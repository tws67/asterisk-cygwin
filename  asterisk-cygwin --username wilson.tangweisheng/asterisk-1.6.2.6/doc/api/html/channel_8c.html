<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:21:44 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_afe38fc0ccf2e9eefca5d5c6b03503d9.html">main</a>
  </div>
</div>
<div class="contents">
<h1>channel.c File Reference</h1>
<p>Channel Management.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="asterisk_8h_source.html">asterisk.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="__private_8h_source.html">asterisk/_private.h</a>&quot;</code><br/>
<code>#include &lt;sys/time.h&gt;</code><br/>
<code>#include &lt;signal.h&gt;</code><br/>
<code>#include &lt;math.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="paths_8h_source.html">asterisk/paths.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="pbx_8h_source.html">asterisk/pbx.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="frame_8h_source.html">asterisk/frame.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="mod__format_8h_source.html">asterisk/mod_format.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="sched_8h_source.html">asterisk/sched.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="channel_8h_source.html">asterisk/channel.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="musiconhold_8h_source.html">asterisk/musiconhold.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="say_8h_source.html">asterisk/say.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="file_8h_source.html">asterisk/file.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="cli_8h_source.html">asterisk/cli.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="translate_8h_source.html">asterisk/translate.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="manager_8h_source.html">asterisk/manager.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="chanvars_8h_source.html">asterisk/chanvars.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="linkedlists_8h_source.html">asterisk/linkedlists.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="indications_8h_source.html">asterisk/indications.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="monitor_8h_source.html">asterisk/monitor.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="causes_8h_source.html">asterisk/causes.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="callerid_8h_source.html">asterisk/callerid.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="utils_8h_source.html">asterisk/utils.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="lock_8h_source.html">asterisk/lock.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="app_8h_source.html">asterisk/app.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="transcap_8h_source.html">asterisk/transcap.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="devicestate_8h_source.html">asterisk/devicestate.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="sha1_8h_source.html">asterisk/sha1.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="threadstorage_8h_source.html">asterisk/threadstorage.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="slinfactory_8h_source.html">asterisk/slinfactory.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="audiohook_8h_source.html">asterisk/audiohook.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="timing_8h_source.html">asterisk/timing.h</a>&quot;</code><br/>

<p><a href="channel_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__epoll__data.html">ast_epoll_data</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__silence__generator.html">ast_silence_generator</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structbackends.html">backends</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">the list of registered channel types  <a href="structbackends.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structchanlist.html">chanlist</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">List of channel drivers.  <a href="structchanlist.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structchannels.html">channels</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">the list of <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> we have. Note that the lock for this list is used for both the <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> list and the <a class="el" href="structbackends.html" title="the list of registered channel types">backends</a> list.  <a href="structchannels.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structtonepair__def.html">tonepair_def</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structtonepair__state.html">tonepair_state</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a4a1bcc0fd8b14e9bbff17b963969bcab">AST_DEFAULT_EMULATE_DTMF_DURATION</a>&nbsp;&nbsp;&nbsp;100</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a1422a2613fb73b73e9ded35fa30ff02b">AST_MIN_DTMF_DURATION</a>&nbsp;&nbsp;&nbsp;80</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a21882e640e01106e62bdab88849a17c5">AST_MIN_DTMF_GAP</a>&nbsp;&nbsp;&nbsp;45</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#ac8dc47e3b39c930caed4bfd05b4ba805">FORMAT</a>&nbsp;&nbsp;&nbsp;&quot;%-10.10s  %-40.40s %-12.12s %-12.12s %-12.12s\n&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#afd4de5975fd2bcaa99390ba19d28f990">STATE2STR_BUFSIZE</a>&nbsp;&nbsp;&nbsp;32</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a5457ba5b9d85a5167027716d84449f1f">__ast_answer</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, unsigned int delay, int cdr_answer)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Answer a channel, with a selectable delay before returning.  <a href="#a5457ba5b9d85a5167027716d84449f1f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a3a8fbe84b62a1b5c60bf4c837e1c1125">__ast_channel_alloc</a> (int needqueue, int <a class="el" href="structstate.html">state</a>, const char *<a class="el" href="chan__phone_8c.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>, const char *<a class="el" href="chan__phone_8c.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>, const char *acctcode, const char *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, const int amaflag, const char *file, int line, const char *function, const char *name_fmt,...)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create a channel structure.  <a href="#a3a8fbe84b62a1b5c60bf4c837e1c1125"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__channel.html">ast_channel</a> <br class="typebreak"/>
*attribute_malloc&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a8da909f2e85e052550b1e56dcfb57962">__ast_channel_alloc_ap</a> (int needqueue, int <a class="el" href="structstate.html">state</a>, const char *<a class="el" href="chan__phone_8c.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>, const char *<a class="el" href="chan__phone_8c.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>, const char *acctcode, const char *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, const int amaflag, const char *file, int line, const char *function, const char *name_fmt, va_list ap1, va_list ap2)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create a new channel structure.  <a href="#a8da909f2e85e052550b1e56dcfb57962"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#ae5b763a23d35fc0b721adc3df8724712">__ast_queue_frame</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__frame.html">ast_frame</a> *fin, int head, struct <a class="el" href="structast__frame.html">ast_frame</a> *after)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a69a66588107e52e682f046d05898ff43">__ast_read</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, int dropaudio)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#ab387fa45df3edc5e64f5c2e2c07860ed">__ast_request_and_dial</a> (const char *<a class="el" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, int <a class="el" href="chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a>, void *data, int timeout, int *outstate, const char *<a class="el" href="chan__phone_8c.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>, const char *<a class="el" href="chan__phone_8c.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>, struct <a class="el" href="structoutgoing__helper.html">outgoing_helper</a> *oh)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Request a channel of a given type, with data as optional information used by the low level module and attempt to place a call on it.  <a href="#ab387fa45df3edc5e64f5c2e2c07860ed"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a4dc5afc784da719a0f626ec53d86d2cc">__init_state2str_threadbuf</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a12a58dda74a19f383f6b77cf7fa88b54">ast_activate_generator</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__generator.html">ast_generator</a> *<a class="el" href="app__externalivr_8c.html#abe143f1bae4445e9b3798e1dec3bda60">gen</a>, void *params)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a9704ae96ab849e9e5a20040c13d29705">ast_active_channels</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">returns <a class="el" href="structnumber.html" title="Number structure.">number</a> of active/allocated <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>  <a href="#a9704ae96ab849e9e5a20040c13d29705"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#aec583a3e25358ee552a4f3df53914cd0">ast_answer</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Answer a channel.  <a href="#aec583a3e25358ee552a4f3df53914cd0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#abfff88810f1ead9e04b3e826265db91b">ast_begin_shutdown</a> (int hangup)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initiate system shutdown.  <a href="#abfff88810f1ead9e04b3e826265db91b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a4d78194779a26341c3ec7298b450b9ed">ast_best_codec</a> (int fmts)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Pick the best audio codec.  <a href="#a4d78194779a26341c3ec7298b450b9ed"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a3f52a5e35d47d8986ccaa66a86018e3a">ast_bridged_channel</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find bridged channel.  <a href="#a3f52a5e35d47d8986ccaa66a86018e3a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#ae212e5f3ae50a869bbf859fe9db7dee0">ast_call</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, char *addr, int timeout)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Make a call.  <a href="#ae212e5f3ae50a869bbf859fe9db7dee0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a05e7ee16979b176273568bea55d2e87d">ast_call_forward</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *caller, struct <a class="el" href="structast__channel.html">ast_channel</a> *orig, int *timeout, int <a class="el" href="chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a>, struct <a class="el" href="structoutgoing__helper.html">outgoing_helper</a> *oh, int *outstate)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Forwards a call to a new channel specified by the original channel's call_forward str. If possible, the new forwarded channel is created and returned while the original one is terminated.  <a href="#a05e7ee16979b176273568bea55d2e87d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#ace6102c072609981f5c400a2d8e282b7">ast_cancel_shutdown</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Cancel a shutdown in <a class="el" href="structprogress.html">progress</a>.  <a href="#ace6102c072609981f5c400a2d8e282b7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a6ea5858ffa106c4991e43bed491293d9">ast_cause2str</a> (int <a class="el" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Gives the string form of a given hangup cause.  <a href="#a6ea5858ffa106c4991e43bed491293d9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a278899a6fc247f9d734ee13a0361aba5">ast_change_name</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, char *newname)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Change channel name.  <a href="#a278899a6fc247f9d734ee13a0361aba5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a38912daf13c69c689a6d5a908672f5c9">ast_channel_alloc</a> (int needqueue, int <a class="el" href="structstate.html">state</a>, const char *<a class="el" href="chan__phone_8c.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>, const char *<a class="el" href="chan__phone_8c.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>, const char *acctcode, const char *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, const int amaflag, const char *name_fmt,...)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05">ast_bridge_result</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#af5f7a28a37717951fccf8abd7e70ec80">ast_channel_bridge</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c0, struct <a class="el" href="structast__channel.html">ast_channel</a> *c1, struct <a class="el" href="structast__bridge__config.html">ast_bridge_config</a> *<a class="el" href="pbx__lua_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>, struct <a class="el" href="structast__frame.html">ast_frame</a> **fo, struct <a class="el" href="structast__channel.html">ast_channel</a> **rc)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Bridge two <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> together.  <a href="#af5f7a28a37717951fccf8abd7e70ec80"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#ac926f4e8ce2c5fccf5632510fd3d3cde">ast_channel_cmpwhentohangup</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, time_t offset)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Compare a offset with the settings of when to hang a channel up.  <a href="#ac926f4e8ce2c5fccf5632510fd3d3cde"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a742eebbd38e247bf75ecc419683fa784">ast_channel_cmpwhentohangup_tv</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct timeval offset)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Compare a offset with when to hangup channel.  <a href="#a742eebbd38e247bf75ecc419683fa784"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a1ed3e98d33d5587948a0e2ef67a81f52">ast_channel_datastore_add</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__datastore.html">ast_datastore</a> *datastore)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add a datastore to a channel.  <a href="#a1ed3e98d33d5587948a0e2ef67a81f52"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__datastore.html">ast_datastore</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#aac02d8cdcc95c07bf2fd705c7485255f">ast_channel_datastore_alloc</a> (const struct <a class="el" href="structast__datastore__info.html">ast_datastore_info</a> *info, const char *uid)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create a channel data store object.  <a href="#aac02d8cdcc95c07bf2fd705c7485255f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__datastore.html">ast_datastore</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#aad1e09cd7c79237d05cffb45d6cdfd7c">ast_channel_datastore_find</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const struct <a class="el" href="structast__datastore__info.html">ast_datastore_info</a> *info, const char *uid)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find a datastore on a channel.  <a href="#aad1e09cd7c79237d05cffb45d6cdfd7c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#ab6fba293c76b4a30ba1a240df068a863">ast_channel_datastore_free</a> (struct <a class="el" href="structast__datastore.html">ast_datastore</a> *datastore)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Free a channel data store object.  <a href="#ab6fba293c76b4a30ba1a240df068a863"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a6ce892974f59537bda03a71319b452e2">ast_channel_datastore_inherit</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *from, struct <a class="el" href="structast__channel.html">ast_channel</a> *to)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Inherit datastores from a parent to a child.  <a href="#a6ce892974f59537bda03a71319b452e2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a1ff1c62b6d50823da93a920575c9c0c9">ast_channel_datastore_remove</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__datastore.html">ast_datastore</a> *datastore)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Remove a datastore from a channel.  <a href="#a1ff1c62b6d50823da93a920575c9c0c9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#aeaeb784665c384163aefb975ddf8bbe8">ast_channel_defer_dtmf</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set defer DTMF flag on channel.  <a href="#aeaeb784665c384163aefb975ddf8bbe8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#aef0540461d88daff61e411841ae264ae">ast_channel_early_bridge</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c0, struct <a class="el" href="structast__channel.html">ast_channel</a> *c1)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Bridge two <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> together (early).  <a href="#aef0540461d88daff61e411841ae264ae"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a9ad2da80ecc312fb4273e45f5ebb6774">ast_channel_free</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Free a channel structure.  <a href="#a9ad2da80ecc312fb4273e45f5ebb6774"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a892b6550a4f90b70ad92198c9d05cedc">ast_channel_inherit_variables</a> (const struct <a class="el" href="structast__channel.html">ast_channel</a> *parent, struct <a class="el" href="structast__channel.html">ast_channel</a> *child)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Inherits channel variable from parent to child channel.  <a href="#a892b6550a4f90b70ad92198c9d05cedc"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a4aff0f5358bdc107a92320b4c4631834">ast_channel_make_compatible</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__channel.html">ast_channel</a> *peer)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Makes two channel <a class="el" href="structformats.html">formats</a> compatible.  <a href="#a4aff0f5358bdc107a92320b4c4631834"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a269e229318912967cf9c939d2b7b52e7">ast_channel_make_compatible_helper</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *from, struct <a class="el" href="structast__channel.html">ast_channel</a> *to)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set up translation from one channel to another.  <a href="#a269e229318912967cf9c939d2b7b52e7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a72c00d7dc6b9930fd0c18ebff6e580ac">ast_channel_masquerade</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *original, struct <a class="el" href="structast__channel.html">ast_channel</a> *clonechan)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Weird function made for call transfers.  <a href="#a72c00d7dc6b9930fd0c18ebff6e580ac"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a4ca17f6d1c390e88d53b4180dea5487b">ast_channel_queryoption</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, int option, void *data, int *datalen, int block)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a25ec12c3abdc7ad6d7971f4ad3737d94">ast_channel_reason2str</a> (int reason)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">return an english explanation of the code returned thru __ast_request_and_dial's 'outstate' argument  <a href="#a25ec12c3abdc7ad6d7971f4ad3737d94"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#ab5f3776fda943e52820ceeee5835c1b4">ast_channel_register</a> (const struct <a class="el" href="structast__channel__tech.html">ast_channel_tech</a> *tech)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Register a new telephony channel in Asterisk.  <a href="#ab5f3776fda943e52820ceeee5835c1b4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a4c61dfe488472b90f811c319cdba7741">ast_channel_search_locked</a> (int(*is_match)(struct <a class="el" href="structast__channel.html">ast_channel</a> *, void *), void *data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Search for a channel based on the passed channel matching callback (first match) and return it, locked.  <a href="#a4c61dfe488472b90f811c319cdba7741"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a8d715844337b07f950bf2ff0eb4c5b90">ast_channel_sendhtml</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, int subclass, const char *data, int datalen)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a2f152a294b4dd2561b0da2325421aead">ast_channel_sendurl</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *<a class="el" href="res__config__ldap_8c.html#a75e4590043edf35241d30fabe2eda546">url</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#aca37ca2f3d55a223d26617329ed48a3e">ast_channel_set_fd</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, int which, int fd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a51d19fd5d03e845c18b7826c9f74a3ae">ast_channel_setoption</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, int option, void *data, int datalen, int block)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Sets an option on a channel.  <a href="#a51d19fd5d03e845c18b7826c9f74a3ae"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#ad690134faa51d238410543f225b1f4d8">ast_channel_setwhentohangup</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, time_t offset)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set when to hang a channel up.  <a href="#ad690134faa51d238410543f225b1f4d8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#ac03c2ec5ac8e7a6ef9c5d92f91880927">ast_channel_setwhentohangup_tv</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct timeval offset)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set when to hangup channel.  <a href="#ac03c2ec5ac8e7a6ef9c5d92f91880927"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__silence__generator.html">ast_silence_generator</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a2a2e0ff24c57491a877cac39cb670024">ast_channel_start_silence_generator</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Starts a silence generator on the given channel.  <a href="#a2a2e0ff24c57491a877cac39cb670024"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a6643cbe766a051d2d06750ab5b3e933d">ast_channel_stop_silence_generator</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__silence__generator.html">ast_silence_generator</a> *<a class="el" href="structstate.html">state</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Stops a previously-started silence generator on the given channel.  <a href="#a6643cbe766a051d2d06750ab5b3e933d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#ad8aa1e0753aff7c104f4f4cf134eab68">ast_channel_supports_html</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a6e558e6f257935744c3c7f9cd79b169a">ast_channel_undefer_dtmf</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unset defer DTMF flag on channel.  <a href="#a6e558e6f257935744c3c7f9cd79b169a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a53b708b7fc71dcbcd33acae0ad4d7ef8">ast_channel_unregister</a> (const struct <a class="el" href="structast__channel__tech.html">ast_channel_tech</a> *tech)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unregister channel driver.  <a href="#a53b708b7fc71dcbcd33acae0ad4d7ef8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#af287194cacb2db8ac7bb50d16a3a2d60">ast_channel_walk_locked</a> (const struct <a class="el" href="structast__channel.html">ast_channel</a> *prev)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Browse <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> in use.  <a href="#af287194cacb2db8ac7bb50d16a3a2d60"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#acfffdd54a4bb4777e110dcb3e5118b4c">ast_channels_init</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__variable.html">ast_variable</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#ae5039a62fbb5dc1ecb217f10940d19df">ast_channeltype_list</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">return an <a class="el" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> list of channeltypes  <a href="#ae5039a62fbb5dc1ecb217f10940d19df"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a9c63fff1d736568d1ee332dd7ea502bd">ast_check_hangup</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Checks to see if a channel is needing hang up.  <a href="#a9c63fff1d736568d1ee332dd7ea502bd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a4f08aa89bd0b65faba26148b6c836b2a">ast_check_hangup_locked</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a7160355005776732fba88cc020f4a45b">ast_deactivate_generator</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a680cadb3f6b84fc2b11e0f2b0ec892a5">ast_do_masquerade</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *original)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Masquerade a channel.  <a href="#a680cadb3f6b84fc2b11e0f2b0ec892a5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05">ast_bridge_result</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a94b603f7b9476126cafc9e0b82dd7d4d">ast_generic_bridge</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c0, struct <a class="el" href="structast__channel.html">ast_channel</a> *c1, struct <a class="el" href="structast__bridge__config.html">ast_bridge_config</a> *<a class="el" href="pbx__lua_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>, struct <a class="el" href="structast__frame.html">ast_frame</a> **fo, struct <a class="el" href="structast__channel.html">ast_channel</a> **rc, struct timeval bridge_end)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#aea1f40d6702929cffc39b29f5ba3884b">ast_get_channel_by_exten_locked</a> (const char *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get channel by exten (and optionally context) and lock it.  <a href="#aea1f40d6702929cffc39b29f5ba3884b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a1faeae3019819b1f9df0d0fddd20aa67">ast_get_channel_by_name_locked</a> (const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get channel by name and lock it.  <a href="#a1faeae3019819b1f9df0d0fddd20aa67"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a67239a95ab93867fb9da5a8b20281224">ast_get_channel_by_name_prefix_locked</a> (const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, const int namelen)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get channel by name prefix and lock it.  <a href="#a67239a95ab93867fb9da5a8b20281224"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__channel__tech.html">ast_channel_tech</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a646e90d1a57effdd627779b93f21f4cf">ast_get_channel_tech</a> (const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get handle to channel driver based on name.  <a href="#a646e90d1a57effdd627779b93f21f4cf"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="channel_8h.html#a641d81d0c5c8df99d43eff69aede3bfd">ast_group_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#aee83e23058d0a4111fda1f506cbda107">ast_get_group</a> (const char *s)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c">ast_hangup</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Hangup a channel.  <a href="#a8f2c0f3dcafbc3a74d84a8dddcce6b9c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#aef2af15a597c948e97628da6c5c84f28">ast_indicate</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, int condition)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Indicates condition of channel.  <a href="#aef2af15a597c948e97628da6c5c84f28"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#acea4077a84f9d8ffac3c41bf660e3219">ast_indicate_data</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, int _condition, const void *data, size_t datalen)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Indicates condition of channel, with payload.  <a href="#acea4077a84f9d8ffac3c41bf660e3219"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a76c8f293c2dacf853b96314157f3421b">ast_install_music_functions</a> (int(*start_ptr)(struct <a class="el" href="structast__channel.html">ast_channel</a> *, const char *, const char *), void(*stop_ptr)(struct <a class="el" href="structast__channel.html">ast_channel</a> *), void(*cleanup_ptr)(struct <a class="el" href="structast__channel.html">ast_channel</a> *))</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a99a8df1071a8de39465245afc8ac6af7">ast_internal_timing_enabled</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check if the channel can run in internal timing mode.  <a href="#a99a8df1071a8de39465245afc8ac6af7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a2bfbbbb8be5c8a13ec5a054bbc9f25b1">ast_moh_cleanup</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a2acec01f2fddd8ca494d874003815cf7">ast_moh_start</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *mclass, const char *interpclass)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Turn on music on hold on a given channel.  <a href="#a2acec01f2fddd8ca494d874003815cf7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a52fead32f69533450f3c05b2e6960149">ast_moh_stop</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Turn off music on hold on a given channel.  <a href="#a52fead32f69533450f3c05b2e6960149"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a1b3f92e2239cd9e9bc20c783e1dedc80">ast_poll_channel_add</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *chan0, struct <a class="el" href="structast__channel.html">ast_channel</a> *chan1)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a6b2da1bbe090143571ba1db7f94055a0">ast_poll_channel_del</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *chan0, struct <a class="el" href="structast__channel.html">ast_channel</a> *chan1)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a092d4e67b0bda0f99b02a1534ee75408">ast_print_group</a> (char *<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, int buflen, <a class="el" href="channel_8h.html#a641d81d0c5c8df99d43eff69aede3bfd">ast_group_t</a> <a class="el" href="structgroup.html">group</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Print call <a class="el" href="structgroup.html">group</a> and pickup <a class="el" href="structgroup.html">group</a> ---.  <a href="#a092d4e67b0bda0f99b02a1534ee75408"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a2458f1412e300412e53d86fe94e19002">ast_prod</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send empty audio to prime a channel driver.  <a href="#a2458f1412e300412e53d86fe94e19002"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a60f9d2b0ab8b7a839902313321163b28">ast_queue_control</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, enum <a class="el" href="frame_8h.html#aedda41918e992000fe921f8f7363b390">ast_control_frame_type</a> control)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Queue a control frame.  <a href="#a60f9d2b0ab8b7a839902313321163b28"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a7e5e15c22564fd66351d332ad10658b5">ast_queue_control_data</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, enum <a class="el" href="frame_8h.html#aedda41918e992000fe921f8f7363b390">ast_control_frame_type</a> control, const void *data, size_t datalen)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Queue a control frame with payload.  <a href="#a7e5e15c22564fd66351d332ad10658b5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a3df7007b550647c63a1b211181b55814">ast_queue_frame</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__frame.html">ast_frame</a> *fin)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Queue one or more frames to a channel's frame queue.  <a href="#a3df7007b550647c63a1b211181b55814"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a8b8c37c2fb7bb32b302635f257982271">ast_queue_frame_head</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__frame.html">ast_frame</a> *fin)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Queue one or more frames to the head of a channel's frame queue.  <a href="#a8b8c37c2fb7bb32b302635f257982271"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a30bcf0418189567bc84ff32034f79f28">ast_queue_hangup</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Queue a hangup frame for channel.  <a href="#a30bcf0418189567bc84ff32034f79f28"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a91e78b15da3244307ffd749fa85f4db7">ast_queue_hangup_with_cause</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, int <a class="el" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Queue a hangup frame for channel.  <a href="#a91e78b15da3244307ffd749fa85f4db7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a8b05a8419e1abb88ae5dde4070b6b7f6">ast_raw_answer</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, int cdr_answer)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Answer a channel.  <a href="#a8b05a8419e1abb88ae5dde4070b6b7f6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a7ef6737309dc9e8b6c4a7cb4800638b1">ast_read</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Reads a frame.  <a href="#a7ef6737309dc9e8b6c4a7cb4800638b1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a34c65699645170a1168e9177ad8aebd4">ast_read_generator_actions</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__frame.html">ast_frame</a> *<a class="el" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a1950f7fe77c02d233de02d299bab8c15">ast_read_noaudio</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Reads a frame, returning AST_FRAME_NULL frame if audio.  <a href="#a1950f7fe77c02d233de02d299bab8c15"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a2ead08f6d731f739b40787f79d2a64ef">ast_readstring</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, char *s, int len, int timeout, int ftimeout, char *enders)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a4029626a4c61de707ff021b7af7c3767">ast_readstring_full</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, char *s, int len, int timeout, int ftimeout, char *enders, int audiofd, int ctrlfd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a5d6470615a8701722e9d3c6c6fca01d0">ast_recvchar</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, int timeout)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Receives a text character from a channel.  <a href="#a5d6470615a8701722e9d3c6c6fca01d0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#abb507e6b148bf773fb546ac5c931f264">ast_recvtext</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, int timeout)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Receives a text string from a channel Read a string of text from a channel.  <a href="#abb507e6b148bf773fb546ac5c931f264"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a66276b870fd0d51036df96395f48b570">ast_request</a> (const char *<a class="el" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, int <a class="el" href="chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a>, void *data, int *<a class="el" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Requests a channel.  <a href="#a66276b870fd0d51036df96395f48b570"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#abe0059a0c11d07e32164a53badaeb9ee">ast_request_and_dial</a> (const char *<a class="el" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, int <a class="el" href="chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a>, void *data, int timeout, int *outstate, const char *cidnum, const char *cidname)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Request a channel of a given type, with data as optional information used by the low level module and attempt to place a call on it.  <a href="#abe0059a0c11d07e32164a53badaeb9ee"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#af10e3bd01602095e1908d3926afc3b76">ast_safe_sleep</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, int ms)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Wait, look for hangups.  <a href="#af10e3bd01602095e1908d3926afc3b76"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#ac23326dea0fc5f850ecd80fccef3424e">ast_safe_sleep_conditional</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, int ms, int(*<a class="el" href="res__timing__pthread_8c.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>)(void *), void *data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Wait, look for hangups and condition arg.  <a href="#ac23326dea0fc5f850ecd80fccef3424e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a1a7823cbe91b5dec9dea88cfd756ab96">ast_say_character_str</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *<a class="el" href="evt_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>, const char *ints, const char *lang)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a22de2fa4172d1ecd3b32426ea1b8f4ba">ast_say_digit_str</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *<a class="el" href="evt_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>, const char *ints, const char *lang)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">says digits of a string  <a href="#a22de2fa4172d1ecd3b32426ea1b8f4ba"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a7cf9dcf6ae6fcedb7752d0deac683b3b">ast_say_digits</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, int <a class="el" href="adsistub_8c.html#af6fc584548091f45267cfaf7066119bd">num</a>, const char *ints, const char *lang)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">says digits  <a href="#a7cf9dcf6ae6fcedb7752d0deac683b3b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#ac293bae3a692080477911e637dbf3463">ast_say_digits_full</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, int <a class="el" href="adsistub_8c.html#af6fc584548091f45267cfaf7066119bd">num</a>, const char *ints, const char *lang, int audiofd, int ctrlfd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a91c054f75fcf111f208a9fa185e8cd94">ast_say_enumeration</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, int <a class="el" href="adsistub_8c.html#af6fc584548091f45267cfaf7066119bd">num</a>, const char *ints, const char *<a class="el" href="chan__phone_8c.html#adf416dc058363e2fd5750c77e2d78bee">language</a>, const char *options)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">says an enumeration  <a href="#a91c054f75fcf111f208a9fa185e8cd94"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a0275d7480f8a07d47460752834bb3a40">ast_say_number</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, int <a class="el" href="adsistub_8c.html#af6fc584548091f45267cfaf7066119bd">num</a>, const char *ints, const char *<a class="el" href="chan__phone_8c.html#adf416dc058363e2fd5750c77e2d78bee">language</a>, const char *options)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">says a <a class="el" href="structnumber.html" title="Number structure.">number</a>  <a href="#a0275d7480f8a07d47460752834bb3a40"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#ab7c03b95bdfaed8f38ecd45e93c868d3">ast_say_phonetic_str</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *<a class="el" href="evt_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>, const char *ints, const char *lang)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a48a8b376caf908979e96af8641591c92">ast_senddigit</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, char digit, unsigned int duration)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send a DTMF digit to a channel Send a DTMF digit to a channel.  <a href="#a48a8b376caf908979e96af8641591c92"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a38f90349e730b6556cfe8b99b134d574">ast_senddigit_begin</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, char digit)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send a DTMF digit to a channel Send a DTMF digit to a channel.  <a href="#a38f90349e730b6556cfe8b99b134d574"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#ab45db8cf33a706a5831d553d5199c143">ast_senddigit_end</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, char digit, unsigned int duration)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send a DTMF digit to a channel.  <a href="#ab45db8cf33a706a5831d553d5199c143"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a83631e0dc02a50802cf857caa3fdc1d7">ast_sendtext</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *<a class="el" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Sends text to a channel.  <a href="#a83631e0dc02a50802cf857caa3fdc1d7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a88d833a56ea7de33e230281c5c12b75d">ast_set_callerid</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *<a class="el" href="chan__phone_8c.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>, const char *<a class="el" href="chan__phone_8c.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>, const char *cid_ani)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set caller ID <a class="el" href="structnumber.html" title="Number structure.">number</a>, name and ANI.  <a href="#a88d833a56ea7de33e230281c5c12b75d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#ab2cdfdb9b321f157038e07a92a82d815">ast_set_read_format</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, int fmt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Sets read format on channel chan Set read format for channel to whichever component of "format" is best.  <a href="#ab2cdfdb9b321f157038e07a92a82d815"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a5b14bfe21364dd8f73d45f15cf313524">ast_set_variables</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__variable.html">ast_variable</a> *vars)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">adds a list of channel variables to a channel  <a href="#a5b14bfe21364dd8f73d45f15cf313524"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a7429113b53f8654e9c361fc5cb835a4b">ast_set_write_format</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, int fmt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Sets write format on channel chan Set write format for channel to whichever component of "format" is best.  <a href="#a7429113b53f8654e9c361fc5cb835a4b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a6b869988b7ee213be11a0e45ee3ba09f">ast_setstate</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, enum <a class="el" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a> <a class="el" href="structstate.html">state</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Change the <a class="el" href="structstate.html">state</a> of a channel.  <a href="#a6b869988b7ee213be11a0e45ee3ba09f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#abb39926813ff8874f8e453ca04307e53">ast_settimeout</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, unsigned int rate, int(*func)(const void *data), void *data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Enable or disable timer ticks for a channel.  <a href="#abb39926813ff8874f8e453ca04307e53"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a6b112b17aed018d85c397e7591948793">ast_shutting_down</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns non-zero if Asterisk is being shut down.  <a href="#a6b112b17aed018d85c397e7591948793"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#aaaa09144f0468d0d5f98f1753a6de952">ast_softhangup</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, int <a class="el" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Softly hangup a channel, lock.  <a href="#aaaa09144f0468d0d5f98f1753a6de952"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#acd23f45d08b4bfadd20c9d82e8060e50">ast_softhangup_nolock</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, int <a class="el" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Softly hangup a channel, don't lock.  <a href="#acd23f45d08b4bfadd20c9d82e8060e50"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a5dd820022b230cab3e008926e1496b59">ast_state2str</a> (enum <a class="el" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a> <a class="el" href="structstate.html">state</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Gives the string form of a given channel <a class="el" href="structstate.html">state</a>.  <a href="#a5dd820022b230cab3e008926e1496b59"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#ad92341a4a7c70ec0d99fc410dab9b07a">ast_str2cause</a> (const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convert a symbolic hangup cause to <a class="el" href="structnumber.html" title="Number structure.">number</a>.  <a href="#ad92341a4a7c70ec0d99fc410dab9b07a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#aec0fd025bfdf11852ceca62636006141">ast_tonepair</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, int freq1, int freq2, int duration, int vol)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a45670e7ba068c0e69745fc44e2084046">ast_tonepair_start</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, int freq1, int freq2, int duration, int vol)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#afef5134a6fb69fdd9492981dcf52b31a">ast_tonepair_stop</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#ac6ae24f259d33ae591e76eac023e8b21">ast_transfer</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, char *dest)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Transfer a call to dest, if the channel supports transfer.  <a href="#ac6ae24f259d33ae591e76eac023e8b21"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a465c2ce577a0166ceca7e0880339184c">ast_transfercapability2str</a> (int transfercapability)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Gives the string form of a given transfer capability.  <a href="#a465c2ce577a0166ceca7e0880339184c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a9a1bf5906ede80cab6b57627fea47272">ast_uninstall_music_functions</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#aed7cba5dd8c6d31600f50d4b3f68d9ca">ast_waitfor</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, int ms)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Wait for input on a channel.  <a href="#aed7cba5dd8c6d31600f50d4b3f68d9ca"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#ac7ca5a25b9aad3ecedef29c3725ef112">ast_waitfor_n</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> **c, int n, int *ms)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Waits for input on a <a class="el" href="structgroup.html">group</a> of <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> Wait for input on an array of <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> for a given # of milliseconds.  <a href="#ac7ca5a25b9aad3ecedef29c3725ef112"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a56819f90869d77808fd52f4d2693a75c">ast_waitfor_n_fd</a> (int *fds, int n, int *ms, int *exception)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Wait for x amount of time on a file descriptor to have input.  <a href="#a56819f90869d77808fd52f4d2693a75c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a2e63eaa5b4d94f214edf99838ef7e7e4">ast_waitfor_nandfds</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> **c, int n, int *fds, int nfds, int *exception, int *outfd, int *ms)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Wait for x amount of time on a file descriptor to have input.  <a href="#a2e63eaa5b4d94f214edf99838ef7e7e4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a050bec9a4abc1a599b6573a6091b080c">ast_waitfordigit</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, int ms)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Waits for a digit.  <a href="#a050bec9a4abc1a599b6573a6091b080c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#ab3a4bbc285abf43d520fa3cbfb320464">ast_waitfordigit_full</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, int ms, int audiofd, int cmdfd)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Wait for a digit Same as <a class="el" href="channel_8h.html#a050bec9a4abc1a599b6573a6091b080c" title="Waits for a digit.">ast_waitfordigit()</a> with audio fd for outputting read audio and ctrlfd to monitor for reading.  <a href="#ab3a4bbc285abf43d520fa3cbfb320464"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a4625f1350f67ea98bdc598329a78f1e7">ast_walk_channel_by_exten_locked</a> (const struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get next channel by exten (and optionally context) and lock it.  <a href="#a4625f1350f67ea98bdc598329a78f1e7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#ad0be2bd6da179c80fec23a04c468b872">ast_walk_channel_by_name_prefix_locked</a> (const struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, const int namelen)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get next channel by name prefix and lock it.  <a href="#ad0be2bd6da179c80fec23a04c468b872"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a1b4c335490f5170c1f9e2c7c6781003f">ast_write</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__frame.html">ast_frame</a> *fr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write a frame to a channel This function writes the given frame to the indicated channel.  <a href="#a1b4c335490f5170c1f9e2c7c6781003f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#aaacf12a6a5826c53e7e55b17d1afc3da">ast_write_video</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__frame.html">ast_frame</a> *fr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write video frame to a channel This function writes the given frame to the indicated channel.  <a href="#aaacf12a6a5826c53e7e55b17d1afc3da"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a63b70c68a2dda262d506cc96b48cde08">bridge_play_sounds</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c0, struct <a class="el" href="structast__channel.html">ast_channel</a> *c1)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a63873f4aec1d534d9c12693585db32fc">bridge_playfile</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__channel.html">ast_channel</a> *peer, const char *<a class="el" href="structsound.html">sound</a>, int remain)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a2679f53f358ce4d56596c511afab764b">calc_monitor_jump</a> (int samples, int sample_rate, int seek_rate)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">calculates the <a class="el" href="structnumber.html" title="Number structure.">number</a> of samples to jump forward with in a monitor stream.  <a href="#a2679f53f358ce4d56596c511afab764b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a205b57c2db0974945d767d8fab853e9c">channel_find_locked</a> (const struct <a class="el" href="structast__channel.html">ast_channel</a> *prev, const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, const int namelen, const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, const char *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Helper function to find <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>.  <a href="#a205b57c2db0974945d767d8fab853e9c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a1bb47a3ff4d73a9472f65d00390334c1">channelreloadreason2txt</a> (enum <a class="el" href="channel_8h.html#a57da1ebf1ede65e10ad6816afcab4afe">channelreloadreason</a> reason)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convert enum channelreloadreason to text string for manager event.  <a href="#a1bb47a3ff4d73a9472f65d00390334c1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a21d6a634f2f99c44233e6c734aadc233">clone_variables</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *original, struct <a class="el" href="structast__channel.html">ast_channel</a> *clonechan)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Clone channel variables from 'clone' channel into 'original' channel.  <a href="#a21d6a634f2f99c44233e6c734aadc233"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a8b42faf0887d5d592b2ac859e629e0a2">complete_channeltypes</a> (struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a2bbdbf1f645a90d6271f82c79c0fb2cc">free_cid</a> (struct <a class="el" href="structast__callerid.html">ast_callerid</a> *cid)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#ac9d4d03c20c48d15d9e91a85c5e35d67">free_translation</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *clonechan)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a99698cbdfd9c1a86f36e0a226076e69f">generator_force</a> (const void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a1d6e6458df4bfcb132a6934bafdb7fcc">handle_cause</a> (int <a class="el" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>, int *outstate)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a756671fc7041ac4e1bd415d4348aeae3">handle_cli_core_show_channeltype</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Show details about a channel driver - CLI command.  <a href="#a756671fc7041ac4e1bd415d4348aeae3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#ada1321e35ae7c038a2018396a99abbed">handle_cli_core_show_channeltypes</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Show channel types - CLI command.  <a href="#ada1321e35ae7c038a2018396a99abbed"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int attribute_const&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#ad06e1b83ea6a33e096035c7ac0be5a20">is_visible_indication</a> (enum <a class="el" href="frame_8h.html#aedda41918e992000fe921f8f7363b390">ast_control_frame_type</a> condition)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#ab8a085dee0e97a277287d359ce7f4e4d">manager_bridge_event</a> (int onoff, int <a class="el" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, struct <a class="el" href="structast__channel.html">ast_channel</a> *c0, struct <a class="el" href="structast__channel.html">ast_channel</a> *c1)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send manager event for bridge link and unlink events.  <a href="#ab8a085dee0e97a277287d359ce7f4e4d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a4efcbb7271ae141197a4ec6fa0c834c2">queue_dtmf_readq</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__frame.html">ast_frame</a> *<a class="el" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a452cff7df535d1f9cbc96fcd67b075ec">report_new_callerid</a> (const struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a2897ccacbd4c0c894a7e8212da97ee83">send_dtmf_event</a> (const struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *direction, const char digit, const char *begin, const char *end)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a1d7ab456acdea2bed28186e664a56879">set_format</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, int fmt, int *rawformat, int *<a class="el" href="chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a>, struct <a class="el" href="structast__trans__pvt.html">ast_trans_pvt</a> **trans, const int direction)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a673ed25d2c254caadf6b68f1c64c84f5">should_skip_dtmf</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Determine whether or not we should ignore DTMF in the readq.  <a href="#a673ed25d2c254caadf6b68f1c64c84f5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a9b25e6d6b996635d7fb5fc6e000e71c9">silence_generator_alloc</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a196556ea463d5aa7e7672d673a2f688f">silence_generator_generate</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, void *data, int len, int samples)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a5b6038c1b5aeb272bcb35c937088984c">silence_generator_release</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a6f5a723ce82b8f608b25a36b4df38e46">tonepair_alloc</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, void *params)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a2ac659c4031230f671a2c94eb7f6e806">tonepair_generator</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, void *data, int len, int samples)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a509aeb7d4b65232ad296813f674e90dd">tonepair_release</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, void *params)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a6f45f5d6e87e9a0b9fc31b1f1109f741">update_bridge_vars</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c0, struct <a class="el" href="structast__channel.html">ast_channel</a> *c1)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a83c5734824bc16e2228e1cb9ec40d0fb">ast_moh_cleanup_ptr</a> )(struct <a class="el" href="structast__channel.html">ast_channel</a> *) = NULL</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#ab61499493f5ff948a579c4c4515ef594">ast_moh_start_ptr</a> )(struct <a class="el" href="structast__channel.html">ast_channel</a> *, const char *, const char *) = NULL</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a0b1ab6a1da92f08402ac4df80b8d9512">ast_moh_stop_ptr</a> )(struct <a class="el" href="structast__channel.html">ast_channel</a> *) = NULL</td></tr>
<tr><td class="memItemLeft" >struct {</td></tr>
<tr><td class="memItemLeft" >&nbsp;&nbsp;&nbsp;int&nbsp;&nbsp;&nbsp;<a class="el" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a></td></tr>
<tr><td class="memItemLeft" >&nbsp;&nbsp;&nbsp;const char *&nbsp;&nbsp;&nbsp;<a class="el" href="channel_8c.html#a710bce51374aba96ab04912897666c35">desc</a></td></tr>
<tr><td class="memItemLeft" >&nbsp;&nbsp;&nbsp;const char *&nbsp;&nbsp;&nbsp;<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a></td></tr>
<tr><td class="memItemLeft" valign="top">}&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a9bef477e7c7644e0cdaf5c9f0e115204">causes</a> []</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">map AST_CAUSE's to readable string representations  <a href="#a9bef477e7c7644e0cdaf5c9f0e115204"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#ad74ec6057ffa0240c8dde77284958fbe">cli_channel</a> []</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a7457a2311fc74cc4a5b0aa0d2001835c">global_fin</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#ade9bc8493de7d579e2f06b55379fc673">global_fout</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__channel__tech.html">ast_channel_tech</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#acee4675035da188a1356fc547ff531fa">null_tech</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a7f68568851b9c7f9291f7bb63f932c18">shutting_down</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Prevent new channel allocation if shutting down.  <a href="#a7f68568851b9c7f9291f7bb63f932c18"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__generator.html">ast_generator</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#ac4fb3b333021e26b0305fe4949f5f254">silence_generator</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__threadstorage.html">ast_threadstorage</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#ae578b94d61d4c2aed2c960c8ac288f2b">state2str_threadbuf</a> = { .once = PTHREAD_ONCE_INIT , .key_init = __init_state2str_threadbuf , .custom_init = NULL , }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__generator.html">ast_generator</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a982bf142a56c626e34f9d4c3f1a16d15">tonepair</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="channel_8c.html#a55bca233afc9e4509a8a96f5195753c2">uniqueint</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Channel Management. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Mark Spencer &lt;<a href="mailto:markster@digium.com">markster@digium.com</a>&gt; </dd></dl>

<p>Definition in file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a4a1bcc0fd8b14e9bbff17b963969bcab"></a><!-- doxytag: member="channel.c::AST_DEFAULT_EMULATE_DTMF_DURATION" ref="a4a1bcc0fd8b14e9bbff17b963969bcab" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_DEFAULT_EMULATE_DTMF_DURATION&nbsp;&nbsp;&nbsp;100</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Default amount of time to use when emulating a digit as a begin and end 100ms </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l00093">93</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l02636">__ast_read()</a>, and <a class="el" href="channel_8c_source.html#l03373">ast_senddigit()</a>.</p>

</div>
</div>
<a class="anchor" id="a1422a2613fb73b73e9ded35fa30ff02b"></a><!-- doxytag: member="channel.c::AST_MIN_DTMF_DURATION" ref="a1422a2613fb73b73e9ded35fa30ff02b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_MIN_DTMF_DURATION&nbsp;&nbsp;&nbsp;80</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Minimum allowed digit length - 80ms </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l00096">96</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l02636">__ast_read()</a>.</p>

</div>
</div>
<a class="anchor" id="a21882e640e01106e62bdab88849a17c5"></a><!-- doxytag: member="channel.c::AST_MIN_DTMF_GAP" ref="a21882e640e01106e62bdab88849a17c5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_MIN_DTMF_GAP&nbsp;&nbsp;&nbsp;45</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Minimum amount of time between the end of the last digit and the beginning of a new one - 45ms </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l00100">100</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l02636">__ast_read()</a>, and <a class="el" href="channel_8c_source.html#l02596">should_skip_dtmf()</a>.</p>

</div>
</div>
<a class="anchor" id="ac8dc47e3b39c930caed4bfd05b4ba805"></a><!-- doxytag: member="channel.c::FORMAT" ref="ac8dc47e3b39c930caed4bfd05b4ba805" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FORMAT&nbsp;&nbsp;&nbsp;&quot;%-10.10s  %-40.40s %-12.12s %-12.12s %-12.12s\n&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="afd4de5975fd2bcaa99390ba19d28f990"></a><!-- doxytag: member="channel.c::STATE2STR_BUFSIZE" ref="afd4de5975fd2bcaa99390ba19d28f990" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATE2STR_BUFSIZE&nbsp;&nbsp;&nbsp;32</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l00089">89</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l00656">ast_state2str()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a5457ba5b9d85a5167027716d84449f1f"></a><!-- doxytag: member="channel.c::__ast_answer" ref="a5457ba5b9d85a5167027716d84449f1f" args="(struct ast_channel *chan, unsigned int delay, int cdr_answer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int __ast_answer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>delay</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cdr_answer</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Answer a channel, with a selectable delay before returning. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel to answer </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>delay</em>&nbsp;</td><td>maximum amount of time to wait for incoming media </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>cdr_answer</em>&nbsp;</td><td>flag to control whether any associated CDR should be marked as 'answered'</td></tr>
  </table>
  </dd>
</dl>
<p>This function answers a channel and handles all necessary call setup functions.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>The channel passed does not need to be locked, but is locked by the function when needed.</dd>
<dd>
This function will wait up to 'delay' milliseconds for media to arrive on the channel before returning to the caller, so that the caller can properly assume the channel is 'ready' for media flow. If 'delay' is less than 500, the function will wait up to 500 milliseconds.</dd></dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>non-zero</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01850">1850</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="frame_8h_source.html#l00298">AST_CONTROL_HANGUP</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8h_source.html#l00118">AST_FRAME_CNG</a>, <a class="el" href="frame_8h_source.html#l00105">AST_FRAME_CONTROL</a>, <a class="el" href="frame_8h_source.html#l00122">AST_FRAME_DTMF_BEGIN</a>, <a class="el" href="frame_8h_source.html#l00099">AST_FRAME_DTMF_END</a>, <a class="el" href="frame_8h_source.html#l00115">AST_FRAME_HTML</a>, <a class="el" href="frame_8h_source.html#l00109">AST_FRAME_IAX</a>, <a class="el" href="frame_8h_source.html#l00113">AST_FRAME_IMAGE</a>, <a class="el" href="frame_8h_source.html#l00120">AST_FRAME_MODEM</a>, <a class="el" href="frame_8h_source.html#l00107">AST_FRAME_NULL</a>, <a class="el" href="frame_8h_source.html#l00111">AST_FRAME_TEXT</a>, <a class="el" href="frame_8h_source.html#l00103">AST_FRAME_VIDEO</a>, <a class="el" href="frame_8h_source.html#l00101">AST_FRAME_VOICE</a>, <a class="el" href="frame_8h_source.html#l00462">ast_frfree</a>, <a class="el" href="frame_8c_source.html#l00389">ast_frisolate()</a>, <a class="el" href="linkedlists_8h_source.html#l00665">AST_LIST_HEAD_INIT_NOLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00224">AST_LIST_HEAD_NOLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00695">AST_LIST_INSERT_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00817">AST_LIST_REMOVE_HEAD</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8c_source.html#l01085">ast_queue_frame_head()</a>, <a class="el" href="channel_8c_source.html#l01799">ast_raw_answer()</a>, <a class="el" href="channel_8c_source.html#l03100">ast_read()</a>, <a class="el" href="channel_8h_source.html#l00363">AST_STATE_RING</a>, <a class="el" href="channel_8h_source.html#l00364">AST_STATE_RINGING</a>, <a class="el" href="channel_8c_source.html#l02389">ast_waitfor()</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="iax2-parser_8c_source.html#l00045">frames</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="utils_8h_source.html#l00226">MAX</a>, and <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l01951">ast_answer()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="pbx_8c_source.html#l08504">pbx_builtin_answer()</a>, and <a class="el" href="pbx_8c_source.html#l08536">pbx_builtin_incomplete()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01851"></a>01851 {
<a name="l01852"></a>01852    <span class="keywordtype">int</span> res = 0;
<a name="l01853"></a>01853    <span class="keyword">enum</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660" title="ast_channel states">ast_channel_state</a> old_state;
<a name="l01854"></a>01854 
<a name="l01855"></a>01855    old_state = chan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>;
<a name="l01856"></a>01856    <span class="keywordflow">if</span> ((res = <a class="code" href="channel_8h.html#a8b05a8419e1abb88ae5dde4070b6b7f6" title="Answer a channel.">ast_raw_answer</a>(chan, cdr_answer))) {
<a name="l01857"></a>01857       <span class="keywordflow">return</span> res;
<a name="l01858"></a>01858    }
<a name="l01859"></a>01859 
<a name="l01860"></a>01860    <span class="keywordflow">switch</span> (old_state) {
<a name="l01861"></a>01861    <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>:
<a name="l01862"></a>01862    <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>:
<a name="l01863"></a>01863       <span class="comment">/* wait for media to start flowing, but don&apos;t wait any longer</span>
<a name="l01864"></a>01864 <span class="comment">       * than &apos;delay&apos; or 500 milliseconds, whichever is longer</span>
<a name="l01865"></a>01865 <span class="comment">       */</span>
<a name="l01866"></a>01866       <span class="keywordflow">do</span> {
<a name="l01867"></a>01867          <a class="code" href="linkedlists_8h.html#a117cbef6a40010cd3c84a16fd9ef4ca6" title="Defines a structure to be used to hold a list of specified type (with no lock).">AST_LIST_HEAD_NOLOCK</a>(, <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a>) <a class="code" href="iax2-parser_8c.html#a61217d5bc9d5b446d9c08e7ca401b733">frames</a>;
<a name="l01868"></a>01868          struct <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *cur, *new;
<a name="l01869"></a>01869          <span class="keywordtype">int</span> ms = <a class="code" href="utils_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(delay, 500);
<a name="l01870"></a>01870          <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> done = 0;
<a name="l01871"></a>01871 
<a name="l01872"></a>01872          <a class="code" href="linkedlists_8h.html#a0d1f922e093ac18824a7863fe3f5fa27" title="Initializes a list head structure.">AST_LIST_HEAD_INIT_NOLOCK</a>(&amp;frames);
<a name="l01873"></a>01873 
<a name="l01874"></a>01874          for (;;) {
<a name="l01875"></a>01875             ms = <a class="code" href="channel_8h.html#a60e0bcaed001e8d5ed1ba0eb2644b3cc" title="Wait for input on a channel.">ast_waitfor</a>(chan, ms);
<a name="l01876"></a>01876             <span class="keywordflow">if</span> (ms &lt; 0) {
<a name="l01877"></a>01877                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Error condition occurred when polling channel %s for a voice frame: %s\n&quot;</span>, chan-&gt;name, strerror(errno));
<a name="l01878"></a>01878                res = -1;
<a name="l01879"></a>01879                <span class="keywordflow">break</span>;
<a name="l01880"></a>01880             }
<a name="l01881"></a>01881             <span class="keywordflow">if</span> (ms == 0) {
<a name="l01882"></a>01882                <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;Didn&apos;t receive a media frame from %s within %d ms of answering. Continuing anyway\n&quot;</span>, chan-&gt;name, <a class="code" href="utils_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(delay, 500));
<a name="l01883"></a>01883                <span class="keywordflow">break</span>;
<a name="l01884"></a>01884             }
<a name="l01885"></a>01885             cur = <a class="code" href="channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1" title="Reads a frame.">ast_read</a>(chan);
<a name="l01886"></a>01886             <span class="keywordflow">if</span> (!cur || ((cur-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>) &amp;&amp;
<a name="l01887"></a>01887                     (cur-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> == <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa7dac1c1896ab418c2ff351aae707fba">AST_CONTROL_HANGUP</a>))) {
<a name="l01888"></a>01888                <span class="keywordflow">if</span> (cur) {
<a name="l01889"></a>01889                   <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(cur);
<a name="l01890"></a>01890                }
<a name="l01891"></a>01891                res = -1;
<a name="l01892"></a>01892                <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;Hangup of channel %s detected in answer routine\n&quot;</span>, chan-&gt;name);
<a name="l01893"></a>01893                <span class="keywordflow">break</span>;
<a name="l01894"></a>01894             }
<a name="l01895"></a>01895 
<a name="l01896"></a>01896             <span class="keywordflow">if</span> ((<span class="keyword">new</span> = <a class="code" href="frame_8h.html#aa7dbd9b12889d9f96fb6c01f94b4909e" title="Makes a frame independent of any static storage.">ast_frisolate</a>(cur)) != cur) {
<a name="l01897"></a>01897                <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(cur);
<a name="l01898"></a>01898             }
<a name="l01899"></a>01899 
<a name="l01900"></a>01900             <a class="code" href="linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307" title="Inserts a list entry at the head of a list.">AST_LIST_INSERT_HEAD</a>(&amp;frames, <span class="keyword">new</span>, frame_list);
<a name="l01901"></a>01901 
<a name="l01902"></a>01902             <span class="comment">/* if a specific delay period was requested, continue</span>
<a name="l01903"></a>01903 <span class="comment">             * until that delay has passed. don&apos;t stop just because</span>
<a name="l01904"></a>01904 <span class="comment">             * incoming media has arrived.</span>
<a name="l01905"></a>01905 <span class="comment">             */</span>
<a name="l01906"></a>01906             <span class="keywordflow">if</span> (delay) {
<a name="l01907"></a>01907                <span class="keywordflow">continue</span>;
<a name="l01908"></a>01908             }
<a name="l01909"></a>01909 
<a name="l01910"></a>01910             <span class="keywordflow">switch</span> (new-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a>) {
<a name="l01911"></a>01911                <span class="comment">/* all of these frametypes qualify as &apos;media&apos; */</span>
<a name="l01912"></a>01912             <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>:
<a name="l01913"></a>01913             <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a17ae96b6ea8a2388bb0d409e8124ff30">AST_FRAME_VIDEO</a>:
<a name="l01914"></a>01914             <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0af7728b18670d3cd075f63d67f8867078">AST_FRAME_TEXT</a>:
<a name="l01915"></a>01915             <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a9b350360a64b55c7590f1ec03db480be">AST_FRAME_DTMF_BEGIN</a>:
<a name="l01916"></a>01916             <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a98e65764bc963016c394bcc1bad6540b">AST_FRAME_DTMF_END</a>:
<a name="l01917"></a>01917             <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a6c9398ee8989239124295d096a87bf32">AST_FRAME_IMAGE</a>:
<a name="l01918"></a>01918             <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a3d91bab33583f560197e21532a02a895">AST_FRAME_HTML</a>:
<a name="l01919"></a>01919             <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ad99b86353343f422bda01163898b2eea">AST_FRAME_MODEM</a>:
<a name="l01920"></a>01920                done = 1;
<a name="l01921"></a>01921                <span class="keywordflow">break</span>;
<a name="l01922"></a>01922             <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>:
<a name="l01923"></a>01923             <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a7f7e5bdc9f8a8ef45c4d078f96b52624">AST_FRAME_IAX</a>:
<a name="l01924"></a>01924             <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a29ff71f9d5c7927906ebd437fe372056">AST_FRAME_NULL</a>:
<a name="l01925"></a>01925             <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a8089c2a7198a1063db9e6c3f904482a4">AST_FRAME_CNG</a>:
<a name="l01926"></a>01926                <span class="keywordflow">break</span>;
<a name="l01927"></a>01927             }
<a name="l01928"></a>01928 
<a name="l01929"></a>01929             <span class="keywordflow">if</span> (done) {
<a name="l01930"></a>01930                <span class="keywordflow">break</span>;
<a name="l01931"></a>01931             }
<a name="l01932"></a>01932          }
<a name="l01933"></a>01933 
<a name="l01934"></a>01934          <span class="keywordflow">if</span> (res == 0) {
<a name="l01935"></a>01935             <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l01936"></a>01936             <span class="keywordflow">while</span> ((cur = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;frames, frame_list))) {
<a name="l01937"></a>01937                <a class="code" href="channel_8h.html#a5665eaabfca509388208e4bd83ed7532" title="Queue one or more frames to the head of a channel&amp;#39;s frame queue.">ast_queue_frame_head</a>(chan, cur);
<a name="l01938"></a>01938                <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(cur);
<a name="l01939"></a>01939             }
<a name="l01940"></a>01940             <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l01941"></a>01941          }
<a name="l01942"></a>01942       } <span class="keywordflow">while</span> (0);
<a name="l01943"></a>01943       <span class="keywordflow">break</span>;
<a name="l01944"></a>01944    <span class="keywordflow">default</span>:
<a name="l01945"></a>01945       <span class="keywordflow">break</span>;
<a name="l01946"></a>01946    }
<a name="l01947"></a>01947 
<a name="l01948"></a>01948    <span class="keywordflow">return</span> res;
<a name="l01949"></a>01949 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3a8fbe84b62a1b5c60bf4c837e1c1125"></a><!-- doxytag: member="channel.c::__ast_channel_alloc" ref="a3a8fbe84b62a1b5c60bf4c837e1c1125" args="(int needqueue, int state, const char *cid_num, const char *cid_name, const char *acctcode, const char *exten, const char *context, const int amaflag, const char *file, int line, const char *function, const char *name_fmt,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__channel.html">ast_channel</a>* __ast_channel_alloc </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>needqueue</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>cid_num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>cid_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>acctcode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>exten</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>amaflag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>line</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>function</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name_fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>...</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create a channel structure. </p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>NULL</em>&nbsp;</td><td>failure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>non-NULL</em>&nbsp;</td><td>successfully allocated channel</td></tr>
  </table>
  </dd>
</dl>
<dl class="note"><dt><b>Note:</b></dt><dd>By default, new <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> are set to the "s" <a class="el" href="structextension.html">extension</a> and "default" context. </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l00972">972</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l00772">__ast_channel_alloc_ap()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00977"></a>00977 {
<a name="l00978"></a>00978    va_list ap1, ap2;
<a name="l00979"></a>00979    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *result;
<a name="l00980"></a>00980 
<a name="l00981"></a>00981    va_start(ap1, name_fmt);
<a name="l00982"></a>00982    va_start(ap2, name_fmt);
<a name="l00983"></a>00983    result = <a class="code" href="channel_8c.html#a8da909f2e85e052550b1e56dcfb57962" title="Create a new channel structure.">__ast_channel_alloc_ap</a>(needqueue, <a class="code" href="structstate.html">state</a>, <a class="code" href="chan__mgcp_8c.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>, <a class="code" href="chan__mgcp_8c.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>, acctcode, <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>,
<a name="l00984"></a>00984                amaflag, file, line, function, name_fmt, ap1, ap2);
<a name="l00985"></a>00985    va_end(ap1);
<a name="l00986"></a>00986    va_end(ap2);
<a name="l00987"></a>00987 
<a name="l00988"></a>00988    <span class="keywordflow">return</span> result;
<a name="l00989"></a>00989 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8da909f2e85e052550b1e56dcfb57962"></a><!-- doxytag: member="channel.c::__ast_channel_alloc_ap" ref="a8da909f2e85e052550b1e56dcfb57962" args="(int needqueue, int state, const char *cid_num, const char *cid_name, const char *acctcode, const char *exten, const char *context, const int amaflag, const char *file, int line, const char *function, const char *name_fmt, va_list ap1, va_list ap2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__channel.html">ast_channel</a>* attribute_malloc __ast_channel_alloc_ap </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>needqueue</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>cid_num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>cid_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>acctcode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>exten</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>amaflag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>line</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>function</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name_fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">va_list&nbsp;</td>
          <td class="paramname"> <em>ap1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">va_list&nbsp;</td>
          <td class="paramname"> <em>ap2</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create a new channel structure. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l00772">772</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="astmm_8c_source.html#l00199">__ast_calloc()</a>, <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="chan__iax2_8c_source.html#l00328">accountcode</a>, <a class="el" href="channel_8h_source.html#l00481">ast_channel::alertpipe</a>, <a class="el" href="channel_8h_source.html#l00473">ast_channel::amaflags</a>, <a class="el" href="channel_8h_source.html#l00158">AST_ALERT_FD</a>, <a class="el" href="lock_8h_source.html#l01964">ast_atomic_fetchadd_int()</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="cdr_8c_source.html#l00452">ast_cdr_alloc()</a>, <a class="el" href="cdr_8c_source.html#l00844">ast_cdr_init()</a>, <a class="el" href="cdr_8c_source.html#l00674">ast_cdr_start()</a>, <a class="el" href="channel_8c_source.html#l01576">ast_channel_set_fd()</a>, <a class="el" href="asterisk_8c_source.html#l00265">ast_config_AST_SYSTEM_NAME</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="cdr_8c_source.html#l00055">ast_default_accountcode</a>, <a class="el" href="cdr_8c_source.html#l00054">ast_default_amaflags</a>, <a class="el" href="channel_8h_source.html#l00567">AST_FLAG_IN_CHANNEL_LIST</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="linkedlists_8h_source.html#l00665">AST_LIST_HEAD_INIT_NOLOCK</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8h_source.html#l00153">AST_MAX_FDS</a>, <a class="el" href="lock_8h_source.html#l01692">ast_mutex_init()</a>, <a class="el" href="linkedlists_8h_source.html#l00702">AST_RWLIST_INSERT_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="channel_8c_source.html#l00656">ast_state2str()</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="stringfields_8h_source.html#l00308">ast_string_field_build</a>, <a class="el" href="stringfields_8h_source.html#l00332">ast_string_field_build_va</a>, <a class="el" href="stringfields_8h_source.html#l00245">ast_string_field_free_memory</a>, <a class="el" href="stringfields_8h_source.html#l00241">ast_string_field_init</a>, <a class="el" href="stringfields_8h_source.html#l00285">ast_string_field_set</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="timing_8c_source.html#l00146">ast_timer_close()</a>, <a class="el" href="timing_8c_source.html#l00153">ast_timer_fd()</a>, <a class="el" href="timing_8c_source.html#l00119">ast_timer_open()</a>, <a class="el" href="channel_8h_source.html#l00159">AST_TIMING_FD</a>, <a class="el" href="channel_8h_source.html#l00422">ast_channel::cdr</a>, <a class="el" href="channel_8h_source.html#l00444">ast_channel::cid</a>, <a class="el" href="channel_8h_source.html#l00204">ast_callerid::cid_name</a>, <a class="el" href="channel_8h_source.html#l00203">ast_callerid::cid_num</a>, <a class="el" href="channel_8h_source.html#l00503">ast_channel::context</a>, <a class="el" href="asterisk_8c_source.html#l00219">defaultlanguage</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="manager_8h_source.html#l00062">EVENT_FLAG_CALL</a>, <a class="el" href="channel_8h_source.html#l00504">ast_channel::exten</a>, <a class="el" href="channel_8h_source.html#l00458">ast_channel::fds</a>, <a class="el" href="channel_8h_source.html#l00475">ast_channel::fin</a>, <a class="el" href="app__dial_8c_source.html#l00570">chanlist::flags</a>, <a class="el" href="channel_8h_source.html#l00477">ast_channel::fout</a>, <a class="el" href="chan__alsa_8c_source.html#l00106">language</a>, <a class="el" href="channel_8h_source.html#l00443">ast_channel::lock_dont_use</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="manager_8h_source.html#l00181">manager_event</a>, <a class="el" href="cdr__adaptive__odbc_8c_source.html#l00053">name</a>, <a class="el" href="channel_8c_source.html#l00765">null_tech</a>, <a class="el" href="channel_8h_source.html#l00471">ast_channel::priority</a>, <a class="el" href="strings_8h_source.html#l00072">S_OR</a>, <a class="el" href="channel_8h_source.html#l00413">ast_channel::sched</a>, <a class="el" href="sched_8c_source.html#l00239">sched_context_create()</a>, <a class="el" href="sched_8c_source.html#l00260">sched_context_destroy()</a>, <a class="el" href="channel_8h_source.html#l00465">ast_channel::streamid</a>, <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>, <a class="el" href="channel_8h_source.html#l00499">ast_channel::timer</a>, <a class="el" href="channel_8h_source.html#l00468">ast_channel::timingfd</a>, and <a class="el" href="channel_8h_source.html#l00446">ast_channel::varshead</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l00972">__ast_channel_alloc()</a>, and <a class="el" href="channel_8c_source.html#l05876">ast_channel_alloc()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00776"></a>00776 {
<a name="l00777"></a>00777    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *tmp;
<a name="l00778"></a>00778    <span class="keywordtype">int</span> x;
<a name="l00779"></a>00779    <span class="keywordtype">int</span> <a class="code" href="structast__channel.html#ac92588540e8c1d014a08cd8a45462b19">flags</a>;
<a name="l00780"></a>00780    <span class="keyword">struct </span>varshead *headp;
<a name="l00781"></a>00781 
<a name="l00782"></a>00782    <span class="comment">/* If shutting down, don&apos;t allocate any new channels */</span>
<a name="l00783"></a>00783    <span class="keywordflow">if</span> (<a class="code" href="channel_8c.html#a7f68568851b9c7f9291f7bb63f932c18" title="Prevent new channel allocation if shutting down.">shutting_down</a>) {
<a name="l00784"></a>00784       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Channel allocation failed: Refusing due to active shutdown\n&quot;</span>);
<a name="l00785"></a>00785       <span class="keywordflow">return</span> NULL;
<a name="l00786"></a>00786    }
<a name="l00787"></a>00787 
<a name="l00788"></a>00788 <span class="preprocessor">#if defined(__AST_DEBUG_MALLOC)</span>
<a name="l00789"></a>00789 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (!(tmp = <a class="code" href="astmm_8h.html#ad800d5c993a0c605f6e061bdef1b524c">__ast_calloc</a>(1, <span class="keyword">sizeof</span>(*tmp), file, line, function))) {
<a name="l00790"></a>00790       <span class="keywordflow">return</span> NULL;
<a name="l00791"></a>00791    }
<a name="l00792"></a>00792 <span class="preprocessor">#else</span>
<a name="l00793"></a>00793 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (!(tmp = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*tmp)))) {
<a name="l00794"></a>00794       <span class="keywordflow">return</span> NULL;
<a name="l00795"></a>00795    }
<a name="l00796"></a>00796 <span class="preprocessor">#endif</span>
<a name="l00797"></a>00797 <span class="preprocessor"></span>
<a name="l00798"></a>00798    <span class="keywordflow">if</span> (!(tmp-&gt;<a class="code" href="structast__channel.html#aea6233539fc73fc5303bf7525ec27e73">sched</a> = <a class="code" href="sched_8h.html#ad4fd5c63d5d3dcc8e11bec644c601017" title="New schedule context.">sched_context_create</a>())) {
<a name="l00799"></a>00799       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Channel allocation failed: Unable to create schedule context\n&quot;</span>);
<a name="l00800"></a>00800       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(tmp);
<a name="l00801"></a>00801       <span class="keywordflow">return</span> NULL;
<a name="l00802"></a>00802    }
<a name="l00803"></a>00803    
<a name="l00804"></a>00804    <span class="keywordflow">if</span> ((<a class="code" href="stringfields_8h.html#a871274fa4fd2687c7a44849a84df3665" title="Initialize a field pool and fields.">ast_string_field_init</a>(tmp, 128))) {
<a name="l00805"></a>00805       <a class="code" href="sched_8h.html#a7350994bcfd1be91874493dbe25faf0c" title="destroys a schedule context Destroys (free&amp;#39;s) the given sched_context structure...">sched_context_destroy</a>(tmp-&gt;<a class="code" href="structast__channel.html#aea6233539fc73fc5303bf7525ec27e73">sched</a>);
<a name="l00806"></a>00806       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(tmp);
<a name="l00807"></a>00807       <span class="keywordflow">return</span> NULL;
<a name="l00808"></a>00808    }
<a name="l00809"></a>00809 
<a name="l00810"></a>00810 <span class="preprocessor">#ifdef HAVE_EPOLL</span>
<a name="l00811"></a>00811 <span class="preprocessor"></span>   tmp-&gt;epfd = epoll_create(25);
<a name="l00812"></a>00812 <span class="preprocessor">#endif</span>
<a name="l00813"></a>00813 <span class="preprocessor"></span>
<a name="l00814"></a>00814    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="channel_8h.html#aa3fc504e7ca90586e4d249831838de3c">AST_MAX_FDS</a>; x++) {
<a name="l00815"></a>00815       tmp-&gt;<a class="code" href="structast__channel.html#aef68cd3879b791a3b6c12cdb750f8e6a">fds</a>[x] = -1;
<a name="l00816"></a>00816 <span class="preprocessor">#ifdef HAVE_EPOLL</span>
<a name="l00817"></a>00817 <span class="preprocessor"></span>      tmp-&gt;epfd_data[x] = NULL;
<a name="l00818"></a>00818 <span class="preprocessor">#endif</span>
<a name="l00819"></a>00819 <span class="preprocessor"></span>   }
<a name="l00820"></a>00820 
<a name="l00821"></a>00821    <span class="keywordflow">if</span> ((tmp-&gt;<a class="code" href="structast__channel.html#a9aed6490b63794e6c9c00af4533f255f">timer</a> = <a class="code" href="timing_8h.html#aacc341f127efc0dc0d62f6415694174a" title="Open a timer.">ast_timer_open</a>())) {
<a name="l00822"></a>00822       needqueue = 0;
<a name="l00823"></a>00823       tmp-&gt;<a class="code" href="structast__channel.html#a31160ea68032ecf93ec55a3127edd2f9">timingfd</a> = <a class="code" href="timing_8h.html#aa3aa7580d76e1d3f7927b3f34764dec2" title="Get a poll()-able file descriptor for a timer.">ast_timer_fd</a>(tmp-&gt;<a class="code" href="structast__channel.html#a9aed6490b63794e6c9c00af4533f255f">timer</a>);
<a name="l00824"></a>00824    } <span class="keywordflow">else</span> {
<a name="l00825"></a>00825       tmp-&gt;<a class="code" href="structast__channel.html#a31160ea68032ecf93ec55a3127edd2f9">timingfd</a> = -1;
<a name="l00826"></a>00826    }
<a name="l00827"></a>00827 
<a name="l00828"></a>00828    <span class="keywordflow">if</span> (needqueue) {
<a name="l00829"></a>00829       <span class="keywordflow">if</span> (pipe(tmp-&gt;<a class="code" href="structast__channel.html#a249765022c528d61c3ab376660b64d0e">alertpipe</a>)) {
<a name="l00830"></a>00830          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Channel allocation failed: Can&apos;t create alert pipe! Try increasing max file descriptors with ulimit -n\n&quot;</span>);
<a name="l00831"></a>00831 alertpipe_failed:
<a name="l00832"></a>00832          <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structast__channel.html#a9aed6490b63794e6c9c00af4533f255f">timer</a>) {
<a name="l00833"></a>00833             <a class="code" href="timing_8h.html#a2a5968baf9962dedeeda855fd5ed9c75" title="Close an opened timing handle.">ast_timer_close</a>(tmp-&gt;<a class="code" href="structast__channel.html#a9aed6490b63794e6c9c00af4533f255f">timer</a>);
<a name="l00834"></a>00834          }
<a name="l00835"></a>00835 
<a name="l00836"></a>00836          <a class="code" href="sched_8h.html#a7350994bcfd1be91874493dbe25faf0c" title="destroys a schedule context Destroys (free&amp;#39;s) the given sched_context structure...">sched_context_destroy</a>(tmp-&gt;<a class="code" href="structast__channel.html#aea6233539fc73fc5303bf7525ec27e73">sched</a>);
<a name="l00837"></a>00837          <a class="code" href="stringfields_8h.html#abf60f862ae6a141d2f86a0f5e82792de" title="free all memory - to be called before destroying the object">ast_string_field_free_memory</a>(tmp);
<a name="l00838"></a>00838          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(tmp);
<a name="l00839"></a>00839          <span class="keywordflow">return</span> NULL;
<a name="l00840"></a>00840       } <span class="keywordflow">else</span> {
<a name="l00841"></a>00841          flags = fcntl(tmp-&gt;<a class="code" href="structast__channel.html#a249765022c528d61c3ab376660b64d0e">alertpipe</a>[0], F_GETFL);
<a name="l00842"></a>00842          <span class="keywordflow">if</span> (fcntl(tmp-&gt;<a class="code" href="structast__channel.html#a249765022c528d61c3ab376660b64d0e">alertpipe</a>[0], F_SETFL, flags | O_NONBLOCK) &lt; 0) {
<a name="l00843"></a>00843             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Channel allocation failed: Unable to set alertpipe nonblocking! (%d: %s)\n&quot;</span>, errno, strerror(errno));
<a name="l00844"></a>00844             close(tmp-&gt;<a class="code" href="structast__channel.html#a249765022c528d61c3ab376660b64d0e">alertpipe</a>[0]);
<a name="l00845"></a>00845             close(tmp-&gt;<a class="code" href="structast__channel.html#a249765022c528d61c3ab376660b64d0e">alertpipe</a>[1]);
<a name="l00846"></a>00846             <span class="keywordflow">goto</span> alertpipe_failed;
<a name="l00847"></a>00847          }
<a name="l00848"></a>00848          flags = fcntl(tmp-&gt;<a class="code" href="structast__channel.html#a249765022c528d61c3ab376660b64d0e">alertpipe</a>[1], F_GETFL);
<a name="l00849"></a>00849          <span class="keywordflow">if</span> (fcntl(tmp-&gt;<a class="code" href="structast__channel.html#a249765022c528d61c3ab376660b64d0e">alertpipe</a>[1], F_SETFL, flags | O_NONBLOCK) &lt; 0) {
<a name="l00850"></a>00850             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Channel allocation failed: Unable to set alertpipe nonblocking! (%d: %s)\n&quot;</span>, errno, strerror(errno));
<a name="l00851"></a>00851             close(tmp-&gt;<a class="code" href="structast__channel.html#a249765022c528d61c3ab376660b64d0e">alertpipe</a>[0]);
<a name="l00852"></a>00852             close(tmp-&gt;<a class="code" href="structast__channel.html#a249765022c528d61c3ab376660b64d0e">alertpipe</a>[1]);
<a name="l00853"></a>00853             <span class="keywordflow">goto</span> alertpipe_failed;
<a name="l00854"></a>00854          }
<a name="l00855"></a>00855       }
<a name="l00856"></a>00856    } <span class="keywordflow">else</span>   <span class="comment">/* Make sure we&apos;ve got it done right if they don&apos;t */</span>
<a name="l00857"></a>00857       tmp-&gt;<a class="code" href="structast__channel.html#a249765022c528d61c3ab376660b64d0e">alertpipe</a>[0] = tmp-&gt;<a class="code" href="structast__channel.html#a249765022c528d61c3ab376660b64d0e">alertpipe</a>[1] = -1;
<a name="l00858"></a>00858 
<a name="l00859"></a>00859    <span class="comment">/* Always watch the alertpipe */</span>
<a name="l00860"></a>00860    <a class="code" href="channel_8h.html#aca37ca2f3d55a223d26617329ed48a3e">ast_channel_set_fd</a>(tmp, <a class="code" href="channel_8h.html#a84fb9b8eb7be6f162fec6779e250c27b">AST_ALERT_FD</a>, tmp-&gt;<a class="code" href="structast__channel.html#a249765022c528d61c3ab376660b64d0e">alertpipe</a>[0]);
<a name="l00861"></a>00861    <span class="comment">/* And timing pipe */</span>
<a name="l00862"></a>00862    <a class="code" href="channel_8h.html#aca37ca2f3d55a223d26617329ed48a3e">ast_channel_set_fd</a>(tmp, <a class="code" href="channel_8h.html#aa2c87e87fcb0c34e45f4596448dea70e">AST_TIMING_FD</a>, tmp-&gt;<a class="code" href="structast__channel.html#a31160ea68032ecf93ec55a3127edd2f9">timingfd</a>);
<a name="l00863"></a>00863    <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(tmp, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="stringliteral">&quot;**Unknown**&quot;</span>);
<a name="l00864"></a>00864 
<a name="l00865"></a>00865    <span class="comment">/* Initial state */</span>
<a name="l00866"></a>00866    tmp-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> = <a class="code" href="structstate.html">state</a>;
<a name="l00867"></a>00867 
<a name="l00868"></a>00868    tmp-&gt;<a class="code" href="structast__channel.html#a7de986d04c859684e7754ac888e18532">streamid</a> = -1;
<a name="l00869"></a>00869    
<a name="l00870"></a>00870    tmp-&gt;<a class="code" href="structast__channel.html#aa4b0a5423e11c07e15c3a503c36be0fb">fin</a> = <a class="code" href="channel_8h.html#a7457a2311fc74cc4a5b0aa0d2001835c">global_fin</a>;
<a name="l00871"></a>00871    tmp-&gt;<a class="code" href="structast__channel.html#af2ef0dd0824e04b55a277f42c10f3dfa">fout</a> = <a class="code" href="channel_8h.html#ade9bc8493de7d579e2f06b55379fc673">global_fout</a>;
<a name="l00872"></a>00872 
<a name="l00873"></a>00873    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="paths_8h.html#ab9f9346c7a41bdf3720f7b1ed02ec703">ast_config_AST_SYSTEM_NAME</a>)) {
<a name="l00874"></a>00874       <a class="code" href="stringfields_8h.html#a8b9f4347fc72720cc5cead952b54abe9" title="Set a field to a complex (built) value.">ast_string_field_build</a>(tmp, uniqueid, <span class="stringliteral">&quot;%li.%d&quot;</span>, (<span class="keywordtype">long</span>) time(NULL), 
<a name="l00875"></a>00875                    <a class="code" href="lock_8h.html#a30df186a6f53f66621e88fae2e7adaf9" title="Atomically add v to *p and return * the previous value of *p. This can be used to...">ast_atomic_fetchadd_int</a>(&amp;<a class="code" href="channel_8c.html#a55bca233afc9e4509a8a96f5195753c2">uniqueint</a>, 1));
<a name="l00876"></a>00876    } <span class="keywordflow">else</span> {
<a name="l00877"></a>00877       <a class="code" href="stringfields_8h.html#a8b9f4347fc72720cc5cead952b54abe9" title="Set a field to a complex (built) value.">ast_string_field_build</a>(tmp, uniqueid, <span class="stringliteral">&quot;%s-%li.%d&quot;</span>, <a class="code" href="paths_8h.html#ab9f9346c7a41bdf3720f7b1ed02ec703">ast_config_AST_SYSTEM_NAME</a>, 
<a name="l00878"></a>00878                    (<span class="keywordtype">long</span>) time(NULL), <a class="code" href="lock_8h.html#a30df186a6f53f66621e88fae2e7adaf9" title="Atomically add v to *p and return * the previous value of *p. This can be used to...">ast_atomic_fetchadd_int</a>(&amp;<a class="code" href="channel_8c.html#a55bca233afc9e4509a8a96f5195753c2">uniqueint</a>, 1));
<a name="l00879"></a>00879    }
<a name="l00880"></a>00880 
<a name="l00881"></a>00881    tmp-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(<a class="code" href="chan__mgcp_8c.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>);
<a name="l00882"></a>00882    tmp-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(<a class="code" href="chan__mgcp_8c.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>);
<a name="l00883"></a>00883    
<a name="l00884"></a>00884    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(name_fmt)) {
<a name="l00885"></a>00885       <span class="comment">/* Almost every channel is calling this function, and setting the name via the ast_string_field_build() call.</span>
<a name="l00886"></a>00886 <span class="comment">       * And they all use slightly different formats for their name string.</span>
<a name="l00887"></a>00887 <span class="comment">       * This means, to set the name here, we have to accept variable args, and call the string_field_build from here.</span>
<a name="l00888"></a>00888 <span class="comment">       * This means, that the stringfields must have a routine that takes the va_lists directly, and </span>
<a name="l00889"></a>00889 <span class="comment">       * uses them to build the string, instead of forming the va_lists internally from the vararg ... list.</span>
<a name="l00890"></a>00890 <span class="comment">       * This new function was written so this can be accomplished.</span>
<a name="l00891"></a>00891 <span class="comment">       */</span>
<a name="l00892"></a>00892       <a class="code" href="stringfields_8h.html#acbfd7ec6432d941a1239b4fa55503d4c" title="Set a field to a complex (built) value.">ast_string_field_build_va</a>(tmp, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, name_fmt, ap1, ap2);
<a name="l00893"></a>00893    }
<a name="l00894"></a>00894 
<a name="l00895"></a>00895    <span class="comment">/* Reminder for the future: under what conditions do we NOT want to track cdrs on channels? */</span>
<a name="l00896"></a>00896 
<a name="l00897"></a>00897    <span class="comment">/* These 4 variables need to be set up for the cdr_init() to work right */</span>
<a name="l00898"></a>00898    <span class="keywordflow">if</span> (amaflag)
<a name="l00899"></a>00899       tmp-&gt;<a class="code" href="structast__channel.html#ad2cfb0f821c065261382a9298bb5a16b">amaflags</a> = amaflag;
<a name="l00900"></a>00900    <span class="keywordflow">else</span>
<a name="l00901"></a>00901       tmp-&gt;<a class="code" href="structast__channel.html#ad2cfb0f821c065261382a9298bb5a16b">amaflags</a> = <a class="code" href="cdr_8h.html#a40d6ca75f86ae72a310c1cdceab8d345">ast_default_amaflags</a>;
<a name="l00902"></a>00902    
<a name="l00903"></a>00903    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(acctcode))
<a name="l00904"></a>00904       <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(tmp, <a class="code" href="chan__iax2_8c.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>, acctcode);
<a name="l00905"></a>00905    <span class="keywordflow">else</span>
<a name="l00906"></a>00906       <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(tmp, <a class="code" href="chan__iax2_8c.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>, <a class="code" href="cdr_8h.html#aa9efa3b0987da203851c54efb6147ee0">ast_default_accountcode</a>);
<a name="l00907"></a>00907       
<a name="l00908"></a>00908    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>))
<a name="l00909"></a>00909       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>));
<a name="l00910"></a>00910    <span class="keywordflow">else</span>
<a name="l00911"></a>00911       strcpy(tmp-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <span class="stringliteral">&quot;default&quot;</span>);
<a name="l00912"></a>00912 
<a name="l00913"></a>00913    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>))
<a name="l00914"></a>00914       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>));
<a name="l00915"></a>00915    <span class="keywordflow">else</span>
<a name="l00916"></a>00916       strcpy(tmp-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, <span class="stringliteral">&quot;s&quot;</span>);
<a name="l00917"></a>00917 
<a name="l00918"></a>00918    tmp-&gt;<a class="code" href="structast__channel.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> = 1;
<a name="l00919"></a>00919       
<a name="l00920"></a>00920    tmp-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a> = <a class="code" href="cdr_8h.html#a29ba08b358224b4c820e5df826273b5b" title="Allocate a CDR record.">ast_cdr_alloc</a>();
<a name="l00921"></a>00921    <a class="code" href="cdr_8h.html#a551fbacb2f2b4caaf57243c601c28a83" title="Initialize based on a channel.">ast_cdr_init</a>(tmp-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>, tmp);
<a name="l00922"></a>00922    <a class="code" href="cdr_8h.html#af788ef701483a64b77656f272843bcd4" title="Start a call.">ast_cdr_start</a>(tmp-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>);
<a name="l00923"></a>00923    
<a name="l00924"></a>00924    headp = &amp;tmp-&gt;<a class="code" href="structast__channel.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>;
<a name="l00925"></a>00925    <a class="code" href="linkedlists_8h.html#a0d1f922e093ac18824a7863fe3f5fa27" title="Initializes a list head structure.">AST_LIST_HEAD_INIT_NOLOCK</a>(headp);
<a name="l00926"></a>00926    
<a name="l00927"></a>00927    <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;tmp-&gt;<a class="code" href="structast__channel.html#a8dc1b6301d8284eb0f31f2d723902a99">lock_dont_use</a>);
<a name="l00928"></a>00928    
<a name="l00929"></a>00929    <a class="code" href="linkedlists_8h.html#a0d1f922e093ac18824a7863fe3f5fa27" title="Initializes a list head structure.">AST_LIST_HEAD_INIT_NOLOCK</a>(&amp;tmp-&gt;datastores);
<a name="l00930"></a>00930    
<a name="l00931"></a>00931    <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(tmp, <a class="code" href="chan__alsa_8c.html#adf416dc058363e2fd5750c77e2d78bee">language</a>, <a class="code" href="options_8h.html#a6975f3d412909586ee6ba1aa4ab0ba2c">defaultlanguage</a>);
<a name="l00932"></a>00932 
<a name="l00933"></a>00933    tmp-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a> = &amp;<a class="code" href="channel_8c.html#acee4675035da188a1356fc547ff531fa">null_tech</a>;
<a name="l00934"></a>00934 
<a name="l00935"></a>00935    <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(tmp, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a88ca779e8fdb868f32d38ed94a75ff53">AST_FLAG_IN_CHANNEL_LIST</a>);
<a name="l00936"></a>00936 
<a name="l00937"></a>00937    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>);
<a name="l00938"></a>00938    <a class="code" href="linkedlists_8h.html#aacc5f6b7c25e361d11d40137fd55a8e8">AST_RWLIST_INSERT_HEAD</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>, tmp, <a class="code" href="structchan__list.html" title="Channel call record structure.">chan_list</a>);
<a name="l00939"></a>00939    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>);
<a name="l00940"></a>00940 
<a name="l00941"></a>00941    <span class="comment">/*\!note</span>
<a name="l00942"></a>00942 <span class="comment">    * and now, since the channel structure is built, and has its name, let&apos;s</span>
<a name="l00943"></a>00943 <span class="comment">    * call the manager event generator with this Newchannel event. This is the</span>
<a name="l00944"></a>00944 <span class="comment">    * proper and correct place to make this call, but you sure do have to pass</span>
<a name="l00945"></a>00945 <span class="comment">    * a lot of data into this func to do it here!</span>
<a name="l00946"></a>00946 <span class="comment">    */</span>
<a name="l00947"></a>00947    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(name_fmt)) {
<a name="l00948"></a>00948       <a class="code" href="manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208" title="External routines may send asterisk manager events this way.">manager_event</a>(<a class="code" href="manager_8h.html#ab5db3cc603d7e798d61cb4cd94fbb4e2">EVENT_FLAG_CALL</a>, <span class="stringliteral">&quot;Newchannel&quot;</span>,
<a name="l00949"></a>00949          <span class="stringliteral">&quot;Channel: %s\r\n&quot;</span>
<a name="l00950"></a>00950          <span class="stringliteral">&quot;ChannelState: %d\r\n&quot;</span>
<a name="l00951"></a>00951          <span class="stringliteral">&quot;ChannelStateDesc: %s\r\n&quot;</span>
<a name="l00952"></a>00952          <span class="stringliteral">&quot;CallerIDNum: %s\r\n&quot;</span>
<a name="l00953"></a>00953          <span class="stringliteral">&quot;CallerIDName: %s\r\n&quot;</span>
<a name="l00954"></a>00954          <span class="stringliteral">&quot;AccountCode: %s\r\n&quot;</span>
<a name="l00955"></a>00955          <span class="stringliteral">&quot;Exten: %s\r\n&quot;</span>
<a name="l00956"></a>00956          <span class="stringliteral">&quot;Context: %s\r\n&quot;</span>
<a name="l00957"></a>00957          <span class="stringliteral">&quot;Uniqueid: %s\r\n&quot;</span>,
<a name="l00958"></a>00958          tmp-&gt;name, 
<a name="l00959"></a>00959          <a class="code" href="structstate.html">state</a>, 
<a name="l00960"></a>00960          <a class="code" href="channel_8h.html#ac97b5983ea4bf3cc217ea898ca002759" title="Gives the string form of a given channel state.">ast_state2str</a>(<a class="code" href="structstate.html">state</a>),
<a name="l00961"></a>00961          <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(<a class="code" href="chan__mgcp_8c.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>, <span class="stringliteral">&quot;&quot;</span>),
<a name="l00962"></a>00962          <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(<a class="code" href="chan__mgcp_8c.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>, <span class="stringliteral">&quot;&quot;</span>),
<a name="l00963"></a>00963          tmp-&gt;accountcode,
<a name="l00964"></a>00964          <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(<a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, <span class="stringliteral">&quot;&quot;</span>),
<a name="l00965"></a>00965          <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <span class="stringliteral">&quot;&quot;</span>),
<a name="l00966"></a>00966          tmp-&gt;uniqueid);
<a name="l00967"></a>00967    }
<a name="l00968"></a>00968 
<a name="l00969"></a>00969    <span class="keywordflow">return</span> tmp;
<a name="l00970"></a>00970 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae5b763a23d35fc0b721adc3df8724712"></a><!-- doxytag: member="channel.c::__ast_queue_frame" ref="ae5b763a23d35fc0b721adc3df8724712" args="(struct ast_channel *chan, struct ast_frame *fin, int head, struct ast_frame *after)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int __ast_queue_frame </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td>
          <td class="paramname"> <em>fin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>head</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td>
          <td class="paramname"> <em>after</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l00991">991</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00481">ast_channel::alertpipe</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="frame_8h_source.html#l00298">AST_CONTROL_HANGUP</a>, <a class="el" href="channel_8h_source.html#l00527">AST_FLAG_BLOCKING</a>, <a class="el" href="frame_8h_source.html#l00105">AST_FRAME_CONTROL</a>, <a class="el" href="frame_8h_source.html#l00107">AST_FRAME_NULL</a>, <a class="el" href="frame_8h_source.html#l00103">AST_FRAME_VIDEO</a>, <a class="el" href="frame_8h_source.html#l00101">AST_FRAME_VOICE</a>, <a class="el" href="frame_8c_source.html#l00474">ast_frdup()</a>, <a class="el" href="frame_8h_source.html#l00462">ast_frfree</a>, <a class="el" href="linkedlists_8h_source.html#l00767">AST_LIST_APPEND_LIST</a>, <a class="el" href="linkedlists_8h_source.html#l00420">AST_LIST_FIRST</a>, <a class="el" href="linkedlists_8h_source.html#l00665">AST_LIST_HEAD_INIT_NOLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00224">AST_LIST_HEAD_NOLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00796">AST_LIST_INSERT_LIST_AFTER</a>, <a class="el" href="linkedlists_8h_source.html#l00715">AST_LIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00428">AST_LIST_LAST</a>, <a class="el" href="linkedlists_8h_source.html#l00438">AST_LIST_NEXT</a>, <a class="el" href="linkedlists_8h_source.html#l00553">AST_LIST_REMOVE_CURRENT</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00528">AST_LIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h_source.html#l00599">AST_LIST_TRAVERSE_SAFE_END</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="timing_8c_source.html#l00172">ast_timer_enable_continuous()</a>, <a class="el" href="channel_8h_source.html#l00442">ast_channel::blocker</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="iax2-parser_8c_source.html#l00045">frames</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, <a class="el" href="channel_8h_source.html#l00499">ast_channel::timer</a>, and <a class="el" href="channel_8h_source.html#l00468">ast_channel::timingfd</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l02636">__ast_read()</a>, <a class="el" href="channel_8c_source.html#l01080">ast_queue_frame()</a>, and <a class="el" href="channel_8c_source.html#l01085">ast_queue_frame_head()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00992"></a>00992 {
<a name="l00993"></a>00993    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l00994"></a>00994    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *cur;
<a name="l00995"></a>00995    <span class="keywordtype">int</span> blah = 1;
<a name="l00996"></a>00996    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> new_frames = 0;
<a name="l00997"></a>00997    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> new_voice_frames = 0;
<a name="l00998"></a>00998    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> queued_frames = 0;
<a name="l00999"></a>00999    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> queued_voice_frames = 0;
<a name="l01000"></a>01000    <a class="code" href="linkedlists_8h.html#a117cbef6a40010cd3c84a16fd9ef4ca6" title="Defines a structure to be used to hold a list of specified type (with no lock).">AST_LIST_HEAD_NOLOCK</a>(, <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a>) <a class="code" href="iax2-parser_8c.html#a61217d5bc9d5b446d9c08e7ca401b733">frames</a>;
<a name="l01001"></a>01001 
<a name="l01002"></a>01002    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l01003"></a>01003 
<a name="l01004"></a>01004    <span class="comment">/* See if the last frame on the queue is a hangup, if so don&apos;t queue anything */</span>
<a name="l01005"></a>01005    if ((cur = <a class="code" href="linkedlists_8h.html#a1e37109bb72d95999821eb45f28c261c" title="Returns the last entry contained in a list.">AST_LIST_LAST</a>(&amp;chan-&gt;readq)) &amp;&amp;
<a name="l01006"></a>01006        (cur-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>) &amp;&amp;
<a name="l01007"></a>01007        (cur-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> == <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa7dac1c1896ab418c2ff351aae707fba">AST_CONTROL_HANGUP</a>)) {
<a name="l01008"></a>01008       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l01009"></a>01009       <span class="keywordflow">return</span> 0;
<a name="l01010"></a>01010    }
<a name="l01011"></a>01011 
<a name="l01012"></a>01012    <span class="comment">/* Build copies of all the frames and count them */</span>
<a name="l01013"></a>01013    <a class="code" href="linkedlists_8h.html#a0d1f922e093ac18824a7863fe3f5fa27" title="Initializes a list head structure.">AST_LIST_HEAD_INIT_NOLOCK</a>(&amp;<a class="code" href="iax2-parser_8c.html#a61217d5bc9d5b446d9c08e7ca401b733">frames</a>);
<a name="l01014"></a>01014    <span class="keywordflow">for</span> (cur = fin; cur; cur = <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(cur, frame_list)) {
<a name="l01015"></a>01015       <span class="keywordflow">if</span> (!(f = <a class="code" href="frame_8h.html#a4b23720d208128250a765490b1a4f145" title="Copies a frame.">ast_frdup</a>(cur))) {
<a name="l01016"></a>01016          <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(<a class="code" href="linkedlists_8h.html#adf1959c5c03a3a706da97ad2f49617e5" title="Returns the first entry contained in a list.">AST_LIST_FIRST</a>(&amp;<a class="code" href="iax2-parser_8c.html#a61217d5bc9d5b446d9c08e7ca401b733">frames</a>));
<a name="l01017"></a>01017          <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l01018"></a>01018          <span class="keywordflow">return</span> -1;
<a name="l01019"></a>01019       }
<a name="l01020"></a>01020 
<a name="l01021"></a>01021       <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;<a class="code" href="iax2-parser_8c.html#a61217d5bc9d5b446d9c08e7ca401b733">frames</a>, f, frame_list);
<a name="l01022"></a>01022       new_frames++;
<a name="l01023"></a>01023       <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>) {
<a name="l01024"></a>01024          new_voice_frames++;
<a name="l01025"></a>01025       }
<a name="l01026"></a>01026    }
<a name="l01027"></a>01027 
<a name="l01028"></a>01028    <span class="comment">/* Count how many frames exist on the queue */</span>
<a name="l01029"></a>01029    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;chan-&gt;readq, cur, frame_list) {
<a name="l01030"></a>01030       queued_frames++;
<a name="l01031"></a>01031       <span class="keywordflow">if</span> (cur-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>) {
<a name="l01032"></a>01032          queued_voice_frames++;
<a name="l01033"></a>01033       }
<a name="l01034"></a>01034    }
<a name="l01035"></a>01035 
<a name="l01036"></a>01036    <span class="keywordflow">if</span> ((queued_frames + new_frames &gt; 128 || queued_voice_frames + new_voice_frames &gt; 96)) {
<a name="l01037"></a>01037       <span class="keywordtype">int</span> count = 0;
<a name="l01038"></a>01038       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Exceptionally long %squeue length queuing to %s\n&quot;</span>, queued_frames + new_frames &gt; 128 ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;voice &quot;</span>, chan-&gt;name);
<a name="l01039"></a>01039       <a class="code" href="linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d" title="Loops safely over (traverses) the entries in a list.">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(&amp;chan-&gt;readq, cur, frame_list) {
<a name="l01040"></a>01040          <span class="comment">/* Save the most recent frame */</span>
<a name="l01041"></a>01041          <span class="keywordflow">if</span> (!<a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(cur, frame_list)) {
<a name="l01042"></a>01042             <span class="keywordflow">break</span>;
<a name="l01043"></a>01043          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cur-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a> || cur-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a17ae96b6ea8a2388bb0d409e8124ff30">AST_FRAME_VIDEO</a> || cur-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a29ff71f9d5c7927906ebd437fe372056">AST_FRAME_NULL</a>) {
<a name="l01044"></a>01044             <span class="keywordflow">if</span> (++count &gt; 64) {
<a name="l01045"></a>01045                <span class="keywordflow">break</span>;
<a name="l01046"></a>01046             }
<a name="l01047"></a>01047             <a class="code" href="linkedlists_8h.html#aa8ac496fa9c717d5afb99a02e1e2760c" title="Removes the current entry from a list during a traversal.">AST_LIST_REMOVE_CURRENT</a>(frame_list);
<a name="l01048"></a>01048             <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(cur);
<a name="l01049"></a>01049          }
<a name="l01050"></a>01050       }
<a name="l01051"></a>01051       <a class="code" href="linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9" title="Closes a safe loop traversal block.">AST_LIST_TRAVERSE_SAFE_END</a>;
<a name="l01052"></a>01052    }
<a name="l01053"></a>01053 
<a name="l01054"></a>01054    <span class="keywordflow">if</span> (after) {
<a name="l01055"></a>01055       <a class="code" href="linkedlists_8h.html#a22f1ded7491469f1fa336a7d25fac468" title="Inserts a whole list after a specific entry in a list.">AST_LIST_INSERT_LIST_AFTER</a>(&amp;chan-&gt;readq, &amp;<a class="code" href="iax2-parser_8c.html#a61217d5bc9d5b446d9c08e7ca401b733">frames</a>, after, frame_list);
<a name="l01056"></a>01056    } <span class="keywordflow">else</span> {
<a name="l01057"></a>01057       <span class="keywordflow">if</span> (head) {
<a name="l01058"></a>01058          <a class="code" href="linkedlists_8h.html#ad66405f1d0b9e1fb484643d9a36e94ed" title="Appends a whole list to the tail of a list.">AST_LIST_APPEND_LIST</a>(&amp;<a class="code" href="iax2-parser_8c.html#a61217d5bc9d5b446d9c08e7ca401b733">frames</a>, &amp;chan-&gt;readq, frame_list);
<a name="l01059"></a>01059          <a class="code" href="linkedlists_8h.html#a0d1f922e093ac18824a7863fe3f5fa27" title="Initializes a list head structure.">AST_LIST_HEAD_INIT_NOLOCK</a>(&amp;chan-&gt;readq);
<a name="l01060"></a>01060       }
<a name="l01061"></a>01061       <a class="code" href="linkedlists_8h.html#ad66405f1d0b9e1fb484643d9a36e94ed" title="Appends a whole list to the tail of a list.">AST_LIST_APPEND_LIST</a>(&amp;chan-&gt;readq, &amp;<a class="code" href="iax2-parser_8c.html#a61217d5bc9d5b446d9c08e7ca401b733">frames</a>, frame_list);
<a name="l01062"></a>01062    }
<a name="l01063"></a>01063 
<a name="l01064"></a>01064    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a249765022c528d61c3ab376660b64d0e">alertpipe</a>[1] &gt; -1) {
<a name="l01065"></a>01065       <span class="keywordflow">if</span> (write(chan-&gt;<a class="code" href="structast__channel.html#a249765022c528d61c3ab376660b64d0e">alertpipe</a>[1], &amp;blah, new_frames * <span class="keyword">sizeof</span>(blah)) != (new_frames * <span class="keyword">sizeof</span>(blah))) {
<a name="l01066"></a>01066          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to write to alert pipe on %s (qlen = %d): %s!\n&quot;</span>,
<a name="l01067"></a>01067             chan-&gt;name, queued_frames, strerror(errno));
<a name="l01068"></a>01068       }
<a name="l01069"></a>01069    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a31160ea68032ecf93ec55a3127edd2f9">timingfd</a> &gt; -1) {
<a name="l01070"></a>01070       <a class="code" href="timing_8h.html#a5d6bdd95ef88176d055961ce353fcfdf" title="Enable continuous mode.">ast_timer_enable_continuous</a>(chan-&gt;<a class="code" href="structast__channel.html#a9aed6490b63794e6c9c00af4533f255f">timer</a>);
<a name="l01071"></a>01071    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329ab5b2bec9425dd0cfc789d96ef229cb3a">AST_FLAG_BLOCKING</a>)) {
<a name="l01072"></a>01072       pthread_kill(chan-&gt;<a class="code" href="structast__channel.html#a0eb129e54ba403f15cae4473dd992ab8">blocker</a>, SIGURG);
<a name="l01073"></a>01073    }
<a name="l01074"></a>01074 
<a name="l01075"></a>01075    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l01076"></a>01076 
<a name="l01077"></a>01077    <span class="keywordflow">return</span> 0;
<a name="l01078"></a>01078 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a69a66588107e52e682f046d05898ff43"></a><!-- doxytag: member="channel.c::__ast_read" ref="a69a66588107e52e682f046d05898ff43" args="(struct ast_channel *chan, int dropaudio)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__frame.html">ast_frame</a>* __ast_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>dropaudio</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><dl class="todo"><dt><b><a class="el" href="todo.html#_todo000066">Todo:</a></b></dt><dd>XXX It is possible to write a digit to the audiohook twice if the digit was originally read while the channel was in autoservice. </dd></dl>
</p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l02636">2636</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l00991">__ast_queue_frame()</a>, <a class="el" href="channel_8h_source.html#l00462">ast_channel::_softhangup</a>, <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="channel_8h_source.html#l00481">ast_channel::alertpipe</a>, <a class="el" href="audiohook_8h_source.html#l00050">AST_AUDIOHOOK_DIRECTION_READ</a>, <a class="el" href="audiohook_8c_source.html#l00710">ast_audiohook_write_list()</a>, <a class="el" href="lock_8h_source.html#l02037">ast_channel_trylock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="channel_8c_source.html#l00461">ast_check_hangup()</a>, <a class="el" href="utils_8h_source.html#l00075">ast_clear_flag</a>, <a class="el" href="frame_8h_source.html#l00301">AST_CONTROL_ANSWER</a>, <a class="el" href="frame_8h_source.html#l00298">AST_CONTROL_HANGUP</a>, <a class="el" href="channel_8c_source.html#l01956">ast_deactivate_generator()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="channel_8c_source.html#l00093">AST_DEFAULT_EMULATE_DTMF_DURATION</a>, <a class="el" href="channel_8c_source.html#l04393">ast_do_masquerade()</a>, <a class="el" href="channel_8h_source.html#l00523">AST_FLAG_DEFER_DTMF</a>, <a class="el" href="channel_8h_source.html#l00548">AST_FLAG_EMULATE_DTMF</a>, <a class="el" href="channel_8h_source.html#l00551">AST_FLAG_END_DTMF_ONLY</a>, <a class="el" href="channel_8h_source.html#l00531">AST_FLAG_EXCEPTION</a>, <a class="el" href="channel_8h_source.html#l00545">AST_FLAG_IN_DTMF</a>, <a class="el" href="channel_8h_source.html#l00543">AST_FLAG_OUTGOING</a>, <a class="el" href="channel_8h_source.html#l00529">AST_FLAG_ZOMBIE</a>, <a class="el" href="frame_8h_source.html#l00680">ast_format_rate()</a>, <a class="el" href="frame_8h_source.html#l00105">AST_FRAME_CONTROL</a>, <a class="el" href="frame_8h_source.html#l00122">AST_FRAME_DTMF_BEGIN</a>, <a class="el" href="frame_8h_source.html#l00099">AST_FRAME_DTMF_END</a>, <a class="el" href="frame_8c_source.html#l00756">ast_frame_dump()</a>, <a class="el" href="frame_8h_source.html#l00107">AST_FRAME_NULL</a>, <a class="el" href="frame_8h_source.html#l00101">AST_FRAME_VOICE</a>, <a class="el" href="frame_8h_source.html#l00462">ast_frfree</a>, <a class="el" href="channel_8h_source.html#l00161">AST_GENERATOR_FD</a>, <a class="el" href="frame_8c_source.html#l00573">ast_getformatname()</a>, <a class="el" href="frame_8c_source.html#l00586">ast_getformatname_multiple()</a>, <a class="el" href="linkedlists_8h_source.html#l00449">AST_LIST_EMPTY</a>, <a class="el" href="linkedlists_8h_source.html#l00420">AST_LIST_FIRST</a>, <a class="el" href="linkedlists_8h_source.html#l00428">AST_LIST_LAST</a>, <a class="el" href="linkedlists_8h_source.html#l00438">AST_LIST_NEXT</a>, <a class="el" href="linkedlists_8h_source.html#l00553">AST_LIST_REMOVE_CURRENT</a>, <a class="el" href="linkedlists_8h_source.html#l00528">AST_LIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h_source.html#l00599">AST_LIST_TRAVERSE_SAFE_END</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8c_source.html#l00096">AST_MIN_DTMF_DURATION</a>, <a class="el" href="channel_8c_source.html#l00100">AST_MIN_DTMF_GAP</a>, <a class="el" href="monitor_8h_source.html#l00029">AST_MONITOR_RUNNING</a>, <a class="el" href="frame_8c_source.html#l00124">ast_null_frame</a>, <a class="el" href="channel_8c_source.html#l01080">ast_queue_frame()</a>, <a class="el" href="channel_8c_source.html#l01085">ast_queue_frame_head()</a>, <a class="el" href="channel_8c_source.html#l02530">ast_read_generator_actions()</a>, <a class="el" href="file_8c_source.html#l00862">ast_seekstream()</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="channel_8c_source.html#l04695">ast_setstate()</a>, <a class="el" href="channel_8h_source.html#l00633">AST_SOFTHANGUP_DEV</a>, <a class="el" href="channel_8h_source.html#l00365">AST_STATE_UP</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="timing_8c_source.html#l00167">ast_timer_ack()</a>, <a class="el" href="timing_8c_source.html#l00181">ast_timer_disable_continuous()</a>, <a class="el" href="timing_8c_source.html#l00190">ast_timer_get_event()</a>, <a class="el" href="timing_8c_source.html#l00158">ast_timer_set_rate()</a>, <a class="el" href="timing_8h_source.html#l00059">AST_TIMING_EVENT_CONTINUOUS</a>, <a class="el" href="timing_8h_source.html#l00058">AST_TIMING_EVENT_EXPIRED</a>, <a class="el" href="channel_8h_source.html#l00159">AST_TIMING_FD</a>, <a class="el" href="translate_8c_source.html#l00308">ast_translate()</a>, <a class="el" href="time_8h_source.html#l00089">ast_tvdiff_ms()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="time_8h_source.html#l00099">ast_tvzero()</a>, <a class="el" href="file_8c_source.html#l00144">ast_writestream()</a>, <a class="el" href="channel_8h_source.html#l00421">ast_channel::audiohooks</a>, <a class="el" href="channel_8h_source.html#l00442">ast_channel::blocker</a>, <a class="el" href="channel_8c_source.html#l02623">calc_monitor_jump()</a>, <a class="el" href="channel_8c_source.html#l00136">cause</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="channel_8h_source.html#l00334">DEBUGCHAN_FLAG</a>, <a class="el" href="structast__generator.html#a6b5dd8c2aa06427e8da9bc5b5e7ec156">ast_generator::digit</a>, <a class="el" href="channel_8h_source.html#l00452">ast_channel::dtmf_tv</a>, <a class="el" href="channel_8h_source.html#l00445">ast_channel::dtmff</a>, <a class="el" href="channel_8h_source.html#l00507">ast_channel::emulate_dtmf_digit</a>, <a class="el" href="channel_8h_source.html#l00487">ast_channel::emulate_dtmf_duration</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="structast__channel__tech.html#a8e20a05a6bd5f25f38f31a6d54a56b03">ast_channel_tech::exception</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="channel_8h_source.html#l00464">ast_channel::fdno</a>, <a class="el" href="channel_8h_source.html#l00458">ast_channel::fds</a>, <a class="el" href="channel_8h_source.html#l00475">ast_channel::fin</a>, <a class="el" href="app__dial_8c_source.html#l00570">chanlist::flags</a>, <a class="el" href="mod__format_8h_source.html#l00102">ast_filestream::fmt</a>, <a class="el" href="mod__format_8h_source.html#l00047">ast_format::format</a>, <a class="el" href="channel_8h_source.html#l00337">FRAMECOUNT_INC</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="structast__generator.html#a92f5f90f97b5e9124c843b5e81d8b53a">ast_generator::generate</a>, <a class="el" href="channel_8h_source.html#l00404">ast_channel::generator</a>, <a class="el" href="channel_8h_source.html#l00403">ast_channel::generatordata</a>, <a class="el" href="channel_8h_source.html#l00479">ast_channel::hangupcause</a>, <a class="el" href="channel_8h_source.html#l00455">ast_channel::insmpl</a>, <a class="el" href="frame_8h_source.html#l00169">ast_frame::len</a>, <a class="el" href="logger_8h_source.html#l00185">LOG_DTMF</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="channel_8h_source.html#l00408">ast_channel::masq</a>, <a class="el" href="channel_8h_source.html#l00425">ast_channel::monitor</a>, <a class="el" href="channel_8h_source.html#l00402">ast_channel::music_state</a>, <a class="el" href="channel_8h_source.html#l00482">ast_channel::nativeformats</a>, <a class="el" href="channel_8h_source.html#l00456">ast_channel::outsmpl</a>, <a class="el" href="channel_8c_source.html#l02578">queue_dtmf_readq()</a>, <a class="el" href="structast__channel__tech.html#aabdf79454b891988f4618d22d882c73e">ast_channel_tech::read</a>, <a class="el" href="monitor_8h_source.html#l00040">ast_channel_monitor::read_stream</a>, <a class="el" href="channel_8h_source.html#l00420">ast_channel::readtrans</a>, <a class="el" href="frame_8h_source.html#l00149">ast_frame::samples</a>, <a class="el" href="file_8h_source.html#l00050">SEEK_FORCECUR</a>, <a class="el" href="channel_8c_source.html#l02517">send_dtmf_event()</a>, <a class="el" href="channel_8c_source.html#l02596">should_skip_dtmf()</a>, <a class="el" href="monitor_8h_source.html#l00048">ast_channel_monitor::state</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>, <a class="el" href="channel_8h_source.html#l00499">ast_channel::timer</a>, <a class="el" href="channel_8h_source.html#l00417">ast_channel::timingdata</a>, <a class="el" href="channel_8h_source.html#l00468">ast_channel::timingfd</a>, <a class="el" href="structast__channel.html#a66e8b9811d596825d60c6a58e0b307a4">ast_channel::timingfunc</a>, and <a class="el" href="frame_8h_source.html#l00159">ast_frame::uint32</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l03100">ast_read()</a>, and <a class="el" href="channel_8c_source.html#l03105">ast_read_noaudio()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02637"></a>02637 {
<a name="l02638"></a>02638    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a> = NULL;   <span class="comment">/* the return value */</span>
<a name="l02639"></a>02639    <span class="keywordtype">int</span> blah;
<a name="l02640"></a>02640    <span class="keywordtype">int</span> prestate;
<a name="l02641"></a>02641    <span class="keywordtype">int</span> count = 0, <a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a> = 0;
<a name="l02642"></a>02642 
<a name="l02643"></a>02643    <span class="comment">/* this function is very long so make sure there is only one return</span>
<a name="l02644"></a>02644 <span class="comment">    * point at the end (there are only two exceptions to this).</span>
<a name="l02645"></a>02645 <span class="comment">    */</span>
<a name="l02646"></a>02646    <span class="keywordflow">while</span>(<a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(chan)) {
<a name="l02647"></a>02647       <span class="keywordflow">if</span>(count++ &gt; 10) 
<a name="l02648"></a>02648          <span class="comment">/*cannot goto done since the channel is not locked*/</span>
<a name="l02649"></a>02649          <span class="keywordflow">return</span> &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l02650"></a>02650       usleep(1);
<a name="l02651"></a>02651    }
<a name="l02652"></a>02652 
<a name="l02653"></a>02653    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#ae38ae730b987d648a6fe1c84c8a13442">masq</a>) {
<a name="l02654"></a>02654       <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#ab26f03fb10f1b2e8e52bfbbb1ee02f78" title="Start masquerading a channel XXX This is a seriously whacked out operation. We&amp;#39;re...">ast_do_masquerade</a>(chan))
<a name="l02655"></a>02655          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to perform masquerade\n&quot;</span>);
<a name="l02656"></a>02656       <span class="keywordflow">else</span>
<a name="l02657"></a>02657          f =  &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l02658"></a>02658       <span class="keywordflow">goto</span> done;
<a name="l02659"></a>02659    }
<a name="l02660"></a>02660 
<a name="l02661"></a>02661    <span class="comment">/* Stop if we&apos;re a zombie or need a soft hangup */</span>
<a name="l02662"></a>02662    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a26796fa52cc5857446eec8d16a4b718d">AST_FLAG_ZOMBIE</a>) || <a class="code" href="channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd" title="Check to see if a channel is needing hang up.">ast_check_hangup</a>(chan)) {
<a name="l02663"></a>02663       <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a4e855ab0f984741b9083b2c5a0fdfe18">generator</a>)
<a name="l02664"></a>02664          <a class="code" href="channel_8h.html#a7160355005776732fba88cc020f4a45b">ast_deactivate_generator</a>(chan);
<a name="l02665"></a>02665       <span class="keywordflow">goto</span> done;
<a name="l02666"></a>02666    }
<a name="l02667"></a>02667 
<a name="l02668"></a>02668 <span class="preprocessor">#ifdef AST_DEVMODE</span>
<a name="l02669"></a>02669 <span class="preprocessor"></span>   <span class="comment">/* </span>
<a name="l02670"></a>02670 <span class="comment">    * The ast_waitfor() code records which of the channel&apos;s file descriptors reported that</span>
<a name="l02671"></a>02671 <span class="comment">    * data is available.  In theory, ast_read() should only be called after ast_waitfor()</span>
<a name="l02672"></a>02672 <span class="comment">    * reports that a channel has data available for reading.  However, there still may be</span>
<a name="l02673"></a>02673 <span class="comment">    * some edge cases throughout the code where ast_read() is called improperly.  This can</span>
<a name="l02674"></a>02674 <span class="comment">    * potentially cause problems, so if this is a developer build, make a lot of noise if</span>
<a name="l02675"></a>02675 <span class="comment">    * this happens so that it can be addressed. </span>
<a name="l02676"></a>02676 <span class="comment">    */</span>
<a name="l02677"></a>02677    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a3a804162c4be609a8def28f69b3e93b2">fdno</a> == -1) {
<a name="l02678"></a>02678       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;ast_read() called with no recorded file descriptor.\n&quot;</span>);
<a name="l02679"></a>02679    }
<a name="l02680"></a>02680 <span class="preprocessor">#endif</span>
<a name="l02681"></a>02681 <span class="preprocessor"></span>
<a name="l02682"></a>02682    prestate = chan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>;
<a name="l02683"></a>02683 
<a name="l02684"></a>02684    <span class="comment">/* Read and ignore anything on the alertpipe, but read only</span>
<a name="l02685"></a>02685 <span class="comment">      one sizeof(blah) per frame that we send from it */</span>
<a name="l02686"></a>02686    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a249765022c528d61c3ab376660b64d0e">alertpipe</a>[0] &gt; -1) {
<a name="l02687"></a>02687       <span class="keywordtype">int</span> <a class="code" href="structast__frame.html#ac92588540e8c1d014a08cd8a45462b19">flags</a> = fcntl(chan-&gt;<a class="code" href="structast__channel.html#a249765022c528d61c3ab376660b64d0e">alertpipe</a>[0], F_GETFL);
<a name="l02688"></a>02688       <span class="comment">/* For some odd reason, the alertpipe occasionally loses nonblocking status,</span>
<a name="l02689"></a>02689 <span class="comment">       * which immediately causes a deadlock scenario.  Detect and prevent this. */</span>
<a name="l02690"></a>02690       <span class="keywordflow">if</span> ((flags &amp; O_NONBLOCK) == 0) {
<a name="l02691"></a>02691          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Alertpipe on channel %s lost O_NONBLOCK?!!\n&quot;</span>, chan-&gt;name);
<a name="l02692"></a>02692          <span class="keywordflow">if</span> (fcntl(chan-&gt;<a class="code" href="structast__channel.html#a249765022c528d61c3ab376660b64d0e">alertpipe</a>[0], F_SETFL, flags | O_NONBLOCK) &lt; 0) {
<a name="l02693"></a>02693             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to set alertpipe nonblocking! (%d: %s)\n&quot;</span>, errno, strerror(errno));
<a name="l02694"></a>02694             f = &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l02695"></a>02695             <span class="keywordflow">goto</span> done;
<a name="l02696"></a>02696          }
<a name="l02697"></a>02697       }
<a name="l02698"></a>02698       <span class="keywordflow">if</span> (read(chan-&gt;<a class="code" href="structast__channel.html#a249765022c528d61c3ab376660b64d0e">alertpipe</a>[0], &amp;blah, <span class="keyword">sizeof</span>(blah)) &lt; 0) {
<a name="l02699"></a>02699          <span class="keywordflow">if</span> (errno != EINTR &amp;&amp; errno != EAGAIN)
<a name="l02700"></a>02700             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;read() failed: %s\n&quot;</span>, strerror(errno));
<a name="l02701"></a>02701       }
<a name="l02702"></a>02702    }
<a name="l02703"></a>02703 
<a name="l02704"></a>02704    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a31160ea68032ecf93ec55a3127edd2f9">timingfd</a> &gt; -1 &amp;&amp; chan-&gt;<a class="code" href="structast__channel.html#a3a804162c4be609a8def28f69b3e93b2">fdno</a> == <a class="code" href="channel_8h.html#aa2c87e87fcb0c34e45f4596448dea70e">AST_TIMING_FD</a>) {
<a name="l02705"></a>02705       <span class="keyword">enum</span> <a class="code" href="timing_8h.html#aa21078cc57057eeda614cb7780bdc60a">ast_timer_event</a> res;
<a name="l02706"></a>02706 
<a name="l02707"></a>02707       <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a75202bcfa58fce5d40e2daddc73b8d11">AST_FLAG_EXCEPTION</a>);
<a name="l02708"></a>02708 
<a name="l02709"></a>02709       res = <a class="code" href="timing_8h.html#a5b0e054f083f10b9f0b2ac7701dddbed" title="Retrieve timing event.">ast_timer_get_event</a>(chan-&gt;<a class="code" href="structast__channel.html#a9aed6490b63794e6c9c00af4533f255f">timer</a>);
<a name="l02710"></a>02710 
<a name="l02711"></a>02711       <span class="keywordflow">switch</span> (res) {
<a name="l02712"></a>02712       <span class="keywordflow">case</span> <a class="code" href="timing_8h.html#aa21078cc57057eeda614cb7780bdc60aa6338cdd939adbc65d20e3412bf11fc3c">AST_TIMING_EVENT_EXPIRED</a>:
<a name="l02713"></a>02713          <a class="code" href="timing_8h.html#a510afb686dee576be589ba47a27c9c40" title="Acknowledge a timer event.">ast_timer_ack</a>(chan-&gt;<a class="code" href="structast__channel.html#a9aed6490b63794e6c9c00af4533f255f">timer</a>, 1);
<a name="l02714"></a>02714 
<a name="l02715"></a>02715          <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a66e8b9811d596825d60c6a58e0b307a4">timingfunc</a>) {
<a name="l02716"></a>02716             <span class="comment">/* save a copy of func/data before unlocking the channel */</span>
<a name="l02717"></a>02717             int (*func)(<span class="keyword">const</span> <span class="keywordtype">void</span> *) = chan-&gt;<a class="code" href="structast__channel.html#a66e8b9811d596825d60c6a58e0b307a4">timingfunc</a>;
<a name="l02718"></a>02718             <span class="keywordtype">void</span> *<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a> = chan-&gt;<a class="code" href="structast__channel.html#adafc0d28570aaa0570be4427407d9015">timingdata</a>;
<a name="l02719"></a>02719             chan-&gt;<a class="code" href="structast__channel.html#a3a804162c4be609a8def28f69b3e93b2">fdno</a> = -1;
<a name="l02720"></a>02720             <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l02721"></a>02721             func(<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>);
<a name="l02722"></a>02722          } <span class="keywordflow">else</span> {
<a name="l02723"></a>02723             <a class="code" href="timing_8h.html#a4dae39fb5fb680a48a05d7567053eb03" title="Set the timing tick rate.">ast_timer_set_rate</a>(chan-&gt;<a class="code" href="structast__channel.html#a9aed6490b63794e6c9c00af4533f255f">timer</a>, 0);
<a name="l02724"></a>02724             chan-&gt;<a class="code" href="structast__channel.html#a3a804162c4be609a8def28f69b3e93b2">fdno</a> = -1;
<a name="l02725"></a>02725             <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l02726"></a>02726          }
<a name="l02727"></a>02727 
<a name="l02728"></a>02728          <span class="comment">/* cannot &apos;goto done&apos; because the channel is already unlocked */</span>
<a name="l02729"></a>02729          <span class="keywordflow">return</span> &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l02730"></a>02730 
<a name="l02731"></a>02731       <span class="keywordflow">case</span> <a class="code" href="timing_8h.html#aa21078cc57057eeda614cb7780bdc60aa2f1a45286f54b8f415b28dc072b931e6">AST_TIMING_EVENT_CONTINUOUS</a>:
<a name="l02732"></a>02732          <span class="keywordflow">if</span> (<a class="code" href="linkedlists_8h.html#a4a1884cde93e53bef32ca85c194a1d05" title="Checks whether the specified list contains any entries.">AST_LIST_EMPTY</a>(&amp;chan-&gt;readq) || 
<a name="l02733"></a>02733             !<a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(<a class="code" href="linkedlists_8h.html#adf1959c5c03a3a706da97ad2f49617e5" title="Returns the first entry contained in a list.">AST_LIST_FIRST</a>(&amp;chan-&gt;readq), frame_list)) {
<a name="l02734"></a>02734             <a class="code" href="timing_8h.html#a8cbf7ad0aadeb93e300c809c8babef27" title="Disable continuous mode.">ast_timer_disable_continuous</a>(chan-&gt;<a class="code" href="structast__channel.html#a9aed6490b63794e6c9c00af4533f255f">timer</a>);
<a name="l02735"></a>02735          }
<a name="l02736"></a>02736          <span class="keywordflow">break</span>;
<a name="l02737"></a>02737       }
<a name="l02738"></a>02738 
<a name="l02739"></a>02739    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#aef68cd3879b791a3b6c12cdb750f8e6a">fds</a>[<a class="code" href="channel_8h.html#a34c26382160debe3411987ec0df1f927">AST_GENERATOR_FD</a>] &gt; -1 &amp;&amp; chan-&gt;<a class="code" href="structast__channel.html#a3a804162c4be609a8def28f69b3e93b2">fdno</a> == <a class="code" href="channel_8h.html#a34c26382160debe3411987ec0df1f927">AST_GENERATOR_FD</a>) {
<a name="l02740"></a>02740       <span class="comment">/* if the AST_GENERATOR_FD is set, call the generator with args</span>
<a name="l02741"></a>02741 <span class="comment">       * set to -1 so it can do whatever it needs to.</span>
<a name="l02742"></a>02742 <span class="comment">       */</span>
<a name="l02743"></a>02743       <span class="keywordtype">void</span> *tmp = chan-&gt;<a class="code" href="structast__channel.html#abe7876f86e249ea3db5fbacd2231389c">generatordata</a>;
<a name="l02744"></a>02744       chan-&gt;<a class="code" href="structast__channel.html#abe7876f86e249ea3db5fbacd2231389c">generatordata</a> = NULL;     <span class="comment">/* reset to let ast_write get through */</span>
<a name="l02745"></a>02745       chan-&gt;<a class="code" href="structast__channel.html#a4e855ab0f984741b9083b2c5a0fdfe18">generator</a>-&gt;<a class="code" href="structast__generator.html#a92f5f90f97b5e9124c843b5e81d8b53a">generate</a>(chan, tmp, -1, -1);
<a name="l02746"></a>02746       chan-&gt;<a class="code" href="structast__channel.html#abe7876f86e249ea3db5fbacd2231389c">generatordata</a> = tmp;
<a name="l02747"></a>02747       f = &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l02748"></a>02748       chan-&gt;<a class="code" href="structast__channel.html#a3a804162c4be609a8def28f69b3e93b2">fdno</a> = -1;
<a name="l02749"></a>02749       <span class="keywordflow">goto</span> done;
<a name="l02750"></a>02750    }
<a name="l02751"></a>02751 
<a name="l02752"></a>02752    <span class="comment">/* Check for pending read queue */</span>
<a name="l02753"></a>02753    <span class="keywordflow">if</span> (!<a class="code" href="linkedlists_8h.html#a4a1884cde93e53bef32ca85c194a1d05" title="Checks whether the specified list contains any entries.">AST_LIST_EMPTY</a>(&amp;chan-&gt;readq)) {
<a name="l02754"></a>02754       <span class="keywordtype">int</span> skip_dtmf = <a class="code" href="channel_8c.html#a673ed25d2c254caadf6b68f1c64c84f5" title="Determine whether or not we should ignore DTMF in the readq.">should_skip_dtmf</a>(chan);
<a name="l02755"></a>02755 
<a name="l02756"></a>02756       <a class="code" href="linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d" title="Loops safely over (traverses) the entries in a list.">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(&amp;chan-&gt;readq, f, frame_list) {
<a name="l02757"></a>02757          <span class="comment">/* We have to be picky about which frame we pull off of the readq because</span>
<a name="l02758"></a>02758 <span class="comment">          * there are cases where we want to leave DTMF frames on the queue until</span>
<a name="l02759"></a>02759 <span class="comment">          * some later time. */</span>
<a name="l02760"></a>02760 
<a name="l02761"></a>02761          <span class="keywordflow">if</span> ( (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a9b350360a64b55c7590f1ec03db480be">AST_FRAME_DTMF_BEGIN</a> || f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a98e65764bc963016c394bcc1bad6540b">AST_FRAME_DTMF_END</a>) &amp;&amp; skip_dtmf) {
<a name="l02762"></a>02762             <span class="keywordflow">continue</span>;
<a name="l02763"></a>02763          }
<a name="l02764"></a>02764 
<a name="l02765"></a>02765          <a class="code" href="linkedlists_8h.html#aa8ac496fa9c717d5afb99a02e1e2760c" title="Removes the current entry from a list during a traversal.">AST_LIST_REMOVE_CURRENT</a>(frame_list);
<a name="l02766"></a>02766          <span class="keywordflow">break</span>;
<a name="l02767"></a>02767       }
<a name="l02768"></a>02768       <a class="code" href="linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9" title="Closes a safe loop traversal block.">AST_LIST_TRAVERSE_SAFE_END</a>;
<a name="l02769"></a>02769       
<a name="l02770"></a>02770       <span class="keywordflow">if</span> (!f) {
<a name="l02771"></a>02771          <span class="comment">/* There were no acceptable frames on the readq. */</span>
<a name="l02772"></a>02772          f = &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l02773"></a>02773          <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a249765022c528d61c3ab376660b64d0e">alertpipe</a>[0] &gt; -1) {
<a name="l02774"></a>02774             <span class="keywordtype">int</span> poke = 0;
<a name="l02775"></a>02775             <span class="comment">/* Restore the state of the alertpipe since we aren&apos;t ready for any</span>
<a name="l02776"></a>02776 <span class="comment">             * of the frames in the readq. */</span>
<a name="l02777"></a>02777             <span class="keywordflow">if</span> (write(chan-&gt;<a class="code" href="structast__channel.html#a249765022c528d61c3ab376660b64d0e">alertpipe</a>[1], &amp;poke, <span class="keyword">sizeof</span>(poke)) != <span class="keyword">sizeof</span>(poke)) {
<a name="l02778"></a>02778                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to write to alertpipe: %s\n&quot;</span>, strerror(errno));
<a name="l02779"></a>02779             }
<a name="l02780"></a>02780          }
<a name="l02781"></a>02781       }
<a name="l02782"></a>02782 
<a name="l02783"></a>02783       <span class="comment">/* Interpret hangup and return NULL */</span>
<a name="l02784"></a>02784       <span class="comment">/* XXX why not the same for frames from the channel ? */</span>
<a name="l02785"></a>02785       <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a> &amp;&amp; f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> == <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa7dac1c1896ab418c2ff351aae707fba">AST_CONTROL_HANGUP</a>) {
<a name="l02786"></a>02786          <a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a> = f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#a5ad776be1fb768f3399aafcd1b58b3a2">uint32</a>;
<a name="l02787"></a>02787          <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l02788"></a>02788          f = NULL;
<a name="l02789"></a>02789       }
<a name="l02790"></a>02790    } <span class="keywordflow">else</span> {
<a name="l02791"></a>02791       chan-&gt;<a class="code" href="structast__channel.html#a0eb129e54ba403f15cae4473dd992ab8">blocker</a> = pthread_self();
<a name="l02792"></a>02792       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a75202bcfa58fce5d40e2daddc73b8d11">AST_FLAG_EXCEPTION</a>)) {
<a name="l02793"></a>02793          <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a8e20a05a6bd5f25f38f31a6d54a56b03" title="Handle an exception, reading a frame.">exception</a>)
<a name="l02794"></a>02794             f = chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a8e20a05a6bd5f25f38f31a6d54a56b03" title="Handle an exception, reading a frame.">exception</a>(chan);
<a name="l02795"></a>02795          <span class="keywordflow">else</span> {
<a name="l02796"></a>02796             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Exception flag set on &apos;%s&apos;, but no exception handler\n&quot;</span>, chan-&gt;name);
<a name="l02797"></a>02797             f = &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l02798"></a>02798          }
<a name="l02799"></a>02799          <span class="comment">/* Clear the exception flag */</span>
<a name="l02800"></a>02800          <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a75202bcfa58fce5d40e2daddc73b8d11">AST_FLAG_EXCEPTION</a>);
<a name="l02801"></a>02801       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#aabdf79454b891988f4618d22d882c73e" title="Read a frame, in standard format (see frame.h).">read</a>)
<a name="l02802"></a>02802          f = chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#aabdf79454b891988f4618d22d882c73e" title="Read a frame, in standard format (see frame.h).">read</a>(chan);
<a name="l02803"></a>02803       <span class="keywordflow">else</span>
<a name="l02804"></a>02804          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No read routine on channel %s\n&quot;</span>, chan-&gt;name);
<a name="l02805"></a>02805    }
<a name="l02806"></a>02806 
<a name="l02807"></a>02807    <span class="comment">/*</span>
<a name="l02808"></a>02808 <span class="comment">    * Reset the recorded file descriptor that triggered this read so that we can</span>
<a name="l02809"></a>02809 <span class="comment">    * easily detect when ast_read() is called without properly using ast_waitfor().</span>
<a name="l02810"></a>02810 <span class="comment">    */</span>
<a name="l02811"></a>02811    chan-&gt;<a class="code" href="structast__channel.html#a3a804162c4be609a8def28f69b3e93b2">fdno</a> = -1;
<a name="l02812"></a>02812 
<a name="l02813"></a>02813    <span class="keywordflow">if</span> (f) {
<a name="l02814"></a>02814       <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *readq_tail = <a class="code" href="linkedlists_8h.html#a1e37109bb72d95999821eb45f28c261c" title="Returns the last entry contained in a list.">AST_LIST_LAST</a>(&amp;chan-&gt;readq);
<a name="l02815"></a>02815 
<a name="l02816"></a>02816       <span class="comment">/* if the channel driver returned more than one frame, stuff the excess</span>
<a name="l02817"></a>02817 <span class="comment">         into the readq for the next ast_read call</span>
<a name="l02818"></a>02818 <span class="comment">      */</span>
<a name="l02819"></a>02819       <span class="keywordflow">if</span> (<a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(f, frame_list)) {
<a name="l02820"></a>02820          <a class="code" href="channel_8h.html#a6cbcba5661d55216968cde8fdf913c89" title="Queue one or more frames to a channel&amp;#39;s frame queue.">ast_queue_frame</a>(chan, <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(f, frame_list));
<a name="l02821"></a>02821          <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(<a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(f, frame_list));
<a name="l02822"></a>02822          <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(f, frame_list) = NULL;
<a name="l02823"></a>02823       }
<a name="l02824"></a>02824 
<a name="l02825"></a>02825       <span class="keywordflow">switch</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a>) {
<a name="l02826"></a>02826       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>:
<a name="l02827"></a>02827          <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> == <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>) {
<a name="l02828"></a>02828             <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a36fa77a64746637c77c6b18a7999d0a2">AST_FLAG_OUTGOING</a>)) {
<a name="l02829"></a>02829                <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Ignoring answer on an inbound call!\n&quot;</span>);
<a name="l02830"></a>02830                <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l02831"></a>02831                f = &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l02832"></a>02832             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (prestate == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) {
<a name="l02833"></a>02833                <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Dropping duplicate answer!\n&quot;</span>);
<a name="l02834"></a>02834                <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l02835"></a>02835                f = &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l02836"></a>02836             } <span class="keywordflow">else</span> {
<a name="l02837"></a>02837                <span class="comment">/* Answer the CDR */</span>
<a name="l02838"></a>02838                <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(chan, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>);
<a name="l02839"></a>02839                <span class="comment">/* removed a call to ast_cdr_answer(chan-&gt;cdr) from here. */</span>
<a name="l02840"></a>02840             }
<a name="l02841"></a>02841          }
<a name="l02842"></a>02842          <span class="keywordflow">break</span>;
<a name="l02843"></a>02843       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a98e65764bc963016c394bcc1bad6540b">AST_FRAME_DTMF_END</a>:
<a name="l02844"></a>02844          <a class="code" href="channel_8c.html#a2897ccacbd4c0c894a7e8212da97ee83">send_dtmf_event</a>(chan, <span class="stringliteral">&quot;Received&quot;</span>, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>, <span class="stringliteral">&quot;No&quot;</span>, <span class="stringliteral">&quot;Yes&quot;</span>);
<a name="l02845"></a>02845          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#af360dd5e7b67cff6cb747d1aa2ac3db8">LOG_DTMF</a>, <span class="stringliteral">&quot;DTMF end &apos;%c&apos; received on %s, duration %ld ms\n&quot;</span>, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>, chan-&gt;name, f-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a>);
<a name="l02846"></a>02846          <span class="comment">/* Queue it up if DTMF is deferred, or if DTMF emulation is forced. */</span>
<a name="l02847"></a>02847          <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329ab05edf1bf82b02f5987de92a6960a9bd">AST_FLAG_DEFER_DTMF</a>) || <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a7aeded1dc9df91dee01bb7af719880c1">AST_FLAG_EMULATE_DTMF</a>)) {
<a name="l02848"></a>02848             <a class="code" href="channel_8c.html#a4efcbb7271ae141197a4ec6fa0c834c2">queue_dtmf_readq</a>(chan, f);
<a name="l02849"></a>02849             <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l02850"></a>02850             f = &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l02851"></a>02851          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a919680ef9fe22e78b9b1e718d3b9a745">AST_FLAG_IN_DTMF</a> | <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a668ac945c84f50becaca2a6134e64058">AST_FLAG_END_DTMF_ONLY</a>)) {
<a name="l02852"></a>02852             <span class="keywordflow">if</span> (!<a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(chan-&gt;<a class="code" href="structast__channel.html#a7dda84c33a9f34c6a0192c88c263b507">dtmf_tv</a>) &amp;&amp; 
<a name="l02853"></a>02853                 <a class="code" href="time_8h.html#a74e35cffcd45ad6cd7c8587921e8a4c2" title="Computes the difference (in milliseconds) between two struct timeval instances.">ast_tvdiff_ms</a>(<a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>(), chan-&gt;<a class="code" href="structast__channel.html#a7dda84c33a9f34c6a0192c88c263b507">dtmf_tv</a>) &lt; <a class="code" href="channel_8c.html#a21882e640e01106e62bdab88849a17c5">AST_MIN_DTMF_GAP</a>) {
<a name="l02854"></a>02854                <span class="comment">/* If it hasn&apos;t been long enough, defer this digit */</span>
<a name="l02855"></a>02855                <a class="code" href="channel_8c.html#a4efcbb7271ae141197a4ec6fa0c834c2">queue_dtmf_readq</a>(chan, f);
<a name="l02856"></a>02856                <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l02857"></a>02857                f = &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l02858"></a>02858             } <span class="keywordflow">else</span> {
<a name="l02859"></a>02859                <span class="comment">/* There was no begin, turn this into a begin and send the end later */</span>
<a name="l02860"></a>02860                f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a9b350360a64b55c7590f1ec03db480be">AST_FRAME_DTMF_BEGIN</a>;
<a name="l02861"></a>02861                <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a7aeded1dc9df91dee01bb7af719880c1">AST_FLAG_EMULATE_DTMF</a>);
<a name="l02862"></a>02862                chan-&gt;<a class="code" href="structast__channel.html#aa8ee924d99e2258f539129e641f9bc6d">emulate_dtmf_digit</a> = f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>;
<a name="l02863"></a>02863                chan-&gt;<a class="code" href="structast__channel.html#a7dda84c33a9f34c6a0192c88c263b507">dtmf_tv</a> = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l02864"></a>02864                <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a>) {
<a name="l02865"></a>02865                   <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a> &gt; <a class="code" href="channel_8c.html#a1422a2613fb73b73e9ded35fa30ff02b">AST_MIN_DTMF_DURATION</a>)
<a name="l02866"></a>02866                      chan-&gt;<a class="code" href="structast__channel.html#a7177c1890b4effc0819cf65c47aa9635">emulate_dtmf_duration</a> = f-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a>;
<a name="l02867"></a>02867                   <span class="keywordflow">else</span> 
<a name="l02868"></a>02868                      chan-&gt;<a class="code" href="structast__channel.html#a7177c1890b4effc0819cf65c47aa9635">emulate_dtmf_duration</a> = <a class="code" href="channel_8c.html#a1422a2613fb73b73e9ded35fa30ff02b">AST_MIN_DTMF_DURATION</a>;
<a name="l02869"></a>02869                } <span class="keywordflow">else</span>
<a name="l02870"></a>02870                   chan-&gt;<a class="code" href="structast__channel.html#a7177c1890b4effc0819cf65c47aa9635">emulate_dtmf_duration</a> = <a class="code" href="channel_8c.html#a4a1bcc0fd8b14e9bbff17b963969bcab">AST_DEFAULT_EMULATE_DTMF_DURATION</a>;
<a name="l02871"></a>02871                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#af360dd5e7b67cff6cb747d1aa2ac3db8">LOG_DTMF</a>, <span class="stringliteral">&quot;DTMF begin emulation of &apos;%c&apos; with duration %u queued on %s\n&quot;</span>, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>, chan-&gt;<a class="code" href="structast__channel.html#a7177c1890b4effc0819cf65c47aa9635">emulate_dtmf_duration</a>, chan-&gt;name);
<a name="l02872"></a>02872             }
<a name="l02873"></a>02873             <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>) {
<a name="l02874"></a>02874                <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *old_frame = f;<span class="comment"></span>
<a name="l02875"></a>02875 <span class="comment">               /*!</span>
<a name="l02876"></a>02876 <span class="comment">                * \todo XXX It is possible to write a digit to the audiohook twice</span>
<a name="l02877"></a>02877 <span class="comment">                * if the digit was originally read while the channel was in autoservice. */</span>
<a name="l02878"></a>02878                f = <a class="code" href="audiohook_8h.html#a6351c89eb98b1832e85fa9c0fca7383f" title="Pass a frame off to be handled by the audiohook core.">ast_audiohook_write_list</a>(chan, chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>, <a class="code" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899a56916f7012e7fe0ec9b6dd4e4c0e2a65">AST_AUDIOHOOK_DIRECTION_READ</a>, f);
<a name="l02879"></a>02879                <span class="keywordflow">if</span> (old_frame != f)
<a name="l02880"></a>02880                   <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(old_frame);
<a name="l02881"></a>02881             }
<a name="l02882"></a>02882          } <span class="keywordflow">else</span> {
<a name="l02883"></a>02883             <span class="keyword">struct </span>timeval now = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l02884"></a>02884             <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a919680ef9fe22e78b9b1e718d3b9a745">AST_FLAG_IN_DTMF</a>)) {
<a name="l02885"></a>02885                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#af360dd5e7b67cff6cb747d1aa2ac3db8">LOG_DTMF</a>, <span class="stringliteral">&quot;DTMF end accepted with begin &apos;%c&apos; on %s\n&quot;</span>, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>, chan-&gt;name);
<a name="l02886"></a>02886                <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a919680ef9fe22e78b9b1e718d3b9a745">AST_FLAG_IN_DTMF</a>);
<a name="l02887"></a>02887                <span class="keywordflow">if</span> (!f-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a>)
<a name="l02888"></a>02888                   f-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a> = <a class="code" href="time_8h.html#a74e35cffcd45ad6cd7c8587921e8a4c2" title="Computes the difference (in milliseconds) between two struct timeval instances.">ast_tvdiff_ms</a>(now, chan-&gt;<a class="code" href="structast__channel.html#a7dda84c33a9f34c6a0192c88c263b507">dtmf_tv</a>);
<a name="l02889"></a>02889             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!f-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a>) {
<a name="l02890"></a>02890                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#af360dd5e7b67cff6cb747d1aa2ac3db8">LOG_DTMF</a>, <span class="stringliteral">&quot;DTMF end accepted without begin &apos;%c&apos; on %s\n&quot;</span>, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>, chan-&gt;name);
<a name="l02891"></a>02891                f-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a> = <a class="code" href="channel_8c.html#a1422a2613fb73b73e9ded35fa30ff02b">AST_MIN_DTMF_DURATION</a>;
<a name="l02892"></a>02892             }
<a name="l02893"></a>02893             <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a> &lt; <a class="code" href="channel_8c.html#a1422a2613fb73b73e9ded35fa30ff02b">AST_MIN_DTMF_DURATION</a> &amp;&amp; !<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a668ac945c84f50becaca2a6134e64058">AST_FLAG_END_DTMF_ONLY</a>)) {
<a name="l02894"></a>02894                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#af360dd5e7b67cff6cb747d1aa2ac3db8">LOG_DTMF</a>, <span class="stringliteral">&quot;DTMF end &apos;%c&apos; has duration %ld but want minimum %d, emulating on %s\n&quot;</span>, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>, f-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a>, <a class="code" href="channel_8c.html#a1422a2613fb73b73e9ded35fa30ff02b">AST_MIN_DTMF_DURATION</a>, chan-&gt;name);
<a name="l02895"></a>02895                <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a7aeded1dc9df91dee01bb7af719880c1">AST_FLAG_EMULATE_DTMF</a>);
<a name="l02896"></a>02896                chan-&gt;<a class="code" href="structast__channel.html#aa8ee924d99e2258f539129e641f9bc6d">emulate_dtmf_digit</a> = f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>;
<a name="l02897"></a>02897                chan-&gt;<a class="code" href="structast__channel.html#a7177c1890b4effc0819cf65c47aa9635">emulate_dtmf_duration</a> = <a class="code" href="channel_8c.html#a1422a2613fb73b73e9ded35fa30ff02b">AST_MIN_DTMF_DURATION</a> - f-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a>;
<a name="l02898"></a>02898                <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l02899"></a>02899                f = &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l02900"></a>02900             } <span class="keywordflow">else</span> {
<a name="l02901"></a>02901                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#af360dd5e7b67cff6cb747d1aa2ac3db8">LOG_DTMF</a>, <span class="stringliteral">&quot;DTMF end passthrough &apos;%c&apos; on %s\n&quot;</span>, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>, chan-&gt;name);
<a name="l02902"></a>02902                <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a> &lt; <a class="code" href="channel_8c.html#a1422a2613fb73b73e9ded35fa30ff02b">AST_MIN_DTMF_DURATION</a>) {
<a name="l02903"></a>02903                   f-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a> = <a class="code" href="channel_8c.html#a1422a2613fb73b73e9ded35fa30ff02b">AST_MIN_DTMF_DURATION</a>;
<a name="l02904"></a>02904                }
<a name="l02905"></a>02905                chan-&gt;<a class="code" href="structast__channel.html#a7dda84c33a9f34c6a0192c88c263b507">dtmf_tv</a> = now;
<a name="l02906"></a>02906             }
<a name="l02907"></a>02907             <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>) {
<a name="l02908"></a>02908                <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *old_frame = f;
<a name="l02909"></a>02909                f = <a class="code" href="audiohook_8h.html#a6351c89eb98b1832e85fa9c0fca7383f" title="Pass a frame off to be handled by the audiohook core.">ast_audiohook_write_list</a>(chan, chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>, <a class="code" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899a56916f7012e7fe0ec9b6dd4e4c0e2a65">AST_AUDIOHOOK_DIRECTION_READ</a>, f);
<a name="l02910"></a>02910                <span class="keywordflow">if</span> (old_frame != f)
<a name="l02911"></a>02911                   <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(old_frame);
<a name="l02912"></a>02912             }
<a name="l02913"></a>02913          }
<a name="l02914"></a>02914          <span class="keywordflow">break</span>;
<a name="l02915"></a>02915       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a9b350360a64b55c7590f1ec03db480be">AST_FRAME_DTMF_BEGIN</a>:
<a name="l02916"></a>02916          <a class="code" href="channel_8c.html#a2897ccacbd4c0c894a7e8212da97ee83">send_dtmf_event</a>(chan, <span class="stringliteral">&quot;Received&quot;</span>, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>, <span class="stringliteral">&quot;Yes&quot;</span>, <span class="stringliteral">&quot;No&quot;</span>);
<a name="l02917"></a>02917          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#af360dd5e7b67cff6cb747d1aa2ac3db8">LOG_DTMF</a>, <span class="stringliteral">&quot;DTMF begin &apos;%c&apos; received on %s\n&quot;</span>, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>, chan-&gt;name);
<a name="l02918"></a>02918          <span class="keywordflow">if</span> ( <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329ab05edf1bf82b02f5987de92a6960a9bd">AST_FLAG_DEFER_DTMF</a> | <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a668ac945c84f50becaca2a6134e64058">AST_FLAG_END_DTMF_ONLY</a> | <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a7aeded1dc9df91dee01bb7af719880c1">AST_FLAG_EMULATE_DTMF</a>) || 
<a name="l02919"></a>02919              (!<a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(chan-&gt;<a class="code" href="structast__channel.html#a7dda84c33a9f34c6a0192c88c263b507">dtmf_tv</a>) &amp;&amp; 
<a name="l02920"></a>02920                <a class="code" href="time_8h.html#a74e35cffcd45ad6cd7c8587921e8a4c2" title="Computes the difference (in milliseconds) between two struct timeval instances.">ast_tvdiff_ms</a>(<a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>(), chan-&gt;<a class="code" href="structast__channel.html#a7dda84c33a9f34c6a0192c88c263b507">dtmf_tv</a>) &lt; <a class="code" href="channel_8c.html#a21882e640e01106e62bdab88849a17c5">AST_MIN_DTMF_GAP</a>) ) {
<a name="l02921"></a>02921             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#af360dd5e7b67cff6cb747d1aa2ac3db8">LOG_DTMF</a>, <span class="stringliteral">&quot;DTMF begin ignored &apos;%c&apos; on %s\n&quot;</span>, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>, chan-&gt;name);
<a name="l02922"></a>02922             <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l02923"></a>02923             f = &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l02924"></a>02924          } <span class="keywordflow">else</span> {
<a name="l02925"></a>02925             <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a919680ef9fe22e78b9b1e718d3b9a745">AST_FLAG_IN_DTMF</a>);
<a name="l02926"></a>02926             chan-&gt;<a class="code" href="structast__channel.html#a7dda84c33a9f34c6a0192c88c263b507">dtmf_tv</a> = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l02927"></a>02927             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#af360dd5e7b67cff6cb747d1aa2ac3db8">LOG_DTMF</a>, <span class="stringliteral">&quot;DTMF begin passthrough &apos;%c&apos; on %s\n&quot;</span>, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>, chan-&gt;name);
<a name="l02928"></a>02928          }
<a name="l02929"></a>02929          <span class="keywordflow">break</span>;
<a name="l02930"></a>02930       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a29ff71f9d5c7927906ebd437fe372056">AST_FRAME_NULL</a>:
<a name="l02931"></a>02931          <span class="comment">/* The EMULATE_DTMF flag must be cleared here as opposed to when the duration</span>
<a name="l02932"></a>02932 <span class="comment">          * is reached , because we want to make sure we pass at least one</span>
<a name="l02933"></a>02933 <span class="comment">          * voice frame through before starting the next digit, to ensure a gap</span>
<a name="l02934"></a>02934 <span class="comment">          * between DTMF digits. */</span>
<a name="l02935"></a>02935          <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a7aeded1dc9df91dee01bb7af719880c1">AST_FLAG_EMULATE_DTMF</a>)) {
<a name="l02936"></a>02936             <span class="keyword">struct </span>timeval now = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l02937"></a>02937             <span class="keywordflow">if</span> (!chan-&gt;<a class="code" href="structast__channel.html#a7177c1890b4effc0819cf65c47aa9635">emulate_dtmf_duration</a>) {
<a name="l02938"></a>02938                <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a7aeded1dc9df91dee01bb7af719880c1">AST_FLAG_EMULATE_DTMF</a>);
<a name="l02939"></a>02939                chan-&gt;<a class="code" href="structast__channel.html#aa8ee924d99e2258f539129e641f9bc6d">emulate_dtmf_digit</a> = 0;
<a name="l02940"></a>02940             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="time_8h.html#a74e35cffcd45ad6cd7c8587921e8a4c2" title="Computes the difference (in milliseconds) between two struct timeval instances.">ast_tvdiff_ms</a>(now, chan-&gt;<a class="code" href="structast__channel.html#a7dda84c33a9f34c6a0192c88c263b507">dtmf_tv</a>) &gt;= chan-&gt;<a class="code" href="structast__channel.html#a7177c1890b4effc0819cf65c47aa9635">emulate_dtmf_duration</a>) {
<a name="l02941"></a>02941                chan-&gt;<a class="code" href="structast__channel.html#a7177c1890b4effc0819cf65c47aa9635">emulate_dtmf_duration</a> = 0;
<a name="l02942"></a>02942                <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l02943"></a>02943                f = &amp;chan-&gt;<a class="code" href="structast__channel.html#a2d07143627b03360ff4de0097553dbcc">dtmff</a>;
<a name="l02944"></a>02944                f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a98e65764bc963016c394bcc1bad6540b">AST_FRAME_DTMF_END</a>;
<a name="l02945"></a>02945                f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = chan-&gt;<a class="code" href="structast__channel.html#aa8ee924d99e2258f539129e641f9bc6d">emulate_dtmf_digit</a>;
<a name="l02946"></a>02946                f-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a> = <a class="code" href="time_8h.html#a74e35cffcd45ad6cd7c8587921e8a4c2" title="Computes the difference (in milliseconds) between two struct timeval instances.">ast_tvdiff_ms</a>(now, chan-&gt;<a class="code" href="structast__channel.html#a7dda84c33a9f34c6a0192c88c263b507">dtmf_tv</a>);
<a name="l02947"></a>02947                chan-&gt;<a class="code" href="structast__channel.html#a7dda84c33a9f34c6a0192c88c263b507">dtmf_tv</a> = now;
<a name="l02948"></a>02948                <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a7aeded1dc9df91dee01bb7af719880c1">AST_FLAG_EMULATE_DTMF</a>);
<a name="l02949"></a>02949                chan-&gt;<a class="code" href="structast__channel.html#aa8ee924d99e2258f539129e641f9bc6d">emulate_dtmf_digit</a> = 0;
<a name="l02950"></a>02950                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#af360dd5e7b67cff6cb747d1aa2ac3db8">LOG_DTMF</a>, <span class="stringliteral">&quot;DTMF end emulation of &apos;%c&apos; queued on %s\n&quot;</span>, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>, chan-&gt;name);
<a name="l02951"></a>02951                <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>) {
<a name="l02952"></a>02952                   <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *old_frame = f;
<a name="l02953"></a>02953                   f = <a class="code" href="audiohook_8h.html#a6351c89eb98b1832e85fa9c0fca7383f" title="Pass a frame off to be handled by the audiohook core.">ast_audiohook_write_list</a>(chan, chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>, <a class="code" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899a56916f7012e7fe0ec9b6dd4e4c0e2a65">AST_AUDIOHOOK_DIRECTION_READ</a>, f);
<a name="l02954"></a>02954                   <span class="keywordflow">if</span> (old_frame != f) {
<a name="l02955"></a>02955                      <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(old_frame);
<a name="l02956"></a>02956                   }
<a name="l02957"></a>02957                }
<a name="l02958"></a>02958             }
<a name="l02959"></a>02959          }
<a name="l02960"></a>02960          <span class="keywordflow">break</span>;
<a name="l02961"></a>02961       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>:
<a name="l02962"></a>02962          <span class="comment">/* The EMULATE_DTMF flag must be cleared here as opposed to when the duration</span>
<a name="l02963"></a>02963 <span class="comment">          * is reached , because we want to make sure we pass at least one</span>
<a name="l02964"></a>02964 <span class="comment">          * voice frame through before starting the next digit, to ensure a gap</span>
<a name="l02965"></a>02965 <span class="comment">          * between DTMF digits. */</span>
<a name="l02966"></a>02966          <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a7aeded1dc9df91dee01bb7af719880c1">AST_FLAG_EMULATE_DTMF</a>) &amp;&amp; !chan-&gt;<a class="code" href="structast__channel.html#a7177c1890b4effc0819cf65c47aa9635">emulate_dtmf_duration</a>) {
<a name="l02967"></a>02967             <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a7aeded1dc9df91dee01bb7af719880c1">AST_FLAG_EMULATE_DTMF</a>);
<a name="l02968"></a>02968             chan-&gt;<a class="code" href="structast__channel.html#aa8ee924d99e2258f539129e641f9bc6d">emulate_dtmf_digit</a> = 0;
<a name="l02969"></a>02969          }
<a name="l02970"></a>02970 
<a name="l02971"></a>02971          <span class="keywordflow">if</span> (dropaudio || <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a919680ef9fe22e78b9b1e718d3b9a745">AST_FLAG_IN_DTMF</a>)) {
<a name="l02972"></a>02972             <span class="keywordflow">if</span> (dropaudio)
<a name="l02973"></a>02973                <a class="code" href="channel_8c.html#a34c65699645170a1168e9177ad8aebd4">ast_read_generator_actions</a>(chan, f);
<a name="l02974"></a>02974             <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l02975"></a>02975             f = &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l02976"></a>02976          }
<a name="l02977"></a>02977 
<a name="l02978"></a>02978          <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a7aeded1dc9df91dee01bb7af719880c1">AST_FLAG_EMULATE_DTMF</a>) &amp;&amp; !<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a919680ef9fe22e78b9b1e718d3b9a745">AST_FLAG_IN_DTMF</a>)) {
<a name="l02979"></a>02979             <span class="keyword">struct </span>timeval now = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l02980"></a>02980             <span class="keywordflow">if</span> (<a class="code" href="time_8h.html#a74e35cffcd45ad6cd7c8587921e8a4c2" title="Computes the difference (in milliseconds) between two struct timeval instances.">ast_tvdiff_ms</a>(now, chan-&gt;<a class="code" href="structast__channel.html#a7dda84c33a9f34c6a0192c88c263b507">dtmf_tv</a>) &gt;= chan-&gt;<a class="code" href="structast__channel.html#a7177c1890b4effc0819cf65c47aa9635">emulate_dtmf_duration</a>) {
<a name="l02981"></a>02981                chan-&gt;<a class="code" href="structast__channel.html#a7177c1890b4effc0819cf65c47aa9635">emulate_dtmf_duration</a> = 0;
<a name="l02982"></a>02982                <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l02983"></a>02983                f = &amp;chan-&gt;<a class="code" href="structast__channel.html#a2d07143627b03360ff4de0097553dbcc">dtmff</a>;
<a name="l02984"></a>02984                f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a98e65764bc963016c394bcc1bad6540b">AST_FRAME_DTMF_END</a>;
<a name="l02985"></a>02985                f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = chan-&gt;<a class="code" href="structast__channel.html#aa8ee924d99e2258f539129e641f9bc6d">emulate_dtmf_digit</a>;
<a name="l02986"></a>02986                f-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a> = <a class="code" href="time_8h.html#a74e35cffcd45ad6cd7c8587921e8a4c2" title="Computes the difference (in milliseconds) between two struct timeval instances.">ast_tvdiff_ms</a>(now, chan-&gt;<a class="code" href="structast__channel.html#a7dda84c33a9f34c6a0192c88c263b507">dtmf_tv</a>);
<a name="l02987"></a>02987                chan-&gt;<a class="code" href="structast__channel.html#a7dda84c33a9f34c6a0192c88c263b507">dtmf_tv</a> = now;
<a name="l02988"></a>02988                <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>) {
<a name="l02989"></a>02989                   <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *old_frame = f;
<a name="l02990"></a>02990                   f = <a class="code" href="audiohook_8h.html#a6351c89eb98b1832e85fa9c0fca7383f" title="Pass a frame off to be handled by the audiohook core.">ast_audiohook_write_list</a>(chan, chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>, <a class="code" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899a56916f7012e7fe0ec9b6dd4e4c0e2a65">AST_AUDIOHOOK_DIRECTION_READ</a>, f);
<a name="l02991"></a>02991                   <span class="keywordflow">if</span> (old_frame != f)
<a name="l02992"></a>02992                      <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(old_frame);
<a name="l02993"></a>02993                }
<a name="l02994"></a>02994                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#af360dd5e7b67cff6cb747d1aa2ac3db8">LOG_DTMF</a>, <span class="stringliteral">&quot;DTMF end emulation of &apos;%c&apos; queued on %s\n&quot;</span>, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>, chan-&gt;name);
<a name="l02995"></a>02995             } <span class="keywordflow">else</span> {
<a name="l02996"></a>02996                <span class="comment">/* Drop voice frames while we&apos;re still in the middle of the digit */</span>
<a name="l02997"></a>02997                <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l02998"></a>02998                f = &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l02999"></a>02999             }
<a name="l03000"></a>03000          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>) &amp;&amp; !(f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> &amp; chan-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>)) {
<a name="l03001"></a>03001             <span class="comment">/* This frame is not one of the current native formats -- drop it on the floor */</span>
<a name="l03002"></a>03002             <span class="keywordtype">char</span> to[200];
<a name="l03003"></a>03003             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Dropping incompatible voice frame on %s of format %s since our native format has changed to %s\n&quot;</span>,
<a name="l03004"></a>03004                chan-&gt;name, <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>), <a class="code" href="frame_8h.html#a37cdc7e78686b0bfa4e47e645f782b30" title="Get the names of a set of formats.">ast_getformatname_multiple</a>(to, <span class="keyword">sizeof</span>(to), chan-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>));
<a name="l03005"></a>03005             <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l03006"></a>03006             f = &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l03007"></a>03007          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>)) {
<a name="l03008"></a>03008             <span class="comment">/* Send frame to audiohooks if present */</span>
<a name="l03009"></a>03009             <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>) {
<a name="l03010"></a>03010                <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *old_frame = f;
<a name="l03011"></a>03011                f = <a class="code" href="audiohook_8h.html#a6351c89eb98b1832e85fa9c0fca7383f" title="Pass a frame off to be handled by the audiohook core.">ast_audiohook_write_list</a>(chan, chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>, <a class="code" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899a56916f7012e7fe0ec9b6dd4e4c0e2a65">AST_AUDIOHOOK_DIRECTION_READ</a>, f);
<a name="l03012"></a>03012                <span class="keywordflow">if</span> (old_frame != f)
<a name="l03013"></a>03013                   <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(old_frame);
<a name="l03014"></a>03014             }
<a name="l03015"></a>03015             <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a4254cefdfaeb5200f89e7ba3ae6f0922">monitor</a> &amp;&amp; chan-&gt;<a class="code" href="structast__channel.html#a4254cefdfaeb5200f89e7ba3ae6f0922">monitor</a>-&gt;<a class="code" href="structast__channel__monitor.html#a71e6f392234194bc5a27b42b90f9df56">read_stream</a> ) {
<a name="l03016"></a>03016                <span class="comment">/* XXX what does this do ? */</span>
<a name="l03017"></a>03017 <span class="preprocessor">#ifndef MONITOR_CONSTANT_DELAY</span>
<a name="l03018"></a>03018 <span class="preprocessor"></span>               <span class="keywordtype">int</span> jump = chan-&gt;<a class="code" href="structast__channel.html#a38fcd80fe4193f13d83f7cb3f7c3218f">outsmpl</a> - chan-&gt;<a class="code" href="structast__channel.html#a95c0c6b0a347b576b183cfa44e9b6a43">insmpl</a> - 4 * f-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>;
<a name="l03019"></a>03019                <span class="keywordflow">if</span> (jump &gt;= 0) {
<a name="l03020"></a>03020                   jump = <a class="code" href="channel_8c.html#a2679f53f358ce4d56596c511afab764b" title="calculates the number of samples to jump forward with in a monitor stream.">calc_monitor_jump</a>((chan-&gt;<a class="code" href="structast__channel.html#a38fcd80fe4193f13d83f7cb3f7c3218f">outsmpl</a> - chan-&gt;<a class="code" href="structast__channel.html#a95c0c6b0a347b576b183cfa44e9b6a43">insmpl</a>), <a class="code" href="frame_8h.html#a29a7b93f4295966d4d441e91bff2b01e" title="Get the sample rate for a given format.">ast_format_rate</a>(f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>), <a class="code" href="frame_8h.html#a29a7b93f4295966d4d441e91bff2b01e" title="Get the sample rate for a given format.">ast_format_rate</a>(chan-&gt;<a class="code" href="structast__channel.html#a4254cefdfaeb5200f89e7ba3ae6f0922">monitor</a>-&gt;<a class="code" href="structast__channel__monitor.html#a71e6f392234194bc5a27b42b90f9df56">read_stream</a>-&gt;<a class="code" href="structast__filestream.html#af4e7a9f36c380991c59c9a49122de100">fmt</a>-&gt;<a class="code" href="structast__format.html#a317afff57d87a89158c2b038d37b2b08">format</a>));
<a name="l03021"></a>03021                   <span class="keywordflow">if</span> (<a class="code" href="file_8h.html#a36f6bba05952162d5d1ee7fb9819bd07" title="Seeks into stream.">ast_seekstream</a>(chan-&gt;<a class="code" href="structast__channel.html#a4254cefdfaeb5200f89e7ba3ae6f0922">monitor</a>-&gt;<a class="code" href="structast__channel__monitor.html#a71e6f392234194bc5a27b42b90f9df56">read_stream</a>, jump, <a class="code" href="file_8h.html#abd4aebd901cf2e2251920acfbe22fa22">SEEK_FORCECUR</a>) == -1)
<a name="l03022"></a>03022                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to perform seek in monitoring read stream, synchronization between the files may be broken\n&quot;</span>);
<a name="l03023"></a>03023                   chan-&gt;<a class="code" href="structast__channel.html#a95c0c6b0a347b576b183cfa44e9b6a43">insmpl</a> += (chan-&gt;<a class="code" href="structast__channel.html#a38fcd80fe4193f13d83f7cb3f7c3218f">outsmpl</a> - chan-&gt;<a class="code" href="structast__channel.html#a95c0c6b0a347b576b183cfa44e9b6a43">insmpl</a>) + f-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>;
<a name="l03024"></a>03024                } <span class="keywordflow">else</span>
<a name="l03025"></a>03025                   chan-&gt;<a class="code" href="structast__channel.html#a95c0c6b0a347b576b183cfa44e9b6a43">insmpl</a>+= f-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>;
<a name="l03026"></a>03026 <span class="preprocessor">#else</span>
<a name="l03027"></a>03027 <span class="preprocessor"></span>               <span class="keywordtype">int</span> jump = <a class="code" href="channel_8c.html#a2679f53f358ce4d56596c511afab764b" title="calculates the number of samples to jump forward with in a monitor stream.">calc_monitor_jump</a>((chan-&gt;<a class="code" href="structast__channel.html#a38fcd80fe4193f13d83f7cb3f7c3218f">outsmpl</a> - chan-&gt;<a class="code" href="structast__channel.html#a95c0c6b0a347b576b183cfa44e9b6a43">insmpl</a>), <a class="code" href="frame_8h.html#a29a7b93f4295966d4d441e91bff2b01e" title="Get the sample rate for a given format.">ast_format_rate</a>(f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>), <a class="code" href="frame_8h.html#a29a7b93f4295966d4d441e91bff2b01e" title="Get the sample rate for a given format.">ast_format_rate</a>(chan-&gt;<a class="code" href="structast__channel.html#a4254cefdfaeb5200f89e7ba3ae6f0922">monitor</a>-&gt;<a class="code" href="structast__channel__monitor.html#a71e6f392234194bc5a27b42b90f9df56">read_stream</a>-&gt;<a class="code" href="structast__filestream.html#af4e7a9f36c380991c59c9a49122de100">fmt</a>-&gt;<a class="code" href="structast__format.html#a317afff57d87a89158c2b038d37b2b08">format</a>));
<a name="l03028"></a>03028                <span class="keywordflow">if</span> (jump - MONITOR_DELAY &gt;= 0) {
<a name="l03029"></a>03029                   <span class="keywordflow">if</span> (<a class="code" href="file_8h.html#a36f6bba05952162d5d1ee7fb9819bd07" title="Seeks into stream.">ast_seekstream</a>(chan-&gt;<a class="code" href="structast__channel.html#a4254cefdfaeb5200f89e7ba3ae6f0922">monitor</a>-&gt;<a class="code" href="structast__channel__monitor.html#a71e6f392234194bc5a27b42b90f9df56">read_stream</a>, jump - f-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>, <a class="code" href="file_8h.html#abd4aebd901cf2e2251920acfbe22fa22">SEEK_FORCECUR</a>) == -1)
<a name="l03030"></a>03030                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to perform seek in monitoring read stream, synchronization between the files may be broken\n&quot;</span>);
<a name="l03031"></a>03031                   chan-&gt;<a class="code" href="structast__channel.html#a95c0c6b0a347b576b183cfa44e9b6a43">insmpl</a> += chan-&gt;<a class="code" href="structast__channel.html#a38fcd80fe4193f13d83f7cb3f7c3218f">outsmpl</a> - chan-&gt;<a class="code" href="structast__channel.html#a95c0c6b0a347b576b183cfa44e9b6a43">insmpl</a>;
<a name="l03032"></a>03032                } <span class="keywordflow">else</span>
<a name="l03033"></a>03033                   chan-&gt;<a class="code" href="structast__channel.html#a95c0c6b0a347b576b183cfa44e9b6a43">insmpl</a> += f-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>;
<a name="l03034"></a>03034 <span class="preprocessor">#endif</span>
<a name="l03035"></a>03035 <span class="preprocessor"></span>               <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a4254cefdfaeb5200f89e7ba3ae6f0922">monitor</a>-&gt;<a class="code" href="structast__channel__monitor.html#a8e6392758d65e06d5e34fddc95bcb9c7">state</a> == <a class="code" href="monitor_8h.html#a9b57685a45dd0700625ea8ba83a868dface918b901d180f5ea85f8a941fc8cbdb">AST_MONITOR_RUNNING</a>) {
<a name="l03036"></a>03036                   <span class="keywordflow">if</span> (<a class="code" href="file_8h.html#a3608386b919ef0949d2858cdeb02d12e" title="Writes a frame to a stream.">ast_writestream</a>(chan-&gt;<a class="code" href="structast__channel.html#a4254cefdfaeb5200f89e7ba3ae6f0922">monitor</a>-&gt;<a class="code" href="structast__channel__monitor.html#a71e6f392234194bc5a27b42b90f9df56">read_stream</a>, f) &lt; 0)
<a name="l03037"></a>03037                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to write data to channel monitor read stream\n&quot;</span>);
<a name="l03038"></a>03038                }
<a name="l03039"></a>03039             }
<a name="l03040"></a>03040 
<a name="l03041"></a>03041             <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a9601e6aff2a4c59cbeb9d6fef81184f4">readtrans</a> &amp;&amp; (f = <a class="code" href="translate_8h.html#ab09d3ccb95d1f828d2871530226f9456" title="translates one or more frames Apply an input frame into the translator and receive...">ast_translate</a>(chan-&gt;<a class="code" href="structast__channel.html#a9601e6aff2a4c59cbeb9d6fef81184f4">readtrans</a>, f, 1)) == NULL) {
<a name="l03042"></a>03042                f = &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l03043"></a>03043             }
<a name="l03044"></a>03044 
<a name="l03045"></a>03045             <span class="comment">/* it is possible for the translation process on chan-&gt;readtrans to have</span>
<a name="l03046"></a>03046 <span class="comment">               produced multiple frames from the single input frame we passed it; if</span>
<a name="l03047"></a>03047 <span class="comment">               this happens, queue the additional frames *before* the frames we may</span>
<a name="l03048"></a>03048 <span class="comment">               have queued earlier. if the readq was empty, put them at the head of</span>
<a name="l03049"></a>03049 <span class="comment">               the queue, and if it was not, put them just after the frame that was</span>
<a name="l03050"></a>03050 <span class="comment">               at the end of the queue.</span>
<a name="l03051"></a>03051 <span class="comment">            */</span>
<a name="l03052"></a>03052             <span class="keywordflow">if</span> (<a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(f, frame_list)) {
<a name="l03053"></a>03053                <span class="keywordflow">if</span> (!readq_tail) {
<a name="l03054"></a>03054                   <a class="code" href="channel_8h.html#a5665eaabfca509388208e4bd83ed7532" title="Queue one or more frames to the head of a channel&amp;#39;s frame queue.">ast_queue_frame_head</a>(chan, <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(f, frame_list));
<a name="l03055"></a>03055                } <span class="keywordflow">else</span> {
<a name="l03056"></a>03056                   <a class="code" href="channel_8c.html#ae5b763a23d35fc0b721adc3df8724712">__ast_queue_frame</a>(chan, <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(f, frame_list), 0, readq_tail);
<a name="l03057"></a>03057                }
<a name="l03058"></a>03058                <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(<a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(f, frame_list));
<a name="l03059"></a>03059                <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(f, frame_list) = NULL;
<a name="l03060"></a>03060             }
<a name="l03061"></a>03061 
<a name="l03062"></a>03062             <span class="comment">/* Run generator sitting on the line if timing device not available</span>
<a name="l03063"></a>03063 <span class="comment">            * and synchronous generation of outgoing frames is necessary       */</span>
<a name="l03064"></a>03064             <a class="code" href="channel_8c.html#a34c65699645170a1168e9177ad8aebd4">ast_read_generator_actions</a>(chan, f);
<a name="l03065"></a>03065          }
<a name="l03066"></a>03066       <span class="keywordflow">default</span>:
<a name="l03067"></a>03067          <span class="comment">/* Just pass it on! */</span>
<a name="l03068"></a>03068          <span class="keywordflow">break</span>;
<a name="l03069"></a>03069       }
<a name="l03070"></a>03070    } <span class="keywordflow">else</span> {
<a name="l03071"></a>03071       <span class="comment">/* Make sure we always return NULL in the future */</span>
<a name="l03072"></a>03072       chan-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> |= <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709a2e185ce313026e13ed90ae3a319c9cb7">AST_SOFTHANGUP_DEV</a>;
<a name="l03073"></a>03073       <span class="keywordflow">if</span> (<a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>)
<a name="l03074"></a>03074          chan-&gt;<a class="code" href="structast__channel.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a> = <a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>;
<a name="l03075"></a>03075       <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a4e855ab0f984741b9083b2c5a0fdfe18">generator</a>)
<a name="l03076"></a>03076          <a class="code" href="channel_8h.html#a7160355005776732fba88cc020f4a45b">ast_deactivate_generator</a>(chan);
<a name="l03077"></a>03077       <span class="comment">/* We no longer End the CDR here */</span>
<a name="l03078"></a>03078    }
<a name="l03079"></a>03079 
<a name="l03080"></a>03080    <span class="comment">/* High bit prints debugging */</span>
<a name="l03081"></a>03081    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#aa4b0a5423e11c07e15c3a503c36be0fb">fin</a> &amp; <a class="code" href="channel_8h.html#a2011c630205057fb4b67eb06145e4a7f">DEBUGCHAN_FLAG</a>)
<a name="l03082"></a>03082       <a class="code" href="frame_8h.html#a35641692b96e9e81da06d8d36e677cb8">ast_frame_dump</a>(chan-&gt;name, f, <span class="stringliteral">&quot;&lt;&lt;&quot;</span>);
<a name="l03083"></a>03083    chan-&gt;<a class="code" href="structast__channel.html#aa4b0a5423e11c07e15c3a503c36be0fb">fin</a> = <a class="code" href="channel_8h.html#ae02cd8717fa5e5be15080386639ebb2c">FRAMECOUNT_INC</a>(chan-&gt;<a class="code" href="structast__channel.html#aa4b0a5423e11c07e15c3a503c36be0fb">fin</a>);
<a name="l03084"></a>03084 
<a name="l03085"></a>03085 done:
<a name="l03086"></a>03086    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a80a9a0d24139c1d84463de5e88248491">music_state</a> &amp;&amp; chan-&gt;<a class="code" href="structast__channel.html#a4e855ab0f984741b9083b2c5a0fdfe18">generator</a> &amp;&amp; chan-&gt;<a class="code" href="structast__channel.html#a4e855ab0f984741b9083b2c5a0fdfe18">generator</a>-&gt;<a class="code" href="structast__generator.html#a6b5dd8c2aa06427e8da9bc5b5e7ec156">digit</a> &amp;&amp; f &amp;&amp; f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a98e65764bc963016c394bcc1bad6540b">AST_FRAME_DTMF_END</a>)
<a name="l03087"></a>03087       chan-&gt;<a class="code" href="structast__channel.html#a4e855ab0f984741b9083b2c5a0fdfe18">generator</a>-&gt;<a class="code" href="structast__generator.html#a6b5dd8c2aa06427e8da9bc5b5e7ec156">digit</a>(chan, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>);
<a name="l03088"></a>03088 
<a name="l03089"></a>03089    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l03090"></a>03090    <span class="keywordflow">return</span> f;
<a name="l03091"></a>03091 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab387fa45df3edc5e64f5c2e2c07860ed"></a><!-- doxytag: member="channel.c::__ast_request_and_dial" ref="ab387fa45df3edc5e64f5c2e2c07860ed" args="(const char *type, int format, void *data, int timeout, int *outstate, const char *cid_num, const char *cid_name, struct outgoing_helper *oh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__channel.html">ast_channel</a>* __ast_request_and_dial </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>timeout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>reason</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>cid_num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>cid_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structoutgoing__helper.html">outgoing_helper</a> *&nbsp;</td>
          <td class="paramname"> <em>oh</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Request a channel of a given type, with data as optional information used by the low level module and attempt to place a call on it. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>type</em>&nbsp;</td><td>type of channel to request </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>format</em>&nbsp;</td><td>requested channel format </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>data to pass to the channel requester </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>timeout</em>&nbsp;</td><td>maximum amount of time to wait for an answer </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>reason</em>&nbsp;</td><td>why unsuccessful (if unsuccessful) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>cid_num</em>&nbsp;</td><td>Caller-ID Number </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>cid_name</em>&nbsp;</td><td>Caller-ID Name (ascii) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>oh</em>&nbsp;</td><td>Outgoing helper </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns an <a class="el" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> on success or no answer, NULL on failure. Check the value of chan-&gt;_state to know if the call was answered or not. </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l03851">3851</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="channel_8h_source.html#l00619">outgoing_helper::account</a>, <a class="el" href="channel_8c_source.html#l04042">ast_call()</a>, <a class="el" href="channel_8c_source.html#l03779">ast_call_forward()</a>, <a class="el" href="causes_8h_source.html#l00105">AST_CAUSE_NO_ANSWER</a>, <a class="el" href="cdr_8c_source.html#l00452">ast_cdr_alloc()</a>, <a class="el" href="cdr_8c_source.html#l00746">ast_cdr_disposition()</a>, <a class="el" href="cdr_8c_source.html#l00879">ast_cdr_end()</a>, <a class="el" href="cdr_8c_source.html#l00715">ast_cdr_failed()</a>, <a class="el" href="cdr_8h_source.html#l00042">AST_CDR_FLAG_ORIGINATED</a>, <a class="el" href="cdr_8c_source.html#l00844">ast_cdr_init()</a>, <a class="el" href="cdr_8c_source.html#l00936">ast_cdr_setaccount()</a>, <a class="el" href="cdr_8c_source.html#l00778">ast_cdr_setapp()</a>, <a class="el" href="cdr_8c_source.html#l00674">ast_cdr_start()</a>, <a class="el" href="cdr_8c_source.html#l00996">ast_cdr_update()</a>, <a class="el" href="channel_8c_source.html#l01517">ast_channel_datastore_inherit()</a>, <a class="el" href="channel_8c_source.html#l04302">ast_channel_inherit_variables()</a>, <a class="el" href="frame_8h_source.html#l00301">AST_CONTROL_ANSWER</a>, <a class="el" href="frame_8h_source.html#l00302">AST_CONTROL_BUSY</a>, <a class="el" href="frame_8h_source.html#l00305">AST_CONTROL_CONGESTION</a>, <a class="el" href="frame_8h_source.html#l00298">AST_CONTROL_HANGUP</a>, <a class="el" href="frame_8h_source.html#l00313">AST_CONTROL_HOLD</a>, <a class="el" href="frame_8h_source.html#l00312">AST_CONTROL_PROCEEDING</a>, <a class="el" href="frame_8h_source.html#l00311">AST_CONTROL_PROGRESS</a>, <a class="el" href="frame_8h_source.html#l00300">AST_CONTROL_RINGING</a>, <a class="el" href="frame_8h_source.html#l00317">AST_CONTROL_SRCUPDATE</a>, <a class="el" href="frame_8h_source.html#l00314">AST_CONTROL_UNHOLD</a>, <a class="el" href="frame_8h_source.html#l00315">AST_CONTROL_VIDUPDATE</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="frame_8h_source.html#l00105">AST_FRAME_CONTROL</a>, <a class="el" href="frame_8h_source.html#l00462">ast_frfree</a>, <a class="el" href="channel_8c_source.html#l01690">ast_hangup()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8c_source.html#l03100">ast_read()</a>, <a class="el" href="channel_8c_source.html#l03986">ast_request()</a>, <a class="el" href="channel_8c_source.html#l04670">ast_set_callerid()</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="channel_8c_source.html#l05592">ast_set_variables()</a>, <a class="el" href="channel_8h_source.html#l00365">AST_STATE_UP</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="channel_8c_source.html#l02389">ast_waitfor()</a>, <a class="el" href="channel_8c_source.html#l00136">cause</a>, <a class="el" href="channel_8h_source.html#l00422">ast_channel::cdr</a>, <a class="el" href="channel_8h_source.html#l00618">outgoing_helper::cid_name</a>, <a class="el" href="channel_8h_source.html#l00617">outgoing_helper::cid_num</a>, <a class="el" href="channel_8h_source.html#l00503">ast_channel::context</a>, <a class="el" href="channel_8h_source.html#l00614">outgoing_helper::context</a>, <a class="el" href="channel_8h_source.html#l00504">ast_channel::exten</a>, <a class="el" href="channel_8h_source.html#l00615">outgoing_helper::exten</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="channel_8c_source.html#l03766">handle_cause()</a>, <a class="el" href="channel_8h_source.html#l00479">ast_channel::hangupcause</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="channel_8h_source.html#l00621">outgoing_helper::parent_channel</a>, <a class="el" href="channel_8h_source.html#l00471">ast_channel::priority</a>, <a class="el" href="channel_8h_source.html#l00616">outgoing_helper::priority</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, and <a class="el" href="channel_8h_source.html#l00620">outgoing_helper::vars</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l08106">ast_pbx_outgoing_app()</a>, <a class="el" href="pbx_8c_source.html#l07940">ast_pbx_outgoing_exten()</a>, <a class="el" href="channel_8c_source.html#l03981">ast_request_and_dial()</a>, and <a class="el" href="app__parkandannounce_8c_source.html#l00088">parkandannounce_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03852"></a>03852 {
<a name="l03853"></a>03853    <span class="keywordtype">int</span> dummy_outstate;
<a name="l03854"></a>03854    <span class="keywordtype">int</span> <a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a> = 0;
<a name="l03855"></a>03855    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>;
<a name="l03856"></a>03856    <span class="keywordtype">int</span> res = 0;
<a name="l03857"></a>03857    <span class="keywordtype">int</span> last_subclass = 0;
<a name="l03858"></a>03858    
<a name="l03859"></a>03859    <span class="keywordflow">if</span> (outstate)
<a name="l03860"></a>03860       *outstate = 0;
<a name="l03861"></a>03861    <span class="keywordflow">else</span>
<a name="l03862"></a>03862       outstate = &amp;dummy_outstate;   <span class="comment">/* make outstate always a valid pointer */</span>
<a name="l03863"></a>03863 
<a name="l03864"></a>03864    chan = <a class="code" href="channel_8h.html#a922b0c040026477b8e2020211abf604a" title="Requests a channel.">ast_request</a>(<a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>, <a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>, &amp;cause);
<a name="l03865"></a>03865    <span class="keywordflow">if</span> (!chan) {
<a name="l03866"></a>03866       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Unable to request channel %s/%s\n&quot;</span>, <a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, (<span class="keywordtype">char</span> *)<a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>);
<a name="l03867"></a>03867       <a class="code" href="channel_8c.html#a1d6e6458df4bfcb132a6934bafdb7fcc">handle_cause</a>(cause, outstate);
<a name="l03868"></a>03868       <span class="keywordflow">return</span> NULL;
<a name="l03869"></a>03869    }
<a name="l03870"></a>03870 
<a name="l03871"></a>03871    <span class="keywordflow">if</span> (oh) {
<a name="l03872"></a>03872       <span class="keywordflow">if</span> (oh-&gt;<a class="code" href="structoutgoing__helper.html#a134fe67053d035e763d6cf99916c1bf8">vars</a>)  
<a name="l03873"></a>03873          <a class="code" href="channel_8h.html#a5b14bfe21364dd8f73d45f15cf313524" title="adds a list of channel variables to a channel">ast_set_variables</a>(chan, oh-&gt;<a class="code" href="structoutgoing__helper.html#a134fe67053d035e763d6cf99916c1bf8">vars</a>);
<a name="l03874"></a>03874       <span class="comment">/* XXX why is this necessary, for the parent_channel perhaps ? */</span>
<a name="l03875"></a>03875       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(oh-&gt;<a class="code" href="structoutgoing__helper.html#a1032774a59971af0f3555668407e7ec7">cid_num</a>) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(oh-&gt;<a class="code" href="structoutgoing__helper.html#a556b8c8508e4a08eb0b212664622306c">cid_name</a>))
<a name="l03876"></a>03876          <a class="code" href="channel_8h.html#a88d833a56ea7de33e230281c5c12b75d" title="Set caller ID number, name and ANI.">ast_set_callerid</a>(chan, oh-&gt;<a class="code" href="structoutgoing__helper.html#a1032774a59971af0f3555668407e7ec7">cid_num</a>, oh-&gt;<a class="code" href="structoutgoing__helper.html#a556b8c8508e4a08eb0b212664622306c">cid_name</a>, oh-&gt;<a class="code" href="structoutgoing__helper.html#a1032774a59971af0f3555668407e7ec7">cid_num</a>);
<a name="l03877"></a>03877       <span class="keywordflow">if</span> (oh-&gt;<a class="code" href="structoutgoing__helper.html#aa4cddc3382d2056a04f09429ea360703">parent_channel</a>) {
<a name="l03878"></a>03878          <a class="code" href="channel_8h.html#a892b6550a4f90b70ad92198c9d05cedc" title="Inherits channel variable from parent to child channel.">ast_channel_inherit_variables</a>(oh-&gt;<a class="code" href="structoutgoing__helper.html#aa4cddc3382d2056a04f09429ea360703">parent_channel</a>, chan);
<a name="l03879"></a>03879          <a class="code" href="channel_8h.html#a6ce892974f59537bda03a71319b452e2" title="Inherit datastores from a parent to a child.">ast_channel_datastore_inherit</a>(oh-&gt;<a class="code" href="structoutgoing__helper.html#aa4cddc3382d2056a04f09429ea360703">parent_channel</a>, chan);
<a name="l03880"></a>03880       }
<a name="l03881"></a>03881       <span class="keywordflow">if</span> (oh-&gt;<a class="code" href="structoutgoing__helper.html#a54735dbbeb30eacadc7e823d15cf03c6">account</a>)
<a name="l03882"></a>03882          <a class="code" href="cdr_8h.html#af6bbc762c1482a5489a761733d785813" title="Set account code, will generate AMI event.">ast_cdr_setaccount</a>(chan, oh-&gt;<a class="code" href="structoutgoing__helper.html#a54735dbbeb30eacadc7e823d15cf03c6">account</a>); 
<a name="l03883"></a>03883    }
<a name="l03884"></a>03884    <a class="code" href="channel_8h.html#a88d833a56ea7de33e230281c5c12b75d" title="Set caller ID number, name and ANI.">ast_set_callerid</a>(chan, <a class="code" href="chan__mgcp_8c.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>, <a class="code" href="chan__mgcp_8c.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>, <a class="code" href="chan__mgcp_8c.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>);
<a name="l03885"></a>03885    <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>, <a class="code" href="cdr_8h.html#aa5bbf08b38c9dc55648f8134be251e1d">AST_CDR_FLAG_ORIGINATED</a>);
<a name="l03886"></a>03886 
<a name="l03887"></a>03887    <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#ae212e5f3ae50a869bbf859fe9db7dee0" title="Make a call.">ast_call</a>(chan, <a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>, 0)) {   <span class="comment">/* ast_call failed... */</span>
<a name="l03888"></a>03888       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Unable to call channel %s/%s\n&quot;</span>, <a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, (<span class="keywordtype">char</span> *)<a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>);
<a name="l03889"></a>03889    } <span class="keywordflow">else</span> {
<a name="l03890"></a>03890       res = 1; <span class="comment">/* mark success in case chan-&gt;_state is already AST_STATE_UP */</span>
<a name="l03891"></a>03891       <span class="keywordflow">while</span> (timeout &amp;&amp; chan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) {
<a name="l03892"></a>03892          <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l03893"></a>03893          res = <a class="code" href="channel_8h.html#a60e0bcaed001e8d5ed1ba0eb2644b3cc" title="Wait for input on a channel.">ast_waitfor</a>(chan, timeout);
<a name="l03894"></a>03894          <span class="keywordflow">if</span> (res == 0) { <span class="comment">/* timeout, treat it like ringing */</span>
<a name="l03895"></a>03895             *outstate = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a>;
<a name="l03896"></a>03896             <span class="keywordflow">break</span>;
<a name="l03897"></a>03897          }
<a name="l03898"></a>03898          <span class="keywordflow">if</span> (res &lt; 0) <span class="comment">/* error or done */</span>
<a name="l03899"></a>03899             <span class="keywordflow">break</span>;
<a name="l03900"></a>03900          <span class="keywordflow">if</span> (timeout &gt; -1)
<a name="l03901"></a>03901             timeout = res;
<a name="l03902"></a>03902          <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(chan-&gt;call_forward)) {
<a name="l03903"></a>03903             <span class="keywordflow">if</span> (!(chan = <a class="code" href="channel_8h.html#a05e7ee16979b176273568bea55d2e87d" title="Forwards a call to a new channel specified by the original channel&amp;#39;s call_forward...">ast_call_forward</a>(NULL, chan, &amp;timeout, <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>, oh, outstate))) {
<a name="l03904"></a>03904                <span class="keywordflow">return</span> NULL;
<a name="l03905"></a>03905             }
<a name="l03906"></a>03906             <span class="keywordflow">continue</span>;
<a name="l03907"></a>03907          }
<a name="l03908"></a>03908 
<a name="l03909"></a>03909          f = <a class="code" href="channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1" title="Reads a frame.">ast_read</a>(chan);
<a name="l03910"></a>03910          <span class="keywordflow">if</span> (!f) {
<a name="l03911"></a>03911             *outstate = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa7dac1c1896ab418c2ff351aae707fba">AST_CONTROL_HANGUP</a>;
<a name="l03912"></a>03912             res = 0;
<a name="l03913"></a>03913             <span class="keywordflow">break</span>;
<a name="l03914"></a>03914          }
<a name="l03915"></a>03915          <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>) {
<a name="l03916"></a>03916             <span class="keywordflow">switch</span> (f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>) {
<a name="l03917"></a>03917             <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a>:  <span class="comment">/* record but keep going */</span>
<a name="l03918"></a>03918                *outstate = f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>;
<a name="l03919"></a>03919                <span class="keywordflow">break</span>;
<a name="l03920"></a>03920 
<a name="l03921"></a>03921             <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875">AST_CONTROL_BUSY</a>:
<a name="l03922"></a>03922             <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a850bb06a1702741c93a3fd67cc9637ab">AST_CONTROL_CONGESTION</a>:
<a name="l03923"></a>03923             <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>:
<a name="l03924"></a>03924                *outstate = f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>;
<a name="l03925"></a>03925                timeout = 0;      <span class="comment">/* trick to force exit from the while() */</span>
<a name="l03926"></a>03926                <span class="keywordflow">break</span>;
<a name="l03927"></a>03927 
<a name="l03928"></a>03928             <span class="comment">/* Ignore these */</span>
<a name="l03929"></a>03929             <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a1a461c5e737ed6ed7c8cb0f78557a6fd">AST_CONTROL_PROGRESS</a>:
<a name="l03930"></a>03930             <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a50b7fe33bba67b74dd7b746539e81000">AST_CONTROL_PROCEEDING</a>:
<a name="l03931"></a>03931             <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ab99a3d1c08c5ae8bca078c7cd1ec02f5">AST_CONTROL_HOLD</a>:
<a name="l03932"></a>03932             <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>:
<a name="l03933"></a>03933             <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a417bc8ac5817cc1525a3b530abfc1528">AST_CONTROL_VIDUPDATE</a>:
<a name="l03934"></a>03934             <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a009e81151b19671f42b5e84ab6a619f4">AST_CONTROL_SRCUPDATE</a>:
<a name="l03935"></a>03935             <span class="keywordflow">case</span> -1:       <span class="comment">/* Ignore -- just stopping indications */</span>
<a name="l03936"></a>03936                <span class="keywordflow">break</span>;
<a name="l03937"></a>03937 
<a name="l03938"></a>03938             <span class="keywordflow">default</span>:
<a name="l03939"></a>03939                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Don&apos;t know what to do with control frame %d\n&quot;</span>, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>);
<a name="l03940"></a>03940             }
<a name="l03941"></a>03941             last_subclass = f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>;
<a name="l03942"></a>03942          }
<a name="l03943"></a>03943          <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l03944"></a>03944       }
<a name="l03945"></a>03945    }
<a name="l03946"></a>03946 
<a name="l03947"></a>03947    <span class="comment">/* Final fixups */</span>
<a name="l03948"></a>03948    <span class="keywordflow">if</span> (oh) {
<a name="l03949"></a>03949       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(oh-&gt;<a class="code" href="structoutgoing__helper.html#a94f090d1fb5c71712726fcdf025b9ace">context</a>))
<a name="l03950"></a>03950          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, oh-&gt;<a class="code" href="structoutgoing__helper.html#a94f090d1fb5c71712726fcdf025b9ace">context</a>, <span class="keyword">sizeof</span>(chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>));
<a name="l03951"></a>03951       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(oh-&gt;<a class="code" href="structoutgoing__helper.html#a762fadb5a38f004f5f4adf71176448e9">exten</a>))
<a name="l03952"></a>03952          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(chan-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, oh-&gt;<a class="code" href="structoutgoing__helper.html#a762fadb5a38f004f5f4adf71176448e9">exten</a>, <span class="keyword">sizeof</span>(chan-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>));
<a name="l03953"></a>03953       <span class="keywordflow">if</span> (oh-&gt;<a class="code" href="structoutgoing__helper.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>) 
<a name="l03954"></a>03954          chan-&gt;<a class="code" href="structast__channel.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> = oh-&gt;<a class="code" href="structoutgoing__helper.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>;
<a name="l03955"></a>03955    }
<a name="l03956"></a>03956    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>)
<a name="l03957"></a>03957       *outstate = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>;
<a name="l03958"></a>03958 
<a name="l03959"></a>03959    <span class="keywordflow">if</span> (res &lt;= 0) {
<a name="l03960"></a>03960       <span class="keywordflow">if</span> ( <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a> == last_subclass ) 
<a name="l03961"></a>03961          chan-&gt;<a class="code" href="structast__channel.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a> = <a class="code" href="causes_8h.html#af03fc9fe2f0ecc69330e014aff8d0f73">AST_CAUSE_NO_ANSWER</a>;
<a name="l03962"></a>03962       <span class="keywordflow">if</span> (!chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a> &amp;&amp; (chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a> = <a class="code" href="cdr_8h.html#a29ba08b358224b4c820e5df826273b5b" title="Allocate a CDR record.">ast_cdr_alloc</a>()))
<a name="l03963"></a>03963          <a class="code" href="cdr_8h.html#a551fbacb2f2b4caaf57243c601c28a83" title="Initialize based on a channel.">ast_cdr_init</a>(chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>, chan);
<a name="l03964"></a>03964       <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>) {
<a name="l03965"></a>03965          <span class="keywordtype">char</span> tmp[256];
<a name="l03966"></a>03966          snprintf(tmp, <span class="keyword">sizeof</span>(tmp), <span class="stringliteral">&quot;%s/%s&quot;</span>, <a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, (<span class="keywordtype">char</span> *)<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>);
<a name="l03967"></a>03967          <a class="code" href="cdr_8h.html#a877162d212a320e7daec6aa7f695e9a8" title="Set the last executed application.">ast_cdr_setapp</a>(chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>,<span class="stringliteral">&quot;Dial&quot;</span>,tmp);
<a name="l03968"></a>03968          <a class="code" href="cdr_8h.html#a92b2e3b685887b48d228f7546ae1a9f1">ast_cdr_update</a>(chan);
<a name="l03969"></a>03969          <a class="code" href="cdr_8h.html#af788ef701483a64b77656f272843bcd4" title="Start a call.">ast_cdr_start</a>(chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>);
<a name="l03970"></a>03970          <a class="code" href="cdr_8h.html#a9884cbdaef20e9f266bc2220772bf52b" title="End a call.">ast_cdr_end</a>(chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>);
<a name="l03971"></a>03971          <span class="comment">/* If the cause wasn&apos;t handled properly */</span>
<a name="l03972"></a>03972          <span class="keywordflow">if</span> (<a class="code" href="cdr_8h.html#a5468ad8b7a45f1f976728be1b23dde47" title="Save the result of the call based on the AST_CAUSE_*.">ast_cdr_disposition</a>(chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>,chan-&gt;<a class="code" href="structast__channel.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a>))
<a name="l03973"></a>03973             <a class="code" href="cdr_8h.html#acdce2d9d0af5180090b70149ce18e554" title="Fail a call.">ast_cdr_failed</a>(chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>);
<a name="l03974"></a>03974       }
<a name="l03975"></a>03975       <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l03976"></a>03976       chan = NULL;
<a name="l03977"></a>03977    }
<a name="l03978"></a>03978    <span class="keywordflow">return</span> chan;
<a name="l03979"></a>03979 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4dc5afc784da719a0f626ec53d86d2cc"></a><!-- doxytag: member="channel.c::__init_state2str_threadbuf" ref="a4dc5afc784da719a0f626ec53d86d2cc" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void __init_state2str_threadbuf </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l00088">88</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00103"></a>00103 {
</pre></div></p>

</div>
</div>
<a class="anchor" id="a12a58dda74a19f383f6b77cf7fa88b54"></a><!-- doxytag: member="channel.c::ast_activate_generator" ref="a12a58dda74a19f383f6b77cf7fa88b54" args="(struct ast_channel *chan, struct ast_generator *gen, void *params)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_activate_generator </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__generator.html">ast_generator</a> *&nbsp;</td>
          <td class="paramname"> <em>gen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>params</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Activate a given generator </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l02001">2001</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="structast__generator.html#a4cdb1ccb0ee9d0a97af1862c625e6bc8">ast_generator::alloc</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="channel_8c_source.html#l03383">ast_prod()</a>, <a class="el" href="channel_8c_source.html#l02405">ast_settimeout()</a>, <a class="el" href="channel_8h_source.html#l00404">ast_channel::generator</a>, <a class="el" href="channel_8c_source.html#l01971">generator_force()</a>, <a class="el" href="channel_8h_source.html#l00403">ast_channel::generatordata</a>, and <a class="el" href="structast__generator.html#af1e67c15ec62c02506efc4f2f305bbe0">ast_generator::release</a>.</p>

<p>Referenced by <a class="el" href="app__externalivr_8c_source.html#l00314">app_exec()</a>, <a class="el" href="channel_8c_source.html#l05640">ast_channel_start_silence_generator()</a>, <a class="el" href="app_8c_source.html#l00466">ast_linear_stream()</a>, <a class="el" href="indications_8c_source.html#l00301">ast_playtones_start()</a>, <a class="el" href="channel_8c_source.html#l05449">ast_tonepair_start()</a>, <a class="el" href="app__chanspy_8c_source.html#l00445">channel_spy()</a>, <a class="el" href="app__externalivr_8c_source.html#l00521">eivr_comm()</a>, <a class="el" href="res__musiconhold_8c_source.html#l01223">local_ast_moh_start()</a>, <a class="el" href="app__milliwatt_8c_source.html#l00121">old_milliwatt_exec()</a>, and <a class="el" href="app__fax_8c_source.html#l00362">transmit_audio()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02002"></a>02002 {
<a name="l02003"></a>02003    <span class="keywordtype">int</span> res = 0;
<a name="l02004"></a>02004 
<a name="l02005"></a>02005    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l02006"></a>02006 
<a name="l02007"></a>02007    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#abe7876f86e249ea3db5fbacd2231389c">generatordata</a>) {
<a name="l02008"></a>02008       <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a4e855ab0f984741b9083b2c5a0fdfe18">generator</a> &amp;&amp; chan-&gt;<a class="code" href="structast__channel.html#a4e855ab0f984741b9083b2c5a0fdfe18">generator</a>-&gt;<a class="code" href="structast__generator.html#af1e67c15ec62c02506efc4f2f305bbe0">release</a>)
<a name="l02009"></a>02009          chan-&gt;<a class="code" href="structast__channel.html#a4e855ab0f984741b9083b2c5a0fdfe18">generator</a>-&gt;<a class="code" href="structast__generator.html#af1e67c15ec62c02506efc4f2f305bbe0">release</a>(chan, chan-&gt;<a class="code" href="structast__channel.html#abe7876f86e249ea3db5fbacd2231389c">generatordata</a>);
<a name="l02010"></a>02010       chan-&gt;<a class="code" href="structast__channel.html#abe7876f86e249ea3db5fbacd2231389c">generatordata</a> = NULL;
<a name="l02011"></a>02011    }
<a name="l02012"></a>02012 
<a name="l02013"></a>02013    <a class="code" href="channel_8h.html#a2458f1412e300412e53d86fe94e19002" title="Send empty audio to prime a channel driver.">ast_prod</a>(chan);
<a name="l02014"></a>02014    <span class="keywordflow">if</span> (gen-&gt;<a class="code" href="structast__generator.html#a4cdb1ccb0ee9d0a97af1862c625e6bc8">alloc</a> &amp;&amp; !(chan-&gt;<a class="code" href="structast__channel.html#abe7876f86e249ea3db5fbacd2231389c">generatordata</a> = gen-&gt;<a class="code" href="structast__generator.html#a4cdb1ccb0ee9d0a97af1862c625e6bc8">alloc</a>(chan, params))) {
<a name="l02015"></a>02015       res = -1;
<a name="l02016"></a>02016    }
<a name="l02017"></a>02017    
<a name="l02018"></a>02018    <span class="keywordflow">if</span> (!res) {
<a name="l02019"></a>02019       <a class="code" href="channel_8h.html#abb39926813ff8874f8e453ca04307e53" title="Enable or disable timer ticks for a channel.">ast_settimeout</a>(chan, 50, <a class="code" href="channel_8c.html#a99698cbdfd9c1a86f36e0a226076e69f">generator_force</a>, chan);
<a name="l02020"></a>02020       chan-&gt;<a class="code" href="structast__channel.html#a4e855ab0f984741b9083b2c5a0fdfe18">generator</a> = gen;
<a name="l02021"></a>02021    }
<a name="l02022"></a>02022 
<a name="l02023"></a>02023    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l02024"></a>02024 
<a name="l02025"></a>02025    <span class="keywordflow">return</span> res;
<a name="l02026"></a>02026 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9704ae96ab849e9e5a20040c13d29705"></a><!-- doxytag: member="channel.c::ast_active_channels" ref="a9704ae96ab849e9e5a20040c13d29705" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_active_channels </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>returns <a class="el" href="structnumber.html" title="Number structure.">number</a> of active/allocated <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> </p>
<p>Returns <a class="el" href="structnumber.html" title="Number structure.">number</a> of active/allocated <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l00497">497</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00077">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, and <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>.</p>

<p>Referenced by <a class="el" href="manager_8c_source.html#l02755">action_corestatus()</a>, <a class="el" href="agent_8c_source.html#l00212">ast_var_channels()</a>, <a class="el" href="agent_8c_source.html#l00228">ast_var_channels_table()</a>, <a class="el" href="chan__dahdi_8c_source.html#l14338">dahdi_restart()</a>, <a class="el" href="asterisk_8c_source.html#l00413">handle_show_settings()</a>, and <a class="el" href="asterisk_8c_source.html#l01549">quit_handler()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00498"></a>00498 {
<a name="l00499"></a>00499    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c;
<a name="l00500"></a>00500    <span class="keywordtype">int</span> cnt = 0;
<a name="l00501"></a>00501    <a class="code" href="linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc" title="Read locks a list.">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>);
<a name="l00502"></a>00502    <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>, c, <a class="code" href="structchan__list.html" title="Channel call record structure.">chan_list</a>)
<a name="l00503"></a>00503       cnt++;
<a name="l00504"></a>00504    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>);
<a name="l00505"></a>00505    return cnt;
<a name="l00506"></a>00506 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aec583a3e25358ee552a4f3df53914cd0"></a><!-- doxytag: member="channel.c::ast_answer" ref="aec583a3e25358ee552a4f3df53914cd0" args="(struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_answer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Answer a channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel to answer</td></tr>
  </table>
  </dd>
</dl>
<p>This function answers a channel and handles all necessary call setup functions.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>The channel passed does not need to be locked, but is locked by the function when needed.</dd>
<dd>
This function will wait up to 500 milliseconds for media to arrive on the channel before returning to the caller, so that the caller can properly assume the channel is 'ready' for media flow.</dd></dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>non-zero</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01951">1951</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l01850">__ast_answer()</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l04156">action_bridge()</a>, <a class="el" href="res__agi_8c_source.html#l03212">agi_exec_full()</a>, <a class="el" href="app__alarmreceiver_8c_source.html#l00567">alarmreceiver_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l04667">answer_trunk_chan()</a>, <a class="el" href="app__externalivr_8c_source.html#l00314">app_exec()</a>, <a class="el" href="app_8c_source.html#l00496">ast_control_streamfile()</a>, <a class="el" href="features_8c_source.html#l04475">ast_pickup_call()</a>, <a class="el" href="app__authenticate_8c_source.html#l00108">auth_exec()</a>, <a class="el" href="app__talkdetect_8c_source.html#l00076">background_detect_exec()</a>, <a class="el" href="features_8c_source.html#l04524">bridge_exec()</a>, <a class="el" href="features_8c_source.html#l00942">builtin_parkcall()</a>, <a class="el" href="app__chanspy_8c_source.html#l00767">common_exec()</a>, <a class="el" href="app__dahdibarge_8c_source.html#l00261">conf_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l03650">count_exec()</a>, <a class="el" href="app__dahdiras_8c_source.html#l00190">dahdiras_exec()</a>, <a class="el" href="app__dictate_8c_source.html#l00084">dictate_exec()</a>, <a class="el" href="app__directory_8c_source.html#l00723">directory_exec()</a>, <a class="el" href="app__disa_8c_source.html#l00143">disa_exec()</a>, <a class="el" href="app__externalivr_8c_source.html#l00521">eivr_comm()</a>, <a class="el" href="res__agi_8c_source.html#l01023">handle_answer()</a>, <a class="el" href="app__ices_8c_source.html#l00107">ices_exec()</a>, <a class="el" href="chan__agent_8c_source.html#l01981">login_exec()</a>, <a class="el" href="app__minivm_8c_source.html#l02195">minivm_accmess_exec()</a>, <a class="el" href="app__minivm_8c_source.html#l01971">minivm_greet_exec()</a>, <a class="el" href="app__minivm_8c_source.html#l01915">minivm_record_exec()</a>, <a class="el" href="app__milliwatt_8c_source.html#l00121">old_milliwatt_exec()</a>, <a class="el" href="features_8c_source.html#l03249">park_call_exec()</a>, <a class="el" href="features_8c_source.html#l03335">park_exec_full()</a>, <a class="el" href="pbx_8c_source.html#l08798">pbx_builtin_background()</a>, <a class="el" href="app__directed__pickup_8c_source.html#l00091">pickup_do()</a>, <a class="el" href="app__playback_8c_source.html#l00418">playback_exec()</a>, <a class="el" href="app__privacy_8c_source.html#l00083">privacy_exec()</a>, <a class="el" href="app__read_8c_source.html#l00127">read_exec()</a>, <a class="el" href="app__readexten_8c_source.html#l00128">readexten_exec()</a>, <a class="el" href="app__record_8c_source.html#l00132">record_exec()</a>, <a class="el" href="app__rpt_8c_source.html#l13122">rpt_exec()</a>, <a class="el" href="app__sayunixtime_8c_source.html#l00092">sayunixtime_exec()</a>, <a class="el" href="app__festival_8c_source.html#l00161">send_waveform_to_channel()</a>, <a class="el" href="app__dial_8c_source.html#l01385">setup_privacy_args()</a>, <a class="el" href="app__ivrdemo_8c_source.html#l00097">skel_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l05601">sla_station_exec()</a>, <a class="el" href="app__speech__utils_8c_source.html#l00639">speech_background()</a>, <a class="el" href="app__test_8c_source.html#l00146">testclient_exec()</a>, <a class="el" href="app__test_8c_source.html#l00320">testserver_exec()</a>, <a class="el" href="app__fax_8c_source.html#l00772">transmit()</a>, <a class="el" href="app__voicemail_8c_source.html#l09810">vm_exec()</a>, <a class="el" href="app__voicemail_8c_source.html#l09099">vm_execmain()</a>, <a class="el" href="app__waitforsilence_8c_source.html#l00205">waitfor_exec()</a>, and <a class="el" href="app__zapateller_8c_source.html#l00077">zapateller_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01952"></a>01952 {
<a name="l01953"></a>01953    <span class="keywordflow">return</span> <a class="code" href="channel_8h.html#a5457ba5b9d85a5167027716d84449f1f" title="Answer a channel, with a selectable delay before returning.">__ast_answer</a>(chan, 0, 1);
<a name="l01954"></a>01954 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abfff88810f1ead9e04b3e826265db91b"></a><!-- doxytag: member="channel.c::ast_begin_shutdown" ref="abfff88810f1ead9e04b3e826265db91b" args="(int hangup)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_begin_shutdown </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>hangup</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initiate system shutdown. </p>
<p>Initiate system shutdown -- prevents new <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> from being allocated. If "hangup" is non-zero, all existing <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> will receive soft hangups </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l00483">483</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00077">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="channel_8c_source.html#l01666">ast_softhangup()</a>, and <a class="el" href="channel_8h_source.html#l00636">AST_SOFTHANGUP_SHUTDOWN</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l01549">quit_handler()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00484"></a>00484 {
<a name="l00485"></a>00485    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c;
<a name="l00486"></a>00486    <a class="code" href="channel_8c.html#a7f68568851b9c7f9291f7bb63f932c18" title="Prevent new channel allocation if shutting down.">shutting_down</a> = 1;
<a name="l00487"></a>00487    <span class="keywordflow">if</span> (hangup) {
<a name="l00488"></a>00488       <a class="code" href="linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc" title="Read locks a list.">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>);
<a name="l00489"></a>00489       <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>, c, <a class="code" href="structchan__list.html" title="Channel call record structure.">chan_list</a>) {
<a name="l00490"></a>00490          <a class="code" href="channel_8h.html#ac2d6607253f7e8b272d4e845474eaa9b" title="Softly hangup up a channel.">ast_softhangup</a>(c, <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709ac8ccf95208e43ea045531ab97697b58a">AST_SOFTHANGUP_SHUTDOWN</a>);
<a name="l00491"></a>00491       }
<a name="l00492"></a>00492       <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>);
<a name="l00493"></a>00493    }
<a name="l00494"></a>00494 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4d78194779a26341c3ec7298b450b9ed"></a><!-- doxytag: member="channel.c::ast_best_codec" ref="a4d78194779a26341c3ec7298b450b9ed" args="(int fmts)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_best_codec </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fmts</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Pick the best audio codec. </p>
<p>Pick the best codec </p>

<p><p>Okay, ulaw is used by all telephony equipment, so start with it</p>
<p>Unless of course, you're a silly European, so then prefer ALAW</p>
<p>G.722 is better then all below, but not as common as the above... so give ulaw and alaw priority</p>
<p>Okay, well, signed linear is easy to translate into other stuff</p>
<p>G.726 is standard ADPCM, in RFC3551 packing order</p>
<p>G.726 is standard ADPCM, in AAL2 packing order</p>
<p>ADPCM has great <a class="el" href="structsound.html">sound</a> quality and is still pretty easy to translate</p>
<p>Okay, we're down to vocoders now, so pick GSM because it's small and easier to translate and sounds pretty good</p>
<p>iLBC is not too bad</p>
<p>Speex is free, but computationally more expensive than GSM</p>
<p>Ick, LPC10 sounds terrible, but at least we have code for it, if you're tacky enough to use it</p>
<p>G.729a is faster than 723 and slightly less expensive</p>
<p>Down to G.723.1 which is proprietary but at least designed for voice </p>
</p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l00711">711</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="frame_8h_source.html#l00251">AST_FORMAT_ADPCM</a>, <a class="el" href="frame_8h_source.html#l00247">AST_FORMAT_ALAW</a>, <a class="el" href="frame_8h_source.html#l00273">AST_FORMAT_AUDIO_MASK</a>, <a class="el" href="frame_8h_source.html#l00265">AST_FORMAT_G722</a>, <a class="el" href="frame_8h_source.html#l00241">AST_FORMAT_G723_1</a>, <a class="el" href="frame_8h_source.html#l00263">AST_FORMAT_G726</a>, <a class="el" href="frame_8h_source.html#l00249">AST_FORMAT_G726_AAL2</a>, <a class="el" href="frame_8h_source.html#l00257">AST_FORMAT_G729A</a>, <a class="el" href="frame_8h_source.html#l00243">AST_FORMAT_GSM</a>, <a class="el" href="frame_8h_source.html#l00261">AST_FORMAT_ILBC</a>, <a class="el" href="frame_8h_source.html#l00255">AST_FORMAT_LPC10</a>, <a class="el" href="frame_8h_source.html#l00269">AST_FORMAT_SIREN14</a>, <a class="el" href="frame_8h_source.html#l00267">AST_FORMAT_SIREN7</a>, <a class="el" href="frame_8h_source.html#l00253">AST_FORMAT_SLINEAR</a>, <a class="el" href="frame_8h_source.html#l00271">AST_FORMAT_SLINEAR16</a>, <a class="el" href="frame_8h_source.html#l00259">AST_FORMAT_SPEEX</a>, <a class="el" href="frame_8h_source.html#l00245">AST_FORMAT_ULAW</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="chan__iax2_8c_source.html#l00209">prefs</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l00999">__oh323_new()</a>, <a class="el" href="chan__agent_8c_source.html#l00770">agent_call()</a>, <a class="el" href="frame_8c_source.html#l01211">ast_codec_choose()</a>, <a class="el" href="chan__iax2_8c_source.html#l05415">ast_iax2_new()</a>, <a class="el" href="res__speech_8c_source.html#l00172">ast_speech_new()</a>, <a class="el" href="bridging_8c_source.html#l00538">bridge_make_compatible()</a>, <a class="el" href="features_8c_source.html#l01396">builtin_atxfer()</a>, <a class="el" href="app__echo_8c_source.html#l00051">echo_exec()</a>, <a class="el" href="app__followme_8c_source.html#l00777">findmeexec()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00989">gtalk_new()</a>, <a class="el" href="chan__skinny_8c_source.html#l05511">handle_open_receive_channel_ack_message()</a>, <a class="el" href="chan__iax2_8c_source.html#l11561">iax2_request()</a>, <a class="el" href="chan__jingle_8c_source.html#l00800">jingle_new()</a>, <a class="el" href="chan__local_8c_source.html#l00734">local_new()</a>, <a class="el" href="chan__agent_8c_source.html#l01981">login_exec()</a>, <a class="el" href="chan__mgcp_8c_source.html#l01470">mgcp_new()</a>, <a class="el" href="chan__sip_8c_source.html#l06599">sip_new()</a>, <a class="el" href="chan__skinny_8c_source.html#l04268">skinny_new()</a>, <a class="el" href="chan__skinny_8c_source.html#l02609">skinny_set_rtp_peer()</a>, <a class="el" href="chan__iax2_8c_source.html#l09458">socket_process()</a>, <a class="el" href="chan__unistim_8c_source.html#l02028">start_rtp()</a>, <a class="el" href="chan__skinny_8c_source.html#l02139">transmit_connect()</a>, and <a class="el" href="chan__unistim_8c_source.html#l04422">unistim_new()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00712"></a>00712 {
<a name="l00713"></a>00713    <span class="comment">/* This just our opinion, expressed in code.  We are asked to choose</span>
<a name="l00714"></a>00714 <span class="comment">      the best codec to use, given no information */</span>
<a name="l00715"></a>00715    <span class="keywordtype">int</span> x;
<a name="l00716"></a>00716    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="chan__iax2_8c.html#a46262e3cc2baf55a72542567ccfe86d9">prefs</a>[] =
<a name="l00717"></a>00717    {<span class="comment"></span>
<a name="l00718"></a>00718 <span class="comment">      /*! Okay, ulaw is used by all telephony equipment, so start with it */</span>
<a name="l00719"></a>00719       <a class="code" href="frame_8h.html#ab602cf455d4a96a3adba2e3ba8cd2b2c">AST_FORMAT_ULAW</a>,<span class="comment"></span>
<a name="l00720"></a>00720 <span class="comment">      /*! Unless of course, you&apos;re a silly European, so then prefer ALAW */</span>
<a name="l00721"></a>00721       <a class="code" href="frame_8h.html#aa58cc980a9c9108522effc64e9aff2d6">AST_FORMAT_ALAW</a>,
<a name="l00722"></a>00722       <a class="code" href="frame_8h.html#a590224283a5c1527fab938e4d02686cc">AST_FORMAT_SIREN14</a>,
<a name="l00723"></a>00723       <a class="code" href="frame_8h.html#a13092663dddb1492d81571f9f0ae4506">AST_FORMAT_SIREN7</a>,<span class="comment"></span>
<a name="l00724"></a>00724 <span class="comment">      /*! G.722 is better then all below, but not as common as the above... so give ulaw and alaw priority */</span>
<a name="l00725"></a>00725       <a class="code" href="frame_8h.html#a4a0e8720928940d26abf28fff2e6586d">AST_FORMAT_G722</a>,<span class="comment"></span>
<a name="l00726"></a>00726 <span class="comment">      /*! Okay, well, signed linear is easy to translate into other stuff */</span>
<a name="l00727"></a>00727       <a class="code" href="frame_8h.html#a6e078550fcf3f2038f6c343b3d65a936">AST_FORMAT_SLINEAR16</a>,
<a name="l00728"></a>00728       <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>,<span class="comment"></span>
<a name="l00729"></a>00729 <span class="comment">      /*! G.726 is standard ADPCM, in RFC3551 packing order */</span>
<a name="l00730"></a>00730       <a class="code" href="frame_8h.html#a030c77081bc2aff5ae5a384769f46418">AST_FORMAT_G726</a>,<span class="comment"></span>
<a name="l00731"></a>00731 <span class="comment">      /*! G.726 is standard ADPCM, in AAL2 packing order */</span>
<a name="l00732"></a>00732       <a class="code" href="frame_8h.html#a536fbd427f197a33e679c7721afad420">AST_FORMAT_G726_AAL2</a>,<span class="comment"></span>
<a name="l00733"></a>00733 <span class="comment">      /*! ADPCM has great sound quality and is still pretty easy to translate */</span>
<a name="l00734"></a>00734       <a class="code" href="frame_8h.html#a933964fc376c2642f9471c176fb7ae7d">AST_FORMAT_ADPCM</a>,<span class="comment"></span>
<a name="l00735"></a>00735 <span class="comment">      /*! Okay, we&apos;re down to vocoders now, so pick GSM because it&apos;s small and easier to</span>
<a name="l00736"></a>00736 <span class="comment">          translate and sounds pretty good */</span>
<a name="l00737"></a>00737       <a class="code" href="frame_8h.html#a85106ada66147a674b36f0a55297d29d">AST_FORMAT_GSM</a>,<span class="comment"></span>
<a name="l00738"></a>00738 <span class="comment">      /*! iLBC is not too bad */</span>
<a name="l00739"></a>00739       <a class="code" href="frame_8h.html#a8330d06ea408802c37e9af61a513c6a1">AST_FORMAT_ILBC</a>,<span class="comment"></span>
<a name="l00740"></a>00740 <span class="comment">      /*! Speex is free, but computationally more expensive than GSM */</span>
<a name="l00741"></a>00741       <a class="code" href="frame_8h.html#a1a05dee116bf73c0f1ca8410bdb48c62">AST_FORMAT_SPEEX</a>,<span class="comment"></span>
<a name="l00742"></a>00742 <span class="comment">      /*! Ick, LPC10 sounds terrible, but at least we have code for it, if you&apos;re tacky enough</span>
<a name="l00743"></a>00743 <span class="comment">          to use it */</span>
<a name="l00744"></a>00744       <a class="code" href="frame_8h.html#ac816c6f1fd32b02a6d20af297d96d04f">AST_FORMAT_LPC10</a>,<span class="comment"></span>
<a name="l00745"></a>00745 <span class="comment">      /*! G.729a is faster than 723 and slightly less expensive */</span>
<a name="l00746"></a>00746       <a class="code" href="frame_8h.html#a8c5f13161448f613baaf42dea11f520a">AST_FORMAT_G729A</a>,<span class="comment"></span>
<a name="l00747"></a>00747 <span class="comment">      /*! Down to G.723.1 which is proprietary but at least designed for voice */</span>
<a name="l00748"></a>00748       <a class="code" href="frame_8h.html#ad90b56ed6ada6e4f13224512668e20fb">AST_FORMAT_G723_1</a>,
<a name="l00749"></a>00749    };
<a name="l00750"></a>00750 
<a name="l00751"></a>00751    <span class="comment">/* Strip out video */</span>
<a name="l00752"></a>00752    fmts &amp;= <a class="code" href="frame_8h.html#a3f680b9c15596de927d507a664fd2803">AST_FORMAT_AUDIO_MASK</a>;
<a name="l00753"></a>00753    
<a name="l00754"></a>00754    <span class="comment">/* Find the first preferred codec in the format given */</span>
<a name="l00755"></a>00755    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(prefs); x++) {
<a name="l00756"></a>00756       <span class="keywordflow">if</span> (fmts &amp; prefs[x])
<a name="l00757"></a>00757          <span class="keywordflow">return</span> prefs[x];
<a name="l00758"></a>00758    }
<a name="l00759"></a>00759 
<a name="l00760"></a>00760    <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Don&apos;t know any of 0x%x formats\n&quot;</span>, fmts);
<a name="l00761"></a>00761 
<a name="l00762"></a>00762    <span class="keywordflow">return</span> 0;
<a name="l00763"></a>00763 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3f52a5e35d47d8986ccaa66a86018e3a"></a><!-- doxytag: member="channel.c::ast_bridged_channel" ref="a3f52a5e35d47d8986ccaa66a86018e3a" args="(struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__channel.html">ast_channel</a>* ast_bridged_channel </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find bridged channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Current channel </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l04733">4733</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00405">ast_channel::_bridge</a>, <a class="el" href="structast__channel__tech.html#adce5031cdd8736b1318e59c8d93eca1c">ast_channel_tech::bridged_channel</a>, and <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l06601">__dahdi_exception()</a>, <a class="el" href="chan__skinny_8c_source.html#l03202">_skinny_show_lines()</a>, <a class="el" href="chan__agent_8c_source.html#l01565">action_agents()</a>, <a class="el" href="manager_8c_source.html#l02814">action_coreshowchannels()</a>, <a class="el" href="chan__agent_8c_source.html#l01817">agents_show()</a>, <a class="el" href="chan__agent_8c_source.html#l01895">agents_show_online()</a>, <a class="el" href="features_8c_source.html#l02441">ast_bridge_call()</a>, <a class="el" href="channel_8c_source.html#l04217">ast_channel_masquerade()</a>, <a class="el" href="rtp_8c_source.html#l02835">ast_rtp_set_vars()</a>, <a class="el" href="agent_8c_source.html#l00583">ast_var_channel_bridge()</a>, <a class="el" href="agent_8c_source.html#l00228">ast_var_channels_table()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05502">attempt_transfer()</a>, <a class="el" href="chan__misdn_8c_source.html#l04379">cb_events()</a>, <a class="el" href="app__chanspy_8c_source.html#l00445">channel_spy()</a>, <a class="el" href="chan__local_8c_source.html#l00289">check_bridge()</a>, <a class="el" href="app__chanspy_8c_source.html#l00767">common_exec()</a>, <a class="el" href="chan__oss_8c_source.html#l01153">console_transfer()</a>, <a class="el" href="abstract__jb_8c_source.html#l00445">create_jb()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, <a class="el" href="chan__misdn_8c_source.html#l00683">export_aoc_vars()</a>, <a class="el" href="chan__sip_8c_source.html#l13489">get_refer_info()</a>, <a class="el" href="cli_8c_source.html#l00790">handle_chanlist()</a>, <a class="el" href="chan__mgcp_8c_source.html#l02938">handle_hd_hf()</a>, <a class="el" href="chan__sip_8c_source.html#l19184">handle_invite_replaces()</a>, <a class="el" href="chan__mgcp_8c_source.html#l03020">handle_request()</a>, <a class="el" href="chan__sip_8c_source.html#l21024">handle_request_bye()</a>, <a class="el" href="chan__sip_8c_source.html#l16615">handle_request_info()</a>, <a class="el" href="chan__sip_8c_source.html#l20572">handle_request_refer()</a>, <a class="el" href="cli_8c_source.html#l01268">handle_showchan()</a>, <a class="el" href="chan__skinny_8c_source.html#l05662">handle_soft_key_event_message()</a>, <a class="el" href="chan__skinny_8c_source.html#l04699">handle_stimulus_message()</a>, <a class="el" href="chan__unistim_8c_source.html#l02544">key_call()</a>, <a class="el" href="chan__unistim_8c_source.html#l02652">key_dial_page()</a>, <a class="el" href="chan__sip_8c_source.html#l20405">local_attended_transfer()</a>, <a class="el" href="chan__mgcp_8c_source.html#l00936">mgcp_hangup()</a>, <a class="el" href="chan__mgcp_8c_source.html#l02637">mgcp_ss()</a>, <a class="el" href="chan__misdn_8c_source.html#l04108">misdn_attempt_transfer()</a>, <a class="el" href="app__mixmonitor_8c_source.html#l00280">mixmonitor_thread()</a>, <a class="el" href="features_8c_source.html#l00678">park_call_full()</a>, <a class="el" href="chan__iax2_8c_source.html#l03970">schedule_delivery()</a>, <a class="el" href="chan__sip_8c_source.html#l05956">sip_hangup()</a>, <a class="el" href="chan__sip_8c_source.html#l25305">sip_set_rtp_peer()</a>, <a class="el" href="chan__skinny_8c_source.html#l04102">skinny_transfer()</a>, <a class="el" href="chan__iax2_8c_source.html#l09458">socket_process()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>, <a class="el" href="app__chanspy_8c_source.html#l00409">start_spying()</a>, <a class="el" href="app__mixmonitor_8c_source.html#l00250">startmon()</a>, <a class="el" href="chan__unistim_8c_source.html#l02305">TransferCallStep1()</a>, and <a class="el" href="chan__unistim_8c_source.html#l03709">unistim_hangup()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04734"></a>04734 {
<a name="l04735"></a>04735    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *bridged;
<a name="l04736"></a>04736    bridged = chan-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a>;
<a name="l04737"></a>04737    <span class="keywordflow">if</span> (bridged &amp;&amp; bridged-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#adce5031cdd8736b1318e59c8d93eca1c" title="Find bridged channel.">bridged_channel</a>)
<a name="l04738"></a>04738       bridged = bridged-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#adce5031cdd8736b1318e59c8d93eca1c" title="Find bridged channel.">bridged_channel</a>(chan, bridged);
<a name="l04739"></a>04739    <span class="keywordflow">return</span> bridged;
<a name="l04740"></a>04740 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae212e5f3ae50a869bbf859fe9db7dee0"></a><!-- doxytag: member="channel.c::ast_call" ref="ae212e5f3ae50a869bbf859fe9db7dee0" args="(struct ast_channel *chan, char *addr, int timeout)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_call </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>timeout</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Make a call. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>which channel to make the call on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>addr</em>&nbsp;</td><td>destination of the call </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>timeout</em>&nbsp;</td><td>time to wait on for connect Place a call, take no longer than timeout ms. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns -1 on failure, 0 on not enough time (does not automatically stop ringing), and the <a class="el" href="structnumber.html" title="Number structure.">number</a> of seconds the connect took otherwise. </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l04042">4042</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="cdr_8h_source.html#l00041">AST_CDR_FLAG_DIALED</a>, <a class="el" href="cdr_8h_source.html#l00042">AST_CDR_FLAG_ORIGINATED</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="channel_8c_source.html#l00461">ast_check_hangup()</a>, <a class="el" href="channel_8h_source.html#l00543">AST_FLAG_OUTGOING</a>, <a class="el" href="channel_8h_source.html#l00529">AST_FLAG_ZOMBIE</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="structast__channel__tech.html#ac629f1c15c578ba269d631bc7e9d6823">ast_channel_tech::call</a>, <a class="el" href="channel_8h_source.html#l00422">ast_channel::cdr</a>, and <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l03851">__ast_request_and_dial()</a>, <a class="el" href="chan__agent_8c_source.html#l00770">agent_call()</a>, <a class="el" href="channel_8c_source.html#l03779">ast_call_forward()</a>, <a class="el" href="app__rpt_8c_source.html#l10335">attempt_reconnect()</a>, <a class="el" href="dial_8c_source.html#l00255">begin_dial_channel()</a>, <a class="el" href="app__rpt_8c_source.html#l05678">connect_link()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="bridge__builtin__features_8c_source.html#l00068">dial_transfer()</a>, <a class="el" href="app__dial_8c_source.html#l00712">do_forward()</a>, <a class="el" href="features_8c_source.html#l02152">feature_request_and_dial()</a>, <a class="el" href="app__followme_8c_source.html#l00777">findmeexec()</a>, <a class="el" href="app__confbridge_8c_source.html#l00554">play_sound_file()</a>, <a class="el" href="app__queue_8c_source.html#l02467">ring_entry()</a>, <a class="el" href="app__rpt_8c_source.html#l10730">rpt()</a>, <a class="el" href="app__rpt_8c_source.html#l13122">rpt_exec()</a>, and <a class="el" href="app__queue_8c_source.html#l02845">wait_for_answer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04043"></a>04043 {
<a name="l04044"></a>04044    <span class="comment">/* Place an outgoing call, but don&apos;t wait any longer than timeout ms before returning.</span>
<a name="l04045"></a>04045 <span class="comment">      If the remote end does not answer within the timeout, then do NOT hang up, but</span>
<a name="l04046"></a>04046 <span class="comment">      return anyway.  */</span>
<a name="l04047"></a>04047    <span class="keywordtype">int</span> res = -1;
<a name="l04048"></a>04048    <span class="comment">/* Stop if we&apos;re a zombie or need a soft hangup */</span>
<a name="l04049"></a>04049    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l04050"></a>04050    <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a26796fa52cc5857446eec8d16a4b718d">AST_FLAG_ZOMBIE</a>) &amp;&amp; !<a class="code" href="channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd" title="Check to see if a channel is needing hang up.">ast_check_hangup</a>(chan)) {
<a name="l04051"></a>04051       <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>) {
<a name="l04052"></a>04052          <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>, <a class="code" href="cdr_8h.html#ad4e369ddb958ec8d383da42ff9e5fd72">AST_CDR_FLAG_DIALED</a>);
<a name="l04053"></a>04053          <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>, <a class="code" href="cdr_8h.html#aa5bbf08b38c9dc55648f8134be251e1d">AST_CDR_FLAG_ORIGINATED</a>);
<a name="l04054"></a>04054       }
<a name="l04055"></a>04055       <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#ac629f1c15c578ba269d631bc7e9d6823" title="Call a given phone number (address, etc), but don&amp;#39;t take longer than timeout...">call</a>)
<a name="l04056"></a>04056          res = chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#ac629f1c15c578ba269d631bc7e9d6823" title="Call a given phone number (address, etc), but don&amp;#39;t take longer than timeout...">call</a>(chan, addr, timeout);
<a name="l04057"></a>04057       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a36fa77a64746637c77c6b18a7999d0a2">AST_FLAG_OUTGOING</a>);
<a name="l04058"></a>04058    }
<a name="l04059"></a>04059    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l04060"></a>04060    <span class="keywordflow">return</span> res;
<a name="l04061"></a>04061 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a05e7ee16979b176273568bea55d2e87d"></a><!-- doxytag: member="channel.c::ast_call_forward" ref="a05e7ee16979b176273568bea55d2e87d" args="(struct ast_channel *caller, struct ast_channel *orig, int *timeout, int format, struct outgoing_helper *oh, int *outstate)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__channel.html">ast_channel</a>* ast_call_forward </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>caller</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>orig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>timeout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structoutgoing__helper.html">outgoing_helper</a> *&nbsp;</td>
          <td class="paramname"> <em>oh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>outstate</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Forwards a call to a new channel specified by the original channel's call_forward str. If possible, the new forwarded channel is created and returned while the original one is terminated. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>caller</em>&nbsp;</td><td>in channel that requested orig </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>orig</em>&nbsp;</td><td>channel being replaced by the call forward channel </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>timeout</em>&nbsp;</td><td>maximum amount of time to wait for setup of new forward channel </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>format</em>&nbsp;</td><td>requested channel format </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>oh</em>&nbsp;</td><td><a class="el" href="structoutgoing.html">outgoing</a> helper used with original channel </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>outstate</em>&nbsp;</td><td>reason why unsuccessful (if uncuccessful) </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns the forwarded call's <a class="el" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> on success or NULL on failure </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l03779">3779</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00619">outgoing_helper::account</a>, <a class="el" href="chan__iax2_8c_source.html#l00328">accountcode</a>, <a class="el" href="channel_8c_source.html#l04042">ast_call()</a>, <a class="el" href="cdr_8h_source.html#l00042">AST_CDR_FLAG_ORIGINATED</a>, <a class="el" href="cdr_8c_source.html#l00936">ast_cdr_setaccount()</a>, <a class="el" href="channel_8c_source.html#l01517">ast_channel_datastore_inherit()</a>, <a class="el" href="channel_8c_source.html#l04302">ast_channel_inherit_variables()</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02037">ast_channel_trylock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="utils_8h_source.html#l00082">ast_copy_flags</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="channel_8c_source.html#l01690">ast_hangup()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8c_source.html#l03986">ast_request()</a>, <a class="el" href="channel_8c_source.html#l04670">ast_set_callerid()</a>, <a class="el" href="channel_8c_source.html#l05592">ast_set_variables()</a>, <a class="el" href="stringfields_8h_source.html#l00285">ast_string_field_set</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="channel_8c_source.html#l00136">cause</a>, <a class="el" href="channel_8h_source.html#l00422">ast_channel::cdr</a>, <a class="el" href="lock_8h_source.html#l01671">CHANNEL_DEADLOCK_AVOIDANCE</a>, <a class="el" href="channel_8h_source.html#l00444">ast_channel::cid</a>, <a class="el" href="channel_8h_source.html#l00204">ast_callerid::cid_name</a>, <a class="el" href="channel_8h_source.html#l00618">outgoing_helper::cid_name</a>, <a class="el" href="channel_8h_source.html#l00203">ast_callerid::cid_num</a>, <a class="el" href="channel_8h_source.html#l00617">outgoing_helper::cid_num</a>, <a class="el" href="channel_8h_source.html#l00503">ast_channel::context</a>, <a class="el" href="channel_8c_source.html#l03766">handle_cause()</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="channel_8h_source.html#l00621">outgoing_helper::parent_channel</a>, <a class="el" href="pbx_8c_source.html#l08951">pbx_builtin_getvar_helper()</a>, <a class="el" href="strings_8h_source.html#l00072">S_OR</a>, <a class="el" href="evt_8c_source.html#l00071">type</a>, and <a class="el" href="channel_8h_source.html#l00620">outgoing_helper::vars</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l03851">__ast_request_and_dial()</a>, and <a class="el" href="features_8c_source.html#l02152">feature_request_and_dial()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03780"></a>03780 {
<a name="l03781"></a>03781    <span class="keywordtype">char</span> tmpchan[256];
<a name="l03782"></a>03782    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<span class="keyword">new</span> = NULL;
<a name="l03783"></a>03783    <span class="keywordtype">char</span> *<a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>, *<a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>;
<a name="l03784"></a>03784    <span class="keywordtype">int</span> <a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a> = 0;
<a name="l03785"></a>03785 
<a name="l03786"></a>03786    <span class="comment">/* gather data and request the new forward channel */</span>
<a name="l03787"></a>03787    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmpchan, orig-&gt;call_forward, <span class="keyword">sizeof</span>(tmpchan));
<a name="l03788"></a>03788    <span class="keywordflow">if</span> ((data = strchr(tmpchan, <span class="charliteral">&apos;/&apos;</span>))) {
<a name="l03789"></a>03789       *data++ = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l03790"></a>03790       type = tmpchan;
<a name="l03791"></a>03791    } <span class="keywordflow">else</span> {
<a name="l03792"></a>03792       <span class="keyword">const</span> <span class="keywordtype">char</span> *forward_context;
<a name="l03793"></a>03793       <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(orig);
<a name="l03794"></a>03794       forward_context = <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(orig, <span class="stringliteral">&quot;FORWARD_CONTEXT&quot;</span>);
<a name="l03795"></a>03795       snprintf(tmpchan, <span class="keyword">sizeof</span>(tmpchan), <span class="stringliteral">&quot;%s@%s&quot;</span>, orig-&gt;call_forward, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(forward_context, orig-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>));
<a name="l03796"></a>03796       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(orig);
<a name="l03797"></a>03797       data = tmpchan;
<a name="l03798"></a>03798       type = <span class="stringliteral">&quot;Local&quot;</span>;
<a name="l03799"></a>03799    }
<a name="l03800"></a>03800    <span class="keywordflow">if</span> (!(<span class="keyword">new</span> = <a class="code" href="channel_8h.html#a922b0c040026477b8e2020211abf604a" title="Requests a channel.">ast_request</a>(type, <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>, data, &amp;cause))) {
<a name="l03801"></a>03801       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Unable to create channel for call forward to &apos;%s/%s&apos; (cause = %d)\n&quot;</span>, type, data, cause);
<a name="l03802"></a>03802       <a class="code" href="channel_8c.html#a1d6e6458df4bfcb132a6934bafdb7fcc">handle_cause</a>(cause, outstate);
<a name="l03803"></a>03803       <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(orig);
<a name="l03804"></a>03804       <span class="keywordflow">return</span> NULL;
<a name="l03805"></a>03805    }
<a name="l03806"></a>03806 
<a name="l03807"></a>03807    <span class="comment">/* Copy/inherit important information into new channel */</span>
<a name="l03808"></a>03808    <span class="keywordflow">if</span> (oh) {
<a name="l03809"></a>03809       <span class="keywordflow">if</span> (oh-&gt;<a class="code" href="structoutgoing__helper.html#a134fe67053d035e763d6cf99916c1bf8">vars</a>) {
<a name="l03810"></a>03810          <a class="code" href="channel_8h.html#a5b14bfe21364dd8f73d45f15cf313524" title="adds a list of channel variables to a channel">ast_set_variables</a>(<span class="keyword">new</span>, oh-&gt;<a class="code" href="structoutgoing__helper.html#a134fe67053d035e763d6cf99916c1bf8">vars</a>);
<a name="l03811"></a>03811       }
<a name="l03812"></a>03812       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(oh-&gt;<a class="code" href="structoutgoing__helper.html#a1032774a59971af0f3555668407e7ec7">cid_num</a>) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(oh-&gt;<a class="code" href="structoutgoing__helper.html#a556b8c8508e4a08eb0b212664622306c">cid_name</a>)) {
<a name="l03813"></a>03813          <a class="code" href="channel_8h.html#a88d833a56ea7de33e230281c5c12b75d" title="Set caller ID number, name and ANI.">ast_set_callerid</a>(<span class="keyword">new</span>, oh-&gt;<a class="code" href="structoutgoing__helper.html#a1032774a59971af0f3555668407e7ec7">cid_num</a>, oh-&gt;<a class="code" href="structoutgoing__helper.html#a556b8c8508e4a08eb0b212664622306c">cid_name</a>, oh-&gt;<a class="code" href="structoutgoing__helper.html#a1032774a59971af0f3555668407e7ec7">cid_num</a>);
<a name="l03814"></a>03814       }
<a name="l03815"></a>03815       <span class="keywordflow">if</span> (oh-&gt;<a class="code" href="structoutgoing__helper.html#aa4cddc3382d2056a04f09429ea360703">parent_channel</a>) {
<a name="l03816"></a>03816          <a class="code" href="channel_8h.html#a892b6550a4f90b70ad92198c9d05cedc" title="Inherits channel variable from parent to child channel.">ast_channel_inherit_variables</a>(oh-&gt;<a class="code" href="structoutgoing__helper.html#aa4cddc3382d2056a04f09429ea360703">parent_channel</a>, <span class="keyword">new</span>);
<a name="l03817"></a>03817          <a class="code" href="channel_8h.html#a6ce892974f59537bda03a71319b452e2" title="Inherit datastores from a parent to a child.">ast_channel_datastore_inherit</a>(oh-&gt;<a class="code" href="structoutgoing__helper.html#aa4cddc3382d2056a04f09429ea360703">parent_channel</a>, <span class="keyword">new</span>);
<a name="l03818"></a>03818       }
<a name="l03819"></a>03819       <span class="keywordflow">if</span> (oh-&gt;<a class="code" href="structoutgoing__helper.html#a54735dbbeb30eacadc7e823d15cf03c6">account</a>) {
<a name="l03820"></a>03820          <a class="code" href="cdr_8h.html#af6bbc762c1482a5489a761733d785813" title="Set account code, will generate AMI event.">ast_cdr_setaccount</a>(<span class="keyword">new</span>, oh-&gt;<a class="code" href="structoutgoing__helper.html#a54735dbbeb30eacadc7e823d15cf03c6">account</a>);
<a name="l03821"></a>03821       }
<a name="l03822"></a>03822    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (caller) { <span class="comment">/* no outgoing helper so use caller if avaliable */</span>
<a name="l03823"></a>03823       <a class="code" href="channel_8h.html#a892b6550a4f90b70ad92198c9d05cedc" title="Inherits channel variable from parent to child channel.">ast_channel_inherit_variables</a>(caller, <span class="keyword">new</span>);
<a name="l03824"></a>03824       <a class="code" href="channel_8h.html#a6ce892974f59537bda03a71319b452e2" title="Inherit datastores from a parent to a child.">ast_channel_datastore_inherit</a>(caller, <span class="keyword">new</span>);
<a name="l03825"></a>03825    }
<a name="l03826"></a>03826 
<a name="l03827"></a>03827    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(orig);
<a name="l03828"></a>03828    <span class="keywordflow">while</span> (<a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(<span class="keyword">new</span>)) {
<a name="l03829"></a>03829       <a class="code" href="lock_8h.html#a7b1d6c8183a6f6f42a98239da3d1c7ca">CHANNEL_DEADLOCK_AVOIDANCE</a>(orig);
<a name="l03830"></a>03830    }
<a name="l03831"></a>03831    <a class="code" href="utils_8h.html#ab9da1c7265610eff83ed6146f104dc6f">ast_copy_flags</a>(new-&gt;cdr, orig-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>, <a class="code" href="cdr_8h.html#aa5bbf08b38c9dc55648f8134be251e1d">AST_CDR_FLAG_ORIGINATED</a>);
<a name="l03832"></a>03832    <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(<span class="keyword">new</span>, <a class="code" href="chan__iax2_8c.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>, orig-&gt;accountcode);
<a name="l03833"></a>03833    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(orig-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(new-&gt;cid.cid_name)) {
<a name="l03834"></a>03834       <a class="code" href="channel_8h.html#a88d833a56ea7de33e230281c5c12b75d" title="Set caller ID number, name and ANI.">ast_set_callerid</a>(<span class="keyword">new</span>, orig-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>, orig-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a>, orig-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>);
<a name="l03835"></a>03835    }
<a name="l03836"></a>03836    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(<span class="keyword">new</span>);
<a name="l03837"></a>03837    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(orig);
<a name="l03838"></a>03838 
<a name="l03839"></a>03839    <span class="comment">/* call new channel */</span>
<a name="l03840"></a>03840    <span class="keywordflow">if</span> ((*timeout = <a class="code" href="channel_8h.html#ae212e5f3ae50a869bbf859fe9db7dee0" title="Make a call.">ast_call</a>(<span class="keyword">new</span>, data, 0))) {
<a name="l03841"></a>03841       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Unable to call forward to channel %s/%s\n&quot;</span>, type, (<span class="keywordtype">char</span> *)data);
<a name="l03842"></a>03842       <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(orig);
<a name="l03843"></a>03843       <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(<span class="keyword">new</span>);
<a name="l03844"></a>03844       <span class="keywordflow">return</span> NULL;
<a name="l03845"></a>03845    }
<a name="l03846"></a>03846    <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(orig);
<a name="l03847"></a>03847 
<a name="l03848"></a>03848    <span class="keywordflow">return</span> <span class="keyword">new</span>;
<a name="l03849"></a>03849 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ace6102c072609981f5c400a2d8e282b7"></a><!-- doxytag: member="channel.c::ast_cancel_shutdown" ref="ace6102c072609981f5c400a2d8e282b7" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_cancel_shutdown </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Cancel a shutdown in <a class="el" href="structprogress.html">progress</a>. </p>
<p>Cancels an existing shutdown and returns to normal operation </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l00509">509</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l01920">handle_abort_shutdown()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00510"></a>00510 {
<a name="l00511"></a>00511    <a class="code" href="channel_8c.html#a7f68568851b9c7f9291f7bb63f932c18" title="Prevent new channel allocation if shutting down.">shutting_down</a> = 0;
<a name="l00512"></a>00512 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6ea5858ffa106c4991e43bed491293d9"></a><!-- doxytag: member="channel.c::ast_cause2str" ref="a6ea5858ffa106c4991e43bed491293d9" args="(int cause)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* ast_cause2str </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>state</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Gives the string form of a given hangup cause. </p>
<p>Gives the string form of a given cause code</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structstate.html">state</a></em>&nbsp;</td><td>cause to get the description of Give a name to a cause code Returns the text form of the binary cause code given </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l00629">629</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, and <a class="el" href="channel_8c.html#a9bef477e7c7644e0cdaf5c9f0e115204">causes</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l09559">__transmit_response()</a>, <a class="el" href="channel_8c_source.html#l04393">ast_do_masquerade()</a>, <a class="el" href="channel_8c_source.html#l01690">ast_hangup()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="app__followme_8c_source.html#l00777">findmeexec()</a>, <a class="el" href="chan__sip_8c_source.html#l05956">sip_hangup()</a>, and <a class="el" href="chan__sip_8c_source.html#l11958">transmit_request_with_auth()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00630"></a>00630 {
<a name="l00631"></a>00631    <span class="keywordtype">int</span> x;
<a name="l00632"></a>00632 
<a name="l00633"></a>00633    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="channel_8c.html#a9bef477e7c7644e0cdaf5c9f0e115204" title="map AST_CAUSE&amp;#39;s to readable string representations">causes</a>); x++) {
<a name="l00634"></a>00634       <span class="keywordflow">if</span> (<a class="code" href="channel_8c.html#a9bef477e7c7644e0cdaf5c9f0e115204" title="map AST_CAUSE&amp;#39;s to readable string representations">causes</a>[x].<a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a> == <a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>)
<a name="l00635"></a>00635          <span class="keywordflow">return</span> <a class="code" href="channel_8c.html#a9bef477e7c7644e0cdaf5c9f0e115204" title="map AST_CAUSE&amp;#39;s to readable string representations">causes</a>[x].desc;
<a name="l00636"></a>00636    }
<a name="l00637"></a>00637 
<a name="l00638"></a>00638    <span class="keywordflow">return</span> <span class="stringliteral">&quot;Unknown&quot;</span>;
<a name="l00639"></a>00639 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a278899a6fc247f9d734ee13a0361aba5"></a><!-- doxytag: member="channel.c::ast_change_name" ref="a278899a6fc247f9d734ee13a0361aba5" args="(struct ast_channel *chan, char *newname)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_change_name </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>newname</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Change channel name. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>The channel must be locked before calling this function. </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l04296">4296</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="stringfields_8h_source.html#l00285">ast_string_field_set</a>, <a class="el" href="manager_8h_source.html#l00062">EVENT_FLAG_CALL</a>, <a class="el" href="manager_8h_source.html#l00181">manager_event</a>, and <a class="el" href="cdr__adaptive__odbc_8c_source.html#l00053">name</a>.</p>

<p>Referenced by <a class="el" href="chan__misdn_8c_source.html#l03682">update_name()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04297"></a>04297 {
<a name="l04298"></a>04298    <a class="code" href="manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208" title="External routines may send asterisk manager events this way.">manager_event</a>(<a class="code" href="manager_8h.html#ab5db3cc603d7e798d61cb4cd94fbb4e2">EVENT_FLAG_CALL</a>, <span class="stringliteral">&quot;Rename&quot;</span>, <span class="stringliteral">&quot;Channel: %s\r\nNewname: %s\r\nUniqueid: %s\r\n&quot;</span>, chan-&gt;name, newname, chan-&gt;uniqueid);
<a name="l04299"></a>04299    <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(chan, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, newname);
<a name="l04300"></a>04300 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a38912daf13c69c689a6d5a908672f5c9"></a><!-- doxytag: member="channel.c::ast_channel_alloc" ref="a38912daf13c69c689a6d5a908672f5c9" args="(int needqueue, int state, const char *cid_num, const char *cid_name, const char *acctcode, const char *exten, const char *context, const int amaflag, const char *name_fmt,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__channel.html">ast_channel</a> * ast_channel_alloc </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>needqueue</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>cid_num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>cid_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>acctcode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>exten</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>amaflag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name_fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>...</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l05876">5876</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l00772">__ast_channel_alloc_ap()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05880"></a>05880 {
<a name="l05881"></a>05881    va_list ap1, ap2;
<a name="l05882"></a>05882    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *result;
<a name="l05883"></a>05883 
<a name="l05884"></a>05884 
<a name="l05885"></a>05885    va_start(ap1, name_fmt);
<a name="l05886"></a>05886    va_start(ap2, name_fmt);
<a name="l05887"></a>05887    result = <a class="code" href="channel_8c.html#a8da909f2e85e052550b1e56dcfb57962" title="Create a new channel structure.">__ast_channel_alloc_ap</a>(needqueue, <a class="code" href="structstate.html">state</a>, <a class="code" href="chan__mgcp_8c.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>, <a class="code" href="chan__mgcp_8c.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>, acctcode, <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>,
<a name="l05888"></a>05888                amaflag, __FILE__, __LINE__, __FUNCTION__, name_fmt, ap1, ap2);
<a name="l05889"></a>05889    va_end(ap1);
<a name="l05890"></a>05890    va_end(ap2);
<a name="l05891"></a>05891 
<a name="l05892"></a>05892    <span class="keywordflow">return</span> result;
<a name="l05893"></a>05893 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af5f7a28a37717951fccf8abd7e70ec80"></a><!-- doxytag: member="channel.c::ast_channel_bridge" ref="af5f7a28a37717951fccf8abd7e70ec80" args="(struct ast_channel *c0, struct ast_channel *c1, struct ast_bridge_config *config, struct ast_frame **fo, struct ast_channel **rc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05">ast_bridge_result</a> ast_channel_bridge </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__bridge__config.html">ast_bridge_config</a> *&nbsp;</td>
          <td class="paramname"> <em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> **&nbsp;</td>
          <td class="paramname"> <em>fo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> **&nbsp;</td>
          <td class="paramname"> <em>rc</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Bridge two <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> together. </p>
<p>Bridge two <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> together </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c0</em>&nbsp;</td><td>first channel to bridge </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>c1</em>&nbsp;</td><td>second channel to bridge </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>config</em>&nbsp;</td><td>config for the <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fo</em>&nbsp;</td><td>destination frame(?) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>rc</em>&nbsp;</td><td>destination channel(?) Bridge two <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> (c0 and c1) together. If an important frame occurs, we return that frame in rf (remember, it could be NULL) and which channel (0 or 1) in rc </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l05055">5055</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00405">ast_channel::_bridge</a>, <a class="el" href="channel_8h_source.html#l00462">ast_channel::_softhangup</a>, <a class="el" href="channel_8h_source.html#l00164">AST_BRIDGE_COMPLETE</a>, <a class="el" href="channel_8h_source.html#l00165">AST_BRIDGE_FAILED</a>, <a class="el" href="channel_8h_source.html#l00166">AST_BRIDGE_FAILED_NOWARN</a>, <a class="el" href="channel_8h_source.html#l00167">AST_BRIDGE_RETRY</a>, <a class="el" href="channel_8c_source.html#l04200">ast_channel_make_compatible()</a>, <a class="el" href="channel_8c_source.html#l00461">ast_check_hangup()</a>, <a class="el" href="channel_8c_source.html#l00473">ast_check_hangup_locked()</a>, <a class="el" href="utils_8h_source.html#l00075">ast_clear_flag</a>, <a class="el" href="frame_8h_source.html#l00317">AST_CONTROL_SRCUPDATE</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="channel_8h_source.html#l00576">AST_FEATURE_PLAY_WARNING</a>, <a class="el" href="channel_8h_source.html#l00584">AST_FEATURE_WARNING_ACTIVE</a>, <a class="el" href="channel_8h_source.html#l00551">AST_FLAG_END_DTMF_ONLY</a>, <a class="el" href="channel_8h_source.html#l00537">AST_FLAG_NBRIDGE</a>, <a class="el" href="channel_8h_source.html#l00529">AST_FLAG_ZOMBIE</a>, <a class="el" href="channel_8c_source.html#l04776">ast_generic_bridge()</a>, <a class="el" href="channel_8c_source.html#l03110">ast_indicate()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="time_8h_source.html#l00176">ast_samp2tv()</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="channel_8h_source.html#l00640">AST_SOFTHANGUP_UNBRIDGE</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="utils_8c_source.html#l01365">ast_tvadd()</a>, <a class="el" href="time_8h_source.html#l00089">ast_tvdiff_ms()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="utils_8c_source.html#l01379">ast_tvsub()</a>, <a class="el" href="time_8h_source.html#l00099">ast_tvzero()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="channel_8h_source.html#l00421">ast_channel::audiohooks</a>, <a class="el" href="structast__channel__tech.html#abc730363b975df40d4fddf0671cb889f">ast_channel_tech::bridge</a>, <a class="el" href="channel_8c_source.html#l05027">bridge_play_sounds()</a>, <a class="el" href="channel_8c_source.html#l04742">bridge_playfile()</a>, <a class="el" href="channel_8h_source.html#l00444">ast_channel::cid</a>, <a class="el" href="channel_8h_source.html#l00203">ast_callerid::cid_num</a>, <a class="el" href="channel_8h_source.html#l00599">ast_bridge_config::end_sound</a>, <a class="el" href="manager_8h_source.html#l00062">EVENT_FLAG_CALL</a>, <a class="el" href="channel_8h_source.html#l00594">ast_bridge_config::feature_timer</a>, <a class="el" href="channel_8h_source.html#l00590">ast_bridge_config::features_callee</a>, <a class="el" href="channel_8h_source.html#l00589">ast_bridge_config::features_caller</a>, <a class="el" href="channel_8h_source.html#l00601">ast_bridge_config::firstpass</a>, <a class="el" href="channel_8h_source.html#l00602">ast_bridge_config::flags</a>, <a class="el" href="channel_8h_source.html#l00404">ast_channel::generator</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="channel_8c_source.html#l04972">manager_bridge_event()</a>, <a class="el" href="manager_8h_source.html#l00181">manager_event</a>, <a class="el" href="channel_8h_source.html#l00408">ast_channel::masq</a>, <a class="el" href="channel_8h_source.html#l00409">ast_channel::masqr</a>, <a class="el" href="channel_8h_source.html#l00425">ast_channel::monitor</a>, <a class="el" href="channel_8h_source.html#l00482">ast_channel::nativeformats</a>, <a class="el" href="channel_8h_source.html#l00592">ast_bridge_config::nexteventts</a>, <a class="el" href="channel_8h_source.html#l00596">ast_bridge_config::play_warning</a>, <a class="el" href="channel_8h_source.html#l00483">ast_channel::readformat</a>, <a class="el" href="structast__channel__tech.html#a83b4c653034ecac13d1abc179d0535d8">ast_channel_tech::send_digit_begin</a>, <a class="el" href="channel_8h_source.html#l00600">ast_bridge_config::start_sound</a>, <a class="el" href="channel_8h_source.html#l00591">ast_bridge_config::start_time</a>, <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>, <a class="el" href="channel_8h_source.html#l00595">ast_bridge_config::timelimit</a>, <a class="el" href="channel_8c_source.html#l04990">update_bridge_vars()</a>, <a class="el" href="channel_8h_source.html#l00597">ast_bridge_config::warning_freq</a>, <a class="el" href="channel_8h_source.html#l00598">ast_bridge_config::warning_sound</a>, and <a class="el" href="channel_8h_source.html#l00484">ast_channel::writeformat</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l02441">ast_bridge_call()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05057"></a>05057 {
<a name="l05058"></a>05058    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *who = NULL;
<a name="l05059"></a>05059    <span class="keyword">enum</span> <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05">ast_bridge_result</a> res = <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05ada47e397237355168a082a189cf13ee1">AST_BRIDGE_COMPLETE</a>;
<a name="l05060"></a>05060    <span class="keywordtype">int</span> nativefailed=0;
<a name="l05061"></a>05061    <span class="keywordtype">int</span> firstpass;
<a name="l05062"></a>05062    <span class="keywordtype">int</span> o0nativeformats;
<a name="l05063"></a>05063    <span class="keywordtype">int</span> o1nativeformats;
<a name="l05064"></a>05064    <span class="keywordtype">long</span> time_left_ms=0;
<a name="l05065"></a>05065    <span class="keywordtype">char</span> caller_warning = 0;
<a name="l05066"></a>05066    <span class="keywordtype">char</span> callee_warning = 0;
<a name="l05067"></a>05067 
<a name="l05068"></a>05068    <span class="keywordflow">if</span> (c0-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a>) {
<a name="l05069"></a>05069       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s is already in a bridge with %s\n&quot;</span>,
<a name="l05070"></a>05070          c0-&gt;name, c0-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a>-&gt;name);
<a name="l05071"></a>05071       <span class="keywordflow">return</span> -1;
<a name="l05072"></a>05072    }
<a name="l05073"></a>05073    <span class="keywordflow">if</span> (c1-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a>) {
<a name="l05074"></a>05074       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s is already in a bridge with %s\n&quot;</span>,
<a name="l05075"></a>05075          c1-&gt;name, c1-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a>-&gt;name);
<a name="l05076"></a>05076       <span class="keywordflow">return</span> -1;
<a name="l05077"></a>05077    }
<a name="l05078"></a>05078    
<a name="l05079"></a>05079    <span class="comment">/* Stop if we&apos;re a zombie or need a soft hangup */</span>
<a name="l05080"></a>05080    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(c0, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a26796fa52cc5857446eec8d16a4b718d">AST_FLAG_ZOMBIE</a>) || <a class="code" href="channel_8c.html#a4f08aa89bd0b65faba26148b6c836b2a">ast_check_hangup_locked</a>(c0) ||
<a name="l05081"></a>05081        <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(c1, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a26796fa52cc5857446eec8d16a4b718d">AST_FLAG_ZOMBIE</a>) || <a class="code" href="channel_8c.html#a4f08aa89bd0b65faba26148b6c836b2a">ast_check_hangup_locked</a>(c1))
<a name="l05082"></a>05082       <span class="keywordflow">return</span> -1;
<a name="l05083"></a>05083 
<a name="l05084"></a>05084    *fo = NULL;
<a name="l05085"></a>05085    firstpass = config-&gt;<a class="code" href="structast__bridge__config.html#a1c72cdec53606007c15bd661d74d07d4">firstpass</a>;
<a name="l05086"></a>05086    config-&gt;<a class="code" href="structast__bridge__config.html#a1c72cdec53606007c15bd661d74d07d4">firstpass</a> = 0;
<a name="l05087"></a>05087 
<a name="l05088"></a>05088    <span class="keywordflow">if</span> (<a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(config-&gt;<a class="code" href="structast__bridge__config.html#ab83335d6897e2ea22f24b1b8afd95b0f">start_time</a>))
<a name="l05089"></a>05089       config-&gt;<a class="code" href="structast__bridge__config.html#ab83335d6897e2ea22f24b1b8afd95b0f">start_time</a> = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l05090"></a>05090    time_left_ms = config-&gt;<a class="code" href="structast__bridge__config.html#ab88b1e2ff0d0fed0616512352e723162">timelimit</a>;
<a name="l05091"></a>05091 
<a name="l05092"></a>05092    caller_warning = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;config-&gt;<a class="code" href="structast__bridge__config.html#aa9510db9c5a776dfbd1aaab8c48970f0">features_caller</a>, <a class="code" href="channel_8h.html#a7495a48740c9d555f7fbcb48246dbd93ae6373d88ce4e9e5d9b7031272a9bc5ab">AST_FEATURE_PLAY_WARNING</a>);
<a name="l05093"></a>05093    callee_warning = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;config-&gt;<a class="code" href="structast__bridge__config.html#a725b051d26c3350f8cd04467b4202c60">features_callee</a>, <a class="code" href="channel_8h.html#a7495a48740c9d555f7fbcb48246dbd93ae6373d88ce4e9e5d9b7031272a9bc5ab">AST_FEATURE_PLAY_WARNING</a>);
<a name="l05094"></a>05094 
<a name="l05095"></a>05095    <span class="keywordflow">if</span> (config-&gt;<a class="code" href="structast__bridge__config.html#af134a8361d8611e10872c9c0f806ba64">start_sound</a> &amp;&amp; firstpass) {
<a name="l05096"></a>05096       <span class="keywordflow">if</span> (caller_warning)
<a name="l05097"></a>05097          <a class="code" href="channel_8c.html#a63873f4aec1d534d9c12693585db32fc">bridge_playfile</a>(c0, c1, config-&gt;<a class="code" href="structast__bridge__config.html#af134a8361d8611e10872c9c0f806ba64">start_sound</a>, time_left_ms / 1000);
<a name="l05098"></a>05098       <span class="keywordflow">if</span> (callee_warning)
<a name="l05099"></a>05099          <a class="code" href="channel_8c.html#a63873f4aec1d534d9c12693585db32fc">bridge_playfile</a>(c1, c0, config-&gt;<a class="code" href="structast__bridge__config.html#af134a8361d8611e10872c9c0f806ba64">start_sound</a>, time_left_ms / 1000);
<a name="l05100"></a>05100    }
<a name="l05101"></a>05101 
<a name="l05102"></a>05102    <span class="comment">/* Keep track of bridge */</span>
<a name="l05103"></a>05103    c0-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a> = c1;
<a name="l05104"></a>05104    c1-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a> = c0;
<a name="l05105"></a>05105 
<a name="l05106"></a>05106 
<a name="l05107"></a>05107    o0nativeformats = c0-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>;
<a name="l05108"></a>05108    o1nativeformats = c1-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>;
<a name="l05109"></a>05109 
<a name="l05110"></a>05110    <span class="keywordflow">if</span> (config-&gt;<a class="code" href="structast__bridge__config.html#af083a5b636f7b870cea1aea1eeadf6ff">feature_timer</a> &amp;&amp; !<a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(config-&gt;<a class="code" href="structast__bridge__config.html#a1abaa6fad41461bdb3da343a2bee88c0">nexteventts</a>)) {
<a name="l05111"></a>05111       config-&gt;<a class="code" href="structast__bridge__config.html#a1abaa6fad41461bdb3da343a2bee88c0">nexteventts</a> = <a class="code" href="time_8h.html#a97e1bb8fbd7a103212789e87e7ed6073" title="Returns the sum of two timevals a + b.">ast_tvadd</a>(config-&gt;<a class="code" href="structast__bridge__config.html#ab83335d6897e2ea22f24b1b8afd95b0f">start_time</a>, <a class="code" href="time_8h.html#a147d132412d7188c1dcebf25b8d31c0c" title="Returns a timeval corresponding to the duration of n samples at rate r. Useful to...">ast_samp2tv</a>(config-&gt;<a class="code" href="structast__bridge__config.html#af083a5b636f7b870cea1aea1eeadf6ff">feature_timer</a>, 1000));
<a name="l05112"></a>05112    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (config-&gt;<a class="code" href="structast__bridge__config.html#ab88b1e2ff0d0fed0616512352e723162">timelimit</a> &amp;&amp; firstpass) {
<a name="l05113"></a>05113       config-&gt;<a class="code" href="structast__bridge__config.html#a1abaa6fad41461bdb3da343a2bee88c0">nexteventts</a> = <a class="code" href="time_8h.html#a97e1bb8fbd7a103212789e87e7ed6073" title="Returns the sum of two timevals a + b.">ast_tvadd</a>(config-&gt;<a class="code" href="structast__bridge__config.html#ab83335d6897e2ea22f24b1b8afd95b0f">start_time</a>, <a class="code" href="time_8h.html#a147d132412d7188c1dcebf25b8d31c0c" title="Returns a timeval corresponding to the duration of n samples at rate r. Useful to...">ast_samp2tv</a>(config-&gt;<a class="code" href="structast__bridge__config.html#ab88b1e2ff0d0fed0616512352e723162">timelimit</a>, 1000));
<a name="l05114"></a>05114       <span class="keywordflow">if</span> (caller_warning || callee_warning)
<a name="l05115"></a>05115          config-&gt;<a class="code" href="structast__bridge__config.html#a1abaa6fad41461bdb3da343a2bee88c0">nexteventts</a> = <a class="code" href="time_8h.html#aa13b651c18bc6004cab21ac041d44dd8" title="Returns the difference of two timevals a - b.">ast_tvsub</a>(config-&gt;<a class="code" href="structast__bridge__config.html#a1abaa6fad41461bdb3da343a2bee88c0">nexteventts</a>, <a class="code" href="time_8h.html#a147d132412d7188c1dcebf25b8d31c0c" title="Returns a timeval corresponding to the duration of n samples at rate r. Useful to...">ast_samp2tv</a>(config-&gt;<a class="code" href="structast__bridge__config.html#af3d16394c849390df1c8f72569faeb37">play_warning</a>, 1000));
<a name="l05116"></a>05116    }
<a name="l05117"></a>05117 
<a name="l05118"></a>05118    <span class="keywordflow">if</span> (!c0-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a83b4c653034ecac13d1abc179d0535d8" title="Start sending a literal DTMF digit.">send_digit_begin</a>)
<a name="l05119"></a>05119       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(c1, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a668ac945c84f50becaca2a6134e64058">AST_FLAG_END_DTMF_ONLY</a>);
<a name="l05120"></a>05120    <span class="keywordflow">if</span> (!c1-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a83b4c653034ecac13d1abc179d0535d8" title="Start sending a literal DTMF digit.">send_digit_begin</a>)
<a name="l05121"></a>05121       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(c0, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a668ac945c84f50becaca2a6134e64058">AST_FLAG_END_DTMF_ONLY</a>);
<a name="l05122"></a>05122    <a class="code" href="channel_8c.html#ab8a085dee0e97a277287d359ce7f4e4d" title="Send manager event for bridge link and unlink events.">manager_bridge_event</a>(1, 1, c0, c1);
<a name="l05123"></a>05123 
<a name="l05124"></a>05124    <span class="comment">/* Before we enter in and bridge these two together tell them both the source of audio has changed */</span>
<a name="l05125"></a>05125    <a class="code" href="channel_8h.html#aef2af15a597c948e97628da6c5c84f28" title="Indicates condition of channel.">ast_indicate</a>(c0, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a009e81151b19671f42b5e84ab6a619f4">AST_CONTROL_SRCUPDATE</a>);
<a name="l05126"></a>05126    <a class="code" href="channel_8h.html#aef2af15a597c948e97628da6c5c84f28" title="Indicates condition of channel.">ast_indicate</a>(c1, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a009e81151b19671f42b5e84ab6a619f4">AST_CONTROL_SRCUPDATE</a>);
<a name="l05127"></a>05127 
<a name="l05128"></a>05128    <span class="keywordflow">for</span> (<span class="comment">/* ever */</span>;;) {
<a name="l05129"></a>05129       <span class="keyword">struct </span>timeval now = { 0, };
<a name="l05130"></a>05130       <span class="keywordtype">int</span> to;
<a name="l05131"></a>05131 
<a name="l05132"></a>05132       to = -1;
<a name="l05133"></a>05133 
<a name="l05134"></a>05134       <span class="keywordflow">if</span> (!<a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(config-&gt;<a class="code" href="structast__bridge__config.html#a1abaa6fad41461bdb3da343a2bee88c0">nexteventts</a>)) {
<a name="l05135"></a>05135          now = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l05136"></a>05136          to = <a class="code" href="time_8h.html#a74e35cffcd45ad6cd7c8587921e8a4c2" title="Computes the difference (in milliseconds) between two struct timeval instances.">ast_tvdiff_ms</a>(config-&gt;<a class="code" href="structast__bridge__config.html#a1abaa6fad41461bdb3da343a2bee88c0">nexteventts</a>, now);
<a name="l05137"></a>05137          <span class="keywordflow">if</span> (to &lt;= 0) {
<a name="l05138"></a>05138             <span class="keywordflow">if</span> (!config-&gt;<a class="code" href="structast__bridge__config.html#ab88b1e2ff0d0fed0616512352e723162">timelimit</a>) {
<a name="l05139"></a>05139                res = <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05ada47e397237355168a082a189cf13ee1">AST_BRIDGE_COMPLETE</a>;
<a name="l05140"></a>05140                <span class="keywordflow">break</span>;
<a name="l05141"></a>05141             }
<a name="l05142"></a>05142             to = 0;
<a name="l05143"></a>05143          }
<a name="l05144"></a>05144       }
<a name="l05145"></a>05145 
<a name="l05146"></a>05146       <span class="keywordflow">if</span> (config-&gt;<a class="code" href="structast__bridge__config.html#ab88b1e2ff0d0fed0616512352e723162">timelimit</a>) {
<a name="l05147"></a>05147          time_left_ms = config-&gt;<a class="code" href="structast__bridge__config.html#ab88b1e2ff0d0fed0616512352e723162">timelimit</a> - <a class="code" href="time_8h.html#a74e35cffcd45ad6cd7c8587921e8a4c2" title="Computes the difference (in milliseconds) between two struct timeval instances.">ast_tvdiff_ms</a>(now, config-&gt;<a class="code" href="structast__bridge__config.html#ab83335d6897e2ea22f24b1b8afd95b0f">start_time</a>);
<a name="l05148"></a>05148          <span class="keywordflow">if</span> (time_left_ms &lt; to)
<a name="l05149"></a>05149             to = time_left_ms;
<a name="l05150"></a>05150 
<a name="l05151"></a>05151          <span class="keywordflow">if</span> (time_left_ms &lt;= 0) {
<a name="l05152"></a>05152             <span class="keywordflow">if</span> (caller_warning &amp;&amp; config-&gt;<a class="code" href="structast__bridge__config.html#a0b23b4ebfc857809d07d1ced94c9a6eb">end_sound</a>)
<a name="l05153"></a>05153                <a class="code" href="channel_8c.html#a63873f4aec1d534d9c12693585db32fc">bridge_playfile</a>(c0, c1, config-&gt;<a class="code" href="structast__bridge__config.html#a0b23b4ebfc857809d07d1ced94c9a6eb">end_sound</a>, 0);
<a name="l05154"></a>05154             <span class="keywordflow">if</span> (callee_warning &amp;&amp; config-&gt;<a class="code" href="structast__bridge__config.html#a0b23b4ebfc857809d07d1ced94c9a6eb">end_sound</a>)
<a name="l05155"></a>05155                <a class="code" href="channel_8c.html#a63873f4aec1d534d9c12693585db32fc">bridge_playfile</a>(c1, c0, config-&gt;<a class="code" href="structast__bridge__config.html#a0b23b4ebfc857809d07d1ced94c9a6eb">end_sound</a>, 0);
<a name="l05156"></a>05156             *fo = NULL;
<a name="l05157"></a>05157             <span class="keywordflow">if</span> (who)
<a name="l05158"></a>05158                *rc = who;
<a name="l05159"></a>05159             res = 0;
<a name="l05160"></a>05160             <span class="keywordflow">break</span>;
<a name="l05161"></a>05161          }
<a name="l05162"></a>05162 
<a name="l05163"></a>05163          <span class="keywordflow">if</span> (!to) {
<a name="l05164"></a>05164             <span class="keywordflow">if</span> (time_left_ms &gt;= 5000 &amp;&amp; config-&gt;<a class="code" href="structast__bridge__config.html#a1fa6cb6235cf4abe198a8561e3c18bae">warning_sound</a> &amp;&amp; config-&gt;<a class="code" href="structast__bridge__config.html#af3d16394c849390df1c8f72569faeb37">play_warning</a> &amp;&amp; <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(config, <a class="code" href="channel_8h.html#a7495a48740c9d555f7fbcb48246dbd93a2b65bf23f98d81b36f2f6898ee0aac16">AST_FEATURE_WARNING_ACTIVE</a>)) {
<a name="l05165"></a>05165                <span class="keywordtype">int</span> t = (time_left_ms + 500) / 1000; <span class="comment">/* round to nearest second */</span>
<a name="l05166"></a>05166                <span class="keywordflow">if</span> (caller_warning)
<a name="l05167"></a>05167                   <a class="code" href="channel_8c.html#a63873f4aec1d534d9c12693585db32fc">bridge_playfile</a>(c0, c1, config-&gt;<a class="code" href="structast__bridge__config.html#a1fa6cb6235cf4abe198a8561e3c18bae">warning_sound</a>, t);
<a name="l05168"></a>05168                <span class="keywordflow">if</span> (callee_warning)
<a name="l05169"></a>05169                   <a class="code" href="channel_8c.html#a63873f4aec1d534d9c12693585db32fc">bridge_playfile</a>(c1, c0, config-&gt;<a class="code" href="structast__bridge__config.html#a1fa6cb6235cf4abe198a8561e3c18bae">warning_sound</a>, t);
<a name="l05170"></a>05170             }
<a name="l05171"></a>05171             <span class="keywordflow">if</span> (config-&gt;<a class="code" href="structast__bridge__config.html#abc09654c9b36de6b0bd0bfd92d31c0c0">warning_freq</a> &amp;&amp; (time_left_ms &gt; (config-&gt;<a class="code" href="structast__bridge__config.html#abc09654c9b36de6b0bd0bfd92d31c0c0">warning_freq</a> + 5000)))
<a name="l05172"></a>05172                config-&gt;<a class="code" href="structast__bridge__config.html#a1abaa6fad41461bdb3da343a2bee88c0">nexteventts</a> = <a class="code" href="time_8h.html#a97e1bb8fbd7a103212789e87e7ed6073" title="Returns the sum of two timevals a + b.">ast_tvadd</a>(config-&gt;<a class="code" href="structast__bridge__config.html#a1abaa6fad41461bdb3da343a2bee88c0">nexteventts</a>, <a class="code" href="time_8h.html#a147d132412d7188c1dcebf25b8d31c0c" title="Returns a timeval corresponding to the duration of n samples at rate r. Useful to...">ast_samp2tv</a>(config-&gt;<a class="code" href="structast__bridge__config.html#abc09654c9b36de6b0bd0bfd92d31c0c0">warning_freq</a>, 1000));
<a name="l05173"></a>05173             <span class="keywordflow">else</span>
<a name="l05174"></a>05174                config-&gt;<a class="code" href="structast__bridge__config.html#a1abaa6fad41461bdb3da343a2bee88c0">nexteventts</a> = <a class="code" href="time_8h.html#a97e1bb8fbd7a103212789e87e7ed6073" title="Returns the sum of two timevals a + b.">ast_tvadd</a>(config-&gt;<a class="code" href="structast__bridge__config.html#ab83335d6897e2ea22f24b1b8afd95b0f">start_time</a>, <a class="code" href="time_8h.html#a147d132412d7188c1dcebf25b8d31c0c" title="Returns a timeval corresponding to the duration of n samples at rate r. Useful to...">ast_samp2tv</a>(config-&gt;<a class="code" href="structast__bridge__config.html#ab88b1e2ff0d0fed0616512352e723162">timelimit</a>, 1000));
<a name="l05175"></a>05175          }
<a name="l05176"></a>05176          <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(config, <a class="code" href="channel_8h.html#a7495a48740c9d555f7fbcb48246dbd93a2b65bf23f98d81b36f2f6898ee0aac16">AST_FEATURE_WARNING_ACTIVE</a>);
<a name="l05177"></a>05177       }
<a name="l05178"></a>05178 
<a name="l05179"></a>05179       <span class="keywordflow">if</span> (c0-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> == <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709ab5066a7ae4553197c7e712139b879f15">AST_SOFTHANGUP_UNBRIDGE</a> || c1-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> == <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709ab5066a7ae4553197c7e712139b879f15">AST_SOFTHANGUP_UNBRIDGE</a>) {
<a name="l05180"></a>05180          <span class="keywordflow">if</span> (c0-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> == <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709ab5066a7ae4553197c7e712139b879f15">AST_SOFTHANGUP_UNBRIDGE</a>)
<a name="l05181"></a>05181             c0-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> = 0;
<a name="l05182"></a>05182          <span class="keywordflow">if</span> (c1-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> == <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709ab5066a7ae4553197c7e712139b879f15">AST_SOFTHANGUP_UNBRIDGE</a>)
<a name="l05183"></a>05183             c1-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> = 0;
<a name="l05184"></a>05184          c0-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a> = c1;
<a name="l05185"></a>05185          c1-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a> = c0;
<a name="l05186"></a>05186          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Unbridge signal received. Ending native bridge.\n&quot;</span>);
<a name="l05187"></a>05187          <span class="keywordflow">continue</span>;
<a name="l05188"></a>05188       }
<a name="l05189"></a>05189 
<a name="l05190"></a>05190       <span class="comment">/* Stop if we&apos;re a zombie or need a soft hangup */</span>
<a name="l05191"></a>05191       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(c0, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a26796fa52cc5857446eec8d16a4b718d">AST_FLAG_ZOMBIE</a>) || <a class="code" href="channel_8c.html#a4f08aa89bd0b65faba26148b6c836b2a">ast_check_hangup_locked</a>(c0) ||
<a name="l05192"></a>05192           <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(c1, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a26796fa52cc5857446eec8d16a4b718d">AST_FLAG_ZOMBIE</a>) || <a class="code" href="channel_8c.html#a4f08aa89bd0b65faba26148b6c836b2a">ast_check_hangup_locked</a>(c1)) {
<a name="l05193"></a>05193          *fo = NULL;
<a name="l05194"></a>05194          <span class="keywordflow">if</span> (who)
<a name="l05195"></a>05195             *rc = who;
<a name="l05196"></a>05196          res = 0;
<a name="l05197"></a>05197          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge stops because we&apos;re zombie or need a soft hangup: c0=%s, c1=%s, flags: %s,%s,%s,%s\n&quot;</span>,
<a name="l05198"></a>05198             c0-&gt;name, c1-&gt;name,
<a name="l05199"></a>05199             <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(c0, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a26796fa52cc5857446eec8d16a4b718d">AST_FLAG_ZOMBIE</a>) ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>,
<a name="l05200"></a>05200             <a class="code" href="channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd" title="Check to see if a channel is needing hang up.">ast_check_hangup</a>(c0) ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>,
<a name="l05201"></a>05201             <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(c1, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a26796fa52cc5857446eec8d16a4b718d">AST_FLAG_ZOMBIE</a>) ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>,
<a name="l05202"></a>05202             <a class="code" href="channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd" title="Check to see if a channel is needing hang up.">ast_check_hangup</a>(c1) ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>);
<a name="l05203"></a>05203          <span class="keywordflow">break</span>;
<a name="l05204"></a>05204       }
<a name="l05205"></a>05205 
<a name="l05206"></a>05206       <a class="code" href="channel_8c.html#a6f45f5d6e87e9a0b9fc31b1f1109f741">update_bridge_vars</a>(c0, c1);
<a name="l05207"></a>05207 
<a name="l05208"></a>05208       <a class="code" href="channel_8c.html#a63b70c68a2dda262d506cc96b48cde08">bridge_play_sounds</a>(c0, c1);
<a name="l05209"></a>05209 
<a name="l05210"></a>05210       <span class="keywordflow">if</span> (c0-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#abc730363b975df40d4fddf0671cb889f" title="Bridge two channels of the same type together.">bridge</a> &amp;&amp;
<a name="l05211"></a>05211           (c0-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#abc730363b975df40d4fddf0671cb889f" title="Bridge two channels of the same type together.">bridge</a> == c1-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#abc730363b975df40d4fddf0671cb889f" title="Bridge two channels of the same type together.">bridge</a>) &amp;&amp;
<a name="l05212"></a>05212           !nativefailed &amp;&amp; !c0-&gt;<a class="code" href="structast__channel.html#a4254cefdfaeb5200f89e7ba3ae6f0922">monitor</a> &amp;&amp; !c1-&gt;<a class="code" href="structast__channel.html#a4254cefdfaeb5200f89e7ba3ae6f0922">monitor</a> &amp;&amp;
<a name="l05213"></a>05213           !c0-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a> &amp;&amp; !c1-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a> &amp;&amp; 
<a name="l05214"></a>05214           !c0-&gt;<a class="code" href="structast__channel.html#ae38ae730b987d648a6fe1c84c8a13442">masq</a> &amp;&amp; !c0-&gt;<a class="code" href="structast__channel.html#abb53278bc00235a5ff76fc8badbe6363">masqr</a> &amp;&amp; !c1-&gt;<a class="code" href="structast__channel.html#ae38ae730b987d648a6fe1c84c8a13442">masq</a> &amp;&amp; !c1-&gt;<a class="code" href="structast__channel.html#abb53278bc00235a5ff76fc8badbe6363">masqr</a>) {
<a name="l05215"></a>05215          <span class="comment">/* Looks like they share a bridge method and nothing else is in the way */</span>
<a name="l05216"></a>05216          <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(c0, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a3215f563ba01d2837d919b6aaeb122ec">AST_FLAG_NBRIDGE</a>);
<a name="l05217"></a>05217          <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(c1, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a3215f563ba01d2837d919b6aaeb122ec">AST_FLAG_NBRIDGE</a>);
<a name="l05218"></a>05218          <span class="keywordflow">if</span> ((res = c0-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#abc730363b975df40d4fddf0671cb889f" title="Bridge two channels of the same type together.">bridge</a>(c0, c1, config-&gt;<a class="code" href="structast__bridge__config.html#ac92588540e8c1d014a08cd8a45462b19">flags</a>, fo, rc, to)) == <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05ada47e397237355168a082a189cf13ee1">AST_BRIDGE_COMPLETE</a>) {
<a name="l05219"></a>05219             <span class="comment">/* \todo  XXX here should check that cid_num is not NULL */</span>
<a name="l05220"></a>05220             <a class="code" href="manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208" title="External routines may send asterisk manager events this way.">manager_event</a>(<a class="code" href="manager_8h.html#ab5db3cc603d7e798d61cb4cd94fbb4e2">EVENT_FLAG_CALL</a>, <span class="stringliteral">&quot;Unlink&quot;</span>,
<a name="l05221"></a>05221                      <span class="stringliteral">&quot;Channel1: %s\r\n&quot;</span>
<a name="l05222"></a>05222                      <span class="stringliteral">&quot;Channel2: %s\r\n&quot;</span>
<a name="l05223"></a>05223                      <span class="stringliteral">&quot;Uniqueid1: %s\r\n&quot;</span>
<a name="l05224"></a>05224                      <span class="stringliteral">&quot;Uniqueid2: %s\r\n&quot;</span>
<a name="l05225"></a>05225                      <span class="stringliteral">&quot;CallerID1: %s\r\n&quot;</span>
<a name="l05226"></a>05226                      <span class="stringliteral">&quot;CallerID2: %s\r\n&quot;</span>,
<a name="l05227"></a>05227                      c0-&gt;name, c1-&gt;name, c0-&gt;uniqueid, c1-&gt;uniqueid, c0-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>, c1-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>);
<a name="l05228"></a>05228             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Returning from native bridge, channels: %s, %s\n&quot;</span>, c0-&gt;name, c1-&gt;name);
<a name="l05229"></a>05229 
<a name="l05230"></a>05230             <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(c0, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a3215f563ba01d2837d919b6aaeb122ec">AST_FLAG_NBRIDGE</a>);
<a name="l05231"></a>05231             <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(c1, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a3215f563ba01d2837d919b6aaeb122ec">AST_FLAG_NBRIDGE</a>);
<a name="l05232"></a>05232 
<a name="l05233"></a>05233             <span class="keywordflow">if</span> (c0-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> == <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709ab5066a7ae4553197c7e712139b879f15">AST_SOFTHANGUP_UNBRIDGE</a> || c1-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> == <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709ab5066a7ae4553197c7e712139b879f15">AST_SOFTHANGUP_UNBRIDGE</a>)
<a name="l05234"></a>05234                <span class="keywordflow">continue</span>;
<a name="l05235"></a>05235 
<a name="l05236"></a>05236             c0-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a> = NULL;
<a name="l05237"></a>05237             c1-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a> = NULL;
<a name="l05238"></a>05238 
<a name="l05239"></a>05239             <span class="keywordflow">return</span> res;
<a name="l05240"></a>05240          } <span class="keywordflow">else</span> {
<a name="l05241"></a>05241             <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(c0, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a3215f563ba01d2837d919b6aaeb122ec">AST_FLAG_NBRIDGE</a>);
<a name="l05242"></a>05242             <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(c1, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a3215f563ba01d2837d919b6aaeb122ec">AST_FLAG_NBRIDGE</a>);
<a name="l05243"></a>05243          }
<a name="l05244"></a>05244          <span class="keywordflow">switch</span> (res) {
<a name="l05245"></a>05245          <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05ac83c1441a620f7bdae5ef84692f8e7a5">AST_BRIDGE_RETRY</a>:
<a name="l05246"></a>05246             <span class="keywordflow">if</span> (config-&gt;<a class="code" href="structast__bridge__config.html#af3d16394c849390df1c8f72569faeb37">play_warning</a>) {
<a name="l05247"></a>05247                <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(config, <a class="code" href="channel_8h.html#a7495a48740c9d555f7fbcb48246dbd93a2b65bf23f98d81b36f2f6898ee0aac16">AST_FEATURE_WARNING_ACTIVE</a>);
<a name="l05248"></a>05248             }
<a name="l05249"></a>05249             <span class="keywordflow">continue</span>;
<a name="l05250"></a>05250          <span class="keywordflow">default</span>:
<a name="l05251"></a>05251             <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Native bridging %s and %s ended\n&quot;</span>, c0-&gt;name, c1-&gt;name);
<a name="l05252"></a>05252             <span class="comment">/* fallthrough */</span>
<a name="l05253"></a>05253          <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05a4368c9e8d0072a09af3086c79790abfb">AST_BRIDGE_FAILED_NOWARN</a>:
<a name="l05254"></a>05254             nativefailed++;
<a name="l05255"></a>05255             <span class="keywordflow">break</span>;
<a name="l05256"></a>05256          }
<a name="l05257"></a>05257       }
<a name="l05258"></a>05258 
<a name="l05259"></a>05259       <span class="keywordflow">if</span> (((c0-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a> != c1-&gt;<a class="code" href="structast__channel.html#ab7786a0f5b9a9ebf83daed87be4f3868">readformat</a>) || (c0-&gt;<a class="code" href="structast__channel.html#ab7786a0f5b9a9ebf83daed87be4f3868">readformat</a> != c1-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a>) ||
<a name="l05260"></a>05260           (c0-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a> != o0nativeformats) || (c1-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a> != o1nativeformats)) &amp;&amp;
<a name="l05261"></a>05261           !(c0-&gt;<a class="code" href="structast__channel.html#a4e855ab0f984741b9083b2c5a0fdfe18">generator</a> || c1-&gt;<a class="code" href="structast__channel.html#a4e855ab0f984741b9083b2c5a0fdfe18">generator</a>)) {
<a name="l05262"></a>05262          <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a57646ce13ff95b5fc66dea2e741b21ff" title="Makes two channel formats compatible.">ast_channel_make_compatible</a>(c0, c1)) {
<a name="l05263"></a>05263             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Can&apos;t make %s and %s compatible\n&quot;</span>, c0-&gt;name, c1-&gt;name);
<a name="l05264"></a>05264             <a class="code" href="channel_8c.html#ab8a085dee0e97a277287d359ce7f4e4d" title="Send manager event for bridge link and unlink events.">manager_bridge_event</a>(0, 1, c0, c1);
<a name="l05265"></a>05265             <span class="keywordflow">return</span> <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05afcae35649bbc24a8c2080bec8d592c40">AST_BRIDGE_FAILED</a>;
<a name="l05266"></a>05266          }
<a name="l05267"></a>05267          o0nativeformats = c0-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>;
<a name="l05268"></a>05268          o1nativeformats = c1-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>;
<a name="l05269"></a>05269       }
<a name="l05270"></a>05270 
<a name="l05271"></a>05271       <a class="code" href="channel_8c.html#a6f45f5d6e87e9a0b9fc31b1f1109f741">update_bridge_vars</a>(c0, c1);
<a name="l05272"></a>05272 
<a name="l05273"></a>05273       res = <a class="code" href="channel_8c.html#a94b603f7b9476126cafc9e0b82dd7d4d">ast_generic_bridge</a>(c0, c1, config, fo, rc, config-&gt;<a class="code" href="structast__bridge__config.html#a1abaa6fad41461bdb3da343a2bee88c0">nexteventts</a>);
<a name="l05274"></a>05274       <span class="keywordflow">if</span> (res != <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05ac83c1441a620f7bdae5ef84692f8e7a5">AST_BRIDGE_RETRY</a>) {
<a name="l05275"></a>05275          <span class="keywordflow">break</span>;
<a name="l05276"></a>05276       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (config-&gt;<a class="code" href="structast__bridge__config.html#af083a5b636f7b870cea1aea1eeadf6ff">feature_timer</a>) {
<a name="l05277"></a>05277          <span class="comment">/* feature timer expired but has not been updated, sending to ast_bridge_call to do so */</span>
<a name="l05278"></a>05278          <span class="keywordflow">break</span>;
<a name="l05279"></a>05279       }
<a name="l05280"></a>05280    }
<a name="l05281"></a>05281 
<a name="l05282"></a>05282    <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(c0, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a668ac945c84f50becaca2a6134e64058">AST_FLAG_END_DTMF_ONLY</a>);
<a name="l05283"></a>05283    <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(c1, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a668ac945c84f50becaca2a6134e64058">AST_FLAG_END_DTMF_ONLY</a>);
<a name="l05284"></a>05284 
<a name="l05285"></a>05285    <span class="comment">/* Now that we have broken the bridge the source will change yet again */</span>
<a name="l05286"></a>05286    <a class="code" href="channel_8h.html#aef2af15a597c948e97628da6c5c84f28" title="Indicates condition of channel.">ast_indicate</a>(c0, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a009e81151b19671f42b5e84ab6a619f4">AST_CONTROL_SRCUPDATE</a>);
<a name="l05287"></a>05287    <a class="code" href="channel_8h.html#aef2af15a597c948e97628da6c5c84f28" title="Indicates condition of channel.">ast_indicate</a>(c1, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a009e81151b19671f42b5e84ab6a619f4">AST_CONTROL_SRCUPDATE</a>);
<a name="l05288"></a>05288 
<a name="l05289"></a>05289    c0-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a> = NULL;
<a name="l05290"></a>05290    c1-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a> = NULL;
<a name="l05291"></a>05291 
<a name="l05292"></a>05292    <span class="comment">/* \todo  XXX here should check that cid_num is not NULL */</span>
<a name="l05293"></a>05293    <a class="code" href="manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208" title="External routines may send asterisk manager events this way.">manager_event</a>(<a class="code" href="manager_8h.html#ab5db3cc603d7e798d61cb4cd94fbb4e2">EVENT_FLAG_CALL</a>, <span class="stringliteral">&quot;Unlink&quot;</span>,
<a name="l05294"></a>05294             <span class="stringliteral">&quot;Channel1: %s\r\n&quot;</span>
<a name="l05295"></a>05295             <span class="stringliteral">&quot;Channel2: %s\r\n&quot;</span>
<a name="l05296"></a>05296             <span class="stringliteral">&quot;Uniqueid1: %s\r\n&quot;</span>
<a name="l05297"></a>05297             <span class="stringliteral">&quot;Uniqueid2: %s\r\n&quot;</span>
<a name="l05298"></a>05298             <span class="stringliteral">&quot;CallerID1: %s\r\n&quot;</span>
<a name="l05299"></a>05299             <span class="stringliteral">&quot;CallerID2: %s\r\n&quot;</span>,
<a name="l05300"></a>05300             c0-&gt;name, c1-&gt;name, c0-&gt;uniqueid, c1-&gt;uniqueid, c0-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>, c1-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>);
<a name="l05301"></a>05301    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge stops bridging channels %s and %s\n&quot;</span>, c0-&gt;name, c1-&gt;name);
<a name="l05302"></a>05302 
<a name="l05303"></a>05303    <span class="keywordflow">return</span> res;
<a name="l05304"></a>05304 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac926f4e8ce2c5fccf5632510fd3d3cde"></a><!-- doxytag: member="channel.c::ast_channel_cmpwhentohangup" ref="ac926f4e8ce2c5fccf5632510fd3d3cde" args="(struct ast_channel *chan, time_t offset)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_channel_cmpwhentohangup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&nbsp;</td>
          <td class="paramname"> <em>offset</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Compare a offset with the settings of when to hang a channel up. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel on which to check for hang up </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>offset</em>&nbsp;</td><td>offset in seconds from current time </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>1, 0, or -1 This function compares a offset from current time with the absolute time out on a channel (when to hang up). If the absolute time out on a channel is earlier than current time plus the offset, it returns 1, if the two time <a class="el" href="structvalues.html">values</a> are equal, it return 0, otherwise, it return -1. </dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="channel_8h.html#a742eebbd38e247bf75ecc419683fa784" title="Compare a offset with the settings of when to hang a channel up.">ast_channel_cmpwhentohangup_tv()</a> </dd></dl>
<dl class="version"><dt><b>Version:</b></dt><dd>1.6.1 deprecated function (only had seconds precision) </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l00550">550</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l00535">ast_channel_cmpwhentohangup_tv()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00551"></a>00551 {
<a name="l00552"></a>00552    <span class="keyword">struct </span>timeval when = { offset, };
<a name="l00553"></a>00553    <span class="keywordflow">return</span> <a class="code" href="channel_8h.html#a742eebbd38e247bf75ecc419683fa784" title="Compare a offset with the settings of when to hang a channel up.">ast_channel_cmpwhentohangup_tv</a>(chan, when);
<a name="l00554"></a>00554 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a742eebbd38e247bf75ecc419683fa784"></a><!-- doxytag: member="channel.c::ast_channel_cmpwhentohangup_tv" ref="a742eebbd38e247bf75ecc419683fa784" args="(struct ast_channel *chan, struct timeval offset)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_channel_cmpwhentohangup_tv </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct timeval&nbsp;</td>
          <td class="paramname"> <em>offset</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Compare a offset with when to hangup channel. </p>
<p>Compare a offset with the settings of when to hang a channel up. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l00535">535</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="utils_8c_source.html#l01365">ast_tvadd()</a>, <a class="el" href="time_8h_source.html#l00089">ast_tvdiff_ms()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="time_8h_source.html#l00099">ast_tvzero()</a>, and <a class="el" href="channel_8h_source.html#l00441">ast_channel::whentohangup</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l00550">ast_channel_cmpwhentohangup()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00536"></a>00536 {
<a name="l00537"></a>00537    <span class="keyword">struct </span>timeval whentohangup;
<a name="l00538"></a>00538 
<a name="l00539"></a>00539    <span class="keywordflow">if</span> (<a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(chan-&gt;<a class="code" href="structast__channel.html#a645928dea02ce2132b83e7e61ef5b80a">whentohangup</a>))
<a name="l00540"></a>00540       <span class="keywordflow">return</span> <a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(offset) ? 0 : -1;
<a name="l00541"></a>00541 
<a name="l00542"></a>00542    <span class="keywordflow">if</span> (<a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(offset))
<a name="l00543"></a>00543       <span class="keywordflow">return</span> 1;
<a name="l00544"></a>00544 
<a name="l00545"></a>00545    whentohangup = <a class="code" href="time_8h.html#a97e1bb8fbd7a103212789e87e7ed6073" title="Returns the sum of two timevals a + b.">ast_tvadd</a>(offset, <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>());
<a name="l00546"></a>00546 
<a name="l00547"></a>00547    <span class="keywordflow">return</span> <a class="code" href="time_8h.html#a74e35cffcd45ad6cd7c8587921e8a4c2" title="Computes the difference (in milliseconds) between two struct timeval instances.">ast_tvdiff_ms</a>(whentohangup, chan-&gt;<a class="code" href="structast__channel.html#a645928dea02ce2132b83e7e61ef5b80a">whentohangup</a>);
<a name="l00548"></a>00548 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1ed3e98d33d5587948a0e2ef67a81f52"></a><!-- doxytag: member="channel.c::ast_channel_datastore_add" ref="a1ed3e98d33d5587948a0e2ef67a81f52" args="(struct ast_channel *chan, struct ast_datastore *datastore)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_channel_datastore_add </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__datastore.html">ast_datastore</a> *&nbsp;</td>
          <td class="paramname"> <em>datastore</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add a datastore to a channel. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>The channel should be locked before calling this function.</dd></dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>non-zero</em>&nbsp;</td><td>failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01534">1534</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00695">AST_LIST_INSERT_HEAD</a>.</p>

<p>Referenced by <a class="el" href="app__macro_8c_source.html#l00219">_macro_exec()</a>, <a class="el" href="func__curl_8c_source.html#l00163">acf_curlopt_write()</a>, <a class="el" href="chan__iax2_8c_source.html#l09409">acf_iaxvar_write()</a>, <a class="el" href="func__odbc_8c_source.html#l00375">acf_odbc_read()</a>, <a class="el" href="features_8c_source.html#l02374">add_features_datastores()</a>, <a class="el" href="res__agi_8c_source.html#l00500">add_to_agi()</a>, <a class="el" href="chan__iax2_8c_source.html#l05415">ast_iax2_new()</a>, <a class="el" href="audiohook_8c_source.html#l00893">audiohook_volume_get()</a>, <a class="el" href="chan__iax2_8c_source.html#l07812">authenticate_reply()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="pbx__dundi_8c_source.html#l03972">dundi_query_read()</a>, <a class="el" href="app__jack_8c_source.html#l00859">enable_jack_hook()</a>, <a class="el" href="func__enum_8c_source.html#l00251">enum_query_read()</a>, <a class="el" href="res__odbc_8c_source.html#l00204">find_transaction()</a>, <a class="el" href="func__lock_8c_source.html#l00211">get_lock()</a>, <a class="el" href="app__stack_8c_source.html#l00328">gosub_exec()</a>, <a class="el" href="pbx__lua_8c_source.html#l01082">lua_get_state()</a>, <a class="el" href="pbx_8c_source.html#l02995">pbx_builtin_raise_exception()</a>, <a class="el" href="app__chanspy_8c_source.html#l00716">setup_chanspy_ds()</a>, <a class="el" href="func__audiohookinherit_8c_source.html#l00154">setup_inheritance_datastore()</a>, <a class="el" href="app__mixmonitor_8c_source.html#l00366">setup_mixmonitor_ds()</a>, <a class="el" href="app__queue_8c_source.html#l03487">setup_transfer_datastore()</a>, <a class="el" href="func__global_8c_source.html#l00176">shared_write()</a>, <a class="el" href="res__smdi_8c_source.html#l01122">smdi_msg_retrieve_read()</a>, <a class="el" href="chan__iax2_8c_source.html#l09458">socket_process()</a>, <a class="el" href="app__speech__utils_8c_source.html#l00484">speech_create()</a>, <a class="el" href="func__speex_8c_source.html#l00194">speex_write()</a>, <a class="el" href="app__queue_8c_source.html#l03569">try_calling()</a>, and <a class="el" href="func__volume_8c_source.html#l00121">volume_write()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01535"></a>01535 {
<a name="l01536"></a>01536    <span class="keywordtype">int</span> res = 0;
<a name="l01537"></a>01537 
<a name="l01538"></a>01538    <a class="code" href="linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307" title="Inserts a list entry at the head of a list.">AST_LIST_INSERT_HEAD</a>(&amp;chan-&gt;datastores, datastore, entry);
<a name="l01539"></a>01539 
<a name="l01540"></a>01540    <span class="keywordflow">return</span> res;
<a name="l01541"></a>01541 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aac02d8cdcc95c07bf2fd705c7485255f"></a><!-- doxytag: member="channel.c::ast_channel_datastore_alloc" ref="aac02d8cdcc95c07bf2fd705c7485255f" args="(const struct ast_datastore_info *info, const char *uid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__datastore.html">ast_datastore</a>* ast_channel_datastore_alloc </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structast__datastore__info.html">ast_datastore_info</a> *&nbsp;</td>
          <td class="paramname"> <em>info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>uid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create a channel data store object. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>None of the datastore API calls lock the <a class="el" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> they are using. So, the channel should be locked before calling the functions that take a channel argument.</dd></dl>
<dl class="deprecated"><dt><b><a class="el" href="deprecated.html#_deprecated000001">Deprecated:</a></b></dt><dd>You should use the <a class="el" href="datastore_8h.html#a666afb07fd77d50782cc10f83e029159">ast_datastore_alloc()</a> generic function instead. </dd></dl>
<dl class="version"><dt><b>Version:</b></dt><dd>1.6.1 deprecated </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01507">1507</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="datastore_8h_source.html#l00071">ast_datastore_alloc</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01508"></a>01508 {
<a name="l01509"></a>01509    <span class="keywordflow">return</span> <a class="code" href="datastore_8h.html#a666afb07fd77d50782cc10f83e029159">ast_datastore_alloc</a>(info, uid);
<a name="l01510"></a>01510 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aad1e09cd7c79237d05cffb45d6cdfd7c"></a><!-- doxytag: member="channel.c::ast_channel_datastore_find" ref="aad1e09cd7c79237d05cffb45d6cdfd7c" args="(struct ast_channel *chan, const struct ast_datastore_info *info, const char *uid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__datastore.html">ast_datastore</a>* ast_channel_datastore_find </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structast__datastore__info.html">ast_datastore_info</a> *&nbsp;</td>
          <td class="paramname"> <em>info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>uid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find a datastore on a channel. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>The channel should be locked before calling this function.</dd>
<dd>
The datastore returned from this function must not be used if the reference to the channel is released.</dd></dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pointer</em>&nbsp;</td><td>to the datastore if found </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>NULL</em>&nbsp;</td><td>if not found </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01548">1548</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00528">AST_LIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h_source.html#l00599">AST_LIST_TRAVERSE_SAFE_END</a>, <a class="el" href="datastore_8h_source.html#l00057">ast_datastore::info</a>, and <a class="el" href="datastore_8h_source.html#l00055">ast_datastore::uid</a>.</p>

<p>Referenced by <a class="el" href="app__macro_8c_source.html#l00219">_macro_exec()</a>, <a class="el" href="func__curl_8c_source.html#l00397">acf_curl_exec()</a>, <a class="el" href="func__curl_8c_source.html#l00282">acf_curlopt_read()</a>, <a class="el" href="func__curl_8c_source.html#l00163">acf_curlopt_write()</a>, <a class="el" href="pbx_8c_source.html#l03028">acf_exception_read()</a>, <a class="el" href="func__odbc_8c_source.html#l00699">acf_fetch()</a>, <a class="el" href="chan__iax2_8c_source.html#l09386">acf_iaxvar_read()</a>, <a class="el" href="chan__iax2_8c_source.html#l09409">acf_iaxvar_write()</a>, <a class="el" href="res__agi_8c_source.html#l00467">add_agi_cmd()</a>, <a class="el" href="features_8c_source.html#l02374">add_features_datastores()</a>, <a class="el" href="res__agi_8c_source.html#l00500">add_to_agi()</a>, <a class="el" href="res__odbc_8c_source.html#l01342">ast_odbc_retrieve_transaction_obj()</a>, <a class="el" href="app__queue_8c_source.html#l03480">attended_transfer_occurred()</a>, <a class="el" href="audiohook_8c_source.html#l00855">audiohook_volume_callback()</a>, <a class="el" href="audiohook_8c_source.html#l00893">audiohook_volume_get()</a>, <a class="el" href="features_8c_source.html#l01396">builtin_atxfer()</a>, <a class="el" href="app__chanspy_8c_source.html#l00684">chanspy_ds_free()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="app__jack_8c_source.html#l00920">disable_jack_hook()</a>, <a class="el" href="pbx__dundi_8c_source.html#l04045">dundi_result_read()</a>, <a class="el" href="app__jack_8c_source.html#l00859">enable_jack_hook()</a>, <a class="el" href="func__enum_8c_source.html#l00316">enum_result_read()</a>, <a class="el" href="func__odbc_8c_source.html#l00735">exec_odbcfinish()</a>, <a class="el" href="app__speech__utils_8c_source.html#l00270">find_speech()</a>, <a class="el" href="res__odbc_8c_source.html#l00204">find_transaction()</a>, <a class="el" href="func__audiohookinherit_8c_source.html#l00207">func_inheritance_write()</a>, <a class="el" href="res__agi_8c_source.html#l00446">get_agi_cmd()</a>, <a class="el" href="func__lock_8c_source.html#l00211">get_lock()</a>, <a class="el" href="app__stack_8c_source.html#l00328">gosub_exec()</a>, <a class="el" href="app__stack_8c_source.html#l00550">handle_gosub()</a>, <a class="el" href="chan__iax2_8c_source.html#l04777">iax2_call()</a>, <a class="el" href="app__jack_8c_source.html#l00819">jack_hook_callback()</a>, <a class="el" href="app__stack_8c_source.html#l00455">local_read()</a>, <a class="el" href="app__stack_8c_source.html#l00487">local_write()</a>, <a class="el" href="func__lock_8c_source.html#l00143">lock_fixup()</a>, <a class="el" href="pbx__lua_8c_source.html#l01082">lua_get_state()</a>, <a class="el" href="features_8c_source.html#l03009">manage_parkinglot()</a>, <a class="el" href="res__odbc_8c_source.html#l00339">mark_transaction_active()</a>, <a class="el" href="features_8c_source.html#l03335">park_exec_full()</a>, <a class="el" href="pbx_8c_source.html#l02995">pbx_builtin_raise_exception()</a>, <a class="el" href="app__stack_8c_source.html#l00270">pop_exec()</a>, <a class="el" href="app__queue_8c_source.html#l03449">queue_transfer_fixup()</a>, <a class="el" href="res__odbc_8c_source.html#l00287">release_transaction()</a>, <a class="el" href="app__stack_8c_source.html#l00294">return_exec()</a>, <a class="el" href="func__global_8c_source.html#l00128">shared_read()</a>, <a class="el" href="func__global_8c_source.html#l00176">shared_write()</a>, <a class="el" href="res__smdi_8c_source.html#l01221">smdi_msg_read()</a>, <a class="el" href="app__speech__utils_8c_source.html#l00639">speech_background()</a>, <a class="el" href="app__speech__utils_8c_source.html#l00891">speech_destroy()</a>, <a class="el" href="func__speex_8c_source.html#l00140">speex_callback()</a>, <a class="el" href="func__speex_8c_source.html#l00305">speex_read()</a>, <a class="el" href="func__speex_8c_source.html#l00194">speex_write()</a>, <a class="el" href="app__mixmonitor_8c_source.html#l00550">stop_mixmonitor_exec()</a>, <a class="el" href="app__queue_8c_source.html#l03569">try_calling()</a>, <a class="el" href="func__lock_8c_source.html#l00364">unlock_read()</a>, <a class="el" href="func__volume_8c_source.html#l00082">volume_callback()</a>, and <a class="el" href="func__volume_8c_source.html#l00121">volume_write()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01549"></a>01549 {
<a name="l01550"></a>01550    <span class="keyword">struct </span><a class="code" href="structast__datastore.html" title="Structure for a data store object.">ast_datastore</a> *datastore = NULL;
<a name="l01551"></a>01551    
<a name="l01552"></a>01552    <span class="keywordflow">if</span> (info == NULL)
<a name="l01553"></a>01553       <span class="keywordflow">return</span> NULL;
<a name="l01554"></a>01554 
<a name="l01555"></a>01555    <a class="code" href="linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d" title="Loops safely over (traverses) the entries in a list.">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(&amp;chan-&gt;datastores, datastore, entry) {
<a name="l01556"></a>01556       <span class="keywordflow">if</span> (datastore-&gt;<a class="code" href="structast__datastore.html#ac63f10c4295eed928ba083bcdff5500c">info</a> != info) {
<a name="l01557"></a>01557          <span class="keywordflow">continue</span>;
<a name="l01558"></a>01558       }
<a name="l01559"></a>01559 
<a name="l01560"></a>01560       <span class="keywordflow">if</span> (<a class="code" href="structast__datastore.html#a2daadcdbac635c83b7bfc6375b4c9be4">uid</a> == NULL) {
<a name="l01561"></a>01561          <span class="comment">/* matched by type only */</span>
<a name="l01562"></a>01562          <span class="keywordflow">break</span>;
<a name="l01563"></a>01563       }
<a name="l01564"></a>01564 
<a name="l01565"></a>01565       <span class="keywordflow">if</span> ((datastore-&gt;<a class="code" href="structast__datastore.html#a2daadcdbac635c83b7bfc6375b4c9be4">uid</a> != NULL) &amp;&amp; !strcasecmp(<a class="code" href="structast__datastore.html#a2daadcdbac635c83b7bfc6375b4c9be4">uid</a>, datastore-&gt;<a class="code" href="structast__datastore.html#a2daadcdbac635c83b7bfc6375b4c9be4">uid</a>)) {
<a name="l01566"></a>01566          <span class="comment">/* Matched by type AND uid */</span>
<a name="l01567"></a>01567          <span class="keywordflow">break</span>;
<a name="l01568"></a>01568       }
<a name="l01569"></a>01569    }
<a name="l01570"></a>01570    <a class="code" href="linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9" title="Closes a safe loop traversal block.">AST_LIST_TRAVERSE_SAFE_END</a>;
<a name="l01571"></a>01571 
<a name="l01572"></a>01572    <span class="keywordflow">return</span> datastore;
<a name="l01573"></a>01573 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab6fba293c76b4a30ba1a240df068a863"></a><!-- doxytag: member="channel.c::ast_channel_datastore_free" ref="ab6fba293c76b4a30ba1a240df068a863" args="(struct ast_datastore *datastore)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_channel_datastore_free </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__datastore.html">ast_datastore</a> *&nbsp;</td>
          <td class="paramname"> <em>datastore</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Free a channel data store object. </p>
<dl class="deprecated"><dt><b><a class="el" href="deprecated.html#_deprecated000002">Deprecated:</a></b></dt><dd>You should use the <a class="el" href="datastore_8h.html#aee27286888b30c6448a9bce928040a14" title="Free a data store object.">ast_datastore_free()</a> generic function instead. </dd></dl>
<dl class="version"><dt><b>Version:</b></dt><dd>1.6.1 deprecated </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01512">1512</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="datastore_8c_source.html#l00058">ast_datastore_free()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01513"></a>01513 {
<a name="l01514"></a>01514    <span class="keywordflow">return</span> <a class="code" href="datastore_8h.html#aee27286888b30c6448a9bce928040a14" title="Free a data store object.">ast_datastore_free</a>(datastore);
<a name="l01515"></a>01515 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6ce892974f59537bda03a71319b452e2"></a><!-- doxytag: member="channel.c::ast_channel_datastore_inherit" ref="a6ce892974f59537bda03a71319b452e2" args="(struct ast_channel *from, struct ast_channel *to)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_channel_datastore_inherit </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>from</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>to</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Inherit datastores from a parent to a child. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01517">1517</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="datastore_8h_source.html#l00071">ast_datastore_alloc</a>, <a class="el" href="linkedlists_8h_source.html#l00715">AST_LIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="datastore_8h_source.html#l00056">ast_datastore::data</a>, <a class="el" href="channel_8h_source.html#l00151">DATASTORE_INHERIT_FOREVER</a>, <a class="el" href="structast__datastore__info.html#a6f43e05fad78ca72d993e3afc7c2b764">ast_datastore_info::duplicate</a>, <a class="el" href="datastore_8h_source.html#l00057">ast_datastore::info</a>, <a class="el" href="datastore_8h_source.html#l00058">ast_datastore::inheritance</a>, and <a class="el" href="datastore_8h_source.html#l00055">ast_datastore::uid</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l03851">__ast_request_and_dial()</a>, <a class="el" href="channel_8c_source.html#l03779">ast_call_forward()</a>, <a class="el" href="dial_8c_source.html#l00255">begin_dial_channel()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="app__dial_8c_source.html#l00712">do_forward()</a>, <a class="el" href="app__followme_8c_source.html#l00777">findmeexec()</a>, <a class="el" href="chan__local_8c_source.html#l00518">local_call()</a>, <a class="el" href="app__queue_8c_source.html#l02467">ring_entry()</a>, and <a class="el" href="app__queue_8c_source.html#l02845">wait_for_answer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01518"></a>01518 {
<a name="l01519"></a>01519    <span class="keyword">struct </span><a class="code" href="structast__datastore.html" title="Structure for a data store object.">ast_datastore</a> *datastore = NULL, *datastore2;
<a name="l01520"></a>01520 
<a name="l01521"></a>01521    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;from-&gt;datastores, datastore, entry) {
<a name="l01522"></a>01522       <span class="keywordflow">if</span> (datastore-&gt;<a class="code" href="structast__datastore.html#a79d869daa2e63a92b3e5f542446031bb">inheritance</a> &gt; 0) {
<a name="l01523"></a>01523          datastore2 = <a class="code" href="datastore_8h.html#a666afb07fd77d50782cc10f83e029159">ast_datastore_alloc</a>(datastore-&gt;<a class="code" href="structast__datastore.html#ac63f10c4295eed928ba083bcdff5500c">info</a>, datastore-&gt;<a class="code" href="structast__datastore.html#a2daadcdbac635c83b7bfc6375b4c9be4">uid</a>);
<a name="l01524"></a>01524          <span class="keywordflow">if</span> (datastore2) {
<a name="l01525"></a>01525             datastore2-&gt;data = datastore-&gt;<a class="code" href="structast__datastore.html#ac63f10c4295eed928ba083bcdff5500c">info</a>-&gt;<a class="code" href="structast__datastore__info.html#a6f43e05fad78ca72d993e3afc7c2b764">duplicate</a> ? datastore-&gt;<a class="code" href="structast__datastore.html#ac63f10c4295eed928ba083bcdff5500c">info</a>-&gt;<a class="code" href="structast__datastore__info.html#a6f43e05fad78ca72d993e3afc7c2b764">duplicate</a>(datastore-&gt;<a class="code" href="structast__datastore.html#a735984d41155bc1032e09bece8f8d66d">data</a>) : NULL;
<a name="l01526"></a>01526             datastore2-&gt;inheritance = datastore-&gt;<a class="code" href="structast__datastore.html#a79d869daa2e63a92b3e5f542446031bb">inheritance</a> == <a class="code" href="channel_8h.html#a3a32e3014998d0066281c4dd8e278ae9">DATASTORE_INHERIT_FOREVER</a> ? <a class="code" href="channel_8h.html#a3a32e3014998d0066281c4dd8e278ae9">DATASTORE_INHERIT_FOREVER</a> : datastore-&gt;<a class="code" href="structast__datastore.html#a79d869daa2e63a92b3e5f542446031bb">inheritance</a> - 1;
<a name="l01527"></a>01527             <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;to-&gt;datastores, datastore2, entry);
<a name="l01528"></a>01528          }
<a name="l01529"></a>01529       }
<a name="l01530"></a>01530    }
<a name="l01531"></a>01531    <span class="keywordflow">return</span> 0;
<a name="l01532"></a>01532 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1ff1c62b6d50823da93a920575c9c0c9"></a><!-- doxytag: member="channel.c::ast_channel_datastore_remove" ref="a1ff1c62b6d50823da93a920575c9c0c9" args="(struct ast_channel *chan, struct ast_datastore *datastore)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_channel_datastore_remove </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__datastore.html">ast_datastore</a> *&nbsp;</td>
          <td class="paramname"> <em>datastore</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Remove a datastore from a channel. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>The channel should be locked before calling this function.</dd></dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>non-zero</em>&nbsp;</td><td>failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01543">1543</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00838">AST_LIST_REMOVE</a>.</p>

<p>Referenced by <a class="el" href="func__odbc_8c_source.html#l00699">acf_fetch()</a>, <a class="el" href="app__chanspy_8c_source.html#l00684">chanspy_ds_free()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="app__jack_8c_source.html#l00920">disable_jack_hook()</a>, <a class="el" href="func__odbc_8c_source.html#l00735">exec_odbcfinish()</a>, <a class="el" href="pbx__lua_8c_source.html#l01082">lua_get_state()</a>, <a class="el" href="app__queue_8c_source.html#l03449">queue_transfer_fixup()</a>, <a class="el" href="app__speech__utils_8c_source.html#l00639">speech_background()</a>, <a class="el" href="app__speech__utils_8c_source.html#l00891">speech_destroy()</a>, <a class="el" href="func__speex_8c_source.html#l00194">speex_write()</a>, <a class="el" href="app__mixmonitor_8c_source.html#l00550">stop_mixmonitor_exec()</a>, and <a class="el" href="app__queue_8c_source.html#l03569">try_calling()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01544"></a>01544 {
<a name="l01545"></a>01545    <span class="keywordflow">return</span> <a class="code" href="linkedlists_8h.html#aa36e72b77f1b80881cd0a9fcca66ce19" title="Removes a specific entry from a list.">AST_LIST_REMOVE</a>(&amp;chan-&gt;datastores, datastore, entry) ? 0 : -1;
<a name="l01546"></a>01546 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aeaeb784665c384163aefb975ddf8bbe8"></a><!-- doxytag: member="channel.c::ast_channel_defer_dtmf" ref="aeaeb784665c384163aefb975ddf8bbe8" args="(struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_channel_defer_dtmf </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set defer DTMF flag on channel. </p>
<p>Defers DTMF</p>
<p>Defer DTMF so that you only read things like hangups and audio. Returns non-zero if channel was already DTMF-deferred or 0 if channel is just now being DTMF-deferred </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01146">1146</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00523">AST_FLAG_DEFER_DTMF</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, and <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>.</p>

<p>Referenced by <a class="el" href="res__adsi_8c_source.html#l00193">__adsi_transmit_messages()</a>, and <a class="el" href="chan__iax2_8c_source.html#l13074">find_cache()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01147"></a>01147 {
<a name="l01148"></a>01148    <span class="keywordtype">int</span> pre = 0;
<a name="l01149"></a>01149 
<a name="l01150"></a>01150    <span class="keywordflow">if</span> (chan) {
<a name="l01151"></a>01151       pre = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329ab05edf1bf82b02f5987de92a6960a9bd">AST_FLAG_DEFER_DTMF</a>);
<a name="l01152"></a>01152       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329ab05edf1bf82b02f5987de92a6960a9bd">AST_FLAG_DEFER_DTMF</a>);
<a name="l01153"></a>01153    }
<a name="l01154"></a>01154    <span class="keywordflow">return</span> pre;
<a name="l01155"></a>01155 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aef0540461d88daff61e411841ae264ae"></a><!-- doxytag: member="channel.c::ast_channel_early_bridge" ref="aef0540461d88daff61e411841ae264ae" args="(struct ast_channel *c0, struct ast_channel *c1)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_channel_early_bridge </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c1</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Bridge two <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> together (early). </p>
<p>Bridge two <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> together (early) </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c0</em>&nbsp;</td><td>first channel to bridge </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>c1</em>&nbsp;</td><td>second channel to bridge Bridge two <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> (c0 and c1) together early. This implies either side may not be answered yet. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns 0 on success and -1 if it could not be done </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l04957">4957</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="structast__channel__tech.html#a3e75c9ace9859fff6c6c75c9059d14d6">ast_channel_tech::early_bridge</a>, and <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>.</p>

<p>Referenced by <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, and <a class="el" href="app__dial_8c_source.html#l00818">wait_for_answer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04958"></a>04958 {
<a name="l04959"></a>04959    <span class="comment">/* Make sure we can early bridge, if not error out */</span>
<a name="l04960"></a>04960    <span class="keywordflow">if</span> (!c0-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a3e75c9ace9859fff6c6c75c9059d14d6" title="Bridge two channels of the same type together (early).">early_bridge</a> || (c1 &amp;&amp; (!c1-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a3e75c9ace9859fff6c6c75c9059d14d6" title="Bridge two channels of the same type together (early).">early_bridge</a> || c0-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a3e75c9ace9859fff6c6c75c9059d14d6" title="Bridge two channels of the same type together (early).">early_bridge</a> != c1-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a3e75c9ace9859fff6c6c75c9059d14d6" title="Bridge two channels of the same type together (early).">early_bridge</a>)))
<a name="l04961"></a>04961       <span class="keywordflow">return</span> -1;
<a name="l04962"></a>04962 
<a name="l04963"></a>04963    <span class="keywordflow">return</span> c0-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a3e75c9ace9859fff6c6c75c9059d14d6" title="Bridge two channels of the same type together (early).">early_bridge</a>(c0, c1);
<a name="l04964"></a>04964 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9ad2da80ecc312fb4273e45f5ebb6774"></a><!-- doxytag: member="channel.c::ast_channel_free" ref="a9ad2da80ecc312fb4273e45f5ebb6774" args="(struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_channel_free </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Free a channel structure. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01388">1388</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00481">ast_channel::alertpipe</a>, <a class="el" href="app_8c_source.html#l01113">ast_app_group_discard()</a>, <a class="el" href="cdr_8c_source.html#l00441">ast_cdr_discard()</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="channel_8h_source.html#l00136">AST_CHANNEL_NAME</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="datastore_8c_source.html#l00058">ast_datastore_free()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="devicestate_8h_source.html#l00052">AST_DEVICE_UNKNOWN</a>, <a class="el" href="devicestate_8c_source.html#l00465">ast_devstate_changed_literal()</a>, <a class="el" href="channel_8h_source.html#l00567">AST_FLAG_IN_CHANNEL_LIST</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="frame_8h_source.html#l00462">ast_frfree</a>, <a class="el" href="abstract__jb_8c_source.html#l00530">ast_jb_destroy()</a>, <a class="el" href="linkedlists_8h_source.html#l00817">AST_LIST_REMOVE_HEAD</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8h_source.html#l00153">AST_MAX_FDS</a>, <a class="el" href="channel_8c_source.html#l05555">ast_moh_cleanup()</a>, <a class="el" href="lock_8h_source.html#l01712">ast_mutex_destroy()</a>, <a class="el" href="linkedlists_8h_source.html#l00860">AST_RWLIST_REMOVE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="stringfields_8h_source.html#l00245">ast_string_field_free_memory</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="timing_8c_source.html#l00146">ast_timer_close()</a>, <a class="el" href="indications_8h_source.html#l00201">ast_tone_zone_unref()</a>, <a class="el" href="translate_8c_source.html#l00253">ast_translator_free_path()</a>, <a class="el" href="chanvars_8c_source.html#l00059">ast_var_delete()</a>, <a class="el" href="channel_8h_source.html#l00422">ast_channel::cdr</a>, <a class="el" href="channel_8h_source.html#l00444">ast_channel::cid</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="astmm_8h_source.html#l00084">free</a>, <a class="el" href="channel_8c_source.html#l01372">free_cid()</a>, <a class="el" href="channel_8h_source.html#l00443">ast_channel::lock_dont_use</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="channel_8h_source.html#l00425">ast_channel::monitor</a>, <a class="el" href="channel_8h_source.html#l00402">ast_channel::music_state</a>, <a class="el" href="cdr__adaptive__odbc_8c_source.html#l00053">name</a>, <a class="el" href="channel_8h_source.html#l00418">ast_channel::pbx</a>, <a class="el" href="channel_8h_source.html#l00420">ast_channel::readtrans</a>, <a class="el" href="channel_8h_source.html#l00413">ast_channel::sched</a>, <a class="el" href="sched_8c_source.html#l00260">sched_context_destroy()</a>, <a class="el" href="structast__channel__monitor.html#ad5c0f502e23625be7e65715c03c54748">ast_channel_monitor::stop</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, <a class="el" href="channel_8h_source.html#l00499">ast_channel::timer</a>, <a class="el" href="channel_8h_source.html#l00446">ast_channel::varshead</a>, <a class="el" href="channel_8h_source.html#l00419">ast_channel::writetrans</a>, and <a class="el" href="channel_8h_source.html#l00423">ast_channel::zone</a>.</p>

<p>Referenced by <a class="el" href="func__odbc_8c_source.html#l00375">acf_odbc_read()</a>, <a class="el" href="func__odbc_8c_source.html#l00203">acf_odbc_write()</a>, <a class="el" href="manager_8c_source.html#l01847">action_getvar()</a>, <a class="el" href="chan__agent_8c_source.html#l00458">agent_cleanup()</a>, <a class="el" href="chan__agent_8c_source.html#l01086">agent_new()</a>, <a class="el" href="channel_8c_source.html#l04393">ast_do_masquerade()</a>, <a class="el" href="channel_8c_source.html#l01690">ast_hangup()</a>, <a class="el" href="chan__iax2_8c_source.html#l05415">ast_iax2_new()</a>, <a class="el" href="pbx_8c_source.html#l07914">ast_pbx_outgoing_cdr_failed()</a>, <a class="el" href="chan__bridge_8c_source.html#l00193">bridge_request()</a>, <a class="el" href="func__odbc_8c_source.html#l00978">cli_odbc_read()</a>, <a class="el" href="func__odbc_8c_source.html#l01177">cli_odbc_write()</a>, <a class="el" href="chan__gtalk_8c_source.html#l01154">gtalk_newcall()</a>, <a class="el" href="chan__local_8c_source.html#l00734">local_new()</a>, <a class="el" href="app__voicemail_8c_source.html#l04163">make_email_file()</a>, <a class="el" href="pbx_8c_source.html#l03403">pbx_substitute_variables_helper_full()</a>, <a class="el" href="logger_8c_source.html#l00500">rotate_file()</a>, <a class="el" href="app__minivm_8c_source.html#l01027">sendmail()</a>, and <a class="el" href="app__voicemail_8c_source.html#l04513">sendpage()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01389"></a>01389 {
<a name="l01390"></a>01390    <span class="keywordtype">int</span> fd;
<a name="l01391"></a>01391 <span class="preprocessor">#ifdef HAVE_EPOLL</span>
<a name="l01392"></a>01392 <span class="preprocessor"></span>   <span class="keywordtype">int</span> i;
<a name="l01393"></a>01393 <span class="preprocessor">#endif</span>
<a name="l01394"></a>01394 <span class="preprocessor"></span>   <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a> *vardata;
<a name="l01395"></a>01395    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l01396"></a>01396    <span class="keyword">struct </span>varshead *headp;
<a name="l01397"></a>01397    <span class="keyword">struct </span><a class="code" href="structast__datastore.html" title="Structure for a data store object.">ast_datastore</a> *datastore = NULL;
<a name="l01398"></a>01398    <span class="keywordtype">char</span> <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>[<a class="code" href="channel_8h.html#ab57c278099ea5f8d7cedbb41eba58b56">AST_CHANNEL_NAME</a>], *dashptr;
<a name="l01399"></a>01399    <span class="keywordtype">int</span> inlist;
<a name="l01400"></a>01400    
<a name="l01401"></a>01401    headp=&amp;chan-&gt;<a class="code" href="structast__channel.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>;
<a name="l01402"></a>01402    
<a name="l01403"></a>01403    inlist = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a88ca779e8fdb868f32d38ed94a75ff53">AST_FLAG_IN_CHANNEL_LIST</a>);
<a name="l01404"></a>01404    <span class="keywordflow">if</span> (inlist) {
<a name="l01405"></a>01405       <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>);
<a name="l01406"></a>01406       <span class="keywordflow">if</span> (!<a class="code" href="linkedlists_8h.html#a6091f0518f8b6f443fd9f5150f3ac407">AST_RWLIST_REMOVE</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>, chan, <a class="code" href="structchan__list.html" title="Channel call record structure.">chan_list</a>)) {
<a name="l01407"></a>01407          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Unable to find channel in list to free. Assuming it has already been done.\n&quot;</span>);
<a name="l01408"></a>01408       }
<a name="l01409"></a>01409       <span class="comment">/* Lock and unlock the channel just to be sure nobody has it locked still</span>
<a name="l01410"></a>01410 <span class="comment">         due to a reference retrieved from the channel list. */</span>
<a name="l01411"></a>01411       <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l01412"></a>01412       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l01413"></a>01413    }
<a name="l01414"></a>01414 
<a name="l01415"></a>01415    <span class="comment">/* Get rid of each of the data stores on the channel */</span>
<a name="l01416"></a>01416    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l01417"></a>01417    <span class="keywordflow">while</span> ((datastore = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;chan-&gt;datastores, entry)))
<a name="l01418"></a>01418       <span class="comment">/* Free the data store */</span>
<a name="l01419"></a>01419       <a class="code" href="datastore_8h.html#aee27286888b30c6448a9bce928040a14" title="Free a data store object.">ast_datastore_free</a>(datastore);
<a name="l01420"></a>01420    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l01421"></a>01421 
<a name="l01422"></a>01422    <span class="comment">/* Lock and unlock the channel just to be sure nobody has it locked still</span>
<a name="l01423"></a>01423 <span class="comment">      due to a reference that was stored in a datastore. (i.e. app_chanspy) */</span>
<a name="l01424"></a>01424    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l01425"></a>01425    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l01426"></a>01426 
<a name="l01427"></a>01427    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>) {
<a name="l01428"></a>01428       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Channel &apos;%s&apos; may not have been hung up properly\n&quot;</span>, chan-&gt;name);
<a name="l01429"></a>01429       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(chan-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>);
<a name="l01430"></a>01430    }
<a name="l01431"></a>01431 
<a name="l01432"></a>01432    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#aea6233539fc73fc5303bf7525ec27e73">sched</a>)
<a name="l01433"></a>01433       <a class="code" href="sched_8h.html#a7350994bcfd1be91874493dbe25faf0c" title="destroys a schedule context Destroys (free&amp;#39;s) the given sched_context structure...">sched_context_destroy</a>(chan-&gt;<a class="code" href="structast__channel.html#aea6233539fc73fc5303bf7525ec27e73">sched</a>);
<a name="l01434"></a>01434 
<a name="l01435"></a>01435    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(name, chan-&gt;name, <span class="keyword">sizeof</span>(name));
<a name="l01436"></a>01436    <span class="keywordflow">if</span> ((dashptr = strrchr(name, <span class="charliteral">&apos;-&apos;</span>))) {
<a name="l01437"></a>01437       *dashptr = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01438"></a>01438    }
<a name="l01439"></a>01439 
<a name="l01440"></a>01440    <span class="comment">/* Stop monitoring */</span>
<a name="l01441"></a>01441    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a4254cefdfaeb5200f89e7ba3ae6f0922">monitor</a>)
<a name="l01442"></a>01442       chan-&gt;<a class="code" href="structast__channel.html#a4254cefdfaeb5200f89e7ba3ae6f0922">monitor</a>-&gt;<a class="code" href="structast__channel__monitor.html#ad5c0f502e23625be7e65715c03c54748">stop</a>( chan, 0 );
<a name="l01443"></a>01443 
<a name="l01444"></a>01444    <span class="comment">/* If there is native format music-on-hold state, free it */</span>
<a name="l01445"></a>01445    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a80a9a0d24139c1d84463de5e88248491">music_state</a>)
<a name="l01446"></a>01446       <a class="code" href="musiconhold_8h.html#a2bfbbbb8be5c8a13ec5a054bbc9f25b1">ast_moh_cleanup</a>(chan);
<a name="l01447"></a>01447 
<a name="l01448"></a>01448    <span class="comment">/* Free translators */</span>
<a name="l01449"></a>01449    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a9601e6aff2a4c59cbeb9d6fef81184f4">readtrans</a>)
<a name="l01450"></a>01450       <a class="code" href="translate_8h.html#a8f767bf5c2095f182e7cbaa73e391207" title="Frees a translator path Frees the given translator path structure.">ast_translator_free_path</a>(chan-&gt;<a class="code" href="structast__channel.html#a9601e6aff2a4c59cbeb9d6fef81184f4">readtrans</a>);
<a name="l01451"></a>01451    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a58d0c117fa64b075eda1d9a7a7d73531">writetrans</a>)
<a name="l01452"></a>01452       <a class="code" href="translate_8h.html#a8f767bf5c2095f182e7cbaa73e391207" title="Frees a translator path Frees the given translator path structure.">ast_translator_free_path</a>(chan-&gt;<a class="code" href="structast__channel.html#a58d0c117fa64b075eda1d9a7a7d73531">writetrans</a>);
<a name="l01453"></a>01453    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#aebc9ecdf679da616c7d975b827e1f4b4">pbx</a>)
<a name="l01454"></a>01454       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;PBX may not have been terminated properly on &apos;%s&apos;\n&quot;</span>, chan-&gt;name);
<a name="l01455"></a>01455    <a class="code" href="channel_8c.html#a2bbdbf1f645a90d6271f82c79c0fb2cc">free_cid</a>(&amp;chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>);
<a name="l01456"></a>01456    <span class="comment">/* Close pipes if appropriate */</span>
<a name="l01457"></a>01457    <span class="keywordflow">if</span> ((fd = chan-&gt;<a class="code" href="structast__channel.html#a249765022c528d61c3ab376660b64d0e">alertpipe</a>[0]) &gt; -1)
<a name="l01458"></a>01458       close(fd);
<a name="l01459"></a>01459    <span class="keywordflow">if</span> ((fd = chan-&gt;<a class="code" href="structast__channel.html#a249765022c528d61c3ab376660b64d0e">alertpipe</a>[1]) &gt; -1)
<a name="l01460"></a>01460       close(fd);
<a name="l01461"></a>01461    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a9aed6490b63794e6c9c00af4533f255f">timer</a>) {
<a name="l01462"></a>01462       <a class="code" href="timing_8h.html#a2a5968baf9962dedeeda855fd5ed9c75" title="Close an opened timing handle.">ast_timer_close</a>(chan-&gt;<a class="code" href="structast__channel.html#a9aed6490b63794e6c9c00af4533f255f">timer</a>);
<a name="l01463"></a>01463    }
<a name="l01464"></a>01464 <span class="preprocessor">#ifdef HAVE_EPOLL</span>
<a name="l01465"></a>01465 <span class="preprocessor"></span>   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="channel_8h.html#aa3fc504e7ca90586e4d249831838de3c">AST_MAX_FDS</a>; i++) {
<a name="l01466"></a>01466       <span class="keywordflow">if</span> (chan-&gt;epfd_data[i])
<a name="l01467"></a>01467          <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(chan-&gt;epfd_data[i]);
<a name="l01468"></a>01468    }
<a name="l01469"></a>01469    close(chan-&gt;epfd);
<a name="l01470"></a>01470 <span class="preprocessor">#endif</span>
<a name="l01471"></a>01471 <span class="preprocessor"></span>   <span class="keywordflow">while</span> ((f = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;chan-&gt;readq, frame_list)))
<a name="l01472"></a>01472       <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l01473"></a>01473    
<a name="l01474"></a>01474    <span class="comment">/* loop over the variables list, freeing all data and deleting list items */</span>
<a name="l01475"></a>01475    <span class="comment">/* no need to lock the list, as the channel is already locked */</span>
<a name="l01476"></a>01476    
<a name="l01477"></a>01477    <span class="keywordflow">while</span> ((vardata = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(headp, entries)))
<a name="l01478"></a>01478       <a class="code" href="chanvars_8h.html#a52aaa758ed30031250c2d356b993c6d9">ast_var_delete</a>(vardata);
<a name="l01479"></a>01479 
<a name="l01480"></a>01480    <a class="code" href="app_8h.html#add0f96b4b815205f528f5248ccb3d515" title="Discard all group counting for a channel.">ast_app_group_discard</a>(chan);
<a name="l01481"></a>01481 
<a name="l01482"></a>01482    <span class="comment">/* Destroy the jitterbuffer */</span>
<a name="l01483"></a>01483    <a class="code" href="abstract__jb_8h.html#aa94fd3c228854f8ac519da8218d5c032" title="Destroys jitterbuffer on a channel.">ast_jb_destroy</a>(chan);
<a name="l01484"></a>01484 
<a name="l01485"></a>01485    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>) {
<a name="l01486"></a>01486       <a class="code" href="cdr_8h.html#a0a672ffbd29adf8622596a36ccb25e65" title="Discard and free a CDR record.">ast_cdr_discard</a>(chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>);
<a name="l01487"></a>01487       chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a> = NULL;
<a name="l01488"></a>01488    }
<a name="l01489"></a>01489 
<a name="l01490"></a>01490    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a3b50931566324162ca5ebdd52fb5874c">zone</a>) {
<a name="l01491"></a>01491       chan-&gt;<a class="code" href="structast__channel.html#a3b50931566324162ca5ebdd52fb5874c">zone</a> = <a class="code" href="indications_8h.html#ae4e735983064b7fe22ffc0fc046d700e" title="Release a reference to an ast_tone_zone.">ast_tone_zone_unref</a>(chan-&gt;<a class="code" href="structast__channel.html#a3b50931566324162ca5ebdd52fb5874c">zone</a>);
<a name="l01492"></a>01492    }
<a name="l01493"></a>01493 
<a name="l01494"></a>01494    <a class="code" href="lock_8h.html#ab237e70b569019bfb490ab0c3c09b8c5">ast_mutex_destroy</a>(&amp;chan-&gt;<a class="code" href="structast__channel.html#a8dc1b6301d8284eb0f31f2d723902a99">lock_dont_use</a>);
<a name="l01495"></a>01495 
<a name="l01496"></a>01496    <a class="code" href="stringfields_8h.html#abf60f862ae6a141d2f86a0f5e82792de" title="free all memory - to be called before destroying the object">ast_string_field_free_memory</a>(chan);
<a name="l01497"></a>01497    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(chan);
<a name="l01498"></a>01498    <span class="keywordflow">if</span> (inlist)
<a name="l01499"></a>01499       <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>);
<a name="l01500"></a>01500 
<a name="l01501"></a>01501    <span class="comment">/* Queue an unknown state, because, while we know that this particular</span>
<a name="l01502"></a>01502 <span class="comment">    * instance is dead, we don&apos;t know the state of all other possible</span>
<a name="l01503"></a>01503 <span class="comment">    * instances. */</span>
<a name="l01504"></a>01504    <a class="code" href="devicestate_8h.html#a0cc33ebff1ed76c113d17785814b5a47" title="Tells Asterisk the State for Device is changed.">ast_devstate_changed_literal</a>(<a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a">AST_DEVICE_UNKNOWN</a>, name);
<a name="l01505"></a>01505 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a892b6550a4f90b70ad92198c9d05cedc"></a><!-- doxytag: member="channel.c::ast_channel_inherit_variables" ref="a892b6550a4f90b70ad92198c9d05cedc" args="(const struct ast_channel *parent, struct ast_channel *child)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_channel_inherit_variables </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>parent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>child</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Inherits channel variable from parent to child channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>parent</em>&nbsp;</td><td>Parent channel </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>child</em>&nbsp;</td><td>Child channel</td></tr>
  </table>
  </dd>
</dl>
<p>Scans all channel variables in the parent channel, looking for those that should be copied into the child channel. Variables whose names begin with a single '_' are copied into the child channel with the prefix removed. Variables whose names begin with '__' are copied into the child channel with their names unchanged. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l04302">4302</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="linkedlists_8h_source.html#l00715">AST_LIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="chanvars_8c_source.html#l00037">ast_var_assign()</a>, <a class="el" href="chanvars_8c_source.html#l00080">ast_var_full_name()</a>, <a class="el" href="chanvars_8c_source.html#l00065">ast_var_name()</a>, <a class="el" href="chanvars_8c_source.html#l00085">ast_var_value()</a>, and <a class="el" href="channel_8h_source.html#l00446">ast_channel::varshead</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l03851">__ast_request_and_dial()</a>, <a class="el" href="chan__agent_8c_source.html#l00770">agent_call()</a>, <a class="el" href="channel_8c_source.html#l03779">ast_call_forward()</a>, <a class="el" href="dial_8c_source.html#l00255">begin_dial_channel()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="bridge__builtin__features_8c_source.html#l00068">dial_transfer()</a>, <a class="el" href="app__dial_8c_source.html#l00712">do_forward()</a>, <a class="el" href="features_8c_source.html#l02152">feature_request_and_dial()</a>, <a class="el" href="app__followme_8c_source.html#l00777">findmeexec()</a>, <a class="el" href="app__queue_8c_source.html#l02467">ring_entry()</a>, and <a class="el" href="app__queue_8c_source.html#l02845">wait_for_answer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04303"></a>04303 {
<a name="l04304"></a>04304    <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a> *current, *newvar;
<a name="l04305"></a>04305    <span class="keyword">const</span> <span class="keywordtype">char</span> *varname;
<a name="l04306"></a>04306 
<a name="l04307"></a>04307    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;parent-&gt;<a class="code" href="structast__channel.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>, current, entries) {
<a name="l04308"></a>04308       <span class="keywordtype">int</span> vartype = 0;
<a name="l04309"></a>04309 
<a name="l04310"></a>04310       varname = <a class="code" href="chanvars_8h.html#a37f22870d234aefac66dafb58f8b86fd">ast_var_full_name</a>(current);
<a name="l04311"></a>04311       <span class="keywordflow">if</span> (!varname)
<a name="l04312"></a>04312          <span class="keywordflow">continue</span>;
<a name="l04313"></a>04313 
<a name="l04314"></a>04314       <span class="keywordflow">if</span> (varname[0] == <span class="charliteral">&apos;_&apos;</span>) {
<a name="l04315"></a>04315          vartype = 1;
<a name="l04316"></a>04316          <span class="keywordflow">if</span> (varname[1] == <span class="charliteral">&apos;_&apos;</span>)
<a name="l04317"></a>04317             vartype = 2;
<a name="l04318"></a>04318       }
<a name="l04319"></a>04319 
<a name="l04320"></a>04320       <span class="keywordflow">switch</span> (vartype) {
<a name="l04321"></a>04321       <span class="keywordflow">case</span> 1:
<a name="l04322"></a>04322          newvar = <a class="code" href="chanvars_8h.html#a8ea2b5a29fa275115c7ed27a593b727d">ast_var_assign</a>(&amp;varname[1], <a class="code" href="chanvars_8h.html#a8e0081172db71c5021d20706c50d959c">ast_var_value</a>(current));
<a name="l04323"></a>04323          <span class="keywordflow">if</span> (newvar) {
<a name="l04324"></a>04324             <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;child-&gt;<a class="code" href="structast__channel.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>, newvar, entries);
<a name="l04325"></a>04325             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Copying soft-transferable variable %s.\n&quot;</span>, <a class="code" href="chanvars_8h.html#a356a31cd608ec07d3668dcd589be49d8">ast_var_name</a>(newvar));
<a name="l04326"></a>04326          }
<a name="l04327"></a>04327          <span class="keywordflow">break</span>;
<a name="l04328"></a>04328       <span class="keywordflow">case</span> 2:
<a name="l04329"></a>04329          newvar = <a class="code" href="chanvars_8h.html#a8ea2b5a29fa275115c7ed27a593b727d">ast_var_assign</a>(varname, <a class="code" href="chanvars_8h.html#a8e0081172db71c5021d20706c50d959c">ast_var_value</a>(current));
<a name="l04330"></a>04330          <span class="keywordflow">if</span> (newvar) {
<a name="l04331"></a>04331             <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;child-&gt;<a class="code" href="structast__channel.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>, newvar, entries);
<a name="l04332"></a>04332             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Copying hard-transferable variable %s.\n&quot;</span>, <a class="code" href="chanvars_8h.html#a356a31cd608ec07d3668dcd589be49d8">ast_var_name</a>(newvar));
<a name="l04333"></a>04333          }
<a name="l04334"></a>04334          <span class="keywordflow">break</span>;
<a name="l04335"></a>04335       <span class="keywordflow">default</span>:
<a name="l04336"></a>04336          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Not copying variable %s.\n&quot;</span>, <a class="code" href="chanvars_8h.html#a356a31cd608ec07d3668dcd589be49d8">ast_var_name</a>(current));
<a name="l04337"></a>04337          <span class="keywordflow">break</span>;
<a name="l04338"></a>04338       }
<a name="l04339"></a>04339    }
<a name="l04340"></a>04340 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4aff0f5358bdc107a92320b4c4631834"></a><!-- doxytag: member="channel.c::ast_channel_make_compatible" ref="a4aff0f5358bdc107a92320b4c4631834" args="(struct ast_channel *chan, struct ast_channel *peer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_channel_make_compatible </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c1</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Makes two channel <a class="el" href="structformats.html">formats</a> compatible. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c0</em>&nbsp;</td><td>first channel to make compatible </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>c1</em>&nbsp;</td><td>other channel to make compatible Set two <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> to compatible <a class="el" href="structformats.html">formats</a> -- call before ast_channel_bridge in general . </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns 0 on success and -1 if it could not be done </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l04200">4200</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l04159">ast_channel_make_compatible_helper()</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l04156">action_bridge()</a>, <a class="el" href="app__followme_8c_source.html#l01003">app_exec()</a>, <a class="el" href="channel_8c_source.html#l05055">ast_channel_bridge()</a>, <a class="el" href="features_8c_source.html#l04524">bridge_exec()</a>, <a class="el" href="features_8c_source.html#l01370">check_compat()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="app__dial_8c_source.html#l00712">do_forward()</a>, <a class="el" href="bridge__multiplexed_8c_source.html#l00295">multiplexed_bridge_join()</a>, <a class="el" href="features_8c_source.html#l03335">park_exec_full()</a>, <a class="el" href="bridge__simple_8c_source.html#l00044">simple_bridge_join()</a>, <a class="el" href="app__queue_8c_source.html#l03569">try_calling()</a>, and <a class="el" href="app__dial_8c_source.html#l00818">wait_for_answer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04201"></a>04201 {
<a name="l04202"></a>04202    <span class="comment">/* Some callers do not check return code, and we must try to set all call legs correctly */</span>
<a name="l04203"></a>04203    <span class="keywordtype">int</span> rc = 0;
<a name="l04204"></a>04204 
<a name="l04205"></a>04205    <span class="comment">/* Set up translation from the chan to the peer */</span>
<a name="l04206"></a>04206    rc = <a class="code" href="channel_8c.html#a269e229318912967cf9c939d2b7b52e7" title="Set up translation from one channel to another.">ast_channel_make_compatible_helper</a>(chan, peer);
<a name="l04207"></a>04207 
<a name="l04208"></a>04208    <span class="keywordflow">if</span> (rc &lt; 0)
<a name="l04209"></a>04209       <span class="keywordflow">return</span> rc;
<a name="l04210"></a>04210 
<a name="l04211"></a>04211    <span class="comment">/* Set up translation from the peer to the chan */</span>
<a name="l04212"></a>04212    rc = <a class="code" href="channel_8c.html#a269e229318912967cf9c939d2b7b52e7" title="Set up translation from one channel to another.">ast_channel_make_compatible_helper</a>(peer, chan);
<a name="l04213"></a>04213 
<a name="l04214"></a>04214    <span class="keywordflow">return</span> rc;
<a name="l04215"></a>04215 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a269e229318912967cf9c939d2b7b52e7"></a><!-- doxytag: member="channel.c::ast_channel_make_compatible_helper" ref="a269e229318912967cf9c939d2b7b52e7" args="(struct ast_channel *from, struct ast_channel *to)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ast_channel_make_compatible_helper </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>from</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>to</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set up translation from one channel to another. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l04159">4159</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00273">AST_FORMAT_AUDIO_MASK</a>, <a class="el" href="frame_8h_source.html#l00253">AST_FORMAT_SLINEAR</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="options_8h_source.html#l00108">ast_opt_transcode_via_slin</a>, <a class="el" href="channel_8c_source.html#l03731">ast_set_read_format()</a>, <a class="el" href="channel_8c_source.html#l03737">ast_set_write_format()</a>, <a class="el" href="translate_8c_source.html#l00808">ast_translate_path_steps()</a>, <a class="el" href="translate_8c_source.html#l00761">ast_translator_best_choice()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="channel_8h_source.html#l00482">ast_channel::nativeformats</a>, <a class="el" href="channel_8h_source.html#l00483">ast_channel::readformat</a>, and <a class="el" href="channel_8h_source.html#l00484">ast_channel::writeformat</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l04200">ast_channel_make_compatible()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04160"></a>04160 {
<a name="l04161"></a>04161    <span class="keywordtype">int</span> src;
<a name="l04162"></a>04162    <span class="keywordtype">int</span> dst;
<a name="l04163"></a>04163 
<a name="l04164"></a>04164    <span class="keywordflow">if</span> (from-&gt;<a class="code" href="structast__channel.html#ab7786a0f5b9a9ebf83daed87be4f3868">readformat</a> == to-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a> &amp;&amp; from-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a> == to-&gt;<a class="code" href="structast__channel.html#ab7786a0f5b9a9ebf83daed87be4f3868">readformat</a>) {
<a name="l04165"></a>04165       <span class="comment">/* Already compatible!  Moving on ... */</span>
<a name="l04166"></a>04166       <span class="keywordflow">return</span> 0;
<a name="l04167"></a>04167    }
<a name="l04168"></a>04168 
<a name="l04169"></a>04169    <span class="comment">/* Set up translation from the &apos;from&apos; channel to the &apos;to&apos; channel */</span>
<a name="l04170"></a>04170    src = from-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>;
<a name="l04171"></a>04171    dst = to-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>;
<a name="l04172"></a>04172 
<a name="l04173"></a>04173    <span class="comment">/* If there&apos;s no audio in this call, don&apos;t bother with trying to find a translation path */</span>
<a name="l04174"></a>04174    <span class="keywordflow">if</span> ((src &amp; <a class="code" href="frame_8h.html#a3f680b9c15596de927d507a664fd2803">AST_FORMAT_AUDIO_MASK</a>) == 0 || (dst &amp; AST_FORMAT_AUDIO_MASK) == 0)
<a name="l04175"></a>04175       <span class="keywordflow">return</span> 0;
<a name="l04176"></a>04176 
<a name="l04177"></a>04177    <span class="keywordflow">if</span> (<a class="code" href="translate_8h.html#a09ac24ad5b3c1e1cee3d294556458e36" title="Chooses the best translation path.">ast_translator_best_choice</a>(&amp;dst, &amp;src) &lt; 0) {
<a name="l04178"></a>04178       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No path to translate from %s(%d) to %s(%d)\n&quot;</span>, from-&gt;name, src, to-&gt;name, dst);
<a name="l04179"></a>04179       <span class="keywordflow">return</span> -1;
<a name="l04180"></a>04180    }
<a name="l04181"></a>04181 
<a name="l04182"></a>04182    <span class="comment">/* if the best path is not &apos;pass through&apos;, then</span>
<a name="l04183"></a>04183 <span class="comment">      transcoding is needed; if desired, force transcode path</span>
<a name="l04184"></a>04184 <span class="comment">      to use SLINEAR between channels, but only if there is</span>
<a name="l04185"></a>04185 <span class="comment">      no direct conversion available */</span>
<a name="l04186"></a>04186    <span class="keywordflow">if</span> ((src != dst) &amp;&amp; <a class="code" href="options_8h.html#a48887ee8724c584209e55362bc887b43">ast_opt_transcode_via_slin</a> &amp;&amp;
<a name="l04187"></a>04187        (<a class="code" href="translate_8h.html#aeb7a78eb98ec299dd2a02abf08b2ffdc" title="Returns the number of steps required to convert from &amp;#39;src&amp;#39; to &amp;#39;dest&amp;#39;...">ast_translate_path_steps</a>(dst, src) != 1))
<a name="l04188"></a>04188       dst = <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>;
<a name="l04189"></a>04189    <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a72d53065c6bc2b6092fa41eefa03f1ad" title="Sets read format on channel chan Set read format for channel to whichever component...">ast_set_read_format</a>(from, dst) &lt; 0) {
<a name="l04190"></a>04190       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to set read format on channel %s to %d\n&quot;</span>, from-&gt;name, dst);
<a name="l04191"></a>04191       <span class="keywordflow">return</span> -1;
<a name="l04192"></a>04192    }
<a name="l04193"></a>04193    <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a978161a52d98fdaee374d1f6e1359544" title="Sets write format on channel chan Set write format for channel to whichever component...">ast_set_write_format</a>(to, dst) &lt; 0) {
<a name="l04194"></a>04194       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to set write format on channel %s to %d\n&quot;</span>, to-&gt;name, dst);
<a name="l04195"></a>04195       <span class="keywordflow">return</span> -1;
<a name="l04196"></a>04196    }
<a name="l04197"></a>04197    <span class="keywordflow">return</span> 0;
<a name="l04198"></a>04198 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a72c00d7dc6b9930fd0c18ebff6e580ac"></a><!-- doxytag: member="channel.c::ast_channel_masquerade" ref="a72c00d7dc6b9930fd0c18ebff6e580ac" args="(struct ast_channel *original, struct ast_channel *clonechan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_channel_masquerade </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>original</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>clone</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Weird function made for call transfers. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>original</em>&nbsp;</td><td>channel to make a copy of </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>clone</em>&nbsp;</td><td>copy of the original channel</td></tr>
  </table>
  </dd>
</dl>
<p>This is a very strange and freaky function used primarily for transfer. Suppose that "original" and "clone" are two <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> in random situations. This function takes the guts out of "clone" and puts them into the "original" channel, then alerts the channel driver of the change, asking it to fixup any private information (like the p-&gt;owner pointer) that is affected by the change. The physical layer of the original channel is hung up.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>Neither channel passed here needs to be locked before calling this function. </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l04217">4217</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00405">ast_channel::_bridge</a>, <a class="el" href="channel_8c_source.html#l04733">ast_bridged_channel()</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02037">ast_channel_trylock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="frame_8c_source.html#l00124">ast_null_frame</a>, <a class="el" href="channel_8c_source.html#l01080">ast_queue_frame()</a>, <a class="el" href="structast__channel__tech.html#aa9da05e868532393d37c2ea154134eea">ast_channel_tech::get_base_channel</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="channel_8h_source.html#l00408">ast_channel::masq</a>, <a class="el" href="channel_8h_source.html#l00409">ast_channel::masqr</a>, and <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l07344">ast_async_goto()</a>, <a class="el" href="features_8c_source.html#l04475">ast_pickup_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05502">attempt_transfer()</a>, <a class="el" href="features_8c_source.html#l01396">builtin_atxfer()</a>, <a class="el" href="chan__agent_8c_source.html#l01350">check_availability()</a>, <a class="el" href="chan__local_8c_source.html#l00289">check_bridge()</a>, <a class="el" href="features_8c_source.html#l00366">check_goto_on_transfer()</a>, <a class="el" href="features_8c_source.html#l04126">do_bridge_masquerade()</a>, <a class="el" href="chan__sip_8c_source.html#l19184">handle_invite_replaces()</a>, <a class="el" href="chan__iax2_8c_source.html#l08941">iax_park()</a>, <a class="el" href="features_8c_source.html#l00833">masq_park_call()</a>, <a class="el" href="chan__misdn_8c_source.html#l04108">misdn_attempt_transfer()</a>, <a class="el" href="app__directed__pickup_8c_source.html#l00091">pickup_do()</a>, <a class="el" href="chan__sip_8c_source.html#l18778">sip_park()</a>, and <a class="el" href="chan__skinny_8c_source.html#l04102">skinny_transfer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04218"></a>04218 {
<a name="l04219"></a>04219    <span class="keywordtype">int</span> res = -1;
<a name="l04220"></a>04220    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *final_orig, *final_clone, *base;
<a name="l04221"></a>04221 
<a name="l04222"></a>04222 retrymasq:
<a name="l04223"></a>04223    final_orig = original;
<a name="l04224"></a>04224    final_clone = clonechan;
<a name="l04225"></a>04225 
<a name="l04226"></a>04226    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(original);
<a name="l04227"></a>04227    <span class="keywordflow">while</span> (<a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(clonechan)) {
<a name="l04228"></a>04228       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(original);
<a name="l04229"></a>04229       usleep(1);
<a name="l04230"></a>04230       <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(original);
<a name="l04231"></a>04231    }
<a name="l04232"></a>04232 
<a name="l04233"></a>04233    <span class="comment">/* each of these channels may be sitting behind a channel proxy (i.e. chan_agent)</span>
<a name="l04234"></a>04234 <span class="comment">      and if so, we don&apos;t really want to masquerade it, but its proxy */</span>
<a name="l04235"></a>04235    <span class="keywordflow">if</span> (original-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a> &amp;&amp; (original-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a> != <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(original)) &amp;&amp; (original-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a>-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a> != original))
<a name="l04236"></a>04236       final_orig = original-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a>;
<a name="l04237"></a>04237 
<a name="l04238"></a>04238    <span class="keywordflow">if</span> (clonechan-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a> &amp;&amp; (clonechan-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a> != <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(clonechan)) &amp;&amp; (clonechan-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a>-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a> != clonechan))
<a name="l04239"></a>04239       final_clone = clonechan-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a>;
<a name="l04240"></a>04240    
<a name="l04241"></a>04241    <span class="keywordflow">if</span> (final_clone-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#aa9da05e868532393d37c2ea154134eea" title="Retrieve base channel (agent and local).">get_base_channel</a> &amp;&amp; (base = final_clone-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#aa9da05e868532393d37c2ea154134eea" title="Retrieve base channel (agent and local).">get_base_channel</a>(final_clone))) {
<a name="l04242"></a>04242       final_clone = base;
<a name="l04243"></a>04243    }
<a name="l04244"></a>04244 
<a name="l04245"></a>04245    <span class="keywordflow">if</span> ((final_orig != original) || (final_clone != clonechan)) {
<a name="l04246"></a>04246       <span class="comment">/* Lots and lots of deadlock avoidance.  The main one we&apos;re competing with</span>
<a name="l04247"></a>04247 <span class="comment">       * is ast_write(), which locks channels recursively, when working with a</span>
<a name="l04248"></a>04248 <span class="comment">       * proxy channel. */</span>
<a name="l04249"></a>04249       <span class="keywordflow">if</span> (<a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(final_orig)) {
<a name="l04250"></a>04250          <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(clonechan);
<a name="l04251"></a>04251          <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(original);
<a name="l04252"></a>04252          <span class="keywordflow">goto</span> retrymasq;
<a name="l04253"></a>04253       }
<a name="l04254"></a>04254       <span class="keywordflow">if</span> (<a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(final_clone)) {
<a name="l04255"></a>04255          <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(final_orig);
<a name="l04256"></a>04256          <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(clonechan);
<a name="l04257"></a>04257          <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(original);
<a name="l04258"></a>04258          <span class="keywordflow">goto</span> retrymasq;
<a name="l04259"></a>04259       }
<a name="l04260"></a>04260       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(clonechan);
<a name="l04261"></a>04261       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(original);
<a name="l04262"></a>04262       original = final_orig;
<a name="l04263"></a>04263       clonechan = final_clone;
<a name="l04264"></a>04264    }
<a name="l04265"></a>04265 
<a name="l04266"></a>04266    <span class="keywordflow">if</span> (original == clonechan) {
<a name="l04267"></a>04267       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Can&apos;t masquerade channel &apos;%s&apos; into itself!\n&quot;</span>, original-&gt;name);
<a name="l04268"></a>04268       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(clonechan);
<a name="l04269"></a>04269       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(original);
<a name="l04270"></a>04270       <span class="keywordflow">return</span> -1;
<a name="l04271"></a>04271    }
<a name="l04272"></a>04272 
<a name="l04273"></a>04273    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Planning to masquerade channel %s into the structure of %s\n&quot;</span>,
<a name="l04274"></a>04274       clonechan-&gt;name, original-&gt;name);
<a name="l04275"></a>04275    <span class="keywordflow">if</span> (original-&gt;<a class="code" href="structast__channel.html#ae38ae730b987d648a6fe1c84c8a13442">masq</a>) {
<a name="l04276"></a>04276       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s is already going to masquerade as %s\n&quot;</span>,
<a name="l04277"></a>04277          original-&gt;<a class="code" href="structast__channel.html#ae38ae730b987d648a6fe1c84c8a13442">masq</a>-&gt;name, original-&gt;name);
<a name="l04278"></a>04278    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (clonechan-&gt;<a class="code" href="structast__channel.html#abb53278bc00235a5ff76fc8badbe6363">masqr</a>) {
<a name="l04279"></a>04279       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s is already going to masquerade as %s\n&quot;</span>,
<a name="l04280"></a>04280          clonechan-&gt;name, clonechan-&gt;<a class="code" href="structast__channel.html#abb53278bc00235a5ff76fc8badbe6363">masqr</a>-&gt;name);
<a name="l04281"></a>04281    } <span class="keywordflow">else</span> {
<a name="l04282"></a>04282       original-&gt;<a class="code" href="structast__channel.html#ae38ae730b987d648a6fe1c84c8a13442">masq</a> = clonechan;
<a name="l04283"></a>04283       clonechan-&gt;<a class="code" href="structast__channel.html#abb53278bc00235a5ff76fc8badbe6363">masqr</a> = original;
<a name="l04284"></a>04284       <a class="code" href="channel_8h.html#a6cbcba5661d55216968cde8fdf913c89" title="Queue one or more frames to a channel&amp;#39;s frame queue.">ast_queue_frame</a>(original, &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>);
<a name="l04285"></a>04285       <a class="code" href="channel_8h.html#a6cbcba5661d55216968cde8fdf913c89" title="Queue one or more frames to a channel&amp;#39;s frame queue.">ast_queue_frame</a>(clonechan, &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>);
<a name="l04286"></a>04286       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Done planning to masquerade channel %s into the structure of %s\n&quot;</span>, clonechan-&gt;name, original-&gt;name);
<a name="l04287"></a>04287       res = 0;
<a name="l04288"></a>04288    }
<a name="l04289"></a>04289 
<a name="l04290"></a>04290    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(clonechan);
<a name="l04291"></a>04291    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(original);
<a name="l04292"></a>04292 
<a name="l04293"></a>04293    <span class="keywordflow">return</span> res;
<a name="l04294"></a>04294 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4ca17f6d1c390e88d53b4180dea5487b"></a><!-- doxytag: member="channel.c::ast_channel_queryoption" ref="a4ca17f6d1c390e88d53b4180dea5487b" args="(struct ast_channel *chan, int option, void *data, int *datalen, int block)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_channel_queryoption </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>channel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>option</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>datalen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>block</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Checks the value of an option</p>
<p>Query the value of an option Works similarly to setoption except only reads the options. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l05320">5320</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="structast__channel__tech.html#ae1ed04e9ad2b835bc1b4237882962b6e">ast_channel_tech::queryoption</a>, and <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>.</p>

<p>Referenced by <a class="el" href="channel_8h_source.html#l01753">ast_channel_get_t38_state()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05321"></a>05321 {
<a name="l05322"></a>05322    <span class="keywordflow">if</span> (!chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#ae1ed04e9ad2b835bc1b4237882962b6e" title="Query a given option.">queryoption</a>) {
<a name="l05323"></a>05323       <a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> = ENOSYS;
<a name="l05324"></a>05324       <span class="keywordflow">return</span> -1;
<a name="l05325"></a>05325    }
<a name="l05326"></a>05326 
<a name="l05327"></a>05327    <span class="keywordflow">if</span> (block)
<a name="l05328"></a>05328       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;XXX Blocking not implemented yet XXX\n&quot;</span>);
<a name="l05329"></a>05329 
<a name="l05330"></a>05330    <span class="keywordflow">return</span> chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#ae1ed04e9ad2b835bc1b4237882962b6e" title="Query a given option.">queryoption</a>(chan, option, <a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>, datalen);
<a name="l05331"></a>05331 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a25ec12c3abdc7ad6d7971f4ad3737d94"></a><!-- doxytag: member="channel.c::ast_channel_reason2str" ref="a25ec12c3abdc7ad6d7971f4ad3737d94" args="(int reason)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* ast_channel_reason2str </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>reason</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>return an english explanation of the code returned thru __ast_request_and_dial's 'outstate' argument </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>reason</em>&nbsp;</td><td>The integer argument, usually taken from AST_CONTROL_ macros </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>char pointer explaining the code </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l03743">3743</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00301">AST_CONTROL_ANSWER</a>, <a class="el" href="frame_8h_source.html#l00302">AST_CONTROL_BUSY</a>, <a class="el" href="frame_8h_source.html#l00305">AST_CONTROL_CONGESTION</a>, <a class="el" href="frame_8h_source.html#l00298">AST_CONTROL_HANGUP</a>, <a class="el" href="frame_8h_source.html#l00299">AST_CONTROL_RING</a>, and <a class="el" href="frame_8h_source.html#l00300">AST_CONTROL_RINGING</a>.</p>

<p>Referenced by <a class="el" href="pbx__spool_8c_source.html#l00325">attempt_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03744"></a>03744 {
<a name="l03745"></a>03745    <span class="keywordflow">switch</span> (reason) <span class="comment">/* the following appear to be the only ones actually returned by request_and_dial */</span>
<a name="l03746"></a>03746    {
<a name="l03747"></a>03747    <span class="keywordflow">case</span> 0:
<a name="l03748"></a>03748       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Call Failure (not BUSY, and not NO_ANSWER, maybe Circuit busy or down?)&quot;</span>;
<a name="l03749"></a>03749    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa7dac1c1896ab418c2ff351aae707fba">AST_CONTROL_HANGUP</a>:
<a name="l03750"></a>03750       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Hangup&quot;</span>;
<a name="l03751"></a>03751    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a00675bfb8c64b2be86297fe4cba51fa2">AST_CONTROL_RING</a>:
<a name="l03752"></a>03752       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Local Ring&quot;</span>;
<a name="l03753"></a>03753    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a>:
<a name="l03754"></a>03754       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Remote end Ringing&quot;</span>;
<a name="l03755"></a>03755    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>:
<a name="l03756"></a>03756       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Remote end has Answered&quot;</span>;
<a name="l03757"></a>03757    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875">AST_CONTROL_BUSY</a>:
<a name="l03758"></a>03758       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Remote end is Busy&quot;</span>;
<a name="l03759"></a>03759    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a850bb06a1702741c93a3fd67cc9637ab">AST_CONTROL_CONGESTION</a>:
<a name="l03760"></a>03760       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Congestion (circuits busy)&quot;</span>;
<a name="l03761"></a>03761    <span class="keywordflow">default</span>:
<a name="l03762"></a>03762       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Unknown Reason!!&quot;</span>;
<a name="l03763"></a>03763    }
<a name="l03764"></a>03764 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab5f3776fda943e52820ceeee5835c1b4"></a><!-- doxytag: member="channel.c::ast_channel_register" ref="ab5f3776fda943e52820ceeee5835c1b4" args="(const struct ast_channel_tech *tech)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_channel_register </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structast__channel__tech.html">ast_channel_tech</a> *&nbsp;</td>
          <td class="paramname"> <em>tech</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Register a new telephony channel in Asterisk. </p>
<p>Register a channel technology (a new channel driver) Called by a channel module to register the kind of <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> it supports. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l00557">557</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="linkedlists_8h_source.html#l00695">AST_LIST_INSERT_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="channel_8h_source.html#l00227">ast_channel_tech::description</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="channel_8c_source.html#l00104">chanlist::tech</a>, and <a class="el" href="channel_8h_source.html#l00226">ast_channel_tech::type</a>.</p>

<p>Referenced by <a class="el" href="chan__agent_8c_source.html#l02567">load_module()</a>, and <a class="el" href="chan__mgcp_8c_source.html#l04327">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00558"></a>00558 {
<a name="l00559"></a>00559    <span class="keyword">struct </span><a class="code" href="structchanlist.html" title="List of channel drivers.">chanlist</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>;
<a name="l00560"></a>00560 
<a name="l00561"></a>00561    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>);
<a name="l00562"></a>00562 
<a name="l00563"></a>00563    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="structbackends.html" title="the list of registered channel types">backends</a>, chan, <a class="code" href="structchanlist.html#ae16c3868ae9c6fd5cf5a94bc9fb6940c">list</a>) {
<a name="l00564"></a>00564       <span class="keywordflow">if</span> (!strcasecmp(tech-&gt;<a class="code" href="structast__channel__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>, chan-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>)) {
<a name="l00565"></a>00565          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Already have a handler for type &apos;%s&apos;\n&quot;</span>, tech-&gt;<a class="code" href="structast__channel__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>);
<a name="l00566"></a>00566          <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>);
<a name="l00567"></a>00567          <span class="keywordflow">return</span> -1;
<a name="l00568"></a>00568       }
<a name="l00569"></a>00569    }
<a name="l00570"></a>00570    
<a name="l00571"></a>00571    <span class="keywordflow">if</span> (!(chan = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*chan)))) {
<a name="l00572"></a>00572       <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>);
<a name="l00573"></a>00573       <span class="keywordflow">return</span> -1;
<a name="l00574"></a>00574    }
<a name="l00575"></a>00575    chan-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a> = tech;
<a name="l00576"></a>00576    <a class="code" href="linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307" title="Inserts a list entry at the head of a list.">AST_LIST_INSERT_HEAD</a>(&amp;<a class="code" href="structbackends.html" title="the list of registered channel types">backends</a>, chan, <a class="code" href="structchanlist.html#ae16c3868ae9c6fd5cf5a94bc9fb6940c">list</a>);
<a name="l00577"></a>00577 
<a name="l00578"></a>00578    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Registered handler for &apos;%s&apos; (%s)\n&quot;</span>, chan-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>, chan-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#ac57ec035c076b222b9420a68ddab3bf1">description</a>);
<a name="l00579"></a>00579 
<a name="l00580"></a>00580    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Registered channel type &apos;%s&apos; (%s)\n&quot;</span>, chan-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>, chan-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#ac57ec035c076b222b9420a68ddab3bf1">description</a>);
<a name="l00581"></a>00581 
<a name="l00582"></a>00582    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>);
<a name="l00583"></a>00583    <span class="keywordflow">return</span> 0;
<a name="l00584"></a>00584 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4c61dfe488472b90f811c319cdba7741"></a><!-- doxytag: member="channel.c::ast_channel_search_locked" ref="a4c61dfe488472b90f811c319cdba7741" args="(int(*is_match)(struct ast_channel *, void *), void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__channel.html">ast_channel</a>* ast_channel_search_locked </td>
          <td>(</td>
          <td class="paramtype">int(*)(struct <a class="el" href="structast__channel.html">ast_channel</a> *, void *)&nbsp;</td>
          <td class="paramname"> <em>is_match</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Search for a channel based on the passed channel matching callback (first match) and return it, locked. </p>
<p>Search for a channel based on the passed channel matching callback Search for a channel based on the specified is_match callback, and return the first channel that we match. When returned, the channel will be locked. Note that the is_match callback is called with the passed channel locked, and should return 0 if there is no match, and non-zero if there is. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01310">1310</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="linkedlists_8h_source.html#l00077">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, and <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l04475">ast_pickup_call()</a>, <a class="el" href="app__directed__pickup_8c_source.html#l00188">pickup_by_exten()</a>, <a class="el" href="app__directed__pickup_8c_source.html#l00220">pickup_by_mark()</a>, and <a class="el" href="chan__sip_8c_source.html#l11046">transmit_state_notify()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01311"></a>01311 {
<a name="l01312"></a>01312    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c = NULL;
<a name="l01313"></a>01313 
<a name="l01314"></a>01314    <a class="code" href="linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc" title="Read locks a list.">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>);
<a name="l01315"></a>01315    <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>, c, <a class="code" href="structchan__list.html" title="Channel call record structure.">chan_list</a>) {
<a name="l01316"></a>01316       <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(c);
<a name="l01317"></a>01317       <span class="keywordflow">if</span> (is_match(c, <a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>)) {
<a name="l01318"></a>01318          <span class="keywordflow">break</span>;
<a name="l01319"></a>01319       }
<a name="l01320"></a>01320       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c);
<a name="l01321"></a>01321    }
<a name="l01322"></a>01322    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>);
<a name="l01323"></a>01323 
<a name="l01324"></a>01324    <span class="keywordflow">return</span> c;
<a name="l01325"></a>01325 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8d715844337b07f950bf2ff0eb4c5b90"></a><!-- doxytag: member="channel.c::ast_channel_sendhtml" ref="a8d715844337b07f950bf2ff0eb4c5b90" args="(struct ast_channel *chan, int subclass, const char *data, int datalen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_channel_sendhtml </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>channel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>subclass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>datalen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Sends HTML on given channel</p>
<p>Send HTML or URL on link. Returns 0 on success or -1 on failure </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l04146">4146</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="structast__channel__tech.html#a8169d0cdf14765d08ed132b495170e3b">ast_channel_tech::send_html</a>, and <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>.</p>

<p>Referenced by <a class="el" href="chan__agent_8c_source.html#l00668">agent_sendhtml()</a>, <a class="el" href="channel_8c_source.html#l04153">ast_channel_sendurl()</a>, and <a class="el" href="app__dial_8c_source.html#l00818">wait_for_answer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04147"></a>04147 {
<a name="l04148"></a>04148    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a8169d0cdf14765d08ed132b495170e3b" title="Send HTML data.">send_html</a>)
<a name="l04149"></a>04149       <span class="keywordflow">return</span> chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a8169d0cdf14765d08ed132b495170e3b" title="Send HTML data.">send_html</a>(chan, subclass, <a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>, datalen);
<a name="l04150"></a>04150    <span class="keywordflow">return</span> -1;
<a name="l04151"></a>04151 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2f152a294b4dd2561b0da2325421aead"></a><!-- doxytag: member="channel.c::ast_channel_sendurl" ref="a2f152a294b4dd2561b0da2325421aead" args="(struct ast_channel *chan, const char *url)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_channel_sendurl </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>channel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>url</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Sends a URL on a given link</p>
<p>Send URL on link. Returns 0 on success or -1 on failure </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l04153">4153</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l04146">ast_channel_sendhtml()</a>, and <a class="el" href="frame_8h_source.html#l00221">AST_HTML_URL</a>.</p>

<p>Referenced by <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="app__url_8c_source.html#l00093">sendurl_exec()</a>, and <a class="el" href="app__queue_8c_source.html#l03569">try_calling()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04154"></a>04154 {
<a name="l04155"></a>04155    <span class="keywordflow">return</span> <a class="code" href="channel_8h.html#a3e312ad1e633f10ca1ddde436a117ef4">ast_channel_sendhtml</a>(chan, <a class="code" href="frame_8h.html#a6eada13200d55b88ef01b68c5d62a43a">AST_HTML_URL</a>, <a class="code" href="res__config__ldap_8c.html#a75e4590043edf35241d30fabe2eda546">url</a>, strlen(<a class="code" href="res__config__ldap_8c.html#a75e4590043edf35241d30fabe2eda546">url</a>) + 1);
<a name="l04156"></a>04156 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aca37ca2f3d55a223d26617329ed48a3e"></a><!-- doxytag: member="channel.c::ast_channel_set_fd" ref="aca37ca2f3d55a223d26617329ed48a3e" args="(struct ast_channel *chan, int which, int fd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_channel_set_fd </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>which</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Set the file descriptor on the channel </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01576">1576</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="channel_8c_source.html#l00071">ast_epoll_data::chan</a>, <a class="el" href="channel_8h_source.html#l00458">ast_channel::fds</a>, <a class="el" href="astmm_8h_source.html#l00084">free</a>, and <a class="el" href="channel_8c_source.html#l00072">ast_epoll_data::which</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l00772">__ast_channel_alloc_ap()</a>, <a class="el" href="chan__h323_8c_source.html#l00999">__oh323_new()</a>, <a class="el" href="chan__h323_8c_source.html#l00951">__oh323_rtp_create()</a>, <a class="el" href="chan__h323_8c_source.html#l00332">__oh323_update_info()</a>, <a class="el" href="chan__alsa_8c_source.html#l00536">alsa_new()</a>, <a class="el" href="channel_8c_source.html#l01956">ast_deactivate_generator()</a>, <a class="el" href="channel_8c_source.html#l04393">ast_do_masquerade()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00989">gtalk_new()</a>, <a class="el" href="chan__jingle_8c_source.html#l00800">jingle_new()</a>, <a class="el" href="chan__mgcp_8c_source.html#l01470">mgcp_new()</a>, <a class="el" href="chan__misdn_8c_source.html#l03705">misdn_new()</a>, <a class="el" href="chan__nbs_8c_source.html#l00222">nbs_new()</a>, <a class="el" href="chan__oss_8c_source.html#l00784">oss_new()</a>, <a class="el" href="chan__phone_8c_source.html#l00846">phone_new()</a>, <a class="el" href="chan__oss_8c_source.html#l00469">setformat()</a>, <a class="el" href="chan__sip_8c_source.html#l06599">sip_new()</a>, <a class="el" href="chan__skinny_8c_source.html#l04268">skinny_new()</a>, <a class="el" href="chan__mgcp_8c_source.html#l02610">start_rtp()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l02062">swap_subs()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01577"></a>01577 {
<a name="l01578"></a>01578 <span class="preprocessor">#ifdef HAVE_EPOLL</span>
<a name="l01579"></a>01579 <span class="preprocessor"></span>   <span class="keyword">struct </span>epoll_event ev;
<a name="l01580"></a>01580    <span class="keyword">struct </span><a class="code" href="structast__epoll__data.html">ast_epoll_data</a> *aed = NULL;
<a name="l01581"></a>01581 
<a name="l01582"></a>01582    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#aef68cd3879b791a3b6c12cdb750f8e6a">fds</a>[<a class="code" href="structast__epoll__data.html#aa2a4dae2a14de4093826005f9bdfd3bb">which</a>] &gt; -1) {
<a name="l01583"></a>01583       epoll_ctl(chan-&gt;epfd, EPOLL_CTL_DEL, chan-&gt;<a class="code" href="structast__channel.html#aef68cd3879b791a3b6c12cdb750f8e6a">fds</a>[<a class="code" href="structast__epoll__data.html#aa2a4dae2a14de4093826005f9bdfd3bb">which</a>], &amp;ev);
<a name="l01584"></a>01584       aed = chan-&gt;epfd_data[<a class="code" href="structast__epoll__data.html#aa2a4dae2a14de4093826005f9bdfd3bb">which</a>];
<a name="l01585"></a>01585    }
<a name="l01586"></a>01586 
<a name="l01587"></a>01587    <span class="comment">/* If this new fd is valid, add it to the epoll */</span>
<a name="l01588"></a>01588    <span class="keywordflow">if</span> (fd &gt; -1) {
<a name="l01589"></a>01589       <span class="keywordflow">if</span> (!aed &amp;&amp; (!(aed = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*aed)))))
<a name="l01590"></a>01590          <span class="keywordflow">return</span>;
<a name="l01591"></a>01591       
<a name="l01592"></a>01592       chan-&gt;epfd_data[<a class="code" href="structast__epoll__data.html#aa2a4dae2a14de4093826005f9bdfd3bb">which</a>] = aed;
<a name="l01593"></a>01593       aed-&gt;<a class="code" href="structast__epoll__data.html#a84d1435c5b8d387806714ea7079304b7">chan</a> = chan;
<a name="l01594"></a>01594       aed-&gt;<a class="code" href="structast__epoll__data.html#aa2a4dae2a14de4093826005f9bdfd3bb">which</a> = <a class="code" href="structast__epoll__data.html#aa2a4dae2a14de4093826005f9bdfd3bb">which</a>;
<a name="l01595"></a>01595       
<a name="l01596"></a>01596       ev.events = EPOLLIN | EPOLLPRI | EPOLLERR | EPOLLHUP;
<a name="l01597"></a>01597       ev.data.ptr = aed;
<a name="l01598"></a>01598       epoll_ctl(chan-&gt;epfd, EPOLL_CTL_ADD, fd, &amp;ev);
<a name="l01599"></a>01599    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (aed) {
<a name="l01600"></a>01600       <span class="comment">/* We don&apos;t have to keep around this epoll data structure now */</span>
<a name="l01601"></a>01601       <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(aed);
<a name="l01602"></a>01602       chan-&gt;epfd_data[<a class="code" href="structast__epoll__data.html#aa2a4dae2a14de4093826005f9bdfd3bb">which</a>] = NULL;
<a name="l01603"></a>01603    }
<a name="l01604"></a>01604 <span class="preprocessor">#endif</span>
<a name="l01605"></a>01605 <span class="preprocessor"></span>   chan-&gt;<a class="code" href="structast__channel.html#aef68cd3879b791a3b6c12cdb750f8e6a">fds</a>[<a class="code" href="structast__epoll__data.html#aa2a4dae2a14de4093826005f9bdfd3bb">which</a>] = fd;
<a name="l01606"></a>01606    <span class="keywordflow">return</span>;
<a name="l01607"></a>01607 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a51d19fd5d03e845c18b7826c9f74a3ae"></a><!-- doxytag: member="channel.c::ast_channel_setoption" ref="a51d19fd5d03e845c18b7826c9f74a3ae" args="(struct ast_channel *chan, int option, void *data, int datalen, int block)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_channel_setoption </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>channel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>option</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>datalen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>block</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Sets an option on a channel. </p>
<p>Sets an option on a channel</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>channel</em>&nbsp;</td><td>channel to set options on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>option</em>&nbsp;</td><td>option to change </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>data specific to option </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>datalen</em>&nbsp;</td><td>length of the data </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>block</em>&nbsp;</td><td>blocking or not Set an option on a channel (see <a class="el" href="frame_8h.html" title="Asterisk internal frame definitions.">frame.h</a>), optionally blocking awaiting the reply Returns 0 on success and -1 on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l05307">5307</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="structast__channel__tech.html#a8d7d76fe50d5df516e63a27d39d28b2a">ast_channel_tech::setoption</a>, and <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l02441">ast_bridge_call()</a>, <a class="el" href="app__chanspy_8c_source.html#l00767">common_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l01998">conf_run()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="func__channel_8c_source.html#l00280">func_channel_write()</a>, <a class="el" href="res__agi_8c_source.html#l01110">handle_tddmode()</a>, <a class="el" href="app__minivm_8c_source.html#l01378">play_record_review()</a>, <a class="el" href="app__meetme_8c_source.html#l01005">reset_volumes()</a>, <a class="el" href="app__rpt_8c_source.html#l10730">rpt()</a>, <a class="el" href="app__rpt_8c_source.html#l13122">rpt_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l00934">set_listen_volume()</a>, <a class="el" href="app__meetme_8c_source.html#l00922">set_talk_volume()</a>, <a class="el" href="app__queue_8c_source.html#l03569">try_calling()</a>, and <a class="el" href="app__voicemail_8c_source.html#l06307">vm_forwardoptions()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05308"></a>05308 {
<a name="l05309"></a>05309    <span class="keywordflow">if</span> (!chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a8d7d76fe50d5df516e63a27d39d28b2a" title="Set a given option.">setoption</a>) {
<a name="l05310"></a>05310       <a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> = ENOSYS;
<a name="l05311"></a>05311       <span class="keywordflow">return</span> -1;
<a name="l05312"></a>05312    }
<a name="l05313"></a>05313 
<a name="l05314"></a>05314    <span class="keywordflow">if</span> (block)
<a name="l05315"></a>05315       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;XXX Blocking not implemented yet XXX\n&quot;</span>);
<a name="l05316"></a>05316 
<a name="l05317"></a>05317    <span class="keywordflow">return</span> chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a8d7d76fe50d5df516e63a27d39d28b2a" title="Set a given option.">setoption</a>(chan, option, data, datalen);
<a name="l05318"></a>05318 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad690134faa51d238410543f225b1f4d8"></a><!-- doxytag: member="channel.c::ast_channel_setwhentohangup" ref="ad690134faa51d238410543f225b1f4d8" args="(struct ast_channel *chan, time_t offset)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_channel_setwhentohangup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&nbsp;</td>
          <td class="paramname"> <em>offset</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set when to hang a channel up. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel on which to check for hang up </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>offset</em>&nbsp;</td><td>offset in seconds relative to the current time of when to hang up</td></tr>
  </table>
  </dd>
</dl>
<p>This function sets the absolute time out on a channel (when to hang up).</p>
<dl class="note"><dt><b>Note:</b></dt><dd>This function does not require that the channel is locked before calling it.</dd></dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Nothing </dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="channel_8h.html#ac03c2ec5ac8e7a6ef9c5d92f91880927" title="Set when to hang a channel up.">ast_channel_setwhentohangup_tv()</a> </dd></dl>
<dl class="version"><dt><b>Version:</b></dt><dd>1.6.1 deprecated function (only had seconds precision) </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l00528">528</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l00521">ast_channel_setwhentohangup_tv()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00529"></a>00529 {
<a name="l00530"></a>00530    <span class="keyword">struct </span>timeval when = { offset, };
<a name="l00531"></a>00531    <a class="code" href="channel_8h.html#ac03c2ec5ac8e7a6ef9c5d92f91880927" title="Set when to hang a channel up.">ast_channel_setwhentohangup_tv</a>(chan, when);
<a name="l00532"></a>00532 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac03c2ec5ac8e7a6ef9c5d92f91880927"></a><!-- doxytag: member="channel.c::ast_channel_setwhentohangup_tv" ref="ac03c2ec5ac8e7a6ef9c5d92f91880927" args="(struct ast_channel *chan, struct timeval offset)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_channel_setwhentohangup_tv </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct timeval&nbsp;</td>
          <td class="paramname"> <em>offset</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set when to hangup channel. </p>
<p>Set when to hang a channel up. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l00521">521</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="frame_8c_source.html#l00124">ast_null_frame</a>, <a class="el" href="channel_8c_source.html#l01080">ast_queue_frame()</a>, <a class="el" href="utils_8c_source.html#l01365">ast_tvadd()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="time_8h_source.html#l00099">ast_tvzero()</a>, and <a class="el" href="channel_8h_source.html#l00441">ast_channel::whentohangup</a>.</p>

<p>Referenced by <a class="el" href="manager_8c_source.html#l02621">action_timeout()</a>, <a class="el" href="channel_8c_source.html#l00528">ast_channel_setwhentohangup()</a>, <a class="el" href="res__agi_8c_source.html#l01671">handle_autohangup()</a>, and <a class="el" href="func__timeout_8c_source.html#l00119">timeout_write()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00522"></a>00522 {
<a name="l00523"></a>00523    chan-&gt;<a class="code" href="structast__channel.html#a645928dea02ce2132b83e7e61ef5b80a">whentohangup</a> = <a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(offset) ? offset : <a class="code" href="time_8h.html#a97e1bb8fbd7a103212789e87e7ed6073" title="Returns the sum of two timevals a + b.">ast_tvadd</a>(offset, <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>());
<a name="l00524"></a>00524    <a class="code" href="channel_8h.html#a6cbcba5661d55216968cde8fdf913c89" title="Queue one or more frames to a channel&amp;#39;s frame queue.">ast_queue_frame</a>(chan, &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>);
<a name="l00525"></a>00525    <span class="keywordflow">return</span>;
<a name="l00526"></a>00526 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2a2e0ff24c57491a877cac39cb670024"></a><!-- doxytag: member="channel.c::ast_channel_start_silence_generator" ref="a2a2e0ff24c57491a877cac39cb670024" args="(struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__silence__generator.html">ast_silence_generator</a>* ast_channel_start_silence_generator </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Starts a silence generator on the given channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>The channel to generate silence on </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>An <a class="el" href="structast__silence__generator.html">ast_silence_generator</a> pointer, or NULL if an error occurs</dd></dl>
<p>This function will cause SLINEAR silence to be generated on the supplied channel until it is disabled; if the channel cannot be put into SLINEAR mode then the function will fail.</p>
<p>The pointer returned by this function must be preserved and passed to ast_channel_stop_silence_generator when you wish to stop the silence generation. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l05640">5640</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l02001">ast_activate_generator()</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8h_source.html#l00253">AST_FORMAT_SLINEAR</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8c_source.html#l03737">ast_set_write_format()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="channel_8c_source.html#l05637">ast_silence_generator::old_write_format</a>, and <a class="el" href="channel_8h_source.html#l00484">ast_channel::writeformat</a>.</p>

<p>Referenced by <a class="el" href="app_8c_source.html#l00668">__ast_play_and_record()</a>, <a class="el" href="app_8c_source.html#l00314">ast_dtmf_stream()</a>, <a class="el" href="channel_8c_source.html#l01328">ast_safe_sleep_conditional()</a>, <a class="el" href="app__chanspy_8c_source.html#l00445">channel_spy()</a>, <a class="el" href="app__record_8c_source.html#l00132">record_exec()</a>, <a class="el" href="chan__unistim_8c_source.html#l02305">TransferCallStep1()</a>, <a class="el" href="app__waitforsilence_8c_source.html#l00205">waitfor_exec()</a>, and <a class="el" href="app__waitforring_8c_source.html#l00056">waitforring_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05641"></a>05641 {
<a name="l05642"></a>05642    <span class="keyword">struct </span><a class="code" href="structast__silence__generator.html">ast_silence_generator</a> *<a class="code" href="structstate.html">state</a>;
<a name="l05643"></a>05643 
<a name="l05644"></a>05644    <span class="keywordflow">if</span> (!(state = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*state)))) {
<a name="l05645"></a>05645       <span class="keywordflow">return</span> NULL;
<a name="l05646"></a>05646    }
<a name="l05647"></a>05647 
<a name="l05648"></a>05648    state-&gt;<a class="code" href="structast__silence__generator.html#a79cc261c222b024395210f02709729f4">old_write_format</a> = chan-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a>;
<a name="l05649"></a>05649 
<a name="l05650"></a>05650    <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a978161a52d98fdaee374d1f6e1359544" title="Sets write format on channel chan Set write format for channel to whichever component...">ast_set_write_format</a>(chan, <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>) &lt; 0) {
<a name="l05651"></a>05651       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not set write format to SLINEAR\n&quot;</span>);
<a name="l05652"></a>05652       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(state);
<a name="l05653"></a>05653       <span class="keywordflow">return</span> NULL;
<a name="l05654"></a>05654    }
<a name="l05655"></a>05655 
<a name="l05656"></a>05656    <a class="code" href="channel_8h.html#a12a58dda74a19f383f6b77cf7fa88b54">ast_activate_generator</a>(chan, &amp;<a class="code" href="channel_8c.html#ac4fb3b333021e26b0305fe4949f5f254">silence_generator</a>, state);
<a name="l05657"></a>05657 
<a name="l05658"></a>05658    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Started silence generator on &apos;%s&apos;\n&quot;</span>, chan-&gt;name);
<a name="l05659"></a>05659 
<a name="l05660"></a>05660    <span class="keywordflow">return</span> state;
<a name="l05661"></a>05661 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6643cbe766a051d2d06750ab5b3e933d"></a><!-- doxytag: member="channel.c::ast_channel_stop_silence_generator" ref="a6643cbe766a051d2d06750ab5b3e933d" args="(struct ast_channel *chan, struct ast_silence_generator *state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_channel_stop_silence_generator </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__silence__generator.html">ast_silence_generator</a> *&nbsp;</td>
          <td class="paramname"> <em>state</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Stops a previously-started silence generator on the given channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>The channel to operate on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structstate.html">state</a></em>&nbsp;</td><td>The <a class="el" href="structast__silence__generator.html">ast_silence_generator</a> pointer return by a previous call to ast_channel_start_silence_generator. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>nothing</dd></dl>
<p>This function will stop the operating silence generator and return the channel to its previous write format. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l05663">5663</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l01956">ast_deactivate_generator()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8c_source.html#l03737">ast_set_write_format()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, and <a class="el" href="channel_8c_source.html#l05637">ast_silence_generator::old_write_format</a>.</p>

<p>Referenced by <a class="el" href="app_8c_source.html#l00668">__ast_play_and_record()</a>, <a class="el" href="app_8c_source.html#l00314">ast_dtmf_stream()</a>, <a class="el" href="channel_8c_source.html#l01328">ast_safe_sleep_conditional()</a>, <a class="el" href="app__chanspy_8c_source.html#l00445">channel_spy()</a>, <a class="el" href="chan__unistim_8c_source.html#l02351">HandleCallOutgoing()</a>, <a class="el" href="chan__unistim_8c_source.html#l02652">key_dial_page()</a>, <a class="el" href="app__record_8c_source.html#l00132">record_exec()</a>, <a class="el" href="chan__unistim_8c_source.html#l03709">unistim_hangup()</a>, <a class="el" href="app__waitforsilence_8c_source.html#l00205">waitfor_exec()</a>, and <a class="el" href="app__waitforring_8c_source.html#l00056">waitforring_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05664"></a>05664 {
<a name="l05665"></a>05665    <span class="keywordflow">if</span> (!state)
<a name="l05666"></a>05666       <span class="keywordflow">return</span>;
<a name="l05667"></a>05667 
<a name="l05668"></a>05668    <a class="code" href="channel_8h.html#a7160355005776732fba88cc020f4a45b">ast_deactivate_generator</a>(chan);
<a name="l05669"></a>05669 
<a name="l05670"></a>05670    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Stopped silence generator on &apos;%s&apos;\n&quot;</span>, chan-&gt;name);
<a name="l05671"></a>05671 
<a name="l05672"></a>05672    <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a978161a52d98fdaee374d1f6e1359544" title="Sets write format on channel chan Set write format for channel to whichever component...">ast_set_write_format</a>(chan, state-&gt;<a class="code" href="structast__silence__generator.html#a79cc261c222b024395210f02709729f4">old_write_format</a>) &lt; 0)
<a name="l05673"></a>05673       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not return write format to its original state\n&quot;</span>);
<a name="l05674"></a>05674 
<a name="l05675"></a>05675    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(state);
<a name="l05676"></a>05676 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad8aa1e0753aff7c104f4f4cf134eab68"></a><!-- doxytag: member="channel.c::ast_channel_supports_html" ref="ad8aa1e0753aff7c104f4f4cf134eab68" args="(struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_channel_supports_html </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>channel</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Checks for HTML support on a channel</p>
<p>Returns 0 if channel does not support HTML or non-zero if it does </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l04141">4141</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="structast__channel__tech.html#a8169d0cdf14765d08ed132b495170e3b">ast_channel_tech::send_html</a>, and <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>.</p>

<p>Referenced by <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="app__url_8c_source.html#l00093">sendurl_exec()</a>, and <a class="el" href="app__queue_8c_source.html#l03569">try_calling()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04142"></a>04142 {
<a name="l04143"></a>04143    <span class="keywordflow">return</span> (chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a8169d0cdf14765d08ed132b495170e3b" title="Send HTML data.">send_html</a>) ? 1 : 0;
<a name="l04144"></a>04144 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6e558e6f257935744c3c7f9cd79b169a"></a><!-- doxytag: member="channel.c::ast_channel_undefer_dtmf" ref="a6e558e6f257935744c3c7f9cd79b169a" args="(struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_channel_undefer_dtmf </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Unset defer DTMF flag on channel. </p>
<p>Undo defer. ast_read will return any dtmf characters that were queued </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01158">1158</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="utils_8h_source.html#l00075">ast_clear_flag</a>, and <a class="el" href="channel_8h_source.html#l00523">AST_FLAG_DEFER_DTMF</a>.</p>

<p>Referenced by <a class="el" href="res__adsi_8c_source.html#l00193">__adsi_transmit_messages()</a>, <a class="el" href="chan__iax2_8c_source.html#l13074">find_cache()</a>, and <a class="el" href="app__rpt_8c_source.html#l05280">rpt_call()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01159"></a>01159 {
<a name="l01160"></a>01160    <span class="keywordflow">if</span> (chan)
<a name="l01161"></a>01161       <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329ab05edf1bf82b02f5987de92a6960a9bd">AST_FLAG_DEFER_DTMF</a>);
<a name="l01162"></a>01162 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a53b708b7fc71dcbcd33acae0ad4d7ef8"></a><!-- doxytag: member="channel.c::ast_channel_unregister" ref="a53b708b7fc71dcbcd33acae0ad4d7ef8" args="(const struct ast_channel_tech *tech)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_channel_unregister </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structast__channel__tech.html">ast_channel_tech</a> *&nbsp;</td>
          <td class="paramname"> <em>tech</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Unregister channel driver. </p>
<p>Unregister a channel technology. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l00587">587</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="linkedlists_8h_source.html#l00553">AST_LIST_REMOVE_CURRENT</a>, <a class="el" href="linkedlists_8h_source.html#l00528">AST_LIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h_source.html#l00599">AST_LIST_TRAVERSE_SAFE_END</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="channel_8c_source.html#l00104">chanlist::tech</a>, and <a class="el" href="channel_8h_source.html#l00226">ast_channel_tech::type</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l15849">__unload_module()</a>, <a class="el" href="chan__console_8c_source.html#l01469">load_module()</a>, and <a class="el" href="chan__agent_8c_source.html#l02605">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00588"></a>00588 {
<a name="l00589"></a>00589    <span class="keyword">struct </span><a class="code" href="structchanlist.html" title="List of channel drivers.">chanlist</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>;
<a name="l00590"></a>00590 
<a name="l00591"></a>00591    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Unregistering channel type &apos;%s&apos;\n&quot;</span>, tech-&gt;<a class="code" href="structast__channel__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>);
<a name="l00592"></a>00592 
<a name="l00593"></a>00593    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>);
<a name="l00594"></a>00594 
<a name="l00595"></a>00595    <a class="code" href="linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d" title="Loops safely over (traverses) the entries in a list.">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(&amp;<a class="code" href="structbackends.html" title="the list of registered channel types">backends</a>, chan, <a class="code" href="structchanlist.html#ae16c3868ae9c6fd5cf5a94bc9fb6940c">list</a>) {
<a name="l00596"></a>00596       <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a> == tech) {
<a name="l00597"></a>00597          <a class="code" href="linkedlists_8h.html#aa8ac496fa9c717d5afb99a02e1e2760c" title="Removes the current entry from a list during a traversal.">AST_LIST_REMOVE_CURRENT</a>(<a class="code" href="structchanlist.html#ae16c3868ae9c6fd5cf5a94bc9fb6940c">list</a>);
<a name="l00598"></a>00598          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(chan);
<a name="l00599"></a>00599          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Unregistered channel type &apos;%s&apos;\n&quot;</span>, tech-&gt;<a class="code" href="structast__channel__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>);
<a name="l00600"></a>00600          <span class="keywordflow">break</span>;   
<a name="l00601"></a>00601       }
<a name="l00602"></a>00602    }
<a name="l00603"></a>00603    <a class="code" href="linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9" title="Closes a safe loop traversal block.">AST_LIST_TRAVERSE_SAFE_END</a>;
<a name="l00604"></a>00604 
<a name="l00605"></a>00605    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>);
<a name="l00606"></a>00606 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af287194cacb2db8ac7bb50d16a3a2d60"></a><!-- doxytag: member="channel.c::ast_channel_walk_locked" ref="af287194cacb2db8ac7bb50d16a3a2d60" args="(const struct ast_channel *prev)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__channel.html">ast_channel</a>* ast_channel_walk_locked </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>prev</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Browse <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> in use. </p>
<p>Browse <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> in use Browse the <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> currently in use. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01272">1272</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l01188">channel_find_locked()</a>.</p>

<p>Referenced by <a class="el" href="manager_8c_source.html#l02814">action_coreshowchannels()</a>, <a class="el" href="manager_8c_source.html#l01904">action_status()</a>, <a class="el" href="cli_8c_source.html#l01390">ast_complete_channels()</a>, <a class="el" href="agent_8c_source.html#l00583">ast_var_channel_bridge()</a>, <a class="el" href="agent_8c_source.html#l00529">ast_var_channel_types_table()</a>, <a class="el" href="agent_8c_source.html#l00228">ast_var_channels_table()</a>, <a class="el" href="app__dahdiscan_8c_source.html#l00290">conf_exec()</a>, <a class="el" href="func__channel_8c_source.html#l00352">func_channels_read()</a>, <a class="el" href="cli_8c_source.html#l00790">handle_chanlist()</a>, <a class="el" href="cli_8c_source.html#l01187">handle_core_set_debug_channel()</a>, and <a class="el" href="app__chanspy_8c_source.html#l00736">next_channel()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01273"></a>01273 {
<a name="l01274"></a>01274    <span class="keywordflow">return</span> <a class="code" href="channel_8c.html#a205b57c2db0974945d767d8fab853e9c" title="Helper function to find channels.">channel_find_locked</a>(prev, NULL, 0, NULL, NULL);
<a name="l01275"></a>01275 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acfffdd54a4bb4777e110dcb3e5118b4c"></a><!-- doxytag: member="channel.c::ast_channels_init" ref="acfffdd54a4bb4777e110dcb3e5118b4c" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_channels_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Provided by <a class="el" href="channel_8c.html" title="Channel Management.">channel.c</a> </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l05561">5561</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="cli_8c_source.html#l01927">ast_cli_register_multiple()</a>, and <a class="el" href="channel_8c_source.html#l00329">cli_channel</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05562"></a>05562 {
<a name="l05563"></a>05563    <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(<a class="code" href="channel_8c.html#ad74ec6057ffa0240c8dde77284958fbe">cli_channel</a>, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="channel_8c.html#ad74ec6057ffa0240c8dde77284958fbe">cli_channel</a>));
<a name="l05564"></a>05564 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae5039a62fbb5dc1ecb217f10940d19df"></a><!-- doxytag: member="channel.c::ast_channeltype_list" ref="ae5039a62fbb5dc1ecb217f10940d19df" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__variable.html">ast_variable</a>* ast_channeltype_list </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>return an <a class="el" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> list of channeltypes </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l00186">186</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="config_8c_source.html#l00223">ast_variable_new()</a>, <a class="el" href="channel_8h_source.html#l00227">ast_channel_tech::description</a>, <a class="el" href="channel_8c_source.html#l00104">chanlist::tech</a>, <a class="el" href="channel_8h_source.html#l00226">ast_channel_tech::type</a>, and <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>.</p>

<p>Referenced by <a class="el" href="agent_8c_source.html#l00510">ast_var_channel_types()</a>, and <a class="el" href="agent_8c_source.html#l00529">ast_var_channel_types_table()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00187"></a>00187 {
<a name="l00188"></a>00188    <span class="keyword">struct </span><a class="code" href="structchanlist.html" title="List of channel drivers.">chanlist</a> *cl;
<a name="l00189"></a>00189    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>=NULL, *prev = NULL;
<a name="l00190"></a>00190    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="structbackends.html" title="the list of registered channel types">backends</a>, cl, list) {
<a name="l00191"></a>00191       <span class="keywordflow">if</span> (prev)  {
<a name="l00192"></a>00192          <span class="keywordflow">if</span> ((prev-&gt;next = <a class="code" href="config_8h.html#a08e94d96f459e7301a74daf32035423b">ast_variable_new</a>(cl-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>, cl-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#ac57ec035c076b222b9420a68ddab3bf1">description</a>, <span class="stringliteral">&quot;&quot;</span>)))
<a name="l00193"></a>00193             prev = prev-&gt;next;
<a name="l00194"></a>00194       } <span class="keywordflow">else</span> {
<a name="l00195"></a>00195          var = <a class="code" href="config_8h.html#a08e94d96f459e7301a74daf32035423b">ast_variable_new</a>(cl-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>, cl-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#ac57ec035c076b222b9420a68ddab3bf1">description</a>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00196"></a>00196          prev = var;
<a name="l00197"></a>00197       }
<a name="l00198"></a>00198    }
<a name="l00199"></a>00199    <span class="keywordflow">return</span> var;
<a name="l00200"></a>00200 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9c63fff1d736568d1ee332dd7ea502bd"></a><!-- doxytag: member="channel.c::ast_check_hangup" ref="a9c63fff1d736568d1ee332dd7ea502bd" args="(struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_check_hangup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Checks to see if a channel is needing hang up. </p>
<p>Check to see if a channel is needing hang up. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l00461">461</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00462">ast_channel::_softhangup</a>, <a class="el" href="channel_8h_source.html#l00637">AST_SOFTHANGUP_TIMEOUT</a>, <a class="el" href="time_8h_source.html#l00089">ast_tvdiff_ms()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="time_8h_source.html#l00099">ast_tvzero()</a>, and <a class="el" href="channel_8h_source.html#l00441">ast_channel::whentohangup</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l04214">__ast_pbx_run()</a>, <a class="el" href="channel_8c_source.html#l02636">__ast_read()</a>, <a class="el" href="app__macro_8c_source.html#l00219">_macro_exec()</a>, <a class="el" href="manager_8c_source.html#l02084">action_redirect()</a>, <a class="el" href="chan__agent_8c_source.html#l00729">agent_indicate()</a>, <a class="el" href="res__agi_8c_source.html#l03279">agi_exec()</a>, <a class="el" href="res__agi_8c_source.html#l02777">agi_handle_command()</a>, <a class="el" href="app__meetme_8c_source.html#l01907">announce_thread()</a>, <a class="el" href="features_8c_source.html#l02441">ast_bridge_call()</a>, <a class="el" href="channel_8c_source.html#l04042">ast_call()</a>, <a class="el" href="channel_8c_source.html#l05055">ast_channel_bridge()</a>, <a class="el" href="channel_8c_source.html#l00473">ast_check_hangup_locked()</a>, <a class="el" href="channel_8c_source.html#l03150">ast_indicate_data()</a>, <a class="el" href="channel_8c_source.html#l01799">ast_raw_answer()</a>, <a class="el" href="channel_8c_source.html#l04093">ast_readstring_full()</a>, <a class="el" href="channel_8c_source.html#l03275">ast_recvtext()</a>, <a class="el" href="rtp_8c_source.html#l04398">ast_rtp_bridge()</a>, <a class="el" href="channel_8c_source.html#l03302">ast_sendtext()</a>, <a class="el" href="channel_8c_source.html#l04070">ast_transfer()</a>, <a class="el" href="udptl_8c_source.html#l01150">ast_udptl_bridge()</a>, <a class="el" href="channel_8c_source.html#l02438">ast_waitfordigit_full()</a>, <a class="el" href="channel_8c_source.html#l03411">ast_write()</a>, <a class="el" href="autoservice_8c_source.html#l00073">autoservice_run()</a>, <a class="el" href="features_8c_source.html#l00412">bridge_call_thread()</a>, <a class="el" href="features_8c_source.html#l04524">bridge_exec()</a>, <a class="el" href="rtp_8c_source.html#l03915">bridge_native_loop()</a>, <a class="el" href="rtp_8c_source.html#l04223">bridge_p2p_loop()</a>, <a class="el" href="features_8c_source.html#l01396">builtin_atxfer()</a>, <a class="el" href="app__chanspy_8c_source.html#l00445">channel_spy()</a>, <a class="el" href="chan__local_8c_source.html#l00289">check_bridge()</a>, <a class="el" href="app__chanspy_8c_source.html#l00767">common_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l01013">conf_play()</a>, <a class="el" href="app__meetme_8c_source.html#l01998">conf_run()</a>, <a class="el" href="chan__dahdi_8c_source.html#l17380">dahdi_sendtext()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04837">dahdi_setoption()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="pbx__dundi_8c_source.html#l03574">dundi_lookup_internal()</a>, <a class="el" href="res__agi_8c_source.html#l03287">eagi_exec()</a>, <a class="el" href="app__externalivr_8c_source.html#l00521">eivr_comm()</a>, <a class="el" href="features_8c_source.html#l02152">feature_request_and_dial()</a>, <a class="el" href="app__followme_8c_source.html#l00777">findmeexec()</a>, <a class="el" href="res__agi_8c_source.html#l01137">handle_sendimage()</a>, <a class="el" href="chan__iax2_8c_source.html#l05170">iax2_bridge()</a>, <a class="el" href="res__agi_8c_source.html#l00617">launch_asyncagi()</a>, <a class="el" href="pbx__lua_8c_source.html#l00715">lua_check_hangup()</a>, <a class="el" href="app__osplookup_8c_source.html#l01657">ospfinished_exec()</a>, <a class="el" href="pbx_8c_source.html#l08536">pbx_builtin_incomplete()</a>, <a class="el" href="pbx_8c_source.html#l01322">pbx_exec()</a>, <a class="el" href="app__read_8c_source.html#l00127">read_exec()</a>, <a class="el" href="app__readexten_8c_source.html#l00128">readexten_exec()</a>, <a class="el" href="app__rpt_8c_source.html#l10730">rpt()</a>, <a class="el" href="app__rpt_8c_source.html#l13122">rpt_exec()</a>, <a class="el" href="app__dahdiras_8c_source.html#l00132">run_ras()</a>, <a class="el" href="app__queue_8c_source.html#l03569">try_calling()</a>, and <a class="el" href="app__dial_8c_source.html#l00818">wait_for_answer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00462"></a>00462 {
<a name="l00463"></a>00463    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a>)     <span class="comment">/* yes if soft hangup flag set */</span>
<a name="l00464"></a>00464       <span class="keywordflow">return</span> 1;
<a name="l00465"></a>00465    <span class="keywordflow">if</span> (<a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(chan-&gt;<a class="code" href="structast__channel.html#a645928dea02ce2132b83e7e61ef5b80a">whentohangup</a>)) <span class="comment">/* no if no hangup scheduled */</span>
<a name="l00466"></a>00466       <span class="keywordflow">return</span> 0;
<a name="l00467"></a>00467    <span class="keywordflow">if</span> (<a class="code" href="time_8h.html#a74e35cffcd45ad6cd7c8587921e8a4c2" title="Computes the difference (in milliseconds) between two struct timeval instances.">ast_tvdiff_ms</a>(chan-&gt;<a class="code" href="structast__channel.html#a645928dea02ce2132b83e7e61ef5b80a">whentohangup</a>, <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>()) &gt; 0)  <span class="comment">/* no if hangup time has not come yet. */</span>
<a name="l00468"></a>00468       <span class="keywordflow">return</span> 0;
<a name="l00469"></a>00469    chan-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> |= <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709a90cd950abc1c22b0701a476bdd6cc246">AST_SOFTHANGUP_TIMEOUT</a>; <span class="comment">/* record event */</span>
<a name="l00470"></a>00470    <span class="keywordflow">return</span> 1;
<a name="l00471"></a>00471 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4f08aa89bd0b65faba26148b6c836b2a"></a><!-- doxytag: member="channel.c::ast_check_hangup_locked" ref="a4f08aa89bd0b65faba26148b6c836b2a" args="(struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ast_check_hangup_locked </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l00473">473</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, and <a class="el" href="channel_8c_source.html#l00461">ast_check_hangup()</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l05055">ast_channel_bridge()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00474"></a>00474 {
<a name="l00475"></a>00475    <span class="keywordtype">int</span> res;
<a name="l00476"></a>00476    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l00477"></a>00477    res = <a class="code" href="channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd" title="Check to see if a channel is needing hang up.">ast_check_hangup</a>(chan);
<a name="l00478"></a>00478    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l00479"></a>00479    <span class="keywordflow">return</span> res;
<a name="l00480"></a>00480 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7160355005776732fba88cc020f4a45b"></a><!-- doxytag: member="channel.c::ast_deactivate_generator" ref="a7160355005776732fba88cc020f4a45b" args="(struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_deactivate_generator </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Deactivate an active generator </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01956">1956</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="channel_8c_source.html#l01576">ast_channel_set_fd()</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="utils_8h_source.html#l00075">ast_clear_flag</a>, <a class="el" href="channel_8h_source.html#l00525">AST_FLAG_WRITE_INT</a>, <a class="el" href="channel_8h_source.html#l00161">AST_GENERATOR_FD</a>, <a class="el" href="channel_8c_source.html#l02405">ast_settimeout()</a>, <a class="el" href="channel_8h_source.html#l00404">ast_channel::generator</a>, <a class="el" href="channel_8h_source.html#l00403">ast_channel::generatordata</a>, and <a class="el" href="structast__generator.html#af1e67c15ec62c02506efc4f2f305bbe0">ast_generator::release</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l02636">__ast_read()</a>, <a class="el" href="app__externalivr_8c_source.html#l00314">app_exec()</a>, <a class="el" href="channel_8c_source.html#l05663">ast_channel_stop_silence_generator()</a>, <a class="el" href="file_8c_source.html#l00624">ast_openstream_full()</a>, <a class="el" href="indications_8c_source.html#l00390">ast_playtones_stop()</a>, <a class="el" href="chan__sip_8c_source.html#l18877">ast_quiet_chan()</a>, <a class="el" href="channel_8c_source.html#l02530">ast_read_generator_actions()</a>, <a class="el" href="channel_8c_source.html#l05462">ast_tonepair_stop()</a>, <a class="el" href="channel_8c_source.html#l03411">ast_write()</a>, <a class="el" href="chan__misdn_8c_source.html#l04379">cb_events()</a>, <a class="el" href="app__chanspy_8c_source.html#l00445">channel_spy()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="channel_8c_source.html#l01971">generator_force()</a>, <a class="el" href="res__musiconhold_8c_source.html#l01433">local_ast_moh_stop()</a>, <a class="el" href="app__milliwatt_8c_source.html#l00121">old_milliwatt_exec()</a>, <a class="el" href="app__fax_8c_source.html#l00362">transmit_audio()</a>, and <a class="el" href="app__dial_8c_source.html#l00818">wait_for_answer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01957"></a>01957 {
<a name="l01958"></a>01958    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l01959"></a>01959    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#abe7876f86e249ea3db5fbacd2231389c">generatordata</a>) {
<a name="l01960"></a>01960       <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a4e855ab0f984741b9083b2c5a0fdfe18">generator</a> &amp;&amp; chan-&gt;<a class="code" href="structast__channel.html#a4e855ab0f984741b9083b2c5a0fdfe18">generator</a>-&gt;<a class="code" href="structast__generator.html#af1e67c15ec62c02506efc4f2f305bbe0">release</a>)
<a name="l01961"></a>01961          chan-&gt;<a class="code" href="structast__channel.html#a4e855ab0f984741b9083b2c5a0fdfe18">generator</a>-&gt;<a class="code" href="structast__generator.html#af1e67c15ec62c02506efc4f2f305bbe0">release</a>(chan, chan-&gt;<a class="code" href="structast__channel.html#abe7876f86e249ea3db5fbacd2231389c">generatordata</a>);
<a name="l01962"></a>01962       chan-&gt;<a class="code" href="structast__channel.html#abe7876f86e249ea3db5fbacd2231389c">generatordata</a> = NULL;
<a name="l01963"></a>01963       chan-&gt;<a class="code" href="structast__channel.html#a4e855ab0f984741b9083b2c5a0fdfe18">generator</a> = NULL;
<a name="l01964"></a>01964       <a class="code" href="channel_8h.html#aca37ca2f3d55a223d26617329ed48a3e">ast_channel_set_fd</a>(chan, <a class="code" href="channel_8h.html#a34c26382160debe3411987ec0df1f927">AST_GENERATOR_FD</a>, -1);
<a name="l01965"></a>01965       <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a9deec175d13a40a6a5fdb527b13c6878">AST_FLAG_WRITE_INT</a>);
<a name="l01966"></a>01966       <a class="code" href="channel_8h.html#abb39926813ff8874f8e453ca04307e53" title="Enable or disable timer ticks for a channel.">ast_settimeout</a>(chan, 0, NULL, NULL);
<a name="l01967"></a>01967    }
<a name="l01968"></a>01968    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l01969"></a>01969 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a680cadb3f6b84fc2b11e0f2b0ec892a5"></a><!-- doxytag: member="channel.c::ast_do_masquerade" ref="a680cadb3f6b84fc2b11e0f2b0ec892a5" args="(struct ast_channel *original)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_do_masquerade </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>original</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Masquerade a channel. </p>
<p>Start masquerading a channel XXX This is a seriously whacked out operation. We're essentially putting the guts of the clone channel into the original channel. Start by killing off the original channel's backend. I'm not sure we're going to keep this function, because while the features are nice, the cost is very high in terms of pure nastiness. XXX.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>Assumes channel will be locked when called </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l04393">4393</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00462">ast_channel::_softhangup</a>, <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="channel_8h_source.html#l00474">ast_channel::adsicpe</a>, <a class="el" href="channel_8h_source.html#l00481">ast_channel::alertpipe</a>, <a class="el" href="app_8c_source.html#l01094">ast_app_group_update()</a>, <a class="el" href="channel_8c_source.html#l00629">ast_cause2str()</a>, <a class="el" href="channel_8c_source.html#l01388">ast_channel_free()</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="channel_8h_source.html#l00136">AST_CHANNEL_NAME</a>, <a class="el" href="channel_8c_source.html#l01576">ast_channel_set_fd()</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="channel_8h_source.html#l00527">AST_FLAG_BLOCKING</a>, <a class="el" href="channel_8h_source.html#l00531">AST_FLAG_EXCEPTION</a>, <a class="el" href="channel_8h_source.html#l00543">AST_FLAG_OUTGOING</a>, <a class="el" href="channel_8h_source.html#l00529">AST_FLAG_ZOMBIE</a>, <a class="el" href="channel_8h_source.html#l00161">AST_GENERATOR_FD</a>, <a class="el" href="channel_8c_source.html#l03110">ast_indicate()</a>, <a class="el" href="linkedlists_8h_source.html#l00767">AST_LIST_APPEND_LIST</a>, <a class="el" href="linkedlists_8h_source.html#l00420">AST_LIST_FIRST</a>, <a class="el" href="linkedlists_8h_source.html#l00224">AST_LIST_HEAD_NOLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00387">AST_LIST_HEAD_SET_NOLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00715">AST_LIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00817">AST_LIST_REMOVE_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00528">AST_LIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h_source.html#l00599">AST_LIST_TRAVERSE_SAFE_END</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8h_source.html#l00153">AST_MAX_FDS</a>, <a class="el" href="frame_8c_source.html#l00124">ast_null_frame</a>, <a class="el" href="channel_8c_source.html#l01080">ast_queue_frame()</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="channel_8c_source.html#l03731">ast_set_read_format()</a>, <a class="el" href="channel_8c_source.html#l03737">ast_set_write_format()</a>, <a class="el" href="channel_8h_source.html#l00633">AST_SOFTHANGUP_DEV</a>, <a class="el" href="channel_8c_source.html#l00656">ast_state2str()</a>, <a class="el" href="stringfields_8h_source.html#l00285">ast_string_field_set</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="channel_8h_source.html#l00159">AST_TIMING_FD</a>, <a class="el" href="channel_8h_source.html#l00442">ast_channel::blocker</a>, <a class="el" href="channel_8h_source.html#l00422">ast_channel::cdr</a>, <a class="el" href="structast__datastore__info.html#a556973b4df9f75e4fcaa1475d2cb5835">ast_datastore_info::chan_fixup</a>, <a class="el" href="channel_8h_source.html#l00444">ast_channel::cid</a>, <a class="el" href="channel_8c_source.html#l04351">clone_variables()</a>, <a class="el" href="datastore_8h_source.html#l00056">ast_datastore::data</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="manager_8h_source.html#l00062">EVENT_FLAG_CALL</a>, <a class="el" href="channel_8h_source.html#l00464">ast_channel::fdno</a>, <a class="el" href="channel_8h_source.html#l00458">ast_channel::fds</a>, <a class="el" href="structast__channel__tech.html#a058f4cf557afc32cc5b7a6b2782b33db">ast_channel_tech::fixup</a>, <a class="el" href="channel_8c_source.html#l01677">free_translation()</a>, <a class="el" href="structast__channel__tech.html#af210bbcabfb03e05658a12e1d9327239">ast_channel_tech::hangup</a>, <a class="el" href="channel_8h_source.html#l00479">ast_channel::hangupcause</a>, <a class="el" href="datastore_8h_source.html#l00057">ast_datastore::info</a>, <a class="el" href="chan__alsa_8c_source.html#l00106">language</a>, <a class="el" href="channel_8h_source.html#l00443">ast_channel::lock_dont_use</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="manager_8h_source.html#l00181">manager_event</a>, <a class="el" href="channel_8h_source.html#l00408">ast_channel::masq</a>, <a class="el" href="channel_8h_source.html#l00409">ast_channel::masqr</a>, <a class="el" href="channel_8h_source.html#l00425">ast_channel::monitor</a>, <a class="el" href="chan__mgcp_8c_source.html#l00146">musicclass</a>, <a class="el" href="cdr__adaptive__odbc_8c_source.html#l00053">name</a>, <a class="el" href="channel_8h_source.html#l00482">ast_channel::nativeformats</a>, <a class="el" href="channel_8h_source.html#l00485">ast_channel::rawreadformat</a>, <a class="el" href="channel_8h_source.html#l00486">ast_channel::rawwriteformat</a>, <a class="el" href="channel_8h_source.html#l00483">ast_channel::readformat</a>, <a class="el" href="channel_8c_source.html#l04371">report_new_callerid()</a>, <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, <a class="el" href="channel_8h_source.html#l00468">ast_channel::timingfd</a>, <a class="el" href="channel_8h_source.html#l00226">ast_channel_tech::type</a>, <a class="el" href="channel_8h_source.html#l00491">ast_channel::visible_indication</a>, and <a class="el" href="channel_8h_source.html#l00484">ast_channel::writeformat</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l02636">__ast_read()</a>, <a class="el" href="pbx_8c_source.html#l07344">ast_async_goto()</a>, <a class="el" href="channel_8c_source.html#l01690">ast_hangup()</a>, <a class="el" href="channel_8c_source.html#l02041">ast_waitfor_nandfds()</a>, <a class="el" href="channel_8c_source.html#l03411">ast_write()</a>, <a class="el" href="features_8c_source.html#l04126">do_bridge_masquerade()</a>, <a class="el" href="chan__sip_8c_source.html#l19184">handle_invite_replaces()</a>, <a class="el" href="chan__iax2_8c_source.html#l08941">iax_park()</a>, <a class="el" href="chan__sip_8c_source.html#l18778">sip_park()</a>, and <a class="el" href="chan__sip_8c_source.html#l18706">sip_park_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04394"></a>04394 {
<a name="l04395"></a>04395    <span class="keywordtype">int</span> x,i;
<a name="l04396"></a>04396    <span class="keywordtype">int</span> res=0;
<a name="l04397"></a>04397    <span class="keywordtype">int</span> origstate;
<a name="l04398"></a>04398    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *current;
<a name="l04399"></a>04399    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structast__channel__tech.html" title="Structure to describe a channel &amp;quot;technology&amp;quot;, ie a channel driver See for...">ast_channel_tech</a> *t;
<a name="l04400"></a>04400    <span class="keywordtype">void</span> *t_pvt;
<a name="l04401"></a>04401    <span class="keyword">struct </span><a class="code" href="structast__callerid.html" title="Structure for all kinds of caller ID identifications.">ast_callerid</a> tmpcid;
<a name="l04402"></a>04402    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *clonechan = original-&gt;<a class="code" href="structast__channel.html#ae38ae730b987d648a6fe1c84c8a13442">masq</a>;
<a name="l04403"></a>04403    <span class="keyword">struct </span><a class="code" href="structast__cdr.html" title="Responsible for call detail data.">ast_cdr</a> *cdr;
<a name="l04404"></a>04404    <span class="keywordtype">int</span> rformat = original-&gt;<a class="code" href="structast__channel.html#ab7786a0f5b9a9ebf83daed87be4f3868">readformat</a>;
<a name="l04405"></a>04405    <span class="keywordtype">int</span> wformat = original-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a>;
<a name="l04406"></a>04406    <span class="keywordtype">char</span> newn[<a class="code" href="channel_8h.html#ab57c278099ea5f8d7cedbb41eba58b56">AST_CHANNEL_NAME</a>];
<a name="l04407"></a>04407    <span class="keywordtype">char</span> orig[<a class="code" href="channel_8h.html#ab57c278099ea5f8d7cedbb41eba58b56">AST_CHANNEL_NAME</a>];
<a name="l04408"></a>04408    <span class="keywordtype">char</span> masqn[<a class="code" href="channel_8h.html#ab57c278099ea5f8d7cedbb41eba58b56">AST_CHANNEL_NAME</a>];
<a name="l04409"></a>04409    <span class="keywordtype">char</span> zombn[<a class="code" href="channel_8h.html#ab57c278099ea5f8d7cedbb41eba58b56">AST_CHANNEL_NAME</a>];
<a name="l04410"></a>04410 
<a name="l04411"></a>04411    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(4, <span class="stringliteral">&quot;Actually Masquerading %s(%d) into the structure of %s(%d)\n&quot;</span>,
<a name="l04412"></a>04412       clonechan-&gt;name, clonechan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>, original-&gt;name, original-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>);
<a name="l04413"></a>04413 
<a name="l04414"></a>04414    <a class="code" href="manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208" title="External routines may send asterisk manager events this way.">manager_event</a>(<a class="code" href="manager_8h.html#ab5db3cc603d7e798d61cb4cd94fbb4e2">EVENT_FLAG_CALL</a>, <span class="stringliteral">&quot;Masquerade&quot;</span>, <span class="stringliteral">&quot;Clone: %s\r\nCloneState: %s\r\nOriginal: %s\r\nOriginalState: %s\r\n&quot;</span>,
<a name="l04415"></a>04415             clonechan-&gt;name, <a class="code" href="channel_8h.html#ac97b5983ea4bf3cc217ea898ca002759" title="Gives the string form of a given channel state.">ast_state2str</a>(clonechan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>), original-&gt;name, <a class="code" href="channel_8h.html#ac97b5983ea4bf3cc217ea898ca002759" title="Gives the string form of a given channel state.">ast_state2str</a>(original-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>));
<a name="l04416"></a>04416 
<a name="l04417"></a>04417    <span class="comment">/* XXX This operation is a bit odd.  We&apos;re essentially putting the guts of</span>
<a name="l04418"></a>04418 <span class="comment">    * the clone channel into the original channel.  Start by killing off the</span>
<a name="l04419"></a>04419 <span class="comment">    * original channel&apos;s backend.  While the features are nice, which is the</span>
<a name="l04420"></a>04420 <span class="comment">    * reason we&apos;re keeping it, it&apos;s still awesomely weird. XXX */</span>
<a name="l04421"></a>04421 
<a name="l04422"></a>04422    <span class="comment">/* We need the clone&apos;s lock, too */</span>
<a name="l04423"></a>04423    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(clonechan);
<a name="l04424"></a>04424 
<a name="l04425"></a>04425    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;Got clone lock for masquerade on &apos;%s&apos; at %p\n&quot;</span>, clonechan-&gt;name, &amp;clonechan-&gt;<a class="code" href="structast__channel.html#a8dc1b6301d8284eb0f31f2d723902a99">lock_dont_use</a>);
<a name="l04426"></a>04426 
<a name="l04427"></a>04427    <span class="comment">/* Having remembered the original read/write formats, we turn off any translation on either</span>
<a name="l04428"></a>04428 <span class="comment">      one */</span>
<a name="l04429"></a>04429    <a class="code" href="channel_8c.html#ac9d4d03c20c48d15d9e91a85c5e35d67">free_translation</a>(clonechan);
<a name="l04430"></a>04430    <a class="code" href="channel_8c.html#ac9d4d03c20c48d15d9e91a85c5e35d67">free_translation</a>(original);
<a name="l04431"></a>04431 
<a name="l04432"></a>04432 
<a name="l04433"></a>04433    <span class="comment">/* Unlink the masquerade */</span>
<a name="l04434"></a>04434    original-&gt;<a class="code" href="structast__channel.html#ae38ae730b987d648a6fe1c84c8a13442">masq</a> = NULL;
<a name="l04435"></a>04435    clonechan-&gt;<a class="code" href="structast__channel.html#abb53278bc00235a5ff76fc8badbe6363">masqr</a> = NULL;
<a name="l04436"></a>04436    
<a name="l04437"></a>04437    <span class="comment">/* Save the original name */</span>
<a name="l04438"></a>04438    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(orig, original-&gt;name, <span class="keyword">sizeof</span>(orig));
<a name="l04439"></a>04439    <span class="comment">/* Save the new name */</span>
<a name="l04440"></a>04440    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(newn, clonechan-&gt;name, <span class="keyword">sizeof</span>(newn));
<a name="l04441"></a>04441    <span class="comment">/* Create the masq name */</span>
<a name="l04442"></a>04442    snprintf(masqn, <span class="keyword">sizeof</span>(masqn), <span class="stringliteral">&quot;%s&lt;MASQ&gt;&quot;</span>, newn);
<a name="l04443"></a>04443       
<a name="l04444"></a>04444    <span class="comment">/* Copy the name from the clone channel */</span>
<a name="l04445"></a>04445    <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(original, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, newn);
<a name="l04446"></a>04446 
<a name="l04447"></a>04447    <span class="comment">/* Mangle the name of the clone channel */</span>
<a name="l04448"></a>04448    <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(clonechan, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, masqn);
<a name="l04449"></a>04449    
<a name="l04450"></a>04450    <span class="comment">/* Notify any managers of the change, first the masq then the other */</span>
<a name="l04451"></a>04451    <a class="code" href="manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208" title="External routines may send asterisk manager events this way.">manager_event</a>(<a class="code" href="manager_8h.html#ab5db3cc603d7e798d61cb4cd94fbb4e2">EVENT_FLAG_CALL</a>, <span class="stringliteral">&quot;Rename&quot;</span>, <span class="stringliteral">&quot;Channel: %s\r\nNewname: %s\r\nUniqueid: %s\r\n&quot;</span>, newn, masqn, clonechan-&gt;uniqueid);
<a name="l04452"></a>04452    <a class="code" href="manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208" title="External routines may send asterisk manager events this way.">manager_event</a>(<a class="code" href="manager_8h.html#ab5db3cc603d7e798d61cb4cd94fbb4e2">EVENT_FLAG_CALL</a>, <span class="stringliteral">&quot;Rename&quot;</span>, <span class="stringliteral">&quot;Channel: %s\r\nNewname: %s\r\nUniqueid: %s\r\n&quot;</span>, orig, newn, original-&gt;uniqueid);
<a name="l04453"></a>04453 
<a name="l04454"></a>04454    <span class="comment">/* Swap the technologies */</span>   
<a name="l04455"></a>04455    t = original-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>;
<a name="l04456"></a>04456    original-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a> = clonechan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>;
<a name="l04457"></a>04457    clonechan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a> = t;
<a name="l04458"></a>04458 
<a name="l04459"></a>04459    <span class="comment">/* Swap the cdrs */</span>
<a name="l04460"></a>04460    cdr = original-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>;
<a name="l04461"></a>04461    original-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a> = clonechan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>;
<a name="l04462"></a>04462    clonechan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a> = cdr;
<a name="l04463"></a>04463 
<a name="l04464"></a>04464    t_pvt = original-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l04465"></a>04465    original-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a> = clonechan-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l04466"></a>04466    clonechan-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a> = t_pvt;
<a name="l04467"></a>04467 
<a name="l04468"></a>04468    <span class="comment">/* Swap the alertpipes */</span>
<a name="l04469"></a>04469    <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) {
<a name="l04470"></a>04470       x = original-&gt;<a class="code" href="structast__channel.html#a249765022c528d61c3ab376660b64d0e">alertpipe</a>[i];
<a name="l04471"></a>04471       original-&gt;<a class="code" href="structast__channel.html#a249765022c528d61c3ab376660b64d0e">alertpipe</a>[i] = clonechan-&gt;<a class="code" href="structast__channel.html#a249765022c528d61c3ab376660b64d0e">alertpipe</a>[i];
<a name="l04472"></a>04472       clonechan-&gt;<a class="code" href="structast__channel.html#a249765022c528d61c3ab376660b64d0e">alertpipe</a>[i] = x;
<a name="l04473"></a>04473    }
<a name="l04474"></a>04474 
<a name="l04475"></a>04475    <span class="comment">/* </span>
<a name="l04476"></a>04476 <span class="comment">    * Swap the readq&apos;s.  The end result should be this:</span>
<a name="l04477"></a>04477 <span class="comment">    *</span>
<a name="l04478"></a>04478 <span class="comment">    *  1) All frames should be on the new (original) channel.</span>
<a name="l04479"></a>04479 <span class="comment">    *  2) Any frames that were already on the new channel before this</span>
<a name="l04480"></a>04480 <span class="comment">    *     masquerade need to be at the end of the readq, after all of the</span>
<a name="l04481"></a>04481 <span class="comment">    *     frames on the old (clone) channel.</span>
<a name="l04482"></a>04482 <span class="comment">    *  3) The alertpipe needs to get poked for every frame that was already</span>
<a name="l04483"></a>04483 <span class="comment">    *     on the new channel, since we are now using the alert pipe from the</span>
<a name="l04484"></a>04484 <span class="comment">    *     old (clone) channel.</span>
<a name="l04485"></a>04485 <span class="comment">    */</span>
<a name="l04486"></a>04486    {
<a name="l04487"></a>04487       <a class="code" href="linkedlists_8h.html#a117cbef6a40010cd3c84a16fd9ef4ca6" title="Defines a structure to be used to hold a list of specified type (with no lock).">AST_LIST_HEAD_NOLOCK</a>(, <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a>) tmp_readq;
<a name="l04488"></a>04488       <a class="code" href="linkedlists_8h.html#ad545834912417101a9a4dbf58991333d" title="Initializes a list head structure with a specified first entry.">AST_LIST_HEAD_SET_NOLOCK</a>(&amp;tmp_readq, NULL);
<a name="l04489"></a>04489 
<a name="l04490"></a>04490       <a class="code" href="linkedlists_8h.html#ad66405f1d0b9e1fb484643d9a36e94ed" title="Appends a whole list to the tail of a list.">AST_LIST_APPEND_LIST</a>(&amp;tmp_readq, &amp;original-&gt;readq, frame_list);
<a name="l04491"></a>04491       <a class="code" href="linkedlists_8h.html#ad66405f1d0b9e1fb484643d9a36e94ed" title="Appends a whole list to the tail of a list.">AST_LIST_APPEND_LIST</a>(&amp;original-&gt;readq, &amp;clonechan-&gt;readq, frame_list);
<a name="l04492"></a>04492 
<a name="l04493"></a>04493       while ((current = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;tmp_readq, frame_list))) {
<a name="l04494"></a>04494          <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;original-&gt;readq, current, frame_list);
<a name="l04495"></a>04495          <span class="keywordflow">if</span> (original-&gt;<a class="code" href="structast__channel.html#a249765022c528d61c3ab376660b64d0e">alertpipe</a>[1] &gt; -1) {
<a name="l04496"></a>04496             <span class="keywordtype">int</span> poke = 0;
<a name="l04497"></a>04497 
<a name="l04498"></a>04498             <span class="keywordflow">if</span> (write(original-&gt;<a class="code" href="structast__channel.html#a249765022c528d61c3ab376660b64d0e">alertpipe</a>[1], &amp;poke, <span class="keyword">sizeof</span>(poke)) &lt; 0) {
<a name="l04499"></a>04499                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;write() failed: %s\n&quot;</span>, strerror(errno));
<a name="l04500"></a>04500             }
<a name="l04501"></a>04501          }
<a name="l04502"></a>04502       }
<a name="l04503"></a>04503    }
<a name="l04504"></a>04504 
<a name="l04505"></a>04505    <span class="comment">/* Swap the raw formats */</span>
<a name="l04506"></a>04506    x = original-&gt;<a class="code" href="structast__channel.html#a6fcf944239e3718e282e0ba7512e66c6">rawreadformat</a>;
<a name="l04507"></a>04507    original-&gt;<a class="code" href="structast__channel.html#a6fcf944239e3718e282e0ba7512e66c6">rawreadformat</a> = clonechan-&gt;<a class="code" href="structast__channel.html#a6fcf944239e3718e282e0ba7512e66c6">rawreadformat</a>;
<a name="l04508"></a>04508    clonechan-&gt;<a class="code" href="structast__channel.html#a6fcf944239e3718e282e0ba7512e66c6">rawreadformat</a> = x;
<a name="l04509"></a>04509    x = original-&gt;<a class="code" href="structast__channel.html#a045b6dfdee84adceb7e86b6c5c4f9a86">rawwriteformat</a>;
<a name="l04510"></a>04510    original-&gt;<a class="code" href="structast__channel.html#a045b6dfdee84adceb7e86b6c5c4f9a86">rawwriteformat</a> = clonechan-&gt;<a class="code" href="structast__channel.html#a045b6dfdee84adceb7e86b6c5c4f9a86">rawwriteformat</a>;
<a name="l04511"></a>04511    clonechan-&gt;<a class="code" href="structast__channel.html#a045b6dfdee84adceb7e86b6c5c4f9a86">rawwriteformat</a> = x;
<a name="l04512"></a>04512 
<a name="l04513"></a>04513    clonechan-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> = <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709a2e185ce313026e13ed90ae3a319c9cb7">AST_SOFTHANGUP_DEV</a>;
<a name="l04514"></a>04514 
<a name="l04515"></a>04515    <span class="comment">/* And of course, so does our current state.  Note we need not</span>
<a name="l04516"></a>04516 <span class="comment">      call ast_setstate since the event manager doesn&apos;t really consider</span>
<a name="l04517"></a>04517 <span class="comment">      these separate.  We do this early so that the clone has the proper</span>
<a name="l04518"></a>04518 <span class="comment">      state of the original channel. */</span>
<a name="l04519"></a>04519    origstate = original-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>;
<a name="l04520"></a>04520    original-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> = clonechan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>;
<a name="l04521"></a>04521    clonechan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> = origstate;
<a name="l04522"></a>04522 
<a name="l04523"></a>04523    <span class="keywordflow">if</span> (clonechan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a058f4cf557afc32cc5b7a6b2782b33db" title="Fix up a channel: If a channel is consumed, this is called. Basically update any...">fixup</a>){
<a name="l04524"></a>04524       res = clonechan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a058f4cf557afc32cc5b7a6b2782b33db" title="Fix up a channel: If a channel is consumed, this is called. Basically update any...">fixup</a>(original, clonechan);
<a name="l04525"></a>04525       <span class="keywordflow">if</span> (res)
<a name="l04526"></a>04526          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Fixup failed on channel %s, strange things may happen.\n&quot;</span>, clonechan-&gt;name);
<a name="l04527"></a>04527    }
<a name="l04528"></a>04528 
<a name="l04529"></a>04529    <span class="comment">/* Start by disconnecting the original&apos;s physical side */</span>
<a name="l04530"></a>04530    <span class="keywordflow">if</span> (clonechan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#af210bbcabfb03e05658a12e1d9327239" title="Hangup (and possibly destroy) the channel.">hangup</a>)
<a name="l04531"></a>04531       res = clonechan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#af210bbcabfb03e05658a12e1d9327239" title="Hangup (and possibly destroy) the channel.">hangup</a>(clonechan);
<a name="l04532"></a>04532    <span class="keywordflow">if</span> (res) {
<a name="l04533"></a>04533       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Hangup failed!  Strange things may happen!\n&quot;</span>);
<a name="l04534"></a>04534       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(clonechan);
<a name="l04535"></a>04535       <span class="keywordflow">return</span> -1;
<a name="l04536"></a>04536    }
<a name="l04537"></a>04537 
<a name="l04538"></a>04538    snprintf(zombn, <span class="keyword">sizeof</span>(zombn), <span class="stringliteral">&quot;%s&lt;ZOMBIE&gt;&quot;</span>, orig);
<a name="l04539"></a>04539    <span class="comment">/* Mangle the name of the clone channel */</span>
<a name="l04540"></a>04540    <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(clonechan, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, zombn);
<a name="l04541"></a>04541    <a class="code" href="manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208" title="External routines may send asterisk manager events this way.">manager_event</a>(<a class="code" href="manager_8h.html#ab5db3cc603d7e798d61cb4cd94fbb4e2">EVENT_FLAG_CALL</a>, <span class="stringliteral">&quot;Rename&quot;</span>, <span class="stringliteral">&quot;Channel: %s\r\nNewname: %s\r\nUniqueid: %s\r\n&quot;</span>, masqn, zombn, clonechan-&gt;uniqueid);
<a name="l04542"></a>04542 
<a name="l04543"></a>04543    <span class="comment">/* Update the type. */</span>
<a name="l04544"></a>04544    t_pvt = original-&gt;<a class="code" href="structast__channel.html#a4254cefdfaeb5200f89e7ba3ae6f0922">monitor</a>;
<a name="l04545"></a>04545    original-&gt;<a class="code" href="structast__channel.html#a4254cefdfaeb5200f89e7ba3ae6f0922">monitor</a> = clonechan-&gt;<a class="code" href="structast__channel.html#a4254cefdfaeb5200f89e7ba3ae6f0922">monitor</a>;
<a name="l04546"></a>04546    clonechan-&gt;<a class="code" href="structast__channel.html#a4254cefdfaeb5200f89e7ba3ae6f0922">monitor</a> = t_pvt;
<a name="l04547"></a>04547 
<a name="l04548"></a>04548    <span class="comment">/* Keep the same language.  */</span>
<a name="l04549"></a>04549    <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(original, <a class="code" href="chan__alsa_8c.html#adf416dc058363e2fd5750c77e2d78bee">language</a>, clonechan-&gt;language);
<a name="l04550"></a>04550    <span class="comment">/* Copy the FD&apos;s other than the generator fd */</span>
<a name="l04551"></a>04551    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="channel_8h.html#aa3fc504e7ca90586e4d249831838de3c">AST_MAX_FDS</a>; x++) {
<a name="l04552"></a>04552       <span class="keywordflow">if</span> (x != <a class="code" href="channel_8h.html#a34c26382160debe3411987ec0df1f927">AST_GENERATOR_FD</a>)
<a name="l04553"></a>04553          <a class="code" href="channel_8h.html#aca37ca2f3d55a223d26617329ed48a3e">ast_channel_set_fd</a>(original, x, clonechan-&gt;<a class="code" href="structast__channel.html#aef68cd3879b791a3b6c12cdb750f8e6a">fds</a>[x]);
<a name="l04554"></a>04554    }
<a name="l04555"></a>04555 
<a name="l04556"></a>04556    <a class="code" href="app_8h.html#a69e90e401aa3da48a6eef5139727cbb3" title="Update all group counting for a channel to a new one.">ast_app_group_update</a>(clonechan, original);
<a name="l04557"></a>04557 
<a name="l04558"></a>04558    <span class="comment">/* Move data stores over */</span>
<a name="l04559"></a>04559    <span class="keywordflow">if</span> (<a class="code" href="linkedlists_8h.html#adf1959c5c03a3a706da97ad2f49617e5" title="Returns the first entry contained in a list.">AST_LIST_FIRST</a>(&amp;clonechan-&gt;datastores)) {
<a name="l04560"></a>04560       <span class="keyword">struct </span><a class="code" href="structast__datastore.html" title="Structure for a data store object.">ast_datastore</a> *ds;
<a name="l04561"></a>04561       <span class="comment">/* We use a safe traversal here because some fixup routines actually</span>
<a name="l04562"></a>04562 <span class="comment">       * remove the datastore from the list and free them.</span>
<a name="l04563"></a>04563 <span class="comment">       */</span>
<a name="l04564"></a>04564       <a class="code" href="linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d" title="Loops safely over (traverses) the entries in a list.">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(&amp;clonechan-&gt;datastores, ds, entry) {
<a name="l04565"></a>04565          <span class="keywordflow">if</span> (ds-&gt;<a class="code" href="structast__datastore.html#ac63f10c4295eed928ba083bcdff5500c">info</a>-&gt;<a class="code" href="structast__datastore__info.html#a556973b4df9f75e4fcaa1475d2cb5835" title="Fix up channel references.">chan_fixup</a>)
<a name="l04566"></a>04566             ds-&gt;<a class="code" href="structast__datastore.html#ac63f10c4295eed928ba083bcdff5500c">info</a>-&gt;<a class="code" href="structast__datastore__info.html#a556973b4df9f75e4fcaa1475d2cb5835" title="Fix up channel references.">chan_fixup</a>(ds-&gt;<a class="code" href="structast__datastore.html#a735984d41155bc1032e09bece8f8d66d">data</a>, clonechan, original);
<a name="l04567"></a>04567       }
<a name="l04568"></a>04568       <a class="code" href="linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9" title="Closes a safe loop traversal block.">AST_LIST_TRAVERSE_SAFE_END</a>;
<a name="l04569"></a>04569       <a class="code" href="linkedlists_8h.html#ad66405f1d0b9e1fb484643d9a36e94ed" title="Appends a whole list to the tail of a list.">AST_LIST_APPEND_LIST</a>(&amp;original-&gt;datastores, &amp;clonechan-&gt;datastores, entry);
<a name="l04570"></a>04570    }
<a name="l04571"></a>04571 
<a name="l04572"></a>04572    <a class="code" href="channel_8c.html#a21d6a634f2f99c44233e6c734aadc233" title="Clone channel variables from &amp;#39;clone&amp;#39; channel into &amp;#39;original&amp;#39; channel...">clone_variables</a>(original, clonechan);
<a name="l04573"></a>04573    <span class="comment">/* Presense of ADSI capable CPE follows clone */</span>
<a name="l04574"></a>04574    original-&gt;<a class="code" href="structast__channel.html#a4507948aab513e976b52d2253376ee7f">adsicpe</a> = clonechan-&gt;<a class="code" href="structast__channel.html#a4507948aab513e976b52d2253376ee7f">adsicpe</a>;
<a name="l04575"></a>04575    <span class="comment">/* Bridge remains the same */</span>
<a name="l04576"></a>04576    <span class="comment">/* CDR fields remain the same */</span>
<a name="l04577"></a>04577    <span class="comment">/* XXX What about blocking, softhangup, blocker, and lock and blockproc? XXX */</span>
<a name="l04578"></a>04578    <span class="comment">/* Application and data remain the same */</span>
<a name="l04579"></a>04579    <span class="comment">/* Clone exception  becomes real one, as with fdno */</span>
<a name="l04580"></a>04580    <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(original, <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(clonechan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a36fa77a64746637c77c6b18a7999d0a2">AST_FLAG_OUTGOING</a> | <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a75202bcfa58fce5d40e2daddc73b8d11">AST_FLAG_EXCEPTION</a>));
<a name="l04581"></a>04581    original-&gt;<a class="code" href="structast__channel.html#a3a804162c4be609a8def28f69b3e93b2">fdno</a> = clonechan-&gt;<a class="code" href="structast__channel.html#a3a804162c4be609a8def28f69b3e93b2">fdno</a>;
<a name="l04582"></a>04582    <span class="comment">/* Schedule context remains the same */</span>
<a name="l04583"></a>04583    <span class="comment">/* Stream stuff stays the same */</span>
<a name="l04584"></a>04584    <span class="comment">/* Keep the original state.  The fixup code will need to work with it most likely */</span>
<a name="l04585"></a>04585 
<a name="l04586"></a>04586    <span class="comment">/* Just swap the whole structures, nevermind the allocations, they&apos;ll work themselves</span>
<a name="l04587"></a>04587 <span class="comment">      out. */</span>
<a name="l04588"></a>04588    tmpcid = original-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>;
<a name="l04589"></a>04589    original-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a> = clonechan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>;
<a name="l04590"></a>04590    clonechan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a> = tmpcid;
<a name="l04591"></a>04591    <a class="code" href="channel_8c.html#a452cff7df535d1f9cbc96fcd67b075ec">report_new_callerid</a>(original);
<a name="l04592"></a>04592 
<a name="l04593"></a>04593    <span class="comment">/* Restore original timing file descriptor */</span>
<a name="l04594"></a>04594    <a class="code" href="channel_8h.html#aca37ca2f3d55a223d26617329ed48a3e">ast_channel_set_fd</a>(original, <a class="code" href="channel_8h.html#aa2c87e87fcb0c34e45f4596448dea70e">AST_TIMING_FD</a>, original-&gt;<a class="code" href="structast__channel.html#a31160ea68032ecf93ec55a3127edd2f9">timingfd</a>);
<a name="l04595"></a>04595 
<a name="l04596"></a>04596    <span class="comment">/* Our native formats are different now */</span>
<a name="l04597"></a>04597    original-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a> = clonechan-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>;
<a name="l04598"></a>04598 
<a name="l04599"></a>04599    <span class="comment">/* Context, extension, priority, app data, jump table,  remain the same */</span>
<a name="l04600"></a>04600    <span class="comment">/* pvt switches.  pbx stays the same, as does next */</span>
<a name="l04601"></a>04601 
<a name="l04602"></a>04602    <span class="comment">/* Set the write format */</span>
<a name="l04603"></a>04603    <a class="code" href="channel_8h.html#a978161a52d98fdaee374d1f6e1359544" title="Sets write format on channel chan Set write format for channel to whichever component...">ast_set_write_format</a>(original, wformat);
<a name="l04604"></a>04604 
<a name="l04605"></a>04605    <span class="comment">/* Set the read format */</span>
<a name="l04606"></a>04606    <a class="code" href="channel_8h.html#a72d53065c6bc2b6092fa41eefa03f1ad" title="Sets read format on channel chan Set read format for channel to whichever component...">ast_set_read_format</a>(original, rformat);
<a name="l04607"></a>04607 
<a name="l04608"></a>04608    <span class="comment">/* Copy the music class */</span>
<a name="l04609"></a>04609    <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(original, <a class="code" href="chan__mgcp_8c.html#abc34958c9b03014779727e5ca61b93e5">musicclass</a>, clonechan-&gt;musicclass);
<a name="l04610"></a>04610 
<a name="l04611"></a>04611    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Putting channel %s in %d/%d formats\n&quot;</span>, original-&gt;name, wformat, rformat);
<a name="l04612"></a>04612 
<a name="l04613"></a>04613    <span class="comment">/* Okay.  Last thing is to let the channel driver know about all this mess, so he</span>
<a name="l04614"></a>04614 <span class="comment">      can fix up everything as best as possible */</span>
<a name="l04615"></a>04615    <span class="keywordflow">if</span> (original-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a058f4cf557afc32cc5b7a6b2782b33db" title="Fix up a channel: If a channel is consumed, this is called. Basically update any...">fixup</a>) {
<a name="l04616"></a>04616       res = original-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a058f4cf557afc32cc5b7a6b2782b33db" title="Fix up a channel: If a channel is consumed, this is called. Basically update any...">fixup</a>(clonechan, original);
<a name="l04617"></a>04617       <span class="keywordflow">if</span> (res) {
<a name="l04618"></a>04618          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Channel for type &apos;%s&apos; could not fixup channel %s\n&quot;</span>,
<a name="l04619"></a>04619             original-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>, original-&gt;name);
<a name="l04620"></a>04620          <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(clonechan);
<a name="l04621"></a>04621          <span class="keywordflow">return</span> -1;
<a name="l04622"></a>04622       }
<a name="l04623"></a>04623    } <span class="keywordflow">else</span>
<a name="l04624"></a>04624       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Channel type &apos;%s&apos; does not have a fixup routine (for %s)!  Bad things may happen.\n&quot;</span>,
<a name="l04625"></a>04625          original-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>, original-&gt;name);
<a name="l04626"></a>04626 
<a name="l04627"></a>04627    <span class="comment">/* </span>
<a name="l04628"></a>04628 <span class="comment">    * If an indication is currently playing, maintain it on the channel </span>
<a name="l04629"></a>04629 <span class="comment">    * that is taking the place of original </span>
<a name="l04630"></a>04630 <span class="comment">    *</span>
<a name="l04631"></a>04631 <span class="comment">    * This is needed because the masquerade is swapping out in the internals</span>
<a name="l04632"></a>04632 <span class="comment">    * of this channel, and the new channel private data needs to be made</span>
<a name="l04633"></a>04633 <span class="comment">    * aware of the current visible indication (RINGING, CONGESTION, etc.)</span>
<a name="l04634"></a>04634 <span class="comment">    */</span>
<a name="l04635"></a>04635    <span class="keywordflow">if</span> (original-&gt;<a class="code" href="structast__channel.html#a5ad10add51120d9c9122eca4201dd645">visible_indication</a>) {
<a name="l04636"></a>04636       <a class="code" href="channel_8h.html#aef2af15a597c948e97628da6c5c84f28" title="Indicates condition of channel.">ast_indicate</a>(original, original-&gt;<a class="code" href="structast__channel.html#a5ad10add51120d9c9122eca4201dd645">visible_indication</a>);
<a name="l04637"></a>04637    }
<a name="l04638"></a>04638    
<a name="l04639"></a>04639    <span class="comment">/* Now, at this point, the &quot;clone&quot; channel is totally F&apos;d up.  We mark it as</span>
<a name="l04640"></a>04640 <span class="comment">      a zombie so nothing tries to touch it.  If it&apos;s already been marked as a</span>
<a name="l04641"></a>04641 <span class="comment">      zombie, then free it now (since it already is considered invalid). */</span>
<a name="l04642"></a>04642    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(clonechan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a26796fa52cc5857446eec8d16a4b718d">AST_FLAG_ZOMBIE</a>)) {
<a name="l04643"></a>04643       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Destroying channel clone &apos;%s&apos;\n&quot;</span>, clonechan-&gt;name);
<a name="l04644"></a>04644       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(clonechan);
<a name="l04645"></a>04645       <a class="code" href="manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208" title="External routines may send asterisk manager events this way.">manager_event</a>(<a class="code" href="manager_8h.html#ab5db3cc603d7e798d61cb4cd94fbb4e2">EVENT_FLAG_CALL</a>, <span class="stringliteral">&quot;Hangup&quot;</span>,
<a name="l04646"></a>04646          <span class="stringliteral">&quot;Channel: %s\r\n&quot;</span>
<a name="l04647"></a>04647          <span class="stringliteral">&quot;Uniqueid: %s\r\n&quot;</span>
<a name="l04648"></a>04648          <span class="stringliteral">&quot;Cause: %d\r\n&quot;</span>
<a name="l04649"></a>04649          <span class="stringliteral">&quot;Cause-txt: %s\r\n&quot;</span>,
<a name="l04650"></a>04650          clonechan-&gt;name,
<a name="l04651"></a>04651          clonechan-&gt;uniqueid,
<a name="l04652"></a>04652          clonechan-&gt;<a class="code" href="structast__channel.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a>,
<a name="l04653"></a>04653          <a class="code" href="channel_8h.html#abb5f5ff5988e039726f2c0d982342378" title="Gives the string form of a given hangup cause.">ast_cause2str</a>(clonechan-&gt;<a class="code" href="structast__channel.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a>)
<a name="l04654"></a>04654          );
<a name="l04655"></a>04655       <a class="code" href="channel_8h.html#a239d899b30002db4e8b08c055ac9d8e5" title="Free a channel structure.">ast_channel_free</a>(clonechan);
<a name="l04656"></a>04656    } <span class="keywordflow">else</span> {
<a name="l04657"></a>04657       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Released clone lock on &apos;%s&apos;\n&quot;</span>, clonechan-&gt;name);
<a name="l04658"></a>04658       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(clonechan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a26796fa52cc5857446eec8d16a4b718d">AST_FLAG_ZOMBIE</a>);
<a name="l04659"></a>04659       <a class="code" href="channel_8h.html#a6cbcba5661d55216968cde8fdf913c89" title="Queue one or more frames to a channel&amp;#39;s frame queue.">ast_queue_frame</a>(clonechan, &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>);
<a name="l04660"></a>04660       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(clonechan);
<a name="l04661"></a>04661    }
<a name="l04662"></a>04662 
<a name="l04663"></a>04663    <span class="comment">/* Signal any blocker */</span>
<a name="l04664"></a>04664    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(original, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329ab5b2bec9425dd0cfc789d96ef229cb3a">AST_FLAG_BLOCKING</a>))
<a name="l04665"></a>04665       pthread_kill(original-&gt;<a class="code" href="structast__channel.html#a0eb129e54ba403f15cae4473dd992ab8">blocker</a>, SIGURG);
<a name="l04666"></a>04666    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Done Masquerading %s (%d)\n&quot;</span>, original-&gt;name, original-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>);
<a name="l04667"></a>04667    <span class="keywordflow">return</span> 0;
<a name="l04668"></a>04668 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a94b603f7b9476126cafc9e0b82dd7d4d"></a><!-- doxytag: member="channel.c::ast_generic_bridge" ref="a94b603f7b9476126cafc9e0b82dd7d4d" args="(struct ast_channel *c0, struct ast_channel *c1, struct ast_bridge_config *config, struct ast_frame **fo, struct ast_channel **rc, struct timeval bridge_end)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05">ast_bridge_result</a> ast_generic_bridge </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__bridge__config.html">ast_bridge_config</a> *&nbsp;</td>
          <td class="paramname"> <em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> **&nbsp;</td>
          <td class="paramname"> <em>fo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> **&nbsp;</td>
          <td class="paramname"> <em>rc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct timeval&nbsp;</td>
          <td class="paramname"> <em>bridge_end</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l04776">4776</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00405">ast_channel::_bridge</a>, <a class="el" href="channel_8h_source.html#l00462">ast_channel::_softhangup</a>, <a class="el" href="channel_8h_source.html#l00164">AST_BRIDGE_COMPLETE</a>, <a class="el" href="channel_8h_source.html#l01370">AST_BRIDGE_DTMF_CHANNEL_0</a>, <a class="el" href="channel_8h_source.html#l01372">AST_BRIDGE_DTMF_CHANNEL_1</a>, <a class="el" href="channel_8h_source.html#l01378">AST_BRIDGE_IGNORE_SIGS</a>, <a class="el" href="channel_8h_source.html#l00167">AST_BRIDGE_RETRY</a>, <a class="el" href="frame_8h_source.html#l00313">AST_CONTROL_HOLD</a>, <a class="el" href="frame_8h_source.html#l00317">AST_CONTROL_SRCUPDATE</a>, <a class="el" href="frame_8h_source.html#l00318">AST_CONTROL_T38_PARAMETERS</a>, <a class="el" href="frame_8h_source.html#l00314">AST_CONTROL_UNHOLD</a>, <a class="el" href="frame_8h_source.html#l00315">AST_CONTROL_VIDUPDATE</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="channel_8h_source.html#l00584">AST_FEATURE_WARNING_ACTIVE</a>, <a class="el" href="frame_8h_source.html#l00105">AST_FRAME_CONTROL</a>, <a class="el" href="frame_8h_source.html#l00124">AST_FRAME_DTMF</a>, <a class="el" href="frame_8h_source.html#l00122">AST_FRAME_DTMF_BEGIN</a>, <a class="el" href="frame_8h_source.html#l00099">AST_FRAME_DTMF_END</a>, <a class="el" href="frame_8h_source.html#l00115">AST_FRAME_HTML</a>, <a class="el" href="frame_8h_source.html#l00113">AST_FRAME_IMAGE</a>, <a class="el" href="frame_8h_source.html#l00120">AST_FRAME_MODEM</a>, <a class="el" href="frame_8h_source.html#l00111">AST_FRAME_TEXT</a>, <a class="el" href="frame_8h_source.html#l00103">AST_FRAME_VIDEO</a>, <a class="el" href="frame_8h_source.html#l00101">AST_FRAME_VOICE</a>, <a class="el" href="frame_8h_source.html#l00462">ast_frfree</a>, <a class="el" href="channel_8c_source.html#l03150">ast_indicate_data()</a>, <a class="el" href="abstract__jb_8c_source.html#l00202">ast_jb_do_usecheck()</a>, <a class="el" href="abstract__jb_8c_source.html#l00621">ast_jb_empty_and_reset()</a>, <a class="el" href="abstract__jb_8c_source.html#l00368">ast_jb_get_and_deliver()</a>, <a class="el" href="abstract__jb_8c_source.html#l00263">ast_jb_get_when_to_wakeup()</a>, <a class="el" href="abstract__jb_8c_source.html#l00303">ast_jb_put()</a>, <a class="el" href="channel_8c_source.html#l01610">ast_poll_channel_add()</a>, <a class="el" href="channel_8c_source.html#l01633">ast_poll_channel_del()</a>, <a class="el" href="channel_8c_source.html#l03100">ast_read()</a>, <a class="el" href="time_8h_source.html#l00176">ast_samp2tv()</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="channel_8h_source.html#l00640">AST_SOFTHANGUP_UNBRIDGE</a>, <a class="el" href="utils_8c_source.html#l01365">ast_tvadd()</a>, <a class="el" href="time_8h_source.html#l00089">ast_tvdiff_ms()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="time_8h_source.html#l00099">ast_tvzero()</a>, <a class="el" href="channel_8c_source.html#l02384">ast_waitfor_n()</a>, <a class="el" href="channel_8c_source.html#l03411">ast_write()</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="frame_8h_source.html#l00147">ast_frame::datalen</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="channel_8h_source.html#l00594">ast_bridge_config::feature_timer</a>, <a class="el" href="channel_8h_source.html#l00602">ast_bridge_config::flags</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="channel_8h_source.html#l00482">ast_channel::nativeformats</a>, <a class="el" href="channel_8h_source.html#l00592">ast_bridge_config::nexteventts</a>, <a class="el" href="channel_8h_source.html#l00593">ast_bridge_config::partialfeature_timer</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::ptr</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, and <a class="el" href="channel_8h_source.html#l00595">ast_bridge_config::timelimit</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l05055">ast_channel_bridge()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04779"></a>04779 {
<a name="l04780"></a>04780    <span class="comment">/* Copy voice back and forth between the two channels. */</span>
<a name="l04781"></a>04781    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *cs[3];
<a name="l04782"></a>04782    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l04783"></a>04783    <span class="keyword">enum</span> <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05">ast_bridge_result</a> res = <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05ada47e397237355168a082a189cf13ee1">AST_BRIDGE_COMPLETE</a>;
<a name="l04784"></a>04784    <span class="keywordtype">int</span> o0nativeformats;
<a name="l04785"></a>04785    <span class="keywordtype">int</span> o1nativeformats;
<a name="l04786"></a>04786    <span class="keywordtype">int</span> watch_c0_dtmf;
<a name="l04787"></a>04787    <span class="keywordtype">int</span> watch_c1_dtmf;
<a name="l04788"></a>04788    <span class="keywordtype">void</span> *pvt0, *pvt1;
<a name="l04789"></a>04789    <span class="comment">/* Indicates whether a frame was queued into a jitterbuffer */</span>
<a name="l04790"></a>04790    <span class="keywordtype">int</span> frame_put_in_jb = 0;
<a name="l04791"></a>04791    <span class="keywordtype">int</span> jb_in_use;
<a name="l04792"></a>04792    <span class="keywordtype">int</span> to;
<a name="l04793"></a>04793    
<a name="l04794"></a>04794    cs[0] = c0;
<a name="l04795"></a>04795    cs[1] = c1;
<a name="l04796"></a>04796    pvt0 = c0-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l04797"></a>04797    pvt1 = c1-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l04798"></a>04798    o0nativeformats = c0-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>;
<a name="l04799"></a>04799    o1nativeformats = c1-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>;
<a name="l04800"></a>04800    watch_c0_dtmf = config-&gt;<a class="code" href="structast__bridge__config.html#ac92588540e8c1d014a08cd8a45462b19">flags</a> &amp; <a class="code" href="channel_8h.html#a2bd5879255a0f6a758c99b58fcab2f27" title="Report DTMF on channel 0.">AST_BRIDGE_DTMF_CHANNEL_0</a>;
<a name="l04801"></a>04801    watch_c1_dtmf = config-&gt;<a class="code" href="structast__bridge__config.html#ac92588540e8c1d014a08cd8a45462b19">flags</a> &amp; <a class="code" href="channel_8h.html#a7dbb6edabad3e02e80d605ca5d254c35" title="Report DTMF on channel 1.">AST_BRIDGE_DTMF_CHANNEL_1</a>;
<a name="l04802"></a>04802 
<a name="l04803"></a>04803    <span class="comment">/* Check the need of a jitterbuffer for each channel */</span>
<a name="l04804"></a>04804    jb_in_use = <a class="code" href="abstract__jb_8h.html#ad013da092efd28ba7a6a21ee76297a80" title="Checks the need of a jb use in a generic bridge.">ast_jb_do_usecheck</a>(c0, c1);
<a name="l04805"></a>04805    <span class="keywordflow">if</span> (jb_in_use)
<a name="l04806"></a>04806       <a class="code" href="abstract__jb_8h.html#a252f5415d8e69c1d17597ccb16446a30" title="drops all frames from a jitterbuffer and resets it">ast_jb_empty_and_reset</a>(c0, c1);
<a name="l04807"></a>04807 
<a name="l04808"></a>04808    <a class="code" href="channel_8h.html#a1b3f92e2239cd9e9bc20c783e1dedc80">ast_poll_channel_add</a>(c0, c1);
<a name="l04809"></a>04809 
<a name="l04810"></a>04810    <span class="keywordflow">if</span> (config-&gt;<a class="code" href="structast__bridge__config.html#af083a5b636f7b870cea1aea1eeadf6ff">feature_timer</a> &gt; 0 &amp;&amp; <a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(config-&gt;<a class="code" href="structast__bridge__config.html#a1abaa6fad41461bdb3da343a2bee88c0">nexteventts</a>)) {
<a name="l04811"></a>04811       <span class="comment">/* calculate when the bridge should possibly break</span>
<a name="l04812"></a>04812 <span class="comment">       * if a partial feature match timed out */</span>
<a name="l04813"></a>04813       config-&gt;<a class="code" href="structast__bridge__config.html#add44738a40cfd3b090900783862fcc2a">partialfeature_timer</a> = <a class="code" href="time_8h.html#a97e1bb8fbd7a103212789e87e7ed6073" title="Returns the sum of two timevals a + b.">ast_tvadd</a>(<a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>(), <a class="code" href="time_8h.html#a147d132412d7188c1dcebf25b8d31c0c" title="Returns a timeval corresponding to the duration of n samples at rate r. Useful to...">ast_samp2tv</a>(config-&gt;<a class="code" href="structast__bridge__config.html#af083a5b636f7b870cea1aea1eeadf6ff">feature_timer</a>, 1000));
<a name="l04814"></a>04814    } <span class="keywordflow">else</span> {
<a name="l04815"></a>04815       memset(&amp;config-&gt;<a class="code" href="structast__bridge__config.html#add44738a40cfd3b090900783862fcc2a">partialfeature_timer</a>, 0, <span class="keyword">sizeof</span>(config-&gt;<a class="code" href="structast__bridge__config.html#add44738a40cfd3b090900783862fcc2a">partialfeature_timer</a>));
<a name="l04816"></a>04816    }
<a name="l04817"></a>04817 
<a name="l04818"></a>04818    <span class="keywordflow">for</span> (;;) {
<a name="l04819"></a>04819       <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *who, *other;
<a name="l04820"></a>04820 
<a name="l04821"></a>04821       <span class="keywordflow">if</span> ((c0-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a> != pvt0) || (c1-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a> != pvt1) ||
<a name="l04822"></a>04822           (o0nativeformats != c0-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>) ||
<a name="l04823"></a>04823           (o1nativeformats != c1-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>)) {
<a name="l04824"></a>04824          <span class="comment">/* Check for Masquerade, codec changes, etc */</span>
<a name="l04825"></a>04825          res = <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05ac83c1441a620f7bdae5ef84692f8e7a5">AST_BRIDGE_RETRY</a>;
<a name="l04826"></a>04826          <span class="keywordflow">break</span>;
<a name="l04827"></a>04827       }
<a name="l04828"></a>04828       <span class="keywordflow">if</span> (bridge_end.tv_sec) {
<a name="l04829"></a>04829          to = <a class="code" href="time_8h.html#a74e35cffcd45ad6cd7c8587921e8a4c2" title="Computes the difference (in milliseconds) between two struct timeval instances.">ast_tvdiff_ms</a>(bridge_end, <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>());
<a name="l04830"></a>04830          <span class="keywordflow">if</span> (to &lt;= 0) {
<a name="l04831"></a>04831             <span class="keywordflow">if</span> (config-&gt;<a class="code" href="structast__bridge__config.html#ab88b1e2ff0d0fed0616512352e723162">timelimit</a>) {
<a name="l04832"></a>04832                res = <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05ac83c1441a620f7bdae5ef84692f8e7a5">AST_BRIDGE_RETRY</a>;
<a name="l04833"></a>04833                <span class="comment">/* generic bridge ending to play warning */</span>
<a name="l04834"></a>04834                <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(config, <a class="code" href="channel_8h.html#a7495a48740c9d555f7fbcb48246dbd93a2b65bf23f98d81b36f2f6898ee0aac16">AST_FEATURE_WARNING_ACTIVE</a>);
<a name="l04835"></a>04835             } <span class="keywordflow">else</span> {
<a name="l04836"></a>04836                res = <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05ada47e397237355168a082a189cf13ee1">AST_BRIDGE_COMPLETE</a>;
<a name="l04837"></a>04837             }
<a name="l04838"></a>04838             <span class="keywordflow">break</span>;
<a name="l04839"></a>04839          }
<a name="l04840"></a>04840       } <span class="keywordflow">else</span> {
<a name="l04841"></a>04841          <span class="comment">/* If a feature has been started and the bridge is configured to </span>
<a name="l04842"></a>04842 <span class="comment">          * to not break, leave the channel bridge when the feature timer</span>
<a name="l04843"></a>04843 <span class="comment">          * time has elapsed so the DTMF will be sent to the other side. </span>
<a name="l04844"></a>04844 <span class="comment">          */</span>
<a name="l04845"></a>04845          <span class="keywordflow">if</span> (!<a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(config-&gt;<a class="code" href="structast__bridge__config.html#add44738a40cfd3b090900783862fcc2a">partialfeature_timer</a>)) {
<a name="l04846"></a>04846             <span class="keywordtype">int</span> diff = <a class="code" href="time_8h.html#a74e35cffcd45ad6cd7c8587921e8a4c2" title="Computes the difference (in milliseconds) between two struct timeval instances.">ast_tvdiff_ms</a>(config-&gt;<a class="code" href="structast__bridge__config.html#add44738a40cfd3b090900783862fcc2a">partialfeature_timer</a>, <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>());
<a name="l04847"></a>04847             <span class="keywordflow">if</span> (diff &lt;= 0) {
<a name="l04848"></a>04848                res = <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05ac83c1441a620f7bdae5ef84692f8e7a5">AST_BRIDGE_RETRY</a>;
<a name="l04849"></a>04849                <span class="keywordflow">break</span>;
<a name="l04850"></a>04850             }
<a name="l04851"></a>04851          }
<a name="l04852"></a>04852          to = -1;
<a name="l04853"></a>04853       }
<a name="l04854"></a>04854       <span class="comment">/* Calculate the appropriate max sleep interval - in general, this is the time,</span>
<a name="l04855"></a>04855 <span class="comment">         left to the closest jb delivery moment */</span>
<a name="l04856"></a>04856       <span class="keywordflow">if</span> (jb_in_use)
<a name="l04857"></a>04857          to = <a class="code" href="abstract__jb_8h.html#ad3f6eb99c87c8fb1d79232762df48354" title="Calculates the time, left to the closest delivery moment in a bridge.">ast_jb_get_when_to_wakeup</a>(c0, c1, to);
<a name="l04858"></a>04858       who = <a class="code" href="channel_8h.html#aec8ce59b78afbd3651f3de011f13290a" title="Waits for input on a group of channels Wait for input on an array of channels for...">ast_waitfor_n</a>(cs, 2, &amp;to);
<a name="l04859"></a>04859       <span class="keywordflow">if</span> (!who) {
<a name="l04860"></a>04860          <span class="comment">/* No frame received within the specified timeout - check if we have to deliver now */</span>
<a name="l04861"></a>04861          <span class="keywordflow">if</span> (jb_in_use)
<a name="l04862"></a>04862             <a class="code" href="abstract__jb_8h.html#a543ca527d26b42c6f50eccb2924ddebd" title="Deliver the queued frames that should be delivered now for both channels.">ast_jb_get_and_deliver</a>(c0, c1);
<a name="l04863"></a>04863          <span class="keywordflow">if</span> (c0-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> == <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709ab5066a7ae4553197c7e712139b879f15">AST_SOFTHANGUP_UNBRIDGE</a> || c1-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> == <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709ab5066a7ae4553197c7e712139b879f15">AST_SOFTHANGUP_UNBRIDGE</a>) {
<a name="l04864"></a>04864             <span class="keywordflow">if</span> (c0-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> == <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709ab5066a7ae4553197c7e712139b879f15">AST_SOFTHANGUP_UNBRIDGE</a>)
<a name="l04865"></a>04865                c0-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> = 0;
<a name="l04866"></a>04866             <span class="keywordflow">if</span> (c1-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> == <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709ab5066a7ae4553197c7e712139b879f15">AST_SOFTHANGUP_UNBRIDGE</a>)
<a name="l04867"></a>04867                c1-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> = 0;
<a name="l04868"></a>04868             c0-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a> = c1;
<a name="l04869"></a>04869             c1-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a> = c0;
<a name="l04870"></a>04870          }
<a name="l04871"></a>04871          <span class="keywordflow">continue</span>;
<a name="l04872"></a>04872       }
<a name="l04873"></a>04873       f = <a class="code" href="channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1" title="Reads a frame.">ast_read</a>(who);
<a name="l04874"></a>04874       <span class="keywordflow">if</span> (!f) {
<a name="l04875"></a>04875          *fo = NULL;
<a name="l04876"></a>04876          *rc = who;
<a name="l04877"></a>04877          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Didn&apos;t get a frame from channel: %s\n&quot;</span>,who-&gt;name);
<a name="l04878"></a>04878          <span class="keywordflow">break</span>;
<a name="l04879"></a>04879       }
<a name="l04880"></a>04880 
<a name="l04881"></a>04881       other = (who == c0) ? c1 : c0; <span class="comment">/* the &apos;other&apos; channel */</span>
<a name="l04882"></a>04882       <span class="comment">/* Try add the frame info the who&apos;s bridged channel jitterbuff */</span>
<a name="l04883"></a>04883       <span class="keywordflow">if</span> (jb_in_use)
<a name="l04884"></a>04884          frame_put_in_jb = !<a class="code" href="abstract__jb_8h.html#a971bdfddf7e452f516dd32991951d581" title="Puts a frame into a channel jitterbuffer.">ast_jb_put</a>(other, f);
<a name="l04885"></a>04885 
<a name="l04886"></a>04886       <span class="keywordflow">if</span> ((f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>) &amp;&amp; !(config-&gt;<a class="code" href="structast__bridge__config.html#ac92588540e8c1d014a08cd8a45462b19">flags</a> &amp; <a class="code" href="channel_8h.html#aed24107184d7fd2cfb1ad32cba4d6bfd" title="Ignore all signal frames except NULL.">AST_BRIDGE_IGNORE_SIGS</a>)) {
<a name="l04887"></a>04887          <span class="keywordtype">int</span> bridge_exit = 0;
<a name="l04888"></a>04888 
<a name="l04889"></a>04889          <span class="keywordflow">switch</span> (f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>) {
<a name="l04890"></a>04890          <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ab99a3d1c08c5ae8bca078c7cd1ec02f5">AST_CONTROL_HOLD</a>:
<a name="l04891"></a>04891          <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>:
<a name="l04892"></a>04892          <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a417bc8ac5817cc1525a3b530abfc1528">AST_CONTROL_VIDUPDATE</a>:
<a name="l04893"></a>04893          <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a009e81151b19671f42b5e84ab6a619f4">AST_CONTROL_SRCUPDATE</a>:
<a name="l04894"></a>04894          <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>:
<a name="l04895"></a>04895             <a class="code" href="channel_8h.html#aa8c3522af1bc639cbd5b38f5fdf171fa" title="Indicates condition of channel, with payload.">ast_indicate_data</a>(other, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>, f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>);
<a name="l04896"></a>04896             <span class="keywordflow">if</span> (jb_in_use) {
<a name="l04897"></a>04897                <a class="code" href="abstract__jb_8h.html#a252f5415d8e69c1d17597ccb16446a30" title="drops all frames from a jitterbuffer and resets it">ast_jb_empty_and_reset</a>(c0, c1);
<a name="l04898"></a>04898             }
<a name="l04899"></a>04899             <span class="keywordflow">break</span>;
<a name="l04900"></a>04900          <span class="keywordflow">default</span>:
<a name="l04901"></a>04901             *fo = f;
<a name="l04902"></a>04902             *rc = who;
<a name="l04903"></a>04903             bridge_exit = 1;
<a name="l04904"></a>04904             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Got a FRAME_CONTROL (%d) frame on channel %s\n&quot;</span>, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>, who-&gt;name);
<a name="l04905"></a>04905             <span class="keywordflow">break</span>;
<a name="l04906"></a>04906          }
<a name="l04907"></a>04907          <span class="keywordflow">if</span> (bridge_exit)
<a name="l04908"></a>04908             <span class="keywordflow">break</span>;
<a name="l04909"></a>04909       }
<a name="l04910"></a>04910       <span class="keywordflow">if</span> ((f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>) ||
<a name="l04911"></a>04911           (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a9b350360a64b55c7590f1ec03db480be">AST_FRAME_DTMF_BEGIN</a>) ||
<a name="l04912"></a>04912           (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#a248afd6c02044259a386f6b7aee922a2">AST_FRAME_DTMF</a>) ||
<a name="l04913"></a>04913           (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a17ae96b6ea8a2388bb0d409e8124ff30">AST_FRAME_VIDEO</a>) ||
<a name="l04914"></a>04914           (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a6c9398ee8989239124295d096a87bf32">AST_FRAME_IMAGE</a>) ||
<a name="l04915"></a>04915           (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a3d91bab33583f560197e21532a02a895">AST_FRAME_HTML</a>) ||
<a name="l04916"></a>04916           (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ad99b86353343f422bda01163898b2eea">AST_FRAME_MODEM</a>) ||
<a name="l04917"></a>04917           (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0af7728b18670d3cd075f63d67f8867078">AST_FRAME_TEXT</a>)) {
<a name="l04918"></a>04918          <span class="comment">/* monitored dtmf causes exit from bridge */</span>
<a name="l04919"></a>04919          <span class="keywordtype">int</span> monitored_source = (who == c0) ? watch_c0_dtmf : watch_c1_dtmf;
<a name="l04920"></a>04920 
<a name="l04921"></a>04921          <span class="keywordflow">if</span> (monitored_source &amp;&amp; 
<a name="l04922"></a>04922             (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a98e65764bc963016c394bcc1bad6540b">AST_FRAME_DTMF_END</a> || 
<a name="l04923"></a>04923             f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a9b350360a64b55c7590f1ec03db480be">AST_FRAME_DTMF_BEGIN</a>)) {
<a name="l04924"></a>04924             *fo = f;
<a name="l04925"></a>04925             *rc = who;
<a name="l04926"></a>04926             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Got DTMF %s on channel (%s)\n&quot;</span>, 
<a name="l04927"></a>04927                f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a98e65764bc963016c394bcc1bad6540b">AST_FRAME_DTMF_END</a> ? <span class="stringliteral">&quot;end&quot;</span> : <span class="stringliteral">&quot;begin&quot;</span>,
<a name="l04928"></a>04928                who-&gt;name);
<a name="l04929"></a>04929 
<a name="l04930"></a>04930             <span class="keywordflow">break</span>;
<a name="l04931"></a>04931          }
<a name="l04932"></a>04932          <span class="comment">/* Write immediately frames, not passed through jb */</span>
<a name="l04933"></a>04933          <span class="keywordflow">if</span> (!frame_put_in_jb)
<a name="l04934"></a>04934             <a class="code" href="channel_8h.html#a79c413d51b7135404d5cacf811649a61" title="Write a frame to a channel This function writes the given frame to the indicated...">ast_write</a>(other, f);
<a name="l04935"></a>04935             
<a name="l04936"></a>04936          <span class="comment">/* Check if we have to deliver now */</span>
<a name="l04937"></a>04937          <span class="keywordflow">if</span> (jb_in_use)
<a name="l04938"></a>04938             <a class="code" href="abstract__jb_8h.html#a543ca527d26b42c6f50eccb2924ddebd" title="Deliver the queued frames that should be delivered now for both channels.">ast_jb_get_and_deliver</a>(c0, c1);
<a name="l04939"></a>04939       }
<a name="l04940"></a>04940       <span class="comment">/* XXX do we want to pass on also frames not matched above ? */</span>
<a name="l04941"></a>04941       <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l04942"></a>04942 
<a name="l04943"></a>04943 <span class="preprocessor">#ifndef HAVE_EPOLL</span>
<a name="l04944"></a>04944 <span class="preprocessor"></span>      <span class="comment">/* Swap who gets priority */</span>
<a name="l04945"></a>04945       cs[2] = cs[0];
<a name="l04946"></a>04946       cs[0] = cs[1];
<a name="l04947"></a>04947       cs[1] = cs[2];
<a name="l04948"></a>04948 <span class="preprocessor">#endif</span>
<a name="l04949"></a>04949 <span class="preprocessor"></span>   }
<a name="l04950"></a>04950 
<a name="l04951"></a>04951    <a class="code" href="channel_8h.html#a6b2da1bbe090143571ba1db7f94055a0">ast_poll_channel_del</a>(c0, c1);
<a name="l04952"></a>04952 
<a name="l04953"></a>04953    <span class="keywordflow">return</span> res;
<a name="l04954"></a>04954 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aea1f40d6702929cffc39b29f5ba3884b"></a><!-- doxytag: member="channel.c::ast_get_channel_by_exten_locked" ref="aea1f40d6702929cffc39b29f5ba3884b" args="(const char *exten, const char *context)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__channel.html">ast_channel</a>* ast_get_channel_by_exten_locked </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>exten</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get channel by exten (and optionally context) and lock it. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01297">1297</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l01188">channel_find_locked()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01298"></a>01298 {
<a name="l01299"></a>01299    <span class="keywordflow">return</span> <a class="code" href="channel_8c.html#a205b57c2db0974945d767d8fab853e9c" title="Helper function to find channels.">channel_find_locked</a>(NULL, NULL, 0, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>);
<a name="l01300"></a>01300 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1faeae3019819b1f9df0d0fddd20aa67"></a><!-- doxytag: member="channel.c::ast_get_channel_by_name_locked" ref="a1faeae3019819b1f9df0d0fddd20aa67" args="(const char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__channel.html">ast_channel</a>* ast_get_channel_by_name_locked </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get channel by name and lock it. </p>
<p>Get channel by name or uniqueid (locks channel). </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01278">1278</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l01188">channel_find_locked()</a>.</p>

<p>Referenced by <a class="el" href="func__logic_8c_source.html#l00226">acf_import()</a>, <a class="el" href="res__agi_8c_source.html#l00587">action_add_agi_cmd()</a>, <a class="el" href="manager_8c_source.html#l02168">action_atxfer()</a>, <a class="el" href="manager_8c_source.html#l01847">action_getvar()</a>, <a class="el" href="manager_8c_source.html#l01777">action_hangup()</a>, <a class="el" href="manager_8c_source.html#l02084">action_redirect()</a>, <a class="el" href="manager_8c_source.html#l02039">action_sendtext()</a>, <a class="el" href="manager_8c_source.html#l01803">action_setvar()</a>, <a class="el" href="manager_8c_source.html#l01904">action_status()</a>, <a class="el" href="manager_8c_source.html#l02621">action_timeout()</a>, <a class="el" href="pbx_8c_source.html#l07397">ast_async_goto_by_name()</a>, <a class="el" href="features_8c_source.html#l02441">ast_bridge_call()</a>, <a class="el" href="app__channelredirect_8c_source.html#l00065">asyncgoto_exec()</a>, <a class="el" href="res__monitor_8c_source.html#l00688">change_monitor_action()</a>, <a class="el" href="res__monitor_8c_source.html#l00728">do_pause_or_unpause()</a>, <a class="el" href="app__dahdiscan_8c_source.html#l00075">get_dahdi_channel_locked()</a>, <a class="el" href="res__agi_8c_source.html#l01786">handle_channelstatus()</a>, <a class="el" href="res__agi_8c_source.html#l00544">handle_cli_agi_add_cmd()</a>, <a class="el" href="cli_8c_source.html#l01187">handle_core_set_debug_channel()</a>, <a class="el" href="res__agi_8c_source.html#l01841">handle_getvariablefull()</a>, <a class="el" href="res__agi_8c_source.html#l01691">handle_hangup()</a>, <a class="el" href="res__clioriginate_8c_source.html#l00175">handle_redirect()</a>, <a class="el" href="pbx_8c_source.html#l06269">handle_set_chanvar()</a>, <a class="el" href="pbx_8c_source.html#l06215">handle_show_chanvar()</a>, <a class="el" href="cli_8c_source.html#l01268">handle_showchan()</a>, <a class="el" href="cli_8c_source.html#l00912">handle_softhangup()</a>, <a class="el" href="features_8c_source.html#l04401">manager_park()</a>, <a class="el" href="app__senddtmf_8c_source.html#l00099">manager_play_dtmf()</a>, <a class="el" href="features_8c_source.html#l00678">park_call_full()</a>, <a class="el" href="pbx_8c_source.html#l09140">pbx_builtin_importvar()</a>, <a class="el" href="func__global_8c_source.html#l00128">shared_read()</a>, <a class="el" href="func__global_8c_source.html#l00176">shared_write()</a>, <a class="el" href="res__monitor_8c_source.html#l00605">start_monitor_action()</a>, and <a class="el" href="res__monitor_8c_source.html#l00655">stop_monitor_action()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01279"></a>01279 {
<a name="l01280"></a>01280    <span class="keywordflow">return</span> <a class="code" href="channel_8c.html#a205b57c2db0974945d767d8fab853e9c" title="Helper function to find channels.">channel_find_locked</a>(NULL, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, 0, NULL, NULL);
<a name="l01281"></a>01281 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a67239a95ab93867fb9da5a8b20281224"></a><!-- doxytag: member="channel.c::ast_get_channel_by_name_prefix_locked" ref="a67239a95ab93867fb9da5a8b20281224" args="(const char *name, const int namelen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__channel.html">ast_channel</a>* ast_get_channel_by_name_prefix_locked </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>namelen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get channel by name prefix and lock it. </p>
<p>Get channel by name or uniqueid prefix (locks channel). </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01284">1284</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l01188">channel_find_locked()</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l04156">action_bridge()</a>, <a class="el" href="devicestate_8c_source.html#l00265">ast_parse_device_state()</a>, <a class="el" href="features_8c_source.html#l04524">bridge_exec()</a>, <a class="el" href="app__chanspy_8c_source.html#l00767">common_exec()</a>, <a class="el" href="app__mixmonitor_8c_source.html#l00587">handle_cli_mixmonitor()</a>, <a class="el" href="func__global_8c_source.html#l00128">shared_read()</a>, and <a class="el" href="func__global_8c_source.html#l00176">shared_write()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01285"></a>01285 {
<a name="l01286"></a>01286    <span class="keywordflow">return</span> <a class="code" href="channel_8c.html#a205b57c2db0974945d767d8fab853e9c" title="Helper function to find channels.">channel_find_locked</a>(NULL, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, namelen, NULL, NULL);
<a name="l01287"></a>01287 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a646e90d1a57effdd627779b93f21f4cf"></a><!-- doxytag: member="channel.c::ast_get_channel_tech" ref="a646e90d1a57effdd627779b93f21f4cf" args="(const char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__channel__tech.html">ast_channel_tech</a>* ast_get_channel_tech </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get handle to channel driver based on name. </p>
<p>Get a channel technology structure by name. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l00609">609</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00077">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="channel_8c_source.html#l00104">chanlist::tech</a>, and <a class="el" href="channel_8h_source.html#l00226">ast_channel_tech::type</a>.</p>

<p>Referenced by <a class="el" href="devicestate_8c_source.html#l00308">_ast_device_state()</a>, and <a class="el" href="agent_8c_source.html#l00529">ast_var_channel_types_table()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00610"></a>00610 {
<a name="l00611"></a>00611    <span class="keyword">struct </span><a class="code" href="structchanlist.html" title="List of channel drivers.">chanlist</a> *chanls;
<a name="l00612"></a>00612    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structast__channel__tech.html" title="Structure to describe a channel &amp;quot;technology&amp;quot;, ie a channel driver See for...">ast_channel_tech</a> *ret = NULL;
<a name="l00613"></a>00613 
<a name="l00614"></a>00614    <a class="code" href="linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc" title="Read locks a list.">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>);
<a name="l00615"></a>00615 
<a name="l00616"></a>00616    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="structbackends.html" title="the list of registered channel types">backends</a>, chanls, list) {
<a name="l00617"></a>00617       <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, chanls-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>)) {
<a name="l00618"></a>00618          ret = chanls-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>;
<a name="l00619"></a>00619          <span class="keywordflow">break</span>;
<a name="l00620"></a>00620       }
<a name="l00621"></a>00621    }
<a name="l00622"></a>00622 
<a name="l00623"></a>00623    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>);
<a name="l00624"></a>00624    
<a name="l00625"></a>00625    <span class="keywordflow">return</span> ret;
<a name="l00626"></a>00626 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aee83e23058d0a4111fda1f506cbda107"></a><!-- doxytag: member="channel.c::ast_get_group" ref="aee83e23058d0a4111fda1f506cbda107" args="(const char *s)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="channel_8h.html#a641d81d0c5c8df99d43eff69aede3bfd">ast_group_t</a> ast_get_group </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>s</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l05485">5485</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="agi_2strcompat_8c_source.html#l00027">strsep()</a>.</p>

<p>Referenced by <a class="el" href="misdn__config_8c_source.html#l00870">_parse()</a>, <a class="el" href="chan__unistim_8c_source.html#l04998">build_device()</a>, <a class="el" href="chan__mgcp_8c_source.html#l03552">build_gateway()</a>, <a class="el" href="chan__sip_8c_source.html#l23690">build_peer()</a>, <a class="el" href="chan__skinny_8c_source.html#l06537">config_parse_variables()</a>, <a class="el" href="func__channel_8c_source.html#l00280">func_channel_write()</a>, <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, and <a class="el" href="chan__agent_8c_source.html#l01180">read_agent_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05486"></a>05486 {
<a name="l05487"></a>05487    <span class="keywordtype">char</span> *piece;
<a name="l05488"></a>05488    <span class="keywordtype">char</span> *c;
<a name="l05489"></a>05489    <span class="keywordtype">int</span> start=0, finish=0, x;
<a name="l05490"></a>05490    <a class="code" href="channel_8h.html#a641d81d0c5c8df99d43eff69aede3bfd">ast_group_t</a> <a class="code" href="structgroup.html">group</a> = 0;
<a name="l05491"></a>05491 
<a name="l05492"></a>05492    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>))
<a name="l05493"></a>05493       <span class="keywordflow">return</span> 0;
<a name="l05494"></a>05494 
<a name="l05495"></a>05495    c = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>);
<a name="l05496"></a>05496    
<a name="l05497"></a>05497    <span class="keywordflow">while</span> ((piece = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;c, <span class="stringliteral">&quot;,&quot;</span>))) {
<a name="l05498"></a>05498       <span class="keywordflow">if</span> (sscanf(piece, <span class="stringliteral">&quot;%30d-%30d&quot;</span>, &amp;start, &amp;finish) == 2) {
<a name="l05499"></a>05499          <span class="comment">/* Range */</span>
<a name="l05500"></a>05500       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sscanf(piece, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;start)) {
<a name="l05501"></a>05501          <span class="comment">/* Just one */</span>
<a name="l05502"></a>05502          finish = start;
<a name="l05503"></a>05503       } <span class="keywordflow">else</span> {
<a name="l05504"></a>05504          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Syntax error parsing group configuration &apos;%s&apos; at &apos;%s&apos;. Ignoring.\n&quot;</span>, <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, piece);
<a name="l05505"></a>05505          <span class="keywordflow">continue</span>;
<a name="l05506"></a>05506       }
<a name="l05507"></a>05507       <span class="keywordflow">for</span> (x = start; x &lt;= finish; x++) {
<a name="l05508"></a>05508          <span class="keywordflow">if</span> ((x &gt; 63) || (x &lt; 0)) {
<a name="l05509"></a>05509             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Ignoring invalid group %d (maximum group is 63)\n&quot;</span>, x);
<a name="l05510"></a>05510          } <span class="keywordflow">else</span>
<a name="l05511"></a>05511             group |= ((<a class="code" href="channel_8h.html#a641d81d0c5c8df99d43eff69aede3bfd">ast_group_t</a>) 1 &lt;&lt; x);
<a name="l05512"></a>05512       }
<a name="l05513"></a>05513    }
<a name="l05514"></a>05514    <span class="keywordflow">return</span> group;
<a name="l05515"></a>05515 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8f2c0f3dcafbc3a74d84a8dddcce6b9c"></a><!-- doxytag: member="channel.c::ast_hangup" ref="a8f2c0f3dcafbc3a74d84a8dddcce6b9c" args="(struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_hangup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Hangup a channel. </p>
<p>Hang up a channel. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01690">1690</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="utils_8h_source.html#l00678">ast_assert</a>, <a class="el" href="audiohook_8c_source.html#l00400">ast_audiohook_detach_list()</a>, <a class="el" href="autoservice_8c_source.html#l00251">ast_autoservice_stop()</a>, <a class="el" href="channel_8c_source.html#l00629">ast_cause2str()</a>, <a class="el" href="cdr_8c_source.html#l01234">ast_cdr_detach()</a>, <a class="el" href="cdr_8c_source.html#l00879">ast_cdr_end()</a>, <a class="el" href="cdr_8h_source.html#l00035">AST_CDR_FLAG_BRIDGED</a>, <a class="el" href="cdr_8h_source.html#l00041">AST_CDR_FLAG_DIALED</a>, <a class="el" href="cdr_8h_source.html#l00034">AST_CDR_FLAG_POST_DISABLED</a>, <a class="el" href="cdr_8h_source.html#l00048">AST_CDR_NULL</a>, <a class="el" href="channel_8c_source.html#l01388">ast_channel_free()</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="utils_8h_source.html#l00075">ast_clear_flag</a>, <a class="el" href="file_8c_source.html#l00887">ast_closestream()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="channel_8c_source.html#l04393">ast_do_masquerade()</a>, <a class="el" href="channel_8h_source.html#l00527">AST_FLAG_BLOCKING</a>, <a class="el" href="channel_8h_source.html#l00567">AST_FLAG_IN_CHANNEL_LIST</a>, <a class="el" href="channel_8h_source.html#l00529">AST_FLAG_ZOMBIE</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="linkedlists_8h_source.html#l00860">AST_RWLIST_REMOVE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="channel_8h_source.html#l00421">ast_channel::audiohooks</a>, <a class="el" href="channel_8h_source.html#l00442">ast_channel::blocker</a>, <a class="el" href="channel_8h_source.html#l00410">ast_channel::blockproc</a>, <a class="el" href="channel_8h_source.html#l00422">ast_channel::cdr</a>, <a class="el" href="channel_8h_source.html#l00444">ast_channel::cid</a>, <a class="el" href="channel_8h_source.html#l00204">ast_callerid::cid_name</a>, <a class="el" href="channel_8h_source.html#l00203">ast_callerid::cid_num</a>, <a class="el" href="cdr_8h_source.html#l00097">ast_cdr::disposition</a>, <a class="el" href="manager_8h_source.html#l00062">EVENT_FLAG_CALL</a>, <a class="el" href="channel_8c_source.html#l01677">free_translation()</a>, <a class="el" href="channel_8h_source.html#l00404">ast_channel::generator</a>, <a class="el" href="channel_8h_source.html#l00403">ast_channel::generatordata</a>, <a class="el" href="structast__channel__tech.html#af210bbcabfb03e05658a12e1d9327239">ast_channel_tech::hangup</a>, <a class="el" href="channel_8h_source.html#l00479">ast_channel::hangupcause</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="manager_8h_source.html#l00181">manager_event</a>, <a class="el" href="channel_8h_source.html#l00408">ast_channel::masq</a>, <a class="el" href="channel_8h_source.html#l00409">ast_channel::masqr</a>, <a class="el" href="structast__generator.html#af1e67c15ec62c02506efc4f2f305bbe0">ast_generator::release</a>, <a class="el" href="strings_8h_source.html#l00072">S_OR</a>, <a class="el" href="channel_8h_source.html#l00413">ast_channel::sched</a>, <a class="el" href="sched_8c_source.html#l00260">sched_context_destroy()</a>, <a class="el" href="channel_8h_source.html#l00414">ast_channel::stream</a>, <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>, and <a class="el" href="channel_8h_source.html#l00415">ast_channel::vstream</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l04214">__ast_pbx_run()</a>, <a class="el" href="channel_8c_source.html#l03851">__ast_request_and_dial()</a>, <a class="el" href="chan__h323_8c_source.html#l00999">__oh323_new()</a>, <a class="el" href="features_8c_source.html#l04156">action_bridge()</a>, <a class="el" href="chan__agent_8c_source.html#l00893">agent_hangup()</a>, <a class="el" href="chan__agent_8c_source.html#l00519">agent_read()</a>, <a class="el" href="chan__alsa_8c_source.html#l00536">alsa_new()</a>, <a class="el" href="dial_8c_source.html#l00140">answer_exec_run()</a>, <a class="el" href="app__followme_8c_source.html#l01003">app_exec()</a>, <a class="el" href="pbx_8c_source.html#l07344">ast_async_goto()</a>, <a class="el" href="channel_8c_source.html#l03779">ast_call_forward()</a>, <a class="el" href="dial_8c_source.html#l00850">ast_dial_destroy()</a>, <a class="el" href="dial_8c_source.html#l00826">ast_dial_hangup()</a>, <a class="el" href="chan__iax2_8c_source.html#l05415">ast_iax2_new()</a>, <a class="el" href="pbx_8c_source.html#l08106">ast_pbx_outgoing_app()</a>, <a class="el" href="pbx_8c_source.html#l07940">ast_pbx_outgoing_exten()</a>, <a class="el" href="pbx_8c_source.html#l08091">ast_pbx_run_app()</a>, <a class="el" href="pbx_8c_source.html#l07853">async_wait()</a>, <a class="el" href="dial_8c_source.html#l00255">begin_dial_channel()</a>, <a class="el" href="features_8c_source.html#l00412">bridge_call_thread()</a>, <a class="el" href="bridging_8c_source.html#l01008">bridge_channel_thread()</a>, <a class="el" href="features_8c_source.html#l04524">bridge_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l01061">build_conf()</a>, <a class="el" href="features_8c_source.html#l01396">builtin_atxfer()</a>, <a class="el" href="app__chanisavail_8c_source.html#l00097">chanavail_exec()</a>, <a class="el" href="features_8c_source.html#l01370">check_compat()</a>, <a class="el" href="features_8c_source.html#l00366">check_goto_on_transfer()</a>, <a class="el" href="app__followme_8c_source.html#l00468">clear_caller()</a>, <a class="el" href="app__meetme_8c_source.html#l01648">conf_free()</a>, <a class="el" href="app__meetme_8c_source.html#l01998">conf_run()</a>, <a class="el" href="app__rpt_8c_source.html#l05678">connect_link()</a>, <a class="el" href="chan__console_8c_source.html#l00410">console_new()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>, <a class="el" href="app__confbridge_8c_source.html#l00364">destroy_conference_bridge()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="bridge__builtin__features_8c_source.html#l00068">dial_transfer()</a>, <a class="el" href="app__dial_8c_source.html#l00712">do_forward()</a>, <a class="el" href="app__queue_8c_source.html#l02408">do_hang()</a>, <a class="el" href="bridge__builtin__features_8c_source.html#l00157">feature_attended_transfer()</a>, <a class="el" href="features_8c_source.html#l02152">feature_request_and_dial()</a>, <a class="el" href="app__followme_8c_source.html#l00777">findmeexec()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00989">gtalk_new()</a>, <a class="el" href="dial_8c_source.html#l00328">handle_call_forward()</a>, <a class="el" href="chan__skinny_8c_source.html#l04584">handle_callforward_button()</a>, <a class="el" href="chan__skinny_8c_source.html#l05578">handle_enbloc_call_message()</a>, <a class="el" href="dial_8c_source.html#l00390">handle_frame()</a>, <a class="el" href="dial_8c_source.html#l00461">handle_frame_ownerless()</a>, <a class="el" href="chan__mgcp_8c_source.html#l02938">handle_hd_hf()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__sip_8c_source.html#l19184">handle_invite_replaces()</a>, <a class="el" href="chan__skinny_8c_source.html#l05045">handle_offhook_message()</a>, <a class="el" href="chan__sip_8c_source.html#l19641">handle_request_invite()</a>, <a class="el" href="chan__skinny_8c_source.html#l05662">handle_soft_key_event_message()</a>, <a class="el" href="chan__skinny_8c_source.html#l04699">handle_stimulus_message()</a>, <a class="el" href="dial_8c_source.html#l00506">handle_timeout_trip()</a>, <a class="el" href="chan__skinny_8c_source.html#l04449">handle_transfer_button()</a>, <a class="el" href="chan__unistim_8c_source.html#l02351">HandleCallOutgoing()</a>, <a class="el" href="chan__misdn_8c_source.html#l03932">hangup_chan()</a>, <a class="el" href="app__queue_8c_source.html#l02300">hangupcalls()</a>, <a class="el" href="app__dial_8c_source.html#l00574">hanguptree()</a>, <a class="el" href="chan__iax2_8c_source.html#l11561">iax2_request()</a>, <a class="el" href="chan__iax2_8c_source.html#l08941">iax_park()</a>, <a class="el" href="chan__iax2_8c_source.html#l08921">iax_park_thread()</a>, <a class="el" href="chan__jingle_8c_source.html#l00800">jingle_new()</a>, <a class="el" href="chan__local_8c_source.html#l00582">local_hangup()</a>, <a class="el" href="features_8c_source.html#l03009">manage_parkinglot()</a>, <a class="el" href="features_8c_source.html#l00833">masq_park_call()</a>, <a class="el" href="chan__mgcp_8c_source.html#l01470">mgcp_new()</a>, <a class="el" href="chan__mgcp_8c_source.html#l02637">mgcp_ss()</a>, <a class="el" href="dial_8c_source.html#l00535">monitor_dial()</a>, <a class="el" href="chan__dahdi_8c_source.html#l08925">mwi_thread()</a>, <a class="el" href="chan__nbs_8c_source.html#l00222">nbs_new()</a>, <a class="el" href="chan__oss_8c_source.html#l00784">oss_new()</a>, <a class="el" href="features_8c_source.html#l03335">park_exec_full()</a>, <a class="el" href="app__parkandannounce_8c_source.html#l00088">parkandannounce_exec()</a>, <a class="el" href="chan__phone_8c_source.html#l00846">phone_new()</a>, <a class="el" href="app__confbridge_8c_source.html#l00554">play_sound_file()</a>, <a class="el" href="app__rpt_8c_source.html#l10730">rpt()</a>, <a class="el" href="app__rpt_8c_source.html#l05280">rpt_call()</a>, <a class="el" href="app__rpt_8c_source.html#l13122">rpt_exec()</a>, <a class="el" href="app__rpt_8c_source.html#l03937">rpt_tele_thread()</a>, <a class="el" href="chan__sip_8c_source.html#l06599">sip_new()</a>, <a class="el" href="chan__sip_8c_source.html#l18778">sip_park()</a>, <a class="el" href="chan__sip_8c_source.html#l18706">sip_park_thread()</a>, <a class="el" href="chan__skinny_8c_source.html#l04268">skinny_new()</a>, <a class="el" href="chan__skinny_8c_source.html#l03619">skinny_ss()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>, <a class="el" href="app__queue_8c_source.html#l03569">try_calling()</a>, <a class="el" href="chan__unistim_8c_source.html#l04422">unistim_new()</a>, <a class="el" href="chan__usbradio_8c_source.html#l02183">usbradio_new()</a>, <a class="el" href="app__dial_8c_source.html#l00818">wait_for_answer()</a>, and <a class="el" href="app__followme_8c_source.html#l00509">wait_for_winner()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01691"></a>01691 {
<a name="l01692"></a>01692    <span class="keywordtype">int</span> res = 0;
<a name="l01693"></a>01693 
<a name="l01694"></a>01694    <span class="comment">/* Don&apos;t actually hang up a channel that will masquerade as someone else, or</span>
<a name="l01695"></a>01695 <span class="comment">      if someone is going to masquerade as us */</span>
<a name="l01696"></a>01696    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l01697"></a>01697 
<a name="l01698"></a>01698    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>) {
<a name="l01699"></a>01699       <a class="code" href="audiohook_8h.html#a97fef5ce6c1baffe0051c8f8b70ad2f8" title="Detach audiohooks from list and destroy said list.">ast_audiohook_detach_list</a>(chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>);
<a name="l01700"></a>01700       chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a> = NULL;
<a name="l01701"></a>01701    }
<a name="l01702"></a>01702 
<a name="l01703"></a>01703    <a class="code" href="channel_8h.html#a08bde7d8cf72457fc8c519a4443b413b" title="Stop servicing a channel for us...">ast_autoservice_stop</a>(chan);
<a name="l01704"></a>01704 
<a name="l01705"></a>01705    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#ae38ae730b987d648a6fe1c84c8a13442">masq</a>) {
<a name="l01706"></a>01706       <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#ab26f03fb10f1b2e8e52bfbbb1ee02f78" title="Start masquerading a channel XXX This is a seriously whacked out operation. We&amp;#39;re...">ast_do_masquerade</a>(chan))
<a name="l01707"></a>01707          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to perform masquerade\n&quot;</span>);
<a name="l01708"></a>01708    }
<a name="l01709"></a>01709 
<a name="l01710"></a>01710    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#ae38ae730b987d648a6fe1c84c8a13442">masq</a>) {
<a name="l01711"></a>01711       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s getting hung up, but someone is trying to masq into us?!?\n&quot;</span>, chan-&gt;name);
<a name="l01712"></a>01712       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l01713"></a>01713       <span class="keywordflow">return</span> 0;
<a name="l01714"></a>01714    }
<a name="l01715"></a>01715    <span class="comment">/* If this channel is one which will be masqueraded into something,</span>
<a name="l01716"></a>01716 <span class="comment">      mark it as a zombie already, so we know to free it later */</span>
<a name="l01717"></a>01717    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#abb53278bc00235a5ff76fc8badbe6363">masqr</a>) {
<a name="l01718"></a>01718       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a26796fa52cc5857446eec8d16a4b718d">AST_FLAG_ZOMBIE</a>);
<a name="l01719"></a>01719       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l01720"></a>01720       <span class="keywordflow">return</span> 0;
<a name="l01721"></a>01721    }
<a name="l01722"></a>01722    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l01723"></a>01723 
<a name="l01724"></a>01724    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>);
<a name="l01725"></a>01725    <span class="keywordflow">if</span> (!<a class="code" href="linkedlists_8h.html#a6091f0518f8b6f443fd9f5150f3ac407">AST_RWLIST_REMOVE</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>, chan, <a class="code" href="structchan__list.html" title="Channel call record structure.">chan_list</a>)) {
<a name="l01726"></a>01726       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to find channel in list to free. Assuming it has already been done.\n&quot;</span>);
<a name="l01727"></a>01727    }
<a name="l01728"></a>01728    <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a88ca779e8fdb868f32d38ed94a75ff53">AST_FLAG_IN_CHANNEL_LIST</a>);
<a name="l01729"></a>01729    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>);
<a name="l01730"></a>01730 
<a name="l01731"></a>01731    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l01732"></a>01732    <a class="code" href="channel_8c.html#ac9d4d03c20c48d15d9e91a85c5e35d67">free_translation</a>(chan);
<a name="l01733"></a>01733    <span class="comment">/* Close audio stream */</span>
<a name="l01734"></a>01734    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a016ccfa2a88444ffde0ad0168a0f231d">stream</a>) {
<a name="l01735"></a>01735       <a class="code" href="file_8h.html#ab53bd2c3c55d509790c7f7620aac6373" title="Closes a stream.">ast_closestream</a>(chan-&gt;<a class="code" href="structast__channel.html#a016ccfa2a88444ffde0ad0168a0f231d">stream</a>);
<a name="l01736"></a>01736       chan-&gt;<a class="code" href="structast__channel.html#a016ccfa2a88444ffde0ad0168a0f231d">stream</a> = NULL;
<a name="l01737"></a>01737    }
<a name="l01738"></a>01738    <span class="comment">/* Close video stream */</span>
<a name="l01739"></a>01739    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#ad224fea293daa62d4fba90f86c3503ee">vstream</a>) {
<a name="l01740"></a>01740       <a class="code" href="file_8h.html#ab53bd2c3c55d509790c7f7620aac6373" title="Closes a stream.">ast_closestream</a>(chan-&gt;<a class="code" href="structast__channel.html#ad224fea293daa62d4fba90f86c3503ee">vstream</a>);
<a name="l01741"></a>01741       chan-&gt;<a class="code" href="structast__channel.html#ad224fea293daa62d4fba90f86c3503ee">vstream</a> = NULL;
<a name="l01742"></a>01742    }
<a name="l01743"></a>01743    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#aea6233539fc73fc5303bf7525ec27e73">sched</a>) {
<a name="l01744"></a>01744       <a class="code" href="sched_8h.html#a7350994bcfd1be91874493dbe25faf0c" title="destroys a schedule context Destroys (free&amp;#39;s) the given sched_context structure...">sched_context_destroy</a>(chan-&gt;<a class="code" href="structast__channel.html#aea6233539fc73fc5303bf7525ec27e73">sched</a>);
<a name="l01745"></a>01745       chan-&gt;<a class="code" href="structast__channel.html#aea6233539fc73fc5303bf7525ec27e73">sched</a> = NULL;
<a name="l01746"></a>01746    }
<a name="l01747"></a>01747    
<a name="l01748"></a>01748    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#abe7876f86e249ea3db5fbacd2231389c">generatordata</a>)   <span class="comment">/* Clear any tone stuff remaining */</span>
<a name="l01749"></a>01749       <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a4e855ab0f984741b9083b2c5a0fdfe18">generator</a> &amp;&amp; chan-&gt;<a class="code" href="structast__channel.html#a4e855ab0f984741b9083b2c5a0fdfe18">generator</a>-&gt;<a class="code" href="structast__generator.html#af1e67c15ec62c02506efc4f2f305bbe0">release</a>)
<a name="l01750"></a>01750          chan-&gt;<a class="code" href="structast__channel.html#a4e855ab0f984741b9083b2c5a0fdfe18">generator</a>-&gt;<a class="code" href="structast__generator.html#af1e67c15ec62c02506efc4f2f305bbe0">release</a>(chan, chan-&gt;<a class="code" href="structast__channel.html#abe7876f86e249ea3db5fbacd2231389c">generatordata</a>);
<a name="l01751"></a>01751    chan-&gt;<a class="code" href="structast__channel.html#abe7876f86e249ea3db5fbacd2231389c">generatordata</a> = NULL;
<a name="l01752"></a>01752    chan-&gt;<a class="code" href="structast__channel.html#a4e855ab0f984741b9083b2c5a0fdfe18">generator</a> = NULL;
<a name="l01753"></a>01753    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329ab5b2bec9425dd0cfc789d96ef229cb3a">AST_FLAG_BLOCKING</a>)) {
<a name="l01754"></a>01754       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Hard hangup called by thread %ld on %s, while fd &quot;</span>
<a name="l01755"></a>01755                <span class="stringliteral">&quot;is blocked by thread %ld in procedure %s!  Expect a failure\n&quot;</span>,
<a name="l01756"></a>01756                (<span class="keywordtype">long</span>)pthread_self(), chan-&gt;name, (<span class="keywordtype">long</span>)chan-&gt;<a class="code" href="structast__channel.html#a0eb129e54ba403f15cae4473dd992ab8">blocker</a>, chan-&gt;<a class="code" href="structast__channel.html#ae9ef3ba2141dce73f755cdd3a34408d3">blockproc</a>);
<a name="l01757"></a>01757       <a class="code" href="utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329ab5b2bec9425dd0cfc789d96ef229cb3a">AST_FLAG_BLOCKING</a>) == 0);
<a name="l01758"></a>01758    }
<a name="l01759"></a>01759    <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a26796fa52cc5857446eec8d16a4b718d">AST_FLAG_ZOMBIE</a>)) {
<a name="l01760"></a>01760       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Hanging up channel &apos;%s&apos;\n&quot;</span>, chan-&gt;name);
<a name="l01761"></a>01761       <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#af210bbcabfb03e05658a12e1d9327239" title="Hangup (and possibly destroy) the channel.">hangup</a>)
<a name="l01762"></a>01762          res = chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#af210bbcabfb03e05658a12e1d9327239" title="Hangup (and possibly destroy) the channel.">hangup</a>(chan);
<a name="l01763"></a>01763    } <span class="keywordflow">else</span> {
<a name="l01764"></a>01764       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Hanging up zombie &apos;%s&apos;\n&quot;</span>, chan-&gt;name);
<a name="l01765"></a>01765    }
<a name="l01766"></a>01766          
<a name="l01767"></a>01767    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l01768"></a>01768    <a class="code" href="manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208" title="External routines may send asterisk manager events this way.">manager_event</a>(<a class="code" href="manager_8h.html#ab5db3cc603d7e798d61cb4cd94fbb4e2">EVENT_FLAG_CALL</a>, <span class="stringliteral">&quot;Hangup&quot;</span>,
<a name="l01769"></a>01769          <span class="stringliteral">&quot;Channel: %s\r\n&quot;</span>
<a name="l01770"></a>01770          <span class="stringliteral">&quot;Uniqueid: %s\r\n&quot;</span>
<a name="l01771"></a>01771          <span class="stringliteral">&quot;CallerIDNum: %s\r\n&quot;</span>
<a name="l01772"></a>01772          <span class="stringliteral">&quot;CallerIDName: %s\r\n&quot;</span>
<a name="l01773"></a>01773          <span class="stringliteral">&quot;Cause: %d\r\n&quot;</span>
<a name="l01774"></a>01774          <span class="stringliteral">&quot;Cause-txt: %s\r\n&quot;</span>,
<a name="l01775"></a>01775          chan-&gt;name,
<a name="l01776"></a>01776          chan-&gt;uniqueid,
<a name="l01777"></a>01777          <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>, <span class="stringliteral">&quot;&lt;unknown&gt;&quot;</span>),
<a name="l01778"></a>01778          <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a>, <span class="stringliteral">&quot;&lt;unknown&gt;&quot;</span>),
<a name="l01779"></a>01779          chan-&gt;<a class="code" href="structast__channel.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a>,
<a name="l01780"></a>01780          <a class="code" href="channel_8h.html#abb5f5ff5988e039726f2c0d982342378" title="Gives the string form of a given hangup cause.">ast_cause2str</a>(chan-&gt;<a class="code" href="structast__channel.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a>)
<a name="l01781"></a>01781          );
<a name="l01782"></a>01782 
<a name="l01783"></a>01783    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a> &amp;&amp; !<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>, <a class="code" href="cdr_8h.html#a61e17153131c3f7832cf2f3224fcfec4">AST_CDR_FLAG_BRIDGED</a>) &amp;&amp; 
<a name="l01784"></a>01784       !<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>, <a class="code" href="cdr_8h.html#ad1c97f787a4ae3481dd9b48fef118572">AST_CDR_FLAG_POST_DISABLED</a>) &amp;&amp; 
<a name="l01785"></a>01785        (chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>-&gt;<a class="code" href="structast__cdr.html#a1f9669e5d9d64aa831cd9db2dd71534f">disposition</a> != <a class="code" href="cdr_8h.html#af20894acc82ed87553fc81355890f152">AST_CDR_NULL</a> || <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>, <a class="code" href="cdr_8h.html#ad4e369ddb958ec8d383da42ff9e5fd72">AST_CDR_FLAG_DIALED</a>))) {
<a name="l01786"></a>01786       <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l01787"></a>01787          
<a name="l01788"></a>01788       <a class="code" href="cdr_8h.html#a9884cbdaef20e9f266bc2220772bf52b" title="End a call.">ast_cdr_end</a>(chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>);
<a name="l01789"></a>01789       <a class="code" href="cdr_8h.html#aaac5bba86e430704119f70df937701f8" title="Detaches the detail record for posting (and freeing) either now or at a later time...">ast_cdr_detach</a>(chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>);
<a name="l01790"></a>01790       chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a> = NULL;
<a name="l01791"></a>01791       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l01792"></a>01792    }
<a name="l01793"></a>01793    
<a name="l01794"></a>01794    <a class="code" href="channel_8h.html#a239d899b30002db4e8b08c055ac9d8e5" title="Free a channel structure.">ast_channel_free</a>(chan);
<a name="l01795"></a>01795 
<a name="l01796"></a>01796    <span class="keywordflow">return</span> res;
<a name="l01797"></a>01797 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aef2af15a597c948e97628da6c5c84f28"></a><!-- doxytag: member="channel.c::ast_indicate" ref="aef2af15a597c948e97628da6c5c84f28" args="(struct ast_channel *chan, int condition)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_indicate </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>condition</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Indicates condition of channel. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>Indicate a condition such as AST_CONTROL_BUSY, AST_CONTROL_RINGING, or AST_CONTROL_CONGESTION on a channel </dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel to change the indication </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>condition</em>&nbsp;</td><td>which condition to indicate on the channel </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns 0 on success, -1 on failure </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l03110">3110</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l03150">ast_indicate_data()</a>.</p>

<p>Referenced by <a class="el" href="app_8c_source.html#l00668">__ast_play_and_record()</a>, <a class="el" href="chan__agent_8c_source.html#l01086">agent_new()</a>, <a class="el" href="chan__alsa_8c_source.html#l00306">alsa_call()</a>, <a class="el" href="app__meetme_8c_source.html#l04667">answer_trunk_chan()</a>, <a class="el" href="features_8c_source.html#l02441">ast_bridge_call()</a>, <a class="el" href="channel_8c_source.html#l05055">ast_channel_bridge()</a>, <a class="el" href="channel_8c_source.html#l04393">ast_do_masquerade()</a>, <a class="el" href="app_8c_source.html#l00314">ast_dtmf_stream()</a>, <a class="el" href="channel_8c_source.html#l01799">ast_raw_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05502">attempt_transfer()</a>, <a class="el" href="features_8c_source.html#l01396">builtin_atxfer()</a>, <a class="el" href="features_8c_source.html#l01265">builtin_blindtransfer()</a>, <a class="el" href="chan__console_8c_source.html#l01026">cli_console_answer()</a>, <a class="el" href="app__dahdibarge_8c_source.html#l00095">conf_run()</a>, <a class="el" href="chan__console_8c_source.html#l00555">console_call()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="app__disa_8c_source.html#l00143">disa_exec()</a>, <a class="el" href="app__dial_8c_source.html#l00712">do_forward()</a>, <a class="el" href="features_8c_source.html#l02152">feature_request_and_dial()</a>, <a class="el" href="features_8c_source.html#l01221">finishup()</a>, <a class="el" href="app__rpt_8c_source.html#l09637">function_remote()</a>, <a class="el" href="chan__skinny_8c_source.html#l04584">handle_callforward_button()</a>, <a class="el" href="dial_8c_source.html#l00390">handle_frame()</a>, <a class="el" href="res__agi_8c_source.html#l01494">handle_recordfile()</a>, <a class="el" href="features_8c_source.html#l03009">manage_parkinglot()</a>, <a class="el" href="chan__mgcp_8c_source.html#l02637">mgcp_ss()</a>, <a class="el" href="dial_8c_source.html#l00535">monitor_dial()</a>, <a class="el" href="chan__oss_8c_source.html#l00591">oss_call()</a>, <a class="el" href="features_8c_source.html#l00678">park_call_full()</a>, <a class="el" href="features_8c_source.html#l03335">park_exec_full()</a>, <a class="el" href="pbx_8c_source.html#l08474">pbx_builtin_busy()</a>, <a class="el" href="pbx_8c_source.html#l08490">pbx_builtin_congestion()</a>, <a class="el" href="pbx_8c_source.html#l08447">pbx_builtin_proceeding()</a>, <a class="el" href="pbx_8c_source.html#l08456">pbx_builtin_progress()</a>, <a class="el" href="pbx_8c_source.html#l08465">pbx_builtin_ringing()</a>, <a class="el" href="pbx_8c_source.html#l08729">pbx_builtin_waitexten()</a>, <a class="el" href="app__queue_8c_source.html#l05031">queue_exec()</a>, <a class="el" href="app__record_8c_source.html#l00132">record_exec()</a>, <a class="el" href="app__rpt_8c_source.html#l10730">rpt()</a>, <a class="el" href="app__rpt_8c_source.html#l13122">rpt_exec()</a>, <a class="el" href="app__queue_8c_source.html#l02731">say_periodic_announcement()</a>, <a class="el" href="app__queue_8c_source.html#l02080">say_position()</a>, <a class="el" href="app__festival_8c_source.html#l00161">send_waveform_to_channel()</a>, <a class="el" href="chan__skinny_8c_source.html#l03619">skinny_ss()</a>, <a class="el" href="app__meetme_8c_source.html#l05149">sla_handle_hold_event()</a>, <a class="el" href="app__meetme_8c_source.html#l05601">sla_station_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l05808">sla_trunk_exec()</a>, <a class="el" href="app__queue_8c_source.html#l03569">try_calling()</a>, and <a class="el" href="app__dial_8c_source.html#l00818">wait_for_answer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03111"></a>03111 {
<a name="l03112"></a>03112    <span class="keywordflow">return</span> <a class="code" href="channel_8h.html#aa8c3522af1bc639cbd5b38f5fdf171fa" title="Indicates condition of channel, with payload.">ast_indicate_data</a>(chan, condition, NULL, 0);
<a name="l03113"></a>03113 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acea4077a84f9d8ffac3c41bf660e3219"></a><!-- doxytag: member="channel.c::ast_indicate_data" ref="acea4077a84f9d8ffac3c41bf660e3219" args="(struct ast_channel *chan, int _condition, const void *data, size_t datalen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_indicate_data </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>condition</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>datalen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Indicates condition of channel, with payload. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>Indicate a condition such as AST_CONTROL_HOLD with payload being music on hold class </dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel to change the indication </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>condition</em>&nbsp;</td><td>which condition to indicate on the channel </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>pointer to payload data </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>datalen</em>&nbsp;</td><td>size of payload data </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns 0 on success, -1 on failure </dd></dl>

<p><dl class="note"><dt><b>Note:</b></dt><dd>If we compare the enumeration type, which does not have any negative constants, the compiler may optimize this code away. Therefore, we must perform an integer comparison here. </dd></dl>
</p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l03150">3150</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="frame_8h_source.html#l00316">_XXX_AST_CONTROL_T38</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="channel_8c_source.html#l00461">ast_check_hangup()</a>, <a class="el" href="frame_8h_source.html#l00301">AST_CONTROL_ANSWER</a>, <a class="el" href="frame_8h_source.html#l00302">AST_CONTROL_BUSY</a>, <a class="el" href="frame_8h_source.html#l00305">AST_CONTROL_CONGESTION</a>, <a class="el" href="frame_8h_source.html#l00306">AST_CONTROL_FLASH</a>, <a class="el" href="frame_8h_source.html#l00298">AST_CONTROL_HANGUP</a>, <a class="el" href="frame_8h_source.html#l00313">AST_CONTROL_HOLD</a>, <a class="el" href="frame_8h_source.html#l00304">AST_CONTROL_OFFHOOK</a>, <a class="el" href="frame_8h_source.html#l00308">AST_CONTROL_OPTION</a>, <a class="el" href="frame_8h_source.html#l00312">AST_CONTROL_PROCEEDING</a>, <a class="el" href="frame_8h_source.html#l00311">AST_CONTROL_PROGRESS</a>, <a class="el" href="frame_8h_source.html#l00309">AST_CONTROL_RADIO_KEY</a>, <a class="el" href="frame_8h_source.html#l00310">AST_CONTROL_RADIO_UNKEY</a>, <a class="el" href="frame_8h_source.html#l00299">AST_CONTROL_RING</a>, <a class="el" href="frame_8h_source.html#l00300">AST_CONTROL_RINGING</a>, <a class="el" href="frame_8h_source.html#l00317">AST_CONTROL_SRCUPDATE</a>, <a class="el" href="frame_8h_source.html#l00318">AST_CONTROL_T38_PARAMETERS</a>, <a class="el" href="frame_8h_source.html#l00303">AST_CONTROL_TAKEOFFHOOK</a>, <a class="el" href="frame_8h_source.html#l00314">AST_CONTROL_UNHOLD</a>, <a class="el" href="frame_8h_source.html#l00315">AST_CONTROL_VIDUPDATE</a>, <a class="el" href="frame_8h_source.html#l00307">AST_CONTROL_WINK</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="channel_8h_source.html#l00529">AST_FLAG_ZOMBIE</a>, <a class="el" href="indications_8c_source.html#l00452">ast_get_indication_tone()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="indications_8c_source.html#l00301">ast_playtones_start()</a>, <a class="el" href="indications_8c_source.html#l00390">ast_playtones_stop()</a>, <a class="el" href="channel_8h_source.html#l00365">AST_STATE_UP</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="indications_8h_source.html#l00223">ast_tone_zone_sound_unref()</a>, <a class="el" href="indications_8h_source.html#l00051">ast_tone_zone_sound::data</a>, <a class="el" href="structast__channel__tech.html#a21e97c64bf4c9c328fa344d29ee1c065">ast_channel_tech::indicate</a>, <a class="el" href="channel_8c_source.html#l03115">is_visible_indication()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>, <a class="el" href="channel_8h_source.html#l00491">ast_channel::visible_indication</a>, and <a class="el" href="channel_8h_source.html#l00423">ast_channel::zone</a>.</p>

<p>Referenced by <a class="el" href="chan__agent_8c_source.html#l00893">agent_hangup()</a>, <a class="el" href="features_8c_source.html#l02441">ast_bridge_call()</a>, <a class="el" href="channel_8c_source.html#l04776">ast_generic_bridge()</a>, <a class="el" href="channel_8c_source.html#l03110">ast_indicate()</a>, <a class="el" href="rtp_8c_source.html#l03915">bridge_native_loop()</a>, <a class="el" href="rtp_8c_source.html#l04223">bridge_p2p_loop()</a>, <a class="el" href="chan__agent_8c_source.html#l01981">login_exec()</a>, <a class="el" href="features_8c_source.html#l03009">manage_parkinglot()</a>, <a class="el" href="features_8c_source.html#l00678">park_call_full()</a>, <a class="el" href="pbx_8c_source.html#l08729">pbx_builtin_waitexten()</a>, <a class="el" href="app__fax_8c_source.html#l00362">transmit_audio()</a>, <a class="el" href="app__fax_8c_source.html#l00599">transmit_t38()</a>, and <a class="el" href="app__dial_8c_source.html#l00818">wait_for_answer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03152"></a>03152 {
<a name="l03153"></a>03153    <span class="comment">/* By using an enum, we&apos;ll get compiler warnings for values not handled </span>
<a name="l03154"></a>03154 <span class="comment">    * in switch statements. */</span>
<a name="l03155"></a>03155    <span class="keyword">enum</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390">ast_control_frame_type</a> condition = _condition;
<a name="l03156"></a>03156    <span class="keyword">struct </span><a class="code" href="structast__tone__zone__sound.html" title="Description of a tone.">ast_tone_zone_sound</a> *ts = NULL;
<a name="l03157"></a>03157    <span class="keywordtype">int</span> res = -1;
<a name="l03158"></a>03158 
<a name="l03159"></a>03159    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l03160"></a>03160 
<a name="l03161"></a>03161    <span class="comment">/* Don&apos;t bother if the channel is about to go away, anyway. */</span>
<a name="l03162"></a>03162    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a26796fa52cc5857446eec8d16a4b718d">AST_FLAG_ZOMBIE</a>) || <a class="code" href="channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd" title="Check to see if a channel is needing hang up.">ast_check_hangup</a>(chan)) {
<a name="l03163"></a>03163       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l03164"></a>03164       <span class="keywordflow">return</span> -1;
<a name="l03165"></a>03165    }
<a name="l03166"></a>03166 
<a name="l03167"></a>03167    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a21e97c64bf4c9c328fa344d29ee1c065" title="Indicate a particular condition (e.g. AST_CONTROL_BUSY or AST_CONTROL_RINGING or...">indicate</a>) {
<a name="l03168"></a>03168       <span class="comment">/* See if the channel driver can handle this condition. */</span>
<a name="l03169"></a>03169       res = chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a21e97c64bf4c9c328fa344d29ee1c065" title="Indicate a particular condition (e.g. AST_CONTROL_BUSY or AST_CONTROL_RINGING or...">indicate</a>(chan, condition, <a class="code" href="structast__tone__zone__sound.html#a8f64897c7ccc5c13f276d1d07c4e7095" title="Description of a tone.">data</a>, datalen);
<a name="l03170"></a>03170    }
<a name="l03171"></a>03171 
<a name="l03172"></a>03172    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l03173"></a>03173 
<a name="l03174"></a>03174    <span class="keywordflow">if</span> (!res) {
<a name="l03175"></a>03175       <span class="comment">/* The channel driver successfully handled this indication */</span>
<a name="l03176"></a>03176       <span class="keywordflow">if</span> (<a class="code" href="channel_8c.html#ad06e1b83ea6a33e096035c7ac0be5a20">is_visible_indication</a>(condition)) {
<a name="l03177"></a>03177          chan-&gt;<a class="code" href="structast__channel.html#a5ad10add51120d9c9122eca4201dd645">visible_indication</a> = condition;
<a name="l03178"></a>03178       }
<a name="l03179"></a>03179       <span class="keywordflow">return</span> 0;
<a name="l03180"></a>03180    }
<a name="l03181"></a>03181 
<a name="l03182"></a>03182    <span class="comment">/* The channel driver does not support this indication, let&apos;s fake</span>
<a name="l03183"></a>03183 <span class="comment">    * it by doing our own tone generation if applicable. */</span>
<a name="l03184"></a>03184 <span class="comment"></span>
<a name="l03185"></a>03185 <span class="comment">   /*!\note If we compare the enumeration type, which does not have any</span>
<a name="l03186"></a>03186 <span class="comment">    * negative constants, the compiler may optimize this code away.</span>
<a name="l03187"></a>03187 <span class="comment">    * Therefore, we must perform an integer comparison here. */</span>
<a name="l03188"></a>03188    <span class="keywordflow">if</span> (_condition &lt; 0) {
<a name="l03189"></a>03189       <span class="comment">/* Stop any tones that are playing */</span>
<a name="l03190"></a>03190       <a class="code" href="app__rpt_8c.html#a9d5be069b7060d326a213f5d60b8dc77">ast_playtones_stop</a>(chan);
<a name="l03191"></a>03191       <span class="keywordflow">return</span> 0;
<a name="l03192"></a>03192    }
<a name="l03193"></a>03193 
<a name="l03194"></a>03194    <span class="comment">/* Handle conditions that we have tones for. */</span>
<a name="l03195"></a>03195    <span class="keywordflow">switch</span> (condition) {
<a name="l03196"></a>03196    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390af4cf96fe3cc13c2a1b4d539fcb1adaed">_XXX_AST_CONTROL_T38</a>:
<a name="l03197"></a>03197       <span class="comment">/* deprecated T.38 control frame */</span>
<a name="l03198"></a>03198       <span class="keywordflow">return</span> -1;
<a name="l03199"></a>03199    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>:
<a name="l03200"></a>03200       <span class="comment">/* there is no way to provide &apos;default&apos; behavior for these</span>
<a name="l03201"></a>03201 <span class="comment">       * control frames, so we need to return failure, but there</span>
<a name="l03202"></a>03202 <span class="comment">       * is also no value in the log message below being emitted</span>
<a name="l03203"></a>03203 <span class="comment">       * since failure to handle these frames is not an &apos;error&apos;</span>
<a name="l03204"></a>03204 <span class="comment">       * so just return right now.</span>
<a name="l03205"></a>03205 <span class="comment">       */</span>
<a name="l03206"></a>03206       <span class="keywordflow">return</span> -1;
<a name="l03207"></a>03207    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a>:
<a name="l03208"></a>03208       ts = <a class="code" href="indications_8h.html#a516be2823557000dcd4be685a44d1d09" title="Locate a tone zone sound.">ast_get_indication_tone</a>(chan-&gt;<a class="code" href="structast__channel.html#a3b50931566324162ca5ebdd52fb5874c">zone</a>, <span class="stringliteral">&quot;ring&quot;</span>);
<a name="l03209"></a>03209       <span class="comment">/* It is common practice for channel drivers to return -1 if trying</span>
<a name="l03210"></a>03210 <span class="comment">       * to indicate ringing on a channel which is up. The idea is to let the</span>
<a name="l03211"></a>03211 <span class="comment">       * core generate the ringing inband. However, we don&apos;t want the</span>
<a name="l03212"></a>03212 <span class="comment">       * warning message about not being able to handle the specific indication</span>
<a name="l03213"></a>03213 <span class="comment">       * to print nor do we want ast_indicate_data to return an &quot;error&quot; for this</span>
<a name="l03214"></a>03214 <span class="comment">       * condition</span>
<a name="l03215"></a>03215 <span class="comment">       */</span>
<a name="l03216"></a>03216       <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) {
<a name="l03217"></a>03217          res = 0;
<a name="l03218"></a>03218       }
<a name="l03219"></a>03219       <span class="keywordflow">break</span>;
<a name="l03220"></a>03220    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875">AST_CONTROL_BUSY</a>:
<a name="l03221"></a>03221       ts = <a class="code" href="indications_8h.html#a516be2823557000dcd4be685a44d1d09" title="Locate a tone zone sound.">ast_get_indication_tone</a>(chan-&gt;<a class="code" href="structast__channel.html#a3b50931566324162ca5ebdd52fb5874c">zone</a>, <span class="stringliteral">&quot;busy&quot;</span>);
<a name="l03222"></a>03222       <span class="keywordflow">break</span>;
<a name="l03223"></a>03223    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a850bb06a1702741c93a3fd67cc9637ab">AST_CONTROL_CONGESTION</a>:
<a name="l03224"></a>03224       ts = <a class="code" href="indications_8h.html#a516be2823557000dcd4be685a44d1d09" title="Locate a tone zone sound.">ast_get_indication_tone</a>(chan-&gt;<a class="code" href="structast__channel.html#a3b50931566324162ca5ebdd52fb5874c">zone</a>, <span class="stringliteral">&quot;congestion&quot;</span>);
<a name="l03225"></a>03225       <span class="keywordflow">break</span>;
<a name="l03226"></a>03226    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a1a461c5e737ed6ed7c8cb0f78557a6fd">AST_CONTROL_PROGRESS</a>:
<a name="l03227"></a>03227    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a50b7fe33bba67b74dd7b746539e81000">AST_CONTROL_PROCEEDING</a>:
<a name="l03228"></a>03228    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a417bc8ac5817cc1525a3b530abfc1528">AST_CONTROL_VIDUPDATE</a>:
<a name="l03229"></a>03229    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a009e81151b19671f42b5e84ab6a619f4">AST_CONTROL_SRCUPDATE</a>:
<a name="l03230"></a>03230    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aacb7ddf1a95fa544fdecada68213f3c7">AST_CONTROL_RADIO_KEY</a>:
<a name="l03231"></a>03231    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a34ac3ccebc219c59daa7eb0275fcd54d">AST_CONTROL_RADIO_UNKEY</a>:
<a name="l03232"></a>03232    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ac4106406e269667ff84ee49e0a634f94">AST_CONTROL_OPTION</a>:
<a name="l03233"></a>03233    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a195b2c39c09113953814aa800dd06e7f">AST_CONTROL_WINK</a>:
<a name="l03234"></a>03234    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ae8f2cd460fdc81e0a774434fa002e4bf">AST_CONTROL_FLASH</a>:
<a name="l03235"></a>03235    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a28cd8e9f9005e25624f993d6edd46755">AST_CONTROL_OFFHOOK</a>:
<a name="l03236"></a>03236    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a5a24176e8066b727463907da4903bb8e">AST_CONTROL_TAKEOFFHOOK</a>:
<a name="l03237"></a>03237    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>:
<a name="l03238"></a>03238    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa7dac1c1896ab418c2ff351aae707fba">AST_CONTROL_HANGUP</a>:
<a name="l03239"></a>03239    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a00675bfb8c64b2be86297fe4cba51fa2">AST_CONTROL_RING</a>:
<a name="l03240"></a>03240    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ab99a3d1c08c5ae8bca078c7cd1ec02f5">AST_CONTROL_HOLD</a>:
<a name="l03241"></a>03241    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>:
<a name="l03242"></a>03242       <span class="comment">/* Nothing left to do for these. */</span>
<a name="l03243"></a>03243       res = 0;
<a name="l03244"></a>03244       <span class="keywordflow">break</span>;
<a name="l03245"></a>03245    }
<a name="l03246"></a>03246 
<a name="l03247"></a>03247    <span class="keywordflow">if</span> (ts) {
<a name="l03248"></a>03248       <span class="comment">/* We have a tone to play, yay. */</span>
<a name="l03249"></a>03249       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Driver for channel &apos;%s&apos; does not support indication %d, emulating it\n&quot;</span>, chan-&gt;name, condition);
<a name="l03250"></a>03250       <a class="code" href="app__rpt_8c.html#a544e8a1dd4a986b00754103dda6a7d3b">ast_playtones_start</a>(chan, 0, ts-&gt;<a class="code" href="structast__tone__zone__sound.html#a8f64897c7ccc5c13f276d1d07c4e7095" title="Description of a tone.">data</a>, 1);
<a name="l03251"></a>03251       ts = <a class="code" href="indications_8h.html#a8b52ace68f21c0ac24414f038471647d" title="Release a reference to an ast_tone_zone_sound.">ast_tone_zone_sound_unref</a>(ts);
<a name="l03252"></a>03252       res = 0;
<a name="l03253"></a>03253       chan-&gt;<a class="code" href="structast__channel.html#a5ad10add51120d9c9122eca4201dd645">visible_indication</a> = condition;
<a name="l03254"></a>03254    }
<a name="l03255"></a>03255 
<a name="l03256"></a>03256    <span class="keywordflow">if</span> (res) {
<a name="l03257"></a>03257       <span class="comment">/* not handled */</span>
<a name="l03258"></a>03258       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to handle indication %d for &apos;%s&apos;\n&quot;</span>, condition, chan-&gt;name);
<a name="l03259"></a>03259    }
<a name="l03260"></a>03260 
<a name="l03261"></a>03261    <span class="keywordflow">return</span> res;
<a name="l03262"></a>03262 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a76c8f293c2dacf853b96314157f3421b"></a><!-- doxytag: member="channel.c::ast_install_music_functions" ref="a76c8f293c2dacf853b96314157f3421b" args="(int(*start_ptr)(struct ast_channel *, const char *, const char *), void(*stop_ptr)(struct ast_channel *), void(*cleanup_ptr)(struct ast_channel *))" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_install_music_functions </td>
          <td>(</td>
          <td class="paramtype">int(*)(struct <a class="el" href="structast__channel.html">ast_channel</a> *, const char *, const char *)&nbsp;</td>
          <td class="paramname"> <em>start_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(struct <a class="el" href="structast__channel.html">ast_channel</a> *)&nbsp;</td>
          <td class="paramname"> <em>stop_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(struct <a class="el" href="structast__channel.html">ast_channel</a> *)&nbsp;</td>
          <td class="paramname"> <em>cleanup_ptr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l05521">5521</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c.html#a83c5734824bc16e2228e1cb9ec40d0fb">ast_moh_cleanup_ptr</a>, <a class="el" href="channel_8c.html#ab61499493f5ff948a579c4c4515ef594">ast_moh_start_ptr</a>, and <a class="el" href="channel_8c.html#a0b1ab6a1da92f08402ac4df80b8d9512">ast_moh_stop_ptr</a>.</p>

<p>Referenced by <a class="el" href="res__musiconhold_8c_source.html#l01775">load_module()</a>, and <a class="el" href="res__musiconhold_8c_source.html#l01806">reload()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05524"></a>05524 {
<a name="l05525"></a>05525    <a class="code" href="channel_8c.html#ab61499493f5ff948a579c4c4515ef594">ast_moh_start_ptr</a> = start_ptr;
<a name="l05526"></a>05526    <a class="code" href="channel_8c.html#a0b1ab6a1da92f08402ac4df80b8d9512">ast_moh_stop_ptr</a> = stop_ptr;
<a name="l05527"></a>05527    <a class="code" href="channel_8c.html#a83c5734824bc16e2228e1cb9ec40d0fb">ast_moh_cleanup_ptr</a> = cleanup_ptr;
<a name="l05528"></a>05528 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a99a8df1071a8de39465245afc8ac6af7"></a><!-- doxytag: member="channel.c::ast_internal_timing_enabled" ref="a99a8df1071a8de39465245afc8ac6af7" args="(struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_internal_timing_enabled </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Check if the channel can run in internal timing mode. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>The channel to check </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>boolean</dd></dl>
<p>This function will return 1 if internal timing is enabled and the timing device is available. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l03093">3093</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="options_8h_source.html#l00117">ast_opt_internal_timing</a>, and <a class="el" href="channel_8h_source.html#l00468">ast_channel::timingfd</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l10016">add_sdp()</a>, and <a class="el" href="channel_8c_source.html#l02530">ast_read_generator_actions()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03094"></a>03094 {
<a name="l03095"></a>03095    <span class="keywordtype">int</span> ret = <a class="code" href="options_8h.html#ad5b0260f7317b8bf84d2b84fccc1f336">ast_opt_internal_timing</a> &amp;&amp; chan-&gt;<a class="code" href="structast__channel.html#a31160ea68032ecf93ec55a3127edd2f9">timingfd</a> &gt; -1;
<a name="l03096"></a>03096    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(5, <span class="stringliteral">&quot;Internal timing is %s (option_internal_timing=%d chan-&gt;timingfd=%d)\n&quot;</span>, ret? <span class="stringliteral">&quot;enabled&quot;</span>: <span class="stringliteral">&quot;disabled&quot;</span>, <a class="code" href="options_8h.html#ad5b0260f7317b8bf84d2b84fccc1f336">ast_opt_internal_timing</a>, chan-&gt;<a class="code" href="structast__channel.html#a31160ea68032ecf93ec55a3127edd2f9">timingfd</a>);
<a name="l03097"></a>03097    <span class="keywordflow">return</span> ret;
<a name="l03098"></a>03098 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2bfbbbb8be5c8a13ec5a054bbc9f25b1"></a><!-- doxytag: member="channel.c::ast_moh_cleanup" ref="a2bfbbbb8be5c8a13ec5a054bbc9f25b1" args="(struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_moh_cleanup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l05555">5555</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c.html#a83c5734824bc16e2228e1cb9ec40d0fb">ast_moh_cleanup_ptr</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l01388">ast_channel_free()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05556"></a>05556 {
<a name="l05557"></a>05557    <span class="keywordflow">if</span> (<a class="code" href="channel_8c.html#a83c5734824bc16e2228e1cb9ec40d0fb">ast_moh_cleanup_ptr</a>)
<a name="l05558"></a>05558       <a class="code" href="channel_8c.html#a83c5734824bc16e2228e1cb9ec40d0fb">ast_moh_cleanup_ptr</a>(chan);
<a name="l05559"></a>05559 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2acec01f2fddd8ca494d874003815cf7"></a><!-- doxytag: member="channel.c::ast_moh_start" ref="a2acec01f2fddd8ca494d874003815cf7" args="(struct ast_channel *chan, const char *mclass, const char *interpclass)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_moh_start </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>mclass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>interpclass</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Turn on music on hold on a given channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>The channel structure that will get music on hold </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mclass</em>&nbsp;</td><td>The class to use if the musicclass is not currently set on the channel structure. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>interpclass</em>&nbsp;</td><td>The class to use if the musicclass is not currently set on the channel structure or in the mclass argument.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>Zero</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>non-zero</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l05538">5538</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c.html#ab61499493f5ff948a579c4c4515ef594">ast_moh_start_ptr</a>, and <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>.</p>

<p>Referenced by <a class="el" href="chan__alsa_8c_source.html#l00500">alsa_indicate()</a>, <a class="el" href="app__followme_8c_source.html#l01003">app_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l01998">conf_run()</a>, <a class="el" href="app__meetme_8c_source.html#l01877">conf_start_moh()</a>, <a class="el" href="chan__console_8c_source.html#l00594">console_indicate()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07170">dahdi_indicate()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="features_8c_source.html#l01903">feature_exec_app()</a>, <a class="el" href="chan__gtalk_8c_source.html#l01483">gtalk_indicate()</a>, <a class="el" href="res__agi_8c_source.html#l01986">handle_setmusic()</a>, <a class="el" href="chan__iax2_8c_source.html#l05336">iax2_indicate()</a>, <a class="el" href="chan__jingle_8c_source.html#l01265">jingle_indicate()</a>, <a class="el" href="chan__unistim_8c_source.html#l02544">key_call()</a>, <a class="el" href="app__confbridge_8c_source.html#l00485">leave_conference_bridge()</a>, <a class="el" href="chan__local_8c_source.html#l00409">local_indicate()</a>, <a class="el" href="app__confbridge_8c_source.html#l00607">menu_callback()</a>, <a class="el" href="chan__mgcp_8c_source.html#l01426">mgcp_indicate()</a>, <a class="el" href="chan__misdn_8c_source.html#l02659">misdn_indication()</a>, <a class="el" href="res__musiconhold_8c_source.html#l00400">moh_handle_digit()</a>, <a class="el" href="dial_8c_source.html#l00535">monitor_dial()</a>, <a class="el" href="chan__h323_8c_source.html#l00856">oh323_indicate()</a>, <a class="el" href="chan__oss_8c_source.html#l00748">oss_indicate()</a>, <a class="el" href="chan__phone_8c_source.html#l00203">phone_indicate()</a>, <a class="el" href="res__musiconhold_8c_source.html#l00667">play_moh_exec()</a>, <a class="el" href="app__confbridge_8c_source.html#l00253">post_join_marked()</a>, <a class="el" href="app__confbridge_8c_source.html#l00320">post_join_unmarked()</a>, <a class="el" href="app__queue_8c_source.html#l05031">queue_exec()</a>, <a class="el" href="app__dial_8c_source.html#l02345">retrydial_exec()</a>, <a class="el" href="app__queue_8c_source.html#l02731">say_periodic_announcement()</a>, <a class="el" href="app__queue_8c_source.html#l02080">say_position()</a>, <a class="el" href="chan__sip_8c_source.html#l06491">sip_indicate()</a>, <a class="el" href="chan__skinny_8c_source.html#l04169">skinny_indicate()</a>, <a class="el" href="res__musiconhold_8c_source.html#l00747">start_moh_exec()</a>, <a class="el" href="chan__unistim_8c_source.html#l02305">TransferCallStep1()</a>, <a class="el" href="chan__unistim_8c_source.html#l04073">unistim_indicate()</a>, <a class="el" href="chan__usbradio_8c_source.html#l02123">usbradio_indicate()</a>, and <a class="el" href="res__musiconhold_8c_source.html#l00707">wait_moh_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05539"></a>05539 {
<a name="l05540"></a>05540    <span class="keywordflow">if</span> (<a class="code" href="channel_8c.html#ab61499493f5ff948a579c4c4515ef594">ast_moh_start_ptr</a>)
<a name="l05541"></a>05541       <span class="keywordflow">return</span> <a class="code" href="channel_8c.html#ab61499493f5ff948a579c4c4515ef594">ast_moh_start_ptr</a>(chan, mclass, interpclass);
<a name="l05542"></a>05542 
<a name="l05543"></a>05543    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Music class %s requested but no musiconhold loaded.\n&quot;</span>, mclass ? mclass : (interpclass ? interpclass : <span class="stringliteral">&quot;default&quot;</span>));
<a name="l05544"></a>05544 
<a name="l05545"></a>05545    <span class="keywordflow">return</span> 0;
<a name="l05546"></a>05546 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a52fead32f69533450f3c05b2e6960149"></a><!-- doxytag: member="channel.c::ast_moh_stop" ref="a52fead32f69533450f3c05b2e6960149" args="(struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_moh_stop </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Turn off music on hold on a given channel. </p>
<p>Turn off music on hold on a given channel </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l05549">5549</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c.html#a0b1ab6a1da92f08402ac4df80b8d9512">ast_moh_stop_ptr</a>.</p>

<p>Referenced by <a class="el" href="chan__alsa_8c_source.html#l00500">alsa_indicate()</a>, <a class="el" href="app__followme_8c_source.html#l01003">app_exec()</a>, <a class="el" href="chan__sip_8c_source.html#l18877">ast_quiet_chan()</a>, <a class="el" href="app__meetme_8c_source.html#l01998">conf_run()</a>, <a class="el" href="chan__console_8c_source.html#l00594">console_indicate()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07170">dahdi_indicate()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="features_8c_source.html#l04126">do_bridge_masquerade()</a>, <a class="el" href="features_8c_source.html#l01903">feature_exec_app()</a>, <a class="el" href="chan__gtalk_8c_source.html#l01483">gtalk_indicate()</a>, <a class="el" href="res__agi_8c_source.html#l01986">handle_setmusic()</a>, <a class="el" href="chan__iax2_8c_source.html#l05336">iax2_indicate()</a>, <a class="el" href="chan__jingle_8c_source.html#l01265">jingle_indicate()</a>, <a class="el" href="chan__unistim_8c_source.html#l02544">key_call()</a>, <a class="el" href="chan__unistim_8c_source.html#l02652">key_dial_page()</a>, <a class="el" href="chan__local_8c_source.html#l00409">local_indicate()</a>, <a class="el" href="app__confbridge_8c_source.html#l00607">menu_callback()</a>, <a class="el" href="chan__mgcp_8c_source.html#l01426">mgcp_indicate()</a>, <a class="el" href="chan__misdn_8c_source.html#l02659">misdn_indication()</a>, <a class="el" href="res__musiconhold_8c_source.html#l00400">moh_handle_digit()</a>, <a class="el" href="dial_8c_source.html#l00535">monitor_dial()</a>, <a class="el" href="chan__h323_8c_source.html#l00856">oh323_indicate()</a>, <a class="el" href="chan__oss_8c_source.html#l00748">oss_indicate()</a>, <a class="el" href="chan__phone_8c_source.html#l00203">phone_indicate()</a>, <a class="el" href="res__musiconhold_8c_source.html#l00667">play_moh_exec()</a>, <a class="el" href="app__confbridge_8c_source.html#l00253">post_join_marked()</a>, <a class="el" href="app__confbridge_8c_source.html#l00320">post_join_unmarked()</a>, <a class="el" href="app__queue_8c_source.html#l05031">queue_exec()</a>, <a class="el" href="app__dial_8c_source.html#l02345">retrydial_exec()</a>, <a class="el" href="app__queue_8c_source.html#l02731">say_periodic_announcement()</a>, <a class="el" href="app__queue_8c_source.html#l02080">say_position()</a>, <a class="el" href="chan__sip_8c_source.html#l06491">sip_indicate()</a>, <a class="el" href="chan__skinny_8c_source.html#l04169">skinny_indicate()</a>, <a class="el" href="res__musiconhold_8c_source.html#l00766">stop_moh_exec()</a>, <a class="el" href="app__queue_8c_source.html#l03569">try_calling()</a>, <a class="el" href="chan__unistim_8c_source.html#l03709">unistim_hangup()</a>, <a class="el" href="chan__unistim_8c_source.html#l04073">unistim_indicate()</a>, <a class="el" href="chan__usbradio_8c_source.html#l02123">usbradio_indicate()</a>, and <a class="el" href="res__musiconhold_8c_source.html#l00707">wait_moh_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05550"></a>05550 {
<a name="l05551"></a>05551    <span class="keywordflow">if</span> (<a class="code" href="channel_8c.html#a0b1ab6a1da92f08402ac4df80b8d9512">ast_moh_stop_ptr</a>)
<a name="l05552"></a>05552       <a class="code" href="channel_8c.html#a0b1ab6a1da92f08402ac4df80b8d9512">ast_moh_stop_ptr</a>(chan);
<a name="l05553"></a>05553 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1b3f92e2239cd9e9bc20c783e1dedc80"></a><!-- doxytag: member="channel.c::ast_poll_channel_add" ref="a1b3f92e2239cd9e9bc20c783e1dedc80" args="(struct ast_channel *chan0, struct ast_channel *chan1)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_poll_channel_add </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan1</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Add a channel to an optimized waitfor </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01610">1610</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00153">AST_MAX_FDS</a>, and <a class="el" href="channel_8h_source.html#l00458">ast_channel::fds</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l04776">ast_generic_bridge()</a>, <a class="el" href="dial_8c_source.html#l00255">begin_dial_channel()</a>, <a class="el" href="rtp_8c_source.html#l03915">bridge_native_loop()</a>, <a class="el" href="rtp_8c_source.html#l04223">bridge_p2p_loop()</a>, <a class="el" href="features_8c_source.html#l02152">feature_request_and_dial()</a>, and <a class="el" href="app__dial_8c_source.html#l00818">wait_for_answer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01611"></a>01611 {
<a name="l01612"></a>01612 <span class="preprocessor">#ifdef HAVE_EPOLL</span>
<a name="l01613"></a>01613 <span class="preprocessor"></span>   <span class="keyword">struct </span>epoll_event ev;
<a name="l01614"></a>01614    <span class="keywordtype">int</span> i = 0;
<a name="l01615"></a>01615 
<a name="l01616"></a>01616    <span class="keywordflow">if</span> (chan0-&gt;epfd == -1)
<a name="l01617"></a>01617       <span class="keywordflow">return</span>;
<a name="l01618"></a>01618 
<a name="l01619"></a>01619    <span class="comment">/* Iterate through the file descriptors on chan1, adding them to chan0 */</span>
<a name="l01620"></a>01620    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="channel_8h.html#aa3fc504e7ca90586e4d249831838de3c">AST_MAX_FDS</a>; i++) {
<a name="l01621"></a>01621       <span class="keywordflow">if</span> (chan1-&gt;<a class="code" href="structast__channel.html#aef68cd3879b791a3b6c12cdb750f8e6a">fds</a>[i] == -1)
<a name="l01622"></a>01622          <span class="keywordflow">continue</span>;
<a name="l01623"></a>01623       ev.events = EPOLLIN | EPOLLPRI | EPOLLERR | EPOLLHUP;
<a name="l01624"></a>01624       ev.data.ptr = chan1-&gt;epfd_data[i];
<a name="l01625"></a>01625       epoll_ctl(chan0-&gt;epfd, EPOLL_CTL_ADD, chan1-&gt;<a class="code" href="structast__channel.html#aef68cd3879b791a3b6c12cdb750f8e6a">fds</a>[i], &amp;ev);
<a name="l01626"></a>01626    }
<a name="l01627"></a>01627 
<a name="l01628"></a>01628 <span class="preprocessor">#endif</span>
<a name="l01629"></a>01629 <span class="preprocessor"></span>   <span class="keywordflow">return</span>;
<a name="l01630"></a>01630 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6b2da1bbe090143571ba1db7f94055a0"></a><!-- doxytag: member="channel.c::ast_poll_channel_del" ref="a6b2da1bbe090143571ba1db7f94055a0" args="(struct ast_channel *chan0, struct ast_channel *chan1)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_poll_channel_del </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan1</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Delete a channel from an optimized waitfor </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01633">1633</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00153">AST_MAX_FDS</a>, and <a class="el" href="channel_8h_source.html#l00458">ast_channel::fds</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l04776">ast_generic_bridge()</a>, <a class="el" href="rtp_8c_source.html#l03915">bridge_native_loop()</a>, <a class="el" href="rtp_8c_source.html#l04223">bridge_p2p_loop()</a>, <a class="el" href="features_8c_source.html#l02152">feature_request_and_dial()</a>, <a class="el" href="dial_8c_source.html#l00535">monitor_dial()</a>, and <a class="el" href="app__dial_8c_source.html#l00818">wait_for_answer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01634"></a>01634 {
<a name="l01635"></a>01635 <span class="preprocessor">#ifdef HAVE_EPOLL</span>
<a name="l01636"></a>01636 <span class="preprocessor"></span>   <span class="keyword">struct </span>epoll_event ev;
<a name="l01637"></a>01637    <span class="keywordtype">int</span> i = 0;
<a name="l01638"></a>01638 
<a name="l01639"></a>01639    <span class="keywordflow">if</span> (chan0-&gt;epfd == -1)
<a name="l01640"></a>01640       <span class="keywordflow">return</span>;
<a name="l01641"></a>01641 
<a name="l01642"></a>01642    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="channel_8h.html#aa3fc504e7ca90586e4d249831838de3c">AST_MAX_FDS</a>; i++) {
<a name="l01643"></a>01643       <span class="keywordflow">if</span> (chan1-&gt;<a class="code" href="structast__channel.html#aef68cd3879b791a3b6c12cdb750f8e6a">fds</a>[i] == -1)
<a name="l01644"></a>01644          <span class="keywordflow">continue</span>;
<a name="l01645"></a>01645       epoll_ctl(chan0-&gt;epfd, EPOLL_CTL_DEL, chan1-&gt;<a class="code" href="structast__channel.html#aef68cd3879b791a3b6c12cdb750f8e6a">fds</a>[i], &amp;ev);
<a name="l01646"></a>01646    }
<a name="l01647"></a>01647 
<a name="l01648"></a>01648 <span class="preprocessor">#endif</span>
<a name="l01649"></a>01649 <span class="preprocessor"></span>   <span class="keywordflow">return</span>;
<a name="l01650"></a>01650 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a092d4e67b0bda0f99b02a1534ee75408"></a><!-- doxytag: member="channel.c::ast_print_group" ref="a092d4e67b0bda0f99b02a1534ee75408" args="(char *buf, int buflen, ast_group_t group)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* ast_print_group </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>buflen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="channel_8h.html#a641d81d0c5c8df99d43eff69aede3bfd">ast_group_t</a>&nbsp;</td>
          <td class="paramname"> <em>group</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Print call <a class="el" href="structgroup.html">group</a> and pickup <a class="el" href="structgroup.html">group</a> ---. </p>
<p>print call- and pickup <a class="el" href="structgroups.html">groups</a> into buffer </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l05567">5567</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="devicestate_8c_source.html#l00198">first</a>, and <a class="el" href="adsistub_8c_source.html#l00077">num</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l15349">_sip_show_peer()</a>, <a class="el" href="chan__skinny_8c_source.html#l03337">_skinny_show_line()</a>, <a class="el" href="func__channel_8c_source.html#l00230">func_channel_read()</a>, <a class="el" href="chan__sip_8c_source.html#l17269">function_sippeer()</a>, <a class="el" href="misdn__config_8c_source.html#l00742">misdn_cfg_get_config_string()</a>, <a class="el" href="chan__sip_8c_source.html#l14888">print_group()</a>, <a class="el" href="chan__misdn_8c_source.html#l02185">read_config()</a>, and <a class="el" href="app__dumpchan_8c_source.html#l00065">serialize_showchan()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05568"></a>05568 {
<a name="l05569"></a>05569    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
<a name="l05570"></a>05570    <span class="keywordtype">int</span> <a class="code" href="devicestate_8c.html#abd2135e6f8a41bc900933b1985d97165">first</a> = 1;
<a name="l05571"></a>05571    <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#af6fc584548091f45267cfaf7066119bd">num</a>[3];
<a name="l05572"></a>05572 
<a name="l05573"></a>05573    <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l05574"></a>05574    
<a name="l05575"></a>05575    <span class="keywordflow">if</span> (!<a class="code" href="structgroup.html">group</a>) <span class="comment">/* Return empty string if no group */</span>
<a name="l05576"></a>05576       <span class="keywordflow">return</span> <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>;
<a name="l05577"></a>05577 
<a name="l05578"></a>05578    <span class="keywordflow">for</span> (i = 0; i &lt;= 63; i++) {   <span class="comment">/* Max group is 63 */</span>
<a name="l05579"></a>05579       <span class="keywordflow">if</span> (<a class="code" href="structgroup.html">group</a> &amp; ((<a class="code" href="channel_8h.html#a641d81d0c5c8df99d43eff69aede3bfd">ast_group_t</a>) 1 &lt;&lt; i)) {
<a name="l05580"></a>05580             <span class="keywordflow">if</span> (!first) {
<a name="l05581"></a>05581             strncat(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <span class="stringliteral">&quot;, &quot;</span>, buflen - strlen(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>) - 1);
<a name="l05582"></a>05582          } <span class="keywordflow">else</span> {
<a name="l05583"></a>05583             first = 0;
<a name="l05584"></a>05584          }
<a name="l05585"></a>05585          snprintf(num, <span class="keyword">sizeof</span>(num), <span class="stringliteral">&quot;%u&quot;</span>, i);
<a name="l05586"></a>05586          strncat(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, num, buflen - strlen(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>) - 1);
<a name="l05587"></a>05587       }
<a name="l05588"></a>05588    }
<a name="l05589"></a>05589    <span class="keywordflow">return</span> <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>;
<a name="l05590"></a>05590 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2458f1412e300412e53d86fe94e19002"></a><!-- doxytag: member="channel.c::ast_prod" ref="a2458f1412e300412e53d86fe94e19002" args="(struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_prod </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Send empty audio to prime a channel driver. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l03383">3383</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8h_source.html#l00101">AST_FRAME_VOICE</a>, <a class="el" href="frame_8h_source.html#l00203">AST_FRIENDLY_OFFSET</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8h_source.html#l00365">AST_STATE_UP</a>, <a class="el" href="channel_8c_source.html#l03411">ast_write()</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::ptr</a>, <a class="el" href="channel_8h_source.html#l00486">ast_channel::rawwriteformat</a>, <a class="el" href="frame_8h_source.html#l00157">ast_frame::src</a>, and <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l02001">ast_activate_generator()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03384"></a>03384 {
<a name="l03385"></a>03385    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> a = { <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a> };
<a name="l03386"></a>03386    <span class="keywordtype">char</span> nothing[128];
<a name="l03387"></a>03387 
<a name="l03388"></a>03388    <span class="comment">/* Send an empty audio frame to get things moving */</span>
<a name="l03389"></a>03389    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) {
<a name="l03390"></a>03390       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Prodding channel &apos;%s&apos;\n&quot;</span>, chan-&gt;name);
<a name="l03391"></a>03391       a.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = chan-&gt;<a class="code" href="structast__channel.html#a045b6dfdee84adceb7e86b6c5c4f9a86">rawwriteformat</a>;
<a name="l03392"></a>03392       a.<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> = nothing + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>;
<a name="l03393"></a>03393       a.<a class="code" href="structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a> = <span class="stringliteral">&quot;ast_prod&quot;</span>;
<a name="l03394"></a>03394       <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a79c413d51b7135404d5cacf811649a61" title="Write a frame to a channel This function writes the given frame to the indicated...">ast_write</a>(chan, &amp;a))
<a name="l03395"></a>03395          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Prodding channel &apos;%s&apos; failed\n&quot;</span>, chan-&gt;name);
<a name="l03396"></a>03396    }
<a name="l03397"></a>03397    <span class="keywordflow">return</span> 0;
<a name="l03398"></a>03398 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a60f9d2b0ab8b7a839902313321163b28"></a><!-- doxytag: member="channel.c::ast_queue_control" ref="a60f9d2b0ab8b7a839902313321163b28" args="(struct ast_channel *chan, enum ast_control_frame_type control)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_queue_control </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="frame_8h.html#aedda41918e992000fe921f8f7363b390">ast_control_frame_type</a>&nbsp;</td>
          <td class="paramname"> <em>control</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Queue a control frame. </p>
<p>Queue a control frame with payload. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01123">1123</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00105">AST_FRAME_CONTROL</a>, <a class="el" href="channel_8c_source.html#l01080">ast_queue_frame()</a>, and <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l06601">__dahdi_exception()</a>, <a class="el" href="chan__h323_8c_source.html#l00332">__oh323_update_info()</a>, <a class="el" href="features_8c_source.html#l04475">ast_pickup_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05502">attempt_transfer()</a>, <a class="el" href="chan__sip_8c_source.html#l05348">auto_congest()</a>, <a class="el" href="chan__misdn_8c_source.html#l04379">cb_events()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00603">gtalk_is_answered()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00501">gtalk_ringing_ack()</a>, <a class="el" href="chan__mgcp_8c_source.html#l02938">handle_hd_hf()</a>, <a class="el" href="chan__skinny_8c_source.html#l05045">handle_offhook_message()</a>, <a class="el" href="chan__mgcp_8c_source.html#l03020">handle_request()</a>, <a class="el" href="chan__sip_8c_source.html#l21024">handle_request_bye()</a>, <a class="el" href="chan__sip_8c_source.html#l16615">handle_request_info()</a>, <a class="el" href="chan__sip_8c_source.html#l19641">handle_request_invite()</a>, <a class="el" href="chan__sip_8c_source.html#l20572">handle_request_refer()</a>, <a class="el" href="chan__sip_8c_source.html#l18268">handle_response()</a>, <a class="el" href="chan__sip_8c_source.html#l17572">handle_response_invite()</a>, <a class="el" href="chan__sip_8c_source.html#l17997">handle_response_refer()</a>, <a class="el" href="chan__skinny_8c_source.html#l05662">handle_soft_key_event_message()</a>, <a class="el" href="chan__skinny_8c_source.html#l04699">handle_stimulus_message()</a>, <a class="el" href="chan__unistim_8c_source.html#l02440">HandleCallIncoming()</a>, <a class="el" href="chan__jingle_8c_source.html#l00478">jingle_is_answered()</a>, <a class="el" href="chan__jingle_8c_source.html#l00377">jingle_ringing_ack()</a>, <a class="el" href="chan__mgcp_8c_source.html#l00843">mgcp_call()</a>, <a class="el" href="chan__misdn_8c_source.html#l04108">misdn_attempt_transfer()</a>, <a class="el" href="chan__nbs_8c_source.html#l00086">nbs_call()</a>, <a class="el" href="chan__phone_8c_source.html#l00287">phone_call()</a>, <a class="el" href="app__directed__pickup_8c_source.html#l00091">pickup_do()</a>, <a class="el" href="chan__sip_8c_source.html#l08040">process_sdp()</a>, <a class="el" href="chan__h323_8c_source.html#l01827">receive_digit()</a>, <a class="el" href="chan__h323_8c_source.html#l02503">remote_hold()</a>, <a class="el" href="chan__misdn_8c_source.html#l04202">send_cause2ast()</a>, <a class="el" href="chan__h323_8c_source.html#l01936">setup_rtp_connection()</a>, <a class="el" href="chan__skinny_8c_source.html#l03723">skinny_call()</a>, <a class="el" href="chan__skinny_8c_source.html#l04102">skinny_transfer()</a>, <a class="el" href="chan__skinny_8c_source.html#l04404">skinny_unhold()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>, <a class="el" href="chan__unistim_8c_source.html#l03649">unistim_call()</a>, and <a class="el" href="chan__h323_8c_source.html#l01170">update_state()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01124"></a>01124 {
<a name="l01125"></a>01125    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> <a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a> = { <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>, };
<a name="l01126"></a>01126 
<a name="l01127"></a>01127    f.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = control;
<a name="l01128"></a>01128 
<a name="l01129"></a>01129    <span class="keywordflow">return</span> <a class="code" href="channel_8h.html#a6cbcba5661d55216968cde8fdf913c89" title="Queue one or more frames to a channel&amp;#39;s frame queue.">ast_queue_frame</a>(chan, &amp;f);
<a name="l01130"></a>01130 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7e5e15c22564fd66351d332ad10658b5"></a><!-- doxytag: member="channel.c::ast_queue_control_data" ref="a7e5e15c22564fd66351d332ad10658b5" args="(struct ast_channel *chan, enum ast_control_frame_type control, const void *data, size_t datalen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_queue_control_data </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="frame_8h.html#aedda41918e992000fe921f8f7363b390">ast_control_frame_type</a>&nbsp;</td>
          <td class="paramname"> <em>control</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>datalen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Queue a control frame with payload. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel to queue frame onto </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>control</em>&nbsp;</td><td>type of control frame </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>pointer to payload data to be included in frame </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>datalen</em>&nbsp;</td><td><a class="el" href="structnumber.html" title="Number structure.">number</a> of bytes of payload data</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>non-zero</em>&nbsp;</td><td>failure</td></tr>
  </table>
  </dd>
</dl>
<p>The supplied payload data is copied into the frame, so the caller's copy is not modified nor freed, and the resulting frame will retain a copy of the data even if the caller frees their local copy.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>This method should be treated as a 'network transport'; in other words, your frames may be transferred across an IAX2 channel to another system, which may be a different endianness than yours. Because of this, you should ensure that either your frames will never be expected to work across systems, or that you always put your payload data into 'network byte order' before calling this function.</dd>
<dd>
The channel does not need to be locked before calling this function. </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01133">1133</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00105">AST_FRAME_CONTROL</a>, <a class="el" href="channel_8c_source.html#l01080">ast_queue_frame()</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="frame_8h_source.html#l00147">ast_frame::datalen</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::ptr</a>, and <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l05019">change_t38_state()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, <a class="el" href="chan__iax2_8c_source.html#l02825">iax2_queue_control_data()</a>, <a class="el" href="chan__sip_8c_source.html#l08040">process_sdp()</a>, and <a class="el" href="chan__skinny_8c_source.html#l04377">skinny_hold()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01135"></a>01135 {
<a name="l01136"></a>01136    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> <a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a> = { <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>, };
<a name="l01137"></a>01137 
<a name="l01138"></a>01138    f.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = control;
<a name="l01139"></a>01139    f.<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> = (<span class="keywordtype">void</span> *) <a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>;
<a name="l01140"></a>01140    f.<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> = <a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>;
<a name="l01141"></a>01141 
<a name="l01142"></a>01142    <span class="keywordflow">return</span> <a class="code" href="channel_8h.html#a6cbcba5661d55216968cde8fdf913c89" title="Queue one or more frames to a channel&amp;#39;s frame queue.">ast_queue_frame</a>(chan, &amp;f);
<a name="l01143"></a>01143 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3df7007b550647c63a1b211181b55814"></a><!-- doxytag: member="channel.c::ast_queue_frame" ref="a3df7007b550647c63a1b211181b55814" args="(struct ast_channel *chan, struct ast_frame *fin)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_queue_frame </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td>
          <td class="paramname"> <em>f</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Queue one or more frames to a channel's frame queue. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>the channel to queue the frame(s) on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>f</em>&nbsp;</td><td>the frame(s) to queue. Note that the frame(s) will be duplicated by this function. It is the responsibility of the caller to handle freeing the memory associated with the frame(s) being passed if necessary.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>non-zero</em>&nbsp;</td><td>failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01080">1080</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l00991">__ast_queue_frame()</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l02636">__ast_read()</a>, <a class="el" href="chan__h323_8c_source.html#l00951">__oh323_rtp_create()</a>, <a class="el" href="chan__h323_8c_source.html#l00332">__oh323_update_info()</a>, <a class="el" href="manager_8c_source.html#l02168">action_atxfer()</a>, <a class="el" href="chan__agent_8c_source.html#l01086">agent_new()</a>, <a class="el" href="chan__alsa_8c_source.html#l00306">alsa_call()</a>, <a class="el" href="channel_8c_source.html#l04217">ast_channel_masquerade()</a>, <a class="el" href="channel_8c_source.html#l00521">ast_channel_setwhentohangup_tv()</a>, <a class="el" href="channel_8c_source.html#l04393">ast_do_masquerade()</a>, <a class="el" href="dsp_8c_source.html#l01306">ast_dsp_process()</a>, <a class="el" href="channel_8c_source.html#l01123">ast_queue_control()</a>, <a class="el" href="channel_8c_source.html#l01133">ast_queue_control_data()</a>, <a class="el" href="channel_8c_source.html#l01091">ast_queue_hangup()</a>, <a class="el" href="channel_8c_source.html#l01103">ast_queue_hangup_with_cause()</a>, <a class="el" href="channel_8c_source.html#l01653">ast_softhangup_nolock()</a>, <a class="el" href="chan__bridge_8c_source.html#l00091">bridge_write()</a>, <a class="el" href="chan__misdn_8c_source.html#l04379">cb_events()</a>, <a class="el" href="chan__console_8c_source.html#l01026">cli_console_answer()</a>, <a class="el" href="chan__console_8c_source.html#l00768">cli_console_dial()</a>, <a class="el" href="chan__console_8c_source.html#l00731">cli_console_flash()</a>, <a class="el" href="chan__console_8c_source.html#l01076">cli_console_sendtext()</a>, <a class="el" href="chan__alsa_8c_source.html#l00645">console_answer()</a>, <a class="el" href="chan__console_8c_source.html#l00555">console_call()</a>, <a class="el" href="chan__alsa_8c_source.html#l00779">console_dial()</a>, <a class="el" href="chan__oss_8c_source.html#l00943">console_do_answer()</a>, <a class="el" href="chan__oss_8c_source.html#l01044">console_flash()</a>, <a class="el" href="chan__alsa_8c_source.html#l00688">console_sendtext()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01544">dahdi_queue_frame()</a>, <a class="el" href="app__dictate_8c_source.html#l00084">dictate_exec()</a>, <a class="el" href="chan__misdn_8c_source.html#l04143">do_immediate_setup()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00680">gtalk_handle_dtmf()</a>, <a class="el" href="chan__skinny_8c_source.html#l04628">handle_keypad_button_message()</a>, <a class="el" href="chan__sip_8c_source.html#l16615">handle_request_info()</a>, <a class="el" href="chan__sip_8c_source.html#l19641">handle_request_invite()</a>, <a class="el" href="chan__sip_8c_source.html#l17572">handle_response_invite()</a>, <a class="el" href="chan__iax2_8c_source.html#l02763">iax2_queue_frame()</a>, <a class="el" href="chan__jingle_8c_source.html#l00498">jingle_handle_dtmf()</a>, <a class="el" href="chan__local_8c_source.html#l00206">local_queue_frame()</a>, <a class="el" href="chan__mgcp_8c_source.html#l00592">mgcp_queue_frame()</a>, <a class="el" href="chan__h323_8c_source.html#l00302">oh323_simulate_dtmf_end()</a>, <a class="el" href="chan__oss_8c_source.html#l00591">oss_call()</a>, <a class="el" href="chan__sip_8c_source.html#l08040">process_sdp()</a>, <a class="el" href="channel_8c_source.html#l02578">queue_dtmf_readq()</a>, <a class="el" href="chan__h323_8c_source.html#l01827">receive_digit()</a>, <a class="el" href="chan__sip_8c_source.html#l14236">receive_message()</a>, <a class="el" href="app__rpt_8c_source.html#l05280">rpt_call()</a>, <a class="el" href="chan__console_8c_source.html#l00261">stream_monitor()</a>, <a class="el" href="chan__unistim_8c_source.html#l02472">unistim_do_senddigit()</a>, <a class="el" href="chan__unistim_8c_source.html#l04219">unistim_senddigit_end()</a>, <a class="el" href="chan__usbradio_8c_source.html#l01796">usbradio_read()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l01520">wakeup_sub()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01081"></a>01081 {
<a name="l01082"></a>01082    <span class="keywordflow">return</span> <a class="code" href="channel_8c.html#ae5b763a23d35fc0b721adc3df8724712">__ast_queue_frame</a>(chan, fin, 0, NULL);
<a name="l01083"></a>01083 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8b8c37c2fb7bb32b302635f257982271"></a><!-- doxytag: member="channel.c::ast_queue_frame_head" ref="a8b8c37c2fb7bb32b302635f257982271" args="(struct ast_channel *chan, struct ast_frame *fin)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_queue_frame_head </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td>
          <td class="paramname"> <em>f</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Queue one or more frames to the head of a channel's frame queue. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>the channel to queue the frame(s) on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>f</em>&nbsp;</td><td>the frame(s) to queue. Note that the frame(s) will be duplicated by this function. It is the responsibility of the caller to handle freeing the memory associated with the frame(s) being passed if necessary.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>non-zero</em>&nbsp;</td><td>failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01085">1085</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l00991">__ast_queue_frame()</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l01850">__ast_answer()</a>, <a class="el" href="channel_8c_source.html#l02636">__ast_read()</a>, and <a class="el" href="autoservice_8c_source.html#l00251">ast_autoservice_stop()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01086"></a>01086 {
<a name="l01087"></a>01087    <span class="keywordflow">return</span> <a class="code" href="channel_8c.html#ae5b763a23d35fc0b721adc3df8724712">__ast_queue_frame</a>(chan, fin, 1, NULL);
<a name="l01088"></a>01088 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a30bcf0418189567bc84ff32034f79f28"></a><!-- doxytag: member="channel.c::ast_queue_hangup" ref="a30bcf0418189567bc84ff32034f79f28" args="(struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_queue_hangup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Queue a hangup frame for channel. </p>
<p>Queue a hangup frame. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01091">1091</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00462">ast_channel::_softhangup</a>, <a class="el" href="lock_8h_source.html#l02037">ast_channel_trylock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="frame_8h_source.html#l00298">AST_CONTROL_HANGUP</a>, <a class="el" href="frame_8h_source.html#l00105">AST_FRAME_CONTROL</a>, <a class="el" href="channel_8c_source.html#l01080">ast_queue_frame()</a>, and <a class="el" href="channel_8h_source.html#l00633">AST_SOFTHANGUP_DEV</a>.</p>

<p>Referenced by <a class="el" href="chan__bridge_8c_source.html#l00136">bridge_queue_hangup()</a>, <a class="el" href="chan__h323_8c_source.html#l02337">cleanup_connection()</a>, <a class="el" href="chan__console_8c_source.html#l00842">cli_console_hangup()</a>, <a class="el" href="chan__unistim_8c_source.html#l01968">close_call()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00748">gtalk_hangup_farend()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00603">gtalk_is_answered()</a>, <a class="el" href="chan__skinny_8c_source.html#l05135">handle_onhook_message()</a>, <a class="el" href="chan__sip_8c_source.html#l21024">handle_request_bye()</a>, <a class="el" href="chan__sip_8c_source.html#l20855">handle_request_cancel()</a>, <a class="el" href="chan__skinny_8c_source.html#l05662">handle_soft_key_event_message()</a>, <a class="el" href="chan__iax2_8c_source.html#l03223">iax2_destroy()</a>, <a class="el" href="chan__iax2_8c_source.html#l02794">iax2_queue_hangup()</a>, <a class="el" href="chan__jingle_8c_source.html#l00562">jingle_hangup_farend()</a>, <a class="el" href="chan__local_8c_source.html#l00582">local_hangup()</a>, and <a class="el" href="chan__mgcp_8c_source.html#l00608">mgcp_queue_hangup()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01092"></a>01092 {
<a name="l01093"></a>01093    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> <a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a> = { <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa7dac1c1896ab418c2ff351aae707fba">AST_CONTROL_HANGUP</a> };
<a name="l01094"></a>01094    <span class="comment">/* Yeah, let&apos;s not change a lock-critical value without locking */</span>
<a name="l01095"></a>01095    <span class="keywordflow">if</span> (!<a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(chan)) {
<a name="l01096"></a>01096       chan-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> |= <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709a2e185ce313026e13ed90ae3a319c9cb7">AST_SOFTHANGUP_DEV</a>;
<a name="l01097"></a>01097       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l01098"></a>01098    }
<a name="l01099"></a>01099    <span class="keywordflow">return</span> <a class="code" href="channel_8h.html#a6cbcba5661d55216968cde8fdf913c89" title="Queue one or more frames to a channel&amp;#39;s frame queue.">ast_queue_frame</a>(chan, &amp;f);
<a name="l01100"></a>01100 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a91e78b15da3244307ffd749fa85f4db7"></a><!-- doxytag: member="channel.c::ast_queue_hangup_with_cause" ref="a91e78b15da3244307ffd749fa85f4db7" args="(struct ast_channel *chan, int cause)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_queue_hangup_with_cause </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cause</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Queue a hangup frame for channel. </p>
<p>Queue a hangup frame with hangupcause set. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01103">1103</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00462">ast_channel::_softhangup</a>, <a class="el" href="lock_8h_source.html#l02037">ast_channel_trylock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="frame_8h_source.html#l00298">AST_CONTROL_HANGUP</a>, <a class="el" href="frame_8h_source.html#l00105">AST_FRAME_CONTROL</a>, <a class="el" href="channel_8c_source.html#l01080">ast_queue_frame()</a>, <a class="el" href="channel_8h_source.html#l00633">AST_SOFTHANGUP_DEV</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="channel_8h_source.html#l00479">ast_channel::hangupcause</a>, and <a class="el" href="frame_8h_source.html#l00159">ast_frame::uint32</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l00332">__oh323_update_info()</a>, <a class="el" href="chan__sip_8c_source.html#l03932">__sip_autodestruct()</a>, <a class="el" href="chan__unistim_8c_source.html#l01968">close_call()</a>, <a class="el" href="chan__unistim_8c_source.html#l01107">close_client()</a>, <a class="el" href="chan__alsa_8c_source.html#l00741">console_hangup()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__sip_8c_source.html#l21024">handle_request_bye()</a>, <a class="el" href="chan__sip_8c_source.html#l18268">handle_response()</a>, <a class="el" href="chan__sip_8c_source.html#l17572">handle_response_invite()</a>, <a class="el" href="chan__sip_8c_source.html#l17893">handle_response_notify()</a>, <a class="el" href="chan__unistim_8c_source.html#l02351">HandleCallOutgoing()</a>, <a class="el" href="chan__misdn_8c_source.html#l03932">hangup_chan()</a>, <a class="el" href="chan__h323_8c_source.html#l02390">hangup_connection()</a>, <a class="el" href="chan__misdn_8c_source.html#l02539">misdn_answer()</a>, <a class="el" href="chan__sip_8c_source.html#l03727">retrans_pkt()</a>, and <a class="el" href="chan__unistim_8c_source.html#l02305">TransferCallStep1()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01104"></a>01104 {
<a name="l01105"></a>01105    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> <a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a> = { <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa7dac1c1896ab418c2ff351aae707fba">AST_CONTROL_HANGUP</a> };
<a name="l01106"></a>01106 
<a name="l01107"></a>01107    <span class="keywordflow">if</span> (<a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a> &gt;= 0)
<a name="l01108"></a>01108       f.<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#a5ad776be1fb768f3399aafcd1b58b3a2">uint32</a> = <a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>;
<a name="l01109"></a>01109 
<a name="l01110"></a>01110    <span class="comment">/* Yeah, let&apos;s not change a lock-critical value without locking */</span>
<a name="l01111"></a>01111    <span class="keywordflow">if</span> (!<a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(chan)) {
<a name="l01112"></a>01112       chan-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> |= <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709a2e185ce313026e13ed90ae3a319c9cb7">AST_SOFTHANGUP_DEV</a>;
<a name="l01113"></a>01113       <span class="keywordflow">if</span> (<a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a> &lt; 0)
<a name="l01114"></a>01114          f.<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#a5ad776be1fb768f3399aafcd1b58b3a2">uint32</a> = chan-&gt;<a class="code" href="structast__channel.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a>;
<a name="l01115"></a>01115 
<a name="l01116"></a>01116       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l01117"></a>01117    }
<a name="l01118"></a>01118 
<a name="l01119"></a>01119    <span class="keywordflow">return</span> <a class="code" href="channel_8h.html#a6cbcba5661d55216968cde8fdf913c89" title="Queue one or more frames to a channel&amp;#39;s frame queue.">ast_queue_frame</a>(chan, &amp;f);
<a name="l01120"></a>01120 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8b05a8419e1abb88ae5dde4070b6b7f6"></a><!-- doxytag: member="channel.c::ast_raw_answer" ref="a8b05a8419e1abb88ae5dde4070b6b7f6" args="(struct ast_channel *chan, int cdr_answer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_raw_answer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cdr_answer</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Answer a channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel to answer </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>cdr_answer</em>&nbsp;</td><td>flag to control whether any associated CDR should be marked as 'answered'</td></tr>
  </table>
  </dd>
</dl>
<p>This function answers a channel and handles all necessary call setup functions.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>The channel passed does not need to be locked, but is locked by the function when needed.</dd>
<dd>
Unlike <a class="el" href="channel_8h.html#aec583a3e25358ee552a4f3df53914cd0" title="Answer a channel.">ast_answer()</a>, this function will not wait for media flow to begin. The caller should be careful before sending media to the channel before incoming media arrives, as the <a class="el" href="structoutgoing.html">outgoing</a> media may be lost.</dd></dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>non-zero</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01799">1799</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="structast__channel__tech.html#adc338ee516cf6e54eb1c9791aa601757">ast_channel_tech::answer</a>, <a class="el" href="cdr_8c_source.html#l00687">ast_cdr_answer()</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="channel_8c_source.html#l00461">ast_check_hangup()</a>, <a class="el" href="channel_8h_source.html#l00543">AST_FLAG_OUTGOING</a>, <a class="el" href="channel_8h_source.html#l00529">AST_FLAG_ZOMBIE</a>, <a class="el" href="channel_8c_source.html#l03110">ast_indicate()</a>, <a class="el" href="channel_8c_source.html#l04695">ast_setstate()</a>, <a class="el" href="channel_8h_source.html#l00363">AST_STATE_RING</a>, <a class="el" href="channel_8h_source.html#l00364">AST_STATE_RINGING</a>, <a class="el" href="channel_8h_source.html#l00365">AST_STATE_UP</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="channel_8h_source.html#l00422">ast_channel::cdr</a>, <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>, and <a class="el" href="channel_8h_source.html#l00491">ast_channel::visible_indication</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l01850">__ast_answer()</a>, and <a class="el" href="features_8c_source.html#l02441">ast_bridge_call()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01800"></a>01800 {
<a name="l01801"></a>01801    <span class="keywordtype">int</span> res = 0;
<a name="l01802"></a>01802 
<a name="l01803"></a>01803    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l01804"></a>01804 
<a name="l01805"></a>01805    <span class="comment">/* You can&apos;t answer an outbound call */</span>
<a name="l01806"></a>01806    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a36fa77a64746637c77c6b18a7999d0a2">AST_FLAG_OUTGOING</a>)) {
<a name="l01807"></a>01807       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l01808"></a>01808       <span class="keywordflow">return</span> 0;
<a name="l01809"></a>01809    }
<a name="l01810"></a>01810 
<a name="l01811"></a>01811    <span class="comment">/* Stop if we&apos;re a zombie or need a soft hangup */</span>
<a name="l01812"></a>01812    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a26796fa52cc5857446eec8d16a4b718d">AST_FLAG_ZOMBIE</a>) || <a class="code" href="channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd" title="Check to see if a channel is needing hang up.">ast_check_hangup</a>(chan)) {
<a name="l01813"></a>01813       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l01814"></a>01814       <span class="keywordflow">return</span> -1;
<a name="l01815"></a>01815    }
<a name="l01816"></a>01816 
<a name="l01817"></a>01817    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l01818"></a>01818 
<a name="l01819"></a>01819    <span class="keywordflow">switch</span> (chan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>) {
<a name="l01820"></a>01820    <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>:
<a name="l01821"></a>01821    <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>:
<a name="l01822"></a>01822       <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l01823"></a>01823       <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#adc338ee516cf6e54eb1c9791aa601757" title="Answer the channel.">answer</a>) {
<a name="l01824"></a>01824          res = chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#adc338ee516cf6e54eb1c9791aa601757" title="Answer the channel.">answer</a>(chan);
<a name="l01825"></a>01825       }
<a name="l01826"></a>01826       <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(chan, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>);
<a name="l01827"></a>01827       <span class="keywordflow">if</span> (cdr_answer) {
<a name="l01828"></a>01828          <a class="code" href="cdr_8h.html#afec38ce5d72ac5bfda689d3a2c877012" title="Answer a call.">ast_cdr_answer</a>(chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>);
<a name="l01829"></a>01829       }
<a name="l01830"></a>01830       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l01831"></a>01831       <span class="keywordflow">break</span>;
<a name="l01832"></a>01832    <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>:
<a name="l01833"></a>01833       <span class="comment">/* Calling ast_cdr_answer when it it has previously been called</span>
<a name="l01834"></a>01834 <span class="comment">       * is essentially a no-op, so it is safe.</span>
<a name="l01835"></a>01835 <span class="comment">       */</span>
<a name="l01836"></a>01836       <span class="keywordflow">if</span> (cdr_answer) {
<a name="l01837"></a>01837          <a class="code" href="cdr_8h.html#afec38ce5d72ac5bfda689d3a2c877012" title="Answer a call.">ast_cdr_answer</a>(chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>);
<a name="l01838"></a>01838       }
<a name="l01839"></a>01839       <span class="keywordflow">break</span>;
<a name="l01840"></a>01840    <span class="keywordflow">default</span>:
<a name="l01841"></a>01841       <span class="keywordflow">break</span>;
<a name="l01842"></a>01842    }
<a name="l01843"></a>01843 
<a name="l01844"></a>01844    <a class="code" href="channel_8h.html#aef2af15a597c948e97628da6c5c84f28" title="Indicates condition of channel.">ast_indicate</a>(chan, -1);
<a name="l01845"></a>01845    chan-&gt;<a class="code" href="structast__channel.html#a5ad10add51120d9c9122eca4201dd645">visible_indication</a> = 0;
<a name="l01846"></a>01846 
<a name="l01847"></a>01847    <span class="keywordflow">return</span> res;
<a name="l01848"></a>01848 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7ef6737309dc9e8b6c4a7cb4800638b1"></a><!-- doxytag: member="channel.c::ast_read" ref="a7ef6737309dc9e8b6c4a7cb4800638b1" args="(struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__frame.html">ast_frame</a>* ast_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reads a frame. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel to read a frame from </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns a frame, or NULL on error. If it returns NULL, you best just stop reading frames and assume the channel has been disconnected. </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l03100">3100</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l02636">__ast_read()</a>.</p>

<p>Referenced by <a class="el" href="res__adsi_8c_source.html#l00193">__adsi_transmit_messages()</a>, <a class="el" href="channel_8c_source.html#l01850">__ast_answer()</a>, <a class="el" href="app_8c_source.html#l00668">__ast_play_and_record()</a>, <a class="el" href="channel_8c_source.html#l03851">__ast_request_and_dial()</a>, <a class="el" href="res__adsi_8c_source.html#l00117">adsi_careful_send()</a>, <a class="el" href="chan__agent_8c_source.html#l01028">agent_ack_sleep()</a>, <a class="el" href="chan__agent_8c_source.html#l00519">agent_read()</a>, <a class="el" href="bridging_8c_source.html#l00276">ast_bridge_handle_trip()</a>, <a class="el" href="channel_8c_source.html#l04776">ast_generic_bridge()</a>, <a class="el" href="channel_8c_source.html#l03275">ast_recvtext()</a>, <a class="el" href="channel_8c_source.html#l01328">ast_safe_sleep_conditional()</a>, <a class="el" href="channel_8c_source.html#l05467">ast_tonepair()</a>, <a class="el" href="udptl_8c_source.html#l01150">ast_udptl_bridge()</a>, <a class="el" href="channel_8c_source.html#l02438">ast_waitfordigit_full()</a>, <a class="el" href="pbx_8c_source.html#l07853">async_wait()</a>, <a class="el" href="autoservice_8c_source.html#l00073">autoservice_run()</a>, <a class="el" href="app__talkdetect_8c_source.html#l00076">background_detect_exec()</a>, <a class="el" href="rtp_8c_source.html#l03915">bridge_native_loop()</a>, <a class="el" href="rtp_8c_source.html#l04223">bridge_p2p_loop()</a>, <a class="el" href="features_8c_source.html#l01396">builtin_atxfer()</a>, <a class="el" href="app__chanspy_8c_source.html#l00445">channel_spy()</a>, <a class="el" href="features_8c_source.html#l00366">check_goto_on_transfer()</a>, <a class="el" href="app__dahdiscan_8c_source.html#l00290">conf_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l01617">conf_flush()</a>, <a class="el" href="app__dahdibarge_8c_source.html#l00095">conf_run()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05156">dahdi_bridge()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="app__dictate_8c_source.html#l00084">dictate_exec()</a>, <a class="el" href="app__disa_8c_source.html#l00143">disa_exec()</a>, <a class="el" href="app__waitforsilence_8c_source.html#l00125">do_waiting()</a>, <a class="el" href="app__echo_8c_source.html#l00051">echo_exec()</a>, <a class="el" href="app__externalivr_8c_source.html#l00521">eivr_comm()</a>, <a class="el" href="features_8c_source.html#l02152">feature_request_and_dial()</a>, <a class="el" href="chan__iax2_8c_source.html#l13074">find_cache()</a>, <a class="el" href="res__agi_8c_source.html#l01494">handle_recordfile()</a>, <a class="el" href="res__agi_8c_source.html#l02137">handle_speechrecognize()</a>, <a class="el" href="chan__iax2_8c_source.html#l05170">iax2_bridge()</a>, <a class="el" href="chan__iax2_8c_source.html#l08921">iax_park_thread()</a>, <a class="el" href="app__ices_8c_source.html#l00107">ices_exec()</a>, <a class="el" href="app__amd_8c_source.html#l00146">isAnsweringMachine()</a>, <a class="el" href="app__jack_8c_source.html#l00743">jack_exec()</a>, <a class="el" href="res__agi_8c_source.html#l00617">launch_asyncagi()</a>, <a class="el" href="features_8c_source.html#l03009">manage_parkinglot()</a>, <a class="el" href="features_8c_source.html#l00833">masq_park_call()</a>, <a class="el" href="app__test_8c_source.html#l00080">measurenoise()</a>, <a class="el" href="chan__misdn_8c_source.html#l03228">misdn_bridge()</a>, <a class="el" href="dial_8c_source.html#l00535">monitor_dial()</a>, <a class="el" href="app__mp3_8c_source.html#l00120">mp3_exec()</a>, <a class="el" href="app__nbscat_8c_source.html#l00108">NBScat_exec()</a>, <a class="el" href="app__alarmreceiver_8c_source.html#l00232">receive_dtmf_digits()</a>, <a class="el" href="app__record_8c_source.html#l00132">record_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l04359">recordthread()</a>, <a class="el" href="app__rpt_8c_source.html#l10730">rpt()</a>, <a class="el" href="app__rpt_8c_source.html#l13122">rpt_exec()</a>, <a class="el" href="res__agi_8c_source.html#l02853">run_agi()</a>, <a class="el" href="app__alarmreceiver_8c_source.html#l00167">send_tone_burst()</a>, <a class="el" href="app__festival_8c_source.html#l00161">send_waveform_to_channel()</a>, <a class="el" href="app__url_8c_source.html#l00093">sendurl_exec()</a>, <a class="el" href="app__speech__utils_8c_source.html#l00639">speech_background()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>, <a class="el" href="app__fax_8c_source.html#l00362">transmit_audio()</a>, <a class="el" href="app__fax_8c_source.html#l00599">transmit_t38()</a>, <a class="el" href="app__dial_8c_source.html#l00818">wait_for_answer()</a>, <a class="el" href="pbx_8c_source.html#l08422">wait_for_hangup()</a>, <a class="el" href="app__followme_8c_source.html#l00509">wait_for_winner()</a>, <a class="el" href="app__waitforring_8c_source.html#l00056">waitforring_exec()</a>, and <a class="el" href="file_8c_source.html#l01168">waitstream_core()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03101"></a>03101 {
<a name="l03102"></a>03102    <span class="keywordflow">return</span> <a class="code" href="channel_8c.html#a69a66588107e52e682f046d05898ff43">__ast_read</a>(chan, 0);
<a name="l03103"></a>03103 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a34c65699645170a1168e9177ad8aebd4"></a><!-- doxytag: member="channel.c::ast_read_generator_actions" ref="a34c65699645170a1168e9177ad8aebd4" args="(struct ast_channel *chan, struct ast_frame *f)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ast_read_generator_actions </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td>
          <td class="paramname"> <em>f</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l02530">2530</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="channel_8c_source.html#l01956">ast_deactivate_generator()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8h_source.html#l00680">ast_format_rate()</a>, <a class="el" href="frame_8h_source.html#l00118">AST_FRAME_CNG</a>, <a class="el" href="channel_8c_source.html#l03093">ast_internal_timing_enabled()</a>, <a class="el" href="channel_8c_source.html#l02405">ast_settimeout()</a>, <a class="el" href="frame_8h_source.html#l00147">ast_frame::datalen</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="structast__generator.html#a92f5f90f97b5e9124c843b5e81d8b53a">ast_generator::generate</a>, <a class="el" href="channel_8h_source.html#l00404">ast_channel::generator</a>, <a class="el" href="channel_8c_source.html#l01971">generator_force()</a>, <a class="el" href="channel_8h_source.html#l00403">ast_channel::generatordata</a>, <a class="el" href="frame_8h_source.html#l00149">ast_frame::samples</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, <a class="el" href="channel_8h_source.html#l00468">ast_channel::timingfd</a>, <a class="el" href="structast__channel.html#a66e8b9811d596825d60c6a58e0b307a4">ast_channel::timingfunc</a>, and <a class="el" href="channel_8h_source.html#l00484">ast_channel::writeformat</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l02636">__ast_read()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02531"></a>02531 {
<a name="l02532"></a>02532    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a4e855ab0f984741b9083b2c5a0fdfe18">generator</a> &amp;&amp; chan-&gt;<a class="code" href="structast__channel.html#a4e855ab0f984741b9083b2c5a0fdfe18">generator</a>-&gt;<a class="code" href="structast__generator.html#a92f5f90f97b5e9124c843b5e81d8b53a">generate</a> &amp;&amp; chan-&gt;<a class="code" href="structast__channel.html#abe7876f86e249ea3db5fbacd2231389c">generatordata</a> &amp;&amp;  !<a class="code" href="channel_8h.html#a99a8df1071a8de39465245afc8ac6af7" title="Check if the channel can run in internal timing mode.">ast_internal_timing_enabled</a>(chan)) {
<a name="l02533"></a>02533       <span class="keywordtype">void</span> *tmp = chan-&gt;<a class="code" href="structast__channel.html#abe7876f86e249ea3db5fbacd2231389c">generatordata</a>;
<a name="l02534"></a>02534       int (*generate)(<span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *chan, <span class="keywordtype">void</span> *tmp, <span class="keywordtype">int</span> datalen, <span class="keywordtype">int</span> samples) = chan-&gt;<a class="code" href="structast__channel.html#a4e855ab0f984741b9083b2c5a0fdfe18">generator</a>-&gt;<a class="code" href="structast__generator.html#a92f5f90f97b5e9124c843b5e81d8b53a">generate</a>;
<a name="l02535"></a>02535       <span class="keywordtype">int</span> res;
<a name="l02536"></a>02536       <span class="keywordtype">int</span> samples;
<a name="l02537"></a>02537 
<a name="l02538"></a>02538       if (chan-&gt;<a class="code" href="structast__channel.html#a66e8b9811d596825d60c6a58e0b307a4">timingfunc</a>) {
<a name="l02539"></a>02539          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Generator got voice, switching to phase locked mode\n&quot;</span>);
<a name="l02540"></a>02540          <a class="code" href="channel_8h.html#abb39926813ff8874f8e453ca04307e53" title="Enable or disable timer ticks for a channel.">ast_settimeout</a>(chan, 0, NULL, NULL);
<a name="l02541"></a>02541       }
<a name="l02542"></a>02542 
<a name="l02543"></a>02543       chan-&gt;<a class="code" href="structast__channel.html#abe7876f86e249ea3db5fbacd2231389c">generatordata</a> = NULL;     <span class="comment">/* reset, to let writes go through */</span>
<a name="l02544"></a>02544 
<a name="l02545"></a>02545       <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> != chan-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a>) {
<a name="l02546"></a>02546          <span class="keywordtype">float</span> factor;
<a name="l02547"></a>02547          factor = ((float) <a class="code" href="frame_8h.html#a29a7b93f4295966d4d441e91bff2b01e" title="Get the sample rate for a given format.">ast_format_rate</a>(chan-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a>)) / ((<span class="keywordtype">float</span>) <a class="code" href="frame_8h.html#a29a7b93f4295966d4d441e91bff2b01e" title="Get the sample rate for a given format.">ast_format_rate</a>(f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>));
<a name="l02548"></a>02548          samples = (int) ( ((<span class="keywordtype">float</span>) f-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>) * factor );
<a name="l02549"></a>02549       } <span class="keywordflow">else</span> {
<a name="l02550"></a>02550          samples = f-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>;
<a name="l02551"></a>02551       }
<a name="l02552"></a>02552       
<a name="l02553"></a>02553       <span class="comment">/* This unlock is here based on two assumptions that hold true at this point in the</span>
<a name="l02554"></a>02554 <span class="comment">       * code. 1) this function is only called from within __ast_read() and 2) all generators</span>
<a name="l02555"></a>02555 <span class="comment">       * call ast_write() in their generate callback.</span>
<a name="l02556"></a>02556 <span class="comment">       *</span>
<a name="l02557"></a>02557 <span class="comment">       * The reason this is added is so that when ast_write is called, the lock that occurs </span>
<a name="l02558"></a>02558 <span class="comment">       * there will not recursively lock the channel. Doing this will cause intended deadlock </span>
<a name="l02559"></a>02559 <span class="comment">       * avoidance not to work in deeper functions</span>
<a name="l02560"></a>02560 <span class="comment">       */</span>
<a name="l02561"></a>02561       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l02562"></a>02562       res = generate(chan, tmp, f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>, samples);
<a name="l02563"></a>02563       <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l02564"></a>02564       chan-&gt;<a class="code" href="structast__channel.html#abe7876f86e249ea3db5fbacd2231389c">generatordata</a> = tmp;
<a name="l02565"></a>02565       <span class="keywordflow">if</span> (res) {
<a name="l02566"></a>02566          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Auto-deactivating generator\n&quot;</span>);
<a name="l02567"></a>02567          <a class="code" href="channel_8h.html#a7160355005776732fba88cc020f4a45b">ast_deactivate_generator</a>(chan);
<a name="l02568"></a>02568       }
<a name="l02569"></a>02569 
<a name="l02570"></a>02570    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a8089c2a7198a1063db9e6c3f904482a4">AST_FRAME_CNG</a>) {
<a name="l02571"></a>02571       <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a4e855ab0f984741b9083b2c5a0fdfe18">generator</a> &amp;&amp; !chan-&gt;<a class="code" href="structast__channel.html#a66e8b9811d596825d60c6a58e0b307a4">timingfunc</a> &amp;&amp; (chan-&gt;<a class="code" href="structast__channel.html#a31160ea68032ecf93ec55a3127edd2f9">timingfd</a> &gt; -1)) {
<a name="l02572"></a>02572          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Generator got CNG, switching to timed mode\n&quot;</span>);
<a name="l02573"></a>02573          <a class="code" href="channel_8h.html#abb39926813ff8874f8e453ca04307e53" title="Enable or disable timer ticks for a channel.">ast_settimeout</a>(chan, 50, <a class="code" href="channel_8c.html#a99698cbdfd9c1a86f36e0a226076e69f">generator_force</a>, chan);
<a name="l02574"></a>02574       }
<a name="l02575"></a>02575    }
<a name="l02576"></a>02576 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1950f7fe77c02d233de02d299bab8c15"></a><!-- doxytag: member="channel.c::ast_read_noaudio" ref="a1950f7fe77c02d233de02d299bab8c15" args="(struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__frame.html">ast_frame</a>* ast_read_noaudio </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reads a frame, returning AST_FRAME_NULL frame if audio. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel to read a frame from </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns a frame, or NULL on error. If it returns NULL, you best just stop reading frames and assume the channel has been disconnected. </dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>Audio is replaced with AST_FRAME_NULL to avoid transcode when the resulting audio is not necessary. </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l03105">3105</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l02636">__ast_read()</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l00276">ast_bridge_handle_trip()</a>, and <a class="el" href="app__meetme_8c_source.html#l01998">conf_run()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03106"></a>03106 {
<a name="l03107"></a>03107    <span class="keywordflow">return</span> <a class="code" href="channel_8c.html#a69a66588107e52e682f046d05898ff43">__ast_read</a>(chan, 1);
<a name="l03108"></a>03108 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2ead08f6d731f739b40787f79d2a64ef"></a><!-- doxytag: member="channel.c::ast_readstring" ref="a2ead08f6d731f739b40787f79d2a64ef" args="(struct ast_channel *c, char *s, int len, int timeout, int ftimeout, char *enders)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_readstring </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>timeout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>rtimeout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>enders</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Reads multiple digits </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c</em>&nbsp;</td><td>channel to read from </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>s</em>&nbsp;</td><td>string to read in to. Must be at least the size of your length </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>len</em>&nbsp;</td><td>how many digits to read (maximum) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>timeout</em>&nbsp;</td><td>how long to timeout between digits </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>rtimeout</em>&nbsp;</td><td>timeout to wait on the first digit </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>enders</em>&nbsp;</td><td>digits to end the string Read in a digit string "s", max length "len", maximum timeout between digits "timeout" (-1 for none), terminated by anything in "enders". Give them rtimeout for the first digit. Returns 0 on normal return, or 1 on a timeout. In the case of a timeout, any digits that were read before the timeout will still be available in s. RETURNS 2 in full version when ctrlfd is available, NOT 1 </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l04088">4088</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l04093">ast_readstring_full()</a>.</p>

<p>Referenced by <a class="el" href="res__adsi_8c_source.html#l00193">__adsi_transmit_messages()</a>, <a class="el" href="res__adsi_8c_source.html#l00309">_ast_adsi_begin_download()</a>, <a class="el" href="res__adsi_8c_source.html#l00615">_ast_adsi_get_cpeinfo()</a>, <a class="el" href="res__adsi_8c_source.html#l00934">_ast_adsi_load_session()</a>, <a class="el" href="app_8c_source.html#l00130">ast_app_getdata()</a>, <a class="el" href="app__voicemail_8c_source.html#l11344">dialout()</a>, <a class="el" href="app__directory_8c_source.html#l00646">do_directory()</a>, <a class="el" href="app__voicemail_8c_source.html#l06582">forward_message()</a>, <a class="el" href="app__privacy_8c_source.html#l00083">privacy_exec()</a>, <a class="el" href="app__voicemail_8c_source.html#l08999">vm_authenticate()</a>, <a class="el" href="app__voicemail_8c_source.html#l08493">vm_newuser()</a>, and <a class="el" href="app__voicemail_8c_source.html#l08588">vm_options()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04089"></a>04089 {
<a name="l04090"></a>04090    <span class="keywordflow">return</span> <a class="code" href="channel_8h.html#a1d7f4bf19db3f1b8a3524593f002fedf">ast_readstring_full</a>(c, <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, timeout, ftimeout, enders, -1, -1);
<a name="l04091"></a>04091 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4029626a4c61de707ff021b7af7c3767"></a><!-- doxytag: member="channel.c::ast_readstring_full" ref="a4029626a4c61de707ff021b7af7c3767" args="(struct ast_channel *c, char *s, int len, int timeout, int ftimeout, char *enders, int audiofd, int ctrlfd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_readstring_full </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>timeout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ftimeout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>enders</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>audiofd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ctrlfd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l04093">4093</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l00461">ast_check_hangup()</a>, <a class="el" href="file_8h_source.html#l00047">AST_DIGIT_ANY</a>, <a class="el" href="channel_8h_source.html#l00529">AST_FLAG_ZOMBIE</a>, <a class="el" href="app_8h_source.html#l00262">AST_GETDATA_COMPLETE</a>, <a class="el" href="app_8h_source.html#l00267">AST_GETDATA_EMPTY_END_TERMINATED</a>, <a class="el" href="app_8h_source.html#l00261">AST_GETDATA_FAILED</a>, <a class="el" href="app_8h_source.html#l00264">AST_GETDATA_INTERRUPTED</a>, <a class="el" href="app_8h_source.html#l00263">AST_GETDATA_TIMEOUT</a>, <a class="el" href="file_8c_source.html#l00122">ast_stopstream()</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="channel_8c_source.html#l02438">ast_waitfordigit_full()</a>, <a class="el" href="file_8c_source.html#l01320">ast_waitstream_full()</a>, and <a class="el" href="channel_8h_source.html#l00414">ast_channel::stream</a>.</p>

<p>Referenced by <a class="el" href="app_8c_source.html#l00183">ast_app_getdata_full()</a>, and <a class="el" href="channel_8c_source.html#l04088">ast_readstring()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04094"></a>04094 {
<a name="l04095"></a>04095    <span class="keywordtype">int</span> pos = 0;   <span class="comment">/* index in the buffer where we accumulate digits */</span>
<a name="l04096"></a>04096    <span class="keywordtype">int</span> to = ftimeout;
<a name="l04097"></a>04097 
<a name="l04098"></a>04098    <span class="comment">/* Stop if we&apos;re a zombie or need a soft hangup */</span>
<a name="l04099"></a>04099    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(c, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a26796fa52cc5857446eec8d16a4b718d">AST_FLAG_ZOMBIE</a>) || <a class="code" href="channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd" title="Check to see if a channel is needing hang up.">ast_check_hangup</a>(c))
<a name="l04100"></a>04100       <span class="keywordflow">return</span> -1;
<a name="l04101"></a>04101    <span class="keywordflow">if</span> (!<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>)
<a name="l04102"></a>04102       <span class="keywordflow">return</span> -1;
<a name="l04103"></a>04103    <span class="keywordflow">for</span> (;;) {
<a name="l04104"></a>04104       <span class="keywordtype">int</span> d;
<a name="l04105"></a>04105       <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structast__channel.html#a016ccfa2a88444ffde0ad0168a0f231d">stream</a>) {
<a name="l04106"></a>04106          d = <a class="code" href="file_8h.html#a3089874cd5223053f670c8499e911ec4">ast_waitstream_full</a>(c, <a class="code" href="file_8h.html#afa92b0106fb7a918ea994c2867ac0a04">AST_DIGIT_ANY</a>, audiofd, ctrlfd);
<a name="l04107"></a>04107          <a class="code" href="file_8h.html#a3092bf11d4bba66f646562759608b1bc" title="Stops a stream.">ast_stopstream</a>(c);
<a name="l04108"></a>04108          usleep(1000);
<a name="l04109"></a>04109          <span class="keywordflow">if</span> (!d)
<a name="l04110"></a>04110             d = <a class="code" href="channel_8h.html#af4725a9cfbacf4db094408fe1406f0ef" title="Wait for a digit Same as ast_waitfordigit() with audio fd for outputting read audio...">ast_waitfordigit_full</a>(c, to, audiofd, ctrlfd);
<a name="l04111"></a>04111       } <span class="keywordflow">else</span> {
<a name="l04112"></a>04112          d = <a class="code" href="channel_8h.html#af4725a9cfbacf4db094408fe1406f0ef" title="Wait for a digit Same as ast_waitfordigit() with audio fd for outputting read audio...">ast_waitfordigit_full</a>(c, to, audiofd, ctrlfd);
<a name="l04113"></a>04113       }
<a name="l04114"></a>04114       <span class="keywordflow">if</span> (d &lt; 0)
<a name="l04115"></a>04115          <span class="keywordflow">return</span> <a class="code" href="app_8h.html#a10624bc470a4ac2634221dfa74bdb17fa447a1a659574cde67aa71538c804206f">AST_GETDATA_FAILED</a>;
<a name="l04116"></a>04116       <span class="keywordflow">if</span> (d == 0) {
<a name="l04117"></a>04117          <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>[pos] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l04118"></a>04118          <span class="keywordflow">return</span> <a class="code" href="app_8h.html#a10624bc470a4ac2634221dfa74bdb17fa79554349b620ac61794e76cb70eef322">AST_GETDATA_TIMEOUT</a>;
<a name="l04119"></a>04119       }
<a name="l04120"></a>04120       <span class="keywordflow">if</span> (d == 1) {
<a name="l04121"></a>04121          <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>[pos] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l04122"></a>04122          <span class="keywordflow">return</span> <a class="code" href="app_8h.html#a10624bc470a4ac2634221dfa74bdb17fa74b94669f324ba10f5bfb979f54e636c">AST_GETDATA_INTERRUPTED</a>;
<a name="l04123"></a>04123       }
<a name="l04124"></a>04124       <span class="keywordflow">if</span> (strchr(enders, d) &amp;&amp; (pos == 0)) {
<a name="l04125"></a>04125          <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>[pos] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l04126"></a>04126          <span class="keywordflow">return</span> <a class="code" href="app_8h.html#a10624bc470a4ac2634221dfa74bdb17fa94425459ee6ac7993c6289fde4d4ea8c">AST_GETDATA_EMPTY_END_TERMINATED</a>;
<a name="l04127"></a>04127       }
<a name="l04128"></a>04128       <span class="keywordflow">if</span> (!strchr(enders, d)) {
<a name="l04129"></a>04129          <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>[pos++] = d;
<a name="l04130"></a>04130       }
<a name="l04131"></a>04131       <span class="keywordflow">if</span> (strchr(enders, d) || (pos &gt;= <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>)) {
<a name="l04132"></a>04132          <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>[pos] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l04133"></a>04133          <span class="keywordflow">return</span> <a class="code" href="app_8h.html#a10624bc470a4ac2634221dfa74bdb17fa76a0cf0f0ca1c3000e227686d7de7d9c">AST_GETDATA_COMPLETE</a>;
<a name="l04134"></a>04134       }
<a name="l04135"></a>04135       to = timeout;
<a name="l04136"></a>04136    }
<a name="l04137"></a>04137    <span class="comment">/* Never reached */</span>
<a name="l04138"></a>04138    <span class="keywordflow">return</span> 0;
<a name="l04139"></a>04139 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5d6470615a8701722e9d3c6c6fca01d0"></a><!-- doxytag: member="channel.c::ast_recvchar" ref="a5d6470615a8701722e9d3c6c6fca01d0" args="(struct ast_channel *chan, int timeout)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_recvchar </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>timeout</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Receives a text character from a channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel to act upon </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>timeout</em>&nbsp;</td><td>timeout in milliseconds (0 for infinite wait) Read a char of text from a channel Returns 0 on success, -1 on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l03264">3264</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, and <a class="el" href="channel_8c_source.html#l03275">ast_recvtext()</a>.</p>

<p>Referenced by <a class="el" href="res__agi_8c_source.html#l01073">handle_recvchar()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03265"></a>03265 {
<a name="l03266"></a>03266    <span class="keywordtype">int</span> c;
<a name="l03267"></a>03267    <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a> = <a class="code" href="channel_8h.html#abb507e6b148bf773fb546ac5c931f264" title="Receives a text string from a channel Read a string of text from a channel.">ast_recvtext</a>(chan, timeout);
<a name="l03268"></a>03268    <span class="keywordflow">if</span> (buf == NULL)
<a name="l03269"></a>03269       <span class="keywordflow">return</span> -1;  <span class="comment">/* error or timeout */</span>
<a name="l03270"></a>03270    c = *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)buf;
<a name="l03271"></a>03271    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(buf);
<a name="l03272"></a>03272    <span class="keywordflow">return</span> c;
<a name="l03273"></a>03273 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abb507e6b148bf773fb546ac5c931f264"></a><!-- doxytag: member="channel.c::ast_recvtext" ref="abb507e6b148bf773fb546ac5c931f264" args="(struct ast_channel *chan, int timeout)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* ast_recvtext </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>timeout</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Receives a text string from a channel Read a string of text from a channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel to act upon </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>timeout</em>&nbsp;</td><td>timeout in milliseconds (0 for infinite wait) </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the received text, or NULL to signify failure. </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l03275">3275</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l00461">ast_check_hangup()</a>, <a class="el" href="frame_8h_source.html#l00298">AST_CONTROL_HANGUP</a>, <a class="el" href="frame_8h_source.html#l00105">AST_FRAME_CONTROL</a>, <a class="el" href="frame_8h_source.html#l00111">AST_FRAME_TEXT</a>, <a class="el" href="frame_8h_source.html#l00462">ast_frfree</a>, <a class="el" href="channel_8c_source.html#l03100">ast_read()</a>, <a class="el" href="astmm_8h_source.html#l00105">ast_strndup</a>, <a class="el" href="channel_8c_source.html#l02389">ast_waitfor()</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="frame_8h_source.html#l00147">ast_frame::datalen</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::ptr</a>, and <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l03264">ast_recvchar()</a>, and <a class="el" href="res__agi_8c_source.html#l01093">handle_recvtext()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03276"></a>03276 {
<a name="l03277"></a>03277    <span class="keywordtype">int</span> res, done = 0;
<a name="l03278"></a>03278    <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a> = NULL;
<a name="l03279"></a>03279    
<a name="l03280"></a>03280    <span class="keywordflow">while</span> (!done) {
<a name="l03281"></a>03281       <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l03282"></a>03282       <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd" title="Check to see if a channel is needing hang up.">ast_check_hangup</a>(chan))
<a name="l03283"></a>03283          <span class="keywordflow">break</span>;
<a name="l03284"></a>03284       res = <a class="code" href="channel_8h.html#a60e0bcaed001e8d5ed1ba0eb2644b3cc" title="Wait for input on a channel.">ast_waitfor</a>(chan, timeout);
<a name="l03285"></a>03285       <span class="keywordflow">if</span> (res &lt;= 0) <span class="comment">/* timeout or error */</span>
<a name="l03286"></a>03286          <span class="keywordflow">break</span>;
<a name="l03287"></a>03287       timeout = res; <span class="comment">/* update timeout */</span>
<a name="l03288"></a>03288       f = <a class="code" href="channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1" title="Reads a frame.">ast_read</a>(chan);
<a name="l03289"></a>03289       <span class="keywordflow">if</span> (f == NULL)
<a name="l03290"></a>03290          <span class="keywordflow">break</span>; <span class="comment">/* no frame */</span>
<a name="l03291"></a>03291       <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a> &amp;&amp; f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> == <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa7dac1c1896ab418c2ff351aae707fba">AST_CONTROL_HANGUP</a>)
<a name="l03292"></a>03292          done = 1;   <span class="comment">/* force a break */</span>
<a name="l03293"></a>03293       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0af7728b18670d3cd075f63d67f8867078">AST_FRAME_TEXT</a>) {      <span class="comment">/* what we want */</span>
<a name="l03294"></a>03294          buf = <a class="code" href="astmm_8h.html#a58d3db2bcf78df0ea59320b54ad1193e">ast_strndup</a>((<span class="keywordtype">char</span> *) f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>);  <span class="comment">/* dup and break */</span>
<a name="l03295"></a>03295          done = 1;
<a name="l03296"></a>03296       }
<a name="l03297"></a>03297       <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l03298"></a>03298    }
<a name="l03299"></a>03299    <span class="keywordflow">return</span> buf;
<a name="l03300"></a>03300 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a66276b870fd0d51036df96395f48b570"></a><!-- doxytag: member="channel.c::ast_request" ref="a66276b870fd0d51036df96395f48b570" args="(const char *type, int format, void *data, int *cause)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__channel.html">ast_channel</a>* ast_request </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>status</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Requests a channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>type</em>&nbsp;</td><td>type of channel to request </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>format</em>&nbsp;</td><td>requested channel format (codec) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>data to pass to the channel requester </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>status</em>&nbsp;</td><td>status</td></tr>
  </table>
  </dd>
</dl>
<p>Request a channel of a given type, with data as optional information used by the low level module</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>NULL</em>&nbsp;</td><td>failure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>non-NULL</em>&nbsp;</td><td>channel on success </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l03986">3986</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="causes_8h_source.html#l00125">AST_CAUSE_BEARERCAPABILITY_NOTAVAIL</a>, <a class="el" href="causes_8h_source.html#l00154">AST_CAUSE_NOSUCHDRIVER</a>, <a class="el" href="causes_8h_source.html#l00153">AST_CAUSE_NOTDEFINED</a>, <a class="el" href="frame_8h_source.html#l00273">AST_FORMAT_AUDIO_MASK</a>, <a class="el" href="frame_8h_source.html#l00295">AST_FORMAT_TEXT_MASK</a>, <a class="el" href="frame_8h_source.html#l00288">AST_FORMAT_VIDEO_MASK</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="linkedlists_8h_source.html#l00077">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="translate_8c_source.html#l00761">ast_translator_best_choice()</a>, <a class="el" href="channel_8h_source.html#l00229">ast_channel_tech::capabilities</a>, <a class="el" href="res__jabber_8c_source.html#l00247">capabilities</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="structast__channel__tech.html#a2a14b7f2ce664a07c04072d2cecb5be4">ast_channel_tech::requester</a>, <a class="el" href="channel_8c_source.html#l00104">chanlist::tech</a>, and <a class="el" href="channel_8h_source.html#l00226">ast_channel_tech::type</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l03851">__ast_request_and_dial()</a>, <a class="el" href="chan__agent_8c_source.html#l01452">agent_request()</a>, <a class="el" href="channel_8c_source.html#l03779">ast_call_forward()</a>, <a class="el" href="app__rpt_8c_source.html#l10335">attempt_reconnect()</a>, <a class="el" href="dial_8c_source.html#l00255">begin_dial_channel()</a>, <a class="el" href="app__meetme_8c_source.html#l01061">build_conf()</a>, <a class="el" href="app__chanisavail_8c_source.html#l00097">chanavail_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l01998">conf_run()</a>, <a class="el" href="app__rpt_8c_source.html#l05678">connect_link()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="bridge__builtin__features_8c_source.html#l00068">dial_transfer()</a>, <a class="el" href="app__dial_8c_source.html#l00712">do_forward()</a>, <a class="el" href="features_8c_source.html#l02152">feature_request_and_dial()</a>, <a class="el" href="app__followme_8c_source.html#l00777">findmeexec()</a>, <a class="el" href="app__confbridge_8c_source.html#l00554">play_sound_file()</a>, <a class="el" href="app__queue_8c_source.html#l02467">ring_entry()</a>, <a class="el" href="app__rpt_8c_source.html#l10730">rpt()</a>, <a class="el" href="app__rpt_8c_source.html#l05280">rpt_call()</a>, <a class="el" href="app__rpt_8c_source.html#l13122">rpt_exec()</a>, <a class="el" href="app__rpt_8c_source.html#l03937">rpt_tele_thread()</a>, and <a class="el" href="app__queue_8c_source.html#l02845">wait_for_answer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03987"></a>03987 {
<a name="l03988"></a>03988    <span class="keyword">struct </span><a class="code" href="structchanlist.html" title="List of channel drivers.">chanlist</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>;
<a name="l03989"></a>03989    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c;
<a name="l03990"></a>03990    <span class="keywordtype">int</span> <a class="code" href="res__jabber_8c.html#aa7afd7ba4814dbf49b1867019891fd14">capabilities</a>;
<a name="l03991"></a>03991    <span class="keywordtype">int</span> fmt;
<a name="l03992"></a>03992    <span class="keywordtype">int</span> res;
<a name="l03993"></a>03993    <span class="keywordtype">int</span> foo;
<a name="l03994"></a>03994    <span class="keywordtype">int</span> videoformat = <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a> &amp; <a class="code" href="frame_8h.html#ad048231af8a6271706585e3c8630dc69">AST_FORMAT_VIDEO_MASK</a>;
<a name="l03995"></a>03995    <span class="keywordtype">int</span> textformat = <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a> &amp; <a class="code" href="frame_8h.html#a40d5a53729402277e268d8b35b7ffaa5">AST_FORMAT_TEXT_MASK</a>;
<a name="l03996"></a>03996 
<a name="l03997"></a>03997    <span class="keywordflow">if</span> (!<a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>)
<a name="l03998"></a>03998       <a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a> = &amp;foo;
<a name="l03999"></a>03999    *<a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a> = <a class="code" href="causes_8h.html#a9462c5c03560a909199202e6e2dbad3f">AST_CAUSE_NOTDEFINED</a>;
<a name="l04000"></a>04000 
<a name="l04001"></a>04001    <span class="keywordflow">if</span> (<a class="code" href="linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc" title="Read locks a list.">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>)) {
<a name="l04002"></a>04002       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to lock channel list\n&quot;</span>);
<a name="l04003"></a>04003       <span class="keywordflow">return</span> NULL;
<a name="l04004"></a>04004    }
<a name="l04005"></a>04005 
<a name="l04006"></a>04006    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="structbackends.html" title="the list of registered channel types">backends</a>, chan, list) {
<a name="l04007"></a>04007       <span class="keywordflow">if</span> (strcasecmp(<a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, chan-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>))
<a name="l04008"></a>04008          <span class="keywordflow">continue</span>;
<a name="l04009"></a>04009 
<a name="l04010"></a>04010       capabilities = chan-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a9461ee266923070466f95a76158f65cd">capabilities</a>;
<a name="l04011"></a>04011       fmt = <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a> &amp; <a class="code" href="frame_8h.html#a3f680b9c15596de927d507a664fd2803">AST_FORMAT_AUDIO_MASK</a>;
<a name="l04012"></a>04012       <span class="keywordflow">if</span> (fmt) {
<a name="l04013"></a>04013          <span class="comment">/* We have audio - is it possible to connect the various calls to each other? </span>
<a name="l04014"></a>04014 <span class="comment">            (Avoid this check for calls without audio, like text+video calls)</span>
<a name="l04015"></a>04015 <span class="comment">         */</span>
<a name="l04016"></a>04016          res = <a class="code" href="translate_8h.html#a09ac24ad5b3c1e1cee3d294556458e36" title="Chooses the best translation path.">ast_translator_best_choice</a>(&amp;fmt, &amp;capabilities);
<a name="l04017"></a>04017          <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l04018"></a>04018             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No translator path exists for channel type %s (native 0x%x) to 0x%x\n&quot;</span>, <a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, chan-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a9461ee266923070466f95a76158f65cd">capabilities</a>, <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>);
<a name="l04019"></a>04019             *<a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a> = <a class="code" href="causes_8h.html#a208e4fc34932b91fc9e90d9008329e87">AST_CAUSE_BEARERCAPABILITY_NOTAVAIL</a>;
<a name="l04020"></a>04020             <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>);
<a name="l04021"></a>04021             <span class="keywordflow">return</span> NULL;
<a name="l04022"></a>04022          }
<a name="l04023"></a>04023       }
<a name="l04024"></a>04024       <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>);
<a name="l04025"></a>04025       <span class="keywordflow">if</span> (!chan-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a2a14b7f2ce664a07c04072d2cecb5be4" title="Requester - to set up call data structures (pvt&amp;#39;s).">requester</a>)
<a name="l04026"></a>04026          <span class="keywordflow">return</span> NULL;
<a name="l04027"></a>04027       
<a name="l04028"></a>04028       <span class="keywordflow">if</span> (!(c = chan-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a2a14b7f2ce664a07c04072d2cecb5be4" title="Requester - to set up call data structures (pvt&amp;#39;s).">requester</a>(<a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, capabilities | videoformat | textformat, <a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>, <a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>)))
<a name="l04029"></a>04029          <span class="keywordflow">return</span> NULL;
<a name="l04030"></a>04030       
<a name="l04031"></a>04031       <span class="comment">/* no need to generate a Newchannel event here; it is done in the channel_alloc call */</span>
<a name="l04032"></a>04032       <span class="keywordflow">return</span> c;
<a name="l04033"></a>04033    }
<a name="l04034"></a>04034 
<a name="l04035"></a>04035    <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No channel type registered for &apos;%s&apos;\n&quot;</span>, <a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>);
<a name="l04036"></a>04036    *<a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a> = <a class="code" href="causes_8h.html#abad444ced4d61293c95114d7104d204c">AST_CAUSE_NOSUCHDRIVER</a>;
<a name="l04037"></a>04037    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>);
<a name="l04038"></a>04038 
<a name="l04039"></a>04039    <span class="keywordflow">return</span> NULL;
<a name="l04040"></a>04040 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abe0059a0c11d07e32164a53badaeb9ee"></a><!-- doxytag: member="channel.c::ast_request_and_dial" ref="abe0059a0c11d07e32164a53badaeb9ee" args="(const char *type, int format, void *data, int timeout, int *outstate, const char *cidnum, const char *cidname)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__channel.html">ast_channel</a>* ast_request_and_dial </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>timeout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>reason</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>cid_num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>cid_name</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Request a channel of a given type, with data as optional information used by the low level module and attempt to place a call on it. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>type</em>&nbsp;</td><td>type of channel to request </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>format</em>&nbsp;</td><td>requested channel format </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>data to pass to the channel requester </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>timeout</em>&nbsp;</td><td>maximum amount of time to wait for an answer </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>reason</em>&nbsp;</td><td>why unsuccessful (if unsuccessful) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>cid_num</em>&nbsp;</td><td>Caller-ID Number </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>cid_name</em>&nbsp;</td><td>Caller-ID Name (ascii)</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns an <a class="el" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> on success or no answer, NULL on failure. Check the value of chan-&gt;_state to know if the call was answered or not. </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l03981">3981</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l03851">__ast_request_and_dial()</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l07940">ast_pbx_outgoing_exten()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03982"></a>03982 {
<a name="l03983"></a>03983    <span class="keywordflow">return</span> <a class="code" href="channel_8h.html#ad95519a1a1059cd3561ec5ae6c9a2e93" title="Request a channel of a given type, with data as optional information used by the...">__ast_request_and_dial</a>(<a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>, <a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>, timeout, outstate, cidnum, cidname, NULL);
<a name="l03984"></a>03984 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af10e3bd01602095e1908d3926afc3b76"></a><!-- doxytag: member="channel.c::ast_safe_sleep" ref="af10e3bd01602095e1908d3926afc3b76" args="(struct ast_channel *chan, int ms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_safe_sleep </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ms</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Wait, look for hangups. </p>
<p>Wait for a specified amount of time, looking for hangups. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01367">1367</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l01328">ast_safe_sleep_conditional()</a>.</p>

<p>Referenced by <a class="el" href="res__adsi_8c_source.html#l00341">_ast_adsi_transmit_message_full()</a>, <a class="el" href="app__alarmreceiver_8c_source.html#l00567">alarmreceiver_exec()</a>, <a class="el" href="app_8c_source.html#l00314">ast_dtmf_stream()</a>, <a class="el" href="channel_8c_source.html#l03373">ast_senddigit()</a>, <a class="el" href="features_8c_source.html#l01396">builtin_atxfer()</a>, <a class="el" href="features_8c_source.html#l00942">builtin_parkcall()</a>, <a class="el" href="app__meetme_8c_source.html#l01998">conf_run()</a>, <a class="el" href="app__dictate_8c_source.html#l00084">dictate_exec()</a>, <a class="el" href="app__disa_8c_source.html#l00143">disa_exec()</a>, <a class="el" href="app__flash_8c_source.html#l00075">flash_exec()</a>, <a class="el" href="app__rpt_8c_source.html#l05872">function_ilink()</a>, <a class="el" href="chan__skinny_8c_source.html#l04584">handle_callforward_button()</a>, <a class="el" href="chan__agent_8c_source.html#l01981">login_exec()</a>, <a class="el" href="chan__mgcp_8c_source.html#l02637">mgcp_ss()</a>, <a class="el" href="app__milliwatt_8c_source.html#l00143">milliwatt_exec()</a>, <a class="el" href="chan__misdn_8c_source.html#l05663">misdn_check_l2l1()</a>, <a class="el" href="app__milliwatt_8c_source.html#l00121">old_milliwatt_exec()</a>, <a class="el" href="features_8c_source.html#l03249">park_call_exec()</a>, <a class="el" href="pbx_8c_source.html#l08713">pbx_builtin_wait()</a>, <a class="el" href="res__musiconhold_8c_source.html#l00667">play_moh_exec()</a>, <a class="el" href="app__rpt_8c_source.html#l03251">play_tone_pair()</a>, <a class="el" href="app__morsecode_8c_source.html#l00112">playtone()</a>, <a class="el" href="app__privacy_8c_source.html#l00083">privacy_exec()</a>, <a class="el" href="app__alarmreceiver_8c_source.html#l00419">receive_ademco_contact_id()</a>, <a class="el" href="app__rpt_8c_source.html#l05280">rpt_call()</a>, <a class="el" href="app__rpt_8c_source.html#l13122">rpt_exec()</a>, <a class="el" href="app__rpt_8c_source.html#l03937">rpt_tele_thread()</a>, <a class="el" href="app__rpt_8c_source.html#l03462">send_morse()</a>, <a class="el" href="app__rpt_8c_source.html#l03624">send_tone_telemetry()</a>, <a class="el" href="chan__skinny_8c_source.html#l03619">skinny_ss()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>, <a class="el" href="app__test_8c_source.html#l00146">testclient_exec()</a>, <a class="el" href="app__test_8c_source.html#l00320">testserver_exec()</a>, <a class="el" href="app__queue_8c_source.html#l03569">try_calling()</a>, <a class="el" href="pbx_8c_source.html#l08422">wait_for_hangup()</a>, <a class="el" href="app__rpt_8c_source.html#l03922">wait_interval()</a>, <a class="el" href="res__musiconhold_8c_source.html#l00707">wait_moh_exec()</a>, <a class="el" href="app__waituntil_8c_source.html#l00070">waituntil_exec()</a>, and <a class="el" href="app__zapateller_8c_source.html#l00077">zapateller_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01368"></a>01368 {
<a name="l01369"></a>01369    <span class="keywordflow">return</span> <a class="code" href="channel_8h.html#ac23326dea0fc5f850ecd80fccef3424e" title="Wait for a specified amount of time, looking for hangups and a condition argument...">ast_safe_sleep_conditional</a>(chan, ms, NULL, NULL);
<a name="l01370"></a>01370 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac23326dea0fc5f850ecd80fccef3424e"></a><!-- doxytag: member="channel.c::ast_safe_sleep_conditional" ref="ac23326dea0fc5f850ecd80fccef3424e" args="(struct ast_channel *chan, int ms, int(*cond)(void *), void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_safe_sleep_conditional </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int(*)(void *)&nbsp;</td>
          <td class="paramname"> <em>cond</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Wait, look for hangups and condition arg. </p>
<p>Wait for a specified amount of time, looking for hangups and a condition argument. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01328">1328</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l05640">ast_channel_start_silence_generator()</a>, <a class="el" href="channel_8c_source.html#l05663">ast_channel_stop_silence_generator()</a>, <a class="el" href="frame_8h_source.html#l00462">ast_frfree</a>, <a class="el" href="options_8h_source.html#l00114">ast_opt_transmit_silence</a>, <a class="el" href="channel_8c_source.html#l03100">ast_read()</a>, <a class="el" href="channel_8c_source.html#l02389">ast_waitfor()</a>, <a class="el" href="app__meetme_8c_source.html#l00841">cond</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, and <a class="el" href="channel_8h_source.html#l00403">ast_channel::generatordata</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l01367">ast_safe_sleep()</a>, and <a class="el" href="chan__agent_8c_source.html#l01981">login_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01329"></a>01329 {
<a name="l01330"></a>01330    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l01331"></a>01331    <span class="keyword">struct </span><a class="code" href="structast__silence__generator.html">ast_silence_generator</a> *silgen = NULL;
<a name="l01332"></a>01332    <span class="keywordtype">int</span> res = 0;
<a name="l01333"></a>01333 
<a name="l01334"></a>01334    <span class="comment">/* If no other generator is present, start silencegen while waiting */</span>
<a name="l01335"></a>01335    <span class="keywordflow">if</span> (<a class="code" href="options_8h.html#afe8795c4ec744506a9300700fc0813dc">ast_opt_transmit_silence</a> &amp;&amp; !chan-&gt;<a class="code" href="structast__channel.html#abe7876f86e249ea3db5fbacd2231389c">generatordata</a>) {
<a name="l01336"></a>01336       silgen = <a class="code" href="channel_8h.html#a2a2e0ff24c57491a877cac39cb670024" title="Starts a silence generator on the given channel.">ast_channel_start_silence_generator</a>(chan);
<a name="l01337"></a>01337    }
<a name="l01338"></a>01338 
<a name="l01339"></a>01339    <span class="keywordflow">while</span> (ms &gt; 0) {
<a name="l01340"></a>01340       <span class="keywordflow">if</span> (<a class="code" href="app__meetme_8c.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a> &amp;&amp; ((*<a class="code" href="app__meetme_8c.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>)(data) == 0)) {
<a name="l01341"></a>01341          <span class="keywordflow">break</span>;
<a name="l01342"></a>01342       }
<a name="l01343"></a>01343       ms = <a class="code" href="channel_8h.html#a60e0bcaed001e8d5ed1ba0eb2644b3cc" title="Wait for input on a channel.">ast_waitfor</a>(chan, ms);
<a name="l01344"></a>01344       <span class="keywordflow">if</span> (ms &lt; 0) {
<a name="l01345"></a>01345          res = -1;
<a name="l01346"></a>01346          <span class="keywordflow">break</span>;
<a name="l01347"></a>01347       }
<a name="l01348"></a>01348       <span class="keywordflow">if</span> (ms &gt; 0) {
<a name="l01349"></a>01349          f = <a class="code" href="channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1" title="Reads a frame.">ast_read</a>(chan);
<a name="l01350"></a>01350          <span class="keywordflow">if</span> (!f) {
<a name="l01351"></a>01351             res = -1;
<a name="l01352"></a>01352             <span class="keywordflow">break</span>;
<a name="l01353"></a>01353          }
<a name="l01354"></a>01354          <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l01355"></a>01355       }
<a name="l01356"></a>01356    }
<a name="l01357"></a>01357 
<a name="l01358"></a>01358    <span class="comment">/* stop silgen if present */</span>
<a name="l01359"></a>01359    <span class="keywordflow">if</span> (silgen) {
<a name="l01360"></a>01360       <a class="code" href="channel_8h.html#a6643cbe766a051d2d06750ab5b3e933d" title="Stops a previously-started silence generator on the given channel.">ast_channel_stop_silence_generator</a>(chan, silgen);
<a name="l01361"></a>01361    }
<a name="l01362"></a>01362 
<a name="l01363"></a>01363    <span class="keywordflow">return</span> res;
<a name="l01364"></a>01364 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1a7823cbe91b5dec9dea88cfd756ab96"></a><!-- doxytag: member="channel.c::ast_say_character_str" ref="a1a7823cbe91b5dec9dea88cfd756ab96" args="(struct ast_channel *chan, const char *str, const char *ints, const char *lang)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_say_character_str </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>ints</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>lang</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l05839">5839</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="say_8h.html#ade1ca4dd1fef967c239d62fad0795332">ast_say_character_str_full</a>.</p>

<p>Referenced by <a class="el" href="app__chanspy_8c_source.html#l00767">common_exec()</a>, <a class="el" href="pbx_8c_source.html#l09265">pbx_builtin_saycharacters()</a>, <a class="el" href="app__directory_8c_source.html#l00247">play_mailbox_owner()</a>, <a class="el" href="app__rpt_8c_source.html#l03937">rpt_tele_thread()</a>, <a class="el" href="app__rpt_8c_source.html#l03694">saycharstr()</a>, and <a class="el" href="app__rpt_8c_source.html#l03722">saynode()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05841"></a>05841 {
<a name="l05842"></a>05842    <span class="keywordflow">return</span> <a class="code" href="say_8h.html#ade1ca4dd1fef967c239d62fad0795332">ast_say_character_str_full</a>(chan, <a class="code" href="app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>, ints, lang, -1, -1);
<a name="l05843"></a>05843 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a22de2fa4172d1ecd3b32426ea1b8f4ba"></a><!-- doxytag: member="channel.c::ast_say_digit_str" ref="a22de2fa4172d1ecd3b32426ea1b8f4ba" args="(struct ast_channel *chan, const char *str, const char *ints, const char *lang)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_say_digit_str </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>ints</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>lang</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>says digits of a string </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel to act upon </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>num</em>&nbsp;</td><td>string to speak </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ints</em>&nbsp;</td><td>which dtmf to interrupt on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>lang</em>&nbsp;</td><td>language to speak in</td></tr>
  </table>
  </dd>
</dl>
<p>Vocally says the digits of a given string </p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on succes </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>DTMF</em>&nbsp;</td><td>if interrupted </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l05833">5833</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="say_8h.html#a921b263824a296812f264716e68ab129">ast_say_digit_str_full</a>.</p>

<p>Referenced by <a class="el" href="app__voicemail_8c_source.html#l06582">forward_message()</a>, <a class="el" href="app__minivm_8c_source.html#l01309">invent_message()</a>, <a class="el" href="chan__mgcp_8c_source.html#l02637">mgcp_ss()</a>, <a class="el" href="pbx_8c_source.html#l09256">pbx_builtin_saydigits()</a>, <a class="el" href="app__voicemail_8c_source.html#l06937">play_message_callerid()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05835"></a>05835 {
<a name="l05836"></a>05836    <span class="keywordflow">return</span> <a class="code" href="say_8h.html#a921b263824a296812f264716e68ab129">ast_say_digit_str_full</a>(chan, <a class="code" href="app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>, ints, lang, -1, -1);
<a name="l05837"></a>05837 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7cf9dcf6ae6fcedb7752d0deac683b3b"></a><!-- doxytag: member="channel.c::ast_say_digits" ref="a7cf9dcf6ae6fcedb7752d0deac683b3b" args="(struct ast_channel *chan, int num, const char *ints, const char *lang)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_say_digits </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>ints</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>lang</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>says digits </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel to act upon </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>num</em>&nbsp;</td><td><a class="el" href="structnumber.html" title="Number structure.">number</a> to speak </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ints</em>&nbsp;</td><td>which dtmf to interrupt on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>lang</em>&nbsp;</td><td>language to speak</td></tr>
  </table>
  </dd>
</dl>
<p>Vocally says digits of a given <a class="el" href="structnumber.html" title="Number structure.">number</a> </p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>DTMF</em>&nbsp;</td><td>if interrupted </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l05827">5827</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l05851">ast_say_digits_full()</a>.</p>

<p>Referenced by <a class="el" href="app__chanspy_8c_source.html#l00767">common_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l03696">conf_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l01998">conf_run()</a>, <a class="el" href="features_8c_source.html#l00678">park_call_full()</a>, <a class="el" href="app__parkandannounce_8c_source.html#l00088">parkandannounce_exec()</a>, and <a class="el" href="app__rpt_8c_source.html#l03937">rpt_tele_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05829"></a>05829 {
<a name="l05830"></a>05830    <span class="keywordflow">return</span> <a class="code" href="say_8h.html#ac293bae3a692080477911e637dbf3463">ast_say_digits_full</a>(chan, <a class="code" href="adsistub_8c.html#af6fc584548091f45267cfaf7066119bd">num</a>, ints, lang, -1, -1);
<a name="l05831"></a>05831 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac293bae3a692080477911e637dbf3463"></a><!-- doxytag: member="channel.c::ast_say_digits_full" ref="ac293bae3a692080477911e637dbf3463" args="(struct ast_channel *chan, int num, const char *ints, const char *lang, int audiofd, int ctrlfd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_say_digits_full </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>ints</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>lang</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>audiofd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ctrlfd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l05851">5851</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="say_8h.html#a921b263824a296812f264716e68ab129">ast_say_digit_str_full</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l05827">ast_say_digits()</a>, <a class="el" href="say_8c_source.html#l02669">ast_say_enumeration_full_da()</a>, <a class="el" href="say_8c_source.html#l02832">ast_say_enumeration_full_de()</a>, <a class="el" href="say_8c_source.html#l00597">ast_say_number_full_cs()</a>, <a class="el" href="say_8c_source.html#l00695">ast_say_number_full_da()</a>, <a class="el" href="say_8c_source.html#l00808">ast_say_number_full_de()</a>, <a class="el" href="say_8c_source.html#l00504">ast_say_number_full_en()</a>, <a class="el" href="say_8c_source.html#l00943">ast_say_number_full_en_GB()</a>, <a class="el" href="say_8c_source.html#l01021">ast_say_number_full_es()</a>, <a class="el" href="say_8c_source.html#l01125">ast_say_number_full_fr()</a>, <a class="el" href="say_8c_source.html#l01217">ast_say_number_full_he()</a>, <a class="el" href="say_8c_source.html#l01388">ast_say_number_full_hu()</a>, <a class="el" href="say_8c_source.html#l01465">ast_say_number_full_it()</a>, <a class="el" href="say_8c_source.html#l07619">ast_say_number_full_ka()</a>, <a class="el" href="say_8c_source.html#l01620">ast_say_number_full_nl()</a>, <a class="el" href="say_8c_source.html#l01712">ast_say_number_full_no()</a>, <a class="el" href="say_8c_source.html#l02099">ast_say_number_full_pt()</a>, <a class="el" href="say_8c_source.html#l02404">ast_say_number_full_ru()</a>, <a class="el" href="say_8c_source.html#l02195">ast_say_number_full_se()</a>, <a class="el" href="say_8c_source.html#l02482">ast_say_number_full_th()</a>, <a class="el" href="say_8c_source.html#l02267">ast_say_number_full_zh()</a>, and <a class="el" href="app__playback_8c_source.html#l00349">say_init_mode()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05853"></a>05853 {
<a name="l05854"></a>05854    <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[256];
<a name="l05855"></a>05855 
<a name="l05856"></a>05856    snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%d&quot;</span>, <a class="code" href="adsistub_8c.html#af6fc584548091f45267cfaf7066119bd">num</a>);
<a name="l05857"></a>05857 
<a name="l05858"></a>05858    <span class="keywordflow">return</span> <a class="code" href="say_8h.html#a921b263824a296812f264716e68ab129">ast_say_digit_str_full</a>(chan, buf, ints, lang, audiofd, ctrlfd);
<a name="l05859"></a>05859 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a91c054f75fcf111f208a9fa185e8cd94"></a><!-- doxytag: member="channel.c::ast_say_enumeration" ref="a91c054f75fcf111f208a9fa185e8cd94" args="(struct ast_channel *chan, int num, const char *ints, const char *language, const char *options)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_say_enumeration </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>ints</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>lang</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>options</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>says an enumeration </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel to say them enumeration on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>num</em>&nbsp;</td><td><a class="el" href="structnumber.html" title="Number structure.">number</a> to say on the channel </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ints</em>&nbsp;</td><td>which dtmf to interrupt on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>lang</em>&nbsp;</td><td>language to speak the enumeration </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>options</em>&nbsp;</td><td>set to 'f' for female, 'm' for male, 'c' for commune, 'n' for neuter, 'p' for plural</td></tr>
  </table>
  </dd>
</dl>
<p>Vocally says an enumeration on a given channel (first, sencond, third, forth, thirtyfirst, hundredth, ....) Especially useful for dates and messages. Says 'last' if num equals to INT_MAX </p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>DTMF</em>&nbsp;</td><td>digit on interrupt </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l05821">5821</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="say_8h.html#a68b1108079b31db9dbac0a14f94c7a2c">ast_say_enumeration_full</a>.</p>

<p>Referenced by <a class="el" href="say_8c_source.html#l03148">ast_say_date_da()</a>, <a class="el" href="say_8c_source.html#l03197">ast_say_date_de()</a>, <a class="el" href="say_8c_source.html#l03727">ast_say_date_with_format_da()</a>, <a class="el" href="say_8c_source.html#l03929">ast_say_date_with_format_de()</a>, <a class="el" href="say_8c_source.html#l03480">ast_say_date_with_format_en()</a>, and <a class="el" href="say_8c_source.html#l05285">ast_say_date_with_format_pl()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05823"></a>05823 {
<a name="l05824"></a>05824    <span class="keywordflow">return</span> <a class="code" href="say_8h.html#a68b1108079b31db9dbac0a14f94c7a2c">ast_say_enumeration_full</a>(chan, <a class="code" href="adsistub_8c.html#af6fc584548091f45267cfaf7066119bd">num</a>, ints, <a class="code" href="chan__alsa_8c.html#adf416dc058363e2fd5750c77e2d78bee">language</a>, options, -1, -1);
<a name="l05825"></a>05825 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0275d7480f8a07d47460752834bb3a40"></a><!-- doxytag: member="channel.c::ast_say_number" ref="a0275d7480f8a07d47460752834bb3a40" args="(struct ast_channel *chan, int num, const char *ints, const char *language, const char *options)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_say_number </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>ints</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>lang</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>options</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>says a <a class="el" href="structnumber.html" title="Number structure.">number</a> </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel to say them <a class="el" href="structnumber.html" title="Number structure.">number</a> on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>num</em>&nbsp;</td><td><a class="el" href="structnumber.html" title="Number structure.">number</a> to say on the channel </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ints</em>&nbsp;</td><td>which dtmf to interrupt on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>lang</em>&nbsp;</td><td>language to speak the <a class="el" href="structnumber.html" title="Number structure.">number</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>options</em>&nbsp;</td><td>set to 'f' for female, 'm' for male, 'c' for commune, 'n' for neuter, 'p' for plural</td></tr>
  </table>
  </dd>
</dl>
<p>Vocally says a <a class="el" href="structnumber.html" title="Number structure.">number</a> on a given channel </p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>DTMF</em>&nbsp;</td><td>digit on interrupt </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l05815">5815</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="say_8h.html#af2f2a53bc36d82082a80daebac5d9d0f">ast_say_number_full</a>.</p>

<p>Referenced by <a class="el" href="app__confbridge_8c_source.html#l00203">announce_user_count()</a>, <a class="el" href="say_8c_source.html#l03148">ast_say_date_da()</a>, <a class="el" href="say_8c_source.html#l03197">ast_say_date_de()</a>, <a class="el" href="say_8c_source.html#l03119">ast_say_date_en()</a>, <a class="el" href="say_8c_source.html#l03279">ast_say_date_fr()</a>, <a class="el" href="say_8c_source.html#l07159">ast_say_date_gr()</a>, <a class="el" href="say_8c_source.html#l03400">ast_say_date_he()</a>, <a class="el" href="say_8c_source.html#l03247">ast_say_date_hu()</a>, <a class="el" href="say_8c_source.html#l07696">ast_say_date_ka()</a>, <a class="el" href="say_8c_source.html#l03308">ast_say_date_nl()</a>, <a class="el" href="say_8c_source.html#l03373">ast_say_date_pt()</a>, <a class="el" href="say_8c_source.html#l03337">ast_say_date_th()</a>, <a class="el" href="say_8c_source.html#l03727">ast_say_date_with_format_da()</a>, <a class="el" href="say_8c_source.html#l03929">ast_say_date_with_format_de()</a>, <a class="el" href="say_8c_source.html#l03480">ast_say_date_with_format_en()</a>, <a class="el" href="say_8c_source.html#l04466">ast_say_date_with_format_es()</a>, <a class="el" href="say_8c_source.html#l04655">ast_say_date_with_format_fr()</a>, <a class="el" href="say_8c_source.html#l04850">ast_say_date_with_format_it()</a>, <a class="el" href="say_8c_source.html#l05080">ast_say_date_with_format_nl()</a>, <a class="el" href="say_8c_source.html#l05285">ast_say_date_with_format_pl()</a>, <a class="el" href="say_8c_source.html#l05502">ast_say_date_with_format_pt()</a>, <a class="el" href="say_8c_source.html#l04132">ast_say_date_with_format_th()</a>, <a class="el" href="say_8c_source.html#l06433">ast_say_datetime_en()</a>, <a class="el" href="say_8c_source.html#l06529">ast_say_datetime_fr()</a>, <a class="el" href="say_8c_source.html#l06862">ast_say_datetime_from_now_en()</a>, <a class="el" href="say_8c_source.html#l06900">ast_say_datetime_from_now_fr()</a>, <a class="el" href="say_8c_source.html#l06988">ast_say_datetime_from_now_he()</a>, <a class="el" href="say_8c_source.html#l07786">ast_say_datetime_from_now_ka()</a>, <a class="el" href="say_8c_source.html#l06938">ast_say_datetime_from_now_pt()</a>, <a class="el" href="say_8c_source.html#l06773">ast_say_datetime_he()</a>, <a class="el" href="say_8c_source.html#l06589">ast_say_datetime_pt()</a>, <a class="el" href="say_8c_source.html#l06670">ast_say_datetime_th()</a>, <a class="el" href="say_8c_source.html#l06713">ast_say_datetime_zh()</a>, <a class="el" href="say_8c_source.html#l06153">ast_say_time_de()</a>, <a class="el" href="say_8c_source.html#l06104">ast_say_time_en()</a>, <a class="el" href="say_8c_source.html#l06196">ast_say_time_fr()</a>, <a class="el" href="say_8c_source.html#l07203">ast_say_time_gr()</a>, <a class="el" href="say_8c_source.html#l06173">ast_say_time_hu()</a>, <a class="el" href="say_8c_source.html#l07736">ast_say_time_ka()</a>, <a class="el" href="say_8c_source.html#l06215">ast_say_time_nl()</a>, <a class="el" href="say_8c_source.html#l06235">ast_say_time_pt()</a>, <a class="el" href="say_8c_source.html#l06264">ast_say_time_pt_BR()</a>, <a class="el" href="say_8c_source.html#l06294">ast_say_time_th()</a>, <a class="el" href="say_8c_source.html#l06312">ast_say_time_zh()</a>, <a class="el" href="channel_8c_source.html#l04742">bridge_playfile()</a>, <a class="el" href="app__dahdiscan_8c_source.html#l00290">conf_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l01998">conf_run()</a>, <a class="el" href="app__meetme_8c_source.html#l03650">count_exec()</a>, <a class="el" href="app__dictate_8c_source.html#l00084">dictate_exec()</a>, <a class="el" href="app__voicemail_8c_source.html#l06238">get_folder()</a>, <a class="el" href="say_8c_source.html#l07033">gr_say_number_female()</a>, <a class="el" href="pbx_8c_source.html#l09228">pbx_builtin_saynumber()</a>, <a class="el" href="app__voicemail_8c_source.html#l07051">play_message()</a>, <a class="el" href="app__voicemail_8c_source.html#l07001">play_message_duration()</a>, <a class="el" href="app__rpt_8c_source.html#l03937">rpt_tele_thread()</a>, <a class="el" href="app__voicemail_8c_source.html#l05658">say_and_wait()</a>, <a class="el" href="app__queue_8c_source.html#l02080">say_position()</a>, <a class="el" href="app__rpt_8c_source.html#l03707">saynum()</a>, <a class="el" href="app__queue_8c_source.html#l03569">try_calling()</a>, <a class="el" href="app__voicemail_8c_source.html#l07468">vm_intro_gr()</a>, <a class="el" href="app__voicemail_8c_source.html#l07602">vm_intro_he()</a>, <a class="el" href="app__voicemail_8c_source.html#l07562">vm_intro_multilang()</a>, <a class="el" href="app__voicemail_8c_source.html#l08161">vm_intro_pt()</a>, and <a class="el" href="app__voicemail_8c_source.html#l08022">vm_intro_pt_BR()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05817"></a>05817 {
<a name="l05818"></a>05818    <span class="keywordflow">return</span> <a class="code" href="say_8h.html#af2f2a53bc36d82082a80daebac5d9d0f">ast_say_number_full</a>(chan, <a class="code" href="adsistub_8c.html#af6fc584548091f45267cfaf7066119bd">num</a>, ints, <a class="code" href="chan__alsa_8c.html#adf416dc058363e2fd5750c77e2d78bee">language</a>, options, -1, -1);
<a name="l05819"></a>05819 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab7c03b95bdfaed8f38ecd45e93c868d3"></a><!-- doxytag: member="channel.c::ast_say_phonetic_str" ref="ab7c03b95bdfaed8f38ecd45e93c868d3" args="(struct ast_channel *chan, const char *str, const char *ints, const char *lang)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_say_phonetic_str </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>ints</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>lang</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l05845">5845</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="say_8h.html#ae361dc17d977422a2fffcb661f8a9a09">ast_say_phonetic_str_full</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l09274">pbx_builtin_sayphonetic()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05847"></a>05847 {
<a name="l05848"></a>05848    <span class="keywordflow">return</span> <a class="code" href="say_8h.html#ae361dc17d977422a2fffcb661f8a9a09">ast_say_phonetic_str_full</a>(chan, <a class="code" href="app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>, ints, lang, -1, -1);
<a name="l05849"></a>05849 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a48a8b376caf908979e96af8641591c92"></a><!-- doxytag: member="channel.c::ast_senddigit" ref="a48a8b376caf908979e96af8641591c92" args="(struct ast_channel *chan, char digit, unsigned int duration)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_senddigit </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>digit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>duration</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Send a DTMF digit to a channel Send a DTMF digit to a channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel to act upon </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>digit</em>&nbsp;</td><td>the DTMF digit to send, encoded in ASCII </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>duration</em>&nbsp;</td><td>the duration of the digit ending in ms </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns 0 on success, -1 on failure </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l03373">3373</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l00093">AST_DEFAULT_EMULATE_DTMF_DURATION</a>, <a class="el" href="channel_8c_source.html#l01367">ast_safe_sleep()</a>, <a class="el" href="channel_8c_source.html#l03315">ast_senddigit_begin()</a>, <a class="el" href="channel_8c_source.html#l03360">ast_senddigit_end()</a>, <a class="el" href="structast__channel__tech.html#a83b4c653034ecac13d1abc179d0535d8">ast_channel_tech::send_digit_begin</a>, and <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>.</p>

<p>Referenced by <a class="el" href="app_8c_source.html#l00314">ast_dtmf_stream()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="app__rpt_8c_source.html#l01524">do_dtmf_phone()</a>, <a class="el" href="app__senddtmf_8c_source.html#l00099">manager_play_dtmf()</a>, and <a class="el" href="app__rpt_8c_source.html#l05280">rpt_call()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03374"></a>03374 {
<a name="l03375"></a>03375    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a83b4c653034ecac13d1abc179d0535d8" title="Start sending a literal DTMF digit.">send_digit_begin</a>) {
<a name="l03376"></a>03376       <a class="code" href="channel_8h.html#a38f90349e730b6556cfe8b99b134d574" title="Send a DTMF digit to a channel Send a DTMF digit to a channel.">ast_senddigit_begin</a>(chan, digit);
<a name="l03377"></a>03377       <a class="code" href="channel_8h.html#af10e3bd01602095e1908d3926afc3b76" title="Wait for a specified amount of time, looking for hangups.">ast_safe_sleep</a>(chan, (duration &gt;= <a class="code" href="channel_8c.html#a4a1bcc0fd8b14e9bbff17b963969bcab">AST_DEFAULT_EMULATE_DTMF_DURATION</a> ? duration : <a class="code" href="channel_8c.html#a4a1bcc0fd8b14e9bbff17b963969bcab">AST_DEFAULT_EMULATE_DTMF_DURATION</a>));
<a name="l03378"></a>03378    }
<a name="l03379"></a>03379    
<a name="l03380"></a>03380    <span class="keywordflow">return</span> <a class="code" href="channel_8h.html#ab45db8cf33a706a5831d553d5199c143" title="Send a DTMF digit to a channel.">ast_senddigit_end</a>(chan, digit, (duration &gt;= <a class="code" href="channel_8c.html#a4a1bcc0fd8b14e9bbff17b963969bcab">AST_DEFAULT_EMULATE_DTMF_DURATION</a> ? duration : <a class="code" href="channel_8c.html#a4a1bcc0fd8b14e9bbff17b963969bcab">AST_DEFAULT_EMULATE_DTMF_DURATION</a>));
<a name="l03381"></a>03381 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a38f90349e730b6556cfe8b99b134d574"></a><!-- doxytag: member="channel.c::ast_senddigit_begin" ref="a38f90349e730b6556cfe8b99b134d574" args="(struct ast_channel *chan, char digit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_senddigit_begin </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>digit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Send a DTMF digit to a channel Send a DTMF digit to a channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel to act upon </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>digit</em>&nbsp;</td><td>the DTMF digit to send, encoded in ASCII </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns 0 on success, -1 on failure </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l03315">3315</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="indications_8c_source.html#l00301">ast_playtones_start()</a>, <a class="el" href="structast__channel__tech.html#a83b4c653034ecac13d1abc179d0535d8">ast_channel_tech::send_digit_begin</a>, and <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>.</p>

<p>Referenced by <a class="el" href="chan__agent_8c_source.html#l00748">agent_digit_begin()</a>, <a class="el" href="channel_8c_source.html#l03373">ast_senddigit()</a>, and <a class="el" href="channel_8c_source.html#l03411">ast_write()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03316"></a>03316 {
<a name="l03317"></a>03317    <span class="comment">/* Device does not support DTMF tones, lets fake</span>
<a name="l03318"></a>03318 <span class="comment">    * it by doing our own generation. */</span>
<a name="l03319"></a>03319    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* dtmf_tones[] = {
<a name="l03320"></a>03320       <span class="stringliteral">&quot;941+1336&quot;</span>, <span class="comment">/* 0 */</span>
<a name="l03321"></a>03321       <span class="stringliteral">&quot;697+1209&quot;</span>, <span class="comment">/* 1 */</span>
<a name="l03322"></a>03322       <span class="stringliteral">&quot;697+1336&quot;</span>, <span class="comment">/* 2 */</span>
<a name="l03323"></a>03323       <span class="stringliteral">&quot;697+1477&quot;</span>, <span class="comment">/* 3 */</span>
<a name="l03324"></a>03324       <span class="stringliteral">&quot;770+1209&quot;</span>, <span class="comment">/* 4 */</span>
<a name="l03325"></a>03325       <span class="stringliteral">&quot;770+1336&quot;</span>, <span class="comment">/* 5 */</span>
<a name="l03326"></a>03326       <span class="stringliteral">&quot;770+1477&quot;</span>, <span class="comment">/* 6 */</span>
<a name="l03327"></a>03327       <span class="stringliteral">&quot;852+1209&quot;</span>, <span class="comment">/* 7 */</span>
<a name="l03328"></a>03328       <span class="stringliteral">&quot;852+1336&quot;</span>, <span class="comment">/* 8 */</span>
<a name="l03329"></a>03329       <span class="stringliteral">&quot;852+1477&quot;</span>, <span class="comment">/* 9 */</span>
<a name="l03330"></a>03330       <span class="stringliteral">&quot;697+1633&quot;</span>, <span class="comment">/* A */</span>
<a name="l03331"></a>03331       <span class="stringliteral">&quot;770+1633&quot;</span>, <span class="comment">/* B */</span>
<a name="l03332"></a>03332       <span class="stringliteral">&quot;852+1633&quot;</span>, <span class="comment">/* C */</span>
<a name="l03333"></a>03333       <span class="stringliteral">&quot;941+1633&quot;</span>, <span class="comment">/* D */</span>
<a name="l03334"></a>03334       <span class="stringliteral">&quot;941+1209&quot;</span>, <span class="comment">/* * */</span>
<a name="l03335"></a>03335       <span class="stringliteral">&quot;941+1477&quot;</span>  <span class="comment">/* # */</span>
<a name="l03336"></a>03336    };
<a name="l03337"></a>03337 
<a name="l03338"></a>03338    <span class="keywordflow">if</span> (!chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a83b4c653034ecac13d1abc179d0535d8" title="Start sending a literal DTMF digit.">send_digit_begin</a>)
<a name="l03339"></a>03339       <span class="keywordflow">return</span> 0;
<a name="l03340"></a>03340 
<a name="l03341"></a>03341    <span class="keywordflow">if</span> (!chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a83b4c653034ecac13d1abc179d0535d8" title="Start sending a literal DTMF digit.">send_digit_begin</a>(chan, digit))
<a name="l03342"></a>03342       <span class="keywordflow">return</span> 0;
<a name="l03343"></a>03343 
<a name="l03344"></a>03344    <span class="keywordflow">if</span> (digit &gt;= <span class="charliteral">&apos;0&apos;</span> &amp;&amp; digit &lt;=<span class="charliteral">&apos;9&apos;</span>)
<a name="l03345"></a>03345       <a class="code" href="app__rpt_8c.html#a544e8a1dd4a986b00754103dda6a7d3b">ast_playtones_start</a>(chan, 0, dtmf_tones[digit-<span class="charliteral">&apos;0&apos;</span>], 0);
<a name="l03346"></a>03346    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (digit &gt;= <span class="charliteral">&apos;A&apos;</span> &amp;&amp; digit &lt;= <span class="charliteral">&apos;D&apos;</span>)
<a name="l03347"></a>03347       <a class="code" href="app__rpt_8c.html#a544e8a1dd4a986b00754103dda6a7d3b">ast_playtones_start</a>(chan, 0, dtmf_tones[digit-<span class="charliteral">&apos;A&apos;</span>+10], 0);
<a name="l03348"></a>03348    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (digit == <span class="charliteral">&apos;*&apos;</span>)
<a name="l03349"></a>03349       <a class="code" href="app__rpt_8c.html#a544e8a1dd4a986b00754103dda6a7d3b">ast_playtones_start</a>(chan, 0, dtmf_tones[14], 0);
<a name="l03350"></a>03350    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (digit == <span class="charliteral">&apos;#&apos;</span>)
<a name="l03351"></a>03351       <a class="code" href="app__rpt_8c.html#a544e8a1dd4a986b00754103dda6a7d3b">ast_playtones_start</a>(chan, 0, dtmf_tones[15], 0);
<a name="l03352"></a>03352    <span class="keywordflow">else</span> {
<a name="l03353"></a>03353       <span class="comment">/* not handled */</span>
<a name="l03354"></a>03354       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Unable to generate DTMF tone &apos;%c&apos; for &apos;%s&apos;\n&quot;</span>, digit, chan-&gt;name);
<a name="l03355"></a>03355    }
<a name="l03356"></a>03356 
<a name="l03357"></a>03357    <span class="keywordflow">return</span> 0;
<a name="l03358"></a>03358 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab45db8cf33a706a5831d553d5199c143"></a><!-- doxytag: member="channel.c::ast_senddigit_end" ref="ab45db8cf33a706a5831d553d5199c143" args="(struct ast_channel *chan, char digit, unsigned int duration)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_senddigit_end </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>digit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>duration</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Send a DTMF digit to a channel. </p>
<p>Send a DTMF digit to a channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel to act upon </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>digit</em>&nbsp;</td><td>the DTMF digit to send, encoded in ASCII </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>duration</em>&nbsp;</td><td>the duration of the digit ending in ms </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns 0 on success, -1 on failure </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l03360">3360</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="indications_8c_source.html#l00390">ast_playtones_stop()</a>, <a class="el" href="channel_8h_source.html#l00404">ast_channel::generator</a>, <a class="el" href="structast__channel__tech.html#a72ca2103b9f51ffa15e4e8b1d0d161d1">ast_channel_tech::send_digit_end</a>, and <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>.</p>

<p>Referenced by <a class="el" href="chan__agent_8c_source.html#l00759">agent_digit_end()</a>, <a class="el" href="channel_8c_source.html#l03373">ast_senddigit()</a>, and <a class="el" href="channel_8c_source.html#l03411">ast_write()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03361"></a>03361 {
<a name="l03362"></a>03362    <span class="keywordtype">int</span> res = -1;
<a name="l03363"></a>03363 
<a name="l03364"></a>03364    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a72ca2103b9f51ffa15e4e8b1d0d161d1" title="Stop sending a literal DTMF digit.">send_digit_end</a>)
<a name="l03365"></a>03365       res = chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a72ca2103b9f51ffa15e4e8b1d0d161d1" title="Stop sending a literal DTMF digit.">send_digit_end</a>(chan, digit, duration);
<a name="l03366"></a>03366 
<a name="l03367"></a>03367    <span class="keywordflow">if</span> (res &amp;&amp; chan-&gt;<a class="code" href="structast__channel.html#a4e855ab0f984741b9083b2c5a0fdfe18">generator</a>)
<a name="l03368"></a>03368       <a class="code" href="app__rpt_8c.html#a9d5be069b7060d326a213f5d60b8dc77">ast_playtones_stop</a>(chan);
<a name="l03369"></a>03369    
<a name="l03370"></a>03370    <span class="keywordflow">return</span> 0;
<a name="l03371"></a>03371 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a83631e0dc02a50802cf857caa3fdc1d7"></a><!-- doxytag: member="channel.c::ast_sendtext" ref="a83631e0dc02a50802cf857caa3fdc1d7" args="(struct ast_channel *chan, const char *text)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_sendtext </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>text</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Sends text to a channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel to act upon </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>text</em>&nbsp;</td><td>string of text to send on the channel</td></tr>
  </table>
  </dd>
</dl>
<p>Write text to a display on a channel</p>
<dl class="note"><dt><b>Note:</b></dt><dd>The channel does not need to be locked before calling this function.</dd></dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l03302">3302</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l00461">ast_check_hangup()</a>, <a class="el" href="utils_8h_source.html#l00075">ast_clear_flag</a>, <a class="el" href="channel_8h_source.html#l00527">AST_FLAG_BLOCKING</a>, <a class="el" href="channel_8h_source.html#l00529">AST_FLAG_ZOMBIE</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="channel_8h_source.html#l01763">CHECK_BLOCKING</a>, <a class="el" href="structast__channel__tech.html#a675e5d4613f3af64e46d5dd8c12544cc">ast_channel_tech::send_text</a>, and <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>.</p>

<p>Referenced by <a class="el" href="manager_8c_source.html#l02039">action_sendtext()</a>, <a class="el" href="chan__agent_8c_source.html#l00679">agent_sendtext()</a>, <a class="el" href="res__agi_8c_source.html#l01054">handle_sendtext()</a>, <a class="el" href="app__rpt_8c_source.html#l05658">send_newkey()</a>, and <a class="el" href="app__sendtext_8c_source.html#l00075">sendtext_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03303"></a>03303 {
<a name="l03304"></a>03304    <span class="keywordtype">int</span> res = 0;
<a name="l03305"></a>03305    <span class="comment">/* Stop if we&apos;re a zombie or need a soft hangup */</span>
<a name="l03306"></a>03306    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a26796fa52cc5857446eec8d16a4b718d">AST_FLAG_ZOMBIE</a>) || <a class="code" href="channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd" title="Check to see if a channel is needing hang up.">ast_check_hangup</a>(chan))
<a name="l03307"></a>03307       <span class="keywordflow">return</span> -1;
<a name="l03308"></a>03308    <a class="code" href="channel_8h.html#a3a5d847510a477edda3d0bc1459709f4">CHECK_BLOCKING</a>(chan);
<a name="l03309"></a>03309    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a675e5d4613f3af64e46d5dd8c12544cc" title="Display or transmit text.">send_text</a>)
<a name="l03310"></a>03310       res = chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a675e5d4613f3af64e46d5dd8c12544cc" title="Display or transmit text.">send_text</a>(chan, <a class="code" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>);
<a name="l03311"></a>03311    <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329ab5b2bec9425dd0cfc789d96ef229cb3a">AST_FLAG_BLOCKING</a>);
<a name="l03312"></a>03312    <span class="keywordflow">return</span> res;
<a name="l03313"></a>03313 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a88d833a56ea7de33e230281c5c12b75d"></a><!-- doxytag: member="channel.c::ast_set_callerid" ref="a88d833a56ea7de33e230281c5c12b75d" args="(struct ast_channel *chan, const char *cid_num, const char *cid_name, const char *cid_ani)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_set_callerid </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>cid_num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>cid_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>cid_ani</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set caller ID <a class="el" href="structnumber.html" title="Number structure.">number</a>, name and ANI. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>The channel does not need to be locked before calling this function. </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l04670">4670</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="channel_8h_source.html#l00444">ast_channel::cid</a>, <a class="el" href="channel_8h_source.html#l00205">ast_callerid::cid_ani</a>, <a class="el" href="channel_8h_source.html#l00204">ast_callerid::cid_name</a>, <a class="el" href="channel_8h_source.html#l00203">ast_callerid::cid_num</a>, and <a class="el" href="channel_8c_source.html#l04371">report_new_callerid()</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l03851">__ast_request_and_dial()</a>, <a class="el" href="chan__agent_8c_source.html#l00770">agent_call()</a>, <a class="el" href="channel_8c_source.html#l03779">ast_call_forward()</a>, <a class="el" href="func__callerid_8c_source.html#l00191">callerid_write()</a>, <a class="el" href="chan__dahdi_8c_source.html#l06717">dahdi_read()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="app__disa_8c_source.html#l00143">disa_exec()</a>, <a class="el" href="app__dial_8c_source.html#l00712">do_forward()</a>, <a class="el" href="features_8c_source.html#l02152">feature_request_and_dial()</a>, <a class="el" href="app__followme_8c_source.html#l00777">findmeexec()</a>, <a class="el" href="res__agi_8c_source.html#l01765">handle_setcallerid()</a>, <a class="el" href="chan__mgcp_8c_source.html#l02637">mgcp_ss()</a>, <a class="el" href="app__privacy_8c_source.html#l00083">privacy_exec()</a>, <a class="el" href="chan__misdn_8c_source.html#l02185">read_config()</a>, <a class="el" href="app__rpt_8c_source.html#l13122">rpt_exec()</a>, <a class="el" href="chan__skinny_8c_source.html#l03594">skinny_newcall()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04671"></a>04671 {
<a name="l04672"></a>04672    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l04673"></a>04673 
<a name="l04674"></a>04674    <span class="keywordflow">if</span> (<a class="code" href="chan__mgcp_8c.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>) {
<a name="l04675"></a>04675       <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>)
<a name="l04676"></a>04676          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>);
<a name="l04677"></a>04677       chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(<a class="code" href="chan__mgcp_8c.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>);
<a name="l04678"></a>04678    }
<a name="l04679"></a>04679    <span class="keywordflow">if</span> (<a class="code" href="chan__mgcp_8c.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>) {
<a name="l04680"></a>04680       <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a>)
<a name="l04681"></a>04681          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a>);
<a name="l04682"></a>04682       chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(<a class="code" href="chan__mgcp_8c.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>);
<a name="l04683"></a>04683    }
<a name="l04684"></a>04684    <span class="keywordflow">if</span> (cid_ani) {
<a name="l04685"></a>04685       <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a7bb8ad258e687da69d6933ab48320df7">cid_ani</a>)
<a name="l04686"></a>04686          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a7bb8ad258e687da69d6933ab48320df7">cid_ani</a>);
<a name="l04687"></a>04687       chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a7bb8ad258e687da69d6933ab48320df7">cid_ani</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(cid_ani);
<a name="l04688"></a>04688    }
<a name="l04689"></a>04689 
<a name="l04690"></a>04690    <a class="code" href="channel_8c.html#a452cff7df535d1f9cbc96fcd67b075ec">report_new_callerid</a>(chan);
<a name="l04691"></a>04691 
<a name="l04692"></a>04692    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l04693"></a>04693 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab2cdfdb9b321f157038e07a92a82d815"></a><!-- doxytag: member="channel.c::ast_set_read_format" ref="ab2cdfdb9b321f157038e07a92a82d815" args="(struct ast_channel *chan, int fmt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_set_read_format </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>format</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Sets read format on channel chan Set read format for channel to whichever component of "format" is best. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel to change </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>format</em>&nbsp;</td><td>format to change to </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns 0 on success, -1 on failure </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l03731">3731</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00485">ast_channel::rawreadformat</a>, <a class="el" href="channel_8h_source.html#l00483">ast_channel::readformat</a>, <a class="el" href="channel_8h_source.html#l00420">ast_channel::readtrans</a>, and <a class="el" href="channel_8c_source.html#l03673">set_format()</a>.</p>

<p>Referenced by <a class="el" href="app_8c_source.html#l00668">__ast_play_and_record()</a>, <a class="el" href="chan__h323_8c_source.html#l00332">__oh323_update_info()</a>, <a class="el" href="res__adsi_8c_source.html#l00341">_ast_adsi_transmit_message_full()</a>, <a class="el" href="chan__agent_8c_source.html#l00770">agent_call()</a>, <a class="el" href="app__alarmreceiver_8c_source.html#l00567">alarmreceiver_exec()</a>, <a class="el" href="channel_8c_source.html#l04159">ast_channel_make_compatible_helper()</a>, <a class="el" href="channel_8c_source.html#l04393">ast_do_masquerade()</a>, <a class="el" href="app__rpt_8c_source.html#l10335">attempt_reconnect()</a>, <a class="el" href="app__talkdetect_8c_source.html#l00076">background_detect_exec()</a>, <a class="el" href="bridging_8c_source.html#l00860">bridge_channel_join()</a>, <a class="el" href="bridging_8c_source.html#l00538">bridge_make_compatible()</a>, <a class="el" href="app__meetme_8c_source.html#l01061">build_conf()</a>, <a class="el" href="app__dahdibarge_8c_source.html#l00095">conf_run()</a>, <a class="el" href="app__rpt_8c_source.html#l05678">connect_link()</a>, <a class="el" href="app__dictate_8c_source.html#l00084">dictate_exec()</a>, <a class="el" href="app__waitforsilence_8c_source.html#l00125">do_waiting()</a>, <a class="el" href="res__agi_8c_source.html#l03287">eagi_exec()</a>, <a class="el" href="app__echo_8c_source.html#l00051">echo_exec()</a>, <a class="el" href="chan__gtalk_8c_source.html#l01385">gtalk_rtp_read()</a>, <a class="el" href="res__agi_8c_source.html#l01494">handle_recordfile()</a>, <a class="el" href="res__agi_8c_source.html#l02137">handle_speechrecognize()</a>, <a class="el" href="app__ices_8c_source.html#l00107">ices_exec()</a>, <a class="el" href="app__amd_8c_source.html#l00146">isAnsweringMachine()</a>, <a class="el" href="app__jack_8c_source.html#l00743">jack_exec()</a>, <a class="el" href="chan__jingle_8c_source.html#l01167">jingle_rtp_read()</a>, <a class="el" href="chan__agent_8c_source.html#l01981">login_exec()</a>, <a class="el" href="app__test_8c_source.html#l00080">measurenoise()</a>, <a class="el" href="chan__mgcp_8c_source.html#l01202">mgcp_rtp_read()</a>, <a class="el" href="chan__h323_8c_source.html#l00748">oh323_rtp_read()</a>, <a class="el" href="app__milliwatt_8c_source.html#l00121">old_milliwatt_exec()</a>, <a class="el" href="chan__sip_8c_source.html#l08040">process_sdp()</a>, <a class="el" href="app__record_8c_source.html#l00132">record_exec()</a>, <a class="el" href="app__rpt_8c_source.html#l10730">rpt()</a>, <a class="el" href="app__rpt_8c_source.html#l13122">rpt_exec()</a>, <a class="el" href="chan__h323_8c_source.html#l01936">setup_rtp_connection()</a>, <a class="el" href="chan__sip_8c_source.html#l06955">sip_rtp_read()</a>, <a class="el" href="chan__skinny_8c_source.html#l03907">skinny_rtp_read()</a>, <a class="el" href="chan__iax2_8c_source.html#l09458">socket_process()</a>, <a class="el" href="app__speech__utils_8c_source.html#l00639">speech_background()</a>, <a class="el" href="app__fax_8c_source.html#l00362">transmit_audio()</a>, and <a class="el" href="chan__unistim_8c_source.html#l03905">unistim_rtp_read()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03732"></a>03732 {
<a name="l03733"></a>03733    <span class="keywordflow">return</span> <a class="code" href="channel_8c.html#a1d7ab456acdea2bed28186e664a56879">set_format</a>(chan, fmt, &amp;chan-&gt;<a class="code" href="structast__channel.html#a6fcf944239e3718e282e0ba7512e66c6">rawreadformat</a>, &amp;chan-&gt;<a class="code" href="structast__channel.html#ab7786a0f5b9a9ebf83daed87be4f3868">readformat</a>,
<a name="l03734"></a>03734            &amp;chan-&gt;<a class="code" href="structast__channel.html#a9601e6aff2a4c59cbeb9d6fef81184f4">readtrans</a>, 0);
<a name="l03735"></a>03735 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5b14bfe21364dd8f73d45f15cf313524"></a><!-- doxytag: member="channel.c::ast_set_variables" ref="a5b14bfe21364dd8f73d45f15cf313524" args="(struct ast_channel *chan, struct ast_variable *vars)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_set_variables </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__variable.html">ast_variable</a> *&nbsp;</td>
          <td class="paramname"> <em>vars</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>adds a list of channel variables to a channel </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>the channel </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>vars</em>&nbsp;</td><td>a linked list of variables</td></tr>
  </table>
  </dd>
</dl>
<p>Variable names can be for a regular channel variable or a dialplan function that has the ability to be written to. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l05592">5592</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="config_8h_source.html#l00075">ast_variable::name</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="pbx_8c_source.html#l09023">pbx_builtin_setvar_helper()</a>, and <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l03851">__ast_request_and_dial()</a>, <a class="el" href="channel_8c_source.html#l03779">ast_call_forward()</a>, <a class="el" href="pbx_8c_source.html#l08106">ast_pbx_outgoing_app()</a>, and <a class="el" href="pbx_8c_source.html#l07940">ast_pbx_outgoing_exten()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05593"></a>05593 {
<a name="l05594"></a>05594    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *cur;
<a name="l05595"></a>05595 
<a name="l05596"></a>05596    <span class="keywordflow">for</span> (cur = vars; cur; cur = cur-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>)
<a name="l05597"></a>05597       <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, cur-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, cur-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);  
<a name="l05598"></a>05598 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7429113b53f8654e9c361fc5cb835a4b"></a><!-- doxytag: member="channel.c::ast_set_write_format" ref="a7429113b53f8654e9c361fc5cb835a4b" args="(struct ast_channel *chan, int fmt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_set_write_format </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>format</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Sets write format on channel chan Set write format for channel to whichever component of "format" is best. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel to change </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>format</em>&nbsp;</td><td>new format for writing </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns 0 on success, -1 on failure </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l03737">3737</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00486">ast_channel::rawwriteformat</a>, <a class="el" href="channel_8c_source.html#l03673">set_format()</a>, <a class="el" href="channel_8h_source.html#l00484">ast_channel::writeformat</a>, and <a class="el" href="channel_8h_source.html#l00419">ast_channel::writetrans</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l00332">__oh323_update_info()</a>, <a class="el" href="res__adsi_8c_source.html#l00341">_ast_adsi_transmit_message_full()</a>, <a class="el" href="chan__agent_8c_source.html#l00770">agent_call()</a>, <a class="el" href="app__alarmreceiver_8c_source.html#l00567">alarmreceiver_exec()</a>, <a class="el" href="channel_8c_source.html#l04159">ast_channel_make_compatible_helper()</a>, <a class="el" href="channel_8c_source.html#l05640">ast_channel_start_silence_generator()</a>, <a class="el" href="channel_8c_source.html#l05663">ast_channel_stop_silence_generator()</a>, <a class="el" href="channel_8c_source.html#l04393">ast_do_masquerade()</a>, <a class="el" href="file_8c_source.html#l00624">ast_openstream_full()</a>, <a class="el" href="file_8c_source.html#l00122">ast_stopstream()</a>, <a class="el" href="app__rpt_8c_source.html#l10335">attempt_reconnect()</a>, <a class="el" href="bridging_8c_source.html#l00860">bridge_channel_join()</a>, <a class="el" href="bridging_8c_source.html#l00538">bridge_make_compatible()</a>, <a class="el" href="app__meetme_8c_source.html#l01061">build_conf()</a>, <a class="el" href="app__chanspy_8c_source.html#l01035">chanspy_exec()</a>, <a class="el" href="app__dahdibarge_8c_source.html#l00095">conf_run()</a>, <a class="el" href="app__rpt_8c_source.html#l05678">connect_link()</a>, <a class="el" href="app__echo_8c_source.html#l00051">echo_exec()</a>, <a class="el" href="app__chanspy_8c_source.html#l01127">extenspy_exec()</a>, <a class="el" href="chan__gtalk_8c_source.html#l01385">gtalk_rtp_read()</a>, <a class="el" href="app__jack_8c_source.html#l00743">jack_exec()</a>, <a class="el" href="chan__jingle_8c_source.html#l01167">jingle_rtp_read()</a>, <a class="el" href="app_8c_source.html#l00433">linear_alloc()</a>, <a class="el" href="app_8c_source.html#l00389">linear_release()</a>, <a class="el" href="chan__agent_8c_source.html#l01981">login_exec()</a>, <a class="el" href="chan__mgcp_8c_source.html#l01202">mgcp_rtp_read()</a>, <a class="el" href="res__musiconhold_8c_source.html#l00859">moh_alloc()</a>, <a class="el" href="res__musiconhold_8c_source.html#l00228">moh_files_release()</a>, <a class="el" href="res__musiconhold_8c_source.html#l00830">moh_release()</a>, <a class="el" href="app__mp3_8c_source.html#l00120">mp3_exec()</a>, <a class="el" href="app__nbscat_8c_source.html#l00108">NBScat_exec()</a>, <a class="el" href="chan__h323_8c_source.html#l00748">oh323_rtp_read()</a>, <a class="el" href="app__milliwatt_8c_source.html#l00121">old_milliwatt_exec()</a>, <a class="el" href="indications_8c_source.html#l00127">playtones_alloc()</a>, <a class="el" href="indications_8c_source.html#l00111">playtones_release()</a>, <a class="el" href="chan__sip_8c_source.html#l08040">process_sdp()</a>, <a class="el" href="app__rpt_8c_source.html#l10730">rpt()</a>, <a class="el" href="app__rpt_8c_source.html#l13122">rpt_exec()</a>, <a class="el" href="app__festival_8c_source.html#l00161">send_waveform_to_channel()</a>, <a class="el" href="chan__h323_8c_source.html#l01936">setup_rtp_connection()</a>, <a class="el" href="chan__sip_8c_source.html#l06955">sip_rtp_read()</a>, <a class="el" href="chan__skinny_8c_source.html#l03907">skinny_rtp_read()</a>, <a class="el" href="chan__iax2_8c_source.html#l09458">socket_process()</a>, <a class="el" href="channel_8c_source.html#l05367">tonepair_alloc()</a>, <a class="el" href="channel_8c_source.html#l05358">tonepair_release()</a>, <a class="el" href="app__fax_8c_source.html#l00362">transmit_audio()</a>, and <a class="el" href="chan__unistim_8c_source.html#l03905">unistim_rtp_read()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03738"></a>03738 {
<a name="l03739"></a>03739    <span class="keywordflow">return</span> <a class="code" href="channel_8c.html#a1d7ab456acdea2bed28186e664a56879">set_format</a>(chan, fmt, &amp;chan-&gt;<a class="code" href="structast__channel.html#a045b6dfdee84adceb7e86b6c5c4f9a86">rawwriteformat</a>, &amp;chan-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a>,
<a name="l03740"></a>03740            &amp;chan-&gt;<a class="code" href="structast__channel.html#a58d0c117fa64b075eda1d9a7a7d73531">writetrans</a>, 1);
<a name="l03741"></a>03741 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6b869988b7ee213be11a0e45ee3ba09f"></a><!-- doxytag: member="channel.c::ast_setstate" ref="a6b869988b7ee213be11a0e45ee3ba09f" args="(struct ast_channel *chan, enum ast_channel_state state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_setstate </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a>&nbsp;</td>
          <td class="paramname"> <em>state</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Change the <a class="el" href="structstate.html">state</a> of a channel. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l04695">4695</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="channel_8h_source.html#l00136">AST_CHANNEL_NAME</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="devicestate_8h_source.html#l00052">AST_DEVICE_UNKNOWN</a>, <a class="el" href="devicestate_8c_source.html#l00465">ast_devstate_changed_literal()</a>, <a class="el" href="channel_8c_source.html#l00656">ast_state2str()</a>, <a class="el" href="channel_8h_source.html#l00444">ast_channel::cid</a>, <a class="el" href="channel_8h_source.html#l00204">ast_callerid::cid_name</a>, <a class="el" href="channel_8h_source.html#l00203">ast_callerid::cid_num</a>, <a class="el" href="manager_8h_source.html#l00062">EVENT_FLAG_CALL</a>, <a class="el" href="manager_8h_source.html#l00181">manager_event</a>, <a class="el" href="cdr__adaptive__odbc_8c_source.html#l00053">name</a>, and <a class="el" href="strings_8h_source.html#l00072">S_OR</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l02636">__ast_read()</a>, <a class="el" href="chan__dahdi_8c_source.html#l06601">__dahdi_exception()</a>, <a class="el" href="chan__h323_8c_source.html#l00332">__oh323_update_info()</a>, <a class="el" href="chan__agent_8c_source.html#l00770">agent_call()</a>, <a class="el" href="chan__alsa_8c_source.html#l00337">alsa_answer()</a>, <a class="el" href="channel_8c_source.html#l01799">ast_raw_answer()</a>, <a class="el" href="chan__misdn_8c_source.html#l04379">cb_events()</a>, <a class="el" href="chan__agent_8c_source.html#l01350">check_availability()</a>, <a class="el" href="chan__console_8c_source.html#l00517">console_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07170">dahdi_indicate()</a>, <a class="el" href="chan__dahdi_8c_source.html#l06717">dahdi_read()</a>, <a class="el" href="features_8c_source.html#l04126">do_bridge_masquerade()</a>, <a class="el" href="chan__gtalk_8c_source.html#l01593">gtalk_call()</a>, <a class="el" href="chan__gtalk_8c_source.html#l01154">gtalk_newcall()</a>, <a class="el" href="chan__sip_8c_source.html#l19184">handle_invite_replaces()</a>, <a class="el" href="chan__skinny_8c_source.html#l05045">handle_offhook_message()</a>, <a class="el" href="chan__sip_8c_source.html#l19641">handle_request_invite()</a>, <a class="el" href="chan__sip_8c_source.html#l17572">handle_response_invite()</a>, <a class="el" href="chan__skinny_8c_source.html#l05662">handle_soft_key_event_message()</a>, <a class="el" href="chan__skinny_8c_source.html#l04699">handle_stimulus_message()</a>, <a class="el" href="chan__iax2_8c_source.html#l04777">iax2_call()</a>, <a class="el" href="chan__jingle_8c_source.html#l01424">jingle_call()</a>, <a class="el" href="chan__jingle_8c_source.html#l00954">jingle_newcall()</a>, <a class="el" href="chan__local_8c_source.html#l00206">local_queue_frame()</a>, <a class="el" href="chan__mgcp_8c_source.html#l01177">mgcp_answer()</a>, <a class="el" href="chan__mgcp_8c_source.html#l00843">mgcp_call()</a>, <a class="el" href="chan__mgcp_8c_source.html#l02637">mgcp_ss()</a>, <a class="el" href="chan__misdn_8c_source.html#l02394">misdn_call()</a>, <a class="el" href="chan__misdn_8c_source.html#l02659">misdn_indication()</a>, <a class="el" href="chan__nbs_8c_source.html#l00086">nbs_call()</a>, <a class="el" href="chan__nbs_8c_source.html#l00164">nbs_hangup()</a>, <a class="el" href="chan__h323_8c_source.html#l00658">oh323_answer()</a>, <a class="el" href="chan__oss_8c_source.html#l00632">oss_answer()</a>, <a class="el" href="pbx_8c_source.html#l08474">pbx_builtin_busy()</a>, <a class="el" href="pbx_8c_source.html#l08490">pbx_builtin_congestion()</a>, <a class="el" href="chan__phone_8c_source.html#l00455">phone_answer()</a>, <a class="el" href="chan__phone_8c_source.html#l00287">phone_call()</a>, <a class="el" href="chan__phone_8c_source.html#l00487">phone_exception()</a>, <a class="el" href="chan__phone_8c_source.html#l00341">phone_hangup()</a>, <a class="el" href="chan__phone_8c_source.html#l00646">phone_write()</a>, <a class="el" href="chan__misdn_8c_source.html#l03980">release_chan()</a>, <a class="el" href="chan__misdn_8c_source.html#l04050">release_chan_early()</a>, <a class="el" href="chan__sip_8c_source.html#l06187">sip_answer()</a>, <a class="el" href="chan__skinny_8c_source.html#l03867">skinny_answer()</a>, <a class="el" href="chan__skinny_8c_source.html#l03723">skinny_call()</a>, <a class="el" href="chan__skinny_8c_source.html#l03594">skinny_newcall()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>, <a class="el" href="chan__unistim_8c_source.html#l03815">unistim_answer()</a>, <a class="el" href="chan__unistim_8c_source.html#l03649">unistim_call()</a>, <a class="el" href="chan__unistim_8c_source.html#l04422">unistim_new()</a>, <a class="el" href="chan__unistim_8c_source.html#l02007">unistim_ss()</a>, <a class="el" href="chan__h323_8c_source.html#l01170">update_state()</a>, <a class="el" href="chan__usbradio_8c_source.html#l01710">usbradio_answer()</a>, and <a class="el" href="chan__usbradio_8c_source.html#l01696">usbradio_call()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04696"></a>04696 {
<a name="l04697"></a>04697    <span class="keywordtype">int</span> oldstate = chan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>;
<a name="l04698"></a>04698    <span class="keywordtype">char</span> <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>[<a class="code" href="channel_8h.html#ab57c278099ea5f8d7cedbb41eba58b56">AST_CHANNEL_NAME</a>], *dashptr;
<a name="l04699"></a>04699 
<a name="l04700"></a>04700    <span class="keywordflow">if</span> (oldstate == <a class="code" href="structstate.html">state</a>)
<a name="l04701"></a>04701       <span class="keywordflow">return</span> 0;
<a name="l04702"></a>04702 
<a name="l04703"></a>04703    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(name, chan-&gt;name, <span class="keyword">sizeof</span>(name));
<a name="l04704"></a>04704    <span class="keywordflow">if</span> ((dashptr = strrchr(name, <span class="charliteral">&apos;-&apos;</span>))) {
<a name="l04705"></a>04705       *dashptr = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l04706"></a>04706    }
<a name="l04707"></a>04707 
<a name="l04708"></a>04708    chan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> = <a class="code" href="structstate.html">state</a>;
<a name="l04709"></a>04709 
<a name="l04710"></a>04710    <span class="comment">/* We have to pass AST_DEVICE_UNKNOWN here because it is entirely possible that the channel driver</span>
<a name="l04711"></a>04711 <span class="comment">    * for this channel is using the callback method for device state. If we pass in an actual state here</span>
<a name="l04712"></a>04712 <span class="comment">    * we override what they are saying the state is and things go amuck. */</span>
<a name="l04713"></a>04713    <a class="code" href="devicestate_8h.html#a0cc33ebff1ed76c113d17785814b5a47" title="Tells Asterisk the State for Device is changed.">ast_devstate_changed_literal</a>(<a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a">AST_DEVICE_UNKNOWN</a>, name);
<a name="l04714"></a>04714 
<a name="l04715"></a>04715    <span class="comment">/* setstate used to conditionally report Newchannel; this is no more */</span>
<a name="l04716"></a>04716    <a class="code" href="manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208" title="External routines may send asterisk manager events this way.">manager_event</a>(<a class="code" href="manager_8h.html#ab5db3cc603d7e798d61cb4cd94fbb4e2">EVENT_FLAG_CALL</a>,
<a name="l04717"></a>04717             <span class="stringliteral">&quot;Newstate&quot;</span>,
<a name="l04718"></a>04718             <span class="stringliteral">&quot;Channel: %s\r\n&quot;</span>
<a name="l04719"></a>04719             <span class="stringliteral">&quot;ChannelState: %d\r\n&quot;</span>
<a name="l04720"></a>04720             <span class="stringliteral">&quot;ChannelStateDesc: %s\r\n&quot;</span>
<a name="l04721"></a>04721             <span class="stringliteral">&quot;CallerIDNum: %s\r\n&quot;</span>
<a name="l04722"></a>04722             <span class="stringliteral">&quot;CallerIDName: %s\r\n&quot;</span>
<a name="l04723"></a>04723             <span class="stringliteral">&quot;Uniqueid: %s\r\n&quot;</span>,
<a name="l04724"></a>04724             chan-&gt;name, chan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>, <a class="code" href="channel_8h.html#ac97b5983ea4bf3cc217ea898ca002759" title="Gives the string form of a given channel state.">ast_state2str</a>(chan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>),
<a name="l04725"></a>04725             <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>, <span class="stringliteral">&quot;&quot;</span>),
<a name="l04726"></a>04726             <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a>, <span class="stringliteral">&quot;&quot;</span>),
<a name="l04727"></a>04727             chan-&gt;uniqueid);
<a name="l04728"></a>04728 
<a name="l04729"></a>04729    <span class="keywordflow">return</span> 0;
<a name="l04730"></a>04730 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abb39926813ff8874f8e453ca04307e53"></a><!-- doxytag: member="channel.c::ast_settimeout" ref="abb39926813ff8874f8e453ca04307e53" args="(struct ast_channel *c, unsigned int rate, int(*func)(const void *data), void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_settimeout </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>rate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int(*)(const void *data)&nbsp;</td>
          <td class="paramname"> <em>func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Enable or disable timer ticks for a channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rate</em>&nbsp;</td><td><a class="el" href="structnumber.html" title="Number structure.">number</a> of timer ticks per second</td></tr>
  </table>
  </dd>
</dl>
<p>If timers are supported, force a scheduled expiration on the timer fd, at which point we call the callback function / data</p>
<p>Call this function with a rate of 0 to turn off the timer ticks</p>
<dl class="version"><dt><b>Version:</b></dt><dd>1.6.1 changed samples parameter to rate, accomodates new timing methods </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l02405">2405</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="timing_8c_source.html#l00199">ast_timer_get_max_rate()</a>, <a class="el" href="timing_8c_source.html#l00158">ast_timer_set_rate()</a>, <a class="el" href="channel_8h_source.html#l00499">ast_channel::timer</a>, <a class="el" href="channel_8h_source.html#l00417">ast_channel::timingdata</a>, <a class="el" href="channel_8h_source.html#l00468">ast_channel::timingfd</a>, and <a class="el" href="structast__channel.html#a66e8b9811d596825d60c6a58e0b307a4">ast_channel::timingfunc</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l02001">ast_activate_generator()</a>, <a class="el" href="file_8c_source.html#l00887">ast_closestream()</a>, <a class="el" href="channel_8c_source.html#l01956">ast_deactivate_generator()</a>, <a class="el" href="channel_8c_source.html#l02530">ast_read_generator_actions()</a>, <a class="el" href="file_8c_source.html#l00735">ast_readaudio_callback()</a>, and <a class="el" href="file_8c_source.html#l00290">filestream_destructor()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02406"></a>02406 {
<a name="l02407"></a>02407    <span class="keywordtype">int</span> res;
<a name="l02408"></a>02408    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> real_rate = rate, max_rate;
<a name="l02409"></a>02409 
<a name="l02410"></a>02410    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(c);
<a name="l02411"></a>02411 
<a name="l02412"></a>02412    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structast__channel.html#a31160ea68032ecf93ec55a3127edd2f9">timingfd</a> == -1) {
<a name="l02413"></a>02413       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c);
<a name="l02414"></a>02414       <span class="keywordflow">return</span> -1;
<a name="l02415"></a>02415    }
<a name="l02416"></a>02416 
<a name="l02417"></a>02417    <span class="keywordflow">if</span> (!func) {
<a name="l02418"></a>02418       rate = 0;
<a name="l02419"></a>02419       data = NULL;
<a name="l02420"></a>02420    }
<a name="l02421"></a>02421 
<a name="l02422"></a>02422    <span class="keywordflow">if</span> (rate &amp;&amp; rate &gt; (max_rate = <a class="code" href="timing_8h.html#a1d143d561876cec8843bce227c06fed2" title="Get maximum rate supported for a timer.">ast_timer_get_max_rate</a>(c-&gt;<a class="code" href="structast__channel.html#a9aed6490b63794e6c9c00af4533f255f">timer</a>))) {
<a name="l02423"></a>02423       real_rate = max_rate;
<a name="l02424"></a>02424    }
<a name="l02425"></a>02425 
<a name="l02426"></a>02426    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Scheduling timer at (%u requested / %u actual) timer ticks per second\n&quot;</span>, rate, real_rate);
<a name="l02427"></a>02427 
<a name="l02428"></a>02428    res = <a class="code" href="timing_8h.html#a4dae39fb5fb680a48a05d7567053eb03" title="Set the timing tick rate.">ast_timer_set_rate</a>(c-&gt;<a class="code" href="structast__channel.html#a9aed6490b63794e6c9c00af4533f255f">timer</a>, real_rate);
<a name="l02429"></a>02429 
<a name="l02430"></a>02430    c-&gt;<a class="code" href="structast__channel.html#a66e8b9811d596825d60c6a58e0b307a4">timingfunc</a> = func;
<a name="l02431"></a>02431    c-&gt;<a class="code" href="structast__channel.html#adafc0d28570aaa0570be4427407d9015">timingdata</a> = data;
<a name="l02432"></a>02432 
<a name="l02433"></a>02433    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c);
<a name="l02434"></a>02434 
<a name="l02435"></a>02435    <span class="keywordflow">return</span> res;
<a name="l02436"></a>02436 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6b112b17aed018d85c397e7591948793"></a><!-- doxytag: member="channel.c::ast_shutting_down" ref="a6b112b17aed018d85c397e7591948793" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_shutting_down </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns non-zero if Asterisk is being shut down. </p>
<p>Returns non-zero if Asterisk is being shut down </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l00515">515</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l19135">handle_request_options()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00516"></a>00516 {
<a name="l00517"></a>00517    <span class="keywordflow">return</span> <a class="code" href="channel_8c.html#a7f68568851b9c7f9291f7bb63f932c18" title="Prevent new channel allocation if shutting down.">shutting_down</a>;
<a name="l00518"></a>00518 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aaaa09144f0468d0d5f98f1753a6de952"></a><!-- doxytag: member="channel.c::ast_softhangup" ref="aaaa09144f0468d0d5f98f1753a6de952" args="(struct ast_channel *chan, int cause)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_softhangup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cause</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Softly hangup a channel, lock. </p>
<p>Softly hangup up a channel. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01666">1666</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, and <a class="el" href="channel_8c_source.html#l01653">ast_softhangup_nolock()</a>.</p>

<p>Referenced by <a class="el" href="loader_8c_source.html#l00227">__ast_module_user_hangup_all()</a>, <a class="el" href="pbx_8c_source.html#l04214">__ast_pbx_run()</a>, <a class="el" href="chan__dahdi_8c_source.html#l15849">__unload_module()</a>, <a class="el" href="manager_8c_source.html#l01777">action_hangup()</a>, <a class="el" href="chan__agent_8c_source.html#l00893">agent_hangup()</a>, <a class="el" href="chan__agent_8c_source.html#l01684">agent_logoff()</a>, <a class="el" href="chan__agent_8c_source.html#l00519">agent_read()</a>, <a class="el" href="channel_8c_source.html#l00483">ast_begin_shutdown()</a>, <a class="el" href="dial_8c_source.html#l00778">ast_dial_join()</a>, <a class="el" href="app__rpt_8c_source.html#l01509">birdbath()</a>, <a class="el" href="app__meetme_8c_source.html#l01648">conf_free()</a>, <a class="el" href="app__rpt_8c_source.html#l05678">connect_link()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="app__rpt_8c_source.html#l01348">flush_telem()</a>, <a class="el" href="app__rpt_8c_source.html#l05872">function_ilink()</a>, <a class="el" href="res__agi_8c_source.html#l01691">handle_hangup()</a>, <a class="el" href="app__rpt_8c_source.html#l06676">handle_link_data()</a>, <a class="el" href="cli_8c_source.html#l00912">handle_softhangup()</a>, <a class="el" href="chan__agent_8c_source.html#l01981">login_exec()</a>, <a class="el" href="features_8c_source.html#l04401">manager_park()</a>, <a class="el" href="chan__agent_8c_source.html#l01180">read_agent_config()</a>, <a class="el" href="app__rpt_8c_source.html#l10730">rpt()</a>, <a class="el" href="app__rpt_8c_source.html#l05280">rpt_call()</a>, <a class="el" href="app__rpt_8c_source.html#l03090">rpt_do_restart()</a>, <a class="el" href="app__rpt_8c_source.html#l13122">rpt_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l05149">sla_handle_hold_event()</a>, <a class="el" href="app__softhangup_8c_source.html#l00072">softhangup_exec()</a>, <a class="el" href="app__chanspy_8c_source.html#l00409">start_spying()</a>, <a class="el" href="app__mixmonitor_8c_source.html#l00250">startmon()</a>, and <a class="el" href="chan__agent_8c_source.html#l02605">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01667"></a>01667 {
<a name="l01668"></a>01668    <span class="keywordtype">int</span> res;
<a name="l01669"></a>01669 
<a name="l01670"></a>01670    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l01671"></a>01671    res = <a class="code" href="channel_8h.html#ae90da1877e143b996d202d4c88a9c862" title="Softly hangup up a channel (no channel lock).">ast_softhangup_nolock</a>(chan, <a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>);
<a name="l01672"></a>01672    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l01673"></a>01673 
<a name="l01674"></a>01674    <span class="keywordflow">return</span> res;
<a name="l01675"></a>01675 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acd23f45d08b4bfadd20c9d82e8060e50"></a><!-- doxytag: member="channel.c::ast_softhangup_nolock" ref="acd23f45d08b4bfadd20c9d82e8060e50" args="(struct ast_channel *chan, int cause)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_softhangup_nolock </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cause</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Softly hangup a channel, don't lock. </p>
<p>Softly hangup up a channel (no channel lock). </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01653">1653</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00462">ast_channel::_softhangup</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="channel_8h_source.html#l00527">AST_FLAG_BLOCKING</a>, <a class="el" href="frame_8c_source.html#l00124">ast_null_frame</a>, <a class="el" href="channel_8c_source.html#l01080">ast_queue_frame()</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, and <a class="el" href="channel_8h_source.html#l00442">ast_channel::blocker</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l07344">ast_async_goto()</a>, <a class="el" href="channel_8c_source.html#l01666">ast_softhangup()</a>, <a class="el" href="chan__sip_8c_source.html#l18889">attempt_transfer()</a>, <a class="el" href="chan__sip_8c_source.html#l22343">check_rtp_timeout()</a>, <a class="el" href="chan__dahdi_8c_source.html#l14309">dahdi_softhangup_all()</a>, <a class="el" href="chan__h323_8c_source.html#l00856">oh323_indicate()</a>, <a class="el" href="chan__sip_8c_source.html#l22567">proc_session_timer()</a>, <a class="el" href="chan__sip_8c_source.html#l06491">sip_indicate()</a>, and <a class="el" href="chan__skinny_8c_source.html#l04169">skinny_indicate()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01654"></a>01654 {
<a name="l01655"></a>01655    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Soft-Hanging up channel &apos;%s&apos;\n&quot;</span>, chan-&gt;name);
<a name="l01656"></a>01656    <span class="comment">/* Inform channel driver that we need to be hung up, if it cares */</span>
<a name="l01657"></a>01657    chan-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> |= <a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>;
<a name="l01658"></a>01658    <a class="code" href="channel_8h.html#a6cbcba5661d55216968cde8fdf913c89" title="Queue one or more frames to a channel&amp;#39;s frame queue.">ast_queue_frame</a>(chan, &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>);
<a name="l01659"></a>01659    <span class="comment">/* Interrupt any poll call or such */</span>
<a name="l01660"></a>01660    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329ab5b2bec9425dd0cfc789d96ef229cb3a">AST_FLAG_BLOCKING</a>))
<a name="l01661"></a>01661       pthread_kill(chan-&gt;<a class="code" href="structast__channel.html#a0eb129e54ba403f15cae4473dd992ab8">blocker</a>, SIGURG);
<a name="l01662"></a>01662    <span class="keywordflow">return</span> 0;
<a name="l01663"></a>01663 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5dd820022b230cab3e008926e1496b59"></a><!-- doxytag: member="channel.c::ast_state2str" ref="a5dd820022b230cab3e008926e1496b59" args="(enum ast_channel_state state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* ast_state2str </td>
          <td>(</td>
          <td class="paramtype">enum <a class="el" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a>&nbsp;</td>
          <td class="paramname"> <em>state</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Gives the string form of a given channel <a class="el" href="structstate.html">state</a>. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>This function is not reentrant. </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l00656">656</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00366">AST_STATE_BUSY</a>, <a class="el" href="channel_8h_source.html#l00362">AST_STATE_DIALING</a>, <a class="el" href="channel_8h_source.html#l00367">AST_STATE_DIALING_OFFHOOK</a>, <a class="el" href="channel_8h_source.html#l00359">AST_STATE_DOWN</a>, <a class="el" href="channel_8h_source.html#l00361">AST_STATE_OFFHOOK</a>, <a class="el" href="channel_8h_source.html#l00368">AST_STATE_PRERING</a>, <a class="el" href="channel_8h_source.html#l00360">AST_STATE_RESERVED</a>, <a class="el" href="channel_8h_source.html#l00363">AST_STATE_RING</a>, <a class="el" href="channel_8h_source.html#l00364">AST_STATE_RINGING</a>, <a class="el" href="channel_8h_source.html#l00365">AST_STATE_UP</a>, <a class="el" href="threadstorage_8h_source.html#l00191">ast_threadstorage_get()</a>, <a class="el" href="channel_8c_source.html#l00089">STATE2STR_BUFSIZE</a>, and <a class="el" href="channel_8c_source.html#l00088">state2str_threadbuf</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l00772">__ast_channel_alloc_ap()</a>, <a class="el" href="manager_8c_source.html#l02814">action_coreshowchannels()</a>, <a class="el" href="manager_8c_source.html#l01904">action_status()</a>, <a class="el" href="chan__agent_8c_source.html#l00893">agent_hangup()</a>, <a class="el" href="channel_8c_source.html#l04393">ast_do_masquerade()</a>, <a class="el" href="channel_8c_source.html#l04695">ast_setstate()</a>, <a class="el" href="chan__sip_8c_source.html#l18889">attempt_transfer()</a>, <a class="el" href="func__channel_8c_source.html#l00230">func_channel_read()</a>, <a class="el" href="cli_8c_source.html#l00790">handle_chanlist()</a>, <a class="el" href="chan__sip_8c_source.html#l19184">handle_invite_replaces()</a>, <a class="el" href="cli_8c_source.html#l01268">handle_showchan()</a>, <a class="el" href="chan__sip_8c_source.html#l20405">local_attended_transfer()</a>, <a class="el" href="chan__mgcp_8c_source.html#l01470">mgcp_new()</a>, <a class="el" href="app__dumpchan_8c_source.html#l00065">serialize_showchan()</a>, and <a class="el" href="chan__sip_8c_source.html#l05956">sip_hangup()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00657"></a>00657 {
<a name="l00658"></a>00658    <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>;
<a name="l00659"></a>00659 
<a name="l00660"></a>00660    <span class="keywordflow">switch</span> (<a class="code" href="structstate.html">state</a>) {
<a name="l00661"></a>00661    <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>:
<a name="l00662"></a>00662       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Down&quot;</span>;
<a name="l00663"></a>00663    <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660addb60fd97b55a4aea24f992e30fe3c84">AST_STATE_RESERVED</a>:
<a name="l00664"></a>00664       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Rsrvd&quot;</span>;
<a name="l00665"></a>00665    <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a9d7b264ddca4b05135add5d9d48e6271">AST_STATE_OFFHOOK</a>:
<a name="l00666"></a>00666       <span class="keywordflow">return</span> <span class="stringliteral">&quot;OffHook&quot;</span>;
<a name="l00667"></a>00667    <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa70881e902c6c29f27ffba80bb43554f">AST_STATE_DIALING</a>:
<a name="l00668"></a>00668       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Dialing&quot;</span>;
<a name="l00669"></a>00669    <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>:
<a name="l00670"></a>00670       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Ring&quot;</span>;
<a name="l00671"></a>00671    <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>:
<a name="l00672"></a>00672       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Ringing&quot;</span>;
<a name="l00673"></a>00673    <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>:
<a name="l00674"></a>00674       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Up&quot;</span>;
<a name="l00675"></a>00675    <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa00d313d1a4f4502932f1c10bd619591">AST_STATE_BUSY</a>:
<a name="l00676"></a>00676       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Busy&quot;</span>;
<a name="l00677"></a>00677    <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a4e5d21d1ab20653e36109919d6ea72e1">AST_STATE_DIALING_OFFHOOK</a>:
<a name="l00678"></a>00678       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Dialing Offhook&quot;</span>;
<a name="l00679"></a>00679    <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a70a2b40aa2ec0f6f0e7378df7a0810db">AST_STATE_PRERING</a>:
<a name="l00680"></a>00680       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Pre-ring&quot;</span>;
<a name="l00681"></a>00681    <span class="keywordflow">default</span>:
<a name="l00682"></a>00682       <span class="keywordflow">if</span> (!(buf = <a class="code" href="threadstorage_8h.html#a9153839e218c987b2ae47cbd39ac1ab5" title="Retrieve thread storage.">ast_threadstorage_get</a>(&amp;<a class="code" href="channel_8c.html#ae578b94d61d4c2aed2c960c8ac288f2b">state2str_threadbuf</a>, <a class="code" href="channel_8c.html#afd4de5975fd2bcaa99390ba19d28f990">STATE2STR_BUFSIZE</a>)))
<a name="l00683"></a>00683          <span class="keywordflow">return</span> <span class="stringliteral">&quot;Unknown&quot;</span>;
<a name="l00684"></a>00684       snprintf(buf, <a class="code" href="channel_8c.html#afd4de5975fd2bcaa99390ba19d28f990">STATE2STR_BUFSIZE</a>, <span class="stringliteral">&quot;Unknown (%d)&quot;</span>, <a class="code" href="structstate.html">state</a>);
<a name="l00685"></a>00685       <span class="keywordflow">return</span> buf;
<a name="l00686"></a>00686    }
<a name="l00687"></a>00687 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad92341a4a7c70ec0d99fc410dab9b07a"></a><!-- doxytag: member="channel.c::ast_str2cause" ref="ad92341a4a7c70ec0d99fc410dab9b07a" args="(const char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_str2cause </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Convert a symbolic hangup cause to <a class="el" href="structnumber.html" title="Number structure.">number</a>. </p>
<p>Convert the string form of a cause code to a <a class="el" href="structnumber.html" title="Number structure.">number</a></p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>string form of the cause Returns the cause code </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l00642">642</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="channel_8c_source.html#l00136">cause</a>, and <a class="el" href="channel_8c.html#a9bef477e7c7644e0cdaf5c9f0e115204">causes</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l08594">pbx_builtin_hangup()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00643"></a>00643 {
<a name="l00644"></a>00644    <span class="keywordtype">int</span> x;
<a name="l00645"></a>00645 
<a name="l00646"></a>00646    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="channel_8c.html#a9bef477e7c7644e0cdaf5c9f0e115204" title="map AST_CAUSE&amp;#39;s to readable string representations">causes</a>); x++)
<a name="l00647"></a>00647       <span class="keywordflow">if</span> (!strncasecmp(<a class="code" href="channel_8c.html#a9bef477e7c7644e0cdaf5c9f0e115204" title="map AST_CAUSE&amp;#39;s to readable string representations">causes</a>[x].<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, name, strlen(<a class="code" href="channel_8c.html#a9bef477e7c7644e0cdaf5c9f0e115204" title="map AST_CAUSE&amp;#39;s to readable string representations">causes</a>[x].name)))
<a name="l00648"></a>00648          <span class="keywordflow">return</span> <a class="code" href="channel_8c.html#a9bef477e7c7644e0cdaf5c9f0e115204" title="map AST_CAUSE&amp;#39;s to readable string representations">causes</a>[x].<a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>;
<a name="l00649"></a>00649 
<a name="l00650"></a>00650    <span class="keywordflow">return</span> -1;
<a name="l00651"></a>00651 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aec0fd025bfdf11852ceca62636006141"></a><!-- doxytag: member="channel.c::ast_tonepair" ref="aec0fd025bfdf11852ceca62636006141" args="(struct ast_channel *chan, int freq1, int freq2, int duration, int vol)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_tonepair </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>freq1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>freq2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>duration</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>vol</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Play a tone pair for a given amount of time </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l05467">5467</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00462">ast_frfree</a>, <a class="el" href="channel_8c_source.html#l03100">ast_read()</a>, <a class="el" href="channel_8c_source.html#l05449">ast_tonepair_start()</a>, <a class="el" href="channel_8c_source.html#l02389">ast_waitfor()</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, and <a class="el" href="channel_8h_source.html#l00403">ast_channel::generatordata</a>.</p>

<p>Referenced by <a class="el" href="app__zapateller_8c_source.html#l00077">zapateller_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05468"></a>05468 {
<a name="l05469"></a>05469    <span class="keywordtype">int</span> res;
<a name="l05470"></a>05470 
<a name="l05471"></a>05471    <span class="keywordflow">if</span> ((res = <a class="code" href="channel_8h.html#a45670e7ba068c0e69745fc44e2084046">ast_tonepair_start</a>(chan, freq1, freq2, duration, vol)))
<a name="l05472"></a>05472       <span class="keywordflow">return</span> res;
<a name="l05473"></a>05473 
<a name="l05474"></a>05474    <span class="comment">/* Give us some wiggle room */</span>
<a name="l05475"></a>05475    <span class="keywordflow">while</span> (chan-&gt;<a class="code" href="structast__channel.html#abe7876f86e249ea3db5fbacd2231389c">generatordata</a> &amp;&amp; <a class="code" href="channel_8h.html#a60e0bcaed001e8d5ed1ba0eb2644b3cc" title="Wait for input on a channel.">ast_waitfor</a>(chan, 100) &gt;= 0) {
<a name="l05476"></a>05476       <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a> = <a class="code" href="channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1" title="Reads a frame.">ast_read</a>(chan);
<a name="l05477"></a>05477       <span class="keywordflow">if</span> (f)
<a name="l05478"></a>05478          <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l05479"></a>05479       <span class="keywordflow">else</span>
<a name="l05480"></a>05480          <span class="keywordflow">return</span> -1;
<a name="l05481"></a>05481    }
<a name="l05482"></a>05482    <span class="keywordflow">return</span> 0;
<a name="l05483"></a>05483 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a45670e7ba068c0e69745fc44e2084046"></a><!-- doxytag: member="channel.c::ast_tonepair_start" ref="a45670e7ba068c0e69745fc44e2084046" args="(struct ast_channel *chan, int freq1, int freq2, int duration, int vol)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_tonepair_start </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>freq1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>freq2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>duration</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>vol</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Start a tone going </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l05449">5449</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l02001">ast_activate_generator()</a>, <a class="el" href="channel_8c_source.html#l05336">tonepair_def::duration</a>, <a class="el" href="channel_8c_source.html#l05334">tonepair_def::freq1</a>, <a class="el" href="channel_8c_source.html#l05335">tonepair_def::freq2</a>, <a class="el" href="channel_8c_source.html#l05443">tonepair</a>, and <a class="el" href="channel_8c_source.html#l05337">tonepair_def::vol</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l05467">ast_tonepair()</a>, <a class="el" href="pbx_8c_source.html#l08729">pbx_builtin_waitexten()</a>, <a class="el" href="app__disa_8c_source.html#l00125">play_dialtone()</a>, <a class="el" href="app__rpt_8c_source.html#l03251">play_tone_pair()</a>, <a class="el" href="app__rpt_8c_source.html#l03937">rpt_tele_thread()</a>, and <a class="el" href="app__test_8c_source.html#l00135">sendnoise()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05450"></a>05450 {
<a name="l05451"></a>05451    <span class="keyword">struct </span><a class="code" href="structtonepair__def.html">tonepair_def</a> d = { 0, };
<a name="l05452"></a>05452 
<a name="l05453"></a>05453    d.<a class="code" href="structtonepair__def.html#aef0a8374190702d825cd5be4f7c3d16f">freq1</a> = <a class="code" href="structtonepair__def.html#aef0a8374190702d825cd5be4f7c3d16f">freq1</a>;
<a name="l05454"></a>05454    d.<a class="code" href="structtonepair__def.html#ae484cbecf50a6913f24356fc00e34d8e">freq2</a> = <a class="code" href="structtonepair__def.html#ae484cbecf50a6913f24356fc00e34d8e">freq2</a>;
<a name="l05455"></a>05455    d.<a class="code" href="structtonepair__def.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = <a class="code" href="structtonepair__def.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;
<a name="l05456"></a>05456    d.<a class="code" href="structtonepair__def.html#a0865f919827121ede94c816e460e4857">vol</a> = (<a class="code" href="structtonepair__def.html#a0865f919827121ede94c816e460e4857">vol</a> &lt; 1) ? 8192 : <a class="code" href="structtonepair__def.html#a0865f919827121ede94c816e460e4857">vol</a>; <span class="comment">/* force invalid to 8192 */</span>
<a name="l05457"></a>05457    <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a12a58dda74a19f383f6b77cf7fa88b54">ast_activate_generator</a>(chan, &amp;<a class="code" href="channel_8c.html#a982bf142a56c626e34f9d4c3f1a16d15">tonepair</a>, &amp;d))
<a name="l05458"></a>05458       <span class="keywordflow">return</span> -1;
<a name="l05459"></a>05459    <span class="keywordflow">return</span> 0;
<a name="l05460"></a>05460 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afef5134a6fb69fdd9492981dcf52b31a"></a><!-- doxytag: member="channel.c::ast_tonepair_stop" ref="afef5134a6fb69fdd9492981dcf52b31a" args="(struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_tonepair_stop </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Stop a tone from playing </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l05462">5462</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l01956">ast_deactivate_generator()</a>.</p>

<p>Referenced by <a class="el" href="app__test_8c_source.html#l00135">sendnoise()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05463"></a>05463 {
<a name="l05464"></a>05464    <a class="code" href="channel_8h.html#a7160355005776732fba88cc020f4a45b">ast_deactivate_generator</a>(chan);
<a name="l05465"></a>05465 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac6ae24f259d33ae591e76eac023e8b21"></a><!-- doxytag: member="channel.c::ast_transfer" ref="ac6ae24f259d33ae591e76eac023e8b21" args="(struct ast_channel *chan, char *dest)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_transfer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>dest</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Transfer a call to dest, if the channel supports transfer. </p>
<p>Transfer a channel (if supported). Returns -1 on error, 0 if not supported and 1 if supported and requested.</p>
<p>Called by: </p>
<ul>
<li>app_transfer </li>
<li>the manager interface </li>
</ul>

<p>Definition at line <a class="el" href="channel_8c_source.html#l04070">4070</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="channel_8c_source.html#l00461">ast_check_hangup()</a>, <a class="el" href="channel_8h_source.html#l00529">AST_FLAG_ZOMBIE</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>, and <a class="el" href="structast__channel__tech.html#a21c3e9be40870d98c41764090f3afdd4">ast_channel_tech::transfer</a>.</p>

<p>Referenced by <a class="el" href="app__transfer_8c_source.html#l00077">transfer_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04071"></a>04071 {
<a name="l04072"></a>04072    <span class="keywordtype">int</span> res = -1;
<a name="l04073"></a>04073 
<a name="l04074"></a>04074    <span class="comment">/* Stop if we&apos;re a zombie or need a soft hangup */</span>
<a name="l04075"></a>04075    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l04076"></a>04076    <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a26796fa52cc5857446eec8d16a4b718d">AST_FLAG_ZOMBIE</a>) &amp;&amp; !<a class="code" href="channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd" title="Check to see if a channel is needing hang up.">ast_check_hangup</a>(chan)) {
<a name="l04077"></a>04077       <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a21c3e9be40870d98c41764090f3afdd4" title="Blind transfer other side (see app_transfer.c and ast_transfer().">transfer</a>) {
<a name="l04078"></a>04078          res = chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a21c3e9be40870d98c41764090f3afdd4" title="Blind transfer other side (see app_transfer.c and ast_transfer().">transfer</a>(chan, dest);
<a name="l04079"></a>04079          <span class="keywordflow">if</span> (!res)
<a name="l04080"></a>04080             res = 1;
<a name="l04081"></a>04081       } <span class="keywordflow">else</span>
<a name="l04082"></a>04082          res = 0;
<a name="l04083"></a>04083    }
<a name="l04084"></a>04084    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l04085"></a>04085    <span class="keywordflow">return</span> res;
<a name="l04086"></a>04086 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a465c2ce577a0166ceca7e0880339184c"></a><!-- doxytag: member="channel.c::ast_transfercapability2str" ref="a465c2ce577a0166ceca7e0880339184c" args="(int transfercapability)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* ast_transfercapability2str </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>transfercapability</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Gives the string form of a given transfer capability. </p>
<p>Gives the string form of a given transfer capability</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>transfercapability</em>&nbsp;</td><td>transfercapabilty to get the name of Give a name to a transfercapbility See above Returns the text form of the binary transfer capability </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l00690">690</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="transcap_8h_source.html#l00037">AST_TRANS_CAP_3_1K_AUDIO</a>, <a class="el" href="transcap_8h_source.html#l00035">AST_TRANS_CAP_DIGITAL</a>, <a class="el" href="transcap_8h_source.html#l00039">AST_TRANS_CAP_DIGITAL_W_TONES</a>, <a class="el" href="transcap_8h_source.html#l00036">AST_TRANS_CAP_RESTRICTED_DIGITAL</a>, <a class="el" href="transcap_8h_source.html#l00034">AST_TRANS_CAP_SPEECH</a>, and <a class="el" href="transcap_8h_source.html#l00040">AST_TRANS_CAP_VIDEO</a>.</p>

<p>Referenced by <a class="el" href="chan__misdn_8c_source.html#l04379">cb_events()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>, <a class="el" href="chan__misdn_8c_source.html#l02394">misdn_call()</a>, and <a class="el" href="chan__h323_8c_source.html#l00579">oh323_call()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00691"></a>00691 {
<a name="l00692"></a>00692    <span class="keywordflow">switch</span> (transfercapability) {
<a name="l00693"></a>00693    <span class="keywordflow">case</span> <a class="code" href="transcap_8h.html#ac93f64d6735cd701ca6f439121ca49c6">AST_TRANS_CAP_SPEECH</a>:
<a name="l00694"></a>00694       <span class="keywordflow">return</span> <span class="stringliteral">&quot;SPEECH&quot;</span>;
<a name="l00695"></a>00695    <span class="keywordflow">case</span> <a class="code" href="transcap_8h.html#a70df930118839f3fc035fc9f15dfa621">AST_TRANS_CAP_DIGITAL</a>:
<a name="l00696"></a>00696       <span class="keywordflow">return</span> <span class="stringliteral">&quot;DIGITAL&quot;</span>;
<a name="l00697"></a>00697    <span class="keywordflow">case</span> <a class="code" href="transcap_8h.html#a4d6401921d25c164619e2ebe8fd8a47a">AST_TRANS_CAP_RESTRICTED_DIGITAL</a>:
<a name="l00698"></a>00698       <span class="keywordflow">return</span> <span class="stringliteral">&quot;RESTRICTED_DIGITAL&quot;</span>;
<a name="l00699"></a>00699    <span class="keywordflow">case</span> <a class="code" href="transcap_8h.html#ae4b5e973bbe6b7bc710345ca183e6bda">AST_TRANS_CAP_3_1K_AUDIO</a>:
<a name="l00700"></a>00700       <span class="keywordflow">return</span> <span class="stringliteral">&quot;3K1AUDIO&quot;</span>;
<a name="l00701"></a>00701    <span class="keywordflow">case</span> <a class="code" href="transcap_8h.html#a9c47e33087516f67f183da4540ee60a3">AST_TRANS_CAP_DIGITAL_W_TONES</a>:
<a name="l00702"></a>00702       <span class="keywordflow">return</span> <span class="stringliteral">&quot;DIGITAL_W_TONES&quot;</span>;
<a name="l00703"></a>00703    <span class="keywordflow">case</span> <a class="code" href="transcap_8h.html#aebd89c1e90b2497984dd29b4608aaa87">AST_TRANS_CAP_VIDEO</a>:
<a name="l00704"></a>00704       <span class="keywordflow">return</span> <span class="stringliteral">&quot;VIDEO&quot;</span>;
<a name="l00705"></a>00705    <span class="keywordflow">default</span>:
<a name="l00706"></a>00706       <span class="keywordflow">return</span> <span class="stringliteral">&quot;UNKNOWN&quot;</span>;
<a name="l00707"></a>00707    }
<a name="l00708"></a>00708 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9a1bf5906ede80cab6b57627fea47272"></a><!-- doxytag: member="channel.c::ast_uninstall_music_functions" ref="a9a1bf5906ede80cab6b57627fea47272" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_uninstall_music_functions </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l05530">5530</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c.html#a83c5734824bc16e2228e1cb9ec40d0fb">ast_moh_cleanup_ptr</a>, <a class="el" href="channel_8c.html#ab61499493f5ff948a579c4c4515ef594">ast_moh_start_ptr</a>, and <a class="el" href="channel_8c.html#a0b1ab6a1da92f08402ac4df80b8d9512">ast_moh_stop_ptr</a>.</p>

<p>Referenced by <a class="el" href="res__musiconhold_8c_source.html#l01823">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05531"></a>05531 {
<a name="l05532"></a>05532    <a class="code" href="channel_8c.html#ab61499493f5ff948a579c4c4515ef594">ast_moh_start_ptr</a> = NULL;
<a name="l05533"></a>05533    <a class="code" href="channel_8c.html#a0b1ab6a1da92f08402ac4df80b8d9512">ast_moh_stop_ptr</a> = NULL;
<a name="l05534"></a>05534    <a class="code" href="channel_8c.html#a83c5734824bc16e2228e1cb9ec40d0fb">ast_moh_cleanup_ptr</a> = NULL;
<a name="l05535"></a>05535 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aed7cba5dd8c6d31600f50d4b3f68d9ca"></a><!-- doxytag: member="channel.c::ast_waitfor" ref="aed7cba5dd8c6d31600f50d4b3f68d9ca" args="(struct ast_channel *c, int ms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_waitfor </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ms</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Wait for input on a channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel to wait on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ms</em>&nbsp;</td><td>length of time to wait on the channel Wait for input on a channel for a given # of milliseconds (&lt;0 for indefinite). </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns &lt; 0 on failure, 0 if nothing ever arrived, and the # of ms remaining otherwise </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l02389">2389</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l02041">ast_waitfor_nandfds()</a>.</p>

<p>Referenced by <a class="el" href="res__adsi_8c_source.html#l00193">__adsi_transmit_messages()</a>, <a class="el" href="channel_8c_source.html#l01850">__ast_answer()</a>, <a class="el" href="app_8c_source.html#l00668">__ast_play_and_record()</a>, <a class="el" href="channel_8c_source.html#l03851">__ast_request_and_dial()</a>, <a class="el" href="res__adsi_8c_source.html#l00117">adsi_careful_send()</a>, <a class="el" href="chan__agent_8c_source.html#l01028">agent_ack_sleep()</a>, <a class="el" href="app_8c_source.html#l00314">ast_dtmf_stream()</a>, <a class="el" href="channel_8c_source.html#l03275">ast_recvtext()</a>, <a class="el" href="channel_8c_source.html#l01328">ast_safe_sleep_conditional()</a>, <a class="el" href="channel_8c_source.html#l05467">ast_tonepair()</a>, <a class="el" href="pbx_8c_source.html#l07853">async_wait()</a>, <a class="el" href="app__talkdetect_8c_source.html#l00076">background_detect_exec()</a>, <a class="el" href="app__chanspy_8c_source.html#l00445">channel_spy()</a>, <a class="el" href="app__dahdiscan_8c_source.html#l00290">conf_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l01617">conf_flush()</a>, <a class="el" href="app__dictate_8c_source.html#l00084">dictate_exec()</a>, <a class="el" href="app__disa_8c_source.html#l00143">disa_exec()</a>, <a class="el" href="app__waitforsilence_8c_source.html#l00125">do_waiting()</a>, <a class="el" href="app__echo_8c_source.html#l00051">echo_exec()</a>, <a class="el" href="res__agi_8c_source.html#l01494">handle_recordfile()</a>, <a class="el" href="res__agi_8c_source.html#l02137">handle_speechrecognize()</a>, <a class="el" href="app__ices_8c_source.html#l00107">ices_exec()</a>, <a class="el" href="app__amd_8c_source.html#l00146">isAnsweringMachine()</a>, <a class="el" href="app__jack_8c_source.html#l00743">jack_exec()</a>, <a class="el" href="res__agi_8c_source.html#l00617">launch_asyncagi()</a>, <a class="el" href="app__test_8c_source.html#l00080">measurenoise()</a>, <a class="el" href="app__mp3_8c_source.html#l00120">mp3_exec()</a>, <a class="el" href="app__nbscat_8c_source.html#l00108">NBScat_exec()</a>, <a class="el" href="app__alarmreceiver_8c_source.html#l00232">receive_dtmf_digits()</a>, <a class="el" href="app__record_8c_source.html#l00132">record_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l04359">recordthread()</a>, <a class="el" href="app__alarmreceiver_8c_source.html#l00167">send_tone_burst()</a>, <a class="el" href="app__festival_8c_source.html#l00161">send_waveform_to_channel()</a>, <a class="el" href="app__url_8c_source.html#l00093">sendurl_exec()</a>, <a class="el" href="app__speech__utils_8c_source.html#l00639">speech_background()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>, <a class="el" href="app__fax_8c_source.html#l00362">transmit_audio()</a>, <a class="el" href="app__fax_8c_source.html#l00599">transmit_t38()</a>, <a class="el" href="pbx_8c_source.html#l08422">wait_for_hangup()</a>, <a class="el" href="app__waitforring_8c_source.html#l00056">waitforring_exec()</a>, and <a class="el" href="file_8c_source.html#l01168">waitstream_core()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02390"></a>02390 {
<a name="l02391"></a>02391    <span class="keywordtype">int</span> oldms = ms;   <span class="comment">/* -1 if no timeout */</span>
<a name="l02392"></a>02392 
<a name="l02393"></a>02393    <a class="code" href="channel_8h.html#a5e62602ca9e229304f60ab5c2b32e13b" title="Waits for activity on a group of channels.">ast_waitfor_nandfds</a>(&amp;c, 1, NULL, 0, NULL, NULL, &amp;ms);
<a name="l02394"></a>02394    <span class="keywordflow">if</span> ((ms &lt; 0) &amp;&amp; (oldms &lt; 0))
<a name="l02395"></a>02395       ms = 0;
<a name="l02396"></a>02396    <span class="keywordflow">return</span> ms;
<a name="l02397"></a>02397 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac7ca5a25b9aad3ecedef29c3725ef112"></a><!-- doxytag: member="channel.c::ast_waitfor_n" ref="ac7ca5a25b9aad3ecedef29c3725ef112" args="(struct ast_channel **c, int n, int *ms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__channel.html">ast_channel</a>* ast_waitfor_n </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> **&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>ms</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Waits for input on a <a class="el" href="structgroup.html">group</a> of <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> Wait for input on an array of <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> for a given # of milliseconds. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>Return channel with activity, or NULL if none has activity. </dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>an array of pointers to <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>n</em>&nbsp;</td><td><a class="el" href="structnumber.html" title="Number structure.">number</a> of <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> that are to be waited upon </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ms</em>&nbsp;</td><td>time "ms" is modified in-place, if applicable </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l02384">2384</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l02041">ast_waitfor_nandfds()</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l04776">ast_generic_bridge()</a>, <a class="el" href="udptl_8c_source.html#l01150">ast_udptl_bridge()</a>, <a class="el" href="autoservice_8c_source.html#l00073">autoservice_run()</a>, <a class="el" href="rtp_8c_source.html#l03915">bridge_native_loop()</a>, <a class="el" href="rtp_8c_source.html#l04223">bridge_p2p_loop()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05156">dahdi_bridge()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="features_8c_source.html#l02152">feature_request_and_dial()</a>, <a class="el" href="bridging_8c_source.html#l00325">generic_thread_loop()</a>, <a class="el" href="chan__iax2_8c_source.html#l05170">iax2_bridge()</a>, <a class="el" href="chan__misdn_8c_source.html#l03228">misdn_bridge()</a>, <a class="el" href="dial_8c_source.html#l00535">monitor_dial()</a>, <a class="el" href="app__rpt_8c_source.html#l10730">rpt()</a>, <a class="el" href="app__rpt_8c_source.html#l13122">rpt_exec()</a>, <a class="el" href="app__dial_8c_source.html#l00818">wait_for_answer()</a>, and <a class="el" href="app__followme_8c_source.html#l00509">wait_for_winner()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02385"></a>02385 {
<a name="l02386"></a>02386    <span class="keywordflow">return</span> <a class="code" href="channel_8h.html#a5e62602ca9e229304f60ab5c2b32e13b" title="Waits for activity on a group of channels.">ast_waitfor_nandfds</a>(c, n, NULL, 0, NULL, NULL, ms);
<a name="l02387"></a>02387 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a56819f90869d77808fd52f4d2693a75c"></a><!-- doxytag: member="channel.c::ast_waitfor_n_fd" ref="a56819f90869d77808fd52f4d2693a75c" args="(int *fds, int n, int *ms, int *exception)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_waitfor_n_fd </td>
          <td>(</td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>fds</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>ms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>exception</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Wait for x amount of time on a file descriptor to have input. </p>
<p>Waits for input on an fd This version works on fd's only. Be careful with it. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l02029">2029</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l02041">ast_waitfor_nandfds()</a>.</p>

<p>Referenced by <a class="el" href="pbx__dundi_8c_source.html#l03574">dundi_lookup_internal()</a>, <a class="el" href="pbx__dundi_8c_source.html#l03747">dundi_precache_internal()</a>, and <a class="el" href="bridge__softmix_8c_source.html#l00211">softmix_bridge_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02030"></a>02030 {
<a name="l02031"></a>02031    <span class="keywordtype">int</span> winner = -1;
<a name="l02032"></a>02032    <a class="code" href="channel_8h.html#a5e62602ca9e229304f60ab5c2b32e13b" title="Waits for activity on a group of channels.">ast_waitfor_nandfds</a>(NULL, 0, fds, n, exception, &amp;winner, ms);
<a name="l02033"></a>02033    <span class="keywordflow">return</span> winner;
<a name="l02034"></a>02034 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2e63eaa5b4d94f214edf99838ef7e7e4"></a><!-- doxytag: member="channel.c::ast_waitfor_nandfds" ref="a2e63eaa5b4d94f214edf99838ef7e7e4" args="(struct ast_channel **c, int n, int *fds, int nfds, int *exception, int *outfd, int *ms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__channel.html">ast_channel</a>* ast_waitfor_nandfds </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> **&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>fds</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nfds</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>exception</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>outfd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>ms</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Wait for x amount of time on a file descriptor to have input. </p>
<p>Waits for activity on a <a class="el" href="structgroup.html">group</a> of <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l02041">2041</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00462">ast_channel::_softhangup</a>, <a class="el" href="channel_8h_source.html#l01677">ast_add_fd()</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="utils_8h_source.html#l00075">ast_clear_flag</a>, <a class="el" href="channel_8c_source.html#l04393">ast_do_masquerade()</a>, <a class="el" href="channel_8h_source.html#l00527">AST_FLAG_BLOCKING</a>, <a class="el" href="channel_8h_source.html#l00531">AST_FLAG_EXCEPTION</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8h_source.html#l00153">AST_MAX_FDS</a>, <a class="el" href="poll-compat_8h_source.html#l00086">ast_poll</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="channel_8h_source.html#l00637">AST_SOFTHANGUP_TIMEOUT</a>, <a class="el" href="time_8h_source.html#l00119">ast_tvcmp()</a>, <a class="el" href="time_8h_source.html#l00089">ast_tvdiff_ms()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="utils_8c_source.html#l01379">ast_tvsub()</a>, <a class="el" href="time_8h_source.html#l00099">ast_tvzero()</a>, <a class="el" href="channel_8h_source.html#l01763">CHECK_BLOCKING</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="channel_8h_source.html#l00464">ast_channel::fdno</a>, and <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l02389">ast_waitfor()</a>, <a class="el" href="channel_8c_source.html#l02384">ast_waitfor_n()</a>, <a class="el" href="channel_8c_source.html#l02029">ast_waitfor_n_fd()</a>, <a class="el" href="channel_8c_source.html#l02438">ast_waitfordigit_full()</a>, <a class="el" href="bridging_8c_source.html#l00698">bridge_channel_join_multithreaded()</a>, <a class="el" href="app__dahdibarge_8c_source.html#l00095">conf_run()</a>, <a class="el" href="app__externalivr_8c_source.html#l00521">eivr_comm()</a>, <a class="el" href="chan__iax2_8c_source.html#l13074">find_cache()</a>, <a class="el" href="bridge__multiplexed_8c_source.html#l00200">multiplexed_thread_function()</a>, <a class="el" href="res__agi_8c_source.html#l02853">run_agi()</a>, and <a class="el" href="file_8c_source.html#l01168">waitstream_core()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02044"></a>02044 {
<a name="l02045"></a>02045    <span class="keyword">struct </span>timeval start = { 0 , 0 };
<a name="l02046"></a>02046    <span class="keyword">struct </span>pollfd *pfds = NULL;
<a name="l02047"></a>02047    <span class="keywordtype">int</span> res;
<a name="l02048"></a>02048    <span class="keywordtype">long</span> rms;
<a name="l02049"></a>02049    <span class="keywordtype">int</span> x, y, max;
<a name="l02050"></a>02050    <span class="keywordtype">int</span> sz;
<a name="l02051"></a>02051    <span class="keyword">struct </span>timeval now = { 0, 0 };
<a name="l02052"></a>02052    <span class="keyword">struct </span>timeval whentohangup = { 0, 0 }, diff;
<a name="l02053"></a>02053    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *winner = NULL;
<a name="l02054"></a>02054    <span class="keyword">struct </span>fdmap {
<a name="l02055"></a>02055       <span class="keywordtype">int</span> <a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>;
<a name="l02056"></a>02056       <span class="keywordtype">int</span> fdno;
<a name="l02057"></a>02057    } *fdmap = NULL;
<a name="l02058"></a>02058 
<a name="l02059"></a>02059    <span class="keywordflow">if</span> ((sz = n * <a class="code" href="channel_8h.html#aa3fc504e7ca90586e4d249831838de3c">AST_MAX_FDS</a> + nfds)) {
<a name="l02060"></a>02060       pfds = alloca(<span class="keyword">sizeof</span>(*pfds) * sz);
<a name="l02061"></a>02061       fdmap = alloca(<span class="keyword">sizeof</span>(*fdmap) * sz);
<a name="l02062"></a>02062    }
<a name="l02063"></a>02063 
<a name="l02064"></a>02064    <span class="keywordflow">if</span> (outfd)
<a name="l02065"></a>02065       *outfd = -99999;
<a name="l02066"></a>02066    <span class="keywordflow">if</span> (exception)
<a name="l02067"></a>02067       *exception = 0;
<a name="l02068"></a>02068    
<a name="l02069"></a>02069    <span class="comment">/* Perform any pending masquerades */</span>
<a name="l02070"></a>02070    <span class="keywordflow">for</span> (x = 0; x &lt; n; x++) {
<a name="l02071"></a>02071       <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(c[x]);
<a name="l02072"></a>02072       <span class="keywordflow">if</span> (c[x]-&gt;masq &amp;&amp; <a class="code" href="channel_8h.html#ab26f03fb10f1b2e8e52bfbbb1ee02f78" title="Start masquerading a channel XXX This is a seriously whacked out operation. We&amp;#39;re...">ast_do_masquerade</a>(c[x])) {
<a name="l02073"></a>02073          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Masquerade failed\n&quot;</span>);
<a name="l02074"></a>02074          *ms = -1;
<a name="l02075"></a>02075          <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c[x]);
<a name="l02076"></a>02076          <span class="keywordflow">return</span> NULL;
<a name="l02077"></a>02077       }
<a name="l02078"></a>02078       <span class="keywordflow">if</span> (!<a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(c[x]-&gt;whentohangup)) {
<a name="l02079"></a>02079          <span class="keywordflow">if</span> (<a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(whentohangup))
<a name="l02080"></a>02080             now = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l02081"></a>02081          diff = <a class="code" href="time_8h.html#aa13b651c18bc6004cab21ac041d44dd8" title="Returns the difference of two timevals a - b.">ast_tvsub</a>(c[x]-&gt;whentohangup, now);
<a name="l02082"></a>02082          <span class="keywordflow">if</span> (diff.tv_sec &lt; 0 || <a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(diff)) {
<a name="l02083"></a>02083             <span class="comment">/* Should already be hungup */</span>
<a name="l02084"></a>02084             c[x]-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> |= <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709a90cd950abc1c22b0701a476bdd6cc246">AST_SOFTHANGUP_TIMEOUT</a>;
<a name="l02085"></a>02085             <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c[x]);
<a name="l02086"></a>02086             <span class="keywordflow">return</span> c[x];
<a name="l02087"></a>02087          }
<a name="l02088"></a>02088          <span class="keywordflow">if</span> (<a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(whentohangup) || <a class="code" href="time_8h.html#acc9e13e54ed18f92956c748a38f82430" title="Compres two struct timeval instances returning -1, 0, 1 if the first arg is smaller...">ast_tvcmp</a>(diff, whentohangup) &lt; 0)
<a name="l02089"></a>02089             whentohangup = diff;
<a name="l02090"></a>02090       }
<a name="l02091"></a>02091       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c[x]);
<a name="l02092"></a>02092    }
<a name="l02093"></a>02093    <span class="comment">/* Wait full interval */</span>
<a name="l02094"></a>02094    rms = *ms;
<a name="l02095"></a>02095    <span class="keywordflow">if</span> (!<a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(whentohangup)) {
<a name="l02096"></a>02096       rms = whentohangup.tv_sec * 1000 + whentohangup.tv_usec / 1000;              <span class="comment">/* timeout in milliseconds */</span>
<a name="l02097"></a>02097       <span class="keywordflow">if</span> (*ms &gt;= 0 &amp;&amp; *ms &lt; rms)    <span class="comment">/* original *ms still smaller */</span>
<a name="l02098"></a>02098          rms =  *ms;
<a name="l02099"></a>02099    }
<a name="l02100"></a>02100    <span class="comment">/*</span>
<a name="l02101"></a>02101 <span class="comment">    * Build the pollfd array, putting the channels&apos; fds first,</span>
<a name="l02102"></a>02102 <span class="comment">    * followed by individual fds. Order is important because</span>
<a name="l02103"></a>02103 <span class="comment">    * individual fd&apos;s must have priority over channel fds.</span>
<a name="l02104"></a>02104 <span class="comment">    */</span>
<a name="l02105"></a>02105    max = 0;
<a name="l02106"></a>02106    <span class="keywordflow">for</span> (x = 0; x &lt; n; x++) {
<a name="l02107"></a>02107       <span class="keywordflow">for</span> (y = 0; y &lt; <a class="code" href="channel_8h.html#aa3fc504e7ca90586e4d249831838de3c">AST_MAX_FDS</a>; y++) {
<a name="l02108"></a>02108          fdmap[max].fdno = y;  <span class="comment">/* fd y is linked to this pfds */</span>
<a name="l02109"></a>02109          fdmap[max].chan = x;  <span class="comment">/* channel x is linked to this pfds */</span>
<a name="l02110"></a>02110          max += <a class="code" href="channel_8h.html#ad375082fcf73a6a755d611a64cac2659" title="if fd is a valid descriptor, set *pfd with the descriptor">ast_add_fd</a>(&amp;pfds[max], c[x]-&gt;fds[y]);
<a name="l02111"></a>02111       }
<a name="l02112"></a>02112       <a class="code" href="channel_8h.html#a3a5d847510a477edda3d0bc1459709f4">CHECK_BLOCKING</a>(c[x]);
<a name="l02113"></a>02113    }
<a name="l02114"></a>02114    <span class="comment">/* Add the individual fds */</span>
<a name="l02115"></a>02115    <span class="keywordflow">for</span> (x = 0; x &lt; nfds; x++) {
<a name="l02116"></a>02116       fdmap[max].chan = -1;
<a name="l02117"></a>02117       max += <a class="code" href="channel_8h.html#ad375082fcf73a6a755d611a64cac2659" title="if fd is a valid descriptor, set *pfd with the descriptor">ast_add_fd</a>(&amp;pfds[max], fds[x]);
<a name="l02118"></a>02118    }
<a name="l02119"></a>02119 
<a name="l02120"></a>02120    <span class="keywordflow">if</span> (*ms &gt; 0)
<a name="l02121"></a>02121       start = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l02122"></a>02122    
<a name="l02123"></a>02123    <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) == 4) { <span class="comment">/* XXX fix timeout &gt; 600000 on linux x86-32 */</span>
<a name="l02124"></a>02124       <span class="keywordflow">do</span> {
<a name="l02125"></a>02125          <span class="keywordtype">int</span> kbrms = rms;
<a name="l02126"></a>02126          <span class="keywordflow">if</span> (kbrms &gt; 600000)
<a name="l02127"></a>02127             kbrms = 600000;
<a name="l02128"></a>02128          res = <a class="code" href="poll-compat_8h.html#a5a0c58fa8311e94cd0ed34382aa822f9">ast_poll</a>(pfds, max, kbrms);
<a name="l02129"></a>02129          <span class="keywordflow">if</span> (!res)
<a name="l02130"></a>02130             rms -= kbrms;
<a name="l02131"></a>02131       } <span class="keywordflow">while</span> (!res &amp;&amp; (rms &gt; 0));
<a name="l02132"></a>02132    } <span class="keywordflow">else</span> {
<a name="l02133"></a>02133       res = <a class="code" href="poll-compat_8h.html#a5a0c58fa8311e94cd0ed34382aa822f9">ast_poll</a>(pfds, max, rms);
<a name="l02134"></a>02134    }
<a name="l02135"></a>02135    <span class="keywordflow">for</span> (x = 0; x &lt; n; x++)
<a name="l02136"></a>02136       <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(c[x], <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329ab5b2bec9425dd0cfc789d96ef229cb3a">AST_FLAG_BLOCKING</a>);
<a name="l02137"></a>02137    <span class="keywordflow">if</span> (res &lt; 0) { <span class="comment">/* Simulate a timeout if we were interrupted */</span>
<a name="l02138"></a>02138       <span class="keywordflow">if</span> (errno != EINTR)
<a name="l02139"></a>02139          *ms = -1;
<a name="l02140"></a>02140       <span class="keywordflow">return</span> NULL;
<a name="l02141"></a>02141    }
<a name="l02142"></a>02142    <span class="keywordflow">if</span> (!<a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(whentohangup)) {   <span class="comment">/* if we have a timeout, check who expired */</span>
<a name="l02143"></a>02143       now = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l02144"></a>02144       <span class="keywordflow">for</span> (x = 0; x &lt; n; x++) {
<a name="l02145"></a>02145          <span class="keywordflow">if</span> (!<a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(c[x]-&gt;whentohangup) &amp;&amp; <a class="code" href="time_8h.html#acc9e13e54ed18f92956c748a38f82430" title="Compres two struct timeval instances returning -1, 0, 1 if the first arg is smaller...">ast_tvcmp</a>(c[x]-&gt;whentohangup, now) &lt;= 0) {
<a name="l02146"></a>02146             c[x]-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> |= <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709a90cd950abc1c22b0701a476bdd6cc246">AST_SOFTHANGUP_TIMEOUT</a>;
<a name="l02147"></a>02147             <span class="keywordflow">if</span> (winner == NULL)
<a name="l02148"></a>02148                winner = c[x];
<a name="l02149"></a>02149          }
<a name="l02150"></a>02150       }
<a name="l02151"></a>02151    }
<a name="l02152"></a>02152    <span class="keywordflow">if</span> (res == 0) { <span class="comment">/* no fd ready, reset timeout and done */</span>
<a name="l02153"></a>02153       *ms = 0; <span class="comment">/* XXX use 0 since we may not have an exact timeout. */</span>
<a name="l02154"></a>02154       <span class="keywordflow">return</span> winner;
<a name="l02155"></a>02155    }
<a name="l02156"></a>02156    <span class="comment">/*</span>
<a name="l02157"></a>02157 <span class="comment">    * Then check if any channel or fd has a pending event.</span>
<a name="l02158"></a>02158 <span class="comment">    * Remember to check channels first and fds last, as they</span>
<a name="l02159"></a>02159 <span class="comment">    * must have priority on setting &apos;winner&apos;</span>
<a name="l02160"></a>02160 <span class="comment">    */</span>
<a name="l02161"></a>02161    <span class="keywordflow">for</span> (x = 0; x &lt; max; x++) {
<a name="l02162"></a>02162       res = pfds[x].revents;
<a name="l02163"></a>02163       <span class="keywordflow">if</span> (res == 0)
<a name="l02164"></a>02164          <span class="keywordflow">continue</span>;
<a name="l02165"></a>02165       <span class="keywordflow">if</span> (fdmap[x].<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a> &gt;= 0) {  <span class="comment">/* this is a channel */</span>
<a name="l02166"></a>02166          winner = c[fdmap[x].chan]; <span class="comment">/* override previous winners */</span>
<a name="l02167"></a>02167          <span class="keywordflow">if</span> (res &amp; POLLPRI)
<a name="l02168"></a>02168             <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(winner, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a75202bcfa58fce5d40e2daddc73b8d11">AST_FLAG_EXCEPTION</a>);
<a name="l02169"></a>02169          <span class="keywordflow">else</span>
<a name="l02170"></a>02170             <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(winner, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a75202bcfa58fce5d40e2daddc73b8d11">AST_FLAG_EXCEPTION</a>);
<a name="l02171"></a>02171          winner-&gt;<a class="code" href="structast__channel.html#a3a804162c4be609a8def28f69b3e93b2">fdno</a> = fdmap[x].fdno;
<a name="l02172"></a>02172       } <span class="keywordflow">else</span> {       <span class="comment">/* this is an fd */</span>
<a name="l02173"></a>02173          <span class="keywordflow">if</span> (outfd)
<a name="l02174"></a>02174             *outfd = pfds[x].fd;
<a name="l02175"></a>02175          <span class="keywordflow">if</span> (exception)
<a name="l02176"></a>02176             *exception = (res &amp; POLLPRI) ? -1 : 0;
<a name="l02177"></a>02177          winner = NULL;
<a name="l02178"></a>02178       }
<a name="l02179"></a>02179    }
<a name="l02180"></a>02180    <span class="keywordflow">if</span> (*ms &gt; 0) {
<a name="l02181"></a>02181       *ms -= <a class="code" href="time_8h.html#a74e35cffcd45ad6cd7c8587921e8a4c2" title="Computes the difference (in milliseconds) between two struct timeval instances.">ast_tvdiff_ms</a>(<a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>(), start);
<a name="l02182"></a>02182       <span class="keywordflow">if</span> (*ms &lt; 0)
<a name="l02183"></a>02183          *ms = 0;
<a name="l02184"></a>02184    }
<a name="l02185"></a>02185    <span class="keywordflow">return</span> winner;
<a name="l02186"></a>02186 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a050bec9a4abc1a599b6573a6091b080c"></a><!-- doxytag: member="channel.c::ast_waitfordigit" ref="a050bec9a4abc1a599b6573a6091b080c" args="(struct ast_channel *c, int ms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_waitfordigit </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ms</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Waits for a digit. </p>
<p>!</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c</em>&nbsp;</td><td>channel to wait for a digit on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ms</em>&nbsp;</td><td>how many milliseconds to wait </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns &lt;0 on error, 0 on no entry, and the digit on success. </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l02400">2400</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l02438">ast_waitfordigit_full()</a>.</p>

<p>Referenced by <a class="el" href="res__adsi_8c_source.html#l00584">_ast_adsi_get_cpeid()</a>, <a class="el" href="res__adsi_8c_source.html#l00615">_ast_adsi_get_cpeinfo()</a>, <a class="el" href="res__adsi_8c_source.html#l00917">_ast_adsi_print()</a>, <a class="el" href="res__adsi_8c_source.html#l00550">_ast_adsi_read_encoded_dtmf()</a>, <a class="el" href="res__adsi_8c_source.html#l00341">_ast_adsi_transmit_message_full()</a>, <a class="el" href="app__while_8c_source.html#l00189">_while_exec()</a>, <a class="el" href="app__voicemail_8c_source.html#l11416">advanced_options()</a>, <a class="el" href="app_8c_source.html#l00076">ast_app_dtget()</a>, <a class="el" href="app_8c_source.html#l00496">ast_control_streamfile()</a>, <a class="el" href="app_8c_source.html#l01439">ast_record_review()</a>, <a class="el" href="bridging_8c_source.html#l00778">bridge_channel_feature()</a>, <a class="el" href="features_8c_source.html#l01396">builtin_atxfer()</a>, <a class="el" href="pbx_8c_source.html#l04188">collect_digits()</a>, <a class="el" href="app__chanspy_8c_source.html#l00767">common_exec()</a>, <a class="el" href="app__getcpeid_8c_source.html#l00064">cpeid_exec()</a>, <a class="el" href="app__voicemail_8c_source.html#l11344">dialout()</a>, <a class="el" href="app__directory_8c_source.html#l00723">directory_exec()</a>, <a class="el" href="app__voicemail_8c_source.html#l06582">forward_message()</a>, <a class="el" href="app__voicemail_8c_source.html#l06238">get_folder()</a>, <a class="el" href="app_8c_source.html#l01540">ivr_dispatch()</a>, <a class="el" href="chan__mgcp_8c_source.html#l02637">mgcp_ss()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07616">my_getsigstr()</a>, <a class="el" href="pbx_8c_source.html#l08729">pbx_builtin_waitexten()</a>, <a class="el" href="app__minivm_8c_source.html#l01378">play_record_review()</a>, <a class="el" href="app__read_8c_source.html#l00127">read_exec()</a>, <a class="el" href="app_8c_source.html#l01632">read_newoption()</a>, <a class="el" href="app__readexten_8c_source.html#l00128">readexten_exec()</a>, <a class="el" href="app__dial_8c_source.html#l02345">retrydial_exec()</a>, <a class="el" href="app__directory_8c_source.html#l00322">select_item_menu()</a>, <a class="el" href="app__directory_8c_source.html#l00287">select_item_seq()</a>, <a class="el" href="app__test_8c_source.html#l00135">sendnoise()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>, <a class="el" href="app__test_8c_source.html#l00146">testclient_exec()</a>, <a class="el" href="app__test_8c_source.html#l00320">testserver_exec()</a>, <a class="el" href="app__voicemail_8c_source.html#l09099">vm_execmain()</a>, <a class="el" href="app__voicemail_8c_source.html#l06307">vm_forwardoptions()</a>, <a class="el" href="app__voicemail_8c_source.html#l08382">vm_instructions_en()</a>, <a class="el" href="app__voicemail_8c_source.html#l08588">vm_options()</a>, <a class="el" href="app__voicemail_8c_source.html#l08725">vm_tempgreeting()</a>, <a class="el" href="app__queue_8c_source.html#l04318">wait_a_bit()</a>, and <a class="el" href="app__queue_8c_source.html#l03195">wait_our_turn()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02401"></a>02401 {
<a name="l02402"></a>02402    <span class="keywordflow">return</span> <a class="code" href="channel_8h.html#af4725a9cfbacf4db094408fe1406f0ef" title="Wait for a digit Same as ast_waitfordigit() with audio fd for outputting read audio...">ast_waitfordigit_full</a>(c, ms, -1, -1);
<a name="l02403"></a>02403 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab3a4bbc285abf43d520fa3cbfb320464"></a><!-- doxytag: member="channel.c::ast_waitfordigit_full" ref="ab3a4bbc285abf43d520fa3cbfb320464" args="(struct ast_channel *c, int ms, int audiofd, int cmdfd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_waitfordigit_full </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>audiofd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ctrlfd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Wait for a digit Same as <a class="el" href="channel_8h.html#a050bec9a4abc1a599b6573a6091b080c" title="Waits for a digit.">ast_waitfordigit()</a> with audio fd for outputting read audio and ctrlfd to monitor for reading. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c</em>&nbsp;</td><td>channel to wait for a digit on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ms</em>&nbsp;</td><td>how many milliseconds to wait </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>audiofd</em>&nbsp;</td><td>audio file descriptor to write to if audio frames are received </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ctrlfd</em>&nbsp;</td><td>control file descriptor to monitor for reading </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns 1 if ctrlfd becomes available </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l02438">2438</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l00461">ast_check_hangup()</a>, <a class="el" href="utils_8h_source.html#l00075">ast_clear_flag</a>, <a class="el" href="frame_8h_source.html#l00301">AST_CONTROL_ANSWER</a>, <a class="el" href="frame_8h_source.html#l00298">AST_CONTROL_HANGUP</a>, <a class="el" href="frame_8h_source.html#l00300">AST_CONTROL_RINGING</a>, <a class="el" href="frame_8h_source.html#l00317">AST_CONTROL_SRCUPDATE</a>, <a class="el" href="channel_8h_source.html#l00551">AST_FLAG_END_DTMF_ONLY</a>, <a class="el" href="channel_8h_source.html#l00529">AST_FLAG_ZOMBIE</a>, <a class="el" href="frame_8h_source.html#l00105">AST_FRAME_CONTROL</a>, <a class="el" href="frame_8h_source.html#l00122">AST_FRAME_DTMF_BEGIN</a>, <a class="el" href="frame_8h_source.html#l00099">AST_FRAME_DTMF_END</a>, <a class="el" href="frame_8h_source.html#l00101">AST_FRAME_VOICE</a>, <a class="el" href="frame_8h_source.html#l00462">ast_frfree</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8c_source.html#l03100">ast_read()</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="channel_8c_source.html#l02041">ast_waitfor_nandfds()</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="frame_8h_source.html#l00147">ast_frame::datalen</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::ptr</a>, and <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l04093">ast_readstring_full()</a>, <a class="el" href="channel_8c_source.html#l02400">ast_waitfordigit()</a>, <a class="el" href="res__agi_8c_source.html#l01239">handle_getoption()</a>, and <a class="el" href="res__agi_8c_source.html#l01041">handle_waitfordigit()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02439"></a>02439 {
<a name="l02440"></a>02440    <span class="comment">/* Stop if we&apos;re a zombie or need a soft hangup */</span>
<a name="l02441"></a>02441    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(c, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a26796fa52cc5857446eec8d16a4b718d">AST_FLAG_ZOMBIE</a>) || <a class="code" href="channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd" title="Check to see if a channel is needing hang up.">ast_check_hangup</a>(c))
<a name="l02442"></a>02442       <span class="keywordflow">return</span> -1;
<a name="l02443"></a>02443 
<a name="l02444"></a>02444    <span class="comment">/* Only look for the end of DTMF, don&apos;t bother with the beginning and don&apos;t emulate things */</span>
<a name="l02445"></a>02445    <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(c, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a668ac945c84f50becaca2a6134e64058">AST_FLAG_END_DTMF_ONLY</a>);
<a name="l02446"></a>02446 
<a name="l02447"></a>02447    <span class="comment">/* Wait for a digit, no more than ms milliseconds total. */</span>
<a name="l02448"></a>02448    
<a name="l02449"></a>02449    <span class="keywordflow">while</span> (ms) {
<a name="l02450"></a>02450       <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *rchan;
<a name="l02451"></a>02451       <span class="keywordtype">int</span> outfd=-1;
<a name="l02452"></a>02452 
<a name="l02453"></a>02453       <a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> = 0;
<a name="l02454"></a>02454       rchan = <a class="code" href="channel_8h.html#a5e62602ca9e229304f60ab5c2b32e13b" title="Waits for activity on a group of channels.">ast_waitfor_nandfds</a>(&amp;c, 1, &amp;cmdfd, (cmdfd &gt; -1) ? 1 : 0, NULL, &amp;outfd, &amp;ms);
<a name="l02455"></a>02455       
<a name="l02456"></a>02456       <span class="keywordflow">if</span> (!rchan &amp;&amp; outfd &lt; 0 &amp;&amp; ms) {
<a name="l02457"></a>02457          <span class="keywordflow">if</span> (errno == 0 || errno == EINTR)
<a name="l02458"></a>02458             <span class="keywordflow">continue</span>;
<a name="l02459"></a>02459          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Wait failed (%s)\n&quot;</span>, strerror(errno));
<a name="l02460"></a>02460          <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(c, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a668ac945c84f50becaca2a6134e64058">AST_FLAG_END_DTMF_ONLY</a>);
<a name="l02461"></a>02461          <span class="keywordflow">return</span> -1;
<a name="l02462"></a>02462       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (outfd &gt; -1) {
<a name="l02463"></a>02463          <span class="comment">/* The FD we were watching has something waiting */</span>
<a name="l02464"></a>02464          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;The FD we were waiting for has something waiting. Waitfordigit returning numeric 1\n&quot;</span>);
<a name="l02465"></a>02465          <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(c, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a668ac945c84f50becaca2a6134e64058">AST_FLAG_END_DTMF_ONLY</a>);
<a name="l02466"></a>02466          <span class="keywordflow">return</span> 1;
<a name="l02467"></a>02467       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rchan) {
<a name="l02468"></a>02468          <span class="keywordtype">int</span> res;
<a name="l02469"></a>02469          <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a> = <a class="code" href="channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1" title="Reads a frame.">ast_read</a>(c);
<a name="l02470"></a>02470          <span class="keywordflow">if</span> (!f)
<a name="l02471"></a>02471             <span class="keywordflow">return</span> -1;
<a name="l02472"></a>02472 
<a name="l02473"></a>02473          <span class="keywordflow">switch</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a>) {
<a name="l02474"></a>02474          <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a9b350360a64b55c7590f1ec03db480be">AST_FRAME_DTMF_BEGIN</a>:
<a name="l02475"></a>02475             <span class="keywordflow">break</span>;
<a name="l02476"></a>02476          <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a98e65764bc963016c394bcc1bad6540b">AST_FRAME_DTMF_END</a>:
<a name="l02477"></a>02477             res = f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>;
<a name="l02478"></a>02478             <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l02479"></a>02479             <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(c, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a668ac945c84f50becaca2a6134e64058">AST_FLAG_END_DTMF_ONLY</a>);
<a name="l02480"></a>02480             <span class="keywordflow">return</span> res;
<a name="l02481"></a>02481          <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>:
<a name="l02482"></a>02482             <span class="keywordflow">switch</span> (f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>) {
<a name="l02483"></a>02483             <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa7dac1c1896ab418c2ff351aae707fba">AST_CONTROL_HANGUP</a>:
<a name="l02484"></a>02484                <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l02485"></a>02485                <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(c, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a668ac945c84f50becaca2a6134e64058">AST_FLAG_END_DTMF_ONLY</a>);
<a name="l02486"></a>02486                <span class="keywordflow">return</span> -1;
<a name="l02487"></a>02487             <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a>:
<a name="l02488"></a>02488             <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>:
<a name="l02489"></a>02489             <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a009e81151b19671f42b5e84ab6a619f4">AST_CONTROL_SRCUPDATE</a>:
<a name="l02490"></a>02490                <span class="comment">/* Unimportant */</span>
<a name="l02491"></a>02491                <span class="keywordflow">break</span>;
<a name="l02492"></a>02492             <span class="keywordflow">default</span>:
<a name="l02493"></a>02493                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unexpected control subclass &apos;%d&apos;\n&quot;</span>, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>);
<a name="l02494"></a>02494                <span class="keywordflow">break</span>;
<a name="l02495"></a>02495             }
<a name="l02496"></a>02496             <span class="keywordflow">break</span>;
<a name="l02497"></a>02497          <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>:
<a name="l02498"></a>02498             <span class="comment">/* Write audio if appropriate */</span>
<a name="l02499"></a>02499             <span class="keywordflow">if</span> (audiofd &gt; -1) {
<a name="l02500"></a>02500                <span class="keywordflow">if</span> (write(audiofd, f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>) &lt; 0) {
<a name="l02501"></a>02501                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;write() failed: %s\n&quot;</span>, strerror(errno));
<a name="l02502"></a>02502                }
<a name="l02503"></a>02503             }
<a name="l02504"></a>02504          <span class="keywordflow">default</span>:
<a name="l02505"></a>02505             <span class="comment">/* Ignore */</span>
<a name="l02506"></a>02506             <span class="keywordflow">break</span>;
<a name="l02507"></a>02507          }
<a name="l02508"></a>02508          <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l02509"></a>02509       }
<a name="l02510"></a>02510    }
<a name="l02511"></a>02511 
<a name="l02512"></a>02512    <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(c, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a668ac945c84f50becaca2a6134e64058">AST_FLAG_END_DTMF_ONLY</a>);
<a name="l02513"></a>02513 
<a name="l02514"></a>02514    <span class="keywordflow">return</span> 0; <span class="comment">/* Time is up */</span>
<a name="l02515"></a>02515 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4625f1350f67ea98bdc598329a78f1e7"></a><!-- doxytag: member="channel.c::ast_walk_channel_by_exten_locked" ref="a4625f1350f67ea98bdc598329a78f1e7" args="(const struct ast_channel *chan, const char *exten, const char *context)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__channel.html">ast_channel</a>* ast_walk_channel_by_exten_locked </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>exten</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get next channel by exten (and optionally context) and lock it. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01303">1303</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l01188">channel_find_locked()</a>.</p>

<p>Referenced by <a class="el" href="app__chanspy_8c_source.html#l00736">next_channel()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01305"></a>01305 {
<a name="l01306"></a>01306    <span class="keywordflow">return</span> <a class="code" href="channel_8c.html#a205b57c2db0974945d767d8fab853e9c" title="Helper function to find channels.">channel_find_locked</a>(chan, NULL, 0, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>);
<a name="l01307"></a>01307 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad0be2bd6da179c80fec23a04c468b872"></a><!-- doxytag: member="channel.c::ast_walk_channel_by_name_prefix_locked" ref="ad0be2bd6da179c80fec23a04c468b872" args="(const struct ast_channel *chan, const char *name, const int namelen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__channel.html">ast_channel</a>* ast_walk_channel_by_name_prefix_locked </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>namelen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get next channel by name prefix and lock it. </p>
<p>Get channel by name or uniqueid prefix (locks channel). </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01290">1290</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l01188">channel_find_locked()</a>.</p>

<p>Referenced by <a class="el" href="app__directed__pickup_8c_source.html#l00125">my_ast_get_channel_by_name_locked()</a>, <a class="el" href="app__chanspy_8c_source.html#l00736">next_channel()</a>, and <a class="el" href="app__softhangup_8c_source.html#l00072">softhangup_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01292"></a>01292 {
<a name="l01293"></a>01293    <span class="keywordflow">return</span> <a class="code" href="channel_8c.html#a205b57c2db0974945d767d8fab853e9c" title="Helper function to find channels.">channel_find_locked</a>(chan, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, namelen, NULL, NULL);
<a name="l01294"></a>01294 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1b4c335490f5170c1f9e2c7c6781003f"></a><!-- doxytag: member="channel.c::ast_write" ref="a1b4c335490f5170c1f9e2c7c6781003f" args="(struct ast_channel *chan, struct ast_frame *fr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_write </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td>
          <td class="paramname"> <em>frame</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Write a frame to a channel This function writes the given frame to the indicated channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>destination channel of the frame </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>frame</em>&nbsp;</td><td>frame that will be written </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>It returns 0 on success, -1 on failure. </dd></dl>

<p><dl class="todo"><dt><b><a class="el" href="todo.html#_todo000067">Todo:</a></b></dt><dd>XXX should return 0 maybe ? </dd></dl>
</p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l03411">3411</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00462">ast_channel::_softhangup</a>, <a class="el" href="audiohook_8h_source.html#l00051">AST_AUDIOHOOK_DIRECTION_WRITE</a>, <a class="el" href="audiohook_8c_source.html#l00710">ast_audiohook_write_list()</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02037">ast_channel_trylock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="channel_8c_source.html#l00461">ast_check_hangup()</a>, <a class="el" href="utils_8h_source.html#l00075">ast_clear_flag</a>, <a class="el" href="frame_8h_source.html#l00314">AST_CONTROL_UNHOLD</a>, <a class="el" href="channel_8c_source.html#l01956">ast_deactivate_generator()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="channel_8c_source.html#l04393">ast_do_masquerade()</a>, <a class="el" href="channel_8h_source.html#l00527">AST_FLAG_BLOCKING</a>, <a class="el" href="channel_8h_source.html#l00525">AST_FLAG_WRITE_INT</a>, <a class="el" href="channel_8h_source.html#l00529">AST_FLAG_ZOMBIE</a>, <a class="el" href="frame_8h_source.html#l00680">ast_format_rate()</a>, <a class="el" href="frame_8h_source.html#l00292">AST_FORMAT_T140</a>, <a class="el" href="frame_8h_source.html#l00105">AST_FRAME_CONTROL</a>, <a class="el" href="frame_8h_source.html#l00122">AST_FRAME_DTMF_BEGIN</a>, <a class="el" href="frame_8h_source.html#l00099">AST_FRAME_DTMF_END</a>, <a class="el" href="frame_8c_source.html#l00756">ast_frame_dump()</a>, <a class="el" href="frame_8h_source.html#l00115">AST_FRAME_HTML</a>, <a class="el" href="frame_8h_source.html#l00109">AST_FRAME_IAX</a>, <a class="el" href="frame_8h_source.html#l00120">AST_FRAME_MODEM</a>, <a class="el" href="frame_8h_source.html#l00107">AST_FRAME_NULL</a>, <a class="el" href="frame_8h_source.html#l00111">AST_FRAME_TEXT</a>, <a class="el" href="frame_8h_source.html#l00103">AST_FRAME_VIDEO</a>, <a class="el" href="frame_8h_source.html#l00101">AST_FRAME_VOICE</a>, <a class="el" href="frame_8h_source.html#l00462">ast_frfree</a>, <a class="el" href="frame_8c_source.html#l00389">ast_frisolate()</a>, <a class="el" href="linkedlists_8h_source.html#l00438">AST_LIST_NEXT</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="monitor_8h_source.html#l00029">AST_MONITOR_RUNNING</a>, <a class="el" href="file_8c_source.html#l00862">ast_seekstream()</a>, <a class="el" href="channel_8c_source.html#l03315">ast_senddigit_begin()</a>, <a class="el" href="channel_8c_source.html#l03360">ast_senddigit_end()</a>, <a class="el" href="channel_8h_source.html#l00633">AST_SOFTHANGUP_DEV</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="translate_8c_source.html#l00308">ast_translate()</a>, <a class="el" href="file_8c_source.html#l00144">ast_writestream()</a>, <a class="el" href="channel_8h_source.html#l00421">ast_channel::audiohooks</a>, <a class="el" href="channel_8c_source.html#l02623">calc_monitor_jump()</a>, <a class="el" href="channel_8h_source.html#l01763">CHECK_BLOCKING</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="frame_8h_source.html#l00147">ast_frame::datalen</a>, <a class="el" href="channel_8h_source.html#l00334">DEBUGCHAN_FLAG</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="mod__format_8h_source.html#l00102">ast_filestream::fmt</a>, <a class="el" href="mod__format_8h_source.html#l00047">ast_format::format</a>, <a class="el" href="channel_8h_source.html#l00477">ast_channel::fout</a>, <a class="el" href="channel_8h_source.html#l00337">FRAMECOUNT_INC</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="channel_8h_source.html#l00403">ast_channel::generatordata</a>, <a class="el" href="structast__channel__tech.html#a21e97c64bf4c9c328fa344d29ee1c065">ast_channel_tech::indicate</a>, <a class="el" href="channel_8h_source.html#l00455">ast_channel::insmpl</a>, <a class="el" href="frame_8h_source.html#l00169">ast_frame::len</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="channel_8h_source.html#l00408">ast_channel::masq</a>, <a class="el" href="channel_8h_source.html#l00409">ast_channel::masqr</a>, <a class="el" href="channel_8h_source.html#l00425">ast_channel::monitor</a>, <a class="el" href="app__dial_8c_source.html#l00568">chanlist::next</a>, <a class="el" href="channel_8h_source.html#l00456">ast_channel::outsmpl</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::ptr</a>, <a class="el" href="channel_8h_source.html#l00486">ast_channel::rawwriteformat</a>, <a class="el" href="monitor_8h_source.html#l00040">ast_channel_monitor::read_stream</a>, <a class="el" href="frame_8h_source.html#l00149">ast_frame::samples</a>, <a class="el" href="file_8h_source.html#l00050">SEEK_FORCECUR</a>, <a class="el" href="channel_8c_source.html#l02517">send_dtmf_event()</a>, <a class="el" href="structast__channel__tech.html#a8169d0cdf14765d08ed132b495170e3b">ast_channel_tech::send_html</a>, <a class="el" href="structast__channel__tech.html#a675e5d4613f3af64e46d5dd8c12544cc">ast_channel_tech::send_text</a>, <a class="el" href="monitor_8h_source.html#l00048">ast_channel_monitor::state</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>, <a class="el" href="structast__channel__tech.html#a2ad42fcd8fe833df5f1f20431122de7c">ast_channel_tech::write</a>, <a class="el" href="monitor_8h_source.html#l00041">ast_channel_monitor::write_stream</a>, <a class="el" href="structast__channel__tech.html#a64c3224fe774456b63d380803e8308d7">ast_channel_tech::write_text</a>, <a class="el" href="structast__channel__tech.html#a6847a462ba3341bd42588f4732dbc0ad">ast_channel_tech::write_video</a>, and <a class="el" href="channel_8h_source.html#l00419">ast_channel::writetrans</a>.</p>

<p>Referenced by <a class="el" href="res__adsi_8c_source.html#l00117">adsi_careful_send()</a>, <a class="el" href="chan__agent_8c_source.html#l00690">agent_write()</a>, <a class="el" href="channel_8c_source.html#l04776">ast_generic_bridge()</a>, <a class="el" href="channel_8c_source.html#l03383">ast_prod()</a>, <a class="el" href="file_8c_source.html#l00735">ast_readaudio_callback()</a>, <a class="el" href="file_8c_source.html#l00799">ast_readvideo_callback()</a>, <a class="el" href="udptl_8c_source.html#l01150">ast_udptl_bridge()</a>, <a class="el" href="channel_8c_source.html#l03400">ast_write_video()</a>, <a class="el" href="rtp_8c_source.html#l03915">bridge_native_loop()</a>, <a class="el" href="rtp_8c_source.html#l04223">bridge_p2p_loop()</a>, <a class="el" href="app__meetme_8c_source.html#l01711">conf_queue_dtmf()</a>, <a class="el" href="app__dahdibarge_8c_source.html#l00095">conf_run()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05156">dahdi_bridge()</a>, <a class="el" href="app__dictate_8c_source.html#l00084">dictate_exec()</a>, <a class="el" href="app__echo_8c_source.html#l00051">echo_exec()</a>, <a class="el" href="app__fax_8c_source.html#l00324">fax_generator_generate()</a>, <a class="el" href="features_8c_source.html#l02152">feature_request_and_dial()</a>, <a class="el" href="app__rpt_8c_source.html#l05872">function_ilink()</a>, <a class="el" href="app__externalivr_8c_source.html#l00219">gen_generate()</a>, <a class="el" href="app__jack_8c_source.html#l00600">handle_jack_audio()</a>, <a class="el" href="app__rpt_8c_source.html#l06676">handle_link_data()</a>, <a class="el" href="chan__iax2_8c_source.html#l05170">iax2_bridge()</a>, <a class="el" href="abstract__jb_8c_source.html#l00385">jb_get_and_deliver()</a>, <a class="el" href="app_8c_source.html#l00404">linear_generator()</a>, <a class="el" href="app__milliwatt_8c_source.html#l00074">milliwatt_generate()</a>, <a class="el" href="chan__misdn_8c_source.html#l03228">misdn_bridge()</a>, <a class="el" href="res__musiconhold_8c_source.html#l00323">moh_files_generator()</a>, <a class="el" href="res__musiconhold_8c_source.html#l00889">moh_generate()</a>, <a class="el" href="app__mp3_8c_source.html#l00120">mp3_exec()</a>, <a class="el" href="bridge__multiplexed_8c_source.html#l00353">multiplexed_bridge_write()</a>, <a class="el" href="app__nbscat_8c_source.html#l00108">NBScat_exec()</a>, <a class="el" href="indications_8c_source.html#l00160">playtones_generator()</a>, <a class="el" href="app__rpt_8c_source.html#l10730">rpt()</a>, <a class="el" href="app__rpt_8c_source.html#l13122">rpt_exec()</a>, <a class="el" href="app__rpt_8c_source.html#l05585">send_link_dtmf()</a>, <a class="el" href="app__rpt_8c_source.html#l05627">send_link_keyquery()</a>, <a class="el" href="app__alarmreceiver_8c_source.html#l00167">send_tone_burst()</a>, <a class="el" href="app__rpt_8c_source.html#l01869">send_usb_txt()</a>, <a class="el" href="app__festival_8c_source.html#l00161">send_waveform_to_channel()</a>, <a class="el" href="channel_8c_source.html#l05611">silence_generator_generate()</a>, <a class="el" href="bridge__simple_8c_source.html#l00062">simple_bridge_write()</a>, <a class="el" href="app__sms_8c_source.html#l01589">sms_generate()</a>, <a class="el" href="bridge__softmix_8c_source.html#l00194">softmix_bridge_poke()</a>, <a class="el" href="bridge__softmix_8c_source.html#l00161">softmix_bridge_write()</a>, <a class="el" href="app__chanspy_8c_source.html#l00361">spy_generate()</a>, <a class="el" href="app__fax_8c_source.html#l00179">t38_tx_packet_handler()</a>, <a class="el" href="channel_8c_source.html#l05396">tonepair_generator()</a>, and <a class="el" href="app__dial_8c_source.html#l00818">wait_for_answer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03412"></a>03412 {
<a name="l03413"></a>03413    <span class="keywordtype">int</span> res = -1;
<a name="l03414"></a>03414    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a> = NULL;
<a name="l03415"></a>03415    <span class="keywordtype">int</span> count = 0;
<a name="l03416"></a>03416 
<a name="l03417"></a>03417    <span class="comment">/*Deadlock avoidance*/</span>
<a name="l03418"></a>03418    <span class="keywordflow">while</span>(<a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(chan)) {
<a name="l03419"></a>03419       <span class="comment">/*cannot goto done since the channel is not locked*/</span>
<a name="l03420"></a>03420       <span class="keywordflow">if</span>(count++ &gt; 10) {
<a name="l03421"></a>03421          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Deadlock avoided for write to channel &apos;%s&apos;\n&quot;</span>, chan-&gt;name);
<a name="l03422"></a>03422          <span class="keywordflow">return</span> 0;
<a name="l03423"></a>03423       }
<a name="l03424"></a>03424       usleep(1);
<a name="l03425"></a>03425    }
<a name="l03426"></a>03426    <span class="comment">/* Stop if we&apos;re a zombie or need a soft hangup */</span>
<a name="l03427"></a>03427    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a26796fa52cc5857446eec8d16a4b718d">AST_FLAG_ZOMBIE</a>) || <a class="code" href="channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd" title="Check to see if a channel is needing hang up.">ast_check_hangup</a>(chan))
<a name="l03428"></a>03428       <span class="keywordflow">goto</span> done;
<a name="l03429"></a>03429 
<a name="l03430"></a>03430    <span class="comment">/* Handle any pending masquerades */</span>
<a name="l03431"></a>03431    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#ae38ae730b987d648a6fe1c84c8a13442">masq</a> &amp;&amp; <a class="code" href="channel_8h.html#ab26f03fb10f1b2e8e52bfbbb1ee02f78" title="Start masquerading a channel XXX This is a seriously whacked out operation. We&amp;#39;re...">ast_do_masquerade</a>(chan)) {
<a name="l03432"></a>03432       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to perform masquerade\n&quot;</span>);
<a name="l03433"></a>03433       <span class="keywordflow">goto</span> done;
<a name="l03434"></a>03434    }
<a name="l03435"></a>03435    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#abb53278bc00235a5ff76fc8badbe6363">masqr</a>) {
<a name="l03436"></a>03436       res = 0; <span class="comment">/* XXX explain, why 0 ? */</span>
<a name="l03437"></a>03437       <span class="keywordflow">goto</span> done;
<a name="l03438"></a>03438    }
<a name="l03439"></a>03439    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#abe7876f86e249ea3db5fbacd2231389c">generatordata</a>) {
<a name="l03440"></a>03440       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a9deec175d13a40a6a5fdb527b13c6878">AST_FLAG_WRITE_INT</a>))
<a name="l03441"></a>03441          <a class="code" href="channel_8h.html#a7160355005776732fba88cc020f4a45b">ast_deactivate_generator</a>(chan);
<a name="l03442"></a>03442       <span class="keywordflow">else</span> {
<a name="l03443"></a>03443          <span class="keywordflow">if</span> (fr-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a98e65764bc963016c394bcc1bad6540b">AST_FRAME_DTMF_END</a>) {
<a name="l03444"></a>03444             <span class="comment">/* There is a generator running while we&apos;re in the middle of a digit.</span>
<a name="l03445"></a>03445 <span class="comment">             * It&apos;s probably inband DTMF, so go ahead and pass it so it can</span>
<a name="l03446"></a>03446 <span class="comment">             * stop the generator */</span>
<a name="l03447"></a>03447             <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329ab5b2bec9425dd0cfc789d96ef229cb3a">AST_FLAG_BLOCKING</a>);
<a name="l03448"></a>03448             <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l03449"></a>03449             res = <a class="code" href="channel_8h.html#ab45db8cf33a706a5831d553d5199c143" title="Send a DTMF digit to a channel.">ast_senddigit_end</a>(chan, fr-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>, fr-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a>);
<a name="l03450"></a>03450             <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l03451"></a>03451             <a class="code" href="channel_8h.html#a3a5d847510a477edda3d0bc1459709f4">CHECK_BLOCKING</a>(chan);
<a name="l03452"></a>03452          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fr-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a> &amp;&amp; fr-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> == <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>) {
<a name="l03453"></a>03453             <span class="comment">/* This is a side case where Echo is basically being called and the person put themselves on hold and took themselves off hold */</span>
<a name="l03454"></a>03454             res = (chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a21e97c64bf4c9c328fa344d29ee1c065" title="Indicate a particular condition (e.g. AST_CONTROL_BUSY or AST_CONTROL_RINGING or...">indicate</a> == NULL) ? 0 :
<a name="l03455"></a>03455                chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a21e97c64bf4c9c328fa344d29ee1c065" title="Indicate a particular condition (e.g. AST_CONTROL_BUSY or AST_CONTROL_RINGING or...">indicate</a>(chan, fr-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>, fr-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, fr-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>);
<a name="l03456"></a>03456          }
<a name="l03457"></a>03457          res = 0; <span class="comment">/* XXX explain, why 0 ? */</span>
<a name="l03458"></a>03458          <span class="keywordflow">goto</span> done;
<a name="l03459"></a>03459       }
<a name="l03460"></a>03460    }
<a name="l03461"></a>03461    <span class="comment">/* High bit prints debugging */</span>
<a name="l03462"></a>03462    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#af2ef0dd0824e04b55a277f42c10f3dfa">fout</a> &amp; <a class="code" href="channel_8h.html#a2011c630205057fb4b67eb06145e4a7f">DEBUGCHAN_FLAG</a>)
<a name="l03463"></a>03463       <a class="code" href="frame_8h.html#a35641692b96e9e81da06d8d36e677cb8">ast_frame_dump</a>(chan-&gt;name, fr, <span class="stringliteral">&quot;&gt;&gt;&quot;</span>);
<a name="l03464"></a>03464    <a class="code" href="channel_8h.html#a3a5d847510a477edda3d0bc1459709f4">CHECK_BLOCKING</a>(chan);
<a name="l03465"></a>03465    <span class="keywordflow">switch</span> (fr-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a>) {
<a name="l03466"></a>03466    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>:
<a name="l03467"></a>03467       res = (chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a21e97c64bf4c9c328fa344d29ee1c065" title="Indicate a particular condition (e.g. AST_CONTROL_BUSY or AST_CONTROL_RINGING or...">indicate</a> == NULL) ? 0 :
<a name="l03468"></a>03468          chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a21e97c64bf4c9c328fa344d29ee1c065" title="Indicate a particular condition (e.g. AST_CONTROL_BUSY or AST_CONTROL_RINGING or...">indicate</a>(chan, fr-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>, fr-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, fr-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>);
<a name="l03469"></a>03469       <span class="keywordflow">break</span>;
<a name="l03470"></a>03470    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a9b350360a64b55c7590f1ec03db480be">AST_FRAME_DTMF_BEGIN</a>:
<a name="l03471"></a>03471       <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>) {
<a name="l03472"></a>03472          <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *old_frame = fr;
<a name="l03473"></a>03473          fr = <a class="code" href="audiohook_8h.html#a6351c89eb98b1832e85fa9c0fca7383f" title="Pass a frame off to be handled by the audiohook core.">ast_audiohook_write_list</a>(chan, chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>, <a class="code" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899a8254a5b3fc181d3fe3f2af892010b586">AST_AUDIOHOOK_DIRECTION_WRITE</a>, fr);
<a name="l03474"></a>03474          <span class="keywordflow">if</span> (old_frame != fr)
<a name="l03475"></a>03475             f = fr;
<a name="l03476"></a>03476       }
<a name="l03477"></a>03477       <a class="code" href="channel_8c.html#a2897ccacbd4c0c894a7e8212da97ee83">send_dtmf_event</a>(chan, <span class="stringliteral">&quot;Sent&quot;</span>, fr-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>, <span class="stringliteral">&quot;Yes&quot;</span>, <span class="stringliteral">&quot;No&quot;</span>);
<a name="l03478"></a>03478       <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329ab5b2bec9425dd0cfc789d96ef229cb3a">AST_FLAG_BLOCKING</a>);
<a name="l03479"></a>03479       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l03480"></a>03480       res = <a class="code" href="channel_8h.html#a38f90349e730b6556cfe8b99b134d574" title="Send a DTMF digit to a channel Send a DTMF digit to a channel.">ast_senddigit_begin</a>(chan, fr-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>);
<a name="l03481"></a>03481       <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l03482"></a>03482       <a class="code" href="channel_8h.html#a3a5d847510a477edda3d0bc1459709f4">CHECK_BLOCKING</a>(chan);
<a name="l03483"></a>03483       <span class="keywordflow">break</span>;
<a name="l03484"></a>03484    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a98e65764bc963016c394bcc1bad6540b">AST_FRAME_DTMF_END</a>:
<a name="l03485"></a>03485       <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>) {
<a name="l03486"></a>03486          <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *new_frame = fr;
<a name="l03487"></a>03487 
<a name="l03488"></a>03488          new_frame = <a class="code" href="audiohook_8h.html#a6351c89eb98b1832e85fa9c0fca7383f" title="Pass a frame off to be handled by the audiohook core.">ast_audiohook_write_list</a>(chan, chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>, <a class="code" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899a8254a5b3fc181d3fe3f2af892010b586">AST_AUDIOHOOK_DIRECTION_WRITE</a>, fr);
<a name="l03489"></a>03489          <span class="keywordflow">if</span> (new_frame != fr) {
<a name="l03490"></a>03490             <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(new_frame);
<a name="l03491"></a>03491          }
<a name="l03492"></a>03492       }
<a name="l03493"></a>03493       <a class="code" href="channel_8c.html#a2897ccacbd4c0c894a7e8212da97ee83">send_dtmf_event</a>(chan, <span class="stringliteral">&quot;Sent&quot;</span>, fr-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>, <span class="stringliteral">&quot;No&quot;</span>, <span class="stringliteral">&quot;Yes&quot;</span>);
<a name="l03494"></a>03494       <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329ab5b2bec9425dd0cfc789d96ef229cb3a">AST_FLAG_BLOCKING</a>);
<a name="l03495"></a>03495       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l03496"></a>03496       res = <a class="code" href="channel_8h.html#ab45db8cf33a706a5831d553d5199c143" title="Send a DTMF digit to a channel.">ast_senddigit_end</a>(chan, fr-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>, fr-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a>);
<a name="l03497"></a>03497       <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l03498"></a>03498       <a class="code" href="channel_8h.html#a3a5d847510a477edda3d0bc1459709f4">CHECK_BLOCKING</a>(chan);
<a name="l03499"></a>03499       <span class="keywordflow">break</span>;
<a name="l03500"></a>03500    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0af7728b18670d3cd075f63d67f8867078">AST_FRAME_TEXT</a>:
<a name="l03501"></a>03501       <span class="keywordflow">if</span> (fr-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> == <a class="code" href="frame_8h.html#a721e65ac52ff8eca03ea163544e695b6">AST_FORMAT_T140</a>) {
<a name="l03502"></a>03502          res = (chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a64c3224fe774456b63d380803e8308d7" title="Write a text frame, in standard format.">write_text</a> == NULL) ? 0 :
<a name="l03503"></a>03503             chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a64c3224fe774456b63d380803e8308d7" title="Write a text frame, in standard format.">write_text</a>(chan, fr);
<a name="l03504"></a>03504       } <span class="keywordflow">else</span> {
<a name="l03505"></a>03505          res = (chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a675e5d4613f3af64e46d5dd8c12544cc" title="Display or transmit text.">send_text</a> == NULL) ? 0 :
<a name="l03506"></a>03506             chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a675e5d4613f3af64e46d5dd8c12544cc" title="Display or transmit text.">send_text</a>(chan, (<span class="keywordtype">char</span> *) fr-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>);
<a name="l03507"></a>03507       }
<a name="l03508"></a>03508       <span class="keywordflow">break</span>;
<a name="l03509"></a>03509    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a3d91bab33583f560197e21532a02a895">AST_FRAME_HTML</a>:
<a name="l03510"></a>03510       res = (chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a8169d0cdf14765d08ed132b495170e3b" title="Send HTML data.">send_html</a> == NULL) ? 0 :
<a name="l03511"></a>03511          chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a8169d0cdf14765d08ed132b495170e3b" title="Send HTML data.">send_html</a>(chan, fr-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>, (<span class="keywordtype">char</span> *) fr-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, fr-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>);
<a name="l03512"></a>03512       <span class="keywordflow">break</span>;
<a name="l03513"></a>03513    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a17ae96b6ea8a2388bb0d409e8124ff30">AST_FRAME_VIDEO</a>:
<a name="l03514"></a>03514       <span class="comment">/* XXX Handle translation of video codecs one day XXX */</span>
<a name="l03515"></a>03515       res = (chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a6847a462ba3341bd42588f4732dbc0ad" title="Write a frame, in standard format.">write_video</a> == NULL) ? 0 :
<a name="l03516"></a>03516          chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a6847a462ba3341bd42588f4732dbc0ad" title="Write a frame, in standard format.">write_video</a>(chan, fr);
<a name="l03517"></a>03517       <span class="keywordflow">break</span>;
<a name="l03518"></a>03518    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ad99b86353343f422bda01163898b2eea">AST_FRAME_MODEM</a>:
<a name="l03519"></a>03519       res = (chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a2ad42fcd8fe833df5f1f20431122de7c" title="Write a frame, in standard format (see frame.h).">write</a> == NULL) ? 0 :
<a name="l03520"></a>03520          chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a2ad42fcd8fe833df5f1f20431122de7c" title="Write a frame, in standard format (see frame.h).">write</a>(chan, fr);
<a name="l03521"></a>03521       <span class="keywordflow">break</span>;
<a name="l03522"></a>03522    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>:
<a name="l03523"></a>03523       <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a2ad42fcd8fe833df5f1f20431122de7c" title="Write a frame, in standard format (see frame.h).">write</a> == NULL)
<a name="l03524"></a>03524          <span class="keywordflow">break</span>;   <span class="comment">/*! \todo XXX should return 0 maybe ? */</span>
<a name="l03525"></a>03525 
<a name="l03526"></a>03526       <span class="comment">/* If the frame is in the raw write format, then it&apos;s easy... just use the frame - otherwise we will have to translate */</span>
<a name="l03527"></a>03527       <span class="keywordflow">if</span> (fr-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> == chan-&gt;<a class="code" href="structast__channel.html#a045b6dfdee84adceb7e86b6c5c4f9a86">rawwriteformat</a>)
<a name="l03528"></a>03528          f = fr;
<a name="l03529"></a>03529       <span class="keywordflow">else</span>
<a name="l03530"></a>03530          f = (chan-&gt;<a class="code" href="structast__channel.html#a58d0c117fa64b075eda1d9a7a7d73531">writetrans</a>) ? <a class="code" href="translate_8h.html#ab09d3ccb95d1f828d2871530226f9456" title="translates one or more frames Apply an input frame into the translator and receive...">ast_translate</a>(chan-&gt;<a class="code" href="structast__channel.html#a58d0c117fa64b075eda1d9a7a7d73531">writetrans</a>, fr, 0) : fr;
<a name="l03531"></a>03531 
<a name="l03532"></a>03532       <span class="keywordflow">if</span> (!f) {
<a name="l03533"></a>03533          res = 0;
<a name="l03534"></a>03534          <span class="keywordflow">break</span>;
<a name="l03535"></a>03535       }
<a name="l03536"></a>03536 
<a name="l03537"></a>03537       <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>) {
<a name="l03538"></a>03538          <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *prev = NULL, *new_frame, *cur, *dup;
<a name="l03539"></a>03539          <span class="keywordtype">int</span> freeoldlist = 0;
<a name="l03540"></a>03540 
<a name="l03541"></a>03541          <span class="keywordflow">if</span> (f != fr) {
<a name="l03542"></a>03542             freeoldlist = 1;
<a name="l03543"></a>03543          }
<a name="l03544"></a>03544 
<a name="l03545"></a>03545          <span class="comment">/* Since ast_audiohook_write may return a new frame, and the cur frame is</span>
<a name="l03546"></a>03546 <span class="comment">          * an item in a list of frames, create a new list adding each cur frame back to it</span>
<a name="l03547"></a>03547 <span class="comment">          * regardless if the cur frame changes or not. */</span>
<a name="l03548"></a>03548          <span class="keywordflow">for</span> (cur = f; cur; cur = <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(cur, frame_list)) {
<a name="l03549"></a>03549             new_frame = <a class="code" href="audiohook_8h.html#a6351c89eb98b1832e85fa9c0fca7383f" title="Pass a frame off to be handled by the audiohook core.">ast_audiohook_write_list</a>(chan, chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>, <a class="code" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899a8254a5b3fc181d3fe3f2af892010b586">AST_AUDIOHOOK_DIRECTION_WRITE</a>, cur);
<a name="l03550"></a>03550 
<a name="l03551"></a>03551             <span class="comment">/* if this frame is different than cur, preserve the end of the list,</span>
<a name="l03552"></a>03552 <span class="comment">             * free the old frames, and set cur to be the new frame */</span>
<a name="l03553"></a>03553             <span class="keywordflow">if</span> (new_frame != cur) {
<a name="l03554"></a>03554 
<a name="l03555"></a>03555                <span class="comment">/* doing an ast_frisolate here seems silly, but we are not guaranteed the new_frame</span>
<a name="l03556"></a>03556 <span class="comment">                * isn&apos;t part of local storage, meaning if ast_audiohook_write is called multiple</span>
<a name="l03557"></a>03557 <span class="comment">                * times it may override the previous frame we got from it unless we dup it */</span>
<a name="l03558"></a>03558                <span class="keywordflow">if</span> ((dup = <a class="code" href="frame_8h.html#aa7dbd9b12889d9f96fb6c01f94b4909e" title="Makes a frame independent of any static storage.">ast_frisolate</a>(new_frame))) {
<a name="l03559"></a>03559                   <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(dup, frame_list) = <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(cur, frame_list);
<a name="l03560"></a>03560                   <span class="keywordflow">if</span> (freeoldlist) {
<a name="l03561"></a>03561                      <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(cur, frame_list) = NULL;
<a name="l03562"></a>03562                      <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(cur);
<a name="l03563"></a>03563                   }
<a name="l03564"></a>03564                   cur = dup;
<a name="l03565"></a>03565                }
<a name="l03566"></a>03566             }
<a name="l03567"></a>03567 
<a name="l03568"></a>03568             <span class="comment">/* now, regardless if cur is new or not, add it to the new list,</span>
<a name="l03569"></a>03569 <span class="comment">             * if the new list has not started, cur will become the first item. */</span>
<a name="l03570"></a>03570             <span class="keywordflow">if</span> (prev) {
<a name="l03571"></a>03571                <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(prev, frame_list) = cur;
<a name="l03572"></a>03572             } <span class="keywordflow">else</span> {
<a name="l03573"></a>03573                f = cur; <span class="comment">/* set f to be the beginning of our new list */</span>
<a name="l03574"></a>03574             }
<a name="l03575"></a>03575             prev = cur;
<a name="l03576"></a>03576          }
<a name="l03577"></a>03577       }
<a name="l03578"></a>03578       
<a name="l03579"></a>03579       <span class="comment">/* If Monitor is running on this channel, then we have to write frames out there too */</span>
<a name="l03580"></a>03580       <span class="comment">/* the translator on chan-&gt;writetrans may have returned multiple frames</span>
<a name="l03581"></a>03581 <span class="comment">         from the single frame we passed in; if so, feed each one of them to the</span>
<a name="l03582"></a>03582 <span class="comment">         monitor */</span>
<a name="l03583"></a>03583       <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a4254cefdfaeb5200f89e7ba3ae6f0922">monitor</a> &amp;&amp; chan-&gt;<a class="code" href="structast__channel.html#a4254cefdfaeb5200f89e7ba3ae6f0922">monitor</a>-&gt;<a class="code" href="structast__channel__monitor.html#a0d944be9f8d5fbcf9055775775d99760">write_stream</a>) {
<a name="l03584"></a>03584          <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *cur;
<a name="l03585"></a>03585 
<a name="l03586"></a>03586          <span class="keywordflow">for</span> (cur = f; cur; cur = <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(cur, frame_list)) {
<a name="l03587"></a>03587          <span class="comment">/* XXX must explain this code */</span>
<a name="l03588"></a>03588 <span class="preprocessor">#ifndef MONITOR_CONSTANT_DELAY</span>
<a name="l03589"></a>03589 <span class="preprocessor"></span>            <span class="keywordtype">int</span> jump = chan-&gt;<a class="code" href="structast__channel.html#a95c0c6b0a347b576b183cfa44e9b6a43">insmpl</a> - chan-&gt;<a class="code" href="structast__channel.html#a38fcd80fe4193f13d83f7cb3f7c3218f">outsmpl</a> - 4 * cur-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>;
<a name="l03590"></a>03590             <span class="keywordflow">if</span> (jump &gt;= 0) {
<a name="l03591"></a>03591                jump = <a class="code" href="channel_8c.html#a2679f53f358ce4d56596c511afab764b" title="calculates the number of samples to jump forward with in a monitor stream.">calc_monitor_jump</a>((chan-&gt;<a class="code" href="structast__channel.html#a95c0c6b0a347b576b183cfa44e9b6a43">insmpl</a> - chan-&gt;<a class="code" href="structast__channel.html#a38fcd80fe4193f13d83f7cb3f7c3218f">outsmpl</a>), <a class="code" href="frame_8h.html#a29a7b93f4295966d4d441e91bff2b01e" title="Get the sample rate for a given format.">ast_format_rate</a>(f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>), <a class="code" href="frame_8h.html#a29a7b93f4295966d4d441e91bff2b01e" title="Get the sample rate for a given format.">ast_format_rate</a>(chan-&gt;<a class="code" href="structast__channel.html#a4254cefdfaeb5200f89e7ba3ae6f0922">monitor</a>-&gt;<a class="code" href="structast__channel__monitor.html#a71e6f392234194bc5a27b42b90f9df56">read_stream</a>-&gt;<a class="code" href="structast__filestream.html#af4e7a9f36c380991c59c9a49122de100">fmt</a>-&gt;<a class="code" href="structast__format.html#a317afff57d87a89158c2b038d37b2b08">format</a>));
<a name="l03592"></a>03592                <span class="keywordflow">if</span> (<a class="code" href="file_8h.html#a36f6bba05952162d5d1ee7fb9819bd07" title="Seeks into stream.">ast_seekstream</a>(chan-&gt;<a class="code" href="structast__channel.html#a4254cefdfaeb5200f89e7ba3ae6f0922">monitor</a>-&gt;<a class="code" href="structast__channel__monitor.html#a0d944be9f8d5fbcf9055775775d99760">write_stream</a>, jump, <a class="code" href="file_8h.html#abd4aebd901cf2e2251920acfbe22fa22">SEEK_FORCECUR</a>) == -1)
<a name="l03593"></a>03593                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to perform seek in monitoring write stream, synchronization between the files may be broken\n&quot;</span>);
<a name="l03594"></a>03594                chan-&gt;<a class="code" href="structast__channel.html#a38fcd80fe4193f13d83f7cb3f7c3218f">outsmpl</a> += (chan-&gt;<a class="code" href="structast__channel.html#a95c0c6b0a347b576b183cfa44e9b6a43">insmpl</a> - chan-&gt;<a class="code" href="structast__channel.html#a38fcd80fe4193f13d83f7cb3f7c3218f">outsmpl</a>) + cur-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>;
<a name="l03595"></a>03595             } <span class="keywordflow">else</span> {
<a name="l03596"></a>03596                chan-&gt;<a class="code" href="structast__channel.html#a38fcd80fe4193f13d83f7cb3f7c3218f">outsmpl</a> += cur-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>;
<a name="l03597"></a>03597             }
<a name="l03598"></a>03598 <span class="preprocessor">#else</span>
<a name="l03599"></a>03599 <span class="preprocessor"></span>            <span class="keywordtype">int</span> jump = <a class="code" href="channel_8c.html#a2679f53f358ce4d56596c511afab764b" title="calculates the number of samples to jump forward with in a monitor stream.">calc_monitor_jump</a>((chan-&gt;<a class="code" href="structast__channel.html#a95c0c6b0a347b576b183cfa44e9b6a43">insmpl</a> - chan-&gt;<a class="code" href="structast__channel.html#a38fcd80fe4193f13d83f7cb3f7c3218f">outsmpl</a>), <a class="code" href="frame_8h.html#a29a7b93f4295966d4d441e91bff2b01e" title="Get the sample rate for a given format.">ast_format_rate</a>(f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>), <a class="code" href="frame_8h.html#a29a7b93f4295966d4d441e91bff2b01e" title="Get the sample rate for a given format.">ast_format_rate</a>(chan-&gt;<a class="code" href="structast__channel.html#a4254cefdfaeb5200f89e7ba3ae6f0922">monitor</a>-&gt;<a class="code" href="structast__channel__monitor.html#a71e6f392234194bc5a27b42b90f9df56">read_stream</a>-&gt;<a class="code" href="structast__filestream.html#af4e7a9f36c380991c59c9a49122de100">fmt</a>-&gt;<a class="code" href="structast__format.html#a317afff57d87a89158c2b038d37b2b08">format</a>));
<a name="l03600"></a>03600             <span class="keywordflow">if</span> (jump - MONITOR_DELAY &gt;= 0) {
<a name="l03601"></a>03601                <span class="keywordflow">if</span> (<a class="code" href="file_8h.html#a36f6bba05952162d5d1ee7fb9819bd07" title="Seeks into stream.">ast_seekstream</a>(chan-&gt;<a class="code" href="structast__channel.html#a4254cefdfaeb5200f89e7ba3ae6f0922">monitor</a>-&gt;<a class="code" href="structast__channel__monitor.html#a0d944be9f8d5fbcf9055775775d99760">write_stream</a>, jump - cur-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>, <a class="code" href="file_8h.html#abd4aebd901cf2e2251920acfbe22fa22">SEEK_FORCECUR</a>) == -1)
<a name="l03602"></a>03602                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to perform seek in monitoring write stream, synchronization between the files may be broken\n&quot;</span>);
<a name="l03603"></a>03603                chan-&gt;<a class="code" href="structast__channel.html#a38fcd80fe4193f13d83f7cb3f7c3218f">outsmpl</a> += chan-&gt;<a class="code" href="structast__channel.html#a95c0c6b0a347b576b183cfa44e9b6a43">insmpl</a> - chan-&gt;<a class="code" href="structast__channel.html#a38fcd80fe4193f13d83f7cb3f7c3218f">outsmpl</a>;
<a name="l03604"></a>03604             } <span class="keywordflow">else</span> {
<a name="l03605"></a>03605                chan-&gt;<a class="code" href="structast__channel.html#a38fcd80fe4193f13d83f7cb3f7c3218f">outsmpl</a> += cur-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>;
<a name="l03606"></a>03606             }
<a name="l03607"></a>03607 <span class="preprocessor">#endif</span>
<a name="l03608"></a>03608 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a4254cefdfaeb5200f89e7ba3ae6f0922">monitor</a>-&gt;<a class="code" href="structast__channel__monitor.html#a8e6392758d65e06d5e34fddc95bcb9c7">state</a> == <a class="code" href="monitor_8h.html#a9b57685a45dd0700625ea8ba83a868dface918b901d180f5ea85f8a941fc8cbdb">AST_MONITOR_RUNNING</a>) {
<a name="l03609"></a>03609                <span class="keywordflow">if</span> (<a class="code" href="file_8h.html#a3608386b919ef0949d2858cdeb02d12e" title="Writes a frame to a stream.">ast_writestream</a>(chan-&gt;<a class="code" href="structast__channel.html#a4254cefdfaeb5200f89e7ba3ae6f0922">monitor</a>-&gt;<a class="code" href="structast__channel__monitor.html#a0d944be9f8d5fbcf9055775775d99760">write_stream</a>, cur) &lt; 0)
<a name="l03610"></a>03610                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to write data to channel monitor write stream\n&quot;</span>);
<a name="l03611"></a>03611             }
<a name="l03612"></a>03612          }
<a name="l03613"></a>03613       }
<a name="l03614"></a>03614 
<a name="l03615"></a>03615       <span class="comment">/* the translator on chan-&gt;writetrans may have returned multiple frames</span>
<a name="l03616"></a>03616 <span class="comment">         from the single frame we passed in; if so, feed each one of them to the</span>
<a name="l03617"></a>03617 <span class="comment">         channel, freeing each one after it has been written */</span>
<a name="l03618"></a>03618       <span class="keywordflow">if</span> ((f != fr) &amp;&amp; <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(f, frame_list)) {
<a name="l03619"></a>03619          <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *cur, *next;
<a name="l03620"></a>03620          <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> skip = 0;
<a name="l03621"></a>03621 
<a name="l03622"></a>03622          <span class="keywordflow">for</span> (cur = f, next = <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(cur, frame_list);
<a name="l03623"></a>03623               cur;
<a name="l03624"></a>03624               cur = next, next = cur ? <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(cur, frame_list) : NULL) {
<a name="l03625"></a>03625             <span class="keywordflow">if</span> (!skip) {
<a name="l03626"></a>03626                <span class="keywordflow">if</span> ((res = chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a2ad42fcd8fe833df5f1f20431122de7c" title="Write a frame, in standard format (see frame.h).">write</a>(chan, cur)) &lt; 0) {
<a name="l03627"></a>03627                   chan-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> |= <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709a2e185ce313026e13ed90ae3a319c9cb7">AST_SOFTHANGUP_DEV</a>;
<a name="l03628"></a>03628                   skip = 1;
<a name="l03629"></a>03629                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (next) {
<a name="l03630"></a>03630                   <span class="comment">/* don&apos;t do this for the last frame in the list,</span>
<a name="l03631"></a>03631 <span class="comment">                     as the code outside the loop will do it once</span>
<a name="l03632"></a>03632 <span class="comment">                  */</span>
<a name="l03633"></a>03633                   chan-&gt;<a class="code" href="structast__channel.html#af2ef0dd0824e04b55a277f42c10f3dfa">fout</a> = <a class="code" href="channel_8h.html#ae02cd8717fa5e5be15080386639ebb2c">FRAMECOUNT_INC</a>(chan-&gt;<a class="code" href="structast__channel.html#af2ef0dd0824e04b55a277f42c10f3dfa">fout</a>);
<a name="l03634"></a>03634                }
<a name="l03635"></a>03635             }
<a name="l03636"></a>03636             <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(cur);
<a name="l03637"></a>03637          }
<a name="l03638"></a>03638 
<a name="l03639"></a>03639          <span class="comment">/* reset f so the code below doesn&apos;t attempt to free it */</span>
<a name="l03640"></a>03640          f = NULL;
<a name="l03641"></a>03641       } <span class="keywordflow">else</span> {
<a name="l03642"></a>03642          res = chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a2ad42fcd8fe833df5f1f20431122de7c" title="Write a frame, in standard format (see frame.h).">write</a>(chan, f);
<a name="l03643"></a>03643       }
<a name="l03644"></a>03644       <span class="keywordflow">break</span>;
<a name="l03645"></a>03645    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a29ff71f9d5c7927906ebd437fe372056">AST_FRAME_NULL</a>:
<a name="l03646"></a>03646    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a7f7e5bdc9f8a8ef45c4d078f96b52624">AST_FRAME_IAX</a>:
<a name="l03647"></a>03647       <span class="comment">/* Ignore these */</span>
<a name="l03648"></a>03648       res = 0;
<a name="l03649"></a>03649       <span class="keywordflow">break</span>;
<a name="l03650"></a>03650    <span class="keywordflow">default</span>:
<a name="l03651"></a>03651       <span class="comment">/* At this point, fr is the incoming frame and f is NULL.  Channels do</span>
<a name="l03652"></a>03652 <span class="comment">       * not expect to get NULL as a frame pointer and will segfault.  Hence,</span>
<a name="l03653"></a>03653 <span class="comment">       * we output the original frame passed in. */</span>
<a name="l03654"></a>03654       res = chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a2ad42fcd8fe833df5f1f20431122de7c" title="Write a frame, in standard format (see frame.h).">write</a>(chan, fr);
<a name="l03655"></a>03655       <span class="keywordflow">break</span>;
<a name="l03656"></a>03656    }
<a name="l03657"></a>03657 
<a name="l03658"></a>03658    <span class="keywordflow">if</span> (f &amp;&amp; f != fr)
<a name="l03659"></a>03659       <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l03660"></a>03660    <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329ab5b2bec9425dd0cfc789d96ef229cb3a">AST_FLAG_BLOCKING</a>);
<a name="l03661"></a>03661 
<a name="l03662"></a>03662    <span class="comment">/* Consider a write failure to force a soft hangup */</span>
<a name="l03663"></a>03663    <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l03664"></a>03664       chan-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> |= <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709a2e185ce313026e13ed90ae3a319c9cb7">AST_SOFTHANGUP_DEV</a>;
<a name="l03665"></a>03665    } <span class="keywordflow">else</span> {
<a name="l03666"></a>03666       chan-&gt;<a class="code" href="structast__channel.html#af2ef0dd0824e04b55a277f42c10f3dfa">fout</a> = <a class="code" href="channel_8h.html#ae02cd8717fa5e5be15080386639ebb2c">FRAMECOUNT_INC</a>(chan-&gt;<a class="code" href="structast__channel.html#af2ef0dd0824e04b55a277f42c10f3dfa">fout</a>);
<a name="l03667"></a>03667    }
<a name="l03668"></a>03668 done:
<a name="l03669"></a>03669    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l03670"></a>03670    <span class="keywordflow">return</span> res;
<a name="l03671"></a>03671 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aaacf12a6a5826c53e7e55b17d1afc3da"></a><!-- doxytag: member="channel.c::ast_write_video" ref="aaacf12a6a5826c53e7e55b17d1afc3da" args="(struct ast_channel *chan, struct ast_frame *fr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_write_video </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td>
          <td class="paramname"> <em>frame</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Write video frame to a channel This function writes the given frame to the indicated channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>destination channel of the frame </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>frame</em>&nbsp;</td><td>frame that will be written </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>It returns 1 on success, 0 if not implemented, and -1 on failure. </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l03400">3400</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l03411">ast_write()</a>, <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>, and <a class="el" href="structast__channel__tech.html#a6847a462ba3341bd42588f4732dbc0ad">ast_channel_tech::write_video</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03401"></a>03401 {
<a name="l03402"></a>03402    <span class="keywordtype">int</span> res;
<a name="l03403"></a>03403    <span class="keywordflow">if</span> (!chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a6847a462ba3341bd42588f4732dbc0ad" title="Write a frame, in standard format.">write_video</a>)
<a name="l03404"></a>03404       <span class="keywordflow">return</span> 0;
<a name="l03405"></a>03405    res = <a class="code" href="channel_8h.html#a79c413d51b7135404d5cacf811649a61" title="Write a frame to a channel This function writes the given frame to the indicated...">ast_write</a>(chan, fr);
<a name="l03406"></a>03406    <span class="keywordflow">if</span> (!res)
<a name="l03407"></a>03407       res = 1;
<a name="l03408"></a>03408    <span class="keywordflow">return</span> res;
<a name="l03409"></a>03409 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a63b70c68a2dda262d506cc96b48cde08"></a><!-- doxytag: member="channel.c::bridge_play_sounds" ref="a63b70c68a2dda262d506cc96b48cde08" args="(struct ast_channel *c0, struct ast_channel *c1)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bridge_play_sounds </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c1</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l05027">5027</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="channel_8c_source.html#l04742">bridge_playfile()</a>, <a class="el" href="pbx_8c_source.html#l08951">pbx_builtin_getvar_helper()</a>, <a class="el" href="pbx_8c_source.html#l09023">pbx_builtin_setvar_helper()</a>, and <a class="el" href="aesopt_8h_source.html#l00399">s</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l05055">ast_channel_bridge()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05028"></a>05028 {
<a name="l05029"></a>05029    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, *<a class="code" href="structsound.html">sound</a>;
<a name="l05030"></a>05030 
<a name="l05031"></a>05031    <span class="comment">/* See if we need to play an audio file to any side of the bridge */</span>
<a name="l05032"></a>05032 
<a name="l05033"></a>05033    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(c0);
<a name="l05034"></a>05034    <span class="keywordflow">if</span> ((s = <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(c0, <span class="stringliteral">&quot;BRIDGE_PLAY_SOUND&quot;</span>))) {
<a name="l05035"></a>05035       sound = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(s);
<a name="l05036"></a>05036       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l05037"></a>05037       <a class="code" href="channel_8c.html#a63873f4aec1d534d9c12693585db32fc">bridge_playfile</a>(c0, c1, sound, 0);
<a name="l05038"></a>05038       <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(c0, <span class="stringliteral">&quot;BRIDGE_PLAY_SOUND&quot;</span>, NULL);
<a name="l05039"></a>05039    } <span class="keywordflow">else</span> {
<a name="l05040"></a>05040       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l05041"></a>05041    }
<a name="l05042"></a>05042 
<a name="l05043"></a>05043    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(c1);
<a name="l05044"></a>05044    <span class="keywordflow">if</span> ((s = <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(c1, <span class="stringliteral">&quot;BRIDGE_PLAY_SOUND&quot;</span>))) {
<a name="l05045"></a>05045       sound = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(s);
<a name="l05046"></a>05046       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l05047"></a>05047       <a class="code" href="channel_8c.html#a63873f4aec1d534d9c12693585db32fc">bridge_playfile</a>(c1, c0, sound, 0);
<a name="l05048"></a>05048       <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(c1, <span class="stringliteral">&quot;BRIDGE_PLAY_SOUND&quot;</span>, NULL);
<a name="l05049"></a>05049    } <span class="keywordflow">else</span> {
<a name="l05050"></a>05050       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l05051"></a>05051    }
<a name="l05052"></a>05052 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a63873f4aec1d534d9c12693585db32fc"></a><!-- doxytag: member="channel.c::bridge_playfile" ref="a63873f4aec1d534d9c12693585db32fc" args="(struct ast_channel *chan, struct ast_channel *peer, const char *sound, int remain)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bridge_playfile </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>sound</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>remain</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l04742">4742</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="autoservice_8c_source.html#l00192">ast_autoservice_start()</a>, <a class="el" href="autoservice_8c_source.html#l00251">ast_autoservice_stop()</a>, <a class="el" href="file_8h_source.html#l00047">AST_DIGIT_ANY</a>, <a class="el" href="channel_8c_source.html#l05815">ast_say_number()</a>, <a class="el" href="file_8c_source.html#l01342">ast_stream_and_wait()</a>, and <a class="el" href="adsistub_8c_source.html#l00049">sec</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l05055">ast_channel_bridge()</a>, and <a class="el" href="channel_8c_source.html#l05027">bridge_play_sounds()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04743"></a>04743 {
<a name="l04744"></a>04744    <span class="keywordtype">int</span> min = 0, <a class="code" href="adsistub_8c.html#a4ea74e506098ab381b9efa0200b1e1a4">sec</a> = 0, check;
<a name="l04745"></a>04745 
<a name="l04746"></a>04746    check = <a class="code" href="channel_8h.html#a7a8f6a50f3db42cb40cad7cfbd1d54f9" title="Automatically service a channel for us...">ast_autoservice_start</a>(peer);
<a name="l04747"></a>04747    <span class="keywordflow">if</span> (check)
<a name="l04748"></a>04748       <span class="keywordflow">return</span>;
<a name="l04749"></a>04749 
<a name="l04750"></a>04750    <span class="keywordflow">if</span> (remain &gt; 0) {
<a name="l04751"></a>04751       <span class="keywordflow">if</span> (remain / 60 &gt; 1) {
<a name="l04752"></a>04752          min = remain / 60;
<a name="l04753"></a>04753          <a class="code" href="adsistub_8c.html#a4ea74e506098ab381b9efa0200b1e1a4">sec</a> = remain % 60;
<a name="l04754"></a>04754       } <span class="keywordflow">else</span> {
<a name="l04755"></a>04755          <a class="code" href="adsistub_8c.html#a4ea74e506098ab381b9efa0200b1e1a4">sec</a> = remain;
<a name="l04756"></a>04756       }
<a name="l04757"></a>04757    }
<a name="l04758"></a>04758    
<a name="l04759"></a>04759    <span class="keywordflow">if</span> (!strcmp(<a class="code" href="structsound.html">sound</a>,<span class="stringliteral">&quot;timeleft&quot;</span>)) { <span class="comment">/* Queue support */</span>
<a name="l04760"></a>04760       <a class="code" href="file_8h.html#a95b94a020720147325a486e210b36775" title="stream file until digit If the file name is non-empty, try to play it.">ast_stream_and_wait</a>(chan, <span class="stringliteral">&quot;vm-youhave&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l04761"></a>04761       <span class="keywordflow">if</span> (min) {
<a name="l04762"></a>04762          <a class="code" href="say_8h.html#a899e1f86b2d65a32eeb6e17aabfa1f12" title="says a number">ast_say_number</a>(chan, min, <a class="code" href="file_8h.html#afa92b0106fb7a918ea994c2867ac0a04">AST_DIGIT_ANY</a>, chan-&gt;language, NULL);
<a name="l04763"></a>04763          <a class="code" href="file_8h.html#a95b94a020720147325a486e210b36775" title="stream file until digit If the file name is non-empty, try to play it.">ast_stream_and_wait</a>(chan, <span class="stringliteral">&quot;queue-minutes&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l04764"></a>04764       }
<a name="l04765"></a>04765       <span class="keywordflow">if</span> (<a class="code" href="adsistub_8c.html#a4ea74e506098ab381b9efa0200b1e1a4">sec</a>) {
<a name="l04766"></a>04766          <a class="code" href="say_8h.html#a899e1f86b2d65a32eeb6e17aabfa1f12" title="says a number">ast_say_number</a>(chan, <a class="code" href="adsistub_8c.html#a4ea74e506098ab381b9efa0200b1e1a4">sec</a>, <a class="code" href="file_8h.html#afa92b0106fb7a918ea994c2867ac0a04">AST_DIGIT_ANY</a>, chan-&gt;language, NULL);
<a name="l04767"></a>04767          <a class="code" href="file_8h.html#a95b94a020720147325a486e210b36775" title="stream file until digit If the file name is non-empty, try to play it.">ast_stream_and_wait</a>(chan, <span class="stringliteral">&quot;queue-seconds&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l04768"></a>04768       }
<a name="l04769"></a>04769    } <span class="keywordflow">else</span> {
<a name="l04770"></a>04770       <a class="code" href="file_8h.html#a95b94a020720147325a486e210b36775" title="stream file until digit If the file name is non-empty, try to play it.">ast_stream_and_wait</a>(chan, <a class="code" href="structsound.html">sound</a>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l04771"></a>04771    }
<a name="l04772"></a>04772 
<a name="l04773"></a>04773    <a class="code" href="channel_8h.html#a08bde7d8cf72457fc8c519a4443b413b" title="Stop servicing a channel for us...">ast_autoservice_stop</a>(peer);
<a name="l04774"></a>04774 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2679f53f358ce4d56596c511afab764b"></a><!-- doxytag: member="channel.c::calc_monitor_jump" ref="a2679f53f358ce4d56596c511afab764b" args="(int samples, int sample_rate, int seek_rate)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int calc_monitor_jump </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>samples</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sample_rate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>seek_rate</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>calculates the <a class="el" href="structnumber.html" title="Number structure.">number</a> of samples to jump forward with in a monitor stream. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>When using <a class="el" href="file_8h.html#a36f6bba05952162d5d1ee7fb9819bd07" title="Seeks into stream.">ast_seekstream()</a> with the read and write streams of a monitor, the <a class="el" href="structnumber.html" title="Number structure.">number</a> of samples to seek forward must be of the same sample rate as the stream or else the jump will not be calculated correctly.</dd></dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structnumber.html" title="Number structure.">number</a></em>&nbsp;</td><td>of samples to seek forward after rate conversion. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l02623">2623</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l02636">__ast_read()</a>, and <a class="el" href="channel_8c_source.html#l03411">ast_write()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02624"></a>02624 {
<a name="l02625"></a>02625    <span class="keywordtype">int</span> diff = sample_rate - seek_rate;
<a name="l02626"></a>02626 
<a name="l02627"></a>02627    <span class="keywordflow">if</span> (diff &gt; 0) {
<a name="l02628"></a>02628       <a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> = <a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> / (float) (sample_rate / seek_rate);
<a name="l02629"></a>02629    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (diff &lt; 0) {
<a name="l02630"></a>02630       <a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> = <a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> * (float) (seek_rate / sample_rate);
<a name="l02631"></a>02631    }
<a name="l02632"></a>02632 
<a name="l02633"></a>02633    <span class="keywordflow">return</span> <a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>;
<a name="l02634"></a>02634 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a205b57c2db0974945d767d8fab853e9c"></a><!-- doxytag: member="channel.c::channel_find_locked" ref="a205b57c2db0974945d767d8fab853e9c" args="(const struct ast_channel *prev, const char *name, const int namelen, const char *context, const char *exten)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__channel.html">ast_channel</a>* channel_find_locked </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>prev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>namelen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>exten</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Helper function to find <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>. </p>
<p>It supports these modes:</p>
<p>prev != NULL : get channel next in list after prev name != NULL : get channel with matching name name != NULL &amp;&amp; namelen != 0 : get channel whose name starts with prefix exten != NULL : get channel whose exten or macroexten matches context != NULL &amp;&amp; exten != NULL : get channel whose context or macrocontext</p>
<p>It returns with the channel's lock held. If getting the individual lock fails, unlock and retry quickly up to 10 times, then give up.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>XXX Note that this code has cost O(N) because of the need to verify that the object is still on the global list.</dd>
<dd>
XXX also note that accessing fields (e.g. c-&gt;name in <a class="el" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log()</a>) can only be done with the lock held or someone could delete the object while we work on it. This causes some ugliness in the code. Note that removing the first <a class="el" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log()</a> may be harmful, as it would shorten the retry period and possibly cause failures. We should definitely go for a better scheme that is deadlock-free. </dd></dl>

<p><dl class="note"><dt><b>Note:</b></dt><dd>We're done searching through the list for the previous item. Any item after this point, we want to evaluate for a match. If we didn't set prev to NULL here, then we would only return matches for the first matching item (since the above "if (c != prev)" would not permit any other potential matches to reach the additional matching logic, below). Instead, it would just iterate until it once again found the original match, then iterate down to the end of the list and quit.</dd></dl>
</p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l01188">1188</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02037">ast_channel_trylock</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="linkedlists_8h_source.html#l00440">AST_RWLIST_NEXT</a>, <a class="el" href="linkedlists_8h_source.html#l00077">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="channel_8h_source.html#l00503">ast_channel::context</a>, <a class="el" href="channel_8h_source.html#l00504">ast_channel::exten</a>, <a class="el" href="channel_8h_source.html#l00505">ast_channel::macrocontext</a>, <a class="el" href="channel_8h_source.html#l00506">ast_channel::macroexten</a>, and <a class="el" href="adsistub_8c_source.html#l00055">msg</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l01272">ast_channel_walk_locked()</a>, <a class="el" href="channel_8c_source.html#l01297">ast_get_channel_by_exten_locked()</a>, <a class="el" href="channel_8c_source.html#l01278">ast_get_channel_by_name_locked()</a>, <a class="el" href="channel_8c_source.html#l01284">ast_get_channel_by_name_prefix_locked()</a>, <a class="el" href="channel_8c_source.html#l01303">ast_walk_channel_by_exten_locked()</a>, and <a class="el" href="channel_8c_source.html#l01290">ast_walk_channel_by_name_prefix_locked()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01191"></a>01191 {
<a name="l01192"></a>01192    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#a0dee90db1d6eb30329bee1ae6cec036a">msg</a> = prev ? <span class="stringliteral">&quot;deadlock&quot;</span> : <span class="stringliteral">&quot;initial deadlock&quot;</span>;
<a name="l01193"></a>01193    <span class="keywordtype">int</span> retries;
<a name="l01194"></a>01194    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c;
<a name="l01195"></a>01195    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *_prev = prev;
<a name="l01196"></a>01196 
<a name="l01197"></a>01197    <span class="keywordflow">for</span> (retries = 0; retries &lt; 200; retries++) {
<a name="l01198"></a>01198       <span class="keywordtype">int</span> done;
<a name="l01199"></a>01199       <span class="comment">/* Reset prev on each retry.  See note below for the reason. */</span>
<a name="l01200"></a>01200       prev = _prev;
<a name="l01201"></a>01201       <a class="code" href="linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc" title="Read locks a list.">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>);
<a name="l01202"></a>01202       <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>, c, <a class="code" href="structchan__list.html" title="Channel call record structure.">chan_list</a>) {
<a name="l01203"></a>01203          <span class="keywordflow">if</span> (prev) { <span class="comment">/* look for last item, first, before any evaluation */</span>
<a name="l01204"></a>01204             <span class="keywordflow">if</span> (c != prev) <span class="comment">/* not this one */</span>
<a name="l01205"></a>01205                <span class="keywordflow">continue</span>;
<a name="l01206"></a>01206             <span class="comment">/* found, prepare to return c-&gt;next */</span>
<a name="l01207"></a>01207             <span class="keywordflow">if</span> ((c = <a class="code" href="linkedlists_8h.html#a5c021d1e034a53d09360da4d95c76220">AST_RWLIST_NEXT</a>(c, <a class="code" href="structchan__list.html" title="Channel call record structure.">chan_list</a>)) == NULL) <span class="keywordflow">break</span>;<span class="comment"></span>
<a name="l01208"></a>01208 <span class="comment">            /*!\note</span>
<a name="l01209"></a>01209 <span class="comment">             * We&apos;re done searching through the list for the previous item.</span>
<a name="l01210"></a>01210 <span class="comment">             * Any item after this point, we want to evaluate for a match.</span>
<a name="l01211"></a>01211 <span class="comment">             * If we didn&apos;t set prev to NULL here, then we would only</span>
<a name="l01212"></a>01212 <span class="comment">             * return matches for the first matching item (since the above</span>
<a name="l01213"></a>01213 <span class="comment">             * &quot;if (c != prev)&quot; would not permit any other potential</span>
<a name="l01214"></a>01214 <span class="comment">             * matches to reach the additional matching logic, below).</span>
<a name="l01215"></a>01215 <span class="comment">             * Instead, it would just iterate until it once again found the</span>
<a name="l01216"></a>01216 <span class="comment">             * original match, then iterate down to the end of the list and</span>
<a name="l01217"></a>01217 <span class="comment">             * quit.</span>
<a name="l01218"></a>01218 <span class="comment">             */</span>
<a name="l01219"></a>01219             prev = NULL;
<a name="l01220"></a>01220          }
<a name="l01221"></a>01221          <span class="keywordflow">if</span> (<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>) { <span class="comment">/* want match by name */</span>
<a name="l01222"></a>01222             <span class="keywordflow">if</span> ((!namelen &amp;&amp; strcasecmp(c-&gt;name, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>) &amp;&amp; strcmp(c-&gt;uniqueid, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>)) ||
<a name="l01223"></a>01223                 (namelen &amp;&amp; strncasecmp(c-&gt;name, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, namelen)))
<a name="l01224"></a>01224                <span class="keywordflow">continue</span>;   <span class="comment">/* name match failed */</span>
<a name="l01225"></a>01225          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>) {
<a name="l01226"></a>01226             <span class="keywordflow">if</span> (<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a> &amp;&amp; strcasecmp(c-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>) &amp;&amp;
<a name="l01227"></a>01227                 strcasecmp(c-&gt;<a class="code" href="structast__channel.html#a0a602b0f10ece2644f247c3f6ff841e0">macrocontext</a>, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>))
<a name="l01228"></a>01228                <span class="keywordflow">continue</span>;   <span class="comment">/* context match failed */</span>
<a name="l01229"></a>01229             <span class="keywordflow">if</span> (strcasecmp(c-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>) &amp;&amp;
<a name="l01230"></a>01230                 strcasecmp(c-&gt;<a class="code" href="structast__channel.html#a582cff3075953f73ba96888167acf009">macroexten</a>, <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>))
<a name="l01231"></a>01231                <span class="keywordflow">continue</span>;   <span class="comment">/* exten match failed */</span>
<a name="l01232"></a>01232          }
<a name="l01233"></a>01233          <span class="comment">/* if we get here, c points to the desired record */</span>
<a name="l01234"></a>01234          <span class="keywordflow">break</span>;
<a name="l01235"></a>01235       }
<a name="l01236"></a>01236       <span class="comment">/* exit if chan not found or mutex acquired successfully */</span>
<a name="l01237"></a>01237       <span class="comment">/* this is slightly unsafe, as we _should_ hold the lock to access c-&gt;name */</span>
<a name="l01238"></a>01238       done = c == NULL || <a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(c) == 0;
<a name="l01239"></a>01239       <span class="keywordflow">if</span> (!done) {
<a name="l01240"></a>01240          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Avoiding %s for channel &apos;%p&apos;\n&quot;</span>, msg, c);
<a name="l01241"></a>01241          <span class="keywordflow">if</span> (retries == 199) {
<a name="l01242"></a>01242             <span class="comment">/* We are about to fail due to a deadlock, so report this</span>
<a name="l01243"></a>01243 <span class="comment">             * while we still have the list lock.</span>
<a name="l01244"></a>01244 <span class="comment">             */</span>
<a name="l01245"></a>01245             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Failure, could not lock &apos;%p&apos; after %d retries!\n&quot;</span>, c, retries);
<a name="l01246"></a>01246             <span class="comment">/* As we have deadlocked, we will skip this channel and</span>
<a name="l01247"></a>01247 <span class="comment">             * see if there is another match.</span>
<a name="l01248"></a>01248 <span class="comment">             * NOTE: No point doing this for a full-name match,</span>
<a name="l01249"></a>01249 <span class="comment">             * as there can be no more matches.</span>
<a name="l01250"></a>01250 <span class="comment">             */</span>
<a name="l01251"></a>01251             <span class="keywordflow">if</span> (!(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a> &amp;&amp; !namelen)) {
<a name="l01252"></a>01252                prev = c;
<a name="l01253"></a>01253                retries = -1;
<a name="l01254"></a>01254             }
<a name="l01255"></a>01255          }
<a name="l01256"></a>01256       }
<a name="l01257"></a>01257       <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>);
<a name="l01258"></a>01258       <span class="keywordflow">if</span> (done)
<a name="l01259"></a>01259          <span class="keywordflow">return</span> c;
<a name="l01260"></a>01260       <span class="comment">/* If we reach this point we basically tried to lock a channel and failed. Instead of</span>
<a name="l01261"></a>01261 <span class="comment">       * starting from the beginning of the list we can restore our saved pointer to the previous</span>
<a name="l01262"></a>01262 <span class="comment">       * channel and start from there.</span>
<a name="l01263"></a>01263 <span class="comment">       */</span>
<a name="l01264"></a>01264       prev = _prev;
<a name="l01265"></a>01265       usleep(1);  <span class="comment">/* give other threads a chance before retrying */</span>
<a name="l01266"></a>01266    }
<a name="l01267"></a>01267 
<a name="l01268"></a>01268    <span class="keywordflow">return</span> NULL;
<a name="l01269"></a>01269 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1bb47a3ff4d73a9472f65d00390334c1"></a><!-- doxytag: member="channel.c::channelreloadreason2txt" ref="a1bb47a3ff4d73a9472f65d00390334c1" args="(enum channelreloadreason reason)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* channelreloadreason2txt </td>
          <td>(</td>
          <td class="paramtype">enum <a class="el" href="channel_8h.html#a57da1ebf1ede65e10ad6816afcab4afe">channelreloadreason</a>&nbsp;</td>
          <td class="paramname"> <em>reason</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Convert enum channelreloadreason to text string for manager event. </p>
<p>\ brief Convert channel reloadreason (ENUM) to text string for manager event </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l05680">5680</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00648">CHANNEL_CLI_RELOAD</a>, <a class="el" href="channel_8h_source.html#l00646">CHANNEL_MODULE_LOAD</a>, and <a class="el" href="channel_8h_source.html#l00647">CHANNEL_MODULE_RELOAD</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l24245">reload_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05681"></a>05681 {
<a name="l05682"></a>05682    <span class="keywordflow">switch</span> (reason) {
<a name="l05683"></a>05683    <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a57da1ebf1ede65e10ad6816afcab4afea2a5002ac510eb1c7213d4677290f8e3b">CHANNEL_MODULE_LOAD</a>:
<a name="l05684"></a>05684       <span class="keywordflow">return</span> <span class="stringliteral">&quot;LOAD (Channel module load)&quot;</span>;
<a name="l05685"></a>05685 
<a name="l05686"></a>05686    <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a57da1ebf1ede65e10ad6816afcab4afea24a926471fb3c9423e82867d4570ba17">CHANNEL_MODULE_RELOAD</a>:
<a name="l05687"></a>05687       <span class="keywordflow">return</span> <span class="stringliteral">&quot;RELOAD (Channel module reload)&quot;</span>;
<a name="l05688"></a>05688 
<a name="l05689"></a>05689    <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a57da1ebf1ede65e10ad6816afcab4afea07e8dcd9478b049ca262fb50e68b6451">CHANNEL_CLI_RELOAD</a>:
<a name="l05690"></a>05690       <span class="keywordflow">return</span> <span class="stringliteral">&quot;CLIRELOAD (Channel module reload by CLI command)&quot;</span>;
<a name="l05691"></a>05691 
<a name="l05692"></a>05692    <span class="keywordflow">default</span>:
<a name="l05693"></a>05693       <span class="keywordflow">return</span> <span class="stringliteral">&quot;MANAGERRELOAD (Channel module reload by manager)&quot;</span>;
<a name="l05694"></a>05694    }
<a name="l05695"></a>05695 };
</pre></div></p>

</div>
</div>
<a class="anchor" id="a21d6a634f2f99c44233e6c734aadc233"></a><!-- doxytag: member="channel.c::clone_variables" ref="a21d6a634f2f99c44233e6c734aadc233" args="(struct ast_channel *original, struct ast_channel *clonechan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void clone_variables </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>original</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>clonechan</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Clone channel variables from 'clone' channel into 'original' channel. </p>
<p>All variables except those related to app_groupcount are cloned. Variables are actually _removed_ from 'clone' channel, presumably because it will subsequently be destroyed.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>Assumes locks will be in place on both <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> when called. </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l04351">4351</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00767">AST_LIST_APPEND_LIST</a>, <a class="el" href="linkedlists_8h_source.html#l00420">AST_LIST_FIRST</a>, <a class="el" href="linkedlists_8h_source.html#l00715">AST_LIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="chanvars_8c_source.html#l00037">ast_var_assign()</a>, <a class="el" href="chanvars_8h_source.html#l00031">ast_var_t::name</a>, <a class="el" href="chanvars_8h_source.html#l00030">ast_var_t::value</a>, and <a class="el" href="channel_8h_source.html#l00446">ast_channel::varshead</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l04393">ast_do_masquerade()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04352"></a>04352 {
<a name="l04353"></a>04353    <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a> *current, *newvar;
<a name="l04354"></a>04354    <span class="comment">/* Append variables from clone channel into original channel */</span>
<a name="l04355"></a>04355    <span class="comment">/* XXX Is this always correct?  We have to in order to keep MACROS working XXX */</span>
<a name="l04356"></a>04356    <span class="keywordflow">if</span> (<a class="code" href="linkedlists_8h.html#adf1959c5c03a3a706da97ad2f49617e5" title="Returns the first entry contained in a list.">AST_LIST_FIRST</a>(&amp;clonechan-&gt;<a class="code" href="structast__channel.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>))
<a name="l04357"></a>04357       <a class="code" href="linkedlists_8h.html#ad66405f1d0b9e1fb484643d9a36e94ed" title="Appends a whole list to the tail of a list.">AST_LIST_APPEND_LIST</a>(&amp;original-&gt;<a class="code" href="structast__channel.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>, &amp;clonechan-&gt;<a class="code" href="structast__channel.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>, entries);
<a name="l04358"></a>04358 
<a name="l04359"></a>04359    <span class="comment">/* then, dup the varshead list into the clone */</span>
<a name="l04360"></a>04360    
<a name="l04361"></a>04361    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;original-&gt;<a class="code" href="structast__channel.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>, current, entries) {
<a name="l04362"></a>04362       newvar = <a class="code" href="chanvars_8h.html#a8ea2b5a29fa275115c7ed27a593b727d">ast_var_assign</a>(current-&gt;<a class="code" href="structast__var__t.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>, current-&gt;<a class="code" href="structast__var__t.html#a4e9aec275e566b978a3ccb4e043d8c61">value</a>);
<a name="l04363"></a>04363       <span class="keywordflow">if</span> (newvar)
<a name="l04364"></a>04364          <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;clonechan-&gt;<a class="code" href="structast__channel.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>, newvar, entries);
<a name="l04365"></a>04365    }
<a name="l04366"></a>04366 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8b42faf0887d5d592b2ac859e629e0a2"></a><!-- doxytag: member="channel.c::complete_channeltypes" ref="a8b42faf0887d5d592b2ac859e629e0a2" args="(struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* complete_channeltypes </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l00246">246</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="cli_8h_source.html#l00145">ast_cli_args::n</a>, <a class="el" href="cli_8h_source.html#l00144">ast_cli_args::pos</a>, <a class="el" href="channel_8c_source.html#l00104">chanlist::tech</a>, <a class="el" href="channel_8h_source.html#l00226">ast_channel_tech::type</a>, and <a class="el" href="cli_8h_source.html#l00143">ast_cli_args::word</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l00269">handle_cli_core_show_channeltype()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00247"></a>00247 {
<a name="l00248"></a>00248    <span class="keyword">struct </span><a class="code" href="structchanlist.html" title="List of channel drivers.">chanlist</a> *cl;
<a name="l00249"></a>00249    <span class="keywordtype">int</span> which = 0;
<a name="l00250"></a>00250    <span class="keywordtype">int</span> wordlen;
<a name="l00251"></a>00251    <span class="keywordtype">char</span> *ret = NULL;
<a name="l00252"></a>00252 
<a name="l00253"></a>00253    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#a1910d262855b71da353ed0d07a6c7823">pos</a> != 3)
<a name="l00254"></a>00254       <span class="keywordflow">return</span> NULL;
<a name="l00255"></a>00255 
<a name="l00256"></a>00256    wordlen = strlen(a-&gt;<a class="code" href="structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>);
<a name="l00257"></a>00257 
<a name="l00258"></a>00258    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="structbackends.html" title="the list of registered channel types">backends</a>, cl, <a class="code" href="structchanlist.html#ae16c3868ae9c6fd5cf5a94bc9fb6940c">list</a>) {
<a name="l00259"></a>00259       <span class="keywordflow">if</span> (!strncasecmp(a-&gt;<a class="code" href="structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>, cl-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>, wordlen) &amp;&amp; ++which &gt; a-&gt;<a class="code" href="structast__cli__args.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>) {
<a name="l00260"></a>00260          ret = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(cl-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>);
<a name="l00261"></a>00261          <span class="keywordflow">break</span>;
<a name="l00262"></a>00262       }
<a name="l00263"></a>00263    }
<a name="l00264"></a>00264    
<a name="l00265"></a>00265    <span class="keywordflow">return</span> ret;
<a name="l00266"></a>00266 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2bbdbf1f645a90d6271f82c79c0fb2cc"></a><!-- doxytag: member="channel.c::free_cid" ref="a2bbdbf1f645a90d6271f82c79c0fb2cc" args="(struct ast_callerid *cid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void free_cid </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__callerid.html">ast_callerid</a> *&nbsp;</td>
          <td class="paramname"> <em>cid</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l01372">1372</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="channel_8h_source.html#l00205">ast_callerid::cid_ani</a>, <a class="el" href="channel_8h_source.html#l00202">ast_callerid::cid_dnid</a>, <a class="el" href="channel_8h_source.html#l00204">ast_callerid::cid_name</a>, <a class="el" href="channel_8h_source.html#l00203">ast_callerid::cid_num</a>, and <a class="el" href="channel_8h_source.html#l00206">ast_callerid::cid_rdnis</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l01388">ast_channel_free()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01373"></a>01373 {
<a name="l01374"></a>01374    <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="structast__callerid.html#aa54ab157f47ac529034d524781e2a7e2">cid_dnid</a>)
<a name="l01375"></a>01375       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(cid-&gt;<a class="code" href="structast__callerid.html#aa54ab157f47ac529034d524781e2a7e2">cid_dnid</a>);
<a name="l01376"></a>01376    <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>)
<a name="l01377"></a>01377       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(cid-&gt;<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>); 
<a name="l01378"></a>01378    <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a>)
<a name="l01379"></a>01379       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(cid-&gt;<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a>);   
<a name="l01380"></a>01380    <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="structast__callerid.html#a7bb8ad258e687da69d6933ab48320df7">cid_ani</a>)
<a name="l01381"></a>01381       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(cid-&gt;<a class="code" href="structast__callerid.html#a7bb8ad258e687da69d6933ab48320df7">cid_ani</a>);
<a name="l01382"></a>01382    <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="structast__callerid.html#a4791c5f3aedc8782678867a1741f4131">cid_rdnis</a>)
<a name="l01383"></a>01383       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(cid-&gt;<a class="code" href="structast__callerid.html#a4791c5f3aedc8782678867a1741f4131">cid_rdnis</a>);
<a name="l01384"></a>01384    cid-&gt;<a class="code" href="structast__callerid.html#aa54ab157f47ac529034d524781e2a7e2">cid_dnid</a> = cid-&gt;<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a> = cid-&gt;<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a> = cid-&gt;<a class="code" href="structast__callerid.html#a7bb8ad258e687da69d6933ab48320df7">cid_ani</a> = cid-&gt;<a class="code" href="structast__callerid.html#a4791c5f3aedc8782678867a1741f4131">cid_rdnis</a> = NULL;
<a name="l01385"></a>01385 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac9d4d03c20c48d15d9e91a85c5e35d67"></a><!-- doxytag: member="channel.c::free_translation" ref="ac9d4d03c20c48d15d9e91a85c5e35d67" args="(struct ast_channel *clonechan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void free_translation </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>clonechan</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l01677">1677</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="translate_8c_source.html#l00253">ast_translator_free_path()</a>, <a class="el" href="channel_8h_source.html#l00482">ast_channel::nativeformats</a>, <a class="el" href="channel_8h_source.html#l00485">ast_channel::rawreadformat</a>, <a class="el" href="channel_8h_source.html#l00486">ast_channel::rawwriteformat</a>, <a class="el" href="channel_8h_source.html#l00420">ast_channel::readtrans</a>, and <a class="el" href="channel_8h_source.html#l00419">ast_channel::writetrans</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l04393">ast_do_masquerade()</a>, and <a class="el" href="channel_8c_source.html#l01690">ast_hangup()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01678"></a>01678 {
<a name="l01679"></a>01679    <span class="keywordflow">if</span> (clonechan-&gt;<a class="code" href="structast__channel.html#a58d0c117fa64b075eda1d9a7a7d73531">writetrans</a>)
<a name="l01680"></a>01680       <a class="code" href="translate_8h.html#a8f767bf5c2095f182e7cbaa73e391207" title="Frees a translator path Frees the given translator path structure.">ast_translator_free_path</a>(clonechan-&gt;<a class="code" href="structast__channel.html#a58d0c117fa64b075eda1d9a7a7d73531">writetrans</a>);
<a name="l01681"></a>01681    <span class="keywordflow">if</span> (clonechan-&gt;<a class="code" href="structast__channel.html#a9601e6aff2a4c59cbeb9d6fef81184f4">readtrans</a>)
<a name="l01682"></a>01682       <a class="code" href="translate_8h.html#a8f767bf5c2095f182e7cbaa73e391207" title="Frees a translator path Frees the given translator path structure.">ast_translator_free_path</a>(clonechan-&gt;<a class="code" href="structast__channel.html#a9601e6aff2a4c59cbeb9d6fef81184f4">readtrans</a>);
<a name="l01683"></a>01683    clonechan-&gt;<a class="code" href="structast__channel.html#a58d0c117fa64b075eda1d9a7a7d73531">writetrans</a> = NULL;
<a name="l01684"></a>01684    clonechan-&gt;<a class="code" href="structast__channel.html#a9601e6aff2a4c59cbeb9d6fef81184f4">readtrans</a> = NULL;
<a name="l01685"></a>01685    clonechan-&gt;<a class="code" href="structast__channel.html#a045b6dfdee84adceb7e86b6c5c4f9a86">rawwriteformat</a> = clonechan-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>;
<a name="l01686"></a>01686    clonechan-&gt;<a class="code" href="structast__channel.html#a6fcf944239e3718e282e0ba7512e66c6">rawreadformat</a> = clonechan-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>;
<a name="l01687"></a>01687 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a99698cbdfd9c1a86f36e0a226076e69f"></a><!-- doxytag: member="channel.c::generator_force" ref="a99698cbdfd9c1a86f36e0a226076e69f" args="(const void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int generator_force </td>
          <td>(</td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l01971">1971</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="channel_8c_source.html#l01956">ast_deactivate_generator()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8h_source.html#l00273">AST_FORMAT_AUDIO_MASK</a>, <a class="el" href="frame_8h_source.html#l00680">ast_format_rate()</a>, <a class="el" href="structast__generator.html#a92f5f90f97b5e9124c843b5e81d8b53a">ast_generator::generate</a>, <a class="el" href="channel_8h_source.html#l00404">ast_channel::generator</a>, <a class="el" href="channel_8h_source.html#l00403">ast_channel::generatordata</a>, and <a class="el" href="channel_8h_source.html#l00484">ast_channel::writeformat</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l02001">ast_activate_generator()</a>, and <a class="el" href="channel_8c_source.html#l02530">ast_read_generator_actions()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01972"></a>01972 {
<a name="l01973"></a>01973    <span class="comment">/* Called if generator doesn&apos;t have data */</span>
<a name="l01974"></a>01974    <span class="keywordtype">void</span> *tmp;
<a name="l01975"></a>01975    <span class="keywordtype">int</span> res;
<a name="l01976"></a>01976    int (*generate)(<span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, <span class="keywordtype">void</span> *tmp, <span class="keywordtype">int</span> datalen, <span class="keywordtype">int</span> samples) = NULL;
<a name="l01977"></a>01977    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *chan = (<span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *)<a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>;
<a name="l01978"></a>01978 
<a name="l01979"></a>01979    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l01980"></a>01980    tmp = chan-&gt;<a class="code" href="structast__channel.html#abe7876f86e249ea3db5fbacd2231389c">generatordata</a>;
<a name="l01981"></a>01981    chan-&gt;<a class="code" href="structast__channel.html#abe7876f86e249ea3db5fbacd2231389c">generatordata</a> = NULL;
<a name="l01982"></a>01982    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a4e855ab0f984741b9083b2c5a0fdfe18">generator</a>)
<a name="l01983"></a>01983       generate = chan-&gt;<a class="code" href="structast__channel.html#a4e855ab0f984741b9083b2c5a0fdfe18">generator</a>-&gt;<a class="code" href="structast__generator.html#a92f5f90f97b5e9124c843b5e81d8b53a">generate</a>;
<a name="l01984"></a>01984    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l01985"></a>01985 
<a name="l01986"></a>01986    <span class="keywordflow">if</span> (!tmp || !generate)
<a name="l01987"></a>01987       <span class="keywordflow">return</span> 0;
<a name="l01988"></a>01988 
<a name="l01989"></a>01989    res = generate(chan, tmp, 0, <a class="code" href="frame_8h.html#a29a7b93f4295966d4d441e91bff2b01e" title="Get the sample rate for a given format.">ast_format_rate</a>(chan-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a> &amp; <a class="code" href="frame_8h.html#a3f680b9c15596de927d507a664fd2803">AST_FORMAT_AUDIO_MASK</a>) / 50);
<a name="l01990"></a>01990 
<a name="l01991"></a>01991    chan-&gt;<a class="code" href="structast__channel.html#abe7876f86e249ea3db5fbacd2231389c">generatordata</a> = tmp;
<a name="l01992"></a>01992 
<a name="l01993"></a>01993    <span class="keywordflow">if</span> (res) {
<a name="l01994"></a>01994       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Auto-deactivating generator\n&quot;</span>);
<a name="l01995"></a>01995       <a class="code" href="channel_8h.html#a7160355005776732fba88cc020f4a45b">ast_deactivate_generator</a>(chan);
<a name="l01996"></a>01996    }
<a name="l01997"></a>01997 
<a name="l01998"></a>01998    <span class="keywordflow">return</span> 0;
<a name="l01999"></a>01999 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1d6e6458df4bfcb132a6934bafdb7fcc"></a><!-- doxytag: member="channel.c::handle_cause" ref="a1d6e6458df4bfcb132a6934bafdb7fcc" args="(int cause, int *outstate)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void handle_cause </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cause</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>outstate</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l03766">3766</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="causes_8h_source.html#l00147">AST_CAUSE_BUSY</a>, <a class="el" href="causes_8h_source.html#l00151">AST_CAUSE_CONGESTION</a>, <a class="el" href="frame_8h_source.html#l00302">AST_CONTROL_BUSY</a>, and <a class="el" href="frame_8h_source.html#l00305">AST_CONTROL_CONGESTION</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l03851">__ast_request_and_dial()</a>, and <a class="el" href="channel_8c_source.html#l03779">ast_call_forward()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03767"></a>03767 {
<a name="l03768"></a>03768    <span class="keywordflow">if</span> (outstate) {
<a name="l03769"></a>03769       <span class="comment">/* compute error and return */</span>
<a name="l03770"></a>03770       <span class="keywordflow">if</span> (<a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a> == <a class="code" href="causes_8h.html#ae009c193522491f7de7ea28b23f20868">AST_CAUSE_BUSY</a>)
<a name="l03771"></a>03771          *outstate = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875">AST_CONTROL_BUSY</a>;
<a name="l03772"></a>03772       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a> == <a class="code" href="causes_8h.html#a0a35518d7b448a53da368cf57f354fba">AST_CAUSE_CONGESTION</a>)
<a name="l03773"></a>03773          *outstate = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a850bb06a1702741c93a3fd67cc9637ab">AST_CONTROL_CONGESTION</a>;
<a name="l03774"></a>03774       <span class="keywordflow">else</span>
<a name="l03775"></a>03775          *outstate = 0;
<a name="l03776"></a>03776    }
<a name="l03777"></a>03777 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a756671fc7041ac4e1bd415d4348aeae3"></a><!-- doxytag: member="channel.c::handle_cli_core_show_channeltype" ref="a756671fc7041ac4e1bd415d4348aeae3" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_cli_core_show_channeltype </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Show details about a channel driver - CLI command. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l00269">269</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00077">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="channel_8h_source.html#l00229">ast_channel_tech::capabilities</a>, <a class="el" href="cli_8h_source.html#l00045">CLI_FAILURE</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="channel_8c_source.html#l00246">complete_channeltypes()</a>, <a class="el" href="structast__channel__tech.html#a3686404e825be25c25c6cff50970e1de">ast_channel_tech::devicestate</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="structast__channel__tech.html#a21e97c64bf4c9c328fa344d29ee1c065">ast_channel_tech::indicate</a>, <a class="el" href="structast__channel__tech.html#a83b4c653034ecac13d1abc179d0535d8">ast_channel_tech::send_digit_begin</a>, <a class="el" href="structast__channel__tech.html#a72ca2103b9f51ffa15e4e8b1d0d161d1">ast_channel_tech::send_digit_end</a>, <a class="el" href="structast__channel__tech.html#a8169d0cdf14765d08ed132b495170e3b">ast_channel_tech::send_html</a>, <a class="el" href="structast__channel__tech.html#a7f06ade1902a58a978820e37136318c3">ast_channel_tech::send_image</a>, <a class="el" href="structast__channel__tech.html#a675e5d4613f3af64e46d5dd8c12544cc">ast_channel_tech::send_text</a>, <a class="el" href="channel_8c_source.html#l00104">chanlist::tech</a>, <a class="el" href="structast__channel__tech.html#a21c3e9be40870d98c41764090f3afdd4">ast_channel_tech::transfer</a>, <a class="el" href="channel_8h_source.html#l00226">ast_channel_tech::type</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00270"></a>00270 {
<a name="l00271"></a>00271    <span class="keyword">struct </span><a class="code" href="structchanlist.html" title="List of channel drivers.">chanlist</a> *cl = NULL;
<a name="l00272"></a>00272 
<a name="l00273"></a>00273    <span class="keywordflow">switch</span> (cmd) {
<a name="l00274"></a>00274    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l00275"></a>00275       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;core show channeltype&quot;</span>;
<a name="l00276"></a>00276       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l00277"></a>00277          <span class="stringliteral">&quot;Usage: core show channeltype &lt;name&gt;\n&quot;</span>
<a name="l00278"></a>00278          <span class="stringliteral">&quot;  Show details about the specified channel type, &lt;name&gt;.\n&quot;</span>;
<a name="l00279"></a>00279       <span class="keywordflow">return</span> NULL;
<a name="l00280"></a>00280    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l00281"></a>00281       <span class="keywordflow">return</span> <a class="code" href="channel_8c.html#a8b42faf0887d5d592b2ac859e629e0a2">complete_channeltypes</a>(a);
<a name="l00282"></a>00282    }
<a name="l00283"></a>00283 
<a name="l00284"></a>00284    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != 4)
<a name="l00285"></a>00285       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l00286"></a>00286    
<a name="l00287"></a>00287    <a class="code" href="linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc" title="Read locks a list.">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>);
<a name="l00288"></a>00288 
<a name="l00289"></a>00289    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="structbackends.html" title="the list of registered channel types">backends</a>, cl, <a class="code" href="structchanlist.html#ae16c3868ae9c6fd5cf5a94bc9fb6940c">list</a>) {
<a name="l00290"></a>00290       <span class="keywordflow">if</span> (!strncasecmp(cl-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>, a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3], strlen(cl-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>)))
<a name="l00291"></a>00291          <span class="keywordflow">break</span>;
<a name="l00292"></a>00292    }
<a name="l00293"></a>00293 
<a name="l00294"></a>00294 
<a name="l00295"></a>00295    <span class="keywordflow">if</span> (!cl) {
<a name="l00296"></a>00296       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;\n%s is not a registered channel driver.\n&quot;</span>, a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3]);
<a name="l00297"></a>00297       <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>);
<a name="l00298"></a>00298       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;
<a name="l00299"></a>00299    }
<a name="l00300"></a>00300 
<a name="l00301"></a>00301    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>,
<a name="l00302"></a>00302       <span class="stringliteral">&quot;-- Info about channel driver: %s --\n&quot;</span>
<a name="l00303"></a>00303       <span class="stringliteral">&quot;  Device State: %s\n&quot;</span>
<a name="l00304"></a>00304       <span class="stringliteral">&quot;    Indication: %s\n&quot;</span>
<a name="l00305"></a>00305       <span class="stringliteral">&quot;     Transfer : %s\n&quot;</span>
<a name="l00306"></a>00306       <span class="stringliteral">&quot;  Capabilities: %d\n&quot;</span>
<a name="l00307"></a>00307       <span class="stringliteral">&quot;   Digit Begin: %s\n&quot;</span>
<a name="l00308"></a>00308       <span class="stringliteral">&quot;     Digit End: %s\n&quot;</span>
<a name="l00309"></a>00309       <span class="stringliteral">&quot;    Send HTML : %s\n&quot;</span>
<a name="l00310"></a>00310       <span class="stringliteral">&quot; Image Support: %s\n&quot;</span>
<a name="l00311"></a>00311       <span class="stringliteral">&quot;  Text Support: %s\n&quot;</span>,
<a name="l00312"></a>00312       cl-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>,
<a name="l00313"></a>00313       (cl-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a3686404e825be25c25c6cff50970e1de">devicestate</a>) ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>,
<a name="l00314"></a>00314       (cl-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a21e97c64bf4c9c328fa344d29ee1c065" title="Indicate a particular condition (e.g. AST_CONTROL_BUSY or AST_CONTROL_RINGING or...">indicate</a>) ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>,
<a name="l00315"></a>00315       (cl-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a21c3e9be40870d98c41764090f3afdd4" title="Blind transfer other side (see app_transfer.c and ast_transfer().">transfer</a>) ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>,
<a name="l00316"></a>00316       (cl-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a9461ee266923070466f95a76158f65cd">capabilities</a>) ? cl-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a9461ee266923070466f95a76158f65cd">capabilities</a> : -1,
<a name="l00317"></a>00317       (cl-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a83b4c653034ecac13d1abc179d0535d8" title="Start sending a literal DTMF digit.">send_digit_begin</a>) ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>,
<a name="l00318"></a>00318       (cl-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a72ca2103b9f51ffa15e4e8b1d0d161d1" title="Stop sending a literal DTMF digit.">send_digit_end</a>) ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>,
<a name="l00319"></a>00319       (cl-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a8169d0cdf14765d08ed132b495170e3b" title="Send HTML data.">send_html</a>) ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>,
<a name="l00320"></a>00320       (cl-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a7f06ade1902a58a978820e37136318c3" title="Display or send an image.">send_image</a>) ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>,
<a name="l00321"></a>00321       (cl-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a675e5d4613f3af64e46d5dd8c12544cc" title="Display or transmit text.">send_text</a>) ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>
<a name="l00322"></a>00322       
<a name="l00323"></a>00323    );
<a name="l00324"></a>00324 
<a name="l00325"></a>00325    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>);
<a name="l00326"></a>00326    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l00327"></a>00327 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ada1321e35ae7c038a2018396a99abbed"></a><!-- doxytag: member="channel.c::handle_cli_core_show_channeltypes" ref="ada1321e35ae7c038a2018396a99abbed" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_cli_core_show_channeltypes </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Show channel types - CLI command. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l00203">203</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00077">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="channel_8h_source.html#l00227">ast_channel_tech::description</a>, <a class="el" href="structast__channel__tech.html#a3686404e825be25c25c6cff50970e1de">ast_channel_tech::devicestate</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="chan__dahdi_8c.html#ac8dc47e3b39c930caed4bfd05b4ba805">FORMAT</a>, <a class="el" href="structast__channel__tech.html#a21e97c64bf4c9c328fa344d29ee1c065">ast_channel_tech::indicate</a>, <a class="el" href="channel_8c_source.html#l00104">chanlist::tech</a>, <a class="el" href="structast__channel__tech.html#a21c3e9be40870d98c41764090f3afdd4">ast_channel_tech::transfer</a>, <a class="el" href="channel_8h_source.html#l00226">ast_channel_tech::type</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00204"></a>00204 {
<a name="l00205"></a>00205 <span class="preprocessor">#define FORMAT  &quot;%-10.10s  %-40.40s %-12.12s %-12.12s %-12.12s\n&quot;</span>
<a name="l00206"></a>00206 <span class="preprocessor"></span>   <span class="keyword">struct </span><a class="code" href="structchanlist.html" title="List of channel drivers.">chanlist</a> *cl;
<a name="l00207"></a>00207    <span class="keywordtype">int</span> count_chan = 0;
<a name="l00208"></a>00208 
<a name="l00209"></a>00209    <span class="keywordflow">switch</span> (cmd) {
<a name="l00210"></a>00210    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l00211"></a>00211       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;core show channeltypes&quot;</span>;
<a name="l00212"></a>00212       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l00213"></a>00213          <span class="stringliteral">&quot;Usage: core show channeltypes\n&quot;</span>
<a name="l00214"></a>00214          <span class="stringliteral">&quot;       Lists available channel types registered in your\n&quot;</span>
<a name="l00215"></a>00215          <span class="stringliteral">&quot;       Asterisk server.\n&quot;</span>;
<a name="l00216"></a>00216       <span class="keywordflow">return</span> NULL;
<a name="l00217"></a>00217    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l00218"></a>00218       <span class="keywordflow">return</span> NULL;
<a name="l00219"></a>00219    }
<a name="l00220"></a>00220 
<a name="l00221"></a>00221    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != 3)
<a name="l00222"></a>00222       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l00223"></a>00223 
<a name="l00224"></a>00224    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, FORMAT, <span class="stringliteral">&quot;Type&quot;</span>, <span class="stringliteral">&quot;Description&quot;</span>,       <span class="stringliteral">&quot;Devicestate&quot;</span>, <span class="stringliteral">&quot;Indications&quot;</span>, <span class="stringliteral">&quot;Transfer&quot;</span>);
<a name="l00225"></a>00225    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, FORMAT, <span class="stringliteral">&quot;----------&quot;</span>, <span class="stringliteral">&quot;-----------&quot;</span>, <span class="stringliteral">&quot;-----------&quot;</span>, <span class="stringliteral">&quot;-----------&quot;</span>, <span class="stringliteral">&quot;--------&quot;</span>);
<a name="l00226"></a>00226 
<a name="l00227"></a>00227    <a class="code" href="linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc" title="Read locks a list.">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>);
<a name="l00228"></a>00228 
<a name="l00229"></a>00229    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="structbackends.html" title="the list of registered channel types">backends</a>, cl, <a class="code" href="structchanlist.html#ae16c3868ae9c6fd5cf5a94bc9fb6940c">list</a>) {
<a name="l00230"></a>00230       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, FORMAT, cl-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>, cl-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#ac57ec035c076b222b9420a68ddab3bf1">description</a>,
<a name="l00231"></a>00231          (cl-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a3686404e825be25c25c6cff50970e1de">devicestate</a>) ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>,
<a name="l00232"></a>00232          (cl-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a21e97c64bf4c9c328fa344d29ee1c065" title="Indicate a particular condition (e.g. AST_CONTROL_BUSY or AST_CONTROL_RINGING or...">indicate</a>) ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>,
<a name="l00233"></a>00233          (cl-&gt;<a class="code" href="structchanlist.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a21c3e9be40870d98c41764090f3afdd4" title="Blind transfer other side (see app_transfer.c and ast_transfer().">transfer</a>) ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>);
<a name="l00234"></a>00234       count_chan++;
<a name="l00235"></a>00235    }
<a name="l00236"></a>00236 
<a name="l00237"></a>00237    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>);
<a name="l00238"></a>00238 
<a name="l00239"></a>00239    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;----------\n%d channel drivers registered.\n&quot;</span>, count_chan);
<a name="l00240"></a>00240 
<a name="l00241"></a>00241    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l00242"></a>00242 
<a name="l00243"></a>00243 <span class="preprocessor">#undef FORMAT</span>
<a name="l00244"></a>00244 <span class="preprocessor"></span>}
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad06e1b83ea6a33e096035c7ac0be5a20"></a><!-- doxytag: member="channel.c::is_visible_indication" ref="ad06e1b83ea6a33e096035c7ac0be5a20" args="(enum ast_control_frame_type condition)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int attribute_const is_visible_indication </td>
          <td>(</td>
          <td class="paramtype">enum <a class="el" href="frame_8h.html#aedda41918e992000fe921f8f7363b390">ast_control_frame_type</a>&nbsp;</td>
          <td class="paramname"> <em>condition</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l03115">3115</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00316">_XXX_AST_CONTROL_T38</a>, <a class="el" href="frame_8h_source.html#l00301">AST_CONTROL_ANSWER</a>, <a class="el" href="frame_8h_source.html#l00302">AST_CONTROL_BUSY</a>, <a class="el" href="frame_8h_source.html#l00305">AST_CONTROL_CONGESTION</a>, <a class="el" href="frame_8h_source.html#l00306">AST_CONTROL_FLASH</a>, <a class="el" href="frame_8h_source.html#l00298">AST_CONTROL_HANGUP</a>, <a class="el" href="frame_8h_source.html#l00313">AST_CONTROL_HOLD</a>, <a class="el" href="frame_8h_source.html#l00304">AST_CONTROL_OFFHOOK</a>, <a class="el" href="frame_8h_source.html#l00308">AST_CONTROL_OPTION</a>, <a class="el" href="frame_8h_source.html#l00312">AST_CONTROL_PROCEEDING</a>, <a class="el" href="frame_8h_source.html#l00311">AST_CONTROL_PROGRESS</a>, <a class="el" href="frame_8h_source.html#l00309">AST_CONTROL_RADIO_KEY</a>, <a class="el" href="frame_8h_source.html#l00310">AST_CONTROL_RADIO_UNKEY</a>, <a class="el" href="frame_8h_source.html#l00299">AST_CONTROL_RING</a>, <a class="el" href="frame_8h_source.html#l00300">AST_CONTROL_RINGING</a>, <a class="el" href="frame_8h_source.html#l00317">AST_CONTROL_SRCUPDATE</a>, <a class="el" href="frame_8h_source.html#l00318">AST_CONTROL_T38_PARAMETERS</a>, <a class="el" href="frame_8h_source.html#l00303">AST_CONTROL_TAKEOFFHOOK</a>, <a class="el" href="frame_8h_source.html#l00314">AST_CONTROL_UNHOLD</a>, <a class="el" href="frame_8h_source.html#l00315">AST_CONTROL_VIDUPDATE</a>, and <a class="el" href="frame_8h_source.html#l00307">AST_CONTROL_WINK</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l03150">ast_indicate_data()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03116"></a>03116 {
<a name="l03117"></a>03117    <span class="comment">/* Don&apos;t include a default case here so that we get compiler warnings</span>
<a name="l03118"></a>03118 <span class="comment">    * when a new type is added. */</span>
<a name="l03119"></a>03119 
<a name="l03120"></a>03120    <span class="keywordflow">switch</span> (condition) {
<a name="l03121"></a>03121    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a1a461c5e737ed6ed7c8cb0f78557a6fd">AST_CONTROL_PROGRESS</a>:
<a name="l03122"></a>03122    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a50b7fe33bba67b74dd7b746539e81000">AST_CONTROL_PROCEEDING</a>:
<a name="l03123"></a>03123    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a417bc8ac5817cc1525a3b530abfc1528">AST_CONTROL_VIDUPDATE</a>:
<a name="l03124"></a>03124    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a009e81151b19671f42b5e84ab6a619f4">AST_CONTROL_SRCUPDATE</a>:
<a name="l03125"></a>03125    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aacb7ddf1a95fa544fdecada68213f3c7">AST_CONTROL_RADIO_KEY</a>:
<a name="l03126"></a>03126    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a34ac3ccebc219c59daa7eb0275fcd54d">AST_CONTROL_RADIO_UNKEY</a>:
<a name="l03127"></a>03127    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ac4106406e269667ff84ee49e0a634f94">AST_CONTROL_OPTION</a>:
<a name="l03128"></a>03128    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a195b2c39c09113953814aa800dd06e7f">AST_CONTROL_WINK</a>:
<a name="l03129"></a>03129    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ae8f2cd460fdc81e0a774434fa002e4bf">AST_CONTROL_FLASH</a>:
<a name="l03130"></a>03130    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a28cd8e9f9005e25624f993d6edd46755">AST_CONTROL_OFFHOOK</a>:
<a name="l03131"></a>03131    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a5a24176e8066b727463907da4903bb8e">AST_CONTROL_TAKEOFFHOOK</a>:
<a name="l03132"></a>03132    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>:
<a name="l03133"></a>03133    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa7dac1c1896ab418c2ff351aae707fba">AST_CONTROL_HANGUP</a>:
<a name="l03134"></a>03134    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>:
<a name="l03135"></a>03135    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390af4cf96fe3cc13c2a1b4d539fcb1adaed">_XXX_AST_CONTROL_T38</a>:
<a name="l03136"></a>03136       <span class="keywordflow">break</span>;
<a name="l03137"></a>03137 
<a name="l03138"></a>03138    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a850bb06a1702741c93a3fd67cc9637ab">AST_CONTROL_CONGESTION</a>:
<a name="l03139"></a>03139    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875">AST_CONTROL_BUSY</a>:
<a name="l03140"></a>03140    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a>:
<a name="l03141"></a>03141    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a00675bfb8c64b2be86297fe4cba51fa2">AST_CONTROL_RING</a>:
<a name="l03142"></a>03142    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ab99a3d1c08c5ae8bca078c7cd1ec02f5">AST_CONTROL_HOLD</a>:
<a name="l03143"></a>03143    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>:
<a name="l03144"></a>03144       <span class="keywordflow">return</span> 1;
<a name="l03145"></a>03145    }
<a name="l03146"></a>03146 
<a name="l03147"></a>03147    <span class="keywordflow">return</span> 0;
<a name="l03148"></a>03148 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab8a085dee0e97a277287d359ce7f4e4d"></a><!-- doxytag: member="channel.c::manager_bridge_event" ref="ab8a085dee0e97a277287d359ce7f4e4d" args="(int onoff, int type, struct ast_channel *c0, struct ast_channel *c1)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void manager_bridge_event </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>onoff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c1</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Send manager event for bridge link and unlink events. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>onoff</em>&nbsp;</td><td>Link/Unlinked </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>type</em>&nbsp;</td><td>1 for core, 2 for native </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>c0</em>&nbsp;</td><td>first channel in bridge </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>c1</em>&nbsp;</td><td>second channel in bridge </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l04972">4972</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00444">ast_channel::cid</a>, <a class="el" href="channel_8h_source.html#l00203">ast_callerid::cid_num</a>, <a class="el" href="manager_8h_source.html#l00062">EVENT_FLAG_CALL</a>, <a class="el" href="manager_8h_source.html#l00181">manager_event</a>, and <a class="el" href="strings_8h_source.html#l00072">S_OR</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l05055">ast_channel_bridge()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04973"></a>04973 {
<a name="l04974"></a>04974    <a class="code" href="manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208" title="External routines may send asterisk manager events this way.">manager_event</a>(<a class="code" href="manager_8h.html#ab5db3cc603d7e798d61cb4cd94fbb4e2">EVENT_FLAG_CALL</a>, <span class="stringliteral">&quot;Bridge&quot;</span>,
<a name="l04975"></a>04975          <span class="stringliteral">&quot;Bridgestate: %s\r\n&quot;</span>
<a name="l04976"></a>04976            <span class="stringliteral">&quot;Bridgetype: %s\r\n&quot;</span>
<a name="l04977"></a>04977             <span class="stringliteral">&quot;Channel1: %s\r\n&quot;</span>
<a name="l04978"></a>04978             <span class="stringliteral">&quot;Channel2: %s\r\n&quot;</span>
<a name="l04979"></a>04979             <span class="stringliteral">&quot;Uniqueid1: %s\r\n&quot;</span>
<a name="l04980"></a>04980             <span class="stringliteral">&quot;Uniqueid2: %s\r\n&quot;</span>
<a name="l04981"></a>04981             <span class="stringliteral">&quot;CallerID1: %s\r\n&quot;</span>
<a name="l04982"></a>04982             <span class="stringliteral">&quot;CallerID2: %s\r\n&quot;</span>,
<a name="l04983"></a>04983          onoff ? <span class="stringliteral">&quot;Link&quot;</span> : <span class="stringliteral">&quot;Unlink&quot;</span>,
<a name="l04984"></a>04984          <a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a> == 1 ? <span class="stringliteral">&quot;core&quot;</span> : <span class="stringliteral">&quot;native&quot;</span>,
<a name="l04985"></a>04985          c0-&gt;name, c1-&gt;name, c0-&gt;uniqueid, c1-&gt;uniqueid, 
<a name="l04986"></a>04986          <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(c0-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>, <span class="stringliteral">&quot;&quot;</span>), 
<a name="l04987"></a>04987          <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(c1-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>, <span class="stringliteral">&quot;&quot;</span>));
<a name="l04988"></a>04988 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4efcbb7271ae141197a4ec6fa0c834c2"></a><!-- doxytag: member="channel.c::queue_dtmf_readq" ref="a4efcbb7271ae141197a4ec6fa0c834c2" args="(struct ast_channel *chan, struct ast_frame *f)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void queue_dtmf_readq </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td>
          <td class="paramname"> <em>f</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l02578">2578</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00099">AST_FRAME_DTMF_END</a>, <a class="el" href="channel_8c_source.html#l01080">ast_queue_frame()</a>, <a class="el" href="channel_8h_source.html#l00445">ast_channel::dtmff</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="frame_8h_source.html#l00169">ast_frame::len</a>, and <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l02636">__ast_read()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02579"></a>02579 {
<a name="l02580"></a>02580    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *fr = &amp;chan-&gt;<a class="code" href="structast__channel.html#a2d07143627b03360ff4de0097553dbcc">dtmff</a>;
<a name="l02581"></a>02581 
<a name="l02582"></a>02582    fr-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a98e65764bc963016c394bcc1bad6540b">AST_FRAME_DTMF_END</a>;
<a name="l02583"></a>02583    fr-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>;
<a name="l02584"></a>02584    fr-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a> = f-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a>;
<a name="l02585"></a>02585 
<a name="l02586"></a>02586    <span class="comment">/* The only time this function will be called is for a frame that just came</span>
<a name="l02587"></a>02587 <span class="comment">    * out of the channel driver.  So, we want to stick it on the tail of the</span>
<a name="l02588"></a>02588 <span class="comment">    * readq. */</span>
<a name="l02589"></a>02589 
<a name="l02590"></a>02590    <a class="code" href="channel_8h.html#a6cbcba5661d55216968cde8fdf913c89" title="Queue one or more frames to a channel&amp;#39;s frame queue.">ast_queue_frame</a>(chan, fr);
<a name="l02591"></a>02591 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a452cff7df535d1f9cbc96fcd67b075ec"></a><!-- doxytag: member="channel.c::report_new_callerid" ref="a452cff7df535d1f9cbc96fcd67b075ec" args="(const struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void report_new_callerid </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="pre"><dt><b>Precondition:</b></dt><dd>chan is locked </dd></dl>

<p>Definition at line <a class="el" href="channel_8c_source.html#l04371">4371</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="callerid_8c_source.html#l01147">ast_describe_caller_presentation()</a>, <a class="el" href="channel_8h_source.html#l00444">ast_channel::cid</a>, <a class="el" href="channel_8h_source.html#l00204">ast_callerid::cid_name</a>, <a class="el" href="channel_8h_source.html#l00203">ast_callerid::cid_num</a>, <a class="el" href="channel_8h_source.html#l00207">ast_callerid::cid_pres</a>, <a class="el" href="manager_8h_source.html#l00062">EVENT_FLAG_CALL</a>, <a class="el" href="manager_8h_source.html#l00181">manager_event</a>, and <a class="el" href="strings_8h_source.html#l00072">S_OR</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l04393">ast_do_masquerade()</a>, and <a class="el" href="channel_8c_source.html#l04670">ast_set_callerid()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04372"></a>04372 {
<a name="l04373"></a>04373    <a class="code" href="manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208" title="External routines may send asterisk manager events this way.">manager_event</a>(<a class="code" href="manager_8h.html#ab5db3cc603d7e798d61cb4cd94fbb4e2">EVENT_FLAG_CALL</a>, <span class="stringliteral">&quot;NewCallerid&quot;</span>,
<a name="l04374"></a>04374             <span class="stringliteral">&quot;Channel: %s\r\n&quot;</span>
<a name="l04375"></a>04375             <span class="stringliteral">&quot;CallerIDNum: %s\r\n&quot;</span>
<a name="l04376"></a>04376             <span class="stringliteral">&quot;CallerIDName: %s\r\n&quot;</span>
<a name="l04377"></a>04377             <span class="stringliteral">&quot;Uniqueid: %s\r\n&quot;</span>
<a name="l04378"></a>04378             <span class="stringliteral">&quot;CID-CallingPres: %d (%s)\r\n&quot;</span>,
<a name="l04379"></a>04379             chan-&gt;name,
<a name="l04380"></a>04380             <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>, <span class="stringliteral">&quot;&quot;</span>),
<a name="l04381"></a>04381             <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a>, <span class="stringliteral">&quot;&quot;</span>),
<a name="l04382"></a>04382             chan-&gt;uniqueid,
<a name="l04383"></a>04383             chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a5674af3fa5ce1dd1fe052be1477d4110">cid_pres</a>,
<a name="l04384"></a>04384             <a class="code" href="callerid_8h.html#a4b8a5c3b5ed37a9e1396ddef68ac7846" title="Convert caller ID pres value to explanatory string.">ast_describe_caller_presentation</a>(chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a5674af3fa5ce1dd1fe052be1477d4110">cid_pres</a>)
<a name="l04385"></a>04385             );
<a name="l04386"></a>04386 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2897ccacbd4c0c894a7e8212da97ee83"></a><!-- doxytag: member="channel.c::send_dtmf_event" ref="a2897ccacbd4c0c894a7e8212da97ee83" args="(const struct ast_channel *chan, const char *direction, const char digit, const char *begin, const char *end)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void send_dtmf_event </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>direction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char&nbsp;</td>
          <td class="paramname"> <em>digit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>begin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>end</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l02517">2517</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="manager_8h_source.html#l00069">EVENT_FLAG_DTMF</a>, and <a class="el" href="manager_8h_source.html#l00181">manager_event</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l02636">__ast_read()</a>, and <a class="el" href="channel_8c_source.html#l03411">ast_write()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02518"></a>02518 {
<a name="l02519"></a>02519    <a class="code" href="manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208" title="External routines may send asterisk manager events this way.">manager_event</a>(<a class="code" href="manager_8h.html#a6307f76e83767cdcd6b618dfbd214526">EVENT_FLAG_DTMF</a>,
<a name="l02520"></a>02520          <span class="stringliteral">&quot;DTMF&quot;</span>,
<a name="l02521"></a>02521          <span class="stringliteral">&quot;Channel: %s\r\n&quot;</span>
<a name="l02522"></a>02522          <span class="stringliteral">&quot;Uniqueid: %s\r\n&quot;</span>
<a name="l02523"></a>02523          <span class="stringliteral">&quot;Digit: %c\r\n&quot;</span>
<a name="l02524"></a>02524          <span class="stringliteral">&quot;Direction: %s\r\n&quot;</span>
<a name="l02525"></a>02525          <span class="stringliteral">&quot;Begin: %s\r\n&quot;</span>
<a name="l02526"></a>02526          <span class="stringliteral">&quot;End: %s\r\n&quot;</span>,
<a name="l02527"></a>02527          chan-&gt;name, chan-&gt;uniqueid, digit, direction, begin, end);
<a name="l02528"></a>02528 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1d7ab456acdea2bed28186e664a56879"></a><!-- doxytag: member="channel.c::set_format" ref="a1d7ab456acdea2bed28186e664a56879" args="(struct ast_channel *chan, int fmt, int *rawformat, int *format, struct ast_trans_pvt **trans, const int direction)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int set_format </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>rawformat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__trans__pvt.html">ast_trans_pvt</a> **&nbsp;</td>
          <td class="paramname"> <em>trans</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>direction</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l03673">3673</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8h_source.html#l00273">AST_FORMAT_AUDIO_MASK</a>, <a class="el" href="frame_8c_source.html#l00573">ast_getformatname()</a>, <a class="el" href="frame_8c_source.html#l00586">ast_getformatname_multiple()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="translate_8c_source.html#l00761">ast_translator_best_choice()</a>, <a class="el" href="translate_8c_source.html#l00263">ast_translator_build_path()</a>, <a class="el" href="translate_8c_source.html#l00253">ast_translator_free_path()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="channel_8h_source.html#l00482">ast_channel::nativeformats</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l03731">ast_set_read_format()</a>, and <a class="el" href="channel_8c_source.html#l03737">ast_set_write_format()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03675"></a>03675 {
<a name="l03676"></a>03676    <span class="keywordtype">int</span> native;
<a name="l03677"></a>03677    <span class="keywordtype">int</span> res;
<a name="l03678"></a>03678    <span class="keywordtype">char</span> from[200], to[200];
<a name="l03679"></a>03679    
<a name="l03680"></a>03680    <span class="comment">/* Make sure we only consider audio */</span>
<a name="l03681"></a>03681    fmt &amp;= <a class="code" href="frame_8h.html#a3f680b9c15596de927d507a664fd2803">AST_FORMAT_AUDIO_MASK</a>;
<a name="l03682"></a>03682    
<a name="l03683"></a>03683    native = chan-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>;
<a name="l03684"></a>03684 
<a name="l03685"></a>03685    <span class="keywordflow">if</span> (!fmt || !native) <span class="comment">/* No audio requested */</span>
<a name="l03686"></a>03686       <span class="keywordflow">return</span> 0;   <span class="comment">/* Let&apos;s try a call without any sounds (video, text) */</span>
<a name="l03687"></a>03687    
<a name="l03688"></a>03688    <span class="comment">/* Find a translation path from the native format to one of the desired formats */</span>
<a name="l03689"></a>03689    <span class="keywordflow">if</span> (!direction)
<a name="l03690"></a>03690       <span class="comment">/* reading */</span>
<a name="l03691"></a>03691       res = <a class="code" href="translate_8h.html#a09ac24ad5b3c1e1cee3d294556458e36" title="Chooses the best translation path.">ast_translator_best_choice</a>(&amp;fmt, &amp;native);
<a name="l03692"></a>03692    <span class="keywordflow">else</span>
<a name="l03693"></a>03693       <span class="comment">/* writing */</span>
<a name="l03694"></a>03694       res = <a class="code" href="translate_8h.html#a09ac24ad5b3c1e1cee3d294556458e36" title="Chooses the best translation path.">ast_translator_best_choice</a>(&amp;native, &amp;fmt);
<a name="l03695"></a>03695 
<a name="l03696"></a>03696    <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l03697"></a>03697       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to find a codec translation path from %s to %s\n&quot;</span>,
<a name="l03698"></a>03698          <a class="code" href="frame_8h.html#a37cdc7e78686b0bfa4e47e645f782b30" title="Get the names of a set of formats.">ast_getformatname_multiple</a>(from, <span class="keyword">sizeof</span>(from), native),
<a name="l03699"></a>03699          <a class="code" href="frame_8h.html#a37cdc7e78686b0bfa4e47e645f782b30" title="Get the names of a set of formats.">ast_getformatname_multiple</a>(to, <span class="keyword">sizeof</span>(to), fmt));
<a name="l03700"></a>03700       <span class="keywordflow">return</span> -1;
<a name="l03701"></a>03701    }
<a name="l03702"></a>03702    
<a name="l03703"></a>03703    <span class="comment">/* Now we have a good choice for both. */</span>
<a name="l03704"></a>03704    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l03705"></a>03705 
<a name="l03706"></a>03706    <span class="keywordflow">if</span> ((*rawformat == native) &amp;&amp; (*<a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a> == fmt) &amp;&amp; ((*rawformat == *<a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>) || (*trans))) {
<a name="l03707"></a>03707       <span class="comment">/* the channel is already in these formats, so nothing to do */</span>
<a name="l03708"></a>03708       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l03709"></a>03709       <span class="keywordflow">return</span> 0;
<a name="l03710"></a>03710    }
<a name="l03711"></a>03711 
<a name="l03712"></a>03712    *rawformat = native;
<a name="l03713"></a>03713    <span class="comment">/* User perspective is fmt */</span>
<a name="l03714"></a>03714    *<a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a> = fmt;
<a name="l03715"></a>03715    <span class="comment">/* Free any read translation we have right now */</span>
<a name="l03716"></a>03716    <span class="keywordflow">if</span> (*trans)
<a name="l03717"></a>03717       <a class="code" href="translate_8h.html#a8f767bf5c2095f182e7cbaa73e391207" title="Frees a translator path Frees the given translator path structure.">ast_translator_free_path</a>(*trans);
<a name="l03718"></a>03718    <span class="comment">/* Build a translation path from the raw format to the desired format */</span>
<a name="l03719"></a>03719    <span class="keywordflow">if</span> (!direction)
<a name="l03720"></a>03720       <span class="comment">/* reading */</span>
<a name="l03721"></a>03721       *trans = <a class="code" href="translate_8h.html#ae53a058fb0d55f3f0b3264813b50232a" title="Builds a translator path Build a path (possibly NULL) from source to dest.">ast_translator_build_path</a>(*<a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>, *rawformat);
<a name="l03722"></a>03722    <span class="keywordflow">else</span>
<a name="l03723"></a>03723       <span class="comment">/* writing */</span>
<a name="l03724"></a>03724       *trans = <a class="code" href="translate_8h.html#ae53a058fb0d55f3f0b3264813b50232a" title="Builds a translator path Build a path (possibly NULL) from source to dest.">ast_translator_build_path</a>(*rawformat, *<a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>);
<a name="l03725"></a>03725    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l03726"></a>03726    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Set channel %s to %s format %s\n&quot;</span>, chan-&gt;name,
<a name="l03727"></a>03727       direction ? <span class="stringliteral">&quot;write&quot;</span> : <span class="stringliteral">&quot;read&quot;</span>, <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(fmt));
<a name="l03728"></a>03728    <span class="keywordflow">return</span> 0;
<a name="l03729"></a>03729 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a673ed25d2c254caadf6b68f1c64c84f5"></a><!-- doxytag: member="channel.c::should_skip_dtmf" ref="a673ed25d2c254caadf6b68f1c64c84f5" args="(struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int should_skip_dtmf </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Determine whether or not we should ignore DTMF in the readq. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l02596">2596</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00523">AST_FLAG_DEFER_DTMF</a>, <a class="el" href="channel_8h_source.html#l00548">AST_FLAG_EMULATE_DTMF</a>, <a class="el" href="channel_8c_source.html#l00100">AST_MIN_DTMF_GAP</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="time_8h_source.html#l00089">ast_tvdiff_ms()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="time_8h_source.html#l00099">ast_tvzero()</a>, and <a class="el" href="channel_8h_source.html#l00452">ast_channel::dtmf_tv</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l02636">__ast_read()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02597"></a>02597 {
<a name="l02598"></a>02598    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329ab05edf1bf82b02f5987de92a6960a9bd">AST_FLAG_DEFER_DTMF</a> | <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a7aeded1dc9df91dee01bb7af719880c1">AST_FLAG_EMULATE_DTMF</a>)) {
<a name="l02599"></a>02599       <span class="comment">/* We&apos;re in the middle of emulating a digit, or DTMF has been</span>
<a name="l02600"></a>02600 <span class="comment">       * explicitly deferred.  Skip this digit, then. */</span>
<a name="l02601"></a>02601       <span class="keywordflow">return</span> 1;
<a name="l02602"></a>02602    }
<a name="l02603"></a>02603          
<a name="l02604"></a>02604    <span class="keywordflow">if</span> (!<a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(chan-&gt;<a class="code" href="structast__channel.html#a7dda84c33a9f34c6a0192c88c263b507">dtmf_tv</a>) &amp;&amp; 
<a name="l02605"></a>02605          <a class="code" href="time_8h.html#a74e35cffcd45ad6cd7c8587921e8a4c2" title="Computes the difference (in milliseconds) between two struct timeval instances.">ast_tvdiff_ms</a>(<a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>(), chan-&gt;<a class="code" href="structast__channel.html#a7dda84c33a9f34c6a0192c88c263b507">dtmf_tv</a>) &lt; <a class="code" href="channel_8c.html#a21882e640e01106e62bdab88849a17c5">AST_MIN_DTMF_GAP</a>) {
<a name="l02606"></a>02606       <span class="comment">/* We&apos;re not in the middle of a digit, but it hasn&apos;t been long enough</span>
<a name="l02607"></a>02607 <span class="comment">       * since the last digit, so we&apos;ll have to skip DTMF for now. */</span>
<a name="l02608"></a>02608       <span class="keywordflow">return</span> 1;
<a name="l02609"></a>02609    }
<a name="l02610"></a>02610 
<a name="l02611"></a>02611    <span class="keywordflow">return</span> 0;
<a name="l02612"></a>02612 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9b25e6d6b996635d7fb5fc6e000e71c9"></a><!-- doxytag: member="channel.c::silence_generator_alloc" ref="a9b25e6d6b996635d7fb5fc6e000e71c9" args="(struct ast_channel *chan, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void* silence_generator_alloc </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l05600">5600</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05601"></a>05601 {
<a name="l05602"></a>05602    <span class="comment">/* just store the data pointer in the channel structure */</span>
<a name="l05603"></a>05603    <span class="keywordflow">return</span> <a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>;
<a name="l05604"></a>05604 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a196556ea463d5aa7e7672d673a2f688f"></a><!-- doxytag: member="channel.c::silence_generator_generate" ref="a196556ea463d5aa7e7672d673a2f688f" args="(struct ast_channel *chan, void *data, int len, int samples)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int silence_generator_generate </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>samples</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l05611">5611</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00253">AST_FORMAT_SLINEAR</a>, <a class="el" href="frame_8h_source.html#l00101">AST_FRAME_VOICE</a>, <a class="el" href="channel_8c_source.html#l03411">ast_write()</a>, and <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05612"></a>05612 {
<a name="l05613"></a>05613    <span class="keywordtype">short</span> <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>];
<a name="l05614"></a>05614    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> frame = {
<a name="l05615"></a>05615       .frametype = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>,
<a name="l05616"></a>05616       .subclass = <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>,
<a name="l05617"></a>05617       .data.ptr = buf,
<a name="l05618"></a>05618       .samples = <a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>,
<a name="l05619"></a>05619       .datalen = <span class="keyword">sizeof</span>(buf),
<a name="l05620"></a>05620    };
<a name="l05621"></a>05621 
<a name="l05622"></a>05622    memset(buf, 0, <span class="keyword">sizeof</span>(buf));
<a name="l05623"></a>05623 
<a name="l05624"></a>05624    <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a79c413d51b7135404d5cacf811649a61" title="Write a frame to a channel This function writes the given frame to the indicated...">ast_write</a>(chan, &amp;frame))
<a name="l05625"></a>05625       <span class="keywordflow">return</span> -1;
<a name="l05626"></a>05626 
<a name="l05627"></a>05627    <span class="keywordflow">return</span> 0;
<a name="l05628"></a>05628 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5b6038c1b5aeb272bcb35c937088984c"></a><!-- doxytag: member="channel.c::silence_generator_release" ref="a5b6038c1b5aeb272bcb35c937088984c" args="(struct ast_channel *chan, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void silence_generator_release </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l05606">5606</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05607"></a>05607 {
<a name="l05608"></a>05608    <span class="comment">/* nothing to do */</span>
<a name="l05609"></a>05609 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6f5a723ce82b8f608b25a36b4df38e46"></a><!-- doxytag: member="channel.c::tonepair_alloc" ref="a6f5a723ce82b8f608b25a36b4df38e46" args="(struct ast_channel *chan, void *params)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void* tonepair_alloc </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>params</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l05367">5367</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="channel_8h_source.html#l00525">AST_FLAG_WRITE_INT</a>, <a class="el" href="frame_8h_source.html#l00253">AST_FORMAT_SLINEAR</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="channel_8c_source.html#l03737">ast_set_write_format()</a>, <a class="el" href="chan__h323_8c_source.html#l00144">cos</a>, <a class="el" href="channel_8c_source.html#l05336">tonepair_def::duration</a>, <a class="el" href="channel_8c_source.html#l05351">tonepair_state::duration</a>, <a class="el" href="channel_8c_source.html#l05341">tonepair_state::fac1</a>, <a class="el" href="channel_8c_source.html#l05342">tonepair_state::fac2</a>, <a class="el" href="channel_8c_source.html#l05334">tonepair_def::freq1</a>, <a class="el" href="channel_8c_source.html#l05335">tonepair_def::freq2</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="channel_8c_source.html#l05352">tonepair_state::modulate</a>, <a class="el" href="channel_8c_source.html#l05349">tonepair_state::origwfmt</a>, <a class="el" href="channel_8c_source.html#l05358">tonepair_release()</a>, <a class="el" href="channel_8c_source.html#l05343">tonepair_state::v1_1</a>, <a class="el" href="channel_8c_source.html#l05344">tonepair_state::v2_1</a>, <a class="el" href="channel_8c_source.html#l05347">tonepair_state::v2_2</a>, <a class="el" href="channel_8c_source.html#l05345">tonepair_state::v3_1</a>, <a class="el" href="channel_8c_source.html#l05348">tonepair_state::v3_2</a>, <a class="el" href="channel_8c_source.html#l05337">tonepair_def::vol</a>, and <a class="el" href="channel_8h_source.html#l00484">ast_channel::writeformat</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05368"></a>05368 {
<a name="l05369"></a>05369    <span class="keyword">struct </span><a class="code" href="structtonepair__state.html">tonepair_state</a> *ts;
<a name="l05370"></a>05370    <span class="keyword">struct </span><a class="code" href="structtonepair__def.html">tonepair_def</a> *td = params;
<a name="l05371"></a>05371 
<a name="l05372"></a>05372    <span class="keywordflow">if</span> (!(ts = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*ts))))
<a name="l05373"></a>05373       <span class="keywordflow">return</span> NULL;
<a name="l05374"></a>05374    ts-&gt;<a class="code" href="structtonepair__state.html#a5ef8e42d1eab1890f7eeb29e4af357eb">origwfmt</a> = chan-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a>;
<a name="l05375"></a>05375    <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a978161a52d98fdaee374d1f6e1359544" title="Sets write format on channel chan Set write format for channel to whichever component...">ast_set_write_format</a>(chan, <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>)) {
<a name="l05376"></a>05376       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to set &apos;%s&apos; to signed linear format (write)\n&quot;</span>, chan-&gt;name);
<a name="l05377"></a>05377       <a class="code" href="channel_8c.html#a509aeb7d4b65232ad296813f674e90dd">tonepair_release</a>(NULL, ts);
<a name="l05378"></a>05378       ts = NULL;
<a name="l05379"></a>05379    } <span class="keywordflow">else</span> {
<a name="l05380"></a>05380       ts-&gt;<a class="code" href="structtonepair__state.html#a78be16714343e05c92280423d7b8c049">fac1</a> = 2.0 * <a class="code" href="chan__h323_8c.html#ae91dad65f553f7afebe4af507803bc7f">cos</a>(2.0 * M_PI * (td-&gt;<a class="code" href="structtonepair__def.html#aef0a8374190702d825cd5be4f7c3d16f">freq1</a> / 8000.0)) * 32768.0;
<a name="l05381"></a>05381       ts-&gt;<a class="code" href="structtonepair__state.html#a0a65e151f23eb826acca0a6bee55edb5">v1_1</a> = 0;
<a name="l05382"></a>05382       ts-&gt;<a class="code" href="structtonepair__state.html#a6a19249508791678eec714f6ba20dcf5">v2_1</a> = sin(-4.0 * M_PI * (td-&gt;<a class="code" href="structtonepair__def.html#aef0a8374190702d825cd5be4f7c3d16f">freq1</a> / 8000.0)) * td-&gt;<a class="code" href="structtonepair__def.html#a0865f919827121ede94c816e460e4857">vol</a>;
<a name="l05383"></a>05383       ts-&gt;<a class="code" href="structtonepair__state.html#accaedd1ffb93951a317101d3c9340769">v3_1</a> = sin(-2.0 * M_PI * (td-&gt;<a class="code" href="structtonepair__def.html#aef0a8374190702d825cd5be4f7c3d16f">freq1</a> / 8000.0)) * td-&gt;<a class="code" href="structtonepair__def.html#a0865f919827121ede94c816e460e4857">vol</a>;
<a name="l05384"></a>05384       ts-&gt;<a class="code" href="structtonepair__state.html#a6a19249508791678eec714f6ba20dcf5">v2_1</a> = 0;
<a name="l05385"></a>05385       ts-&gt;<a class="code" href="structtonepair__state.html#a346af58f2d4bbe53004ec9ef0cdabfa4">fac2</a> = 2.0 * <a class="code" href="chan__h323_8c.html#ae91dad65f553f7afebe4af507803bc7f">cos</a>(2.0 * M_PI * (td-&gt;<a class="code" href="structtonepair__def.html#ae484cbecf50a6913f24356fc00e34d8e">freq2</a> / 8000.0)) * 32768.0;
<a name="l05386"></a>05386       ts-&gt;<a class="code" href="structtonepair__state.html#ab34934db2556aa36bf2a30c33313f911">v2_2</a> = sin(-4.0 * M_PI * (td-&gt;<a class="code" href="structtonepair__def.html#ae484cbecf50a6913f24356fc00e34d8e">freq2</a> / 8000.0)) * td-&gt;<a class="code" href="structtonepair__def.html#a0865f919827121ede94c816e460e4857">vol</a>;
<a name="l05387"></a>05387       ts-&gt;<a class="code" href="structtonepair__state.html#ad4af51433f84565e04fa49a753e08b64">v3_2</a> = sin(-2.0 * M_PI * (td-&gt;<a class="code" href="structtonepair__def.html#ae484cbecf50a6913f24356fc00e34d8e">freq2</a> / 8000.0)) * td-&gt;<a class="code" href="structtonepair__def.html#a0865f919827121ede94c816e460e4857">vol</a>;
<a name="l05388"></a>05388       ts-&gt;<a class="code" href="structtonepair__state.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = td-&gt;<a class="code" href="structtonepair__def.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;
<a name="l05389"></a>05389       ts-&gt;<a class="code" href="structtonepair__state.html#ac1c4127983f79b8c09b4f1610d1c1021">modulate</a> = 0;
<a name="l05390"></a>05390    }
<a name="l05391"></a>05391    <span class="comment">/* Let interrupts interrupt :) */</span>
<a name="l05392"></a>05392    <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a9deec175d13a40a6a5fdb527b13c6878">AST_FLAG_WRITE_INT</a>);
<a name="l05393"></a>05393    <span class="keywordflow">return</span> ts;
<a name="l05394"></a>05394 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2ac659c4031230f671a2c94eb7f6e806"></a><!-- doxytag: member="channel.c::tonepair_generator" ref="a2ac659c4031230f671a2c94eb7f6e806" args="(struct ast_channel *chan, void *data, int len, int samples)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int tonepair_generator </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>samples</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l05396">5396</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00253">AST_FORMAT_SLINEAR</a>, <a class="el" href="frame_8h_source.html#l00101">AST_FRAME_VOICE</a>, <a class="el" href="frame_8h_source.html#l00203">AST_FRIENDLY_OFFSET</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8c_source.html#l03411">ast_write()</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="channel_8c_source.html#l05355">tonepair_state::data</a>, <a class="el" href="frame_8h_source.html#l00147">ast_frame::datalen</a>, <a class="el" href="channel_8c_source.html#l05351">tonepair_state::duration</a>, <a class="el" href="channel_8c_source.html#l05353">tonepair_state::f</a>, <a class="el" href="channel_8c_source.html#l05341">tonepair_state::fac1</a>, <a class="el" href="channel_8c_source.html#l05342">tonepair_state::fac2</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="channel_8c_source.html#l05352">tonepair_state::modulate</a>, <a class="el" href="frame_8h_source.html#l00155">ast_frame::offset</a>, <a class="el" href="channel_8c_source.html#l05350">tonepair_state::pos</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::ptr</a>, <a class="el" href="frame_8h_source.html#l00149">ast_frame::samples</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, <a class="el" href="channel_8c_source.html#l05343">tonepair_state::v1_1</a>, <a class="el" href="channel_8c_source.html#l05346">tonepair_state::v1_2</a>, <a class="el" href="channel_8c_source.html#l05344">tonepair_state::v2_1</a>, <a class="el" href="channel_8c_source.html#l05347">tonepair_state::v2_2</a>, <a class="el" href="channel_8c_source.html#l05345">tonepair_state::v3_1</a>, and <a class="el" href="channel_8c_source.html#l05348">tonepair_state::v3_2</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05397"></a>05397 {
<a name="l05398"></a>05398    <span class="keyword">struct </span><a class="code" href="structtonepair__state.html">tonepair_state</a> *ts = <a class="code" href="structtonepair__state.html#aaaea89b24922f3b6099fd0185acb3142">data</a>;
<a name="l05399"></a>05399    <span class="keywordtype">int</span> x;
<a name="l05400"></a>05400 
<a name="l05401"></a>05401    <span class="comment">/* we need to prepare a frame with 16 * timelen samples as we&apos;re</span>
<a name="l05402"></a>05402 <span class="comment">    * generating SLIN audio</span>
<a name="l05403"></a>05403 <span class="comment">    */</span>
<a name="l05404"></a>05404    <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> = samples * 2;
<a name="l05405"></a>05405 
<a name="l05406"></a>05406    <span class="keywordflow">if</span> (<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> &gt; <span class="keyword">sizeof</span>(ts-&gt;<a class="code" href="structtonepair__state.html#aaaea89b24922f3b6099fd0185acb3142">data</a>) / 2 - 1) {
<a name="l05407"></a>05407       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Can&apos;t generate that much data!\n&quot;</span>);
<a name="l05408"></a>05408       <span class="keywordflow">return</span> -1;
<a name="l05409"></a>05409    }
<a name="l05410"></a>05410    memset(&amp;ts-&gt;<a class="code" href="structtonepair__state.html#a735f764b1095611ace084e7c6c06857d">f</a>, 0, <span class="keyword">sizeof</span>(ts-&gt;<a class="code" href="structtonepair__state.html#a735f764b1095611ace084e7c6c06857d">f</a>));
<a name="l05411"></a>05411    <span class="keywordflow">for</span> (x=0;x&lt;<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>/2;x++) {
<a name="l05412"></a>05412       ts-&gt;<a class="code" href="structtonepair__state.html#a0a65e151f23eb826acca0a6bee55edb5">v1_1</a> = ts-&gt;<a class="code" href="structtonepair__state.html#a6a19249508791678eec714f6ba20dcf5">v2_1</a>;
<a name="l05413"></a>05413       ts-&gt;<a class="code" href="structtonepair__state.html#a6a19249508791678eec714f6ba20dcf5">v2_1</a> = ts-&gt;<a class="code" href="structtonepair__state.html#accaedd1ffb93951a317101d3c9340769">v3_1</a>;
<a name="l05414"></a>05414       ts-&gt;<a class="code" href="structtonepair__state.html#accaedd1ffb93951a317101d3c9340769">v3_1</a> = (ts-&gt;<a class="code" href="structtonepair__state.html#a78be16714343e05c92280423d7b8c049">fac1</a> * ts-&gt;<a class="code" href="structtonepair__state.html#a6a19249508791678eec714f6ba20dcf5">v2_1</a> &gt;&gt; 15) - ts-&gt;<a class="code" href="structtonepair__state.html#a0a65e151f23eb826acca0a6bee55edb5">v1_1</a>;
<a name="l05415"></a>05415       
<a name="l05416"></a>05416       ts-&gt;<a class="code" href="structtonepair__state.html#a6bce5bf91aef7c67ff71a69f437f25c3">v1_2</a> = ts-&gt;<a class="code" href="structtonepair__state.html#ab34934db2556aa36bf2a30c33313f911">v2_2</a>;
<a name="l05417"></a>05417       ts-&gt;<a class="code" href="structtonepair__state.html#ab34934db2556aa36bf2a30c33313f911">v2_2</a> = ts-&gt;<a class="code" href="structtonepair__state.html#ad4af51433f84565e04fa49a753e08b64">v3_2</a>;
<a name="l05418"></a>05418       ts-&gt;<a class="code" href="structtonepair__state.html#ad4af51433f84565e04fa49a753e08b64">v3_2</a> = (ts-&gt;<a class="code" href="structtonepair__state.html#a346af58f2d4bbe53004ec9ef0cdabfa4">fac2</a> * ts-&gt;<a class="code" href="structtonepair__state.html#ab34934db2556aa36bf2a30c33313f911">v2_2</a> &gt;&gt; 15) - ts-&gt;<a class="code" href="structtonepair__state.html#a6bce5bf91aef7c67ff71a69f437f25c3">v1_2</a>;
<a name="l05419"></a>05419       <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtonepair__state.html#ac1c4127983f79b8c09b4f1610d1c1021">modulate</a>) {
<a name="l05420"></a>05420          <span class="keywordtype">int</span> p;
<a name="l05421"></a>05421          p = ts-&gt;<a class="code" href="structtonepair__state.html#ad4af51433f84565e04fa49a753e08b64">v3_2</a> - 32768;
<a name="l05422"></a>05422          <span class="keywordflow">if</span> (p &lt; 0) p = -p;
<a name="l05423"></a>05423          p = ((p * 9) / 10) + 1;
<a name="l05424"></a>05424          ts-&gt;<a class="code" href="structtonepair__state.html#aaaea89b24922f3b6099fd0185acb3142">data</a>[x] = (ts-&gt;<a class="code" href="structtonepair__state.html#accaedd1ffb93951a317101d3c9340769">v3_1</a> * p) &gt;&gt; 15;
<a name="l05425"></a>05425       } <span class="keywordflow">else</span>
<a name="l05426"></a>05426          ts-&gt;<a class="code" href="structtonepair__state.html#aaaea89b24922f3b6099fd0185acb3142">data</a>[x] = ts-&gt;<a class="code" href="structtonepair__state.html#accaedd1ffb93951a317101d3c9340769">v3_1</a> + ts-&gt;<a class="code" href="structtonepair__state.html#ad4af51433f84565e04fa49a753e08b64">v3_2</a>; 
<a name="l05427"></a>05427    }
<a name="l05428"></a>05428    ts-&gt;<a class="code" href="structtonepair__state.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>;
<a name="l05429"></a>05429    ts-&gt;<a class="code" href="structtonepair__state.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>;
<a name="l05430"></a>05430    ts-&gt;<a class="code" href="structtonepair__state.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> = <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;
<a name="l05431"></a>05431    ts-&gt;<a class="code" href="structtonepair__state.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> = samples;
<a name="l05432"></a>05432    ts-&gt;<a class="code" href="structtonepair__state.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#aed7ea92f45bd273dde380a45ddced592">offset</a> = <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>;
<a name="l05433"></a>05433    ts-&gt;<a class="code" href="structtonepair__state.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> = ts-&gt;<a class="code" href="structtonepair__state.html#aaaea89b24922f3b6099fd0185acb3142">data</a>;
<a name="l05434"></a>05434    <a class="code" href="channel_8h.html#a79c413d51b7135404d5cacf811649a61" title="Write a frame to a channel This function writes the given frame to the indicated...">ast_write</a>(chan, &amp;ts-&gt;<a class="code" href="structtonepair__state.html#a735f764b1095611ace084e7c6c06857d">f</a>);
<a name="l05435"></a>05435    ts-&gt;<a class="code" href="structtonepair__state.html#a1910d262855b71da353ed0d07a6c7823">pos</a> += x;
<a name="l05436"></a>05436    <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtonepair__state.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; 0) {
<a name="l05437"></a>05437       <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtonepair__state.html#a1910d262855b71da353ed0d07a6c7823">pos</a> &gt;= ts-&gt;<a class="code" href="structtonepair__state.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> * 8)
<a name="l05438"></a>05438          <span class="keywordflow">return</span> -1;
<a name="l05439"></a>05439    }
<a name="l05440"></a>05440    <span class="keywordflow">return</span> 0;
<a name="l05441"></a>05441 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a509aeb7d4b65232ad296813f674e90dd"></a><!-- doxytag: member="channel.c::tonepair_release" ref="a509aeb7d4b65232ad296813f674e90dd" args="(struct ast_channel *chan, void *params)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void tonepair_release </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>params</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l05358">5358</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="channel_8c_source.html#l03737">ast_set_write_format()</a>, and <a class="el" href="channel_8c_source.html#l05349">tonepair_state::origwfmt</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l05367">tonepair_alloc()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05359"></a>05359 {
<a name="l05360"></a>05360    <span class="keyword">struct </span><a class="code" href="structtonepair__state.html">tonepair_state</a> *ts = params;
<a name="l05361"></a>05361 
<a name="l05362"></a>05362    <span class="keywordflow">if</span> (chan)
<a name="l05363"></a>05363       <a class="code" href="channel_8h.html#a978161a52d98fdaee374d1f6e1359544" title="Sets write format on channel chan Set write format for channel to whichever component...">ast_set_write_format</a>(chan, ts-&gt;<a class="code" href="structtonepair__state.html#a5ef8e42d1eab1890f7eeb29e4af357eb">origwfmt</a>);
<a name="l05364"></a>05364    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(ts);
<a name="l05365"></a>05365 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6f45f5d6e87e9a0b9fc31b1f1109f741"></a><!-- doxytag: member="channel.c::update_bridge_vars" ref="a6f45f5d6e87e9a0b9fc31b1f1109f741" args="(struct ast_channel *c0, struct ast_channel *c1)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void update_bridge_vars </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c1</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l04990">4990</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="structast__channel__tech.html#a149e0d499a1d6244ad78e08cf6786ee0">ast_channel_tech::get_pvt_uniqueid</a>, <a class="el" href="pbx_8c_source.html#l08951">pbx_builtin_getvar_helper()</a>, <a class="el" href="pbx_8c_source.html#l09023">pbx_builtin_setvar_helper()</a>, and <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l05055">ast_channel_bridge()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04991"></a>04991 {
<a name="l04992"></a>04992    <span class="keyword">const</span> <span class="keywordtype">char</span> *c0_name;
<a name="l04993"></a>04993    <span class="keyword">const</span> <span class="keywordtype">char</span> *c1_name;
<a name="l04994"></a>04994    <span class="keyword">const</span> <span class="keywordtype">char</span> *c0_pvtid = NULL;
<a name="l04995"></a>04995    <span class="keyword">const</span> <span class="keywordtype">char</span> *c1_pvtid = NULL;
<a name="l04996"></a>04996 
<a name="l04997"></a>04997    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(c1);
<a name="l04998"></a>04998    c1_name = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(c1-&gt;name);
<a name="l04999"></a>04999    <span class="keywordflow">if</span> (c1-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a149e0d499a1d6244ad78e08cf6786ee0" title="Get the unique identifier for the PVT, i.e. SIP call-ID for SIP.">get_pvt_uniqueid</a>) {
<a name="l05000"></a>05000       c1_pvtid = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(c1-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a149e0d499a1d6244ad78e08cf6786ee0" title="Get the unique identifier for the PVT, i.e. SIP call-ID for SIP.">get_pvt_uniqueid</a>(c1));
<a name="l05001"></a>05001    }
<a name="l05002"></a>05002    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l05003"></a>05003 
<a name="l05004"></a>05004    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(c0);
<a name="l05005"></a>05005    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(c0, <span class="stringliteral">&quot;BRIDGEPEER&quot;</span>))) {
<a name="l05006"></a>05006       <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(c0, <span class="stringliteral">&quot;BRIDGEPEER&quot;</span>, c1_name);
<a name="l05007"></a>05007    }
<a name="l05008"></a>05008    <span class="keywordflow">if</span> (c1_pvtid) {
<a name="l05009"></a>05009       <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(c0, <span class="stringliteral">&quot;BRIDGEPVTCALLID&quot;</span>, c1_pvtid);
<a name="l05010"></a>05010    }
<a name="l05011"></a>05011    c0_name = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(c0-&gt;name);
<a name="l05012"></a>05012    <span class="keywordflow">if</span> (c0-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a149e0d499a1d6244ad78e08cf6786ee0" title="Get the unique identifier for the PVT, i.e. SIP call-ID for SIP.">get_pvt_uniqueid</a>) {
<a name="l05013"></a>05013       c0_pvtid = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(c0-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a149e0d499a1d6244ad78e08cf6786ee0" title="Get the unique identifier for the PVT, i.e. SIP call-ID for SIP.">get_pvt_uniqueid</a>(c0));
<a name="l05014"></a>05014    }
<a name="l05015"></a>05015    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l05016"></a>05016 
<a name="l05017"></a>05017    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(c1);
<a name="l05018"></a>05018    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(c1, <span class="stringliteral">&quot;BRIDGEPEER&quot;</span>))) {
<a name="l05019"></a>05019       <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(c1, <span class="stringliteral">&quot;BRIDGEPEER&quot;</span>, c0_name);
<a name="l05020"></a>05020    }
<a name="l05021"></a>05021    <span class="keywordflow">if</span> (c0_pvtid) {
<a name="l05022"></a>05022       <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(c1, <span class="stringliteral">&quot;BRIDGEPVTCALLID&quot;</span>, c0_pvtid);
<a name="l05023"></a>05023    }
<a name="l05024"></a>05024    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l05025"></a>05025 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a83c5734824bc16e2228e1cb9ec40d0fb"></a><!-- doxytag: member="channel.c::ast_moh_cleanup_ptr" ref="a83c5734824bc16e2228e1cb9ec40d0fb" args=")(struct ast_channel *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void(* <a class="el" href="channel_8c.html#a83c5734824bc16e2228e1cb9ec40d0fb">ast_moh_cleanup_ptr</a>)(struct <a class="el" href="structast__channel.html">ast_channel</a> *) = NULL<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="channel_8c_source.html#l05521">ast_install_music_functions()</a>, <a class="el" href="channel_8c_source.html#l05555">ast_moh_cleanup()</a>, and <a class="el" href="channel_8c_source.html#l05530">ast_uninstall_music_functions()</a>.</p>

</div>
</div>
<a class="anchor" id="ab61499493f5ff948a579c4c4515ef594"></a><!-- doxytag: member="channel.c::ast_moh_start_ptr" ref="ab61499493f5ff948a579c4c4515ef594" args=")(struct ast_channel *, const char *, const char *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int(* <a class="el" href="channel_8c.html#ab61499493f5ff948a579c4c4515ef594">ast_moh_start_ptr</a>)(struct <a class="el" href="structast__channel.html">ast_channel</a> *, const char *, const char *) = NULL<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="channel_8c_source.html#l05521">ast_install_music_functions()</a>, <a class="el" href="channel_8c_source.html#l05538">ast_moh_start()</a>, and <a class="el" href="channel_8c_source.html#l05530">ast_uninstall_music_functions()</a>.</p>

</div>
</div>
<a class="anchor" id="a0b1ab6a1da92f08402ac4df80b8d9512"></a><!-- doxytag: member="channel.c::ast_moh_stop_ptr" ref="a0b1ab6a1da92f08402ac4df80b8d9512" args=")(struct ast_channel *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void(* <a class="el" href="channel_8c.html#a0b1ab6a1da92f08402ac4df80b8d9512">ast_moh_stop_ptr</a>)(struct <a class="el" href="structast__channel.html">ast_channel</a> *) = NULL<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="channel_8c_source.html#l05521">ast_install_music_functions()</a>, <a class="el" href="channel_8c_source.html#l05549">ast_moh_stop()</a>, and <a class="el" href="channel_8c_source.html#l05530">ast_uninstall_music_functions()</a>.</p>

</div>
</div>
<a class="anchor" id="aa4d0ccb9d0904892652f2f258c5ad225"></a><!-- doxytag: member="channel.c::cause" ref="aa4d0ccb9d0904892652f2f258c5ad225" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l00136">136</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l02636">__ast_read()</a>, <a class="el" href="channel_8c_source.html#l03851">__ast_request_and_dial()</a>, <a class="el" href="channel_8c_source.html#l03779">ast_call_forward()</a>, <a class="el" href="channel_8c_source.html#l00642">ast_str2cause()</a>, <a class="el" href="chan__misdn_8c_source.html#l04379">cb_events()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="bridge__builtin__features_8c_source.html#l00068">dial_transfer()</a>, <a class="el" href="app__dial_8c_source.html#l00712">do_forward()</a>, <a class="el" href="dundi-parser_8c_source.html#l00156">dump_cause()</a>, <a class="el" href="features_8c_source.html#l02152">feature_request_and_dial()</a>, <a class="el" href="chan__h323_8c_source.html#l00681">oh323_hangup()</a>, <a class="el" href="app__osplookup_8c_source.html#l01657">ospfinished_exec()</a>, <a class="el" href="app__osplookup_8c_source.html#l01503">ospnext_exec()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00779">parse_disconnect()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00861">parse_release()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00900">parse_release_complete()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l01104">parse_status()</a>, <a class="el" href="pbx_8c_source.html#l08594">pbx_builtin_hangup()</a>, <a class="el" href="app__confbridge_8c_source.html#l00554">play_sound_file()</a>, <a class="el" href="app__sms_8c_source.html#l01488">sms_messagerx()</a>, and <a class="el" href="app__sms_8c_source.html#l01329">sms_messagerx2()</a>.</p>

</div>
</div>
<a class="anchor" id="a9bef477e7c7644e0cdaf5c9f0e115204"></a><!-- doxytag: member="channel.c::causes" ref="a9bef477e7c7644e0cdaf5c9f0e115204" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct { ... }   <a class="el" href="channel_8c.html#a9bef477e7c7644e0cdaf5c9f0e115204">causes</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>map AST_CAUSE's to readable string representations </p>
<p><a class="el" href="causes_8h.html">causes.h</a> </p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l00629">ast_cause2str()</a>, <a class="el" href="channel_8c_source.html#l00642">ast_str2cause()</a>, and <a class="el" href="dundi-parser_8c_source.html#l00156">dump_cause()</a>.</p>

</div>
</div>
<a class="anchor" id="ad74ec6057ffa0240c8dde77284958fbe"></a><!-- doxytag: member="channel.c::cli_channel" ref="ad74ec6057ffa0240c8dde77284958fbe" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> <a class="el" href="channel_8c.html#ad74ec6057ffa0240c8dde77284958fbe">cli_channel</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
   <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="channel_8c.html#ada1321e35ae7c038a2018396a99abbed" title="Show channel types - CLI command.">handle_cli_core_show_channeltypes</a>, <span class="stringliteral">&quot;List available channel types&quot;</span>),
   <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="channel_8c.html#a756671fc7041ac4e1bd415d4348aeae3" title="Show details about a channel driver - CLI command.">handle_cli_core_show_channeltype</a>,  <span class="stringliteral">&quot;Give more details on that channel type&quot;</span>)
}
</pre></div>
<p>Definition at line <a class="el" href="channel_8c_source.html#l00329">329</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l05561">ast_channels_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a710bce51374aba96ab04912897666c35"></a><!-- doxytag: member="channel.c::desc" ref="a710bce51374aba96ab04912897666c35" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="channel_8c.html#a710bce51374aba96ab04912897666c35">desc</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l00138">138</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l03244">acf_retrieve_docs()</a>, <a class="el" href="tcptls_8c_source.html#l00339">ast_tcptls_client_start()</a>, <a class="el" href="tcptls_8c_source.html#l00233">ast_tcptls_server_root()</a>, <a class="el" href="dundi-parser_8c_source.html#l00156">dump_cause()</a>, <a class="el" href="res__limit_8c_source.html#l00101">handle_cli_ulimit()</a>, <a class="el" href="func__odbc_8c_source.html#l00745">init_acf_query()</a>, <a class="el" href="app__rpt_8c_source.html#l02224">load_rpt_vars()</a>, <a class="el" href="misdn__config_8c_source.html#l00618">misdn_cfg_get_desc()</a>, <a class="el" href="chan__misdn_8c_source.html#l01175">show_config_description()</a>, and <a class="el" href="res__limit_8c_source.html#l00075">str2desc()</a>.</p>

</div>
</div>
<a class="anchor" id="a7457a2311fc74cc4a5b0aa0d2001835c"></a><!-- doxytag: member="channel.c::global_fin" ref="a7457a2311fc74cc4a5b0aa0d2001835c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long <a class="el" href="channel_8c.html#a7457a2311fc74cc4a5b0aa0d2001835c">global_fin</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The current value of the debug flags is stored in the two variables global_fin and global_fout (declared in <a class="el" href="channel_8c.html" title="Channel Management.">main/channel.c</a>) </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l00086">86</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l01187">handle_core_set_debug_channel()</a>.</p>

</div>
</div>
<a class="anchor" id="ade9bc8493de7d579e2f06b55379fc673"></a><!-- doxytag: member="channel.c::global_fout" ref="ade9bc8493de7d579e2f06b55379fc673" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long <a class="el" href="channel_8c.html#ade9bc8493de7d579e2f06b55379fc673">global_fout</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l00086">86</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l01187">handle_core_set_debug_channel()</a>.</p>

</div>
</div>
<a class="anchor" id="a8f8f80d37794cde9472343e4487ba3eb"></a><!-- doxytag: member="channel.c::name" ref="a8f8f80d37794cde9472343e4487ba3eb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l00137">137</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

</div>
</div>
<a class="anchor" id="acee4675035da188a1356fc547ff531fa"></a><!-- doxytag: member="channel.c::null_tech" ref="acee4675035da188a1356fc547ff531fa" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__channel__tech.html">ast_channel_tech</a> <a class="el" href="channel_8c.html#acee4675035da188a1356fc547ff531fa">null_tech</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
   .type = <span class="stringliteral">&quot;NULL&quot;</span>,
   .description = <span class="stringliteral">&quot;Null channel (should not see this)&quot;</span>,
}
</pre></div>
<p>Definition at line <a class="el" href="channel_8c_source.html#l00765">765</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l00772">__ast_channel_alloc_ap()</a>.</p>

</div>
</div>
<a class="anchor" id="a7f68568851b9c7f9291f7bb63f932c18"></a><!-- doxytag: member="channel.c::shutting_down" ref="a7f68568851b9c7f9291f7bb63f932c18" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="channel_8c.html#a7f68568851b9c7f9291f7bb63f932c18">shutting_down</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Prevent new channel allocation if shutting down. </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l00082">82</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac4fb3b333021e26b0305fe4949f5f254"></a><!-- doxytag: member="channel.c::silence_generator" ref="ac4fb3b333021e26b0305fe4949f5f254" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__generator.html">ast_generator</a> <a class="el" href="channel_8c.html#ac4fb3b333021e26b0305fe4949f5f254">silence_generator</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
   .alloc = <a class="code" href="channel_8c.html#a9b25e6d6b996635d7fb5fc6e000e71c9">silence_generator_alloc</a>,
   .release = <a class="code" href="channel_8c.html#a5b6038c1b5aeb272bcb35c937088984c">silence_generator_release</a>,
   .generate = <a class="code" href="channel_8c.html#a196556ea463d5aa7e7672d673a2f688f">silence_generator_generate</a>,
}
</pre></div>
<p>Definition at line <a class="el" href="channel_8c_source.html#l05630">5630</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae578b94d61d4c2aed2c960c8ac288f2b"></a><!-- doxytag: member="channel.c::state2str_threadbuf" ref="ae578b94d61d4c2aed2c960c8ac288f2b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__threadstorage.html">ast_threadstorage</a> <a class="el" href="channel_8c.html#ae578b94d61d4c2aed2c960c8ac288f2b">state2str_threadbuf</a> = { .once = PTHREAD_ONCE_INIT , .key_init = __init_state2str_threadbuf , .custom_init = NULL , }<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l00088">88</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l00656">ast_state2str()</a>.</p>

</div>
</div>
<a class="anchor" id="a982bf142a56c626e34f9d4c3f1a16d15"></a><!-- doxytag: member="channel.c::tonepair" ref="a982bf142a56c626e34f9d4c3f1a16d15" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__generator.html">ast_generator</a> <a class="el" href="channel_8c.html#a982bf142a56c626e34f9d4c3f1a16d15">tonepair</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
   alloc: <a class="code" href="channel_8c.html#a6f5a723ce82b8f608b25a36b4df38e46">tonepair_alloc</a>,
   release: <a class="code" href="channel_8c.html#a509aeb7d4b65232ad296813f674e90dd">tonepair_release</a>,
   generate: <a class="code" href="channel_8c.html#a2ac659c4031230f671a2c94eb7f6e806">tonepair_generator</a>,
}
</pre></div>
<p>Definition at line <a class="el" href="channel_8c_source.html#l05443">5443</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l05449">ast_tonepair_start()</a>.</p>

</div>
</div>
<a class="anchor" id="a55bca233afc9e4509a8a96f5195753c2"></a><!-- doxytag: member="channel.c::uniqueint" ref="a55bca233afc9e4509a8a96f5195753c2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="channel_8c.html#a55bca233afc9e4509a8a96f5195753c2">uniqueint</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="channel_8c_source.html#l00084">84</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:21:50 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
