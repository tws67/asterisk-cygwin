<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:19:57 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_0ca6ff3bf6b340411b2c6edd15b1a34d.html">channels</a>
  </div>
</div>
<div class="contents">
<h1>chan_h323.c File Reference</h1>
<p>This file is part of the chan_h323 driver for Asterisk.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="asterisk_8h_source.html">asterisk.h</a>&quot;</code><br/>
<code>#include &lt;sys/types.h&gt;</code><br/>
<code>#include &lt;sys/socket.h&gt;</code><br/>
<code>#include &lt;sys/signal.h&gt;</code><br/>
<code>#include &lt;sys/param.h&gt;</code><br/>
<code>#include &lt;arpa/inet.h&gt;</code><br/>
<code>#include &lt;net/if.h&gt;</code><br/>
<code>#include &lt;netinet/in.h&gt;</code><br/>
<code>#include &lt;netinet/in_systm.h&gt;</code><br/>
<code>#include &lt;netinet/ip.h&gt;</code><br/>
<code>#include &lt;netdb.h&gt;</code><br/>
<code>#include &lt;fcntl.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="lock_8h_source.html">asterisk/lock.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="channel_8h_source.html">asterisk/channel.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="config_8h_source.html">asterisk/config.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="module_8h_source.html">asterisk/module.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="musiconhold_8h_source.html">asterisk/musiconhold.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="pbx_8h_source.html">asterisk/pbx.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="utils_8h_source.html">asterisk/utils.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="sched_8h_source.html">asterisk/sched.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="io_8h_source.html">asterisk/io.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="rtp_8h_source.html">asterisk/rtp.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="acl_8h_source.html">asterisk/acl.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="callerid_8h_source.html">asterisk/callerid.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="cli_8h_source.html">asterisk/cli.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="dsp_8h_source.html">asterisk/dsp.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="causes_8h_source.html">asterisk/causes.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="stringfields_8h_source.html">asterisk/stringfields.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="abstract__jb_8h_source.html">asterisk/abstract_jb.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="astobj_8h_source.html">asterisk/astobj.h</a>&quot;</code><br/>
<code>#include &quot;h323/chan_h323.h&quot;</code><br/>

<p><a href="chan__h323_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structh323__alias__list.html">h323_alias_list</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">H323 alias list.  <a href="structh323__alias__list.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structh323__peer__list.html">h323_peer_list</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">H323 peer list.  <a href="structh323__peer__list.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structh323__user__list.html">h323_user_list</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">H323 User list.  <a href="structh323__user__list.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structoh323__pvt.html">oh323_pvt</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Private structure of a OpenH323 channel.  <a href="structoh323__pvt.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a2675432ddd8161cbe434c098fb535aa3">GLOBAL_CAPABILITY</a>&nbsp;&nbsp;&nbsp;(AST_FORMAT_G723_1 | AST_FORMAT_GSM | AST_FORMAT_ULAW | AST_FORMAT_ALAW | AST_FORMAT_G729A | AST_FORMAT_G726_AAL2 | AST_FORMAT_H261)</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#abe8a9c722d92f457598ab1be93e780ea">__oh323_destroy</a> (struct <a class="el" href="structoh323__pvt.html">oh323_pvt</a> *pvt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#ab9a955a886712c23ff59fb68d2a59f9a">__oh323_new</a> (struct <a class="el" href="structoh323__pvt.html">oh323_pvt</a> *pvt, int <a class="el" href="structstate.html">state</a>, const char *host)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Private structure should be locked on a call.  <a href="#ab9a955a886712c23ff59fb68d2a59f9a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a954ed862fccabf74f1b9ea728c97fb3b">__oh323_rtp_create</a> (struct <a class="el" href="structoh323__pvt.html">oh323_pvt</a> *pvt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#ac83c5df72d69f2472b7bd1fd36b634cb">__oh323_update_info</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, struct <a class="el" href="structoh323__pvt.html">oh323_pvt</a> *pvt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Channel and private structures should be already locked.  <a href="#ac83c5df72d69f2472b7bd1fd36b634cb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a09e087de558c65717f6db4e73198c443">answer_call</a> (unsigned call_reference, const char *token)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Call-back function to start PBX when OpenH323 ready to serve incoming call.  <a href="#a09e087de558c65717f6db4e73198c443"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a19bc21e9b8625e16582554b2dfb9e6c4">AST_MODULE_INFO</a> (ASTERISK_GPL_KEY, AST_MODFLAG_DEFAULT,&quot;The NuFone Network's OpenH323 Channel Driver&quot;,.load=load_module,.unload=unload_module,.reload=reload,)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a39aacd48203e50527e7cca8767c92da8">AST_MUTEX_DEFINE_STATIC</a> (h323_reload_lock)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Protect the reload process.  <a href="#a39aacd48203e50527e7cca8767c92da8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a054d3e99cff3274423888d494bcac929">AST_MUTEX_DEFINE_STATIC</a> (caplock)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Protect the H.323 capabilities list, to avoid more than one channel to set the capabilities simultaneaously in the h323 stack.  <a href="#a054d3e99cff3274423888d494bcac929"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a381db14ebde360ab4092e0c7ab18579d">AST_MUTEX_DEFINE_STATIC</a> (monlock)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Protect the H.323 monitoring thread, so only one process can kill or start it, and not when it's doing something critical.  <a href="#a381db14ebde360ab4092e0c7ab18579d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a8a540d6c5362c0966c0c929270f046b7">AST_MUTEX_DEFINE_STATIC</a> (iflock)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct oh323_alias *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a7c5637b8e64dc84dacbd47037572f99e">build_alias</a> (const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, struct <a class="el" href="structast__variable.html">ast_variable</a> *v, struct <a class="el" href="structast__variable.html">ast_variable</a> *alt, int realtime)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct oh323_peer *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a53c07cbdf5928cad397e68d05d64c0cf">build_peer</a> (const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, struct <a class="el" href="structast__variable.html">ast_variable</a> *v, struct <a class="el" href="structast__variable.html">ast_variable</a> *alt, int realtime)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct oh323_user *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#af5ea8aafcd4cedda80e628ca32386fe8">build_user</a> (const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, struct <a class="el" href="structast__variable.html">ast_variable</a> *v, struct <a class="el" href="structast__variable.html">ast_variable</a> *alt, int realtime)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#abe8912b97493d1dc19b84f3c3e80984a">chan_ringing</a> (unsigned call_reference, const char *token)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Call-back function to signal asterisk that the channel is ringing Returns nothing.  <a href="#abe8912b97493d1dc19b84f3c3e80984a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a9c8ed7310ecb320faec26082515f4cbc">cleanup_call_details</a> (call_details_t *cd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a672902ed001137f6a99cfeece800ce9f">cleanup_connection</a> (unsigned call_reference, const char *call_token)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Call-back function to cleanup communication Returns nothing,.  <a href="#a672902ed001137f6a99cfeece800ce9f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a8e5a95844ec0171f79294dad29ed7b28">connection_made</a> (unsigned call_reference, const char *token)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Call-back function to signal asterisk that the channel has been answered Returns nothing.  <a href="#a8e5a95844ec0171f79294dad29ed7b28"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#ab7daa2cddc7e391558f8074656aa2b6f">convertcap</a> (int cap)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#aff6ea052d0552e2899a61b2eaad9ca7e">create_addr</a> (struct <a class="el" href="structoh323__pvt.html">oh323_pvt</a> *pvt, char *opeer)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#aa77a93372791bbbc3a75fc5f18b92b0d">delete_aliases</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#ace322a3e8008af8b872b72770e97fa85">delete_users</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a02d8db6086b4a18353b82ebcad631ff6">do_monitor</a> (void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct rtp_info *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a0943ee4bea659b2877d483853b272c1a">external_rtp_create</a> (unsigned call_reference, const char *token)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Callback function used to inform the H.323 stack of the local rtp ip/port details.  <a href="#a0943ee4bea659b2877d483853b272c1a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct oh323_alias *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#ac2318e0c047a6ba567df7701f64f917b">find_alias</a> (const char *source_aliases, int realtime)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find a call by alias.  <a href="#ac2318e0c047a6ba567df7701f64f917b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structoh323__pvt.html">oh323_pvt</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a246fb1df8539e4f168a9bc8233ef76b9">find_call_locked</a> (int call_reference, const char *token)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct oh323_peer *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a26ef35cbfee0292c459f1b67d2bd718f">find_peer</a> (const char *peer, struct sockaddr_in *sin, int realtime)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct oh323_user *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#aa3f365bda05996becf0e9c32e94507ea">find_user</a> (const call_details_t *cd, int realtime)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a2b14b06b75b8bbff574be9ab7bfc5957">h323_do_reload</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#aeaa9d343c54df03af296eccb32cf700c">h323_reload</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a5707938bbeb768615abbead1a2b63e35">handle_cli_h323_cycle_gk</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a749a0666cf60b8805d0cb58751cfaf7a">handle_cli_h323_hangup</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a618287b0a5b4c030d38bf0145c602b54">handle_cli_h323_reload</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a9517295cc023bb8e9469a3beffb1b0f6">handle_cli_h323_set_debug</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#ac5eb80b9aa4fa51ca5770ad1e42b4cfe">handle_cli_h323_set_trace</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#ad01b37e8fb4a77e63000883ffff1a6db">handle_cli_h323_show_tokens</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a659cbd49ef7f17b79f0b1cd5107f0782">handle_cli_h323_show_version</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a7cfd1891983f596cb42929aa363a3f6d">hangup_connection</a> (unsigned int call_reference, const char *token, int <a class="el" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="module_8h.html#adc09474f0ff557e9925b722ee5b952df">ast_module_load_result</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a8f637f6e4d4a880f6556eb05dcd6c8a0">load_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#ab0f013613fb4dcee67919a81a1c725ae">oh323_addrcmp</a> (struct sockaddr_in addr, struct sockaddr_in *sin)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a95ea09e6112cba4a7a878e9d87bf97e1">oh323_addrcmp_str</a> (struct in_addr inaddr, char *addr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structoh323__pvt.html">oh323_pvt</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#acec1d7f963be298bd166ec8f869e3462">oh323_alloc</a> (int callid)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#abb92904171d18ca0a9ee3420043d9d91">oh323_answer</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a7543d0418de5932902c645270071f063">oh323_call</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, char *dest, int timeout)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Make a call over the specified channel to the specified destination. Returns -1 on error, 0 on success.  <a href="#a7543d0418de5932902c645270071f063"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#ae0faaef42fdc4a529c953c2a48a902c5">oh323_destroy</a> (struct <a class="el" href="structoh323__pvt.html">oh323_pvt</a> *pvt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a9ebae4396be42baf2785e593f5fede69">oh323_destroy_alias</a> (struct oh323_alias *alias)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#ad2fe7bc6fcd60293a92f883ff5d03fc0">oh323_destroy_peer</a> (struct oh323_peer *peer)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#ad2a4b95f164d86a67d96a23c8714157b">oh323_destroy_user</a> (struct oh323_user *<a class="el" href="structuser.html">user</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#ab1fbdbf048ff93fd00351549de0074a5">oh323_digit_begin</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, char digit)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#ae6f44cd218ae303ea03b53dca83e4d54">oh323_digit_end</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, char digit, unsigned int duration)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send (play) the specified digit to the channel.  <a href="#ae6f44cd218ae303ea03b53dca83e4d54"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a775105a2a46963e0eadff7804c84a5e5">oh323_fixup</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *oldchan, struct <a class="el" href="structast__channel.html">ast_channel</a> *newchan)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95">ast_rtp_get_result</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a4ede66ddfa71389a1cf63f7a7b605985">oh323_get_rtp_peer</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__rtp.html">ast_rtp</a> **rtp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95">ast_rtp_get_result</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a7fe40032c649a3ca7861d2bb65f7a835">oh323_get_vrtp_peer</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__rtp.html">ast_rtp</a> **rtp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a972114df5bdd7b6858d15c0c83d3643c">oh323_hangup</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a13b1532a4ef67feabec91cb317470d29">oh323_indicate</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, int condition, const void *data, size_t datalen)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#adcbc32265d679075f1aaa98bad45d360">oh323_read</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#af86f2a525b1e58cf7b2853001b0d2345">oh323_request</a> (const char *<a class="el" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, int <a class="el" href="chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a>, void *data, int *<a class="el" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#ad8f15f265c65347173e83fbfb9f9880b">oh323_rtp_read</a> (struct <a class="el" href="structoh323__pvt.html">oh323_pvt</a> *pvt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Retrieve audio/etc from channel. Assumes pvt-&gt;lock is already held.  <a href="#ad8f15f265c65347173e83fbfb9f9880b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a1dabe18a938d4b51c708350c2596a7e7">oh323_set_rtp_peer</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, struct <a class="el" href="structast__rtp.html">ast_rtp</a> *vrtp, struct <a class="el" href="structast__rtp.html">ast_rtp</a> *trtp, int codecs, int nat_active)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#aa0bf2b42c059abf332e545b0f481df33">oh323_simulate_dtmf_end</a> (const void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a9d607a503353cfb6f7b4305b192fda8e">oh323_update_info</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Only channel structure should be locked.  <a href="#a9d607a503353cfb6f7b4305b192fda8e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#adad48dd1d0d4ee4a9b0e6e341e53f547">oh323_write</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, struct <a class="el" href="structast__frame.html">ast_frame</a> *frame)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a46a127e7a215d234d16690c06a412255">progress</a> (unsigned call_reference, const char *token, int inband)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a55c82d81ce37ebe5125d5a017c12b5ac">prune_peers</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct oh323_alias *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a8bf574965e8d09f6d10407ce9468ff1b">realtime_alias</a> (const char *alias)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct oh323_peer *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#ade030a243ae99913806e20bc6239cde0">realtime_peer</a> (const char *peername, struct sockaddr_in *sin)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct oh323_user *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a0f578c07de3dd4338e69ff42ba1e1996">realtime_user</a> (const call_details_t *cd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a533a0dc5525df003509528552d047aa7">receive_digit</a> (unsigned call_reference, char digit, const char *token, int duration)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Callback for sending digits from H.323 up to asterisk.  <a href="#a533a0dc5525df003509528552d047aa7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a6cfebf8a16722535ebfc3039f7a61456">redirectingreason2str</a> (int redirectingreason)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#aa0b7680df49f5fe40c8bb1c8f0536cc6">reload_config</a> (int is_reload)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#ac1df53d236a5999adb52ea5a0bca678a">remote_hold</a> (unsigned call_reference, const char *token, int is_hold)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a83af94bb19a421cb25ca02d16fa5ba9c">restart_monitor</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a3fe6108223a4ca1bf57716dc77a85038">set_dtmf_payload</a> (unsigned call_reference, const char *token, int payload, int is_cisco)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a3b2a3a72391ac7feafe74083f69db6fc">set_local_capabilities</a> (unsigned call_reference, const char *token)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#aa3a89ee27c1efd3e8ee24dead62035bc">set_peer_capabilities</a> (unsigned call_reference, const char *token, int <a class="el" href="res__jabber_8c.html#aa7afd7ba4814dbf49b1867019891fd14">capabilities</a>, struct <a class="el" href="structast__codec__pref.html">ast_codec_pref</a> *<a class="el" href="chan__iax2_8c.html#a46262e3cc2baf55a72542567ccfe86d9">prefs</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static call_options_t *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a99229ff7b6ed5b42956b0ba1a86924ae">setup_incoming_call</a> (call_details_t *cd)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Call-back function for incoming calls.  <a href="#a99229ff7b6ed5b42956b0ba1a86924ae"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#aba66a9543f9b7a9755a65250169e0f2a">setup_outgoing_call</a> (call_details_t *cd)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Call-back function to establish an <a class="el" href="structoutgoing.html">outgoing</a> H.323 call.  <a href="#aba66a9543f9b7a9755a65250169e0f2a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a952624d4d47581b01ee71048280ac681">setup_rtp_connection</a> (unsigned call_reference, const char *remoteIp, int remotePort, const char *token, int pt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Call-back function passing remote ip/port information from H.323 to asterisk.  <a href="#a952624d4d47581b01ee71048280ac681"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a7203b2d801c8bd449671f862cf6b2b24">update_common_options</a> (struct <a class="el" href="structast__variable.html">ast_variable</a> *v, struct call_options *options)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a88ea396aa3c9c270ced6ca203c8ad5ba">update_state</a> (struct <a class="el" href="structoh323__pvt.html">oh323_pvt</a> *pvt, int <a class="el" href="structstate.html">state</a>, int signal)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a782aff739a0c7035182f9d10828cbe35">acceptAnonymous</a> = 1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structh323__alias__list.html">h323_alias_list</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a2029bed642f94cb8e3299209b084e585">aliasl</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">H323 alias list.  <a href="#a2029bed642f94cb8e3299209b084e585"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct sockaddr_in&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#abb56ddafa06a53da731882da397ce655">cli_h323</a> []</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a3c042f9683086454ebde91b64db19726">cli_h323_reload</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a9ee8d742a1fbcff45f97842b92952610">config</a> [] = &quot;h323.conf&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#ae91dad65f553f7afebe4af507803bc7f">cos</a> = 0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a7dc6cff9d51743005af0fcf0c37251ad">default_context</a> [AST_MAX_CONTEXT] = &quot;default&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__jb__conf.html">ast_jb_conf</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a2d8d5920e90ccbad7832926becdadb29">default_jbconf</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Global jitterbuffer configuration - by default, jb is disabled.  <a href="#a2d8d5920e90ccbad7832926becdadb29"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a4bd4778b66bf079c2227fe62ec9a3e73">gatekeeper</a> [100]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#abf24fbc8556bb94e3e636bfa53170b7d">gatekeeper_disable</a> = 1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a1bcd9525b45f12be3151ff75d7f9712f">gatekeeper_discover</a> = 0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#ac870109b5266804b2ae791184ed556b8">gkroute</a> = 0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__jb__conf.html">ast_jb_conf</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">global_jbconf</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static call_options_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#ab2aace2a2c551db5a7ce9ccadc159b72">global_options</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#ad60ccb0475ed36e6be2e9914df685d56">h323_reloading</a> = 0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a7f366397aeb2f3ce05c337d8a8b32a09">h323_signalling_port</a> = 1720</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structoh323__pvt.html">oh323_pvt</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#af2608cb80e01a744400057785fd1660e">iflist</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Private structure of a OpenH323 channel.  <a href="#af2608cb80e01a744400057785fd1660e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structio__context.html">io_context</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static pthread_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503">monitor_thread</a> = AST_PTHREADT_NULL</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This is the thread for the monitor which checks for input on the <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> which are not currently in use.  <a href="#afbd6fc6e0ab3c1a04a518f19c21d4503"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__rtp__protocol.html">ast_rtp_protocol</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a662b19f30aa83f4c9b55099b8720e017">oh323_rtp</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__channel__tech.html">ast_channel_tech</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a6763477c6c97aba1b89bff0ac7641422">oh323_tech</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">answer_call_cb&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a1fa628b7c57610b13201ffbacefff0a1">on_answer_call</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">chan_ringing_cb&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#aa866b165304583211307f4df91b8f8f1">on_chan_ringing</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">clear_con_cb&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a2df495e6b83fd37a4ddf1b22cdcd4193">on_connection_cleared</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">con_established_cb&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a762d63fc9c454c71dca6a288adf9afc9">on_connection_established</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">on_rtp_cb&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a1b72cae1fc4f7c8591edcb4dc25c3514">on_external_rtp_create</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">hangup_cb&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#ab2852f78157b26698470401cb69dabfb">on_hangup</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">onhold_cb&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a26e11e1159e5e1fae04d3a082b404840">on_hold</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">setup_incoming_cb&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#ae6909633a52dfecde1a36f8e1bce53c0">on_incoming_call</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">setup_outbound_cb&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a1f6e809c069ea40ba55d5ba90dd87976">on_outgoing_call</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">progress_cb&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a8cb82d6d08966697b18c3d6372352d63">on_progress</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">receive_digit_cb&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a909f58fcc4cb5612bd30713b64605540">on_receive_digit</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">rfc2833_cb&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#ac3cb320bd0720f2cfd3ea72a29065ded">on_set_rfc2833_payload</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">setcapabilities_cb&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#acb450c0aea67fa7f35686432c3348b61">on_setcapabilities</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">setpeercapabilities_cb&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a4ce39abed19cb9aa170776834bc2bf80">on_setpeercapabilities</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">start_rtp_cb&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a54bda2aa0f993948068db2ffc8451525">on_start_rtp_channel</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structh323__peer__list.html">h323_peer_list</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a73d22ff9770f2c94dac6e92c3eddea5f">peerl</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">H323 peer list.  <a href="#a73d22ff9770f2c94dac6e92c3eddea5f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structsched__context.html">sched_context</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#aea6233539fc73fc5303bf7525ec27e73">sched</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a67fefea55602b6c8d1e29902f600e249">secret</a> [50]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a71535bf985a1a06d548fd73a0a0ec32c">tdesc</a> [] = &quot;The NuFone Network's Open H.323 Channel Driver&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a25a9305efab3b493ca2519562fcec3d5">tos</a> = 0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#a40103a555dbee6c6e5e4dc193c7fa833">unique</a> = 0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#af8106a09b3ed0924050635f9a8a19fca">userbyalias</a> = 1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structh323__user__list.html">h323_user_list</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__h323_8c.html#ab8937033f3230cb7adfe1e86d2055a5e">userl</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">H323 User list.  <a href="#ab8937033f3230cb7adfe1e86d2055a5e"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>This file is part of the chan_h323 driver for Asterisk. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Jeremy McNamara</dd></dl>
<dl class="user"><dt><b>See also</b></dt><dd><ul>
<li>Config_h323 </li>
</ul>
</dd></dl>
<dl class="extref"><dt><b><a class="el" href="extref.html#_extref000011">ExtRef:</a></b></dt><dd>OpenH323 <a href="http://www.voxgratia.org/">http://www.voxgratia.org/</a></dd></dl>

<p>Definition in file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a2675432ddd8161cbe434c098fb535aa3"></a><!-- doxytag: member="chan_h323.c::GLOBAL_CAPABILITY" ref="a2675432ddd8161cbe434c098fb535aa3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define GLOBAL_CAPABILITY&nbsp;&nbsp;&nbsp;(AST_FORMAT_G723_1 | AST_FORMAT_GSM | AST_FORMAT_ULAW | AST_FORMAT_ALAW | AST_FORMAT_G729A | AST_FORMAT_G726_AAL2 | AST_FORMAT_H261)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00132">132</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l02832">reload_config()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="abe8a9c722d92f457598ab1be93e780ea"></a><!-- doxytag: member="chan_h323.c::__oh323_destroy" ref="abe8a9c722d92f457598ab1be93e780ea" args="(struct oh323_pvt *pvt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void __oh323_destroy </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structoh323__pvt.html">oh323_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>pvt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00443">443</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="dsp_8c_source.html#l01545">ast_dsp_free()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01712">ast_mutex_destroy()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="rtp_8c_source.html#l03058">ast_rtp_destroy()</a>, <a class="el" href="sched_8h_source.html#l00051">AST_SCHED_DEL</a>, <a class="el" href="chan__h323_8c_source.html#l00156">oh323_pvt::cd</a>, <a class="el" href="chan__h323_8c_source.html#l00407">cleanup_call_details()</a>, <a class="el" href="chan__h323_8c_source.html#l00182">oh323_pvt::DTMFsched</a>, <a class="el" href="chan__h323_8c.html#af2608cb80e01a744400057785fd1660e">iflist</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__h323_8c_source.html#l00189">oh323_pvt::next</a>, <a class="el" href="chan__h323_8c_source.html#l00157">oh323_pvt::owner</a>, <a class="el" href="chan__h323_8c_source.html#l00167">oh323_pvt::rtp</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, and <a class="el" href="chan__h323_8c_source.html#l00168">oh323_pvt::vad</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l02529">do_monitor()</a>, and <a class="el" href="chan__h323_8c_source.html#l00488">oh323_destroy()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00444"></a>00444 {
<a name="l00445"></a>00445    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *cur, *prev = NULL;
<a name="l00446"></a>00446 
<a name="l00447"></a>00447    <a class="code" href="sched_8h.html#a25647782014f8dc012994efcd1b81d32" title="a loop construct to ensure that the scheduled task get deleted. The idea is that...">AST_SCHED_DEL</a>(<a class="code" href="structsched.html">sched</a>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a065b36acb6c0d5185e203b227f257b9c">DTMFsched</a>);
<a name="l00448"></a>00448 
<a name="l00449"></a>00449    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>) {
<a name="l00450"></a>00450       <a class="code" href="rtp_8h.html#a6d2addabf879eb321a660932e3bd57eb">ast_rtp_destroy</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>);
<a name="l00451"></a>00451    }
<a name="l00452"></a>00452 
<a name="l00453"></a>00453    <span class="comment">/* Free dsp used for in-band DTMF detection */</span>
<a name="l00454"></a>00454    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#aa62a1382425913a43d6111e71b9fa019">vad</a>) {
<a name="l00455"></a>00455       <a class="code" href="dsp_8h.html#a0a57a1e374549eb2705068688f4046db">ast_dsp_free</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aa62a1382425913a43d6111e71b9fa019">vad</a>);
<a name="l00456"></a>00456    }
<a name="l00457"></a>00457    <a class="code" href="chan__h323_8c.html#a9c8ed7310ecb320faec26082515f4cbc">cleanup_call_details</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>);
<a name="l00458"></a>00458 
<a name="l00459"></a>00459    <span class="comment">/* Unlink us from the owner if we have one */</span>
<a name="l00460"></a>00460    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l00461"></a>00461       <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l00462"></a>00462       <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l00463"></a>00463          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Detaching from %s\n&quot;</span>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name);
<a name="l00464"></a>00464       pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a> = NULL;
<a name="l00465"></a>00465       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l00466"></a>00466    }
<a name="l00467"></a>00467    cur = <a class="code" href="chan__h323_8c.html#af2608cb80e01a744400057785fd1660e" title="Private structure of a OpenH323 channel.">iflist</a>;
<a name="l00468"></a>00468    <span class="keywordflow">while</span>(cur) {
<a name="l00469"></a>00469       <span class="keywordflow">if</span> (cur == pvt) {
<a name="l00470"></a>00470          <span class="keywordflow">if</span> (prev)
<a name="l00471"></a>00471             prev-&gt;<a class="code" href="structoh323__pvt.html#aa892ef2e174a7308e21e4ab3bf7dfdae">next</a> = cur-&gt;<a class="code" href="structoh323__pvt.html#aa892ef2e174a7308e21e4ab3bf7dfdae">next</a>;
<a name="l00472"></a>00472          <span class="keywordflow">else</span>
<a name="l00473"></a>00473             <a class="code" href="chan__h323_8c.html#af2608cb80e01a744400057785fd1660e" title="Private structure of a OpenH323 channel.">iflist</a> = cur-&gt;<a class="code" href="structoh323__pvt.html#aa892ef2e174a7308e21e4ab3bf7dfdae">next</a>;
<a name="l00474"></a>00474          <span class="keywordflow">break</span>;
<a name="l00475"></a>00475       }
<a name="l00476"></a>00476       prev = cur;
<a name="l00477"></a>00477       cur = cur-&gt;<a class="code" href="structoh323__pvt.html#aa892ef2e174a7308e21e4ab3bf7dfdae">next</a>;
<a name="l00478"></a>00478    }
<a name="l00479"></a>00479    <span class="keywordflow">if</span> (!cur) {
<a name="l00480"></a>00480       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%p is not in list?!?! \n&quot;</span>, cur);
<a name="l00481"></a>00481    } <span class="keywordflow">else</span> {
<a name="l00482"></a>00482       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00483"></a>00483       <a class="code" href="lock_8h.html#ab237e70b569019bfb490ab0c3c09b8c5">ast_mutex_destroy</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00484"></a>00484       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(pvt);
<a name="l00485"></a>00485    }
<a name="l00486"></a>00486 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab9a955a886712c23ff59fb68d2a59f9a"></a><!-- doxytag: member="chan_h323.c::__oh323_new" ref="ab9a955a886712c23ff59fb68d2a59f9a" args="(struct oh323_pvt *pvt, int state, const char *host)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__channel.html">ast_channel</a>* __oh323_new </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structoh323__pvt.html">oh323_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>pvt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>host</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Private structure should be locked on a call. </p>

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00999">999</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="chan__h323_8c_source.html#l00951">__oh323_rtp_create()</a>, <a class="el" href="chan__iax2_8c_source.html#l00328">accountcode</a>, <a class="el" href="chan__h323_8c_source.html#l00164">oh323_pvt::accountcode</a>, <a class="el" href="channel_8h_source.html#l00473">ast_channel::amaflags</a>, <a class="el" href="chan__h323_8c_source.html#l00166">oh323_pvt::amaflags</a>, <a class="el" href="channel_8c_source.html#l00711">ast_best_codec()</a>, <a class="el" href="channel_8h_source.html#l00730">ast_channel_alloc</a>, <a class="el" href="channel_8c_source.html#l01576">ast_channel_set_fd()</a>, <a class="el" href="frame_8c_source.html#l01211">ast_codec_choose()</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="dsp_8c_source.html#l01519">ast_dsp_new()</a>, <a class="el" href="dsp_8c_source.html#l01540">ast_dsp_set_features()</a>, <a class="el" href="channel_8c_source.html#l01690">ast_hangup()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="loader_8c_source.html#l01163">ast_module_ref()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="pbx_8c_source.html#l04559">ast_pbx_start()</a>, <a class="el" href="rtp_8c_source.html#l00723">ast_rtcp_fd()</a>, <a class="el" href="rtp_8c_source.html#l00718">ast_rtp_fd()</a>, <a class="el" href="channel_8h_source.html#l00359">AST_STATE_DOWN</a>, <a class="el" href="channel_8h_source.html#l00363">AST_STATE_RING</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="stringfields_8h_source.html#l00285">ast_string_field_set</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="udptl_8c_source.html#l00640">ast_udptl_fd()</a>, <a class="el" href="chan__h323_8c_source.html#l00156">oh323_pvt::cd</a>, <a class="el" href="channel_8h_source.html#l00444">ast_channel::cid</a>, <a class="el" href="channel_8h_source.html#l00205">ast_callerid::cid_ani</a>, <a class="el" href="channel_8h_source.html#l00202">ast_callerid::cid_dnid</a>, <a class="el" href="chan__mgcp_8c_source.html#l00149">cid_name</a>, <a class="el" href="chan__mgcp_8c_source.html#l00148">cid_num</a>, <a class="el" href="channel_8h_source.html#l00207">ast_callerid::cid_pres</a>, <a class="el" href="channel_8h_source.html#l00206">ast_callerid::cid_rdnis</a>, <a class="el" href="channel_8h_source.html#l00209">ast_callerid::cid_ton</a>, <a class="el" href="channel_8h_source.html#l00503">ast_channel::context</a>, <a class="el" href="chan__h323_8c_source.html#l00163">oh323_pvt::context</a>, <a class="el" href="dsp_8h_source.html#l00028">DSP_FEATURE_DIGIT_DETECT</a>, <a class="el" href="channel_8h_source.html#l00504">ast_channel::exten</a>, <a class="el" href="chan__h323_8c_source.html#l00162">oh323_pvt::exten</a>, <a class="el" href="chan__h323_8c_source.html#l00178">oh323_pvt::jointcapability</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__h323_8c_source.html#l00169">oh323_pvt::nativeformats</a>, <a class="el" href="channel_8h_source.html#l00482">ast_channel::nativeformats</a>, <a class="el" href="chan__h323_8c_source.html#l00153">oh323_pvt::options</a>, <a class="el" href="chan__h323_8c_source.html#l00157">oh323_pvt::owner</a>, <a class="el" href="pbx_8c_source.html#l09023">pbx_builtin_setvar_helper()</a>, <a class="el" href="channel_8h_source.html#l00471">ast_channel::priority</a>, <a class="el" href="channel_8h_source.html#l00485">ast_channel::rawreadformat</a>, <a class="el" href="channel_8h_source.html#l00486">ast_channel::rawwriteformat</a>, <a class="el" href="channel_8h_source.html#l00483">ast_channel::readformat</a>, <a class="el" href="chan__h323_8c_source.html#l00263">redirectingreason2str()</a>, <a class="el" href="channel_8h_source.html#l00470">ast_channel::rings</a>, <a class="el" href="chan__h323_8c_source.html#l00167">oh323_pvt::rtp</a>, <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, <a class="el" href="channel_8h_source.html#l00493">ast_channel::transfercapability</a>, <a class="el" href="chan__h323_8c_source.html#l00168">oh323_pvt::vad</a>, and <a class="el" href="channel_8h_source.html#l00484">ast_channel::writeformat</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l02220">answer_call()</a>, and <a class="el" href="chan__h323_8c_source.html#l01722">oh323_request()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01000"></a>01000 {
<a name="l01001"></a>01001    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *ch;
<a name="l01002"></a>01002    <span class="keywordtype">char</span> *<a class="code" href="chan__mgcp_8c.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>, *<a class="code" href="chan__mgcp_8c.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>;
<a name="l01003"></a>01003    <span class="keywordtype">int</span> fmt;
<a name="l01004"></a>01004 
<a name="l01005"></a>01005    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.cid_num))
<a name="l01006"></a>01006       cid_num = pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.cid_num;
<a name="l01007"></a>01007    <span class="keywordflow">else</span>
<a name="l01008"></a>01008       cid_num = pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.call_source_e164;
<a name="l01009"></a>01009 
<a name="l01010"></a>01010    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.cid_name))
<a name="l01011"></a>01011       cid_name = pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.cid_name;
<a name="l01012"></a>01012    <span class="keywordflow">else</span>
<a name="l01013"></a>01013       cid_name = pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.call_source_name;
<a name="l01014"></a>01014    
<a name="l01015"></a>01015    <span class="comment">/* Don&apos;t hold a oh323_pvt lock while we allocate a chanel */</span>
<a name="l01016"></a>01016    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01017"></a>01017    ch = <a class="code" href="channel_8h.html#adfbceb39821586c0f9be0c47496a4e18">ast_channel_alloc</a>(1, <a class="code" href="structstate.html">state</a>, cid_num, cid_name, pvt-&gt;<a class="code" href="structoh323__pvt.html#acfaabb39ce3cdd7f938adf92d5083380">accountcode</a>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>, pvt-&gt;<a class="code" href="structoh323__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, pvt-&gt;<a class="code" href="structoh323__pvt.html#ad2cfb0f821c065261382a9298bb5a16b">amaflags</a>, <span class="stringliteral">&quot;H323/%s&quot;</span>, host);
<a name="l01018"></a>01018    <span class="comment">/* Update usage counter */</span>
<a name="l01019"></a>01019    <a class="code" href="module_8h.html#aa08fcee0b390e15532dd03803c8728c4">ast_module_ref</a>(<a class="code" href="structast__module__info.html">ast_module_info</a>-&gt;self);
<a name="l01020"></a>01020    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01021"></a>01021    <span class="keywordflow">if</span> (ch) {
<a name="l01022"></a>01022       ch-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a> = &amp;<a class="code" href="chan__h323_8c.html#a6763477c6c97aba1b89bff0ac7641422">oh323_tech</a>;
<a name="l01023"></a>01023       <span class="keywordflow">if</span> (!(fmt = pvt-&gt;<a class="code" href="structoh323__pvt.html#a38f5730c90d9315eb1c0df6cfdc37da6">jointcapability</a>) &amp;&amp; !(fmt = pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.capability))
<a name="l01024"></a>01024          fmt = <a class="code" href="chan__h323_8c.html#ab2aace2a2c551db5a7ce9ccadc159b72">global_options</a>.capability;
<a name="l01025"></a>01025       ch-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a> = <a class="code" href="frame_8h.html#a123ec7e6e90e279b75bc6447eab5d3b2" title="Select the best audio format according to preference list from supplied options....">ast_codec_choose</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.prefs, fmt, 1)<span class="comment">/* | (pvt-&gt;jointcapability &amp; AST_FORMAT_VIDEO_MASK)*/</span>;
<a name="l01026"></a>01026       pvt-&gt;<a class="code" href="structoh323__pvt.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a> = ch-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>;
<a name="l01027"></a>01027       fmt = <a class="code" href="channel_8h.html#a4d78194779a26341c3ec7298b450b9ed" title="Pick the best audio codec.">ast_best_codec</a>(ch-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>);
<a name="l01028"></a>01028       ch-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a> = fmt;
<a name="l01029"></a>01029       ch-&gt;<a class="code" href="structast__channel.html#a045b6dfdee84adceb7e86b6c5c4f9a86">rawwriteformat</a> = fmt;
<a name="l01030"></a>01030       ch-&gt;<a class="code" href="structast__channel.html#ab7786a0f5b9a9ebf83daed87be4f3868">readformat</a> = fmt;
<a name="l01031"></a>01031       ch-&gt;<a class="code" href="structast__channel.html#a6fcf944239e3718e282e0ba7512e66c6">rawreadformat</a> = fmt;
<a name="l01032"></a>01032       <span class="keywordflow">if</span> (!pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>)
<a name="l01033"></a>01033          <a class="code" href="chan__h323_8c.html#a954ed862fccabf74f1b9ea728c97fb3b">__oh323_rtp_create</a>(pvt);
<a name="l01034"></a>01034 <span class="preprocessor">#if 0</span>
<a name="l01035"></a>01035 <span class="preprocessor"></span>      <a class="code" href="channel_8h.html#aca37ca2f3d55a223d26617329ed48a3e">ast_channel_set_fd</a>(ch, 0, <a class="code" href="rtp_8h.html#a9a990d85fb0aac29bda48777f0f86108">ast_rtp_fd</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>));
<a name="l01036"></a>01036       <a class="code" href="channel_8h.html#aca37ca2f3d55a223d26617329ed48a3e">ast_channel_set_fd</a>(ch, 1, <a class="code" href="rtp_8h.html#ac3e115dfd0bfe82479060b55dd41601f">ast_rtcp_fd</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>));
<a name="l01037"></a>01037 <span class="preprocessor">#endif</span>
<a name="l01038"></a>01038 <span class="preprocessor"></span><span class="preprocessor">#ifdef VIDEO_SUPPORT</span>
<a name="l01039"></a>01039 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (pvt-&gt;vrtp) {
<a name="l01040"></a>01040          <a class="code" href="channel_8h.html#aca37ca2f3d55a223d26617329ed48a3e">ast_channel_set_fd</a>(ch, 2, <a class="code" href="rtp_8h.html#a9a990d85fb0aac29bda48777f0f86108">ast_rtp_fd</a>(pvt-&gt;vrtp));
<a name="l01041"></a>01041          <a class="code" href="channel_8h.html#aca37ca2f3d55a223d26617329ed48a3e">ast_channel_set_fd</a>(ch, 3, <a class="code" href="rtp_8h.html#ac3e115dfd0bfe82479060b55dd41601f">ast_rtcp_fd</a>(pvt-&gt;vrtp));
<a name="l01042"></a>01042       }
<a name="l01043"></a>01043 <span class="preprocessor">#endif</span>
<a name="l01044"></a>01044 <span class="preprocessor"></span><span class="preprocessor">#ifdef T38_SUPPORT</span>
<a name="l01045"></a>01045 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (pvt-&gt;udptl) {
<a name="l01046"></a>01046          <a class="code" href="channel_8h.html#aca37ca2f3d55a223d26617329ed48a3e">ast_channel_set_fd</a>(ch, 4, <a class="code" href="udptl_8h.html#a424e6e48fcfa491a9ee6da3c8a7162a3">ast_udptl_fd</a>(pvt-&gt;udptl));
<a name="l01047"></a>01047       }
<a name="l01048"></a>01048 <span class="preprocessor">#endif</span>
<a name="l01049"></a>01049 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="structstate.html">state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>) {
<a name="l01050"></a>01050          ch-&gt;<a class="code" href="structast__channel.html#a358fd14658a0c5276190e48f1b1f251a">rings</a> = 1;
<a name="l01051"></a>01051       }
<a name="l01052"></a>01052       <span class="comment">/* Allocate dsp for in-band DTMF support */</span>
<a name="l01053"></a>01053       <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.dtmfmode &amp; H323_DTMF_INBAND) {
<a name="l01054"></a>01054          pvt-&gt;<a class="code" href="structoh323__pvt.html#aa62a1382425913a43d6111e71b9fa019">vad</a> = <a class="code" href="dsp_8h.html#a0a60e93006c8e1ca8fda922ae0e0da2c">ast_dsp_new</a>();
<a name="l01055"></a>01055          <a class="code" href="dsp_8h.html#aedc7fa20fba91e3c018f6989e95c714b" title="Select feature set.">ast_dsp_set_features</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aa62a1382425913a43d6111e71b9fa019">vad</a>, <a class="code" href="dsp_8h.html#a84818b360426bdd5f588cdca463e15be">DSP_FEATURE_DIGIT_DETECT</a>);
<a name="l01056"></a>01056       }
<a name="l01057"></a>01057       <span class="comment">/* Register channel functions. */</span>
<a name="l01058"></a>01058       ch-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a> = pvt;
<a name="l01059"></a>01059       <span class="comment">/* Set the owner of this channel */</span>
<a name="l01060"></a>01060       pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = ch;
<a name="l01061"></a>01061 
<a name="l01062"></a>01062       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(ch-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, pvt-&gt;<a class="code" href="structoh323__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <span class="keyword">sizeof</span>(ch-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>));
<a name="l01063"></a>01063       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(ch-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>, <span class="keyword">sizeof</span>(ch-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>));
<a name="l01064"></a>01064       ch-&gt;<a class="code" href="structast__channel.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> = 1;
<a name="l01065"></a>01065       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#acfaabb39ce3cdd7f938adf92d5083380">accountcode</a>)) {
<a name="l01066"></a>01066          <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(ch, <a class="code" href="chan__iax2_8c.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>, pvt-&gt;<a class="code" href="structoh323__pvt.html#acfaabb39ce3cdd7f938adf92d5083380">accountcode</a>);
<a name="l01067"></a>01067       }
<a name="l01068"></a>01068       <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#ad2cfb0f821c065261382a9298bb5a16b">amaflags</a>) {
<a name="l01069"></a>01069          ch-&gt;<a class="code" href="structast__channel.html#ad2cfb0f821c065261382a9298bb5a16b">amaflags</a> = pvt-&gt;<a class="code" href="structoh323__pvt.html#ad2cfb0f821c065261382a9298bb5a16b">amaflags</a>;
<a name="l01070"></a>01070       }
<a name="l01071"></a>01071 
<a name="l01072"></a>01072       <span class="comment">/* Don&apos;t use ast_set_callerid() here because it will</span>
<a name="l01073"></a>01073 <span class="comment">       * generate a needless NewCallerID event */</span>
<a name="l01074"></a>01074       ch-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a7bb8ad258e687da69d6933ab48320df7">cid_ani</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(cid_num);
<a name="l01075"></a>01075 
<a name="l01076"></a>01076       <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.redirect_reason &gt;= 0) {
<a name="l01077"></a>01077          ch-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a4791c5f3aedc8782678867a1741f4131">cid_rdnis</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.redirect_number);
<a name="l01078"></a>01078          <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(ch, <span class="stringliteral">&quot;PRIREDIRECTREASON&quot;</span>, <a class="code" href="chan__h323_8c.html#a6cfebf8a16722535ebfc3039f7a61456">redirectingreason2str</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.redirect_reason));
<a name="l01079"></a>01079       }
<a name="l01080"></a>01080       ch-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a5674af3fa5ce1dd1fe052be1477d4110">cid_pres</a> = pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.presentation;
<a name="l01081"></a>01081       ch-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#aff456ca48d31a9813584e799064cf88e">cid_ton</a> = pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.type_of_number;
<a name="l01082"></a>01082 
<a name="l01083"></a>01083       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>) &amp;&amp; strcmp(pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>, <span class="stringliteral">&quot;s&quot;</span>)) {
<a name="l01084"></a>01084          ch-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#aa54ab157f47ac529034d524781e2a7e2">cid_dnid</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>);
<a name="l01085"></a>01085       }
<a name="l01086"></a>01086       <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.transfer_capability &gt;= 0)
<a name="l01087"></a>01087          ch-&gt;<a class="code" href="structast__channel.html#a67fbfb6a4051ff15a242b9685167f16a">transfercapability</a> = pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.transfer_capability;
<a name="l01088"></a>01088       <span class="keywordflow">if</span> (<a class="code" href="structstate.html">state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>) {
<a name="l01089"></a>01089          <span class="keywordflow">if</span> (<a class="code" href="pbx_8h.html#a9a937fbb3b5f4e68880a9c5714a29ce5" title="Create a new thread and start the PBX.">ast_pbx_start</a>(ch)) {
<a name="l01090"></a>01090             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to start PBX on %s\n&quot;</span>, ch-&gt;name);
<a name="l01091"></a>01091             <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(ch);
<a name="l01092"></a>01092             ch = NULL;
<a name="l01093"></a>01093          }
<a name="l01094"></a>01094       }
<a name="l01095"></a>01095    } <span class="keywordflow">else</span> {
<a name="l01096"></a>01096       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to allocate channel structure\n&quot;</span>);
<a name="l01097"></a>01097    }
<a name="l01098"></a>01098    <span class="keywordflow">return</span> ch;
<a name="l01099"></a>01099 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a954ed862fccabf74f1b9ea728c97fb3b"></a><!-- doxytag: member="chan_h323.c::__oh323_rtp_create" ref="a954ed862fccabf74f1b9ea728c97fb3b" args="(struct oh323_pvt *pvt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int __oh323_rtp_create </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structoh323__pvt.html">oh323_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>pvt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00951">951</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l01576">ast_channel_set_fd()</a>, <a class="el" href="lock_8h_source.html#l02037">ast_channel_trylock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="acl_8c_source.html#l00511">ast_find_ourip()</a>, <a class="el" href="abstract__jb_8c_source.html#l00610">ast_jb_configure()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="frame_8c_source.html#l00124">ast_null_frame</a>, <a class="el" href="channel_8c_source.html#l01080">ast_queue_frame()</a>, <a class="el" href="rtp_8c_source.html#l00723">ast_rtcp_fd()</a>, <a class="el" href="rtp_8c_source.html#l03728">ast_rtp_codec_setpref()</a>, <a class="el" href="rtp_8c_source.html#l00718">ast_rtp_fd()</a>, <a class="el" href="rtp_8c_source.html#l02533">ast_rtp_new_with_bindaddr()</a>, <a class="el" href="rtp_8c_source.html#l02310">ast_rtp_set_rtpmap_type()</a>, <a class="el" href="rtp_8c_source.html#l00801">ast_rtp_setnat()</a>, <a class="el" href="rtp_8c_source.html#l02636">ast_rtp_setqos()</a>, <a class="el" href="chan__h323_8c_source.html#l00130">bindaddr</a>, <a class="el" href="chan__h323_8c_source.html#l00180">oh323_pvt::dtmf_pt</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="chan__h323_8c_source.html#l00124">global_jbconf</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__h323_8c_source.html#l00153">oh323_pvt::options</a>, <a class="el" href="chan__h323_8c_source.html#l00157">oh323_pvt::owner</a>, <a class="el" href="chan__h323_8c_source.html#l00179">oh323_pvt::peer_prefs</a>, <a class="el" href="chan__h323_8c_source.html#l00177">oh323_pvt::peercapability</a>, <a class="el" href="chan__h323_8c_source.html#l00167">oh323_pvt::rtp</a>, and <a class="el" href="chan__h323_8c_source.html#l00183">oh323_pvt::update_rtp_info</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l00999">__oh323_new()</a>, <a class="el" href="chan__h323_8c_source.html#l01895">external_rtp_create()</a>, and <a class="el" href="chan__h323_8c_source.html#l01936">setup_rtp_connection()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00952"></a>00952 {
<a name="l00953"></a>00953    <span class="keyword">struct </span>in_addr our_addr;
<a name="l00954"></a>00954 
<a name="l00955"></a>00955    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>)
<a name="l00956"></a>00956       <span class="keywordflow">return</span> 0;
<a name="l00957"></a>00957 
<a name="l00958"></a>00958    <span class="keywordflow">if</span> (<a class="code" href="acl_8h.html#a4fbb9258573d41461c7389afbcbba377">ast_find_ourip</a>(&amp;our_addr, <a class="code" href="chan__h323_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>)) {
<a name="l00959"></a>00959       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00960"></a>00960       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to locate local IP address for RTP stream\n&quot;</span>);
<a name="l00961"></a>00961       <span class="keywordflow">return</span> -1;
<a name="l00962"></a>00962    }
<a name="l00963"></a>00963    pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a> = <a class="code" href="rtp_8h.html#a10d5296cd50be78954103b0a0c754640" title="Initializate a RTP session using an in_addr structure.">ast_rtp_new_with_bindaddr</a>(<a class="code" href="structsched.html">sched</a>, <a class="code" href="chan__h323_8c.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a>, 1, 0, our_addr);
<a name="l00964"></a>00964    <span class="keywordflow">if</span> (!pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>) {
<a name="l00965"></a>00965       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00966"></a>00966       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create RTP session: %s\n&quot;</span>, strerror(errno));
<a name="l00967"></a>00967       <span class="keywordflow">return</span> -1;
<a name="l00968"></a>00968    }
<a name="l00969"></a>00969    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l00970"></a>00970       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Created RTP channel\n&quot;</span>);
<a name="l00971"></a>00971 
<a name="l00972"></a>00972    <a class="code" href="rtp_8h.html#af8579b7a7b2815a83cd80bf1c23d7824">ast_rtp_setqos</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, <a class="code" href="chan__h323_8c.html#a25a9305efab3b493ca2519562fcec3d5">tos</a>, <a class="code" href="chan__h323_8c.html#ae91dad65f553f7afebe4af507803bc7f">cos</a>, <span class="stringliteral">&quot;H323 RTP&quot;</span>);
<a name="l00973"></a>00973 
<a name="l00974"></a>00974    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l00975"></a>00975       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Setting NAT on RTP to %d\n&quot;</span>, pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.nat);
<a name="l00976"></a>00976    <a class="code" href="rtp_8h.html#ad7fd9b0ac09fc5378dcf120bc5d18c03">ast_rtp_setnat</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.nat);
<a name="l00977"></a>00977 
<a name="l00978"></a>00978    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#a2a424f83ef5dc1995dbf1d6ddf0a9e1f">dtmf_pt</a>[0] &gt; 0)
<a name="l00979"></a>00979       <a class="code" href="rtp_8h.html#a02a3ba4e11691cafd933cbb1e6225b3e" title="Set payload type to a known MIME media type for a codec.">ast_rtp_set_rtpmap_type</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a2a424f83ef5dc1995dbf1d6ddf0a9e1f">dtmf_pt</a>[0], <span class="stringliteral">&quot;audio&quot;</span>, <span class="stringliteral">&quot;telephone-event&quot;</span>, 0);
<a name="l00980"></a>00980    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#a2a424f83ef5dc1995dbf1d6ddf0a9e1f">dtmf_pt</a>[1] &gt; 0)
<a name="l00981"></a>00981       <a class="code" href="rtp_8h.html#a02a3ba4e11691cafd933cbb1e6225b3e" title="Set payload type to a known MIME media type for a codec.">ast_rtp_set_rtpmap_type</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a2a424f83ef5dc1995dbf1d6ddf0a9e1f">dtmf_pt</a>[1], <span class="stringliteral">&quot;audio&quot;</span>, <span class="stringliteral">&quot;cisco-telephone-event&quot;</span>, 0);
<a name="l00982"></a>00982 
<a name="l00983"></a>00983    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#a64c43413589d9d63d2ef5db58ed1a7c2">peercapability</a>)
<a name="l00984"></a>00984       <a class="code" href="rtp_8h.html#ae6a1acd75aaf08afc6954bd5ac671c6a" title="Set codec preference.">ast_rtp_codec_setpref</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, &amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#a2dfc2493ffd09f38b5da7248fb7177a9">peer_prefs</a>);
<a name="l00985"></a>00985 
<a name="l00986"></a>00986    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; !<a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {
<a name="l00987"></a>00987       <a class="code" href="abstract__jb_8h.html#a0981c84ac90dd79bc2a0fdd90aa6efba" title="Configures a jitterbuffer on a channel.">ast_jb_configure</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, &amp;<a class="code" href="chan__h323_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">global_jbconf</a>);
<a name="l00988"></a>00988       <a class="code" href="channel_8h.html#aca37ca2f3d55a223d26617329ed48a3e">ast_channel_set_fd</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, 0, <a class="code" href="rtp_8h.html#a9a990d85fb0aac29bda48777f0f86108">ast_rtp_fd</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>));
<a name="l00989"></a>00989       <a class="code" href="channel_8h.html#aca37ca2f3d55a223d26617329ed48a3e">ast_channel_set_fd</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, 1, <a class="code" href="rtp_8h.html#ac3e115dfd0bfe82479060b55dd41601f">ast_rtcp_fd</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>));
<a name="l00990"></a>00990       <a class="code" href="channel_8h.html#a6cbcba5661d55216968cde8fdf913c89" title="Queue one or more frames to a channel&amp;#39;s frame queue.">ast_queue_frame</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>);   <span class="comment">/* Tell Asterisk to apply changes */</span>
<a name="l00991"></a>00991       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l00992"></a>00992    } <span class="keywordflow">else</span>
<a name="l00993"></a>00993       pvt-&gt;<a class="code" href="structoh323__pvt.html#aa66a6c29649ba7a43eccbcc71f223c3c">update_rtp_info</a> = 1;
<a name="l00994"></a>00994 
<a name="l00995"></a>00995    <span class="keywordflow">return</span> 0;
<a name="l00996"></a>00996 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac83c5df72d69f2472b7bd1fd36b634cb"></a><!-- doxytag: member="chan_h323.c::__oh323_update_info" ref="ac83c5df72d69f2472b7bd1fd36b634cb" args="(struct ast_channel *c, struct oh323_pvt *pvt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void __oh323_update_info </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structoh323__pvt.html">oh323_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>pvt</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Channel and private structures should be already locked. </p>

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00332">332</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00462">ast_channel::_softhangup</a>, <a class="el" href="channel_8c_source.html#l01576">ast_channel_set_fd()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8h_source.html#l00122">AST_FRAME_DTMF_BEGIN</a>, <a class="el" href="frame_8h_source.html#l00099">AST_FRAME_DTMF_END</a>, <a class="el" href="abstract__jb_8c_source.html#l00610">ast_jb_configure()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="frame_8c_source.html#l00124">ast_null_frame</a>, <a class="el" href="channel_8c_source.html#l01123">ast_queue_control()</a>, <a class="el" href="channel_8c_source.html#l01080">ast_queue_frame()</a>, <a class="el" href="channel_8c_source.html#l01103">ast_queue_hangup_with_cause()</a>, <a class="el" href="rtp_8c_source.html#l00723">ast_rtcp_fd()</a>, <a class="el" href="rtp_8c_source.html#l00718">ast_rtp_fd()</a>, <a class="el" href="sched_8c_source.html#l00439">ast_sched_add()</a>, <a class="el" href="sched_8h_source.html#l00051">AST_SCHED_DEL</a>, <a class="el" href="channel_8c_source.html#l03731">ast_set_read_format()</a>, <a class="el" href="channel_8c_source.html#l03737">ast_set_write_format()</a>, <a class="el" href="channel_8c_source.html#l04695">ast_setstate()</a>, <a class="el" href="channel_8h_source.html#l00633">AST_SOFTHANGUP_DEV</a>, <a class="el" href="chan__h323_8c_source.html#l00181">oh323_pvt::curDTMF</a>, <a class="el" href="chan__h323_8c_source.html#l00182">oh323_pvt::DTMFsched</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="chan__h323_8c_source.html#l00124">global_jbconf</a>, <a class="el" href="chan__h323_8c_source.html#l00171">oh323_pvt::hangupcause</a>, <a class="el" href="channel_8h_source.html#l00479">ast_channel::hangupcause</a>, <a class="el" href="logger_8h_source.html#l00185">LOG_DTMF</a>, <a class="el" href="chan__h323_8c_source.html#l00169">oh323_pvt::nativeformats</a>, <a class="el" href="channel_8h_source.html#l00482">ast_channel::nativeformats</a>, <a class="el" href="chan__h323_8c_source.html#l00170">oh323_pvt::needhangup</a>, <a class="el" href="chan__h323_8c_source.html#l00173">oh323_pvt::newcontrol</a>, <a class="el" href="chan__h323_8c_source.html#l00174">oh323_pvt::newdigit</a>, <a class="el" href="chan__h323_8c_source.html#l00175">oh323_pvt::newduration</a>, <a class="el" href="chan__h323_8c_source.html#l00172">oh323_pvt::newstate</a>, <a class="el" href="chan__h323_8c_source.html#l00302">oh323_simulate_dtmf_end()</a>, <a class="el" href="chan__h323_8c_source.html#l00157">oh323_pvt::owner</a>, <a class="el" href="channel_8h_source.html#l00483">ast_channel::readformat</a>, <a class="el" href="chan__h323_8c_source.html#l00167">oh323_pvt::rtp</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, <a class="el" href="chan__h323_8c_source.html#l00183">oh323_pvt::update_rtp_info</a>, and <a class="el" href="channel_8h_source.html#l00484">ast_channel::writeformat</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l00803">oh323_read()</a>, <a class="el" href="chan__h323_8c_source.html#l00396">oh323_update_info()</a>, and <a class="el" href="chan__h323_8c_source.html#l00828">oh323_write()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00333"></a>00333 {
<a name="l00334"></a>00334    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a> != pvt-&gt;<a class="code" href="structoh323__pvt.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>) {
<a name="l00335"></a>00335       <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l00336"></a>00336          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Preparing %s for new native format\n&quot;</span>, c-&gt;name);
<a name="l00337"></a>00337       c-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a> = pvt-&gt;<a class="code" href="structoh323__pvt.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>;
<a name="l00338"></a>00338       <a class="code" href="channel_8h.html#a72d53065c6bc2b6092fa41eefa03f1ad" title="Sets read format on channel chan Set read format for channel to whichever component...">ast_set_read_format</a>(c, c-&gt;<a class="code" href="structast__channel.html#ab7786a0f5b9a9ebf83daed87be4f3868">readformat</a>);
<a name="l00339"></a>00339       <a class="code" href="channel_8h.html#a978161a52d98fdaee374d1f6e1359544" title="Sets write format on channel chan Set write format for channel to whichever component...">ast_set_write_format</a>(c, c-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a>);
<a name="l00340"></a>00340    }
<a name="l00341"></a>00341    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#ab410abac6a8fa56d1c7b19a470a25d93">needhangup</a>) {
<a name="l00342"></a>00342       <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l00343"></a>00343          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Process pending hangup for %s\n&quot;</span>, c-&gt;name);
<a name="l00344"></a>00344       c-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> |= <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709a2e185ce313026e13ed90ae3a319c9cb7">AST_SOFTHANGUP_DEV</a>;
<a name="l00345"></a>00345       c-&gt;<a class="code" href="structast__channel.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a> = pvt-&gt;<a class="code" href="structoh323__pvt.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a>;
<a name="l00346"></a>00346       <a class="code" href="channel_8h.html#a91e78b15da3244307ffd749fa85f4db7" title="Queue a hangup frame with hangupcause set.">ast_queue_hangup_with_cause</a>(c, pvt-&gt;<a class="code" href="structoh323__pvt.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a>);
<a name="l00347"></a>00347       pvt-&gt;<a class="code" href="structoh323__pvt.html#ab410abac6a8fa56d1c7b19a470a25d93">needhangup</a> = 0;
<a name="l00348"></a>00348       pvt-&gt;<a class="code" href="structoh323__pvt.html#a6c29a78e6d59b85ce615a046fabd4b0f">newstate</a> = pvt-&gt;<a class="code" href="structoh323__pvt.html#a96512445a0a8d8b2b9f40db190f33f14">newcontrol</a> = pvt-&gt;<a class="code" href="structoh323__pvt.html#a8972b94b384117570fef447df6504fde">newdigit</a> = pvt-&gt;<a class="code" href="structoh323__pvt.html#a065b36acb6c0d5185e203b227f257b9c">DTMFsched</a> = -1;
<a name="l00349"></a>00349    }
<a name="l00350"></a>00350    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#a6c29a78e6d59b85ce615a046fabd4b0f">newstate</a> &gt;= 0) {
<a name="l00351"></a>00351       <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(c, pvt-&gt;<a class="code" href="structoh323__pvt.html#a6c29a78e6d59b85ce615a046fabd4b0f">newstate</a>);
<a name="l00352"></a>00352       pvt-&gt;<a class="code" href="structoh323__pvt.html#a6c29a78e6d59b85ce615a046fabd4b0f">newstate</a> = -1;
<a name="l00353"></a>00353    }
<a name="l00354"></a>00354    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#a96512445a0a8d8b2b9f40db190f33f14">newcontrol</a> &gt;= 0) {
<a name="l00355"></a>00355       <a class="code" href="channel_8h.html#a60f9d2b0ab8b7a839902313321163b28" title="Queue a control frame with payload.">ast_queue_control</a>(c, pvt-&gt;<a class="code" href="structoh323__pvt.html#a96512445a0a8d8b2b9f40db190f33f14">newcontrol</a>);
<a name="l00356"></a>00356       pvt-&gt;<a class="code" href="structoh323__pvt.html#a96512445a0a8d8b2b9f40db190f33f14">newcontrol</a> = -1;
<a name="l00357"></a>00357    }
<a name="l00358"></a>00358    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#a8972b94b384117570fef447df6504fde">newdigit</a> &gt;= 0) {
<a name="l00359"></a>00359       <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> <a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a> = {
<a name="l00360"></a>00360          .frametype = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a98e65764bc963016c394bcc1bad6540b">AST_FRAME_DTMF_END</a>,
<a name="l00361"></a>00361          .subclass = pvt-&gt;<a class="code" href="structoh323__pvt.html#a8972b94b384117570fef447df6504fde">newdigit</a>,
<a name="l00362"></a>00362          .samples = pvt-&gt;<a class="code" href="structoh323__pvt.html#acd0eb566ce3a46e17cb6823b46a671e4">newduration</a> * 8,
<a name="l00363"></a>00363          .len = pvt-&gt;<a class="code" href="structoh323__pvt.html#acd0eb566ce3a46e17cb6823b46a671e4">newduration</a>,
<a name="l00364"></a>00364          .src = <span class="stringliteral">&quot;UPDATE_INFO&quot;</span>,
<a name="l00365"></a>00365       };
<a name="l00366"></a>00366       <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#a8972b94b384117570fef447df6504fde">newdigit</a> == <span class="charliteral">&apos; &apos;</span>) {      <span class="comment">/* signalUpdate message */</span>
<a name="l00367"></a>00367          f.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = pvt-&gt;<a class="code" href="structoh323__pvt.html#af9a8bf05d4868eff107cd3b34689a5bb">curDTMF</a>;
<a name="l00368"></a>00368          <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#a065b36acb6c0d5185e203b227f257b9c">DTMFsched</a> &gt;= 0) {
<a name="l00369"></a>00369             <a class="code" href="sched_8h.html#a25647782014f8dc012994efcd1b81d32" title="a loop construct to ensure that the scheduled task get deleted. The idea is that...">AST_SCHED_DEL</a>(<a class="code" href="structsched.html">sched</a>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a065b36acb6c0d5185e203b227f257b9c">DTMFsched</a>);
<a name="l00370"></a>00370          }
<a name="l00371"></a>00371       } <span class="keywordflow">else</span> {                <span class="comment">/* Regular input or signal message */</span>
<a name="l00372"></a>00372          <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#acd0eb566ce3a46e17cb6823b46a671e4">newduration</a>) {    <span class="comment">/* This is a signal, signalUpdate follows */</span>
<a name="l00373"></a>00373             f.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a9b350360a64b55c7590f1ec03db480be">AST_FRAME_DTMF_BEGIN</a>;
<a name="l00374"></a>00374             <a class="code" href="sched_8h.html#a25647782014f8dc012994efcd1b81d32" title="a loop construct to ensure that the scheduled task get deleted. The idea is that...">AST_SCHED_DEL</a>(<a class="code" href="structsched.html">sched</a>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a065b36acb6c0d5185e203b227f257b9c">DTMFsched</a>);
<a name="l00375"></a>00375             pvt-&gt;<a class="code" href="structoh323__pvt.html#a065b36acb6c0d5185e203b227f257b9c">DTMFsched</a> = <a class="code" href="sched_8h.html#a97176531282ac4e70aa107b2e8ee5543" title="Adds a scheduled event Schedule an event to take place at some point in the future...">ast_sched_add</a>(<a class="code" href="structsched.html">sched</a>, pvt-&gt;<a class="code" href="structoh323__pvt.html#acd0eb566ce3a46e17cb6823b46a671e4">newduration</a>, <a class="code" href="chan__h323_8c.html#aa0bf2b42c059abf332e545b0f481df33">oh323_simulate_dtmf_end</a>, pvt);
<a name="l00376"></a>00376             <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l00377"></a>00377                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#af360dd5e7b67cff6cb747d1aa2ac3db8">LOG_DTMF</a>, <span class="stringliteral">&quot;Scheduled DTMF END simulation for %d ms, id=%d\n&quot;</span>, pvt-&gt;<a class="code" href="structoh323__pvt.html#acd0eb566ce3a46e17cb6823b46a671e4">newduration</a>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a065b36acb6c0d5185e203b227f257b9c">DTMFsched</a>);
<a name="l00378"></a>00378          }
<a name="l00379"></a>00379          pvt-&gt;<a class="code" href="structoh323__pvt.html#af9a8bf05d4868eff107cd3b34689a5bb">curDTMF</a> = pvt-&gt;<a class="code" href="structoh323__pvt.html#a8972b94b384117570fef447df6504fde">newdigit</a>;
<a name="l00380"></a>00380       }
<a name="l00381"></a>00381       <a class="code" href="channel_8h.html#a6cbcba5661d55216968cde8fdf913c89" title="Queue one or more frames to a channel&amp;#39;s frame queue.">ast_queue_frame</a>(c, &amp;f);
<a name="l00382"></a>00382       pvt-&gt;<a class="code" href="structoh323__pvt.html#a8972b94b384117570fef447df6504fde">newdigit</a> = -1;
<a name="l00383"></a>00383    }
<a name="l00384"></a>00384    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#aa66a6c29649ba7a43eccbcc71f223c3c">update_rtp_info</a> &gt; 0) {
<a name="l00385"></a>00385       <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>) {
<a name="l00386"></a>00386          <a class="code" href="abstract__jb_8h.html#a0981c84ac90dd79bc2a0fdd90aa6efba" title="Configures a jitterbuffer on a channel.">ast_jb_configure</a>(c, &amp;<a class="code" href="chan__h323_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">global_jbconf</a>);
<a name="l00387"></a>00387          <a class="code" href="channel_8h.html#aca37ca2f3d55a223d26617329ed48a3e">ast_channel_set_fd</a>(c, 0, <a class="code" href="rtp_8h.html#a9a990d85fb0aac29bda48777f0f86108">ast_rtp_fd</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>));
<a name="l00388"></a>00388          <a class="code" href="channel_8h.html#aca37ca2f3d55a223d26617329ed48a3e">ast_channel_set_fd</a>(c, 1, <a class="code" href="rtp_8h.html#ac3e115dfd0bfe82479060b55dd41601f">ast_rtcp_fd</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>));
<a name="l00389"></a>00389          <a class="code" href="channel_8h.html#a6cbcba5661d55216968cde8fdf913c89" title="Queue one or more frames to a channel&amp;#39;s frame queue.">ast_queue_frame</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>);   <span class="comment">/* Tell Asterisk to apply changes */</span>
<a name="l00390"></a>00390       }
<a name="l00391"></a>00391       pvt-&gt;<a class="code" href="structoh323__pvt.html#aa66a6c29649ba7a43eccbcc71f223c3c">update_rtp_info</a> = -1;
<a name="l00392"></a>00392    }
<a name="l00393"></a>00393 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a09e087de558c65717f6db4e73198c443"></a><!-- doxytag: member="chan_h323.c::answer_call" ref="a09e087de558c65717f6db4e73198c443" args="(unsigned call_reference, const char *token)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int answer_call </td>
          <td>(</td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>call_reference</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>token</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Call-back function to start PBX when OpenH323 ready to serve incoming call. </p>
<p>Returns 1 on success </p>

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l02220">2220</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="chan__h323_8c_source.html#l00999">__oh323_new()</a>, <a class="el" href="causes_8h_source.html#l00097">AST_CAUSE_UNALLOCATED</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="pbx_8c_source.html#l04143">ast_exists_extension()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="channel_8h_source.html#l00364">AST_STATE_RINGING</a>, <a class="el" href="chan__h323_8c_source.html#l00156">oh323_pvt::cd</a>, <a class="el" href="chan__h323_8c_source.html#l00163">oh323_pvt::context</a>, <a class="el" href="chan__h323_8c_source.html#l00162">oh323_pvt::exten</a>, <a class="el" href="chan__h323_8c_source.html#l01144">find_call_locked()</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, and <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l03222">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02221"></a>02221 {
<a name="l02222"></a>02222    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *pvt;
<a name="l02223"></a>02223    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c = NULL;
<a name="l02224"></a>02224    <span class="keyword">enum</span> {ext_original, ext_s, ext_i, ext_notexists} try_exten;
<a name="l02225"></a>02225    <span class="keywordtype">char</span> tmp_exten[<span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>)];
<a name="l02226"></a>02226 
<a name="l02227"></a>02227    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l02228"></a>02228       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Preparing Asterisk to answer for %s\n&quot;</span>, token);
<a name="l02229"></a>02229 
<a name="l02230"></a>02230    <span class="comment">/* Find the call or allocate a private structure if call not found */</span>
<a name="l02231"></a>02231    pvt = <a class="code" href="chan__h323_8c.html#a246fb1df8539e4f168a9bc8233ef76b9">find_call_locked</a>(call_reference, token);
<a name="l02232"></a>02232    <span class="keywordflow">if</span> (!pvt) {
<a name="l02233"></a>02233       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Something is wrong: answer_call\n&quot;</span>);
<a name="l02234"></a>02234       <span class="keywordflow">return</span> 0;
<a name="l02235"></a>02235    }
<a name="l02236"></a>02236    <span class="comment">/* Check if requested extension@context pair exists in the dialplan */</span>
<a name="l02237"></a>02237    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp_exten, pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>, <span class="keyword">sizeof</span>(tmp_exten));
<a name="l02238"></a>02238 
<a name="l02239"></a>02239    <span class="comment">/* Try to find best extension in specified context */</span>
<a name="l02240"></a>02240    <span class="keywordflow">if</span> ((tmp_exten[0] != <span class="charliteral">&apos;\0&apos;</span>) &amp;&amp; (tmp_exten[1] == <span class="charliteral">&apos;\0&apos;</span>)) {
<a name="l02241"></a>02241       <span class="keywordflow">if</span> (tmp_exten[0] == <span class="charliteral">&apos;s&apos;</span>)
<a name="l02242"></a>02242          try_exten = ext_s;
<a name="l02243"></a>02243       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tmp_exten[0] == <span class="charliteral">&apos;i&apos;</span>)
<a name="l02244"></a>02244          try_exten = ext_i;
<a name="l02245"></a>02245       <span class="keywordflow">else</span>
<a name="l02246"></a>02246          try_exten = ext_original;
<a name="l02247"></a>02247    } <span class="keywordflow">else</span>
<a name="l02248"></a>02248       try_exten = ext_original;
<a name="l02249"></a>02249    <span class="keywordflow">do</span> {
<a name="l02250"></a>02250       <span class="keywordflow">if</span> (<a class="code" href="pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7" title="Determine whether an extension exists.">ast_exists_extension</a>(NULL, pvt-&gt;<a class="code" href="structoh323__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, tmp_exten, 1, NULL))
<a name="l02251"></a>02251          <span class="keywordflow">break</span>;
<a name="l02252"></a>02252       <span class="keywordflow">switch</span> (try_exten) {
<a name="l02253"></a>02253       <span class="keywordflow">case</span> ext_original:
<a name="l02254"></a>02254          tmp_exten[0] = <span class="charliteral">&apos;s&apos;</span>;
<a name="l02255"></a>02255          tmp_exten[1] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l02256"></a>02256          try_exten = ext_s;
<a name="l02257"></a>02257          <span class="keywordflow">break</span>;
<a name="l02258"></a>02258       <span class="keywordflow">case</span> ext_s:
<a name="l02259"></a>02259          tmp_exten[0] = <span class="charliteral">&apos;i&apos;</span>;
<a name="l02260"></a>02260          try_exten = ext_i;
<a name="l02261"></a>02261          <span class="keywordflow">break</span>;
<a name="l02262"></a>02262       <span class="keywordflow">case</span> ext_i:
<a name="l02263"></a>02263          try_exten = ext_notexists;
<a name="l02264"></a>02264          <span class="keywordflow">break</span>;
<a name="l02265"></a>02265       <span class="keywordflow">default</span>:
<a name="l02266"></a>02266          <span class="keywordflow">break</span>;
<a name="l02267"></a>02267       }
<a name="l02268"></a>02268    } <span class="keywordflow">while</span> (try_exten != ext_notexists);
<a name="l02269"></a>02269 
<a name="l02270"></a>02270    <span class="comment">/* Drop the call if we don&apos;t have &lt;exten&gt;, s and i extensions */</span>
<a name="l02271"></a>02271    <span class="keywordflow">if</span> (try_exten == ext_notexists) {
<a name="l02272"></a>02272       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Dropping call because extensions &apos;%s&apos;, &apos;s&apos; and &apos;i&apos; doesn&apos;t exists in context [%s]\n&quot;</span>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>, pvt-&gt;<a class="code" href="structoh323__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>);
<a name="l02273"></a>02273       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l02274"></a>02274       h323_clear_call(token, <a class="code" href="causes_8h.html#a131d8780af378d0c4ef5075949902785">AST_CAUSE_UNALLOCATED</a>);
<a name="l02275"></a>02275       <span class="keywordflow">return</span> 0;
<a name="l02276"></a>02276    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((try_exten != ext_original) &amp;&amp; (strcmp(pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>, tmp_exten) != 0)) {
<a name="l02277"></a>02277       <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l02278"></a>02278          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Going to extension %s@%s because %s@%s isn&apos;t exists\n&quot;</span>, tmp_exten, pvt-&gt;<a class="code" href="structoh323__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>, pvt-&gt;<a class="code" href="structoh323__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>);
<a name="l02279"></a>02279       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>, tmp_exten, <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>));
<a name="l02280"></a>02280    }
<a name="l02281"></a>02281 
<a name="l02282"></a>02282    <span class="comment">/* allocate a channel and tell asterisk about it */</span>
<a name="l02283"></a>02283    c = <a class="code" href="chan__h323_8c.html#ab9a955a886712c23ff59fb68d2a59f9a" title="Private structure should be locked on a call.">__oh323_new</a>(pvt, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.call_token);
<a name="l02284"></a>02284 
<a name="l02285"></a>02285    <span class="comment">/* And release when done */</span>
<a name="l02286"></a>02286    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l02287"></a>02287    <span class="keywordflow">if</span> (!c) {
<a name="l02288"></a>02288       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Couldn&apos;t create channel. This is bad\n&quot;</span>);
<a name="l02289"></a>02289       <span class="keywordflow">return</span> 0;
<a name="l02290"></a>02290    }
<a name="l02291"></a>02291    <span class="keywordflow">return</span> 1;
<a name="l02292"></a>02292 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a19bc21e9b8625e16582554b2dfb9e6c4"></a><!-- doxytag: member="chan_h323.c::AST_MODULE_INFO" ref="a19bc21e9b8625e16582554b2dfb9e6c4" args="(ASTERISK_GPL_KEY, AST_MODFLAG_DEFAULT,&quot;The NuFone Network's OpenH323 Channel Driver&quot;,.load=load_module,.unload=unload_module,.reload=reload,)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AST_MODULE_INFO </td>
          <td>(</td>
          <td class="paramtype">ASTERISK_GPL_KEY&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">AST_MODFLAG_DEFAULT&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;The NuFone Network's OpenH323 Channel Driver&quot;&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">.&nbsp;</td>
          <td class="paramname"> <em>load</em> = <code>load_module</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">.&nbsp;</td>
          <td class="paramname"> <em>unload</em> = <code>unload_module</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">.&nbsp;</td>
          <td class="paramname"> <em>reload</em> = <code>reload</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a39aacd48203e50527e7cca8767c92da8"></a><!-- doxytag: member="chan_h323.c::AST_MUTEX_DEFINE_STATIC" ref="a39aacd48203e50527e7cca8767c92da8" args="(h323_reload_lock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AST_MUTEX_DEFINE_STATIC </td>
          <td>(</td>
          <td class="paramtype">h323_reload_lock&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Protect the reload process. </p>

</div>
</div>
<a class="anchor" id="a054d3e99cff3274423888d494bcac929"></a><!-- doxytag: member="chan_h323.c::AST_MUTEX_DEFINE_STATIC" ref="a054d3e99cff3274423888d494bcac929" args="(caplock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AST_MUTEX_DEFINE_STATIC </td>
          <td>(</td>
          <td class="paramtype">caplock&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Protect the H.323 capabilities list, to avoid more than one channel to set the capabilities simultaneaously in the h323 stack. </p>

</div>
</div>
<a class="anchor" id="a381db14ebde360ab4092e0c7ab18579d"></a><!-- doxytag: member="chan_h323.c::AST_MUTEX_DEFINE_STATIC" ref="a381db14ebde360ab4092e0c7ab18579d" args="(monlock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AST_MUTEX_DEFINE_STATIC </td>
          <td>(</td>
          <td class="paramtype">monlock&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Protect the H.323 monitoring thread, so only one process can kill or start it, and not when it's doing something critical. </p>

</div>
</div>
<a class="anchor" id="a8a540d6c5362c0966c0c929270f046b7"></a><!-- doxytag: member="chan_h323.c::AST_MUTEX_DEFINE_STATIC" ref="a8a540d6c5362c0966c0c929270f046b7" args="(iflock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AST_MUTEX_DEFINE_STATIC </td>
          <td>(</td>
          <td class="paramtype">iflock&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Protect the interface list (<a class="el" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a>) </p>

</div>
</div>
<a class="anchor" id="a7c5637b8e64dc84dacbd47037572f99e"></a><!-- doxytag: member="chan_h323.c::build_alias" ref="a7c5637b8e64dc84dacbd47037572f99e" args="(const char *name, struct ast_variable *v, struct ast_variable *alt, int realtime)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct oh323_alias* build_alias </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__variable.html">ast_variable</a> *&nbsp;</td>
          <td class="paramname"> <em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__variable.html">ast_variable</a> *&nbsp;</td>
          <td class="paramname"> <em>alt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>realtime</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l01191">1191</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="chan__h323_8c.html#a2029bed642f94cb8e3299209b084e585">aliasl</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="astobj_8h_source.html#l00551">ASTOBJ_CONTAINER_FIND_UNLINK_FULL</a>, <a class="el" href="astobj_8h_source.html#l00264">ASTOBJ_INIT</a>, <a class="el" href="astobj_8h_source.html#l00251">ASTOBJ_UNMARK</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="config_8h_source.html#l00075">ast_variable::name</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, and <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l01226">realtime_alias()</a>, and <a class="el" href="chan__h323_8c_source.html#l02832">reload_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01192"></a>01192 {
<a name="l01193"></a>01193    <span class="keyword">struct </span>oh323_alias *alias;
<a name="l01194"></a>01194    <span class="keywordtype">int</span> found = 0;
<a name="l01195"></a>01195 
<a name="l01196"></a>01196    alias = <a class="code" href="astobj_8h.html#a6c76bfbc9e80b029038df1805f824446" title="Find and remove an object in a container.">ASTOBJ_CONTAINER_FIND_UNLINK_FULL</a>(&amp;<a class="code" href="chan__h323_8c.html#a2029bed642f94cb8e3299209b084e585" title="H323 alias list.">aliasl</a>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, 0, 0, strcasecmp);
<a name="l01197"></a>01197 
<a name="l01198"></a>01198    <span class="keywordflow">if</span> (alias)
<a name="l01199"></a>01199       found++;
<a name="l01200"></a>01200    <span class="keywordflow">else</span> {
<a name="l01201"></a>01201       <span class="keywordflow">if</span> (!(alias = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*alias))))
<a name="l01202"></a>01202          <span class="keywordflow">return</span> NULL;
<a name="l01203"></a>01203       <a class="code" href="astobj_8h.html#a996db3d193843755068f61f21e14c3dd" title="Initialize an object.">ASTOBJ_INIT</a>(alias);
<a name="l01204"></a>01204    }
<a name="l01205"></a>01205    <span class="keywordflow">if</span> (!found &amp;&amp; <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>)
<a name="l01206"></a>01206       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(alias-&gt;name, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keyword">sizeof</span>(alias-&gt;name));
<a name="l01207"></a>01207    <span class="keywordflow">for</span> (; v || ((v = alt) &amp;&amp; !(alt = NULL)); v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l01208"></a>01208       <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;e164&quot;</span>)) {
<a name="l01209"></a>01209          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(alias-&gt;e164, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(alias-&gt;e164));
<a name="l01210"></a>01210       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;prefix&quot;</span>)) {
<a name="l01211"></a>01211          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(alias-&gt;prefix, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(alias-&gt;prefix));
<a name="l01212"></a>01212       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;context&quot;</span>)) {
<a name="l01213"></a>01213          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(alias-&gt;context, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(alias-&gt;context));
<a name="l01214"></a>01214       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;secret&quot;</span>)) {
<a name="l01215"></a>01215          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(alias-&gt;secret, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(alias-&gt;secret));
<a name="l01216"></a>01216       } <span class="keywordflow">else</span> {
<a name="l01217"></a>01217          <span class="keywordflow">if</span> (strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;h323&quot;</span>)) {
<a name="l01218"></a>01218             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Keyword %s does not make sense in type=h323\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);
<a name="l01219"></a>01219          }
<a name="l01220"></a>01220       }
<a name="l01221"></a>01221    }
<a name="l01222"></a>01222    <a class="code" href="astobj_8h.html#a789fc1432f54cb615e839f0db9decad5" title="Unmark an ASTOBJ by subtracting the ASTOBJ_FLAG_MARKED flag from its objflags mask...">ASTOBJ_UNMARK</a>(alias);
<a name="l01223"></a>01223    <span class="keywordflow">return</span> alias;
<a name="l01224"></a>01224 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a53c07cbdf5928cad397e68d05d64c0cf"></a><!-- doxytag: member="chan_h323.c::build_peer" ref="a53c07cbdf5928cad397e68d05d64c0cf" args="(const char *name, struct ast_variable *v, struct ast_variable *alt, int realtime)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct oh323_peer* build_peer </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__variable.html">ast_variable</a> *&nbsp;</td>
          <td class="paramname"> <em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__variable.html">ast_variable</a> *&nbsp;</td>
          <td class="paramname"> <em>alt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>realtime</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l01478">1478</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="acl_8c_source.html#l00272">ast_append_ha()</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="acl_8c_source.html#l00217">ast_free_ha()</a>, <a class="el" href="acl_8c_source.html#l00476">ast_get_ip()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="utils_8c_source.html#l01311">ast_true()</a>, <a class="el" href="config_8c_source.html#l00397">ast_variables_destroy()</a>, <a class="el" href="astobj_8h_source.html#l00551">ASTOBJ_CONTAINER_FIND_UNLINK_FULL</a>, <a class="el" href="astobj_8h_source.html#l00264">ASTOBJ_INIT</a>, <a class="el" href="astobj_8h_source.html#l00251">ASTOBJ_UNMARK</a>, <a class="el" href="astobj_8h_source.html#l00218">ASTOBJ_UNREF</a>, <a class="el" href="config_8h_source.html#l00081">ast_variable::lineno</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="config_8h_source.html#l00075">ast_variable::name</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="chan__h323_8c_source.html#l00294">oh323_destroy_peer()</a>, <a class="el" href="chan__h323_8c.html#a73d22ff9770f2c94dac6e92c3eddea5f">peerl</a>, <a class="el" href="chan__h323_8c_source.html#l01251">update_common_options()</a>, and <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l01554">realtime_peer()</a>, and <a class="el" href="chan__h323_8c_source.html#l02832">reload_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01479"></a>01479 {
<a name="l01480"></a>01480    <span class="keyword">struct </span>oh323_peer *peer;
<a name="l01481"></a>01481    <span class="keyword">struct </span><a class="code" href="structast__ha.html" title="internal representation of acl entries In principle user applications would have...">ast_ha</a> *oldha;
<a name="l01482"></a>01482    <span class="keywordtype">int</span> found = 0;
<a name="l01483"></a>01483 
<a name="l01484"></a>01484    peer = <a class="code" href="astobj_8h.html#a6c76bfbc9e80b029038df1805f824446" title="Find and remove an object in a container.">ASTOBJ_CONTAINER_FIND_UNLINK_FULL</a>(&amp;<a class="code" href="chan__h323_8c.html#a73d22ff9770f2c94dac6e92c3eddea5f" title="H323 peer list.">peerl</a>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, 0, 0, strcmp);
<a name="l01485"></a>01485 
<a name="l01486"></a>01486    <span class="keywordflow">if</span> (peer)
<a name="l01487"></a>01487       found++;
<a name="l01488"></a>01488    <span class="keywordflow">else</span> {
<a name="l01489"></a>01489       <span class="keywordflow">if</span> (!(peer = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*peer))))
<a name="l01490"></a>01490          <span class="keywordflow">return</span> NULL;
<a name="l01491"></a>01491       <a class="code" href="astobj_8h.html#a996db3d193843755068f61f21e14c3dd" title="Initialize an object.">ASTOBJ_INIT</a>(peer);
<a name="l01492"></a>01492    }
<a name="l01493"></a>01493    oldha = peer-&gt;ha;
<a name="l01494"></a>01494    peer-&gt;ha = NULL;
<a name="l01495"></a>01495    memcpy(&amp;peer-&gt;options, &amp;<a class="code" href="chan__h323_8c.html#ab2aace2a2c551db5a7ce9ccadc159b72">global_options</a>, <span class="keyword">sizeof</span>(peer-&gt;options));
<a name="l01496"></a>01496    peer-&gt;options.dtmfmode = 0;
<a name="l01497"></a>01497    peer-&gt;options.holdHandling = 0;
<a name="l01498"></a>01498    peer-&gt;addr.sin_port = htons(<a class="code" href="chan__h323_8c.html#a7f366397aeb2f3ce05c337d8a8b32a09">h323_signalling_port</a>);
<a name="l01499"></a>01499    peer-&gt;addr.sin_family = AF_INET;
<a name="l01500"></a>01500    <span class="keywordflow">if</span> (!found &amp;&amp; <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>)
<a name="l01501"></a>01501       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(peer-&gt;name, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keyword">sizeof</span>(peer-&gt;name));
<a name="l01502"></a>01502 
<a name="l01503"></a>01503 <span class="preprocessor">#if 0 </span><span class="comment">/* XXX Port channel variables functionality from chan_sip XXX */</span>
<a name="l01504"></a>01504    <span class="keywordflow">if</span> (peer-&gt;chanvars) {
<a name="l01505"></a>01505       <a class="code" href="config_8h.html#ad3d8122172af6f13687a07840411d65d" title="Free variable list.">ast_variables_destroy</a>(peer-&gt;chanvars);
<a name="l01506"></a>01506       peer-&gt;chanvars = NULL;
<a name="l01507"></a>01507    }
<a name="l01508"></a>01508 <span class="preprocessor">#endif</span>
<a name="l01509"></a>01509 <span class="preprocessor"></span>   <span class="comment">/* Default settings for mailbox */</span>
<a name="l01510"></a>01510    peer-&gt;mailbox[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01511"></a>01511 
<a name="l01512"></a>01512    <span class="keywordflow">for</span> (; v || ((v = alt) &amp;&amp; !(alt = NULL)); v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l01513"></a>01513       <span class="keywordflow">if</span> (!<a class="code" href="chan__h323_8c.html#a7203b2d801c8bd449671f862cf6b2b24">update_common_options</a>(v, &amp;peer-&gt;options))
<a name="l01514"></a>01514          <span class="keywordflow">continue</span>;
<a name="l01515"></a>01515       <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;host&quot;</span>)) {
<a name="l01516"></a>01516          <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;dynamic&quot;</span>)) {
<a name="l01517"></a>01517             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Dynamic host configuration not implemented.\n&quot;</span>);
<a name="l01518"></a>01518             <a class="code" href="astobj_8h.html#aed02826b481ce75ec710c1184ac8f059" title="Decrement the reference count on an object.">ASTOBJ_UNREF</a>(peer, <a class="code" href="chan__h323_8c.html#ad2fe7bc6fcd60293a92f883ff5d03fc0">oh323_destroy_peer</a>);
<a name="l01519"></a>01519             <span class="keywordflow">return</span> NULL;
<a name="l01520"></a>01520          }
<a name="l01521"></a>01521          <span class="keywordflow">if</span> (<a class="code" href="acl_8h.html#af04bd435c082da93aec0cb6e0782788a">ast_get_ip</a>(&amp;peer-&gt;addr, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>)) {
<a name="l01522"></a>01522             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not determine IP for %s\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01523"></a>01523             <a class="code" href="astobj_8h.html#aed02826b481ce75ec710c1184ac8f059" title="Decrement the reference count on an object.">ASTOBJ_UNREF</a>(peer, <a class="code" href="chan__h323_8c.html#ad2fe7bc6fcd60293a92f883ff5d03fc0">oh323_destroy_peer</a>);
<a name="l01524"></a>01524             <span class="keywordflow">return</span> NULL;
<a name="l01525"></a>01525          }
<a name="l01526"></a>01526       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;port&quot;</span>)) {
<a name="l01527"></a>01527          peer-&gt;addr.sin_port = htons(atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>));
<a name="l01528"></a>01528       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;permit&quot;</span>) ||
<a name="l01529"></a>01529                !strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;deny&quot;</span>)) {
<a name="l01530"></a>01530          <span class="keywordtype">int</span> ha_error = 0;
<a name="l01531"></a>01531 
<a name="l01532"></a>01532          peer-&gt;ha = <a class="code" href="acl_8h.html#ae839a9c2465be4e9a560dda668a65b9b" title="Append ACL entry to host access list.">ast_append_ha</a>(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, peer-&gt;ha, &amp;ha_error);
<a name="l01533"></a>01533          <span class="keywordflow">if</span> (ha_error)
<a name="l01534"></a>01534             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Bad ACL entry in configuration line %d : %s\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01535"></a>01535       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;mailbox&quot;</span>)) {
<a name="l01536"></a>01536          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(peer-&gt;mailbox, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(peer-&gt;mailbox));
<a name="l01537"></a>01537       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;hasvoicemail&quot;</span>)) {
<a name="l01538"></a>01538          <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>) &amp;&amp; <a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(peer-&gt;mailbox)) {
<a name="l01539"></a>01539             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(peer-&gt;mailbox, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keyword">sizeof</span>(peer-&gt;mailbox));
<a name="l01540"></a>01540          }
<a name="l01541"></a>01541       }
<a name="l01542"></a>01542    }
<a name="l01543"></a>01543    <span class="keywordflow">if</span> (!peer-&gt;options.dtmfmode)
<a name="l01544"></a>01544       peer-&gt;options.dtmfmode = <a class="code" href="chan__h323_8c.html#ab2aace2a2c551db5a7ce9ccadc159b72">global_options</a>.dtmfmode;
<a name="l01545"></a>01545    <span class="keywordflow">if</span> (peer-&gt;options.holdHandling == ~0)
<a name="l01546"></a>01546       peer-&gt;options.holdHandling = 0;
<a name="l01547"></a>01547    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!peer-&gt;options.holdHandling)
<a name="l01548"></a>01548       peer-&gt;options.holdHandling = <a class="code" href="chan__h323_8c.html#ab2aace2a2c551db5a7ce9ccadc159b72">global_options</a>.holdHandling;
<a name="l01549"></a>01549    <a class="code" href="astobj_8h.html#a789fc1432f54cb615e839f0db9decad5" title="Unmark an ASTOBJ by subtracting the ASTOBJ_FLAG_MARKED flag from its objflags mask...">ASTOBJ_UNMARK</a>(peer);
<a name="l01550"></a>01550    <a class="code" href="acl_8h.html#a45dc427430b544afc0ef8e898b2c57bf" title="Free host access list.">ast_free_ha</a>(oldha);
<a name="l01551"></a>01551    <span class="keywordflow">return</span> peer;
<a name="l01552"></a>01552 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af5ea8aafcd4cedda80e628ca32386fe8"></a><!-- doxytag: member="chan_h323.c::build_user" ref="af5ea8aafcd4cedda80e628ca32386fe8" args="(const char *name, struct ast_variable *v, struct ast_variable *alt, int realtime)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct oh323_user* build_user </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__variable.html">ast_variable</a> *&nbsp;</td>
          <td class="paramname"> <em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__variable.html">ast_variable</a> *&nbsp;</td>
          <td class="paramname"> <em>alt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>realtime</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l01360">1360</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="acl_8c_source.html#l00272">ast_append_ha()</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="cdr_8c_source.html#l01016">ast_cdr_amaflags2int()</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="acl_8c_source.html#l00217">ast_free_ha()</a>, <a class="el" href="acl_8c_source.html#l00476">ast_get_ip()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="config_8c_source.html#l00397">ast_variables_destroy()</a>, <a class="el" href="astobj_8h_source.html#l00551">ASTOBJ_CONTAINER_FIND_UNLINK_FULL</a>, <a class="el" href="astobj_8h_source.html#l00264">ASTOBJ_INIT</a>, <a class="el" href="astobj_8h_source.html#l00251">ASTOBJ_UNMARK</a>, <a class="el" href="astobj_8h_source.html#l00218">ASTOBJ_UNREF</a>, <a class="el" href="cdr__custom_8c_source.html#l00058">format</a>, <a class="el" href="config_8h_source.html#l00081">ast_variable::lineno</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="config_8h_source.html#l00075">ast_variable::name</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="chan__h323_8c_source.html#l00286">oh323_destroy_user()</a>, <a class="el" href="chan__h323_8c_source.html#l01251">update_common_options()</a>, <a class="el" href="chan__h323_8c.html#ab8937033f3230cb7adfe1e86d2055a5e">userl</a>, and <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l01440">realtime_user()</a>, and <a class="el" href="chan__h323_8c_source.html#l02832">reload_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01361"></a>01361 {
<a name="l01362"></a>01362    <span class="keyword">struct </span>oh323_user *<a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a>;
<a name="l01363"></a>01363    <span class="keyword">struct </span><a class="code" href="structast__ha.html" title="internal representation of acl entries In principle user applications would have...">ast_ha</a> *oldha;
<a name="l01364"></a>01364    <span class="keywordtype">int</span> found = 0;
<a name="l01365"></a>01365    <span class="keywordtype">int</span> <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>;
<a name="l01366"></a>01366 
<a name="l01367"></a>01367    user = <a class="code" href="astobj_8h.html#a6c76bfbc9e80b029038df1805f824446" title="Find and remove an object in a container.">ASTOBJ_CONTAINER_FIND_UNLINK_FULL</a>(&amp;<a class="code" href="chan__h323_8c.html#ab8937033f3230cb7adfe1e86d2055a5e" title="H323 User list.">userl</a>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, 0, 0, strcmp);
<a name="l01368"></a>01368 
<a name="l01369"></a>01369    <span class="keywordflow">if</span> (user)
<a name="l01370"></a>01370       found++;
<a name="l01371"></a>01371    <span class="keywordflow">else</span> {
<a name="l01372"></a>01372       <span class="keywordflow">if</span> (!(user = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*user))))
<a name="l01373"></a>01373          <span class="keywordflow">return</span> NULL;
<a name="l01374"></a>01374       <a class="code" href="astobj_8h.html#a996db3d193843755068f61f21e14c3dd" title="Initialize an object.">ASTOBJ_INIT</a>(user);
<a name="l01375"></a>01375    }
<a name="l01376"></a>01376    oldha = user-&gt;ha;
<a name="l01377"></a>01377    user-&gt;ha = (<span class="keyword">struct </span><a class="code" href="structast__ha.html" title="internal representation of acl entries In principle user applications would have...">ast_ha</a> *)NULL;
<a name="l01378"></a>01378    memcpy(&amp;user-&gt;options, &amp;<a class="code" href="chan__h323_8c.html#ab2aace2a2c551db5a7ce9ccadc159b72">global_options</a>, <span class="keyword">sizeof</span>(user-&gt;options));
<a name="l01379"></a>01379    user-&gt;options.dtmfmode = 0;
<a name="l01380"></a>01380    user-&gt;options.holdHandling = 0;
<a name="l01381"></a>01381    <span class="comment">/* Set default context */</span>
<a name="l01382"></a>01382    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(user-&gt;context, <a class="code" href="chan__h323_8c.html#a7dc6cff9d51743005af0fcf0c37251ad">default_context</a>, <span class="keyword">sizeof</span>(user-&gt;context));
<a name="l01383"></a>01383    <span class="keywordflow">if</span> (user &amp;&amp; !found)
<a name="l01384"></a>01384       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(user-&gt;name, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keyword">sizeof</span>(user-&gt;name));
<a name="l01385"></a>01385 
<a name="l01386"></a>01386 <span class="preprocessor">#if 0 </span><span class="comment">/* XXX Port channel variables functionality from chan_sip XXX */</span>
<a name="l01387"></a>01387    <span class="keywordflow">if</span> (user-&gt;chanvars) {
<a name="l01388"></a>01388       <a class="code" href="config_8h.html#ad3d8122172af6f13687a07840411d65d" title="Free variable list.">ast_variables_destroy</a>(user-&gt;chanvars);
<a name="l01389"></a>01389       user-&gt;chanvars = NULL;
<a name="l01390"></a>01390    }
<a name="l01391"></a>01391 <span class="preprocessor">#endif</span>
<a name="l01392"></a>01392 <span class="preprocessor"></span>
<a name="l01393"></a>01393    <span class="keywordflow">for</span> (; v || ((v = alt) &amp;&amp; !(alt = NULL)); v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l01394"></a>01394       <span class="keywordflow">if</span> (!<a class="code" href="chan__h323_8c.html#a7203b2d801c8bd449671f862cf6b2b24">update_common_options</a>(v, &amp;user-&gt;options))
<a name="l01395"></a>01395          <span class="keywordflow">continue</span>;
<a name="l01396"></a>01396       <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;context&quot;</span>)) {
<a name="l01397"></a>01397          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(user-&gt;context, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(user-&gt;context));
<a name="l01398"></a>01398       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;secret&quot;</span>)) {
<a name="l01399"></a>01399          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(user-&gt;secret, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(user-&gt;secret));
<a name="l01400"></a>01400       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;accountcode&quot;</span>)) {
<a name="l01401"></a>01401          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(user-&gt;accountcode, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(user-&gt;accountcode));
<a name="l01402"></a>01402       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;host&quot;</span>)) {
<a name="l01403"></a>01403          <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;dynamic&quot;</span>)) {
<a name="l01404"></a>01404             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;A dynamic host on a type=user does not make any sense\n&quot;</span>);
<a name="l01405"></a>01405             <a class="code" href="astobj_8h.html#aed02826b481ce75ec710c1184ac8f059" title="Decrement the reference count on an object.">ASTOBJ_UNREF</a>(user, <a class="code" href="chan__h323_8c.html#ad2a4b95f164d86a67d96a23c8714157b">oh323_destroy_user</a>);
<a name="l01406"></a>01406             <span class="keywordflow">return</span> NULL;
<a name="l01407"></a>01407          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="acl_8h.html#af04bd435c082da93aec0cb6e0782788a">ast_get_ip</a>(&amp;user-&gt;addr, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>)) {
<a name="l01408"></a>01408             <a class="code" href="astobj_8h.html#aed02826b481ce75ec710c1184ac8f059" title="Decrement the reference count on an object.">ASTOBJ_UNREF</a>(user, <a class="code" href="chan__h323_8c.html#ad2a4b95f164d86a67d96a23c8714157b">oh323_destroy_user</a>);
<a name="l01409"></a>01409             <span class="keywordflow">return</span> NULL;
<a name="l01410"></a>01410          }
<a name="l01411"></a>01411          <span class="comment">/* Let us know we need to use ip authentication */</span>
<a name="l01412"></a>01412          user-&gt;host = 1;
<a name="l01413"></a>01413       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;amaflags&quot;</span>)) {
<a name="l01414"></a>01414          format = <a class="code" href="cdr_8h.html#a5c2d2dee484a1ad9dbef128c11a2b693" title="Convert a string to a detail record AMA flag.">ast_cdr_amaflags2int</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01415"></a>01415          <span class="keywordflow">if</span> (format &lt; 0) {
<a name="l01416"></a>01416             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid AMA Flags: %s at line %d\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l01417"></a>01417          } <span class="keywordflow">else</span> {
<a name="l01418"></a>01418             user-&gt;amaflags = format;
<a name="l01419"></a>01419          }
<a name="l01420"></a>01420       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;permit&quot;</span>) ||
<a name="l01421"></a>01421                !strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;deny&quot;</span>)) {
<a name="l01422"></a>01422          <span class="keywordtype">int</span> ha_error = 0;
<a name="l01423"></a>01423 
<a name="l01424"></a>01424          user-&gt;ha = <a class="code" href="acl_8h.html#ae839a9c2465be4e9a560dda668a65b9b" title="Append ACL entry to host access list.">ast_append_ha</a>(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, user-&gt;ha, &amp;ha_error);
<a name="l01425"></a>01425          <span class="keywordflow">if</span> (ha_error)
<a name="l01426"></a>01426             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Bad ACL entry in configuration line %d : %s\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01427"></a>01427       }
<a name="l01428"></a>01428    }
<a name="l01429"></a>01429    <span class="keywordflow">if</span> (!user-&gt;options.dtmfmode)
<a name="l01430"></a>01430       user-&gt;options.dtmfmode = <a class="code" href="chan__h323_8c.html#ab2aace2a2c551db5a7ce9ccadc159b72">global_options</a>.dtmfmode;
<a name="l01431"></a>01431    <span class="keywordflow">if</span> (user-&gt;options.holdHandling == ~0)
<a name="l01432"></a>01432       user-&gt;options.holdHandling = 0;
<a name="l01433"></a>01433    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!user-&gt;options.holdHandling)
<a name="l01434"></a>01434       user-&gt;options.holdHandling = <a class="code" href="chan__h323_8c.html#ab2aace2a2c551db5a7ce9ccadc159b72">global_options</a>.holdHandling;
<a name="l01435"></a>01435    <a class="code" href="astobj_8h.html#a789fc1432f54cb615e839f0db9decad5" title="Unmark an ASTOBJ by subtracting the ASTOBJ_FLAG_MARKED flag from its objflags mask...">ASTOBJ_UNMARK</a>(user);
<a name="l01436"></a>01436    <a class="code" href="acl_8h.html#a45dc427430b544afc0ef8e898b2c57bf" title="Free host access list.">ast_free_ha</a>(oldha);
<a name="l01437"></a>01437    <span class="keywordflow">return</span> user;
<a name="l01438"></a>01438 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abe8912b97493d1dc19b84f3c3e80984a"></a><!-- doxytag: member="chan_h323.c::chan_ringing" ref="abe8912b97493d1dc19b84f3c3e80984a" args="(unsigned call_reference, const char *token)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void chan_ringing </td>
          <td>(</td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>call_reference</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>token</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Call-back function to signal asterisk that the channel is ringing Returns nothing. </p>

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l02311">2311</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00300">AST_CONTROL_RINGING</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="channel_8h_source.html#l00364">AST_STATE_RINGING</a>, <a class="el" href="chan__h323_8c_source.html#l01144">find_call_locked()</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="chan__h323_8c_source.html#l00157">oh323_pvt::owner</a>, and <a class="el" href="chan__h323_8c_source.html#l01170">update_state()</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l03222">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02312"></a>02312 {
<a name="l02313"></a>02313    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *pvt;
<a name="l02314"></a>02314 
<a name="l02315"></a>02315    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l02316"></a>02316       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Ringing on %s\n&quot;</span>, token);
<a name="l02317"></a>02317 
<a name="l02318"></a>02318    pvt = <a class="code" href="chan__h323_8c.html#a246fb1df8539e4f168a9bc8233ef76b9">find_call_locked</a>(call_reference, token);
<a name="l02319"></a>02319    <span class="keywordflow">if</span> (!pvt) {
<a name="l02320"></a>02320       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Something is wrong: ringing\n&quot;</span>);
<a name="l02321"></a>02321       <span class="keywordflow">return</span>;
<a name="l02322"></a>02322    }
<a name="l02323"></a>02323    <span class="keywordflow">if</span> (!pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l02324"></a>02324       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l02325"></a>02325       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Channel has no owner\n&quot;</span>);
<a name="l02326"></a>02326       <span class="keywordflow">return</span>;
<a name="l02327"></a>02327    }
<a name="l02328"></a>02328    <a class="code" href="chan__h323_8c.html#a88ea396aa3c9c270ced6ca203c8ad5ba">update_state</a>(pvt, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a>);
<a name="l02329"></a>02329    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l02330"></a>02330    <span class="keywordflow">return</span>;
<a name="l02331"></a>02331 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9c8ed7310ecb320faec26082515f4cbc"></a><!-- doxytag: member="chan_h323.c::cleanup_call_details" ref="a9c8ed7310ecb320faec26082515f4cbc" args="(call_details_t *cd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void cleanup_call_details </td>
          <td>(</td>
          <td class="paramtype">call_details_t *&nbsp;</td>
          <td class="paramname"> <em>cd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00407">407</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l00443">__oh323_destroy()</a>, <a class="el" href="chan__h323_8c_source.html#l02337">cleanup_connection()</a>, <a class="el" href="chan__h323_8c_source.html#l02100">setup_incoming_call()</a>, and <a class="el" href="chan__h323_8c_source.html#l02299">setup_outgoing_call()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00408"></a>00408 {
<a name="l00409"></a>00409    <span class="keywordflow">if</span> (<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>-&gt;call_token) {
<a name="l00410"></a>00410       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>-&gt;call_token);
<a name="l00411"></a>00411       <a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>-&gt;call_token = NULL;
<a name="l00412"></a>00412    }
<a name="l00413"></a>00413    <span class="keywordflow">if</span> (<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>-&gt;call_source_aliases) {
<a name="l00414"></a>00414       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>-&gt;call_source_aliases);
<a name="l00415"></a>00415       <a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>-&gt;call_source_aliases = NULL;
<a name="l00416"></a>00416    }
<a name="l00417"></a>00417    <span class="keywordflow">if</span> (<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>-&gt;call_dest_alias) {
<a name="l00418"></a>00418       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>-&gt;call_dest_alias);
<a name="l00419"></a>00419       <a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>-&gt;call_dest_alias = NULL;
<a name="l00420"></a>00420    }
<a name="l00421"></a>00421    <span class="keywordflow">if</span> (<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>-&gt;call_source_name) {
<a name="l00422"></a>00422       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>-&gt;call_source_name);
<a name="l00423"></a>00423       <a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>-&gt;call_source_name = NULL;
<a name="l00424"></a>00424    }
<a name="l00425"></a>00425    <span class="keywordflow">if</span> (<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>-&gt;call_source_e164) {
<a name="l00426"></a>00426       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>-&gt;call_source_e164);
<a name="l00427"></a>00427       <a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>-&gt;call_source_e164 = NULL;
<a name="l00428"></a>00428    }
<a name="l00429"></a>00429    <span class="keywordflow">if</span> (<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>-&gt;call_dest_e164) {
<a name="l00430"></a>00430       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>-&gt;call_dest_e164);
<a name="l00431"></a>00431       <a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>-&gt;call_dest_e164 = NULL;
<a name="l00432"></a>00432    }
<a name="l00433"></a>00433    <span class="keywordflow">if</span> (<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>-&gt;sourceIp) {
<a name="l00434"></a>00434       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>-&gt;sourceIp);
<a name="l00435"></a>00435       <a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>-&gt;sourceIp = NULL;
<a name="l00436"></a>00436    }
<a name="l00437"></a>00437    <span class="keywordflow">if</span> (<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>-&gt;redirect_number) {
<a name="l00438"></a>00438       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>-&gt;redirect_number);
<a name="l00439"></a>00439       <a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>-&gt;redirect_number = NULL;
<a name="l00440"></a>00440    }
<a name="l00441"></a>00441 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a672902ed001137f6a99cfeece800ce9f"></a><!-- doxytag: member="chan_h323.c::cleanup_connection" ref="a672902ed001137f6a99cfeece800ce9f" args="(unsigned call_reference, const char *call_token)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void cleanup_connection </td>
          <td>(</td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>call_reference</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>call_token</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Call-back function to cleanup communication Returns nothing,. </p>

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l02337">2337</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00462">ast_channel::_softhangup</a>, <a class="el" href="chan__h323_8c_source.html#l00154">oh323_pvt::alreadygone</a>, <a class="el" href="lock_8h_source.html#l02037">ast_channel_trylock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="dsp_8c_source.html#l01545">ast_dsp_free()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="channel_8c_source.html#l01091">ast_queue_hangup()</a>, <a class="el" href="rtp_8c_source.html#l03058">ast_rtp_destroy()</a>, <a class="el" href="channel_8h_source.html#l00633">AST_SOFTHANGUP_DEV</a>, <a class="el" href="chan__h323_8c_source.html#l00156">oh323_pvt::cd</a>, <a class="el" href="chan__h323_8c_source.html#l00407">cleanup_call_details()</a>, <a class="el" href="chan__h323_8c_source.html#l01144">find_call_locked()</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="chan__h323_8c_source.html#l00157">oh323_pvt::owner</a>, <a class="el" href="chan__h323_8c_source.html#l00167">oh323_pvt::rtp</a>, and <a class="el" href="chan__h323_8c_source.html#l00168">oh323_pvt::vad</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l03222">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02338"></a>02338 {
<a name="l02339"></a>02339    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *pvt;
<a name="l02340"></a>02340 
<a name="l02341"></a>02341    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l02342"></a>02342       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Cleaning connection to %s\n&quot;</span>, call_token);
<a name="l02343"></a>02343 
<a name="l02344"></a>02344    <span class="keywordflow">while</span> (1) {
<a name="l02345"></a>02345       pvt = <a class="code" href="chan__h323_8c.html#a246fb1df8539e4f168a9bc8233ef76b9">find_call_locked</a>(call_reference, call_token);
<a name="l02346"></a>02346       <span class="keywordflow">if</span> (!pvt) {
<a name="l02347"></a>02347          <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l02348"></a>02348             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;No connection for %s\n&quot;</span>, call_token);
<a name="l02349"></a>02349          <span class="keywordflow">return</span>;
<a name="l02350"></a>02350       }
<a name="l02351"></a>02351       <span class="keywordflow">if</span> (!pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> || !<a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>))
<a name="l02352"></a>02352          <span class="keywordflow">break</span>;
<a name="l02353"></a>02353 <span class="preprocessor">#if 1</span>
<a name="l02354"></a>02354 <span class="preprocessor"></span>      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Avoiding H.323 destory deadlock on %s\n&quot;</span>, call_token);
<a name="l02355"></a>02355 <span class="preprocessor">#ifdef DEBUG_THREADS</span>
<a name="l02356"></a>02356 <span class="preprocessor"></span>      <span class="comment">/* XXX to be completed</span>
<a name="l02357"></a>02357 <span class="comment">       * If we want to print more info on who is holding the lock,</span>
<a name="l02358"></a>02358 <span class="comment">       * implement the relevant code in lock.h and use the routines</span>
<a name="l02359"></a>02359 <span class="comment">       * supplied there.</span>
<a name="l02360"></a>02360 <span class="comment">       */</span>
<a name="l02361"></a>02361 <span class="preprocessor">#endif</span>
<a name="l02362"></a>02362 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l02363"></a>02363 <span class="preprocessor"></span>      <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l02364"></a>02364       usleep(1);
<a name="l02365"></a>02365    }
<a name="l02366"></a>02366    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>) {
<a name="l02367"></a>02367       <span class="comment">/* Immediately stop RTP */</span>
<a name="l02368"></a>02368       <a class="code" href="rtp_8h.html#a6d2addabf879eb321a660932e3bd57eb">ast_rtp_destroy</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>);
<a name="l02369"></a>02369       pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a> = NULL;
<a name="l02370"></a>02370    }
<a name="l02371"></a>02371    <span class="comment">/* Free dsp used for in-band DTMF detection */</span>
<a name="l02372"></a>02372    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#aa62a1382425913a43d6111e71b9fa019">vad</a>) {
<a name="l02373"></a>02373       <a class="code" href="dsp_8h.html#a0a57a1e374549eb2705068688f4046db">ast_dsp_free</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aa62a1382425913a43d6111e71b9fa019">vad</a>);
<a name="l02374"></a>02374       pvt-&gt;<a class="code" href="structoh323__pvt.html#aa62a1382425913a43d6111e71b9fa019">vad</a> = NULL;
<a name="l02375"></a>02375    }
<a name="l02376"></a>02376    <a class="code" href="chan__h323_8c.html#a9c8ed7310ecb320faec26082515f4cbc">cleanup_call_details</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>);
<a name="l02377"></a>02377    pvt-&gt;<a class="code" href="structoh323__pvt.html#ac43993a73742eff145b861107a1afa0d">alreadygone</a> = 1;
<a name="l02378"></a>02378    <span class="comment">/* Send hangup */</span>
<a name="l02379"></a>02379    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l02380"></a>02380       pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> |= <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709a2e185ce313026e13ed90ae3a319c9cb7">AST_SOFTHANGUP_DEV</a>;
<a name="l02381"></a>02381       <a class="code" href="channel_8h.html#a30bcf0418189567bc84ff32034f79f28" title="Queue a hangup frame.">ast_queue_hangup</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l02382"></a>02382       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l02383"></a>02383    }
<a name="l02384"></a>02384    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l02385"></a>02385    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l02386"></a>02386       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Connection to %s cleaned\n&quot;</span>, call_token);
<a name="l02387"></a>02387    <span class="keywordflow">return</span>;
<a name="l02388"></a>02388 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8e5a95844ec0171f79294dad29ed7b28"></a><!-- doxytag: member="chan_h323.c::connection_made" ref="a8e5a95844ec0171f79294dad29ed7b28" args="(unsigned call_reference, const char *token)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void connection_made </td>
          <td>(</td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>call_reference</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>token</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Call-back function to signal asterisk that the channel has been answered Returns nothing. </p>

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l02045">2045</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00301">AST_CONTROL_ANSWER</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="chan__h323_8c_source.html#l00187">oh323_pvt::connection_established</a>, <a class="el" href="chan__h323_8c_source.html#l01144">find_call_locked()</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="chan__h323_8c_source.html#l00161">oh323_pvt::outgoing</a>, and <a class="el" href="chan__h323_8c_source.html#l01170">update_state()</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l03222">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02046"></a>02046 {
<a name="l02047"></a>02047    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *pvt;
<a name="l02048"></a>02048 
<a name="l02049"></a>02049    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l02050"></a>02050       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Call %s answered\n&quot;</span>, token);
<a name="l02051"></a>02051 
<a name="l02052"></a>02052    pvt = <a class="code" href="chan__h323_8c.html#a246fb1df8539e4f168a9bc8233ef76b9">find_call_locked</a>(call_reference, token);
<a name="l02053"></a>02053    <span class="keywordflow">if</span> (!pvt) {
<a name="l02054"></a>02054       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Something is wrong: connection\n&quot;</span>);
<a name="l02055"></a>02055       <span class="keywordflow">return</span>;
<a name="l02056"></a>02056    }
<a name="l02057"></a>02057 
<a name="l02058"></a>02058    <span class="comment">/* Inform asterisk about remote party connected only on outgoing calls */</span>
<a name="l02059"></a>02059    <span class="keywordflow">if</span> (!pvt-&gt;<a class="code" href="structoh323__pvt.html#a586fc7c710ade15aabab8f223e53fdd9">outgoing</a>) {
<a name="l02060"></a>02060       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l02061"></a>02061       <span class="keywordflow">return</span>;
<a name="l02062"></a>02062    }
<a name="l02063"></a>02063    <span class="comment">/* Do not send ANSWER message more than once */</span>
<a name="l02064"></a>02064    <span class="keywordflow">if</span> (!pvt-&gt;<a class="code" href="structoh323__pvt.html#a3544e86fafa51dee81097307e81d8b42">connection_established</a>) {
<a name="l02065"></a>02065       pvt-&gt;<a class="code" href="structoh323__pvt.html#a3544e86fafa51dee81097307e81d8b42">connection_established</a> = 1;
<a name="l02066"></a>02066       <a class="code" href="chan__h323_8c.html#a88ea396aa3c9c270ced6ca203c8ad5ba">update_state</a>(pvt, -1, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>);
<a name="l02067"></a>02067    }
<a name="l02068"></a>02068    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l02069"></a>02069    <span class="keywordflow">return</span>;
<a name="l02070"></a>02070 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab7daa2cddc7e391558f8074656aa2b6f"></a><!-- doxytag: member="chan_h323.c::convertcap" ref="ab7daa2cddc7e391558f8074656aa2b6f" args="(int cap)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* convertcap </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cap</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l03162">3162</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00251">AST_FORMAT_ADPCM</a>, <a class="el" href="frame_8h_source.html#l00247">AST_FORMAT_ALAW</a>, <a class="el" href="frame_8h_source.html#l00265">AST_FORMAT_G722</a>, <a class="el" href="frame_8h_source.html#l00241">AST_FORMAT_G723_1</a>, <a class="el" href="frame_8h_source.html#l00257">AST_FORMAT_G729A</a>, <a class="el" href="frame_8h_source.html#l00243">AST_FORMAT_GSM</a>, <a class="el" href="frame_8h_source.html#l00261">AST_FORMAT_ILBC</a>, <a class="el" href="frame_8h_source.html#l00259">AST_FORMAT_SPEEX</a>, <a class="el" href="frame_8h_source.html#l00245">AST_FORMAT_ULAW</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, and <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l03189">oh323_set_rtp_peer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03163"></a>03163 {
<a name="l03164"></a>03164    <span class="keywordflow">switch</span> (cap) {
<a name="l03165"></a>03165    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ad90b56ed6ada6e4f13224512668e20fb">AST_FORMAT_G723_1</a>:
<a name="l03166"></a>03166       <span class="keywordflow">return</span> <span class="stringliteral">&quot;G.723&quot;</span>;
<a name="l03167"></a>03167    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a85106ada66147a674b36f0a55297d29d">AST_FORMAT_GSM</a>:
<a name="l03168"></a>03168       <span class="keywordflow">return</span> <span class="stringliteral">&quot;GSM&quot;</span>;
<a name="l03169"></a>03169    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ab602cf455d4a96a3adba2e3ba8cd2b2c">AST_FORMAT_ULAW</a>:
<a name="l03170"></a>03170       <span class="keywordflow">return</span> <span class="stringliteral">&quot;ULAW&quot;</span>;
<a name="l03171"></a>03171    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aa58cc980a9c9108522effc64e9aff2d6">AST_FORMAT_ALAW</a>:
<a name="l03172"></a>03172       <span class="keywordflow">return</span> <span class="stringliteral">&quot;ALAW&quot;</span>;
<a name="l03173"></a>03173    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a4a0e8720928940d26abf28fff2e6586d">AST_FORMAT_G722</a>:
<a name="l03174"></a>03174       <span class="keywordflow">return</span> <span class="stringliteral">&quot;G.722&quot;</span>;
<a name="l03175"></a>03175    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a933964fc376c2642f9471c176fb7ae7d">AST_FORMAT_ADPCM</a>:
<a name="l03176"></a>03176       <span class="keywordflow">return</span> <span class="stringliteral">&quot;G.728&quot;</span>;
<a name="l03177"></a>03177    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a8c5f13161448f613baaf42dea11f520a">AST_FORMAT_G729A</a>:
<a name="l03178"></a>03178       <span class="keywordflow">return</span> <span class="stringliteral">&quot;G.729&quot;</span>;
<a name="l03179"></a>03179    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a1a05dee116bf73c0f1ca8410bdb48c62">AST_FORMAT_SPEEX</a>:
<a name="l03180"></a>03180       <span class="keywordflow">return</span> <span class="stringliteral">&quot;SPEEX&quot;</span>;
<a name="l03181"></a>03181    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a8330d06ea408802c37e9af61a513c6a1">AST_FORMAT_ILBC</a>:
<a name="l03182"></a>03182       <span class="keywordflow">return</span> <span class="stringliteral">&quot;ILBC&quot;</span>;
<a name="l03183"></a>03183    <span class="keywordflow">default</span>:
<a name="l03184"></a>03184       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Don&apos;t know how to deal with mode %d\n&quot;</span>, cap);
<a name="l03185"></a>03185       <span class="keywordflow">return</span> NULL;
<a name="l03186"></a>03186    }
<a name="l03187"></a>03187 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aff6ea052d0552e2899a61b2eaad9ca7e"></a><!-- doxytag: member="chan_h323.c::create_addr" ref="aff6ea052d0552e2899a61b2eaad9ca7e" args="(struct oh323_pvt *pvt, char *opeer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int create_addr </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structoh323__pvt.html">oh323_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>pvt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>opeer</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l01650">1650</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="utils_8c_source.html#l00182">ast_gethostbyname()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="rtp_8h_source.html#l00043">AST_RTP_DTMF</a>, <a class="el" href="astobj_8h_source.html#l00218">ASTOBJ_UNREF</a>, <a class="el" href="chan__h323_8c_source.html#l01632">find_peer()</a>, <a class="el" href="chan__skinny_8c_source.html#l00982">hp</a>, <a class="el" href="chan__h323_8c_source.html#l00178">oh323_pvt::jointcapability</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__h323_8c_source.html#l00160">oh323_pvt::nonCodecCapability</a>, <a class="el" href="chan__h323_8c_source.html#l00294">oh323_destroy_peer()</a>, <a class="el" href="chan__h323_8c_source.html#l00153">oh323_pvt::options</a>, and <a class="el" href="chan__h323_8c_source.html#l00158">oh323_pvt::sa</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l01722">oh323_request()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01651"></a>01651 {
<a name="l01652"></a>01652    <span class="keyword">struct </span>hostent *<a class="code" href="chan__skinny_8c.html#aa0f575fa3882aa394cc287edba645a35">hp</a>;
<a name="l01653"></a>01653    <span class="keyword">struct </span><a class="code" href="structast__hostent.html">ast_hostent</a> <a class="code" href="chan__skinny_8c.html#a9e435aef83f14da6d3d5ec44f821558e">ahp</a>;
<a name="l01654"></a>01654    <span class="keyword">struct </span>oh323_peer *p;
<a name="l01655"></a>01655    <span class="keywordtype">int</span> portno;
<a name="l01656"></a>01656    <span class="keywordtype">int</span> found = 0;
<a name="l01657"></a>01657    <span class="keywordtype">char</span> *port;
<a name="l01658"></a>01658    <span class="keywordtype">char</span> *hostn;
<a name="l01659"></a>01659    <span class="keywordtype">char</span> peer[256] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01660"></a>01660 
<a name="l01661"></a>01661    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(peer, opeer, <span class="keyword">sizeof</span>(peer));
<a name="l01662"></a>01662    port = strchr(peer, <span class="charliteral">&apos;:&apos;</span>);
<a name="l01663"></a>01663    <span class="keywordflow">if</span> (port) {
<a name="l01664"></a>01664       *port = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01665"></a>01665       port++;
<a name="l01666"></a>01666    }
<a name="l01667"></a>01667    pvt-&gt;<a class="code" href="structoh323__pvt.html#ab559462aaba22bc0245c6ce056c36981">sa</a>.sin_family = AF_INET;
<a name="l01668"></a>01668    p = <a class="code" href="chan__h323_8c.html#a26ef35cbfee0292c459f1b67d2bd718f">find_peer</a>(peer, NULL, 1);
<a name="l01669"></a>01669    <span class="keywordflow">if</span> (p) {
<a name="l01670"></a>01670       found++;
<a name="l01671"></a>01671       memcpy(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>, &amp;p-&gt;options, <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>));
<a name="l01672"></a>01672       pvt-&gt;<a class="code" href="structoh323__pvt.html#a38f5730c90d9315eb1c0df6cfdc37da6">jointcapability</a> = pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.capability;
<a name="l01673"></a>01673       <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.dtmfmode) {
<a name="l01674"></a>01674          <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.dtmfmode &amp; H323_DTMF_RFC2833) {
<a name="l01675"></a>01675             pvt-&gt;<a class="code" href="structoh323__pvt.html#a08e270ee42ff478a275294762aa0e195">nonCodecCapability</a> |= <a class="code" href="rtp_8h.html#a3cc8001677e3b955b9b5ceb4267a76ec">AST_RTP_DTMF</a>;
<a name="l01676"></a>01676          } <span class="keywordflow">else</span> {
<a name="l01677"></a>01677             pvt-&gt;<a class="code" href="structoh323__pvt.html#a08e270ee42ff478a275294762aa0e195">nonCodecCapability</a> &amp;= ~<a class="code" href="rtp_8h.html#a3cc8001677e3b955b9b5ceb4267a76ec">AST_RTP_DTMF</a>;
<a name="l01678"></a>01678          }
<a name="l01679"></a>01679       }
<a name="l01680"></a>01680       <span class="keywordflow">if</span> (p-&gt;addr.sin_addr.s_addr) {
<a name="l01681"></a>01681          pvt-&gt;<a class="code" href="structoh323__pvt.html#ab559462aaba22bc0245c6ce056c36981">sa</a>.sin_addr = p-&gt;addr.sin_addr;
<a name="l01682"></a>01682          pvt-&gt;<a class="code" href="structoh323__pvt.html#ab559462aaba22bc0245c6ce056c36981">sa</a>.sin_port = p-&gt;addr.sin_port;
<a name="l01683"></a>01683       }
<a name="l01684"></a>01684       <a class="code" href="astobj_8h.html#aed02826b481ce75ec710c1184ac8f059" title="Decrement the reference count on an object.">ASTOBJ_UNREF</a>(p, <a class="code" href="chan__h323_8c.html#ad2fe7bc6fcd60293a92f883ff5d03fc0">oh323_destroy_peer</a>);
<a name="l01685"></a>01685    }
<a name="l01686"></a>01686    <span class="keywordflow">if</span> (!p &amp;&amp; !found) {
<a name="l01687"></a>01687       hostn = peer;
<a name="l01688"></a>01688       <span class="keywordflow">if</span> (port) {
<a name="l01689"></a>01689          portno = atoi(port);
<a name="l01690"></a>01690       } <span class="keywordflow">else</span> {
<a name="l01691"></a>01691          portno = <a class="code" href="chan__h323_8c.html#a7f366397aeb2f3ce05c337d8a8b32a09">h323_signalling_port</a>;
<a name="l01692"></a>01692       }
<a name="l01693"></a>01693       hp = <a class="code" href="utils_8h.html#ad3b63ee1041593219ef0765b28d70442" title="Thread-safe gethostbyname function to use in Asterisk.">ast_gethostbyname</a>(hostn, &amp;<a class="code" href="chan__skinny_8c.html#a9e435aef83f14da6d3d5ec44f821558e">ahp</a>);
<a name="l01694"></a>01694       <span class="keywordflow">if</span> (hp) {
<a name="l01695"></a>01695          memcpy(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#ab559462aaba22bc0245c6ce056c36981">sa</a>.sin_addr, hp-&gt;h_addr, <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="structoh323__pvt.html#ab559462aaba22bc0245c6ce056c36981">sa</a>.sin_addr));
<a name="l01696"></a>01696          pvt-&gt;<a class="code" href="structoh323__pvt.html#ab559462aaba22bc0245c6ce056c36981">sa</a>.sin_port = htons(portno);
<a name="l01697"></a>01697          <span class="comment">/* Look peer by address */</span>
<a name="l01698"></a>01698          p = <a class="code" href="chan__h323_8c.html#a26ef35cbfee0292c459f1b67d2bd718f">find_peer</a>(NULL, &amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#ab559462aaba22bc0245c6ce056c36981">sa</a>, 1);
<a name="l01699"></a>01699          memcpy(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>, (p ? &amp;p-&gt;options : &amp;<a class="code" href="chan__h323_8c.html#ab2aace2a2c551db5a7ce9ccadc159b72">global_options</a>), <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>));
<a name="l01700"></a>01700          pvt-&gt;<a class="code" href="structoh323__pvt.html#a38f5730c90d9315eb1c0df6cfdc37da6">jointcapability</a> = pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.capability;
<a name="l01701"></a>01701          <span class="keywordflow">if</span> (p) {
<a name="l01702"></a>01702             <a class="code" href="astobj_8h.html#aed02826b481ce75ec710c1184ac8f059" title="Decrement the reference count on an object.">ASTOBJ_UNREF</a>(p, <a class="code" href="chan__h323_8c.html#ad2fe7bc6fcd60293a92f883ff5d03fc0">oh323_destroy_peer</a>);
<a name="l01703"></a>01703          }
<a name="l01704"></a>01704          <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.dtmfmode) {
<a name="l01705"></a>01705             <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.dtmfmode &amp; H323_DTMF_RFC2833) {
<a name="l01706"></a>01706                pvt-&gt;<a class="code" href="structoh323__pvt.html#a08e270ee42ff478a275294762aa0e195">nonCodecCapability</a> |= <a class="code" href="rtp_8h.html#a3cc8001677e3b955b9b5ceb4267a76ec">AST_RTP_DTMF</a>;
<a name="l01707"></a>01707             } <span class="keywordflow">else</span> {
<a name="l01708"></a>01708                pvt-&gt;<a class="code" href="structoh323__pvt.html#a08e270ee42ff478a275294762aa0e195">nonCodecCapability</a> &amp;= ~<a class="code" href="rtp_8h.html#a3cc8001677e3b955b9b5ceb4267a76ec">AST_RTP_DTMF</a>;
<a name="l01709"></a>01709             }
<a name="l01710"></a>01710          }
<a name="l01711"></a>01711          <span class="keywordflow">return</span> 0;
<a name="l01712"></a>01712       } <span class="keywordflow">else</span> {
<a name="l01713"></a>01713          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No such host: %s\n&quot;</span>, peer);
<a name="l01714"></a>01714          <span class="keywordflow">return</span> -1;
<a name="l01715"></a>01715       }
<a name="l01716"></a>01716    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!found) {
<a name="l01717"></a>01717       <span class="keywordflow">return</span> -1;
<a name="l01718"></a>01718    } <span class="keywordflow">else</span> {
<a name="l01719"></a>01719       <span class="keywordflow">return</span> 0;
<a name="l01720"></a>01720    }
<a name="l01721"></a>01721 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa77a93372791bbbc3a75fc5f18b92b0d"></a><!-- doxytag: member="chan_h323.c::delete_aliases" ref="aa77a93372791bbbc3a75fc5f18b92b0d" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void delete_aliases </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l02808">2808</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="chan__h323_8c.html#a2029bed642f94cb8e3299209b084e585">aliasl</a>, <a class="el" href="astobj_8h_source.html#l00651">ASTOBJ_CONTAINER_PRUNE_MARKED</a>, <a class="el" href="astobj_8h_source.html#l00376">ASTOBJ_CONTAINER_TRAVERSE</a>, <a class="el" href="astobj_8h_source.html#l00283">ASTOBJ_CONTAINER_UNLOCK</a>, <a class="el" href="astobj_8h_source.html#l00280">ASTOBJ_CONTAINER_WRLOCK</a>, <a class="el" href="astobj_8h_source.html#l00241">ASTOBJ_MARK</a>, <a class="el" href="astobj_8h_source.html#l00100">ASTOBJ_RDLOCK</a>, <a class="el" href="astobj_8h_source.html#l00109">ASTOBJ_UNLOCK</a>, and <a class="el" href="chan__h323_8c_source.html#l00279">oh323_destroy_alias()</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l02832">reload_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02809"></a>02809 {
<a name="l02810"></a>02810    <span class="keywordtype">int</span> pruned = 0;
<a name="l02811"></a>02811 
<a name="l02812"></a>02812    <span class="comment">/* Delete all aliases */</span>
<a name="l02813"></a>02813    <a class="code" href="astobj_8h.html#afd5426b59fc40457028874afefbf2220" title="Lock an ASTOBJ_CONTAINER for writing.">ASTOBJ_CONTAINER_WRLOCK</a>(&amp;<a class="code" href="chan__h323_8c.html#a2029bed642f94cb8e3299209b084e585" title="H323 alias list.">aliasl</a>);
<a name="l02814"></a>02814    <a class="code" href="astobj_8h.html#a8483cbd2bcf0b91ac62168fb1cb7f5b1" title="Iterate through the objects in a container.">ASTOBJ_CONTAINER_TRAVERSE</a>(&amp;<a class="code" href="chan__h323_8c.html#a2029bed642f94cb8e3299209b084e585" title="H323 alias list.">aliasl</a>, 1, <span class="keywordflow">do</span> {
<a name="l02815"></a>02815       <a class="code" href="astobj_8h.html#a8d411cc142b0b49472fe38cf7b0845e1" title="Lock an ASTOBJ for reading.">ASTOBJ_RDLOCK</a>(iterator);
<a name="l02816"></a>02816       <a class="code" href="astobj_8h.html#ad51464686c5c2948bd337f8bb2c483b7" title="Mark an ASTOBJ by adding the ASTOBJ_FLAG_MARKED flag to its objflags mask.">ASTOBJ_MARK</a>(iterator);
<a name="l02817"></a>02817       ++pruned;
<a name="l02818"></a>02818       <a class="code" href="astobj_8h.html#a9acee27cc52e8533d439f6cc10d11fbc" title="Unlock a locked object.">ASTOBJ_UNLOCK</a>(iterator);
<a name="l02819"></a>02819    } <span class="keywordflow">while</span> (0) );
<a name="l02820"></a>02820    <span class="keywordflow">if</span> (pruned) {
<a name="l02821"></a>02821       <a class="code" href="astobj_8h.html#a794727ca4ef71982250ff9f36a9668d7" title="Prune marked objects from a container.">ASTOBJ_CONTAINER_PRUNE_MARKED</a>(&amp;<a class="code" href="chan__h323_8c.html#a2029bed642f94cb8e3299209b084e585" title="H323 alias list.">aliasl</a>, <a class="code" href="chan__h323_8c.html#a9ebae4396be42baf2785e593f5fede69">oh323_destroy_alias</a>);
<a name="l02822"></a>02822    }
<a name="l02823"></a>02823    <a class="code" href="astobj_8h.html#aa427859308cff6f8153760f7f67e5e30" title="Unlock an ASTOBJ_CONTAINER.">ASTOBJ_CONTAINER_UNLOCK</a>(&amp;<a class="code" href="chan__h323_8c.html#a2029bed642f94cb8e3299209b084e585" title="H323 alias list.">aliasl</a>);
<a name="l02824"></a>02824 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ace322a3e8008af8b872b72770e97fa85"></a><!-- doxytag: member="chan_h323.c::delete_users" ref="ace322a3e8008af8b872b72770e97fa85" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void delete_users </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l02782">2782</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="astobj_8h_source.html#l00651">ASTOBJ_CONTAINER_PRUNE_MARKED</a>, <a class="el" href="astobj_8h_source.html#l00376">ASTOBJ_CONTAINER_TRAVERSE</a>, <a class="el" href="astobj_8h_source.html#l00283">ASTOBJ_CONTAINER_UNLOCK</a>, <a class="el" href="astobj_8h_source.html#l00280">ASTOBJ_CONTAINER_WRLOCK</a>, <a class="el" href="astobj_8h_source.html#l00241">ASTOBJ_MARK</a>, <a class="el" href="astobj_8h_source.html#l00100">ASTOBJ_RDLOCK</a>, <a class="el" href="astobj_8h_source.html#l00109">ASTOBJ_UNLOCK</a>, <a class="el" href="chan__h323_8c_source.html#l00286">oh323_destroy_user()</a>, <a class="el" href="chan__h323_8c.html#a73d22ff9770f2c94dac6e92c3eddea5f">peerl</a>, and <a class="el" href="chan__h323_8c.html#ab8937033f3230cb7adfe1e86d2055a5e">userl</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l02832">reload_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02783"></a>02783 {
<a name="l02784"></a>02784    <span class="keywordtype">int</span> pruned = 0;
<a name="l02785"></a>02785 
<a name="l02786"></a>02786    <span class="comment">/* Delete all users */</span>
<a name="l02787"></a>02787    <a class="code" href="astobj_8h.html#afd5426b59fc40457028874afefbf2220" title="Lock an ASTOBJ_CONTAINER for writing.">ASTOBJ_CONTAINER_WRLOCK</a>(&amp;<a class="code" href="chan__h323_8c.html#ab8937033f3230cb7adfe1e86d2055a5e" title="H323 User list.">userl</a>);
<a name="l02788"></a>02788    <a class="code" href="astobj_8h.html#a8483cbd2bcf0b91ac62168fb1cb7f5b1" title="Iterate through the objects in a container.">ASTOBJ_CONTAINER_TRAVERSE</a>(&amp;<a class="code" href="chan__h323_8c.html#ab8937033f3230cb7adfe1e86d2055a5e" title="H323 User list.">userl</a>, 1, <span class="keywordflow">do</span> {
<a name="l02789"></a>02789       <a class="code" href="astobj_8h.html#a8d411cc142b0b49472fe38cf7b0845e1" title="Lock an ASTOBJ for reading.">ASTOBJ_RDLOCK</a>(iterator);
<a name="l02790"></a>02790       <a class="code" href="astobj_8h.html#ad51464686c5c2948bd337f8bb2c483b7" title="Mark an ASTOBJ by adding the ASTOBJ_FLAG_MARKED flag to its objflags mask.">ASTOBJ_MARK</a>(iterator);
<a name="l02791"></a>02791       ++pruned;
<a name="l02792"></a>02792       <a class="code" href="astobj_8h.html#a9acee27cc52e8533d439f6cc10d11fbc" title="Unlock a locked object.">ASTOBJ_UNLOCK</a>(iterator);
<a name="l02793"></a>02793    } <span class="keywordflow">while</span> (0) );
<a name="l02794"></a>02794    <span class="keywordflow">if</span> (pruned) {
<a name="l02795"></a>02795       <a class="code" href="astobj_8h.html#a794727ca4ef71982250ff9f36a9668d7" title="Prune marked objects from a container.">ASTOBJ_CONTAINER_PRUNE_MARKED</a>(&amp;<a class="code" href="chan__h323_8c.html#ab8937033f3230cb7adfe1e86d2055a5e" title="H323 User list.">userl</a>, <a class="code" href="chan__h323_8c.html#ad2a4b95f164d86a67d96a23c8714157b">oh323_destroy_user</a>);
<a name="l02796"></a>02796    }
<a name="l02797"></a>02797    <a class="code" href="astobj_8h.html#aa427859308cff6f8153760f7f67e5e30" title="Unlock an ASTOBJ_CONTAINER.">ASTOBJ_CONTAINER_UNLOCK</a>(&amp;<a class="code" href="chan__h323_8c.html#ab8937033f3230cb7adfe1e86d2055a5e" title="H323 User list.">userl</a>);
<a name="l02798"></a>02798 
<a name="l02799"></a>02799    <a class="code" href="astobj_8h.html#afd5426b59fc40457028874afefbf2220" title="Lock an ASTOBJ_CONTAINER for writing.">ASTOBJ_CONTAINER_WRLOCK</a>(&amp;<a class="code" href="chan__h323_8c.html#a73d22ff9770f2c94dac6e92c3eddea5f" title="H323 peer list.">peerl</a>);
<a name="l02800"></a>02800    <a class="code" href="astobj_8h.html#a8483cbd2bcf0b91ac62168fb1cb7f5b1" title="Iterate through the objects in a container.">ASTOBJ_CONTAINER_TRAVERSE</a>(&amp;<a class="code" href="chan__h323_8c.html#a73d22ff9770f2c94dac6e92c3eddea5f" title="H323 peer list.">peerl</a>, 1, <span class="keywordflow">do</span> {
<a name="l02801"></a>02801       <a class="code" href="astobj_8h.html#a8d411cc142b0b49472fe38cf7b0845e1" title="Lock an ASTOBJ for reading.">ASTOBJ_RDLOCK</a>(iterator);
<a name="l02802"></a>02802       <a class="code" href="astobj_8h.html#ad51464686c5c2948bd337f8bb2c483b7" title="Mark an ASTOBJ by adding the ASTOBJ_FLAG_MARKED flag to its objflags mask.">ASTOBJ_MARK</a>(iterator);
<a name="l02803"></a>02803       <a class="code" href="astobj_8h.html#a9acee27cc52e8533d439f6cc10d11fbc" title="Unlock a locked object.">ASTOBJ_UNLOCK</a>(iterator);
<a name="l02804"></a>02804    } <span class="keywordflow">while</span> (0) );
<a name="l02805"></a>02805    <a class="code" href="astobj_8h.html#aa427859308cff6f8153760f7f67e5e30" title="Unlock an ASTOBJ_CONTAINER.">ASTOBJ_CONTAINER_UNLOCK</a>(&amp;<a class="code" href="chan__h323_8c.html#a73d22ff9770f2c94dac6e92c3eddea5f" title="H323 peer list.">peerl</a>);
<a name="l02806"></a>02806 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a02d8db6086b4a18353b82ebcad631ff6"></a><!-- doxytag: member="chan_h323.c::do_monitor" ref="a02d8db6086b4a18353b82ebcad631ff6" args="(void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void* do_monitor </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l02529">2529</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="chan__h323_8c_source.html#l00443">__oh323_destroy()</a>, <a class="el" href="io_8c_source.html#l00269">ast_io_wait()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01722">ast_mutex_trylock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="sched_8c_source.html#l00581">ast_sched_runq()</a>, <a class="el" href="sched_8c_source.html#l00327">ast_sched_wait()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="chan__h323_8c_source.html#l03119">h323_do_reload()</a>, <a class="el" href="chan__h323_8c.html#af2608cb80e01a744400057785fd1660e">iflist</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, <a class="el" href="chan__h323_8c_source.html#l00155">oh323_pvt::needdestroy</a>, and <a class="el" href="chan__h323_8c_source.html#l00189">oh323_pvt::next</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l02597">restart_monitor()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02530"></a>02530 {
<a name="l02531"></a>02531    <span class="keywordtype">int</span> res;
<a name="l02532"></a>02532    <span class="keywordtype">int</span> reloading;
<a name="l02533"></a>02533    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *oh323 = NULL;
<a name="l02534"></a>02534 
<a name="l02535"></a>02535    <span class="keywordflow">for</span>(;;) {
<a name="l02536"></a>02536       <span class="comment">/* Check for a reload request */</span>
<a name="l02537"></a>02537       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;h323_reload_lock);
<a name="l02538"></a>02538       reloading = <a class="code" href="chan__h323_8c.html#ad60ccb0475ed36e6be2e9914df685d56">h323_reloading</a>;
<a name="l02539"></a>02539       <a class="code" href="chan__h323_8c.html#ad60ccb0475ed36e6be2e9914df685d56">h323_reloading</a> = 0;
<a name="l02540"></a>02540       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;h323_reload_lock);
<a name="l02541"></a>02541       <span class="keywordflow">if</span> (reloading) {
<a name="l02542"></a>02542          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Reloading H.323\n&quot;</span>);
<a name="l02543"></a>02543          <a class="code" href="chan__h323_8c.html#a2b14b06b75b8bbff574be9ab7bfc5957">h323_do_reload</a>();
<a name="l02544"></a>02544       }
<a name="l02545"></a>02545       <span class="comment">/* Check for interfaces needing to be killed */</span>
<a name="l02546"></a>02546       <span class="keywordflow">if</span> (!<a class="code" href="lock_8h.html#a036ccafa2339f674a46bc269bbd48c5f">ast_mutex_trylock</a>(&amp;iflock)) {
<a name="l02547"></a>02547 <span class="preprocessor">#if 1</span>
<a name="l02548"></a>02548 <span class="preprocessor"></span>         <span class="keywordflow">do</span> {
<a name="l02549"></a>02549             <span class="keywordflow">for</span> (oh323 = <a class="code" href="chan__h323_8c.html#af2608cb80e01a744400057785fd1660e" title="Private structure of a OpenH323 channel.">iflist</a>; oh323; oh323 = oh323-&gt;<a class="code" href="structoh323__pvt.html#aa892ef2e174a7308e21e4ab3bf7dfdae">next</a>) {
<a name="l02550"></a>02550                <span class="keywordflow">if</span> (!<a class="code" href="lock_8h.html#a036ccafa2339f674a46bc269bbd48c5f">ast_mutex_trylock</a>(&amp;oh323-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>)) {
<a name="l02551"></a>02551                   <span class="keywordflow">if</span> (oh323-&gt;<a class="code" href="structoh323__pvt.html#a68a26c888924e997c3ce5fdb6273bf7f">needdestroy</a>) {
<a name="l02552"></a>02552                      <a class="code" href="chan__h323_8c.html#abe8a9c722d92f457598ab1be93e780ea">__oh323_destroy</a>(oh323);
<a name="l02553"></a>02553                      <span class="keywordflow">break</span>;
<a name="l02554"></a>02554                   }
<a name="l02555"></a>02555                   <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;oh323-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l02556"></a>02556                }
<a name="l02557"></a>02557             }
<a name="l02558"></a>02558          } <span class="keywordflow">while</span> (<span class="comment">/*oh323*/</span> 0);
<a name="l02559"></a>02559 <span class="preprocessor">#else</span>
<a name="l02560"></a>02560 <span class="preprocessor"></span>restartsearch:
<a name="l02561"></a>02561          oh323 = <a class="code" href="chan__h323_8c.html#af2608cb80e01a744400057785fd1660e" title="Private structure of a OpenH323 channel.">iflist</a>;
<a name="l02562"></a>02562          <span class="keywordflow">while</span>(oh323) {
<a name="l02563"></a>02563             <span class="keywordflow">if</span> (!<a class="code" href="lock_8h.html#a036ccafa2339f674a46bc269bbd48c5f">ast_mutex_trylock</a>(&amp;oh323-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>)) {
<a name="l02564"></a>02564                <span class="keywordflow">if</span> (oh323-&gt;<a class="code" href="structoh323__pvt.html#a68a26c888924e997c3ce5fdb6273bf7f">needdestroy</a>) {
<a name="l02565"></a>02565                   <a class="code" href="chan__h323_8c.html#abe8a9c722d92f457598ab1be93e780ea">__oh323_destroy</a>(oh323);
<a name="l02566"></a>02566                   <span class="keywordflow">goto</span> restartsearch;
<a name="l02567"></a>02567                }
<a name="l02568"></a>02568                <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;oh323-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l02569"></a>02569                oh323 = oh323-&gt;<a class="code" href="structoh323__pvt.html#aa892ef2e174a7308e21e4ab3bf7dfdae">next</a>;
<a name="l02570"></a>02570             }
<a name="l02571"></a>02571          }
<a name="l02572"></a>02572 <span class="preprocessor">#endif</span>
<a name="l02573"></a>02573 <span class="preprocessor"></span>         <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;iflock);
<a name="l02574"></a>02574       } <span class="keywordflow">else</span>
<a name="l02575"></a>02575          oh323 = (<span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *)1;   <span class="comment">/* Force fast loop */</span>
<a name="l02576"></a>02576       pthread_testcancel();
<a name="l02577"></a>02577       <span class="comment">/* Wait for sched or io */</span>
<a name="l02578"></a>02578       res = <a class="code" href="sched_8h.html#a64797d66b6051095debfcdb7f790e605" title="Determines number of seconds until the next outstanding event to take place Determine...">ast_sched_wait</a>(<a class="code" href="structsched.html">sched</a>);
<a name="l02579"></a>02579       <span class="keywordflow">if</span> ((res &lt; 0) || (res &gt; 1000)) {
<a name="l02580"></a>02580          res = 1000;
<a name="l02581"></a>02581       }
<a name="l02582"></a>02582       <span class="comment">/* Do not wait if some channel(s) is destroyed, probably, more available too */</span>
<a name="l02583"></a>02583       <span class="keywordflow">if</span> (oh323)
<a name="l02584"></a>02584          res = 1;
<a name="l02585"></a>02585       res = <a class="code" href="io_8h.html#a6f1abe730a5606b88c8f415f53b784bc" title="Waits for IO.">ast_io_wait</a>(<a class="code" href="chan__h323_8c.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a>, res);
<a name="l02586"></a>02586       pthread_testcancel();
<a name="l02587"></a>02587       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;monlock);
<a name="l02588"></a>02588       <span class="keywordflow">if</span> (res &gt;= 0) {
<a name="l02589"></a>02589          <a class="code" href="sched_8h.html#a2867b39106061847a8508bf49e38f420" title="Runs the queue.">ast_sched_runq</a>(<a class="code" href="structsched.html">sched</a>);
<a name="l02590"></a>02590       }
<a name="l02591"></a>02591       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;monlock);
<a name="l02592"></a>02592    }
<a name="l02593"></a>02593    <span class="comment">/* Never reached */</span>
<a name="l02594"></a>02594    <span class="keywordflow">return</span> NULL;
<a name="l02595"></a>02595 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0943ee4bea659b2877d483853b272c1a"></a><!-- doxytag: member="chan_h323.c::external_rtp_create" ref="a0943ee4bea659b2877d483853b272c1a" args="(unsigned call_reference, const char *token)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct rtp_info* external_rtp_create </td>
          <td>(</td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>call_reference</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>token</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Callback function used to inform the H.323 stack of the local rtp ip/port details. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns the local RTP information </dd></dl>

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l01895">1895</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="chan__h323_8c_source.html#l00951">__oh323_rtp_create()</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="utils_8c_source.html#l00431">ast_inet_ntoa()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="rtp_8c_source.html#l02694">ast_rtp_get_us()</a>, <a class="el" href="chan__h323_8c_source.html#l01144">find_call_locked()</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, and <a class="el" href="chan__h323_8c_source.html#l00167">oh323_pvt::rtp</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l03222">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01896"></a>01896 {
<a name="l01897"></a>01897    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *pvt;
<a name="l01898"></a>01898    <span class="keyword">struct </span>sockaddr_in us;
<a name="l01899"></a>01899    <span class="keyword">struct </span>rtp_info *info;
<a name="l01900"></a>01900 
<a name="l01901"></a>01901    info = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*info));
<a name="l01902"></a>01902    <span class="keywordflow">if</span> (!info) {
<a name="l01903"></a>01903       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to allocated info structure, this is very bad\n&quot;</span>);
<a name="l01904"></a>01904       <span class="keywordflow">return</span> NULL;
<a name="l01905"></a>01905    }
<a name="l01906"></a>01906    pvt = <a class="code" href="chan__h323_8c.html#a246fb1df8539e4f168a9bc8233ef76b9">find_call_locked</a>(call_reference, token);
<a name="l01907"></a>01907    <span class="keywordflow">if</span> (!pvt) {
<a name="l01908"></a>01908       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(info);
<a name="l01909"></a>01909       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to find call %s(%d)\n&quot;</span>, token, call_reference);
<a name="l01910"></a>01910       <span class="keywordflow">return</span> NULL;
<a name="l01911"></a>01911    }
<a name="l01912"></a>01912    <span class="keywordflow">if</span> (!pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>)
<a name="l01913"></a>01913       <a class="code" href="chan__h323_8c.html#a954ed862fccabf74f1b9ea728c97fb3b">__oh323_rtp_create</a>(pvt);
<a name="l01914"></a>01914    <span class="keywordflow">if</span> (!pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>) {
<a name="l01915"></a>01915       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01916"></a>01916       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(info);
<a name="l01917"></a>01917       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No RTP stream is available for call %s (%d)&quot;</span>, token, call_reference);
<a name="l01918"></a>01918       <span class="keywordflow">return</span> NULL;
<a name="l01919"></a>01919    }
<a name="l01920"></a>01920    <span class="comment">/* figure out our local RTP port and tell the H.323 stack about it */</span>
<a name="l01921"></a>01921    <a class="code" href="rtp_8h.html#a307269685e6f067a6abe35a184c3bae6">ast_rtp_get_us</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, &amp;us);
<a name="l01922"></a>01922    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01923"></a>01923 
<a name="l01924"></a>01924    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(info-&gt;addr, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(us.sin_addr), <span class="keyword">sizeof</span>(info-&gt;addr));
<a name="l01925"></a>01925    info-&gt;port = ntohs(us.sin_port);
<a name="l01926"></a>01926    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l01927"></a>01927       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Sending RTP &apos;US&apos; %s:%d\n&quot;</span>, info-&gt;addr, info-&gt;port);
<a name="l01928"></a>01928    <span class="keywordflow">return</span> info;
<a name="l01929"></a>01929 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac2318e0c047a6ba567df7701f64f917b"></a><!-- doxytag: member="chan_h323.c::find_alias" ref="ac2318e0c047a6ba567df7701f64f917b" args="(const char *source_aliases, int realtime)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct oh323_alias* find_alias </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>source_aliases</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>realtime</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find a call by alias. </p>

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l01811">1811</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="chan__h323_8c.html#a2029bed642f94cb8e3299209b084e585">aliasl</a>, <a class="el" href="astobj_8h_source.html#l00401">ASTOBJ_CONTAINER_FIND</a>, and <a class="el" href="chan__h323_8c_source.html#l01226">realtime_alias()</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l02100">setup_incoming_call()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01812"></a>01812 {
<a name="l01813"></a>01813    <span class="keyword">struct </span>oh323_alias *a;
<a name="l01814"></a>01814 
<a name="l01815"></a>01815    a = <a class="code" href="astobj_8h.html#aca5d7206cd0c6817140bba786a9b6b8a" title="Find an object in a container.">ASTOBJ_CONTAINER_FIND</a>(&amp;<a class="code" href="chan__h323_8c.html#a2029bed642f94cb8e3299209b084e585" title="H323 alias list.">aliasl</a>, source_aliases);
<a name="l01816"></a>01816 
<a name="l01817"></a>01817    <span class="keywordflow">if</span> (!a &amp;&amp; realtime)
<a name="l01818"></a>01818       a = <a class="code" href="chan__h323_8c.html#a8bf574965e8d09f6d10407ce9468ff1b">realtime_alias</a>(source_aliases);
<a name="l01819"></a>01819 
<a name="l01820"></a>01820    <span class="keywordflow">return</span> a;
<a name="l01821"></a>01821 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a246fb1df8539e4f168a9bc8233ef76b9"></a><!-- doxytag: member="chan_h323.c::find_call_locked" ref="a246fb1df8539e4f168a9bc8233ef76b9" args="(int call_reference, const char *token)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structoh323__pvt.html">oh323_pvt</a>* find_call_locked </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>call_reference</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>token</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l01144">1144</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="chan__h323_8c_source.html#l00156">oh323_pvt::cd</a>, <a class="el" href="chan__h323_8c.html#af2608cb80e01a744400057785fd1660e">iflist</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__h323_8c_source.html#l00155">oh323_pvt::needdestroy</a>, and <a class="el" href="chan__h323_8c_source.html#l00189">oh323_pvt::next</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l02220">answer_call()</a>, <a class="el" href="chan__h323_8c_source.html#l02311">chan_ringing()</a>, <a class="el" href="chan__h323_8c_source.html#l02337">cleanup_connection()</a>, <a class="el" href="chan__h323_8c_source.html#l02045">connection_made()</a>, <a class="el" href="chan__h323_8c_source.html#l01895">external_rtp_create()</a>, <a class="el" href="chan__h323_8c_source.html#l02390">hangup_connection()</a>, <a class="el" href="chan__h323_8c_source.html#l02072">progress()</a>, <a class="el" href="chan__h323_8c_source.html#l01827">receive_digit()</a>, <a class="el" href="chan__h323_8c_source.html#l02503">remote_hold()</a>, <a class="el" href="chan__h323_8c_source.html#l02418">set_dtmf_payload()</a>, <a class="el" href="chan__h323_8c_source.html#l02473">set_local_capabilities()</a>, <a class="el" href="chan__h323_8c_source.html#l02438">set_peer_capabilities()</a>, and <a class="el" href="chan__h323_8c_source.html#l01936">setup_rtp_connection()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01145"></a>01145 {
<a name="l01146"></a>01146    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *pvt;
<a name="l01147"></a>01147 
<a name="l01148"></a>01148    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;iflock);
<a name="l01149"></a>01149    pvt = <a class="code" href="chan__h323_8c.html#af2608cb80e01a744400057785fd1660e" title="Private structure of a OpenH323 channel.">iflist</a>;
<a name="l01150"></a>01150    <span class="keywordflow">while</span>(pvt) {
<a name="l01151"></a>01151       <span class="keywordflow">if</span> (!pvt-&gt;<a class="code" href="structoh323__pvt.html#a68a26c888924e997c3ce5fdb6273bf7f">needdestroy</a> &amp;&amp; ((<span class="keywordtype">signed</span> <span class="keywordtype">int</span>)pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.call_reference == call_reference)) {
<a name="l01152"></a>01152          <span class="comment">/* Found the call */</span>
<a name="l01153"></a>01153          <span class="keywordflow">if</span> ((token != NULL) &amp;&amp; (pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.call_token != NULL) &amp;&amp; (!strcmp(pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.call_token, token))) {
<a name="l01154"></a>01154             <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01155"></a>01155             <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;iflock);
<a name="l01156"></a>01156             <span class="keywordflow">return</span> pvt;
<a name="l01157"></a>01157          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token == NULL) {
<a name="l01158"></a>01158             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Call Token is NULL\n&quot;</span>);
<a name="l01159"></a>01159             <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01160"></a>01160             <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;iflock);
<a name="l01161"></a>01161             <span class="keywordflow">return</span> pvt;
<a name="l01162"></a>01162          }
<a name="l01163"></a>01163       }
<a name="l01164"></a>01164       pvt = pvt-&gt;<a class="code" href="structoh323__pvt.html#aa892ef2e174a7308e21e4ab3bf7dfdae">next</a>;
<a name="l01165"></a>01165    }
<a name="l01166"></a>01166    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;iflock);
<a name="l01167"></a>01167    <span class="keywordflow">return</span> NULL;
<a name="l01168"></a>01168 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a26ef35cbfee0292c459f1b67d2bd718f"></a><!-- doxytag: member="chan_h323.c::find_peer" ref="a26ef35cbfee0292c459f1b67d2bd718f" args="(const char *peer, struct sockaddr_in *sin, int realtime)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct oh323_peer* find_peer </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>sin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>realtime</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l01632">1632</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="utils_8c_source.html#l00431">ast_inet_ntoa()</a>, <a class="el" href="astobj_8h_source.html#l00401">ASTOBJ_CONTAINER_FIND</a>, <a class="el" href="astobj_8h_source.html#l00428">ASTOBJ_CONTAINER_FIND_FULL</a>, <a class="el" href="chan__h323_8c_source.html#l01620">oh323_addrcmp()</a>, <a class="el" href="chan__h323_8c.html#a73d22ff9770f2c94dac6e92c3eddea5f">peerl</a>, and <a class="el" href="chan__h323_8c_source.html#l01554">realtime_peer()</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l01650">create_addr()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01633"></a>01633 {
<a name="l01634"></a>01634    <span class="keyword">struct </span>oh323_peer *p;
<a name="l01635"></a>01635 
<a name="l01636"></a>01636    <span class="keywordflow">if</span> (peer)
<a name="l01637"></a>01637       p = <a class="code" href="astobj_8h.html#aca5d7206cd0c6817140bba786a9b6b8a" title="Find an object in a container.">ASTOBJ_CONTAINER_FIND</a>(&amp;<a class="code" href="chan__h323_8c.html#a73d22ff9770f2c94dac6e92c3eddea5f" title="H323 peer list.">peerl</a>, peer);
<a name="l01638"></a>01638    <span class="keywordflow">else</span>
<a name="l01639"></a>01639       p = <a class="code" href="astobj_8h.html#a2714c822060df6eec7241ee4b250cc3c" title="Find an object in a container.">ASTOBJ_CONTAINER_FIND_FULL</a>(&amp;<a class="code" href="chan__h323_8c.html#a73d22ff9770f2c94dac6e92c3eddea5f" title="H323 peer list.">peerl</a>, sin, addr, 0, 0, <a class="code" href="chan__h323_8c.html#ab0f013613fb4dcee67919a81a1c725ae">oh323_addrcmp</a>);
<a name="l01640"></a>01640 
<a name="l01641"></a>01641    <span class="keywordflow">if</span> (!p &amp;&amp; realtime)
<a name="l01642"></a>01642       p = <a class="code" href="chan__h323_8c.html#ade030a243ae99913806e20bc6239cde0">realtime_peer</a>(peer, sin);
<a name="l01643"></a>01643 
<a name="l01644"></a>01644    <span class="keywordflow">if</span> (!p &amp;&amp; <a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l01645"></a>01645       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Could not find peer by name %s or address %s\n&quot;</span>, (peer ? peer : <span class="stringliteral">&quot;&lt;NONE&gt;&quot;</span>), (sin ? <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(sin-&gt;sin_addr) : <span class="stringliteral">&quot;&lt;NONE&gt;&quot;</span>));
<a name="l01646"></a>01646 
<a name="l01647"></a>01647    <span class="keywordflow">return</span> p;
<a name="l01648"></a>01648 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa3f365bda05996becf0e9c32e94507ea"></a><!-- doxytag: member="chan_h323.c::find_user" ref="aa3f365bda05996becf0e9c32e94507ea" args="(const call_details_t *cd, int realtime)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct oh323_user* find_user </td>
          <td>(</td>
          <td class="paramtype">const call_details_t *&nbsp;</td>
          <td class="paramname"> <em>cd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>realtime</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l01602">1602</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="astobj_8h_source.html#l00401">ASTOBJ_CONTAINER_FIND</a>, <a class="el" href="astobj_8h_source.html#l00428">ASTOBJ_CONTAINER_FIND_FULL</a>, <a class="el" href="chan__h323_8c_source.html#l01597">oh323_addrcmp_str()</a>, <a class="el" href="chan__h323_8c_source.html#l01440">realtime_user()</a>, and <a class="el" href="chan__h323_8c.html#ab8937033f3230cb7adfe1e86d2055a5e">userl</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l02100">setup_incoming_call()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01603"></a>01603 {
<a name="l01604"></a>01604    <span class="keyword">struct </span>oh323_user *u;
<a name="l01605"></a>01605 
<a name="l01606"></a>01606    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#af8106a09b3ed0924050635f9a8a19fca">userbyalias</a>)
<a name="l01607"></a>01607       u = <a class="code" href="astobj_8h.html#aca5d7206cd0c6817140bba786a9b6b8a" title="Find an object in a container.">ASTOBJ_CONTAINER_FIND</a>(&amp;<a class="code" href="chan__h323_8c.html#ab8937033f3230cb7adfe1e86d2055a5e" title="H323 User list.">userl</a>, cd-&gt;call_source_aliases);
<a name="l01608"></a>01608    <span class="keywordflow">else</span>
<a name="l01609"></a>01609       u = <a class="code" href="astobj_8h.html#a2714c822060df6eec7241ee4b250cc3c" title="Find an object in a container.">ASTOBJ_CONTAINER_FIND_FULL</a>(&amp;<a class="code" href="chan__h323_8c.html#ab8937033f3230cb7adfe1e86d2055a5e" title="H323 User list.">userl</a>, cd-&gt;sourceIp, addr.sin_addr, 0, 0, <a class="code" href="chan__h323_8c.html#a95ea09e6112cba4a7a878e9d87bf97e1">oh323_addrcmp_str</a>);
<a name="l01610"></a>01610 
<a name="l01611"></a>01611    <span class="keywordflow">if</span> (!u &amp;&amp; realtime)
<a name="l01612"></a>01612       u = <a class="code" href="chan__h323_8c.html#a0f578c07de3dd4338e69ff42ba1e1996">realtime_user</a>(cd);
<a name="l01613"></a>01613 
<a name="l01614"></a>01614    <span class="keywordflow">if</span> (!u &amp;&amp; <a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l01615"></a>01615       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Could not find user by name %s or address %s\n&quot;</span>, cd-&gt;call_source_aliases, cd-&gt;sourceIp);
<a name="l01616"></a>01616 
<a name="l01617"></a>01617    <span class="keywordflow">return</span> u;
<a name="l01618"></a>01618 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2b14b06b75b8bbff574be9ab7bfc5957"></a><!-- doxytag: member="chan_h323.c::h323_do_reload" ref="a2b14b06b75b8bbff574be9ab7bfc5957" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int h323_do_reload </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l03119">3119</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="chan__h323_8c_source.html#l02832">reload_config()</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l02529">do_monitor()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03120"></a>03120 {
<a name="l03121"></a>03121    <a class="code" href="chan__h323_8c.html#aa0b7680df49f5fe40c8bb1c8f0536cc6">reload_config</a>(1);
<a name="l03122"></a>03122    <span class="keywordflow">return</span> 0;
<a name="l03123"></a>03123 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aeaa9d343c54df03af296eccb32cf700c"></a><!-- doxytag: member="chan_h323.c::h323_reload" ref="aeaa9d343c54df03af296eccb32cf700c" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int h323_reload </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l03085">3085</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="logger_8h_source.html#l00079">ast_verbose</a>, and <a class="el" href="chan__h323_8c_source.html#l02597">restart_monitor()</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l03098">handle_cli_h323_reload()</a>, and <a class="el" href="chan__h323_8c_source.html#l03125">reload()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03086"></a>03086 {
<a name="l03087"></a>03087    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;h323_reload_lock);
<a name="l03088"></a>03088    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#ad60ccb0475ed36e6be2e9914df685d56">h323_reloading</a>) {
<a name="l03089"></a>03089       <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;Previous H.323 reload not yet done\n&quot;</span>);
<a name="l03090"></a>03090    } <span class="keywordflow">else</span> {
<a name="l03091"></a>03091       <a class="code" href="chan__h323_8c.html#ad60ccb0475ed36e6be2e9914df685d56">h323_reloading</a> = 1;
<a name="l03092"></a>03092    }
<a name="l03093"></a>03093    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;h323_reload_lock);
<a name="l03094"></a>03094    <a class="code" href="chan__h323_8c.html#a83af94bb19a421cb25ca02d16fa5ba9c">restart_monitor</a>();
<a name="l03095"></a>03095    <span class="keywordflow">return</span> 0;
<a name="l03096"></a>03096 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5707938bbeb768615abbead1a2b63e35"></a><!-- doxytag: member="chan_h323.c::handle_cli_h323_cycle_gk" ref="a5707938bbeb768615abbead1a2b63e35" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_cli_h323_cycle_gk </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l02681">2681</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02682"></a>02682 {
<a name="l02683"></a>02683    <span class="keywordflow">switch</span> (cmd) {
<a name="l02684"></a>02684    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l02685"></a>02685       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;h323 cycle gk&quot;</span>;
<a name="l02686"></a>02686       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l02687"></a>02687          <span class="stringliteral">&quot;Usage: h323 cycle gk\n&quot;</span>
<a name="l02688"></a>02688          <span class="stringliteral">&quot;       Manually re-register with the Gatekeper (Currently Disabled)\n&quot;</span>;
<a name="l02689"></a>02689       <span class="keywordflow">return</span> NULL;
<a name="l02690"></a>02690    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l02691"></a>02691       <span class="keywordflow">return</span> NULL;
<a name="l02692"></a>02692    }
<a name="l02693"></a>02693 
<a name="l02694"></a>02694    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != 3)
<a name="l02695"></a>02695       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l02696"></a>02696 
<a name="l02697"></a>02697    h323_gk_urq();
<a name="l02698"></a>02698 
<a name="l02699"></a>02699    <span class="comment">/* Possibly register with a GK */</span>
<a name="l02700"></a>02700    <span class="keywordflow">if</span> (!<a class="code" href="chan__h323_8c.html#abf24fbc8556bb94e3e636bfa53170b7d">gatekeeper_disable</a>) {
<a name="l02701"></a>02701       <span class="keywordflow">if</span> (h323_set_gk(<a class="code" href="chan__h323_8c.html#a1bcd9525b45f12be3151ff75d7f9712f">gatekeeper_discover</a>, <a class="code" href="chan__h323_8c.html#a4bd4778b66bf079c2227fe62ec9a3e73">gatekeeper</a>, <a class="code" href="chan__h323_8c.html#a67fefea55602b6c8d1e29902f600e249">secret</a>)) {
<a name="l02702"></a>02702          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Gatekeeper registration failed.\n&quot;</span>);
<a name="l02703"></a>02703       }
<a name="l02704"></a>02704    }
<a name="l02705"></a>02705    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l02706"></a>02706 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a749a0666cf60b8805d0cb58751cfaf7a"></a><!-- doxytag: member="chan_h323.c::handle_cli_h323_hangup" ref="a749a0666cf60b8805d0cb58751cfaf7a" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_cli_h323_hangup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l02708">2708</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02709"></a>02709 {
<a name="l02710"></a>02710    <span class="keywordflow">switch</span> (cmd) {
<a name="l02711"></a>02711    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l02712"></a>02712       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;h323 hangup&quot;</span>;
<a name="l02713"></a>02713       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l02714"></a>02714          <span class="stringliteral">&quot;Usage: h323 hangup &lt;token&gt;\n&quot;</span>
<a name="l02715"></a>02715          <span class="stringliteral">&quot;       Manually try to hang up the call identified by &lt;token&gt;\n&quot;</span>;
<a name="l02716"></a>02716       <span class="keywordflow">return</span> NULL;
<a name="l02717"></a>02717    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l02718"></a>02718       <span class="keywordflow">return</span> NULL;
<a name="l02719"></a>02719    }
<a name="l02720"></a>02720 
<a name="l02721"></a>02721    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != 3)
<a name="l02722"></a>02722       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l02723"></a>02723    <span class="keywordflow">if</span> (h323_soft_hangup(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[2])) {
<a name="l02724"></a>02724       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Hangup succeeded on %s\n&quot;</span>, a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[2]);
<a name="l02725"></a>02725    } <span class="keywordflow">else</span> {
<a name="l02726"></a>02726       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Hangup failed for %s\n&quot;</span>, a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[2]);
<a name="l02727"></a>02727    }
<a name="l02728"></a>02728    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l02729"></a>02729 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a618287b0a5b4c030d38bf0145c602b54"></a><!-- doxytag: member="chan_h323.c::handle_cli_h323_reload" ref="a618287b0a5b4c030d38bf0145c602b54" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_cli_h323_reload </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l03098">3098</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="chan__h323_8c_source.html#l03085">h323_reload()</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03099"></a>03099 {
<a name="l03100"></a>03100    <span class="keywordflow">switch</span> (cmd) {
<a name="l03101"></a>03101    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l03102"></a>03102       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;h323 reload&quot;</span>;
<a name="l03103"></a>03103       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l03104"></a>03104          <span class="stringliteral">&quot;Usage: h323 reload\n&quot;</span>
<a name="l03105"></a>03105          <span class="stringliteral">&quot;       Reloads H.323 configuration from h323.conf\n&quot;</span>;
<a name="l03106"></a>03106       <span class="keywordflow">return</span> NULL;
<a name="l03107"></a>03107    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l03108"></a>03108       <span class="keywordflow">return</span> NULL;
<a name="l03109"></a>03109    }
<a name="l03110"></a>03110 
<a name="l03111"></a>03111    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != 2)
<a name="l03112"></a>03112       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l03113"></a>03113 
<a name="l03114"></a>03114    <a class="code" href="chan__h323_8c.html#aeaa9d343c54df03af296eccb32cf700c">h323_reload</a>();
<a name="l03115"></a>03115 
<a name="l03116"></a>03116    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l03117"></a>03117 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9517295cc023bb8e9469a3beffb1b0f6"></a><!-- doxytag: member="chan_h323.c::handle_cli_h323_set_debug" ref="a9517295cc023bb8e9469a3beffb1b0f6" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_cli_h323_set_debug </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l02658">2658</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00167">ast_cli_entry::args</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02659"></a>02659 {
<a name="l02660"></a>02660    <span class="keywordflow">switch</span> (cmd) {
<a name="l02661"></a>02661    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l02662"></a>02662       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;h323 set debug [on|off]&quot;</span>;
<a name="l02663"></a>02663       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l02664"></a>02664          <span class="stringliteral">&quot;Usage: h323 set debug [on|off]\n&quot;</span>
<a name="l02665"></a>02665          <span class="stringliteral">&quot;       Enable/Disable H.323 debugging output\n&quot;</span>;
<a name="l02666"></a>02666       <span class="keywordflow">return</span> NULL;
<a name="l02667"></a>02667    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l02668"></a>02668       <span class="keywordflow">return</span> NULL;
<a name="l02669"></a>02669    }
<a name="l02670"></a>02670 
<a name="l02671"></a>02671    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>)
<a name="l02672"></a>02672       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l02673"></a>02673    <span class="keywordflow">if</span> (strcasecmp(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3], <span class="stringliteral">&quot;on&quot;</span>) &amp;&amp; strcasecmp(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3], <span class="stringliteral">&quot;off&quot;</span>))
<a name="l02674"></a>02674       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l02675"></a>02675 
<a name="l02676"></a>02676    <a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a> = (strcasecmp(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3], <span class="stringliteral">&quot;on&quot;</span>)) ? 0 : 1;
<a name="l02677"></a>02677    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;H.323 Debugging %s\n&quot;</span>, <a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a> ? <span class="stringliteral">&quot;Enabled&quot;</span> : <span class="stringliteral">&quot;Disabled&quot;</span>);
<a name="l02678"></a>02678    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l02679"></a>02679 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac5eb80b9aa4fa51ca5770ad1e42b4cfe"></a><!-- doxytag: member="chan_h323.c::handle_cli_h323_set_trace" ref="ac5eb80b9aa4fa51ca5770ad1e42b4cfe" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_cli_h323_set_trace </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l02629">2629</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00167">ast_cli_entry::args</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02630"></a>02630 {
<a name="l02631"></a>02631    <span class="keywordflow">switch</span> (cmd) {
<a name="l02632"></a>02632    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l02633"></a>02633       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;h323 set trace [on|off]&quot;</span>;
<a name="l02634"></a>02634       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l02635"></a>02635          <span class="stringliteral">&quot;Usage: h323 set trace (on|off|&lt;trace level&gt;)\n&quot;</span>
<a name="l02636"></a>02636          <span class="stringliteral">&quot;       Enable/Disable H.323 stack tracing for debugging purposes\n&quot;</span>;
<a name="l02637"></a>02637       <span class="keywordflow">return</span> NULL;
<a name="l02638"></a>02638    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l02639"></a>02639       <span class="keywordflow">return</span> NULL;
<a name="l02640"></a>02640    }
<a name="l02641"></a>02641 
<a name="l02642"></a>02642    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>)
<a name="l02643"></a>02643       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l02644"></a>02644    <span class="keywordflow">if</span> (!strcasecmp(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3], <span class="stringliteral">&quot;off&quot;</span>)) {
<a name="l02645"></a>02645       h323_debug(0, 0);
<a name="l02646"></a>02646       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;H.323 Trace Disabled\n&quot;</span>);
<a name="l02647"></a>02647    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3], <span class="stringliteral">&quot;on&quot;</span>)) {
<a name="l02648"></a>02648       h323_debug(1, 1);
<a name="l02649"></a>02649       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;H.323 Trace Enabled\n&quot;</span>);
<a name="l02650"></a>02650    } <span class="keywordflow">else</span> {
<a name="l02651"></a>02651       <span class="keywordtype">int</span> tracelevel = atoi(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3]);
<a name="l02652"></a>02652       h323_debug(1, tracelevel);
<a name="l02653"></a>02653       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;H.323 Trace Enabled (Trace Level: %d)\n&quot;</span>, tracelevel);
<a name="l02654"></a>02654    }
<a name="l02655"></a>02655    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l02656"></a>02656 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad01b37e8fb4a77e63000883ffff1a6db"></a><!-- doxytag: member="chan_h323.c::handle_cli_h323_show_tokens" ref="ad01b37e8fb4a77e63000883ffff1a6db" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_cli_h323_show_tokens </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l02731">2731</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02732"></a>02732 {
<a name="l02733"></a>02733    <span class="keywordflow">switch</span> (cmd) {
<a name="l02734"></a>02734    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l02735"></a>02735       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;h323 show tokens&quot;</span>;
<a name="l02736"></a>02736       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l02737"></a>02737          <span class="stringliteral">&quot;Usage: h323 show tokens\n&quot;</span>
<a name="l02738"></a>02738          <span class="stringliteral">&quot;       Print out all active call tokens\n&quot;</span>;
<a name="l02739"></a>02739       <span class="keywordflow">return</span> NULL;
<a name="l02740"></a>02740    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l02741"></a>02741       <span class="keywordflow">return</span> NULL;
<a name="l02742"></a>02742    }
<a name="l02743"></a>02743 
<a name="l02744"></a>02744    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != 3)
<a name="l02745"></a>02745       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l02746"></a>02746 
<a name="l02747"></a>02747    h323_show_tokens();
<a name="l02748"></a>02748 
<a name="l02749"></a>02749    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l02750"></a>02750 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a659cbd49ef7f17b79f0b1cd5107f0782"></a><!-- doxytag: member="chan_h323.c::handle_cli_h323_show_version" ref="a659cbd49ef7f17b79f0b1cd5107f0782" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_cli_h323_show_version </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l02752">2752</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02753"></a>02753 {
<a name="l02754"></a>02754    <span class="keywordflow">switch</span> (cmd) {
<a name="l02755"></a>02755    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l02756"></a>02756       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;h323 show version&quot;</span>;
<a name="l02757"></a>02757       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l02758"></a>02758          <span class="stringliteral">&quot;Usage: h323 show version\n&quot;</span>
<a name="l02759"></a>02759          <span class="stringliteral">&quot;     Show the version of the H.323 library in use\n&quot;</span>;
<a name="l02760"></a>02760       <span class="keywordflow">return</span> NULL;
<a name="l02761"></a>02761    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l02762"></a>02762       <span class="keywordflow">return</span> NULL;
<a name="l02763"></a>02763    }
<a name="l02764"></a>02764 
<a name="l02765"></a>02765    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != 3)
<a name="l02766"></a>02766       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l02767"></a>02767 
<a name="l02768"></a>02768    h323_show_version();
<a name="l02769"></a>02769    
<a name="l02770"></a>02770    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l02771"></a>02771 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7cfd1891983f596cb42929aa363a3f6d"></a><!-- doxytag: member="chan_h323.c::hangup_connection" ref="a7cfd1891983f596cb42929aa363a3f6d" args="(unsigned int call_reference, const char *token, int cause)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void hangup_connection </td>
          <td>(</td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>call_reference</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cause</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l02390">2390</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00462">ast_channel::_softhangup</a>, <a class="el" href="lock_8h_source.html#l02037">ast_channel_trylock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="channel_8c_source.html#l01103">ast_queue_hangup_with_cause()</a>, <a class="el" href="channel_8h_source.html#l00633">AST_SOFTHANGUP_DEV</a>, <a class="el" href="chan__h323_8c_source.html#l01144">find_call_locked()</a>, <a class="el" href="chan__h323_8c_source.html#l00171">oh323_pvt::hangupcause</a>, <a class="el" href="channel_8h_source.html#l00479">ast_channel::hangupcause</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, <a class="el" href="chan__h323_8c_source.html#l00170">oh323_pvt::needhangup</a>, and <a class="el" href="chan__h323_8c_source.html#l00157">oh323_pvt::owner</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l03222">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02391"></a>02391 {
<a name="l02392"></a>02392    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *pvt;
<a name="l02393"></a>02393 
<a name="l02394"></a>02394    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l02395"></a>02395       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Hanging up connection to %s with cause %d\n&quot;</span>, token, <a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>);
<a name="l02396"></a>02396 
<a name="l02397"></a>02397    pvt = <a class="code" href="chan__h323_8c.html#a246fb1df8539e4f168a9bc8233ef76b9">find_call_locked</a>(call_reference, token);
<a name="l02398"></a>02398    <span class="keywordflow">if</span> (!pvt) {
<a name="l02399"></a>02399       <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l02400"></a>02400          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Connection to %s already cleared\n&quot;</span>, token);
<a name="l02401"></a>02401       <span class="keywordflow">return</span>;
<a name="l02402"></a>02402    }
<a name="l02403"></a>02403    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; !<a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {
<a name="l02404"></a>02404       pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> |= <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709a2e185ce313026e13ed90ae3a319c9cb7">AST_SOFTHANGUP_DEV</a>;
<a name="l02405"></a>02405       pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a> = pvt-&gt;<a class="code" href="structoh323__pvt.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a> = <a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>;
<a name="l02406"></a>02406       <a class="code" href="channel_8h.html#a91e78b15da3244307ffd749fa85f4db7" title="Queue a hangup frame with hangupcause set.">ast_queue_hangup_with_cause</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>);
<a name="l02407"></a>02407       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l02408"></a>02408    }
<a name="l02409"></a>02409    <span class="keywordflow">else</span> {
<a name="l02410"></a>02410       pvt-&gt;<a class="code" href="structoh323__pvt.html#ab410abac6a8fa56d1c7b19a470a25d93">needhangup</a> = 1;
<a name="l02411"></a>02411       pvt-&gt;<a class="code" href="structoh323__pvt.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a> = <a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>;
<a name="l02412"></a>02412       <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l02413"></a>02413          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Hangup for %s is pending\n&quot;</span>, token);
<a name="l02414"></a>02414    }
<a name="l02415"></a>02415    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l02416"></a>02416 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8f637f6e4d4a880f6556eb05dcd6c8a0"></a><!-- doxytag: member="chan_h323.c::load_module" ref="a8f637f6e4d4a880f6556eb05dcd6c8a0" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="module_8h.html#adc09474f0ff557e9925b722ee5b952df">ast_module_load_result</a> load_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l03222">3222</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="chan__h323_8c.html#a2029bed642f94cb8e3299209b084e585">aliasl</a>, <a class="el" href="chan__h323_8c_source.html#l02220">answer_call()</a>, <a class="el" href="channel_8c_source.html#l00557">ast_channel_register()</a>, <a class="el" href="cli_8c_source.html#l01919">ast_cli_register()</a>, <a class="el" href="cli_8c_source.html#l01927">ast_cli_register_multiple()</a>, <a class="el" href="cli_8c_source.html#l01913">ast_cli_unregister()</a>, <a class="el" href="cli_8c_source.html#l01937">ast_cli_unregister_multiple()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="module_8h_source.html#l00062">AST_MODULE_LOAD_DECLINE</a>, <a class="el" href="module_8h_source.html#l00065">AST_MODULE_LOAD_FAILURE</a>, <a class="el" href="module_8h_source.html#l00061">AST_MODULE_LOAD_SUCCESS</a>, <a class="el" href="rtp_8c_source.html#l03896">ast_rtp_proto_register()</a>, <a class="el" href="rtp_8c_source.html#l03888">ast_rtp_proto_unregister()</a>, <a class="el" href="astobj_8h_source.html#l00765">ASTOBJ_CONTAINER_DESTROY</a>, <a class="el" href="astobj_8h_source.html#l00453">ASTOBJ_CONTAINER_DESTROYALL</a>, <a class="el" href="astobj_8h_source.html#l00752">ASTOBJ_CONTAINER_INIT</a>, <a class="el" href="chan__h323_8c_source.html#l00130">bindaddr</a>, <a class="el" href="chan__h323_8c_source.html#l02311">chan_ringing()</a>, <a class="el" href="chan__h323_8c_source.html#l02337">cleanup_connection()</a>, <a class="el" href="chan__h323_8c_source.html#l02045">connection_made()</a>, <a class="el" href="chan__h323_8c_source.html#l01895">external_rtp_create()</a>, <a class="el" href="chan__h323_8c_source.html#l02390">hangup_connection()</a>, <a class="el" href="io_8c_source.html#l00072">io_context_create()</a>, <a class="el" href="io_8c_source.html#l00098">io_context_destroy()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__h323_8c_source.html#l00279">oh323_destroy_alias()</a>, <a class="el" href="chan__h323_8c_source.html#l00294">oh323_destroy_peer()</a>, <a class="el" href="chan__h323_8c_source.html#l00286">oh323_destroy_user()</a>, <a class="el" href="chan__h323_8c.html#a73d22ff9770f2c94dac6e92c3eddea5f">peerl</a>, <a class="el" href="chan__h323_8c_source.html#l01827">receive_digit()</a>, <a class="el" href="chan__h323_8c_source.html#l02832">reload_config()</a>, <a class="el" href="chan__h323_8c_source.html#l02503">remote_hold()</a>, <a class="el" href="chan__h323_8c_source.html#l02597">restart_monitor()</a>, <a class="el" href="sched_8c_source.html#l00239">sched_context_create()</a>, <a class="el" href="sched_8c_source.html#l00260">sched_context_destroy()</a>, <a class="el" href="chan__h323_8c_source.html#l02418">set_dtmf_payload()</a>, <a class="el" href="chan__h323_8c_source.html#l02473">set_local_capabilities()</a>, <a class="el" href="chan__h323_8c_source.html#l02438">set_peer_capabilities()</a>, <a class="el" href="chan__h323_8c_source.html#l02100">setup_incoming_call()</a>, <a class="el" href="chan__h323_8c_source.html#l02299">setup_outgoing_call()</a>, <a class="el" href="chan__h323_8c_source.html#l01936">setup_rtp_connection()</a>, and <a class="el" href="chan__h323_8c.html#ab8937033f3230cb7adfe1e86d2055a5e">userl</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03223"></a>03223 {
<a name="l03224"></a>03224    <span class="keywordtype">int</span> res;
<a name="l03225"></a>03225 
<a name="l03226"></a>03226    <a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a> = 0;
<a name="l03227"></a>03227    <a class="code" href="structsched.html">sched</a> = <a class="code" href="sched_8h.html#ad4fd5c63d5d3dcc8e11bec644c601017" title="New schedule context.">sched_context_create</a>();
<a name="l03228"></a>03228    <span class="keywordflow">if</span> (!<a class="code" href="structsched.html">sched</a>) {
<a name="l03229"></a>03229       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create schedule context\n&quot;</span>);
<a name="l03230"></a>03230       <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa8724da3ad620df86524280e760add388">AST_MODULE_LOAD_FAILURE</a>;
<a name="l03231"></a>03231    }
<a name="l03232"></a>03232    <a class="code" href="chan__h323_8c.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a> = <a class="code" href="io_8h.html#a7d66d121ef63109c2f55188a38b8240f" title="Creates a context Create a context for I/O operations Basically mallocs an IO structure...">io_context_create</a>();
<a name="l03233"></a>03233    <span class="keywordflow">if</span> (!<a class="code" href="chan__h323_8c.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a>) {
<a name="l03234"></a>03234       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create I/O context\n&quot;</span>);
<a name="l03235"></a>03235       <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa8724da3ad620df86524280e760add388">AST_MODULE_LOAD_FAILURE</a>;
<a name="l03236"></a>03236    }
<a name="l03237"></a>03237    <a class="code" href="cli_8h.html#a0ca7e108aceb1cd488bb9e3ee26e4ebc" title="Registers a command or an array of commands.">ast_cli_register</a>(&amp;<a class="code" href="chan__h323_8c.html#a3c042f9683086454ebde91b64db19726">cli_h323_reload</a>);
<a name="l03238"></a>03238    <a class="code" href="astobj_8h.html#a8551f606c8aecc4797ef7728c7792827" title="Initialize a container.">ASTOBJ_CONTAINER_INIT</a>(&amp;<a class="code" href="chan__h323_8c.html#ab8937033f3230cb7adfe1e86d2055a5e" title="H323 User list.">userl</a>);
<a name="l03239"></a>03239    <a class="code" href="astobj_8h.html#a8551f606c8aecc4797ef7728c7792827" title="Initialize a container.">ASTOBJ_CONTAINER_INIT</a>(&amp;<a class="code" href="chan__h323_8c.html#a73d22ff9770f2c94dac6e92c3eddea5f" title="H323 peer list.">peerl</a>);
<a name="l03240"></a>03240    <a class="code" href="astobj_8h.html#a8551f606c8aecc4797ef7728c7792827" title="Initialize a container.">ASTOBJ_CONTAINER_INIT</a>(&amp;<a class="code" href="chan__h323_8c.html#a2029bed642f94cb8e3299209b084e585" title="H323 alias list.">aliasl</a>);
<a name="l03241"></a>03241    res = <a class="code" href="chan__h323_8c.html#aa0b7680df49f5fe40c8bb1c8f0536cc6">reload_config</a>(0);
<a name="l03242"></a>03242    <span class="keywordflow">if</span> (res) {
<a name="l03243"></a>03243       <span class="comment">/* No config entry */</span>
<a name="l03244"></a>03244       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Unload and load chan_h323.so again in order to receive configuration changes.\n&quot;</span>);
<a name="l03245"></a>03245       <a class="code" href="cli_8h.html#a3189e6720486808603d13f5d2b58daf4" title="Unregisters a command or an array of commands.">ast_cli_unregister</a>(&amp;<a class="code" href="chan__h323_8c.html#a3c042f9683086454ebde91b64db19726">cli_h323_reload</a>);
<a name="l03246"></a>03246       <a class="code" href="io_8h.html#a5409251fbead35b5e59fe322e14446b9" title="Destroys a context.">io_context_destroy</a>(<a class="code" href="chan__h323_8c.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a>);
<a name="l03247"></a>03247       <a class="code" href="chan__h323_8c.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a> = NULL;
<a name="l03248"></a>03248       <a class="code" href="sched_8h.html#a7350994bcfd1be91874493dbe25faf0c" title="destroys a schedule context Destroys (free&amp;#39;s) the given sched_context structure...">sched_context_destroy</a>(<a class="code" href="structsched.html">sched</a>);
<a name="l03249"></a>03249       <a class="code" href="structsched.html">sched</a> = NULL;
<a name="l03250"></a>03250       <a class="code" href="astobj_8h.html#a49ab9467549d53be33f3f9f3ecae97f9" title="Destroy a container.">ASTOBJ_CONTAINER_DESTROY</a>(&amp;<a class="code" href="chan__h323_8c.html#ab8937033f3230cb7adfe1e86d2055a5e" title="H323 User list.">userl</a>);
<a name="l03251"></a>03251       <a class="code" href="astobj_8h.html#a49ab9467549d53be33f3f9f3ecae97f9" title="Destroy a container.">ASTOBJ_CONTAINER_DESTROY</a>(&amp;<a class="code" href="chan__h323_8c.html#a73d22ff9770f2c94dac6e92c3eddea5f" title="H323 peer list.">peerl</a>);
<a name="l03252"></a>03252       <a class="code" href="astobj_8h.html#a49ab9467549d53be33f3f9f3ecae97f9" title="Destroy a container.">ASTOBJ_CONTAINER_DESTROY</a>(&amp;<a class="code" href="chan__h323_8c.html#a2029bed642f94cb8e3299209b084e585" title="H323 alias list.">aliasl</a>);
<a name="l03253"></a>03253       <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;
<a name="l03254"></a>03254    } <span class="keywordflow">else</span> {
<a name="l03255"></a>03255       <span class="comment">/* Make sure we can register our channel type */</span>
<a name="l03256"></a>03256       <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#ab5f3776fda943e52820ceeee5835c1b4" title="Register a channel technology (a new channel driver) Called by a channel module to...">ast_channel_register</a>(&amp;<a class="code" href="chan__h323_8c.html#a6763477c6c97aba1b89bff0ac7641422">oh323_tech</a>)) {
<a name="l03257"></a>03257          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to register channel class &apos;H323&apos;\n&quot;</span>);
<a name="l03258"></a>03258          <a class="code" href="cli_8h.html#a3189e6720486808603d13f5d2b58daf4" title="Unregisters a command or an array of commands.">ast_cli_unregister</a>(&amp;<a class="code" href="chan__h323_8c.html#a3c042f9683086454ebde91b64db19726">cli_h323_reload</a>);
<a name="l03259"></a>03259          h323_end_process();
<a name="l03260"></a>03260          <a class="code" href="io_8h.html#a5409251fbead35b5e59fe322e14446b9" title="Destroys a context.">io_context_destroy</a>(<a class="code" href="chan__h323_8c.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a>);
<a name="l03261"></a>03261          <a class="code" href="sched_8h.html#a7350994bcfd1be91874493dbe25faf0c" title="destroys a schedule context Destroys (free&amp;#39;s) the given sched_context structure...">sched_context_destroy</a>(<a class="code" href="structsched.html">sched</a>);
<a name="l03262"></a>03262 
<a name="l03263"></a>03263          <a class="code" href="astobj_8h.html#a5b923418ce1d4908359bb3b27b211411" title="Empty a container.">ASTOBJ_CONTAINER_DESTROYALL</a>(&amp;<a class="code" href="chan__h323_8c.html#ab8937033f3230cb7adfe1e86d2055a5e" title="H323 User list.">userl</a>, <a class="code" href="chan__h323_8c.html#ad2a4b95f164d86a67d96a23c8714157b">oh323_destroy_user</a>);
<a name="l03264"></a>03264          <a class="code" href="astobj_8h.html#a49ab9467549d53be33f3f9f3ecae97f9" title="Destroy a container.">ASTOBJ_CONTAINER_DESTROY</a>(&amp;<a class="code" href="chan__h323_8c.html#ab8937033f3230cb7adfe1e86d2055a5e" title="H323 User list.">userl</a>);
<a name="l03265"></a>03265          <a class="code" href="astobj_8h.html#a5b923418ce1d4908359bb3b27b211411" title="Empty a container.">ASTOBJ_CONTAINER_DESTROYALL</a>(&amp;<a class="code" href="chan__h323_8c.html#a73d22ff9770f2c94dac6e92c3eddea5f" title="H323 peer list.">peerl</a>, <a class="code" href="chan__h323_8c.html#ad2fe7bc6fcd60293a92f883ff5d03fc0">oh323_destroy_peer</a>);
<a name="l03266"></a>03266          <a class="code" href="astobj_8h.html#a49ab9467549d53be33f3f9f3ecae97f9" title="Destroy a container.">ASTOBJ_CONTAINER_DESTROY</a>(&amp;<a class="code" href="chan__h323_8c.html#a73d22ff9770f2c94dac6e92c3eddea5f" title="H323 peer list.">peerl</a>);
<a name="l03267"></a>03267          <a class="code" href="astobj_8h.html#a5b923418ce1d4908359bb3b27b211411" title="Empty a container.">ASTOBJ_CONTAINER_DESTROYALL</a>(&amp;<a class="code" href="chan__h323_8c.html#a2029bed642f94cb8e3299209b084e585" title="H323 alias list.">aliasl</a>, <a class="code" href="chan__h323_8c.html#a9ebae4396be42baf2785e593f5fede69">oh323_destroy_alias</a>);
<a name="l03268"></a>03268          <a class="code" href="astobj_8h.html#a49ab9467549d53be33f3f9f3ecae97f9" title="Destroy a container.">ASTOBJ_CONTAINER_DESTROY</a>(&amp;<a class="code" href="chan__h323_8c.html#a2029bed642f94cb8e3299209b084e585" title="H323 alias list.">aliasl</a>);
<a name="l03269"></a>03269 
<a name="l03270"></a>03270          <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa8724da3ad620df86524280e760add388">AST_MODULE_LOAD_FAILURE</a>;
<a name="l03271"></a>03271       }
<a name="l03272"></a>03272       <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(<a class="code" href="chan__h323_8c.html#abb56ddafa06a53da731882da397ce655">cli_h323</a>, <span class="keyword">sizeof</span>(<a class="code" href="chan__h323_8c.html#abb56ddafa06a53da731882da397ce655">cli_h323</a>) / <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a>));
<a name="l03273"></a>03273 
<a name="l03274"></a>03274       <a class="code" href="rtp_8h.html#a00b94396faf3f52b0c3ea612a9af334d" title="Register an RTP channel client.">ast_rtp_proto_register</a>(&amp;<a class="code" href="chan__h323_8c.html#a662b19f30aa83f4c9b55099b8720e017">oh323_rtp</a>);
<a name="l03275"></a>03275 
<a name="l03276"></a>03276       <span class="comment">/* Register our callback functions */</span>
<a name="l03277"></a>03277       h323_callback_register(<a class="code" href="chan__h323_8c.html#a99229ff7b6ed5b42956b0ba1a86924ae" title="Call-back function for incoming calls.">setup_incoming_call</a>,
<a name="l03278"></a>03278                   <a class="code" href="chan__h323_8c.html#aba66a9543f9b7a9755a65250169e0f2a" title="Call-back function to establish an outgoing H.323 call.">setup_outgoing_call</a>,
<a name="l03279"></a>03279                   <a class="code" href="chan__h323_8c.html#a0943ee4bea659b2877d483853b272c1a" title="Callback function used to inform the H.323 stack of the local rtp ip/port details...">external_rtp_create</a>,
<a name="l03280"></a>03280                   <a class="code" href="chan__h323_8c.html#a952624d4d47581b01ee71048280ac681" title="Call-back function passing remote ip/port information from H.323 to asterisk.">setup_rtp_connection</a>,
<a name="l03281"></a>03281                   <a class="code" href="chan__h323_8c.html#a672902ed001137f6a99cfeece800ce9f" title="Call-back function to cleanup communication Returns nothing,.">cleanup_connection</a>,
<a name="l03282"></a>03282                   <a class="code" href="chan__h323_8c.html#abe8912b97493d1dc19b84f3c3e80984a" title="Call-back function to signal asterisk that the channel is ringing Returns nothing...">chan_ringing</a>,
<a name="l03283"></a>03283                   <a class="code" href="chan__h323_8c.html#a8e5a95844ec0171f79294dad29ed7b28" title="Call-back function to signal asterisk that the channel has been answered Returns...">connection_made</a>,
<a name="l03284"></a>03284                   <a class="code" href="chan__h323_8c.html#a533a0dc5525df003509528552d047aa7" title="Callback for sending digits from H.323 up to asterisk.">receive_digit</a>,
<a name="l03285"></a>03285                   <a class="code" href="chan__h323_8c.html#a09e087de558c65717f6db4e73198c443" title="Call-back function to start PBX when OpenH323 ready to serve incoming call.">answer_call</a>,
<a name="l03286"></a>03286                   <a class="code" href="structprogress.html">progress</a>,
<a name="l03287"></a>03287                   <a class="code" href="chan__h323_8c.html#a3fe6108223a4ca1bf57716dc77a85038">set_dtmf_payload</a>,
<a name="l03288"></a>03288                   <a class="code" href="chan__h323_8c.html#a7cfd1891983f596cb42929aa363a3f6d">hangup_connection</a>,
<a name="l03289"></a>03289                   <a class="code" href="chan__h323_8c.html#a3b2a3a72391ac7feafe74083f69db6fc">set_local_capabilities</a>,
<a name="l03290"></a>03290                   <a class="code" href="chan__h323_8c.html#aa3a89ee27c1efd3e8ee24dead62035bc">set_peer_capabilities</a>,
<a name="l03291"></a>03291                   <a class="code" href="chan__h323_8c.html#ac1df53d236a5999adb52ea5a0bca678a">remote_hold</a>);
<a name="l03292"></a>03292       <span class="comment">/* start the h.323 listener */</span>
<a name="l03293"></a>03293       <span class="keywordflow">if</span> (h323_start_listener(<a class="code" href="chan__h323_8c.html#a7f366397aeb2f3ce05c337d8a8b32a09">h323_signalling_port</a>, <a class="code" href="chan__h323_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>)) {
<a name="l03294"></a>03294          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to create H323 listener.\n&quot;</span>);
<a name="l03295"></a>03295          <a class="code" href="rtp_8h.html#a39d797fe6097e914323998f72b13420c" title="Unregister an RTP channel client.">ast_rtp_proto_unregister</a>(&amp;<a class="code" href="chan__h323_8c.html#a662b19f30aa83f4c9b55099b8720e017">oh323_rtp</a>);
<a name="l03296"></a>03296          <a class="code" href="cli_8h.html#a56b6b59ee2eaa994597a5b0f4e9f9d09" title="Unregister multiple commands.">ast_cli_unregister_multiple</a>(<a class="code" href="chan__h323_8c.html#abb56ddafa06a53da731882da397ce655">cli_h323</a>, <span class="keyword">sizeof</span>(<a class="code" href="chan__h323_8c.html#abb56ddafa06a53da731882da397ce655">cli_h323</a>) / <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a>));
<a name="l03297"></a>03297          <a class="code" href="cli_8h.html#a3189e6720486808603d13f5d2b58daf4" title="Unregisters a command or an array of commands.">ast_cli_unregister</a>(&amp;<a class="code" href="chan__h323_8c.html#a3c042f9683086454ebde91b64db19726">cli_h323_reload</a>);
<a name="l03298"></a>03298          h323_end_process();
<a name="l03299"></a>03299          <a class="code" href="io_8h.html#a5409251fbead35b5e59fe322e14446b9" title="Destroys a context.">io_context_destroy</a>(<a class="code" href="chan__h323_8c.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a>);
<a name="l03300"></a>03300          <a class="code" href="sched_8h.html#a7350994bcfd1be91874493dbe25faf0c" title="destroys a schedule context Destroys (free&amp;#39;s) the given sched_context structure...">sched_context_destroy</a>(<a class="code" href="structsched.html">sched</a>);
<a name="l03301"></a>03301 
<a name="l03302"></a>03302          <a class="code" href="astobj_8h.html#a5b923418ce1d4908359bb3b27b211411" title="Empty a container.">ASTOBJ_CONTAINER_DESTROYALL</a>(&amp;<a class="code" href="chan__h323_8c.html#ab8937033f3230cb7adfe1e86d2055a5e" title="H323 User list.">userl</a>, <a class="code" href="chan__h323_8c.html#ad2a4b95f164d86a67d96a23c8714157b">oh323_destroy_user</a>);
<a name="l03303"></a>03303          <a class="code" href="astobj_8h.html#a49ab9467549d53be33f3f9f3ecae97f9" title="Destroy a container.">ASTOBJ_CONTAINER_DESTROY</a>(&amp;<a class="code" href="chan__h323_8c.html#ab8937033f3230cb7adfe1e86d2055a5e" title="H323 User list.">userl</a>);
<a name="l03304"></a>03304          <a class="code" href="astobj_8h.html#a5b923418ce1d4908359bb3b27b211411" title="Empty a container.">ASTOBJ_CONTAINER_DESTROYALL</a>(&amp;<a class="code" href="chan__h323_8c.html#a73d22ff9770f2c94dac6e92c3eddea5f" title="H323 peer list.">peerl</a>, <a class="code" href="chan__h323_8c.html#ad2fe7bc6fcd60293a92f883ff5d03fc0">oh323_destroy_peer</a>);
<a name="l03305"></a>03305          <a class="code" href="astobj_8h.html#a49ab9467549d53be33f3f9f3ecae97f9" title="Destroy a container.">ASTOBJ_CONTAINER_DESTROY</a>(&amp;<a class="code" href="chan__h323_8c.html#a73d22ff9770f2c94dac6e92c3eddea5f" title="H323 peer list.">peerl</a>);
<a name="l03306"></a>03306          <a class="code" href="astobj_8h.html#a5b923418ce1d4908359bb3b27b211411" title="Empty a container.">ASTOBJ_CONTAINER_DESTROYALL</a>(&amp;<a class="code" href="chan__h323_8c.html#a2029bed642f94cb8e3299209b084e585" title="H323 alias list.">aliasl</a>, <a class="code" href="chan__h323_8c.html#a9ebae4396be42baf2785e593f5fede69">oh323_destroy_alias</a>);
<a name="l03307"></a>03307          <a class="code" href="astobj_8h.html#a49ab9467549d53be33f3f9f3ecae97f9" title="Destroy a container.">ASTOBJ_CONTAINER_DESTROY</a>(&amp;<a class="code" href="chan__h323_8c.html#a2029bed642f94cb8e3299209b084e585" title="H323 alias list.">aliasl</a>);
<a name="l03308"></a>03308 
<a name="l03309"></a>03309          <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa8724da3ad620df86524280e760add388">AST_MODULE_LOAD_FAILURE</a>;
<a name="l03310"></a>03310       }
<a name="l03311"></a>03311       <span class="comment">/* Possibly register with a GK */</span>
<a name="l03312"></a>03312       <span class="keywordflow">if</span> (!<a class="code" href="chan__h323_8c.html#abf24fbc8556bb94e3e636bfa53170b7d">gatekeeper_disable</a>) {
<a name="l03313"></a>03313          <span class="keywordflow">if</span> (h323_set_gk(<a class="code" href="chan__h323_8c.html#a1bcd9525b45f12be3151ff75d7f9712f">gatekeeper_discover</a>, <a class="code" href="chan__h323_8c.html#a4bd4778b66bf079c2227fe62ec9a3e73">gatekeeper</a>, <a class="code" href="chan__h323_8c.html#a67fefea55602b6c8d1e29902f600e249">secret</a>)) {
<a name="l03314"></a>03314             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Gatekeeper registration failed.\n&quot;</span>);
<a name="l03315"></a>03315             <a class="code" href="chan__h323_8c.html#abf24fbc8556bb94e3e636bfa53170b7d">gatekeeper_disable</a> = 1;
<a name="l03316"></a>03316             res = <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a>;
<a name="l03317"></a>03317          }
<a name="l03318"></a>03318       }
<a name="l03319"></a>03319       <span class="comment">/* And start the monitor for the first time */</span>
<a name="l03320"></a>03320       <a class="code" href="chan__h323_8c.html#a83af94bb19a421cb25ca02d16fa5ba9c">restart_monitor</a>();
<a name="l03321"></a>03321    }
<a name="l03322"></a>03322    <span class="keywordflow">return</span> res;
<a name="l03323"></a>03323 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab0f013613fb4dcee67919a81a1c725ae"></a><!-- doxytag: member="chan_h323.c::oh323_addrcmp" ref="ab0f013613fb4dcee67919a81a1c725ae" args="(struct sockaddr_in addr, struct sockaddr_in *sin)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int oh323_addrcmp </td>
          <td>(</td>
          <td class="paramtype">struct sockaddr_in&nbsp;</td>
          <td class="paramname"> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>sin</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l01620">1620</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="network_8h_source.html#l00090">inaddrcmp()</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l01632">find_peer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01621"></a>01621 {
<a name="l01622"></a>01622    <span class="keywordtype">int</span> res;
<a name="l01623"></a>01623 
<a name="l01624"></a>01624    <span class="keywordflow">if</span> (!sin)
<a name="l01625"></a>01625       res = -1;
<a name="l01626"></a>01626    <span class="keywordflow">else</span>
<a name="l01627"></a>01627       res = <a class="code" href="network_8h.html#a645471815fc2fff930c75b0494197b3d" title="Compares the source address and port of two sockaddr_in.">inaddrcmp</a>(&amp;addr , sin);
<a name="l01628"></a>01628 
<a name="l01629"></a>01629    <span class="keywordflow">return</span> res;
<a name="l01630"></a>01630 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a95ea09e6112cba4a7a878e9d87bf97e1"></a><!-- doxytag: member="chan_h323.c::oh323_addrcmp_str" ref="a95ea09e6112cba4a7a878e9d87bf97e1" args="(struct in_addr inaddr, char *addr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int oh323_addrcmp_str </td>
          <td>(</td>
          <td class="paramtype">struct in_addr&nbsp;</td>
          <td class="paramname"> <em>inaddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>addr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l01597">1597</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="utils_8c_source.html#l00431">ast_inet_ntoa()</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l01602">find_user()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01598"></a>01598 {
<a name="l01599"></a>01599    <span class="keywordflow">return</span> strcmp(<a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(inaddr), addr);
<a name="l01600"></a>01600 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acec1d7f963be298bd166ec8f869e3462"></a><!-- doxytag: member="chan_h323.c::oh323_alloc" ref="acec1d7f963be298bd166ec8f869e3462" args="(int callid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structoh323__pvt.html">oh323_pvt</a>* oh323_alloc </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>callid</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l01101">1101</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01692">ast_mutex_init()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="rtp_8c_source.html#l03058">ast_rtp_destroy()</a>, <a class="el" href="rtp_8h_source.html#l00043">AST_RTP_DTMF</a>, <a class="el" href="chan__h323_8c_source.html#l00156">oh323_pvt::cd</a>, <a class="el" href="chan__h323_8c_source.html#l00163">oh323_pvt::context</a>, <a class="el" href="chan__h323_8c_source.html#l00182">oh323_pvt::DTMFsched</a>, <a class="el" href="chan__h323_8c.html#af2608cb80e01a744400057785fd1660e">iflist</a>, <a class="el" href="chan__h323_8c_source.html#l00178">oh323_pvt::jointcapability</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="chan__h323_8c_source.html#l00173">oh323_pvt::newcontrol</a>, <a class="el" href="chan__h323_8c_source.html#l00174">oh323_pvt::newdigit</a>, <a class="el" href="chan__h323_8c_source.html#l00172">oh323_pvt::newstate</a>, <a class="el" href="chan__h323_8c_source.html#l00189">oh323_pvt::next</a>, <a class="el" href="chan__h323_8c_source.html#l00160">oh323_pvt::nonCodecCapability</a>, <a class="el" href="chan__h323_8c_source.html#l00153">oh323_pvt::options</a>, <a class="el" href="chan__h323_8c_source.html#l00167">oh323_pvt::rtp</a>, and <a class="el" href="chan__h323_8c_source.html#l00183">oh323_pvt::update_rtp_info</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l01722">oh323_request()</a>, and <a class="el" href="chan__h323_8c_source.html#l02100">setup_incoming_call()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01102"></a>01102 {
<a name="l01103"></a>01103    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *pvt;
<a name="l01104"></a>01104 
<a name="l01105"></a>01105    pvt = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*pvt));
<a name="l01106"></a>01106    <span class="keywordflow">if</span> (!pvt) {
<a name="l01107"></a>01107       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Couldn&apos;t allocate private structure. This is bad\n&quot;</span>);
<a name="l01108"></a>01108       <span class="keywordflow">return</span> NULL;
<a name="l01109"></a>01109    }
<a name="l01110"></a>01110    pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.redirect_reason = -1;
<a name="l01111"></a>01111    pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.transfer_capability = -1;
<a name="l01112"></a>01112    <span class="comment">/* Ensure the call token is allocated for outgoing call */</span>
<a name="l01113"></a>01113    <span class="keywordflow">if</span> (!callid) {
<a name="l01114"></a>01114       <span class="keywordflow">if</span> ((pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>).call_token == NULL) {
<a name="l01115"></a>01115          (pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>).call_token = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, 128);
<a name="l01116"></a>01116       }
<a name="l01117"></a>01117       <span class="keywordflow">if</span> (!pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.call_token) {
<a name="l01118"></a>01118          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Not enough memory to alocate call token\n&quot;</span>);
<a name="l01119"></a>01119          <a class="code" href="rtp_8h.html#a6d2addabf879eb321a660932e3bd57eb">ast_rtp_destroy</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>);
<a name="l01120"></a>01120          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(pvt);
<a name="l01121"></a>01121          <span class="keywordflow">return</span> NULL;
<a name="l01122"></a>01122       }
<a name="l01123"></a>01123       memset((<span class="keywordtype">char</span> *)(pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>).call_token, 0, 128);
<a name="l01124"></a>01124       pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.call_reference = callid;
<a name="l01125"></a>01125    }
<a name="l01126"></a>01126    memcpy(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>, &amp;<a class="code" href="chan__h323_8c.html#ab2aace2a2c551db5a7ce9ccadc159b72">global_options</a>, <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>));
<a name="l01127"></a>01127    pvt-&gt;<a class="code" href="structoh323__pvt.html#a38f5730c90d9315eb1c0df6cfdc37da6">jointcapability</a> = pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.capability;
<a name="l01128"></a>01128    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.dtmfmode &amp; (H323_DTMF_RFC2833 | H323_DTMF_CISCO)) {
<a name="l01129"></a>01129       pvt-&gt;<a class="code" href="structoh323__pvt.html#a08e270ee42ff478a275294762aa0e195">nonCodecCapability</a> |= <a class="code" href="rtp_8h.html#a3cc8001677e3b955b9b5ceb4267a76ec">AST_RTP_DTMF</a>;
<a name="l01130"></a>01130    } <span class="keywordflow">else</span> {
<a name="l01131"></a>01131       pvt-&gt;<a class="code" href="structoh323__pvt.html#a08e270ee42ff478a275294762aa0e195">nonCodecCapability</a> &amp;= ~<a class="code" href="rtp_8h.html#a3cc8001677e3b955b9b5ceb4267a76ec">AST_RTP_DTMF</a>;
<a name="l01132"></a>01132    }
<a name="l01133"></a>01133    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <a class="code" href="chan__h323_8c.html#a7dc6cff9d51743005af0fcf0c37251ad">default_context</a>, <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="structoh323__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>));
<a name="l01134"></a>01134    pvt-&gt;<a class="code" href="structoh323__pvt.html#a6c29a78e6d59b85ce615a046fabd4b0f">newstate</a> = pvt-&gt;<a class="code" href="structoh323__pvt.html#a96512445a0a8d8b2b9f40db190f33f14">newcontrol</a> = pvt-&gt;<a class="code" href="structoh323__pvt.html#a8972b94b384117570fef447df6504fde">newdigit</a> = pvt-&gt;<a class="code" href="structoh323__pvt.html#aa66a6c29649ba7a43eccbcc71f223c3c">update_rtp_info</a> = pvt-&gt;<a class="code" href="structoh323__pvt.html#a065b36acb6c0d5185e203b227f257b9c">DTMFsched</a> = -1;
<a name="l01135"></a>01135    <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01136"></a>01136    <span class="comment">/* Add to interface list */</span>
<a name="l01137"></a>01137    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;iflock);
<a name="l01138"></a>01138    pvt-&gt;<a class="code" href="structoh323__pvt.html#aa892ef2e174a7308e21e4ab3bf7dfdae">next</a> = <a class="code" href="chan__h323_8c.html#af2608cb80e01a744400057785fd1660e" title="Private structure of a OpenH323 channel.">iflist</a>;
<a name="l01139"></a>01139    <a class="code" href="chan__h323_8c.html#af2608cb80e01a744400057785fd1660e" title="Private structure of a OpenH323 channel.">iflist</a> = pvt;
<a name="l01140"></a>01140    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;iflock);
<a name="l01141"></a>01141    <span class="keywordflow">return</span> pvt;
<a name="l01142"></a>01142 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abb92904171d18ca0a9ee3420043d9d91"></a><!-- doxytag: member="chan_h323.c::oh323_answer" ref="abb92904171d18ca0a9ee3420043d9d91" args="(struct ast_channel *c)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int oh323_answer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00658">658</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="channel_8c_source.html#l04695">ast_setstate()</a>, <a class="el" href="channel_8h_source.html#l00365">AST_STATE_UP</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="chan__h323_8c_source.html#l00156">oh323_pvt::cd</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, <a class="el" href="chan__h323_8c_source.html#l00396">oh323_update_info()</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00659"></a>00659 {
<a name="l00660"></a>00660    <span class="keywordtype">int</span> res;
<a name="l00661"></a>00661    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *pvt = (<span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *) c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l00662"></a>00662    <span class="keywordtype">char</span> *token;
<a name="l00663"></a>00663 
<a name="l00664"></a>00664    if (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l00665"></a>00665       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Answering on %s\n&quot;</span>, c-&gt;name);
<a name="l00666"></a>00666 
<a name="l00667"></a>00667    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00668"></a>00668    token = pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.call_token ? <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.call_token) : NULL;
<a name="l00669"></a>00669    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00670"></a>00670    res = h323_answering_call(token, 0);
<a name="l00671"></a>00671    <span class="keywordflow">if</span> (token)
<a name="l00672"></a>00672       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(token);
<a name="l00673"></a>00673 
<a name="l00674"></a>00674    <a class="code" href="chan__h323_8c.html#a9d607a503353cfb6f7b4305b192fda8e" title="Only channel structure should be locked.">oh323_update_info</a>(c);
<a name="l00675"></a>00675    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) {
<a name="l00676"></a>00676       <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(c, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>);
<a name="l00677"></a>00677    }
<a name="l00678"></a>00678    <span class="keywordflow">return</span> res;
<a name="l00679"></a>00679 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7543d0418de5932902c645270071f063"></a><!-- doxytag: member="chan_h323.c::oh323_call" ref="a7543d0418de5932902c645270071f063" args="(struct ast_channel *c, char *dest, int timeout)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int oh323_call </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>timeout</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Make a call over the specified channel to the specified destination. Returns -1 on error, 0 on success. </p>

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00579">579</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="utils_8c_source.html#l00431">ast_inet_ntoa()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="channel_8h_source.html#l00359">AST_STATE_DOWN</a>, <a class="el" href="channel_8h_source.html#l00360">AST_STATE_RESERVED</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="channel_8c_source.html#l00690">ast_transfercapability2str()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="chan__h323_8c_source.html#l00156">oh323_pvt::cd</a>, <a class="el" href="channel_8h_source.html#l00444">ast_channel::cid</a>, <a class="el" href="channel_8h_source.html#l00204">ast_callerid::cid_name</a>, <a class="el" href="channel_8h_source.html#l00203">ast_callerid::cid_num</a>, <a class="el" href="channel_8h_source.html#l00207">ast_callerid::cid_pres</a>, <a class="el" href="channel_8h_source.html#l00206">ast_callerid::cid_rdnis</a>, <a class="el" href="channel_8h_source.html#l00209">ast_callerid::cid_ton</a>, <a class="el" href="chan__h323_8c_source.html#l00162">oh323_pvt::exten</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__h323_8c_source.html#l00396">oh323_update_info()</a>, <a class="el" href="chan__h323_8c_source.html#l00153">oh323_pvt::options</a>, <a class="el" href="chan__h323_8c_source.html#l00161">oh323_pvt::outgoing</a>, <a class="el" href="pbx_8c_source.html#l08951">pbx_builtin_getvar_helper()</a>, <a class="el" href="chan__h323_8c_source.html#l00158">oh323_pvt::sa</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, and <a class="el" href="channel_8h_source.html#l00493">ast_channel::transfercapability</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00580"></a>00580 {
<a name="l00581"></a>00581    <span class="keywordtype">int</span> res = 0;
<a name="l00582"></a>00582    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *pvt = (<span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *)c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l00583"></a>00583    <span class="keyword">const</span> <span class="keywordtype">char</span> *addr;
<a name="l00584"></a>00584    <span class="keywordtype">char</span> called_addr[1024];
<a name="l00585"></a>00585 
<a name="l00586"></a>00586    if (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>) {
<a name="l00587"></a>00587       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Calling to %s on %s\n&quot;</span>, dest, c-&gt;name);
<a name="l00588"></a>00588    }
<a name="l00589"></a>00589    <span class="keywordflow">if</span> ((c-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>) &amp;&amp; (c-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660addb60fd97b55a4aea24f992e30fe3c84">AST_STATE_RESERVED</a>)) {
<a name="l00590"></a>00590       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Line is already in use (%s)\n&quot;</span>, c-&gt;name);
<a name="l00591"></a>00591       <span class="keywordflow">return</span> -1;
<a name="l00592"></a>00592    }
<a name="l00593"></a>00593    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00594"></a>00594    <span class="keywordflow">if</span> (!<a class="code" href="chan__h323_8c.html#abf24fbc8556bb94e3e636bfa53170b7d">gatekeeper_disable</a>) {
<a name="l00595"></a>00595       <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>)) {
<a name="l00596"></a>00596          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(called_addr, dest, <span class="keyword">sizeof</span>(called_addr));
<a name="l00597"></a>00597       } <span class="keywordflow">else</span> {
<a name="l00598"></a>00598          snprintf(called_addr, <span class="keyword">sizeof</span>(called_addr), <span class="stringliteral">&quot;%s@%s&quot;</span>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>, dest);
<a name="l00599"></a>00599       }
<a name="l00600"></a>00600    } <span class="keywordflow">else</span> {
<a name="l00601"></a>00601       res = htons(pvt-&gt;<a class="code" href="structoh323__pvt.html#ab559462aaba22bc0245c6ce056c36981">sa</a>.sin_port);
<a name="l00602"></a>00602       addr = <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#ab559462aaba22bc0245c6ce056c36981">sa</a>.sin_addr);
<a name="l00603"></a>00603       <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>)) {
<a name="l00604"></a>00604          snprintf(called_addr, <span class="keyword">sizeof</span>(called_addr), <span class="stringliteral">&quot;%s:%d&quot;</span>, addr, res);
<a name="l00605"></a>00605       } <span class="keywordflow">else</span> {
<a name="l00606"></a>00606          snprintf(called_addr, <span class="keyword">sizeof</span>(called_addr), <span class="stringliteral">&quot;%s@%s:%d&quot;</span>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>, addr, res);
<a name="l00607"></a>00607       }
<a name="l00608"></a>00608    }
<a name="l00609"></a>00609    <span class="comment">/* make sure null terminated */</span>
<a name="l00610"></a>00610    called_addr[<span class="keyword">sizeof</span>(called_addr) - 1] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00611"></a>00611 
<a name="l00612"></a>00612    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>)
<a name="l00613"></a>00613       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.cid_num, c-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>, <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.cid_num));
<a name="l00614"></a>00614 
<a name="l00615"></a>00615    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a>)
<a name="l00616"></a>00616       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.cid_name, c-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a>, <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.cid_name));
<a name="l00617"></a>00617 
<a name="l00618"></a>00618    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a4791c5f3aedc8782678867a1741f4131">cid_rdnis</a>) {
<a name="l00619"></a>00619       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.cid_rdnis, c-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a4791c5f3aedc8782678867a1741f4131">cid_rdnis</a>, <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.cid_rdnis));
<a name="l00620"></a>00620    }
<a name="l00621"></a>00621 
<a name="l00622"></a>00622    pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.presentation = c-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a5674af3fa5ce1dd1fe052be1477d4110">cid_pres</a>;
<a name="l00623"></a>00623    pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.type_of_number = c-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#aff456ca48d31a9813584e799064cf88e">cid_ton</a>;
<a name="l00624"></a>00624 
<a name="l00625"></a>00625    <span class="keywordflow">if</span> ((addr = <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(c, <span class="stringliteral">&quot;PRIREDIRECTREASON&quot;</span>))) {
<a name="l00626"></a>00626       <span class="keywordflow">if</span> (!strcasecmp(addr, <span class="stringliteral">&quot;UNKNOWN&quot;</span>))
<a name="l00627"></a>00627          pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.redirect_reason = 0;
<a name="l00628"></a>00628       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(addr, <span class="stringliteral">&quot;BUSY&quot;</span>))
<a name="l00629"></a>00629          pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.redirect_reason = 1;
<a name="l00630"></a>00630       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(addr, <span class="stringliteral">&quot;NO_REPLY&quot;</span>) || !strcasecmp(addr, <span class="stringliteral">&quot;NOANSWER&quot;</span>))
<a name="l00631"></a>00631       <span class="comment">/* the NOANSWER is to match diversion-reason from chan_sip, (which never reads PRIREDIRECTREASON) */</span>
<a name="l00632"></a>00632          pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.redirect_reason = 2;
<a name="l00633"></a>00633       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(addr, <span class="stringliteral">&quot;UNCONDITIONAL&quot;</span>))
<a name="l00634"></a>00634          pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.redirect_reason = 15;
<a name="l00635"></a>00635       <span class="keywordflow">else</span>
<a name="l00636"></a>00636          pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.redirect_reason = -1;
<a name="l00637"></a>00637    } <span class="keywordflow">else</span>
<a name="l00638"></a>00638       pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.redirect_reason = -1;
<a name="l00639"></a>00639 
<a name="l00640"></a>00640    pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.transfer_capability = c-&gt;<a class="code" href="structast__channel.html#a67fbfb6a4051ff15a242b9685167f16a">transfercapability</a>;
<a name="l00641"></a>00641 
<a name="l00642"></a>00642    <span class="comment">/* indicate that this is an outgoing call */</span>
<a name="l00643"></a>00643    pvt-&gt;<a class="code" href="structoh323__pvt.html#a586fc7c710ade15aabab8f223e53fdd9">outgoing</a> = 1;
<a name="l00644"></a>00644 
<a name="l00645"></a>00645    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Requested transfer capability: 0x%.2x - %s\n&quot;</span>, c-&gt;<a class="code" href="structast__channel.html#a67fbfb6a4051ff15a242b9685167f16a">transfercapability</a>, <a class="code" href="channel_8h.html#acb027b361350d81e4b94b540fbdfe4e4" title="Gives the string form of a given transfer capability.">ast_transfercapability2str</a>(c-&gt;<a class="code" href="structast__channel.html#a67fbfb6a4051ff15a242b9685167f16a">transfercapability</a>));
<a name="l00646"></a>00646    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l00647"></a>00647       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Placing outgoing call to %s, %d/%d\n&quot;</span>, called_addr, pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.dtmfcodec[0], pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.dtmfcodec[1]);
<a name="l00648"></a>00648    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00649"></a>00649    res = h323_make_call(called_addr, &amp;(pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>), &amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>);
<a name="l00650"></a>00650    <span class="keywordflow">if</span> (res) {
<a name="l00651"></a>00651       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;h323_make_call failed(%s)\n&quot;</span>, c-&gt;name);
<a name="l00652"></a>00652       <span class="keywordflow">return</span> -1;
<a name="l00653"></a>00653    }
<a name="l00654"></a>00654    <a class="code" href="chan__h323_8c.html#a9d607a503353cfb6f7b4305b192fda8e" title="Only channel structure should be locked.">oh323_update_info</a>(c);
<a name="l00655"></a>00655    <span class="keywordflow">return</span> 0;
<a name="l00656"></a>00656 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae0faaef42fdc4a529c953c2a48a902c5"></a><!-- doxytag: member="chan_h323.c::oh323_destroy" ref="ae0faaef42fdc4a529c953c2a48a902c5" args="(struct oh323_pvt *pvt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void oh323_destroy </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structoh323__pvt.html">oh323_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>pvt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00488">488</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="chan__h323_8c_source.html#l00443">__oh323_destroy()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, and <a class="el" href="chan__h323_8c_source.html#l00157">oh323_pvt::owner</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l01722">oh323_request()</a>, and <a class="el" href="chan__h323_8c_source.html#l02100">setup_incoming_call()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00489"></a>00489 {
<a name="l00490"></a>00490    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>) {
<a name="l00491"></a>00491       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Destroying channel %s\n&quot;</span>, (pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> ? pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name : <span class="stringliteral">&quot;&lt;unknown&gt;&quot;</span>));
<a name="l00492"></a>00492    }
<a name="l00493"></a>00493    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;iflock);
<a name="l00494"></a>00494    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00495"></a>00495    <a class="code" href="chan__h323_8c.html#abe8a9c722d92f457598ab1be93e780ea">__oh323_destroy</a>(pvt);
<a name="l00496"></a>00496    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;iflock);
<a name="l00497"></a>00497 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9ebae4396be42baf2785e593f5fede69"></a><!-- doxytag: member="chan_h323.c::oh323_destroy_alias" ref="a9ebae4396be42baf2785e593f5fede69" args="(struct oh323_alias *alias)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void oh323_destroy_alias </td>
          <td>(</td>
          <td class="paramtype">struct oh323_alias *&nbsp;</td>
          <td class="paramname"> <em>alias</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00279">279</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, and <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l02808">delete_aliases()</a>, <a class="el" href="chan__h323_8c_source.html#l03222">load_module()</a>, <a class="el" href="chan__h323_8c_source.html#l02832">reload_config()</a>, and <a class="el" href="chan__h323_8c_source.html#l03325">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00280"></a>00280 {
<a name="l00281"></a>00281    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l00282"></a>00282       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Destroying alias &apos;%s&apos;\n&quot;</span>, alias-&gt;name);
<a name="l00283"></a>00283    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(alias);
<a name="l00284"></a>00284 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad2fe7bc6fcd60293a92f883ff5d03fc0"></a><!-- doxytag: member="chan_h323.c::oh323_destroy_peer" ref="ad2fe7bc6fcd60293a92f883ff5d03fc0" args="(struct oh323_peer *peer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void oh323_destroy_peer </td>
          <td>(</td>
          <td class="paramtype">struct oh323_peer *&nbsp;</td>
          <td class="paramname"> <em>peer</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00294">294</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, and <a class="el" href="acl_8c_source.html#l00217">ast_free_ha()</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l01478">build_peer()</a>, <a class="el" href="chan__h323_8c_source.html#l01650">create_addr()</a>, <a class="el" href="chan__h323_8c_source.html#l03222">load_module()</a>, <a class="el" href="chan__h323_8c_source.html#l02826">prune_peers()</a>, <a class="el" href="chan__h323_8c_source.html#l02832">reload_config()</a>, and <a class="el" href="chan__h323_8c_source.html#l03325">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00295"></a>00295 {
<a name="l00296"></a>00296    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l00297"></a>00297       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Destroying peer &apos;%s&apos;\n&quot;</span>, peer-&gt;name);
<a name="l00298"></a>00298    <a class="code" href="acl_8h.html#a45dc427430b544afc0ef8e898b2c57bf" title="Free host access list.">ast_free_ha</a>(peer-&gt;ha);
<a name="l00299"></a>00299    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(peer);
<a name="l00300"></a>00300 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad2a4b95f164d86a67d96a23c8714157b"></a><!-- doxytag: member="chan_h323.c::oh323_destroy_user" ref="ad2a4b95f164d86a67d96a23c8714157b" args="(struct oh323_user *user)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void oh323_destroy_user </td>
          <td>(</td>
          <td class="paramtype">struct oh323_user *&nbsp;</td>
          <td class="paramname"> <em>user</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00286">286</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, and <a class="el" href="acl_8c_source.html#l00217">ast_free_ha()</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l01360">build_user()</a>, <a class="el" href="chan__h323_8c_source.html#l02782">delete_users()</a>, <a class="el" href="chan__h323_8c_source.html#l03222">load_module()</a>, <a class="el" href="chan__h323_8c_source.html#l02832">reload_config()</a>, <a class="el" href="chan__h323_8c_source.html#l02100">setup_incoming_call()</a>, and <a class="el" href="chan__h323_8c_source.html#l03325">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00287"></a>00287 {
<a name="l00288"></a>00288    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l00289"></a>00289       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Destroying user &apos;%s&apos;\n&quot;</span>, <a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a>-&gt;name);
<a name="l00290"></a>00290    <a class="code" href="acl_8h.html#a45dc427430b544afc0ef8e898b2c57bf" title="Free host access list.">ast_free_ha</a>(<a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a>-&gt;ha);
<a name="l00291"></a>00291    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(<a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a>);
<a name="l00292"></a>00292 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab1fbdbf048ff93fd00351549de0074a5"></a><!-- doxytag: member="chan_h323.c::oh323_digit_begin" ref="ab1fbdbf048ff93fd00351549de0074a5" args="(struct ast_channel *c, char digit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int oh323_digit_begin </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>digit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00499">499</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="rtp_8c_source.html#l03141">ast_rtp_senddigit_begin()</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="chan__h323_8c_source.html#l00156">oh323_pvt::cd</a>, <a class="el" href="chan__h323_8c_source.html#l00180">oh323_pvt::dtmf_pt</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00185">LOG_DTMF</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="chan__h323_8c_source.html#l00396">oh323_update_info()</a>, <a class="el" href="chan__h323_8c_source.html#l00153">oh323_pvt::options</a>, <a class="el" href="chan__h323_8c_source.html#l00167">oh323_pvt::rtp</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, and <a class="el" href="chan__h323_8c_source.html#l00185">oh323_pvt::txDtmfDigit</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00500"></a>00500 {
<a name="l00501"></a>00501    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *pvt = (<span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *) c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l00502"></a>00502    <span class="keywordtype">char</span> *token;
<a name="l00503"></a>00503 
<a name="l00504"></a>00504    if (!pvt) {
<a name="l00505"></a>00505       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No private structure?! This is bad\n&quot;</span>);
<a name="l00506"></a>00506       <span class="keywordflow">return</span> -1;
<a name="l00507"></a>00507    }
<a name="l00508"></a>00508    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00509"></a>00509    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a> &amp;&amp;
<a name="l00510"></a>00510       (((pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.dtmfmode &amp; H323_DTMF_RFC2833) &amp;&amp; pvt-&gt;<a class="code" href="structoh323__pvt.html#a2a424f83ef5dc1995dbf1d6ddf0a9e1f">dtmf_pt</a>[0])
<a name="l00511"></a>00511        <span class="comment">/*|| ((pvt-&gt;options.dtmfmode &amp; H323_DTMF_CISCO) &amp;&amp; pvt-&gt;dtmf_pt[1]))*/</span>)) {
<a name="l00512"></a>00512       <span class="comment">/* out-of-band DTMF */</span>
<a name="l00513"></a>00513       <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>) {
<a name="l00514"></a>00514          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#af360dd5e7b67cff6cb747d1aa2ac3db8">LOG_DTMF</a>, <span class="stringliteral">&quot;Begin sending out-of-band digit %c on %s\n&quot;</span>, digit, c-&gt;name);
<a name="l00515"></a>00515       }
<a name="l00516"></a>00516       <a class="code" href="rtp_8h.html#ad67b565977122712cc970d5a12f124b2" title="Send begin frames for DTMF.">ast_rtp_senddigit_begin</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, digit);
<a name="l00517"></a>00517       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00518"></a>00518    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#a5a687bf4fd9bf6413172924f71dc9d16">txDtmfDigit</a> != digit) {
<a name="l00519"></a>00519       <span class="comment">/* in-band DTMF */</span>
<a name="l00520"></a>00520       <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>) {
<a name="l00521"></a>00521          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#af360dd5e7b67cff6cb747d1aa2ac3db8">LOG_DTMF</a>, <span class="stringliteral">&quot;Begin sending inband digit %c on %s\n&quot;</span>, digit, c-&gt;name);
<a name="l00522"></a>00522       }
<a name="l00523"></a>00523       pvt-&gt;<a class="code" href="structoh323__pvt.html#a5a687bf4fd9bf6413172924f71dc9d16">txDtmfDigit</a> = digit;
<a name="l00524"></a>00524       token = pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.call_token ? <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.call_token) : NULL;
<a name="l00525"></a>00525       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00526"></a>00526       h323_send_tone(token, digit);
<a name="l00527"></a>00527       <span class="keywordflow">if</span> (token) {
<a name="l00528"></a>00528          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(token);
<a name="l00529"></a>00529       }
<a name="l00530"></a>00530    } <span class="keywordflow">else</span>
<a name="l00531"></a>00531       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00532"></a>00532    <a class="code" href="chan__h323_8c.html#a9d607a503353cfb6f7b4305b192fda8e" title="Only channel structure should be locked.">oh323_update_info</a>(c);
<a name="l00533"></a>00533    <span class="keywordflow">return</span> 0;
<a name="l00534"></a>00534 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae6f44cd218ae303ea03b53dca83e4d54"></a><!-- doxytag: member="chan_h323.c::oh323_digit_end" ref="ae6f44cd218ae303ea03b53dca83e4d54" args="(struct ast_channel *c, char digit, unsigned int duration)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int oh323_digit_end </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>digit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>duration</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Send (play) the specified digit to the channel. </p>

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00540">540</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="rtp_8c_source.html#l03243">ast_rtp_senddigit_end()</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="chan__h323_8c_source.html#l00156">oh323_pvt::cd</a>, <a class="el" href="chan__h323_8c_source.html#l00180">oh323_pvt::dtmf_pt</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00185">LOG_DTMF</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="chan__h323_8c_source.html#l00396">oh323_update_info()</a>, <a class="el" href="chan__h323_8c_source.html#l00153">oh323_pvt::options</a>, <a class="el" href="chan__h323_8c_source.html#l00167">oh323_pvt::rtp</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, and <a class="el" href="chan__h323_8c_source.html#l00185">oh323_pvt::txDtmfDigit</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00541"></a>00541 {
<a name="l00542"></a>00542    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *pvt = (<span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *) c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l00543"></a>00543    <span class="keywordtype">char</span> *token;
<a name="l00544"></a>00544 
<a name="l00545"></a>00545    if (!pvt) {
<a name="l00546"></a>00546       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No private structure?! This is bad\n&quot;</span>);
<a name="l00547"></a>00547       <span class="keywordflow">return</span> -1;
<a name="l00548"></a>00548    }
<a name="l00549"></a>00549    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00550"></a>00550    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a> &amp;&amp; (pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.dtmfmode &amp; H323_DTMF_RFC2833) &amp;&amp; ((pvt-&gt;<a class="code" href="structoh323__pvt.html#a2a424f83ef5dc1995dbf1d6ddf0a9e1f">dtmf_pt</a>[0] &gt; 0) || (pvt-&gt;<a class="code" href="structoh323__pvt.html#a2a424f83ef5dc1995dbf1d6ddf0a9e1f">dtmf_pt</a>[0] &gt; 0))) {
<a name="l00551"></a>00551       <span class="comment">/* out-of-band DTMF */</span>
<a name="l00552"></a>00552       <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>) {
<a name="l00553"></a>00553          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#af360dd5e7b67cff6cb747d1aa2ac3db8">LOG_DTMF</a>, <span class="stringliteral">&quot;End sending out-of-band digit %c on %s, duration %d\n&quot;</span>, digit, c-&gt;name, duration);
<a name="l00554"></a>00554       }
<a name="l00555"></a>00555       <a class="code" href="rtp_8h.html#a75bc4adaf04f7e5348fc73608c3b1ebc" title="Send end packets for DTMF.">ast_rtp_senddigit_end</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, digit);
<a name="l00556"></a>00556       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00557"></a>00557    } <span class="keywordflow">else</span> {
<a name="l00558"></a>00558       <span class="comment">/* in-band DTMF */</span>
<a name="l00559"></a>00559       <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>) {
<a name="l00560"></a>00560          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#af360dd5e7b67cff6cb747d1aa2ac3db8">LOG_DTMF</a>, <span class="stringliteral">&quot;End sending inband digit %c on %s, duration %d\n&quot;</span>, digit, c-&gt;name, duration);
<a name="l00561"></a>00561       }
<a name="l00562"></a>00562       pvt-&gt;<a class="code" href="structoh323__pvt.html#a5a687bf4fd9bf6413172924f71dc9d16">txDtmfDigit</a> = <span class="charliteral">&apos; &apos;</span>;
<a name="l00563"></a>00563       token = pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.call_token ? <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.call_token) : NULL;
<a name="l00564"></a>00564       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00565"></a>00565       h323_send_tone(token, <span class="charliteral">&apos; &apos;</span>);
<a name="l00566"></a>00566       <span class="keywordflow">if</span> (token) {
<a name="l00567"></a>00567          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(token);
<a name="l00568"></a>00568       }
<a name="l00569"></a>00569    }
<a name="l00570"></a>00570    <a class="code" href="chan__h323_8c.html#a9d607a503353cfb6f7b4305b192fda8e" title="Only channel structure should be locked.">oh323_update_info</a>(c);
<a name="l00571"></a>00571    <span class="keywordflow">return</span> 0;
<a name="l00572"></a>00572 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a775105a2a46963e0eadff7804c84a5e5"></a><!-- doxytag: member="chan_h323.c::oh323_fixup" ref="a775105a2a46963e0eadff7804c84a5e5" args="(struct ast_channel *oldchan, struct ast_channel *newchan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int oh323_fixup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>oldchan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>newchan</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00937">937</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__h323_8c_source.html#l00157">oh323_pvt::owner</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00938"></a>00938 {
<a name="l00939"></a>00939    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *pvt = (<span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *) newchan-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l00940"></a>00940 
<a name="l00941"></a>00941    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00942"></a>00942    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> != oldchan) {
<a name="l00943"></a>00943       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;old channel wasn&apos;t %p but was %p\n&quot;</span>, oldchan, pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l00944"></a>00944       <span class="keywordflow">return</span> -1;
<a name="l00945"></a>00945    }
<a name="l00946"></a>00946    pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = newchan;
<a name="l00947"></a>00947    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00948"></a>00948    <span class="keywordflow">return</span> 0;
<a name="l00949"></a>00949 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4ede66ddfa71389a1cf63f7a7b605985"></a><!-- doxytag: member="chan_h323.c::oh323_get_rtp_peer" ref="a4ede66ddfa71389a1cf63f7a7b605985" args="(struct ast_channel *chan, struct ast_rtp **rtp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95">ast_rtp_get_result</a> oh323_get_rtp_peer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> **&nbsp;</td>
          <td class="paramname"> <em>rtp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l03137">3137</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="rtp_8h_source.html#l00065">AST_RTP_GET_FAILED</a>, <a class="el" href="rtp_8h_source.html#l00069">AST_RTP_TRY_NATIVE</a>, <a class="el" href="rtp_8h_source.html#l00067">AST_RTP_TRY_PARTIAL</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, <a class="el" href="chan__h323_8c_source.html#l00153">oh323_pvt::options</a>, <a class="el" href="chan__h323_8c_source.html#l00167">oh323_pvt::rtp</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03138"></a>03138 {
<a name="l03139"></a>03139    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *pvt;
<a name="l03140"></a>03140    <span class="keyword">enum</span> <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95">ast_rtp_get_result</a> res = <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95a8bc993394ab95ca4c2ac98f9477518fe">AST_RTP_TRY_PARTIAL</a>;
<a name="l03141"></a>03141 
<a name="l03142"></a>03142    <span class="keywordflow">if</span> (!(pvt = (<span class="keyword">struct</span> <a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *)chan-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>))
<a name="l03143"></a>03143       <span class="keywordflow">return</span> <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>;
<a name="l03144"></a>03144 
<a name="l03145"></a>03145    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03146"></a>03146    *rtp = pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>;
<a name="l03147"></a>03147 <span class="preprocessor">#if 0</span>
<a name="l03148"></a>03148 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.bridge) {
<a name="l03149"></a>03149       res = <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ab591abc73866492b4b33dd96d9925136">AST_RTP_TRY_NATIVE</a>;
<a name="l03150"></a>03150    }
<a name="l03151"></a>03151 <span class="preprocessor">#endif</span>
<a name="l03152"></a>03152 <span class="preprocessor"></span>   <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03153"></a>03153 
<a name="l03154"></a>03154    <span class="keywordflow">return</span> res;
<a name="l03155"></a>03155 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7fe40032c649a3ca7861d2bb65f7a835"></a><!-- doxytag: member="chan_h323.c::oh323_get_vrtp_peer" ref="a7fe40032c649a3ca7861d2bb65f7a835" args="(struct ast_channel *chan, struct ast_rtp **rtp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95">ast_rtp_get_result</a> oh323_get_vrtp_peer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> **&nbsp;</td>
          <td class="paramname"> <em>rtp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l03157">3157</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="rtp_8h_source.html#l00065">AST_RTP_GET_FAILED</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03158"></a>03158 {
<a name="l03159"></a>03159    <span class="keywordflow">return</span> <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>;
<a name="l03160"></a>03160 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a972114df5bdd7b6858d15c0c83d3643c"></a><!-- doxytag: member="chan_h323.c::oh323_hangup" ref="a972114df5bdd7b6858d15c0c83d3643c" args="(struct ast_channel *c)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int oh323_hangup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00681">681</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="chan__h323_8c_source.html#l00154">oh323_pvt::alreadygone</a>, <a class="el" href="causes_8h_source.html#l00107">AST_CAUSE_CALL_REJECTED</a>, <a class="el" href="causes_8h_source.html#l00105">AST_CAUSE_NO_ANSWER</a>, <a class="el" href="causes_8h_source.html#l00114">AST_CAUSE_NORMAL_CIRCUIT_CONGESTION</a>, <a class="el" href="causes_8h_source.html#l00102">AST_CAUSE_NORMAL_CLEARING</a>, <a class="el" href="causes_8h_source.html#l00119">AST_CAUSE_REQUESTED_CHAN_UNAVAIL</a>, <a class="el" href="causes_8h_source.html#l00103">AST_CAUSE_USER_BUSY</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="loader_8c_source.html#l01171">ast_module_unref()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="channel_8c_source.html#l00136">cause</a>, <a class="el" href="chan__h323_8c_source.html#l00156">oh323_pvt::cd</a>, <a class="el" href="chan__h323_8c_source.html#l00171">oh323_pvt::hangupcause</a>, <a class="el" href="channel_8h_source.html#l00479">ast_channel::hangupcause</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__h323_8c_source.html#l00155">oh323_pvt::needdestroy</a>, <a class="el" href="chan__h323_8c_source.html#l00157">oh323_pvt::owner</a>, <a class="el" href="pbx_8c_source.html#l08951">pbx_builtin_getvar_helper()</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00682"></a>00682 {
<a name="l00683"></a>00683    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *pvt = (<span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *) c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l00684"></a>00684    <span class="keywordtype">int</span> q931cause = <a class="code" href="causes_8h.html#af2235eb1c27925e4020ce286255d165f">AST_CAUSE_NORMAL_CLEARING</a>;
<a name="l00685"></a>00685    <span class="keywordtype">char</span> *call_token;
<a name="l00686"></a>00686 
<a name="l00687"></a>00687 
<a name="l00688"></a>00688    if (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l00689"></a>00689       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Hanging up and scheduling destroy of call %s\n&quot;</span>, c-&gt;name);
<a name="l00690"></a>00690 
<a name="l00691"></a>00691    <span class="keywordflow">if</span> (!c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>) {
<a name="l00692"></a>00692       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Asked to hangup channel not connected\n&quot;</span>);
<a name="l00693"></a>00693       <span class="keywordflow">return</span> 0;
<a name="l00694"></a>00694    }
<a name="l00695"></a>00695    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00696"></a>00696    <span class="comment">/* Determine how to disconnect */</span>
<a name="l00697"></a>00697    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> != c) {
<a name="l00698"></a>00698       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Huh?  We aren&apos;t the owner?\n&quot;</span>);
<a name="l00699"></a>00699       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00700"></a>00700       <span class="keywordflow">return</span> 0;
<a name="l00701"></a>00701    }
<a name="l00702"></a>00702 
<a name="l00703"></a>00703    pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = NULL;
<a name="l00704"></a>00704    c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a> = NULL;
<a name="l00705"></a>00705 
<a name="l00706"></a>00706    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structast__channel.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a>) {
<a name="l00707"></a>00707       q931cause = c-&gt;<a class="code" href="structast__channel.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a>;
<a name="l00708"></a>00708    } <span class="keywordflow">else</span> {
<a name="l00709"></a>00709       <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a> = <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(c, <span class="stringliteral">&quot;DIALSTATUS&quot;</span>);
<a name="l00710"></a>00710       <span class="keywordflow">if</span> (cause) {
<a name="l00711"></a>00711          <span class="keywordflow">if</span> (!strcmp(cause, <span class="stringliteral">&quot;CONGESTION&quot;</span>)) {
<a name="l00712"></a>00712             q931cause = <a class="code" href="causes_8h.html#a84f3380611feeec35bb25319b26f92fd">AST_CAUSE_NORMAL_CIRCUIT_CONGESTION</a>;
<a name="l00713"></a>00713          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(cause, <span class="stringliteral">&quot;BUSY&quot;</span>)) {
<a name="l00714"></a>00714             q931cause = <a class="code" href="causes_8h.html#aff0e956cb3ef657557fa468a17416c0b">AST_CAUSE_USER_BUSY</a>;
<a name="l00715"></a>00715          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(cause, <span class="stringliteral">&quot;CHANISUNVAIL&quot;</span>)) {
<a name="l00716"></a>00716             q931cause = <a class="code" href="causes_8h.html#a7f49d27e9e3876fb4ccf1d139d31db73">AST_CAUSE_REQUESTED_CHAN_UNAVAIL</a>;
<a name="l00717"></a>00717          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(cause, <span class="stringliteral">&quot;NOANSWER&quot;</span>)) {
<a name="l00718"></a>00718             q931cause = <a class="code" href="causes_8h.html#af03fc9fe2f0ecc69330e014aff8d0f73">AST_CAUSE_NO_ANSWER</a>;
<a name="l00719"></a>00719          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(cause, <span class="stringliteral">&quot;CANCEL&quot;</span>)) {
<a name="l00720"></a>00720             q931cause = <a class="code" href="causes_8h.html#a9900b24b261c275bb54631f16d4d38cc">AST_CAUSE_CALL_REJECTED</a>;
<a name="l00721"></a>00721          }
<a name="l00722"></a>00722       }
<a name="l00723"></a>00723    }
<a name="l00724"></a>00724 
<a name="l00725"></a>00725    <span class="comment">/* Start the process if it&apos;s not already started */</span>
<a name="l00726"></a>00726    <span class="keywordflow">if</span> (!pvt-&gt;<a class="code" href="structoh323__pvt.html#ac43993a73742eff145b861107a1afa0d">alreadygone</a> &amp;&amp; !pvt-&gt;<a class="code" href="structoh323__pvt.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a>) {
<a name="l00727"></a>00727       call_token = pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.call_token ? <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.call_token) : NULL;
<a name="l00728"></a>00728       <span class="keywordflow">if</span> (call_token) {
<a name="l00729"></a>00729          <span class="comment">/* Release lock to eliminate deadlock */</span>
<a name="l00730"></a>00730          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00731"></a>00731          <span class="keywordflow">if</span> (h323_clear_call(call_token, q931cause)) {
<a name="l00732"></a>00732             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;ClearCall failed.\n&quot;</span>);
<a name="l00733"></a>00733          }
<a name="l00734"></a>00734          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(call_token);
<a name="l00735"></a>00735          <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00736"></a>00736       }
<a name="l00737"></a>00737    }
<a name="l00738"></a>00738    pvt-&gt;<a class="code" href="structoh323__pvt.html#a68a26c888924e997c3ce5fdb6273bf7f">needdestroy</a> = 1;
<a name="l00739"></a>00739    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00740"></a>00740 
<a name="l00741"></a>00741    <span class="comment">/* Update usage counter */</span>
<a name="l00742"></a>00742    <a class="code" href="module_8h.html#ac65fa15b16dbc563a2424af744ab003d">ast_module_unref</a>(<a class="code" href="structast__module__info.html">ast_module_info</a>-&gt;self);
<a name="l00743"></a>00743 
<a name="l00744"></a>00744    <span class="keywordflow">return</span> 0;
<a name="l00745"></a>00745 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a13b1532a4ef67feabec91cb317470d29"></a><!-- doxytag: member="chan_h323.c::oh323_indicate" ref="a13b1532a4ef67feabec91cb317470d29" args="(struct ast_channel *c, int condition, const void *data, size_t datalen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int oh323_indicate </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>condition</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>datalen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00856">856</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="chan__h323_8c_source.html#l00154">oh323_pvt::alreadygone</a>, <a class="el" href="frame_8h_source.html#l00302">AST_CONTROL_BUSY</a>, <a class="el" href="frame_8h_source.html#l00305">AST_CONTROL_CONGESTION</a>, <a class="el" href="frame_8h_source.html#l00313">AST_CONTROL_HOLD</a>, <a class="el" href="frame_8h_source.html#l00312">AST_CONTROL_PROCEEDING</a>, <a class="el" href="frame_8h_source.html#l00311">AST_CONTROL_PROGRESS</a>, <a class="el" href="frame_8h_source.html#l00300">AST_CONTROL_RINGING</a>, <a class="el" href="frame_8h_source.html#l00317">AST_CONTROL_SRCUPDATE</a>, <a class="el" href="frame_8h_source.html#l00314">AST_CONTROL_UNHOLD</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8c_source.html#l05538">ast_moh_start()</a>, <a class="el" href="channel_8c_source.html#l05549">ast_moh_stop()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="rtp_8c_source.html#l02646">ast_rtp_new_source()</a>, <a class="el" href="channel_8h_source.html#l00633">AST_SOFTHANGUP_DEV</a>, <a class="el" href="channel_8c_source.html#l01653">ast_softhangup_nolock()</a>, <a class="el" href="channel_8h_source.html#l00363">AST_STATE_RING</a>, <a class="el" href="channel_8h_source.html#l00364">AST_STATE_RINGING</a>, <a class="el" href="channel_8h_source.html#l00365">AST_STATE_UP</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="chan__h323_8c_source.html#l00156">oh323_pvt::cd</a>, <a class="el" href="chan__h323_8c_source.html#l00188">oh323_pvt::got_progress</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__h323_8c_source.html#l00396">oh323_update_info()</a>, <a class="el" href="chan__h323_8c_source.html#l00167">oh323_pvt::rtp</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00857"></a>00857 {
<a name="l00858"></a>00858 
<a name="l00859"></a>00859    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *pvt = (<span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *) c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l00860"></a>00860    <span class="keywordtype">char</span> *token = (<span class="keywordtype">char</span> *)NULL;
<a name="l00861"></a>00861    <span class="keywordtype">int</span> res = -1;
<a name="l00862"></a>00862    <span class="keywordtype">int</span> <a class="code" href="structoh323__pvt.html#ae9dde1134e297efd2b92379244171d95">got_progress</a>;
<a name="l00863"></a>00863 
<a name="l00864"></a>00864    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00865"></a>00865    token = (pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.call_token ? <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.call_token) : NULL);
<a name="l00866"></a>00866    got_progress = pvt-&gt;<a class="code" href="structoh323__pvt.html#ae9dde1134e297efd2b92379244171d95">got_progress</a>;
<a name="l00867"></a>00867    <span class="keywordflow">if</span> (condition == <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a1a461c5e737ed6ed7c8cb0f78557a6fd">AST_CONTROL_PROGRESS</a>)
<a name="l00868"></a>00868       pvt-&gt;<a class="code" href="structoh323__pvt.html#ae9dde1134e297efd2b92379244171d95">got_progress</a> = 1;
<a name="l00869"></a>00869    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((condition == <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875">AST_CONTROL_BUSY</a>) || (condition == <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a850bb06a1702741c93a3fd67cc9637ab">AST_CONTROL_CONGESTION</a>))
<a name="l00870"></a>00870       pvt-&gt;<a class="code" href="structoh323__pvt.html#ac43993a73742eff145b861107a1afa0d">alreadygone</a> = 1;
<a name="l00871"></a>00871    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00872"></a>00872 
<a name="l00873"></a>00873    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l00874"></a>00874       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OH323: Indicating %d on %s (%s)\n&quot;</span>, condition, token, c-&gt;name);
<a name="l00875"></a>00875 
<a name="l00876"></a>00876    <span class="keywordflow">switch</span>(condition) {
<a name="l00877"></a>00877    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a>:
<a name="l00878"></a>00878       <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a> || c-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>) {
<a name="l00879"></a>00879          h323_send_alerting(token);
<a name="l00880"></a>00880          res = (got_progress ? 0 : -1);   <span class="comment">/* Do not simulate any audio tones if we got PROGRESS message */</span>
<a name="l00881"></a>00881       }
<a name="l00882"></a>00882       <span class="keywordflow">break</span>;
<a name="l00883"></a>00883    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a1a461c5e737ed6ed7c8cb0f78557a6fd">AST_CONTROL_PROGRESS</a>:
<a name="l00884"></a>00884       <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) {
<a name="l00885"></a>00885          <span class="comment">/* Do not send PROGRESS message more than once */</span>
<a name="l00886"></a>00886          <span class="keywordflow">if</span> (!got_progress)
<a name="l00887"></a>00887             h323_send_progress(token);
<a name="l00888"></a>00888          res = 0;
<a name="l00889"></a>00889       }
<a name="l00890"></a>00890       <span class="keywordflow">break</span>;
<a name="l00891"></a>00891    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875">AST_CONTROL_BUSY</a>:
<a name="l00892"></a>00892       <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) {
<a name="l00893"></a>00893          h323_answering_call(token, 1);
<a name="l00894"></a>00894          <a class="code" href="channel_8h.html#ae90da1877e143b996d202d4c88a9c862" title="Softly hangup up a channel (no channel lock).">ast_softhangup_nolock</a>(c, <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709a2e185ce313026e13ed90ae3a319c9cb7">AST_SOFTHANGUP_DEV</a>);
<a name="l00895"></a>00895          res = 0;
<a name="l00896"></a>00896       }
<a name="l00897"></a>00897       <span class="keywordflow">break</span>;
<a name="l00898"></a>00898    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a850bb06a1702741c93a3fd67cc9637ab">AST_CONTROL_CONGESTION</a>:
<a name="l00899"></a>00899       <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) {
<a name="l00900"></a>00900          h323_answering_call(token, 1);
<a name="l00901"></a>00901          <a class="code" href="channel_8h.html#ae90da1877e143b996d202d4c88a9c862" title="Softly hangup up a channel (no channel lock).">ast_softhangup_nolock</a>(c, <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709a2e185ce313026e13ed90ae3a319c9cb7">AST_SOFTHANGUP_DEV</a>);
<a name="l00902"></a>00902          res = 0;
<a name="l00903"></a>00903       }
<a name="l00904"></a>00904       <span class="keywordflow">break</span>;
<a name="l00905"></a>00905    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ab99a3d1c08c5ae8bca078c7cd1ec02f5">AST_CONTROL_HOLD</a>:
<a name="l00906"></a>00906       h323_hold_call(token, 1);
<a name="l00907"></a>00907       <span class="comment">/* We should start MOH only if remote party isn&apos;t provide audio for us */</span>
<a name="l00908"></a>00908       <a class="code" href="musiconhold_8h.html#a2acec01f2fddd8ca494d874003815cf7" title="Turn on music on hold on a given channel.">ast_moh_start</a>(c, data, NULL);
<a name="l00909"></a>00909       res = 0;
<a name="l00910"></a>00910       <span class="keywordflow">break</span>;
<a name="l00911"></a>00911    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>:
<a name="l00912"></a>00912       h323_hold_call(token, 0);
<a name="l00913"></a>00913       <a class="code" href="musiconhold_8h.html#a52fead32f69533450f3c05b2e6960149" title="Turn off music on hold on a given channel.">ast_moh_stop</a>(c);
<a name="l00914"></a>00914       res = 0;
<a name="l00915"></a>00915       <span class="keywordflow">break</span>;
<a name="l00916"></a>00916    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a009e81151b19671f42b5e84ab6a619f4">AST_CONTROL_SRCUPDATE</a>:
<a name="l00917"></a>00917       <a class="code" href="rtp_8h.html#a858a9803ad1b78fc1b9602bb9cad1411">ast_rtp_new_source</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>);
<a name="l00918"></a>00918       res = 0;
<a name="l00919"></a>00919       <span class="keywordflow">break</span>;
<a name="l00920"></a>00920    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a50b7fe33bba67b74dd7b746539e81000">AST_CONTROL_PROCEEDING</a>:
<a name="l00921"></a>00921    <span class="keywordflow">case</span> -1:
<a name="l00922"></a>00922       <span class="keywordflow">break</span>;
<a name="l00923"></a>00923    <span class="keywordflow">default</span>:
<a name="l00924"></a>00924       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;OH323: Don&apos;t know how to indicate condition %d on %s\n&quot;</span>, condition, token);
<a name="l00925"></a>00925       <span class="keywordflow">break</span>;
<a name="l00926"></a>00926    }
<a name="l00927"></a>00927 
<a name="l00928"></a>00928    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l00929"></a>00929       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OH323: Indicated %d on %s, res=%d\n&quot;</span>, condition, token, res);
<a name="l00930"></a>00930    <span class="keywordflow">if</span> (token)
<a name="l00931"></a>00931       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(token);
<a name="l00932"></a>00932    <a class="code" href="chan__h323_8c.html#a9d607a503353cfb6f7b4305b192fda8e" title="Only channel structure should be locked.">oh323_update_info</a>(c);
<a name="l00933"></a>00933 
<a name="l00934"></a>00934    <span class="keywordflow">return</span> res;
<a name="l00935"></a>00935 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adcbc32265d679075f1aaa98bad45d360"></a><!-- doxytag: member="chan_h323.c::oh323_read" ref="adcbc32265d679075f1aaa98bad45d360" args="(struct ast_channel *c)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__frame.html">ast_frame</a> * oh323_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00803">803</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="chan__h323_8c_source.html#l00332">__oh323_update_info()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="frame_8c_source.html#l00124">ast_null_frame</a>, <a class="el" href="rtp_8c_source.html#l01168">ast_rtcp_read()</a>, <a class="el" href="channel_8h_source.html#l00464">ast_channel::fdno</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="chan__h323_8c_source.html#l00748">oh323_rtp_read()</a>, <a class="el" href="chan__h323_8c_source.html#l00167">oh323_pvt::rtp</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00804"></a>00804 {
<a name="l00805"></a>00805    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *fr;
<a name="l00806"></a>00806    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *pvt = (<span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *)c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l00807"></a>00807    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00808"></a>00808    <a class="code" href="chan__h323_8c.html#ac83c5df72d69f2472b7bd1fd36b634cb" title="Channel and private structures should be already locked.">__oh323_update_info</a>(c, pvt);
<a name="l00809"></a>00809    <span class="keywordflow">switch</span>(c-&gt;<a class="code" href="structast__channel.html#a3a804162c4be609a8def28f69b3e93b2">fdno</a>) {
<a name="l00810"></a>00810    <span class="keywordflow">case</span> 0:
<a name="l00811"></a>00811       fr = <a class="code" href="chan__h323_8c.html#ad8f15f265c65347173e83fbfb9f9880b" title="Retrieve audio/etc from channel. Assumes pvt-&amp;gt;lock is already held.">oh323_rtp_read</a>(pvt);
<a name="l00812"></a>00812       <span class="keywordflow">break</span>;
<a name="l00813"></a>00813    <span class="keywordflow">case</span> 1:
<a name="l00814"></a>00814       <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>)
<a name="l00815"></a>00815          fr = <a class="code" href="rtp_8h.html#ad2add11e197fbff70b7ff710f90e617f">ast_rtcp_read</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>);
<a name="l00816"></a>00816       <span class="keywordflow">else</span>
<a name="l00817"></a>00817          fr = &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l00818"></a>00818       <span class="keywordflow">break</span>;
<a name="l00819"></a>00819    <span class="keywordflow">default</span>:
<a name="l00820"></a>00820       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to handle fd %d on channel %s\n&quot;</span>, c-&gt;<a class="code" href="structast__channel.html#a3a804162c4be609a8def28f69b3e93b2">fdno</a>, c-&gt;name);
<a name="l00821"></a>00821       fr = &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l00822"></a>00822       <span class="keywordflow">break</span>;
<a name="l00823"></a>00823    }
<a name="l00824"></a>00824    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00825"></a>00825    <span class="keywordflow">return</span> fr;
<a name="l00826"></a>00826 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af86f2a525b1e58cf7b2853001b0d2345"></a><!-- doxytag: member="chan_h323.c::oh323_request" ref="af86f2a525b1e58cf7b2853001b0d2345" args="(const char *type, int format, void *data, int *cause)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__channel.html">ast_channel</a> * oh323_request </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>cause</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l01722">1722</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="chan__h323_8c_source.html#l00999">__oh323_new()</a>, <a class="el" href="causes_8h_source.html#l00109">AST_CAUSE_DESTINATION_OUT_OF_ORDER</a>, <a class="el" href="causes_8h_source.html#l00130">AST_CAUSE_INCOMPATIBLE_DESTINATION</a>, <a class="el" href="causes_8h_source.html#l00116">AST_CAUSE_NORMAL_TEMPORARY_FAILURE</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8h_source.html#l00273">AST_FORMAT_AUDIO_MASK</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="rtp_8h_source.html#l00043">AST_RTP_DTMF</a>, <a class="el" href="channel_8h_source.html#l00359">AST_STATE_DOWN</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="loader_8c_source.html#l01085">ast_update_use_count()</a>, <a class="el" href="chan__h323_8c_source.html#l01650">create_addr()</a>, <a class="el" href="http_8c_source.html#l00097">ext</a>, <a class="el" href="chan__h323_8c_source.html#l00162">oh323_pvt::exten</a>, <a class="el" href="chan__h323_8c_source.html#l00178">oh323_pvt::jointcapability</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__h323_8c_source.html#l00160">oh323_pvt::nonCodecCapability</a>, <a class="el" href="chan__h323_8c_source.html#l01101">oh323_alloc()</a>, <a class="el" href="chan__h323_8c_source.html#l00488">oh323_destroy()</a>, <a class="el" href="chan__h323_8c_source.html#l00153">oh323_pvt::options</a>, and <a class="el" href="chan__h323_8c_source.html#l02597">restart_monitor()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01723"></a>01723 {
<a name="l01724"></a>01724    <span class="keywordtype">int</span> oldformat;
<a name="l01725"></a>01725    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *pvt;
<a name="l01726"></a>01726    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *tmpc = NULL;
<a name="l01727"></a>01727    <span class="keywordtype">char</span> *dest = (<span class="keywordtype">char</span> *)<a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>;
<a name="l01728"></a>01728    <span class="keywordtype">char</span> *<a class="code" href="http_8c.html#af9b32121c4ad80b0887a3d73fd24de5f">ext</a>, *host;
<a name="l01729"></a>01729    <span class="keywordtype">char</span> *h323id = NULL;
<a name="l01730"></a>01730    <span class="keywordtype">char</span> tmp[256], tmp1[256];
<a name="l01731"></a>01731 
<a name="l01732"></a>01732    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l01733"></a>01733       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;type=%s, format=%d, data=%s.\n&quot;</span>, <a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>, (<span class="keywordtype">char</span> *)<a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>);
<a name="l01734"></a>01734 
<a name="l01735"></a>01735    pvt = <a class="code" href="chan__h323_8c.html#acec1d7f963be298bd166ec8f869e3462">oh323_alloc</a>(0);
<a name="l01736"></a>01736    <span class="keywordflow">if</span> (!pvt) {
<a name="l01737"></a>01737       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to build pvt data for &apos;%s&apos;\n&quot;</span>, (<span class="keywordtype">char</span> *)<a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>);
<a name="l01738"></a>01738       <span class="keywordflow">return</span> NULL;
<a name="l01739"></a>01739    }
<a name="l01740"></a>01740    oldformat = <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>;
<a name="l01741"></a>01741    <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a> &amp;= <a class="code" href="frame_8h.html#a3f680b9c15596de927d507a664fd2803">AST_FORMAT_AUDIO_MASK</a>;
<a name="l01742"></a>01742    <span class="keywordflow">if</span> (!<a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>) {
<a name="l01743"></a>01743       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Asked to get a channel of unsupported format &apos;%d&apos;\n&quot;</span>, <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>);
<a name="l01744"></a>01744       <a class="code" href="chan__h323_8c.html#ae0faaef42fdc4a529c953c2a48a902c5">oh323_destroy</a>(pvt);
<a name="l01745"></a>01745       <span class="keywordflow">if</span> (<a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>)
<a name="l01746"></a>01746          *<a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a> = <a class="code" href="causes_8h.html#a4c378d6f7b9d40dee77d74fa7c5d91e4">AST_CAUSE_INCOMPATIBLE_DESTINATION</a>;
<a name="l01747"></a>01747       <span class="keywordflow">return</span> NULL;
<a name="l01748"></a>01748    }
<a name="l01749"></a>01749    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp, dest, <span class="keyword">sizeof</span>(tmp));
<a name="l01750"></a>01750    host = strchr(tmp, <span class="charliteral">&apos;@&apos;</span>);
<a name="l01751"></a>01751    <span class="keywordflow">if</span> (host) {
<a name="l01752"></a>01752       *host = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01753"></a>01753       host++;
<a name="l01754"></a>01754       ext = tmp;
<a name="l01755"></a>01755    } <span class="keywordflow">else</span> {
<a name="l01756"></a>01756       ext = strrchr(tmp, <span class="charliteral">&apos;/&apos;</span>);
<a name="l01757"></a>01757       <span class="keywordflow">if</span> (ext)
<a name="l01758"></a>01758          *ext++ = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01759"></a>01759       host = tmp;
<a name="l01760"></a>01760    }
<a name="l01761"></a>01761    strtok_r(host, <span class="stringliteral">&quot;/&quot;</span>, &amp;(h323id));
<a name="l01762"></a>01762    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(h323id)) {
<a name="l01763"></a>01763       h323_set_id(h323id);
<a name="l01764"></a>01764    }
<a name="l01765"></a>01765    <span class="keywordflow">if</span> (ext) {
<a name="l01766"></a>01766       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>, ext, <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>));
<a name="l01767"></a>01767    }
<a name="l01768"></a>01768    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l01769"></a>01769       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Extension: %s Host: %s\n&quot;</span>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>, host);
<a name="l01770"></a>01770 
<a name="l01771"></a>01771    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#abf24fbc8556bb94e3e636bfa53170b7d">gatekeeper_disable</a>) {
<a name="l01772"></a>01772       <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aff6ea052d0552e2899a61b2eaad9ca7e">create_addr</a>(pvt, host)) {
<a name="l01773"></a>01773          <a class="code" href="chan__h323_8c.html#ae0faaef42fdc4a529c953c2a48a902c5">oh323_destroy</a>(pvt);
<a name="l01774"></a>01774          <span class="keywordflow">if</span> (<a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>)
<a name="l01775"></a>01775             *<a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a> = <a class="code" href="causes_8h.html#a51ccdf5c6aa26375323fd14cfef02618">AST_CAUSE_DESTINATION_OUT_OF_ORDER</a>;
<a name="l01776"></a>01776          <span class="keywordflow">return</span> NULL;
<a name="l01777"></a>01777       }
<a name="l01778"></a>01778    }
<a name="l01779"></a>01779    <span class="keywordflow">else</span> {
<a name="l01780"></a>01780       memcpy(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>, &amp;<a class="code" href="chan__h323_8c.html#ab2aace2a2c551db5a7ce9ccadc159b72">global_options</a>, <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>));
<a name="l01781"></a>01781       pvt-&gt;<a class="code" href="structoh323__pvt.html#a38f5730c90d9315eb1c0df6cfdc37da6">jointcapability</a> = pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.capability;
<a name="l01782"></a>01782       <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.dtmfmode) {
<a name="l01783"></a>01783          <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.dtmfmode &amp; H323_DTMF_RFC2833) {
<a name="l01784"></a>01784             pvt-&gt;<a class="code" href="structoh323__pvt.html#a08e270ee42ff478a275294762aa0e195">nonCodecCapability</a> |= <a class="code" href="rtp_8h.html#a3cc8001677e3b955b9b5ceb4267a76ec">AST_RTP_DTMF</a>;
<a name="l01785"></a>01785          } <span class="keywordflow">else</span> {
<a name="l01786"></a>01786             pvt-&gt;<a class="code" href="structoh323__pvt.html#a08e270ee42ff478a275294762aa0e195">nonCodecCapability</a> &amp;= ~<a class="code" href="rtp_8h.html#a3cc8001677e3b955b9b5ceb4267a76ec">AST_RTP_DTMF</a>;
<a name="l01787"></a>01787          }
<a name="l01788"></a>01788       }
<a name="l01789"></a>01789    }
<a name="l01790"></a>01790 
<a name="l01791"></a>01791    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;caplock);
<a name="l01792"></a>01792    <span class="comment">/* Generate unique channel identifier */</span>
<a name="l01793"></a>01793    snprintf(tmp1, <span class="keyword">sizeof</span>(tmp1)-1, <span class="stringliteral">&quot;%s-%u&quot;</span>, host, ++<a class="code" href="chan__h323_8c.html#a40103a555dbee6c6e5e4dc193c7fa833">unique</a>);
<a name="l01794"></a>01794    tmp1[<span class="keyword">sizeof</span>(tmp1)-1] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01795"></a>01795    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;caplock);
<a name="l01796"></a>01796 
<a name="l01797"></a>01797    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01798"></a>01798    tmpc = <a class="code" href="chan__h323_8c.html#ab9a955a886712c23ff59fb68d2a59f9a" title="Private structure should be locked on a call.">__oh323_new</a>(pvt, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>, tmp1);
<a name="l01799"></a>01799    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01800"></a>01800    <span class="keywordflow">if</span> (!tmpc) {
<a name="l01801"></a>01801       <a class="code" href="chan__h323_8c.html#ae0faaef42fdc4a529c953c2a48a902c5">oh323_destroy</a>(pvt);
<a name="l01802"></a>01802       <span class="keywordflow">if</span> (<a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>)
<a name="l01803"></a>01803          *<a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a> = <a class="code" href="causes_8h.html#a554ad1e279785609a381c194f770f554">AST_CAUSE_NORMAL_TEMPORARY_FAILURE</a>;
<a name="l01804"></a>01804    }
<a name="l01805"></a>01805    <a class="code" href="module_8h.html#a28b9e8444e0f9b495cc1b10628b816e8" title="Notify when usecount has been changed.">ast_update_use_count</a>();
<a name="l01806"></a>01806    <a class="code" href="chan__h323_8c.html#a83af94bb19a421cb25ca02d16fa5ba9c">restart_monitor</a>();
<a name="l01807"></a>01807    <span class="keywordflow">return</span> tmpc;
<a name="l01808"></a>01808 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad8f15f265c65347173e83fbfb9f9880b"></a><!-- doxytag: member="chan_h323.c::oh323_rtp_read" ref="ad8f15f265c65347173e83fbfb9f9880b" args="(struct oh323_pvt *pvt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__frame.html">ast_frame</a>* oh323_rtp_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structoh323__pvt.html">oh323_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>pvt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Retrieve audio/etc from channel. Assumes pvt-&gt;lock is already held. </p>

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00748">748</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02037">ast_channel_trylock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="dsp_8c_source.html#l01306">ast_dsp_process()</a>, <a class="el" href="frame_8h_source.html#l00247">AST_FORMAT_ALAW</a>, <a class="el" href="frame_8h_source.html#l00253">AST_FORMAT_SLINEAR</a>, <a class="el" href="frame_8h_source.html#l00245">AST_FORMAT_ULAW</a>, <a class="el" href="frame_8h_source.html#l00124">AST_FRAME_DTMF</a>, <a class="el" href="frame_8h_source.html#l00101">AST_FRAME_VOICE</a>, <a class="el" href="frame_8c_source.html#l00573">ast_getformatname()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="frame_8c_source.html#l00124">ast_null_frame</a>, <a class="el" href="rtp_8c_source.html#l01562">ast_rtp_read()</a>, <a class="el" href="rtp_8c_source.html#l00801">ast_rtp_setnat()</a>, <a class="el" href="channel_8c_source.html#l03731">ast_set_read_format()</a>, <a class="el" href="channel_8c_source.html#l03737">ast_set_write_format()</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="logger_8h_source.html#l00185">LOG_DTMF</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="chan__h323_8c_source.html#l00169">oh323_pvt::nativeformats</a>, <a class="el" href="channel_8h_source.html#l00482">ast_channel::nativeformats</a>, <a class="el" href="chan__h323_8c_source.html#l00186">oh323_pvt::noInbandDtmf</a>, <a class="el" href="chan__h323_8c_source.html#l00153">oh323_pvt::options</a>, <a class="el" href="chan__h323_8c_source.html#l00157">oh323_pvt::owner</a>, <a class="el" href="channel_8h_source.html#l00483">ast_channel::readformat</a>, <a class="el" href="chan__h323_8c_source.html#l00167">oh323_pvt::rtp</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, <a class="el" href="chan__h323_8c_source.html#l00168">oh323_pvt::vad</a>, and <a class="el" href="channel_8h_source.html#l00484">ast_channel::writeformat</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l00803">oh323_read()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00749"></a>00749 {
<a name="l00750"></a>00750    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l00751"></a>00751 
<a name="l00752"></a>00752    <span class="comment">/* Only apply it for the first packet, we just need the correct ip/port */</span>
<a name="l00753"></a>00753    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.nat) {
<a name="l00754"></a>00754       <a class="code" href="rtp_8h.html#ad7fd9b0ac09fc5378dcf120bc5d18c03">ast_rtp_setnat</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.nat);
<a name="l00755"></a>00755       pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.nat = 0;
<a name="l00756"></a>00756    }
<a name="l00757"></a>00757 
<a name="l00758"></a>00758    f = <a class="code" href="rtp_8h.html#ac0a9d31f175e3de83fa1dda629c11674">ast_rtp_read</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>);
<a name="l00759"></a>00759    <span class="comment">/* Don&apos;t send RFC2833 if we&apos;re not supposed to */</span>
<a name="l00760"></a>00760    <span class="keywordflow">if</span> (f &amp;&amp; (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#a248afd6c02044259a386f6b7aee922a2">AST_FRAME_DTMF</a>) &amp;&amp; !(pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.dtmfmode &amp; (H323_DTMF_RFC2833 | H323_DTMF_CISCO))) {
<a name="l00761"></a>00761       <span class="keywordflow">return</span> &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l00762"></a>00762    }
<a name="l00763"></a>00763    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l00764"></a>00764       <span class="comment">/* We already hold the channel lock */</span>
<a name="l00765"></a>00765       <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>) {
<a name="l00766"></a>00766          <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> != pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>) {
<a name="l00767"></a>00767             <span class="comment">/* Try to avoid deadlock */</span>
<a name="l00768"></a>00768             <span class="keywordflow">if</span> (<a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {
<a name="l00769"></a>00769                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Format changed but channel is locked. Ignoring frame...\n&quot;</span>);
<a name="l00770"></a>00770                <span class="keywordflow">return</span> &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l00771"></a>00771             }
<a name="l00772"></a>00772             <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l00773"></a>00773                <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Oooh, format changed to %d\n&quot;</span>, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>);
<a name="l00774"></a>00774             pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a> = f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>;
<a name="l00775"></a>00775             pvt-&gt;<a class="code" href="structoh323__pvt.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a> = f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>;
<a name="l00776"></a>00776             <a class="code" href="channel_8h.html#a72d53065c6bc2b6092fa41eefa03f1ad" title="Sets read format on channel chan Set read format for channel to whichever component...">ast_set_read_format</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#ab7786a0f5b9a9ebf83daed87be4f3868">readformat</a>);
<a name="l00777"></a>00777             <a class="code" href="channel_8h.html#a978161a52d98fdaee374d1f6e1359544" title="Sets write format on channel chan Set write format for channel to whichever component...">ast_set_write_format</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a>);
<a name="l00778"></a>00778             <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l00779"></a>00779          }
<a name="l00780"></a>00780          <span class="comment">/* Do in-band DTMF detection */</span>
<a name="l00781"></a>00781          <span class="keywordflow">if</span> ((pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.dtmfmode &amp; H323_DTMF_INBAND) &amp;&amp; pvt-&gt;<a class="code" href="structoh323__pvt.html#aa62a1382425913a43d6111e71b9fa019">vad</a>) {
<a name="l00782"></a>00782             <span class="keywordflow">if</span> ((pvt-&gt;<a class="code" href="structoh323__pvt.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a> &amp; (<a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a> | <a class="code" href="frame_8h.html#aa58cc980a9c9108522effc64e9aff2d6">AST_FORMAT_ALAW</a> | <a class="code" href="frame_8h.html#ab602cf455d4a96a3adba2e3ba8cd2b2c">AST_FORMAT_ULAW</a>))) {
<a name="l00783"></a>00783                <span class="keywordflow">if</span> (!<a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {
<a name="l00784"></a>00784                   f = <a class="code" href="dsp_8h.html#ab6387ee12a3544d3d2068db61d9576ad" title="Return AST_FRAME_NULL frames when there is silence, AST_FRAME_BUSY on busies, and...">ast_dsp_process</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, pvt-&gt;<a class="code" href="structoh323__pvt.html#aa62a1382425913a43d6111e71b9fa019">vad</a>, f);
<a name="l00785"></a>00785                   <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l00786"></a>00786                }
<a name="l00787"></a>00787                <span class="keywordflow">else</span>
<a name="l00788"></a>00788                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Unable to process inband DTMF while channel is locked\n&quot;</span>);
<a name="l00789"></a>00789             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a> &amp;&amp; !pvt-&gt;<a class="code" href="structoh323__pvt.html#a47c9f759cf041ef59cae50124a56610b">noInbandDtmf</a>) {
<a name="l00790"></a>00790                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Inband DTMF is not supported on codec %s. Use RFC2833\n&quot;</span>, <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>));
<a name="l00791"></a>00791                pvt-&gt;<a class="code" href="structoh323__pvt.html#a47c9f759cf041ef59cae50124a56610b">noInbandDtmf</a> = 1;
<a name="l00792"></a>00792             }
<a name="l00793"></a>00793             <span class="keywordflow">if</span> (f &amp;&amp;(f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#a248afd6c02044259a386f6b7aee922a2">AST_FRAME_DTMF</a>)) {
<a name="l00794"></a>00794                <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l00795"></a>00795                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#af360dd5e7b67cff6cb747d1aa2ac3db8">LOG_DTMF</a>, <span class="stringliteral">&quot;Received in-band digit %c.\n&quot;</span>, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>);
<a name="l00796"></a>00796             }
<a name="l00797"></a>00797          }
<a name="l00798"></a>00798       }
<a name="l00799"></a>00799    }
<a name="l00800"></a>00800    <span class="keywordflow">return</span> f;
<a name="l00801"></a>00801 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1dabe18a938d4b51c708350c2596a7e7"></a><!-- doxytag: member="chan_h323.c::oh323_set_rtp_peer" ref="a1dabe18a938d4b51c708350c2596a7e7" args="(struct ast_channel *chan, struct ast_rtp *rtp, struct ast_rtp *vrtp, struct ast_rtp *trtp, int codecs, int nat_active)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int oh323_set_rtp_peer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>vrtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>trtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>codecs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nat_active</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l03189">3189</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="utils_8c_source.html#l00431">ast_inet_ntoa()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="rtp_8c_source.html#l02681">ast_rtp_get_peer()</a>, <a class="el" href="rtp_8c_source.html#l02694">ast_rtp_get_us()</a>, <a class="el" href="chan__h323_8c_source.html#l00156">oh323_pvt::cd</a>, <a class="el" href="chan__h323_8c_source.html#l03162">convertcap()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, and <a class="el" href="channel_8h_source.html#l00484">ast_channel::writeformat</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03190"></a>03190 {
<a name="l03191"></a>03191    <span class="comment">/* XXX Deal with Video */</span>
<a name="l03192"></a>03192    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *pvt;
<a name="l03193"></a>03193    <span class="keyword">struct </span>sockaddr_in them;
<a name="l03194"></a>03194    <span class="keyword">struct </span>sockaddr_in us;
<a name="l03195"></a>03195    <span class="keywordtype">char</span> *mode;
<a name="l03196"></a>03196 
<a name="l03197"></a>03197    <span class="keywordflow">if</span> (!rtp) {
<a name="l03198"></a>03198       <span class="keywordflow">return</span> 0;
<a name="l03199"></a>03199    }
<a name="l03200"></a>03200 
<a name="l03201"></a>03201    mode = <a class="code" href="chan__h323_8c.html#ab7daa2cddc7e391558f8074656aa2b6f">convertcap</a>(chan-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a>);
<a name="l03202"></a>03202    pvt = (<span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *) chan-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l03203"></a>03203    if (!pvt) {
<a name="l03204"></a>03204       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No Private Structure, this is bad\n&quot;</span>);
<a name="l03205"></a>03205       <span class="keywordflow">return</span> -1;
<a name="l03206"></a>03206    }
<a name="l03207"></a>03207    <a class="code" href="rtp_8h.html#aa1ffde0e800995c386729bc5eaf82e7c">ast_rtp_get_peer</a>(rtp, &amp;them);
<a name="l03208"></a>03208    <a class="code" href="rtp_8h.html#a307269685e6f067a6abe35a184c3bae6">ast_rtp_get_us</a>(rtp, &amp;us);
<a name="l03209"></a>03209 <span class="preprocessor">#if 0 </span><span class="comment">/* Native bridge still isn&apos;t ready */</span>
<a name="l03210"></a>03210    h323_native_bridge(pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.call_token, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(them.sin_addr), mode);
<a name="l03211"></a>03211 <span class="preprocessor">#endif</span>
<a name="l03212"></a>03212 <span class="preprocessor"></span>   <span class="keywordflow">return</span> 0;
<a name="l03213"></a>03213 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa0bf2b42c059abf332e545b0f481df33"></a><!-- doxytag: member="chan_h323.c::oh323_simulate_dtmf_end" ref="aa0bf2b42c059abf332e545b0f481df33" args="(const void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int oh323_simulate_dtmf_end </td>
          <td>(</td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00302">302</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02037">ast_channel_trylock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="frame_8h_source.html#l00099">AST_FRAME_DTMF_END</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="channel_8c_source.html#l01080">ast_queue_frame()</a>, <a class="el" href="chan__h323_8c_source.html#l00181">oh323_pvt::curDTMF</a>, <a class="el" href="lock_8h_source.html#l01676">DEADLOCK_AVOIDANCE</a>, <a class="el" href="chan__h323_8c_source.html#l00182">oh323_pvt::DTMFsched</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, and <a class="el" href="chan__h323_8c_source.html#l00157">oh323_pvt::owner</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l00332">__oh323_update_info()</a>, and <a class="el" href="chan__h323_8c_source.html#l01827">receive_digit()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00303"></a>00303 {
<a name="l00304"></a>00304    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *pvt = (<span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *)data;
<a name="l00305"></a>00305 
<a name="l00306"></a>00306    <span class="keywordflow">if</span> (pvt) {
<a name="l00307"></a>00307       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00308"></a>00308       <span class="comment">/* Don&apos;t hold pvt lock while trying to lock the channel */</span>
<a name="l00309"></a>00309       <span class="keywordflow">while</span>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; <a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {
<a name="l00310"></a>00310          <a class="code" href="lock_8h.html#a851106e971b4611a38cb4be8b39d9fcf">DEADLOCK_AVOIDANCE</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00311"></a>00311       }
<a name="l00312"></a>00312 
<a name="l00313"></a>00313       <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l00314"></a>00314          <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> <a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a> = {
<a name="l00315"></a>00315             .frametype = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a98e65764bc963016c394bcc1bad6540b">AST_FRAME_DTMF_END</a>,
<a name="l00316"></a>00316             .subclass = pvt-&gt;<a class="code" href="structoh323__pvt.html#af9a8bf05d4868eff107cd3b34689a5bb">curDTMF</a>,
<a name="l00317"></a>00317             .samples = 0,
<a name="l00318"></a>00318             .src = <span class="stringliteral">&quot;SIMULATE_DTMF_END&quot;</span>,
<a name="l00319"></a>00319          };
<a name="l00320"></a>00320          <a class="code" href="channel_8h.html#a6cbcba5661d55216968cde8fdf913c89" title="Queue one or more frames to a channel&amp;#39;s frame queue.">ast_queue_frame</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, &amp;f);
<a name="l00321"></a>00321          <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l00322"></a>00322       }
<a name="l00323"></a>00323 
<a name="l00324"></a>00324       pvt-&gt;<a class="code" href="structoh323__pvt.html#a065b36acb6c0d5185e203b227f257b9c">DTMFsched</a> = -1;
<a name="l00325"></a>00325       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00326"></a>00326    }
<a name="l00327"></a>00327 
<a name="l00328"></a>00328    <span class="keywordflow">return</span> 0;
<a name="l00329"></a>00329 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9d607a503353cfb6f7b4305b192fda8e"></a><!-- doxytag: member="chan_h323.c::oh323_update_info" ref="a9d607a503353cfb6f7b4305b192fda8e" args="(struct ast_channel *c)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void oh323_update_info </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Only channel structure should be locked. </p>

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00396">396</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="chan__h323_8c_source.html#l00332">__oh323_update_info()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l00658">oh323_answer()</a>, <a class="el" href="chan__h323_8c_source.html#l00579">oh323_call()</a>, <a class="el" href="chan__h323_8c_source.html#l00499">oh323_digit_begin()</a>, <a class="el" href="chan__h323_8c_source.html#l00540">oh323_digit_end()</a>, and <a class="el" href="chan__h323_8c_source.html#l00856">oh323_indicate()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00397"></a>00397 {
<a name="l00398"></a>00398    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *pvt = c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l00399"></a>00399 
<a name="l00400"></a>00400    <span class="keywordflow">if</span> (pvt) {
<a name="l00401"></a>00401       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00402"></a>00402       <a class="code" href="chan__h323_8c.html#ac83c5df72d69f2472b7bd1fd36b634cb" title="Channel and private structures should be already locked.">__oh323_update_info</a>(c, pvt);
<a name="l00403"></a>00403       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00404"></a>00404    }
<a name="l00405"></a>00405 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adad48dd1d0d4ee4a9b0e6e341e53f547"></a><!-- doxytag: member="chan_h323.c::oh323_write" ref="adad48dd1d0d4ee4a9b0e6e341e53f547" args="(struct ast_channel *c, struct ast_frame *frame)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int oh323_write </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td>
          <td class="paramname"> <em>frame</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00828">828</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="chan__h323_8c_source.html#l00332">__oh323_update_info()</a>, <a class="el" href="frame_8h_source.html#l00113">AST_FRAME_IMAGE</a>, <a class="el" href="frame_8h_source.html#l00101">AST_FRAME_VOICE</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="rtp_8c_source.html#l03790">ast_rtp_write()</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="channel_8h_source.html#l00482">ast_channel::nativeformats</a>, <a class="el" href="channel_8h_source.html#l00483">ast_channel::readformat</a>, <a class="el" href="chan__h323_8c_source.html#l00184">oh323_pvt::recvonly</a>, <a class="el" href="chan__h323_8c_source.html#l00167">oh323_pvt::rtp</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, and <a class="el" href="channel_8h_source.html#l00484">ast_channel::writeformat</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00829"></a>00829 {
<a name="l00830"></a>00830    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *pvt = (<span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *) c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l00831"></a>00831    <span class="keywordtype">int</span> res = 0;
<a name="l00832"></a>00832    if (frame-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> != <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>) {
<a name="l00833"></a>00833       <span class="keywordflow">if</span> (frame-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a6c9398ee8989239124295d096a87bf32">AST_FRAME_IMAGE</a>) {
<a name="l00834"></a>00834          <span class="keywordflow">return</span> 0;
<a name="l00835"></a>00835       } <span class="keywordflow">else</span> {
<a name="l00836"></a>00836          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Can&apos;t send %d type frames with H323 write\n&quot;</span>, frame-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a>);
<a name="l00837"></a>00837          <span class="keywordflow">return</span> 0;
<a name="l00838"></a>00838       }
<a name="l00839"></a>00839    } <span class="keywordflow">else</span> {
<a name="l00840"></a>00840       <span class="keywordflow">if</span> (!(frame-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> &amp; c-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>)) {
<a name="l00841"></a>00841          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Asked to transmit frame type %d, while native formats is %d (read/write = %d/%d)\n&quot;</span>,
<a name="l00842"></a>00842             frame-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>, c-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>, c-&gt;<a class="code" href="structast__channel.html#ab7786a0f5b9a9ebf83daed87be4f3868">readformat</a>, c-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a>);
<a name="l00843"></a>00843          <span class="keywordflow">return</span> 0;
<a name="l00844"></a>00844       }
<a name="l00845"></a>00845    }
<a name="l00846"></a>00846    <span class="keywordflow">if</span> (pvt) {
<a name="l00847"></a>00847       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00848"></a>00848       <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a> &amp;&amp; !pvt-&gt;<a class="code" href="structoh323__pvt.html#a8233e5098a564987fd6e02cc7bf0316e">recvonly</a>)
<a name="l00849"></a>00849          res = <a class="code" href="rtp_8h.html#a7a8ffdcbe10f04c3ca29e7cad359a68c">ast_rtp_write</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, frame);
<a name="l00850"></a>00850       <a class="code" href="chan__h323_8c.html#ac83c5df72d69f2472b7bd1fd36b634cb" title="Channel and private structures should be already locked.">__oh323_update_info</a>(c, pvt);
<a name="l00851"></a>00851       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00852"></a>00852    }
<a name="l00853"></a>00853    <span class="keywordflow">return</span> res;
<a name="l00854"></a>00854 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a46a127e7a215d234d16690c06a412255"></a><!-- doxytag: member="chan_h323.c::progress" ref="a46a127e7a215d234d16690c06a412255" args="(unsigned call_reference, const char *token, int inband)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int <a class="el" href="structprogress.html">progress</a> </td>
          <td>(</td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>call_reference</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>inband</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l02072">2072</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00311">AST_CONTROL_PROGRESS</a>, <a class="el" href="frame_8h_source.html#l00300">AST_CONTROL_RINGING</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="chan__h323_8c_source.html#l01144">find_call_locked()</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="chan__h323_8c_source.html#l00157">oh323_pvt::owner</a>, and <a class="el" href="chan__h323_8c_source.html#l01170">update_state()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02073"></a>02073 {
<a name="l02074"></a>02074    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *pvt;
<a name="l02075"></a>02075 
<a name="l02076"></a>02076    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l02077"></a>02077       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Received ALERT/PROGRESS message for %s tones\n&quot;</span>, (inband ? <span class="stringliteral">&quot;inband&quot;</span> : <span class="stringliteral">&quot;self-generated&quot;</span>));
<a name="l02078"></a>02078 
<a name="l02079"></a>02079    pvt = <a class="code" href="chan__h323_8c.html#a246fb1df8539e4f168a9bc8233ef76b9">find_call_locked</a>(call_reference, token);
<a name="l02080"></a>02080    <span class="keywordflow">if</span> (!pvt) {
<a name="l02081"></a>02081       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Private structure not found in progress.\n&quot;</span>);
<a name="l02082"></a>02082       <span class="keywordflow">return</span> -1;
<a name="l02083"></a>02083    }
<a name="l02084"></a>02084    <span class="keywordflow">if</span> (!pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l02085"></a>02085       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l02086"></a>02086       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No Asterisk channel associated with private structure.\n&quot;</span>);
<a name="l02087"></a>02087       <span class="keywordflow">return</span> -1;
<a name="l02088"></a>02088    }
<a name="l02089"></a>02089    <a class="code" href="chan__h323_8c.html#a88ea396aa3c9c270ced6ca203c8ad5ba">update_state</a>(pvt, -1, (inband ? <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a1a461c5e737ed6ed7c8cb0f78557a6fd">AST_CONTROL_PROGRESS</a> : <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a>));
<a name="l02090"></a>02090    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l02091"></a>02091 
<a name="l02092"></a>02092    <span class="keywordflow">return</span> 0;
<a name="l02093"></a>02093 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a55c82d81ce37ebe5125d5a017c12b5ac"></a><!-- doxytag: member="chan_h323.c::prune_peers" ref="a55c82d81ce37ebe5125d5a017c12b5ac" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void prune_peers </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l02826">2826</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="astobj_8h_source.html#l00651">ASTOBJ_CONTAINER_PRUNE_MARKED</a>, <a class="el" href="chan__h323_8c_source.html#l00294">oh323_destroy_peer()</a>, and <a class="el" href="chan__h323_8c.html#a73d22ff9770f2c94dac6e92c3eddea5f">peerl</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l02832">reload_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02827"></a>02827 {
<a name="l02828"></a>02828    <span class="comment">/* Prune peers who still are supposed to be deleted */</span>
<a name="l02829"></a>02829    <a class="code" href="astobj_8h.html#a794727ca4ef71982250ff9f36a9668d7" title="Prune marked objects from a container.">ASTOBJ_CONTAINER_PRUNE_MARKED</a>(&amp;<a class="code" href="chan__h323_8c.html#a73d22ff9770f2c94dac6e92c3eddea5f" title="H323 peer list.">peerl</a>, <a class="code" href="chan__h323_8c.html#ad2fe7bc6fcd60293a92f883ff5d03fc0">oh323_destroy_peer</a>);
<a name="l02830"></a>02830 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8bf574965e8d09f6d10407ce9468ff1b"></a><!-- doxytag: member="chan_h323.c::realtime_alias" ref="a8bf574965e8d09f6d10407ce9468ff1b" args="(const char *alias)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct oh323_alias* realtime_alias </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>alias</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l01226">1226</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="config_8c_source.html#l02113">ast_load_realtime()</a>, <a class="el" href="config_8c_source.html#l00397">ast_variables_destroy()</a>, <a class="el" href="chan__h323_8c_source.html#l01191">build_alias()</a>, <a class="el" href="config_8h_source.html#l00075">ast_variable::name</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="compiler_8h_source.html#l00069">SENTINEL</a>, <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>, and <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l01811">find_alias()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01227"></a>01227 {
<a name="l01228"></a>01228    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, *tmp;
<a name="l01229"></a>01229    <span class="keyword">struct </span>oh323_alias *a;
<a name="l01230"></a>01230 
<a name="l01231"></a>01231    var = <a class="code" href="config_8h.html#a1a03993603e2bc2463153857836645bb" title="Retrieve realtime configuration.">ast_load_realtime</a>(<span class="stringliteral">&quot;h323&quot;</span>, <span class="stringliteral">&quot;name&quot;</span>, alias, <a class="code" href="compiler_8h.html#af2af475b85aef66019c417d8ded1c435">SENTINEL</a>);
<a name="l01232"></a>01232 
<a name="l01233"></a>01233    <span class="keywordflow">if</span> (!var)
<a name="l01234"></a>01234       <span class="keywordflow">return</span> NULL;
<a name="l01235"></a>01235 
<a name="l01236"></a>01236    <span class="keywordflow">for</span> (tmp = var; tmp; tmp = tmp-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l01237"></a>01237       <span class="keywordflow">if</span> (!strcasecmp(tmp-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;type&quot;</span>) &amp;&amp;
<a name="l01238"></a>01238       !(!strcasecmp(tmp-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;alias&quot;</span>) || !strcasecmp(tmp-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;h323&quot;</span>))) {
<a name="l01239"></a>01239          <a class="code" href="config_8h.html#ad3d8122172af6f13687a07840411d65d" title="Free variable list.">ast_variables_destroy</a>(var);
<a name="l01240"></a>01240          <span class="keywordflow">return</span> NULL;
<a name="l01241"></a>01241       }
<a name="l01242"></a>01242    }
<a name="l01243"></a>01243 
<a name="l01244"></a>01244    a = <a class="code" href="chan__h323_8c.html#a7c5637b8e64dc84dacbd47037572f99e">build_alias</a>(alias, var, NULL, 1);
<a name="l01245"></a>01245 
<a name="l01246"></a>01246    <a class="code" href="config_8h.html#ad3d8122172af6f13687a07840411d65d" title="Free variable list.">ast_variables_destroy</a>(var);
<a name="l01247"></a>01247 
<a name="l01248"></a>01248    <span class="keywordflow">return</span> a;
<a name="l01249"></a>01249 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ade030a243ae99913806e20bc6239cde0"></a><!-- doxytag: member="chan_h323.c::realtime_peer" ref="ade030a243ae99913806e20bc6239cde0" args="(const char *peername, struct sockaddr_in *sin)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct oh323_peer* realtime_peer </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>peername</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>sin</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l01554">1554</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="utils_8c_source.html#l00431">ast_inet_ntoa()</a>, <a class="el" href="config_8c_source.html#l02113">ast_load_realtime()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="config_8c_source.html#l00397">ast_variables_destroy()</a>, <a class="el" href="chan__h323_8c_source.html#l01478">build_peer()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="config_8h_source.html#l00075">ast_variable::name</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="compiler_8h_source.html#l00069">SENTINEL</a>, <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>, and <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l01632">find_peer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01555"></a>01555 {
<a name="l01556"></a>01556    <span class="keyword">struct </span>oh323_peer *peer;
<a name="l01557"></a>01557    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>;
<a name="l01558"></a>01558    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *tmp;
<a name="l01559"></a>01559    <span class="keyword">const</span> <span class="keywordtype">char</span> *addr = NULL;
<a name="l01560"></a>01560 
<a name="l01561"></a>01561    <span class="comment">/* First check on peer name */</span>
<a name="l01562"></a>01562    <span class="keywordflow">if</span> (peername)
<a name="l01563"></a>01563       var = <a class="code" href="config_8h.html#a1a03993603e2bc2463153857836645bb" title="Retrieve realtime configuration.">ast_load_realtime</a>(<span class="stringliteral">&quot;h323&quot;</span>, <span class="stringliteral">&quot;name&quot;</span>, peername, <a class="code" href="compiler_8h.html#af2af475b85aef66019c417d8ded1c435">SENTINEL</a>);
<a name="l01564"></a>01564    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sin) <span class="comment">/* Then check on IP address for dynamic peers */</span>
<a name="l01565"></a>01565       var = <a class="code" href="config_8h.html#a1a03993603e2bc2463153857836645bb" title="Retrieve realtime configuration.">ast_load_realtime</a>(<span class="stringliteral">&quot;h323&quot;</span>, <span class="stringliteral">&quot;host&quot;</span>, addr = <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(sin-&gt;sin_addr), <a class="code" href="compiler_8h.html#af2af475b85aef66019c417d8ded1c435">SENTINEL</a>);
<a name="l01566"></a>01566    <span class="keywordflow">else</span>
<a name="l01567"></a>01567       <span class="keywordflow">return</span> NULL;
<a name="l01568"></a>01568 
<a name="l01569"></a>01569    <span class="keywordflow">if</span> (!var)
<a name="l01570"></a>01570       <span class="keywordflow">return</span> NULL;
<a name="l01571"></a>01571 
<a name="l01572"></a>01572    <span class="keywordflow">for</span> (tmp = var; tmp; tmp = tmp-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l01573"></a>01573       <span class="comment">/* If this is type=user, then skip this object. */</span>
<a name="l01574"></a>01574       <span class="keywordflow">if</span> (!strcasecmp(tmp-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;type&quot;</span>) &amp;&amp;
<a name="l01575"></a>01575             !(!strcasecmp(tmp-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;peer&quot;</span>) || !strcasecmp(tmp-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;friend&quot;</span>))) {
<a name="l01576"></a>01576          <a class="code" href="config_8h.html#ad3d8122172af6f13687a07840411d65d" title="Free variable list.">ast_variables_destroy</a>(var);
<a name="l01577"></a>01577          <span class="keywordflow">return</span> NULL;
<a name="l01578"></a>01578       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!peername &amp;&amp; !strcasecmp(tmp-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;name&quot;</span>)) {
<a name="l01579"></a>01579          peername = tmp-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>;
<a name="l01580"></a>01580       }
<a name="l01581"></a>01581    }
<a name="l01582"></a>01582 
<a name="l01583"></a>01583    <span class="keywordflow">if</span> (!peername) {  <span class="comment">/* Did not find peer in realtime */</span>
<a name="l01584"></a>01584       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot determine peer name for IP address %s\n&quot;</span>, addr);
<a name="l01585"></a>01585       <a class="code" href="config_8h.html#ad3d8122172af6f13687a07840411d65d" title="Free variable list.">ast_variables_destroy</a>(var);
<a name="l01586"></a>01586       <span class="keywordflow">return</span> NULL;
<a name="l01587"></a>01587    }
<a name="l01588"></a>01588 
<a name="l01589"></a>01589    <span class="comment">/* Peer found in realtime, now build it in memory */</span>
<a name="l01590"></a>01590    peer = <a class="code" href="chan__h323_8c.html#a53c07cbdf5928cad397e68d05d64c0cf">build_peer</a>(peername, var, NULL, 1);
<a name="l01591"></a>01591 
<a name="l01592"></a>01592    <a class="code" href="config_8h.html#ad3d8122172af6f13687a07840411d65d" title="Free variable list.">ast_variables_destroy</a>(var);
<a name="l01593"></a>01593 
<a name="l01594"></a>01594    <span class="keywordflow">return</span> peer;
<a name="l01595"></a>01595 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0f578c07de3dd4338e69ff42ba1e1996"></a><!-- doxytag: member="chan_h323.c::realtime_user" ref="a0f578c07de3dd4338e69ff42ba1e1996" args="(const call_details_t *cd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct oh323_user* realtime_user </td>
          <td>(</td>
          <td class="paramtype">const call_details_t *&nbsp;</td>
          <td class="paramname"> <em>cd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l01440">1440</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="config_8c_source.html#l02113">ast_load_realtime()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="config_8c_source.html#l00397">ast_variables_destroy()</a>, <a class="el" href="chan__h323_8c_source.html#l01360">build_user()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="config_8h_source.html#l00075">ast_variable::name</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="compiler_8h_source.html#l00069">SENTINEL</a>, <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>, and <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l01602">find_user()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01441"></a>01441 {
<a name="l01442"></a>01442    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, *tmp;
<a name="l01443"></a>01443    <span class="keyword">struct </span>oh323_user *<a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a>;
<a name="l01444"></a>01444    <span class="keyword">const</span> <span class="keywordtype">char</span> *username;
<a name="l01445"></a>01445 
<a name="l01446"></a>01446    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#af8106a09b3ed0924050635f9a8a19fca">userbyalias</a>)
<a name="l01447"></a>01447       var = <a class="code" href="config_8h.html#a1a03993603e2bc2463153857836645bb" title="Retrieve realtime configuration.">ast_load_realtime</a>(<span class="stringliteral">&quot;h323&quot;</span>, <span class="stringliteral">&quot;name&quot;</span>, username = cd-&gt;call_source_aliases, <a class="code" href="compiler_8h.html#af2af475b85aef66019c417d8ded1c435">SENTINEL</a>);
<a name="l01448"></a>01448    <span class="keywordflow">else</span> {
<a name="l01449"></a>01449       username = (<span class="keywordtype">char</span> *)NULL;
<a name="l01450"></a>01450       var = <a class="code" href="config_8h.html#a1a03993603e2bc2463153857836645bb" title="Retrieve realtime configuration.">ast_load_realtime</a>(<span class="stringliteral">&quot;h323&quot;</span>, <span class="stringliteral">&quot;host&quot;</span>, cd-&gt;sourceIp, <a class="code" href="compiler_8h.html#af2af475b85aef66019c417d8ded1c435">SENTINEL</a>);
<a name="l01451"></a>01451    }
<a name="l01452"></a>01452 
<a name="l01453"></a>01453    <span class="keywordflow">if</span> (!var)
<a name="l01454"></a>01454       <span class="keywordflow">return</span> NULL;
<a name="l01455"></a>01455 
<a name="l01456"></a>01456    <span class="keywordflow">for</span> (tmp = var; tmp; tmp = tmp-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l01457"></a>01457       <span class="keywordflow">if</span> (!strcasecmp(tmp-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;type&quot;</span>) &amp;&amp;
<a name="l01458"></a>01458       !(!strcasecmp(tmp-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;user&quot;</span>) || !strcasecmp(tmp-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;friend&quot;</span>))) {
<a name="l01459"></a>01459          <a class="code" href="config_8h.html#ad3d8122172af6f13687a07840411d65d" title="Free variable list.">ast_variables_destroy</a>(var);
<a name="l01460"></a>01460          <span class="keywordflow">return</span> NULL;
<a name="l01461"></a>01461       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!username &amp;&amp; !strcasecmp(tmp-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;name&quot;</span>))
<a name="l01462"></a>01462          username = tmp-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>;
<a name="l01463"></a>01463    }
<a name="l01464"></a>01464 
<a name="l01465"></a>01465    <span class="keywordflow">if</span> (!username) {
<a name="l01466"></a>01466       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot determine user name for IP address %s\n&quot;</span>, cd-&gt;sourceIp);
<a name="l01467"></a>01467       <a class="code" href="config_8h.html#ad3d8122172af6f13687a07840411d65d" title="Free variable list.">ast_variables_destroy</a>(var);
<a name="l01468"></a>01468       <span class="keywordflow">return</span> NULL;
<a name="l01469"></a>01469    }
<a name="l01470"></a>01470 
<a name="l01471"></a>01471    user = <a class="code" href="chan__h323_8c.html#af5ea8aafcd4cedda80e628ca32386fe8">build_user</a>(username, var, NULL, 1);
<a name="l01472"></a>01472 
<a name="l01473"></a>01473    <a class="code" href="config_8h.html#ad3d8122172af6f13687a07840411d65d" title="Free variable list.">ast_variables_destroy</a>(var);
<a name="l01474"></a>01474 
<a name="l01475"></a>01475    <span class="keywordflow">return</span> user;
<a name="l01476"></a>01476 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a533a0dc5525df003509528552d047aa7"></a><!-- doxytag: member="chan_h323.c::receive_digit" ref="a533a0dc5525df003509528552d047aa7" args="(unsigned call_reference, char digit, const char *token, int duration)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int receive_digit </td>
          <td>(</td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>call_reference</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>digit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>duration</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Callback for sending digits from H.323 up to asterisk. </p>

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l01827">1827</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02037">ast_channel_trylock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="frame_8h_source.html#l00306">AST_CONTROL_FLASH</a>, <a class="el" href="frame_8h_source.html#l00122">AST_FRAME_DTMF_BEGIN</a>, <a class="el" href="frame_8h_source.html#l00099">AST_FRAME_DTMF_END</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="channel_8c_source.html#l01123">ast_queue_control()</a>, <a class="el" href="channel_8c_source.html#l01080">ast_queue_frame()</a>, <a class="el" href="sched_8c_source.html#l00439">ast_sched_add()</a>, <a class="el" href="sched_8h_source.html#l00051">AST_SCHED_DEL</a>, <a class="el" href="chan__h323_8c_source.html#l00181">oh323_pvt::curDTMF</a>, <a class="el" href="chan__h323_8c_source.html#l00182">oh323_pvt::DTMFsched</a>, <a class="el" href="chan__h323_8c_source.html#l01144">find_call_locked()</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="frame_8h_source.html#l00169">ast_frame::len</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00185">LOG_DTMF</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="chan__h323_8c_source.html#l00173">oh323_pvt::newcontrol</a>, <a class="el" href="chan__h323_8c_source.html#l00174">oh323_pvt::newdigit</a>, <a class="el" href="chan__h323_8c_source.html#l00175">oh323_pvt::newduration</a>, <a class="el" href="chan__h323_8c_source.html#l00302">oh323_simulate_dtmf_end()</a>, <a class="el" href="chan__h323_8c_source.html#l00157">oh323_pvt::owner</a>, <a class="el" href="frame_8h_source.html#l00149">ast_frame::samples</a>, and <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l03222">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01828"></a>01828 {
<a name="l01829"></a>01829    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *pvt;
<a name="l01830"></a>01830    <span class="keywordtype">int</span> res;
<a name="l01831"></a>01831 
<a name="l01832"></a>01832    pvt = <a class="code" href="chan__h323_8c.html#a246fb1df8539e4f168a9bc8233ef76b9">find_call_locked</a>(call_reference, token);
<a name="l01833"></a>01833    <span class="keywordflow">if</span> (!pvt) {
<a name="l01834"></a>01834       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Received digit &apos;%c&apos; (%u ms) for call %s without private structure\n&quot;</span>, digit, duration, token);
<a name="l01835"></a>01835       <span class="keywordflow">return</span> -1;
<a name="l01836"></a>01836    }
<a name="l01837"></a>01837    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l01838"></a>01838       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#af360dd5e7b67cff6cb747d1aa2ac3db8">LOG_DTMF</a>, <span class="stringliteral">&quot;Received %s digit &apos;%c&apos; (%u ms) for call %s\n&quot;</span>, (digit == <span class="charliteral">&apos; &apos;</span> ? <span class="stringliteral">&quot;update for&quot;</span> : <span class="stringliteral">&quot;new&quot;</span>), (digit == <span class="charliteral">&apos; &apos;</span> ? pvt-&gt;<a class="code" href="structoh323__pvt.html#af9a8bf05d4868eff107cd3b34689a5bb">curDTMF</a> : digit), duration, token);
<a name="l01839"></a>01839 
<a name="l01840"></a>01840    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; !<a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {
<a name="l01841"></a>01841       <span class="keywordflow">if</span> (digit == <span class="charliteral">&apos;!&apos;</span>)
<a name="l01842"></a>01842          res = <a class="code" href="channel_8h.html#a60f9d2b0ab8b7a839902313321163b28" title="Queue a control frame with payload.">ast_queue_control</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ae8f2cd460fdc81e0a774434fa002e4bf">AST_CONTROL_FLASH</a>);
<a name="l01843"></a>01843       <span class="keywordflow">else</span> {
<a name="l01844"></a>01844          <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> <a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a> = {
<a name="l01845"></a>01845             .frametype = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a98e65764bc963016c394bcc1bad6540b">AST_FRAME_DTMF_END</a>,
<a name="l01846"></a>01846             .subclass = digit,
<a name="l01847"></a>01847             .samples = duration * 8,
<a name="l01848"></a>01848             .len = duration,
<a name="l01849"></a>01849             .src = <span class="stringliteral">&quot;SEND_DIGIT&quot;</span>,
<a name="l01850"></a>01850          };
<a name="l01851"></a>01851          <span class="keywordflow">if</span> (digit == <span class="charliteral">&apos; &apos;</span>) {     <span class="comment">/* signalUpdate message */</span>
<a name="l01852"></a>01852             f.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = pvt-&gt;<a class="code" href="structoh323__pvt.html#af9a8bf05d4868eff107cd3b34689a5bb">curDTMF</a>;
<a name="l01853"></a>01853             <a class="code" href="sched_8h.html#a25647782014f8dc012994efcd1b81d32" title="a loop construct to ensure that the scheduled task get deleted. The idea is that...">AST_SCHED_DEL</a>(<a class="code" href="structsched.html">sched</a>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a065b36acb6c0d5185e203b227f257b9c">DTMFsched</a>);
<a name="l01854"></a>01854          } <span class="keywordflow">else</span> {          <span class="comment">/* Regular input or signal message */</span>
<a name="l01855"></a>01855             <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#a065b36acb6c0d5185e203b227f257b9c">DTMFsched</a> &gt;= 0) {
<a name="l01856"></a>01856                <span class="comment">/* We still don&apos;t send DTMF END from previous event, send it now */</span>
<a name="l01857"></a>01857                <a class="code" href="sched_8h.html#a25647782014f8dc012994efcd1b81d32" title="a loop construct to ensure that the scheduled task get deleted. The idea is that...">AST_SCHED_DEL</a>(<a class="code" href="structsched.html">sched</a>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a065b36acb6c0d5185e203b227f257b9c">DTMFsched</a>);
<a name="l01858"></a>01858                f.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = pvt-&gt;<a class="code" href="structoh323__pvt.html#af9a8bf05d4868eff107cd3b34689a5bb">curDTMF</a>;
<a name="l01859"></a>01859                f.<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> = f.<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a> = 0;
<a name="l01860"></a>01860                <a class="code" href="channel_8h.html#a6cbcba5661d55216968cde8fdf913c89" title="Queue one or more frames to a channel&amp;#39;s frame queue.">ast_queue_frame</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, &amp;f);
<a name="l01861"></a>01861                <span class="comment">/* Restore values */</span>
<a name="l01862"></a>01862                f.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = digit;
<a name="l01863"></a>01863                f.<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> = duration * 8;
<a name="l01864"></a>01864                f.<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a> = duration;
<a name="l01865"></a>01865             }
<a name="l01866"></a>01866             <span class="keywordflow">if</span> (duration) {      <span class="comment">/* This is a signal, signalUpdate follows */</span>
<a name="l01867"></a>01867                f.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a9b350360a64b55c7590f1ec03db480be">AST_FRAME_DTMF_BEGIN</a>;
<a name="l01868"></a>01868                pvt-&gt;<a class="code" href="structoh323__pvt.html#a065b36acb6c0d5185e203b227f257b9c">DTMFsched</a> = <a class="code" href="sched_8h.html#a97176531282ac4e70aa107b2e8ee5543" title="Adds a scheduled event Schedule an event to take place at some point in the future...">ast_sched_add</a>(<a class="code" href="structsched.html">sched</a>, duration, <a class="code" href="chan__h323_8c.html#aa0bf2b42c059abf332e545b0f481df33">oh323_simulate_dtmf_end</a>, pvt);
<a name="l01869"></a>01869                <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l01870"></a>01870                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#af360dd5e7b67cff6cb747d1aa2ac3db8">LOG_DTMF</a>, <span class="stringliteral">&quot;Scheduled DTMF END simulation for %d ms, id=%d\n&quot;</span>, duration, pvt-&gt;<a class="code" href="structoh323__pvt.html#a065b36acb6c0d5185e203b227f257b9c">DTMFsched</a>);
<a name="l01871"></a>01871             }
<a name="l01872"></a>01872             pvt-&gt;<a class="code" href="structoh323__pvt.html#af9a8bf05d4868eff107cd3b34689a5bb">curDTMF</a> = digit;
<a name="l01873"></a>01873          }
<a name="l01874"></a>01874          res = <a class="code" href="channel_8h.html#a6cbcba5661d55216968cde8fdf913c89" title="Queue one or more frames to a channel&amp;#39;s frame queue.">ast_queue_frame</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, &amp;f);
<a name="l01875"></a>01875       }
<a name="l01876"></a>01876       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l01877"></a>01877    } <span class="keywordflow">else</span> {
<a name="l01878"></a>01878       <span class="keywordflow">if</span> (digit == <span class="charliteral">&apos;!&apos;</span>)
<a name="l01879"></a>01879          pvt-&gt;<a class="code" href="structoh323__pvt.html#a96512445a0a8d8b2b9f40db190f33f14">newcontrol</a> = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ae8f2cd460fdc81e0a774434fa002e4bf">AST_CONTROL_FLASH</a>;
<a name="l01880"></a>01880       <span class="keywordflow">else</span> {
<a name="l01881"></a>01881          pvt-&gt;<a class="code" href="structoh323__pvt.html#acd0eb566ce3a46e17cb6823b46a671e4">newduration</a> = duration;
<a name="l01882"></a>01882          pvt-&gt;<a class="code" href="structoh323__pvt.html#a8972b94b384117570fef447df6504fde">newdigit</a> = digit;
<a name="l01883"></a>01883       }
<a name="l01884"></a>01884       res = 0;
<a name="l01885"></a>01885    }
<a name="l01886"></a>01886    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01887"></a>01887    <span class="keywordflow">return</span> res;
<a name="l01888"></a>01888 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6cfebf8a16722535ebfc3039f7a61456"></a><!-- doxytag: member="chan_h323.c::redirectingreason2str" ref="a6cfebf8a16722535ebfc3039f7a61456" args="(int redirectingreason)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static const char* redirectingreason2str </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>redirectingreason</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00263">263</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l00999">__oh323_new()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00264"></a>00264 {
<a name="l00265"></a>00265    <span class="keywordflow">switch</span> (redirectingreason) {
<a name="l00266"></a>00266    <span class="keywordflow">case</span> 0:
<a name="l00267"></a>00267       <span class="keywordflow">return</span> <span class="stringliteral">&quot;UNKNOWN&quot;</span>;
<a name="l00268"></a>00268    <span class="keywordflow">case</span> 1:
<a name="l00269"></a>00269       <span class="keywordflow">return</span> <span class="stringliteral">&quot;BUSY&quot;</span>;
<a name="l00270"></a>00270    <span class="keywordflow">case</span> 2:
<a name="l00271"></a>00271       <span class="keywordflow">return</span> <span class="stringliteral">&quot;NO_REPLY&quot;</span>;
<a name="l00272"></a>00272    <span class="keywordflow">case</span> 0xF:
<a name="l00273"></a>00273       <span class="keywordflow">return</span> <span class="stringliteral">&quot;UNCONDITIONAL&quot;</span>;
<a name="l00274"></a>00274    <span class="keywordflow">default</span>:
<a name="l00275"></a>00275       <span class="keywordflow">return</span> <span class="stringliteral">&quot;NOREDIRECT&quot;</span>;
<a name="l00276"></a>00276    }
<a name="l00277"></a>00277 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad1982509765f4870f1f63412a53ea668"></a><!-- doxytag: member="chan_h323.c::reload" ref="ad1982509765f4870f1f63412a53ea668" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int reload </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l03125">3125</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="chan__h323_8c_source.html#l03085">h323_reload()</a>, and <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03126"></a>03126 {
<a name="l03127"></a>03127    <span class="keywordflow">if</span> (!<a class="code" href="structsched.html">sched</a> || !<a class="code" href="chan__h323_8c.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a>) {
<a name="l03128"></a>03128       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Unload and load chan_h323.so again in order to receive configuration changes.\n&quot;</span>);
<a name="l03129"></a>03129       <span class="keywordflow">return</span> 0;
<a name="l03130"></a>03130    }
<a name="l03131"></a>03131    <span class="keywordflow">return</span> <a class="code" href="chan__h323_8c.html#aeaa9d343c54df03af296eccb32cf700c">h323_reload</a>();
<a name="l03132"></a>03132 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa0b7680df49f5fe40c8bb1c8f0536cc6"></a><!-- doxytag: member="chan_h323.c::reload_config" ref="aa0b7680df49f5fe40c8bb1c8f0536cc6" args="(int is_reload)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int reload_config </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>is_reload</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l02832">2832</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="chan__h323_8c.html#a2029bed642f94cb8e3299209b084e585">aliasl</a>, <a class="el" href="config_8c_source.html#l00613">ast_category_browse()</a>, <a class="el" href="utils_8h_source.html#l00075">ast_clear_flag</a>, <a class="el" href="config_8c_source.html#l00827">ast_config_destroy()</a>, <a class="el" href="config_8h_source.html#l00139">ast_config_load</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="utils_8c_source.html#l00182">ast_gethostbyname()</a>, <a class="el" href="abstract__jb_8c_source.html#l00571">ast_jb_read_conf()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="acl_8c_source.html#l00429">ast_str2cos()</a>, <a class="el" href="acl_8c_source.html#l00443">ast_str2tos()</a>, <a class="el" href="utils_8c_source.html#l01311">ast_true()</a>, <a class="el" href="config_8c_source.html#l00411">ast_variable_browse()</a>, <a class="el" href="config_8c_source.html#l00435">ast_variable_retrieve()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="astobj_8h_source.html#l00776">ASTOBJ_CONTAINER_LINK</a>, <a class="el" href="astobj_8h_source.html#l00376">ASTOBJ_CONTAINER_TRAVERSE</a>, <a class="el" href="astobj_8h_source.html#l00283">ASTOBJ_CONTAINER_UNLOCK</a>, <a class="el" href="astobj_8h_source.html#l00280">ASTOBJ_CONTAINER_WRLOCK</a>, <a class="el" href="astobj_8h_source.html#l00100">ASTOBJ_RDLOCK</a>, <a class="el" href="astobj_8h_source.html#l00109">ASTOBJ_UNLOCK</a>, <a class="el" href="astobj_8h_source.html#l00218">ASTOBJ_UNREF</a>, <a class="el" href="chan__h323_8c_source.html#l00130">bindaddr</a>, <a class="el" href="chan__h323_8c_source.html#l01191">build_alias()</a>, <a class="el" href="chan__h323_8c_source.html#l01478">build_peer()</a>, <a class="el" href="chan__h323_8c_source.html#l01360">build_user()</a>, <a class="el" href="config_8h_source.html#l00043">CONFIG_FLAG_FILEUNCHANGED</a>, <a class="el" href="config_8h_source.html#l00050">CONFIG_STATUS_FILEINVALID</a>, <a class="el" href="config_8h_source.html#l00049">CONFIG_STATUS_FILEUNCHANGED</a>, <a class="el" href="chan__h323_8c_source.html#l02808">delete_aliases()</a>, <a class="el" href="chan__h323_8c_source.html#l02782">delete_users()</a>, <a class="el" href="app__externalivr_8c_source.html#l00243">gen</a>, <a class="el" href="chan__h323_8c_source.html#l00132">GLOBAL_CAPABILITY</a>, <a class="el" href="chan__h323_8c_source.html#l00124">global_jbconf</a>, <a class="el" href="chan__skinny_8c_source.html#l00982">hp</a>, <a class="el" href="config_8h_source.html#l00081">ast_variable::lineno</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="config_8h_source.html#l00075">ast_variable::name</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="chan__h323_8c_source.html#l00279">oh323_destroy_alias()</a>, <a class="el" href="chan__h323_8c_source.html#l00294">oh323_destroy_peer()</a>, <a class="el" href="chan__h323_8c_source.html#l00286">oh323_destroy_user()</a>, <a class="el" href="chan__h323_8c.html#a73d22ff9770f2c94dac6e92c3eddea5f">peerl</a>, <a class="el" href="chan__h323_8c_source.html#l02826">prune_peers()</a>, <a class="el" href="chan__h323_8c_source.html#l01251">update_common_options()</a>, <a class="el" href="chan__h323_8c.html#ab8937033f3230cb7adfe1e86d2055a5e">userl</a>, and <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l03119">h323_do_reload()</a>, and <a class="el" href="chan__h323_8c_source.html#l03222">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02833"></a>02833 {
<a name="l02834"></a>02834    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *cfg, *ucfg;
<a name="l02835"></a>02835    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *v;
<a name="l02836"></a>02836    <span class="keyword">struct </span>oh323_peer *peer = NULL;
<a name="l02837"></a>02837    <span class="keyword">struct </span>oh323_user *<a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a> = NULL;
<a name="l02838"></a>02838    <span class="keyword">struct </span>oh323_alias *alias = NULL;
<a name="l02839"></a>02839    <span class="keyword">struct </span><a class="code" href="structast__hostent.html">ast_hostent</a> <a class="code" href="chan__skinny_8c.html#a9e435aef83f14da6d3d5ec44f821558e">ahp</a>; <span class="keyword">struct </span>hostent *<a class="code" href="chan__skinny_8c.html#aa0f575fa3882aa394cc287edba645a35">hp</a>;
<a name="l02840"></a>02840    <span class="keywordtype">char</span> *cat;
<a name="l02841"></a>02841    <span class="keyword">const</span> <span class="keywordtype">char</span> *utype;
<a name="l02842"></a>02842    <span class="keywordtype">int</span> is_user, is_peer, is_alias;
<a name="l02843"></a>02843    <span class="keywordtype">char</span> _gatekeeper[100];
<a name="l02844"></a>02844    <span class="keywordtype">int</span> gk_discover, gk_disable, gk_changed;
<a name="l02845"></a>02845    <span class="keyword">struct </span><a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> <a class="code" href="app__rpt_8c.html#a1f57f20c1f46890828791a4827fe8752">config_flags</a> = { is_reload ? <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26afa887389dc380bbdcffb65fec379f037">CONFIG_FLAG_FILEUNCHANGED</a> : 0 };
<a name="l02846"></a>02846 
<a name="l02847"></a>02847    cfg = <a class="code" href="config_8h.html#a0a07ddd6bbcf44485e01c14c96109482">ast_config_load</a>(<a class="code" href="chan__h323_8c.html#a9ee8d742a1fbcff45f97842b92952610">config</a>, config_flags);
<a name="l02848"></a>02848 
<a name="l02849"></a>02849    <span class="comment">/* We *must* have a config file otherwise stop immediately */</span>
<a name="l02850"></a>02850    <span class="keywordflow">if</span> (!cfg) {
<a name="l02851"></a>02851       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Unable to load config %s, H.323 disabled\n&quot;</span>, <a class="code" href="chan__h323_8c.html#a9ee8d742a1fbcff45f97842b92952610">config</a>);
<a name="l02852"></a>02852       <span class="keywordflow">return</span> 1;
<a name="l02853"></a>02853    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cfg == <a class="code" href="config_8h.html#a846844eb2c4eb44554445936b3770711">CONFIG_STATUS_FILEUNCHANGED</a>) {
<a name="l02854"></a>02854       ucfg = <a class="code" href="config_8h.html#a0a07ddd6bbcf44485e01c14c96109482">ast_config_load</a>(<span class="stringliteral">&quot;users.conf&quot;</span>, config_flags);
<a name="l02855"></a>02855       <span class="keywordflow">if</span> (ucfg == <a class="code" href="config_8h.html#a846844eb2c4eb44554445936b3770711">CONFIG_STATUS_FILEUNCHANGED</a>) {
<a name="l02856"></a>02856          <span class="keywordflow">return</span> 0;
<a name="l02857"></a>02857       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ucfg == <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>) {
<a name="l02858"></a>02858          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Config file users.conf is in an invalid format.  Aborting.\n&quot;</span>);
<a name="l02859"></a>02859          <span class="keywordflow">return</span> 0;
<a name="l02860"></a>02860       }
<a name="l02861"></a>02861       <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(&amp;config_flags, <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26afa887389dc380bbdcffb65fec379f037">CONFIG_FLAG_FILEUNCHANGED</a>);
<a name="l02862"></a>02862       <span class="keywordflow">if</span> ((cfg = <a class="code" href="config_8h.html#a0a07ddd6bbcf44485e01c14c96109482">ast_config_load</a>(<a class="code" href="chan__h323_8c.html#a9ee8d742a1fbcff45f97842b92952610">config</a>, config_flags)) == <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>) {
<a name="l02863"></a>02863          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Config file %s is in an invalid format.  Aborting.\n&quot;</span>, <a class="code" href="chan__h323_8c.html#a9ee8d742a1fbcff45f97842b92952610">config</a>);
<a name="l02864"></a>02864          <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(ucfg);
<a name="l02865"></a>02865          <span class="keywordflow">return</span> 0;
<a name="l02866"></a>02866       }
<a name="l02867"></a>02867    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cfg == <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>) {
<a name="l02868"></a>02868       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Config file %s is in an invalid format.  Aborting.\n&quot;</span>, <a class="code" href="chan__h323_8c.html#a9ee8d742a1fbcff45f97842b92952610">config</a>);
<a name="l02869"></a>02869       <span class="keywordflow">return</span> 0;
<a name="l02870"></a>02870    } <span class="keywordflow">else</span> {
<a name="l02871"></a>02871       <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(&amp;config_flags, <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26afa887389dc380bbdcffb65fec379f037">CONFIG_FLAG_FILEUNCHANGED</a>);
<a name="l02872"></a>02872       <span class="keywordflow">if</span> ((ucfg = <a class="code" href="config_8h.html#a0a07ddd6bbcf44485e01c14c96109482">ast_config_load</a>(<span class="stringliteral">&quot;users.conf&quot;</span>, config_flags)) == <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>) {
<a name="l02873"></a>02873          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Config file users.conf is in an invalid format.  Aborting.\n&quot;</span>);
<a name="l02874"></a>02874          <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(cfg);
<a name="l02875"></a>02875          <span class="keywordflow">return</span> 0;
<a name="l02876"></a>02876       }
<a name="l02877"></a>02877    }
<a name="l02878"></a>02878 
<a name="l02879"></a>02879    <span class="keywordflow">if</span> (is_reload) {
<a name="l02880"></a>02880       <a class="code" href="chan__h323_8c.html#ace322a3e8008af8b872b72770e97fa85">delete_users</a>();
<a name="l02881"></a>02881       <a class="code" href="chan__h323_8c.html#aa77a93372791bbbc3a75fc5f18b92b0d">delete_aliases</a>();
<a name="l02882"></a>02882       <a class="code" href="chan__h323_8c.html#a55c82d81ce37ebe5125d5a017c12b5ac">prune_peers</a>();
<a name="l02883"></a>02883    }
<a name="l02884"></a>02884 
<a name="l02885"></a>02885    <span class="comment">/* fire up the H.323 Endpoint */</span>
<a name="l02886"></a>02886    <span class="keywordflow">if</span> (!h323_end_point_exist()) {
<a name="l02887"></a>02887       h323_end_point_create();
<a name="l02888"></a>02888    }
<a name="l02889"></a>02889    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(_gatekeeper, <a class="code" href="chan__h323_8c.html#a4bd4778b66bf079c2227fe62ec9a3e73">gatekeeper</a>, <span class="keyword">sizeof</span>(_gatekeeper));
<a name="l02890"></a>02890    gk_discover = <a class="code" href="chan__h323_8c.html#a1bcd9525b45f12be3151ff75d7f9712f">gatekeeper_discover</a>;
<a name="l02891"></a>02891    gk_disable = <a class="code" href="chan__h323_8c.html#abf24fbc8556bb94e3e636bfa53170b7d">gatekeeper_disable</a>;
<a name="l02892"></a>02892    memset(&amp;<a class="code" href="chan__h323_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="chan__h323_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>));
<a name="l02893"></a>02893    memset(&amp;<a class="code" href="chan__h323_8c.html#ab2aace2a2c551db5a7ce9ccadc159b72">global_options</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="chan__h323_8c.html#ab2aace2a2c551db5a7ce9ccadc159b72">global_options</a>));
<a name="l02894"></a>02894    <a class="code" href="chan__h323_8c.html#ab2aace2a2c551db5a7ce9ccadc159b72">global_options</a>.fastStart = 1;
<a name="l02895"></a>02895    <a class="code" href="chan__h323_8c.html#ab2aace2a2c551db5a7ce9ccadc159b72">global_options</a>.h245Tunneling = 1;
<a name="l02896"></a>02896    <a class="code" href="chan__h323_8c.html#ab2aace2a2c551db5a7ce9ccadc159b72">global_options</a>.dtmfcodec[0] = H323_DTMF_RFC2833_PT;
<a name="l02897"></a>02897    <a class="code" href="chan__h323_8c.html#ab2aace2a2c551db5a7ce9ccadc159b72">global_options</a>.dtmfcodec[1] = H323_DTMF_CISCO_PT;
<a name="l02898"></a>02898    <a class="code" href="chan__h323_8c.html#ab2aace2a2c551db5a7ce9ccadc159b72">global_options</a>.dtmfmode = 0;
<a name="l02899"></a>02899    <a class="code" href="chan__h323_8c.html#ab2aace2a2c551db5a7ce9ccadc159b72">global_options</a>.holdHandling = 0;
<a name="l02900"></a>02900    <a class="code" href="chan__h323_8c.html#ab2aace2a2c551db5a7ce9ccadc159b72">global_options</a>.capability = <a class="code" href="chan__h323_8c.html#a2675432ddd8161cbe434c098fb535aa3">GLOBAL_CAPABILITY</a>;
<a name="l02901"></a>02901    <a class="code" href="chan__h323_8c.html#ab2aace2a2c551db5a7ce9ccadc159b72">global_options</a>.bridge = 1;    <span class="comment">/* Do native bridging by default */</span>
<a name="l02902"></a>02902    <a class="code" href="chan__h323_8c.html#ab2aace2a2c551db5a7ce9ccadc159b72">global_options</a>.autoframing = 0;
<a name="l02903"></a>02903    strcpy(<a class="code" href="chan__h323_8c.html#a7dc6cff9d51743005af0fcf0c37251ad">default_context</a>, <span class="stringliteral">&quot;default&quot;</span>);
<a name="l02904"></a>02904    <a class="code" href="chan__h323_8c.html#a7f366397aeb2f3ce05c337d8a8b32a09">h323_signalling_port</a> = 1720;
<a name="l02905"></a>02905    <a class="code" href="chan__h323_8c.html#abf24fbc8556bb94e3e636bfa53170b7d">gatekeeper_disable</a> = 1;
<a name="l02906"></a>02906    <a class="code" href="chan__h323_8c.html#a1bcd9525b45f12be3151ff75d7f9712f">gatekeeper_discover</a> = 0;
<a name="l02907"></a>02907    <a class="code" href="chan__h323_8c.html#ac870109b5266804b2ae791184ed556b8">gkroute</a> = 0;
<a name="l02908"></a>02908    <a class="code" href="chan__h323_8c.html#af8106a09b3ed0924050635f9a8a19fca">userbyalias</a> = 1;
<a name="l02909"></a>02909    <a class="code" href="chan__h323_8c.html#a782aff739a0c7035182f9d10828cbe35">acceptAnonymous</a> = 1;
<a name="l02910"></a>02910    <a class="code" href="chan__h323_8c.html#a25a9305efab3b493ca2519562fcec3d5">tos</a> = 0;
<a name="l02911"></a>02911    <a class="code" href="chan__h323_8c.html#ae91dad65f553f7afebe4af507803bc7f">cos</a> = 0;
<a name="l02912"></a>02912 
<a name="l02913"></a>02913    <span class="comment">/* Copy the default jb config over global_jbconf */</span>
<a name="l02914"></a>02914    memcpy(&amp;<a class="code" href="chan__h323_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">global_jbconf</a>, &amp;<a class="code" href="chan__h323_8c.html#a2d8d5920e90ccbad7832926becdadb29" title="Global jitterbuffer configuration - by default, jb is disabled.">default_jbconf</a>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__jb__conf.html" title="General jitterbuffer configuration.">ast_jb_conf</a>));
<a name="l02915"></a>02915 
<a name="l02916"></a>02916    <span class="keywordflow">if</span> (ucfg) {
<a name="l02917"></a>02917       <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="app__externalivr_8c.html#abe143f1bae4445e9b3798e1dec3bda60">gen</a>;
<a name="l02918"></a>02918       <span class="keywordtype">int</span> genhas_h323;
<a name="l02919"></a>02919       <span class="keyword">const</span> <span class="keywordtype">char</span> *has_h323;
<a name="l02920"></a>02920 
<a name="l02921"></a>02921       genhas_h323 = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(<a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(ucfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;hash323&quot;</span>));
<a name="l02922"></a>02922       gen = <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(ucfg, <span class="stringliteral">&quot;general&quot;</span>);
<a name="l02923"></a>02923       <span class="keywordflow">for</span> (cat = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(ucfg, NULL); cat; cat = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(ucfg, cat)) {
<a name="l02924"></a>02924          <span class="keywordflow">if</span> (strcasecmp(cat, <span class="stringliteral">&quot;general&quot;</span>)) {
<a name="l02925"></a>02925             has_h323 = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(ucfg, cat, <span class="stringliteral">&quot;hash323&quot;</span>);
<a name="l02926"></a>02926             <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(has_h323) || (!has_h323 &amp;&amp; genhas_h323)) {
<a name="l02927"></a>02927                user = <a class="code" href="chan__h323_8c.html#af5ea8aafcd4cedda80e628ca32386fe8">build_user</a>(cat, gen, <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(ucfg, cat), 0);
<a name="l02928"></a>02928                <span class="keywordflow">if</span> (user) {
<a name="l02929"></a>02929                   <a class="code" href="astobj_8h.html#a73bb2d9f59430fd47007a3c6ea651de6" title="Add an object to a container.">ASTOBJ_CONTAINER_LINK</a>(&amp;<a class="code" href="chan__h323_8c.html#ab8937033f3230cb7adfe1e86d2055a5e" title="H323 User list.">userl</a>, user);
<a name="l02930"></a>02930                   <a class="code" href="astobj_8h.html#aed02826b481ce75ec710c1184ac8f059" title="Decrement the reference count on an object.">ASTOBJ_UNREF</a>(user, <a class="code" href="chan__h323_8c.html#ad2a4b95f164d86a67d96a23c8714157b">oh323_destroy_user</a>);
<a name="l02931"></a>02931                }
<a name="l02932"></a>02932                peer = <a class="code" href="chan__h323_8c.html#a53c07cbdf5928cad397e68d05d64c0cf">build_peer</a>(cat, gen, <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(ucfg, cat), 0);
<a name="l02933"></a>02933                <span class="keywordflow">if</span> (peer) {
<a name="l02934"></a>02934                   <a class="code" href="astobj_8h.html#a73bb2d9f59430fd47007a3c6ea651de6" title="Add an object to a container.">ASTOBJ_CONTAINER_LINK</a>(&amp;<a class="code" href="chan__h323_8c.html#a73d22ff9770f2c94dac6e92c3eddea5f" title="H323 peer list.">peerl</a>, peer);
<a name="l02935"></a>02935                   <a class="code" href="astobj_8h.html#aed02826b481ce75ec710c1184ac8f059" title="Decrement the reference count on an object.">ASTOBJ_UNREF</a>(peer, <a class="code" href="chan__h323_8c.html#ad2fe7bc6fcd60293a92f883ff5d03fc0">oh323_destroy_peer</a>);
<a name="l02936"></a>02936                }
<a name="l02937"></a>02937             }
<a name="l02938"></a>02938          }
<a name="l02939"></a>02939       }
<a name="l02940"></a>02940       <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(ucfg);
<a name="l02941"></a>02941    }
<a name="l02942"></a>02942 
<a name="l02943"></a>02943    <span class="keywordflow">for</span> (v = <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>); v; v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l02944"></a>02944       <span class="comment">/* handle jb conf */</span>
<a name="l02945"></a>02945       <span class="keywordflow">if</span> (!<a class="code" href="abstract__jb_8h.html#ae50ad081bd2ae6b58bcfc4687916c586" title="Sets jitterbuffer configuration property.">ast_jb_read_conf</a>(&amp;<a class="code" href="chan__h323_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">global_jbconf</a>, v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>))
<a name="l02946"></a>02946          <span class="keywordflow">continue</span>;
<a name="l02947"></a>02947       <span class="comment">/* Create the interface list */</span>
<a name="l02948"></a>02948       <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;port&quot;</span>)) {
<a name="l02949"></a>02949          <a class="code" href="chan__h323_8c.html#a7f366397aeb2f3ce05c337d8a8b32a09">h323_signalling_port</a> = (int)strtol(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, NULL, 10);
<a name="l02950"></a>02950       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;bindaddr&quot;</span>)) {
<a name="l02951"></a>02951          <span class="keywordflow">if</span> (!(hp = <a class="code" href="utils_8h.html#ad3b63ee1041593219ef0765b28d70442" title="Thread-safe gethostbyname function to use in Asterisk.">ast_gethostbyname</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, &amp;<a class="code" href="chan__skinny_8c.html#a9e435aef83f14da6d3d5ec44f821558e">ahp</a>))) {
<a name="l02952"></a>02952             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid address: %s\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l02953"></a>02953          } <span class="keywordflow">else</span> {
<a name="l02954"></a>02954             memcpy(&amp;<a class="code" href="chan__h323_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>.sin_addr, hp-&gt;h_addr, <span class="keyword">sizeof</span>(<a class="code" href="chan__h323_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>.sin_addr));
<a name="l02955"></a>02955          }
<a name="l02956"></a>02956       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;tos&quot;</span>)) { <span class="comment">/* Needs to be removed in next release */</span>
<a name="l02957"></a>02957          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;The \&quot;tos\&quot; setting is deprecated in this version of Asterisk. Please change to \&quot;tos_audio\&quot;.\n&quot;</span>);
<a name="l02958"></a>02958          <span class="keywordflow">if</span> (<a class="code" href="acl_8h.html#a49d1eefe77636e2a63ad013afa0fc3b5">ast_str2tos</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, &amp;<a class="code" href="chan__h323_8c.html#a25a9305efab3b493ca2519562fcec3d5">tos</a>)) {
<a name="l02959"></a>02959             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid tos_audio value at line %d, refer to QoS documentation\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);        
<a name="l02960"></a>02960          }
<a name="l02961"></a>02961       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;tos_audio&quot;</span>)) {
<a name="l02962"></a>02962          <span class="keywordflow">if</span> (<a class="code" href="acl_8h.html#a49d1eefe77636e2a63ad013afa0fc3b5">ast_str2tos</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, &amp;<a class="code" href="chan__h323_8c.html#a25a9305efab3b493ca2519562fcec3d5">tos</a>)) {
<a name="l02963"></a>02963             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid tos_audio value at line %d, refer to QoS documentation\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);        
<a name="l02964"></a>02964          }
<a name="l02965"></a>02965       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;cos&quot;</span>)) {
<a name="l02966"></a>02966          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;The \&quot;cos\&quot; setting is deprecated in this version of Asterisk. Please change to \&quot;cos_audio\&quot;.\n&quot;</span>);
<a name="l02967"></a>02967          <span class="keywordflow">if</span> (<a class="code" href="acl_8h.html#ad364a9241e15fc0dbec0ffcb88f64671">ast_str2cos</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, &amp;<a class="code" href="chan__h323_8c.html#ae91dad65f553f7afebe4af507803bc7f">cos</a>)) {
<a name="l02968"></a>02968             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid cos_audio value at line %d, refer to QoS documentation\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);        
<a name="l02969"></a>02969          }
<a name="l02970"></a>02970       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;cos_audio&quot;</span>)) {
<a name="l02971"></a>02971          <span class="keywordflow">if</span> (<a class="code" href="acl_8h.html#ad364a9241e15fc0dbec0ffcb88f64671">ast_str2cos</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, &amp;<a class="code" href="chan__h323_8c.html#ae91dad65f553f7afebe4af507803bc7f">cos</a>)) {
<a name="l02972"></a>02972             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid cos_audio value at line %d, refer to QoS documentation\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);        
<a name="l02973"></a>02973          }
<a name="l02974"></a>02974       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;gatekeeper&quot;</span>)) {
<a name="l02975"></a>02975          <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;DISABLE&quot;</span>)) {
<a name="l02976"></a>02976             <a class="code" href="chan__h323_8c.html#abf24fbc8556bb94e3e636bfa53170b7d">gatekeeper_disable</a> = 1;
<a name="l02977"></a>02977          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;DISCOVER&quot;</span>)) {
<a name="l02978"></a>02978             <a class="code" href="chan__h323_8c.html#abf24fbc8556bb94e3e636bfa53170b7d">gatekeeper_disable</a> = 0;
<a name="l02979"></a>02979             <a class="code" href="chan__h323_8c.html#a1bcd9525b45f12be3151ff75d7f9712f">gatekeeper_discover</a> = 1;
<a name="l02980"></a>02980          } <span class="keywordflow">else</span> {
<a name="l02981"></a>02981             <a class="code" href="chan__h323_8c.html#abf24fbc8556bb94e3e636bfa53170b7d">gatekeeper_disable</a> = 0;
<a name="l02982"></a>02982             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="chan__h323_8c.html#a4bd4778b66bf079c2227fe62ec9a3e73">gatekeeper</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(<a class="code" href="chan__h323_8c.html#a4bd4778b66bf079c2227fe62ec9a3e73">gatekeeper</a>));
<a name="l02983"></a>02983          }
<a name="l02984"></a>02984       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;secret&quot;</span>)) {
<a name="l02985"></a>02985          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="chan__h323_8c.html#a67fefea55602b6c8d1e29902f600e249">secret</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(<a class="code" href="chan__h323_8c.html#a67fefea55602b6c8d1e29902f600e249">secret</a>));
<a name="l02986"></a>02986       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;AllowGKRouted&quot;</span>)) {
<a name="l02987"></a>02987          <a class="code" href="chan__h323_8c.html#ac870109b5266804b2ae791184ed556b8">gkroute</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l02988"></a>02988       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;context&quot;</span>)) {
<a name="l02989"></a>02989          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="chan__h323_8c.html#a7dc6cff9d51743005af0fcf0c37251ad">default_context</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(<a class="code" href="chan__h323_8c.html#a7dc6cff9d51743005af0fcf0c37251ad">default_context</a>));
<a name="l02990"></a>02990          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Setting default context to %s\n&quot;</span>, <a class="code" href="chan__h323_8c.html#a7dc6cff9d51743005af0fcf0c37251ad">default_context</a>);
<a name="l02991"></a>02991       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;UserByAlias&quot;</span>)) {
<a name="l02992"></a>02992          <a class="code" href="chan__h323_8c.html#af8106a09b3ed0924050635f9a8a19fca">userbyalias</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l02993"></a>02993       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;AcceptAnonymous&quot;</span>)) {
<a name="l02994"></a>02994          <a class="code" href="chan__h323_8c.html#a782aff739a0c7035182f9d10828cbe35">acceptAnonymous</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l02995"></a>02995       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="chan__h323_8c.html#a7203b2d801c8bd449671f862cf6b2b24">update_common_options</a>(v, &amp;<a class="code" href="chan__h323_8c.html#ab2aace2a2c551db5a7ce9ccadc159b72">global_options</a>)) {
<a name="l02996"></a>02996          <span class="comment">/* dummy */</span>
<a name="l02997"></a>02997       }
<a name="l02998"></a>02998    }
<a name="l02999"></a>02999    <span class="keywordflow">if</span> (!<a class="code" href="chan__h323_8c.html#ab2aace2a2c551db5a7ce9ccadc159b72">global_options</a>.dtmfmode)
<a name="l03000"></a>03000       <a class="code" href="chan__h323_8c.html#ab2aace2a2c551db5a7ce9ccadc159b72">global_options</a>.dtmfmode = H323_DTMF_RFC2833;
<a name="l03001"></a>03001    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#ab2aace2a2c551db5a7ce9ccadc159b72">global_options</a>.holdHandling == ~0)
<a name="l03002"></a>03002       <a class="code" href="chan__h323_8c.html#ab2aace2a2c551db5a7ce9ccadc159b72">global_options</a>.holdHandling = 0;
<a name="l03003"></a>03003    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="chan__h323_8c.html#ab2aace2a2c551db5a7ce9ccadc159b72">global_options</a>.holdHandling)
<a name="l03004"></a>03004       <a class="code" href="chan__h323_8c.html#ab2aace2a2c551db5a7ce9ccadc159b72">global_options</a>.holdHandling = H323_HOLD_H450;
<a name="l03005"></a>03005 
<a name="l03006"></a>03006    <span class="keywordflow">for</span> (cat = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(cfg, NULL); cat; cat = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(cfg, cat)) {
<a name="l03007"></a>03007       <span class="keywordflow">if</span> (strcasecmp(cat, <span class="stringliteral">&quot;general&quot;</span>)) {
<a name="l03008"></a>03008          utype = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, cat, <span class="stringliteral">&quot;type&quot;</span>);
<a name="l03009"></a>03009          <span class="keywordflow">if</span> (utype) {
<a name="l03010"></a>03010             is_user = is_peer = is_alias = 0;
<a name="l03011"></a>03011             <span class="keywordflow">if</span> (!strcasecmp(utype, <span class="stringliteral">&quot;user&quot;</span>))
<a name="l03012"></a>03012                is_user = 1;
<a name="l03013"></a>03013             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(utype, <span class="stringliteral">&quot;peer&quot;</span>))
<a name="l03014"></a>03014                is_peer = 1;
<a name="l03015"></a>03015             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(utype, <span class="stringliteral">&quot;friend&quot;</span>))
<a name="l03016"></a>03016                is_user = is_peer = 1;
<a name="l03017"></a>03017             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(utype, <span class="stringliteral">&quot;h323&quot;</span>) || !strcasecmp(utype, <span class="stringliteral">&quot;alias&quot;</span>))
<a name="l03018"></a>03018                is_alias = 1;
<a name="l03019"></a>03019             <span class="keywordflow">else</span> {
<a name="l03020"></a>03020                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unknown type &apos;%s&apos; for &apos;%s&apos; in %s\n&quot;</span>, utype, cat, <a class="code" href="chan__h323_8c.html#a9ee8d742a1fbcff45f97842b92952610">config</a>);
<a name="l03021"></a>03021                <span class="keywordflow">continue</span>;
<a name="l03022"></a>03022             }
<a name="l03023"></a>03023             <span class="keywordflow">if</span> (is_user) {
<a name="l03024"></a>03024                user = <a class="code" href="chan__h323_8c.html#af5ea8aafcd4cedda80e628ca32386fe8">build_user</a>(cat, <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(cfg, cat), NULL, 0);
<a name="l03025"></a>03025                <span class="keywordflow">if</span> (user) {
<a name="l03026"></a>03026                   <a class="code" href="astobj_8h.html#a73bb2d9f59430fd47007a3c6ea651de6" title="Add an object to a container.">ASTOBJ_CONTAINER_LINK</a>(&amp;<a class="code" href="chan__h323_8c.html#ab8937033f3230cb7adfe1e86d2055a5e" title="H323 User list.">userl</a>, user);
<a name="l03027"></a>03027                   <a class="code" href="astobj_8h.html#aed02826b481ce75ec710c1184ac8f059" title="Decrement the reference count on an object.">ASTOBJ_UNREF</a>(user, <a class="code" href="chan__h323_8c.html#ad2a4b95f164d86a67d96a23c8714157b">oh323_destroy_user</a>);
<a name="l03028"></a>03028                }
<a name="l03029"></a>03029             }
<a name="l03030"></a>03030             <span class="keywordflow">if</span> (is_peer) {
<a name="l03031"></a>03031                peer = <a class="code" href="chan__h323_8c.html#a53c07cbdf5928cad397e68d05d64c0cf">build_peer</a>(cat, <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(cfg, cat), NULL, 0);
<a name="l03032"></a>03032                <span class="keywordflow">if</span> (peer) {
<a name="l03033"></a>03033                   <a class="code" href="astobj_8h.html#a73bb2d9f59430fd47007a3c6ea651de6" title="Add an object to a container.">ASTOBJ_CONTAINER_LINK</a>(&amp;<a class="code" href="chan__h323_8c.html#a73d22ff9770f2c94dac6e92c3eddea5f" title="H323 peer list.">peerl</a>, peer);
<a name="l03034"></a>03034                   <a class="code" href="astobj_8h.html#aed02826b481ce75ec710c1184ac8f059" title="Decrement the reference count on an object.">ASTOBJ_UNREF</a>(peer, <a class="code" href="chan__h323_8c.html#ad2fe7bc6fcd60293a92f883ff5d03fc0">oh323_destroy_peer</a>);
<a name="l03035"></a>03035                }
<a name="l03036"></a>03036             }
<a name="l03037"></a>03037             <span class="keywordflow">if</span> (is_alias) {
<a name="l03038"></a>03038                alias = <a class="code" href="chan__h323_8c.html#a7c5637b8e64dc84dacbd47037572f99e">build_alias</a>(cat, <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(cfg, cat), NULL, 0);
<a name="l03039"></a>03039                <span class="keywordflow">if</span> (alias) {
<a name="l03040"></a>03040                   <a class="code" href="astobj_8h.html#a73bb2d9f59430fd47007a3c6ea651de6" title="Add an object to a container.">ASTOBJ_CONTAINER_LINK</a>(&amp;<a class="code" href="chan__h323_8c.html#a2029bed642f94cb8e3299209b084e585" title="H323 alias list.">aliasl</a>, alias);
<a name="l03041"></a>03041                   <a class="code" href="astobj_8h.html#aed02826b481ce75ec710c1184ac8f059" title="Decrement the reference count on an object.">ASTOBJ_UNREF</a>(alias, <a class="code" href="chan__h323_8c.html#a9ebae4396be42baf2785e593f5fede69">oh323_destroy_alias</a>);
<a name="l03042"></a>03042                }
<a name="l03043"></a>03043             }
<a name="l03044"></a>03044          } <span class="keywordflow">else</span> {
<a name="l03045"></a>03045             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Section &apos;%s&apos; lacks type\n&quot;</span>, cat);
<a name="l03046"></a>03046          }
<a name="l03047"></a>03047       }
<a name="l03048"></a>03048    }
<a name="l03049"></a>03049    <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(cfg);
<a name="l03050"></a>03050 
<a name="l03051"></a>03051    <span class="comment">/* Register our H.323 aliases if any*/</span>
<a name="l03052"></a>03052    <a class="code" href="astobj_8h.html#afd5426b59fc40457028874afefbf2220" title="Lock an ASTOBJ_CONTAINER for writing.">ASTOBJ_CONTAINER_WRLOCK</a>(&amp;<a class="code" href="chan__h323_8c.html#a2029bed642f94cb8e3299209b084e585" title="H323 alias list.">aliasl</a>);
<a name="l03053"></a>03053    <a class="code" href="astobj_8h.html#a8483cbd2bcf0b91ac62168fb1cb7f5b1" title="Iterate through the objects in a container.">ASTOBJ_CONTAINER_TRAVERSE</a>(&amp;<a class="code" href="chan__h323_8c.html#a2029bed642f94cb8e3299209b084e585" title="H323 alias list.">aliasl</a>, 1, <span class="keywordflow">do</span> {
<a name="l03054"></a>03054       <a class="code" href="astobj_8h.html#a8d411cc142b0b49472fe38cf7b0845e1" title="Lock an ASTOBJ for reading.">ASTOBJ_RDLOCK</a>(iterator);
<a name="l03055"></a>03055       <span class="keywordflow">if</span> (h323_set_alias(iterator)) {
<a name="l03056"></a>03056          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Alias %s rejected by endpoint\n&quot;</span>, alias-&gt;name);
<a name="l03057"></a>03057          <a class="code" href="astobj_8h.html#a9acee27cc52e8533d439f6cc10d11fbc" title="Unlock a locked object.">ASTOBJ_UNLOCK</a>(iterator);
<a name="l03058"></a>03058          <span class="keywordflow">continue</span>;
<a name="l03059"></a>03059       }
<a name="l03060"></a>03060       <a class="code" href="astobj_8h.html#a9acee27cc52e8533d439f6cc10d11fbc" title="Unlock a locked object.">ASTOBJ_UNLOCK</a>(iterator);
<a name="l03061"></a>03061    } <span class="keywordflow">while</span> (0) );
<a name="l03062"></a>03062    <a class="code" href="astobj_8h.html#aa427859308cff6f8153760f7f67e5e30" title="Unlock an ASTOBJ_CONTAINER.">ASTOBJ_CONTAINER_UNLOCK</a>(&amp;<a class="code" href="chan__h323_8c.html#a2029bed642f94cb8e3299209b084e585" title="H323 alias list.">aliasl</a>);
<a name="l03063"></a>03063 
<a name="l03064"></a>03064    <span class="comment">/* Don&apos;t touch GK if nothing changed because URQ will drop all existing calls */</span>
<a name="l03065"></a>03065    gk_changed = 0;
<a name="l03066"></a>03066    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#abf24fbc8556bb94e3e636bfa53170b7d">gatekeeper_disable</a> != gk_disable)
<a name="l03067"></a>03067       gk_changed = is_reload;
<a name="l03068"></a>03068    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!<a class="code" href="chan__h323_8c.html#abf24fbc8556bb94e3e636bfa53170b7d">gatekeeper_disable</a> &amp;&amp; (<a class="code" href="chan__h323_8c.html#a1bcd9525b45f12be3151ff75d7f9712f">gatekeeper_discover</a> != gk_discover))
<a name="l03069"></a>03069       gk_changed = is_reload;
<a name="l03070"></a>03070    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!<a class="code" href="chan__h323_8c.html#abf24fbc8556bb94e3e636bfa53170b7d">gatekeeper_disable</a> &amp;&amp; (strncmp(_gatekeeper, <a class="code" href="chan__h323_8c.html#a4bd4778b66bf079c2227fe62ec9a3e73">gatekeeper</a>, <span class="keyword">sizeof</span>(_gatekeeper)) != 0))
<a name="l03071"></a>03071       gk_changed = is_reload;
<a name="l03072"></a>03072    <span class="keywordflow">if</span> (gk_changed) {
<a name="l03073"></a>03073       <span class="keywordflow">if</span>(!gk_disable)
<a name="l03074"></a>03074          h323_gk_urq();
<a name="l03075"></a>03075       <span class="keywordflow">if</span> (!<a class="code" href="chan__h323_8c.html#abf24fbc8556bb94e3e636bfa53170b7d">gatekeeper_disable</a>) {
<a name="l03076"></a>03076          <span class="keywordflow">if</span> (h323_set_gk(<a class="code" href="chan__h323_8c.html#a1bcd9525b45f12be3151ff75d7f9712f">gatekeeper_discover</a>, <a class="code" href="chan__h323_8c.html#a4bd4778b66bf079c2227fe62ec9a3e73">gatekeeper</a>, <a class="code" href="chan__h323_8c.html#a67fefea55602b6c8d1e29902f600e249">secret</a>)) {
<a name="l03077"></a>03077             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Gatekeeper registration failed.\n&quot;</span>);
<a name="l03078"></a>03078             <a class="code" href="chan__h323_8c.html#abf24fbc8556bb94e3e636bfa53170b7d">gatekeeper_disable</a> = 1;
<a name="l03079"></a>03079          }
<a name="l03080"></a>03080       }
<a name="l03081"></a>03081    }
<a name="l03082"></a>03082    <span class="keywordflow">return</span> 0;
<a name="l03083"></a>03083 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac1df53d236a5999adb52ea5a0bca678a"></a><!-- doxytag: member="chan_h323.c::remote_hold" ref="ac1df53d236a5999adb52ea5a0bca678a" args="(unsigned call_reference, const char *token, int is_hold)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void remote_hold </td>
          <td>(</td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>call_reference</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>is_hold</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l02503">2503</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02037">ast_channel_trylock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="frame_8h_source.html#l00313">AST_CONTROL_HOLD</a>, <a class="el" href="frame_8h_source.html#l00314">AST_CONTROL_UNHOLD</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="channel_8c_source.html#l01123">ast_queue_control()</a>, <a class="el" href="chan__h323_8c_source.html#l01144">find_call_locked()</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, <a class="el" href="chan__h323_8c_source.html#l00173">oh323_pvt::newcontrol</a>, and <a class="el" href="chan__h323_8c_source.html#l00157">oh323_pvt::owner</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l03222">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02504"></a>02504 {
<a name="l02505"></a>02505    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *pvt;
<a name="l02506"></a>02506 
<a name="l02507"></a>02507    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l02508"></a>02508       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Setting %shold status for connection %s\n&quot;</span>, (is_hold ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;un&quot;</span>), token);
<a name="l02509"></a>02509 
<a name="l02510"></a>02510    pvt = <a class="code" href="chan__h323_8c.html#a246fb1df8539e4f168a9bc8233ef76b9">find_call_locked</a>(call_reference, token);
<a name="l02511"></a>02511    <span class="keywordflow">if</span> (!pvt)
<a name="l02512"></a>02512       <span class="keywordflow">return</span>;
<a name="l02513"></a>02513    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; !<a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {
<a name="l02514"></a>02514       <span class="keywordflow">if</span> (is_hold)
<a name="l02515"></a>02515          <a class="code" href="channel_8h.html#a60f9d2b0ab8b7a839902313321163b28" title="Queue a control frame with payload.">ast_queue_control</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ab99a3d1c08c5ae8bca078c7cd1ec02f5">AST_CONTROL_HOLD</a>);
<a name="l02516"></a>02516       <span class="keywordflow">else</span>
<a name="l02517"></a>02517          <a class="code" href="channel_8h.html#a60f9d2b0ab8b7a839902313321163b28" title="Queue a control frame with payload.">ast_queue_control</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>);
<a name="l02518"></a>02518       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l02519"></a>02519    }
<a name="l02520"></a>02520    <span class="keywordflow">else</span> {
<a name="l02521"></a>02521       <span class="keywordflow">if</span> (is_hold)
<a name="l02522"></a>02522          pvt-&gt;<a class="code" href="structoh323__pvt.html#a96512445a0a8d8b2b9f40db190f33f14">newcontrol</a> = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ab99a3d1c08c5ae8bca078c7cd1ec02f5">AST_CONTROL_HOLD</a>;
<a name="l02523"></a>02523       <span class="keywordflow">else</span>
<a name="l02524"></a>02524          pvt-&gt;<a class="code" href="structoh323__pvt.html#a96512445a0a8d8b2b9f40db190f33f14">newcontrol</a> = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>;
<a name="l02525"></a>02525    }
<a name="l02526"></a>02526    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l02527"></a>02527 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a83af94bb19a421cb25ca02d16fa5ba9c"></a><!-- doxytag: member="chan_h323.c::restart_monitor" ref="a83af94bb19a421cb25ca02d16fa5ba9c" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int restart_monitor </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l02597">2597</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="utils_8h_source.html#l00384">ast_pthread_create_background</a>, <a class="el" href="lock_8h_source.html#l00082">AST_PTHREADT_NULL</a>, <a class="el" href="lock_8h_source.html#l00083">AST_PTHREADT_STOP</a>, <a class="el" href="chan__h323_8c_source.html#l02529">do_monitor()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, and <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l03085">h323_reload()</a>, <a class="el" href="chan__h323_8c_source.html#l03222">load_module()</a>, and <a class="el" href="chan__h323_8c_source.html#l01722">oh323_request()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02598"></a>02598 {
<a name="l02599"></a>02599    <span class="comment">/* If we&apos;re supposed to be stopped -- stay stopped */</span>
<a name="l02600"></a>02600    <span class="keywordflow">if</span> (<a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;monlock)) {
<a name="l02601"></a>02601       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to lock monitor\n&quot;</span>);
<a name="l02602"></a>02602       <span class="keywordflow">return</span> -1;
<a name="l02603"></a>02603    }
<a name="l02604"></a>02604    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a> == <a class="code" href="lock_8h.html#a873a83eb8196323194aac2bea23d794e">AST_PTHREADT_STOP</a>) {
<a name="l02605"></a>02605       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;monlock);
<a name="l02606"></a>02606       <span class="keywordflow">return</span> 0;
<a name="l02607"></a>02607    }
<a name="l02608"></a>02608    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a> == pthread_self()) {
<a name="l02609"></a>02609       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;monlock);
<a name="l02610"></a>02610       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot kill myself\n&quot;</span>);
<a name="l02611"></a>02611       <span class="keywordflow">return</span> -1;
<a name="l02612"></a>02612    }
<a name="l02613"></a>02613    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a> &amp;&amp; (<a class="code" href="chan__h323_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a> != <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>)) {
<a name="l02614"></a>02614       <span class="comment">/* Wake up the thread */</span>
<a name="l02615"></a>02615       pthread_kill(<a class="code" href="chan__h323_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a>, SIGURG);
<a name="l02616"></a>02616    } <span class="keywordflow">else</span> {
<a name="l02617"></a>02617       <span class="comment">/* Start a new monitor */</span>
<a name="l02618"></a>02618       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a595e2f8aa398f4bd21e381c3211235fe">ast_pthread_create_background</a>(&amp;<a class="code" href="chan__h323_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a>, NULL, <a class="code" href="chan__h323_8c.html#a02d8db6086b4a18353b82ebcad631ff6">do_monitor</a>, NULL) &lt; 0) {
<a name="l02619"></a>02619          <a class="code" href="chan__h323_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a> = <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>;
<a name="l02620"></a>02620          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;monlock);
<a name="l02621"></a>02621          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to start monitor thread.\n&quot;</span>);
<a name="l02622"></a>02622          <span class="keywordflow">return</span> -1;
<a name="l02623"></a>02623       }
<a name="l02624"></a>02624    }
<a name="l02625"></a>02625    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;monlock);
<a name="l02626"></a>02626    <span class="keywordflow">return</span> 0;
<a name="l02627"></a>02627 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3fe6108223a4ca1bf57716dc77a85038"></a><!-- doxytag: member="chan_h323.c::set_dtmf_payload" ref="a3fe6108223a4ca1bf57716dc77a85038" args="(unsigned call_reference, const char *token, int payload, int is_cisco)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void set_dtmf_payload </td>
          <td>(</td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>call_reference</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>is_cisco</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l02418">2418</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="rtp_8c_source.html#l02310">ast_rtp_set_rtpmap_type()</a>, <a class="el" href="chan__h323_8c_source.html#l00180">oh323_pvt::dtmf_pt</a>, <a class="el" href="chan__h323_8c_source.html#l01144">find_call_locked()</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, and <a class="el" href="chan__h323_8c_source.html#l00167">oh323_pvt::rtp</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l03222">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02419"></a>02419 {
<a name="l02420"></a>02420    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *pvt;
<a name="l02421"></a>02421 
<a name="l02422"></a>02422    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l02423"></a>02423       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Setting %s DTMF payload to %d on %s\n&quot;</span>, (is_cisco ? <span class="stringliteral">&quot;Cisco&quot;</span> : <span class="stringliteral">&quot;RFC2833&quot;</span>), payload, token);
<a name="l02424"></a>02424 
<a name="l02425"></a>02425    pvt = <a class="code" href="chan__h323_8c.html#a246fb1df8539e4f168a9bc8233ef76b9">find_call_locked</a>(call_reference, token);
<a name="l02426"></a>02426    <span class="keywordflow">if</span> (!pvt) {
<a name="l02427"></a>02427       <span class="keywordflow">return</span>;
<a name="l02428"></a>02428    }
<a name="l02429"></a>02429    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>) {
<a name="l02430"></a>02430       <a class="code" href="rtp_8h.html#a02a3ba4e11691cafd933cbb1e6225b3e" title="Set payload type to a known MIME media type for a codec.">ast_rtp_set_rtpmap_type</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, payload, <span class="stringliteral">&quot;audio&quot;</span>, (is_cisco ? <span class="stringliteral">&quot;cisco-telephone-event&quot;</span> : <span class="stringliteral">&quot;telephone-event&quot;</span>), 0);
<a name="l02431"></a>02431    }
<a name="l02432"></a>02432    pvt-&gt;<a class="code" href="structoh323__pvt.html#a2a424f83ef5dc1995dbf1d6ddf0a9e1f">dtmf_pt</a>[is_cisco ? 1 : 0] = payload;
<a name="l02433"></a>02433    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l02434"></a>02434    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l02435"></a>02435       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;DTMF payload on %s set to %d\n&quot;</span>, token, payload);
<a name="l02436"></a>02436 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3b2a3a72391ac7feafe74083f69db6fc"></a><!-- doxytag: member="chan_h323.c::set_local_capabilities" ref="a3b2a3a72391ac7feafe74083f69db6fc" args="(unsigned call_reference, const char *token)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void set_local_capabilities </td>
          <td>(</td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>call_reference</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>token</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l02473">2473</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8c_source.html#l00573">ast_getformatname()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="chan__mgcp_8c_source.html#l00214">capability</a>, <a class="el" href="chan__mgcp_8c_source.html#l00151">dtmfmode</a>, <a class="el" href="chan__h323_8c_source.html#l01144">find_call_locked()</a>, <a class="el" href="frame_8h_source.html#l00039">ast_codec_pref::framing</a>, <a class="el" href="chan__h323_8c_source.html#l00178">oh323_pvt::jointcapability</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, <a class="el" href="chan__h323_8c_source.html#l00153">oh323_pvt::options</a>, <a class="el" href="frame_8h_source.html#l00038">ast_codec_pref::order</a>, and <a class="el" href="chan__h323_8c_source.html#l00176">oh323_pvt::pref_codec</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l03222">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02474"></a>02474 {
<a name="l02475"></a>02475    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *pvt;
<a name="l02476"></a>02476    <span class="keywordtype">int</span> <a class="code" href="chan__mgcp_8c.html#afa05b14ff7f76f303c784c00c4c63fa7">capability</a>, <a class="code" href="chan__mgcp_8c.html#a0e5a76746e3addb17a93a158017c2273">dtmfmode</a>, <a class="code" href="structoh323__pvt.html#a6fd01f975d864a81168d037a1781d074">pref_codec</a>;
<a name="l02477"></a>02477    <span class="keyword">struct </span><a class="code" href="structast__codec__pref.html">ast_codec_pref</a> <a class="code" href="chan__iax2_8c.html#a46262e3cc2baf55a72542567ccfe86d9">prefs</a>;
<a name="l02478"></a>02478 
<a name="l02479"></a>02479    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l02480"></a>02480       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Setting capabilities for connection %s\n&quot;</span>, token);
<a name="l02481"></a>02481 
<a name="l02482"></a>02482    pvt = <a class="code" href="chan__h323_8c.html#a246fb1df8539e4f168a9bc8233ef76b9">find_call_locked</a>(call_reference, token);
<a name="l02483"></a>02483    <span class="keywordflow">if</span> (!pvt)
<a name="l02484"></a>02484       <span class="keywordflow">return</span>;
<a name="l02485"></a>02485    capability = (pvt-&gt;<a class="code" href="structoh323__pvt.html#a38f5730c90d9315eb1c0df6cfdc37da6">jointcapability</a>) ? pvt-&gt;<a class="code" href="structoh323__pvt.html#a38f5730c90d9315eb1c0df6cfdc37da6">jointcapability</a> : pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.capability;
<a name="l02486"></a>02486    dtmfmode = pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.dtmfmode;
<a name="l02487"></a>02487    <a class="code" href="chan__iax2_8c.html#a46262e3cc2baf55a72542567ccfe86d9">prefs</a> = pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.prefs;
<a name="l02488"></a>02488    pref_codec = pvt-&gt;<a class="code" href="structoh323__pvt.html#a6fd01f975d864a81168d037a1781d074">pref_codec</a>;
<a name="l02489"></a>02489    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l02490"></a>02490    h323_set_capabilities(token, capability, dtmfmode, &amp;<a class="code" href="chan__iax2_8c.html#a46262e3cc2baf55a72542567ccfe86d9">prefs</a>, pref_codec);
<a name="l02491"></a>02491 
<a name="l02492"></a>02492    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>) {
<a name="l02493"></a>02493       <span class="keywordtype">int</span> i;
<a name="l02494"></a>02494       <span class="keywordflow">for</span> (i = 0; i &lt; 32; i++) {
<a name="l02495"></a>02495          <span class="keywordflow">if</span> (!<a class="code" href="chan__iax2_8c.html#a46262e3cc2baf55a72542567ccfe86d9">prefs</a>.<a class="code" href="structast__codec__pref.html#af2068e452bdf5eeafcda00c8c06b5cc0">order</a>[i])
<a name="l02496"></a>02496             <span class="keywordflow">break</span>;
<a name="l02497"></a>02497          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;local prefs[%d]=%s:%d\n&quot;</span>, i, (<a class="code" href="chan__iax2_8c.html#a46262e3cc2baf55a72542567ccfe86d9">prefs</a>.<a class="code" href="structast__codec__pref.html#af2068e452bdf5eeafcda00c8c06b5cc0">order</a>[i] ? <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(1 &lt;&lt; (<a class="code" href="chan__iax2_8c.html#a46262e3cc2baf55a72542567ccfe86d9">prefs</a>.<a class="code" href="structast__codec__pref.html#af2068e452bdf5eeafcda00c8c06b5cc0">order</a>[i]-1)) : <span class="stringliteral">&quot;&lt;none&gt;&quot;</span>), <a class="code" href="chan__iax2_8c.html#a46262e3cc2baf55a72542567ccfe86d9">prefs</a>.<a class="code" href="structast__codec__pref.html#a2b0514c4f4584036696b7b6e83985906">framing</a>[i]);
<a name="l02498"></a>02498       }
<a name="l02499"></a>02499       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Capabilities for connection %s is set\n&quot;</span>, token);
<a name="l02500"></a>02500    }
<a name="l02501"></a>02501 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa3a89ee27c1efd3e8ee24dead62035bc"></a><!-- doxytag: member="chan_h323.c::set_peer_capabilities" ref="aa3a89ee27c1efd3e8ee24dead62035bc" args="(unsigned call_reference, const char *token, int capabilities, struct ast_codec_pref *prefs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void set_peer_capabilities </td>
          <td>(</td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>call_reference</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>capabilities</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__codec__pref.html">ast_codec_pref</a> *&nbsp;</td>
          <td class="paramname"> <em>prefs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l02438">2438</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8c_source.html#l00573">ast_getformatname()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="rtp_8c_source.html#l03728">ast_rtp_codec_setpref()</a>, <a class="el" href="chan__h323_8c_source.html#l01144">find_call_locked()</a>, <a class="el" href="frame_8h_source.html#l00039">ast_codec_pref::framing</a>, <a class="el" href="chan__h323_8c_source.html#l00178">oh323_pvt::jointcapability</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, <a class="el" href="chan__h323_8c_source.html#l00153">oh323_pvt::options</a>, <a class="el" href="frame_8h_source.html#l00038">ast_codec_pref::order</a>, <a class="el" href="chan__h323_8c_source.html#l00179">oh323_pvt::peer_prefs</a>, <a class="el" href="chan__h323_8c_source.html#l00177">oh323_pvt::peercapability</a>, and <a class="el" href="chan__h323_8c_source.html#l00167">oh323_pvt::rtp</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l03222">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02439"></a>02439 {
<a name="l02440"></a>02440    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *pvt;
<a name="l02441"></a>02441 
<a name="l02442"></a>02442    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l02443"></a>02443       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Got remote capabilities from connection %s\n&quot;</span>, token);
<a name="l02444"></a>02444 
<a name="l02445"></a>02445    pvt = <a class="code" href="chan__h323_8c.html#a246fb1df8539e4f168a9bc8233ef76b9">find_call_locked</a>(call_reference, token);
<a name="l02446"></a>02446    <span class="keywordflow">if</span> (!pvt)
<a name="l02447"></a>02447       <span class="keywordflow">return</span>;
<a name="l02448"></a>02448    pvt-&gt;<a class="code" href="structoh323__pvt.html#a64c43413589d9d63d2ef5db58ed1a7c2">peercapability</a> = <a class="code" href="res__jabber_8c.html#aa7afd7ba4814dbf49b1867019891fd14">capabilities</a>;
<a name="l02449"></a>02449    pvt-&gt;<a class="code" href="structoh323__pvt.html#a38f5730c90d9315eb1c0df6cfdc37da6">jointcapability</a> = pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.capability &amp; <a class="code" href="res__jabber_8c.html#aa7afd7ba4814dbf49b1867019891fd14">capabilities</a>;
<a name="l02450"></a>02450    <span class="keywordflow">if</span> (prefs) {
<a name="l02451"></a>02451       memcpy(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#a2dfc2493ffd09f38b5da7248fb7177a9">peer_prefs</a>, prefs, <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a2dfc2493ffd09f38b5da7248fb7177a9">peer_prefs</a>));
<a name="l02452"></a>02452       <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>) {
<a name="l02453"></a>02453          <span class="keywordtype">int</span> i;
<a name="l02454"></a>02454          <span class="keywordflow">for</span> (i = 0; i &lt; 32; ++i) {
<a name="l02455"></a>02455             <span class="keywordflow">if</span> (!prefs-&gt;<a class="code" href="structast__codec__pref.html#af2068e452bdf5eeafcda00c8c06b5cc0">order</a>[i])
<a name="l02456"></a>02456                <span class="keywordflow">break</span>;
<a name="l02457"></a>02457             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;prefs[%d]=%s:%d\n&quot;</span>, i, (prefs-&gt;<a class="code" href="structast__codec__pref.html#af2068e452bdf5eeafcda00c8c06b5cc0">order</a>[i] ? <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(1 &lt;&lt; (prefs-&gt;<a class="code" href="structast__codec__pref.html#af2068e452bdf5eeafcda00c8c06b5cc0">order</a>[i]-1)) : <span class="stringliteral">&quot;&lt;none&gt;&quot;</span>), prefs-&gt;<a class="code" href="structast__codec__pref.html#a2b0514c4f4584036696b7b6e83985906">framing</a>[i]);
<a name="l02458"></a>02458          }
<a name="l02459"></a>02459       }
<a name="l02460"></a>02460       <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>) {
<a name="l02461"></a>02461          <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.autoframing) {
<a name="l02462"></a>02462             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;Autoframing option set, using peer&apos;s packetization settings\n&quot;</span>);
<a name="l02463"></a>02463             <a class="code" href="rtp_8h.html#ae6a1acd75aaf08afc6954bd5ac671c6a" title="Set codec preference.">ast_rtp_codec_setpref</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, &amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#a2dfc2493ffd09f38b5da7248fb7177a9">peer_prefs</a>);
<a name="l02464"></a>02464          } <span class="keywordflow">else</span> {
<a name="l02465"></a>02465             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;Autoframing option not set, ignoring peer&apos;s packetization settings\n&quot;</span>);
<a name="l02466"></a>02466             <a class="code" href="rtp_8h.html#ae6a1acd75aaf08afc6954bd5ac671c6a" title="Set codec preference.">ast_rtp_codec_setpref</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, &amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.prefs);
<a name="l02467"></a>02467          }
<a name="l02468"></a>02468       }
<a name="l02469"></a>02469    }
<a name="l02470"></a>02470    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l02471"></a>02471 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a99229ff7b6ed5b42956b0ba1a86924ae"></a><!-- doxytag: member="chan_h323.c::setup_incoming_call" ref="a99229ff7b6ed5b42956b0ba1a86924ae" args="(call_details_t *cd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static call_options_t* setup_incoming_call </td>
          <td>(</td>
          <td class="paramtype">call_details_t *&nbsp;</td>
          <td class="paramname"> <em>cd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Call-back function for incoming calls. </p>
<p>Returns 1 on success </p>

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l02100">2100</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="chan__h323_8c_source.html#l00164">oh323_pvt::accountcode</a>, <a class="el" href="chan__h323_8c_source.html#l00166">oh323_pvt::amaflags</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="utils_8c_source.html#l00431">ast_inet_ntoa()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="astobj_8h_source.html#l00218">ASTOBJ_UNREF</a>, <a class="el" href="chan__h323_8c_source.html#l00156">oh323_pvt::cd</a>, <a class="el" href="chan__h323_8c_source.html#l00407">cleanup_call_details()</a>, <a class="el" href="chan__h323_8c_source.html#l00163">oh323_pvt::context</a>, <a class="el" href="chan__h323_8c_source.html#l00162">oh323_pvt::exten</a>, <a class="el" href="chan__h323_8c_source.html#l01811">find_alias()</a>, <a class="el" href="chan__h323_8c_source.html#l01602">find_user()</a>, <a class="el" href="chan__h323_8c_source.html#l00178">oh323_pvt::jointcapability</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="chan__h323_8c_source.html#l01101">oh323_alloc()</a>, <a class="el" href="chan__h323_8c_source.html#l00488">oh323_destroy()</a>, <a class="el" href="chan__h323_8c_source.html#l00286">oh323_destroy_user()</a>, and <a class="el" href="chan__h323_8c_source.html#l00153">oh323_pvt::options</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l03222">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02101"></a>02101 {
<a name="l02102"></a>02102    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *pvt;
<a name="l02103"></a>02103    <span class="keyword">struct </span>oh323_user *<a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a> = NULL;
<a name="l02104"></a>02104    <span class="keyword">struct </span>oh323_alias *alias = NULL;
<a name="l02105"></a>02105 
<a name="l02106"></a>02106    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l02107"></a>02107       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Setting up incoming call for %s\n&quot;</span>, cd-&gt;call_token);
<a name="l02108"></a>02108 
<a name="l02109"></a>02109    <span class="comment">/* allocate the call*/</span>
<a name="l02110"></a>02110    pvt = <a class="code" href="chan__h323_8c.html#acec1d7f963be298bd166ec8f869e3462">oh323_alloc</a>(cd-&gt;call_reference);
<a name="l02111"></a>02111 
<a name="l02112"></a>02112    <span class="keywordflow">if</span> (!pvt) {
<a name="l02113"></a>02113       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to allocate private structure, this is bad.\n&quot;</span>);
<a name="l02114"></a>02114       <a class="code" href="chan__h323_8c.html#a9c8ed7310ecb320faec26082515f4cbc">cleanup_call_details</a>(cd);
<a name="l02115"></a>02115       <span class="keywordflow">return</span> NULL;
<a name="l02116"></a>02116    }
<a name="l02117"></a>02117 
<a name="l02118"></a>02118    <span class="comment">/* Populate the call details in the private structure */</span>
<a name="l02119"></a>02119    memcpy(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>, cd, <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>));
<a name="l02120"></a>02120    memcpy(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>, &amp;<a class="code" href="chan__h323_8c.html#ab2aace2a2c551db5a7ce9ccadc159b72">global_options</a>, <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>));
<a name="l02121"></a>02121    pvt-&gt;<a class="code" href="structoh323__pvt.html#a38f5730c90d9315eb1c0df6cfdc37da6">jointcapability</a> = pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.capability;
<a name="l02122"></a>02122 
<a name="l02123"></a>02123    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>) {
<a name="l02124"></a>02124       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Setting up Call\n&quot;</span>);
<a name="l02125"></a>02125       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot; \tCall token:  [%s]\n&quot;</span>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.call_token);
<a name="l02126"></a>02126       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot; \tCalling party name:  [%s]\n&quot;</span>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.call_source_name);
<a name="l02127"></a>02127       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot; \tCalling party number:  [%s]\n&quot;</span>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.call_source_e164);
<a name="l02128"></a>02128       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot; \tCalled party name:  [%s]\n&quot;</span>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.call_dest_alias);
<a name="l02129"></a>02129       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot; \tCalled party number:  [%s]\n&quot;</span>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.call_dest_e164);
<a name="l02130"></a>02130       <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.redirect_reason &gt;= 0)
<a name="l02131"></a>02131          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot; \tRedirecting party number:  [%s] (reason %d)\n&quot;</span>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.redirect_number, pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.redirect_reason);
<a name="l02132"></a>02132       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot; \tCalling party IP:  [%s]\n&quot;</span>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.sourceIp);
<a name="l02133"></a>02133    }
<a name="l02134"></a>02134 
<a name="l02135"></a>02135    <span class="comment">/* Decide if we are allowing Gatekeeper routed calls*/</span>
<a name="l02136"></a>02136    <span class="keywordflow">if</span> ((!strcasecmp(cd-&gt;sourceIp, <a class="code" href="chan__h323_8c.html#a4bd4778b66bf079c2227fe62ec9a3e73">gatekeeper</a>)) &amp;&amp; (<a class="code" href="chan__h323_8c.html#ac870109b5266804b2ae791184ed556b8">gkroute</a> == -1) &amp;&amp; !<a class="code" href="chan__h323_8c.html#abf24fbc8556bb94e3e636bfa53170b7d">gatekeeper_disable</a>) {
<a name="l02137"></a>02137       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(cd-&gt;call_dest_e164)) {
<a name="l02138"></a>02138          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>, cd-&gt;call_dest_e164, <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>));
<a name="l02139"></a>02139          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <a class="code" href="chan__h323_8c.html#a7dc6cff9d51743005af0fcf0c37251ad">default_context</a>, <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="structoh323__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>));
<a name="l02140"></a>02140       } <span class="keywordflow">else</span> {
<a name="l02141"></a>02141          alias = <a class="code" href="chan__h323_8c.html#ac2318e0c047a6ba567df7701f64f917b" title="Find a call by alias.">find_alias</a>(cd-&gt;call_dest_alias, 1);
<a name="l02142"></a>02142          <span class="keywordflow">if</span> (!alias) {
<a name="l02143"></a>02143             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Call for %s rejected, alias not found\n&quot;</span>, cd-&gt;call_dest_alias);
<a name="l02144"></a>02144             <a class="code" href="chan__h323_8c.html#ae0faaef42fdc4a529c953c2a48a902c5">oh323_destroy</a>(pvt);
<a name="l02145"></a>02145             <span class="keywordflow">return</span> NULL;
<a name="l02146"></a>02146          }
<a name="l02147"></a>02147          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>, alias-&gt;name, <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>));
<a name="l02148"></a>02148          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, alias-&gt;context, <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="structoh323__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>));
<a name="l02149"></a>02149       }
<a name="l02150"></a>02150    } <span class="keywordflow">else</span> {
<a name="l02151"></a>02151       <span class="comment">/* Either this call is not from the Gatekeeper</span>
<a name="l02152"></a>02152 <span class="comment">         or we are not allowing gk routed calls */</span>
<a name="l02153"></a>02153       user = <a class="code" href="chan__h323_8c.html#aa3f365bda05996becf0e9c32e94507ea">find_user</a>(cd, 1);
<a name="l02154"></a>02154       <span class="keywordflow">if</span> (!user) {
<a name="l02155"></a>02155          <span class="keywordflow">if</span> (!<a class="code" href="chan__h323_8c.html#a782aff739a0c7035182f9d10828cbe35">acceptAnonymous</a>) {
<a name="l02156"></a>02156             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Anonymous call from &apos;%s@%s&apos; rejected\n&quot;</span>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.call_source_aliases, pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.sourceIp);
<a name="l02157"></a>02157             <a class="code" href="chan__h323_8c.html#ae0faaef42fdc4a529c953c2a48a902c5">oh323_destroy</a>(pvt);
<a name="l02158"></a>02158             <span class="keywordflow">return</span> NULL;
<a name="l02159"></a>02159          }
<a name="l02160"></a>02160          <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="chan__h323_8c.html#a7dc6cff9d51743005af0fcf0c37251ad">default_context</a>)) {
<a name="l02161"></a>02161             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Call from &apos;%s@%s&apos; rejected due to no default context\n&quot;</span>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.call_source_aliases, pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.sourceIp);
<a name="l02162"></a>02162             <a class="code" href="chan__h323_8c.html#ae0faaef42fdc4a529c953c2a48a902c5">oh323_destroy</a>(pvt);
<a name="l02163"></a>02163             <span class="keywordflow">return</span> NULL;
<a name="l02164"></a>02164          }
<a name="l02165"></a>02165          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <a class="code" href="chan__h323_8c.html#a7dc6cff9d51743005af0fcf0c37251ad">default_context</a>, <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="structoh323__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>));
<a name="l02166"></a>02166          <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.call_dest_e164)) {
<a name="l02167"></a>02167             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>, cd-&gt;call_dest_e164, <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>));
<a name="l02168"></a>02168          } <span class="keywordflow">else</span> {
<a name="l02169"></a>02169             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>, cd-&gt;call_dest_alias, <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>));
<a name="l02170"></a>02170          }
<a name="l02171"></a>02171          <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l02172"></a>02172             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Sending %s@%s to context [%s] extension %s\n&quot;</span>, cd-&gt;call_source_aliases, cd-&gt;sourceIp, pvt-&gt;<a class="code" href="structoh323__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>);
<a name="l02173"></a>02173       } <span class="keywordflow">else</span> {
<a name="l02174"></a>02174          <span class="keywordflow">if</span> (user-&gt;host) {
<a name="l02175"></a>02175             <span class="keywordflow">if</span> (strcasecmp(cd-&gt;sourceIp, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(user-&gt;addr.sin_addr))) {
<a name="l02176"></a>02176                <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(user-&gt;context)) {
<a name="l02177"></a>02177                   <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="chan__h323_8c.html#a7dc6cff9d51743005af0fcf0c37251ad">default_context</a>)) {
<a name="l02178"></a>02178                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Call from &apos;%s&apos; rejected due to non-matching IP address (%s) and no default context\n&quot;</span>, user-&gt;name, cd-&gt;sourceIp);
<a name="l02179"></a>02179                      <a class="code" href="chan__h323_8c.html#ae0faaef42fdc4a529c953c2a48a902c5">oh323_destroy</a>(pvt);
<a name="l02180"></a>02180                      <a class="code" href="astobj_8h.html#aed02826b481ce75ec710c1184ac8f059" title="Decrement the reference count on an object.">ASTOBJ_UNREF</a>(user, <a class="code" href="chan__h323_8c.html#ad2a4b95f164d86a67d96a23c8714157b">oh323_destroy_user</a>);
<a name="l02181"></a>02181                      <span class="keywordflow">return</span> NULL;
<a name="l02182"></a>02182                   }
<a name="l02183"></a>02183                   <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <a class="code" href="chan__h323_8c.html#a7dc6cff9d51743005af0fcf0c37251ad">default_context</a>, <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="structoh323__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>));
<a name="l02184"></a>02184                } <span class="keywordflow">else</span> {
<a name="l02185"></a>02185                   <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, user-&gt;context, <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="structoh323__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>));
<a name="l02186"></a>02186                }
<a name="l02187"></a>02187                pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>[0] = <span class="charliteral">&apos;i&apos;</span>;
<a name="l02188"></a>02188                pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>[1] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l02189"></a>02189                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Call from &apos;%s&apos; rejected due to non-matching IP address (%s)s\n&quot;</span>, user-&gt;name, cd-&gt;sourceIp);
<a name="l02190"></a>02190                <a class="code" href="chan__h323_8c.html#ae0faaef42fdc4a529c953c2a48a902c5">oh323_destroy</a>(pvt);
<a name="l02191"></a>02191                <a class="code" href="astobj_8h.html#aed02826b481ce75ec710c1184ac8f059" title="Decrement the reference count on an object.">ASTOBJ_UNREF</a>(user, <a class="code" href="chan__h323_8c.html#ad2a4b95f164d86a67d96a23c8714157b">oh323_destroy_user</a>);
<a name="l02192"></a>02192                <span class="keywordflow">return</span> NULL;   <span class="comment">/* XXX: Hmmm... Why to setup context if we drop connection immediately??? */</span>
<a name="l02193"></a>02193             }
<a name="l02194"></a>02194          }
<a name="l02195"></a>02195          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, user-&gt;context, <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="structoh323__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>));
<a name="l02196"></a>02196          memcpy(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>, &amp;user-&gt;options, <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>));
<a name="l02197"></a>02197          pvt-&gt;<a class="code" href="structoh323__pvt.html#a38f5730c90d9315eb1c0df6cfdc37da6">jointcapability</a> = pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.capability;
<a name="l02198"></a>02198          <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a697ef4a8ad86065f046ee7b47ffece3c">cd</a>.call_dest_e164)) {
<a name="l02199"></a>02199             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>, cd-&gt;call_dest_e164, <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>));
<a name="l02200"></a>02200          } <span class="keywordflow">else</span> {
<a name="l02201"></a>02201             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>, cd-&gt;call_dest_alias, <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>));
<a name="l02202"></a>02202          }
<a name="l02203"></a>02203          <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(user-&gt;accountcode)) {
<a name="l02204"></a>02204             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#acfaabb39ce3cdd7f938adf92d5083380">accountcode</a>, user-&gt;accountcode, <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="structoh323__pvt.html#acfaabb39ce3cdd7f938adf92d5083380">accountcode</a>));
<a name="l02205"></a>02205          }
<a name="l02206"></a>02206          <span class="keywordflow">if</span> (user-&gt;amaflags) {
<a name="l02207"></a>02207             pvt-&gt;<a class="code" href="structoh323__pvt.html#ad2cfb0f821c065261382a9298bb5a16b">amaflags</a> = user-&gt;amaflags;
<a name="l02208"></a>02208          }
<a name="l02209"></a>02209          <a class="code" href="astobj_8h.html#aed02826b481ce75ec710c1184ac8f059" title="Decrement the reference count on an object.">ASTOBJ_UNREF</a>(user, <a class="code" href="chan__h323_8c.html#ad2a4b95f164d86a67d96a23c8714157b">oh323_destroy_user</a>);
<a name="l02210"></a>02210       }
<a name="l02211"></a>02211    }
<a name="l02212"></a>02212    <span class="keywordflow">return</span> &amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>;
<a name="l02213"></a>02213 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aba66a9543f9b7a9755a65250169e0f2a"></a><!-- doxytag: member="chan_h323.c::setup_outgoing_call" ref="aba66a9543f9b7a9755a65250169e0f2a" args="(call_details_t *cd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int setup_outgoing_call </td>
          <td>(</td>
          <td class="paramtype">call_details_t *&nbsp;</td>
          <td class="paramname"> <em>cd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Call-back function to establish an <a class="el" href="structoutgoing.html">outgoing</a> H.323 call. </p>
<p>Returns 1 on success </p>

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l02299">2299</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="chan__h323_8c_source.html#l00407">cleanup_call_details()</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l03222">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02300"></a>02300 {
<a name="l02301"></a>02301    <span class="comment">/* Use argument here or free it immediately */</span>
<a name="l02302"></a>02302    <a class="code" href="chan__h323_8c.html#a9c8ed7310ecb320faec26082515f4cbc">cleanup_call_details</a>(cd);
<a name="l02303"></a>02303 
<a name="l02304"></a>02304    <span class="keywordflow">return</span> 1;
<a name="l02305"></a>02305 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a952624d4d47581b01ee71048280ac681"></a><!-- doxytag: member="chan_h323.c::setup_rtp_connection" ref="a952624d4d47581b01ee71048280ac681" args="(unsigned call_reference, const char *remoteIp, int remotePort, const char *token, int pt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void setup_rtp_connection </td>
          <td>(</td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>call_reference</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>remoteIp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>remotePort</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pt</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Call-back function passing remote ip/port information from H.323 to asterisk. </p>
<p>Returns nothing </p>

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l01936">1936</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="chan__h323_8c_source.html#l00951">__oh323_rtp_create()</a>, <a class="el" href="chan__h323_8c_source.html#l00154">oh323_pvt::alreadygone</a>, <a class="el" href="lock_8h_source.html#l02037">ast_channel_trylock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="frame_8h_source.html#l00313">AST_CONTROL_HOLD</a>, <a class="el" href="frame_8h_source.html#l00311">AST_CONTROL_PROGRESS</a>, <a class="el" href="frame_8h_source.html#l00314">AST_CONTROL_UNHOLD</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8h_source.html#l00249">AST_FORMAT_G726_AAL2</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="channel_8c_source.html#l01123">ast_queue_control()</a>, <a class="el" href="rtp_8c_source.html#l02338">ast_rtp_lookup_pt()</a>, <a class="el" href="rtp_8h_source.html#l00060">AST_RTP_OPT_G726_NONSTANDARD</a>, <a class="el" href="rtp_8c_source.html#l02656">ast_rtp_set_peer()</a>, <a class="el" href="rtp_8c_source.html#l02310">ast_rtp_set_rtpmap_type()</a>, <a class="el" href="rtp_8c_source.html#l02710">ast_rtp_stop()</a>, <a class="el" href="channel_8c_source.html#l03731">ast_set_read_format()</a>, <a class="el" href="channel_8c_source.html#l03737">ast_set_write_format()</a>, <a class="el" href="rtp_8h_source.html#l00090">rtpPayloadType::code</a>, <a class="el" href="chan__h323_8c_source.html#l01144">find_call_locked()</a>, <a class="el" href="chan__h323_8c_source.html#l00178">oh323_pvt::jointcapability</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="channel_8h_source.html#l00482">ast_channel::nativeformats</a>, <a class="el" href="chan__h323_8c_source.html#l00169">oh323_pvt::nativeformats</a>, <a class="el" href="chan__h323_8c_source.html#l00173">oh323_pvt::newcontrol</a>, <a class="el" href="chan__h323_8c_source.html#l00153">oh323_pvt::options</a>, <a class="el" href="chan__h323_8c_source.html#l00157">oh323_pvt::owner</a>, <a class="el" href="channel_8h_source.html#l00483">ast_channel::readformat</a>, <a class="el" href="chan__h323_8c_source.html#l00184">oh323_pvt::recvonly</a>, <a class="el" href="chan__h323_8c_source.html#l00167">oh323_pvt::rtp</a>, and <a class="el" href="channel_8h_source.html#l00484">ast_channel::writeformat</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l03222">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01937"></a>01937 {
<a name="l01938"></a>01938    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *pvt;
<a name="l01939"></a>01939    <span class="keyword">struct </span>sockaddr_in them;
<a name="l01940"></a>01940    <span class="keyword">struct </span><a class="code" href="structrtpPayloadType.html" title="The value of each payload format mapping:.">rtpPayloadType</a> rtptype;
<a name="l01941"></a>01941    <span class="keywordtype">int</span> nativeformats_changed;
<a name="l01942"></a>01942    <span class="keyword">enum</span> { NEED_NONE, NEED_HOLD, NEED_UNHOLD } rtp_change = NEED_NONE;
<a name="l01943"></a>01943 
<a name="l01944"></a>01944    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l01945"></a>01945       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Setting up RTP connection for %s\n&quot;</span>, token);
<a name="l01946"></a>01946 
<a name="l01947"></a>01947    <span class="comment">/* Find the call or allocate a private structure if call not found */</span>
<a name="l01948"></a>01948    pvt = <a class="code" href="chan__h323_8c.html#a246fb1df8539e4f168a9bc8233ef76b9">find_call_locked</a>(call_reference, token);
<a name="l01949"></a>01949    <span class="keywordflow">if</span> (!pvt) {
<a name="l01950"></a>01950       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Something is wrong: rtp\n&quot;</span>);
<a name="l01951"></a>01951       <span class="keywordflow">return</span>;
<a name="l01952"></a>01952    }
<a name="l01953"></a>01953    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#ac43993a73742eff145b861107a1afa0d">alreadygone</a>) {
<a name="l01954"></a>01954       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01955"></a>01955       <span class="keywordflow">return</span>;
<a name="l01956"></a>01956    }
<a name="l01957"></a>01957 
<a name="l01958"></a>01958    <span class="keywordflow">if</span> (!pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>)
<a name="l01959"></a>01959       <a class="code" href="chan__h323_8c.html#a954ed862fccabf74f1b9ea728c97fb3b">__oh323_rtp_create</a>(pvt);
<a name="l01960"></a>01960 
<a name="l01961"></a>01961    <span class="keywordflow">if</span> ((pt == 2) &amp;&amp; (pvt-&gt;<a class="code" href="structoh323__pvt.html#a38f5730c90d9315eb1c0df6cfdc37da6">jointcapability</a> &amp; <a class="code" href="frame_8h.html#a536fbd427f197a33e679c7721afad420">AST_FORMAT_G726_AAL2</a>)) {
<a name="l01962"></a>01962       <a class="code" href="rtp_8h.html#a02a3ba4e11691cafd933cbb1e6225b3e" title="Set payload type to a known MIME media type for a codec.">ast_rtp_set_rtpmap_type</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, pt, <span class="stringliteral">&quot;audio&quot;</span>, <span class="stringliteral">&quot;G726-32&quot;</span>, <a class="code" href="rtp_8h.html#a95ccef8388e3b0e9c9639e393d4081b6ad570d49420fe15c4660793d1fc2f0fc8">AST_RTP_OPT_G726_NONSTANDARD</a>);
<a name="l01963"></a>01963    }
<a name="l01964"></a>01964 
<a name="l01965"></a>01965    them.sin_family = AF_INET;
<a name="l01966"></a>01966    <span class="comment">/* only works for IPv4 */</span>
<a name="l01967"></a>01967    them.sin_addr.s_addr = inet_addr(remoteIp);
<a name="l01968"></a>01968    them.sin_port = htons(remotePort);
<a name="l01969"></a>01969 
<a name="l01970"></a>01970    <span class="keywordflow">if</span> (them.sin_addr.s_addr) {
<a name="l01971"></a>01971       <a class="code" href="rtp_8h.html#a8731e858c93551d3bb56a2f297a9ef59">ast_rtp_set_peer</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, &amp;them);
<a name="l01972"></a>01972       <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#a8233e5098a564987fd6e02cc7bf0316e">recvonly</a>) {
<a name="l01973"></a>01973          pvt-&gt;<a class="code" href="structoh323__pvt.html#a8233e5098a564987fd6e02cc7bf0316e">recvonly</a> = 0;
<a name="l01974"></a>01974          rtp_change = NEED_UNHOLD;
<a name="l01975"></a>01975       }
<a name="l01976"></a>01976    } <span class="keywordflow">else</span> {
<a name="l01977"></a>01977       <a class="code" href="rtp_8h.html#a55123d53642a71a4bd834fcc0c0f00c5">ast_rtp_stop</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>);
<a name="l01978"></a>01978       <span class="keywordflow">if</span> (!pvt-&gt;<a class="code" href="structoh323__pvt.html#a8233e5098a564987fd6e02cc7bf0316e">recvonly</a>) {
<a name="l01979"></a>01979          pvt-&gt;<a class="code" href="structoh323__pvt.html#a8233e5098a564987fd6e02cc7bf0316e">recvonly</a> = 1;
<a name="l01980"></a>01980          rtp_change = NEED_HOLD;
<a name="l01981"></a>01981       }
<a name="l01982"></a>01982    }
<a name="l01983"></a>01983 
<a name="l01984"></a>01984    <span class="comment">/* Change native format to reflect information taken from OLC/OLCAck */</span>
<a name="l01985"></a>01985    nativeformats_changed = 0;
<a name="l01986"></a>01986    <span class="keywordflow">if</span> (pt != 128 &amp;&amp; pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>) {  <span class="comment">/* Payload type is invalid, so try to use previously decided */</span>
<a name="l01987"></a>01987       rtptype = <a class="code" href="rtp_8h.html#a9fdf56baeb1e0ca97859d10826bdd1de" title="Mapping between RTP payload format codes and Asterisk codes:.">ast_rtp_lookup_pt</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, pt);
<a name="l01988"></a>01988       <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l01989"></a>01989          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Native format is set to %d from %d by RTP payload type %d\n&quot;</span>, rtptype.code, pvt-&gt;<a class="code" href="structoh323__pvt.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>, pt);
<a name="l01990"></a>01990       <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a> != rtptype.code) {
<a name="l01991"></a>01991          pvt-&gt;<a class="code" href="structoh323__pvt.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a> = rtptype.code;
<a name="l01992"></a>01992          nativeformats_changed = 1;
<a name="l01993"></a>01993       }
<a name="l01994"></a>01994    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l01995"></a>01995       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Payload type is unknown, formats isn&apos;t changed\n&quot;</span>);
<a name="l01996"></a>01996 
<a name="l01997"></a>01997    <span class="comment">/* Don&apos;t try to lock the channel if nothing changed */</span>
<a name="l01998"></a>01998    <span class="keywordflow">if</span> (nativeformats_changed || pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.progress_audio || (rtp_change != NEED_NONE)) {
<a name="l01999"></a>01999       <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; !<a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {
<a name="l02000"></a>02000          <span class="comment">/* Re-build translation path only if native format(s) has been changed */</span>
<a name="l02001"></a>02001          <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a> != pvt-&gt;<a class="code" href="structoh323__pvt.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>) {
<a name="l02002"></a>02002             <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l02003"></a>02003                <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Native format changed to %d from %d, read format is %d, write format is %d\n&quot;</span>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#ab7786a0f5b9a9ebf83daed87be4f3868">readformat</a>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a>);
<a name="l02004"></a>02004             pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a> = pvt-&gt;<a class="code" href="structoh323__pvt.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>;
<a name="l02005"></a>02005             <a class="code" href="channel_8h.html#a72d53065c6bc2b6092fa41eefa03f1ad" title="Sets read format on channel chan Set read format for channel to whichever component...">ast_set_read_format</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#ab7786a0f5b9a9ebf83daed87be4f3868">readformat</a>);
<a name="l02006"></a>02006             <a class="code" href="channel_8h.html#a978161a52d98fdaee374d1f6e1359544" title="Sets write format on channel chan Set write format for channel to whichever component...">ast_set_write_format</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a>);
<a name="l02007"></a>02007          }
<a name="l02008"></a>02008          <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.progress_audio)
<a name="l02009"></a>02009             <a class="code" href="channel_8h.html#a60f9d2b0ab8b7a839902313321163b28" title="Queue a control frame with payload.">ast_queue_control</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a1a461c5e737ed6ed7c8cb0f78557a6fd">AST_CONTROL_PROGRESS</a>);
<a name="l02010"></a>02010          <span class="keywordflow">switch</span> (rtp_change) {
<a name="l02011"></a>02011          <span class="keywordflow">case</span> NEED_HOLD:
<a name="l02012"></a>02012             <a class="code" href="channel_8h.html#a60f9d2b0ab8b7a839902313321163b28" title="Queue a control frame with payload.">ast_queue_control</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ab99a3d1c08c5ae8bca078c7cd1ec02f5">AST_CONTROL_HOLD</a>);
<a name="l02013"></a>02013             <span class="keywordflow">break</span>;
<a name="l02014"></a>02014          <span class="keywordflow">case</span> NEED_UNHOLD:
<a name="l02015"></a>02015             <a class="code" href="channel_8h.html#a60f9d2b0ab8b7a839902313321163b28" title="Queue a control frame with payload.">ast_queue_control</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>);
<a name="l02016"></a>02016             <span class="keywordflow">break</span>;
<a name="l02017"></a>02017          <span class="keywordflow">default</span>:
<a name="l02018"></a>02018             <span class="keywordflow">break</span>;
<a name="l02019"></a>02019          }
<a name="l02020"></a>02020          <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l02021"></a>02021       }
<a name="l02022"></a>02022       <span class="keywordflow">else</span> {
<a name="l02023"></a>02023          <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>.progress_audio)
<a name="l02024"></a>02024             pvt-&gt;<a class="code" href="structoh323__pvt.html#a96512445a0a8d8b2b9f40db190f33f14">newcontrol</a> = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a1a461c5e737ed6ed7c8cb0f78557a6fd">AST_CONTROL_PROGRESS</a>;
<a name="l02025"></a>02025          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rtp_change == NEED_HOLD)
<a name="l02026"></a>02026             pvt-&gt;<a class="code" href="structoh323__pvt.html#a96512445a0a8d8b2b9f40db190f33f14">newcontrol</a> = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ab99a3d1c08c5ae8bca078c7cd1ec02f5">AST_CONTROL_HOLD</a>;
<a name="l02027"></a>02027          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rtp_change == NEED_UNHOLD)
<a name="l02028"></a>02028             pvt-&gt;<a class="code" href="structoh323__pvt.html#a96512445a0a8d8b2b9f40db190f33f14">newcontrol</a> = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>;
<a name="l02029"></a>02029          <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l02030"></a>02030             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;RTP connection preparation for %s is pending...\n&quot;</span>, token);
<a name="l02031"></a>02031       }
<a name="l02032"></a>02032    }
<a name="l02033"></a>02033    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l02034"></a>02034 
<a name="l02035"></a>02035    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a>)
<a name="l02036"></a>02036       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;RTP connection prepared for %s\n&quot;</span>, token);
<a name="l02037"></a>02037 
<a name="l02038"></a>02038    <span class="keywordflow">return</span>;
<a name="l02039"></a>02039 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad09fa931f468002152a3cc2d5ce25eae"></a><!-- doxytag: member="chan_h323.c::unload_module" ref="ad09fa931f468002152a3cc2d5ce25eae" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int unload_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l03325">3325</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="chan__h323_8c.html#a2029bed642f94cb8e3299209b084e585">aliasl</a>, <a class="el" href="channel_8c_source.html#l00587">ast_channel_unregister()</a>, <a class="el" href="cli_8c_source.html#l01913">ast_cli_unregister()</a>, <a class="el" href="cli_8c_source.html#l01937">ast_cli_unregister_multiple()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01712">ast_mutex_destroy()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="lock_8h_source.html#l00082">AST_PTHREADT_NULL</a>, <a class="el" href="lock_8h_source.html#l00083">AST_PTHREADT_STOP</a>, <a class="el" href="rtp_8c_source.html#l03888">ast_rtp_proto_unregister()</a>, <a class="el" href="channel_8c_source.html#l01666">ast_softhangup()</a>, <a class="el" href="channel_8h_source.html#l00638">AST_SOFTHANGUP_APPUNLOAD</a>, <a class="el" href="astobj_8h_source.html#l00765">ASTOBJ_CONTAINER_DESTROY</a>, <a class="el" href="astobj_8h_source.html#l00453">ASTOBJ_CONTAINER_DESTROYALL</a>, <a class="el" href="chan__h323_8c.html#af2608cb80e01a744400057785fd1660e">iflist</a>, <a class="el" href="io_8c_source.html#l00098">io_context_destroy()</a>, <a class="el" href="chan__h323_8c_source.html#l00152">oh323_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__h323_8c_source.html#l00189">oh323_pvt::next</a>, <a class="el" href="chan__h323_8c_source.html#l00279">oh323_destroy_alias()</a>, <a class="el" href="chan__h323_8c_source.html#l00294">oh323_destroy_peer()</a>, <a class="el" href="chan__h323_8c_source.html#l00286">oh323_destroy_user()</a>, <a class="el" href="chan__h323_8c_source.html#l00157">oh323_pvt::owner</a>, <a class="el" href="chan__h323_8c.html#a73d22ff9770f2c94dac6e92c3eddea5f">peerl</a>, <a class="el" href="sched_8c_source.html#l00260">sched_context_destroy()</a>, and <a class="el" href="chan__h323_8c.html#ab8937033f3230cb7adfe1e86d2055a5e">userl</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03326"></a>03326 {
<a name="l03327"></a>03327    <span class="keyword">struct </span><a class="code" href="structoh323__pvt.html" title="Private structure of a OpenH323 channel.">oh323_pvt</a> *p, *pl;
<a name="l03328"></a>03328 
<a name="l03329"></a>03329    <span class="comment">/* unregister commands */</span>
<a name="l03330"></a>03330    <a class="code" href="cli_8h.html#a56b6b59ee2eaa994597a5b0f4e9f9d09" title="Unregister multiple commands.">ast_cli_unregister_multiple</a>(<a class="code" href="chan__h323_8c.html#abb56ddafa06a53da731882da397ce655">cli_h323</a>, <span class="keyword">sizeof</span>(<a class="code" href="chan__h323_8c.html#abb56ddafa06a53da731882da397ce655">cli_h323</a>) / <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a>));
<a name="l03331"></a>03331    <a class="code" href="cli_8h.html#a3189e6720486808603d13f5d2b58daf4" title="Unregisters a command or an array of commands.">ast_cli_unregister</a>(&amp;<a class="code" href="chan__h323_8c.html#a3c042f9683086454ebde91b64db19726">cli_h323_reload</a>);
<a name="l03332"></a>03332 
<a name="l03333"></a>03333    <a class="code" href="channel_8h.html#a53b708b7fc71dcbcd33acae0ad4d7ef8" title="Unregister a channel technology.">ast_channel_unregister</a>(&amp;<a class="code" href="chan__h323_8c.html#a6763477c6c97aba1b89bff0ac7641422">oh323_tech</a>);
<a name="l03334"></a>03334    <a class="code" href="rtp_8h.html#a39d797fe6097e914323998f72b13420c" title="Unregister an RTP channel client.">ast_rtp_proto_unregister</a>(&amp;<a class="code" href="chan__h323_8c.html#a662b19f30aa83f4c9b55099b8720e017">oh323_rtp</a>);
<a name="l03335"></a>03335 
<a name="l03336"></a>03336    <span class="keywordflow">if</span> (!<a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;iflock)) {
<a name="l03337"></a>03337       <span class="comment">/* hangup all interfaces if they have an owner */</span>
<a name="l03338"></a>03338       p = <a class="code" href="chan__h323_8c.html#af2608cb80e01a744400057785fd1660e" title="Private structure of a OpenH323 channel.">iflist</a>;
<a name="l03339"></a>03339       <span class="keywordflow">while</span>(p) {
<a name="l03340"></a>03340          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l03341"></a>03341             <a class="code" href="channel_8h.html#ac2d6607253f7e8b272d4e845474eaa9b" title="Softly hangup up a channel.">ast_softhangup</a>(p-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709aeeafae6abd77156800ec76b0ff7d3867">AST_SOFTHANGUP_APPUNLOAD</a>);
<a name="l03342"></a>03342          }
<a name="l03343"></a>03343          p = p-&gt;<a class="code" href="structoh323__pvt.html#aa892ef2e174a7308e21e4ab3bf7dfdae">next</a>;
<a name="l03344"></a>03344       }
<a name="l03345"></a>03345       <a class="code" href="chan__h323_8c.html#af2608cb80e01a744400057785fd1660e" title="Private structure of a OpenH323 channel.">iflist</a> = NULL;
<a name="l03346"></a>03346       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;iflock);
<a name="l03347"></a>03347    } <span class="keywordflow">else</span> {
<a name="l03348"></a>03348       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to lock the interface list\n&quot;</span>);
<a name="l03349"></a>03349       <span class="keywordflow">return</span> -1;
<a name="l03350"></a>03350    }
<a name="l03351"></a>03351    <span class="keywordflow">if</span> (!<a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;monlock)) {
<a name="l03352"></a>03352       <span class="keywordflow">if</span> ((<a class="code" href="chan__h323_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a> != <a class="code" href="lock_8h.html#a873a83eb8196323194aac2bea23d794e">AST_PTHREADT_STOP</a>) &amp;&amp; (<a class="code" href="chan__h323_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a> != <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>)) {
<a name="l03353"></a>03353          <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a> != pthread_self()) {
<a name="l03354"></a>03354             pthread_cancel(<a class="code" href="chan__h323_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a>);
<a name="l03355"></a>03355          }
<a name="l03356"></a>03356          pthread_kill(<a class="code" href="chan__h323_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a>, SIGURG);
<a name="l03357"></a>03357          pthread_join(<a class="code" href="chan__h323_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a>, NULL);
<a name="l03358"></a>03358       }
<a name="l03359"></a>03359       <a class="code" href="chan__h323_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a> = <a class="code" href="lock_8h.html#a873a83eb8196323194aac2bea23d794e">AST_PTHREADT_STOP</a>;
<a name="l03360"></a>03360       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;monlock);
<a name="l03361"></a>03361    } <span class="keywordflow">else</span> {
<a name="l03362"></a>03362       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to lock the monitor\n&quot;</span>);
<a name="l03363"></a>03363       <span class="keywordflow">return</span> -1;
<a name="l03364"></a>03364    }
<a name="l03365"></a>03365    <span class="keywordflow">if</span> (!<a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;iflock)) {
<a name="l03366"></a>03366       <span class="comment">/* destroy all the interfaces and free their memory */</span>
<a name="l03367"></a>03367       p = <a class="code" href="chan__h323_8c.html#af2608cb80e01a744400057785fd1660e" title="Private structure of a OpenH323 channel.">iflist</a>;
<a name="l03368"></a>03368       <span class="keywordflow">while</span>(p) {
<a name="l03369"></a>03369          pl = p;
<a name="l03370"></a>03370          p = p-&gt;<a class="code" href="structoh323__pvt.html#aa892ef2e174a7308e21e4ab3bf7dfdae">next</a>;
<a name="l03371"></a>03371          <span class="comment">/* free associated memory */</span>
<a name="l03372"></a>03372          <a class="code" href="lock_8h.html#ab237e70b569019bfb490ab0c3c09b8c5">ast_mutex_destroy</a>(&amp;pl-&gt;<a class="code" href="structoh323__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03373"></a>03373          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(pl);
<a name="l03374"></a>03374       }
<a name="l03375"></a>03375       <a class="code" href="chan__h323_8c.html#af2608cb80e01a744400057785fd1660e" title="Private structure of a OpenH323 channel.">iflist</a> = NULL;
<a name="l03376"></a>03376       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;iflock);
<a name="l03377"></a>03377    } <span class="keywordflow">else</span> {
<a name="l03378"></a>03378       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to lock the interface list\n&quot;</span>);
<a name="l03379"></a>03379       <span class="keywordflow">return</span> -1;
<a name="l03380"></a>03380    }
<a name="l03381"></a>03381    <span class="keywordflow">if</span> (!<a class="code" href="chan__h323_8c.html#abf24fbc8556bb94e3e636bfa53170b7d">gatekeeper_disable</a>)
<a name="l03382"></a>03382       h323_gk_urq();
<a name="l03383"></a>03383    h323_end_process();
<a name="l03384"></a>03384    <span class="keywordflow">if</span> (<a class="code" href="chan__h323_8c.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a>)
<a name="l03385"></a>03385       <a class="code" href="io_8h.html#a5409251fbead35b5e59fe322e14446b9" title="Destroys a context.">io_context_destroy</a>(<a class="code" href="chan__h323_8c.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a>);
<a name="l03386"></a>03386    <span class="keywordflow">if</span> (<a class="code" href="structsched.html">sched</a>)
<a name="l03387"></a>03387       <a class="code" href="sched_8h.html#a7350994bcfd1be91874493dbe25faf0c" title="destroys a schedule context Destroys (free&amp;#39;s) the given sched_context structure...">sched_context_destroy</a>(<a class="code" href="structsched.html">sched</a>);
<a name="l03388"></a>03388 
<a name="l03389"></a>03389    <a class="code" href="astobj_8h.html#a5b923418ce1d4908359bb3b27b211411" title="Empty a container.">ASTOBJ_CONTAINER_DESTROYALL</a>(&amp;<a class="code" href="chan__h323_8c.html#ab8937033f3230cb7adfe1e86d2055a5e" title="H323 User list.">userl</a>, <a class="code" href="chan__h323_8c.html#ad2a4b95f164d86a67d96a23c8714157b">oh323_destroy_user</a>);
<a name="l03390"></a>03390    <a class="code" href="astobj_8h.html#a49ab9467549d53be33f3f9f3ecae97f9" title="Destroy a container.">ASTOBJ_CONTAINER_DESTROY</a>(&amp;<a class="code" href="chan__h323_8c.html#ab8937033f3230cb7adfe1e86d2055a5e" title="H323 User list.">userl</a>);
<a name="l03391"></a>03391    <a class="code" href="astobj_8h.html#a5b923418ce1d4908359bb3b27b211411" title="Empty a container.">ASTOBJ_CONTAINER_DESTROYALL</a>(&amp;<a class="code" href="chan__h323_8c.html#a73d22ff9770f2c94dac6e92c3eddea5f" title="H323 peer list.">peerl</a>, <a class="code" href="chan__h323_8c.html#ad2fe7bc6fcd60293a92f883ff5d03fc0">oh323_destroy_peer</a>);
<a name="l03392"></a>03392    <a class="code" href="astobj_8h.html#a49ab9467549d53be33f3f9f3ecae97f9" title="Destroy a container.">ASTOBJ_CONTAINER_DESTROY</a>(&amp;<a class="code" href="chan__h323_8c.html#a73d22ff9770f2c94dac6e92c3eddea5f" title="H323 peer list.">peerl</a>);
<a name="l03393"></a>03393    <a class="code" href="astobj_8h.html#a5b923418ce1d4908359bb3b27b211411" title="Empty a container.">ASTOBJ_CONTAINER_DESTROYALL</a>(&amp;<a class="code" href="chan__h323_8c.html#a2029bed642f94cb8e3299209b084e585" title="H323 alias list.">aliasl</a>, <a class="code" href="chan__h323_8c.html#a9ebae4396be42baf2785e593f5fede69">oh323_destroy_alias</a>);
<a name="l03394"></a>03394    <a class="code" href="astobj_8h.html#a49ab9467549d53be33f3f9f3ecae97f9" title="Destroy a container.">ASTOBJ_CONTAINER_DESTROY</a>(&amp;<a class="code" href="chan__h323_8c.html#a2029bed642f94cb8e3299209b084e585" title="H323 alias list.">aliasl</a>);
<a name="l03395"></a>03395 
<a name="l03396"></a>03396    <span class="keywordflow">return</span> 0;
<a name="l03397"></a>03397 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7203b2d801c8bd449671f862cf6b2b24"></a><!-- doxytag: member="chan_h323.c::update_common_options" ref="a7203b2d801c8bd449671f862cf6b2b24" args="(struct ast_variable *v, struct call_options *options)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int update_common_options </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__variable.html">ast_variable</a> *&nbsp;</td>
          <td class="paramname"> <em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct call_options *&nbsp;</td>
          <td class="paramname"> <em>options</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l01251">1251</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="callerid_8c_source.html#l01087">ast_callerid_split()</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="frame_8c_source.html#l01233">ast_parse_allow_disallow()</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="utils_8c_source.html#l01311">ast_true()</a>, <a class="el" href="config_8h_source.html#l00081">ast_variable::lineno</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="config_8h_source.html#l00075">ast_variable::name</a>, and <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l01478">build_peer()</a>, <a class="el" href="chan__h323_8c_source.html#l01360">build_user()</a>, and <a class="el" href="chan__h323_8c_source.html#l02832">reload_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01252"></a>01252 {
<a name="l01253"></a>01253    <span class="keywordtype">int</span> tmp = 0;
<a name="l01254"></a>01254    <span class="keywordtype">char</span> *<a class="code" href="structval.html">val</a>, *opt;
<a name="l01255"></a>01255 
<a name="l01256"></a>01256    <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;allow&quot;</span>)) {
<a name="l01257"></a>01257       <a class="code" href="frame_8h.html#a35aa1fb72e1993a14156a6b912034ef9" title="Parse an &amp;quot;allow&amp;quot; or &amp;quot;deny&amp;quot; line in a channel or device configuration...">ast_parse_allow_disallow</a>(&amp;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;prefs, &amp;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;capability, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, 1);
<a name="l01258"></a>01258    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;autoframing&quot;</span>)) {
<a name="l01259"></a>01259       <a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;autoframing = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01260"></a>01260    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;disallow&quot;</span>)) {
<a name="l01261"></a>01261       <a class="code" href="frame_8h.html#a35aa1fb72e1993a14156a6b912034ef9" title="Parse an &amp;quot;allow&amp;quot; or &amp;quot;deny&amp;quot; line in a channel or device configuration...">ast_parse_allow_disallow</a>(&amp;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;prefs, &amp;<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;capability, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, 0);
<a name="l01262"></a>01262    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;dtmfmode&quot;</span>)) {
<a name="l01263"></a>01263       val = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01264"></a>01264       <span class="keywordflow">if</span> ((opt = strchr(val, <span class="charliteral">&apos;:&apos;</span>)) != (<span class="keywordtype">char</span> *)NULL) {
<a name="l01265"></a>01265          *opt++ = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01266"></a>01266          tmp = atoi(opt);
<a name="l01267"></a>01267       }
<a name="l01268"></a>01268       <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;inband&quot;</span>)) {
<a name="l01269"></a>01269          <a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;dtmfmode |= H323_DTMF_INBAND;
<a name="l01270"></a>01270       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(val, <span class="stringliteral">&quot;rfc2833&quot;</span>)) {
<a name="l01271"></a>01271          <a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;dtmfmode |= H323_DTMF_RFC2833;
<a name="l01272"></a>01272          <span class="keywordflow">if</span> (!opt) {
<a name="l01273"></a>01273             <a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;dtmfcodec[0] = H323_DTMF_RFC2833_PT;
<a name="l01274"></a>01274          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((tmp &gt;= 96) &amp;&amp; (tmp &lt; 128)) {
<a name="l01275"></a>01275             <a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;dtmfcodec[0] = tmp;
<a name="l01276"></a>01276          } <span class="keywordflow">else</span> {
<a name="l01277"></a>01277             <a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;dtmfcodec[0] = H323_DTMF_RFC2833_PT;
<a name="l01278"></a>01278             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unknown rfc2833 payload %s specified at line %d, using default %d\n&quot;</span>, opt, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>, <a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;dtmfcodec[0]);
<a name="l01279"></a>01279          }
<a name="l01280"></a>01280       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(val, <span class="stringliteral">&quot;cisco&quot;</span>)) {
<a name="l01281"></a>01281          <a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;dtmfmode |= H323_DTMF_CISCO;
<a name="l01282"></a>01282          <span class="keywordflow">if</span> (!opt) {
<a name="l01283"></a>01283             <a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;dtmfcodec[1] = H323_DTMF_CISCO_PT;
<a name="l01284"></a>01284          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((tmp &gt;= 96) &amp;&amp; (tmp &lt; 128)) {
<a name="l01285"></a>01285             <a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;dtmfcodec[1] = tmp;
<a name="l01286"></a>01286          } <span class="keywordflow">else</span> {
<a name="l01287"></a>01287             <a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;dtmfcodec[1] = H323_DTMF_CISCO_PT;
<a name="l01288"></a>01288             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unknown Cisco DTMF payload %s specified at line %d, using default %d\n&quot;</span>, opt, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>, <a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;dtmfcodec[1]);
<a name="l01289"></a>01289          }
<a name="l01290"></a>01290       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;h245-signal&quot;</span>)) {
<a name="l01291"></a>01291          <a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;dtmfmode |= H323_DTMF_SIGNAL;
<a name="l01292"></a>01292       } <span class="keywordflow">else</span> {
<a name="l01293"></a>01293          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unknown dtmf mode &apos;%s&apos; at line %d\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l01294"></a>01294       }
<a name="l01295"></a>01295    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;dtmfcodec&quot;</span>)) {
<a name="l01296"></a>01296       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Option %s at line %d is deprecated. Use dtmfmode=rfc2833[:&lt;payload&gt;] instead.\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l01297"></a>01297       tmp = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01298"></a>01298       <span class="keywordflow">if</span> (tmp &lt; 96)
<a name="l01299"></a>01299          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid %s value %s at line %d\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l01300"></a>01300       <span class="keywordflow">else</span>
<a name="l01301"></a>01301          <a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;dtmfcodec[0] = tmp;
<a name="l01302"></a>01302    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;bridge&quot;</span>)) {
<a name="l01303"></a>01303       <a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;bridge = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01304"></a>01304    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;nat&quot;</span>)) {
<a name="l01305"></a>01305       <a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;nat = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01306"></a>01306    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;fastStart&quot;</span>)) {
<a name="l01307"></a>01307       <a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;fastStart = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01308"></a>01308    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;h245Tunneling&quot;</span>)) {
<a name="l01309"></a>01309       <a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;h245Tunneling = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01310"></a>01310    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;silenceSuppression&quot;</span>)) {
<a name="l01311"></a>01311       <a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;silenceSuppression = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01312"></a>01312    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;progress_setup&quot;</span>)) {
<a name="l01313"></a>01313       tmp = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01314"></a>01314       <span class="keywordflow">if</span> ((tmp != 0) &amp;&amp; (tmp != 1) &amp;&amp; (tmp != 3) &amp;&amp; (tmp != 8)) {
<a name="l01315"></a>01315          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid value %s for %s at line %d, assuming 0\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l01316"></a>01316          tmp = 0;
<a name="l01317"></a>01317       }
<a name="l01318"></a>01318       <a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;progress_setup = tmp;
<a name="l01319"></a>01319    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;progress_alert&quot;</span>)) {
<a name="l01320"></a>01320       tmp = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01321"></a>01321       <span class="keywordflow">if</span> ((tmp != 0) &amp;&amp; (tmp != 1) &amp;&amp; (tmp != 8)) {
<a name="l01322"></a>01322          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid value %s for %s at line %d, assuming 0\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l01323"></a>01323          tmp = 0;
<a name="l01324"></a>01324       }
<a name="l01325"></a>01325       <a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;progress_alert = tmp;
<a name="l01326"></a>01326    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;progress_audio&quot;</span>)) {
<a name="l01327"></a>01327       <a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;progress_audio = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01328"></a>01328    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;callerid&quot;</span>)) {
<a name="l01329"></a>01329       <a class="code" href="callerid_8h.html#af33ee38631fe79ab21d91bcd0634903a">ast_callerid_split</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;cid_name, <span class="keyword">sizeof</span>(<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;cid_name), <a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;cid_num, <span class="keyword">sizeof</span>(<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;cid_num));
<a name="l01330"></a>01330    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;fullname&quot;</span>)) {
<a name="l01331"></a>01331       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;cid_name, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;cid_name));
<a name="l01332"></a>01332    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;cid_number&quot;</span>)) {
<a name="l01333"></a>01333       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;cid_num, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(<a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;cid_num));
<a name="l01334"></a>01334    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;tunneling&quot;</span>)) {
<a name="l01335"></a>01335       <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;none&quot;</span>))
<a name="l01336"></a>01336          <a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;tunnelOptions = 0;
<a name="l01337"></a>01337       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;cisco&quot;</span>))
<a name="l01338"></a>01338          <a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;tunnelOptions |= H323_TUNNEL_CISCO;
<a name="l01339"></a>01339       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;qsig&quot;</span>))
<a name="l01340"></a>01340          <a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;tunnelOptions |= H323_TUNNEL_QSIG;
<a name="l01341"></a>01341       <span class="keywordflow">else</span>
<a name="l01342"></a>01342          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid value %s for %s at line %d\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l01343"></a>01343    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;hold&quot;</span>)) {
<a name="l01344"></a>01344       <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;none&quot;</span>))
<a name="l01345"></a>01345          <a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;holdHandling = ~0;
<a name="l01346"></a>01346       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;notify&quot;</span>))
<a name="l01347"></a>01347          <a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;holdHandling |= H323_HOLD_NOTIFY;
<a name="l01348"></a>01348       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;q931only&quot;</span>))
<a name="l01349"></a>01349          <a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;holdHandling |= H323_HOLD_NOTIFY | H323_HOLD_Q931ONLY;
<a name="l01350"></a>01350       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;h450&quot;</span>))
<a name="l01351"></a>01351          <a class="code" href="structoh323__pvt.html#ad1501ec7b70839b245287563d7b7aee9">options</a>-&gt;holdHandling |= H323_HOLD_H450;
<a name="l01352"></a>01352       <span class="keywordflow">else</span>
<a name="l01353"></a>01353          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid value %s for %s at line %d\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l01354"></a>01354    } <span class="keywordflow">else</span>
<a name="l01355"></a>01355       <span class="keywordflow">return</span> 1;
<a name="l01356"></a>01356 
<a name="l01357"></a>01357    <span class="keywordflow">return</span> 0;
<a name="l01358"></a>01358 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a88ea396aa3c9c270ced6ca203c8ad5ba"></a><!-- doxytag: member="chan_h323.c::update_state" ref="a88ea396aa3c9c270ced6ca203c8ad5ba" args="(struct oh323_pvt *pvt, int state, int signal)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int update_state </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structoh323__pvt.html">oh323_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>pvt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>signal</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l01170">1170</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02037">ast_channel_trylock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="channel_8c_source.html#l01123">ast_queue_control()</a>, <a class="el" href="channel_8c_source.html#l04695">ast_setstate()</a>, <a class="el" href="chan__h323_8c_source.html#l00173">oh323_pvt::newcontrol</a>, <a class="el" href="chan__h323_8c_source.html#l00172">oh323_pvt::newstate</a>, and <a class="el" href="chan__h323_8c_source.html#l00157">oh323_pvt::owner</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l02311">chan_ringing()</a>, <a class="el" href="chan__h323_8c_source.html#l02045">connection_made()</a>, and <a class="el" href="chan__h323_8c_source.html#l02072">progress()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01171"></a>01171 {
<a name="l01172"></a>01172    <span class="keywordflow">if</span> (!pvt)
<a name="l01173"></a>01173       <span class="keywordflow">return</span> 0;
<a name="l01174"></a>01174    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; !<a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {
<a name="l01175"></a>01175       <span class="keywordflow">if</span> (<a class="code" href="structstate.html">state</a> &gt;= 0)
<a name="l01176"></a>01176          <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="structstate.html">state</a>);
<a name="l01177"></a>01177       <span class="keywordflow">if</span> (signal &gt;= 0)
<a name="l01178"></a>01178          <a class="code" href="channel_8h.html#a60f9d2b0ab8b7a839902313321163b28" title="Queue a control frame with payload.">ast_queue_control</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, signal);
<a name="l01179"></a>01179       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(pvt-&gt;<a class="code" href="structoh323__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l01180"></a>01180       <span class="keywordflow">return</span> 1;
<a name="l01181"></a>01181    }
<a name="l01182"></a>01182    <span class="keywordflow">else</span> {
<a name="l01183"></a>01183       <span class="keywordflow">if</span> (<a class="code" href="structstate.html">state</a> &gt;= 0)
<a name="l01184"></a>01184          pvt-&gt;<a class="code" href="structoh323__pvt.html#a6c29a78e6d59b85ce615a046fabd4b0f">newstate</a> = <a class="code" href="structstate.html">state</a>;
<a name="l01185"></a>01185       <span class="keywordflow">if</span> (signal &gt;= 0)
<a name="l01186"></a>01186          pvt-&gt;<a class="code" href="structoh323__pvt.html#a96512445a0a8d8b2b9f40db190f33f14">newcontrol</a> = signal;
<a name="l01187"></a>01187       <span class="keywordflow">return</span> 0;
<a name="l01188"></a>01188    }
<a name="l01189"></a>01189 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a782aff739a0c7035182f9d10828cbe35"></a><!-- doxytag: member="chan_h323.c::acceptAnonymous" ref="a782aff739a0c7035182f9d10828cbe35" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="chan__h323_8c.html#a782aff739a0c7035182f9d10828cbe35">acceptAnonymous</a> = 1<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00142">142</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="a2029bed642f94cb8e3299209b084e585"></a><!-- doxytag: member="chan_h323.c::aliasl" ref="a2029bed642f94cb8e3299209b084e585" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structh323__alias__list.html">h323_alias_list</a>  <a class="el" href="chan__h323_8c.html#a2029bed642f94cb8e3299209b084e585">aliasl</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>H323 alias list. </p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l01191">build_alias()</a>, <a class="el" href="chan__h323_8c_source.html#l02808">delete_aliases()</a>, <a class="el" href="chan__h323_8c_source.html#l01811">find_alias()</a>, <a class="el" href="chan__h323_8c_source.html#l03222">load_module()</a>, <a class="el" href="chan__h323_8c_source.html#l02832">reload_config()</a>, and <a class="el" href="chan__h323_8c_source.html#l03325">unload_module()</a>.</p>

</div>
</div>
<a class="anchor" id="a4ec29229510a2e3ea6ce34d520f06e90"></a><!-- doxytag: member="chan_h323.c::bindaddr" ref="a4ec29229510a2e3ea6ce34d520f06e90" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct sockaddr_in <a class="el" href="chan__skinny_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00130">130</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l00951">__oh323_rtp_create()</a>, <a class="el" href="chan__h323_8c_source.html#l03222">load_module()</a>, and <a class="el" href="chan__h323_8c_source.html#l02832">reload_config()</a>.</p>

</div>
</div>
<a class="anchor" id="abb56ddafa06a53da731882da397ce655"></a><!-- doxytag: member="chan_h323.c::cli_h323" ref="abb56ddafa06a53da731882da397ce655" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> <a class="el" href="chan__h323_8c.html#abb56ddafa06a53da731882da397ce655">cli_h323</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l02773">2773</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3c042f9683086454ebde91b64db19726"></a><!-- doxytag: member="chan_h323.c::cli_h323_reload" ref="a3c042f9683086454ebde91b64db19726" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> <a class="el" href="chan__h323_8c.html#a3c042f9683086454ebde91b64db19726">cli_h323_reload</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment">
   <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="chan__h323_8c.html#a618287b0a5b4c030d38bf0145c602b54">handle_cli_h323_reload</a>, <span class="stringliteral">&quot;Reload H.323 configuration&quot;</span>)
</pre></div>
<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l03134">3134</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9ee8d742a1fbcff45f97842b92952610"></a><!-- doxytag: member="chan_h323.c::config" ref="a9ee8d742a1fbcff45f97842b92952610" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char <a class="el" href="pbx__lua_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>[] = &quot;h323.conf&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00128">128</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae91dad65f553f7afebe4af507803bc7f"></a><!-- doxytag: member="chan_h323.c::cos" ref="ae91dad65f553f7afebe4af507803bc7f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="chan__unistim_8c.html#ae91dad65f553f7afebe4af507803bc7f">cos</a> = 0<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00144">144</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>Referenced by <a class="el" href="indications_8c_source.html#l00301">ast_playtones_start()</a>, <a class="el" href="callerid_8c_source.html#l00112">callerid_init()</a>, <a class="el" href="dsp_8c_source.html#l00342">goertzel_init()</a>, <a class="el" href="tdd_8c_source.html#l00089">tdd_init()</a>, and <a class="el" href="channel_8c_source.html#l05367">tonepair_alloc()</a>.</p>

</div>
</div>
<a class="anchor" id="a7dc6cff9d51743005af0fcf0c37251ad"></a><!-- doxytag: member="chan_h323.c::default_context" ref="a7dc6cff9d51743005af0fcf0c37251ad" args="[AST_MAX_CONTEXT]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="chan__h323_8c.html#a7dc6cff9d51743005af0fcf0c37251ad">default_context</a>[AST_MAX_CONTEXT] = &quot;default&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00129">129</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="a2d8d5920e90ccbad7832926becdadb29"></a><!-- doxytag: member="chan_h323.c::default_jbconf" ref="a2d8d5920e90ccbad7832926becdadb29" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__jb__conf.html">ast_jb_conf</a> <a class="el" href="misdn__config_8c.html#a2d8d5920e90ccbad7832926becdadb29">default_jbconf</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Global jitterbuffer configuration - by default, jb is disabled. </p>

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00116">116</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="a4bd4778b66bf079c2227fe62ec9a3e73"></a><!-- doxytag: member="chan_h323.c::gatekeeper" ref="a4bd4778b66bf079c2227fe62ec9a3e73" args="[100]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="chan__h323_8c.html#a4bd4778b66bf079c2227fe62ec9a3e73">gatekeeper</a>[100]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00136">136</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="abf24fbc8556bb94e3e636bfa53170b7d"></a><!-- doxytag: member="chan_h323.c::gatekeeper_disable" ref="abf24fbc8556bb94e3e636bfa53170b7d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="chan__h323_8c.html#abf24fbc8556bb94e3e636bfa53170b7d">gatekeeper_disable</a> = 1<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00137">137</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1bcd9525b45f12be3151ff75d7f9712f"></a><!-- doxytag: member="chan_h323.c::gatekeeper_discover" ref="a1bcd9525b45f12be3151ff75d7f9712f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="chan__h323_8c.html#a1bcd9525b45f12be3151ff75d7f9712f">gatekeeper_discover</a> = 0<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00138">138</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac870109b5266804b2ae791184ed556b8"></a><!-- doxytag: member="chan_h323.c::gkroute" ref="ac870109b5266804b2ae791184ed556b8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="chan__h323_8c.html#ac870109b5266804b2ae791184ed556b8">gkroute</a> = 0<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00139">139</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="abaabcb7f4349cc632dde3af5c6a5e1bd"></a><!-- doxytag: member="chan_h323.c::global_jbconf" ref="abaabcb7f4349cc632dde3af5c6a5e1bd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__jb__conf.html">ast_jb_conf</a> <a class="el" href="misdn__config_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">global_jbconf</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00124">124</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l00951">__oh323_rtp_create()</a>, <a class="el" href="chan__h323_8c_source.html#l00332">__oh323_update_info()</a>, and <a class="el" href="chan__h323_8c_source.html#l02832">reload_config()</a>.</p>

</div>
</div>
<a class="anchor" id="ab2aace2a2c551db5a7ce9ccadc159b72"></a><!-- doxytag: member="chan_h323.c::global_options" ref="ab2aace2a2c551db5a7ce9ccadc159b72" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">call_options_t <a class="el" href="chan__h323_8c.html#ab2aace2a2c551db5a7ce9ccadc159b72">global_options</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00148">148</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad60ccb0475ed36e6be2e9914df685d56"></a><!-- doxytag: member="chan_h323.c::h323_reloading" ref="ad60ccb0475ed36e6be2e9914df685d56" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="chan__h323_8c.html#ad60ccb0475ed36e6be2e9914df685d56">h323_reloading</a> = 0<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00222">222</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7f366397aeb2f3ce05c337d8a8b32a09"></a><!-- doxytag: member="chan_h323.c::h323_signalling_port" ref="a7f366397aeb2f3ce05c337d8a8b32a09" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="chan__h323_8c.html#a7f366397aeb2f3ce05c337d8a8b32a09">h323_signalling_port</a> = 1720<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>H.323 configuration <a class="el" href="structvalues.html">values</a> </p>

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00135">135</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="aedf59c4beb0c5d85b88da5e360b5cc69"></a><!-- doxytag: member="chan_h323.c::h323debug" ref="aedf59c4beb0c5d85b88da5e360b5cc69" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="chan__h323_8c.html#aedf59c4beb0c5d85b88da5e360b5cc69">h323debug</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>global debug flag </p>

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00113">113</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="af2608cb80e01a744400057785fd1660e"></a><!-- doxytag: member="chan_h323.c::iflist" ref="af2608cb80e01a744400057785fd1660e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structoh323__pvt.html">oh323_pvt</a> * <a class="el" href="chan__phone_8c.html#a2369193a6501251a9a3fd53e44556758">iflist</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Private structure of a OpenH323 channel. </p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l00443">__oh323_destroy()</a>, <a class="el" href="chan__h323_8c_source.html#l02529">do_monitor()</a>, <a class="el" href="chan__h323_8c_source.html#l01144">find_call_locked()</a>, <a class="el" href="chan__h323_8c_source.html#l01101">oh323_alloc()</a>, and <a class="el" href="chan__h323_8c_source.html#l03325">unload_module()</a>.</p>

</div>
</div>
<a class="anchor" id="abda48311b6abe5a4dd8b6904ddde0a6d"></a><!-- doxytag: member="chan_h323.c::io" ref="abda48311b6abe5a4dd8b6904ddde0a6d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structio__context.html">io_context</a>* <a class="el" href="pbx__dundi_8c.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00209">209</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="afbd6fc6e0ab3c1a04a518f19c21d4503"></a><!-- doxytag: member="chan_h323.c::monitor_thread" ref="afbd6fc6e0ab3c1a04a518f19c21d4503" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_t <a class="el" href="chan__unistim_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503">monitor_thread</a> = AST_PTHREADT_NULL<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This is the thread for the monitor which checks for input on the <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> which are not currently in use. </p>

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00226">226</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="a662b19f30aa83f4c9b55099b8720e017"></a><!-- doxytag: member="chan_h323.c::oh323_rtp" ref="a662b19f30aa83f4c9b55099b8720e017" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__rtp__protocol.html">ast_rtp_protocol</a> <a class="el" href="chan__h323_8c.html#a662b19f30aa83f4c9b55099b8720e017">oh323_rtp</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l03215">3215</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6763477c6c97aba1b89bff0ac7641422"></a><!-- doxytag: member="chan_h323.c::oh323_tech" ref="a6763477c6c97aba1b89bff0ac7641422" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__channel__tech.html">ast_channel_tech</a> <a class="el" href="chan__h323_8c.html#a6763477c6c97aba1b89bff0ac7641422">oh323_tech</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00245">245</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1fa628b7c57610b13201ffbacefff0a1"></a><!-- doxytag: member="chan_h323.c::on_answer_call" ref="a1fa628b7c57610b13201ffbacefff0a1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">answer_call_cb <a class="el" href="chan__h323_8c.html#a1fa628b7c57610b13201ffbacefff0a1">on_answer_call</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00105">105</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa866b165304583211307f4df91b8f8f1"></a><!-- doxytag: member="chan_h323.c::on_chan_ringing" ref="aa866b165304583211307f4df91b8f8f1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">chan_ringing_cb <a class="el" href="chan__h323_8c.html#aa866b165304583211307f4df91b8f8f1">on_chan_ringing</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00102">102</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="a2df495e6b83fd37a4ddf1b22cdcd4193"></a><!-- doxytag: member="chan_h323.c::on_connection_cleared" ref="a2df495e6b83fd37a4ddf1b22cdcd4193" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">clear_con_cb <a class="el" href="chan__h323_8c.html#a2df495e6b83fd37a4ddf1b22cdcd4193">on_connection_cleared</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00104">104</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="a762d63fc9c454c71dca6a288adf9afc9"></a><!-- doxytag: member="chan_h323.c::on_connection_established" ref="a762d63fc9c454c71dca6a288adf9afc9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">con_established_cb <a class="el" href="chan__h323_8c.html#a762d63fc9c454c71dca6a288adf9afc9">on_connection_established</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00103">103</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1b72cae1fc4f7c8591edcb4dc25c3514"></a><!-- doxytag: member="chan_h323.c::on_external_rtp_create" ref="a1b72cae1fc4f7c8591edcb4dc25c3514" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">on_rtp_cb <a class="el" href="chan__h323_8c.html#a1b72cae1fc4f7c8591edcb4dc25c3514">on_external_rtp_create</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00098">98</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="ab2852f78157b26698470401cb69dabfb"></a><!-- doxytag: member="chan_h323.c::on_hangup" ref="ab2852f78157b26698470401cb69dabfb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">hangup_cb <a class="el" href="chan__h323_8c.html#ab2852f78157b26698470401cb69dabfb">on_hangup</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00108">108</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="a26e11e1159e5e1fae04d3a082b404840"></a><!-- doxytag: member="chan_h323.c::on_hold" ref="a26e11e1159e5e1fae04d3a082b404840" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">onhold_cb <a class="el" href="chan__h323_8c.html#a26e11e1159e5e1fae04d3a082b404840">on_hold</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00111">111</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae6909633a52dfecde1a36f8e1bce53c0"></a><!-- doxytag: member="chan_h323.c::on_incoming_call" ref="ae6909633a52dfecde1a36f8e1bce53c0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">setup_incoming_cb <a class="el" href="chan__h323_8c.html#ae6909633a52dfecde1a36f8e1bce53c0">on_incoming_call</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00100">100</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1f6e809c069ea40ba55d5ba90dd87976"></a><!-- doxytag: member="chan_h323.c::on_outgoing_call" ref="a1f6e809c069ea40ba55d5ba90dd87976" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">setup_outbound_cb <a class="el" href="chan__h323_8c.html#a1f6e809c069ea40ba55d5ba90dd87976">on_outgoing_call</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00101">101</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="a8cb82d6d08966697b18c3d6372352d63"></a><!-- doxytag: member="chan_h323.c::on_progress" ref="a8cb82d6d08966697b18c3d6372352d63" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">progress_cb <a class="el" href="chan__h323_8c.html#a8cb82d6d08966697b18c3d6372352d63">on_progress</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00106">106</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="a909f58fcc4cb5612bd30713b64605540"></a><!-- doxytag: member="chan_h323.c::on_receive_digit" ref="a909f58fcc4cb5612bd30713b64605540" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">receive_digit_cb <a class="el" href="chan__h323_8c.html#a909f58fcc4cb5612bd30713b64605540">on_receive_digit</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00097">97</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac3cb320bd0720f2cfd3ea72a29065ded"></a><!-- doxytag: member="chan_h323.c::on_set_rfc2833_payload" ref="ac3cb320bd0720f2cfd3ea72a29065ded" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rfc2833_cb <a class="el" href="chan__h323_8c.html#ac3cb320bd0720f2cfd3ea72a29065ded">on_set_rfc2833_payload</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00107">107</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="acb450c0aea67fa7f35686432c3348b61"></a><!-- doxytag: member="chan_h323.c::on_setcapabilities" ref="acb450c0aea67fa7f35686432c3348b61" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">setcapabilities_cb <a class="el" href="chan__h323_8c.html#acb450c0aea67fa7f35686432c3348b61">on_setcapabilities</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00109">109</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="a4ce39abed19cb9aa170776834bc2bf80"></a><!-- doxytag: member="chan_h323.c::on_setpeercapabilities" ref="a4ce39abed19cb9aa170776834bc2bf80" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">setpeercapabilities_cb <a class="el" href="chan__h323_8c.html#a4ce39abed19cb9aa170776834bc2bf80">on_setpeercapabilities</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00110">110</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="a54bda2aa0f993948068db2ffc8451525"></a><!-- doxytag: member="chan_h323.c::on_start_rtp_channel" ref="a54bda2aa0f993948068db2ffc8451525" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">start_rtp_cb <a class="el" href="chan__h323_8c.html#a54bda2aa0f993948068db2ffc8451525">on_start_rtp_channel</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00099">99</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="a73d22ff9770f2c94dac6e92c3eddea5f"></a><!-- doxytag: member="chan_h323.c::peerl" ref="a73d22ff9770f2c94dac6e92c3eddea5f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structh323__peer__list.html">h323_peer_list</a>  <a class="el" href="chan__h323_8c.html#a73d22ff9770f2c94dac6e92c3eddea5f">peerl</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>H323 peer list. </p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l01478">build_peer()</a>, <a class="el" href="chan__h323_8c_source.html#l02782">delete_users()</a>, <a class="el" href="chan__h323_8c_source.html#l01632">find_peer()</a>, <a class="el" href="chan__h323_8c_source.html#l03222">load_module()</a>, <a class="el" href="chan__h323_8c_source.html#l02826">prune_peers()</a>, <a class="el" href="chan__h323_8c_source.html#l02832">reload_config()</a>, and <a class="el" href="chan__h323_8c_source.html#l03325">unload_module()</a>.</p>

</div>
</div>
<a class="anchor" id="aea6233539fc73fc5303bf7525ec27e73"></a><!-- doxytag: member="chan_h323.c::sched" ref="aea6233539fc73fc5303bf7525ec27e73" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structsched__context.html">sched_context</a>* <a class="el" href="structsched.html">sched</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00208">208</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="a67fefea55602b6c8d1e29902f600e249"></a><!-- doxytag: member="chan_h323.c::secret" ref="a67fefea55602b6c8d1e29902f600e249" args="[50]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="chan__h323_8c.html#a67fefea55602b6c8d1e29902f600e249">secret</a>[50]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00145">145</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l23483">add_realm_authentication()</a>, <a class="el" href="res__jabber_8c_source.html#l00944">aji_act_hook()</a>, <a class="el" href="chan__iax2_8c_source.html#l07515">authenticate_verify()</a>, <a class="el" href="chan__iax2_8c_source.html#l11880">build_peer()</a>, <a class="el" href="chan__sip_8c_source.html#l17113">build_reply_digest()</a>, <a class="el" href="chan__iax2_8c_source.html#l12156">build_user()</a>, <a class="el" href="chan__iax2_8c_source.html#l13001">cache_get_callno_locked()</a>, <a class="el" href="chan__iax2_8c_source.html#l07197">check_access()</a>, <a class="el" href="chan__iax2_8c_source.html#l06017">decrypt_frame()</a>, <a class="el" href="chan__iax2_8c_source.html#l04777">iax2_call()</a>, <a class="el" href="chan__iax2_8c_source.html#l08180">iax2_register()</a>, <a class="el" href="chan__agent_8c_source.html#l01180">read_agent_config()</a>, <a class="el" href="chan__iax2_8c_source.html#l07596">register_verify()</a>, <a class="el" href="chan__sip_8c_source.html#l24245">reload_config()</a>, <a class="el" href="chan__iax2_8c_source.html#l12493">set_config()</a>, <a class="el" href="chan__sip_8c_source.html#l23584">set_peer_defaults()</a>, <a class="el" href="chan__sip_8c_source.html#l07472">sip_register()</a>, <a class="el" href="chan__sip_8c_source.html#l23066">sip_request_call()</a>, and <a class="el" href="chan__sip_8c_source.html#l07663">sip_subscribe_mwi()</a>.</p>

</div>
</div>
<a class="anchor" id="a71535bf985a1a06d548fd73a0a0ec32c"></a><!-- doxytag: member="chan_h323.c::tdesc" ref="a71535bf985a1a06d548fd73a0a0ec32c" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char <a class="el" href="chan__usbradio_8c.html#a206197bcdc50090e511e22b33a2166a9">tdesc</a>[] = &quot;The NuFone Network's Open H.323 Channel Driver&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Variables required by Asterisk </p>

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00127">127</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="a25a9305efab3b493ca2519562fcec3d5"></a><!-- doxytag: member="chan_h323.c::tos" ref="a25a9305efab3b493ca2519562fcec3d5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="pbx__dundi_8c.html#a25a9305efab3b493ca2519562fcec3d5">tos</a> = 0<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00143">143</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="a40103a555dbee6c6e5e4dc193c7fa833"></a><!-- doxytag: member="chan_h323.c::unique" ref="a40103a555dbee6c6e5e4dc193c7fa833" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="chan__h323_8c.html#a40103a555dbee6c6e5e4dc193c7fa833">unique</a> = 0<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00146">146</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="af8106a09b3ed0924050635f9a8a19fca"></a><!-- doxytag: member="chan_h323.c::userbyalias" ref="af8106a09b3ed0924050635f9a8a19fca" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="chan__h323_8c.html#af8106a09b3ed0924050635f9a8a19fca">userbyalias</a> = 1<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__h323_8c_source.html#l00141">141</a> of file <a class="el" href="chan__h323_8c_source.html">chan_h323.c</a>.</p>

</div>
</div>
<a class="anchor" id="ab8937033f3230cb7adfe1e86d2055a5e"></a><!-- doxytag: member="chan_h323.c::userl" ref="ab8937033f3230cb7adfe1e86d2055a5e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structh323__user__list.html">h323_user_list</a>  <a class="el" href="chan__h323_8c.html#ab8937033f3230cb7adfe1e86d2055a5e">userl</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>H323 User list. </p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l01360">build_user()</a>, <a class="el" href="chan__h323_8c_source.html#l02782">delete_users()</a>, <a class="el" href="chan__h323_8c_source.html#l01602">find_user()</a>, <a class="el" href="chan__h323_8c_source.html#l03222">load_module()</a>, <a class="el" href="chan__h323_8c_source.html#l02832">reload_config()</a>, and <a class="el" href="chan__h323_8c_source.html#l03325">unload_module()</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:19:58 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
