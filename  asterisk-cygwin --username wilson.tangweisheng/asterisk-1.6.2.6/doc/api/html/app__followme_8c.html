<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:18:56 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_7739c4bd2a7c382676c2c912043775c7.html">apps</a>
  </div>
</div>
<div class="contents">
<h1>app_followme.c File Reference</h1>
<p>Find-Me Follow-Me application.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="asterisk_8h_source.html">asterisk.h</a>&quot;</code><br/>
<code>#include &lt;signal.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="paths_8h_source.html">asterisk/paths.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="lock_8h_source.html">asterisk/lock.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="file_8h_source.html">asterisk/file.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="channel_8h_source.html">asterisk/channel.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="pbx_8h_source.html">asterisk/pbx.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="module_8h_source.html">asterisk/module.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="translate_8h_source.html">asterisk/translate.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="say_8h_source.html">asterisk/say.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="features_8h_source.html">asterisk/features.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="musiconhold_8h_source.html">asterisk/musiconhold.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="cli_8h_source.html">asterisk/cli.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="manager_8h_source.html">asterisk/manager.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="config_8h_source.html">asterisk/config.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="monitor_8h_source.html">asterisk/monitor.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="utils_8h_source.html">asterisk/utils.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="causes_8h_source.html">asterisk/causes.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="astdb_8h_source.html">asterisk/astdb.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="dsp_8h_source.html">asterisk/dsp.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="app_8h_source.html">asterisk/app.h</a>&quot;</code><br/>

<p><a href="app__followme_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcall__followme.html">call_followme</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Data structure for followme scripts.  <a href="structcall__followme.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfindme__user.html">findme_user</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfm__args.html">fm_args</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structnumber.html">number</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Number structure.  <a href="structnumber.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom">{ <a class="el" href="app__followme_8c.html#a05589fbab0657f08285ebdfe93f5ec9eae4d958c16dc313931ea3085a2fe66a45">FOLLOWMEFLAG_STATUSMSG</a> =  (1 &lt;&lt; 0), 
<a class="el" href="app__followme_8c.html#a05589fbab0657f08285ebdfe93f5ec9eaaec0bc89cf600ac7a7eda8bfc6c7f131">FOLLOWMEFLAG_RECORDNAME</a> =  (1 &lt;&lt; 1), 
<a class="el" href="app__followme_8c.html#a05589fbab0657f08285ebdfe93f5ec9ea193ed723fecb00c576eae4ee1491e76d">FOLLOWMEFLAG_UNREACHABLEMSG</a> =  (1 &lt;&lt; 2)
 }</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structcall__followme.html">call_followme</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#ace16df1bb73fc3611a7b1d0b2bf77fd3">alloc_profile</a> (const char *fmname)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Allocate and initialize followme profile.  <a href="#ace16df1bb73fc3611a7b1d0b2bf77fd3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#a0e20eb0c1f8fdf6ca75e70db33f47ef9">app_exec</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#a28b5a982589e5fb65ae794794d97f690">AST_APP_OPTIONS</a> (followme_opts,{AST_APP_OPTION('s', FOLLOWMEFLAG_STATUSMSG), AST_APP_OPTION('a', FOLLOWMEFLAG_RECORDNAME), AST_APP_OPTION('n', FOLLOWMEFLAG_UNREACHABLEMSG),})</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#a89eab1189d02dd27c9ac03c4b2c19360">AST_LIST_HEAD_NOLOCK</a> (findme_user_listptr, <a class="el" href="structfindme__user.html">findme_user</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#af5396fe6e348c7540ad75ba410302333">AST_MODULE_INFO</a> (ASTERISK_GPL_KEY, AST_MODFLAG_DEFAULT,&quot;Find-Me/Follow-Me Application&quot;,.load=load_module,.unload=unload_module,.reload=reload,)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#ac63ee23d13876c263d1cbd032dc53a6b">AST_RWLIST_HEAD_STATIC</a> (followmes, <a class="el" href="structcall__followme.html">call_followme</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#a6dfdd110df83975e33a181076db12133">clear_caller</a> (struct <a class="el" href="structfindme__user.html">findme_user</a> *tmpuser)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#a5aeb2881b16ba0ebbe15d9e4cae4f676">clear_calling_tree</a> (struct findme_user_listptr *findme_user_list)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structnumber.html">number</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#a6809b71b4d445758dd9471de9d995588">create_followme_number</a> (char *<a class="el" href="structnumber.html">number</a>, int timeout, int numorder)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add a new <a class="el" href="structnumber.html" title="Number structure.">number</a>.  <a href="#a6809b71b4d445758dd9471de9d995588"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#acb5e3261ae018d7bbe4cbdcc9cace101">end_bridge_callback</a> (void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#adc150dec1056eca590d0f1555ff5188b">end_bridge_callback_data_fixup</a> (struct <a class="el" href="structast__bridge__config.html">ast_bridge_config</a> *bconfig, struct <a class="el" href="structast__channel.html">ast_channel</a> *originator, struct <a class="el" href="structast__channel.html">ast_channel</a> *terminator)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structcall__followme.html">call_followme</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#a1250a90348260fc35893e100e768dc72">find_realtime</a> (const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#a9e376d1687c24f3182bdffb0ed441a2d">findmeexec</a> (struct <a class="el" href="structfm__args.html">fm_args</a> *tpargs)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#afefd489e0ca01820b7054d61cd2d5a73">free_numbers</a> (struct <a class="el" href="structcall__followme.html">call_followme</a> *<a class="el" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#aa56fb5eca455d8b50b1247a0b8c04701">init_profile</a> (struct <a class="el" href="structcall__followme.html">call_followme</a> *<a class="el" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#a3935b36cf23add0f3e42ad55e506f913">profile_set_param</a> (struct <a class="el" href="structcall__followme.html">call_followme</a> *<a class="el" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>, const char *param, const char *<a class="el" href="structval.html">val</a>, int linenum, int failunknown)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set parameter in profile from configuration file.  <a href="#a3935b36cf23add0f3e42ad55e506f913"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#a464451be8c648057316f6e7dc82cee5c">reload_followme</a> (int reload)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Reload followme application module.  <a href="#a464451be8c648057316f6e7dc82cee5c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#ac4c2cfb4933d0035ed53143d4dcce457">wait_for_winner</a> (struct findme_user_listptr *findme_user_list, struct <a class="el" href="structnumber.html">number</a> *nm, struct <a class="el" href="structast__channel.html">ast_channel</a> *caller, char *namerecloc, int *<a class="el" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>, struct <a class="el" href="structfm__args.html">fm_args</a> *tpargs)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#a9e5f57131367eff409b9e0bd7b31aa1a">app</a> = &quot;FollowMe&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#a58f00693748f61c394c084fef26c3827">callfromprompt</a> [PATH_MAX] = &quot;followme/call-from&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#afb21a9c7fa24519c9f790555b1904b91">defaultmoh</a> = &quot;default&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#a846427c0fcd8e7f387e43b465f74e810">featuredigittimeout</a> = 5000</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#ac7eb2e0c3a6a5a82caca6194003cb287">featuredigittostr</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#a9dbb4ee6d178039269f8d6c8bb5b6610">nextindp</a> [20] = &quot;2&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#ad19a8f288abdc0da9c0970a76e535a88">norecordingprompt</a> [PATH_MAX] = &quot;followme/no-recording&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#a8cd1221921f88677b4e194ccabb54f23">optionsprompt</a> [PATH_MAX] = &quot;followme/options&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#aa9ef93bdd1331f6a36cfc4b038790bd8">plsholdprompt</a> [PATH_MAX] = &quot;followme/pls-hold-while-try&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#a433b7a39c8c5b0df72622c414d7a8b4c">sorryprompt</a> [PATH_MAX] = &quot;followme/sorry&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#a9dc4e0a4fed22949dd087c179b43dbe9">statusprompt</a> [PATH_MAX] = &quot;followme/<a class="el" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#a5e4eb41cdb87c8899c7568985b44310e">takecall</a> [20] = &quot;1&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__followme_8c.html#a2df99f262786552284cf7927efda2efd">ynlongest</a> = 0</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Find-Me Follow-Me application. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>BJ Weschke &lt;<a href="mailto:bweschke@btwtech.com">bweschke@btwtech.com</a>&gt;</dd></dl>
<ul>
<li>See <a class="el" href="Config_followme.html">Followme: An application for simple follow-me calls</a> </li>
</ul>

<p>Definition in file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="a05589fbab0657f08285ebdfe93f5ec9e"></a><!-- doxytag: member="app_followme.c::@13" ref="a05589fbab0657f08285ebdfe93f5ec9e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a05589fbab0657f08285ebdfe93f5ec9eae4d958c16dc313931ea3085a2fe66a45"></a><!-- doxytag: member="FOLLOWMEFLAG_STATUSMSG" ref="a05589fbab0657f08285ebdfe93f5ec9eae4d958c16dc313931ea3085a2fe66a45" args="" -->FOLLOWMEFLAG_STATUSMSG</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a05589fbab0657f08285ebdfe93f5ec9eaaec0bc89cf600ac7a7eda8bfc6c7f131"></a><!-- doxytag: member="FOLLOWMEFLAG_RECORDNAME" ref="a05589fbab0657f08285ebdfe93f5ec9eaaec0bc89cf600ac7a7eda8bfc6c7f131" args="" -->FOLLOWMEFLAG_RECORDNAME</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a05589fbab0657f08285ebdfe93f5ec9ea193ed723fecb00c576eae4ee1491e76d"></a><!-- doxytag: member="FOLLOWMEFLAG_UNREACHABLEMSG" ref="a05589fbab0657f08285ebdfe93f5ec9ea193ed723fecb00c576eae4ee1491e76d" args="" -->FOLLOWMEFLAG_UNREACHABLEMSG</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="app__followme_8c_source.html#l00159">159</a> of file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00159"></a>00159      {
<a name="l00160"></a>00160    <a class="code" href="app__followme_8c.html#a05589fbab0657f08285ebdfe93f5ec9eae4d958c16dc313931ea3085a2fe66a45">FOLLOWMEFLAG_STATUSMSG</a> = (1 &lt;&lt; 0),
<a name="l00161"></a>00161    <a class="code" href="app__followme_8c.html#a05589fbab0657f08285ebdfe93f5ec9eaaec0bc89cf600ac7a7eda8bfc6c7f131">FOLLOWMEFLAG_RECORDNAME</a> = (1 &lt;&lt; 1),
<a name="l00162"></a>00162    <a class="code" href="app__followme_8c.html#a05589fbab0657f08285ebdfe93f5ec9ea193ed723fecb00c576eae4ee1491e76d">FOLLOWMEFLAG_UNREACHABLEMSG</a> = (1 &lt;&lt; 2)
<a name="l00163"></a>00163 };
</pre></div></p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ace16df1bb73fc3611a7b1d0b2bf77fd3"></a><!-- doxytag: member="app_followme.c::alloc_profile" ref="ace16df1bb73fc3611a7b1d0b2bf77fd3" args="(const char *fmname)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structcall__followme.html">call_followme</a>* alloc_profile </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>fmname</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Allocate and initialize followme profile. </p>

<p>Definition at line <a class="el" href="app__followme_8c_source.html#l00212">212</a> of file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="linkedlists_8h_source.html#l00665">AST_LIST_HEAD_INIT_NOLOCK</a>, <a class="el" href="lock_8h_source.html#l01692">ast_mutex_init()</a>, <a class="el" href="app__followme_8c_source.html#l00116">call_followme::callfromprompt</a>, <a class="el" href="app__followme_8c_source.html#l00111">call_followme::context</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="app__followme_8c_source.html#l00108">call_followme::lock</a>, <a class="el" href="app__followme_8c_source.html#l00110">call_followme::moh</a>, <a class="el" href="app__followme_8c_source.html#l00109">call_followme::name</a>, <a class="el" href="app__followme_8c_source.html#l00115">call_followme::nextindp</a>, <a class="el" href="app__followme_8c_source.html#l00117">call_followme::norecordingprompt</a>, <a class="el" href="app__followme_8c_source.html#l00118">call_followme::optionsprompt</a>, <a class="el" href="app__followme_8c_source.html#l00119">call_followme::plsholdprompt</a>, <a class="el" href="app__followme_8c_source.html#l00121">call_followme::sorryprompt</a>, <a class="el" href="app__followme_8c_source.html#l00120">call_followme::statusprompt</a>, and <a class="el" href="app__followme_8c_source.html#l00114">call_followme::takecall</a>.</p>

<p>Referenced by <a class="el" href="app__followme_8c_source.html#l00917">find_realtime()</a>, and <a class="el" href="app__followme_8c_source.html#l00297">reload_followme()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00213"></a>00213 {
<a name="l00214"></a>00214    <span class="keyword">struct </span><a class="code" href="structcall__followme.html" title="Data structure for followme scripts.">call_followme</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l00215"></a>00215 
<a name="l00216"></a>00216    <span class="keywordflow">if</span> (!(f = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*f))))
<a name="l00217"></a>00217       <span class="keywordflow">return</span> NULL;
<a name="l00218"></a>00218 
<a name="l00219"></a>00219    <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;f-&gt;<a class="code" href="structcall__followme.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00220"></a>00220    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(f-&gt;<a class="code" href="structcall__followme.html#a3010cd0d0ed2387e8f00c212787c2746">name</a>, fmname, <span class="keyword">sizeof</span>(f-&gt;<a class="code" href="structcall__followme.html#a3010cd0d0ed2387e8f00c212787c2746">name</a>));
<a name="l00221"></a>00221    f-&gt;<a class="code" href="structcall__followme.html#ac63620daf5cbc4c0297282362b746909">moh</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00222"></a>00222    f-&gt;<a class="code" href="structcall__followme.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00223"></a>00223    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(f-&gt;<a class="code" href="structcall__followme.html#a5e4eb41cdb87c8899c7568985b44310e">takecall</a>, <a class="code" href="app__followme_8c.html#a5e4eb41cdb87c8899c7568985b44310e">takecall</a>, <span class="keyword">sizeof</span>(f-&gt;<a class="code" href="structcall__followme.html#a5e4eb41cdb87c8899c7568985b44310e">takecall</a>));
<a name="l00224"></a>00224    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(f-&gt;<a class="code" href="structcall__followme.html#a9dbb4ee6d178039269f8d6c8bb5b6610">nextindp</a>, <a class="code" href="app__followme_8c.html#a9dbb4ee6d178039269f8d6c8bb5b6610">nextindp</a>, <span class="keyword">sizeof</span>(f-&gt;<a class="code" href="structcall__followme.html#a9dbb4ee6d178039269f8d6c8bb5b6610">nextindp</a>));
<a name="l00225"></a>00225    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(f-&gt;<a class="code" href="structcall__followme.html#a58f00693748f61c394c084fef26c3827">callfromprompt</a>, <a class="code" href="app__followme_8c.html#a58f00693748f61c394c084fef26c3827">callfromprompt</a>, <span class="keyword">sizeof</span>(f-&gt;<a class="code" href="structcall__followme.html#a58f00693748f61c394c084fef26c3827">callfromprompt</a>));
<a name="l00226"></a>00226    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(f-&gt;<a class="code" href="structcall__followme.html#ad19a8f288abdc0da9c0970a76e535a88">norecordingprompt</a>, <a class="code" href="app__followme_8c.html#ad19a8f288abdc0da9c0970a76e535a88">norecordingprompt</a>, <span class="keyword">sizeof</span>(f-&gt;<a class="code" href="structcall__followme.html#ad19a8f288abdc0da9c0970a76e535a88">norecordingprompt</a>));
<a name="l00227"></a>00227    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(f-&gt;<a class="code" href="structcall__followme.html#a8cd1221921f88677b4e194ccabb54f23">optionsprompt</a>, <a class="code" href="app__followme_8c.html#a8cd1221921f88677b4e194ccabb54f23">optionsprompt</a>, <span class="keyword">sizeof</span>(f-&gt;<a class="code" href="structcall__followme.html#a8cd1221921f88677b4e194ccabb54f23">optionsprompt</a>));
<a name="l00228"></a>00228    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(f-&gt;<a class="code" href="structcall__followme.html#aa9ef93bdd1331f6a36cfc4b038790bd8">plsholdprompt</a>, <a class="code" href="app__followme_8c.html#aa9ef93bdd1331f6a36cfc4b038790bd8">plsholdprompt</a>, <span class="keyword">sizeof</span>(f-&gt;<a class="code" href="structcall__followme.html#aa9ef93bdd1331f6a36cfc4b038790bd8">plsholdprompt</a>));
<a name="l00229"></a>00229    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(f-&gt;<a class="code" href="structcall__followme.html#a9dc4e0a4fed22949dd087c179b43dbe9">statusprompt</a>, <a class="code" href="app__followme_8c.html#a9dc4e0a4fed22949dd087c179b43dbe9">statusprompt</a>, <span class="keyword">sizeof</span>(f-&gt;<a class="code" href="structcall__followme.html#a9dc4e0a4fed22949dd087c179b43dbe9">statusprompt</a>));
<a name="l00230"></a>00230    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(f-&gt;<a class="code" href="structcall__followme.html#a433b7a39c8c5b0df72622c414d7a8b4c">sorryprompt</a>, <a class="code" href="app__followme_8c.html#a433b7a39c8c5b0df72622c414d7a8b4c">sorryprompt</a>, <span class="keyword">sizeof</span>(f-&gt;<a class="code" href="structcall__followme.html#a433b7a39c8c5b0df72622c414d7a8b4c">sorryprompt</a>));
<a name="l00231"></a>00231    <a class="code" href="linkedlists_8h.html#a0d1f922e093ac18824a7863fe3f5fa27" title="Initializes a list head structure.">AST_LIST_HEAD_INIT_NOLOCK</a>(&amp;f-&gt;numbers);
<a name="l00232"></a>00232    <a class="code" href="linkedlists_8h.html#a0d1f922e093ac18824a7863fe3f5fa27" title="Initializes a list head structure.">AST_LIST_HEAD_INIT_NOLOCK</a>(&amp;f-&gt;blnumbers);
<a name="l00233"></a>00233    <a class="code" href="linkedlists_8h.html#a0d1f922e093ac18824a7863fe3f5fa27" title="Initializes a list head structure.">AST_LIST_HEAD_INIT_NOLOCK</a>(&amp;f-&gt;wlnumbers);
<a name="l00234"></a>00234    <span class="keywordflow">return</span> f;
<a name="l00235"></a>00235 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0e20eb0c1f8fdf6ca75e70db33f47ef9"></a><!-- doxytag: member="app_followme.c::app_exec" ref="a0e20eb0c1f8fdf6ca75e70db33f47ef9" args="(struct ast_channel *chan, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int app_exec </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__followme_8c_source.html#l01003">1003</a> of file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="app__followme_8c_source.html#l00112">call_followme::active</a>, <a class="el" href="channel_8c_source.html#l01951">ast_answer()</a>, <a class="el" href="app_8h_source.html#l00338">AST_APP_ARG</a>, <a class="el" href="app_8c_source.html#l01776">ast_app_parse_options()</a>, <a class="el" href="features_8c_source.html#l02441">ast_bridge_call()</a>, <a class="el" href="channel_8c_source.html#l04200">ast_channel_make_compatible()</a>, <a class="el" href="asterisk_8c_source.html#l00251">ast_config_AST_SPOOL_DIR</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="channel_8c_source.html#l01956">ast_deactivate_generator()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="app_8h_source.html#l00355">AST_DECLARE_APP_ARGS</a>, <a class="el" href="dsp_8c_source.html#l01707">ast_dsp_get_threshold_from_settings()</a>, <a class="el" href="channel_8h_source.html#l00580">AST_FEATURE_AUTOMON</a>, <a class="el" href="channel_8h_source.html#l00577">AST_FEATURE_REDIRECT</a>, <a class="el" href="file_8c_source.html#l00914">ast_fileexists()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="channel_8c_source.html#l01690">ast_hangup()</a>, <a class="el" href="linkedlists_8h_source.html#l00665">AST_LIST_HEAD_INIT_NOLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00715">AST_LIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00817">AST_LIST_REMOVE_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8c_source.html#l05538">ast_moh_start()</a>, <a class="el" href="channel_8c_source.html#l05549">ast_moh_stop()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="app_8c_source.html#l00960">ast_play_and_record()</a>, <a class="el" href="linkedlists_8h_source.html#l00077">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="app_8h_source.html#l00387">AST_STANDARD_APP_ARGS</a>, <a class="el" href="channel_8h_source.html#l00365">AST_STATE_UP</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="file_8c_source.html#l01342">ast_stream_and_wait()</a>, <a class="el" href="file_8c_source.html#l00943">ast_streamfile()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="file_8c_source.html#l01315">ast_waitstream()</a>, <a class="el" href="app__followme_8c_source.html#l00116">call_followme::callfromprompt</a>, <a class="el" href="app__followme_8c_source.html#l00130">fm_args::chan</a>, <a class="el" href="app__followme_8c_source.html#l00111">call_followme::context</a>, <a class="el" href="app__followme_8c_source.html#l00278">create_followme_number()</a>, <a class="el" href="app__followme_8c_source.html#l00977">end_bridge_callback()</a>, <a class="el" href="structast__bridge__config.html#a03acb9e092c45d88e1fb9e146e5e554e">ast_bridge_config::end_bridge_callback</a>, <a class="el" href="channel_8h_source.html#l00604">ast_bridge_config::end_bridge_callback_data</a>, <a class="el" href="app__followme_8c_source.html#l00998">end_bridge_callback_data_fixup()</a>, <a class="el" href="structast__bridge__config.html#acf41a4cfd7f144294e2d14ab8738704a">ast_bridge_config::end_bridge_callback_data_fixup</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="channel_8h_source.html#l00590">ast_bridge_config::features_callee</a>, <a class="el" href="channel_8h_source.html#l00589">ast_bridge_config::features_caller</a>, <a class="el" href="app__followme_8c_source.html#l00917">find_realtime()</a>, <a class="el" href="app__followme_8c_source.html#l00777">findmeexec()</a>, <a class="el" href="app__followme_8c_source.html#l00161">FOLLOWMEFLAG_RECORDNAME</a>, <a class="el" href="app__followme_8c_source.html#l00160">FOLLOWMEFLAG_STATUSMSG</a>, <a class="el" href="app__followme_8c_source.html#l00162">FOLLOWMEFLAG_UNREACHABLEMSG</a>, <a class="el" href="app__followme_8c_source.html#l00189">free_numbers()</a>, <a class="el" href="app__followme_8c_source.html#l00108">call_followme::lock</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="app__followme_8c_source.html#l00110">call_followme::moh</a>, <a class="el" href="app__followme_8c_source.html#l00131">fm_args::mohclass</a>, <a class="el" href="app__followme_8c_source.html#l00109">call_followme::name</a>, <a class="el" href="app__followme_8c_source.html#l00115">call_followme::nextindp</a>, <a class="el" href="app__followme_8c_source.html#l00117">call_followme::norecordingprompt</a>, <a class="el" href="app__followme_8c_source.html#l00100">number::number</a>, <a class="el" href="app__followme_8c_source.html#l00118">call_followme::optionsprompt</a>, <a class="el" href="app__followme_8c_source.html#l00102">number::order</a>, <a class="el" href="app__followme_8c_source.html#l00119">call_followme::plsholdprompt</a>, <a class="el" href="app__followme_8c_source.html#l00113">call_followme::realtime</a>, <a class="el" href="strings_8h_source.html#l00072">S_OR</a>, <a class="el" href="app__followme_8c_source.html#l00121">call_followme::sorryprompt</a>, <a class="el" href="app__followme_8c_source.html#l00120">call_followme::statusprompt</a>, <a class="el" href="app__followme_8c_source.html#l00114">call_followme::takecall</a>, <a class="el" href="dsp_8h_source.html#l00064">THRESHOLD_SILENCE</a>, and <a class="el" href="app__followme_8c_source.html#l00101">number::timeout</a>.</p>

<p>Referenced by <a class="el" href="app__followme_8c_source.html#l01178">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01004"></a>01004 {
<a name="l01005"></a>01005    <span class="keyword">struct </span><a class="code" href="structfm__args.html">fm_args</a> targs = { 0, };
<a name="l01006"></a>01006    <span class="keyword">struct </span><a class="code" href="structast__bridge__config.html" title="bridge configuration">ast_bridge_config</a> <a class="code" href="cdr__csv_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>;
<a name="l01007"></a>01007    <span class="keyword">struct </span><a class="code" href="structcall__followme.html" title="Data structure for followme scripts.">call_followme</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l01008"></a>01008    <span class="keyword">struct </span><a class="code" href="structnumber.html" title="Number structure.">number</a> *nm, *newnm;
<a name="l01009"></a>01009    <span class="keywordtype">int</span> res = 0;
<a name="l01010"></a>01010    <span class="keywordtype">char</span> *argstr;
<a name="l01011"></a>01011    <span class="keywordtype">char</span> namerecloc[255];
<a name="l01012"></a>01012    <span class="keywordtype">int</span> duration = 0;
<a name="l01013"></a>01013    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *caller;
<a name="l01014"></a>01014    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *outbound;
<a name="l01015"></a>01015    <a class="code" href="app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2" title="Declare a structure to hold an application&amp;#39;s arguments.">AST_DECLARE_APP_ARGS</a>(args,
<a name="l01016"></a>01016       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(followmeid);
<a name="l01017"></a>01017       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(options);
<a name="l01018"></a>01018    );
<a name="l01019"></a>01019 
<a name="l01020"></a>01020    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>)) {
<a name="l01021"></a>01021       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s requires an argument (followmeid)\n&quot;</span>, <a class="code" href="app__adsiprog_8c.html#a9e5f57131367eff409b9e0bd7b31aa1a">app</a>);
<a name="l01022"></a>01022       <span class="keywordflow">return</span> -1;
<a name="l01023"></a>01023    }
<a name="l01024"></a>01024 
<a name="l01025"></a>01025    <span class="keywordflow">if</span> (!(argstr = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>((<span class="keywordtype">char</span> *)<a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>))) {
<a name="l01026"></a>01026       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Out of memory!\n&quot;</span>);
<a name="l01027"></a>01027       <span class="keywordflow">return</span> -1;
<a name="l01028"></a>01028    }
<a name="l01029"></a>01029 
<a name="l01030"></a>01030    <a class="code" href="app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8" title="Performs the &amp;#39;standard&amp;#39; argument separation process for an application.">AST_STANDARD_APP_ARGS</a>(args, argstr);
<a name="l01031"></a>01031 
<a name="l01032"></a>01032    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(args.followmeid)) {
<a name="l01033"></a>01033       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s requires an argument (followmeid)\n&quot;</span>, <a class="code" href="app__adsiprog_8c.html#a9e5f57131367eff409b9e0bd7b31aa1a">app</a>);
<a name="l01034"></a>01034       <span class="keywordflow">return</span> -1;
<a name="l01035"></a>01035    }
<a name="l01036"></a>01036 
<a name="l01037"></a>01037    <a class="code" href="linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc" title="Read locks a list.">AST_RWLIST_RDLOCK</a>(&amp;followmes);
<a name="l01038"></a>01038    <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;followmes, f, entry) {
<a name="l01039"></a>01039       <span class="keywordflow">if</span> (!strcasecmp(f-&gt;<a class="code" href="structcall__followme.html#a3010cd0d0ed2387e8f00c212787c2746">name</a>, args.followmeid) &amp;&amp; (f-&gt;<a class="code" href="structcall__followme.html#ad89074c5d51acfd1ca5a1d7787d30d37">active</a>))
<a name="l01040"></a>01040          <span class="keywordflow">break</span>;
<a name="l01041"></a>01041    }
<a name="l01042"></a>01042    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;followmes);
<a name="l01043"></a>01043 
<a name="l01044"></a>01044    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;New profile %s.\n&quot;</span>, args.followmeid);
<a name="l01045"></a>01045 
<a name="l01046"></a>01046    <span class="keywordflow">if</span> (!f) {
<a name="l01047"></a>01047       f = <a class="code" href="app__followme_8c.html#a1250a90348260fc35893e100e768dc72">find_realtime</a>(args.followmeid);
<a name="l01048"></a>01048    }
<a name="l01049"></a>01049 
<a name="l01050"></a>01050    <span class="keywordflow">if</span> (!f) {
<a name="l01051"></a>01051       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Profile requested, %s, not found in the configuration.\n&quot;</span>, args.followmeid);
<a name="l01052"></a>01052       <span class="keywordflow">return</span> 0;
<a name="l01053"></a>01053    }
<a name="l01054"></a>01054 
<a name="l01055"></a>01055    <span class="comment">/* XXX TODO: Reinsert the db check value to see whether or not follow-me is on or off */</span>
<a name="l01056"></a>01056    <span class="keywordflow">if</span> (args.options) 
<a name="l01057"></a>01057       <a class="code" href="app_8h.html#af40039f1c49c16d0f6fa33fe9c43a0cb" title="Parses a string containing application options and sets flags/arguments.">ast_app_parse_options</a>(followme_opts, &amp;targs.followmeflags, NULL, args.options);
<a name="l01058"></a>01058 
<a name="l01059"></a>01059    <span class="comment">/* Lock the profile lock and copy out everything we need to run with before unlocking it again */</span>
<a name="l01060"></a>01060    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;f-&gt;<a class="code" href="structcall__followme.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01061"></a>01061    targs.<a class="code" href="structfm__args.html#a887e3e255f6af7b271488183ef860e44">mohclass</a> = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(f-&gt;<a class="code" href="structcall__followme.html#ac63620daf5cbc4c0297282362b746909">moh</a>);
<a name="l01062"></a>01062    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(targs.context, f-&gt;<a class="code" href="structcall__followme.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <span class="keyword">sizeof</span>(targs.context));
<a name="l01063"></a>01063    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(targs.takecall, f-&gt;<a class="code" href="structcall__followme.html#a5e4eb41cdb87c8899c7568985b44310e">takecall</a>, <span class="keyword">sizeof</span>(targs.takecall));
<a name="l01064"></a>01064    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(targs.nextindp, f-&gt;<a class="code" href="structcall__followme.html#a9dbb4ee6d178039269f8d6c8bb5b6610">nextindp</a>, <span class="keyword">sizeof</span>(targs.nextindp));
<a name="l01065"></a>01065    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(targs.callfromprompt, f-&gt;<a class="code" href="structcall__followme.html#a58f00693748f61c394c084fef26c3827">callfromprompt</a>, <span class="keyword">sizeof</span>(targs.callfromprompt));
<a name="l01066"></a>01066    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(targs.norecordingprompt, f-&gt;<a class="code" href="structcall__followme.html#ad19a8f288abdc0da9c0970a76e535a88">norecordingprompt</a>, <span class="keyword">sizeof</span>(targs.norecordingprompt));
<a name="l01067"></a>01067    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(targs.optionsprompt, f-&gt;<a class="code" href="structcall__followme.html#a8cd1221921f88677b4e194ccabb54f23">optionsprompt</a>, <span class="keyword">sizeof</span>(targs.optionsprompt));
<a name="l01068"></a>01068    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(targs.plsholdprompt, f-&gt;<a class="code" href="structcall__followme.html#aa9ef93bdd1331f6a36cfc4b038790bd8">plsholdprompt</a>, <span class="keyword">sizeof</span>(targs.plsholdprompt));
<a name="l01069"></a>01069    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(targs.statusprompt, f-&gt;<a class="code" href="structcall__followme.html#a9dc4e0a4fed22949dd087c179b43dbe9">statusprompt</a>, <span class="keyword">sizeof</span>(targs.statusprompt));
<a name="l01070"></a>01070    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(targs.sorryprompt, f-&gt;<a class="code" href="structcall__followme.html#a433b7a39c8c5b0df72622c414d7a8b4c">sorryprompt</a>, <span class="keyword">sizeof</span>(targs.sorryprompt));
<a name="l01071"></a>01071    <span class="comment">/* Copy the numbers we&apos;re going to use into another list in case the master list should get modified </span>
<a name="l01072"></a>01072 <span class="comment">      (and locked) while we&apos;re trying to do a follow-me */</span>
<a name="l01073"></a>01073    <a class="code" href="linkedlists_8h.html#a0d1f922e093ac18824a7863fe3f5fa27" title="Initializes a list head structure.">AST_LIST_HEAD_INIT_NOLOCK</a>(&amp;targs.cnumbers);
<a name="l01074"></a>01074    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;f-&gt;numbers, nm, entry) {
<a name="l01075"></a>01075       newnm = <a class="code" href="app__followme_8c.html#a6809b71b4d445758dd9471de9d995588" title="Add a new number.">create_followme_number</a>(nm-&gt;<a class="code" href="structnumber.html#a92f27092d81a0f8a69958967e66bb688">number</a>, nm-&gt;<a class="code" href="structnumber.html#a0eb73e1ac837828209a5b842000fa3b0">timeout</a>, nm-&gt;<a class="code" href="structnumber.html#ac85d5511fdb8d162a7278bfb440ae420">order</a>);
<a name="l01076"></a>01076       <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;targs.cnumbers, newnm, entry);
<a name="l01077"></a>01077    }
<a name="l01078"></a>01078    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;f-&gt;<a class="code" href="structcall__followme.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01079"></a>01079 
<a name="l01080"></a>01080    <span class="comment">/* Answer the call */</span>
<a name="l01081"></a>01081    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) {
<a name="l01082"></a>01082       <a class="code" href="channel_8h.html#aec583a3e25358ee552a4f3df53914cd0" title="Answer a channel.">ast_answer</a>(chan);
<a name="l01083"></a>01083    }
<a name="l01084"></a>01084 
<a name="l01085"></a>01085    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;targs.followmeflags, <a class="code" href="app__followme_8c.html#a05589fbab0657f08285ebdfe93f5ec9eae4d958c16dc313931ea3085a2fe66a45">FOLLOWMEFLAG_STATUSMSG</a>)) 
<a name="l01086"></a>01086       <a class="code" href="file_8h.html#a95b94a020720147325a486e210b36775" title="stream file until digit If the file name is non-empty, try to play it.">ast_stream_and_wait</a>(chan, targs.statusprompt, <span class="stringliteral">&quot;&quot;</span>);
<a name="l01087"></a>01087 
<a name="l01088"></a>01088    snprintf(namerecloc,<span class="keyword">sizeof</span>(namerecloc),<span class="stringliteral">&quot;%s/followme.%s&quot;</span>,<a class="code" href="paths_8h.html#a95c5b4ffe620dc96d1ea9311b35c4d4f">ast_config_AST_SPOOL_DIR</a>,chan-&gt;uniqueid);
<a name="l01089"></a>01089    duration = 5;
<a name="l01090"></a>01090 
<a name="l01091"></a>01091    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;targs.followmeflags, <a class="code" href="app__followme_8c.html#a05589fbab0657f08285ebdfe93f5ec9eaaec0bc89cf600ac7a7eda8bfc6c7f131">FOLLOWMEFLAG_RECORDNAME</a>)) 
<a name="l01092"></a>01092       <span class="keywordflow">if</span> (<a class="code" href="app_8h.html#a5189403102ce3cae44bd1b1644ee97a2" title="Record a file for a max amount of time (in seconds), in a given list of formats separated...">ast_play_and_record</a>(chan, <span class="stringliteral">&quot;vm-rec-name&quot;</span>, namerecloc, 5, <span class="stringliteral">&quot;sln&quot;</span>, &amp;duration, <a class="code" href="dsp_8h.html#aab28c68838eaed4e0c89460a4e554cca" title="Get silence threshold from dsp.conf.">ast_dsp_get_threshold_from_settings</a>(<a class="code" href="dsp_8h.html#a11a8ce2b7eba2230cab37aad708d9abfa40278495f8621707b864e57e1110d20f">THRESHOLD_SILENCE</a>), 0, NULL) &lt; 0)
<a name="l01093"></a>01093          <span class="keywordflow">goto</span> outrun;
<a name="l01094"></a>01094 
<a name="l01095"></a>01095    <span class="keywordflow">if</span> (!<a class="code" href="file_8h.html#ab9b8ab8e5ee34c9b4da25779255cafde" title="Checks for the existence of a given file.">ast_fileexists</a>(namerecloc, NULL, chan-&gt;language))
<a name="l01096"></a>01096       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(namerecloc, <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">sizeof</span>(namerecloc));
<a name="l01097"></a>01097 
<a name="l01098"></a>01098    <span class="keywordflow">if</span> (<a class="code" href="file_8h.html#a67c7e271b4ca70aca6d48fd48d121857" title="Streams a file.">ast_streamfile</a>(chan, targs.plsholdprompt, chan-&gt;language))
<a name="l01099"></a>01099       <span class="keywordflow">goto</span> outrun;
<a name="l01100"></a>01100    <span class="keywordflow">if</span> (<a class="code" href="file_8h.html#affc21cb57c6bf72a2cb7ec8a379b2137" title="Waits for a stream to stop or digit to be pressed.">ast_waitstream</a>(chan, <span class="stringliteral">&quot;&quot;</span>) &lt; 0)
<a name="l01101"></a>01101       <span class="keywordflow">goto</span> outrun;
<a name="l01102"></a>01102    <a class="code" href="musiconhold_8h.html#a2acec01f2fddd8ca494d874003815cf7" title="Turn on music on hold on a given channel.">ast_moh_start</a>(chan, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(targs.<a class="code" href="structfm__args.html#a887e3e255f6af7b271488183ef860e44">mohclass</a>, NULL), NULL);
<a name="l01103"></a>01103 
<a name="l01104"></a>01104    targs.status = 0;
<a name="l01105"></a>01105    targs.<a class="code" href="structfm__args.html#a84d1435c5b8d387806714ea7079304b7">chan</a> = chan;
<a name="l01106"></a>01106    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(targs.namerecloc, namerecloc, <span class="keyword">sizeof</span>(targs.namerecloc));
<a name="l01107"></a>01107 
<a name="l01108"></a>01108    <a class="code" href="app__followme_8c.html#a9e376d1687c24f3182bdffb0ed441a2d">findmeexec</a>(&amp;targs);
<a name="l01109"></a>01109 
<a name="l01110"></a>01110    <span class="keywordflow">while</span> ((nm = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;targs.cnumbers, entry)))
<a name="l01111"></a>01111       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(nm);
<a name="l01112"></a>01112 
<a name="l01113"></a>01113    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(namerecloc))
<a name="l01114"></a>01114       unlink(namerecloc);
<a name="l01115"></a>01115 
<a name="l01116"></a>01116    <span class="keywordflow">if</span> (targs.status != 100) {
<a name="l01117"></a>01117       <a class="code" href="musiconhold_8h.html#a52fead32f69533450f3c05b2e6960149" title="Turn off music on hold on a given channel.">ast_moh_stop</a>(chan);
<a name="l01118"></a>01118       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;targs.followmeflags, <a class="code" href="app__followme_8c.html#a05589fbab0657f08285ebdfe93f5ec9ea193ed723fecb00c576eae4ee1491e76d">FOLLOWMEFLAG_UNREACHABLEMSG</a>)) 
<a name="l01119"></a>01119          <a class="code" href="file_8h.html#a95b94a020720147325a486e210b36775" title="stream file until digit If the file name is non-empty, try to play it.">ast_stream_and_wait</a>(chan, targs.sorryprompt, <span class="stringliteral">&quot;&quot;</span>);
<a name="l01120"></a>01120       res = 0;
<a name="l01121"></a>01121    } <span class="keywordflow">else</span> {
<a name="l01122"></a>01122       caller = chan;
<a name="l01123"></a>01123       outbound = targs.outbound;
<a name="l01124"></a>01124       <span class="comment">/* Bridge the two channels. */</span>
<a name="l01125"></a>01125 
<a name="l01126"></a>01126       memset(&amp;<a class="code" href="cdr__csv_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="cdr__csv_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>));
<a name="l01127"></a>01127       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(&amp;(<a class="code" href="cdr__csv_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>.features_callee), <a class="code" href="channel_8h.html#a7495a48740c9d555f7fbcb48246dbd93a33e339fbf78c26377f6c7057dda06ccc">AST_FEATURE_REDIRECT</a>);
<a name="l01128"></a>01128       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(&amp;(<a class="code" href="cdr__csv_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>.features_callee), <a class="code" href="channel_8h.html#a7495a48740c9d555f7fbcb48246dbd93ae16218a9dfb2123d391f959e3d078362">AST_FEATURE_AUTOMON</a>);
<a name="l01129"></a>01129       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(&amp;(<a class="code" href="cdr__csv_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>.features_caller), <a class="code" href="channel_8h.html#a7495a48740c9d555f7fbcb48246dbd93ae16218a9dfb2123d391f959e3d078362">AST_FEATURE_AUTOMON</a>);
<a name="l01130"></a>01130       <a class="code" href="cdr__csv_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>.end_bridge_callback = <a class="code" href="app__followme_8c.html#acb5e3261ae018d7bbe4cbdcc9cace101">end_bridge_callback</a>;
<a name="l01131"></a>01131       <a class="code" href="cdr__csv_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>.end_bridge_callback_data = chan;
<a name="l01132"></a>01132       <a class="code" href="cdr__csv_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>.end_bridge_callback_data_fixup = <a class="code" href="app__followme_8c.html#adc150dec1056eca590d0f1555ff5188b">end_bridge_callback_data_fixup</a>;
<a name="l01133"></a>01133 
<a name="l01134"></a>01134       <a class="code" href="musiconhold_8h.html#a52fead32f69533450f3c05b2e6960149" title="Turn off music on hold on a given channel.">ast_moh_stop</a>(caller);
<a name="l01135"></a>01135       <span class="comment">/* Be sure no generators are left on it */</span>
<a name="l01136"></a>01136       <a class="code" href="channel_8h.html#a7160355005776732fba88cc020f4a45b">ast_deactivate_generator</a>(caller);
<a name="l01137"></a>01137       <span class="comment">/* Make sure channels are compatible */</span>
<a name="l01138"></a>01138       res = <a class="code" href="channel_8h.html#a57646ce13ff95b5fc66dea2e741b21ff" title="Makes two channel formats compatible.">ast_channel_make_compatible</a>(caller, outbound);
<a name="l01139"></a>01139       <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l01140"></a>01140          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Had to drop call because I couldn&apos;t make %s compatible with %s\n&quot;</span>, caller-&gt;name, outbound-&gt;name);
<a name="l01141"></a>01141          <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(outbound);
<a name="l01142"></a>01142          <span class="keywordflow">goto</span> outrun;
<a name="l01143"></a>01143       }
<a name="l01144"></a>01144       res = <a class="code" href="features_8h.html#a3fe7c7e43b8f3140716d836816bf827f" title="Bridge a call, optionally allowing redirection.">ast_bridge_call</a>(caller, outbound, &amp;<a class="code" href="cdr__csv_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>);
<a name="l01145"></a>01145       <span class="keywordflow">if</span> (outbound)
<a name="l01146"></a>01146          <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(outbound);
<a name="l01147"></a>01147    }
<a name="l01148"></a>01148 
<a name="l01149"></a>01149    outrun:
<a name="l01150"></a>01150 
<a name="l01151"></a>01151    <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structcall__followme.html#aac1ae37fa4007496a50df75cf1f698c1">realtime</a>) {
<a name="l01152"></a>01152       <span class="comment">/* Not in list */</span>
<a name="l01153"></a>01153       <a class="code" href="app__followme_8c.html#afefd489e0ca01820b7054d61cd2d5a73">free_numbers</a>(f);
<a name="l01154"></a>01154       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(f);
<a name="l01155"></a>01155    }
<a name="l01156"></a>01156 
<a name="l01157"></a>01157    <span class="keywordflow">return</span> res;
<a name="l01158"></a>01158 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a28b5a982589e5fb65ae794794d97f690"></a><!-- doxytag: member="app_followme.c::AST_APP_OPTIONS" ref="a28b5a982589e5fb65ae794794d97f690" args="(followme_opts,{AST_APP_OPTION('s', FOLLOWMEFLAG_STATUSMSG), AST_APP_OPTION('a', FOLLOWMEFLAG_RECORDNAME), AST_APP_OPTION('n', FOLLOWMEFLAG_UNREACHABLEMSG),})" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AST_APP_OPTIONS </td>
          <td>(</td>
          <td class="paramtype">followme_opts&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a89eab1189d02dd27c9ac03c4b2c19360"></a><!-- doxytag: member="app_followme.c::AST_LIST_HEAD_NOLOCK" ref="a89eab1189d02dd27c9ac03c4b2c19360" args="(findme_user_listptr, findme_user)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AST_LIST_HEAD_NOLOCK </td>
          <td>(</td>
          <td class="paramtype">findme_user_listptr&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfindme__user.html">findme_user</a>&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="af5396fe6e348c7540ad75ba410302333"></a><!-- doxytag: member="app_followme.c::AST_MODULE_INFO" ref="af5396fe6e348c7540ad75ba410302333" args="(ASTERISK_GPL_KEY, AST_MODFLAG_DEFAULT,&quot;Find&#45;Me/Follow&#45;Me Application&quot;,.load=load_module,.unload=unload_module,.reload=reload,)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AST_MODULE_INFO </td>
          <td>(</td>
          <td class="paramtype">ASTERISK_GPL_KEY&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">AST_MODFLAG_DEFAULT&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;Find-Me/Follow-Me Application&quot;&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">.&nbsp;</td>
          <td class="paramname"> <em>load</em> = <code>load_module</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">.&nbsp;</td>
          <td class="paramname"> <em>unload</em> = <code>unload_module</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">.&nbsp;</td>
          <td class="paramname"> <em>reload</em> = <code>reload</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ac63ee23d13876c263d1cbd032dc53a6b"></a><!-- doxytag: member="app_followme.c::AST_RWLIST_HEAD_STATIC" ref="ac63ee23d13876c263d1cbd032dc53a6b" args="(followmes, call_followme)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static AST_RWLIST_HEAD_STATIC </td>
          <td>(</td>
          <td class="paramtype">followmes&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structcall__followme.html">call_followme</a>&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a6dfdd110df83975e33a181076db12133"></a><!-- doxytag: member="app_followme.c::clear_caller" ref="a6dfdd110df83975e33a181076db12133" args="(struct findme_user *tmpuser)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void clear_caller </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structfindme__user.html">findme_user</a> *&nbsp;</td>
          <td class="paramname"> <em>tmpuser</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__followme_8c_source.html#l00468">468</a> of file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>

<p>References <a class="el" href="cdr_8c_source.html#l00452">ast_cdr_alloc()</a>, <a class="el" href="cdr_8c_source.html#l00746">ast_cdr_disposition()</a>, <a class="el" href="cdr_8c_source.html#l00879">ast_cdr_end()</a>, <a class="el" href="cdr_8c_source.html#l00715">ast_cdr_failed()</a>, <a class="el" href="cdr_8c_source.html#l00844">ast_cdr_init()</a>, <a class="el" href="cdr_8c_source.html#l00778">ast_cdr_setapp()</a>, <a class="el" href="cdr_8c_source.html#l00674">ast_cdr_start()</a>, <a class="el" href="cdr_8c_source.html#l00996">ast_cdr_update()</a>, <a class="el" href="channel_8c_source.html#l01690">ast_hangup()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8h_source.html#l00422">ast_channel::cdr</a>, <a class="el" href="app__followme_8c_source.html#l00151">findme_user::dialarg</a>, <a class="el" href="channel_8h_source.html#l00479">ast_channel::hangupcause</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="app__followme_8c_source.html#l00149">findme_user::ochan</a>, and <a class="el" href="app__followme_8c_source.html#l00150">findme_user::state</a>.</p>

<p>Referenced by <a class="el" href="app__followme_8c_source.html#l00497">clear_calling_tree()</a>, and <a class="el" href="app__followme_8c_source.html#l00777">findmeexec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00469"></a>00469 {
<a name="l00470"></a>00470    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *outbound;
<a name="l00471"></a>00471 
<a name="l00472"></a>00472    <span class="keywordflow">if</span> (tmpuser &amp;&amp; tmpuser-&gt;<a class="code" href="structfindme__user.html#a3cd62ecaf93dc424694f2f347e02a35e">ochan</a> &amp;&amp; tmpuser-&gt;<a class="code" href="structfindme__user.html#a89f234133d3efe315836311cbf21c64b">state</a> &gt;= 0) {
<a name="l00473"></a>00473       outbound = tmpuser-&gt;<a class="code" href="structfindme__user.html#a3cd62ecaf93dc424694f2f347e02a35e">ochan</a>;
<a name="l00474"></a>00474       <span class="keywordflow">if</span> (!outbound-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>) {
<a name="l00475"></a>00475          outbound-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a> = <a class="code" href="cdr_8h.html#a29ba08b358224b4c820e5df826273b5b" title="Allocate a CDR record.">ast_cdr_alloc</a>();
<a name="l00476"></a>00476          <span class="keywordflow">if</span> (outbound-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>)
<a name="l00477"></a>00477             <a class="code" href="cdr_8h.html#a551fbacb2f2b4caaf57243c601c28a83" title="Initialize based on a channel.">ast_cdr_init</a>(outbound-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>, outbound);
<a name="l00478"></a>00478       }
<a name="l00479"></a>00479       <span class="keywordflow">if</span> (outbound-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>) {
<a name="l00480"></a>00480          <span class="keywordtype">char</span> tmp[256];
<a name="l00481"></a>00481 
<a name="l00482"></a>00482          snprintf(tmp, <span class="keyword">sizeof</span>(tmp), <span class="stringliteral">&quot;%s/%s&quot;</span>, <span class="stringliteral">&quot;Local&quot;</span>, tmpuser-&gt;<a class="code" href="structfindme__user.html#aefc45ce98c37211a6be9d58a341fcff3">dialarg</a>);
<a name="l00483"></a>00483          <a class="code" href="cdr_8h.html#a877162d212a320e7daec6aa7f695e9a8" title="Set the last executed application.">ast_cdr_setapp</a>(outbound-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>, <span class="stringliteral">&quot;FollowMe&quot;</span>, tmp);
<a name="l00484"></a>00484          <a class="code" href="cdr_8h.html#a92b2e3b685887b48d228f7546ae1a9f1">ast_cdr_update</a>(outbound);
<a name="l00485"></a>00485          <a class="code" href="cdr_8h.html#af788ef701483a64b77656f272843bcd4" title="Start a call.">ast_cdr_start</a>(outbound-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>);
<a name="l00486"></a>00486          <a class="code" href="cdr_8h.html#a9884cbdaef20e9f266bc2220772bf52b" title="End a call.">ast_cdr_end</a>(outbound-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>);
<a name="l00487"></a>00487          <span class="comment">/* If the cause wasn&apos;t handled properly */</span>
<a name="l00488"></a>00488          <span class="keywordflow">if</span> (<a class="code" href="cdr_8h.html#a5468ad8b7a45f1f976728be1b23dde47" title="Save the result of the call based on the AST_CAUSE_*.">ast_cdr_disposition</a>(outbound-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>, outbound-&gt;<a class="code" href="structast__channel.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a>))
<a name="l00489"></a>00489             <a class="code" href="cdr_8h.html#acdce2d9d0af5180090b70149ce18e554" title="Fail a call.">ast_cdr_failed</a>(outbound-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>);
<a name="l00490"></a>00490       } <span class="keywordflow">else</span>
<a name="l00491"></a>00491          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create Call Detail Record\n&quot;</span>);
<a name="l00492"></a>00492       <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(tmpuser-&gt;<a class="code" href="structfindme__user.html#a3cd62ecaf93dc424694f2f347e02a35e">ochan</a>);
<a name="l00493"></a>00493    }
<a name="l00494"></a>00494 
<a name="l00495"></a>00495 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5aeb2881b16ba0ebbe15d9e4cae4f676"></a><!-- doxytag: member="app_followme.c::clear_calling_tree" ref="a5aeb2881b16ba0ebbe15d9e4cae4f676" args="(struct findme_user_listptr *findme_user_list)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void clear_calling_tree </td>
          <td>(</td>
          <td class="paramtype">struct findme_user_listptr *&nbsp;</td>
          <td class="paramname"> <em>findme_user_list</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__followme_8c_source.html#l00497">497</a> of file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="app__followme_8c_source.html#l00468">clear_caller()</a>, and <a class="el" href="app__followme_8c_source.html#l00155">findme_user::cleared</a>.</p>

<p>Referenced by <a class="el" href="app__followme_8c_source.html#l00509">wait_for_winner()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00498"></a>00498 {
<a name="l00499"></a>00499    <span class="keyword">struct </span><a class="code" href="structfindme__user.html">findme_user</a> *tmpuser;
<a name="l00500"></a>00500 
<a name="l00501"></a>00501    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(findme_user_list, tmpuser, entry) {
<a name="l00502"></a>00502       <a class="code" href="app__followme_8c.html#a6dfdd110df83975e33a181076db12133">clear_caller</a>(tmpuser);
<a name="l00503"></a>00503       tmpuser-&gt;<a class="code" href="structfindme__user.html#a887e8bdd9deeb0866ce86067cdba5fcc">cleared</a> = 1;
<a name="l00504"></a>00504    }
<a name="l00505"></a>00505 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6809b71b4d445758dd9471de9d995588"></a><!-- doxytag: member="app_followme.c::create_followme_number" ref="a6809b71b4d445758dd9471de9d995588" args="(char *number, int timeout, int numorder)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structnumber.html">number</a>* create_followme_number </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>timeout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numorder</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add a new <a class="el" href="structnumber.html" title="Number structure.">number</a>. </p>

<p>Definition at line <a class="el" href="app__followme_8c_source.html#l00278">278</a> of file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="app__followme_8c_source.html#l00100">number::number</a>, <a class="el" href="app__followme_8c_source.html#l00102">number::order</a>, and <a class="el" href="app__followme_8c_source.html#l00101">number::timeout</a>.</p>

<p>Referenced by <a class="el" href="app__followme_8c_source.html#l01003">app_exec()</a>, <a class="el" href="app__followme_8c_source.html#l00917">find_realtime()</a>, and <a class="el" href="app__followme_8c_source.html#l00297">reload_followme()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00279"></a>00279 {
<a name="l00280"></a>00280    <span class="keyword">struct </span><a class="code" href="structnumber.html" title="Number structure.">number</a> *cur;
<a name="l00281"></a>00281    <span class="keywordtype">char</span> *tmp;
<a name="l00282"></a>00282 
<a name="l00283"></a>00283    <span class="keywordflow">if</span> (!(cur = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*cur))))
<a name="l00284"></a>00284       <span class="keywordflow">return</span> NULL;
<a name="l00285"></a>00285 
<a name="l00286"></a>00286    cur-&gt;<a class="code" href="structnumber.html#a0eb73e1ac837828209a5b842000fa3b0">timeout</a> = <a class="code" href="structnumber.html#a0eb73e1ac837828209a5b842000fa3b0">timeout</a>;
<a name="l00287"></a>00287    <span class="keywordflow">if</span> ((tmp = strchr(<a class="code" href="structnumber.html" title="Number structure.">number</a>, <span class="charliteral">&apos;,&apos;</span>))) 
<a name="l00288"></a>00288       *tmp = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00289"></a>00289    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(cur-&gt;<a class="code" href="structnumber.html#a92f27092d81a0f8a69958967e66bb688">number</a>, <a class="code" href="structnumber.html" title="Number structure.">number</a>, <span class="keyword">sizeof</span>(cur-&gt;<a class="code" href="structnumber.html#a92f27092d81a0f8a69958967e66bb688">number</a>));
<a name="l00290"></a>00290    cur-&gt;<a class="code" href="structnumber.html#ac85d5511fdb8d162a7278bfb440ae420">order</a> = numorder;
<a name="l00291"></a>00291    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Created a number, %s, order of , %d, with a timeout of %ld.\n&quot;</span>, cur-&gt;<a class="code" href="structnumber.html#a92f27092d81a0f8a69958967e66bb688">number</a>, cur-&gt;<a class="code" href="structnumber.html#ac85d5511fdb8d162a7278bfb440ae420">order</a>, cur-&gt;<a class="code" href="structnumber.html#a0eb73e1ac837828209a5b842000fa3b0">timeout</a>);
<a name="l00292"></a>00292 
<a name="l00293"></a>00293    <span class="keywordflow">return</span> cur;
<a name="l00294"></a>00294 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acb5e3261ae018d7bbe4cbdcc9cace101"></a><!-- doxytag: member="app_followme.c::end_bridge_callback" ref="acb5e3261ae018d7bbe4cbdcc9cace101" args="(void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void end_bridge_callback </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__followme_8c_source.html#l00977">977</a> of file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>

<p>References <a class="el" href="cdr_8h_source.html#l00089">ast_cdr::answer</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="adsistub_8c_source.html#l00059">buf</a>, <a class="el" href="channel_8h_source.html#l00422">ast_channel::cdr</a>, <a class="el" href="pbx_8c_source.html#l09023">pbx_builtin_setvar_helper()</a>, and <a class="el" href="cdr_8h_source.html#l00087">ast_cdr::start</a>.</p>

<p>Referenced by <a class="el" href="app__followme_8c_source.html#l01003">app_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00978"></a>00978 {
<a name="l00979"></a>00979    <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[80];
<a name="l00980"></a>00980    time_t end;
<a name="l00981"></a>00981    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a> = <a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>;
<a name="l00982"></a>00982 
<a name="l00983"></a>00983    time(&amp;end);
<a name="l00984"></a>00984 
<a name="l00985"></a>00985    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l00986"></a>00986    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a>.tv_sec) {
<a name="l00987"></a>00987       snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%ld&quot;</span>, end - chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a>.tv_sec);
<a name="l00988"></a>00988       <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;ANSWEREDTIME&quot;</span>, buf);
<a name="l00989"></a>00989    }
<a name="l00990"></a>00990 
<a name="l00991"></a>00991    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>-&gt;<a class="code" href="structast__cdr.html#ad80305b5e16da9c2675d5f057bd69386">start</a>.tv_sec) {
<a name="l00992"></a>00992       snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%ld&quot;</span>, end - chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>-&gt;<a class="code" href="structast__cdr.html#ad80305b5e16da9c2675d5f057bd69386">start</a>.tv_sec);
<a name="l00993"></a>00993       <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;DIALEDTIME&quot;</span>, buf);
<a name="l00994"></a>00994    }
<a name="l00995"></a>00995    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l00996"></a>00996 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adc150dec1056eca590d0f1555ff5188b"></a><!-- doxytag: member="app_followme.c::end_bridge_callback_data_fixup" ref="adc150dec1056eca590d0f1555ff5188b" args="(struct ast_bridge_config *bconfig, struct ast_channel *originator, struct ast_channel *terminator)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void end_bridge_callback_data_fixup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge__config.html">ast_bridge_config</a> *&nbsp;</td>
          <td class="paramname"> <em>bconfig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>originator</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>terminator</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__followme_8c_source.html#l00998">998</a> of file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00604">ast_bridge_config::end_bridge_callback_data</a>.</p>

<p>Referenced by <a class="el" href="app__followme_8c_source.html#l01003">app_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00999"></a>00999 {
<a name="l01000"></a>01000    bconfig-&gt;<a class="code" href="structast__bridge__config.html#a30cb875f49910a9515ee92d8dfdf8b83">end_bridge_callback_data</a> = originator;
<a name="l01001"></a>01001 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1250a90348260fc35893e100e768dc72"></a><!-- doxytag: member="app_followme.c::find_realtime" ref="a1250a90348260fc35893e100e768dc72" args="(const char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structcall__followme.html">call_followme</a>* find_realtime </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__followme_8c_source.html#l00917">917</a> of file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>

<p>References <a class="el" href="app__followme_8c_source.html#l00212">alloc_profile()</a>, <a class="el" href="config_8c_source.html#l00613">ast_category_browse()</a>, <a class="el" href="config_8c_source.html#l00827">ast_config_destroy()</a>, <a class="el" href="utils_8c_source.html#l01328">ast_false()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="linkedlists_8h_source.html#l00715">AST_LIST_INSERT_TAIL</a>, <a class="el" href="config_8c_source.html#l02113">ast_load_realtime()</a>, <a class="el" href="config_8c_source.html#l02198">ast_load_realtime_multientry()</a>, <a class="el" href="lock_8h_source.html#l01712">ast_mutex_destroy()</a>, <a class="el" href="strings_8h_source.html#l00488">ast_str_buffer()</a>, <a class="el" href="strings_8h_source.html#l00415">ast_str_create()</a>, <a class="el" href="strings_8h_source.html#l00825">ast_str_set()</a>, <a class="el" href="config_8c_source.html#l00435">ast_variable_retrieve()</a>, <a class="el" href="config_8c_source.html#l00397">ast_variables_destroy()</a>, <a class="el" href="app__followme_8c_source.html#l00278">create_followme_number()</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="app__followme_8c_source.html#l00246">profile_set_param()</a>, <a class="el" href="compiler_8h_source.html#l00069">SENTINEL</a>, <a class="el" href="app__jack_8c_source.html#l00142">str</a>, <a class="el" href="app__followme_8c_source.html#l00101">number::timeout</a>, and <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>.</p>

<p>Referenced by <a class="el" href="app__followme_8c_source.html#l01003">app_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00918"></a>00918 {
<a name="l00919"></a>00919    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a> = <a class="code" href="config_8h.html#a1a03993603e2bc2463153857836645bb" title="Retrieve realtime configuration.">ast_load_realtime</a>(<span class="stringliteral">&quot;followme&quot;</span>, <span class="stringliteral">&quot;name&quot;</span>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <a class="code" href="compiler_8h.html#af2af475b85aef66019c417d8ded1c435">SENTINEL</a>), *v;
<a name="l00920"></a>00920    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *cfg;
<a name="l00921"></a>00921    <span class="keyword">const</span> <span class="keywordtype">char</span> *catg;
<a name="l00922"></a>00922    <span class="keyword">struct </span><a class="code" href="structcall__followme.html" title="Data structure for followme scripts.">call_followme</a> *<span class="keyword">new</span>;
<a name="l00923"></a>00923    <span class="keyword">struct </span><a class="code" href="structast__str.html" title="The descriptor of a dynamic string XXX storage will be optimized later if needed...">ast_str</a> *<a class="code" href="app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a> = <a class="code" href="strings_8h.html#a8ec37e4acb6ecb20eb6f6edd1141cd76" title="Create a malloc&amp;#39;ed dynamic length string.">ast_str_create</a>(16);
<a name="l00924"></a>00924 
<a name="l00925"></a>00925    <span class="keywordflow">if</span> (!var) {
<a name="l00926"></a>00926       <span class="keywordflow">return</span> NULL;
<a name="l00927"></a>00927    }
<a name="l00928"></a>00928 
<a name="l00929"></a>00929    <span class="keywordflow">if</span> (!(<span class="keyword">new</span> = <a class="code" href="app__followme_8c.html#ace16df1bb73fc3611a7b1d0b2bf77fd3" title="Allocate and initialize followme profile.">alloc_profile</a>(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>))) {
<a name="l00930"></a>00930       <span class="keywordflow">return</span> NULL;
<a name="l00931"></a>00931    }
<a name="l00932"></a>00932 
<a name="l00933"></a>00933    <span class="keywordflow">for</span> (v = var; v; v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l00934"></a>00934       <span class="keywordflow">if</span> (!strcasecmp(v-&gt;name, <span class="stringliteral">&quot;active&quot;</span>)) {
<a name="l00935"></a>00935          <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a6c3dc0bad204e9dd9890325c1c861e38" title="Make sure something is false. Determine if a string containing a boolean value is...">ast_false</a>(v-&gt;value)) {
<a name="l00936"></a>00936             <a class="code" href="lock_8h.html#ab237e70b569019bfb490ab0c3c09b8c5">ast_mutex_destroy</a>(&amp;new-&gt;lock);
<a name="l00937"></a>00937             <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(<span class="keyword">new</span>);
<a name="l00938"></a>00938             <span class="keywordflow">return</span> NULL;
<a name="l00939"></a>00939          }
<a name="l00940"></a>00940       } <span class="keywordflow">else</span> {
<a name="l00941"></a>00941          <a class="code" href="app__followme_8c.html#a3935b36cf23add0f3e42ad55e506f913" title="Set parameter in profile from configuration file.">profile_set_param</a>(<span class="keyword">new</span>, v-&gt;name, v-&gt;value, 0, 0);
<a name="l00942"></a>00942       }
<a name="l00943"></a>00943    }
<a name="l00944"></a>00944 
<a name="l00945"></a>00945    <a class="code" href="config_8h.html#ad3d8122172af6f13687a07840411d65d" title="Free variable list.">ast_variables_destroy</a>(var);
<a name="l00946"></a>00946    <span class="keyword">new</span>-&gt;realtime = 1;
<a name="l00947"></a>00947 
<a name="l00948"></a>00948    <span class="comment">/* Load numbers */</span>
<a name="l00949"></a>00949    <span class="keywordflow">if</span> (!(cfg = <a class="code" href="config_8h.html#a29ff8cd717c0c0bac60abbd827fec409" title="Retrieve realtime configuration.">ast_load_realtime_multientry</a>(<span class="stringliteral">&quot;followme_numbers&quot;</span>, <span class="stringliteral">&quot;ordinal LIKE&quot;</span>, <span class="stringliteral">&quot;%&quot;</span>, <span class="stringliteral">&quot;name&quot;</span>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <a class="code" href="compiler_8h.html#af2af475b85aef66019c417d8ded1c435">SENTINEL</a>))) {
<a name="l00950"></a>00950       <a class="code" href="lock_8h.html#ab237e70b569019bfb490ab0c3c09b8c5">ast_mutex_destroy</a>(&amp;new-&gt;lock);
<a name="l00951"></a>00951       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(<span class="keyword">new</span>);
<a name="l00952"></a>00952       <span class="keywordflow">return</span> NULL;
<a name="l00953"></a>00953    }
<a name="l00954"></a>00954 
<a name="l00955"></a>00955    <span class="keywordflow">for</span> (catg = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(cfg, NULL); catg; catg = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(cfg, catg)) {
<a name="l00956"></a>00956       <span class="keyword">const</span> <span class="keywordtype">char</span> *numstr, *timeoutstr, *ordstr;
<a name="l00957"></a>00957       <span class="keywordtype">int</span> timeout;
<a name="l00958"></a>00958       <span class="keyword">struct </span><a class="code" href="structnumber.html" title="Number structure.">number</a> *cur;
<a name="l00959"></a>00959       <span class="keywordflow">if</span> (!(numstr = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, catg, <span class="stringliteral">&quot;phonenumber&quot;</span>))) {
<a name="l00960"></a>00960          <span class="keywordflow">continue</span>;
<a name="l00961"></a>00961       }
<a name="l00962"></a>00962       <span class="keywordflow">if</span> (!(timeoutstr = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, catg, <span class="stringliteral">&quot;timeout&quot;</span>)) || sscanf(timeoutstr, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;timeout) != 1 || timeout &lt; 1) {
<a name="l00963"></a>00963          timeout = 25;
<a name="l00964"></a>00964       }
<a name="l00965"></a>00965       <span class="comment">/* This one has to exist; it was part of the query */</span>
<a name="l00966"></a>00966       ordstr = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, catg, <span class="stringliteral">&quot;ordinal&quot;</span>);
<a name="l00967"></a>00967       <a class="code" href="strings_8h.html#a4a3222f04f84c80a1d70f51e2dff00ea" title="Set a dynamic string using variable arguments.">ast_str_set</a>(&amp;str, 0, <span class="stringliteral">&quot;%s&quot;</span>, numstr);
<a name="l00968"></a>00968       <span class="keywordflow">if</span> ((cur = <a class="code" href="app__followme_8c.html#a6809b71b4d445758dd9471de9d995588" title="Add a new number.">create_followme_number</a>(<a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(str), timeout, atoi(ordstr)))) {
<a name="l00969"></a>00969          <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;new-&gt;numbers, cur, entry);
<a name="l00970"></a>00970       }
<a name="l00971"></a>00971    }
<a name="l00972"></a>00972    <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(cfg);
<a name="l00973"></a>00973 
<a name="l00974"></a>00974    <span class="keywordflow">return</span> <span class="keyword">new</span>;
<a name="l00975"></a>00975 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9e376d1687c24f3182bdffb0ed441a2d"></a><!-- doxytag: member="app_followme.c::findmeexec" ref="a9e376d1687c24f3182bdffb0ed441a2d" args="(struct fm_args *tpargs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void findmeexec </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structfm__args.html">fm_args</a> *&nbsp;</td>
          <td class="paramname"> <em>tpargs</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__followme_8c_source.html#l00777">777</a> of file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>

<p>References <a class="el" href="chan__iax2_8c_source.html#l00328">accountcode</a>, <a class="el" href="channel_8c_source.html#l00711">ast_best_codec()</a>, <a class="el" href="channel_8c_source.html#l04042">ast_call()</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="channel_8c_source.html#l00629">ast_cause2str()</a>, <a class="el" href="cdr_8c_source.html#l00452">ast_cdr_alloc()</a>, <a class="el" href="cdr_8c_source.html#l00746">ast_cdr_disposition()</a>, <a class="el" href="cdr_8c_source.html#l00879">ast_cdr_end()</a>, <a class="el" href="cdr_8c_source.html#l00715">ast_cdr_failed()</a>, <a class="el" href="cdr_8c_source.html#l00844">ast_cdr_init()</a>, <a class="el" href="cdr_8c_source.html#l00778">ast_cdr_setapp()</a>, <a class="el" href="cdr_8c_source.html#l00674">ast_cdr_start()</a>, <a class="el" href="cdr_8c_source.html#l00996">ast_cdr_update()</a>, <a class="el" href="channel_8c_source.html#l01517">ast_channel_datastore_inherit()</a>, <a class="el" href="channel_8c_source.html#l04302">ast_channel_inherit_variables()</a>, <a class="el" href="channel_8c_source.html#l00461">ast_check_hangup()</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="channel_8c_source.html#l01690">ast_hangup()</a>, <a class="el" href="linkedlists_8h_source.html#l00449">AST_LIST_EMPTY</a>, <a class="el" href="linkedlists_8h_source.html#l00665">AST_LIST_HEAD_INIT_NOLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00715">AST_LIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00817">AST_LIST_REMOVE_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8c_source.html#l03986">ast_request()</a>, <a class="el" href="channel_8c_source.html#l04670">ast_set_callerid()</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="stringfields_8h_source.html#l00285">ast_string_field_set</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="channel_8h_source.html#l00422">ast_channel::cdr</a>, <a class="el" href="app__followme_8c_source.html#l00130">fm_args::chan</a>, <a class="el" href="channel_8h_source.html#l00444">ast_channel::cid</a>, <a class="el" href="channel_8h_source.html#l00204">ast_callerid::cid_name</a>, <a class="el" href="channel_8h_source.html#l00203">ast_callerid::cid_num</a>, <a class="el" href="app__followme_8c_source.html#l00468">clear_caller()</a>, <a class="el" href="app__followme_8c_source.html#l00155">findme_user::cleared</a>, <a class="el" href="app__followme_8c_source.html#l00151">findme_user::dialarg</a>, <a class="el" href="channel_8h_source.html#l00479">ast_channel::hangupcause</a>, <a class="el" href="chan__alsa_8c_source.html#l00106">language</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__mgcp_8c_source.html#l00146">musicclass</a>, <a class="el" href="channel_8h_source.html#l00482">ast_channel::nativeformats</a>, <a class="el" href="app__followme_8c_source.html#l00100">number::number</a>, <a class="el" href="app__followme_8c_source.html#l00149">findme_user::ochan</a>, <a class="el" href="app__followme_8c_source.html#l00102">number::order</a>, <a class="el" href="app__followme_8c_source.html#l00150">findme_user::state</a>, <a class="el" href="app__followme_8c_source.html#l00101">number::timeout</a>, and <a class="el" href="app__followme_8c_source.html#l00509">wait_for_winner()</a>.</p>

<p>Referenced by <a class="el" href="app__followme_8c_source.html#l01003">app_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00778"></a>00778 {
<a name="l00779"></a>00779    <span class="keyword">struct </span><a class="code" href="structnumber.html" title="Number structure.">number</a> *nm;
<a name="l00780"></a>00780    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *outbound;
<a name="l00781"></a>00781    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *caller;
<a name="l00782"></a>00782    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *winner = NULL;
<a name="l00783"></a>00783    <span class="keywordtype">char</span> dialarg[512];
<a name="l00784"></a>00784    <span class="keywordtype">int</span> dg, idx;
<a name="l00785"></a>00785    <span class="keywordtype">char</span> *rest, *<a class="code" href="structnumber.html" title="Number structure.">number</a>;
<a name="l00786"></a>00786    <span class="keyword">struct </span><a class="code" href="structfindme__user.html">findme_user</a> *tmpuser;
<a name="l00787"></a>00787    <span class="keyword">struct </span><a class="code" href="structfindme__user.html">findme_user</a> *fmuser;
<a name="l00788"></a>00788    <span class="keyword">struct </span><a class="code" href="structfindme__user.html">findme_user</a> *headuser;
<a name="l00789"></a>00789    <span class="keyword">struct </span>findme_user_listptr *findme_user_list;
<a name="l00790"></a>00790    <span class="keywordtype">int</span> <a class="code" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>;
<a name="l00791"></a>00791 
<a name="l00792"></a>00792    findme_user_list = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*findme_user_list));
<a name="l00793"></a>00793    <a class="code" href="linkedlists_8h.html#a0d1f922e093ac18824a7863fe3f5fa27" title="Initializes a list head structure.">AST_LIST_HEAD_INIT_NOLOCK</a>(findme_user_list);
<a name="l00794"></a>00794 
<a name="l00795"></a>00795    <span class="comment">/* We&apos;re going to figure out what the longest possible string of digits to collect is */</span>
<a name="l00796"></a>00796    <a class="code" href="app__followme_8c.html#a2df99f262786552284cf7927efda2efd">ynlongest</a> = 0;
<a name="l00797"></a>00797    <span class="keywordflow">if</span> (strlen(tpargs-&gt;takecall) &gt; <a class="code" href="app__followme_8c.html#a2df99f262786552284cf7927efda2efd">ynlongest</a>)
<a name="l00798"></a>00798       <a class="code" href="app__followme_8c.html#a2df99f262786552284cf7927efda2efd">ynlongest</a> = strlen(tpargs-&gt;takecall);
<a name="l00799"></a>00799    <span class="keywordflow">if</span> (strlen(tpargs-&gt;nextindp) &gt; <a class="code" href="app__followme_8c.html#a2df99f262786552284cf7927efda2efd">ynlongest</a>)
<a name="l00800"></a>00800       <a class="code" href="app__followme_8c.html#a2df99f262786552284cf7927efda2efd">ynlongest</a> = strlen(tpargs-&gt;nextindp);
<a name="l00801"></a>00801 
<a name="l00802"></a>00802    idx = 1;
<a name="l00803"></a>00803    caller = tpargs-&gt;<a class="code" href="structfm__args.html#a84d1435c5b8d387806714ea7079304b7">chan</a>;
<a name="l00804"></a>00804    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;tpargs-&gt;cnumbers, nm, entry)
<a name="l00805"></a>00805       if (nm-&gt;order == idx)
<a name="l00806"></a>00806          break;
<a name="l00807"></a>00807 
<a name="l00808"></a>00808    while (nm) {
<a name="l00809"></a>00809 
<a name="l00810"></a>00810       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;Number %s timeout %ld\n&quot;</span>, nm-&gt;number,nm-&gt;timeout);
<a name="l00811"></a>00811 
<a name="l00812"></a>00812       number = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(nm-&gt;number);
<a name="l00813"></a>00813       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(3, <span class="stringliteral">&quot;examining %s\n&quot;</span>, number);
<a name="l00814"></a>00814       <span class="keywordflow">do</span> {
<a name="l00815"></a>00815          rest = strchr(number, <span class="charliteral">&apos;&amp;&apos;</span>);
<a name="l00816"></a>00816          <span class="keywordflow">if</span> (rest) {
<a name="l00817"></a>00817             *rest = 0;
<a name="l00818"></a>00818             rest++;
<a name="l00819"></a>00819          }
<a name="l00820"></a>00820 
<a name="l00821"></a>00821          <span class="keywordflow">if</span> (!strcmp(tpargs-&gt;context, <span class="stringliteral">&quot;&quot;</span>))
<a name="l00822"></a>00822             snprintf(dialarg, <span class="keyword">sizeof</span>(dialarg), <span class="stringliteral">&quot;%s&quot;</span>, number);
<a name="l00823"></a>00823          <span class="keywordflow">else</span>
<a name="l00824"></a>00824             snprintf(dialarg, <span class="keyword">sizeof</span>(dialarg), <span class="stringliteral">&quot;%s@%s&quot;</span>, number, tpargs-&gt;context);
<a name="l00825"></a>00825 
<a name="l00826"></a>00826          tmpuser = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*tmpuser));
<a name="l00827"></a>00827          <span class="keywordflow">if</span> (!tmpuser) {
<a name="l00828"></a>00828             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Out of memory!\n&quot;</span>);
<a name="l00829"></a>00829             <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(findme_user_list);
<a name="l00830"></a>00830             <span class="keywordflow">return</span>;
<a name="l00831"></a>00831          }
<a name="l00832"></a>00832 
<a name="l00833"></a>00833          outbound = <a class="code" href="channel_8h.html#a922b0c040026477b8e2020211abf604a" title="Requests a channel.">ast_request</a>(<span class="stringliteral">&quot;Local&quot;</span>, <a class="code" href="channel_8h.html#a4d78194779a26341c3ec7298b450b9ed" title="Pick the best audio codec.">ast_best_codec</a>(caller-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>), dialarg, &amp;dg);
<a name="l00834"></a>00834          <span class="keywordflow">if</span> (outbound) {
<a name="l00835"></a>00835             <a class="code" href="channel_8h.html#a88d833a56ea7de33e230281c5c12b75d" title="Set caller ID number, name and ANI.">ast_set_callerid</a>(outbound, caller-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>, caller-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a>, caller-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>);
<a name="l00836"></a>00836             <a class="code" href="channel_8h.html#a892b6550a4f90b70ad92198c9d05cedc" title="Inherits channel variable from parent to child channel.">ast_channel_inherit_variables</a>(tpargs-&gt;<a class="code" href="structfm__args.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, outbound);
<a name="l00837"></a>00837             <a class="code" href="channel_8h.html#a6ce892974f59537bda03a71319b452e2" title="Inherit datastores from a parent to a child.">ast_channel_datastore_inherit</a>(tpargs-&gt;<a class="code" href="structfm__args.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, outbound);
<a name="l00838"></a>00838             <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(outbound, <a class="code" href="chan__alsa_8c.html#adf416dc058363e2fd5750c77e2d78bee">language</a>, tpargs-&gt;<a class="code" href="structfm__args.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;language);
<a name="l00839"></a>00839             <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(outbound, <a class="code" href="chan__iax2_8c.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>, tpargs-&gt;<a class="code" href="structfm__args.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;accountcode);
<a name="l00840"></a>00840             <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(outbound, <a class="code" href="chan__mgcp_8c.html#abc34958c9b03014779727e5ca61b93e5">musicclass</a>, tpargs-&gt;<a class="code" href="structfm__args.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;musicclass);
<a name="l00841"></a>00841             <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;calling %s\n&quot;</span>, dialarg);
<a name="l00842"></a>00842             <span class="keywordflow">if</span> (!<a class="code" href="channel_8h.html#ae212e5f3ae50a869bbf859fe9db7dee0" title="Make a call.">ast_call</a>(outbound,dialarg,0)) {
<a name="l00843"></a>00843                tmpuser-&gt;<a class="code" href="structfindme__user.html#a3cd62ecaf93dc424694f2f347e02a35e">ochan</a> = outbound;
<a name="l00844"></a>00844                tmpuser-&gt;<a class="code" href="structfindme__user.html#a89f234133d3efe315836311cbf21c64b">state</a> = 0;
<a name="l00845"></a>00845                tmpuser-&gt;<a class="code" href="structfindme__user.html#a887e8bdd9deeb0866ce86067cdba5fcc">cleared</a> = 0;
<a name="l00846"></a>00846                <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmpuser-&gt;<a class="code" href="structfindme__user.html#aefc45ce98c37211a6be9d58a341fcff3">dialarg</a>, dialarg, <span class="keyword">sizeof</span>(dialarg));
<a name="l00847"></a>00847                <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(findme_user_list, tmpuser, entry);
<a name="l00848"></a>00848             } <span class="keywordflow">else</span> {
<a name="l00849"></a>00849                <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;couldn&apos;t reach at this number.\n&quot;</span>); 
<a name="l00850"></a>00850                <span class="keywordflow">if</span> (outbound) {
<a name="l00851"></a>00851                   <span class="keywordflow">if</span> (!outbound-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>) 
<a name="l00852"></a>00852                      outbound-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a> = <a class="code" href="cdr_8h.html#a29ba08b358224b4c820e5df826273b5b" title="Allocate a CDR record.">ast_cdr_alloc</a>();
<a name="l00853"></a>00853                   <span class="keywordflow">if</span> (outbound-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>) {
<a name="l00854"></a>00854                      <span class="keywordtype">char</span> tmp[256];
<a name="l00855"></a>00855 
<a name="l00856"></a>00856                      <a class="code" href="cdr_8h.html#a551fbacb2f2b4caaf57243c601c28a83" title="Initialize based on a channel.">ast_cdr_init</a>(outbound-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>, outbound);
<a name="l00857"></a>00857                      snprintf(tmp, <span class="keyword">sizeof</span>(tmp), <span class="stringliteral">&quot;%s/%s&quot;</span>, <span class="stringliteral">&quot;Local&quot;</span>, dialarg);
<a name="l00858"></a>00858                      <a class="code" href="cdr_8h.html#a877162d212a320e7daec6aa7f695e9a8" title="Set the last executed application.">ast_cdr_setapp</a>(outbound-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>, <span class="stringliteral">&quot;FollowMe&quot;</span>, tmp);
<a name="l00859"></a>00859                      <a class="code" href="cdr_8h.html#a92b2e3b685887b48d228f7546ae1a9f1">ast_cdr_update</a>(outbound);
<a name="l00860"></a>00860                      <a class="code" href="cdr_8h.html#af788ef701483a64b77656f272843bcd4" title="Start a call.">ast_cdr_start</a>(outbound-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>);
<a name="l00861"></a>00861                      <a class="code" href="cdr_8h.html#a9884cbdaef20e9f266bc2220772bf52b" title="End a call.">ast_cdr_end</a>(outbound-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>);
<a name="l00862"></a>00862                      <span class="comment">/* If the cause wasn&apos;t handled properly */</span>
<a name="l00863"></a>00863                      <span class="keywordflow">if</span> (<a class="code" href="cdr_8h.html#a5468ad8b7a45f1f976728be1b23dde47" title="Save the result of the call based on the AST_CAUSE_*.">ast_cdr_disposition</a>(outbound-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>,outbound-&gt;<a class="code" href="structast__channel.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a>))
<a name="l00864"></a>00864                         <a class="code" href="cdr_8h.html#acdce2d9d0af5180090b70149ce18e554" title="Fail a call.">ast_cdr_failed</a>(outbound-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>);
<a name="l00865"></a>00865                   } <span class="keywordflow">else</span> {
<a name="l00866"></a>00866                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to create Call Detail Record\n&quot;</span>);
<a name="l00867"></a>00867                      <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(outbound);
<a name="l00868"></a>00868                      outbound = NULL;
<a name="l00869"></a>00869                   }
<a name="l00870"></a>00870                }
<a name="l00871"></a>00871             }
<a name="l00872"></a>00872          } <span class="keywordflow">else</span> 
<a name="l00873"></a>00873             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to allocate a channel for Local/%s cause: %s\n&quot;</span>, dialarg, <a class="code" href="channel_8h.html#abb5f5ff5988e039726f2c0d982342378" title="Gives the string form of a given hangup cause.">ast_cause2str</a>(dg));
<a name="l00874"></a>00874 
<a name="l00875"></a>00875          number = rest;
<a name="l00876"></a>00876       } <span class="keywordflow">while</span> (number);
<a name="l00877"></a>00877 
<a name="l00878"></a>00878       status = 0;
<a name="l00879"></a>00879       <span class="keywordflow">if</span> (!<a class="code" href="linkedlists_8h.html#a4a1884cde93e53bef32ca85c194a1d05" title="Checks whether the specified list contains any entries.">AST_LIST_EMPTY</a>(findme_user_list))
<a name="l00880"></a>00880          winner = <a class="code" href="app__followme_8c.html#ac4c2cfb4933d0035ed53143d4dcce457">wait_for_winner</a>(findme_user_list, nm, caller, tpargs-&gt;namerecloc, &amp;status, tpargs);
<a name="l00881"></a>00881 
<a name="l00882"></a>00882       <span class="keywordflow">while</span> ((fmuser = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(findme_user_list, entry))) {
<a name="l00883"></a>00883          <span class="keywordflow">if</span> (!fmuser-&gt;<a class="code" href="structfindme__user.html#a887e8bdd9deeb0866ce86067cdba5fcc">cleared</a> &amp;&amp; fmuser-&gt;<a class="code" href="structfindme__user.html#a3cd62ecaf93dc424694f2f347e02a35e">ochan</a> != winner)
<a name="l00884"></a>00884             <a class="code" href="app__followme_8c.html#a6dfdd110df83975e33a181076db12133">clear_caller</a>(fmuser);
<a name="l00885"></a>00885          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(fmuser);
<a name="l00886"></a>00886       }
<a name="l00887"></a>00887 
<a name="l00888"></a>00888       fmuser = NULL;
<a name="l00889"></a>00889       tmpuser = NULL;
<a name="l00890"></a>00890       headuser = NULL;
<a name="l00891"></a>00891       <span class="keywordflow">if</span> (winner)
<a name="l00892"></a>00892          <span class="keywordflow">break</span>;
<a name="l00893"></a>00893 
<a name="l00894"></a>00894       <span class="keywordflow">if</span> (!caller || <a class="code" href="channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd" title="Check to see if a channel is needing hang up.">ast_check_hangup</a>(caller)) {
<a name="l00895"></a>00895          tpargs-&gt;status = 1;
<a name="l00896"></a>00896          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(findme_user_list);
<a name="l00897"></a>00897          <span class="keywordflow">return</span>;
<a name="l00898"></a>00898       }
<a name="l00899"></a>00899 
<a name="l00900"></a>00900       idx++;
<a name="l00901"></a>00901       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;tpargs-&gt;cnumbers, nm, entry) {
<a name="l00902"></a>00902          <span class="keywordflow">if</span> (nm-&gt;order == idx)
<a name="l00903"></a>00903             <span class="keywordflow">break</span>;
<a name="l00904"></a>00904       }
<a name="l00905"></a>00905    }
<a name="l00906"></a>00906    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(findme_user_list);
<a name="l00907"></a>00907    <span class="keywordflow">if</span> (!winner) 
<a name="l00908"></a>00908       tpargs-&gt;status = 1;
<a name="l00909"></a>00909    <span class="keywordflow">else</span> {
<a name="l00910"></a>00910       tpargs-&gt;status = 100;
<a name="l00911"></a>00911       tpargs-&gt;outbound = winner;
<a name="l00912"></a>00912    }
<a name="l00913"></a>00913 
<a name="l00914"></a>00914    <span class="keywordflow">return</span>;
<a name="l00915"></a>00915 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afefd489e0ca01820b7054d61cd2d5a73"></a><!-- doxytag: member="app_followme.c::free_numbers" ref="afefd489e0ca01820b7054d61cd2d5a73" args="(struct call_followme *f)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void free_numbers </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structcall__followme.html">call_followme</a> *&nbsp;</td>
          <td class="paramname"> <em>f</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__followme_8c_source.html#l00189">189</a> of file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="linkedlists_8h_source.html#l00665">AST_LIST_HEAD_INIT_NOLOCK</a>, and <a class="el" href="linkedlists_8h_source.html#l00817">AST_LIST_REMOVE_HEAD</a>.</p>

<p>Referenced by <a class="el" href="app__followme_8c_source.html#l01003">app_exec()</a>, <a class="el" href="app__followme_8c_source.html#l00297">reload_followme()</a>, and <a class="el" href="app__followme_8c_source.html#l01160">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00190"></a>00190 {
<a name="l00191"></a>00191    <span class="comment">/* Free numbers attached to the profile */</span>
<a name="l00192"></a>00192    <span class="keyword">struct </span><a class="code" href="structnumber.html" title="Number structure.">number</a> *prev;
<a name="l00193"></a>00193 
<a name="l00194"></a>00194    <span class="keywordflow">while</span> ((prev = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;f-&gt;numbers, entry)))
<a name="l00195"></a>00195       <span class="comment">/* Free the number */</span>
<a name="l00196"></a>00196       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(prev);
<a name="l00197"></a>00197    <a class="code" href="linkedlists_8h.html#a0d1f922e093ac18824a7863fe3f5fa27" title="Initializes a list head structure.">AST_LIST_HEAD_INIT_NOLOCK</a>(&amp;f-&gt;numbers);
<a name="l00198"></a>00198 
<a name="l00199"></a>00199    <span class="keywordflow">while</span> ((prev = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;f-&gt;blnumbers, entry)))
<a name="l00200"></a>00200       <span class="comment">/* Free the blacklisted number */</span>
<a name="l00201"></a>00201       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(prev);
<a name="l00202"></a>00202    <a class="code" href="linkedlists_8h.html#a0d1f922e093ac18824a7863fe3f5fa27" title="Initializes a list head structure.">AST_LIST_HEAD_INIT_NOLOCK</a>(&amp;f-&gt;blnumbers);
<a name="l00203"></a>00203 
<a name="l00204"></a>00204    <span class="keywordflow">while</span> ((prev = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;f-&gt;wlnumbers, entry)))
<a name="l00205"></a>00205       <span class="comment">/* Free the whitelisted number */</span>
<a name="l00206"></a>00206       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(prev);
<a name="l00207"></a>00207    <a class="code" href="linkedlists_8h.html#a0d1f922e093ac18824a7863fe3f5fa27" title="Initializes a list head structure.">AST_LIST_HEAD_INIT_NOLOCK</a>(&amp;f-&gt;wlnumbers);
<a name="l00208"></a>00208 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa56fb5eca455d8b50b1247a0b8c04701"></a><!-- doxytag: member="app_followme.c::init_profile" ref="aa56fb5eca455d8b50b1247a0b8c04701" args="(struct call_followme *f)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void init_profile </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structcall__followme.html">call_followme</a> *&nbsp;</td>
          <td class="paramname"> <em>f</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__followme_8c_source.html#l00237">237</a> of file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>

<p>References <a class="el" href="app__followme_8c_source.html#l00112">call_followme::active</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, and <a class="el" href="app__followme_8c_source.html#l00110">call_followme::moh</a>.</p>

<p>Referenced by <a class="el" href="app__followme_8c_source.html#l00297">reload_followme()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00238"></a>00238 {
<a name="l00239"></a>00239    f-&gt;<a class="code" href="structcall__followme.html#ad89074c5d51acfd1ca5a1d7787d30d37">active</a> = 1;
<a name="l00240"></a>00240    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(f-&gt;<a class="code" href="structcall__followme.html#ac63620daf5cbc4c0297282362b746909">moh</a>, <a class="code" href="app__followme_8c.html#afb21a9c7fa24519c9f790555b1904b91">defaultmoh</a>, <span class="keyword">sizeof</span>(f-&gt;<a class="code" href="structcall__followme.html#ac63620daf5cbc4c0297282362b746909">moh</a>));
<a name="l00241"></a>00241 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac3382bf6da54c56b37069bd76bbdf4f9"></a><!-- doxytag: member="app_followme.c::load_module" ref="ac3382bf6da54c56b37069bd76bbdf4f9" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int load_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__followme_8c_source.html#l01178">1178</a> of file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>

<p>References <a class="el" href="app__followme_8c_source.html#l01003">app_exec()</a>, <a class="el" href="module_8h_source.html#l00062">AST_MODULE_LOAD_DECLINE</a>, <a class="el" href="module_8h_source.html#l00406">ast_register_application_xml</a>, and <a class="el" href="app__followme_8c_source.html#l00297">reload_followme()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01179"></a>01179 {
<a name="l01180"></a>01180    <span class="keywordflow">if</span>(!<a class="code" href="app__followme_8c.html#a464451be8c648057316f6e7dc82cee5c" title="Reload followme application module.">reload_followme</a>(0))
<a name="l01181"></a>01181       <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;
<a name="l01182"></a>01182 
<a name="l01183"></a>01183    <span class="keywordflow">return</span> <a class="code" href="module_8h.html#afba4eb7a910b10969041ae4cd488729d" title="Register an application using XML documentation.">ast_register_application_xml</a>(<a class="code" href="app__adsiprog_8c.html#a9e5f57131367eff409b9e0bd7b31aa1a">app</a>, <a class="code" href="app__followme_8c.html#a0e20eb0c1f8fdf6ca75e70db33f47ef9">app_exec</a>);
<a name="l01184"></a>01184 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3935b36cf23add0f3e42ad55e506f913"></a><!-- doxytag: member="app_followme.c::profile_set_param" ref="a3935b36cf23add0f3e42ad55e506f913" args="(struct call_followme *f, const char *param, const char *val, int linenum, int failunknown)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void profile_set_param </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structcall__followme.html">call_followme</a> *&nbsp;</td>
          <td class="paramname"> <em>f</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>param</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>val</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>linenum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>failunknown</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set parameter in profile from configuration file. </p>

<p>Definition at line <a class="el" href="app__followme_8c_source.html#l00246">246</a> of file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="app__followme_8c_source.html#l00116">call_followme::callfromprompt</a>, <a class="el" href="app__followme_8c_source.html#l00111">call_followme::context</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="app__followme_8c_source.html#l00110">call_followme::moh</a>, <a class="el" href="app__followme_8c_source.html#l00109">call_followme::name</a>, <a class="el" href="app__followme_8c_source.html#l00115">call_followme::nextindp</a>, <a class="el" href="app__followme_8c_source.html#l00117">call_followme::norecordingprompt</a>, <a class="el" href="app__followme_8c_source.html#l00118">call_followme::optionsprompt</a>, <a class="el" href="app__followme_8c_source.html#l00119">call_followme::plsholdprompt</a>, <a class="el" href="app__followme_8c_source.html#l00121">call_followme::sorryprompt</a>, <a class="el" href="app__followme_8c_source.html#l00120">call_followme::statusprompt</a>, and <a class="el" href="app__followme_8c_source.html#l00114">call_followme::takecall</a>.</p>

<p>Referenced by <a class="el" href="app__followme_8c_source.html#l00917">find_realtime()</a>, and <a class="el" href="app__followme_8c_source.html#l00297">reload_followme()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00247"></a>00247 {
<a name="l00248"></a>00248 
<a name="l00249"></a>00249    <span class="keywordflow">if</span> (!strcasecmp(param, <span class="stringliteral">&quot;musicclass&quot;</span>) || !strcasecmp(param, <span class="stringliteral">&quot;musiconhold&quot;</span>) || !strcasecmp(param, <span class="stringliteral">&quot;music&quot;</span>)) 
<a name="l00250"></a>00250       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(f-&gt;<a class="code" href="structcall__followme.html#ac63620daf5cbc4c0297282362b746909">moh</a>, <a class="code" href="structval.html">val</a>, <span class="keyword">sizeof</span>(f-&gt;<a class="code" href="structcall__followme.html#ac63620daf5cbc4c0297282362b746909">moh</a>));
<a name="l00251"></a>00251    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(param, <span class="stringliteral">&quot;context&quot;</span>)) 
<a name="l00252"></a>00252       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(f-&gt;<a class="code" href="structcall__followme.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <a class="code" href="structval.html">val</a>, <span class="keyword">sizeof</span>(f-&gt;<a class="code" href="structcall__followme.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>));
<a name="l00253"></a>00253    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(param, <span class="stringliteral">&quot;takecall&quot;</span>))
<a name="l00254"></a>00254       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(f-&gt;<a class="code" href="structcall__followme.html#a5e4eb41cdb87c8899c7568985b44310e">takecall</a>, <a class="code" href="structval.html">val</a>, <span class="keyword">sizeof</span>(f-&gt;<a class="code" href="structcall__followme.html#a5e4eb41cdb87c8899c7568985b44310e">takecall</a>));
<a name="l00255"></a>00255    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(param, <span class="stringliteral">&quot;declinecall&quot;</span>))
<a name="l00256"></a>00256       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(f-&gt;<a class="code" href="structcall__followme.html#a9dbb4ee6d178039269f8d6c8bb5b6610">nextindp</a>, <a class="code" href="structval.html">val</a>, <span class="keyword">sizeof</span>(f-&gt;<a class="code" href="structcall__followme.html#a9dbb4ee6d178039269f8d6c8bb5b6610">nextindp</a>));
<a name="l00257"></a>00257    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(param, <span class="stringliteral">&quot;call-from-prompt&quot;</span>) || !strcasecmp(param, <span class="stringliteral">&quot;call_from_prompt&quot;</span>))
<a name="l00258"></a>00258       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(f-&gt;<a class="code" href="structcall__followme.html#a58f00693748f61c394c084fef26c3827">callfromprompt</a>, <a class="code" href="structval.html">val</a>, <span class="keyword">sizeof</span>(f-&gt;<a class="code" href="structcall__followme.html#a58f00693748f61c394c084fef26c3827">callfromprompt</a>));
<a name="l00259"></a>00259    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(param, <span class="stringliteral">&quot;followme-norecording-prompt&quot;</span>) || !strcasecmp(param, <span class="stringliteral">&quot;norecording_prompt&quot;</span>)) 
<a name="l00260"></a>00260       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(f-&gt;<a class="code" href="structcall__followme.html#ad19a8f288abdc0da9c0970a76e535a88">norecordingprompt</a>, <a class="code" href="structval.html">val</a>, <span class="keyword">sizeof</span>(f-&gt;<a class="code" href="structcall__followme.html#ad19a8f288abdc0da9c0970a76e535a88">norecordingprompt</a>));
<a name="l00261"></a>00261    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(param, <span class="stringliteral">&quot;followme-options-prompt&quot;</span>) || !strcasecmp(param, <span class="stringliteral">&quot;options_prompt&quot;</span>)) 
<a name="l00262"></a>00262       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(f-&gt;<a class="code" href="structcall__followme.html#a8cd1221921f88677b4e194ccabb54f23">optionsprompt</a>, <a class="code" href="structval.html">val</a>, <span class="keyword">sizeof</span>(f-&gt;<a class="code" href="structcall__followme.html#a8cd1221921f88677b4e194ccabb54f23">optionsprompt</a>));
<a name="l00263"></a>00263    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(param, <span class="stringliteral">&quot;followme-pls-hold-prompt&quot;</span>) || !strcasecmp(param, <span class="stringliteral">&quot;pls_hold_prompt&quot;</span>))
<a name="l00264"></a>00264       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(f-&gt;<a class="code" href="structcall__followme.html#aa9ef93bdd1331f6a36cfc4b038790bd8">plsholdprompt</a>, <a class="code" href="structval.html">val</a>, <span class="keyword">sizeof</span>(f-&gt;<a class="code" href="structcall__followme.html#aa9ef93bdd1331f6a36cfc4b038790bd8">plsholdprompt</a>));
<a name="l00265"></a>00265    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(param, <span class="stringliteral">&quot;followme-status-prompt&quot;</span>) || !strcasecmp(param, <span class="stringliteral">&quot;status_prompt&quot;</span>)) 
<a name="l00266"></a>00266       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(f-&gt;<a class="code" href="structcall__followme.html#a9dc4e0a4fed22949dd087c179b43dbe9">statusprompt</a>, <a class="code" href="structval.html">val</a>, <span class="keyword">sizeof</span>(f-&gt;<a class="code" href="structcall__followme.html#a9dc4e0a4fed22949dd087c179b43dbe9">statusprompt</a>));
<a name="l00267"></a>00267    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(param, <span class="stringliteral">&quot;followme-sorry-prompt&quot;</span>) || !strcasecmp(param, <span class="stringliteral">&quot;sorry_prompt&quot;</span>)) 
<a name="l00268"></a>00268       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(f-&gt;<a class="code" href="structcall__followme.html#a433b7a39c8c5b0df72622c414d7a8b4c">sorryprompt</a>, <a class="code" href="structval.html">val</a>, <span class="keyword">sizeof</span>(f-&gt;<a class="code" href="structcall__followme.html#a433b7a39c8c5b0df72622c414d7a8b4c">sorryprompt</a>));
<a name="l00269"></a>00269    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (failunknown) {
<a name="l00270"></a>00270       <span class="keywordflow">if</span> (linenum &gt;= 0)
<a name="l00271"></a>00271          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unknown keyword in profile &apos;%s&apos;: %s at line %d of followme.conf\n&quot;</span>, f-&gt;<a class="code" href="structcall__followme.html#a3010cd0d0ed2387e8f00c212787c2746">name</a>, param, linenum);
<a name="l00272"></a>00272       <span class="keywordflow">else</span>
<a name="l00273"></a>00273          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unknown keyword in profile &apos;%s&apos;: %s\n&quot;</span>, f-&gt;<a class="code" href="structcall__followme.html#a3010cd0d0ed2387e8f00c212787c2746">name</a>, param);
<a name="l00274"></a>00274    }
<a name="l00275"></a>00275 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad1982509765f4870f1f63412a53ea668"></a><!-- doxytag: member="app_followme.c::reload" ref="ad1982509765f4870f1f63412a53ea668" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int reload </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__followme_8c_source.html#l01186">1186</a> of file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>

<p>References <a class="el" href="app__followme_8c_source.html#l00297">reload_followme()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01187"></a>01187 {
<a name="l01188"></a>01188    <a class="code" href="app__followme_8c.html#a464451be8c648057316f6e7dc82cee5c" title="Reload followme application module.">reload_followme</a>(1);
<a name="l01189"></a>01189 
<a name="l01190"></a>01190    <span class="keywordflow">return</span> 0;
<a name="l01191"></a>01191 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a464451be8c648057316f6e7dc82cee5c"></a><!-- doxytag: member="app_followme.c::reload_followme" ref="a464451be8c648057316f6e7dc82cee5c" args="(int reload)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int reload_followme </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>reload</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reload followme application module. </p>

<p>Definition at line <a class="el" href="app__followme_8c_source.html#l00297">297</a> of file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>

<p>References <a class="el" href="app__followme_8c_source.html#l00112">call_followme::active</a>, <a class="el" href="app__followme_8c_source.html#l00212">alloc_profile()</a>, <a class="el" href="config_8c_source.html#l00613">ast_category_browse()</a>, <a class="el" href="config_8c_source.html#l00827">ast_config_destroy()</a>, <a class="el" href="config_8h_source.html#l00139">ast_config_load</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="linkedlists_8h_source.html#l00715">AST_LIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="linkedlists_8h_source.html#l00702">AST_RWLIST_INSERT_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="config_8c_source.html#l00411">ast_variable_browse()</a>, <a class="el" href="config_8c_source.html#l00435">ast_variable_retrieve()</a>, <a class="el" href="config_8h_source.html#l00043">CONFIG_FLAG_FILEUNCHANGED</a>, <a class="el" href="config_8h_source.html#l00050">CONFIG_STATUS_FILEINVALID</a>, <a class="el" href="config_8h_source.html#l00049">CONFIG_STATUS_FILEUNCHANGED</a>, <a class="el" href="app__followme_8c_source.html#l00278">create_followme_number()</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="app__followme_8c_source.html#l00189">free_numbers()</a>, <a class="el" href="app__followme_8c_source.html#l00237">init_profile()</a>, <a class="el" href="config_8h_source.html#l00081">ast_variable::lineno</a>, <a class="el" href="app__followme_8c_source.html#l00108">call_followme::lock</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="config_8h_source.html#l00075">ast_variable::name</a>, <a class="el" href="app__followme_8c_source.html#l00109">call_followme::name</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="app__followme_8c_source.html#l00246">profile_set_param()</a>, <a class="el" href="app__followme_8c_source.html#l00101">number::timeout</a>, <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>, and <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>.</p>

<p>Referenced by <a class="el" href="app__followme_8c_source.html#l01178">load_module()</a>, and <a class="el" href="app__followme_8c_source.html#l01186">reload()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00298"></a>00298 {
<a name="l00299"></a>00299    <span class="keyword">struct </span><a class="code" href="structcall__followme.html" title="Data structure for followme scripts.">call_followme</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l00300"></a>00300    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *cfg;
<a name="l00301"></a>00301    <span class="keywordtype">char</span> *cat = NULL, *tmp;
<a name="l00302"></a>00302    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>;
<a name="l00303"></a>00303    <span class="keyword">struct </span><a class="code" href="structnumber.html" title="Number structure.">number</a> *cur, *nm;
<a name="l00304"></a>00304    <span class="keywordtype">char</span> numberstr[90];
<a name="l00305"></a>00305    <span class="keywordtype">int</span> <a class="code" href="structnumber.html#a0eb73e1ac837828209a5b842000fa3b0">timeout</a>;
<a name="l00306"></a>00306    <span class="keywordtype">char</span> *timeoutstr;
<a name="l00307"></a>00307    <span class="keywordtype">int</span> numorder;
<a name="l00308"></a>00308    <span class="keyword">const</span> <span class="keywordtype">char</span> *takecallstr;
<a name="l00309"></a>00309    <span class="keyword">const</span> <span class="keywordtype">char</span> *declinecallstr;
<a name="l00310"></a>00310    <span class="keyword">const</span> <span class="keywordtype">char</span> *tmpstr;
<a name="l00311"></a>00311    <span class="keyword">struct </span><a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> <a class="code" href="app__rpt_8c.html#a1f57f20c1f46890828791a4827fe8752">config_flags</a> = { <a class="code" href="app__followme_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> ? <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26afa887389dc380bbdcffb65fec379f037">CONFIG_FLAG_FILEUNCHANGED</a> : 0 };
<a name="l00312"></a>00312 
<a name="l00313"></a>00313    <span class="keywordflow">if</span> (!(cfg = <a class="code" href="config_8h.html#a0a07ddd6bbcf44485e01c14c96109482">ast_config_load</a>(<span class="stringliteral">&quot;followme.conf&quot;</span>, config_flags))) {
<a name="l00314"></a>00314       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No follow me config file (followme.conf), so no follow me\n&quot;</span>);
<a name="l00315"></a>00315       <span class="keywordflow">return</span> 0;
<a name="l00316"></a>00316    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cfg == <a class="code" href="config_8h.html#a846844eb2c4eb44554445936b3770711">CONFIG_STATUS_FILEUNCHANGED</a>) {
<a name="l00317"></a>00317       <span class="keywordflow">return</span> 0;
<a name="l00318"></a>00318    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cfg == <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>) {
<a name="l00319"></a>00319       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Config file followme.conf is in an invalid format.  Aborting.\n&quot;</span>);
<a name="l00320"></a>00320       <span class="keywordflow">return</span> 0;
<a name="l00321"></a>00321    }
<a name="l00322"></a>00322 
<a name="l00323"></a>00323    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;followmes);
<a name="l00324"></a>00324 
<a name="l00325"></a>00325    <span class="comment">/* Reset Global Var Values */</span>
<a name="l00326"></a>00326    <a class="code" href="app__followme_8c.html#a846427c0fcd8e7f387e43b465f74e810">featuredigittimeout</a> = 5000;
<a name="l00327"></a>00327 
<a name="l00328"></a>00328    <span class="comment">/* Mark all profiles as inactive for the moment */</span>
<a name="l00329"></a>00329    <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;followmes, f, entry) {
<a name="l00330"></a>00330       f-&gt;<a class="code" href="structcall__followme.html#ad89074c5d51acfd1ca5a1d7787d30d37">active</a> = 0;
<a name="l00331"></a>00331    }
<a name="l00332"></a>00332 
<a name="l00333"></a>00333    <a class="code" href="app__followme_8c.html#ac7eb2e0c3a6a5a82caca6194003cb287">featuredigittostr</a> = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;featuredigittimeout&quot;</span>);
<a name="l00334"></a>00334 
<a name="l00335"></a>00335    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="app__followme_8c.html#ac7eb2e0c3a6a5a82caca6194003cb287">featuredigittostr</a>)) {
<a name="l00336"></a>00336       <span class="keywordflow">if</span> (!sscanf(<a class="code" href="app__followme_8c.html#ac7eb2e0c3a6a5a82caca6194003cb287">featuredigittostr</a>, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;<a class="code" href="app__followme_8c.html#a846427c0fcd8e7f387e43b465f74e810">featuredigittimeout</a>))
<a name="l00337"></a>00337          <a class="code" href="app__followme_8c.html#a846427c0fcd8e7f387e43b465f74e810">featuredigittimeout</a> = 5000;
<a name="l00338"></a>00338    }
<a name="l00339"></a>00339 
<a name="l00340"></a>00340    <span class="keywordflow">if</span> ((takecallstr = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;takecall&quot;</span>)) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(takecallstr)) {
<a name="l00341"></a>00341       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="app__followme_8c.html#a5e4eb41cdb87c8899c7568985b44310e">takecall</a>, takecallstr, <span class="keyword">sizeof</span>(<a class="code" href="app__followme_8c.html#a5e4eb41cdb87c8899c7568985b44310e">takecall</a>));
<a name="l00342"></a>00342    }
<a name="l00343"></a>00343 
<a name="l00344"></a>00344    <span class="keywordflow">if</span> ((declinecallstr = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;declinecall&quot;</span>)) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(declinecallstr)) {
<a name="l00345"></a>00345       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="app__followme_8c.html#a9dbb4ee6d178039269f8d6c8bb5b6610">nextindp</a>, declinecallstr, <span class="keyword">sizeof</span>(<a class="code" href="app__followme_8c.html#a9dbb4ee6d178039269f8d6c8bb5b6610">nextindp</a>));
<a name="l00346"></a>00346    }
<a name="l00347"></a>00347 
<a name="l00348"></a>00348    <span class="keywordflow">if</span> ((tmpstr = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;call-from-prompt&quot;</span>)) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(tmpstr)) {
<a name="l00349"></a>00349       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="app__followme_8c.html#a58f00693748f61c394c084fef26c3827">callfromprompt</a>, tmpstr, <span class="keyword">sizeof</span>(<a class="code" href="app__followme_8c.html#a58f00693748f61c394c084fef26c3827">callfromprompt</a>));
<a name="l00350"></a>00350    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((tmpstr = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;call_from_prompt&quot;</span>)) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(tmpstr)) {
<a name="l00351"></a>00351       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="app__followme_8c.html#a58f00693748f61c394c084fef26c3827">callfromprompt</a>, tmpstr, <span class="keyword">sizeof</span>(<a class="code" href="app__followme_8c.html#a58f00693748f61c394c084fef26c3827">callfromprompt</a>));
<a name="l00352"></a>00352    }
<a name="l00353"></a>00353 
<a name="l00354"></a>00354    <span class="keywordflow">if</span> ((tmpstr = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;norecording-prompt&quot;</span>)) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(tmpstr)) {
<a name="l00355"></a>00355       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="app__followme_8c.html#ad19a8f288abdc0da9c0970a76e535a88">norecordingprompt</a>, tmpstr, <span class="keyword">sizeof</span>(<a class="code" href="app__followme_8c.html#ad19a8f288abdc0da9c0970a76e535a88">norecordingprompt</a>));
<a name="l00356"></a>00356    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((tmpstr = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;norecording_prompt&quot;</span>)) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(tmpstr)) {
<a name="l00357"></a>00357       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="app__followme_8c.html#a58f00693748f61c394c084fef26c3827">callfromprompt</a>, tmpstr, <span class="keyword">sizeof</span>(<a class="code" href="app__followme_8c.html#a58f00693748f61c394c084fef26c3827">callfromprompt</a>));
<a name="l00358"></a>00358    }
<a name="l00359"></a>00359 
<a name="l00360"></a>00360 
<a name="l00361"></a>00361    <span class="keywordflow">if</span> ((tmpstr = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;options-prompt&quot;</span>)) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(tmpstr)) {
<a name="l00362"></a>00362       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="app__followme_8c.html#a8cd1221921f88677b4e194ccabb54f23">optionsprompt</a>, tmpstr, <span class="keyword">sizeof</span>(<a class="code" href="app__followme_8c.html#a8cd1221921f88677b4e194ccabb54f23">optionsprompt</a>));
<a name="l00363"></a>00363    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((tmpstr = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;options_prompt&quot;</span>)) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(tmpstr)) {
<a name="l00364"></a>00364       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="app__followme_8c.html#a8cd1221921f88677b4e194ccabb54f23">optionsprompt</a>, tmpstr, <span class="keyword">sizeof</span>(<a class="code" href="app__followme_8c.html#a8cd1221921f88677b4e194ccabb54f23">optionsprompt</a>));
<a name="l00365"></a>00365    }
<a name="l00366"></a>00366 
<a name="l00367"></a>00367    <span class="keywordflow">if</span> ((tmpstr = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;pls-hold-prompt&quot;</span>)) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(tmpstr)) {
<a name="l00368"></a>00368       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="app__followme_8c.html#a8cd1221921f88677b4e194ccabb54f23">optionsprompt</a>, tmpstr, <span class="keyword">sizeof</span>(<a class="code" href="app__followme_8c.html#a8cd1221921f88677b4e194ccabb54f23">optionsprompt</a>));
<a name="l00369"></a>00369    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((tmpstr = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;pls_hold_prompt&quot;</span>)) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(tmpstr)) {
<a name="l00370"></a>00370       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="app__followme_8c.html#a8cd1221921f88677b4e194ccabb54f23">optionsprompt</a>, tmpstr, <span class="keyword">sizeof</span>(<a class="code" href="app__followme_8c.html#a8cd1221921f88677b4e194ccabb54f23">optionsprompt</a>));
<a name="l00371"></a>00371    }
<a name="l00372"></a>00372 
<a name="l00373"></a>00373    <span class="keywordflow">if</span> ((tmpstr = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;status-prompt&quot;</span>)) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(tmpstr)) {
<a name="l00374"></a>00374       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="app__followme_8c.html#a8cd1221921f88677b4e194ccabb54f23">optionsprompt</a>, tmpstr, <span class="keyword">sizeof</span>(<a class="code" href="app__followme_8c.html#a8cd1221921f88677b4e194ccabb54f23">optionsprompt</a>));
<a name="l00375"></a>00375    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((tmpstr = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;status_prompt&quot;</span>)) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(tmpstr)) {
<a name="l00376"></a>00376       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="app__followme_8c.html#a8cd1221921f88677b4e194ccabb54f23">optionsprompt</a>, tmpstr, <span class="keyword">sizeof</span>(<a class="code" href="app__followme_8c.html#a8cd1221921f88677b4e194ccabb54f23">optionsprompt</a>));
<a name="l00377"></a>00377    }
<a name="l00378"></a>00378 
<a name="l00379"></a>00379    <span class="keywordflow">if</span> ((tmpstr = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;sorry-prompt&quot;</span>)) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(tmpstr)) {
<a name="l00380"></a>00380       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="app__followme_8c.html#a8cd1221921f88677b4e194ccabb54f23">optionsprompt</a>, tmpstr, <span class="keyword">sizeof</span>(<a class="code" href="app__followme_8c.html#a8cd1221921f88677b4e194ccabb54f23">optionsprompt</a>));
<a name="l00381"></a>00381    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((tmpstr = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;sorry_prompt&quot;</span>)) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(tmpstr)) {
<a name="l00382"></a>00382       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="app__followme_8c.html#a8cd1221921f88677b4e194ccabb54f23">optionsprompt</a>, tmpstr, <span class="keyword">sizeof</span>(<a class="code" href="app__followme_8c.html#a8cd1221921f88677b4e194ccabb54f23">optionsprompt</a>));
<a name="l00383"></a>00383    }
<a name="l00384"></a>00384 
<a name="l00385"></a>00385    <span class="comment">/* Chug through config file */</span>
<a name="l00386"></a>00386    <span class="keywordflow">while</span> ((cat = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(cfg, cat))) {
<a name="l00387"></a>00387       <span class="keywordtype">int</span> <span class="keyword">new</span> = 0;
<a name="l00388"></a>00388 
<a name="l00389"></a>00389       <span class="keywordflow">if</span> (!strcasecmp(cat, <span class="stringliteral">&quot;general&quot;</span>))
<a name="l00390"></a>00390          <span class="keywordflow">continue</span>;
<a name="l00391"></a>00391 
<a name="l00392"></a>00392       <span class="comment">/* Look for an existing one */</span>
<a name="l00393"></a>00393       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;followmes, f, entry) {
<a name="l00394"></a>00394          <span class="keywordflow">if</span> (!strcasecmp(f-&gt;<a class="code" href="structcall__followme.html#a3010cd0d0ed2387e8f00c212787c2746">name</a>, cat))
<a name="l00395"></a>00395             <span class="keywordflow">break</span>;
<a name="l00396"></a>00396       }
<a name="l00397"></a>00397 
<a name="l00398"></a>00398       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;New profile %s.\n&quot;</span>, cat);
<a name="l00399"></a>00399 
<a name="l00400"></a>00400       <span class="keywordflow">if</span> (!f) {
<a name="l00401"></a>00401          <span class="comment">/* Make one then */</span>
<a name="l00402"></a>00402          f = <a class="code" href="app__followme_8c.html#ace16df1bb73fc3611a7b1d0b2bf77fd3" title="Allocate and initialize followme profile.">alloc_profile</a>(cat);
<a name="l00403"></a>00403          <span class="keyword">new</span> = 1;
<a name="l00404"></a>00404       }
<a name="l00405"></a>00405 
<a name="l00406"></a>00406       <span class="comment">/* Totally fail if we fail to find/create an entry */</span>
<a name="l00407"></a>00407       <span class="keywordflow">if</span> (!f)
<a name="l00408"></a>00408          <span class="keywordflow">continue</span>;
<a name="l00409"></a>00409 
<a name="l00410"></a>00410       <span class="keywordflow">if</span> (!<span class="keyword">new</span>)
<a name="l00411"></a>00411          <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;f-&gt;<a class="code" href="structcall__followme.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00412"></a>00412       <span class="comment">/* Re-initialize the profile */</span>
<a name="l00413"></a>00413       <a class="code" href="app__followme_8c.html#aa56fb5eca455d8b50b1247a0b8c04701">init_profile</a>(f);
<a name="l00414"></a>00414       <a class="code" href="app__followme_8c.html#afefd489e0ca01820b7054d61cd2d5a73">free_numbers</a>(f);
<a name="l00415"></a>00415       var = <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(cfg, cat);
<a name="l00416"></a>00416       <span class="keywordflow">while</span> (var) {
<a name="l00417"></a>00417          <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;number&quot;</span>)) {
<a name="l00418"></a>00418             <span class="keywordtype">int</span> idx = 0;
<a name="l00419"></a>00419 
<a name="l00420"></a>00420             <span class="comment">/* Add a new number */</span>
<a name="l00421"></a>00421             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(numberstr, var-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(numberstr));
<a name="l00422"></a>00422             <span class="keywordflow">if</span> ((tmp = strchr(numberstr, <span class="charliteral">&apos;,&apos;</span>))) {
<a name="l00423"></a>00423                *tmp++ = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00424"></a>00424                timeoutstr = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(tmp);
<a name="l00425"></a>00425                <span class="keywordflow">if</span> ((tmp = strchr(timeoutstr, <span class="charliteral">&apos;,&apos;</span>))) {
<a name="l00426"></a>00426                   *tmp++ = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00427"></a>00427                   numorder = atoi(tmp);
<a name="l00428"></a>00428                   <span class="keywordflow">if</span> (numorder &lt; 0)
<a name="l00429"></a>00429                      numorder = 0;
<a name="l00430"></a>00430                } <span class="keywordflow">else</span> 
<a name="l00431"></a>00431                   numorder = 0;
<a name="l00432"></a>00432                timeout = atoi(timeoutstr);
<a name="l00433"></a>00433                <span class="keywordflow">if</span> (timeout &lt; 0) 
<a name="l00434"></a>00434                   timeout = 25;
<a name="l00435"></a>00435             } <span class="keywordflow">else</span> {
<a name="l00436"></a>00436                timeout = 25;
<a name="l00437"></a>00437                numorder = 0;
<a name="l00438"></a>00438             }
<a name="l00439"></a>00439 
<a name="l00440"></a>00440             <span class="keywordflow">if</span> (!numorder) {
<a name="l00441"></a>00441                idx = 1;
<a name="l00442"></a>00442                <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;f-&gt;numbers, nm, entry) 
<a name="l00443"></a>00443                   idx++;
<a name="l00444"></a>00444                numorder = idx;
<a name="l00445"></a>00445             }
<a name="l00446"></a>00446             cur = <a class="code" href="app__followme_8c.html#a6809b71b4d445758dd9471de9d995588" title="Add a new number.">create_followme_number</a>(numberstr, timeout, numorder);
<a name="l00447"></a>00447             <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;f-&gt;numbers, cur, entry);
<a name="l00448"></a>00448          } else {
<a name="l00449"></a>00449             <a class="code" href="app__followme_8c.html#a3935b36cf23add0f3e42ad55e506f913" title="Set parameter in profile from configuration file.">profile_set_param</a>(f, var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, var-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, var-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>, 1);
<a name="l00450"></a>00450             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;Logging parameter %s with value %s from lineno %d\n&quot;</span>, var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, var-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, var-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l00451"></a>00451          }
<a name="l00452"></a>00452          var = var-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l00453"></a>00453       } <span class="comment">/* End while(var) loop */</span>
<a name="l00454"></a>00454 
<a name="l00455"></a>00455       <span class="keywordflow">if</span> (!<span class="keyword">new</span>) 
<a name="l00456"></a>00456          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;f-&gt;<a class="code" href="structcall__followme.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00457"></a>00457       <span class="keywordflow">else</span>
<a name="l00458"></a>00458          <a class="code" href="linkedlists_8h.html#aacc5f6b7c25e361d11d40137fd55a8e8">AST_RWLIST_INSERT_HEAD</a>(&amp;followmes, f, entry);
<a name="l00459"></a>00459    }
<a name="l00460"></a>00460 
<a name="l00461"></a>00461    <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(cfg);
<a name="l00462"></a>00462 
<a name="l00463"></a>00463    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;followmes);
<a name="l00464"></a>00464 
<a name="l00465"></a>00465    <span class="keywordflow">return</span> 1;
<a name="l00466"></a>00466 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad09fa931f468002152a3cc2d5ce25eae"></a><!-- doxytag: member="app_followme.c::unload_module" ref="ad09fa931f468002152a3cc2d5ce25eae" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int unload_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__followme_8c_source.html#l01160">1160</a> of file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="linkedlists_8h_source.html#l00828">AST_RWLIST_REMOVE_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="pbx_8c_source.html#l06403">ast_unregister_application()</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, and <a class="el" href="app__followme_8c_source.html#l00189">free_numbers()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01161"></a>01161 {
<a name="l01162"></a>01162    <span class="keyword">struct </span><a class="code" href="structcall__followme.html" title="Data structure for followme scripts.">call_followme</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l01163"></a>01163 
<a name="l01164"></a>01164    <a class="code" href="module_8h.html#ad2ca15621101154f29748cf1dac3c3cf" title="Unregister an application.">ast_unregister_application</a>(<a class="code" href="app__adsiprog_8c.html#a9e5f57131367eff409b9e0bd7b31aa1a">app</a>);
<a name="l01165"></a>01165 
<a name="l01166"></a>01166    <span class="comment">/* Free Memory. Yeah! I&apos;m free! */</span>
<a name="l01167"></a>01167    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;followmes);
<a name="l01168"></a>01168    <span class="keywordflow">while</span> ((f = <a class="code" href="linkedlists_8h.html#a3d3aa4fb3b4ba38ad8d6d255d97e037c">AST_RWLIST_REMOVE_HEAD</a>(&amp;followmes, entry))) {
<a name="l01169"></a>01169       <a class="code" href="app__followme_8c.html#afefd489e0ca01820b7054d61cd2d5a73">free_numbers</a>(f);
<a name="l01170"></a>01170       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(f);
<a name="l01171"></a>01171    }
<a name="l01172"></a>01172 
<a name="l01173"></a>01173    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;followmes);
<a name="l01174"></a>01174 
<a name="l01175"></a>01175    <span class="keywordflow">return</span> 0;
<a name="l01176"></a>01176 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac4c2cfb4933d0035ed53143d4dcce457"></a><!-- doxytag: member="app_followme.c::wait_for_winner" ref="ac4c2cfb4933d0035ed53143d4dcce457" args="(struct findme_user_listptr *findme_user_list, struct number *nm, struct ast_channel *caller, char *namerecloc, int *status, struct fm_args *tpargs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__channel.html">ast_channel</a>* wait_for_winner </td>
          <td>(</td>
          <td class="paramtype">struct findme_user_listptr *&nbsp;</td>
          <td class="paramname"> <em>findme_user_list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structnumber.html">number</a> *&nbsp;</td>
          <td class="paramname"> <em>nm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>caller</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>namerecloc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>status</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structfm__args.html">fm_args</a> *&nbsp;</td>
          <td class="paramname"> <em>tpargs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__followme_8c_source.html#l00509">509</a> of file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>

<p>References <a class="el" href="causes_8h_source.html#l00102">AST_CAUSE_NORMAL_CLEARING</a>, <a class="el" href="frame_8h_source.html#l00301">AST_CONTROL_ANSWER</a>, <a class="el" href="frame_8h_source.html#l00302">AST_CONTROL_BUSY</a>, <a class="el" href="frame_8h_source.html#l00305">AST_CONTROL_CONGESTION</a>, <a class="el" href="frame_8h_source.html#l00306">AST_CONTROL_FLASH</a>, <a class="el" href="frame_8h_source.html#l00298">AST_CONTROL_HANGUP</a>, <a class="el" href="frame_8h_source.html#l00313">AST_CONTROL_HOLD</a>, <a class="el" href="frame_8h_source.html#l00304">AST_CONTROL_OFFHOOK</a>, <a class="el" href="frame_8h_source.html#l00312">AST_CONTROL_PROCEEDING</a>, <a class="el" href="frame_8h_source.html#l00311">AST_CONTROL_PROGRESS</a>, <a class="el" href="frame_8h_source.html#l00300">AST_CONTROL_RINGING</a>, <a class="el" href="frame_8h_source.html#l00317">AST_CONTROL_SRCUPDATE</a>, <a class="el" href="frame_8h_source.html#l00314">AST_CONTROL_UNHOLD</a>, <a class="el" href="frame_8h_source.html#l00315">AST_CONTROL_VIDUPDATE</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8h_source.html#l00105">AST_FRAME_CONTROL</a>, <a class="el" href="frame_8h_source.html#l00124">AST_FRAME_DTMF</a>, <a class="el" href="frame_8h_source.html#l00462">ast_frfree</a>, <a class="el" href="channel_8c_source.html#l01690">ast_hangup()</a>, <a class="el" href="linkedlists_8h_source.html#l00449">AST_LIST_EMPTY</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8c_source.html#l03100">ast_read()</a>, <a class="el" href="sched_8c_source.html#l00581">ast_sched_runq()</a>, <a class="el" href="sched_8c_source.html#l00327">ast_sched_wait()</a>, <a class="el" href="file_8c_source.html#l00122">ast_stopstream()</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="file_8c_source.html#l00943">ast_streamfile()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="channel_8c_source.html#l02384">ast_waitfor_n()</a>, <a class="el" href="app__followme_8c_source.html#l00497">clear_calling_tree()</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="app__followme_8c_source.html#l00154">findme_user::digts</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="channel_8h_source.html#l00479">ast_channel::hangupcause</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="app__followme_8c_source.html#l00149">findme_user::ochan</a>, <a class="el" href="channel_8h_source.html#l00413">ast_channel::sched</a>, <a class="el" href="app__followme_8c_source.html#l00150">findme_user::state</a>, <a class="el" href="channel_8h_source.html#l00414">ast_channel::stream</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, <a class="el" href="app__followme_8c_source.html#l00101">number::timeout</a>, <a class="el" href="structast__channel.html#a66e8b9811d596825d60c6a58e0b307a4">ast_channel::timingfunc</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::uint32</a>, <a class="el" href="app__followme_8c_source.html#l00152">findme_user::yn</a>, and <a class="el" href="app__followme_8c_source.html#l00153">findme_user::ynidx</a>.</p>

<p>Referenced by <a class="el" href="app__followme_8c_source.html#l00777">findmeexec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00510"></a>00510 {
<a name="l00511"></a>00511    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *watchers[256];
<a name="l00512"></a>00512    <span class="keywordtype">int</span> pos;
<a name="l00513"></a>00513    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *winner;
<a name="l00514"></a>00514    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l00515"></a>00515    <span class="keywordtype">int</span> ctstatus = 0;
<a name="l00516"></a>00516    <span class="keywordtype">int</span> dg;
<a name="l00517"></a>00517    <span class="keyword">struct </span><a class="code" href="structfindme__user.html">findme_user</a> *tmpuser;
<a name="l00518"></a>00518    <span class="keywordtype">int</span> to = 0;
<a name="l00519"></a>00519    <span class="keywordtype">int</span> livechannels = 0;
<a name="l00520"></a>00520    <span class="keywordtype">int</span> tmpto;
<a name="l00521"></a>00521    <span class="keywordtype">long</span> totalwait = 0, wtd = 0, towas = 0;
<a name="l00522"></a>00522    <span class="keywordtype">char</span> *callfromname;
<a name="l00523"></a>00523    <span class="keywordtype">char</span> *pressbuttonname;
<a name="l00524"></a>00524 
<a name="l00525"></a>00525    <span class="comment">/* ------------ wait_for_winner_channel start --------------- */</span> 
<a name="l00526"></a>00526 
<a name="l00527"></a>00527    callfromname = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(tpargs-&gt;callfromprompt);
<a name="l00528"></a>00528    pressbuttonname = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(tpargs-&gt;optionsprompt);
<a name="l00529"></a>00529 
<a name="l00530"></a>00530    <span class="keywordflow">if</span> (<a class="code" href="linkedlists_8h.html#a4a1884cde93e53bef32ca85c194a1d05" title="Checks whether the specified list contains any entries.">AST_LIST_EMPTY</a>(findme_user_list)) {
<a name="l00531"></a>00531       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;couldn&apos;t reach at this number.\n&quot;</span>);
<a name="l00532"></a>00532       <span class="keywordflow">return</span> NULL;
<a name="l00533"></a>00533    }
<a name="l00534"></a>00534 
<a name="l00535"></a>00535    <span class="keywordflow">if</span> (!caller) {
<a name="l00536"></a>00536       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Original caller hungup. Cleanup.\n&quot;</span>);
<a name="l00537"></a>00537       <a class="code" href="app__followme_8c.html#a5aeb2881b16ba0ebbe15d9e4cae4f676">clear_calling_tree</a>(findme_user_list);
<a name="l00538"></a>00538       <span class="keywordflow">return</span> NULL;
<a name="l00539"></a>00539    }
<a name="l00540"></a>00540 
<a name="l00541"></a>00541    totalwait = nm-&gt;<a class="code" href="structnumber.html#a0eb73e1ac837828209a5b842000fa3b0">timeout</a> * 1000;
<a name="l00542"></a>00542 
<a name="l00543"></a>00543    <span class="keywordflow">while</span> (!ctstatus) {
<a name="l00544"></a>00544       to = 1000;
<a name="l00545"></a>00545       pos = 1; 
<a name="l00546"></a>00546       livechannels = 0;
<a name="l00547"></a>00547       watchers[0] = caller;
<a name="l00548"></a>00548 
<a name="l00549"></a>00549       dg = 0;
<a name="l00550"></a>00550       winner = NULL;
<a name="l00551"></a>00551       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(findme_user_list, tmpuser, entry) {
<a name="l00552"></a>00552          <span class="keywordflow">if</span> (tmpuser-&gt;<a class="code" href="structfindme__user.html#a89f234133d3efe315836311cbf21c64b">state</a> &gt;= 0 &amp;&amp; tmpuser-&gt;<a class="code" href="structfindme__user.html#a3cd62ecaf93dc424694f2f347e02a35e">ochan</a>) {
<a name="l00553"></a>00553             <span class="keywordflow">if</span> (tmpuser-&gt;<a class="code" href="structfindme__user.html#a89f234133d3efe315836311cbf21c64b">state</a> == 3) 
<a name="l00554"></a>00554                tmpuser-&gt;<a class="code" href="structfindme__user.html#ad1b201c211aa1cda8b088feaddd55e16">digts</a> += (towas - wtd);
<a name="l00555"></a>00555             <span class="keywordflow">if</span> (tmpuser-&gt;<a class="code" href="structfindme__user.html#ad1b201c211aa1cda8b088feaddd55e16">digts</a> &amp;&amp; (tmpuser-&gt;<a class="code" href="structfindme__user.html#ad1b201c211aa1cda8b088feaddd55e16">digts</a> &gt; <a class="code" href="app__followme_8c.html#a846427c0fcd8e7f387e43b465f74e810">featuredigittimeout</a>)) {
<a name="l00556"></a>00556                <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;We&apos;ve been waiting for digits longer than we should have.\n&quot;</span>);
<a name="l00557"></a>00557                <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(namerecloc)) {
<a name="l00558"></a>00558                   tmpuser-&gt;<a class="code" href="structfindme__user.html#a89f234133d3efe315836311cbf21c64b">state</a> = 1;
<a name="l00559"></a>00559                   tmpuser-&gt;<a class="code" href="structfindme__user.html#ad1b201c211aa1cda8b088feaddd55e16">digts</a> = 0;
<a name="l00560"></a>00560                   <span class="keywordflow">if</span> (!<a class="code" href="file_8h.html#a67c7e271b4ca70aca6d48fd48d121857" title="Streams a file.">ast_streamfile</a>(tmpuser-&gt;<a class="code" href="structfindme__user.html#a3cd62ecaf93dc424694f2f347e02a35e">ochan</a>, callfromname, tmpuser-&gt;<a class="code" href="structfindme__user.html#a3cd62ecaf93dc424694f2f347e02a35e">ochan</a>-&gt;language)) {
<a name="l00561"></a>00561                      <a class="code" href="sched_8h.html#a2867b39106061847a8508bf49e38f420" title="Runs the queue.">ast_sched_runq</a>(tmpuser-&gt;<a class="code" href="structfindme__user.html#a3cd62ecaf93dc424694f2f347e02a35e">ochan</a>-&gt;<a class="code" href="structast__channel.html#aea6233539fc73fc5303bf7525ec27e73">sched</a>);
<a name="l00562"></a>00562                   } <span class="keywordflow">else</span> {
<a name="l00563"></a>00563                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to playback %s.\n&quot;</span>, callfromname);
<a name="l00564"></a>00564                      <span class="keywordflow">return</span> NULL;
<a name="l00565"></a>00565                   }
<a name="l00566"></a>00566                } <span class="keywordflow">else</span> {
<a name="l00567"></a>00567                   tmpuser-&gt;<a class="code" href="structfindme__user.html#a89f234133d3efe315836311cbf21c64b">state</a> = 2;
<a name="l00568"></a>00568                   tmpuser-&gt;<a class="code" href="structfindme__user.html#ad1b201c211aa1cda8b088feaddd55e16">digts</a> = 0;
<a name="l00569"></a>00569                   <span class="keywordflow">if</span> (!<a class="code" href="file_8h.html#a67c7e271b4ca70aca6d48fd48d121857" title="Streams a file.">ast_streamfile</a>(tmpuser-&gt;<a class="code" href="structfindme__user.html#a3cd62ecaf93dc424694f2f347e02a35e">ochan</a>, tpargs-&gt;norecordingprompt, tmpuser-&gt;<a class="code" href="structfindme__user.html#a3cd62ecaf93dc424694f2f347e02a35e">ochan</a>-&gt;language))
<a name="l00570"></a>00570                      <a class="code" href="sched_8h.html#a2867b39106061847a8508bf49e38f420" title="Runs the queue.">ast_sched_runq</a>(tmpuser-&gt;<a class="code" href="structfindme__user.html#a3cd62ecaf93dc424694f2f347e02a35e">ochan</a>-&gt;<a class="code" href="structast__channel.html#aea6233539fc73fc5303bf7525ec27e73">sched</a>);
<a name="l00571"></a>00571                   <span class="keywordflow">else</span> {
<a name="l00572"></a>00572                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to playback %s.\n&quot;</span>, tpargs-&gt;norecordingprompt);
<a name="l00573"></a>00573                      <span class="keywordflow">return</span> NULL;
<a name="l00574"></a>00574                   }
<a name="l00575"></a>00575                }
<a name="l00576"></a>00576             }
<a name="l00577"></a>00577             <span class="keywordflow">if</span> (tmpuser-&gt;<a class="code" href="structfindme__user.html#a3cd62ecaf93dc424694f2f347e02a35e">ochan</a>-&gt;<a class="code" href="structast__channel.html#a016ccfa2a88444ffde0ad0168a0f231d">stream</a>) {
<a name="l00578"></a>00578                <a class="code" href="sched_8h.html#a2867b39106061847a8508bf49e38f420" title="Runs the queue.">ast_sched_runq</a>(tmpuser-&gt;<a class="code" href="structfindme__user.html#a3cd62ecaf93dc424694f2f347e02a35e">ochan</a>-&gt;<a class="code" href="structast__channel.html#aea6233539fc73fc5303bf7525ec27e73">sched</a>);
<a name="l00579"></a>00579                tmpto = <a class="code" href="sched_8h.html#a64797d66b6051095debfcdb7f790e605" title="Determines number of seconds until the next outstanding event to take place Determine...">ast_sched_wait</a>(tmpuser-&gt;<a class="code" href="structfindme__user.html#a3cd62ecaf93dc424694f2f347e02a35e">ochan</a>-&gt;<a class="code" href="structast__channel.html#aea6233539fc73fc5303bf7525ec27e73">sched</a>);
<a name="l00580"></a>00580                <span class="keywordflow">if</span> (tmpto &gt; 0 &amp;&amp; tmpto &lt; to)
<a name="l00581"></a>00581                   to = tmpto;
<a name="l00582"></a>00582                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tmpto &lt; 0 &amp;&amp; !tmpuser-&gt;<a class="code" href="structfindme__user.html#a3cd62ecaf93dc424694f2f347e02a35e">ochan</a>-&gt;<a class="code" href="structast__channel.html#a66e8b9811d596825d60c6a58e0b307a4">timingfunc</a>) {
<a name="l00583"></a>00583                   <a class="code" href="file_8h.html#a3092bf11d4bba66f646562759608b1bc" title="Stops a stream.">ast_stopstream</a>(tmpuser-&gt;<a class="code" href="structfindme__user.html#a3cd62ecaf93dc424694f2f347e02a35e">ochan</a>);
<a name="l00584"></a>00584                   <span class="keywordflow">if</span> (tmpuser-&gt;<a class="code" href="structfindme__user.html#a89f234133d3efe315836311cbf21c64b">state</a> == 1) {
<a name="l00585"></a>00585                      <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Playback of the call-from file appears to be done.\n&quot;</span>);
<a name="l00586"></a>00586                      <span class="keywordflow">if</span> (!<a class="code" href="file_8h.html#a67c7e271b4ca70aca6d48fd48d121857" title="Streams a file.">ast_streamfile</a>(tmpuser-&gt;<a class="code" href="structfindme__user.html#a3cd62ecaf93dc424694f2f347e02a35e">ochan</a>, namerecloc, tmpuser-&gt;<a class="code" href="structfindme__user.html#a3cd62ecaf93dc424694f2f347e02a35e">ochan</a>-&gt;language)) {
<a name="l00587"></a>00587                         tmpuser-&gt;<a class="code" href="structfindme__user.html#a89f234133d3efe315836311cbf21c64b">state</a> = 2;
<a name="l00588"></a>00588                      } <span class="keywordflow">else</span> {
<a name="l00589"></a>00589                         <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Unable to playback %s. Maybe the caller didn&apos;t record their name?\n&quot;</span>, namerecloc);
<a name="l00590"></a>00590                         memset(tmpuser-&gt;<a class="code" href="structfindme__user.html#a33ecf76cbe2370bec3b0abef99e75519">yn</a>, 0, <span class="keyword">sizeof</span>(tmpuser-&gt;<a class="code" href="structfindme__user.html#a33ecf76cbe2370bec3b0abef99e75519">yn</a>));
<a name="l00591"></a>00591                         tmpuser-&gt;<a class="code" href="structfindme__user.html#a2d81c86af2299006095fb3b8691e456a">ynidx</a> = 0;
<a name="l00592"></a>00592                         <span class="keywordflow">if</span> (!<a class="code" href="file_8h.html#a67c7e271b4ca70aca6d48fd48d121857" title="Streams a file.">ast_streamfile</a>(tmpuser-&gt;<a class="code" href="structfindme__user.html#a3cd62ecaf93dc424694f2f347e02a35e">ochan</a>, pressbuttonname, tmpuser-&gt;<a class="code" href="structfindme__user.html#a3cd62ecaf93dc424694f2f347e02a35e">ochan</a>-&gt;language))
<a name="l00593"></a>00593                            tmpuser-&gt;<a class="code" href="structfindme__user.html#a89f234133d3efe315836311cbf21c64b">state</a> = 3;
<a name="l00594"></a>00594                         <span class="keywordflow">else</span> {
<a name="l00595"></a>00595                            <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to playback %s.\n&quot;</span>, pressbuttonname);
<a name="l00596"></a>00596                            <span class="keywordflow">return</span> NULL;
<a name="l00597"></a>00597                         } 
<a name="l00598"></a>00598                      }
<a name="l00599"></a>00599                   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tmpuser-&gt;<a class="code" href="structfindme__user.html#a89f234133d3efe315836311cbf21c64b">state</a> == 2) {
<a name="l00600"></a>00600                      <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Playback of name file appears to be done.\n&quot;</span>);
<a name="l00601"></a>00601                      memset(tmpuser-&gt;<a class="code" href="structfindme__user.html#a33ecf76cbe2370bec3b0abef99e75519">yn</a>, 0, <span class="keyword">sizeof</span>(tmpuser-&gt;<a class="code" href="structfindme__user.html#a33ecf76cbe2370bec3b0abef99e75519">yn</a>));
<a name="l00602"></a>00602                      tmpuser-&gt;<a class="code" href="structfindme__user.html#a2d81c86af2299006095fb3b8691e456a">ynidx</a> = 0;
<a name="l00603"></a>00603                      <span class="keywordflow">if</span> (!<a class="code" href="file_8h.html#a67c7e271b4ca70aca6d48fd48d121857" title="Streams a file.">ast_streamfile</a>(tmpuser-&gt;<a class="code" href="structfindme__user.html#a3cd62ecaf93dc424694f2f347e02a35e">ochan</a>, pressbuttonname, tmpuser-&gt;<a class="code" href="structfindme__user.html#a3cd62ecaf93dc424694f2f347e02a35e">ochan</a>-&gt;language)) {
<a name="l00604"></a>00604                         tmpuser-&gt;<a class="code" href="structfindme__user.html#a89f234133d3efe315836311cbf21c64b">state</a> = 3;
<a name="l00605"></a>00605                      } <span class="keywordflow">else</span> {
<a name="l00606"></a>00606                         <span class="keywordflow">return</span> NULL;
<a name="l00607"></a>00607                      } 
<a name="l00608"></a>00608                   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tmpuser-&gt;<a class="code" href="structfindme__user.html#a89f234133d3efe315836311cbf21c64b">state</a> == 3) {
<a name="l00609"></a>00609                      <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Playback of the next step file appears to be done.\n&quot;</span>);
<a name="l00610"></a>00610                      tmpuser-&gt;<a class="code" href="structfindme__user.html#ad1b201c211aa1cda8b088feaddd55e16">digts</a> = 0;
<a name="l00611"></a>00611                   }
<a name="l00612"></a>00612                }
<a name="l00613"></a>00613             }
<a name="l00614"></a>00614             watchers[pos++] = tmpuser-&gt;<a class="code" href="structfindme__user.html#a3cd62ecaf93dc424694f2f347e02a35e">ochan</a>;
<a name="l00615"></a>00615             livechannels++;
<a name="l00616"></a>00616          }
<a name="l00617"></a>00617       }
<a name="l00618"></a>00618 
<a name="l00619"></a>00619       tmpto = to;
<a name="l00620"></a>00620       <span class="keywordflow">if</span> (to &lt; 0) {
<a name="l00621"></a>00621          to = 1000;
<a name="l00622"></a>00622          tmpto = 1000;
<a name="l00623"></a>00623       }
<a name="l00624"></a>00624       towas = to;
<a name="l00625"></a>00625       winner = <a class="code" href="channel_8h.html#aec8ce59b78afbd3651f3de011f13290a" title="Waits for input on a group of channels Wait for input on an array of channels for...">ast_waitfor_n</a>(watchers, pos, &amp;to);
<a name="l00626"></a>00626       tmpto -= to;
<a name="l00627"></a>00627       totalwait -= tmpto;
<a name="l00628"></a>00628       wtd = to;
<a name="l00629"></a>00629       <span class="keywordflow">if</span> (totalwait &lt;= 0) {
<a name="l00630"></a>00630          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;We&apos;ve hit our timeout for this step. Drop everyone and move on to the next one. %ld\n&quot;</span>, totalwait);
<a name="l00631"></a>00631          <a class="code" href="app__followme_8c.html#a5aeb2881b16ba0ebbe15d9e4cae4f676">clear_calling_tree</a>(findme_user_list);
<a name="l00632"></a>00632          <span class="keywordflow">return</span> NULL;
<a name="l00633"></a>00633       }
<a name="l00634"></a>00634       <span class="keywordflow">if</span> (winner) {
<a name="l00635"></a>00635          <span class="comment">/* Need to find out which channel this is */</span>
<a name="l00636"></a>00636          dg = 0;
<a name="l00637"></a>00637          <span class="keywordflow">while</span> ((winner != watchers[dg]) &amp;&amp; (dg &lt; 256))
<a name="l00638"></a>00638             dg++;
<a name="l00639"></a>00639          <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(findme_user_list, tmpuser, entry)
<a name="l00640"></a>00640             if (tmpuser-&gt;<a class="code" href="structfindme__user.html#a3cd62ecaf93dc424694f2f347e02a35e">ochan</a> == winner)
<a name="l00641"></a>00641                break;
<a name="l00642"></a>00642          f = <a class="code" href="channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1" title="Reads a frame.">ast_read</a>(winner);
<a name="l00643"></a>00643          if (f) {
<a name="l00644"></a>00644             <span class="keywordflow">if</span> (f-&gt;frametype == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>) {
<a name="l00645"></a>00645                <span class="keywordflow">switch</span>(f-&gt;subclass) {
<a name="l00646"></a>00646                <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa7dac1c1896ab418c2ff351aae707fba">AST_CONTROL_HANGUP</a>:
<a name="l00647"></a>00647                   <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;%s received a hangup frame.\n&quot;</span>, winner-&gt;name);
<a name="l00648"></a>00648                   <span class="keywordflow">if</span> (f-&gt;data.uint32) {
<a name="l00649"></a>00649                      winner-&gt;hangupcause = f-&gt;data.uint32;
<a name="l00650"></a>00650                   }
<a name="l00651"></a>00651                   <span class="keywordflow">if</span> (dg == 0) {
<a name="l00652"></a>00652                      <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;The calling channel hungup. Need to drop everyone else.\n&quot;</span>);
<a name="l00653"></a>00653                      <a class="code" href="app__followme_8c.html#a5aeb2881b16ba0ebbe15d9e4cae4f676">clear_calling_tree</a>(findme_user_list);
<a name="l00654"></a>00654                      ctstatus = -1;
<a name="l00655"></a>00655                   }
<a name="l00656"></a>00656                   <span class="keywordflow">break</span>;
<a name="l00657"></a>00657                <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>:
<a name="l00658"></a>00658                   <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;%s answered %s\n&quot;</span>, winner-&gt;name, caller-&gt;name);
<a name="l00659"></a>00659                   <span class="comment">/* If call has been answered, then the eventual hangup is likely to be normal hangup */</span> 
<a name="l00660"></a>00660                   winner-&gt;hangupcause = <a class="code" href="causes_8h.html#af2235eb1c27925e4020ce286255d165f">AST_CAUSE_NORMAL_CLEARING</a>;
<a name="l00661"></a>00661                   caller-&gt;<a class="code" href="structast__channel.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a> = <a class="code" href="causes_8h.html#af2235eb1c27925e4020ce286255d165f">AST_CAUSE_NORMAL_CLEARING</a>;
<a name="l00662"></a>00662                   <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Starting playback of %s\n&quot;</span>, callfromname);
<a name="l00663"></a>00663                   <span class="keywordflow">if</span> (dg &gt; 0) {
<a name="l00664"></a>00664                      <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(namerecloc)) {
<a name="l00665"></a>00665                         <span class="keywordflow">if</span> (!<a class="code" href="file_8h.html#a67c7e271b4ca70aca6d48fd48d121857" title="Streams a file.">ast_streamfile</a>(winner, callfromname, winner-&gt;language)) {
<a name="l00666"></a>00666                            <a class="code" href="sched_8h.html#a2867b39106061847a8508bf49e38f420" title="Runs the queue.">ast_sched_runq</a>(winner-&gt;sched);
<a name="l00667"></a>00667                            tmpuser-&gt;<a class="code" href="structfindme__user.html#a89f234133d3efe315836311cbf21c64b">state</a> = 1;
<a name="l00668"></a>00668                         } <span class="keywordflow">else</span> {
<a name="l00669"></a>00669                            <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to playback %s.\n&quot;</span>, callfromname);
<a name="l00670"></a>00670                            <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l00671"></a>00671                            <span class="keywordflow">return</span> NULL;
<a name="l00672"></a>00672                         }
<a name="l00673"></a>00673                      } <span class="keywordflow">else</span> {
<a name="l00674"></a>00674                         tmpuser-&gt;<a class="code" href="structfindme__user.html#a89f234133d3efe315836311cbf21c64b">state</a> = 2;
<a name="l00675"></a>00675                         <span class="keywordflow">if</span> (!<a class="code" href="file_8h.html#a67c7e271b4ca70aca6d48fd48d121857" title="Streams a file.">ast_streamfile</a>(tmpuser-&gt;<a class="code" href="structfindme__user.html#a3cd62ecaf93dc424694f2f347e02a35e">ochan</a>, tpargs-&gt;norecordingprompt, tmpuser-&gt;<a class="code" href="structfindme__user.html#a3cd62ecaf93dc424694f2f347e02a35e">ochan</a>-&gt;language))
<a name="l00676"></a>00676                            <a class="code" href="sched_8h.html#a2867b39106061847a8508bf49e38f420" title="Runs the queue.">ast_sched_runq</a>(tmpuser-&gt;<a class="code" href="structfindme__user.html#a3cd62ecaf93dc424694f2f347e02a35e">ochan</a>-&gt;<a class="code" href="structast__channel.html#aea6233539fc73fc5303bf7525ec27e73">sched</a>);
<a name="l00677"></a>00677                         <span class="keywordflow">else</span> {
<a name="l00678"></a>00678                            <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to playback %s.\n&quot;</span>, tpargs-&gt;norecordingprompt);
<a name="l00679"></a>00679                            <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l00680"></a>00680                            <span class="keywordflow">return</span> NULL;
<a name="l00681"></a>00681                         }
<a name="l00682"></a>00682                      }
<a name="l00683"></a>00683                   }
<a name="l00684"></a>00684                   <span class="keywordflow">break</span>;
<a name="l00685"></a>00685                <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875">AST_CONTROL_BUSY</a>:
<a name="l00686"></a>00686                   <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;%s is busy\n&quot;</span>, winner-&gt;name);
<a name="l00687"></a>00687                   <span class="keywordflow">break</span>;
<a name="l00688"></a>00688                <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a850bb06a1702741c93a3fd67cc9637ab">AST_CONTROL_CONGESTION</a>:
<a name="l00689"></a>00689                   <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;%s is circuit-busy\n&quot;</span>, winner-&gt;name);
<a name="l00690"></a>00690                   <span class="keywordflow">break</span>;
<a name="l00691"></a>00691                <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a>:
<a name="l00692"></a>00692                   <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;%s is ringing\n&quot;</span>, winner-&gt;name);
<a name="l00693"></a>00693                   <span class="keywordflow">break</span>;
<a name="l00694"></a>00694                <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a1a461c5e737ed6ed7c8cb0f78557a6fd">AST_CONTROL_PROGRESS</a>:
<a name="l00695"></a>00695                   <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;%s is making progress passing it to %s\n&quot;</span>, winner-&gt;name, caller-&gt;name);
<a name="l00696"></a>00696                   <span class="keywordflow">break</span>;
<a name="l00697"></a>00697                <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a417bc8ac5817cc1525a3b530abfc1528">AST_CONTROL_VIDUPDATE</a>:
<a name="l00698"></a>00698                   <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;%s requested a video update, passing it to %s\n&quot;</span>, winner-&gt;name, caller-&gt;name);
<a name="l00699"></a>00699                   <span class="keywordflow">break</span>;
<a name="l00700"></a>00700                <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a009e81151b19671f42b5e84ab6a619f4">AST_CONTROL_SRCUPDATE</a>:
<a name="l00701"></a>00701                   <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;%s requested a source update, passing it to %s\n&quot;</span>, winner-&gt;name, caller-&gt;name);
<a name="l00702"></a>00702                   <span class="keywordflow">break</span>;
<a name="l00703"></a>00703                <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a50b7fe33bba67b74dd7b746539e81000">AST_CONTROL_PROCEEDING</a>:
<a name="l00704"></a>00704                   <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;%s is proceeding passing it to %s\n&quot;</span>, winner-&gt;name,caller-&gt;name);
<a name="l00705"></a>00705                   <span class="keywordflow">break</span>;
<a name="l00706"></a>00706                <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ab99a3d1c08c5ae8bca078c7cd1ec02f5">AST_CONTROL_HOLD</a>:
<a name="l00707"></a>00707                   <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Call on %s placed on hold\n&quot;</span>, winner-&gt;name);
<a name="l00708"></a>00708                   <span class="keywordflow">break</span>;
<a name="l00709"></a>00709                <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>:
<a name="l00710"></a>00710                   <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Call on %s left from hold\n&quot;</span>, winner-&gt;name);
<a name="l00711"></a>00711                   <span class="keywordflow">break</span>;
<a name="l00712"></a>00712                <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a28cd8e9f9005e25624f993d6edd46755">AST_CONTROL_OFFHOOK</a>:
<a name="l00713"></a>00713                <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ae8f2cd460fdc81e0a774434fa002e4bf">AST_CONTROL_FLASH</a>:
<a name="l00714"></a>00714                   <span class="comment">/* Ignore going off hook and flash */</span>
<a name="l00715"></a>00715                   <span class="keywordflow">break</span>;
<a name="l00716"></a>00716                <span class="keywordflow">case</span> -1:
<a name="l00717"></a>00717                   <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;%s stopped sounds\n&quot;</span>, winner-&gt;name);
<a name="l00718"></a>00718                   <span class="keywordflow">break</span>;
<a name="l00719"></a>00719                <span class="keywordflow">default</span>:
<a name="l00720"></a>00720                   <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Dunno what to do with control type %d\n&quot;</span>, f-&gt;subclass);
<a name="l00721"></a>00721                   <span class="keywordflow">break</span>;
<a name="l00722"></a>00722                }
<a name="l00723"></a>00723             } 
<a name="l00724"></a>00724             <span class="keywordflow">if</span> (tmpuser &amp;&amp; tmpuser-&gt;<a class="code" href="structfindme__user.html#a89f234133d3efe315836311cbf21c64b">state</a> == 3 &amp;&amp; f-&gt;frametype == <a class="code" href="frame_8h.html#a248afd6c02044259a386f6b7aee922a2">AST_FRAME_DTMF</a>) {
<a name="l00725"></a>00725                <span class="keywordflow">if</span> (winner-&gt;stream)
<a name="l00726"></a>00726                   <a class="code" href="file_8h.html#a3092bf11d4bba66f646562759608b1bc" title="Stops a stream.">ast_stopstream</a>(winner);
<a name="l00727"></a>00727                tmpuser-&gt;<a class="code" href="structfindme__user.html#ad1b201c211aa1cda8b088feaddd55e16">digts</a> = 0;
<a name="l00728"></a>00728                <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;DTMF received: %c\n&quot;</span>,(<span class="keywordtype">char</span>) f-&gt;subclass);
<a name="l00729"></a>00729                tmpuser-&gt;<a class="code" href="structfindme__user.html#a33ecf76cbe2370bec3b0abef99e75519">yn</a>[tmpuser-&gt;<a class="code" href="structfindme__user.html#a2d81c86af2299006095fb3b8691e456a">ynidx</a>] = (char) f-&gt;subclass;
<a name="l00730"></a>00730                tmpuser-&gt;<a class="code" href="structfindme__user.html#a2d81c86af2299006095fb3b8691e456a">ynidx</a>++;
<a name="l00731"></a>00731                <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;DTMF string: %s\n&quot;</span>, tmpuser-&gt;<a class="code" href="structfindme__user.html#a33ecf76cbe2370bec3b0abef99e75519">yn</a>);
<a name="l00732"></a>00732                <span class="keywordflow">if</span> (tmpuser-&gt;<a class="code" href="structfindme__user.html#a2d81c86af2299006095fb3b8691e456a">ynidx</a> &gt;= <a class="code" href="app__followme_8c.html#a2df99f262786552284cf7927efda2efd">ynlongest</a>) {
<a name="l00733"></a>00733                   <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;reached longest possible match - doing evals\n&quot;</span>);
<a name="l00734"></a>00734                   <span class="keywordflow">if</span> (!strcmp(tmpuser-&gt;<a class="code" href="structfindme__user.html#a33ecf76cbe2370bec3b0abef99e75519">yn</a>, tpargs-&gt;takecall)) {
<a name="l00735"></a>00735                      <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Match to take the call!\n&quot;</span>);
<a name="l00736"></a>00736                      <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l00737"></a>00737                      <span class="keywordflow">return</span> tmpuser-&gt;<a class="code" href="structfindme__user.html#a3cd62ecaf93dc424694f2f347e02a35e">ochan</a>;
<a name="l00738"></a>00738                   }
<a name="l00739"></a>00739                   <span class="keywordflow">if</span> (!strcmp(tmpuser-&gt;<a class="code" href="structfindme__user.html#a33ecf76cbe2370bec3b0abef99e75519">yn</a>, tpargs-&gt;nextindp)) {
<a name="l00740"></a>00740                      <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Next in dial plan step requested.\n&quot;</span>);
<a name="l00741"></a>00741                      *<a class="code" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a> = 1;
<a name="l00742"></a>00742                      <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l00743"></a>00743                      <span class="keywordflow">return</span> NULL;
<a name="l00744"></a>00744                   }
<a name="l00745"></a>00745 
<a name="l00746"></a>00746                }
<a name="l00747"></a>00747             }
<a name="l00748"></a>00748 
<a name="l00749"></a>00749             <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l00750"></a>00750          } <span class="keywordflow">else</span> {
<a name="l00751"></a>00751             <span class="keywordflow">if</span> (winner) {
<a name="l00752"></a>00752                <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;we didn&apos;t get a frame. hanging up. dg is %d\n&quot;</span>,dg);                   
<a name="l00753"></a>00753                <span class="keywordflow">if</span> (!dg) {
<a name="l00754"></a>00754                   <a class="code" href="app__followme_8c.html#a5aeb2881b16ba0ebbe15d9e4cae4f676">clear_calling_tree</a>(findme_user_list);
<a name="l00755"></a>00755                   <span class="keywordflow">return</span> NULL;
<a name="l00756"></a>00756                } <span class="keywordflow">else</span> {
<a name="l00757"></a>00757                   tmpuser-&gt;<a class="code" href="structfindme__user.html#a89f234133d3efe315836311cbf21c64b">state</a> = -1;
<a name="l00758"></a>00758                   <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(winner);  
<a name="l00759"></a>00759                   livechannels--;
<a name="l00760"></a>00760                   <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;live channels left %d\n&quot;</span>, livechannels);
<a name="l00761"></a>00761                   <span class="keywordflow">if</span> (!livechannels) {
<a name="l00762"></a>00762                      <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;no live channels left. exiting.\n&quot;</span>);
<a name="l00763"></a>00763                      <span class="keywordflow">return</span> NULL;
<a name="l00764"></a>00764                   }
<a name="l00765"></a>00765                }
<a name="l00766"></a>00766             }
<a name="l00767"></a>00767          }
<a name="l00768"></a>00768 
<a name="l00769"></a>00769       } <span class="keywordflow">else</span>
<a name="l00770"></a>00770          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;timed out waiting for action\n&quot;</span>);
<a name="l00771"></a>00771    }
<a name="l00772"></a>00772 
<a name="l00773"></a>00773    <span class="comment">/* --- WAIT FOR WINNER NUMBER END! -----------*/</span>
<a name="l00774"></a>00774    <span class="keywordflow">return</span> NULL;
<a name="l00775"></a>00775 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a9e5f57131367eff409b9e0bd7b31aa1a"></a><!-- doxytag: member="app_followme.c::app" ref="a9e5f57131367eff409b9e0bd7b31aa1a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="res__agi_8c.html#a9e5f57131367eff409b9e0bd7b31aa1a">app</a> = &quot;FollowMe&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__followme_8c_source.html#l00096">96</a> of file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>

</div>
</div>
<a class="anchor" id="a58f00693748f61c394c084fef26c3827"></a><!-- doxytag: member="app_followme.c::callfromprompt" ref="a58f00693748f61c394c084fef26c3827" args="[PATH_MAX]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="app__followme_8c.html#a58f00693748f61c394c084fef26c3827">callfromprompt</a>[PATH_MAX] = &quot;followme/call-from&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__followme_8c_source.html#l00178">178</a> of file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>

</div>
</div>
<a class="anchor" id="afb21a9c7fa24519c9f790555b1904b91"></a><!-- doxytag: member="app_followme.c::defaultmoh" ref="afb21a9c7fa24519c9f790555b1904b91" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="app__followme_8c.html#afb21a9c7fa24519c9f790555b1904b91">defaultmoh</a> = &quot;default&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Default Music-On-Hold Class </p>

<p>Definition at line <a class="el" href="app__followme_8c_source.html#l00175">175</a> of file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>

</div>
</div>
<a class="anchor" id="a846427c0fcd8e7f387e43b465f74e810"></a><!-- doxytag: member="app_followme.c::featuredigittimeout" ref="a846427c0fcd8e7f387e43b465f74e810" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="res__features_8c.html#a846427c0fcd8e7f387e43b465f74e810">featuredigittimeout</a> = 5000<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Feature Digit Timeout </p>

<p>Definition at line <a class="el" href="app__followme_8c_source.html#l00174">174</a> of file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac7eb2e0c3a6a5a82caca6194003cb287"></a><!-- doxytag: member="app_followme.c::featuredigittostr" ref="ac7eb2e0c3a6a5a82caca6194003cb287" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="app__followme_8c.html#ac7eb2e0c3a6a5a82caca6194003cb287">featuredigittostr</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__followme_8c_source.html#l00173">173</a> of file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9dbb4ee6d178039269f8d6c8bb5b6610"></a><!-- doxytag: member="app_followme.c::nextindp" ref="a9dbb4ee6d178039269f8d6c8bb5b6610" args="[20]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="app__followme_8c.html#a9dbb4ee6d178039269f8d6c8bb5b6610">nextindp</a>[20] = &quot;2&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__followme_8c_source.html#l00177">177</a> of file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad19a8f288abdc0da9c0970a76e535a88"></a><!-- doxytag: member="app_followme.c::norecordingprompt" ref="ad19a8f288abdc0da9c0970a76e535a88" args="[PATH_MAX]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="app__followme_8c.html#ad19a8f288abdc0da9c0970a76e535a88">norecordingprompt</a>[PATH_MAX] = &quot;followme/no-recording&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__followme_8c_source.html#l00179">179</a> of file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>

</div>
</div>
<a class="anchor" id="a8cd1221921f88677b4e194ccabb54f23"></a><!-- doxytag: member="app_followme.c::optionsprompt" ref="a8cd1221921f88677b4e194ccabb54f23" args="[PATH_MAX]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="app__followme_8c.html#a8cd1221921f88677b4e194ccabb54f23">optionsprompt</a>[PATH_MAX] = &quot;followme/options&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__followme_8c_source.html#l00180">180</a> of file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa9ef93bdd1331f6a36cfc4b038790bd8"></a><!-- doxytag: member="app_followme.c::plsholdprompt" ref="aa9ef93bdd1331f6a36cfc4b038790bd8" args="[PATH_MAX]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="app__followme_8c.html#aa9ef93bdd1331f6a36cfc4b038790bd8">plsholdprompt</a>[PATH_MAX] = &quot;followme/pls-hold-while-try&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__followme_8c_source.html#l00181">181</a> of file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>

</div>
</div>
<a class="anchor" id="a433b7a39c8c5b0df72622c414d7a8b4c"></a><!-- doxytag: member="app_followme.c::sorryprompt" ref="a433b7a39c8c5b0df72622c414d7a8b4c" args="[PATH_MAX]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="app__followme_8c.html#a433b7a39c8c5b0df72622c414d7a8b4c">sorryprompt</a>[PATH_MAX] = &quot;followme/sorry&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__followme_8c_source.html#l00183">183</a> of file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9dc4e0a4fed22949dd087c179b43dbe9"></a><!-- doxytag: member="app_followme.c::statusprompt" ref="a9dc4e0a4fed22949dd087c179b43dbe9" args="[PATH_MAX]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="app__followme_8c.html#a9dc4e0a4fed22949dd087c179b43dbe9">statusprompt</a>[PATH_MAX] = &quot;followme/<a class="el" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__followme_8c_source.html#l00182">182</a> of file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5e4eb41cdb87c8899c7568985b44310e"></a><!-- doxytag: member="app_followme.c::takecall" ref="a5e4eb41cdb87c8899c7568985b44310e" args="[20]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="app__followme_8c.html#a5e4eb41cdb87c8899c7568985b44310e">takecall</a>[20] = &quot;1&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__followme_8c_source.html#l00177">177</a> of file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>

</div>
</div>
<a class="anchor" id="a2df99f262786552284cf7927efda2efd"></a><!-- doxytag: member="app_followme.c::ynlongest" ref="a2df99f262786552284cf7927efda2efd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="app__followme_8c.html#a2df99f262786552284cf7927efda2efd">ynlongest</a> = 0<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__followme_8c_source.html#l00171">171</a> of file <a class="el" href="app__followme_8c_source.html">app_followme.c</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:18:56 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
