<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:21:56 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_1ab815038f534adda65c8b4ae4993449.html">include</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_16d825f1fa9ecca2e70b1a8d9256d0e6.html">asterisk</a>
  </div>
</div>
<div class="contents">
<h1>compat.h File Reference</h1>
<p>General Definitions for Asterisk top level program Included by <a class="el" href="asterisk_8h.html" title="Asterisk main include file. File version handling, generic pbx functions.">asterisk.h</a> to handle platform-specific issues especially those related to header files.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="compiler_8h_source.html">asterisk/compiler.h</a>&quot;</code><br/>
<code>#include &lt;inttypes.h&gt;</code><br/>
<code>#include &lt;limits.h&gt;</code><br/>
<code>#include &lt;unistd.h&gt;</code><br/>
<code>#include &lt;stddef.h&gt;</code><br/>
<code>#include &lt;stdint.h&gt;</code><br/>
<code>#include &lt;sys/types.h&gt;</code><br/>
<code>#include &lt;stdarg.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;alloca.h&gt;</code><br/>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;sys/poll.h&gt;</code><br/>
<code>#include &lt;errno.h&gt;</code><br/>
<code>#include &lt;glob.h&gt;</code><br/>

<p><a href="compat_8h_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="compat_8h.html#abfc9432294a2cd3d55c92dca5c12f922">__STDC_VERSION__</a>&nbsp;&nbsp;&nbsp;0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="compat_8h.html#aaac7e52043ca7fcf7113eaaf95f6e3b7">MY_GLOB_FLAGS</a>&nbsp;&nbsp;&nbsp;(GLOB_NOMAGIC|GLOB_BRACE)</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="compat_8h.html#a40e0da58ab6964e3264b90f79ad6d476">getloadavg</a> (double *list, int nelem)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return something that won't cancel the call, but still return -1, in case we correct the implementation to check return value.  <a href="#a40e0da58ab6964e3264b90f79ad6d476"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint64_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="compat_8h.html#abf24475cd33504a038026a62504890b2">strtoq</a> (const char *nptr, char **endptr, int base)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convert a string to a quad integer.  <a href="#abf24475cd33504a038026a62504890b2"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>General Definitions for Asterisk top level program Included by <a class="el" href="asterisk_8h.html" title="Asterisk main include file. File version handling, generic pbx functions.">asterisk.h</a> to handle platform-specific issues especially those related to header files. </p>

<p>Definition in file <a class="el" href="compat_8h_source.html">compat.h</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="abfc9432294a2cd3d55c92dca5c12f922"></a><!-- doxytag: member="compat.h::__STDC_VERSION__" ref="abfc9432294a2cd3d55c92dca5c12f922" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __STDC_VERSION__&nbsp;&nbsp;&nbsp;0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="compat_8h_source.html#l00025">25</a> of file <a class="el" href="compat_8h_source.html">compat.h</a>.</p>

</div>
</div>
<a class="anchor" id="aaac7e52043ca7fcf7113eaaf95f6e3b7"></a><!-- doxytag: member="compat.h::MY_GLOB_FLAGS" ref="aaac7e52043ca7fcf7113eaaf95f6e3b7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MY_GLOB_FLAGS&nbsp;&nbsp;&nbsp;(GLOB_NOMAGIC|GLOB_BRACE)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="compat_8h_source.html#l00193">193</a> of file <a class="el" href="compat_8h_source.html">compat.h</a>.</p>

<p>Referenced by <a class="el" href="xmldoc_8c_source.html#l01765">ast_xmldoc_load_documentation()</a>, and <a class="el" href="config_8c_source.html#l01176">config_text_file_load()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a40e0da58ab6964e3264b90f79ad6d476"></a><!-- doxytag: member="compat.h::getloadavg" ref="a40e0da58ab6964e3264b90f79ad6d476" args="(double *list, int nelem)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int getloadavg </td>
          <td>(</td>
          <td class="paramtype">double *&nbsp;</td>
          <td class="paramname"> <em>list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nelem</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return something that won't cancel the call, but still return -1, in case we correct the implementation to check return value. </p>

<p>Definition at line <a class="el" href="agi_2strcompat_8c_source.html#l00325">325</a> of file <a class="el" href="agi_2strcompat_8c_source.html">agi/strcompat.c</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l02784">ast_readconfig()</a>, <a class="el" href="asterisk_8c_source.html#l02164">cli_prompt()</a>, <a class="el" href="pbx_8c_source.html#l04470">increase_call_count()</a>, and <a class="el" href="func__sysinfo_8c_source.html#l00039">sysinfo_helper()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00326"></a>00326 {
<a name="l00327"></a>00327    <span class="keywordtype">int</span> i;
<a name="l00328"></a>00328 
<a name="l00329"></a>00329    <span class="keywordflow">for</span> (i = 0; i &lt; nelem; i++) {
<a name="l00330"></a>00330       list[i] = 0.1;
<a name="l00331"></a>00331    }
<a name="l00332"></a>00332    <span class="keywordflow">return</span> -1;
<a name="l00333"></a>00333 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abf24475cd33504a038026a62504890b2"></a><!-- doxytag: member="compat.h::strtoq" ref="abf24475cd33504a038026a62504890b2" args="(const char *nptr, char **endptr, int base)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t strtoq </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>nptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>endptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>base</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Convert a string to a quad integer. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>Ignores `locale' stuff. Assumes that the upper and lower case alphabets and digits are each contiguous. </dd></dl>

<p>Definition at line <a class="el" href="agi_2strcompat_8c_source.html#l00216">216</a> of file <a class="el" href="agi_2strcompat_8c_source.html">agi/strcompat.c</a>.</p>

<p>References <a class="el" href="agi_2strcompat_8c_source.html#l00206">LONG_MAX</a>, <a class="el" href="agi_2strcompat_8c_source.html#l00202">LONG_MIN</a>, and <a class="el" href="aesopt_8h_source.html#l00399">s</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00217"></a>00217 {
<a name="l00218"></a>00218     <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>;
<a name="l00219"></a>00219     uint64_t acc;
<a name="l00220"></a>00220     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> c;
<a name="l00221"></a>00221     uint64_t qbase, cutoff;
<a name="l00222"></a>00222     <span class="keywordtype">int</span> neg, any, cutlim;
<a name="l00223"></a>00223 
<a name="l00224"></a>00224     <span class="comment">/*</span>
<a name="l00225"></a>00225 <span class="comment">     * Skip white space and pick up leading +/- sign if any.</span>
<a name="l00226"></a>00226 <span class="comment">     * If base is 0, allow 0x for hex and 0 for octal, else</span>
<a name="l00227"></a>00227 <span class="comment">     * assume decimal; if base is already 16, allow 0x.</span>
<a name="l00228"></a>00228 <span class="comment">     */</span>
<a name="l00229"></a>00229     s = nptr;
<a name="l00230"></a>00230     <span class="keywordflow">do</span> {
<a name="l00231"></a>00231             c = *s++;
<a name="l00232"></a>00232     } <span class="keywordflow">while</span> (isspace(c));
<a name="l00233"></a>00233     <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;-&apos;</span>) {
<a name="l00234"></a>00234             neg = 1;
<a name="l00235"></a>00235             c = *s++;
<a name="l00236"></a>00236     } <span class="keywordflow">else</span> {
<a name="l00237"></a>00237             neg = 0;
<a name="l00238"></a>00238             <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;+&apos;</span>)
<a name="l00239"></a>00239                     c = *s++;
<a name="l00240"></a>00240     }
<a name="l00241"></a>00241     <span class="keywordflow">if</span> ((base == 0 || base == 16) &amp;&amp;
<a name="l00242"></a>00242         c == <span class="charliteral">&apos;\0&apos;</span> &amp;&amp; (*s == <span class="charliteral">&apos;x&apos;</span> || *s == <span class="charliteral">&apos;X&apos;</span>)) {
<a name="l00243"></a>00243             c = s[1];
<a name="l00244"></a>00244             s += 2;
<a name="l00245"></a>00245             base = 16;
<a name="l00246"></a>00246     }
<a name="l00247"></a>00247     <span class="keywordflow">if</span> (base == 0)
<a name="l00248"></a>00248             base = c == <span class="charliteral">&apos;\0&apos;</span> ? 8 : 10;
<a name="l00249"></a>00249 
<a name="l00250"></a>00250     <span class="comment">/*</span>
<a name="l00251"></a>00251 <span class="comment">     * Compute the cutoff value between legal numbers and illegal</span>
<a name="l00252"></a>00252 <span class="comment">     * numbers.  That is the largest legal value, divided by the</span>
<a name="l00253"></a>00253 <span class="comment">     * base.  An input number that is greater than this value, if</span>
<a name="l00254"></a>00254 <span class="comment">     * followed by a legal input character, is too big.  One that</span>
<a name="l00255"></a>00255 <span class="comment">     * is equal to this value may be valid or not; the limit</span>
<a name="l00256"></a>00256 <span class="comment">     * between valid and invalid numbers is then based on the last</span>
<a name="l00257"></a>00257 <span class="comment">     * digit.  For instance, if the range for quads is</span>
<a name="l00258"></a>00258 <span class="comment">     * [-9223372036854775808..9223372036854775807] and the input base</span>
<a name="l00259"></a>00259 <span class="comment">     * is 10, cutoff will be set to 922337203685477580 and cutlim to</span>
<a name="l00260"></a>00260 <span class="comment">     * either 7 (neg==0) or 8 (neg==1), meaning that if we have</span>
<a name="l00261"></a>00261 <span class="comment">     * accumulated a value &gt; 922337203685477580, or equal but the</span>
<a name="l00262"></a>00262 <span class="comment">     * next digit is &gt; 7 (or 8), the number is too big, and we will</span>
<a name="l00263"></a>00263 <span class="comment">     * return a range error.</span>
<a name="l00264"></a>00264 <span class="comment">     *</span>
<a name="l00265"></a>00265 <span class="comment">     * Set any if any `digits&apos; consumed; make it negative to indicate</span>
<a name="l00266"></a>00266 <span class="comment">     * overflow.</span>
<a name="l00267"></a>00267 <span class="comment">     */</span>
<a name="l00268"></a>00268     qbase = (unsigned)base;
<a name="l00269"></a>00269     cutoff = neg ? (uint64_t)-(<a class="code" href="agi_2strcompat_8c.html#ae8a44c5a7436466221e0f3859d02420f">LONG_MIN</a> + <a class="code" href="agi_2strcompat_8c.html#a50fece4db74f09568b2938db583c5655">LONG_MAX</a>) + <a class="code" href="agi_2strcompat_8c.html#a50fece4db74f09568b2938db583c5655">LONG_MAX</a> : <a class="code" href="agi_2strcompat_8c.html#a50fece4db74f09568b2938db583c5655">LONG_MAX</a>;
<a name="l00270"></a>00270     cutlim = cutoff % qbase;
<a name="l00271"></a>00271     cutoff /= qbase;
<a name="l00272"></a>00272     <span class="keywordflow">for</span> (acc = 0, any = 0;; c = *s++) {
<a name="l00273"></a>00273             <span class="keywordflow">if</span> (!isascii(c))
<a name="l00274"></a>00274                     <span class="keywordflow">break</span>;
<a name="l00275"></a>00275             <span class="keywordflow">if</span> (isdigit(c))
<a name="l00276"></a>00276                     c -= <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00277"></a>00277             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isalpha(c))
<a name="l00278"></a>00278                     c -= isupper(c) ? <span class="charliteral">&apos;A&apos;</span> - 10 : <span class="charliteral">&apos;a&apos;</span> - 10;
<a name="l00279"></a>00279             <span class="keywordflow">else</span>
<a name="l00280"></a>00280                     <span class="keywordflow">break</span>;
<a name="l00281"></a>00281             <span class="keywordflow">if</span> (c &gt;= base)
<a name="l00282"></a>00282                     <span class="keywordflow">break</span>;
<a name="l00283"></a>00283             <span class="keywordflow">if</span> (any &lt; 0 || acc &gt; cutoff || (acc == cutoff &amp;&amp; c &gt; cutlim))
<a name="l00284"></a>00284                     any = -1;
<a name="l00285"></a>00285             <span class="keywordflow">else</span> {
<a name="l00286"></a>00286                     any = 1;
<a name="l00287"></a>00287                     acc *= qbase;
<a name="l00288"></a>00288                     acc += c;
<a name="l00289"></a>00289             }
<a name="l00290"></a>00290     }
<a name="l00291"></a>00291     <span class="keywordflow">if</span> (any &lt; 0) {
<a name="l00292"></a>00292             acc = neg ? <a class="code" href="agi_2strcompat_8c.html#ae8a44c5a7436466221e0f3859d02420f">LONG_MIN</a> : <a class="code" href="agi_2strcompat_8c.html#a50fece4db74f09568b2938db583c5655">LONG_MAX</a>;
<a name="l00293"></a>00293     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (neg)
<a name="l00294"></a>00294             acc = -acc;
<a name="l00295"></a>00295     <span class="keywordflow">if</span> (endptr != 0)
<a name="l00296"></a>00296             *((<span class="keyword">const</span> <span class="keywordtype">char</span> **)endptr) = any ? s - 1 : nptr;
<a name="l00297"></a>00297     <span class="keywordflow">return</span> acc;
<a name="l00298"></a>00298 }
</pre></div></p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:21:56 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
