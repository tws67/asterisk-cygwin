<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:18:40 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_afe38fc0ccf2e9eefca5d5c6b03503d9.html">main</a>
  </div>
</div>
<div class="contents">
<h1>frame.c</h1><a href="frame_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Asterisk -- An open source telephony toolkit.</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * Copyright (C) 1999 - 2005, Digium, Inc.</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * Mark Spencer &lt;markster@digium.com&gt;</span>
<a name="l00007"></a>00007 <span class="comment"> *</span>
<a name="l00008"></a>00008 <span class="comment"> * See http://www.asterisk.org for more information about</span>
<a name="l00009"></a>00009 <span class="comment"> * the Asterisk project. Please do not directly contact</span>
<a name="l00010"></a>00010 <span class="comment"> * any of the maintainers of this project for assistance;</span>
<a name="l00011"></a>00011 <span class="comment"> * the project provides a web site, mailing lists and IRC</span>
<a name="l00012"></a>00012 <span class="comment"> * channels for your use.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * This program is free software, distributed under the terms of</span>
<a name="l00015"></a>00015 <span class="comment"> * the GNU General Public License Version 2. See the LICENSE file</span>
<a name="l00016"></a>00016 <span class="comment"> * at the top of the source tree.</span>
<a name="l00017"></a>00017 <span class="comment"> */</span>
<a name="l00018"></a>00018 <span class="comment"></span>
<a name="l00019"></a>00019 <span class="comment">/*! \file</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * \brief Frame and codec manipulation routines</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * \author Mark Spencer &lt;markster@digium.com&gt; </span>
<a name="l00024"></a>00024 <span class="comment"> */</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="asterisk_8h.html" title="Asterisk main include file. File version handling, generic pbx functions.">asterisk.h</a>&quot;</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <a class="code" href="asterisk_8h.html#ab0390be60f8c539a2662df2faf9985c7" title="Register/unregister a source code file with the core.">ASTERISK_FILE_VERSION</a>(__FILE__, <span class="stringliteral">&quot;$Revision: 243247 $&quot;</span>)
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;asterisk/_private.h&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="lock_8h.html" title="Asterisk locking-related definitions:ast_mutext_t, ast_rwlock_t and related functions;atomic...">asterisk/lock.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="frame_8h.html" title="Asterisk internal frame definitions.">asterisk/frame.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="channel_8h.html" title="General Asterisk PBX channel definitions.">asterisk/channel.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="cli_8h.html" title="Standard Command Line Interface.">asterisk/cli.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="term_8h.html" title="Handy terminal functions for vt* terms.">asterisk/term.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="utils_8h.html" title="Utility functions.">asterisk/utils.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="threadstorage_8h.html" title="Definitions to aid in the use of thread local storage.">asterisk/threadstorage.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="linkedlists_8h.html" title="A set of macros to manage forward-linked lists.">asterisk/linkedlists.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="translate_8h.html" title="Support for translation of data formats. translate.c.">asterisk/translate.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="dsp_8h.html" title="Convenient Signal Processing routines.">asterisk/dsp.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="file_8h.html" title="Generic File Format Support. Should be included by clients of the file handling routines...">asterisk/file.h</a>&quot;</span>
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 <span class="preprocessor">#if !defined(LOW_MEMORY)</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="frame_8c.html#ae0047382e2ea1dac90f6f8c8dcd2bfb8">frame_cache_cleanup</a>(<span class="keywordtype">void</span> *data);
<a name="l00045"></a>00045 <span class="comment"></span>
<a name="l00046"></a>00046 <span class="comment">/*! \brief A per-thread cache of frame headers */</span>
<a name="l00047"></a><a class="code" href="frame_8c.html#a0aa5ff72fc86609f2fe7385e7747b52e">00047</a> <a class="code" href="threadstorage_8h.html#a3fb5391416c5bf7a18d5f7f7b84c4b81" title="Define a thread storage variable, with custom initialization and cleanup.">AST_THREADSTORAGE_CUSTOM</a>(<a class="code" href="frame_8c.html#a0aa5ff72fc86609f2fe7385e7747b52e">frame_cache</a>, NULL, <a class="code" href="frame_8c.html#ae0047382e2ea1dac90f6f8c8dcd2bfb8">frame_cache_cleanup</a>);
<a name="l00048"></a>00048 <span class="comment"></span>
<a name="l00049"></a>00049 <span class="comment">/*! </span>
<a name="l00050"></a>00050 <span class="comment"> * \brief Maximum ast_frame cache size</span>
<a name="l00051"></a>00051 <span class="comment"> *</span>
<a name="l00052"></a>00052 <span class="comment"> * In most cases where the frame header cache will be useful, the size</span>
<a name="l00053"></a>00053 <span class="comment"> * of the cache will stay very small.  However, it is not always the case that</span>
<a name="l00054"></a>00054 <span class="comment"> * the same thread that allocates the frame will be the one freeing them, so</span>
<a name="l00055"></a>00055 <span class="comment"> * sometimes a thread will never have any frames in its cache, or the cache</span>
<a name="l00056"></a>00056 <span class="comment"> * will never be pulled from.  For the latter case, we limit the maximum size. </span>
<a name="l00057"></a>00057 <span class="comment"> */</span> 
<a name="l00058"></a><a class="code" href="frame_8c.html#a5323507292adb03f4b5b83a23460d9d6">00058</a> <span class="preprocessor">#define FRAME_CACHE_MAX_SIZE  10</span>
<a name="l00059"></a>00059 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00060"></a>00060 <span class="comment">/*! \brief This is just so ast_frames, a list head struct for holding a list of</span>
<a name="l00061"></a>00061 <span class="comment"> *  ast_frame structures, is defined. */</span>
<a name="l00062"></a><a class="code" href="structast__frames.html#a26b5d863c7e0cb86c0272712fea6f996">00062</a> <a class="code" href="linkedlists_8h.html#a117cbef6a40010cd3c84a16fd9ef4ca6" title="Defines a structure to be used to hold a list of specified type (with no lock).">AST_LIST_HEAD_NOLOCK</a>(<a class="code" href="structast__frames.html" title="This is just so ast_frames, a list head struct for holding a list of ast_frame structures...">ast_frames</a>, <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a>);
<a name="l00063"></a>00063 
<a name="l00064"></a><a class="code" href="structast__frame__cache.html">00064</a> <span class="keyword">struct </span><a class="code" href="structast__frame__cache.html">ast_frame_cache</a> {
<a name="l00065"></a><a class="code" href="structast__frame__cache.html#a9c7b49f68e5d958a09c3628a40a4206f">00065</a>    <span class="keyword">struct </span><a class="code" href="structast__frames.html" title="This is just so ast_frames, a list head struct for holding a list of ast_frame structures...">ast_frames</a> <a class="code" href="structast__frame__cache.html#a9c7b49f68e5d958a09c3628a40a4206f">list</a>;
<a name="l00066"></a><a class="code" href="structast__frame__cache.html#a854352f53b148adc24983a58a1866d66">00066</a>    <span class="keywordtype">size_t</span> <a class="code" href="structast__frame__cache.html#a854352f53b148adc24983a58a1866d66">size</a>;
<a name="l00067"></a>00067 };
<a name="l00068"></a>00068 <span class="preprocessor">#endif</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span>
<a name="l00070"></a><a class="code" href="frame_8c.html#ad437b001eeca9b4ec5e30440de546bec">00070</a> <span class="preprocessor">#define SMOOTHER_SIZE 8000</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span>
<a name="l00072"></a><a class="code" href="frame_8c.html#a3ca2c0bc7578bf3d337e34b2c08a6c5f">00072</a> <span class="keyword">enum</span> <a class="code" href="frame_8c.html#a3ca2c0bc7578bf3d337e34b2c08a6c5f">frame_type</a> {
<a name="l00073"></a><a class="code" href="frame_8c.html#a3ca2c0bc7578bf3d337e34b2c08a6c5faa36545ff3bafe095ec6ecade4820c8ac">00073</a>    <a class="code" href="codec__speex_8c.html#a2fa0578bfbd608daafde3c56a0ad15a6">TYPE_HIGH</a>,     <span class="comment">/* 0x0 */</span>
<a name="l00074"></a><a class="code" href="frame_8c.html#a3ca2c0bc7578bf3d337e34b2c08a6c5fa5fc57b85380135170348dd50eefc2758">00074</a>    <a class="code" href="codec__speex_8c.html#ab78c10a44f25f2b7196c44c0397839bf">TYPE_LOW</a>,      <span class="comment">/* 0x1 */</span>
<a name="l00075"></a><a class="code" href="frame_8c.html#a3ca2c0bc7578bf3d337e34b2c08a6c5fa78be5c6e5e111a4e84d3be94233fca48">00075</a>    <a class="code" href="codec__speex_8c.html#af560916d7051f74aa7cf9af7023cafe2">TYPE_SILENCE</a>,  <span class="comment">/* 0x2 */</span>
<a name="l00076"></a><a class="code" href="frame_8c.html#a3ca2c0bc7578bf3d337e34b2c08a6c5fab13f7bec98d45341d5c02adb21372dc7">00076</a>    <a class="code" href="frame_8c.html#a3ca2c0bc7578bf3d337e34b2c08a6c5fab13f7bec98d45341d5c02adb21372dc7">TYPE_DONTSEND</a>  <span class="comment">/* 0x3 */</span>
<a name="l00077"></a>00077 };
<a name="l00078"></a>00078 
<a name="l00079"></a><a class="code" href="frame_8c.html#aff17a6771d3319ab64930cd2b937d6cf">00079</a> <span class="preprocessor">#define TYPE_MASK 0x3</span>
<a name="l00080"></a>00080 <span class="preprocessor"></span>
<a name="l00081"></a><a class="code" href="structast__smoother.html">00081</a> <span class="keyword">struct </span><a class="code" href="structast__smoother.html">ast_smoother</a> {
<a name="l00082"></a><a class="code" href="structast__smoother.html#a439227feff9d7f55384e8780cfc2eb82">00082</a>    <span class="keywordtype">int</span> <a class="code" href="structast__smoother.html#a439227feff9d7f55384e8780cfc2eb82">size</a>;
<a name="l00083"></a><a class="code" href="structast__smoother.html#a317afff57d87a89158c2b038d37b2b08">00083</a>    <span class="keywordtype">int</span> <a class="code" href="structast__smoother.html#a317afff57d87a89158c2b038d37b2b08">format</a>;
<a name="l00084"></a><a class="code" href="structast__smoother.html#ac8bf36fe0577cba66bccda3a6f7e80a4">00084</a>    <span class="keywordtype">int</span> <a class="code" href="structast__smoother.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a>;
<a name="l00085"></a><a class="code" href="structast__smoother.html#ace5328f4f85cf26835ca68604818271d">00085</a>    <span class="keywordtype">float</span> <a class="code" href="structast__smoother.html#ace5328f4f85cf26835ca68604818271d">samplesperbyte</a>;
<a name="l00086"></a><a class="code" href="structast__smoother.html#aa0bab80f07b3d04d81bd3c9ae69e8b68">00086</a>    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structast__smoother.html#aa0bab80f07b3d04d81bd3c9ae69e8b68">opt_needs_swap</a>:1;
<a name="l00087"></a><a class="code" href="structast__smoother.html#a735f764b1095611ace084e7c6c06857d">00087</a>    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> <a class="code" href="structast__smoother.html#a735f764b1095611ace084e7c6c06857d">f</a>;
<a name="l00088"></a><a class="code" href="structast__smoother.html#a41a708025486b4c9383e7432e9ba3f0e">00088</a>    <span class="keyword">struct </span>timeval <a class="code" href="structast__smoother.html#a41a708025486b4c9383e7432e9ba3f0e">delivery</a>;
<a name="l00089"></a><a class="code" href="structast__smoother.html#ae5c0218650008c505b08356333bbe5b3">00089</a>    <span class="keywordtype">char</span> <a class="code" href="structast__smoother.html#ae5c0218650008c505b08356333bbe5b3">data</a>[<a class="code" href="frame_8c.html#ad437b001eeca9b4ec5e30440de546bec">SMOOTHER_SIZE</a>];
<a name="l00090"></a><a class="code" href="structast__smoother.html#a9b5791c26a8c001bdd98e61634b7de5a">00090</a>    <span class="keywordtype">char</span> <a class="code" href="structast__smoother.html#a9b5791c26a8c001bdd98e61634b7de5a">framedata</a>[<a class="code" href="frame_8c.html#ad437b001eeca9b4ec5e30440de546bec">SMOOTHER_SIZE</a> + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>];
<a name="l00091"></a><a class="code" href="structast__smoother.html#a2707e7d39a01f2e9a557076acd901889">00091</a>    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="structast__smoother.html#a2707e7d39a01f2e9a557076acd901889">opt</a>;
<a name="l00092"></a><a class="code" href="structast__smoother.html#afed088663f8704004425cdae2120b9b3">00092</a>    <span class="keywordtype">int</span> <a class="code" href="structast__smoother.html#afed088663f8704004425cdae2120b9b3">len</a>;
<a name="l00093"></a>00093 };
<a name="l00094"></a>00094 <span class="comment"></span>
<a name="l00095"></a>00095 <span class="comment">/*! \brief Definition of supported media formats (codecs) */</span>
<a name="l00096"></a><a class="code" href="frame_8c.html#a6da24d09807c4c89bbba05e5566eb266">00096</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structast__format__list.html" title="Definition of supported media formats (codecs).">ast_format_list</a> <a class="code" href="frame_8c.html#a6da24d09807c4c89bbba05e5566eb266" title="Definition of supported media formats (codecs).">AST_FORMAT_LIST</a>[] = {
<a name="l00097"></a>00097    { <a class="code" href="frame_8h.html#ad90b56ed6ada6e4f13224512668e20fb">AST_FORMAT_G723_1</a> , <span class="stringliteral">&quot;g723&quot;</span>, 8000, <span class="stringliteral">&quot;G.723.1&quot;</span>, 20, 30, 300, 30, 30 },                                  <span class="comment">/*!&lt; G723.1 */</span>
<a name="l00098"></a>00098    { <a class="code" href="frame_8h.html#a85106ada66147a674b36f0a55297d29d">AST_FORMAT_GSM</a>, <span class="stringliteral">&quot;gsm&quot;</span>, 8000, <span class="stringliteral">&quot;GSM&quot;</span>, 33, 20, 300, 20, 20 },                                           <span class="comment">/*!&lt; codec_gsm.c */</span>
<a name="l00099"></a>00099    { <a class="code" href="frame_8h.html#ab602cf455d4a96a3adba2e3ba8cd2b2c">AST_FORMAT_ULAW</a>, <span class="stringliteral">&quot;ulaw&quot;</span>, 8000, <span class="stringliteral">&quot;G.711 u-law&quot;</span>, 80, 10, 150, 10, 20 },                                 <span class="comment">/*!&lt; codec_ulaw.c */</span>
<a name="l00100"></a>00100    { <a class="code" href="frame_8h.html#aa58cc980a9c9108522effc64e9aff2d6">AST_FORMAT_ALAW</a>, <span class="stringliteral">&quot;alaw&quot;</span>, 8000, <span class="stringliteral">&quot;G.711 A-law&quot;</span>, 80, 10, 150, 10, 20 },                                 <span class="comment">/*!&lt; codec_alaw.c */</span>
<a name="l00101"></a>00101    { <a class="code" href="frame_8h.html#a030c77081bc2aff5ae5a384769f46418">AST_FORMAT_G726</a>, <span class="stringliteral">&quot;g726&quot;</span>, 8000, <span class="stringliteral">&quot;G.726 RFC3551&quot;</span>, 40, 10, 300, 10, 20 },                               <span class="comment">/*!&lt; codec_g726.c */</span>
<a name="l00102"></a>00102    { <a class="code" href="frame_8h.html#a933964fc376c2642f9471c176fb7ae7d">AST_FORMAT_ADPCM</a>, <span class="stringliteral">&quot;adpcm&quot;</span> , 8000, <span class="stringliteral">&quot;ADPCM&quot;</span>, 40, 10, 300, 10, 20 },                                    <span class="comment">/*!&lt; codec_adpcm.c */</span>
<a name="l00103"></a>00103    { <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>, <span class="stringliteral">&quot;slin&quot;</span>, 8000, <span class="stringliteral">&quot;16 bit Signed Linear PCM&quot;</span>, 160, 10, 70, 10, 20, <a class="code" href="frame_8h.html#af2e180889cb2b85cd10823803b9eb005">AST_SMOOTHER_FLAG_BE</a> }, <span class="comment">/*!&lt; Signed linear */</span>
<a name="l00104"></a>00104    { <a class="code" href="frame_8h.html#ac816c6f1fd32b02a6d20af297d96d04f">AST_FORMAT_LPC10</a>, <span class="stringliteral">&quot;lpc10&quot;</span>, 8000, <span class="stringliteral">&quot;LPC10&quot;</span>, 7, 20, 20, 20, 20 },                                       <span class="comment">/*!&lt; codec_lpc10.c */</span> 
<a name="l00105"></a>00105    { <a class="code" href="frame_8h.html#a8c5f13161448f613baaf42dea11f520a">AST_FORMAT_G729A</a>, <span class="stringliteral">&quot;g729&quot;</span>, 8000, <span class="stringliteral">&quot;G.729A&quot;</span>, 10, 10, 230, 10, 20, <a class="code" href="frame_8h.html#a06828788896ac92282112bd8ffe12319">AST_SMOOTHER_FLAG_G729</a> },             <span class="comment">/*!&lt; Binary commercial distribution */</span>
<a name="l00106"></a>00106    { <a class="code" href="frame_8h.html#a1a05dee116bf73c0f1ca8410bdb48c62">AST_FORMAT_SPEEX</a>, <span class="stringliteral">&quot;speex&quot;</span>, 8000, <span class="stringliteral">&quot;SpeeX&quot;</span>, 10, 10, 60, 10, 20 },                                      <span class="comment">/*!&lt; codec_speex.c */</span>
<a name="l00107"></a>00107    { <a class="code" href="frame_8h.html#a8330d06ea408802c37e9af61a513c6a1">AST_FORMAT_ILBC</a>, <span class="stringliteral">&quot;ilbc&quot;</span>, 8000, <span class="stringliteral">&quot;iLBC&quot;</span>, 50, 30, 30, 30, 30 },                                         <span class="comment">/*!&lt; codec_ilbc.c */</span> <span class="comment">/* inc=30ms - workaround */</span>
<a name="l00108"></a>00108    { <a class="code" href="frame_8h.html#a536fbd427f197a33e679c7721afad420">AST_FORMAT_G726_AAL2</a>, <span class="stringliteral">&quot;g726aal2&quot;</span>, 8000, <span class="stringliteral">&quot;G.726 AAL2&quot;</span>, 40, 10, 300, 10, 20 },                         <span class="comment">/*!&lt; codec_g726.c */</span>
<a name="l00109"></a>00109    { <a class="code" href="frame_8h.html#a4a0e8720928940d26abf28fff2e6586d">AST_FORMAT_G722</a>, <span class="stringliteral">&quot;g722&quot;</span>, 16000, <span class="stringliteral">&quot;G722&quot;</span>, 80, 10, 150, 10, 20 },                                       <span class="comment">/*!&lt; codec_g722.c */</span>
<a name="l00110"></a>00110    { <a class="code" href="frame_8h.html#a6e078550fcf3f2038f6c343b3d65a936">AST_FORMAT_SLINEAR16</a>, <span class="stringliteral">&quot;slin16&quot;</span>, 16000, <span class="stringliteral">&quot;16 bit Signed Linear PCM (16kHz)&quot;</span>, 320, 10, 70, 10, 20, <a class="code" href="frame_8h.html#af2e180889cb2b85cd10823803b9eb005">AST_SMOOTHER_FLAG_BE</a> },    <span class="comment">/*!&lt; Signed linear (16kHz) */</span>
<a name="l00111"></a>00111    { <a class="code" href="frame_8h.html#a9f42fbac3d6631f67cb0fb9a91091ec5">AST_FORMAT_JPEG</a>, <span class="stringliteral">&quot;jpeg&quot;</span>, 0, <span class="stringliteral">&quot;JPEG image&quot;</span>},                                                           <span class="comment">/*!&lt; See format_jpeg.c */</span>
<a name="l00112"></a>00112    { <a class="code" href="frame_8h.html#a66201142be0584b5741786416aa3e446">AST_FORMAT_PNG</a>, <span class="stringliteral">&quot;png&quot;</span>, 0, <span class="stringliteral">&quot;PNG image&quot;</span>},                                                              <span class="comment">/*!&lt; PNG Image format */</span>
<a name="l00113"></a>00113    { <a class="code" href="frame_8h.html#a876fb06c385409451b7842fe1af6c42e">AST_FORMAT_H261</a>, <span class="stringliteral">&quot;h261&quot;</span>, 0, <span class="stringliteral">&quot;H.261 Video&quot;</span> },                                                         <span class="comment">/*!&lt; H.261 Video Passthrough */</span>
<a name="l00114"></a>00114    { <a class="code" href="frame_8h.html#a750506bc6e9117c66a5a6ad2dc82bc85">AST_FORMAT_H263</a>, <span class="stringliteral">&quot;h263&quot;</span>, 0, <span class="stringliteral">&quot;H.263 Video&quot;</span> },                                                         <span class="comment">/*!&lt; H.263 Passthrough support, see format_h263.c */</span>
<a name="l00115"></a>00115    { <a class="code" href="frame_8h.html#aea05b09095ebe8302b1187f4f0b0d042">AST_FORMAT_H263_PLUS</a>, <span class="stringliteral">&quot;h263p&quot;</span>, 0, <span class="stringliteral">&quot;H.263+ Video&quot;</span> },                                                  <span class="comment">/*!&lt; H.263plus passthrough support See format_h263.c */</span>
<a name="l00116"></a>00116    { <a class="code" href="frame_8h.html#a884a71784d2a563dd54eb15c2cfc57b0">AST_FORMAT_H264</a>, <span class="stringliteral">&quot;h264&quot;</span>, 0, <span class="stringliteral">&quot;H.264 Video&quot;</span> },                                                         <span class="comment">/*!&lt; Passthrough support, see format_h263.c */</span>
<a name="l00117"></a>00117    { <a class="code" href="frame_8h.html#a315d4a14bcf11a55ea8df52dd3a74d35">AST_FORMAT_MP4_VIDEO</a>, <span class="stringliteral">&quot;mpeg4&quot;</span>, 0, <span class="stringliteral">&quot;MPEG4 Video&quot;</span> },                                                   <span class="comment">/*!&lt; Passthrough support for MPEG4 */</span>
<a name="l00118"></a>00118    { <a class="code" href="frame_8h.html#aa43d17815b58f27836a45fb310d33959">AST_FORMAT_T140RED</a>, <span class="stringliteral">&quot;red&quot;</span>, 1, <span class="stringliteral">&quot;T.140 Realtime Text with redundancy&quot;</span>},                                <span class="comment">/*!&lt; Redundant T.140 Realtime Text */</span>
<a name="l00119"></a>00119    { <a class="code" href="frame_8h.html#a721e65ac52ff8eca03ea163544e695b6">AST_FORMAT_T140</a>, <span class="stringliteral">&quot;t140&quot;</span>, 0, <span class="stringliteral">&quot;Passthrough T.140 Realtime Text&quot;</span> },                                     <span class="comment">/*!&lt; Passthrough support for T.140 Realtime Text */</span>
<a name="l00120"></a>00120    { <a class="code" href="frame_8h.html#a13092663dddb1492d81571f9f0ae4506">AST_FORMAT_SIREN7</a>, <span class="stringliteral">&quot;siren7&quot;</span>, 16000, <span class="stringliteral">&quot;ITU G.722.1 (Siren7, licensed from Polycom)&quot;</span>, 80, 20, 80, 20, 20 },        <span class="comment">/*!&lt; Binary commercial distribution */</span>
<a name="l00121"></a>00121    { <a class="code" href="frame_8h.html#a590224283a5c1527fab938e4d02686cc">AST_FORMAT_SIREN14</a>, <span class="stringliteral">&quot;siren14&quot;</span>, 32000, <span class="stringliteral">&quot;ITU G.722.1 Annex C, (Siren14, licensed from Polycom)&quot;</span>, 120, 20, 80, 20, 20 }, <span class="comment">/*!&lt; Binary commercial distribution */</span>
<a name="l00122"></a>00122 };
<a name="l00123"></a>00123 
<a name="l00124"></a><a class="code" href="frame_8c.html#af203379aca2fd704fe8d86a9445596b6">00124</a> <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> <a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a> = { <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a29ff71f9d5c7927906ebd437fe372056">AST_FRAME_NULL</a>, };
<a name="l00125"></a>00125 
<a name="l00126"></a><a class="code" href="frame_8c.html#acb874d67b82b47620eb082453403f820">00126</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="frame_8c.html#acb874d67b82b47620eb082453403f820">smoother_frame_feed</a>(<span class="keyword">struct</span> <a class="code" href="structast__smoother.html">ast_smoother</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>, <span class="keywordtype">int</span> swap)
<a name="l00127"></a>00127 {
<a name="l00128"></a>00128    <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structast__smoother.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> &amp; <a class="code" href="frame_8h.html#a06828788896ac92282112bd8ffe12319">AST_SMOOTHER_FLAG_G729</a>) {
<a name="l00129"></a>00129       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structast__smoother.html#afed088663f8704004425cdae2120b9b3">len</a> % 10) {
<a name="l00130"></a>00130          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Dropping extra frame of G.729 since we already have a VAD frame at the end\n&quot;</span>);
<a name="l00131"></a>00131          <span class="keywordflow">return</span> 0;
<a name="l00132"></a>00132       }
<a name="l00133"></a>00133    }
<a name="l00134"></a>00134    <span class="keywordflow">if</span> (swap) {
<a name="l00135"></a>00135       <a class="code" href="frame_8h.html#ad3313ac3c6813594f1ea408e26505be7">ast_swapcopy_samples</a>(s-&gt;<a class="code" href="structast__smoother.html#ae5c0218650008c505b08356333bbe5b3">data</a> + s-&gt;<a class="code" href="structast__smoother.html#afed088663f8704004425cdae2120b9b3">len</a>, f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, f-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>);
<a name="l00136"></a>00136    } <span class="keywordflow">else</span> {
<a name="l00137"></a>00137       memcpy(s-&gt;<a class="code" href="structast__smoother.html#ae5c0218650008c505b08356333bbe5b3">data</a> + s-&gt;<a class="code" href="structast__smoother.html#afed088663f8704004425cdae2120b9b3">len</a>, f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>);
<a name="l00138"></a>00138    }
<a name="l00139"></a>00139    <span class="comment">/* If either side is empty, reset the delivery time */</span>
<a name="l00140"></a>00140    <span class="keywordflow">if</span> (!s-&gt;<a class="code" href="structast__smoother.html#afed088663f8704004425cdae2120b9b3">len</a> || <a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(f-&gt;<a class="code" href="structast__frame.html#a41a708025486b4c9383e7432e9ba3f0e">delivery</a>) || <a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(s-&gt;<a class="code" href="structast__smoother.html#a41a708025486b4c9383e7432e9ba3f0e">delivery</a>)) { <span class="comment">/* XXX really ? */</span>
<a name="l00141"></a>00141       s-&gt;<a class="code" href="structast__smoother.html#a41a708025486b4c9383e7432e9ba3f0e">delivery</a> = f-&gt;<a class="code" href="structast__frame.html#a41a708025486b4c9383e7432e9ba3f0e">delivery</a>;
<a name="l00142"></a>00142    }
<a name="l00143"></a>00143    s-&gt;<a class="code" href="structast__smoother.html#afed088663f8704004425cdae2120b9b3">len</a> += f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>;
<a name="l00144"></a>00144 
<a name="l00145"></a>00145    <span class="keywordflow">return</span> 0;
<a name="l00146"></a>00146 }
<a name="l00147"></a>00147 
<a name="l00148"></a><a class="code" href="frame_8c.html#add7324cf0482ce24eaa13abdc00e115d">00148</a> <span class="keywordtype">void</span> <a class="code" href="frame_8h.html#add7324cf0482ce24eaa13abdc00e115d">ast_smoother_reset</a>(<span class="keyword">struct</span> <a class="code" href="structast__smoother.html">ast_smoother</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, <span class="keywordtype">int</span> bytes)
<a name="l00149"></a>00149 {
<a name="l00150"></a>00150    memset(s, 0, <span class="keyword">sizeof</span>(*s));
<a name="l00151"></a>00151    s-&gt;<a class="code" href="structast__smoother.html#a439227feff9d7f55384e8780cfc2eb82">size</a> = bytes;
<a name="l00152"></a>00152 }
<a name="l00153"></a>00153 
<a name="l00154"></a><a class="code" href="frame_8c.html#a34c247d5417aed64069bbeac7fc09728">00154</a> <span class="keywordtype">void</span> <a class="code" href="frame_8h.html#a34c247d5417aed64069bbeac7fc09728" title="Reconfigure an existing smoother to output a different number of bytes per frame...">ast_smoother_reconfigure</a>(<span class="keyword">struct</span> <a class="code" href="structast__smoother.html">ast_smoother</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, <span class="keywordtype">int</span> bytes)
<a name="l00155"></a>00155 {
<a name="l00156"></a>00156    <span class="comment">/* if there is no change, then nothing to do */</span>
<a name="l00157"></a>00157    <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structast__smoother.html#a439227feff9d7f55384e8780cfc2eb82">size</a> == bytes) {
<a name="l00158"></a>00158       <span class="keywordflow">return</span>;
<a name="l00159"></a>00159    }
<a name="l00160"></a>00160    <span class="comment">/* set the new desired output size */</span>
<a name="l00161"></a>00161    s-&gt;<a class="code" href="structast__smoother.html#a439227feff9d7f55384e8780cfc2eb82">size</a> = bytes;
<a name="l00162"></a>00162    <span class="comment">/* if there is no &apos;optimized&apos; frame in the smoother,</span>
<a name="l00163"></a>00163 <span class="comment">    *   then there is nothing left to do</span>
<a name="l00164"></a>00164 <span class="comment">    */</span>
<a name="l00165"></a>00165    <span class="keywordflow">if</span> (!s-&gt;<a class="code" href="structast__smoother.html#a2707e7d39a01f2e9a557076acd901889">opt</a>) {
<a name="l00166"></a>00166       <span class="keywordflow">return</span>;
<a name="l00167"></a>00167    }
<a name="l00168"></a>00168    <span class="comment">/* there is an &apos;optimized&apos; frame here at the old size,</span>
<a name="l00169"></a>00169 <span class="comment">    * but it must now be put into the buffer so the data</span>
<a name="l00170"></a>00170 <span class="comment">    * can be extracted at the new size</span>
<a name="l00171"></a>00171 <span class="comment">    */</span>
<a name="l00172"></a>00172    <a class="code" href="frame_8c.html#acb874d67b82b47620eb082453403f820">smoother_frame_feed</a>(s, s-&gt;<a class="code" href="structast__smoother.html#a2707e7d39a01f2e9a557076acd901889">opt</a>, s-&gt;<a class="code" href="structast__smoother.html#aa0bab80f07b3d04d81bd3c9ae69e8b68">opt_needs_swap</a>);
<a name="l00173"></a>00173    s-&gt;<a class="code" href="structast__smoother.html#a2707e7d39a01f2e9a557076acd901889">opt</a> = NULL;
<a name="l00174"></a>00174 }
<a name="l00175"></a>00175 
<a name="l00176"></a><a class="code" href="frame_8c.html#a4cf7f3fd41e2c268159299ea54b36e33">00176</a> <span class="keyword">struct </span><a class="code" href="structast__smoother.html">ast_smoother</a> *<a class="code" href="frame_8h.html#a6f1c795e5db00c9eb553e540dce7a503">ast_smoother_new</a>(<span class="keywordtype">int</span> <a class="code" href="structast__smoother.html#a439227feff9d7f55384e8780cfc2eb82">size</a>)
<a name="l00177"></a>00177 {
<a name="l00178"></a>00178    <span class="keyword">struct </span><a class="code" href="structast__smoother.html">ast_smoother</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>;
<a name="l00179"></a>00179    <span class="keywordflow">if</span> (size &lt; 1)
<a name="l00180"></a>00180       <span class="keywordflow">return</span> NULL;
<a name="l00181"></a>00181    <span class="keywordflow">if</span> ((s = <a class="code" href="astmm_8h.html#a64a0e7a3ab511a3777ac56f5d43c628e">ast_malloc</a>(<span class="keyword">sizeof</span>(*s))))
<a name="l00182"></a>00182       <a class="code" href="frame_8h.html#add7324cf0482ce24eaa13abdc00e115d">ast_smoother_reset</a>(s, size);
<a name="l00183"></a>00183    <span class="keywordflow">return</span> s;
<a name="l00184"></a>00184 }
<a name="l00185"></a>00185 
<a name="l00186"></a><a class="code" href="frame_8c.html#a22e621d6147c80f2dd12ff75c2d8d3cc">00186</a> <span class="keywordtype">int</span> <a class="code" href="frame_8h.html#a6fc9579ac9888a2a92016034592c7d76">ast_smoother_get_flags</a>(<span class="keyword">struct</span> <a class="code" href="structast__smoother.html">ast_smoother</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l00187"></a>00187 {
<a name="l00188"></a>00188    <span class="keywordflow">return</span> s-&gt;<a class="code" href="structast__smoother.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a>;
<a name="l00189"></a>00189 }
<a name="l00190"></a>00190 
<a name="l00191"></a><a class="code" href="frame_8c.html#a3a3294d5c7260c90f2de7b65037055c5">00191</a> <span class="keywordtype">void</span> <a class="code" href="frame_8h.html#a2bf0a4739b534e4f317230763ec3afcb">ast_smoother_set_flags</a>(<span class="keyword">struct</span> <a class="code" href="structast__smoother.html">ast_smoother</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, <span class="keywordtype">int</span> <a class="code" href="structast__smoother.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a>)
<a name="l00192"></a>00192 {
<a name="l00193"></a>00193    s-&gt;<a class="code" href="structast__smoother.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> = flags;
<a name="l00194"></a>00194 }
<a name="l00195"></a>00195 
<a name="l00196"></a><a class="code" href="frame_8c.html#a3d6997c8a03e68d88c52f784c16c069f">00196</a> <span class="keywordtype">int</span> <a class="code" href="frame_8h.html#a3d6997c8a03e68d88c52f784c16c069f">ast_smoother_test_flag</a>(<span class="keyword">struct</span> <a class="code" href="structast__smoother.html">ast_smoother</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, <span class="keywordtype">int</span> flag)
<a name="l00197"></a>00197 {
<a name="l00198"></a>00198    <span class="keywordflow">return</span> (s-&gt;<a class="code" href="structast__smoother.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> &amp; flag);
<a name="l00199"></a>00199 }
<a name="l00200"></a>00200 
<a name="l00201"></a><a class="code" href="frame_8c.html#aa3ca9ba99227d1f76e44d2ceb32cc6f5">00201</a> <span class="keywordtype">int</span> <a class="code" href="frame_8h.html#aa3ca9ba99227d1f76e44d2ceb32cc6f5">__ast_smoother_feed</a>(<span class="keyword">struct</span> <a class="code" href="structast__smoother.html">ast_smoother</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>, <span class="keywordtype">int</span> swap)
<a name="l00202"></a>00202 {
<a name="l00203"></a>00203    <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> != <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>) {
<a name="l00204"></a>00204       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Huh?  Can&apos;t smooth a non-voice frame!\n&quot;</span>);
<a name="l00205"></a>00205       <span class="keywordflow">return</span> -1;
<a name="l00206"></a>00206    }
<a name="l00207"></a>00207    <span class="keywordflow">if</span> (!s-&gt;<a class="code" href="structast__smoother.html#a317afff57d87a89158c2b038d37b2b08">format</a>) {
<a name="l00208"></a>00208       s-&gt;<a class="code" href="structast__smoother.html#a317afff57d87a89158c2b038d37b2b08">format</a> = f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>;
<a name="l00209"></a>00209       s-&gt;<a class="code" href="structast__smoother.html#ace5328f4f85cf26835ca68604818271d">samplesperbyte</a> = (float)f-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> / (<span class="keywordtype">float</span>)f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>;
<a name="l00210"></a>00210    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structast__smoother.html#a317afff57d87a89158c2b038d37b2b08">format</a> != f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>) {
<a name="l00211"></a>00211       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Smoother was working on %d format frames, now trying to feed %d?\n&quot;</span>, s-&gt;<a class="code" href="structast__smoother.html#a317afff57d87a89158c2b038d37b2b08">format</a>, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>);
<a name="l00212"></a>00212       <span class="keywordflow">return</span> -1;
<a name="l00213"></a>00213    }
<a name="l00214"></a>00214    <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structast__smoother.html#afed088663f8704004425cdae2120b9b3">len</a> + f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> &gt; <a class="code" href="frame_8c.html#ad437b001eeca9b4ec5e30440de546bec">SMOOTHER_SIZE</a>) {
<a name="l00215"></a>00215       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Out of smoother space\n&quot;</span>);
<a name="l00216"></a>00216       <span class="keywordflow">return</span> -1;
<a name="l00217"></a>00217    }
<a name="l00218"></a>00218    <span class="keywordflow">if</span> (((f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> == s-&gt;<a class="code" href="structast__smoother.html#a439227feff9d7f55384e8780cfc2eb82">size</a>) ||
<a name="l00219"></a>00219         ((f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> &lt; 10) &amp;&amp; (s-&gt;<a class="code" href="structast__smoother.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> &amp; <a class="code" href="frame_8h.html#a06828788896ac92282112bd8ffe12319">AST_SMOOTHER_FLAG_G729</a>))) &amp;&amp;
<a name="l00220"></a>00220        !s-&gt;<a class="code" href="structast__smoother.html#a2707e7d39a01f2e9a557076acd901889">opt</a> &amp;&amp;
<a name="l00221"></a>00221        !s-&gt;<a class="code" href="structast__smoother.html#afed088663f8704004425cdae2120b9b3">len</a> &amp;&amp;
<a name="l00222"></a>00222        (f-&gt;<a class="code" href="structast__frame.html#aed7ea92f45bd273dde380a45ddced592">offset</a> &gt;= <a class="code" href="frame_8h.html#a0398e1e7020adf345eaaca6357f164b2">AST_MIN_OFFSET</a>)) {
<a name="l00223"></a>00223       <span class="comment">/* Optimize by sending the frame we just got</span>
<a name="l00224"></a>00224 <span class="comment">         on the next read, thus eliminating the douple</span>
<a name="l00225"></a>00225 <span class="comment">         copy */</span>
<a name="l00226"></a>00226       <span class="keywordflow">if</span> (swap)
<a name="l00227"></a>00227          <a class="code" href="frame_8h.html#ad3313ac3c6813594f1ea408e26505be7">ast_swapcopy_samples</a>(f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, f-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>);
<a name="l00228"></a>00228       s-&gt;<a class="code" href="structast__smoother.html#a2707e7d39a01f2e9a557076acd901889">opt</a> = f;
<a name="l00229"></a>00229       s-&gt;<a class="code" href="structast__smoother.html#aa0bab80f07b3d04d81bd3c9ae69e8b68">opt_needs_swap</a> = swap ? 1 : 0;
<a name="l00230"></a>00230       <span class="keywordflow">return</span> 0;
<a name="l00231"></a>00231    }
<a name="l00232"></a>00232 
<a name="l00233"></a>00233    <span class="keywordflow">return</span> <a class="code" href="frame_8c.html#acb874d67b82b47620eb082453403f820">smoother_frame_feed</a>(s, f, swap);
<a name="l00234"></a>00234 }
<a name="l00235"></a>00235 
<a name="l00236"></a><a class="code" href="frame_8c.html#af8d6dcd265eaf403b1b1139770c885d8">00236</a> <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="frame_8h.html#af8d6dcd265eaf403b1b1139770c885d8">ast_smoother_read</a>(<span class="keyword">struct</span> <a class="code" href="structast__smoother.html">ast_smoother</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l00237"></a>00237 {
<a name="l00238"></a>00238    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *opt;
<a name="l00239"></a>00239    <span class="keywordtype">int</span> <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;
<a name="l00240"></a>00240 
<a name="l00241"></a>00241    <span class="comment">/* IF we have an optimization frame, send it */</span>
<a name="l00242"></a>00242    <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structast__smoother.html#a2707e7d39a01f2e9a557076acd901889">opt</a>) {
<a name="l00243"></a>00243       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structast__smoother.html#a2707e7d39a01f2e9a557076acd901889">opt</a>-&gt;<a class="code" href="structast__frame.html#aed7ea92f45bd273dde380a45ddced592">offset</a> &lt; <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>)
<a name="l00244"></a>00244          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Returning a frame of inappropriate offset (%d).\n&quot;</span>,
<a name="l00245"></a>00245                      s-&gt;<a class="code" href="structast__smoother.html#a2707e7d39a01f2e9a557076acd901889">opt</a>-&gt;<a class="code" href="structast__frame.html#aed7ea92f45bd273dde380a45ddced592">offset</a>);
<a name="l00246"></a>00246       opt = s-&gt;<a class="code" href="structast__smoother.html#a2707e7d39a01f2e9a557076acd901889">opt</a>;
<a name="l00247"></a>00247       s-&gt;<a class="code" href="structast__smoother.html#a2707e7d39a01f2e9a557076acd901889">opt</a> = NULL;
<a name="l00248"></a>00248       <span class="keywordflow">return</span> opt;
<a name="l00249"></a>00249    }
<a name="l00250"></a>00250 
<a name="l00251"></a>00251    <span class="comment">/* Make sure we have enough data */</span>
<a name="l00252"></a>00252    <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structast__smoother.html#afed088663f8704004425cdae2120b9b3">len</a> &lt; s-&gt;<a class="code" href="structast__smoother.html#a439227feff9d7f55384e8780cfc2eb82">size</a>) {
<a name="l00253"></a>00253       <span class="comment">/* Or, if this is a G.729 frame with VAD on it, send it immediately anyway */</span>
<a name="l00254"></a>00254       <span class="keywordflow">if</span> (!((s-&gt;<a class="code" href="structast__smoother.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> &amp; <a class="code" href="frame_8h.html#a06828788896ac92282112bd8ffe12319">AST_SMOOTHER_FLAG_G729</a>) &amp;&amp; (s-&gt;<a class="code" href="structast__smoother.html#afed088663f8704004425cdae2120b9b3">len</a> % 10)))
<a name="l00255"></a>00255          <span class="keywordflow">return</span> NULL;
<a name="l00256"></a>00256    }
<a name="l00257"></a>00257    len = s-&gt;<a class="code" href="structast__smoother.html#a439227feff9d7f55384e8780cfc2eb82">size</a>;
<a name="l00258"></a>00258    <span class="keywordflow">if</span> (len &gt; s-&gt;<a class="code" href="structast__smoother.html#afed088663f8704004425cdae2120b9b3">len</a>)
<a name="l00259"></a>00259       len = s-&gt;<a class="code" href="structast__smoother.html#afed088663f8704004425cdae2120b9b3">len</a>;
<a name="l00260"></a>00260    <span class="comment">/* Make frame */</span>
<a name="l00261"></a>00261    s-&gt;<a class="code" href="structast__smoother.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>;
<a name="l00262"></a>00262    s-&gt;<a class="code" href="structast__smoother.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = s-&gt;<a class="code" href="structast__smoother.html#a317afff57d87a89158c2b038d37b2b08">format</a>;
<a name="l00263"></a>00263    s-&gt;<a class="code" href="structast__smoother.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> = s-&gt;<a class="code" href="structast__smoother.html#a9b5791c26a8c001bdd98e61634b7de5a">framedata</a> + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>;
<a name="l00264"></a>00264    s-&gt;<a class="code" href="structast__smoother.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#aed7ea92f45bd273dde380a45ddced592">offset</a> = <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>;
<a name="l00265"></a>00265    s-&gt;<a class="code" href="structast__smoother.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> = len;
<a name="l00266"></a>00266    <span class="comment">/* Samples will be improper given VAD, but with VAD the concept really doesn&apos;t even exist */</span>
<a name="l00267"></a>00267    s-&gt;<a class="code" href="structast__smoother.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> = len * s-&gt;<a class="code" href="structast__smoother.html#ace5328f4f85cf26835ca68604818271d">samplesperbyte</a>;   <span class="comment">/* XXX rounding */</span>
<a name="l00268"></a>00268    s-&gt;<a class="code" href="structast__smoother.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a41a708025486b4c9383e7432e9ba3f0e">delivery</a> = s-&gt;<a class="code" href="structast__smoother.html#a41a708025486b4c9383e7432e9ba3f0e">delivery</a>;
<a name="l00269"></a>00269    <span class="comment">/* Fill Data */</span>
<a name="l00270"></a>00270    memcpy(s-&gt;<a class="code" href="structast__smoother.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, s-&gt;<a class="code" href="structast__smoother.html#ae5c0218650008c505b08356333bbe5b3">data</a>, len);
<a name="l00271"></a>00271    s-&gt;<a class="code" href="structast__smoother.html#afed088663f8704004425cdae2120b9b3">len</a> -= len;
<a name="l00272"></a>00272    <span class="comment">/* Move remaining data to the front if applicable */</span>
<a name="l00273"></a>00273    <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structast__smoother.html#afed088663f8704004425cdae2120b9b3">len</a>) {
<a name="l00274"></a>00274       <span class="comment">/* In principle this should all be fine because if we are sending</span>
<a name="l00275"></a>00275 <span class="comment">         G.729 VAD, the next timestamp will take over anyawy */</span>
<a name="l00276"></a>00276       memmove(s-&gt;<a class="code" href="structast__smoother.html#ae5c0218650008c505b08356333bbe5b3">data</a>, s-&gt;<a class="code" href="structast__smoother.html#ae5c0218650008c505b08356333bbe5b3">data</a> + len, s-&gt;<a class="code" href="structast__smoother.html#afed088663f8704004425cdae2120b9b3">len</a>);
<a name="l00277"></a>00277       <span class="keywordflow">if</span> (!<a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(s-&gt;<a class="code" href="structast__smoother.html#a41a708025486b4c9383e7432e9ba3f0e">delivery</a>)) {
<a name="l00278"></a>00278          <span class="comment">/* If we have delivery time, increment it, otherwise, leave it at 0 */</span>
<a name="l00279"></a>00279          s-&gt;<a class="code" href="structast__smoother.html#a41a708025486b4c9383e7432e9ba3f0e">delivery</a> = <a class="code" href="time_8h.html#a97e1bb8fbd7a103212789e87e7ed6073" title="Returns the sum of two timevals a + b.">ast_tvadd</a>(s-&gt;<a class="code" href="structast__smoother.html#a41a708025486b4c9383e7432e9ba3f0e">delivery</a>, <a class="code" href="time_8h.html#a147d132412d7188c1dcebf25b8d31c0c" title="Returns a timeval corresponding to the duration of n samples at rate r. Useful to...">ast_samp2tv</a>(s-&gt;<a class="code" href="structast__smoother.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>, <a class="code" href="frame_8h.html#a29a7b93f4295966d4d441e91bff2b01e" title="Get the sample rate for a given format.">ast_format_rate</a>(s-&gt;<a class="code" href="structast__smoother.html#a317afff57d87a89158c2b038d37b2b08">format</a>)));
<a name="l00280"></a>00280       }
<a name="l00281"></a>00281    }
<a name="l00282"></a>00282    <span class="comment">/* Return frame */</span>
<a name="l00283"></a>00283    <span class="keywordflow">return</span> &amp;s-&gt;<a class="code" href="structast__smoother.html#a735f764b1095611ace084e7c6c06857d">f</a>;
<a name="l00284"></a>00284 }
<a name="l00285"></a>00285 
<a name="l00286"></a><a class="code" href="frame_8c.html#a6d3b71e0a81af743bae6c33c02b64f1f">00286</a> <span class="keywordtype">void</span> <a class="code" href="frame_8h.html#a6d3b71e0a81af743bae6c33c02b64f1f">ast_smoother_free</a>(<span class="keyword">struct</span> <a class="code" href="structast__smoother.html">ast_smoother</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l00287"></a>00287 {
<a name="l00288"></a>00288    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(s);
<a name="l00289"></a>00289 }
<a name="l00290"></a>00290 
<a name="l00291"></a><a class="code" href="frame_8c.html#aa3c3bdf906f259cea0aa33d7218b0e1e">00291</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="frame_8c.html#aa3c3bdf906f259cea0aa33d7218b0e1e">ast_frame_header_new</a>(<span class="keywordtype">void</span>)
<a name="l00292"></a>00292 {
<a name="l00293"></a>00293    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l00294"></a>00294 
<a name="l00295"></a>00295 <span class="preprocessor">#if !defined(LOW_MEMORY)</span>
<a name="l00296"></a>00296 <span class="preprocessor"></span>   <span class="keyword">struct </span><a class="code" href="structast__frame__cache.html">ast_frame_cache</a> *<a class="code" href="iax2-parser_8c.html#a61217d5bc9d5b446d9c08e7ca401b733">frames</a>;
<a name="l00297"></a>00297 
<a name="l00298"></a>00298    <span class="keywordflow">if</span> ((frames = <a class="code" href="threadstorage_8h.html#a9153839e218c987b2ae47cbd39ac1ab5" title="Retrieve thread storage.">ast_threadstorage_get</a>(&amp;<a class="code" href="frame_8c.html#a0aa5ff72fc86609f2fe7385e7747b52e">frame_cache</a>, <span class="keyword">sizeof</span>(*frames)))) {
<a name="l00299"></a>00299       <span class="keywordflow">if</span> ((f = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;frames-&gt;<a class="code" href="structast__frame__cache.html#a9c7b49f68e5d958a09c3628a40a4206f">list</a>, frame_list))) {
<a name="l00300"></a>00300          <span class="keywordtype">size_t</span> mallocd_len = f-&gt;<a class="code" href="structast__frame.html#a8cbff4a8245f6b7d82c011261cf1fb4d">mallocd_hdr_len</a>;
<a name="l00301"></a>00301          memset(f, 0, <span class="keyword">sizeof</span>(*f));
<a name="l00302"></a>00302          f-&gt;<a class="code" href="structast__frame.html#a8cbff4a8245f6b7d82c011261cf1fb4d">mallocd_hdr_len</a> = mallocd_len;
<a name="l00303"></a>00303          f-&gt;<a class="code" href="structast__frame.html#aed16590d48f41d89f31e0cf347f5cd99">mallocd</a> = <a class="code" href="frame_8h.html#a22c49dfda592a2adb1fbaeaaa6ed3b7f">AST_MALLOCD_HDR</a>;
<a name="l00304"></a>00304          frames-&gt;<a class="code" href="structast__frame__cache.html#a854352f53b148adc24983a58a1866d66">size</a>--;
<a name="l00305"></a>00305          <span class="keywordflow">return</span> f;
<a name="l00306"></a>00306       }
<a name="l00307"></a>00307    }
<a name="l00308"></a>00308    <span class="keywordflow">if</span> (!(f = <a class="code" href="astmm_8h.html#a690471dda49603174e7dd93a29fea87a">ast_calloc_cache</a>(1, <span class="keyword">sizeof</span>(*f))))
<a name="l00309"></a>00309       <span class="keywordflow">return</span> NULL;
<a name="l00310"></a>00310 <span class="preprocessor">#else</span>
<a name="l00311"></a>00311 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (!(f = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*f))))
<a name="l00312"></a>00312       <span class="keywordflow">return</span> NULL;
<a name="l00313"></a>00313 <span class="preprocessor">#endif</span>
<a name="l00314"></a>00314 <span class="preprocessor"></span>
<a name="l00315"></a>00315    f-&gt;<a class="code" href="structast__frame.html#a8cbff4a8245f6b7d82c011261cf1fb4d">mallocd_hdr_len</a> = <span class="keyword">sizeof</span>(*f);
<a name="l00316"></a>00316    
<a name="l00317"></a>00317    <span class="keywordflow">return</span> f;
<a name="l00318"></a>00318 }
<a name="l00319"></a>00319 
<a name="l00320"></a>00320 <span class="preprocessor">#if !defined(LOW_MEMORY)</span>
<a name="l00321"></a><a class="code" href="frame_8c.html#ae0047382e2ea1dac90f6f8c8dcd2bfb8">00321</a> <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="frame_8c.html#ae0047382e2ea1dac90f6f8c8dcd2bfb8">frame_cache_cleanup</a>(<span class="keywordtype">void</span> *data)
<a name="l00322"></a>00322 {
<a name="l00323"></a>00323    <span class="keyword">struct </span><a class="code" href="structast__frame__cache.html">ast_frame_cache</a> *<a class="code" href="iax2-parser_8c.html#a61217d5bc9d5b446d9c08e7ca401b733">frames</a> = data;
<a name="l00324"></a>00324    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l00325"></a>00325 
<a name="l00326"></a>00326    <span class="keywordflow">while</span> ((f = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;frames-&gt;<a class="code" href="structast__frame__cache.html#a9c7b49f68e5d958a09c3628a40a4206f">list</a>, frame_list)))
<a name="l00327"></a>00327       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(f);
<a name="l00328"></a>00328    
<a name="l00329"></a>00329    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(frames);
<a name="l00330"></a>00330 }
<a name="l00331"></a>00331 <span class="preprocessor">#endif</span>
<a name="l00332"></a>00332 <span class="preprocessor"></span>
<a name="l00333"></a><a class="code" href="frame_8c.html#aa621becb506e6b6c3c2a098944a14da8">00333</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="frame_8c.html#aa621becb506e6b6c3c2a098944a14da8">__frame_free</a>(<span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *fr, <span class="keywordtype">int</span> cache)
<a name="l00334"></a>00334 {
<a name="l00335"></a>00335    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(fr, <a class="code" href="frame_8h.html#a0ae1e3bf78c960c83e2d437efd802058a4a242fff9bd02b02c64a1515a85e15ce">AST_FRFLAG_FROM_TRANSLATOR</a>)) {
<a name="l00336"></a>00336       <a class="code" href="translate_8h.html#a9cbaad6d667527799974c89a8b3e467f" title="Hint that a frame from a translator has been freed.">ast_translate_frame_freed</a>(fr);
<a name="l00337"></a>00337    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(fr, <a class="code" href="frame_8h.html#a0ae1e3bf78c960c83e2d437efd802058a7500f97b39b4d91f3df7daa2435fc8fe">AST_FRFLAG_FROM_DSP</a>)) {
<a name="l00338"></a>00338       <a class="code" href="dsp_8h.html#a9a0a78f4d4ccd93a2eb131e3e67151f4" title="Hint that a frame from a dsp was freed.">ast_dsp_frame_freed</a>(fr);
<a name="l00339"></a>00339    }
<a name="l00340"></a>00340 
<a name="l00341"></a>00341    <span class="keywordflow">if</span> (!fr-&gt;<a class="code" href="structast__frame.html#aed16590d48f41d89f31e0cf347f5cd99">mallocd</a>)
<a name="l00342"></a>00342       <span class="keywordflow">return</span>;
<a name="l00343"></a>00343 
<a name="l00344"></a>00344 <span class="preprocessor">#if !defined(LOW_MEMORY)</span>
<a name="l00345"></a>00345 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (cache &amp;&amp; fr-&gt;<a class="code" href="structast__frame.html#aed16590d48f41d89f31e0cf347f5cd99">mallocd</a> == <a class="code" href="frame_8h.html#a22c49dfda592a2adb1fbaeaaa6ed3b7f">AST_MALLOCD_HDR</a>) {
<a name="l00346"></a>00346       <span class="comment">/* Cool, only the header is malloc&apos;d, let&apos;s just cache those for now </span>
<a name="l00347"></a>00347 <span class="comment">       * to keep things simple... */</span>
<a name="l00348"></a>00348       <span class="keyword">struct </span><a class="code" href="structast__frame__cache.html">ast_frame_cache</a> *<a class="code" href="iax2-parser_8c.html#a61217d5bc9d5b446d9c08e7ca401b733">frames</a>;
<a name="l00349"></a>00349 
<a name="l00350"></a>00350       <span class="keywordflow">if</span> ((frames = <a class="code" href="threadstorage_8h.html#a9153839e218c987b2ae47cbd39ac1ab5" title="Retrieve thread storage.">ast_threadstorage_get</a>(&amp;<a class="code" href="frame_8c.html#a0aa5ff72fc86609f2fe7385e7747b52e">frame_cache</a>, <span class="keyword">sizeof</span>(*frames))) &amp;&amp;
<a name="l00351"></a>00351           (frames-&gt;<a class="code" href="structast__frame__cache.html#a854352f53b148adc24983a58a1866d66">size</a> &lt; <a class="code" href="iax2-parser_8c.html#a5323507292adb03f4b5b83a23460d9d6">FRAME_CACHE_MAX_SIZE</a>)) {
<a name="l00352"></a>00352          <a class="code" href="linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307" title="Inserts a list entry at the head of a list.">AST_LIST_INSERT_HEAD</a>(&amp;frames-&gt;<a class="code" href="structast__frame__cache.html#a9c7b49f68e5d958a09c3628a40a4206f">list</a>, fr, frame_list);
<a name="l00353"></a>00353          frames-&gt;<a class="code" href="structast__frame__cache.html#a854352f53b148adc24983a58a1866d66">size</a>++;
<a name="l00354"></a>00354          <span class="keywordflow">return</span>;
<a name="l00355"></a>00355       }
<a name="l00356"></a>00356    }
<a name="l00357"></a>00357 <span class="preprocessor">#endif</span>
<a name="l00358"></a>00358 <span class="preprocessor"></span>   
<a name="l00359"></a>00359    <span class="keywordflow">if</span> (fr-&gt;<a class="code" href="structast__frame.html#aed16590d48f41d89f31e0cf347f5cd99">mallocd</a> &amp; <a class="code" href="frame_8h.html#a700f5f786d7e5a985387e5ce40c47a6a">AST_MALLOCD_DATA</a>) {
<a name="l00360"></a>00360       <span class="keywordflow">if</span> (fr-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>) 
<a name="l00361"></a>00361          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(fr-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> - fr-&gt;<a class="code" href="structast__frame.html#aed7ea92f45bd273dde380a45ddced592">offset</a>);
<a name="l00362"></a>00362    }
<a name="l00363"></a>00363    <span class="keywordflow">if</span> (fr-&gt;<a class="code" href="structast__frame.html#aed16590d48f41d89f31e0cf347f5cd99">mallocd</a> &amp; <a class="code" href="frame_8h.html#aa1644c06703f3d2e61318b559a090685">AST_MALLOCD_SRC</a>) {
<a name="l00364"></a>00364       <span class="keywordflow">if</span> (fr-&gt;<a class="code" href="structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a>)
<a name="l00365"></a>00365          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>((<span class="keywordtype">void</span> *) fr-&gt;<a class="code" href="structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a>);
<a name="l00366"></a>00366    }
<a name="l00367"></a>00367    <span class="keywordflow">if</span> (fr-&gt;<a class="code" href="structast__frame.html#aed16590d48f41d89f31e0cf347f5cd99">mallocd</a> &amp; <a class="code" href="frame_8h.html#a22c49dfda592a2adb1fbaeaaa6ed3b7f">AST_MALLOCD_HDR</a>) {
<a name="l00368"></a>00368       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(fr);
<a name="l00369"></a>00369    }
<a name="l00370"></a>00370 }
<a name="l00371"></a>00371 
<a name="l00372"></a>00372 
<a name="l00373"></a><a class="code" href="frame_8c.html#a3c004d3820bcf6ba492be693b67e1869">00373</a> <span class="keywordtype">void</span> <a class="code" href="frame_8h.html#a27385fd97f84847f7aa3b7bfcb861361" title="Requests a frame to be allocated.">ast_frame_free</a>(<span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *frame, <span class="keywordtype">int</span> cache)
<a name="l00374"></a>00374 {
<a name="l00375"></a>00375    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *next;
<a name="l00376"></a>00376 
<a name="l00377"></a>00377    <span class="keywordflow">for</span> (next = <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(frame, frame_list);
<a name="l00378"></a>00378         frame;
<a name="l00379"></a>00379         frame = next, next = frame ? <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(frame, frame_list) : NULL) {
<a name="l00380"></a>00380       <a class="code" href="frame_8c.html#aa621becb506e6b6c3c2a098944a14da8">__frame_free</a>(frame, cache);
<a name="l00381"></a>00381    }
<a name="l00382"></a>00382 }
<a name="l00383"></a>00383 <span class="comment"></span>
<a name="l00384"></a>00384 <span class="comment">/*!</span>
<a name="l00385"></a>00385 <span class="comment"> * \brief &apos;isolates&apos; a frame by duplicating non-malloc&apos;ed components</span>
<a name="l00386"></a>00386 <span class="comment"> * (header, src, data).</span>
<a name="l00387"></a>00387 <span class="comment"> * On return all components are malloc&apos;ed</span>
<a name="l00388"></a>00388 <span class="comment"> */</span>
<a name="l00389"></a><a class="code" href="frame_8c.html#aa7dbd9b12889d9f96fb6c01f94b4909e">00389</a> <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="frame_8h.html#aa7dbd9b12889d9f96fb6c01f94b4909e" title="Makes a frame independent of any static storage.">ast_frisolate</a>(<span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *fr)
<a name="l00390"></a>00390 {
<a name="l00391"></a>00391    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *out;
<a name="l00392"></a>00392    <span class="keywordtype">void</span> *newdata;
<a name="l00393"></a>00393 
<a name="l00394"></a>00394    <span class="comment">/* if none of the existing frame is malloc&apos;d, let ast_frdup() do it</span>
<a name="l00395"></a>00395 <span class="comment">      since it is more efficient</span>
<a name="l00396"></a>00396 <span class="comment">   */</span>
<a name="l00397"></a>00397    <span class="keywordflow">if</span> (fr-&gt;<a class="code" href="structast__frame.html#aed16590d48f41d89f31e0cf347f5cd99">mallocd</a> == 0) {
<a name="l00398"></a>00398       <span class="keywordflow">return</span> <a class="code" href="frame_8h.html#a4b23720d208128250a765490b1a4f145" title="Copies a frame.">ast_frdup</a>(fr);
<a name="l00399"></a>00399    }
<a name="l00400"></a>00400 
<a name="l00401"></a>00401    <span class="comment">/* if everything is already malloc&apos;d, we are done */</span>
<a name="l00402"></a>00402    <span class="keywordflow">if</span> ((fr-&gt;<a class="code" href="structast__frame.html#aed16590d48f41d89f31e0cf347f5cd99">mallocd</a> &amp; (<a class="code" href="frame_8h.html#a22c49dfda592a2adb1fbaeaaa6ed3b7f">AST_MALLOCD_HDR</a> | <a class="code" href="frame_8h.html#aa1644c06703f3d2e61318b559a090685">AST_MALLOCD_SRC</a> | <a class="code" href="frame_8h.html#a700f5f786d7e5a985387e5ce40c47a6a">AST_MALLOCD_DATA</a>)) ==
<a name="l00403"></a>00403        (<a class="code" href="frame_8h.html#a22c49dfda592a2adb1fbaeaaa6ed3b7f">AST_MALLOCD_HDR</a> | <a class="code" href="frame_8h.html#aa1644c06703f3d2e61318b559a090685">AST_MALLOCD_SRC</a> | <a class="code" href="frame_8h.html#a700f5f786d7e5a985387e5ce40c47a6a">AST_MALLOCD_DATA</a>)) {
<a name="l00404"></a>00404       <span class="keywordflow">return</span> fr;
<a name="l00405"></a>00405    }
<a name="l00406"></a>00406 
<a name="l00407"></a>00407    <span class="keywordflow">if</span> (!(fr-&gt;<a class="code" href="structast__frame.html#aed16590d48f41d89f31e0cf347f5cd99">mallocd</a> &amp; <a class="code" href="frame_8h.html#a22c49dfda592a2adb1fbaeaaa6ed3b7f">AST_MALLOCD_HDR</a>)) {
<a name="l00408"></a>00408       <span class="comment">/* Allocate a new header if needed */</span>
<a name="l00409"></a>00409       <span class="keywordflow">if</span> (!(out = <a class="code" href="frame_8c.html#aa3c3bdf906f259cea0aa33d7218b0e1e">ast_frame_header_new</a>())) {
<a name="l00410"></a>00410          <span class="keywordflow">return</span> NULL;
<a name="l00411"></a>00411       }
<a name="l00412"></a>00412       out-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = fr-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a>;
<a name="l00413"></a>00413       out-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = fr-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>;
<a name="l00414"></a>00414       out-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> = fr-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>;
<a name="l00415"></a>00415       out-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> = fr-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>;
<a name="l00416"></a>00416       out-&gt;<a class="code" href="structast__frame.html#aed7ea92f45bd273dde380a45ddced592">offset</a> = fr-&gt;<a class="code" href="structast__frame.html#aed7ea92f45bd273dde380a45ddced592">offset</a>;
<a name="l00417"></a>00417       <span class="comment">/* Copy the timing data */</span>
<a name="l00418"></a>00418       <a class="code" href="utils_8h.html#ab9da1c7265610eff83ed6146f104dc6f">ast_copy_flags</a>(out, fr, <a class="code" href="frame_8h.html#a0ae1e3bf78c960c83e2d437efd802058ae8f674e19f6450e2b746c8a52c11649a">AST_FRFLAG_HAS_TIMING_INFO</a>);
<a name="l00419"></a>00419       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(fr, <a class="code" href="frame_8h.html#a0ae1e3bf78c960c83e2d437efd802058ae8f674e19f6450e2b746c8a52c11649a">AST_FRFLAG_HAS_TIMING_INFO</a>)) {
<a name="l00420"></a>00420          out-&gt;<a class="code" href="structast__frame.html#a1eb46dcb363821328c0d2a758549216b">ts</a> = fr-&gt;<a class="code" href="structast__frame.html#a1eb46dcb363821328c0d2a758549216b">ts</a>;
<a name="l00421"></a>00421          out-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a> = fr-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a>;
<a name="l00422"></a>00422          out-&gt;<a class="code" href="structast__frame.html#ab793262012344621455faf9266acbac2">seqno</a> = fr-&gt;<a class="code" href="structast__frame.html#ab793262012344621455faf9266acbac2">seqno</a>;
<a name="l00423"></a>00423       }
<a name="l00424"></a>00424    } <span class="keywordflow">else</span> {
<a name="l00425"></a>00425       <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(fr, <a class="code" href="frame_8h.html#a0ae1e3bf78c960c83e2d437efd802058a4a242fff9bd02b02c64a1515a85e15ce">AST_FRFLAG_FROM_TRANSLATOR</a>);
<a name="l00426"></a>00426       <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(fr, <a class="code" href="frame_8h.html#a0ae1e3bf78c960c83e2d437efd802058a7500f97b39b4d91f3df7daa2435fc8fe">AST_FRFLAG_FROM_DSP</a>);
<a name="l00427"></a>00427       out = fr;
<a name="l00428"></a>00428    }
<a name="l00429"></a>00429    
<a name="l00430"></a>00430    <span class="keywordflow">if</span> (!(fr-&gt;<a class="code" href="structast__frame.html#aed16590d48f41d89f31e0cf347f5cd99">mallocd</a> &amp; <a class="code" href="frame_8h.html#aa1644c06703f3d2e61318b559a090685">AST_MALLOCD_SRC</a>) &amp;&amp; fr-&gt;<a class="code" href="structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a>) {
<a name="l00431"></a>00431       <span class="keywordflow">if</span> (!(out-&gt;<a class="code" href="structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(fr-&gt;<a class="code" href="structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a>))) {
<a name="l00432"></a>00432          <span class="keywordflow">if</span> (out != fr) {
<a name="l00433"></a>00433             <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(out);
<a name="l00434"></a>00434          }
<a name="l00435"></a>00435          <span class="keywordflow">return</span> NULL;
<a name="l00436"></a>00436       }
<a name="l00437"></a>00437    } <span class="keywordflow">else</span> {
<a name="l00438"></a>00438       out-&gt;<a class="code" href="structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a> = fr-&gt;<a class="code" href="structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a>;
<a name="l00439"></a>00439       fr-&gt;<a class="code" href="structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a> = NULL;
<a name="l00440"></a>00440       fr-&gt;<a class="code" href="structast__frame.html#aed16590d48f41d89f31e0cf347f5cd99">mallocd</a> &amp;= ~<a class="code" href="frame_8h.html#aa1644c06703f3d2e61318b559a090685">AST_MALLOCD_SRC</a>;
<a name="l00441"></a>00441    }
<a name="l00442"></a>00442    
<a name="l00443"></a>00443    <span class="keywordflow">if</span> (!(fr-&gt;<a class="code" href="structast__frame.html#aed16590d48f41d89f31e0cf347f5cd99">mallocd</a> &amp; <a class="code" href="frame_8h.html#a700f5f786d7e5a985387e5ce40c47a6a">AST_MALLOCD_DATA</a>))  {
<a name="l00444"></a>00444       <span class="keywordflow">if</span> (!fr-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>) {
<a name="l00445"></a>00445          out-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#a5ad776be1fb768f3399aafcd1b58b3a2">uint32</a> = fr-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#a5ad776be1fb768f3399aafcd1b58b3a2">uint32</a>;
<a name="l00446"></a>00446          out-&gt;<a class="code" href="structast__frame.html#aed16590d48f41d89f31e0cf347f5cd99">mallocd</a> = <a class="code" href="frame_8h.html#a22c49dfda592a2adb1fbaeaaa6ed3b7f">AST_MALLOCD_HDR</a> | <a class="code" href="frame_8h.html#aa1644c06703f3d2e61318b559a090685">AST_MALLOCD_SRC</a>;
<a name="l00447"></a>00447          <span class="keywordflow">return</span> out;
<a name="l00448"></a>00448       }
<a name="l00449"></a>00449       <span class="keywordflow">if</span> (!(newdata = <a class="code" href="astmm_8h.html#a64a0e7a3ab511a3777ac56f5d43c628e">ast_malloc</a>(fr-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>))) {
<a name="l00450"></a>00450          <span class="keywordflow">if</span> (out-&gt;<a class="code" href="structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a> != fr-&gt;<a class="code" href="structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a>) {
<a name="l00451"></a>00451             <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>((<span class="keywordtype">void</span> *) out-&gt;<a class="code" href="structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a>);
<a name="l00452"></a>00452          }
<a name="l00453"></a>00453          <span class="keywordflow">if</span> (out != fr) {
<a name="l00454"></a>00454             <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(out);
<a name="l00455"></a>00455          }
<a name="l00456"></a>00456          <span class="keywordflow">return</span> NULL;
<a name="l00457"></a>00457       }
<a name="l00458"></a>00458       newdata += <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>;
<a name="l00459"></a>00459       out-&gt;<a class="code" href="structast__frame.html#aed7ea92f45bd273dde380a45ddced592">offset</a> = <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>;
<a name="l00460"></a>00460       out-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> = fr-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>;
<a name="l00461"></a>00461       memcpy(newdata, fr-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, fr-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>);
<a name="l00462"></a>00462       out-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> = newdata;
<a name="l00463"></a>00463    } <span class="keywordflow">else</span> {
<a name="l00464"></a>00464       out-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a> = fr-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>;
<a name="l00465"></a>00465       memset(&amp;fr-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>, 0, <span class="keyword">sizeof</span>(fr-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>));
<a name="l00466"></a>00466       fr-&gt;<a class="code" href="structast__frame.html#aed16590d48f41d89f31e0cf347f5cd99">mallocd</a> &amp;= ~<a class="code" href="frame_8h.html#a700f5f786d7e5a985387e5ce40c47a6a">AST_MALLOCD_DATA</a>;
<a name="l00467"></a>00467    }
<a name="l00468"></a>00468 
<a name="l00469"></a>00469    out-&gt;<a class="code" href="structast__frame.html#aed16590d48f41d89f31e0cf347f5cd99">mallocd</a> = <a class="code" href="frame_8h.html#a22c49dfda592a2adb1fbaeaaa6ed3b7f">AST_MALLOCD_HDR</a> | <a class="code" href="frame_8h.html#aa1644c06703f3d2e61318b559a090685">AST_MALLOCD_SRC</a> | <a class="code" href="frame_8h.html#a700f5f786d7e5a985387e5ce40c47a6a">AST_MALLOCD_DATA</a>;
<a name="l00470"></a>00470    
<a name="l00471"></a>00471    <span class="keywordflow">return</span> out;
<a name="l00472"></a>00472 }
<a name="l00473"></a>00473 
<a name="l00474"></a><a class="code" href="frame_8c.html#a2a467ce3424859d1b6194c93f2cc05f5">00474</a> <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="frame_8h.html#a4b23720d208128250a765490b1a4f145" title="Copies a frame.">ast_frdup</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>)
<a name="l00475"></a>00475 {
<a name="l00476"></a>00476    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *out = NULL;
<a name="l00477"></a>00477    <span class="keywordtype">int</span> <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, srclen = 0;
<a name="l00478"></a>00478    <span class="keywordtype">void</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a> = NULL;
<a name="l00479"></a>00479 
<a name="l00480"></a>00480 <span class="preprocessor">#if !defined(LOW_MEMORY)</span>
<a name="l00481"></a>00481 <span class="preprocessor"></span>   <span class="keyword">struct </span><a class="code" href="structast__frame__cache.html">ast_frame_cache</a> *<a class="code" href="iax2-parser_8c.html#a61217d5bc9d5b446d9c08e7ca401b733">frames</a>;
<a name="l00482"></a>00482 <span class="preprocessor">#endif</span>
<a name="l00483"></a>00483 <span class="preprocessor"></span>
<a name="l00484"></a>00484    <span class="comment">/* Start with standard stuff */</span>
<a name="l00485"></a>00485    len = <span class="keyword">sizeof</span>(*out) + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a> + f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>;
<a name="l00486"></a>00486    <span class="comment">/* If we have a source, add space for it */</span>
<a name="l00487"></a>00487    <span class="comment">/*</span>
<a name="l00488"></a>00488 <span class="comment">    * XXX Watch out here - if we receive a src which is not terminated</span>
<a name="l00489"></a>00489 <span class="comment">    * properly, we can be easily attacked. Should limit the size we deal with.</span>
<a name="l00490"></a>00490 <span class="comment">    */</span>
<a name="l00491"></a>00491    <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a>)
<a name="l00492"></a>00492       srclen = strlen(f-&gt;<a class="code" href="structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a>);
<a name="l00493"></a>00493    <span class="keywordflow">if</span> (srclen &gt; 0)
<a name="l00494"></a>00494       len += srclen + 1;
<a name="l00495"></a>00495    
<a name="l00496"></a>00496 <span class="preprocessor">#if !defined(LOW_MEMORY)</span>
<a name="l00497"></a>00497 <span class="preprocessor"></span>   <span class="keywordflow">if</span> ((frames = <a class="code" href="threadstorage_8h.html#a9153839e218c987b2ae47cbd39ac1ab5" title="Retrieve thread storage.">ast_threadstorage_get</a>(&amp;<a class="code" href="frame_8c.html#a0aa5ff72fc86609f2fe7385e7747b52e">frame_cache</a>, <span class="keyword">sizeof</span>(*frames)))) {
<a name="l00498"></a>00498       <a class="code" href="linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d" title="Loops safely over (traverses) the entries in a list.">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(&amp;frames-&gt;<a class="code" href="structast__frame__cache.html#a9c7b49f68e5d958a09c3628a40a4206f">list</a>, out, frame_list) {
<a name="l00499"></a>00499          <span class="keywordflow">if</span> (out-&gt;<a class="code" href="structast__frame.html#a8cbff4a8245f6b7d82c011261cf1fb4d">mallocd_hdr_len</a> &gt;= len) {
<a name="l00500"></a>00500             <span class="keywordtype">size_t</span> mallocd_len = out-&gt;<a class="code" href="structast__frame.html#a8cbff4a8245f6b7d82c011261cf1fb4d">mallocd_hdr_len</a>;
<a name="l00501"></a>00501 
<a name="l00502"></a>00502             <a class="code" href="linkedlists_8h.html#aa8ac496fa9c717d5afb99a02e1e2760c" title="Removes the current entry from a list during a traversal.">AST_LIST_REMOVE_CURRENT</a>(frame_list);
<a name="l00503"></a>00503             memset(out, 0, <span class="keyword">sizeof</span>(*out));
<a name="l00504"></a>00504             out-&gt;<a class="code" href="structast__frame.html#a8cbff4a8245f6b7d82c011261cf1fb4d">mallocd_hdr_len</a> = mallocd_len;
<a name="l00505"></a>00505             buf = out;
<a name="l00506"></a>00506             frames-&gt;<a class="code" href="structast__frame__cache.html#a854352f53b148adc24983a58a1866d66">size</a>--;
<a name="l00507"></a>00507             <span class="keywordflow">break</span>;
<a name="l00508"></a>00508          }
<a name="l00509"></a>00509       }
<a name="l00510"></a>00510       <a class="code" href="linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9" title="Closes a safe loop traversal block.">AST_LIST_TRAVERSE_SAFE_END</a>;
<a name="l00511"></a>00511    }
<a name="l00512"></a>00512 <span class="preprocessor">#endif</span>
<a name="l00513"></a>00513 <span class="preprocessor"></span>
<a name="l00514"></a>00514    <span class="keywordflow">if</span> (!buf) {
<a name="l00515"></a>00515       <span class="keywordflow">if</span> (!(buf = <a class="code" href="astmm_8h.html#a690471dda49603174e7dd93a29fea87a">ast_calloc_cache</a>(1, len)))
<a name="l00516"></a>00516          <span class="keywordflow">return</span> NULL;
<a name="l00517"></a>00517       out = buf;
<a name="l00518"></a>00518       out-&gt;<a class="code" href="structast__frame.html#a8cbff4a8245f6b7d82c011261cf1fb4d">mallocd_hdr_len</a> = len;
<a name="l00519"></a>00519    }
<a name="l00520"></a>00520 
<a name="l00521"></a>00521    out-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a>;
<a name="l00522"></a>00522    out-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>;
<a name="l00523"></a>00523    out-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> = f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>;
<a name="l00524"></a>00524    out-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> = f-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>;
<a name="l00525"></a>00525    out-&gt;<a class="code" href="structast__frame.html#a41a708025486b4c9383e7432e9ba3f0e">delivery</a> = f-&gt;<a class="code" href="structast__frame.html#a41a708025486b4c9383e7432e9ba3f0e">delivery</a>;
<a name="l00526"></a>00526    <span class="comment">/* Set us as having malloc&apos;d header only, so it will eventually</span>
<a name="l00527"></a>00527 <span class="comment">      get freed. */</span>
<a name="l00528"></a>00528    out-&gt;<a class="code" href="structast__frame.html#aed16590d48f41d89f31e0cf347f5cd99">mallocd</a> = <a class="code" href="frame_8h.html#a22c49dfda592a2adb1fbaeaaa6ed3b7f">AST_MALLOCD_HDR</a>;
<a name="l00529"></a>00529    out-&gt;<a class="code" href="structast__frame.html#aed7ea92f45bd273dde380a45ddced592">offset</a> = <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>;
<a name="l00530"></a>00530    <span class="keywordflow">if</span> (out-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>) {
<a name="l00531"></a>00531       out-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> = buf + <span class="keyword">sizeof</span>(*out) + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>;
<a name="l00532"></a>00532       memcpy(out-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, out-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>);  
<a name="l00533"></a>00533    } <span class="keywordflow">else</span> {
<a name="l00534"></a>00534       out-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#a5ad776be1fb768f3399aafcd1b58b3a2">uint32</a> = f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#a5ad776be1fb768f3399aafcd1b58b3a2">uint32</a>;
<a name="l00535"></a>00535    }
<a name="l00536"></a>00536    <span class="keywordflow">if</span> (srclen &gt; 0) {
<a name="l00537"></a>00537       <span class="comment">/* This may seem a little strange, but it&apos;s to avoid a gcc (4.2.4) compiler warning */</span>
<a name="l00538"></a>00538       <span class="keywordtype">char</span> *src;
<a name="l00539"></a>00539       out-&gt;<a class="code" href="structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a> = buf + <span class="keyword">sizeof</span>(*out) + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a> + f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>;
<a name="l00540"></a>00540       src = (<span class="keywordtype">char</span> *) out-&gt;<a class="code" href="structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a>;
<a name="l00541"></a>00541       <span class="comment">/* Must have space since we allocated for it */</span>
<a name="l00542"></a>00542       strcpy(src, f-&gt;<a class="code" href="structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a>);
<a name="l00543"></a>00543    }
<a name="l00544"></a>00544    <a class="code" href="utils_8h.html#ab9da1c7265610eff83ed6146f104dc6f">ast_copy_flags</a>(out, f, <a class="code" href="frame_8h.html#a0ae1e3bf78c960c83e2d437efd802058ae8f674e19f6450e2b746c8a52c11649a">AST_FRFLAG_HAS_TIMING_INFO</a>);
<a name="l00545"></a>00545    out-&gt;<a class="code" href="structast__frame.html#a1eb46dcb363821328c0d2a758549216b">ts</a> = f-&gt;<a class="code" href="structast__frame.html#a1eb46dcb363821328c0d2a758549216b">ts</a>;
<a name="l00546"></a>00546    out-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a> = f-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a>;
<a name="l00547"></a>00547    out-&gt;<a class="code" href="structast__frame.html#ab793262012344621455faf9266acbac2">seqno</a> = f-&gt;<a class="code" href="structast__frame.html#ab793262012344621455faf9266acbac2">seqno</a>;
<a name="l00548"></a>00548    <span class="keywordflow">return</span> out;
<a name="l00549"></a>00549 }
<a name="l00550"></a>00550 
<a name="l00551"></a><a class="code" href="frame_8c.html#ad3313ac3c6813594f1ea408e26505be7">00551</a> <span class="keywordtype">void</span> <a class="code" href="frame_8h.html#ad3313ac3c6813594f1ea408e26505be7">ast_swapcopy_samples</a>(<span class="keywordtype">void</span> *dst, <span class="keyword">const</span> <span class="keywordtype">void</span> *src, <span class="keywordtype">int</span> samples)
<a name="l00552"></a>00552 {
<a name="l00553"></a>00553    <span class="keywordtype">int</span> i;
<a name="l00554"></a>00554    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *dst_s = dst;
<a name="l00555"></a>00555    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *src_s = src;
<a name="l00556"></a>00556 
<a name="l00557"></a>00557    <span class="keywordflow">for</span> (i = 0; i &lt; samples; i++)
<a name="l00558"></a>00558       dst_s[i] = (src_s[i]&lt;&lt;8) | (src_s[i]&gt;&gt;8);
<a name="l00559"></a>00559 }
<a name="l00560"></a>00560 
<a name="l00561"></a>00561 
<a name="l00562"></a><a class="code" href="frame_8c.html#ae4f8e9142a346cf35e65200969b587ca">00562</a> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structast__format__list.html" title="Definition of supported media formats (codecs).">ast_format_list</a> *<a class="code" href="frame_8h.html#a268ae14fc66757a5491831e30560a476">ast_get_format_list_index</a>(<span class="keywordtype">int</span> idx) 
<a name="l00563"></a>00563 {
<a name="l00564"></a>00564    <span class="keywordflow">return</span> &amp;AST_FORMAT_LIST[idx];
<a name="l00565"></a>00565 }
<a name="l00566"></a>00566 
<a name="l00567"></a><a class="code" href="frame_8c.html#a7a74b26c677d2372f9b90b3a38d03b14">00567</a> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structast__format__list.html" title="Definition of supported media formats (codecs).">ast_format_list</a> *<a class="code" href="frame_8h.html#a7a74b26c677d2372f9b90b3a38d03b14">ast_get_format_list</a>(<span class="keywordtype">size_t</span> *size) 
<a name="l00568"></a>00568 {
<a name="l00569"></a>00569    *size = <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(AST_FORMAT_LIST);
<a name="l00570"></a>00570    <span class="keywordflow">return</span> AST_FORMAT_LIST;
<a name="l00571"></a>00571 }
<a name="l00572"></a>00572 
<a name="l00573"></a><a class="code" href="frame_8c.html#afe8f690984f8ba95cd01a431198c10bf">00573</a> <span class="keywordtype">char</span>* <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(<span class="keywordtype">int</span> <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>)
<a name="l00574"></a>00574 {
<a name="l00575"></a>00575    <span class="keywordtype">int</span> x;
<a name="l00576"></a>00576    <span class="keywordtype">char</span> *ret = <span class="stringliteral">&quot;unknown&quot;</span>;
<a name="l00577"></a>00577    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(AST_FORMAT_LIST); x++) {
<a name="l00578"></a>00578       <span class="keywordflow">if</span> (AST_FORMAT_LIST[x].<a class="code" href="structast__format__list.html#ad1e28a1a66a25529b0b61b9ca4e66d44">bits</a> == format) {
<a name="l00579"></a>00579          ret = AST_FORMAT_LIST[x].<a class="code" href="structast__format__list.html#a5ac083a645d964373f022d03df4849c8">name</a>;
<a name="l00580"></a>00580          <span class="keywordflow">break</span>;
<a name="l00581"></a>00581       }
<a name="l00582"></a>00582    }
<a name="l00583"></a>00583    <span class="keywordflow">return</span> ret;
<a name="l00584"></a>00584 }
<a name="l00585"></a>00585 
<a name="l00586"></a><a class="code" href="frame_8c.html#a37cdc7e78686b0bfa4e47e645f782b30">00586</a> <span class="keywordtype">char</span> *<a class="code" href="frame_8h.html#a37cdc7e78686b0bfa4e47e645f782b30" title="Get the names of a set of formats.">ast_getformatname_multiple</a>(<span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <span class="keywordtype">size_t</span> size, <span class="keywordtype">int</span> <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>)
<a name="l00587"></a>00587 {
<a name="l00588"></a>00588    <span class="keywordtype">int</span> x;
<a name="l00589"></a>00589    <span class="keywordtype">unsigned</span> <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;
<a name="l00590"></a>00590    <span class="keywordtype">char</span> *start, *end = buf;
<a name="l00591"></a>00591 
<a name="l00592"></a>00592    <span class="keywordflow">if</span> (!size)
<a name="l00593"></a>00593       <span class="keywordflow">return</span> buf;
<a name="l00594"></a>00594    snprintf(end, size, <span class="stringliteral">&quot;0x%x (&quot;</span>, format);
<a name="l00595"></a>00595    len = strlen(end);
<a name="l00596"></a>00596    end += len;
<a name="l00597"></a>00597    size -= len;
<a name="l00598"></a>00598    start = end;
<a name="l00599"></a>00599    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(AST_FORMAT_LIST); x++) {
<a name="l00600"></a>00600       <span class="keywordflow">if</span> (AST_FORMAT_LIST[x].<a class="code" href="structast__format__list.html#ad1e28a1a66a25529b0b61b9ca4e66d44">bits</a> &amp; format) {
<a name="l00601"></a>00601          snprintf(end, size,<span class="stringliteral">&quot;%s|&quot;</span>,AST_FORMAT_LIST[x].<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l00602"></a>00602          len = strlen(end);
<a name="l00603"></a>00603          end += len;
<a name="l00604"></a>00604          size -= len;
<a name="l00605"></a>00605       }
<a name="l00606"></a>00606    }
<a name="l00607"></a>00607    <span class="keywordflow">if</span> (start == end)
<a name="l00608"></a>00608       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(start, <span class="stringliteral">&quot;nothing)&quot;</span>, size);
<a name="l00609"></a>00609    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (size &gt; 1)
<a name="l00610"></a>00610       *(end -1) = <span class="charliteral">&apos;)&apos;</span>;
<a name="l00611"></a>00611    <span class="keywordflow">return</span> buf;
<a name="l00612"></a>00612 }
<a name="l00613"></a>00613 
<a name="l00614"></a><a class="code" href="structast__codec__alias__table.html">00614</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__codec__alias__table.html">ast_codec_alias_table</a> {
<a name="l00615"></a><a class="code" href="structast__codec__alias__table.html#a9027b352db4085a0122952932d065705">00615</a>    <span class="keywordtype">char</span> *<a class="code" href="structast__codec__alias__table.html#a9027b352db4085a0122952932d065705">alias</a>;
<a name="l00616"></a><a class="code" href="structast__codec__alias__table.html#a980ab011cd3d327b370c042833f1dc08">00616</a>    <span class="keywordtype">char</span> *<a class="code" href="structast__codec__alias__table.html#a980ab011cd3d327b370c042833f1dc08">realname</a>;
<a name="l00617"></a>00617 } <a class="code" href="structast__codec__alias__table.html">ast_codec_alias_table</a>[] = {
<a name="l00618"></a>00618    { <span class="stringliteral">&quot;slinear&quot;</span>, <span class="stringliteral">&quot;slin&quot;</span>},
<a name="l00619"></a>00619    { <span class="stringliteral">&quot;slinear16&quot;</span>, <span class="stringliteral">&quot;slin16&quot;</span>},
<a name="l00620"></a>00620    { <span class="stringliteral">&quot;g723.1&quot;</span>, <span class="stringliteral">&quot;g723&quot;</span>},
<a name="l00621"></a>00621    { <span class="stringliteral">&quot;g722.1&quot;</span>, <span class="stringliteral">&quot;siren7&quot;</span>},
<a name="l00622"></a>00622    { <span class="stringliteral">&quot;g722.1c&quot;</span>, <span class="stringliteral">&quot;siren14&quot;</span>},
<a name="l00623"></a>00623 };
<a name="l00624"></a>00624 
<a name="l00625"></a><a class="code" href="frame_8c.html#a8ce634275e2d4e37422332eb8fbdc5dd">00625</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="frame_8c.html#a8ce634275e2d4e37422332eb8fbdc5dd">ast_expand_codec_alias</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *in)
<a name="l00626"></a>00626 {
<a name="l00627"></a>00627    <span class="keywordtype">int</span> x;
<a name="l00628"></a>00628 
<a name="l00629"></a>00629    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="structast__codec__alias__table.html">ast_codec_alias_table</a>); x++) {
<a name="l00630"></a>00630       <span class="keywordflow">if</span> (!strcmp(in,<a class="code" href="structast__codec__alias__table.html">ast_codec_alias_table</a>[x].alias))
<a name="l00631"></a>00631          <span class="keywordflow">return</span> <a class="code" href="structast__codec__alias__table.html">ast_codec_alias_table</a>[x].realname;
<a name="l00632"></a>00632    }
<a name="l00633"></a>00633    <span class="keywordflow">return</span> in;
<a name="l00634"></a>00634 }
<a name="l00635"></a>00635 
<a name="l00636"></a><a class="code" href="frame_8c.html#a2cf30450cd1821bfbc77d2d9e3605363">00636</a> <span class="keywordtype">int</span> <a class="code" href="frame_8h.html#a2cf30450cd1821bfbc77d2d9e3605363" title="Gets a format from a name.">ast_getformatbyname</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>)
<a name="l00637"></a>00637 {
<a name="l00638"></a>00638    <span class="keywordtype">int</span> x, all, <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a> = 0;
<a name="l00639"></a>00639 
<a name="l00640"></a>00640    all = strcasecmp(name, <span class="stringliteral">&quot;all&quot;</span>) ? 0 : 1;
<a name="l00641"></a>00641    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(AST_FORMAT_LIST); x++) {
<a name="l00642"></a>00642       <span class="keywordflow">if</span> (all || 
<a name="l00643"></a>00643            !strcasecmp(AST_FORMAT_LIST[x].name,name) ||
<a name="l00644"></a>00644            !strcasecmp(AST_FORMAT_LIST[x].name, <a class="code" href="frame_8c.html#a8ce634275e2d4e37422332eb8fbdc5dd">ast_expand_codec_alias</a>(name))) {
<a name="l00645"></a>00645          format |= AST_FORMAT_LIST[x].<a class="code" href="structast__format__list.html#ad1e28a1a66a25529b0b61b9ca4e66d44">bits</a>;
<a name="l00646"></a>00646          <span class="keywordflow">if</span> (!all)
<a name="l00647"></a>00647             <span class="keywordflow">break</span>;
<a name="l00648"></a>00648       }
<a name="l00649"></a>00649    }
<a name="l00650"></a>00650 
<a name="l00651"></a>00651    <span class="keywordflow">return</span> format;
<a name="l00652"></a>00652 }
<a name="l00653"></a>00653 
<a name="l00654"></a><a class="code" href="frame_8c.html#ab492fdbd06591d26ff743d440cc0594f">00654</a> <span class="keywordtype">char</span> *<a class="code" href="frame_8h.html#ab492fdbd06591d26ff743d440cc0594f" title="Get a name from a format Gets a name from a format.">ast_codec2str</a>(<span class="keywordtype">int</span> codec)
<a name="l00655"></a>00655 {
<a name="l00656"></a>00656    <span class="keywordtype">int</span> x;
<a name="l00657"></a>00657    <span class="keywordtype">char</span> *ret = <span class="stringliteral">&quot;unknown&quot;</span>;
<a name="l00658"></a>00658    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(AST_FORMAT_LIST); x++) {
<a name="l00659"></a>00659       <span class="keywordflow">if</span> (AST_FORMAT_LIST[x].bits == codec) {
<a name="l00660"></a>00660          ret = AST_FORMAT_LIST[x].<a class="code" href="structast__format__list.html#a3aad16fd4bea1b9717f232ea75ad6449">desc</a>;
<a name="l00661"></a>00661          <span class="keywordflow">break</span>;
<a name="l00662"></a>00662       }
<a name="l00663"></a>00663    }
<a name="l00664"></a>00664    <span class="keywordflow">return</span> ret;
<a name="l00665"></a>00665 }
<a name="l00666"></a>00666 
<a name="l00667"></a><a class="code" href="frame_8c.html#a8e79daabbe43ccf4880e628c7e712b38">00667</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="frame_8c.html#a8e79daabbe43ccf4880e628c7e712b38">show_codecs</a>(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="structast__cli__args.html">ast_cli_args</a> *a)
<a name="l00668"></a>00668 {
<a name="l00669"></a>00669    <span class="keywordtype">int</span> i, found=0;
<a name="l00670"></a>00670    <span class="keywordtype">char</span> hex[25];
<a name="l00671"></a>00671 
<a name="l00672"></a>00672    <span class="keywordflow">switch</span> (cmd) {
<a name="l00673"></a>00673    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l00674"></a>00674       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;core show codecs [audio|video|image]&quot;</span>;
<a name="l00675"></a>00675       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> = 
<a name="l00676"></a>00676          <span class="stringliteral">&quot;Usage: core show codecs [audio|video|image]\n&quot;</span>
<a name="l00677"></a>00677          <span class="stringliteral">&quot;       Displays codec mapping\n&quot;</span>;
<a name="l00678"></a>00678       <span class="keywordflow">return</span> NULL;
<a name="l00679"></a>00679    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l00680"></a>00680       <span class="keywordflow">return</span> NULL;
<a name="l00681"></a>00681    }
<a name="l00682"></a>00682    
<a name="l00683"></a>00683    <span class="keywordflow">if</span> ((a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> &lt; 3) || (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> &gt; 4))
<a name="l00684"></a>00684       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l00685"></a>00685 
<a name="l00686"></a>00686    <span class="keywordflow">if</span> (!<a class="code" href="options_8h.html#a5240f07b6ff8003ff47b856d44ef7226">ast_opt_dont_warn</a>)
<a name="l00687"></a>00687       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Disclaimer: this command is for informational purposes only.\n&quot;</span>
<a name="l00688"></a>00688             <span class="stringliteral">&quot;\tIt does not indicate anything about your configuration.\n&quot;</span>);
<a name="l00689"></a>00689 
<a name="l00690"></a>00690    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;%11s %9s %10s   TYPE   %8s   %s\n&quot;</span>,<span class="stringliteral">&quot;INT&quot;</span>,<span class="stringliteral">&quot;BINARY&quot;</span>,<span class="stringliteral">&quot;HEX&quot;</span>,<span class="stringliteral">&quot;NAME&quot;</span>,<span class="stringliteral">&quot;DESC&quot;</span>);
<a name="l00691"></a>00691    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;--------------------------------------------------------------------------------\n&quot;</span>);
<a name="l00692"></a>00692    <span class="keywordflow">if</span> ((a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> == 3) || (!strcasecmp(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3],<span class="stringliteral">&quot;audio&quot;</span>))) {
<a name="l00693"></a>00693       found = 1;
<a name="l00694"></a>00694       <span class="keywordflow">for</span> (i=0;i&lt;13;i++) {
<a name="l00695"></a>00695          snprintf(hex,25,<span class="stringliteral">&quot;(0x%x)&quot;</span>,1&lt;&lt;i);
<a name="l00696"></a>00696          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;%11u (1 &lt;&lt; %2d) %10s  audio   %8s   (%s)\n&quot;</span>,1 &lt;&lt; i,i,hex,<a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(1&lt;&lt;i),<a class="code" href="frame_8h.html#ab492fdbd06591d26ff743d440cc0594f" title="Get a name from a format Gets a name from a format.">ast_codec2str</a>(1&lt;&lt;i));
<a name="l00697"></a>00697       }
<a name="l00698"></a>00698    }
<a name="l00699"></a>00699 
<a name="l00700"></a>00700    <span class="keywordflow">if</span> ((a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> == 3) || (!strcasecmp(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3],<span class="stringliteral">&quot;image&quot;</span>))) {
<a name="l00701"></a>00701       found = 1;
<a name="l00702"></a>00702       <span class="keywordflow">for</span> (i=16;i&lt;18;i++) {
<a name="l00703"></a>00703          snprintf(hex,25,<span class="stringliteral">&quot;(0x%x)&quot;</span>,1&lt;&lt;i);
<a name="l00704"></a>00704          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;%11u (1 &lt;&lt; %2d) %10s  image   %8s   (%s)\n&quot;</span>,1 &lt;&lt; i,i,hex,<a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(1&lt;&lt;i),<a class="code" href="frame_8h.html#ab492fdbd06591d26ff743d440cc0594f" title="Get a name from a format Gets a name from a format.">ast_codec2str</a>(1&lt;&lt;i));
<a name="l00705"></a>00705       }
<a name="l00706"></a>00706    }
<a name="l00707"></a>00707 
<a name="l00708"></a>00708    <span class="keywordflow">if</span> ((a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> == 3) || (!strcasecmp(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3],<span class="stringliteral">&quot;video&quot;</span>))) {
<a name="l00709"></a>00709       found = 1;
<a name="l00710"></a>00710       <span class="keywordflow">for</span> (i=18;i&lt;22;i++) {
<a name="l00711"></a>00711          snprintf(hex,25,<span class="stringliteral">&quot;(0x%x)&quot;</span>,1&lt;&lt;i);
<a name="l00712"></a>00712          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;%11u (1 &lt;&lt; %2d) %10s  video   %8s   (%s)\n&quot;</span>,1 &lt;&lt; i,i,hex,<a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(1&lt;&lt;i),<a class="code" href="frame_8h.html#ab492fdbd06591d26ff743d440cc0594f" title="Get a name from a format Gets a name from a format.">ast_codec2str</a>(1&lt;&lt;i));
<a name="l00713"></a>00713       }
<a name="l00714"></a>00714    }
<a name="l00715"></a>00715 
<a name="l00716"></a>00716    <span class="keywordflow">if</span> (!found)
<a name="l00717"></a>00717       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l00718"></a>00718    <span class="keywordflow">else</span>
<a name="l00719"></a>00719       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l00720"></a>00720 }
<a name="l00721"></a>00721 
<a name="l00722"></a><a class="code" href="frame_8c.html#a151c4ff0b1d8addf7ec1f81c553ea084">00722</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="frame_8c.html#a151c4ff0b1d8addf7ec1f81c553ea084">show_codec_n</a>(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="structast__cli__args.html">ast_cli_args</a> *a)
<a name="l00723"></a>00723 {
<a name="l00724"></a>00724    <span class="keywordtype">int</span> codec, i, found=0;
<a name="l00725"></a>00725 
<a name="l00726"></a>00726    <span class="keywordflow">switch</span> (cmd) {
<a name="l00727"></a>00727    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l00728"></a>00728       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;core show codec&quot;</span>;
<a name="l00729"></a>00729       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> = 
<a name="l00730"></a>00730          <span class="stringliteral">&quot;Usage: core show codec &lt;number&gt;\n&quot;</span>
<a name="l00731"></a>00731          <span class="stringliteral">&quot;       Displays codec mapping\n&quot;</span>;
<a name="l00732"></a>00732       <span class="keywordflow">return</span> NULL;
<a name="l00733"></a>00733    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l00734"></a>00734       <span class="keywordflow">return</span> NULL;
<a name="l00735"></a>00735    }
<a name="l00736"></a>00736 
<a name="l00737"></a>00737    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != 4)
<a name="l00738"></a>00738       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l00739"></a>00739 
<a name="l00740"></a>00740    <span class="keywordflow">if</span> (sscanf(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3], <span class="stringliteral">&quot;%30d&quot;</span>, &amp;codec) != 1)
<a name="l00741"></a>00741       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l00742"></a>00742 
<a name="l00743"></a>00743    <span class="keywordflow">for</span> (i = 0; i &lt; 32; i++)
<a name="l00744"></a>00744       <span class="keywordflow">if</span> (codec &amp; (1 &lt;&lt; i)) {
<a name="l00745"></a>00745          found = 1;
<a name="l00746"></a>00746          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;%11u (1 &lt;&lt; %2d)  %s\n&quot;</span>,1 &lt;&lt; i,i,<a class="code" href="frame_8h.html#ab492fdbd06591d26ff743d440cc0594f" title="Get a name from a format Gets a name from a format.">ast_codec2str</a>(1&lt;&lt;i));
<a name="l00747"></a>00747       }
<a name="l00748"></a>00748 
<a name="l00749"></a>00749    <span class="keywordflow">if</span> (!found)
<a name="l00750"></a>00750       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Codec %d not found\n&quot;</span>, codec);
<a name="l00751"></a>00751 
<a name="l00752"></a>00752    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l00753"></a>00753 }
<a name="l00754"></a>00754 <span class="comment"></span>
<a name="l00755"></a>00755 <span class="comment">/*! Dump a frame for debugging purposes */</span>
<a name="l00756"></a><a class="code" href="frame_8c.html#a35641692b96e9e81da06d8d36e677cb8">00756</a> <span class="keywordtype">void</span> <a class="code" href="frame_8h.html#a35641692b96e9e81da06d8d36e677cb8">ast_frame_dump</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>, <span class="keywordtype">char</span> *<a class="code" href="http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a>)
<a name="l00757"></a>00757 {
<a name="l00758"></a>00758    <span class="keyword">const</span> <span class="keywordtype">char</span> noname[] = <span class="stringliteral">&quot;unknown&quot;</span>;
<a name="l00759"></a>00759    <span class="keywordtype">char</span> ftype[40] = <span class="stringliteral">&quot;Unknown Frametype&quot;</span>;
<a name="l00760"></a>00760    <span class="keywordtype">char</span> cft[80];
<a name="l00761"></a>00761    <span class="keywordtype">char</span> subclass[40] = <span class="stringliteral">&quot;Unknown Subclass&quot;</span>;
<a name="l00762"></a>00762    <span class="keywordtype">char</span> csub[80];
<a name="l00763"></a>00763    <span class="keywordtype">char</span> moreinfo[40] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00764"></a>00764    <span class="keywordtype">char</span> cn[60];
<a name="l00765"></a>00765    <span class="keywordtype">char</span> cp[40];
<a name="l00766"></a>00766    <span class="keywordtype">char</span> cmn[40];
<a name="l00767"></a>00767    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structmessage.html">message</a> = <span class="stringliteral">&quot;Unknown&quot;</span>;
<a name="l00768"></a>00768 
<a name="l00769"></a>00769    <span class="keywordflow">if</span> (!name)
<a name="l00770"></a>00770       name = noname;
<a name="l00771"></a>00771 
<a name="l00772"></a>00772 
<a name="l00773"></a>00773    <span class="keywordflow">if</span> (!f) {
<a name="l00774"></a>00774       <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;%s [ %s (NULL) ] [%s]\n&quot;</span>, 
<a name="l00775"></a>00775          <a class="code" href="term_8h.html#a7b6c72116c334f40bf7c1e50e793c93b">term_color</a>(cp, prefix, <a class="code" href="term_8h.html#aee88b2ffd7fd2128fe38896cffb1a71a">COLOR_BRMAGENTA</a>, <a class="code" href="term_8h.html#aba2a7fe77a7501e5844370eec0185207">COLOR_BLACK</a>, <span class="keyword">sizeof</span>(cp)),
<a name="l00776"></a>00776          <a class="code" href="term_8h.html#a7b6c72116c334f40bf7c1e50e793c93b">term_color</a>(cft, <span class="stringliteral">&quot;HANGUP&quot;</span>, <a class="code" href="term_8h.html#a1851f8a3f25e5caf6183dc44af070d0d">COLOR_BRRED</a>, <a class="code" href="term_8h.html#aba2a7fe77a7501e5844370eec0185207">COLOR_BLACK</a>, <span class="keyword">sizeof</span>(cft)), 
<a name="l00777"></a>00777          <a class="code" href="term_8h.html#a7b6c72116c334f40bf7c1e50e793c93b">term_color</a>(cn, name, <a class="code" href="term_8h.html#a4534b577b74a58b0f4b7be027af664e0">COLOR_YELLOW</a>, <a class="code" href="term_8h.html#aba2a7fe77a7501e5844370eec0185207">COLOR_BLACK</a>, <span class="keyword">sizeof</span>(cn)));
<a name="l00778"></a>00778       <span class="keywordflow">return</span>;
<a name="l00779"></a>00779    }
<a name="l00780"></a>00780    <span class="comment">/* XXX We should probably print one each of voice and video when the format changes XXX */</span>
<a name="l00781"></a>00781    <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>)
<a name="l00782"></a>00782       <span class="keywordflow">return</span>;
<a name="l00783"></a>00783    <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a17ae96b6ea8a2388bb0d409e8124ff30">AST_FRAME_VIDEO</a>)
<a name="l00784"></a>00784       <span class="keywordflow">return</span>;
<a name="l00785"></a>00785    <span class="keywordflow">switch</span>(f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a>) {
<a name="l00786"></a>00786    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a9b350360a64b55c7590f1ec03db480be">AST_FRAME_DTMF_BEGIN</a>:
<a name="l00787"></a>00787       strcpy(ftype, <span class="stringliteral">&quot;DTMF Begin&quot;</span>);
<a name="l00788"></a>00788       subclass[0] = f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>;
<a name="l00789"></a>00789       subclass[1] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00790"></a>00790       <span class="keywordflow">break</span>;
<a name="l00791"></a>00791    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a98e65764bc963016c394bcc1bad6540b">AST_FRAME_DTMF_END</a>:
<a name="l00792"></a>00792       strcpy(ftype, <span class="stringliteral">&quot;DTMF End&quot;</span>);
<a name="l00793"></a>00793       subclass[0] = f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>;
<a name="l00794"></a>00794       subclass[1] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00795"></a>00795       <span class="keywordflow">break</span>;
<a name="l00796"></a>00796    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>:
<a name="l00797"></a>00797       strcpy(ftype, <span class="stringliteral">&quot;Control&quot;</span>);
<a name="l00798"></a>00798       <span class="keywordflow">switch</span>(f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>) {
<a name="l00799"></a>00799       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa7dac1c1896ab418c2ff351aae707fba">AST_CONTROL_HANGUP</a>:
<a name="l00800"></a>00800          strcpy(subclass, <span class="stringliteral">&quot;Hangup&quot;</span>);
<a name="l00801"></a>00801          <span class="keywordflow">break</span>;
<a name="l00802"></a>00802       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a00675bfb8c64b2be86297fe4cba51fa2">AST_CONTROL_RING</a>:
<a name="l00803"></a>00803          strcpy(subclass, <span class="stringliteral">&quot;Ring&quot;</span>);
<a name="l00804"></a>00804          <span class="keywordflow">break</span>;
<a name="l00805"></a>00805       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a>:
<a name="l00806"></a>00806          strcpy(subclass, <span class="stringliteral">&quot;Ringing&quot;</span>);
<a name="l00807"></a>00807          <span class="keywordflow">break</span>;
<a name="l00808"></a>00808       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>:
<a name="l00809"></a>00809          strcpy(subclass, <span class="stringliteral">&quot;Answer&quot;</span>);
<a name="l00810"></a>00810          <span class="keywordflow">break</span>;
<a name="l00811"></a>00811       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875">AST_CONTROL_BUSY</a>:
<a name="l00812"></a>00812          strcpy(subclass, <span class="stringliteral">&quot;Busy&quot;</span>);
<a name="l00813"></a>00813          <span class="keywordflow">break</span>;
<a name="l00814"></a>00814       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a5a24176e8066b727463907da4903bb8e">AST_CONTROL_TAKEOFFHOOK</a>:
<a name="l00815"></a>00815          strcpy(subclass, <span class="stringliteral">&quot;Take Off Hook&quot;</span>);
<a name="l00816"></a>00816          <span class="keywordflow">break</span>;
<a name="l00817"></a>00817       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a28cd8e9f9005e25624f993d6edd46755">AST_CONTROL_OFFHOOK</a>:
<a name="l00818"></a>00818          strcpy(subclass, <span class="stringliteral">&quot;Line Off Hook&quot;</span>);
<a name="l00819"></a>00819          <span class="keywordflow">break</span>;
<a name="l00820"></a>00820       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a850bb06a1702741c93a3fd67cc9637ab">AST_CONTROL_CONGESTION</a>:
<a name="l00821"></a>00821          strcpy(subclass, <span class="stringliteral">&quot;Congestion&quot;</span>);
<a name="l00822"></a>00822          <span class="keywordflow">break</span>;
<a name="l00823"></a>00823       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ae8f2cd460fdc81e0a774434fa002e4bf">AST_CONTROL_FLASH</a>:
<a name="l00824"></a>00824          strcpy(subclass, <span class="stringliteral">&quot;Flash&quot;</span>);
<a name="l00825"></a>00825          <span class="keywordflow">break</span>;
<a name="l00826"></a>00826       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a195b2c39c09113953814aa800dd06e7f">AST_CONTROL_WINK</a>:
<a name="l00827"></a>00827          strcpy(subclass, <span class="stringliteral">&quot;Wink&quot;</span>);
<a name="l00828"></a>00828          <span class="keywordflow">break</span>;
<a name="l00829"></a>00829       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ac4106406e269667ff84ee49e0a634f94">AST_CONTROL_OPTION</a>:
<a name="l00830"></a>00830          strcpy(subclass, <span class="stringliteral">&quot;Option&quot;</span>);
<a name="l00831"></a>00831          <span class="keywordflow">break</span>;
<a name="l00832"></a>00832       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aacb7ddf1a95fa544fdecada68213f3c7">AST_CONTROL_RADIO_KEY</a>:
<a name="l00833"></a>00833          strcpy(subclass, <span class="stringliteral">&quot;Key Radio&quot;</span>);
<a name="l00834"></a>00834          <span class="keywordflow">break</span>;
<a name="l00835"></a>00835       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a34ac3ccebc219c59daa7eb0275fcd54d">AST_CONTROL_RADIO_UNKEY</a>:
<a name="l00836"></a>00836          strcpy(subclass, <span class="stringliteral">&quot;Unkey Radio&quot;</span>);
<a name="l00837"></a>00837          <span class="keywordflow">break</span>;
<a name="l00838"></a>00838       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ab99a3d1c08c5ae8bca078c7cd1ec02f5">AST_CONTROL_HOLD</a>:
<a name="l00839"></a>00839          strcpy(subclass, <span class="stringliteral">&quot;Hold&quot;</span>);
<a name="l00840"></a>00840          <span class="keywordflow">break</span>;
<a name="l00841"></a>00841       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>:
<a name="l00842"></a>00842          strcpy(subclass, <span class="stringliteral">&quot;Unhold&quot;</span>);
<a name="l00843"></a>00843          <span class="keywordflow">break</span>;
<a name="l00844"></a>00844       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>:
<a name="l00845"></a>00845          <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> != <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__control__t38__parameters.html">ast_control_t38_parameters</a>)) {
<a name="l00846"></a>00846             message = <span class="stringliteral">&quot;Invalid&quot;</span>;
<a name="l00847"></a>00847          } <span class="keywordflow">else</span> {
<a name="l00848"></a>00848             <span class="keyword">struct </span><a class="code" href="structast__control__t38__parameters.html">ast_control_t38_parameters</a> *parameters = f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>;
<a name="l00849"></a>00849             <span class="keyword">enum</span> <a class="code" href="frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4b">ast_control_t38</a> <a class="code" href="structstate.html">state</a> = parameters-&gt;<a class="code" href="structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a>;
<a name="l00850"></a>00850             <span class="keywordflow">if</span> (state == <a class="code" href="frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bafdb1ca68d683c64301c4cf07463a9975">AST_T38_REQUEST_NEGOTIATE</a>)
<a name="l00851"></a>00851                message = <span class="stringliteral">&quot;Negotiation Requested&quot;</span>;
<a name="l00852"></a>00852             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (state == <a class="code" href="frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bab75e46d3212a2a886143d874c78a1e3c">AST_T38_REQUEST_TERMINATE</a>)
<a name="l00853"></a>00853                message = <span class="stringliteral">&quot;Negotiation Request Terminated&quot;</span>;
<a name="l00854"></a>00854             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (state == <a class="code" href="frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bad501e0d5fe272eaba466507a686a2df5">AST_T38_NEGOTIATED</a>)
<a name="l00855"></a>00855                message = <span class="stringliteral">&quot;Negotiated&quot;</span>;
<a name="l00856"></a>00856             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (state == <a class="code" href="frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4ba9df578b4287c86673d7f40f9abcdc86f">AST_T38_TERMINATED</a>)
<a name="l00857"></a>00857                message = <span class="stringliteral">&quot;Terminated&quot;</span>;
<a name="l00858"></a>00858             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (state == <a class="code" href="frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4baa02b30f25621f20396d06f5ac8aa7a2e">AST_T38_REFUSED</a>)
<a name="l00859"></a>00859                message = <span class="stringliteral">&quot;Refused&quot;</span>;
<a name="l00860"></a>00860          }
<a name="l00861"></a>00861          snprintf(subclass, <span class="keyword">sizeof</span>(subclass), <span class="stringliteral">&quot;T38_Parameters/%s&quot;</span>, message);
<a name="l00862"></a>00862          <span class="keywordflow">break</span>;
<a name="l00863"></a>00863       <span class="keywordflow">case</span> -1:
<a name="l00864"></a>00864          strcpy(subclass, <span class="stringliteral">&quot;Stop generators&quot;</span>);
<a name="l00865"></a>00865          <span class="keywordflow">break</span>;
<a name="l00866"></a>00866       <span class="keywordflow">default</span>:
<a name="l00867"></a>00867          snprintf(subclass, <span class="keyword">sizeof</span>(subclass), <span class="stringliteral">&quot;Unknown control &apos;%d&apos;&quot;</span>, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>);
<a name="l00868"></a>00868       }
<a name="l00869"></a>00869       <span class="keywordflow">break</span>;
<a name="l00870"></a>00870    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a29ff71f9d5c7927906ebd437fe372056">AST_FRAME_NULL</a>:
<a name="l00871"></a>00871       strcpy(ftype, <span class="stringliteral">&quot;Null Frame&quot;</span>);
<a name="l00872"></a>00872       strcpy(subclass, <span class="stringliteral">&quot;N/A&quot;</span>);
<a name="l00873"></a>00873       <span class="keywordflow">break</span>;
<a name="l00874"></a>00874    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a7f7e5bdc9f8a8ef45c4d078f96b52624">AST_FRAME_IAX</a>:
<a name="l00875"></a>00875       <span class="comment">/* Should never happen */</span>
<a name="l00876"></a>00876       strcpy(ftype, <span class="stringliteral">&quot;IAX Specific&quot;</span>);
<a name="l00877"></a>00877       snprintf(subclass, <span class="keyword">sizeof</span>(subclass), <span class="stringliteral">&quot;IAX Frametype %d&quot;</span>, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>);
<a name="l00878"></a>00878       <span class="keywordflow">break</span>;
<a name="l00879"></a>00879    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0af7728b18670d3cd075f63d67f8867078">AST_FRAME_TEXT</a>:
<a name="l00880"></a>00880       strcpy(ftype, <span class="stringliteral">&quot;Text&quot;</span>);
<a name="l00881"></a>00881       strcpy(subclass, <span class="stringliteral">&quot;N/A&quot;</span>);
<a name="l00882"></a>00882       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(moreinfo, f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, <span class="keyword">sizeof</span>(moreinfo));
<a name="l00883"></a>00883       <span class="keywordflow">break</span>;
<a name="l00884"></a>00884    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a6c9398ee8989239124295d096a87bf32">AST_FRAME_IMAGE</a>:
<a name="l00885"></a>00885       strcpy(ftype, <span class="stringliteral">&quot;Image&quot;</span>);
<a name="l00886"></a>00886       snprintf(subclass, <span class="keyword">sizeof</span>(subclass), <span class="stringliteral">&quot;Image format %s\n&quot;</span>, <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>));
<a name="l00887"></a>00887       <span class="keywordflow">break</span>;
<a name="l00888"></a>00888    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a3d91bab33583f560197e21532a02a895">AST_FRAME_HTML</a>:
<a name="l00889"></a>00889       strcpy(ftype, <span class="stringliteral">&quot;HTML&quot;</span>);
<a name="l00890"></a>00890       <span class="keywordflow">switch</span>(f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>) {
<a name="l00891"></a>00891       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a6eada13200d55b88ef01b68c5d62a43a">AST_HTML_URL</a>:
<a name="l00892"></a>00892          strcpy(subclass, <span class="stringliteral">&quot;URL&quot;</span>);
<a name="l00893"></a>00893          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(moreinfo, f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, <span class="keyword">sizeof</span>(moreinfo));
<a name="l00894"></a>00894          <span class="keywordflow">break</span>;
<a name="l00895"></a>00895       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aba474b9a2a4dcde86ee12f74e878ab6d">AST_HTML_DATA</a>:
<a name="l00896"></a>00896          strcpy(subclass, <span class="stringliteral">&quot;Data&quot;</span>);
<a name="l00897"></a>00897          <span class="keywordflow">break</span>;
<a name="l00898"></a>00898       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ade1d4ef84064d1c58f0377514292db3c">AST_HTML_BEGIN</a>:
<a name="l00899"></a>00899          strcpy(subclass, <span class="stringliteral">&quot;Begin&quot;</span>);
<a name="l00900"></a>00900          <span class="keywordflow">break</span>;
<a name="l00901"></a>00901       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aa6c9a7c6b3b55b0b2b3792655b24cfaf">AST_HTML_END</a>:
<a name="l00902"></a>00902          strcpy(subclass, <span class="stringliteral">&quot;End&quot;</span>);
<a name="l00903"></a>00903          <span class="keywordflow">break</span>;
<a name="l00904"></a>00904       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a91982c4a8393bd03929906ae254e759e">AST_HTML_LDCOMPLETE</a>:
<a name="l00905"></a>00905          strcpy(subclass, <span class="stringliteral">&quot;Load Complete&quot;</span>);
<a name="l00906"></a>00906          <span class="keywordflow">break</span>;
<a name="l00907"></a>00907       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a75abb5123a5468bdce1c651a6df008c3">AST_HTML_NOSUPPORT</a>:
<a name="l00908"></a>00908          strcpy(subclass, <span class="stringliteral">&quot;No Support&quot;</span>);
<a name="l00909"></a>00909          <span class="keywordflow">break</span>;
<a name="l00910"></a>00910       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a5e242c10a410dcee83755947346d9671">AST_HTML_LINKURL</a>:
<a name="l00911"></a>00911          strcpy(subclass, <span class="stringliteral">&quot;Link URL&quot;</span>);
<a name="l00912"></a>00912          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(moreinfo, f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, <span class="keyword">sizeof</span>(moreinfo));
<a name="l00913"></a>00913          <span class="keywordflow">break</span>;
<a name="l00914"></a>00914       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a1c9f284a258e8c26216fe1ac4fbecba4">AST_HTML_UNLINK</a>:
<a name="l00915"></a>00915          strcpy(subclass, <span class="stringliteral">&quot;Unlink&quot;</span>);
<a name="l00916"></a>00916          <span class="keywordflow">break</span>;
<a name="l00917"></a>00917       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ad5863e5c322715392e99acc5bef0a518">AST_HTML_LINKREJECT</a>:
<a name="l00918"></a>00918          strcpy(subclass, <span class="stringliteral">&quot;Link Reject&quot;</span>);
<a name="l00919"></a>00919          <span class="keywordflow">break</span>;
<a name="l00920"></a>00920       <span class="keywordflow">default</span>:
<a name="l00921"></a>00921          snprintf(subclass, <span class="keyword">sizeof</span>(subclass), <span class="stringliteral">&quot;Unknown HTML frame &apos;%d&apos;\n&quot;</span>, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>);
<a name="l00922"></a>00922          <span class="keywordflow">break</span>;
<a name="l00923"></a>00923       }
<a name="l00924"></a>00924       <span class="keywordflow">break</span>;
<a name="l00925"></a>00925    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ad99b86353343f422bda01163898b2eea">AST_FRAME_MODEM</a>:
<a name="l00926"></a>00926       strcpy(ftype, <span class="stringliteral">&quot;Modem&quot;</span>);
<a name="l00927"></a>00927       <span class="keywordflow">switch</span> (f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>) {
<a name="l00928"></a>00928       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a3a510e4e2673c6870ed5fe0f1eb53732">AST_MODEM_T38</a>:
<a name="l00929"></a>00929          strcpy(subclass, <span class="stringliteral">&quot;T.38&quot;</span>);
<a name="l00930"></a>00930          <span class="keywordflow">break</span>;
<a name="l00931"></a>00931       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ad7ac909bf2adaabfe37805db2cf53f14">AST_MODEM_V150</a>:
<a name="l00932"></a>00932          strcpy(subclass, <span class="stringliteral">&quot;V.150&quot;</span>);
<a name="l00933"></a>00933          <span class="keywordflow">break</span>;
<a name="l00934"></a>00934       <span class="keywordflow">default</span>:
<a name="l00935"></a>00935          snprintf(subclass, <span class="keyword">sizeof</span>(subclass), <span class="stringliteral">&quot;Unknown MODEM frame &apos;%d&apos;\n&quot;</span>, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>);
<a name="l00936"></a>00936          <span class="keywordflow">break</span>;
<a name="l00937"></a>00937       }
<a name="l00938"></a>00938       <span class="keywordflow">break</span>;
<a name="l00939"></a>00939    <span class="keywordflow">default</span>:
<a name="l00940"></a>00940       snprintf(ftype, <span class="keyword">sizeof</span>(ftype), <span class="stringliteral">&quot;Unknown Frametype &apos;%d&apos;&quot;</span>, f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a>);
<a name="l00941"></a>00941    }
<a name="l00942"></a>00942    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(moreinfo))
<a name="l00943"></a>00943       <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;%s [ TYPE: %s (%d) SUBCLASS: %s (%d) &apos;%s&apos; ] [%s]\n&quot;</span>,  
<a name="l00944"></a>00944              <a class="code" href="term_8h.html#a7b6c72116c334f40bf7c1e50e793c93b">term_color</a>(cp, prefix, <a class="code" href="term_8h.html#aee88b2ffd7fd2128fe38896cffb1a71a">COLOR_BRMAGENTA</a>, <a class="code" href="term_8h.html#aba2a7fe77a7501e5844370eec0185207">COLOR_BLACK</a>, <span class="keyword">sizeof</span>(cp)),
<a name="l00945"></a>00945              <a class="code" href="term_8h.html#a7b6c72116c334f40bf7c1e50e793c93b">term_color</a>(cft, ftype, <a class="code" href="term_8h.html#a1851f8a3f25e5caf6183dc44af070d0d">COLOR_BRRED</a>, <a class="code" href="term_8h.html#aba2a7fe77a7501e5844370eec0185207">COLOR_BLACK</a>, <span class="keyword">sizeof</span>(cft)),
<a name="l00946"></a>00946              f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a>, 
<a name="l00947"></a>00947              <a class="code" href="term_8h.html#a7b6c72116c334f40bf7c1e50e793c93b">term_color</a>(csub, subclass, <a class="code" href="term_8h.html#a23aeefae76b2cacc1a6162de88c3fff0">COLOR_BRCYAN</a>, <a class="code" href="term_8h.html#aba2a7fe77a7501e5844370eec0185207">COLOR_BLACK</a>, <span class="keyword">sizeof</span>(csub)),
<a name="l00948"></a>00948              f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>, 
<a name="l00949"></a>00949              <a class="code" href="term_8h.html#a7b6c72116c334f40bf7c1e50e793c93b">term_color</a>(cmn, moreinfo, <a class="code" href="term_8h.html#a0149574f00c0892ce71ca7964e69672b">COLOR_BRGREEN</a>, <a class="code" href="term_8h.html#aba2a7fe77a7501e5844370eec0185207">COLOR_BLACK</a>, <span class="keyword">sizeof</span>(cmn)),
<a name="l00950"></a>00950              <a class="code" href="term_8h.html#a7b6c72116c334f40bf7c1e50e793c93b">term_color</a>(cn, name, <a class="code" href="term_8h.html#a4534b577b74a58b0f4b7be027af664e0">COLOR_YELLOW</a>, <a class="code" href="term_8h.html#aba2a7fe77a7501e5844370eec0185207">COLOR_BLACK</a>, <span class="keyword">sizeof</span>(cn)));
<a name="l00951"></a>00951    <span class="keywordflow">else</span>
<a name="l00952"></a>00952       <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;%s [ TYPE: %s (%d) SUBCLASS: %s (%d) ] [%s]\n&quot;</span>,  
<a name="l00953"></a>00953              <a class="code" href="term_8h.html#a7b6c72116c334f40bf7c1e50e793c93b">term_color</a>(cp, prefix, <a class="code" href="term_8h.html#aee88b2ffd7fd2128fe38896cffb1a71a">COLOR_BRMAGENTA</a>, <a class="code" href="term_8h.html#aba2a7fe77a7501e5844370eec0185207">COLOR_BLACK</a>, <span class="keyword">sizeof</span>(cp)),
<a name="l00954"></a>00954              <a class="code" href="term_8h.html#a7b6c72116c334f40bf7c1e50e793c93b">term_color</a>(cft, ftype, <a class="code" href="term_8h.html#a1851f8a3f25e5caf6183dc44af070d0d">COLOR_BRRED</a>, <a class="code" href="term_8h.html#aba2a7fe77a7501e5844370eec0185207">COLOR_BLACK</a>, <span class="keyword">sizeof</span>(cft)),
<a name="l00955"></a>00955              f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a>, 
<a name="l00956"></a>00956              <a class="code" href="term_8h.html#a7b6c72116c334f40bf7c1e50e793c93b">term_color</a>(csub, subclass, <a class="code" href="term_8h.html#a23aeefae76b2cacc1a6162de88c3fff0">COLOR_BRCYAN</a>, <a class="code" href="term_8h.html#aba2a7fe77a7501e5844370eec0185207">COLOR_BLACK</a>, <span class="keyword">sizeof</span>(csub)),
<a name="l00957"></a>00957              f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>, 
<a name="l00958"></a>00958              <a class="code" href="term_8h.html#a7b6c72116c334f40bf7c1e50e793c93b">term_color</a>(cn, name, <a class="code" href="term_8h.html#a4534b577b74a58b0f4b7be027af664e0">COLOR_YELLOW</a>, <a class="code" href="term_8h.html#aba2a7fe77a7501e5844370eec0185207">COLOR_BLACK</a>, <span class="keyword">sizeof</span>(cn)));
<a name="l00959"></a>00959 }
<a name="l00960"></a>00960 
<a name="l00961"></a>00961 
<a name="l00962"></a>00962 <span class="comment">/* Builtin Asterisk CLI-commands for debugging */</span>
<a name="l00963"></a><a class="code" href="frame_8c.html#af1a7a13ff239697e9106ed3763072298">00963</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> <a class="code" href="frame_8c.html#af1a7a13ff239697e9106ed3763072298">my_clis</a>[] = {
<a name="l00964"></a>00964    <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="frame_8c.html#a8e79daabbe43ccf4880e628c7e712b38">show_codecs</a>, <span class="stringliteral">&quot;Displays a list of codecs&quot;</span>),
<a name="l00965"></a>00965    <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="frame_8c.html#a151c4ff0b1d8addf7ec1f81c553ea084">show_codec_n</a>, <span class="stringliteral">&quot;Shows a specific codec&quot;</span>),
<a name="l00966"></a>00966 };
<a name="l00967"></a>00967 
<a name="l00968"></a><a class="code" href="frame_8c.html#ae8a701b0b688879d84514bd36d63ff82">00968</a> <span class="keywordtype">int</span> <a class="code" href="__private_8h.html#ae8a701b0b688879d84514bd36d63ff82">init_framer</a>(<span class="keywordtype">void</span>)
<a name="l00969"></a>00969 {
<a name="l00970"></a>00970    <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(my_clis, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(my_clis));
<a name="l00971"></a>00971    <span class="keywordflow">return</span> 0;   
<a name="l00972"></a>00972 }
<a name="l00973"></a>00973 
<a name="l00974"></a><a class="code" href="frame_8c.html#a42cc334b6773ff33cb3c24ca5a916842">00974</a> <span class="keywordtype">void</span> <a class="code" href="frame_8h.html#a42cc334b6773ff33cb3c24ca5a916842" title="Shift an audio codec preference list up or down 65 bytes so that it becomes an ASCII...">ast_codec_pref_convert</a>(<span class="keyword">struct</span> <a class="code" href="structast__codec__pref.html">ast_codec_pref</a> *pref, <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <span class="keywordtype">size_t</span> size, <span class="keywordtype">int</span> right) 
<a name="l00975"></a>00975 {
<a name="l00976"></a>00976    <span class="keywordtype">int</span> x, differential = (int) <span class="charliteral">&apos;A&apos;</span>, mem;
<a name="l00977"></a>00977    <span class="keywordtype">char</span> *from, *to;
<a name="l00978"></a>00978 
<a name="l00979"></a>00979    <span class="keywordflow">if</span> (right) {
<a name="l00980"></a>00980       from = pref-&gt;<a class="code" href="structast__codec__pref.html#af2068e452bdf5eeafcda00c8c06b5cc0">order</a>;
<a name="l00981"></a>00981       to = buf;
<a name="l00982"></a>00982       mem = size;
<a name="l00983"></a>00983    } <span class="keywordflow">else</span> {
<a name="l00984"></a>00984       to = pref-&gt;<a class="code" href="structast__codec__pref.html#af2068e452bdf5eeafcda00c8c06b5cc0">order</a>;
<a name="l00985"></a>00985       from = buf;
<a name="l00986"></a>00986       mem = 32;
<a name="l00987"></a>00987    }
<a name="l00988"></a>00988 
<a name="l00989"></a>00989    memset(to, 0, mem);
<a name="l00990"></a>00990    <span class="keywordflow">for</span> (x = 0; x &lt; 32 ; x++) {
<a name="l00991"></a>00991       <span class="keywordflow">if</span> (!from[x])
<a name="l00992"></a>00992          <span class="keywordflow">break</span>;
<a name="l00993"></a>00993       to[x] = right ? (from[x] + differential) : (from[x] - differential);
<a name="l00994"></a>00994    }
<a name="l00995"></a>00995 }
<a name="l00996"></a>00996 
<a name="l00997"></a><a class="code" href="frame_8c.html#a784e4f7371cbfce0b3e9f957f7ce54e3">00997</a> <span class="keywordtype">int</span> <a class="code" href="frame_8h.html#a784e4f7371cbfce0b3e9f957f7ce54e3" title="Dump audio codec preference list into a string.">ast_codec_pref_string</a>(<span class="keyword">struct</span> <a class="code" href="structast__codec__pref.html">ast_codec_pref</a> *pref, <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <span class="keywordtype">size_t</span> size) 
<a name="l00998"></a>00998 {
<a name="l00999"></a>00999    <span class="keywordtype">int</span> x, codec; 
<a name="l01000"></a>01000    <span class="keywordtype">size_t</span> total_len, slen;
<a name="l01001"></a>01001    <span class="keywordtype">char</span> *formatname;
<a name="l01002"></a>01002    
<a name="l01003"></a>01003    memset(buf,0,size);
<a name="l01004"></a>01004    total_len = size;
<a name="l01005"></a>01005    buf[0] = <span class="charliteral">&apos;(&apos;</span>;
<a name="l01006"></a>01006    total_len--;
<a name="l01007"></a>01007    <span class="keywordflow">for</span>(x = 0; x &lt; 32 ; x++) {
<a name="l01008"></a>01008       <span class="keywordflow">if</span> (total_len &lt;= 0)
<a name="l01009"></a>01009          <span class="keywordflow">break</span>;
<a name="l01010"></a>01010       <span class="keywordflow">if</span> (!(codec = <a class="code" href="frame_8h.html#af9dd4cbc4b715644df1afe4964169c9b" title="Codec located at a particular place in the preference index.">ast_codec_pref_index</a>(pref,x)))
<a name="l01011"></a>01011          <span class="keywordflow">break</span>;
<a name="l01012"></a>01012       <span class="keywordflow">if</span> ((formatname = <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(codec))) {
<a name="l01013"></a>01013          slen = strlen(formatname);
<a name="l01014"></a>01014          <span class="keywordflow">if</span> (slen &gt; total_len)
<a name="l01015"></a>01015             <span class="keywordflow">break</span>;
<a name="l01016"></a>01016          strncat(buf, formatname, total_len - 1); <span class="comment">/* safe */</span>
<a name="l01017"></a>01017          total_len -= slen;
<a name="l01018"></a>01018       }
<a name="l01019"></a>01019       <span class="keywordflow">if</span> (total_len &amp;&amp; x &lt; 31 &amp;&amp; <a class="code" href="frame_8h.html#af9dd4cbc4b715644df1afe4964169c9b" title="Codec located at a particular place in the preference index.">ast_codec_pref_index</a>(pref , x + 1)) {
<a name="l01020"></a>01020          strncat(buf, <span class="stringliteral">&quot;|&quot;</span>, total_len - 1); <span class="comment">/* safe */</span>
<a name="l01021"></a>01021          total_len--;
<a name="l01022"></a>01022       }
<a name="l01023"></a>01023    }
<a name="l01024"></a>01024    <span class="keywordflow">if</span> (total_len) {
<a name="l01025"></a>01025       strncat(buf, <span class="stringliteral">&quot;)&quot;</span>, total_len - 1); <span class="comment">/* safe */</span>
<a name="l01026"></a>01026       total_len--;
<a name="l01027"></a>01027    }
<a name="l01028"></a>01028 
<a name="l01029"></a>01029    <span class="keywordflow">return</span> size - total_len;
<a name="l01030"></a>01030 }
<a name="l01031"></a>01031 
<a name="l01032"></a><a class="code" href="frame_8c.html#a1610acfbe3638e07556dd06562d6c035">01032</a> <span class="keywordtype">int</span> <a class="code" href="frame_8h.html#af9dd4cbc4b715644df1afe4964169c9b" title="Codec located at a particular place in the preference index.">ast_codec_pref_index</a>(<span class="keyword">struct</span> <a class="code" href="structast__codec__pref.html">ast_codec_pref</a> *pref, <span class="keywordtype">int</span> idx)
<a name="l01033"></a>01033 {
<a name="l01034"></a>01034    <span class="keywordtype">int</span> slot = 0;
<a name="l01035"></a>01035 
<a name="l01036"></a>01036    <span class="keywordflow">if</span> ((idx &gt;= 0) &amp;&amp; (idx &lt; <span class="keyword">sizeof</span>(pref-&gt;<a class="code" href="structast__codec__pref.html#af2068e452bdf5eeafcda00c8c06b5cc0">order</a>))) {
<a name="l01037"></a>01037       slot = pref-&gt;<a class="code" href="structast__codec__pref.html#af2068e452bdf5eeafcda00c8c06b5cc0">order</a>[idx];
<a name="l01038"></a>01038    }
<a name="l01039"></a>01039 
<a name="l01040"></a>01040    <span class="keywordflow">return</span> slot ? AST_FORMAT_LIST[slot - 1].<a class="code" href="structast__format__list.html#ad1e28a1a66a25529b0b61b9ca4e66d44">bits</a> : 0;
<a name="l01041"></a>01041 }
<a name="l01042"></a>01042 <span class="comment"></span>
<a name="l01043"></a>01043 <span class="comment">/*! \brief Remove codec from pref list */</span>
<a name="l01044"></a><a class="code" href="frame_8c.html#a8daa8fe39c23fc605881466efafa00f7">01044</a> <span class="keywordtype">void</span> <a class="code" href="frame_8h.html#a8daa8fe39c23fc605881466efafa00f7" title="Remove audio a codec from a preference list.">ast_codec_pref_remove</a>(<span class="keyword">struct</span> <a class="code" href="structast__codec__pref.html">ast_codec_pref</a> *pref, <span class="keywordtype">int</span> <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>)
<a name="l01045"></a>01045 {
<a name="l01046"></a>01046    <span class="keyword">struct </span><a class="code" href="structast__codec__pref.html">ast_codec_pref</a> oldorder;
<a name="l01047"></a>01047    <span class="keywordtype">int</span> x, y = 0;
<a name="l01048"></a>01048    <span class="keywordtype">int</span> slot;
<a name="l01049"></a>01049    <span class="keywordtype">int</span> size;
<a name="l01050"></a>01050 
<a name="l01051"></a>01051    <span class="keywordflow">if</span> (!pref-&gt;<a class="code" href="structast__codec__pref.html#af2068e452bdf5eeafcda00c8c06b5cc0">order</a>[0])
<a name="l01052"></a>01052       <span class="keywordflow">return</span>;
<a name="l01053"></a>01053 
<a name="l01054"></a>01054    memcpy(&amp;oldorder, pref, <span class="keyword">sizeof</span>(oldorder));
<a name="l01055"></a>01055    memset(pref, 0, <span class="keyword">sizeof</span>(*pref));
<a name="l01056"></a>01056 
<a name="l01057"></a>01057    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(AST_FORMAT_LIST); x++) {
<a name="l01058"></a>01058       slot = oldorder.<a class="code" href="structast__codec__pref.html#af2068e452bdf5eeafcda00c8c06b5cc0">order</a>[x];
<a name="l01059"></a>01059       size = oldorder.<a class="code" href="structast__codec__pref.html#a2b0514c4f4584036696b7b6e83985906">framing</a>[x];
<a name="l01060"></a>01060       <span class="keywordflow">if</span> (! slot)
<a name="l01061"></a>01061          <span class="keywordflow">break</span>;
<a name="l01062"></a>01062       <span class="keywordflow">if</span> (AST_FORMAT_LIST[slot-1].bits != format) {
<a name="l01063"></a>01063          pref-&gt;<a class="code" href="structast__codec__pref.html#af2068e452bdf5eeafcda00c8c06b5cc0">order</a>[y] = slot;
<a name="l01064"></a>01064          pref-&gt;<a class="code" href="structast__codec__pref.html#a2b0514c4f4584036696b7b6e83985906">framing</a>[y++] = size;
<a name="l01065"></a>01065       }
<a name="l01066"></a>01066    }
<a name="l01067"></a>01067    
<a name="l01068"></a>01068 }
<a name="l01069"></a>01069 <span class="comment"></span>
<a name="l01070"></a>01070 <span class="comment">/*! \brief Append codec to list */</span>
<a name="l01071"></a><a class="code" href="frame_8c.html#a54b0af0dfdc8466239e6babb9303f7b3">01071</a> <span class="keywordtype">int</span> <a class="code" href="frame_8h.html#a54b0af0dfdc8466239e6babb9303f7b3" title="Append a audio codec to a preference list, removing it first if it was already there...">ast_codec_pref_append</a>(<span class="keyword">struct</span> <a class="code" href="structast__codec__pref.html">ast_codec_pref</a> *pref, <span class="keywordtype">int</span> <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>)
<a name="l01072"></a>01072 {
<a name="l01073"></a>01073    <span class="keywordtype">int</span> x, newindex = 0;
<a name="l01074"></a>01074 
<a name="l01075"></a>01075    <a class="code" href="frame_8h.html#a8daa8fe39c23fc605881466efafa00f7" title="Remove audio a codec from a preference list.">ast_codec_pref_remove</a>(pref, format);
<a name="l01076"></a>01076 
<a name="l01077"></a>01077    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(AST_FORMAT_LIST); x++) {
<a name="l01078"></a>01078       <span class="keywordflow">if</span> (AST_FORMAT_LIST[x].bits == format) {
<a name="l01079"></a>01079          newindex = x + 1;
<a name="l01080"></a>01080          <span class="keywordflow">break</span>;
<a name="l01081"></a>01081       }
<a name="l01082"></a>01082    }
<a name="l01083"></a>01083 
<a name="l01084"></a>01084    <span class="keywordflow">if</span> (newindex) {
<a name="l01085"></a>01085       <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(AST_FORMAT_LIST); x++) {
<a name="l01086"></a>01086          <span class="keywordflow">if</span> (!pref-&gt;<a class="code" href="structast__codec__pref.html#af2068e452bdf5eeafcda00c8c06b5cc0">order</a>[x]) {
<a name="l01087"></a>01087             pref-&gt;<a class="code" href="structast__codec__pref.html#af2068e452bdf5eeafcda00c8c06b5cc0">order</a>[x] = newindex;
<a name="l01088"></a>01088             <span class="keywordflow">break</span>;
<a name="l01089"></a>01089          }
<a name="l01090"></a>01090       }
<a name="l01091"></a>01091    }
<a name="l01092"></a>01092 
<a name="l01093"></a>01093    <span class="keywordflow">return</span> x;
<a name="l01094"></a>01094 }
<a name="l01095"></a>01095 <span class="comment"></span>
<a name="l01096"></a>01096 <span class="comment">/*! \brief Prepend codec to list */</span>
<a name="l01097"></a><a class="code" href="frame_8c.html#a5eb17ccec8892ebe96ab661e749f0399">01097</a> <span class="keywordtype">void</span> <a class="code" href="frame_8h.html#a5eb17ccec8892ebe96ab661e749f0399" title="Prepend an audio codec to a preference list, removing it first if it was already...">ast_codec_pref_prepend</a>(<span class="keyword">struct</span> <a class="code" href="structast__codec__pref.html">ast_codec_pref</a> *pref, <span class="keywordtype">int</span> <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>, <span class="keywordtype">int</span> only_if_existing)
<a name="l01098"></a>01098 {
<a name="l01099"></a>01099    <span class="keywordtype">int</span> x, newindex = 0;
<a name="l01100"></a>01100 
<a name="l01101"></a>01101    <span class="comment">/* First step is to get the codecs &quot;index number&quot; */</span>
<a name="l01102"></a>01102    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(AST_FORMAT_LIST); x++) {
<a name="l01103"></a>01103       <span class="keywordflow">if</span> (AST_FORMAT_LIST[x].bits == format) {
<a name="l01104"></a>01104          newindex = x + 1;
<a name="l01105"></a>01105          <span class="keywordflow">break</span>;
<a name="l01106"></a>01106       }
<a name="l01107"></a>01107    }
<a name="l01108"></a>01108    <span class="comment">/* Done if its unknown */</span>
<a name="l01109"></a>01109    <span class="keywordflow">if</span> (!newindex)
<a name="l01110"></a>01110       <span class="keywordflow">return</span>;
<a name="l01111"></a>01111 
<a name="l01112"></a>01112    <span class="comment">/* Now find any existing occurrence, or the end */</span>
<a name="l01113"></a>01113    <span class="keywordflow">for</span> (x = 0; x &lt; 32; x++) {
<a name="l01114"></a>01114       <span class="keywordflow">if</span> (!pref-&gt;<a class="code" href="structast__codec__pref.html#af2068e452bdf5eeafcda00c8c06b5cc0">order</a>[x] || pref-&gt;<a class="code" href="structast__codec__pref.html#af2068e452bdf5eeafcda00c8c06b5cc0">order</a>[x] == newindex)
<a name="l01115"></a>01115          <span class="keywordflow">break</span>;
<a name="l01116"></a>01116    }
<a name="l01117"></a>01117 
<a name="l01118"></a>01118    <span class="keywordflow">if</span> (only_if_existing &amp;&amp; !pref-&gt;<a class="code" href="structast__codec__pref.html#af2068e452bdf5eeafcda00c8c06b5cc0">order</a>[x])
<a name="l01119"></a>01119       <span class="keywordflow">return</span>;
<a name="l01120"></a>01120 
<a name="l01121"></a>01121    <span class="comment">/* Move down to make space to insert - either all the way to the end,</span>
<a name="l01122"></a>01122 <span class="comment">      or as far as the existing location (which will be overwritten) */</span>
<a name="l01123"></a>01123    <span class="keywordflow">for</span> (; x &gt; 0; x--) {
<a name="l01124"></a>01124       pref-&gt;<a class="code" href="structast__codec__pref.html#af2068e452bdf5eeafcda00c8c06b5cc0">order</a>[x] = pref-&gt;<a class="code" href="structast__codec__pref.html#af2068e452bdf5eeafcda00c8c06b5cc0">order</a>[x - 1];
<a name="l01125"></a>01125       pref-&gt;<a class="code" href="structast__codec__pref.html#a2b0514c4f4584036696b7b6e83985906">framing</a>[x] = pref-&gt;<a class="code" href="structast__codec__pref.html#a2b0514c4f4584036696b7b6e83985906">framing</a>[x - 1];
<a name="l01126"></a>01126    }
<a name="l01127"></a>01127 
<a name="l01128"></a>01128    <span class="comment">/* And insert the new entry */</span>
<a name="l01129"></a>01129    pref-&gt;<a class="code" href="structast__codec__pref.html#af2068e452bdf5eeafcda00c8c06b5cc0">order</a>[0] = newindex;
<a name="l01130"></a>01130    pref-&gt;<a class="code" href="structast__codec__pref.html#a2b0514c4f4584036696b7b6e83985906">framing</a>[0] = 0; <span class="comment">/* ? */</span>
<a name="l01131"></a>01131 }
<a name="l01132"></a>01132 <span class="comment"></span>
<a name="l01133"></a>01133 <span class="comment">/*! \brief Set packet size for codec */</span>
<a name="l01134"></a><a class="code" href="frame_8c.html#a6803881645ae33ff0618b3648d26aeaa">01134</a> <span class="keywordtype">int</span> <a class="code" href="frame_8h.html#a6803881645ae33ff0618b3648d26aeaa" title="Set packet size for codec.">ast_codec_pref_setsize</a>(<span class="keyword">struct</span> <a class="code" href="structast__codec__pref.html">ast_codec_pref</a> *pref, <span class="keywordtype">int</span> <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>, <span class="keywordtype">int</span> framems)
<a name="l01135"></a>01135 {
<a name="l01136"></a>01136    <span class="keywordtype">int</span> x, idx = -1;
<a name="l01137"></a>01137 
<a name="l01138"></a>01138    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(AST_FORMAT_LIST); x++) {
<a name="l01139"></a>01139       <span class="keywordflow">if</span> (AST_FORMAT_LIST[x].bits == format) {
<a name="l01140"></a>01140          idx = x;
<a name="l01141"></a>01141          <span class="keywordflow">break</span>;
<a name="l01142"></a>01142       }
<a name="l01143"></a>01143    }
<a name="l01144"></a>01144 
<a name="l01145"></a>01145    <span class="keywordflow">if</span> (idx &lt; 0)
<a name="l01146"></a>01146       <span class="keywordflow">return</span> -1;
<a name="l01147"></a>01147 
<a name="l01148"></a>01148    <span class="comment">/* size validation */</span>
<a name="l01149"></a>01149    <span class="keywordflow">if</span> (!framems)
<a name="l01150"></a>01150       framems = AST_FORMAT_LIST[idx].<a class="code" href="structast__format__list.html#a6811d95221b6ad6a05fb9e628d903ff5">def_ms</a>;
<a name="l01151"></a>01151 
<a name="l01152"></a>01152    <span class="keywordflow">if</span> (AST_FORMAT_LIST[idx].inc_ms &amp;&amp; framems % AST_FORMAT_LIST[idx].inc_ms) <span class="comment">/* avoid division by zero */</span>
<a name="l01153"></a>01153       framems -= framems % AST_FORMAT_LIST[idx].<a class="code" href="structast__format__list.html#a05368e07b33c55c5588a16887e0d1937">inc_ms</a>;
<a name="l01154"></a>01154 
<a name="l01155"></a>01155    <span class="keywordflow">if</span> (framems &lt; AST_FORMAT_LIST[idx].min_ms)
<a name="l01156"></a>01156       framems = AST_FORMAT_LIST[idx].<a class="code" href="structast__format__list.html#a005fe943b03a357496fec4fd5a5384c7">min_ms</a>;
<a name="l01157"></a>01157 
<a name="l01158"></a>01158    <span class="keywordflow">if</span> (framems &gt; AST_FORMAT_LIST[idx].max_ms)
<a name="l01159"></a>01159       framems = AST_FORMAT_LIST[idx].<a class="code" href="structast__format__list.html#ae92eef30d25050a86edb84d37a39b984">max_ms</a>;
<a name="l01160"></a>01160 
<a name="l01161"></a>01161    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(AST_FORMAT_LIST); x++) {
<a name="l01162"></a>01162       <span class="keywordflow">if</span> (pref-&gt;<a class="code" href="structast__codec__pref.html#af2068e452bdf5eeafcda00c8c06b5cc0">order</a>[x] == (idx + 1)) {
<a name="l01163"></a>01163          pref-&gt;<a class="code" href="structast__codec__pref.html#a2b0514c4f4584036696b7b6e83985906">framing</a>[x] = framems;
<a name="l01164"></a>01164          <span class="keywordflow">break</span>;
<a name="l01165"></a>01165       }
<a name="l01166"></a>01166    }
<a name="l01167"></a>01167 
<a name="l01168"></a>01168    <span class="keywordflow">return</span> x;
<a name="l01169"></a>01169 }
<a name="l01170"></a>01170 <span class="comment"></span>
<a name="l01171"></a>01171 <span class="comment">/*! \brief Get packet size for codec */</span>
<a name="l01172"></a><a class="code" href="frame_8c.html#ac9789499b866949ab31bab025b497964">01172</a> <span class="keyword">struct </span><a class="code" href="structast__format__list.html" title="Definition of supported media formats (codecs).">ast_format_list</a> <a class="code" href="frame_8h.html#ac9789499b866949ab31bab025b497964" title="Get packet size for codec.">ast_codec_pref_getsize</a>(struct <a class="code" href="structast__codec__pref.html">ast_codec_pref</a> *pref, <span class="keywordtype">int</span> <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>)
<a name="l01173"></a>01173 {
<a name="l01174"></a>01174    <span class="keywordtype">int</span> x, idx = -1, framems = 0;
<a name="l01175"></a>01175    <span class="keyword">struct </span><a class="code" href="structast__format__list.html" title="Definition of supported media formats (codecs).">ast_format_list</a> fmt = { 0, };
<a name="l01176"></a>01176 
<a name="l01177"></a>01177    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(AST_FORMAT_LIST); x++) {
<a name="l01178"></a>01178       <span class="keywordflow">if</span> (AST_FORMAT_LIST[x].<a class="code" href="structast__format__list.html#ad1e28a1a66a25529b0b61b9ca4e66d44">bits</a> == <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>) {
<a name="l01179"></a>01179          fmt = AST_FORMAT_LIST[x];
<a name="l01180"></a>01180          idx = x;
<a name="l01181"></a>01181          <span class="keywordflow">break</span>;
<a name="l01182"></a>01182       }
<a name="l01183"></a>01183    }
<a name="l01184"></a>01184 
<a name="l01185"></a>01185    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(AST_FORMAT_LIST); x++) {
<a name="l01186"></a>01186       <span class="keywordflow">if</span> (pref-&gt;order[x] == (idx + 1)) {
<a name="l01187"></a>01187          framems = pref-&gt;framing[x];
<a name="l01188"></a>01188          <span class="keywordflow">break</span>;
<a name="l01189"></a>01189       }
<a name="l01190"></a>01190    }
<a name="l01191"></a>01191 
<a name="l01192"></a>01192    <span class="comment">/* size validation */</span>
<a name="l01193"></a>01193    <span class="keywordflow">if</span> (!framems)
<a name="l01194"></a>01194       framems = AST_FORMAT_LIST[idx].<a class="code" href="structast__format__list.html#a6811d95221b6ad6a05fb9e628d903ff5">def_ms</a>;
<a name="l01195"></a>01195 
<a name="l01196"></a>01196    <span class="keywordflow">if</span> (AST_FORMAT_LIST[idx].<a class="code" href="structast__format__list.html#a05368e07b33c55c5588a16887e0d1937">inc_ms</a> &amp;&amp; framems % AST_FORMAT_LIST[idx].<a class="code" href="structast__format__list.html#a05368e07b33c55c5588a16887e0d1937">inc_ms</a>) <span class="comment">/* avoid division by zero */</span>
<a name="l01197"></a>01197       framems -= framems % AST_FORMAT_LIST[idx].<a class="code" href="structast__format__list.html#a05368e07b33c55c5588a16887e0d1937">inc_ms</a>;
<a name="l01198"></a>01198 
<a name="l01199"></a>01199    <span class="keywordflow">if</span> (framems &lt; AST_FORMAT_LIST[idx].<a class="code" href="structast__format__list.html#a005fe943b03a357496fec4fd5a5384c7">min_ms</a>)
<a name="l01200"></a>01200       framems = AST_FORMAT_LIST[idx].<a class="code" href="structast__format__list.html#a005fe943b03a357496fec4fd5a5384c7">min_ms</a>;
<a name="l01201"></a>01201 
<a name="l01202"></a>01202    <span class="keywordflow">if</span> (framems &gt; AST_FORMAT_LIST[idx].<a class="code" href="structast__format__list.html#ae92eef30d25050a86edb84d37a39b984">max_ms</a>)
<a name="l01203"></a>01203       framems = AST_FORMAT_LIST[idx].<a class="code" href="structast__format__list.html#ae92eef30d25050a86edb84d37a39b984">max_ms</a>;
<a name="l01204"></a>01204 
<a name="l01205"></a>01205    fmt.<a class="code" href="structast__format__list.html#a8082330d5592ca639ddd6f7be0c0c39b">cur_ms</a> = framems;
<a name="l01206"></a>01206 
<a name="l01207"></a>01207    <span class="keywordflow">return</span> fmt;
<a name="l01208"></a>01208 }
<a name="l01209"></a>01209 <span class="comment"></span>
<a name="l01210"></a>01210 <span class="comment">/*! \brief Pick a codec */</span>
<a name="l01211"></a><a class="code" href="frame_8c.html#a123ec7e6e90e279b75bc6447eab5d3b2">01211</a> <span class="keywordtype">int</span> <a class="code" href="frame_8h.html#a123ec7e6e90e279b75bc6447eab5d3b2" title="Select the best audio format according to preference list from supplied options....">ast_codec_choose</a>(<span class="keyword">struct</span> <a class="code" href="structast__codec__pref.html">ast_codec_pref</a> *pref, <span class="keywordtype">int</span> <a class="code" href="structformats.html">formats</a>, <span class="keywordtype">int</span> <a class="code" href="app__queue_8c.html#ab389b8ba466d7d05808b044592b05710" title="find the entry with the best metric, or NULL">find_best</a>)
<a name="l01212"></a>01212 {
<a name="l01213"></a>01213    <span class="keywordtype">int</span> x, ret = 0, slot;
<a name="l01214"></a>01214 
<a name="l01215"></a>01215    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(AST_FORMAT_LIST); x++) {
<a name="l01216"></a>01216       slot = pref-&gt;<a class="code" href="structast__codec__pref.html#af2068e452bdf5eeafcda00c8c06b5cc0">order</a>[x];
<a name="l01217"></a>01217 
<a name="l01218"></a>01218       <span class="keywordflow">if</span> (!slot)
<a name="l01219"></a>01219          <span class="keywordflow">break</span>;
<a name="l01220"></a>01220       <span class="keywordflow">if</span> (formats &amp; AST_FORMAT_LIST[slot-1].<a class="code" href="structast__format__list.html#ad1e28a1a66a25529b0b61b9ca4e66d44">bits</a>) {
<a name="l01221"></a>01221          ret = AST_FORMAT_LIST[slot-1].<a class="code" href="structast__format__list.html#ad1e28a1a66a25529b0b61b9ca4e66d44">bits</a>;
<a name="l01222"></a>01222          <span class="keywordflow">break</span>;
<a name="l01223"></a>01223       }
<a name="l01224"></a>01224    }
<a name="l01225"></a>01225    <span class="keywordflow">if</span> (ret &amp; <a class="code" href="frame_8h.html#a3f680b9c15596de927d507a664fd2803">AST_FORMAT_AUDIO_MASK</a>)
<a name="l01226"></a>01226       <span class="keywordflow">return</span> ret;
<a name="l01227"></a>01227 
<a name="l01228"></a>01228    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(4, <span class="stringliteral">&quot;Could not find preferred codec - %s\n&quot;</span>, find_best ? <span class="stringliteral">&quot;Going for the best codec&quot;</span> : <span class="stringliteral">&quot;Returning zero codec&quot;</span>);
<a name="l01229"></a>01229 
<a name="l01230"></a>01230       <span class="keywordflow">return</span> find_best ? <a class="code" href="channel_8h.html#a4d78194779a26341c3ec7298b450b9ed" title="Pick the best audio codec.">ast_best_codec</a>(formats) : 0;
<a name="l01231"></a>01231 }
<a name="l01232"></a>01232 
<a name="l01233"></a><a class="code" href="frame_8c.html#a35aa1fb72e1993a14156a6b912034ef9">01233</a> <span class="keywordtype">int</span> <a class="code" href="frame_8h.html#a35aa1fb72e1993a14156a6b912034ef9" title="Parse an &amp;quot;allow&amp;quot; or &amp;quot;deny&amp;quot; line in a channel or device configuration...">ast_parse_allow_disallow</a>(<span class="keyword">struct</span> <a class="code" href="structast__codec__pref.html">ast_codec_pref</a> *pref, <span class="keywordtype">int</span> *mask, <span class="keyword">const</span> <span class="keywordtype">char</span> *list, <span class="keywordtype">int</span> allowing) 
<a name="l01234"></a>01234 {
<a name="l01235"></a>01235    <span class="keywordtype">int</span> errors = 0;
<a name="l01236"></a>01236    <span class="keywordtype">char</span> *<a class="code" href="chan__mgcp_8c.html#a2e006acff60d9b3d65d7d60f975d6747">parse</a> = NULL, *<span class="keyword">this</span> = NULL, *psize = NULL;
<a name="l01237"></a>01237    <span class="keywordtype">int</span> <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a> = 0, framems = 0;
<a name="l01238"></a>01238 
<a name="l01239"></a>01239    parse = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(list);
<a name="l01240"></a>01240    <span class="keywordflow">while</span> ((<span class="keyword">this</span> = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;parse, <span class="stringliteral">&quot;,&quot;</span>))) {
<a name="l01241"></a>01241       framems = 0;
<a name="l01242"></a>01242       <span class="keywordflow">if</span> ((psize = strrchr(<span class="keyword">this</span>, <span class="charliteral">&apos;:&apos;</span>))) {
<a name="l01243"></a>01243          *psize++ = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01244"></a>01244          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Packetization for codec: %s is %s\n&quot;</span>, <span class="keyword">this</span>, psize);
<a name="l01245"></a>01245          framems = atoi(psize);
<a name="l01246"></a>01246          <span class="keywordflow">if</span> (framems &lt; 0) {
<a name="l01247"></a>01247             framems = 0;
<a name="l01248"></a>01248             errors++;
<a name="l01249"></a>01249             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Bad packetization value for codec %s\n&quot;</span>, <span class="keyword">this</span>);
<a name="l01250"></a>01250          }
<a name="l01251"></a>01251       }
<a name="l01252"></a>01252       <span class="keywordflow">if</span> (!(format = <a class="code" href="frame_8h.html#a2cf30450cd1821bfbc77d2d9e3605363" title="Gets a format from a name.">ast_getformatbyname</a>(<span class="keyword">this</span>))) {
<a name="l01253"></a>01253          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot %s unknown format &apos;%s&apos;\n&quot;</span>, allowing ? <span class="stringliteral">&quot;allow&quot;</span> : <span class="stringliteral">&quot;disallow&quot;</span>, <span class="keyword">this</span>);
<a name="l01254"></a>01254          errors++;
<a name="l01255"></a>01255          <span class="keywordflow">continue</span>;
<a name="l01256"></a>01256       }
<a name="l01257"></a>01257 
<a name="l01258"></a>01258       <span class="keywordflow">if</span> (mask) {
<a name="l01259"></a>01259          <span class="keywordflow">if</span> (allowing)
<a name="l01260"></a>01260             *mask |= format;
<a name="l01261"></a>01261          <span class="keywordflow">else</span>
<a name="l01262"></a>01262             *mask &amp;= ~format;
<a name="l01263"></a>01263       }
<a name="l01264"></a>01264 
<a name="l01265"></a>01265       <span class="comment">/* Set up a preference list for audio. Do not include video in preferences </span>
<a name="l01266"></a>01266 <span class="comment">         since we can not transcode video and have to use whatever is offered</span>
<a name="l01267"></a>01267 <span class="comment">       */</span>
<a name="l01268"></a>01268       <span class="keywordflow">if</span> (pref &amp;&amp; (format &amp; <a class="code" href="frame_8h.html#a3f680b9c15596de927d507a664fd2803">AST_FORMAT_AUDIO_MASK</a>)) {
<a name="l01269"></a>01269          <span class="keywordflow">if</span> (strcasecmp(<span class="keyword">this</span>, <span class="stringliteral">&quot;all&quot;</span>)) {
<a name="l01270"></a>01270             <span class="keywordflow">if</span> (allowing) {
<a name="l01271"></a>01271                <a class="code" href="frame_8h.html#a54b0af0dfdc8466239e6babb9303f7b3" title="Append a audio codec to a preference list, removing it first if it was already there...">ast_codec_pref_append</a>(pref, format);
<a name="l01272"></a>01272                <a class="code" href="frame_8h.html#a6803881645ae33ff0618b3648d26aeaa" title="Set packet size for codec.">ast_codec_pref_setsize</a>(pref, format, framems);
<a name="l01273"></a>01273             }
<a name="l01274"></a>01274             <span class="keywordflow">else</span>
<a name="l01275"></a>01275                <a class="code" href="frame_8h.html#a8daa8fe39c23fc605881466efafa00f7" title="Remove audio a codec from a preference list.">ast_codec_pref_remove</a>(pref, format);
<a name="l01276"></a>01276          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!allowing) {
<a name="l01277"></a>01277             memset(pref, 0, <span class="keyword">sizeof</span>(*pref));
<a name="l01278"></a>01278          }
<a name="l01279"></a>01279       }
<a name="l01280"></a>01280    }
<a name="l01281"></a>01281    <span class="keywordflow">return</span> errors;
<a name="l01282"></a>01282 }
<a name="l01283"></a>01283 
<a name="l01284"></a><a class="code" href="frame_8c.html#a5d8cb9e7ec765506672f15e0c2d184f1">01284</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="frame_8c.html#a5d8cb9e7ec765506672f15e0c2d184f1">g723_len</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>)
<a name="l01285"></a>01285 {
<a name="l01286"></a>01286    <span class="keyword">enum</span> <a class="code" href="frame_8c.html#a3ca2c0bc7578bf3d337e34b2c08a6c5f">frame_type</a> <a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a> = buf &amp; <a class="code" href="codec__speex_8c.html#aff17a6771d3319ab64930cd2b937d6cf">TYPE_MASK</a>;
<a name="l01287"></a>01287 
<a name="l01288"></a>01288    <span class="keywordflow">switch</span>(type) {
<a name="l01289"></a>01289    <span class="keywordflow">case</span> <a class="code" href="frame_8c.html#a3ca2c0bc7578bf3d337e34b2c08a6c5fab13f7bec98d45341d5c02adb21372dc7">TYPE_DONTSEND</a>:
<a name="l01290"></a>01290       <span class="keywordflow">return</span> 0;
<a name="l01291"></a>01291       <span class="keywordflow">break</span>;
<a name="l01292"></a>01292    <span class="keywordflow">case</span> <a class="code" href="codec__speex_8c.html#af560916d7051f74aa7cf9af7023cafe2">TYPE_SILENCE</a>:
<a name="l01293"></a>01293       <span class="keywordflow">return</span> 4;
<a name="l01294"></a>01294       <span class="keywordflow">break</span>;
<a name="l01295"></a>01295    <span class="keywordflow">case</span> <a class="code" href="codec__speex_8c.html#a2fa0578bfbd608daafde3c56a0ad15a6">TYPE_HIGH</a>:
<a name="l01296"></a>01296       <span class="keywordflow">return</span> 24;
<a name="l01297"></a>01297       <span class="keywordflow">break</span>;
<a name="l01298"></a>01298    <span class="keywordflow">case</span> <a class="code" href="codec__speex_8c.html#ab78c10a44f25f2b7196c44c0397839bf">TYPE_LOW</a>:
<a name="l01299"></a>01299       <span class="keywordflow">return</span> 20;
<a name="l01300"></a>01300       <span class="keywordflow">break</span>;
<a name="l01301"></a>01301    <span class="keywordflow">default</span>:
<a name="l01302"></a>01302       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Badly encoded frame (%d)\n&quot;</span>, type);
<a name="l01303"></a>01303    }
<a name="l01304"></a>01304    <span class="keywordflow">return</span> -1;
<a name="l01305"></a>01305 }
<a name="l01306"></a>01306 
<a name="l01307"></a><a class="code" href="frame_8c.html#a4eb46a9fec3d504357127c4c1ad41ac9">01307</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="frame_8c.html#a4eb46a9fec3d504357127c4c1ad41ac9">g723_samples</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <span class="keywordtype">int</span> maxlen)
<a name="l01308"></a>01308 {
<a name="l01309"></a>01309    <span class="keywordtype">int</span> pos = 0;
<a name="l01310"></a>01310    <span class="keywordtype">int</span> samples = 0;
<a name="l01311"></a>01311    <span class="keywordtype">int</span> res;
<a name="l01312"></a>01312    <span class="keywordflow">while</span>(pos &lt; maxlen) {
<a name="l01313"></a>01313       res = <a class="code" href="frame_8c.html#a5d8cb9e7ec765506672f15e0c2d184f1">g723_len</a>(buf[pos]);
<a name="l01314"></a>01314       <span class="keywordflow">if</span> (res &lt;= 0)
<a name="l01315"></a>01315          <span class="keywordflow">break</span>;
<a name="l01316"></a>01316       samples += 240;
<a name="l01317"></a>01317       pos += res;
<a name="l01318"></a>01318    }
<a name="l01319"></a>01319    <span class="keywordflow">return</span> samples;
<a name="l01320"></a>01320 }
<a name="l01321"></a>01321 
<a name="l01322"></a><a class="code" href="frame_8c.html#a3a631ab309b415fe0138d69ec7dbe323">01322</a> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="frame_8c.html#a3a631ab309b415fe0138d69ec7dbe323">get_n_bits_at</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *data, <span class="keywordtype">int</span> n, <span class="keywordtype">int</span> bit)
<a name="l01323"></a>01323 {
<a name="l01324"></a>01324    <span class="keywordtype">int</span> byte = bit / 8;       <span class="comment">/* byte containing first bit */</span>
<a name="l01325"></a>01325    <span class="keywordtype">int</span> rem = 8 - (bit % 8);  <span class="comment">/* remaining bits in first byte */</span>
<a name="l01326"></a>01326    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ret = 0;
<a name="l01327"></a>01327    
<a name="l01328"></a>01328    <span class="keywordflow">if</span> (n &lt;= 0 || n &gt; 8)
<a name="l01329"></a>01329       <span class="keywordflow">return</span> 0;
<a name="l01330"></a>01330 
<a name="l01331"></a>01331    <span class="keywordflow">if</span> (rem &lt; n) {
<a name="l01332"></a>01332       ret = (data[byte] &lt;&lt; (n - rem));
<a name="l01333"></a>01333       ret |= (data[byte + 1] &gt;&gt; (8 - n + rem));
<a name="l01334"></a>01334    } <span class="keywordflow">else</span> {
<a name="l01335"></a>01335       ret = (data[byte] &gt;&gt; (rem - n));
<a name="l01336"></a>01336    }
<a name="l01337"></a>01337 
<a name="l01338"></a>01338    <span class="keywordflow">return</span> (ret &amp; (0xff &gt;&gt; (8 - n)));
<a name="l01339"></a>01339 }
<a name="l01340"></a>01340 
<a name="l01341"></a><a class="code" href="frame_8c.html#a124f17e16301f8e0720d2f4388e0387e">01341</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="frame_8c.html#a124f17e16301f8e0720d2f4388e0387e">speex_get_wb_sz_at</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *data, <span class="keywordtype">int</span> <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, <span class="keywordtype">int</span> bit)
<a name="l01342"></a>01342 {
<a name="l01343"></a>01343    <span class="keyword">static</span> <span class="keywordtype">int</span> SpeexWBSubModeSz[] = {
<a name="l01344"></a>01344       0, 36, 112, 192,
<a name="l01345"></a>01345       352, 0, 0, 0 };
<a name="l01346"></a>01346    <span class="keywordtype">int</span> off = bit;
<a name="l01347"></a>01347    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> c;
<a name="l01348"></a>01348 
<a name="l01349"></a>01349    <span class="comment">/* skip up to two wideband frames */</span>
<a name="l01350"></a>01350    <span class="keywordflow">if</span> (((len * 8 - off) &gt;= 5) &amp;&amp; 
<a name="l01351"></a>01351       <a class="code" href="frame_8c.html#a3a631ab309b415fe0138d69ec7dbe323">get_n_bits_at</a>(data, 1, off)) {
<a name="l01352"></a>01352       c = <a class="code" href="frame_8c.html#a3a631ab309b415fe0138d69ec7dbe323">get_n_bits_at</a>(data, 3, off + 1);
<a name="l01353"></a>01353       off += SpeexWBSubModeSz[c];
<a name="l01354"></a>01354 
<a name="l01355"></a>01355       <span class="keywordflow">if</span> (((len * 8 - off) &gt;= 5) &amp;&amp; 
<a name="l01356"></a>01356          <a class="code" href="frame_8c.html#a3a631ab309b415fe0138d69ec7dbe323">get_n_bits_at</a>(data, 1, off)) {
<a name="l01357"></a>01357          c = <a class="code" href="frame_8c.html#a3a631ab309b415fe0138d69ec7dbe323">get_n_bits_at</a>(data, 3, off + 1);
<a name="l01358"></a>01358          off += SpeexWBSubModeSz[c];
<a name="l01359"></a>01359 
<a name="l01360"></a>01360          <span class="keywordflow">if</span> (((len * 8 - off) &gt;= 5) &amp;&amp; 
<a name="l01361"></a>01361             <a class="code" href="frame_8c.html#a3a631ab309b415fe0138d69ec7dbe323">get_n_bits_at</a>(data, 1, off)) {
<a name="l01362"></a>01362             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Encountered corrupt speex frame; too many wideband frames in a row.\n&quot;</span>);
<a name="l01363"></a>01363             <span class="keywordflow">return</span> -1;
<a name="l01364"></a>01364          }
<a name="l01365"></a>01365       }
<a name="l01366"></a>01366 
<a name="l01367"></a>01367    }
<a name="l01368"></a>01368    <span class="keywordflow">return</span> off - bit;
<a name="l01369"></a>01369 }
<a name="l01370"></a>01370 
<a name="l01371"></a><a class="code" href="frame_8c.html#adb6c30bc64d4ebc36843172a35105de4">01371</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="frame_8c.html#adb6c30bc64d4ebc36843172a35105de4">speex_samples</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *data, <span class="keywordtype">int</span> <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>)
<a name="l01372"></a>01372 {
<a name="l01373"></a>01373    <span class="keyword">static</span> <span class="keywordtype">int</span> SpeexSubModeSz[] = {
<a name="l01374"></a>01374       5, 43, 119, 160,
<a name="l01375"></a>01375       220, 300, 364, 492, 
<a name="l01376"></a>01376       79, 0, 0, 0,
<a name="l01377"></a>01377       0, 0, 0, 0 };
<a name="l01378"></a>01378    <span class="keyword">static</span> <span class="keywordtype">int</span> SpeexInBandSz[] = { 
<a name="l01379"></a>01379       1, 1, 4, 4,
<a name="l01380"></a>01380       4, 4, 4, 4,
<a name="l01381"></a>01381       8, 8, 16, 16,
<a name="l01382"></a>01382       32, 32, 64, 64 };
<a name="l01383"></a>01383    <span class="keywordtype">int</span> bit = 0;
<a name="l01384"></a>01384    <span class="keywordtype">int</span> cnt = 0;
<a name="l01385"></a>01385    <span class="keywordtype">int</span> off;
<a name="l01386"></a>01386    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> c;
<a name="l01387"></a>01387 
<a name="l01388"></a>01388    <span class="keywordflow">while</span> ((len * 8 - bit) &gt;= 5) {
<a name="l01389"></a>01389       <span class="comment">/* skip wideband frames */</span>
<a name="l01390"></a>01390       off = <a class="code" href="frame_8c.html#a124f17e16301f8e0720d2f4388e0387e">speex_get_wb_sz_at</a>(data, len, bit);
<a name="l01391"></a>01391       <span class="keywordflow">if</span> (off &lt; 0)  {
<a name="l01392"></a>01392          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Had error while reading wideband frames for speex samples\n&quot;</span>);
<a name="l01393"></a>01393          <span class="keywordflow">break</span>;
<a name="l01394"></a>01394       }
<a name="l01395"></a>01395       bit += off;
<a name="l01396"></a>01396 
<a name="l01397"></a>01397       <span class="keywordflow">if</span> ((len * 8 - bit) &lt; 5) {
<a name="l01398"></a>01398          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Not enough bits remaining after wide band for speex samples.\n&quot;</span>);
<a name="l01399"></a>01399          <span class="keywordflow">break</span>;
<a name="l01400"></a>01400       }
<a name="l01401"></a>01401 
<a name="l01402"></a>01402       <span class="comment">/* get control bits */</span>
<a name="l01403"></a>01403       c = <a class="code" href="frame_8c.html#a3a631ab309b415fe0138d69ec7dbe323">get_n_bits_at</a>(data, 5, bit);
<a name="l01404"></a>01404       bit += 5;
<a name="l01405"></a>01405 
<a name="l01406"></a>01406       <span class="keywordflow">if</span> (c == 15) { 
<a name="l01407"></a>01407          <span class="comment">/* terminator */</span>
<a name="l01408"></a>01408          <span class="keywordflow">break</span>; 
<a name="l01409"></a>01409       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == 14) {
<a name="l01410"></a>01410          <span class="comment">/* in-band signal; next 4 bits contain signal id */</span>
<a name="l01411"></a>01411          c = <a class="code" href="frame_8c.html#a3a631ab309b415fe0138d69ec7dbe323">get_n_bits_at</a>(data, 4, bit);
<a name="l01412"></a>01412          bit += 4;
<a name="l01413"></a>01413          bit += SpeexInBandSz[c];
<a name="l01414"></a>01414       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == 13) {
<a name="l01415"></a>01415          <span class="comment">/* user in-band; next 5 bits contain msg len */</span>
<a name="l01416"></a>01416          c = <a class="code" href="frame_8c.html#a3a631ab309b415fe0138d69ec7dbe323">get_n_bits_at</a>(data, 5, bit);
<a name="l01417"></a>01417          bit += 5;
<a name="l01418"></a>01418          bit += c * 8;
<a name="l01419"></a>01419       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c &gt; 8) {
<a name="l01420"></a>01420          <span class="comment">/* unknown */</span>
<a name="l01421"></a>01421          <span class="keywordflow">break</span>;
<a name="l01422"></a>01422       } <span class="keywordflow">else</span> {
<a name="l01423"></a>01423          <span class="comment">/* skip number bits for submode (less the 5 control bits) */</span>
<a name="l01424"></a>01424          bit += SpeexSubModeSz[c] - 5;
<a name="l01425"></a>01425          cnt += 160; <span class="comment">/* new frame */</span>
<a name="l01426"></a>01426       }
<a name="l01427"></a>01427    }
<a name="l01428"></a>01428    <span class="keywordflow">return</span> cnt;
<a name="l01429"></a>01429 }
<a name="l01430"></a>01430 
<a name="l01431"></a><a class="code" href="frame_8c.html#aedec72ae8357bb6c334111f93d283713">01431</a> <span class="keywordtype">int</span> <a class="code" href="frame_8h.html#aedec72ae8357bb6c334111f93d283713" title="Returns the number of samples contained in the frame.">ast_codec_get_samples</a>(<span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>)
<a name="l01432"></a>01432 {
<a name="l01433"></a>01433    <span class="keywordtype">int</span> samples = 0;
<a name="l01434"></a>01434 
<a name="l01435"></a>01435    <span class="keywordflow">switch</span>(f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>) {
<a name="l01436"></a>01436    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a1a05dee116bf73c0f1ca8410bdb48c62">AST_FORMAT_SPEEX</a>:
<a name="l01437"></a>01437       samples = <a class="code" href="frame_8c.html#adb6c30bc64d4ebc36843172a35105de4">speex_samples</a>(f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>);
<a name="l01438"></a>01438       <span class="keywordflow">break</span>;
<a name="l01439"></a>01439    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ad90b56ed6ada6e4f13224512668e20fb">AST_FORMAT_G723_1</a>:
<a name="l01440"></a>01440       samples = <a class="code" href="frame_8c.html#a4eb46a9fec3d504357127c4c1ad41ac9">g723_samples</a>(f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>);
<a name="l01441"></a>01441       <span class="keywordflow">break</span>;
<a name="l01442"></a>01442    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a8330d06ea408802c37e9af61a513c6a1">AST_FORMAT_ILBC</a>:
<a name="l01443"></a>01443       samples = 240 * (f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> / 50);
<a name="l01444"></a>01444       <span class="keywordflow">break</span>;
<a name="l01445"></a>01445    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a85106ada66147a674b36f0a55297d29d">AST_FORMAT_GSM</a>:
<a name="l01446"></a>01446       samples = 160 * (f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> / 33);
<a name="l01447"></a>01447       <span class="keywordflow">break</span>;
<a name="l01448"></a>01448    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a8c5f13161448f613baaf42dea11f520a">AST_FORMAT_G729A</a>:
<a name="l01449"></a>01449       samples = f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> * 8;
<a name="l01450"></a>01450       <span class="keywordflow">break</span>;
<a name="l01451"></a>01451    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>:
<a name="l01452"></a>01452    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a6e078550fcf3f2038f6c343b3d65a936">AST_FORMAT_SLINEAR16</a>:
<a name="l01453"></a>01453       samples = f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> / 2;
<a name="l01454"></a>01454       <span class="keywordflow">break</span>;
<a name="l01455"></a>01455    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ac816c6f1fd32b02a6d20af297d96d04f">AST_FORMAT_LPC10</a>:
<a name="l01456"></a>01456       <span class="comment">/* assumes that the RTP packet contains one LPC10 frame */</span>
<a name="l01457"></a>01457       samples = 22 * 8;
<a name="l01458"></a>01458       samples += (((<span class="keywordtype">char</span> *)(f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>))[7] &amp; 0x1) * 8;
<a name="l01459"></a>01459       <span class="keywordflow">break</span>;
<a name="l01460"></a>01460    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ab602cf455d4a96a3adba2e3ba8cd2b2c">AST_FORMAT_ULAW</a>:
<a name="l01461"></a>01461    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aa58cc980a9c9108522effc64e9aff2d6">AST_FORMAT_ALAW</a>:
<a name="l01462"></a>01462       samples = f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>;
<a name="l01463"></a>01463       <span class="keywordflow">break</span>;
<a name="l01464"></a>01464    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a4a0e8720928940d26abf28fff2e6586d">AST_FORMAT_G722</a>:
<a name="l01465"></a>01465    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a933964fc376c2642f9471c176fb7ae7d">AST_FORMAT_ADPCM</a>:
<a name="l01466"></a>01466    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a030c77081bc2aff5ae5a384769f46418">AST_FORMAT_G726</a>:
<a name="l01467"></a>01467    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a536fbd427f197a33e679c7721afad420">AST_FORMAT_G726_AAL2</a>:
<a name="l01468"></a>01468       samples = f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> * 2;
<a name="l01469"></a>01469       <span class="keywordflow">break</span>;
<a name="l01470"></a>01470    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a13092663dddb1492d81571f9f0ae4506">AST_FORMAT_SIREN7</a>:
<a name="l01471"></a>01471       <span class="comment">/* 16,000 samples per second at 32kbps is 4,000 bytes per second */</span>
<a name="l01472"></a>01472       samples = f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> * (16000 / 4000);
<a name="l01473"></a>01473       <span class="keywordflow">break</span>;
<a name="l01474"></a>01474    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a590224283a5c1527fab938e4d02686cc">AST_FORMAT_SIREN14</a>:
<a name="l01475"></a>01475       <span class="comment">/* 32,000 samples per second at 48kbps is 6,000 bytes per second */</span>
<a name="l01476"></a>01476       samples = (int) f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> * ((<span class="keywordtype">float</span>) 32000 / 6000);
<a name="l01477"></a>01477       <span class="keywordflow">break</span>;
<a name="l01478"></a>01478    <span class="keywordflow">default</span>:
<a name="l01479"></a>01479       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to calculate samples for format %s\n&quot;</span>, <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>));
<a name="l01480"></a>01480    }
<a name="l01481"></a>01481    <span class="keywordflow">return</span> samples;
<a name="l01482"></a>01482 }
<a name="l01483"></a>01483 
<a name="l01484"></a><a class="code" href="frame_8c.html#ae147ae1521acd6b95bba6956078b2f34">01484</a> <span class="keywordtype">int</span> <a class="code" href="frame_8h.html#ae147ae1521acd6b95bba6956078b2f34" title="Returns the number of bytes for the number of samples of the given format.">ast_codec_get_len</a>(<span class="keywordtype">int</span> <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>, <span class="keywordtype">int</span> samples)
<a name="l01485"></a>01485 {
<a name="l01486"></a>01486    <span class="keywordtype">int</span> <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> = 0;
<a name="l01487"></a>01487 
<a name="l01488"></a>01488    <span class="comment">/* XXX Still need speex, and lpc10 XXX */</span> 
<a name="l01489"></a>01489    <span class="keywordflow">switch</span>(format) {
<a name="l01490"></a>01490    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ad90b56ed6ada6e4f13224512668e20fb">AST_FORMAT_G723_1</a>:
<a name="l01491"></a>01491       len = (samples / 240) * 20;
<a name="l01492"></a>01492       <span class="keywordflow">break</span>;
<a name="l01493"></a>01493    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a8330d06ea408802c37e9af61a513c6a1">AST_FORMAT_ILBC</a>:
<a name="l01494"></a>01494       len = (samples / 240) * 50;
<a name="l01495"></a>01495       <span class="keywordflow">break</span>;
<a name="l01496"></a>01496    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a85106ada66147a674b36f0a55297d29d">AST_FORMAT_GSM</a>:
<a name="l01497"></a>01497       len = (samples / 160) * 33;
<a name="l01498"></a>01498       <span class="keywordflow">break</span>;
<a name="l01499"></a>01499    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a8c5f13161448f613baaf42dea11f520a">AST_FORMAT_G729A</a>:
<a name="l01500"></a>01500       len = samples / 8;
<a name="l01501"></a>01501       <span class="keywordflow">break</span>;
<a name="l01502"></a>01502    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>:
<a name="l01503"></a>01503    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a6e078550fcf3f2038f6c343b3d65a936">AST_FORMAT_SLINEAR16</a>:
<a name="l01504"></a>01504       len = samples * 2;
<a name="l01505"></a>01505       <span class="keywordflow">break</span>;
<a name="l01506"></a>01506    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ab602cf455d4a96a3adba2e3ba8cd2b2c">AST_FORMAT_ULAW</a>:
<a name="l01507"></a>01507    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aa58cc980a9c9108522effc64e9aff2d6">AST_FORMAT_ALAW</a>:
<a name="l01508"></a>01508       len = samples;
<a name="l01509"></a>01509       <span class="keywordflow">break</span>;
<a name="l01510"></a>01510    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a4a0e8720928940d26abf28fff2e6586d">AST_FORMAT_G722</a>:
<a name="l01511"></a>01511    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a933964fc376c2642f9471c176fb7ae7d">AST_FORMAT_ADPCM</a>:
<a name="l01512"></a>01512    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a030c77081bc2aff5ae5a384769f46418">AST_FORMAT_G726</a>:
<a name="l01513"></a>01513    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a536fbd427f197a33e679c7721afad420">AST_FORMAT_G726_AAL2</a>:
<a name="l01514"></a>01514       len = samples / 2;
<a name="l01515"></a>01515       <span class="keywordflow">break</span>;
<a name="l01516"></a>01516    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a13092663dddb1492d81571f9f0ae4506">AST_FORMAT_SIREN7</a>:
<a name="l01517"></a>01517       <span class="comment">/* 16,000 samples per second at 32kbps is 4,000 bytes per second */</span>
<a name="l01518"></a>01518       len = samples / (16000 / 4000);
<a name="l01519"></a>01519       <span class="keywordflow">break</span>;
<a name="l01520"></a>01520    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a590224283a5c1527fab938e4d02686cc">AST_FORMAT_SIREN14</a>:
<a name="l01521"></a>01521       <span class="comment">/* 32,000 samples per second at 48kbps is 6,000 bytes per second */</span>
<a name="l01522"></a>01522       len = (int) samples / ((<span class="keywordtype">float</span>) 32000 / 6000);
<a name="l01523"></a>01523       <span class="keywordflow">break</span>;
<a name="l01524"></a>01524    <span class="keywordflow">default</span>:
<a name="l01525"></a>01525       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to calculate sample length for format %s\n&quot;</span>, <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(format));
<a name="l01526"></a>01526    }
<a name="l01527"></a>01527 
<a name="l01528"></a>01528    <span class="keywordflow">return</span> len;
<a name="l01529"></a>01529 }
<a name="l01530"></a>01530 
<a name="l01531"></a><a class="code" href="frame_8c.html#a59b72ee1caa9e8349ca017df01e8ac55">01531</a> <span class="keywordtype">int</span> <a class="code" href="frame_8h.html#a59b72ee1caa9e8349ca017df01e8ac55" title="Adjusts the volume of the audio samples contained in a frame.">ast_frame_adjust_volume</a>(<span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>, <span class="keywordtype">int</span> adjustment)
<a name="l01532"></a>01532 {
<a name="l01533"></a>01533    <span class="keywordtype">int</span> count;
<a name="l01534"></a>01534    <span class="keywordtype">short</span> *fdata = f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>;
<a name="l01535"></a>01535    <span class="keywordtype">short</span> adjust_value = abs(adjustment);
<a name="l01536"></a>01536 
<a name="l01537"></a>01537    <span class="keywordflow">if</span> ((f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> != <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>) || (f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> != <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>))
<a name="l01538"></a>01538       <span class="keywordflow">return</span> -1;
<a name="l01539"></a>01539 
<a name="l01540"></a>01540    <span class="keywordflow">if</span> (!adjustment)
<a name="l01541"></a>01541       <span class="keywordflow">return</span> 0;
<a name="l01542"></a>01542 
<a name="l01543"></a>01543    <span class="keywordflow">for</span> (count = 0; count &lt; f-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>; count++) {
<a name="l01544"></a>01544       <span class="keywordflow">if</span> (adjustment &gt; 0) {
<a name="l01545"></a>01545          <a class="code" href="utils_8h.html#a5b2919c84591a13feb6b750b54c57520">ast_slinear_saturated_multiply</a>(&amp;fdata[count], &amp;adjust_value);
<a name="l01546"></a>01546       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (adjustment &lt; 0) {
<a name="l01547"></a>01547          <a class="code" href="utils_8h.html#af5e55a87e9741a1bbea1e2ec2f99a1e1">ast_slinear_saturated_divide</a>(&amp;fdata[count], &amp;adjust_value);
<a name="l01548"></a>01548       }
<a name="l01549"></a>01549    }
<a name="l01550"></a>01550 
<a name="l01551"></a>01551    <span class="keywordflow">return</span> 0;
<a name="l01552"></a>01552 }
<a name="l01553"></a>01553 
<a name="l01554"></a><a class="code" href="frame_8c.html#ab819ef38276be16fede1c39cfcc8306c">01554</a> <span class="keywordtype">int</span> <a class="code" href="frame_8h.html#ab819ef38276be16fede1c39cfcc8306c" title="Sums two frames of audio samples.">ast_frame_slinear_sum</a>(<span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *f1, <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *f2)
<a name="l01555"></a>01555 {
<a name="l01556"></a>01556    <span class="keywordtype">int</span> count;
<a name="l01557"></a>01557    <span class="keywordtype">short</span> *data1, *data2;
<a name="l01558"></a>01558 
<a name="l01559"></a>01559    <span class="keywordflow">if</span> ((f1-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> != <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>) || (f1-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> != <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>))
<a name="l01560"></a>01560       <span class="keywordflow">return</span> -1;
<a name="l01561"></a>01561 
<a name="l01562"></a>01562    <span class="keywordflow">if</span> ((f2-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> != <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>) || (f2-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> != <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>))
<a name="l01563"></a>01563       <span class="keywordflow">return</span> -1;
<a name="l01564"></a>01564 
<a name="l01565"></a>01565    <span class="keywordflow">if</span> (f1-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> != f2-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>)
<a name="l01566"></a>01566       <span class="keywordflow">return</span> -1;
<a name="l01567"></a>01567 
<a name="l01568"></a>01568    <span class="keywordflow">for</span> (count = 0, data1 = f1-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, data2 = f2-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>;
<a name="l01569"></a>01569         count &lt; f1-&gt;samples;
<a name="l01570"></a>01570         count++, data1++, data2++)
<a name="l01571"></a>01571       <a class="code" href="utils_8h.html#a8761597fec2f8a17d105a82c20d0b728">ast_slinear_saturated_add</a>(data1, data2);
<a name="l01572"></a>01572 
<a name="l01573"></a>01573    <span class="keywordflow">return</span> 0;
<a name="l01574"></a>01574 }
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:18:40 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
