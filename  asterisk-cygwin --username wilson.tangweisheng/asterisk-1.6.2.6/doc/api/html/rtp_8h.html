<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:23:21 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_1ab815038f534adda65c8b4ae4993449.html">include</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_16d825f1fa9ecca2e70b1a8d9256d0e6.html">asterisk</a>
  </div>
</div>
<div class="contents">
<h1>rtp.h File Reference</h1>
<p>Supports RTP and RTCP with Symmetric RTP support for NAT traversal.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="network_8h_source.html">asterisk/network.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="frame_8h_source.html">asterisk/frame.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="io_8h_source.html">asterisk/io.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="sched_8h_source.html">asterisk/sched.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="channel_8h_source.html">asterisk/channel.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="linkedlists_8h_source.html">asterisk/linkedlists.h</a>&quot;</code><br/>

<p><a href="rtp_8h_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__rtp__protocol.html">ast_rtp_protocol</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This is the structure that binds a channel (SIP/Jingle/H.323) to the RTP subsystem.  <a href="structast__rtp__protocol.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__rtp__quality.html">ast_rtp_quality</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">RTCP quality report storage.  <a href="structast__rtp__quality.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrtpPayloadType.html">rtpPayloadType</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The value of each payload format mapping:.  <a href="structrtpPayloadType.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#afd196e2ba79659dff0799d49494e8b45">AST_RTP_CISCO_DTMF</a>&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 2)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#ad924782a38efb3a8f9edbb92d3135541">AST_RTP_CN</a>&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 1)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a3cc8001677e3b955b9b5ceb4267a76ec">AST_RTP_DTMF</a>&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 0)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#ae89f572a6b37614f05f4e210afcffa8c">AST_RTP_MAX</a>&nbsp;&nbsp;&nbsp;AST_RTP_CISCO_DTMF</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a1b696f676e4e78260e3356973f647034">FLAG_3389_WARNING</a>&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 0)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#ac8aa85cd14ebbc20fc0043f6f72b968d">MAX_RTP_PT</a>&nbsp;&nbsp;&nbsp;256</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#af72998d88fc2e3a7b7225e6d5bd37e30">RED_MAX_GENERATION</a>&nbsp;&nbsp;&nbsp;5</td></tr>
<tr><td colspan="2"><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef int(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a8d640c81e33ce90c44ae443dbd9f38cb">ast_rtp_callback</a> )(struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, struct <a class="el" href="structast__frame.html">ast_frame</a> *<a class="el" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>, void *data)</td></tr>
<tr><td colspan="2"><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95">ast_rtp_get_result</a> { <a class="el" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a> =  0, 
<a class="el" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95a8bc993394ab95ca4c2ac98f9477518fe">AST_RTP_TRY_PARTIAL</a>, 
<a class="el" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ab591abc73866492b4b33dd96d9925136">AST_RTP_TRY_NATIVE</a>
 }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a95ccef8388e3b0e9c9639e393d4081b6">ast_rtp_options</a> { <a class="el" href="rtp_8h.html#a95ccef8388e3b0e9c9639e393d4081b6ad570d49420fe15c4660793d1fc2f0fc8">AST_RTP_OPT_G726_NONSTANDARD</a> =  (1 &lt;&lt; 0)
 }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a58b8acdd5acd2a70aa1a6d7040db199f">ast_rtp_qos_vars</a> { <br/>
&nbsp;&nbsp;<a class="el" href="rtp_8h.html#a58b8acdd5acd2a70aa1a6d7040db199fa7693b0a1e7eace7864bdc786233f6fcd">AST_RTP_TXCOUNT</a>, 
<a class="el" href="rtp_8h.html#a58b8acdd5acd2a70aa1a6d7040db199fa3b1506d914a21ac0ab82c85fc67e35d2">AST_RTP_RXCOUNT</a>, 
<a class="el" href="rtp_8h.html#a58b8acdd5acd2a70aa1a6d7040db199fa349dc7902b65436f8fb251d5df5f2711">AST_RTP_TXJITTER</a>, 
<a class="el" href="rtp_8h.html#a58b8acdd5acd2a70aa1a6d7040db199fa5bf842efa73289a66d780670fd68e9c4">AST_RTP_RXJITTER</a>, 
<br/>
&nbsp;&nbsp;<a class="el" href="rtp_8h.html#a58b8acdd5acd2a70aa1a6d7040db199fa61c9ec686ce215425f2d5ce98d6d3603">AST_RTP_RXPLOSS</a>, 
<a class="el" href="rtp_8h.html#a58b8acdd5acd2a70aa1a6d7040db199fada74b59f8703038f54e74dea998d0a5a">AST_RTP_TXPLOSS</a>, 
<a class="el" href="rtp_8h.html#a58b8acdd5acd2a70aa1a6d7040db199fa00e0735389375cf9b1dd3eb72f83d940">AST_RTP_RTT</a>
<br/>
 }</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p>Variables used in ast_rtcp_get function. </p>
 <a href="rtp_8h.html#a58b8acdd5acd2a70aa1a6d7040db199f">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a756ea404ff32087dee22a779a8d277a6">ast_rtp_quality_type</a> { <a class="el" href="rtp_8h.html#a756ea404ff32087dee22a779a8d277a6a7f88830a41aa42bfb5e25f40f8184019">RTPQOS_SUMMARY</a> =  0, 
<a class="el" href="rtp_8h.html#a756ea404ff32087dee22a779a8d277a6aa977210a30c7eeab8d2592df4e197d4b">RTPQOS_JITTER</a>, 
<a class="el" href="rtp_8h.html#a756ea404ff32087dee22a779a8d277a6a06685070e92abe94bdd33cd1abaa30c1">RTPQOS_LOSS</a>, 
<a class="el" href="rtp_8h.html#a756ea404ff32087dee22a779a8d277a6acecf9cdfe1b45c0f19c4e9516c0d68ae">RTPQOS_RTT</a>
 }</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#ac3e115dfd0bfe82479060b55dd41601f">ast_rtcp_fd</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#ad2add11e197fbff70b7ff710f90e617f">ast_rtcp_read</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a90ca590267510860f846c606e9e764a8">ast_rtcp_send_h261fur</a> (void *data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send an H.261 fast update request. Some devices need this rather than the XML <a class="el" href="structmessage.html">message</a> in SIP.  <a href="#a90ca590267510860f846c606e9e764a8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a697378663e75e6a9591aaf728c0fb968">ast_rtp_alloc_size</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the amount of space required to hold an RTP session.  <a href="#a697378663e75e6a9591aaf728c0fb968"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#af45b92414bcb435f50e82c819e77649c">ast_rtp_bridge</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c0, struct <a class="el" href="structast__channel.html">ast_channel</a> *c1, int flags, struct <a class="el" href="structast__frame.html">ast_frame</a> **fo, struct <a class="el" href="structast__channel.html">ast_channel</a> **rc, int timeoutms)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The RTP bridge.  <a href="#af45b92414bcb435f50e82c819e77649c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a6fbba7cab174d951968e91cc94afb200">ast_rtp_codec_getformat</a> (int pt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">get format from predefined dynamic payload format  <a href="#a6fbba7cab174d951968e91cc94afb200"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__codec__pref.html">ast_codec_pref</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#af759eaf34ade34d4f118d45655fcd6bc">ast_rtp_codec_getpref</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get codec preference.  <a href="#af759eaf34ade34d4f118d45655fcd6bc"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#ae6a1acd75aaf08afc6954bd5ac671c6a">ast_rtp_codec_setpref</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, struct <a class="el" href="structast__codec__pref.html">ast_codec_pref</a> *<a class="el" href="chan__iax2_8c.html#a46262e3cc2baf55a72542567ccfe86d9">prefs</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set codec preference.  <a href="#ae6a1acd75aaf08afc6954bd5ac671c6a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a6d2addabf879eb321a660932e3bd57eb">ast_rtp_destroy</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#aba89225382987d42ec798462d15930e6">ast_rtp_early_bridge</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c0, struct <a class="el" href="structast__channel.html">ast_channel</a> *c1)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">If possible, create an early bridge directly between the devices without having to send a re-invite later.  <a href="#aba89225382987d42ec798462d15930e6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a9a990d85fb0aac29bda48777f0f86108">ast_rtp_fd</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#af7dc32ebdfacbbf446321de6fcfe2d9a">ast_rtp_get_bridged</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a0af7232148535d9bc024fc01579d4ec8">ast_rtp_get_current_formats</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, int *astFormats, int *nonAstFormats)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return the union of all of the codecs that were set by rtp_set...() calls They're returned as two distinct sets: AST_FORMATs, and AST_RTPs.  <a href="#a0af7232148535d9bc024fc01579d4ec8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#aa1ffde0e800995c386729bc5eaf82e7c">ast_rtp_get_peer</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, struct sockaddr_in *them)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#ae8c09b6f55ec0b7444a9b48038157d22">ast_rtp_get_qos</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, const char *<a class="el" href="chan__unistim_8c.html#a6369bc99bfc6b7cfce77770cc1798d58">qos</a>, char *<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, unsigned int buflen)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get QOS stats on a RTP channel.  <a href="#ae8c09b6f55ec0b7444a9b48038157d22"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a78d6d7ba670a9b2eebe039db90b00fb4">ast_rtp_get_qosvalue</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, enum <a class="el" href="rtp_8h.html#a58b8acdd5acd2a70aa1a6d7040db199f">ast_rtp_qos_vars</a> value)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return RTP and RTCP QoS <a class="el" href="structvalues.html">values</a>.  <a href="#a78d6d7ba670a9b2eebe039db90b00fb4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#ab704d9412f9a12c656f51baf77f65a08">ast_rtp_get_quality</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, struct <a class="el" href="structast__rtp__quality.html">ast_rtp_quality</a> *qual, enum <a class="el" href="rtp_8h.html#a756ea404ff32087dee22a779a8d277a6">ast_rtp_quality_type</a> qtype)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return RTCP quality string.  <a href="#ab704d9412f9a12c656f51baf77f65a08"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a3a2d59587ce0c7d5259a33726f1c1e5c">ast_rtp_get_rtpholdtimeout</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get rtp hold timeout.  <a href="#a3a2d59587ce0c7d5259a33726f1c1e5c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a003294c332c246f8ad007df22ecd5a16">ast_rtp_get_rtpkeepalive</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get RTP keepalive interval.  <a href="#a003294c332c246f8ad007df22ecd5a16"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a09840fa9ab8d07f139c5d0729cfebe13">ast_rtp_get_rtptimeout</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get rtp timeout.  <a href="#a09840fa9ab8d07f139c5d0729cfebe13"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a307269685e6f067a6abe35a184c3bae6">ast_rtp_get_us</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, struct sockaddr_in *us)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a036fcb49050c5f45a075d18b2f20c96a">ast_rtp_getnat</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a2e910d500d92f02ebf8d571f585d6dd3">ast_rtp_init</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize the RTP system in Asterisk.  <a href="#a2e910d500d92f02ebf8d571f585d6dd3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a4daa559b8f2ef25bc33d8f5d8fd937d1">ast_rtp_lookup_code</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, int isAstFormat, int code)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Looks up an RTP code out of our *static* outbound list.  <a href="#a4daa559b8f2ef25bc33d8f5d8fd937d1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a00ae5fb20d1016e2fdf140befbebff05">ast_rtp_lookup_mime_multiple</a> (char *<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, size_t size, const int <a class="el" href="chan__mgcp_8c.html#afa05b14ff7f76f303c784c00c4c63fa7">capability</a>, const int isAstFormat, enum <a class="el" href="rtp_8h.html#a95ccef8388e3b0e9c9639e393d4081b6">ast_rtp_options</a> options)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Build a string of MIME subtype names from a capability list.  <a href="#a00ae5fb20d1016e2fdf140befbebff05"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#ac740a1df73c95aecb587ccc0d46251a5">ast_rtp_lookup_mime_subtype</a> (int isAstFormat, int code, enum <a class="el" href="rtp_8h.html#a95ccef8388e3b0e9c9639e393d4081b6">ast_rtp_options</a> options)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Mapping an Asterisk code into a MIME subtype (string):.  <a href="#ac740a1df73c95aecb587ccc0d46251a5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structrtpPayloadType.html">rtpPayloadType</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a9fdf56baeb1e0ca97859d10826bdd1de">ast_rtp_lookup_pt</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, int pt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Mapping between RTP payload format codes and Asterisk codes:.  <a href="#a9fdf56baeb1e0ca97859d10826bdd1de"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#af081370a8afd454b1f8cae5bdc55be09">ast_rtp_lookup_sample_rate</a> (int isAstFormat, int code)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the sample rate associated with known RTP payload types.  <a href="#af081370a8afd454b1f8cae5bdc55be09"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#ad410e7253fcf8b398328276412d4232e">ast_rtp_make_compatible</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *dest, struct <a class="el" href="structast__channel.html">ast_channel</a> *src, int media)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a7736ea5b51cac9412ae82d6f009d7055">ast_rtp_new</a> (struct <a class="el" href="structsched__context.html">sched_context</a> *<a class="el" href="structsched.html">sched</a>, struct <a class="el" href="structio__context.html">io_context</a> *<a class="el" href="pbx__dundi_8c.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a>, int rtcpenable, int callbackmode)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initializate a RTP session.  <a href="#a7736ea5b51cac9412ae82d6f009d7055"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#ad1235778d2cb1fbe8b1339b43ca3602c">ast_rtp_new_init</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize a new RTP structure.  <a href="#ad1235778d2cb1fbe8b1339b43ca3602c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a858a9803ad1b78fc1b9602bb9cad1411">ast_rtp_new_source</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a10d5296cd50be78954103b0a0c754640">ast_rtp_new_with_bindaddr</a> (struct <a class="el" href="structsched__context.html">sched_context</a> *<a class="el" href="structsched.html">sched</a>, struct <a class="el" href="structio__context.html">io_context</a> *<a class="el" href="pbx__dundi_8c.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a>, int rtcpenable, int callbackmode, struct in_addr in)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initializate a RTP session using an in_addr structure.  <a href="#a10d5296cd50be78954103b0a0c754640"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a00b94396faf3f52b0c3ea612a9af334d">ast_rtp_proto_register</a> (struct <a class="el" href="structast__rtp__protocol.html">ast_rtp_protocol</a> *proto)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Register an RTP channel client.  <a href="#a00b94396faf3f52b0c3ea612a9af334d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a39d797fe6097e914323998f72b13420c">ast_rtp_proto_unregister</a> (struct <a class="el" href="structast__rtp__protocol.html">ast_rtp_protocol</a> *proto)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unregister an RTP channel client.  <a href="#a39d797fe6097e914323998f72b13420c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#ac008cc5d5e4b915062b98ff2f202cc38">ast_rtp_pt_clear</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Setting RTP payload types from lines in a SDP description:.  <a href="#ac008cc5d5e4b915062b98ff2f202cc38"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a30cfc736f18627e5d0d25196a116faa1">ast_rtp_pt_copy</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *dest, struct <a class="el" href="structast__rtp.html">ast_rtp</a> *src)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Copy payload types between RTP structures.  <a href="#a30cfc736f18627e5d0d25196a116faa1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#af9ebff17643c46897280902ccd33ff40">ast_rtp_pt_default</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set payload types to defaults.  <a href="#af9ebff17643c46897280902ccd33ff40"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#ac0a9d31f175e3de83fa1dda629c11674">ast_rtp_read</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a939d33729da677d7fc093f99c558e8e6">ast_rtp_reload</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a40fda91dae06184092d7d70663b19416">ast_rtp_reset</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#ab1a31f2e24aafee3087c227e50eb4ee8">ast_rtp_sendcng</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, int level)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">generate comfort noice (CNG)  <a href="#ab1a31f2e24aafee3087c227e50eb4ee8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#ad67b565977122712cc970d5a12f124b2">ast_rtp_senddigit_begin</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, char digit)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send begin frames for DTMF.  <a href="#ad67b565977122712cc970d5a12f124b2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a75bc4adaf04f7e5348fc73608c3b1ebc">ast_rtp_senddigit_end</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, char digit)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send end packets for DTMF.  <a href="#a75bc4adaf04f7e5348fc73608c3b1ebc"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#ac80a75863b5a15612ec319f181c4da7f">ast_rtp_set_alt_peer</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, struct sockaddr_in *alt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">set potential alternate source for RTP media  <a href="#ac80a75863b5a15612ec319f181c4da7f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a5919a5a4eef238a45254313d782a864c">ast_rtp_set_callback</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, <a class="el" href="rtp_8h.html#a8d640c81e33ce90c44ae443dbd9f38cb">ast_rtp_callback</a> callback)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a4bbc4b17d1c8afe7d831346edf73e6d2">ast_rtp_set_constantssrc</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">When changing sources, don't generate a new SSRC.  <a href="#a4bbc4b17d1c8afe7d831346edf73e6d2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#adeb9cc3c3a7b7b8bf4a7e63e395a56b6">ast_rtp_set_data</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a83fe16478ba4b99f0bc1798f1064baef">ast_rtp_set_m_type</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, int pt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Activate payload type.  <a href="#a83fe16478ba4b99f0bc1798f1064baef"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a8731e858c93551d3bb56a2f297a9ef59">ast_rtp_set_peer</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, struct sockaddr_in *them)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a3d6eab4ad6579f8616f1f9457aa6bba7">ast_rtp_set_rtpholdtimeout</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, int timeout)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set rtp hold timeout.  <a href="#a3d6eab4ad6579f8616f1f9457aa6bba7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a519628da9d60698b3b630697f6df0ed4">ast_rtp_set_rtpkeepalive</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, int period)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">set RTP keepalive interval  <a href="#a519628da9d60698b3b630697f6df0ed4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a02a3ba4e11691cafd933cbb1e6225b3e">ast_rtp_set_rtpmap_type</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, int pt, char *<a class="el" href="structmimeType.html">mimeType</a>, char *mimeSubtype, enum <a class="el" href="rtp_8h.html#a95ccef8388e3b0e9c9639e393d4081b6">ast_rtp_options</a> options)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set payload type to a known MIME media type for a codec.  <a href="#a02a3ba4e11691cafd933cbb1e6225b3e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a1c0ef66aed0fb55f27f44154cce3e238">ast_rtp_set_rtpmap_type_rate</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, int pt, char *<a class="el" href="structmimeType.html">mimeType</a>, char *mimeSubtype, enum <a class="el" href="rtp_8h.html#a95ccef8388e3b0e9c9639e393d4081b6">ast_rtp_options</a> options, unsigned int sample_rate)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set payload type to a known MIME media type for a codec with a specific sample rate.  <a href="#a1c0ef66aed0fb55f27f44154cce3e238"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a30d6a83648ee8345a70aa1a2ccd311c7">ast_rtp_set_rtptimeout</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, int timeout)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set rtp timeout.  <a href="#a30d6a83648ee8345a70aa1a2ccd311c7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#aa50e1394275ae2a2fd61da5659c5cb57">ast_rtp_set_rtptimers_onhold</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a787203f0e9b0ad978ee7d381cb280d2a">ast_rtp_set_vars</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set RTPAUDIOQOS(...) variables on a channel when it is being hung up.  <a href="#a787203f0e9b0ad978ee7d381cb280d2a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a60e7859e5819265bbc0ba619f852b0aa">ast_rtp_setdtmf</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, int dtmf)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Indicate whether this RTP session is carrying DTMF or not.  <a href="#a60e7859e5819265bbc0ba619f852b0aa"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#af89b655b02f586e920c3a27d06a590b1">ast_rtp_setdtmfcompensate</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, int compensate)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Compensate for devices that send RFC2833 packets all at once.  <a href="#af89b655b02f586e920c3a27d06a590b1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#ad7fd9b0ac09fc5378dcf120bc5d18c03">ast_rtp_setnat</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, int <a class="el" href="chan__mgcp_8c.html#ada540a5f25f7302dc1a3d17ccfa59b10">nat</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#af8579b7a7b2815a83cd80bf1c23d7824">ast_rtp_setqos</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, int <a class="el" href="pbx__dundi_8c.html#a25a9305efab3b493ca2519562fcec3d5">tos</a>, int <a class="el" href="chan__unistim_8c.html#ae91dad65f553f7afebe4af507803bc7f">cos</a>, char *<a class="el" href="channel_8c.html#a710bce51374aba96ab04912897666c35">desc</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a7c4ba34d21a78cb29bed9a286858180b">ast_rtp_setstun</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, int stun_enable)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Enable STUN capability.  <a href="#a7c4ba34d21a78cb29bed9a286858180b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a55123d53642a71a4bd834fcc0c0f00c5">ast_rtp_stop</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a07235f64f5a9df68065cfe08ee6d9f44">ast_rtp_stun_request</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, struct sockaddr_in *suggestion, const char *username)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send STUN request for an RTP socket Deprecated, this is just a wrapper for <a class="el" href="rtp_8h.html#a07235f64f5a9df68065cfe08ee6d9f44" title="Send STUN request for an RTP socket Deprecated, this is just a wrapper for ast_rtp_stun_request()...">ast_rtp_stun_request()</a>.  <a href="#a07235f64f5a9df68065cfe08ee6d9f44"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#af509d36b6cbaefc1c0c5f7c754967555">ast_rtp_unset_m_type</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, int pt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">clear payload type  <a href="#af509d36b6cbaefc1c0c5f7c754967555"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a7a8ffdcbe10f04c3ca29e7cad359a68c">ast_rtp_write</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, struct <a class="el" href="structast__frame.html">ast_frame</a> *<a class="el" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#a494a72723299c0e75e1c2cf092135ea6">ast_stun_request</a> (int s, struct sockaddr_in *dst, const char *username, struct sockaddr_in *answer)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Generic STUN request send a generic stun request to the server specified.  <a href="#a494a72723299c0e75e1c2cf092135ea6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#aea735d249de828c184131bdb74863210">red_buffer_t140</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, struct <a class="el" href="structast__frame.html">ast_frame</a> *<a class="el" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Buffer t.140 data.  <a href="#aea735d249de828c184131bdb74863210"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtp_8h.html#abb328c934231a434fa342680b881e49a">rtp_red_init</a> (struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, int ti, int *pt, int num_gen)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initalize t.140 redudancy.  <a href="#abb328c934231a434fa342680b881e49a"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Supports RTP and RTCP with Symmetric RTP support for NAT traversal. </p>
<p>RTP is defined in RFC 3550. </p>

<p>Definition in file <a class="el" href="rtp_8h_source.html">rtp.h</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="afd196e2ba79659dff0799d49494e8b45"></a><!-- doxytag: member="rtp.h::AST_RTP_CISCO_DTMF" ref="afd196e2ba79659dff0799d49494e8b45" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_RTP_CISCO_DTMF&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 2)</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>DTMF (Cisco Proprietary) </p>

<p>Definition at line <a class="el" href="rtp_8h_source.html#l00047">47</a> of file <a class="el" href="rtp_8h_source.html">rtp.h</a>.</p>

<p>Referenced by <a class="el" href="rtp_8c_source.html#l01562">ast_rtp_read()</a>.</p>

</div>
</div>
<a class="anchor" id="ad924782a38efb3a8f9edbb92d3135541"></a><!-- doxytag: member="rtp.h::AST_RTP_CN" ref="ad924782a38efb3a8f9edbb92d3135541" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_RTP_CN&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 1)</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>'Comfort Noise' (RFC3389) </p>

<p>Definition at line <a class="el" href="rtp_8h_source.html#l00045">45</a> of file <a class="el" href="rtp_8h_source.html">rtp.h</a>.</p>

<p>Referenced by <a class="el" href="rtp_8c_source.html#l01562">ast_rtp_read()</a>, and <a class="el" href="rtp_8c_source.html#l03574">ast_rtp_sendcng()</a>.</p>

</div>
</div>
<a class="anchor" id="a3cc8001677e3b955b9b5ceb4267a76ec"></a><!-- doxytag: member="rtp.h::AST_RTP_DTMF" ref="a3cc8001677e3b955b9b5ceb4267a76ec" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_RTP_DTMF&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 0)</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>DTMF (RFC2833) </p>

<p>Definition at line <a class="el" href="rtp_8h_source.html#l00043">43</a> of file <a class="el" href="rtp_8h_source.html">rtp.h</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l09955">add_noncodec_to_sdp()</a>, <a class="el" href="chan__mgcp_8c_source.html#l02047">add_sdp()</a>, <a class="el" href="rtp_8c_source.html#l01562">ast_rtp_read()</a>, <a class="el" href="rtp_8c_source.html#l03141">ast_rtp_senddigit_begin()</a>, <a class="el" href="rtp_8c_source.html#l01508">bridge_p2p_rtp_write()</a>, <a class="el" href="chan__sip_8c_source.html#l13923">check_peer_ok()</a>, <a class="el" href="chan__h323_8c_source.html#l01650">create_addr()</a>, <a class="el" href="chan__sip_8c_source.html#l05102">create_addr_from_peer()</a>, <a class="el" href="chan__h323_8c_source.html#l01101">oh323_alloc()</a>, <a class="el" href="chan__h323_8c_source.html#l01722">oh323_request()</a>, <a class="el" href="chan__sip_8c_source.html#l08040">process_sdp()</a>, <a class="el" href="chan__sip_8c_source.html#l07151">sip_alloc()</a>, and <a class="el" href="chan__sip_8c_source.html#l25380">sip_dtmfmode()</a>.</p>

</div>
</div>
<a class="anchor" id="ae89f572a6b37614f05f4e210afcffa8c"></a><!-- doxytag: member="rtp.h::AST_RTP_MAX" ref="ae89f572a6b37614f05f4e210afcffa8c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_RTP_MAX&nbsp;&nbsp;&nbsp;AST_RTP_CISCO_DTMF</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Maximum RTP-specific code </p>

<p>Definition at line <a class="el" href="rtp_8h_source.html#l00049">49</a> of file <a class="el" href="rtp_8h_source.html">rtp.h</a>.</p>

<p>Referenced by <a class="el" href="chan__mgcp_8c_source.html#l02047">add_sdp()</a>, and <a class="el" href="rtp_8c_source.html#l02433">ast_rtp_lookup_mime_multiple()</a>.</p>

</div>
</div>
<a class="anchor" id="a1b696f676e4e78260e3356973f647034"></a><!-- doxytag: member="rtp.h::FLAG_3389_WARNING" ref="a1b696f676e4e78260e3356973f647034" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FLAG_3389_WARNING&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 0)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rtp_8h_source.html#l00057">57</a> of file <a class="el" href="rtp_8h_source.html">rtp.h</a>.</p>

<p>Referenced by <a class="el" href="rtp_8c_source.html#l01120">process_rfc3389()</a>.</p>

</div>
</div>
<a class="anchor" id="ac8aa85cd14ebbc20fc0043f6f72b968d"></a><!-- doxytag: member="rtp.h::MAX_RTP_PT" ref="ac8aa85cd14ebbc20fc0043f6f72b968d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_RTP_PT&nbsp;&nbsp;&nbsp;256</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Maxmum <a class="el" href="structnumber.html" title="Number structure.">number</a> of payload defintions for a RTP session </p>

<p>Definition at line <a class="el" href="rtp_8h_source.html#l00052">52</a> of file <a class="el" href="rtp_8h_source.html">rtp.h</a>.</p>

<p>Referenced by <a class="el" href="rtp_8c_source.html#l03779">ast_rtp_codec_getformat()</a>, <a class="el" href="rtp_8c_source.html#l02319">ast_rtp_get_current_formats()</a>, <a class="el" href="rtp_8c_source.html#l02360">ast_rtp_lookup_code()</a>, <a class="el" href="rtp_8c_source.html#l02338">ast_rtp_lookup_pt()</a>, <a class="el" href="rtp_8c_source.html#l01995">ast_rtp_pt_clear()</a>, <a class="el" href="rtp_8c_source.html#l02035">ast_rtp_pt_copy()</a>, <a class="el" href="rtp_8c_source.html#l02016">ast_rtp_pt_default()</a>, <a class="el" href="rtp_8c_source.html#l02234">ast_rtp_set_m_type()</a>, <a class="el" href="rtp_8c_source.html#l02261">ast_rtp_set_rtpmap_type_rate()</a>, <a class="el" href="rtp_8c_source.html#l02246">ast_rtp_unset_m_type()</a>, and <a class="el" href="chan__sip_8c_source.html#l08730">process_sdp_a_audio()</a>.</p>

</div>
</div>
<a class="anchor" id="af72998d88fc2e3a7b7225e6d5bd37e30"></a><!-- doxytag: member="rtp.h::RED_MAX_GENERATION" ref="af72998d88fc2e3a7b7225e6d5bd37e30" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RED_MAX_GENERATION&nbsp;&nbsp;&nbsp;5</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>T.140 Redundancy Maxium <a class="el" href="structnumber.html" title="Number structure.">number</a> of generations </p>

<p>Definition at line <a class="el" href="rtp_8h_source.html#l00055">55</a> of file <a class="el" href="rtp_8h_source.html">rtp.h</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l08853">process_sdp_a_text()</a>.</p>

</div>
</div>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="a8d640c81e33ce90c44ae443dbd9f38cb"></a><!-- doxytag: member="rtp.h::ast_rtp_callback" ref="a8d640c81e33ce90c44ae443dbd9f38cb" args=")(struct ast_rtp *rtp, struct ast_frame *f, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int(* <a class="el" href="rtp_8h.html#a8d640c81e33ce90c44ae443dbd9f38cb">ast_rtp_callback</a>)(struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, struct <a class="el" href="structast__frame.html">ast_frame</a> *<a class="el" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>, void *data)</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>RTP callback structure </p>

<p>Definition at line <a class="el" href="rtp_8h_source.html#l00130">130</a> of file <a class="el" href="rtp_8h_source.html">rtp.h</a>.</p>

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="adb5c0a29db09eb234a36f24b25766a95"></a><!-- doxytag: member="rtp.h::ast_rtp_get_result" ref="adb5c0a29db09eb234a36f24b25766a95" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95">ast_rtp_get_result</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4"></a><!-- doxytag: member="AST_RTP_GET_FAILED" ref="adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4" args="" -->AST_RTP_GET_FAILED</em>&nbsp;</td><td>
<p>Failed to find the RTP structure </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="adb5c0a29db09eb234a36f24b25766a95a8bc993394ab95ca4c2ac98f9477518fe"></a><!-- doxytag: member="AST_RTP_TRY_PARTIAL" ref="adb5c0a29db09eb234a36f24b25766a95a8bc993394ab95ca4c2ac98f9477518fe" args="" -->AST_RTP_TRY_PARTIAL</em>&nbsp;</td><td>
<p>RTP structure exists but true native bridge can not occur so try partial </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="adb5c0a29db09eb234a36f24b25766a95ab591abc73866492b4b33dd96d9925136"></a><!-- doxytag: member="AST_RTP_TRY_NATIVE" ref="adb5c0a29db09eb234a36f24b25766a95ab591abc73866492b4b33dd96d9925136" args="" -->AST_RTP_TRY_NATIVE</em>&nbsp;</td><td>
<p>RTP structure exists and native bridge can occur </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="rtp_8h_source.html#l00063">63</a> of file <a class="el" href="rtp_8h_source.html">rtp.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00063"></a>00063                         {<span class="comment"></span>
<a name="l00064"></a>00064 <span class="comment">   /*! Failed to find the RTP structure */</span>
<a name="l00065"></a>00065    <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a> = 0,<span class="comment"></span>
<a name="l00066"></a>00066 <span class="comment">   /*! RTP structure exists but true native bridge can not occur so try partial */</span>
<a name="l00067"></a>00067    <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95a8bc993394ab95ca4c2ac98f9477518fe">AST_RTP_TRY_PARTIAL</a>,<span class="comment"></span>
<a name="l00068"></a>00068 <span class="comment">   /*! RTP structure exists and native bridge can occur */</span>
<a name="l00069"></a>00069    <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ab591abc73866492b4b33dd96d9925136">AST_RTP_TRY_NATIVE</a>,
<a name="l00070"></a>00070 };
</pre></div></p>

</div>
</div>
<a class="anchor" id="a95ccef8388e3b0e9c9639e393d4081b6"></a><!-- doxytag: member="rtp.h::ast_rtp_options" ref="a95ccef8388e3b0e9c9639e393d4081b6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="rtp_8h.html#a95ccef8388e3b0e9c9639e393d4081b6">ast_rtp_options</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a95ccef8388e3b0e9c9639e393d4081b6ad570d49420fe15c4660793d1fc2f0fc8"></a><!-- doxytag: member="AST_RTP_OPT_G726_NONSTANDARD" ref="a95ccef8388e3b0e9c9639e393d4081b6ad570d49420fe15c4660793d1fc2f0fc8" args="" -->AST_RTP_OPT_G726_NONSTANDARD</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="rtp_8h_source.html#l00059">59</a> of file <a class="el" href="rtp_8h_source.html">rtp.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00059"></a>00059                      {
<a name="l00060"></a>00060    <a class="code" href="rtp_8h.html#a95ccef8388e3b0e9c9639e393d4081b6ad570d49420fe15c4660793d1fc2f0fc8">AST_RTP_OPT_G726_NONSTANDARD</a> = (1 &lt;&lt; 0),
<a name="l00061"></a>00061 };
</pre></div></p>

</div>
</div>
<a class="anchor" id="a58b8acdd5acd2a70aa1a6d7040db199f"></a><!-- doxytag: member="rtp.h::ast_rtp_qos_vars" ref="a58b8acdd5acd2a70aa1a6d7040db199f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="rtp_8h.html#a58b8acdd5acd2a70aa1a6d7040db199f">ast_rtp_qos_vars</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Variables used in ast_rtcp_get function. </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a58b8acdd5acd2a70aa1a6d7040db199fa7693b0a1e7eace7864bdc786233f6fcd"></a><!-- doxytag: member="AST_RTP_TXCOUNT" ref="a58b8acdd5acd2a70aa1a6d7040db199fa7693b0a1e7eace7864bdc786233f6fcd" args="" -->AST_RTP_TXCOUNT</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a58b8acdd5acd2a70aa1a6d7040db199fa3b1506d914a21ac0ab82c85fc67e35d2"></a><!-- doxytag: member="AST_RTP_RXCOUNT" ref="a58b8acdd5acd2a70aa1a6d7040db199fa3b1506d914a21ac0ab82c85fc67e35d2" args="" -->AST_RTP_RXCOUNT</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a58b8acdd5acd2a70aa1a6d7040db199fa349dc7902b65436f8fb251d5df5f2711"></a><!-- doxytag: member="AST_RTP_TXJITTER" ref="a58b8acdd5acd2a70aa1a6d7040db199fa349dc7902b65436f8fb251d5df5f2711" args="" -->AST_RTP_TXJITTER</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a58b8acdd5acd2a70aa1a6d7040db199fa5bf842efa73289a66d780670fd68e9c4"></a><!-- doxytag: member="AST_RTP_RXJITTER" ref="a58b8acdd5acd2a70aa1a6d7040db199fa5bf842efa73289a66d780670fd68e9c4" args="" -->AST_RTP_RXJITTER</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a58b8acdd5acd2a70aa1a6d7040db199fa61c9ec686ce215425f2d5ce98d6d3603"></a><!-- doxytag: member="AST_RTP_RXPLOSS" ref="a58b8acdd5acd2a70aa1a6d7040db199fa61c9ec686ce215425f2d5ce98d6d3603" args="" -->AST_RTP_RXPLOSS</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a58b8acdd5acd2a70aa1a6d7040db199fada74b59f8703038f54e74dea998d0a5a"></a><!-- doxytag: member="AST_RTP_TXPLOSS" ref="a58b8acdd5acd2a70aa1a6d7040db199fada74b59f8703038f54e74dea998d0a5a" args="" -->AST_RTP_TXPLOSS</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a58b8acdd5acd2a70aa1a6d7040db199fa00e0735389375cf9b1dd3eb72f83d940"></a><!-- doxytag: member="AST_RTP_RTT" ref="a58b8acdd5acd2a70aa1a6d7040db199fa00e0735389375cf9b1dd3eb72f83d940" args="" -->AST_RTP_RTT</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="rtp_8h_source.html#l00073">73</a> of file <a class="el" href="rtp_8h_source.html">rtp.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00073"></a>00073                       {
<a name="l00074"></a>00074    <a class="code" href="rtp_8h.html#a58b8acdd5acd2a70aa1a6d7040db199fa7693b0a1e7eace7864bdc786233f6fcd">AST_RTP_TXCOUNT</a>,
<a name="l00075"></a>00075    <a class="code" href="rtp_8h.html#a58b8acdd5acd2a70aa1a6d7040db199fa3b1506d914a21ac0ab82c85fc67e35d2">AST_RTP_RXCOUNT</a>,
<a name="l00076"></a>00076    <a class="code" href="rtp_8h.html#a58b8acdd5acd2a70aa1a6d7040db199fa349dc7902b65436f8fb251d5df5f2711">AST_RTP_TXJITTER</a>,
<a name="l00077"></a>00077    <a class="code" href="rtp_8h.html#a58b8acdd5acd2a70aa1a6d7040db199fa5bf842efa73289a66d780670fd68e9c4">AST_RTP_RXJITTER</a>,
<a name="l00078"></a>00078    <a class="code" href="rtp_8h.html#a58b8acdd5acd2a70aa1a6d7040db199fa61c9ec686ce215425f2d5ce98d6d3603">AST_RTP_RXPLOSS</a>,
<a name="l00079"></a>00079    <a class="code" href="rtp_8h.html#a58b8acdd5acd2a70aa1a6d7040db199fada74b59f8703038f54e74dea998d0a5a">AST_RTP_TXPLOSS</a>,
<a name="l00080"></a>00080    <a class="code" href="rtp_8h.html#a58b8acdd5acd2a70aa1a6d7040db199fa00e0735389375cf9b1dd3eb72f83d940">AST_RTP_RTT</a>
<a name="l00081"></a>00081 };
</pre></div></p>

</div>
</div>
<a class="anchor" id="a756ea404ff32087dee22a779a8d277a6"></a><!-- doxytag: member="rtp.h::ast_rtp_quality_type" ref="a756ea404ff32087dee22a779a8d277a6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="rtp_8h.html#a756ea404ff32087dee22a779a8d277a6">ast_rtp_quality_type</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a756ea404ff32087dee22a779a8d277a6a7f88830a41aa42bfb5e25f40f8184019"></a><!-- doxytag: member="RTPQOS_SUMMARY" ref="a756ea404ff32087dee22a779a8d277a6a7f88830a41aa42bfb5e25f40f8184019" args="" -->RTPQOS_SUMMARY</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a756ea404ff32087dee22a779a8d277a6aa977210a30c7eeab8d2592df4e197d4b"></a><!-- doxytag: member="RTPQOS_JITTER" ref="a756ea404ff32087dee22a779a8d277a6aa977210a30c7eeab8d2592df4e197d4b" args="" -->RTPQOS_JITTER</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a756ea404ff32087dee22a779a8d277a6a06685070e92abe94bdd33cd1abaa30c1"></a><!-- doxytag: member="RTPQOS_LOSS" ref="a756ea404ff32087dee22a779a8d277a6a06685070e92abe94bdd33cd1abaa30c1" args="" -->RTPQOS_LOSS</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a756ea404ff32087dee22a779a8d277a6acecf9cdfe1b45c0f19c4e9516c0d68ae"></a><!-- doxytag: member="RTPQOS_RTT" ref="a756ea404ff32087dee22a779a8d277a6acecf9cdfe1b45c0f19c4e9516c0d68ae" args="" -->RTPQOS_RTT</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="rtp_8h_source.html#l00109">109</a> of file <a class="el" href="rtp_8h_source.html">rtp.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00109"></a>00109                           {
<a name="l00110"></a>00110    <a class="code" href="rtp_8h.html#a756ea404ff32087dee22a779a8d277a6a7f88830a41aa42bfb5e25f40f8184019">RTPQOS_SUMMARY</a> = 0,
<a name="l00111"></a>00111    <a class="code" href="rtp_8h.html#a756ea404ff32087dee22a779a8d277a6aa977210a30c7eeab8d2592df4e197d4b">RTPQOS_JITTER</a>,
<a name="l00112"></a>00112    <a class="code" href="rtp_8h.html#a756ea404ff32087dee22a779a8d277a6a06685070e92abe94bdd33cd1abaa30c1">RTPQOS_LOSS</a>,
<a name="l00113"></a>00113    <a class="code" href="rtp_8h.html#a756ea404ff32087dee22a779a8d277a6acecf9cdfe1b45c0f19c4e9516c0d68ae">RTPQOS_RTT</a>
<a name="l00114"></a>00114 };
</pre></div></p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ac3e115dfd0bfe82479060b55dd41601f"></a><!-- doxytag: member="rtp.h::ast_rtcp_fd" ref="ac3e115dfd0bfe82479060b55dd41601f" args="(struct ast_rtp *rtp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_rtcp_fd </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rtp_8c_source.html#l00723">723</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l00170">ast_rtp::rtcp</a>, and <a class="el" href="rtp_8c_source.html#l00232">ast_rtcp::s</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l00999">__oh323_new()</a>, <a class="el" href="chan__h323_8c_source.html#l00951">__oh323_rtp_create()</a>, <a class="el" href="chan__h323_8c_source.html#l00332">__oh323_update_info()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00989">gtalk_new()</a>, <a class="el" href="chan__jingle_8c_source.html#l00800">jingle_new()</a>, <a class="el" href="chan__sip_8c_source.html#l06599">sip_new()</a>, <a class="el" href="chan__skinny_8c_source.html#l03557">start_rtp()</a>, and <a class="el" href="chan__unistim_8c_source.html#l04422">unistim_new()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00724"></a>00724 {
<a name="l00725"></a>00725    <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>)
<a name="l00726"></a>00726       <span class="keywordflow">return</span> rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a339d22b3e442946380f98ed19e320db2">s</a>;
<a name="l00727"></a>00727    <span class="keywordflow">return</span> -1;
<a name="l00728"></a>00728 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad2add11e197fbff70b7ff710f90e617f"></a><!-- doxytag: member="rtp.h::ast_rtcp_read" ref="ad2add11e197fbff70b7ff710f90e617f" args="(struct ast_rtp *rtp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__frame.html">ast_frame</a>* ast_rtcp_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rtp_8c_source.html#l01168">1168</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l00247">ast_rtcp::accumulated_transit</a>, <a class="el" href="rtp_8c_source.html#l00235">ast_rtcp::altthem</a>, <a class="el" href="utils_8h_source.html#l00678">ast_assert</a>, <a class="el" href="frame_8h_source.html#l00315">AST_CONTROL_VIDUPDATE</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8h_source.html#l00105">AST_FRAME_CONTROL</a>, <a class="el" href="frame_8h_source.html#l00203">AST_FRIENDLY_OFFSET</a>, <a class="el" href="utils_8c_source.html#l00431">ast_inet_ntoa()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="frame_8c_source.html#l00124">ast_null_frame</a>, <a class="el" href="logger_8h_source.html#l00079">ast_verbose</a>, <a class="el" href="frame_8h_source.html#l00147">ast_frame::datalen</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="manager_8h_source.html#l00070">EVENT_FLAG_REPORTING</a>, <a class="el" href="rtp_8c_source.html#l00104">ast_rtp::f</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="func__strings_8c_source.html#l00821">len()</a>, <a class="el" href="logger_8h_source.html#l00119">LOG_DEBUG</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="frame_8h_source.html#l00151">ast_frame::mallocd</a>, <a class="el" href="manager_8h_source.html#l00181">manager_event</a>, <a class="el" href="rtp_8c_source.html#l00279">ast_rtcp::maxrtt</a>, <a class="el" href="rtp_8c_source.html#l00280">ast_rtcp::minrtt</a>, <a class="el" href="rtp_8c_source.html#l00145">ast_rtp::nat</a>, <a class="el" href="rtp_8c_source.html#l00843">normdev_compute()</a>, <a class="el" href="rtp_8c_source.html#l00281">ast_rtcp::normdevrtt</a>, <a class="el" href="asterisk_8c_source.html#l00175">option_debug</a>, <a class="el" href="rtp_8c_source.html#l00249">ast_rtcp::reported_jitter</a>, <a class="el" href="rtp_8c_source.html#l00260">ast_rtcp::reported_jitter_count</a>, <a class="el" href="rtp_8c_source.html#l00250">ast_rtcp::reported_lost</a>, <a class="el" href="rtp_8c_source.html#l00256">ast_rtcp::reported_maxjitter</a>, <a class="el" href="rtp_8c_source.html#l00262">ast_rtcp::reported_maxlost</a>, <a class="el" href="rtp_8c_source.html#l00257">ast_rtcp::reported_minjitter</a>, <a class="el" href="rtp_8c_source.html#l00263">ast_rtcp::reported_minlost</a>, <a class="el" href="rtp_8c_source.html#l00258">ast_rtcp::reported_normdev_jitter</a>, <a class="el" href="rtp_8c_source.html#l00264">ast_rtcp::reported_normdev_lost</a>, <a class="el" href="rtp_8c_source.html#l00259">ast_rtcp::reported_stdev_jitter</a>, <a class="el" href="rtp_8c_source.html#l00265">ast_rtcp::reported_stdev_lost</a>, <a class="el" href="rtp_8c_source.html#l00170">ast_rtp::rtcp</a>, <a class="el" href="rtp_8c_source.html#l00909">rtcp_debug_test_addr()</a>, <a class="el" href="rtp_8c_source.html#l00231">ast_rtcp::rtcp_info</a>, <a class="el" href="rtp_8c_source.html#l00062">RTCP_PT_BYE</a>, <a class="el" href="rtp_8c_source.html#l00058">RTCP_PT_FUR</a>, <a class="el" href="rtp_8c_source.html#l00060">RTCP_PT_RR</a>, <a class="el" href="rtp_8c_source.html#l00061">RTCP_PT_SDES</a>, <a class="el" href="rtp_8c_source.html#l00059">RTCP_PT_SR</a>, <a class="el" href="rtp_8c_source.html#l00248">ast_rtcp::rtt</a>, <a class="el" href="rtp_8c_source.html#l00283">ast_rtcp::rtt_count</a>, <a class="el" href="rtp_8c_source.html#l00239">ast_rtcp::rxlsr</a>, <a class="el" href="rtp_8c_source.html#l00232">ast_rtcp::s</a>, <a class="el" href="frame_8h_source.html#l00149">ast_frame::samples</a>, <a class="el" href="rtp_8c_source.html#l00236">ast_rtcp::soc</a>, <a class="el" href="rtp_8c_source.html#l00237">ast_rtcp::spc</a>, <a class="el" href="frame_8h_source.html#l00157">ast_frame::src</a>, <a class="el" href="rtp_8c_source.html#l00851">stddev_compute()</a>, <a class="el" href="rtp_8c_source.html#l00282">ast_rtcp::stdevrtt</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, <a class="el" href="rtp_8c_source.html#l00234">ast_rtcp::them</a>, <a class="el" href="rtp_8c_source.html#l00238">ast_rtcp::themrxlsr</a>, and <a class="el" href="rtp_8c_source.html#l00708">timeval2ntp()</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l00803">oh323_read()</a>, <a class="el" href="chan__sip_8c_source.html#l06955">sip_rtp_read()</a>, <a class="el" href="chan__skinny_8c_source.html#l03907">skinny_rtp_read()</a>, and <a class="el" href="chan__unistim_8c_source.html#l03905">unistim_rtp_read()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01169"></a>01169 {
<a name="l01170"></a>01170    socklen_t <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;
<a name="l01171"></a>01171    <span class="keywordtype">int</span> position, i, packetwords;
<a name="l01172"></a>01172    <span class="keywordtype">int</span> res;
<a name="l01173"></a>01173    <span class="keyword">struct </span>sockaddr_in sock_in;
<a name="l01174"></a>01174    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rtcpdata[8192 + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>];
<a name="l01175"></a>01175    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *rtcpheader;
<a name="l01176"></a>01176    <span class="keywordtype">int</span> pt;
<a name="l01177"></a>01177    <span class="keyword">struct </span>timeval now;
<a name="l01178"></a>01178    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> length;
<a name="l01179"></a>01179    <span class="keywordtype">int</span> rc;
<a name="l01180"></a>01180    <span class="keywordtype">double</span> rttsec;
<a name="l01181"></a>01181    uint64_t rtt = 0;
<a name="l01182"></a>01182    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dlsr;
<a name="l01183"></a>01183    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lsr;
<a name="l01184"></a>01184    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> msw;
<a name="l01185"></a>01185    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lsw;
<a name="l01186"></a>01186    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> comp;
<a name="l01187"></a>01187    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a> = &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l01188"></a>01188    
<a name="l01189"></a>01189    <span class="keywordtype">double</span> reported_jitter;
<a name="l01190"></a>01190    <span class="keywordtype">double</span> reported_normdev_jitter_current;
<a name="l01191"></a>01191    <span class="keywordtype">double</span> normdevrtt_current;
<a name="l01192"></a>01192    <span class="keywordtype">double</span> reported_lost;
<a name="l01193"></a>01193    <span class="keywordtype">double</span> reported_normdev_lost_current;
<a name="l01194"></a>01194 
<a name="l01195"></a>01195    <span class="keywordflow">if</span> (!rtp || !rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>)
<a name="l01196"></a>01196       <span class="keywordflow">return</span> &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l01197"></a>01197 
<a name="l01198"></a>01198    len = <span class="keyword">sizeof</span>(sock_in);
<a name="l01199"></a>01199    
<a name="l01200"></a>01200    res = recvfrom(rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a339d22b3e442946380f98ed19e320db2">s</a>, rtcpdata + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>, <span class="keyword">sizeof</span>(rtcpdata) - <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) * <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>,
<a name="l01201"></a>01201                0, (<span class="keyword">struct</span> sockaddr *)&amp;sock_in, &amp;len);
<a name="l01202"></a>01202    rtcpheader = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *)(rtcpdata + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>);
<a name="l01203"></a>01203    
<a name="l01204"></a>01204    <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l01205"></a>01205       <a class="code" href="utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(errno != EBADF);
<a name="l01206"></a>01206       <span class="keywordflow">if</span> (errno != EAGAIN) {
<a name="l01207"></a>01207          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;RTCP Read error: %s.  Hanging up.\n&quot;</span>, strerror(errno));
<a name="l01208"></a>01208          <span class="keywordflow">return</span> NULL;
<a name="l01209"></a>01209       }
<a name="l01210"></a>01210       <span class="keywordflow">return</span> &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l01211"></a>01211    }
<a name="l01212"></a>01212 
<a name="l01213"></a>01213    packetwords = res / 4;
<a name="l01214"></a>01214    
<a name="l01215"></a>01215    <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#ada540a5f25f7302dc1a3d17ccfa59b10">nat</a>) {
<a name="l01216"></a>01216       <span class="comment">/* Send to whoever sent to us */</span>
<a name="l01217"></a>01217       <span class="keywordflow">if</span> (((rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr.s_addr != sock_in.sin_addr.s_addr) ||
<a name="l01218"></a>01218           (rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port != sock_in.sin_port)) &amp;&amp; 
<a name="l01219"></a>01219           ((rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a567178215831a573c88f6370305a2997">altthem</a>.sin_addr.s_addr != sock_in.sin_addr.s_addr) || 
<a name="l01220"></a>01220           (rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a567178215831a573c88f6370305a2997">altthem</a>.sin_port != sock_in.sin_port))) {
<a name="l01221"></a>01221          memcpy(&amp;rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>, &amp;sock_in, <span class="keyword">sizeof</span>(rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>));
<a name="l01222"></a>01222          <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ga40f8fb2e731031d99f732f515cec680f">option_debug</a> || <a class="code" href="rtp_8c.html#a147859009ddb300c602e8e9ca3c85983">rtpdebug</a>)
<a name="l01223"></a>01223             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(0, <span class="stringliteral">&quot;RTCP NAT: Got RTCP from other end. Now sending to address %s:%d\n&quot;</span>, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr), ntohs(rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port));
<a name="l01224"></a>01224       }
<a name="l01225"></a>01225    }
<a name="l01226"></a>01226 
<a name="l01227"></a>01227    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Got RTCP report of %d bytes\n&quot;</span>, res);
<a name="l01228"></a>01228 
<a name="l01229"></a>01229    <span class="comment">/* Process a compound packet */</span>
<a name="l01230"></a>01230    position = 0;
<a name="l01231"></a>01231    <span class="keywordflow">while</span> (position &lt; packetwords) {
<a name="l01232"></a>01232       i = position;
<a name="l01233"></a>01233       length = ntohl(rtcpheader[i]);
<a name="l01234"></a>01234       pt = (length &amp; 0xff0000) &gt;&gt; 16;
<a name="l01235"></a>01235       rc = (length &amp; 0x1f000000) &gt;&gt; 24;
<a name="l01236"></a>01236       length &amp;= 0xffff;
<a name="l01237"></a>01237  
<a name="l01238"></a>01238       <span class="keywordflow">if</span> ((i + length) &gt; packetwords) {
<a name="l01239"></a>01239          <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ga40f8fb2e731031d99f732f515cec680f">option_debug</a> || <a class="code" href="rtp_8c.html#a147859009ddb300c602e8e9ca3c85983">rtpdebug</a>)
<a name="l01240"></a>01240             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;RTCP Read too short\n&quot;</span>);
<a name="l01241"></a>01241          <span class="keywordflow">return</span> &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l01242"></a>01242       }
<a name="l01243"></a>01243       
<a name="l01244"></a>01244       <span class="keywordflow">if</span> (<a class="code" href="rtp_8c.html#a24040ef125f03db4df56ee0113beee9e">rtcp_debug_test_addr</a>(&amp;sock_in)) {
<a name="l01245"></a>01245          <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;\n\nGot RTCP from %s:%d\n&quot;</span>, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(sock_in.sin_addr), ntohs(sock_in.sin_port));
<a name="l01246"></a>01246          <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;PT: %d(%s)\n&quot;</span>, pt, (pt == 200) ? <span class="stringliteral">&quot;Sender Report&quot;</span> : (pt == 201) ? <span class="stringliteral">&quot;Receiver Report&quot;</span> : (pt == 192) ? <span class="stringliteral">&quot;H.261 FUR&quot;</span> : <span class="stringliteral">&quot;Unknown&quot;</span>);
<a name="l01247"></a>01247          <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;Reception reports: %d\n&quot;</span>, rc);
<a name="l01248"></a>01248          <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;SSRC of sender: %u\n&quot;</span>, rtcpheader[i + 1]);
<a name="l01249"></a>01249       }
<a name="l01250"></a>01250  
<a name="l01251"></a>01251       i += 2; <span class="comment">/* Advance past header and ssrc */</span>
<a name="l01252"></a>01252       
<a name="l01253"></a>01253       <span class="keywordflow">switch</span> (pt) {
<a name="l01254"></a>01254       <span class="keywordflow">case</span> <a class="code" href="rtp_8c.html#abe50a9d9c36c702889863e206f4502c6">RTCP_PT_SR</a>:
<a name="l01255"></a>01255          gettimeofday(&amp;rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#ad96a304ae7c0f3dd877c1db41a5a668e">rxlsr</a>,NULL); <span class="comment">/* To be able to populate the dlsr */</span>
<a name="l01256"></a>01256          rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a959172bce678fc4a84719bd16af5ae2b">spc</a> = ntohl(rtcpheader[i+3]);
<a name="l01257"></a>01257          rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a5559c53d2e48d42237cc342fff7dab72">soc</a> = ntohl(rtcpheader[i + 4]);
<a name="l01258"></a>01258          rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a1a01ee9eadfc673fe172181c754928f5">themrxlsr</a> = ((ntohl(rtcpheader[i]) &amp; 0x0000ffff) &lt;&lt; 16) | ((ntohl(rtcpheader[i + 1]) &amp; 0xffff0000) &gt;&gt; 16); <span class="comment">/* Going to LSR in RR*/</span>
<a name="l01259"></a>01259  
<a name="l01260"></a>01260          <span class="keywordflow">if</span> (<a class="code" href="rtp_8c.html#a24040ef125f03db4df56ee0113beee9e">rtcp_debug_test_addr</a>(&amp;sock_in)) {
<a name="l01261"></a>01261             <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;NTP timestamp: %lu.%010lu\n&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) ntohl(rtcpheader[i]), (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) ntohl(rtcpheader[i + 1]) * 4096);
<a name="l01262"></a>01262             <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;RTP timestamp: %lu\n&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) ntohl(rtcpheader[i + 2]));
<a name="l01263"></a>01263             <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;SPC: %lu\tSOC: %lu\n&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) ntohl(rtcpheader[i + 3]), (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) ntohl(rtcpheader[i + 4]));
<a name="l01264"></a>01264          }
<a name="l01265"></a>01265          i += 5;
<a name="l01266"></a>01266          <span class="keywordflow">if</span> (rc &lt; 1)
<a name="l01267"></a>01267             <span class="keywordflow">break</span>;
<a name="l01268"></a>01268          <span class="comment">/* Intentional fall through */</span>
<a name="l01269"></a>01269       <span class="keywordflow">case</span> <a class="code" href="rtp_8c.html#a4d8564f9c96df1cd1076ad4f6faed7ab">RTCP_PT_RR</a>:
<a name="l01270"></a>01270          <span class="comment">/* Don&apos;t handle multiple reception reports (rc &gt; 1) yet */</span>
<a name="l01271"></a>01271          <span class="comment">/* Calculate RTT per RFC */</span>
<a name="l01272"></a>01272          gettimeofday(&amp;now, NULL);
<a name="l01273"></a>01273          <a class="code" href="rtp_8c.html#ae07b5d23a23d4d09988c4a1c5d477d14">timeval2ntp</a>(now, &amp;msw, &amp;lsw);
<a name="l01274"></a>01274          <span class="keywordflow">if</span> (ntohl(rtcpheader[i + 4]) &amp;&amp; ntohl(rtcpheader[i + 5])) { <span class="comment">/* We must have the LSR &amp;&amp; DLSR */</span>
<a name="l01275"></a>01275             comp = ((msw &amp; 0xffff) &lt;&lt; 16) | ((lsw &amp; 0xffff0000) &gt;&gt; 16);
<a name="l01276"></a>01276             lsr = ntohl(rtcpheader[i + 4]);
<a name="l01277"></a>01277             dlsr = ntohl(rtcpheader[i + 5]);
<a name="l01278"></a>01278             rtt = comp - lsr - dlsr;
<a name="l01279"></a>01279 
<a name="l01280"></a>01280             <span class="comment">/* Convert end to end delay to usec (keeping the calculation in 64bit space)</span>
<a name="l01281"></a>01281 <span class="comment">               sess-&gt;ee_delay = (eedelay * 1000) / 65536; */</span>
<a name="l01282"></a>01282             <span class="keywordflow">if</span> (rtt &lt; 4294) {
<a name="l01283"></a>01283                 rtt = (rtt * 1000000) &gt;&gt; 16;
<a name="l01284"></a>01284             } <span class="keywordflow">else</span> {
<a name="l01285"></a>01285                 rtt = (rtt * 1000) &gt;&gt; 16;
<a name="l01286"></a>01286                 rtt *= 1000;
<a name="l01287"></a>01287             }
<a name="l01288"></a>01288             rtt = rtt / 1000.;
<a name="l01289"></a>01289             rttsec = rtt / 1000.;
<a name="l01290"></a>01290             rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#abc953dca5930a67736d6cd8f72353794">rtt</a> = rttsec;
<a name="l01291"></a>01291 
<a name="l01292"></a>01292             <span class="keywordflow">if</span> (comp - dlsr &gt;= lsr) {
<a name="l01293"></a>01293                rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a8e759d4e39d3d6531987a55158af3c40">accumulated_transit</a> += rttsec;
<a name="l01294"></a>01294 
<a name="l01295"></a>01295                <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#ab11c205b744d7793062ac51aea74b122">rtt_count</a> == 0) 
<a name="l01296"></a>01296                   rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#aa5e4ba49724f6bb86be553f4c823b510">minrtt</a> = rttsec;
<a name="l01297"></a>01297 
<a name="l01298"></a>01298                <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#ad9e0112e5a3834937c4f84604c175ba6">maxrtt</a>&lt;rttsec)
<a name="l01299"></a>01299                   rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#ad9e0112e5a3834937c4f84604c175ba6">maxrtt</a> = rttsec;
<a name="l01300"></a>01300 
<a name="l01301"></a>01301                <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#aa5e4ba49724f6bb86be553f4c823b510">minrtt</a>&gt;rttsec)
<a name="l01302"></a>01302                   rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#aa5e4ba49724f6bb86be553f4c823b510">minrtt</a> = rttsec;
<a name="l01303"></a>01303 
<a name="l01304"></a>01304                normdevrtt_current = <a class="code" href="rtp_8c.html#a86102202cb3c77be2ceec5d9dcf84561" title="Calculate normal deviation.">normdev_compute</a>(rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a41960a911bf90300e198a29deac4a02f">normdevrtt</a>, rttsec, rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#ab11c205b744d7793062ac51aea74b122">rtt_count</a>);
<a name="l01305"></a>01305 
<a name="l01306"></a>01306                rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a484c5279646a0804e4beba6b3f0828c9">stdevrtt</a> = <a class="code" href="rtp_8c.html#a31d5d9d7642101b098206acf2b4bf496">stddev_compute</a>(rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a484c5279646a0804e4beba6b3f0828c9">stdevrtt</a>, rttsec, rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a41960a911bf90300e198a29deac4a02f">normdevrtt</a>, normdevrtt_current, rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#ab11c205b744d7793062ac51aea74b122">rtt_count</a>);
<a name="l01307"></a>01307 
<a name="l01308"></a>01308                rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a41960a911bf90300e198a29deac4a02f">normdevrtt</a> = normdevrtt_current;
<a name="l01309"></a>01309 
<a name="l01310"></a>01310                rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#ab11c205b744d7793062ac51aea74b122">rtt_count</a>++;
<a name="l01311"></a>01311             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="rtp_8c.html#a24040ef125f03db4df56ee0113beee9e">rtcp_debug_test_addr</a>(&amp;sock_in)) {
<a name="l01312"></a>01312                <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;Internal RTCP NTP clock skew detected: &quot;</span>
<a name="l01313"></a>01313                         <span class="stringliteral">&quot;lsr=%u, now=%u, dlsr=%u (%d:%03dms), &quot;</span>
<a name="l01314"></a>01314                         <span class="stringliteral">&quot;diff=%d\n&quot;</span>,
<a name="l01315"></a>01315                         lsr, comp, dlsr, dlsr / 65536,
<a name="l01316"></a>01316                         (dlsr % 65536) * 1000 / 65536,
<a name="l01317"></a>01317                         dlsr - (comp - lsr));
<a name="l01318"></a>01318             }
<a name="l01319"></a>01319          }
<a name="l01320"></a>01320 
<a name="l01321"></a>01321          rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a1b3b9edcf4981174716c8afafd8c10f5">reported_jitter</a> = ntohl(rtcpheader[i + 3]);
<a name="l01322"></a>01322          reported_jitter = (double) rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a1b3b9edcf4981174716c8afafd8c10f5">reported_jitter</a>;
<a name="l01323"></a>01323 
<a name="l01324"></a>01324          if (rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a82658051e9c12f5af4d0969a497d2319">reported_jitter_count</a> == 0) 
<a name="l01325"></a>01325             rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#ace87dcab8278d048a1aec3c529aae3e8">reported_minjitter</a> = reported_jitter;
<a name="l01326"></a>01326 
<a name="l01327"></a>01327          <span class="keywordflow">if</span> (reported_jitter &lt; rtp-&gt;rtcp-&gt;reported_minjitter) 
<a name="l01328"></a>01328             rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#ace87dcab8278d048a1aec3c529aae3e8">reported_minjitter</a> = reported_jitter;
<a name="l01329"></a>01329 
<a name="l01330"></a>01330          <span class="keywordflow">if</span> (reported_jitter &gt; rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a30d52d11d41c2eb613686f33a5decc9c">reported_maxjitter</a>) 
<a name="l01331"></a>01331             rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a30d52d11d41c2eb613686f33a5decc9c">reported_maxjitter</a> = reported_jitter;
<a name="l01332"></a>01332 
<a name="l01333"></a>01333          reported_normdev_jitter_current = <a class="code" href="rtp_8c.html#a86102202cb3c77be2ceec5d9dcf84561" title="Calculate normal deviation.">normdev_compute</a>(rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#ab5b714627a5bc33b066206bb8d01b27f">reported_normdev_jitter</a>, reported_jitter, rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a82658051e9c12f5af4d0969a497d2319">reported_jitter_count</a>);
<a name="l01334"></a>01334 
<a name="l01335"></a>01335          rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a752c1c70fc3a23f882d1c59da8dde021">reported_stdev_jitter</a> = <a class="code" href="rtp_8c.html#a31d5d9d7642101b098206acf2b4bf496">stddev_compute</a>(rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a752c1c70fc3a23f882d1c59da8dde021">reported_stdev_jitter</a>, reported_jitter, rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#ab5b714627a5bc33b066206bb8d01b27f">reported_normdev_jitter</a>, reported_normdev_jitter_current, rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a82658051e9c12f5af4d0969a497d2319">reported_jitter_count</a>);
<a name="l01336"></a>01336 
<a name="l01337"></a>01337          rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#ab5b714627a5bc33b066206bb8d01b27f">reported_normdev_jitter</a> = reported_normdev_jitter_current;
<a name="l01338"></a>01338 
<a name="l01339"></a>01339          rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a735181229b9c3facc1081e30fe7e532e">reported_lost</a> = ntohl(rtcpheader[i + 1]) &amp; 0xffffff;
<a name="l01340"></a>01340 
<a name="l01341"></a>01341          reported_lost = (double) rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a735181229b9c3facc1081e30fe7e532e">reported_lost</a>;
<a name="l01342"></a>01342 
<a name="l01343"></a>01343          <span class="comment">/* using same counter as for jitter */</span>
<a name="l01344"></a>01344          if (rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a82658051e9c12f5af4d0969a497d2319">reported_jitter_count</a> == 0)
<a name="l01345"></a>01345             rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a336c76200bd6e5390ae94cc780e602b6">reported_minlost</a> = reported_lost;
<a name="l01346"></a>01346 
<a name="l01347"></a>01347          <span class="keywordflow">if</span> (reported_lost &lt; rtp-&gt;rtcp-&gt;reported_minlost)
<a name="l01348"></a>01348             rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a336c76200bd6e5390ae94cc780e602b6">reported_minlost</a> = reported_lost;
<a name="l01349"></a>01349 
<a name="l01350"></a>01350          <span class="keywordflow">if</span> (reported_lost &gt; rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#abbf709761c24a05feba0f0dc2ee23b31">reported_maxlost</a>) 
<a name="l01351"></a>01351             rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#abbf709761c24a05feba0f0dc2ee23b31">reported_maxlost</a> = reported_lost;
<a name="l01352"></a>01352 
<a name="l01353"></a>01353          reported_normdev_lost_current = <a class="code" href="rtp_8c.html#a86102202cb3c77be2ceec5d9dcf84561" title="Calculate normal deviation.">normdev_compute</a>(rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a326f467bbb9a1439c7c2295e7965a9b1">reported_normdev_lost</a>, reported_lost, rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a82658051e9c12f5af4d0969a497d2319">reported_jitter_count</a>);
<a name="l01354"></a>01354 
<a name="l01355"></a>01355          rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a90913f9d1e572535345617ac4d9ae2a4">reported_stdev_lost</a> = <a class="code" href="rtp_8c.html#a31d5d9d7642101b098206acf2b4bf496">stddev_compute</a>(rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a90913f9d1e572535345617ac4d9ae2a4">reported_stdev_lost</a>, reported_lost, rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a326f467bbb9a1439c7c2295e7965a9b1">reported_normdev_lost</a>, reported_normdev_lost_current, rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a82658051e9c12f5af4d0969a497d2319">reported_jitter_count</a>);
<a name="l01356"></a>01356 
<a name="l01357"></a>01357          rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a326f467bbb9a1439c7c2295e7965a9b1">reported_normdev_lost</a> = reported_normdev_lost_current;
<a name="l01358"></a>01358 
<a name="l01359"></a>01359          rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a82658051e9c12f5af4d0969a497d2319">reported_jitter_count</a>++;
<a name="l01360"></a>01360 
<a name="l01361"></a>01361          <span class="keywordflow">if</span> (<a class="code" href="rtp_8c.html#a24040ef125f03db4df56ee0113beee9e">rtcp_debug_test_addr</a>(&amp;sock_in)) {
<a name="l01362"></a>01362             <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;  Fraction lost: %ld\n&quot;</span>, (((<span class="keywordtype">long</span>) ntohl(rtcpheader[i + 1]) &amp; 0xff000000) &gt;&gt; 24));
<a name="l01363"></a>01363             <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;  Packets lost so far: %d\n&quot;</span>, rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a735181229b9c3facc1081e30fe7e532e">reported_lost</a>);
<a name="l01364"></a>01364             <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;  Highest sequence number: %ld\n&quot;</span>, (<span class="keywordtype">long</span>) (ntohl(rtcpheader[i + 2]) &amp; 0xffff));
<a name="l01365"></a>01365             <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;  Sequence number cycles: %ld\n&quot;</span>, (<span class="keywordtype">long</span>) (ntohl(rtcpheader[i + 2]) &amp; 0xffff) &gt;&gt; 16);
<a name="l01366"></a>01366             <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;  Interarrival jitter: %u\n&quot;</span>, rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a1b3b9edcf4981174716c8afafd8c10f5">reported_jitter</a>);
<a name="l01367"></a>01367             <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;  Last SR(our NTP): %lu.%010lu\n&quot;</span>,(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) ntohl(rtcpheader[i + 4]) &gt;&gt; 16,((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) ntohl(rtcpheader[i + 4]) &lt;&lt; 16) * 4096);
<a name="l01368"></a>01368             <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;  DLSR: %4.4f (sec)\n&quot;</span>,ntohl(rtcpheader[i + 5])/65536.0);
<a name="l01369"></a>01369             <span class="keywordflow">if</span> (rtt)
<a name="l01370"></a>01370                <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;  RTT: %lu(sec)\n&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) rtt);
<a name="l01371"></a>01371          }
<a name="l01372"></a>01372 
<a name="l01373"></a>01373          <span class="keywordflow">if</span> (rtt) {
<a name="l01374"></a>01374             <a class="code" href="manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208" title="External routines may send asterisk manager events this way.">manager_event</a>(<a class="code" href="manager_8h.html#a0b1b4140c2836696a6950e92ab48a580">EVENT_FLAG_REPORTING</a>, <span class="stringliteral">&quot;RTCPReceived&quot;</span>, <span class="stringliteral">&quot;From: %s:%d\r\n&quot;</span>
<a name="l01375"></a>01375                             <span class="stringliteral">&quot;PT: %d(%s)\r\n&quot;</span>
<a name="l01376"></a>01376                             <span class="stringliteral">&quot;ReceptionReports: %d\r\n&quot;</span>
<a name="l01377"></a>01377                             <span class="stringliteral">&quot;SenderSSRC: %u\r\n&quot;</span>
<a name="l01378"></a>01378                             <span class="stringliteral">&quot;FractionLost: %ld\r\n&quot;</span>
<a name="l01379"></a>01379                             <span class="stringliteral">&quot;PacketsLost: %d\r\n&quot;</span>
<a name="l01380"></a>01380                             <span class="stringliteral">&quot;HighestSequence: %ld\r\n&quot;</span>
<a name="l01381"></a>01381                             <span class="stringliteral">&quot;SequenceNumberCycles: %ld\r\n&quot;</span>
<a name="l01382"></a>01382                             <span class="stringliteral">&quot;IAJitter: %u\r\n&quot;</span>
<a name="l01383"></a>01383                             <span class="stringliteral">&quot;LastSR: %lu.%010lu\r\n&quot;</span>
<a name="l01384"></a>01384                             <span class="stringliteral">&quot;DLSR: %4.4f(sec)\r\n&quot;</span>
<a name="l01385"></a>01385                             <span class="stringliteral">&quot;RTT: %llu(sec)\r\n&quot;</span>,
<a name="l01386"></a>01386                             <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(sock_in.sin_addr), ntohs(sock_in.sin_port),
<a name="l01387"></a>01387                             pt, (pt == 200) ? <span class="stringliteral">&quot;Sender Report&quot;</span> : (pt == 201) ? <span class="stringliteral">&quot;Receiver Report&quot;</span> : (pt == 192) ? <span class="stringliteral">&quot;H.261 FUR&quot;</span> : <span class="stringliteral">&quot;Unknown&quot;</span>,
<a name="l01388"></a>01388                             rc,
<a name="l01389"></a>01389                             rtcpheader[i + 1],
<a name="l01390"></a>01390                             (((<span class="keywordtype">long</span>) ntohl(rtcpheader[i + 1]) &amp; 0xff000000) &gt;&gt; 24),
<a name="l01391"></a>01391                             rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a735181229b9c3facc1081e30fe7e532e">reported_lost</a>,
<a name="l01392"></a>01392                             (<span class="keywordtype">long</span>) (ntohl(rtcpheader[i + 2]) &amp; 0xffff),
<a name="l01393"></a>01393                             (<span class="keywordtype">long</span>) (ntohl(rtcpheader[i + 2]) &amp; 0xffff) &gt;&gt; 16,
<a name="l01394"></a>01394                             rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a1b3b9edcf4981174716c8afafd8c10f5">reported_jitter</a>,
<a name="l01395"></a>01395                             (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) ntohl(rtcpheader[i + 4]) &gt;&gt; 16, ((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) ntohl(rtcpheader[i + 4]) &lt;&lt; 16) * 4096,
<a name="l01396"></a>01396                             ntohl(rtcpheader[i + 5])/65536.0,
<a name="l01397"></a>01397                             (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>)rtt);
<a name="l01398"></a>01398          } <span class="keywordflow">else</span> {
<a name="l01399"></a>01399             <a class="code" href="manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208" title="External routines may send asterisk manager events this way.">manager_event</a>(<a class="code" href="manager_8h.html#a0b1b4140c2836696a6950e92ab48a580">EVENT_FLAG_REPORTING</a>, <span class="stringliteral">&quot;RTCPReceived&quot;</span>, <span class="stringliteral">&quot;From: %s:%d\r\n&quot;</span>
<a name="l01400"></a>01400                             <span class="stringliteral">&quot;PT: %d(%s)\r\n&quot;</span>
<a name="l01401"></a>01401                             <span class="stringliteral">&quot;ReceptionReports: %d\r\n&quot;</span>
<a name="l01402"></a>01402                             <span class="stringliteral">&quot;SenderSSRC: %u\r\n&quot;</span>
<a name="l01403"></a>01403                             <span class="stringliteral">&quot;FractionLost: %ld\r\n&quot;</span>
<a name="l01404"></a>01404                             <span class="stringliteral">&quot;PacketsLost: %d\r\n&quot;</span>
<a name="l01405"></a>01405                             <span class="stringliteral">&quot;HighestSequence: %ld\r\n&quot;</span>
<a name="l01406"></a>01406                             <span class="stringliteral">&quot;SequenceNumberCycles: %ld\r\n&quot;</span>
<a name="l01407"></a>01407                             <span class="stringliteral">&quot;IAJitter: %u\r\n&quot;</span>
<a name="l01408"></a>01408                             <span class="stringliteral">&quot;LastSR: %lu.%010lu\r\n&quot;</span>
<a name="l01409"></a>01409                             <span class="stringliteral">&quot;DLSR: %4.4f(sec)\r\n&quot;</span>,
<a name="l01410"></a>01410                             <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(sock_in.sin_addr), ntohs(sock_in.sin_port),
<a name="l01411"></a>01411                             pt, (pt == 200) ? <span class="stringliteral">&quot;Sender Report&quot;</span> : (pt == 201) ? <span class="stringliteral">&quot;Receiver Report&quot;</span> : (pt == 192) ? <span class="stringliteral">&quot;H.261 FUR&quot;</span> : <span class="stringliteral">&quot;Unknown&quot;</span>,
<a name="l01412"></a>01412                             rc,
<a name="l01413"></a>01413                             rtcpheader[i + 1],
<a name="l01414"></a>01414                             (((<span class="keywordtype">long</span>) ntohl(rtcpheader[i + 1]) &amp; 0xff000000) &gt;&gt; 24),
<a name="l01415"></a>01415                             rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a735181229b9c3facc1081e30fe7e532e">reported_lost</a>,
<a name="l01416"></a>01416                             (<span class="keywordtype">long</span>) (ntohl(rtcpheader[i + 2]) &amp; 0xffff),
<a name="l01417"></a>01417                             (<span class="keywordtype">long</span>) (ntohl(rtcpheader[i + 2]) &amp; 0xffff) &gt;&gt; 16,
<a name="l01418"></a>01418                             rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a1b3b9edcf4981174716c8afafd8c10f5">reported_jitter</a>,
<a name="l01419"></a>01419                             (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) ntohl(rtcpheader[i + 4]) &gt;&gt; 16,
<a name="l01420"></a>01420                             ((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) ntohl(rtcpheader[i + 4]) &lt;&lt; 16) * 4096,
<a name="l01421"></a>01421                             ntohl(rtcpheader[i + 5])/65536.0);
<a name="l01422"></a>01422          }
<a name="l01423"></a>01423          <span class="keywordflow">break</span>;
<a name="l01424"></a>01424       <span class="keywordflow">case</span> <a class="code" href="rtp_8c.html#a38fce7504b6d0ac96b1f07fa86598ce8">RTCP_PT_FUR</a>:
<a name="l01425"></a>01425          <span class="keywordflow">if</span> (<a class="code" href="rtp_8c.html#a24040ef125f03db4df56ee0113beee9e">rtcp_debug_test_addr</a>(&amp;sock_in))
<a name="l01426"></a>01426             <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;Received an RTCP Fast Update Request\n&quot;</span>);
<a name="l01427"></a>01427          rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>;
<a name="l01428"></a>01428          rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a417bc8ac5817cc1525a3b530abfc1528">AST_CONTROL_VIDUPDATE</a>;
<a name="l01429"></a>01429          rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> = 0;
<a name="l01430"></a>01430          rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> = 0;
<a name="l01431"></a>01431          rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#aed16590d48f41d89f31e0cf347f5cd99">mallocd</a> = 0;
<a name="l01432"></a>01432          rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a> = <span class="stringliteral">&quot;RTP&quot;</span>;
<a name="l01433"></a>01433          f = &amp;rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>;
<a name="l01434"></a>01434          <span class="keywordflow">break</span>;
<a name="l01435"></a>01435       <span class="keywordflow">case</span> <a class="code" href="rtp_8c.html#aa6a84235b636497872f31a832a8b17af">RTCP_PT_SDES</a>:
<a name="l01436"></a>01436          <span class="keywordflow">if</span> (<a class="code" href="rtp_8c.html#a24040ef125f03db4df56ee0113beee9e">rtcp_debug_test_addr</a>(&amp;sock_in))
<a name="l01437"></a>01437             <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;Received an SDES from %s:%d\n&quot;</span>, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr), ntohs(rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port));
<a name="l01438"></a>01438          <span class="keywordflow">break</span>;
<a name="l01439"></a>01439       <span class="keywordflow">case</span> <a class="code" href="rtp_8c.html#a5723708baf43b6326706331795fcd52f">RTCP_PT_BYE</a>:
<a name="l01440"></a>01440          <span class="keywordflow">if</span> (<a class="code" href="rtp_8c.html#a24040ef125f03db4df56ee0113beee9e">rtcp_debug_test_addr</a>(&amp;sock_in))
<a name="l01441"></a>01441             <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;Received a BYE from %s:%d\n&quot;</span>, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr), ntohs(rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port));
<a name="l01442"></a>01442          <span class="keywordflow">break</span>;
<a name="l01443"></a>01443       <span class="keywordflow">default</span>:
<a name="l01444"></a>01444          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Unknown RTCP packet (pt=%d) received from %s:%d\n&quot;</span>, pt, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr), ntohs(rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port));
<a name="l01445"></a>01445          <span class="keywordflow">break</span>;
<a name="l01446"></a>01446       }
<a name="l01447"></a>01447       position += (length + 1);
<a name="l01448"></a>01448    }
<a name="l01449"></a>01449    rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#aac35a3d79ed32a54ee5b9e86e386df53">rtcp_info</a> = 1;  
<a name="l01450"></a>01450    <span class="keywordflow">return</span> f;
<a name="l01451"></a>01451 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a90ca590267510860f846c606e9e764a8"></a><!-- doxytag: member="rtp.h::ast_rtcp_send_h261fur" ref="a90ca590267510860f846c606e9e764a8" args="(void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_rtcp_send_h261fur </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Send an H.261 fast update request. Some devices need this rather than the XML <a class="el" href="structmessage.html">message</a> in SIP. </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l03299">3299</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l03557">ast_rtcp_write()</a>, <a class="el" href="rtp_8c_source.html#l00170">ast_rtp::rtcp</a>, and <a class="el" href="rtp_8c_source.html#l00284">ast_rtcp::sendfur</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03300"></a>03300 {
<a name="l03301"></a>03301    <span class="keyword">struct </span><a class="code" href="structast__rtp.html" title="Structure representing a RTP session.">ast_rtp</a> *rtp = <a class="code" href="structast__rtp.html#a735984d41155bc1032e09bece8f8d66d">data</a>;
<a name="l03302"></a>03302    <span class="keywordtype">int</span> res;
<a name="l03303"></a>03303 
<a name="l03304"></a>03304    rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a81f0ffde0bcf0d037264b8f9ed68ab4b">sendfur</a> = 1;
<a name="l03305"></a>03305    res = <a class="code" href="rtp_8c.html#aff89c2855ec73ffa6efdc958bb71c2e8" title="Write and RTCP packet to the far end.">ast_rtcp_write</a>(<a class="code" href="structast__rtp.html#a735984d41155bc1032e09bece8f8d66d">data</a>);
<a name="l03306"></a>03306    
<a name="l03307"></a>03307    <span class="keywordflow">return</span> res;
<a name="l03308"></a>03308 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a697378663e75e6a9591aaf728c0fb968"></a><!-- doxytag: member="rtp.h::ast_rtp_alloc_size" ref="a697378663e75e6a9591aaf728c0fb968" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t ast_rtp_alloc_size </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get the amount of space required to hold an RTP session. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd><a class="el" href="structnumber.html" title="Number structure.">number</a> of bytes required </dd></dl>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l00494">494</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l08040">process_sdp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00495"></a>00495 {
<a name="l00496"></a>00496    <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structast__rtp.html" title="Structure representing a RTP session.">ast_rtp</a>);
<a name="l00497"></a>00497 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af45b92414bcb435f50e82c819e77649c"></a><!-- doxytag: member="rtp.h::ast_rtp_bridge" ref="af45b92414bcb435f50e82c819e77649c" args="(struct ast_channel *c0, struct ast_channel *c1, int flags, struct ast_frame **fo, struct ast_channel **rc, int timeoutms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_rtp_bridge </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> **&nbsp;</td>
          <td class="paramname"> <em>fo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> **&nbsp;</td>
          <td class="paramname"> <em>rc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>timeoutms</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The RTP bridge. </p>
<ul>
<li><a class="el" href="AstRTPbridge.html">The Asterisk RTP bridge</a> </li>
</ul>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l04398">4398</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l01370">AST_BRIDGE_DTMF_CHANNEL_0</a>, <a class="el" href="channel_8h_source.html#l01372">AST_BRIDGE_DTMF_CHANNEL_1</a>, <a class="el" href="channel_8h_source.html#l00165">AST_BRIDGE_FAILED</a>, <a class="el" href="channel_8h_source.html#l00166">AST_BRIDGE_FAILED_NOWARN</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02037">ast_channel_trylock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="channel_8c_source.html#l00461">ast_check_hangup()</a>, <a class="el" href="frame_8c_source.html#l01172">ast_codec_pref_getsize()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="rtp_8h_source.html#l00065">AST_RTP_GET_FAILED</a>, <a class="el" href="rtp_8h_source.html#l00069">AST_RTP_TRY_NATIVE</a>, <a class="el" href="rtp_8h_source.html#l00067">AST_RTP_TRY_PARTIAL</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="rtp_8c_source.html#l03915">bridge_native_loop()</a>, <a class="el" href="rtp_8c_source.html#l04223">bridge_p2p_loop()</a>, <a class="el" href="frame_8h_source.html#l00440">ast_format_list::cur_ms</a>, <a class="el" href="rtp_8c_source.html#l00213">FLAG_HAS_DTMF</a>, <a class="el" href="rtp_8c_source.html#l00215">FLAG_P2P_NEED_DTMF</a>, <a class="el" href="structast__rtp__protocol.html#aef0f5483a05126d99b826a0312ea7992">ast_rtp_protocol::get_codec</a>, <a class="el" href="rtp_8c_source.html#l02057">get_proto()</a>, <a class="el" href="structast__rtp__protocol.html#aad2be0227a36efe9efc1fea51dd407a5">ast_rtp_protocol::get_rtp_info</a>, <a class="el" href="structast__rtp__protocol.html#ae3c52f1d063f37511bf26a747639254a">ast_rtp_protocol::get_trtp_info</a>, <a class="el" href="structast__rtp__protocol.html#aea1ff20567813f95ff79f94c554fff27">ast_rtp_protocol::get_vrtp_info</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="rtp_8c_source.html#l00171">ast_rtp::pref</a>, <a class="el" href="channel_8h_source.html#l00485">ast_channel::rawreadformat</a>, <a class="el" href="channel_8h_source.html#l00486">ast_channel::rawwriteformat</a>, <a class="el" href="structast__channel__tech.html#a83b4c653034ecac13d1abc179d0535d8">ast_channel_tech::send_digit_begin</a>, <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04399"></a>04399 {
<a name="l04400"></a>04400    <span class="keyword">struct </span><a class="code" href="structast__rtp.html" title="Structure representing a RTP session.">ast_rtp</a> *p0 = NULL, *p1 = NULL;    <span class="comment">/* Audio RTP Channels */</span>
<a name="l04401"></a>04401    <span class="keyword">struct </span><a class="code" href="structast__rtp.html" title="Structure representing a RTP session.">ast_rtp</a> *vp0 = NULL, *vp1 = NULL;  <span class="comment">/* Video RTP channels */</span>
<a name="l04402"></a>04402    <span class="keyword">struct </span><a class="code" href="structast__rtp.html" title="Structure representing a RTP session.">ast_rtp</a> *tp0 = NULL, *tp1 = NULL;  <span class="comment">/* Text RTP channels */</span>
<a name="l04403"></a>04403    <span class="keyword">struct </span><a class="code" href="structast__rtp__protocol.html" title="This is the structure that binds a channel (SIP/Jingle/H.323) to the RTP subsystem...">ast_rtp_protocol</a> *pr0 = NULL, *pr1 = NULL;
<a name="l04404"></a>04404    <span class="keyword">enum</span> <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95">ast_rtp_get_result</a> audio_p0_res = <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>, video_p0_res = <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>, text_p0_res = <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>;
<a name="l04405"></a>04405    <span class="keyword">enum</span> <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95">ast_rtp_get_result</a> audio_p1_res = <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>, video_p1_res = <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>, text_p1_res = <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>;
<a name="l04406"></a>04406    <span class="keyword">enum</span> <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05">ast_bridge_result</a> res = <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05afcae35649bbc24a8c2080bec8d592c40">AST_BRIDGE_FAILED</a>;
<a name="l04407"></a>04407    <span class="keywordtype">int</span> codec0 = 0, codec1 = 0;
<a name="l04408"></a>04408    <span class="keywordtype">void</span> *pvt0 = NULL, *pvt1 = NULL;
<a name="l04409"></a>04409 
<a name="l04410"></a>04410    <span class="comment">/* Lock channels */</span>
<a name="l04411"></a>04411    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(c0);
<a name="l04412"></a>04412    <span class="keywordflow">while</span> (<a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(c1)) {
<a name="l04413"></a>04413       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l04414"></a>04414       usleep(1);
<a name="l04415"></a>04415       <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(c0);
<a name="l04416"></a>04416    }
<a name="l04417"></a>04417 
<a name="l04418"></a>04418    <span class="comment">/* Ensure neither channel got hungup during lock avoidance */</span>
<a name="l04419"></a>04419    <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd" title="Check to see if a channel is needing hang up.">ast_check_hangup</a>(c0) || <a class="code" href="channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd" title="Check to see if a channel is needing hang up.">ast_check_hangup</a>(c1)) {
<a name="l04420"></a>04420       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Got hangup while attempting to bridge &apos;%s&apos; and &apos;%s&apos;\n&quot;</span>, c0-&gt;name, c1-&gt;name);
<a name="l04421"></a>04421       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l04422"></a>04422       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l04423"></a>04423       <span class="keywordflow">return</span> <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05afcae35649bbc24a8c2080bec8d592c40">AST_BRIDGE_FAILED</a>;
<a name="l04424"></a>04424    }
<a name="l04425"></a>04425       
<a name="l04426"></a>04426    <span class="comment">/* Find channel driver interfaces */</span>
<a name="l04427"></a>04427    <span class="keywordflow">if</span> (!(pr0 = <a class="code" href="rtp_8c.html#aaff70ed852bc78df19b0615bbb1885cd" title="Get channel driver interface structure.">get_proto</a>(c0))) {
<a name="l04428"></a>04428       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Can&apos;t find native functions for channel &apos;%s&apos;\n&quot;</span>, c0-&gt;name);
<a name="l04429"></a>04429       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l04430"></a>04430       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l04431"></a>04431       <span class="keywordflow">return</span> <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05afcae35649bbc24a8c2080bec8d592c40">AST_BRIDGE_FAILED</a>;
<a name="l04432"></a>04432    }
<a name="l04433"></a>04433    <span class="keywordflow">if</span> (!(pr1 = <a class="code" href="rtp_8c.html#aaff70ed852bc78df19b0615bbb1885cd" title="Get channel driver interface structure.">get_proto</a>(c1))) {
<a name="l04434"></a>04434       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Can&apos;t find native functions for channel &apos;%s&apos;\n&quot;</span>, c1-&gt;name);
<a name="l04435"></a>04435       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l04436"></a>04436       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l04437"></a>04437       <span class="keywordflow">return</span> <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05afcae35649bbc24a8c2080bec8d592c40">AST_BRIDGE_FAILED</a>;
<a name="l04438"></a>04438    }
<a name="l04439"></a>04439 
<a name="l04440"></a>04440    <span class="comment">/* Get channel specific interface structures */</span>
<a name="l04441"></a>04441    pvt0 = c0-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l04442"></a>04442    pvt1 = c1-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l04443"></a>04443 
<a name="l04444"></a>04444    <span class="comment">/* Get audio and video interface (if native bridge is possible) */</span>
<a name="l04445"></a>04445    audio_p0_res = pr0-&gt;<a class="code" href="structast__rtp__protocol.html#aad2be0227a36efe9efc1fea51dd407a5">get_rtp_info</a>(c0, &amp;p0);
<a name="l04446"></a>04446    video_p0_res = pr0-&gt;<a class="code" href="structast__rtp__protocol.html#aea1ff20567813f95ff79f94c554fff27">get_vrtp_info</a> ? pr0-&gt;<a class="code" href="structast__rtp__protocol.html#aea1ff20567813f95ff79f94c554fff27">get_vrtp_info</a>(c0, &amp;vp0) : <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>;
<a name="l04447"></a>04447    text_p0_res = pr0-&gt;<a class="code" href="structast__rtp__protocol.html#ae3c52f1d063f37511bf26a747639254a">get_trtp_info</a> ? pr0-&gt;<a class="code" href="structast__rtp__protocol.html#ae3c52f1d063f37511bf26a747639254a">get_trtp_info</a>(c0, &amp;vp0) : <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>;
<a name="l04448"></a>04448    audio_p1_res = pr1-&gt;get_rtp_info(c1, &amp;p1);
<a name="l04449"></a>04449    video_p1_res = pr1-&gt;get_vrtp_info ? pr1-&gt;get_vrtp_info(c1, &amp;vp1) : <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>;
<a name="l04450"></a>04450    text_p1_res = pr1-&gt;get_trtp_info ? pr1-&gt;get_trtp_info(c1, &amp;vp1) : <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>;
<a name="l04451"></a>04451 
<a name="l04452"></a>04452    <span class="comment">/* If we are carrying video, and both sides are not reinviting... then fail the native bridge */</span>
<a name="l04453"></a>04453    <span class="keywordflow">if</span> (video_p0_res != <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a> &amp;&amp; (audio_p0_res != <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ab591abc73866492b4b33dd96d9925136">AST_RTP_TRY_NATIVE</a> || video_p0_res != <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ab591abc73866492b4b33dd96d9925136">AST_RTP_TRY_NATIVE</a>))
<a name="l04454"></a>04454       audio_p0_res = <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>;
<a name="l04455"></a>04455    <span class="keywordflow">if</span> (video_p1_res != <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a> &amp;&amp; (audio_p1_res != <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ab591abc73866492b4b33dd96d9925136">AST_RTP_TRY_NATIVE</a> || video_p1_res != <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ab591abc73866492b4b33dd96d9925136">AST_RTP_TRY_NATIVE</a>))
<a name="l04456"></a>04456       audio_p1_res = <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>;
<a name="l04457"></a>04457 
<a name="l04458"></a>04458    <span class="comment">/* Check if a bridge is possible (partial/native) */</span>
<a name="l04459"></a>04459    <span class="keywordflow">if</span> (audio_p0_res == <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a> || audio_p1_res == <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>) {
<a name="l04460"></a>04460       <span class="comment">/* Somebody doesn&apos;t want to play... */</span>
<a name="l04461"></a>04461       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l04462"></a>04462       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l04463"></a>04463       <span class="keywordflow">return</span> <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05a4368c9e8d0072a09af3086c79790abfb">AST_BRIDGE_FAILED_NOWARN</a>;
<a name="l04464"></a>04464    }
<a name="l04465"></a>04465 
<a name="l04466"></a>04466    <span class="comment">/* If we need to feed DTMF frames into the core then only do a partial native bridge */</span>
<a name="l04467"></a>04467    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(p0, <a class="code" href="rtp_8c.html#a3da84400ccc8d31229b3c91d505ca7af">FLAG_HAS_DTMF</a>) &amp;&amp; (flags &amp; <a class="code" href="channel_8h.html#a2bd5879255a0f6a758c99b58fcab2f27" title="Report DTMF on channel 0.">AST_BRIDGE_DTMF_CHANNEL_0</a>)) {
<a name="l04468"></a>04468       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(p0, <a class="code" href="rtp_8c.html#a74430081871d2b537f65fbb01e2d7e16">FLAG_P2P_NEED_DTMF</a>);
<a name="l04469"></a>04469       audio_p0_res = <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95a8bc993394ab95ca4c2ac98f9477518fe">AST_RTP_TRY_PARTIAL</a>;
<a name="l04470"></a>04470    }
<a name="l04471"></a>04471 
<a name="l04472"></a>04472    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(p1, <a class="code" href="rtp_8c.html#a3da84400ccc8d31229b3c91d505ca7af">FLAG_HAS_DTMF</a>) &amp;&amp; (flags &amp; <a class="code" href="channel_8h.html#a7dbb6edabad3e02e80d605ca5d254c35" title="Report DTMF on channel 1.">AST_BRIDGE_DTMF_CHANNEL_1</a>)) {
<a name="l04473"></a>04473       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(p1, <a class="code" href="rtp_8c.html#a74430081871d2b537f65fbb01e2d7e16">FLAG_P2P_NEED_DTMF</a>);
<a name="l04474"></a>04474       audio_p1_res = <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95a8bc993394ab95ca4c2ac98f9477518fe">AST_RTP_TRY_PARTIAL</a>;
<a name="l04475"></a>04475    }
<a name="l04476"></a>04476 
<a name="l04477"></a>04477    <span class="comment">/* If both sides are not using the same method of DTMF transmission </span>
<a name="l04478"></a>04478 <span class="comment">    * (ie: one is RFC2833, other is INFO... then we can not do direct media. </span>
<a name="l04479"></a>04479 <span class="comment">    * --------------------------------------------------</span>
<a name="l04480"></a>04480 <span class="comment">    * | DTMF Mode |  HAS_DTMF  |  Accepts Begin Frames |</span>
<a name="l04481"></a>04481 <span class="comment">    * |-----------|------------|-----------------------|</span>
<a name="l04482"></a>04482 <span class="comment">    * | Inband    | False      | True                  |</span>
<a name="l04483"></a>04483 <span class="comment">    * | RFC2833   | True       | True                  |</span>
<a name="l04484"></a>04484 <span class="comment">    * | SIP INFO  | False      | False                 |</span>
<a name="l04485"></a>04485 <span class="comment">    * --------------------------------------------------</span>
<a name="l04486"></a>04486 <span class="comment">    * However, if DTMF from both channels is being monitored by the core, then</span>
<a name="l04487"></a>04487 <span class="comment">    * we can still do packet-to-packet bridging, because passing through the </span>
<a name="l04488"></a>04488 <span class="comment">    * core will handle DTMF mode translation.</span>
<a name="l04489"></a>04489 <span class="comment">    */</span>
<a name="l04490"></a>04490    <span class="keywordflow">if</span> ((<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(p0, <a class="code" href="rtp_8c.html#a3da84400ccc8d31229b3c91d505ca7af">FLAG_HAS_DTMF</a>) != <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(p1, <a class="code" href="rtp_8c.html#a3da84400ccc8d31229b3c91d505ca7af">FLAG_HAS_DTMF</a>)) ||
<a name="l04491"></a>04491       (!c0-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a83b4c653034ecac13d1abc179d0535d8" title="Start sending a literal DTMF digit.">send_digit_begin</a> != !c1-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a83b4c653034ecac13d1abc179d0535d8" title="Start sending a literal DTMF digit.">send_digit_begin</a>)) {
<a name="l04492"></a>04492       <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(p0, <a class="code" href="rtp_8c.html#a74430081871d2b537f65fbb01e2d7e16">FLAG_P2P_NEED_DTMF</a>) || !<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(p1, <a class="code" href="rtp_8c.html#a74430081871d2b537f65fbb01e2d7e16">FLAG_P2P_NEED_DTMF</a>)) {
<a name="l04493"></a>04493          <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l04494"></a>04494          <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l04495"></a>04495          <span class="keywordflow">return</span> <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05a4368c9e8d0072a09af3086c79790abfb">AST_BRIDGE_FAILED_NOWARN</a>;
<a name="l04496"></a>04496       }
<a name="l04497"></a>04497       audio_p0_res = <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95a8bc993394ab95ca4c2ac98f9477518fe">AST_RTP_TRY_PARTIAL</a>;
<a name="l04498"></a>04498       audio_p1_res = <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95a8bc993394ab95ca4c2ac98f9477518fe">AST_RTP_TRY_PARTIAL</a>;
<a name="l04499"></a>04499    }
<a name="l04500"></a>04500 
<a name="l04501"></a>04501    <span class="comment">/* If we need to feed frames into the core don&apos;t do a P2P bridge */</span>
<a name="l04502"></a>04502    <span class="keywordflow">if</span> ((audio_p0_res == <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95a8bc993394ab95ca4c2ac98f9477518fe">AST_RTP_TRY_PARTIAL</a> &amp;&amp; <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(p0, <a class="code" href="rtp_8c.html#a74430081871d2b537f65fbb01e2d7e16">FLAG_P2P_NEED_DTMF</a>)) ||
<a name="l04503"></a>04503        (audio_p1_res == <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95a8bc993394ab95ca4c2ac98f9477518fe">AST_RTP_TRY_PARTIAL</a> &amp;&amp; <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(p1, <a class="code" href="rtp_8c.html#a74430081871d2b537f65fbb01e2d7e16">FLAG_P2P_NEED_DTMF</a>))) {
<a name="l04504"></a>04504       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l04505"></a>04505       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l04506"></a>04506       <span class="keywordflow">return</span> <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05a4368c9e8d0072a09af3086c79790abfb">AST_BRIDGE_FAILED_NOWARN</a>;
<a name="l04507"></a>04507    }
<a name="l04508"></a>04508 
<a name="l04509"></a>04509    <span class="comment">/* Get codecs from both sides */</span>
<a name="l04510"></a>04510    codec0 = pr0-&gt;<a class="code" href="structast__rtp__protocol.html#aef0f5483a05126d99b826a0312ea7992">get_codec</a> ? pr0-&gt;<a class="code" href="structast__rtp__protocol.html#aef0f5483a05126d99b826a0312ea7992">get_codec</a>(c0) : 0;
<a name="l04511"></a>04511    codec1 = pr1-&gt;get_codec ? pr1-&gt;get_codec(c1) : 0;
<a name="l04512"></a>04512    <span class="keywordflow">if</span> (codec0 &amp;&amp; codec1 &amp;&amp; !(codec0 &amp; codec1)) {
<a name="l04513"></a>04513       <span class="comment">/* Hey, we can&apos;t do native bridging if both parties speak different codecs */</span>
<a name="l04514"></a>04514       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(3, <span class="stringliteral">&quot;Channel codec0 = %d is not codec1 = %d, cannot native bridge in RTP.\n&quot;</span>, codec0, codec1);
<a name="l04515"></a>04515       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l04516"></a>04516       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l04517"></a>04517       <span class="keywordflow">return</span> <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05a4368c9e8d0072a09af3086c79790abfb">AST_BRIDGE_FAILED_NOWARN</a>;
<a name="l04518"></a>04518    }
<a name="l04519"></a>04519 
<a name="l04520"></a>04520    <span class="comment">/* If either side can only do a partial bridge, then don&apos;t try for a true native bridge */</span>
<a name="l04521"></a>04521    <span class="keywordflow">if</span> (audio_p0_res == <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95a8bc993394ab95ca4c2ac98f9477518fe">AST_RTP_TRY_PARTIAL</a> || audio_p1_res == <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95a8bc993394ab95ca4c2ac98f9477518fe">AST_RTP_TRY_PARTIAL</a>) {
<a name="l04522"></a>04522       <span class="keyword">struct </span><a class="code" href="structast__format__list.html" title="Definition of supported media formats (codecs).">ast_format_list</a> fmt0, fmt1;
<a name="l04523"></a>04523 
<a name="l04524"></a>04524       <span class="comment">/* In order to do Packet2Packet bridging both sides must be in the same rawread/rawwrite */</span>
<a name="l04525"></a>04525       <span class="keywordflow">if</span> (c0-&gt;<a class="code" href="structast__channel.html#a6fcf944239e3718e282e0ba7512e66c6">rawreadformat</a> != c1-&gt;<a class="code" href="structast__channel.html#a045b6dfdee84adceb7e86b6c5c4f9a86">rawwriteformat</a> || c1-&gt;<a class="code" href="structast__channel.html#a6fcf944239e3718e282e0ba7512e66c6">rawreadformat</a> != c0-&gt;<a class="code" href="structast__channel.html#a045b6dfdee84adceb7e86b6c5c4f9a86">rawwriteformat</a>) {
<a name="l04526"></a>04526          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Cannot packet2packet bridge - raw formats are incompatible\n&quot;</span>);
<a name="l04527"></a>04527          <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l04528"></a>04528          <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l04529"></a>04529          <span class="keywordflow">return</span> <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05a4368c9e8d0072a09af3086c79790abfb">AST_BRIDGE_FAILED_NOWARN</a>;
<a name="l04530"></a>04530       }
<a name="l04531"></a>04531       <span class="comment">/* They must also be using the same packetization */</span>
<a name="l04532"></a>04532       fmt0 = <a class="code" href="frame_8h.html#ac9789499b866949ab31bab025b497964" title="Get packet size for codec.">ast_codec_pref_getsize</a>(&amp;p0-&gt;<a class="code" href="structast__rtp.html#a19c23d44fca820c7b8c868f4c9075b56">pref</a>, c0-&gt;<a class="code" href="structast__channel.html#a6fcf944239e3718e282e0ba7512e66c6">rawreadformat</a>);
<a name="l04533"></a>04533       fmt1 = <a class="code" href="frame_8h.html#ac9789499b866949ab31bab025b497964" title="Get packet size for codec.">ast_codec_pref_getsize</a>(&amp;p1-&gt;pref, c1-&gt;<a class="code" href="structast__channel.html#a6fcf944239e3718e282e0ba7512e66c6">rawreadformat</a>);
<a name="l04534"></a>04534       <span class="keywordflow">if</span> (fmt0.cur_ms != fmt1.cur_ms) {
<a name="l04535"></a>04535          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Cannot packet2packet bridge - packetization settings prevent it\n&quot;</span>);
<a name="l04536"></a>04536          <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l04537"></a>04537          <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l04538"></a>04538          <span class="keywordflow">return</span> <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05a4368c9e8d0072a09af3086c79790abfb">AST_BRIDGE_FAILED_NOWARN</a>;
<a name="l04539"></a>04539       }
<a name="l04540"></a>04540 
<a name="l04541"></a>04541       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Packet2Packet bridging %s and %s\n&quot;</span>, c0-&gt;name, c1-&gt;name);
<a name="l04542"></a>04542       res = <a class="code" href="rtp_8c.html#ab1f0de9367de02dc9983e85eab3f8b88" title="Bridge loop for partial native bridge (packet2packet).">bridge_p2p_loop</a>(c0, c1, p0, p1, timeoutms, <a class="code" href="structast__format__list.html#ac92588540e8c1d014a08cd8a45462b19">flags</a>, fo, rc, pvt0, pvt1);
<a name="l04543"></a>04543    } <span class="keywordflow">else</span> {
<a name="l04544"></a>04544       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Native bridging %s and %s\n&quot;</span>, c0-&gt;name, c1-&gt;name);
<a name="l04545"></a>04545       res = <a class="code" href="rtp_8c.html#a2e5b6817e5bb2de05f716709b7d177c6" title="Bridge loop for true native bridge (reinvite).">bridge_native_loop</a>(c0, c1, p0, p1, vp0, vp1, tp0, tp1, pr0, pr1, codec0, codec1, timeoutms, <a class="code" href="structast__format__list.html#ac92588540e8c1d014a08cd8a45462b19">flags</a>, fo, rc, pvt0, pvt1);
<a name="l04546"></a>04546    }
<a name="l04547"></a>04547 
<a name="l04548"></a>04548    <span class="keywordflow">return</span> res;
<a name="l04549"></a>04549 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6fbba7cab174d951968e91cc94afb200"></a><!-- doxytag: member="rtp.h::ast_rtp_codec_getformat" ref="a6fbba7cab174d951968e91cc94afb200" args="(int pt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_rtp_codec_getformat </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>get format from predefined dynamic payload format </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l03779">3779</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8h_source.html#l00090">rtpPayloadType::code</a>, and <a class="el" href="rtp_8h_source.html#l00052">MAX_RTP_PT</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l08730">process_sdp_a_audio()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03780"></a>03780 {
<a name="l03781"></a>03781    <span class="keywordflow">if</span> (pt &lt; 0 || pt &gt;= <a class="code" href="rtp_8h.html#ac8aa85cd14ebbc20fc0043f6f72b968d">MAX_RTP_PT</a>)
<a name="l03782"></a>03782       <span class="keywordflow">return</span> 0; <span class="comment">/* bogus payload type */</span>
<a name="l03783"></a>03783 
<a name="l03784"></a>03784    <span class="keywordflow">if</span> (<a class="code" href="rtp_8c.html#aee0ddbbc121110ad6d1d3342eddec5f2" title="Mapping between Asterisk codecs and rtp payload types.">static_RTP_PT</a>[pt].isAstFormat)
<a name="l03785"></a>03785       <span class="keywordflow">return</span> <a class="code" href="rtp_8c.html#aee0ddbbc121110ad6d1d3342eddec5f2" title="Mapping between Asterisk codecs and rtp payload types.">static_RTP_PT</a>[pt].<a class="code" href="structrtpPayloadType.html#a45a5b7c00a796a23f01673cef1dbe0a9">code</a>;
<a name="l03786"></a>03786    <span class="keywordflow">else</span>
<a name="l03787"></a>03787       <span class="keywordflow">return</span> 0;
<a name="l03788"></a>03788 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af759eaf34ade34d4f118d45655fcd6bc"></a><!-- doxytag: member="rtp.h::ast_rtp_codec_getpref" ref="af759eaf34ade34d4f118d45655fcd6bc" args="(struct ast_rtp *rtp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__codec__pref.html">ast_codec_pref</a>* ast_rtp_codec_getpref </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get codec preference. </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l03774">3774</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l00171">ast_rtp::pref</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l09822">add_codec_to_sdp()</a>, and <a class="el" href="chan__sip_8c_source.html#l08730">process_sdp_a_audio()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03775"></a>03775 {
<a name="l03776"></a>03776    <span class="keywordflow">return</span> &amp;rtp-&gt;<a class="code" href="structast__rtp.html#a19c23d44fca820c7b8c868f4c9075b56">pref</a>;
<a name="l03777"></a>03777 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae6a1acd75aaf08afc6954bd5ac671c6a"></a><!-- doxytag: member="rtp.h::ast_rtp_codec_setpref" ref="ae6a1acd75aaf08afc6954bd5ac671c6a" args="(struct ast_rtp *rtp, struct ast_codec_pref *prefs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_rtp_codec_setpref </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__codec__pref.html">ast_codec_pref</a> *&nbsp;</td>
          <td class="paramname"> <em>prefs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set codec preference. </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l03728">3728</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="frame_8c_source.html#l01172">ast_codec_pref_getsize()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="frame_8c_source.html#l00176">ast_smoother_new()</a>, <a class="el" href="frame_8c_source.html#l00154">ast_smoother_reconfigure()</a>, <a class="el" href="frame_8c_source.html#l00191">ast_smoother_set_flags()</a>, <a class="el" href="frame_8h_source.html#l00440">ast_format_list::cur_ms</a>, <a class="el" href="frame_8h_source.html#l00439">ast_format_list::flags</a>, <a class="el" href="frame_8h_source.html#l00434">ast_format_list::fr_len</a>, <a class="el" href="frame_8h_source.html#l00437">ast_format_list::inc_ms</a>, <a class="el" href="rtp_8c_source.html#l00126">ast_rtp::lasttxformat</a>, <a class="el" href="logger_8h_source.html#l00119">LOG_DEBUG</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="asterisk_8c_source.html#l00175">option_debug</a>, <a class="el" href="rtp_8c_source.html#l00171">ast_rtp::pref</a>, and <a class="el" href="rtp_8c_source.html#l00155">ast_rtp::smoother</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l00951">__oh323_rtp_create()</a>, <a class="el" href="chan__sip_8c_source.html#l13923">check_peer_ok()</a>, <a class="el" href="chan__sip_8c_source.html#l05102">create_addr_from_peer()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00989">gtalk_new()</a>, <a class="el" href="chan__jingle_8c_source.html#l00800">jingle_new()</a>, <a class="el" href="chan__sip_8c_source.html#l08730">process_sdp_a_audio()</a>, <a class="el" href="chan__sip_8c_source.html#l12942">register_verify()</a>, <a class="el" href="chan__h323_8c_source.html#l02438">set_peer_capabilities()</a>, <a class="el" href="chan__sip_8c_source.html#l07151">sip_alloc()</a>, <a class="el" href="chan__skinny_8c_source.html#l03557">start_rtp()</a>, and <a class="el" href="chan__sip_8c_source.html#l10415">transmit_response_with_sdp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03729"></a>03729 {
<a name="l03730"></a>03730    <span class="keyword">struct </span><a class="code" href="structast__format__list.html" title="Definition of supported media formats (codecs).">ast_format_list</a> current_format_old, current_format_new;
<a name="l03731"></a>03731 
<a name="l03732"></a>03732    <span class="comment">/* if no packets have been sent through this session yet, then</span>
<a name="l03733"></a>03733 <span class="comment">    *  changing preferences does not require any extra work</span>
<a name="l03734"></a>03734 <span class="comment">    */</span>
<a name="l03735"></a>03735    <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#aad2a54a4541520f7f134aa28717fe1e7">lasttxformat</a> == 0) {
<a name="l03736"></a>03736       rtp-&gt;<a class="code" href="structast__rtp.html#a19c23d44fca820c7b8c868f4c9075b56">pref</a> = *prefs;
<a name="l03737"></a>03737       <span class="keywordflow">return</span>;
<a name="l03738"></a>03738    }
<a name="l03739"></a>03739 
<a name="l03740"></a>03740    current_format_old = <a class="code" href="frame_8h.html#ac9789499b866949ab31bab025b497964" title="Get packet size for codec.">ast_codec_pref_getsize</a>(&amp;rtp-&gt;<a class="code" href="structast__rtp.html#a19c23d44fca820c7b8c868f4c9075b56">pref</a>, rtp-&gt;<a class="code" href="structast__rtp.html#aad2a54a4541520f7f134aa28717fe1e7">lasttxformat</a>);
<a name="l03741"></a>03741 
<a name="l03742"></a>03742    rtp-&gt;<a class="code" href="structast__rtp.html#a19c23d44fca820c7b8c868f4c9075b56">pref</a> = *prefs;
<a name="l03743"></a>03743 
<a name="l03744"></a>03744    current_format_new = <a class="code" href="frame_8h.html#ac9789499b866949ab31bab025b497964" title="Get packet size for codec.">ast_codec_pref_getsize</a>(&amp;rtp-&gt;<a class="code" href="structast__rtp.html#a19c23d44fca820c7b8c868f4c9075b56">pref</a>, rtp-&gt;<a class="code" href="structast__rtp.html#aad2a54a4541520f7f134aa28717fe1e7">lasttxformat</a>);
<a name="l03745"></a>03745 
<a name="l03746"></a>03746    <span class="comment">/* if the framing desired for the current format has changed, we may have to create</span>
<a name="l03747"></a>03747 <span class="comment">    * or adjust the smoother for this session</span>
<a name="l03748"></a>03748 <span class="comment">    */</span>
<a name="l03749"></a>03749    <span class="keywordflow">if</span> ((current_format_new.inc_ms != 0) &amp;&amp;
<a name="l03750"></a>03750        (current_format_new.cur_ms != current_format_old.cur_ms)) {
<a name="l03751"></a>03751       <span class="keywordtype">int</span> new_size = (current_format_new.cur_ms * current_format_new.fr_len) / current_format_new.inc_ms;
<a name="l03752"></a>03752 
<a name="l03753"></a>03753       if (rtp-&gt;<a class="code" href="structast__rtp.html#a34ee6625e0f7d45c4e35cd409cb42e21">smoother</a>) {
<a name="l03754"></a>03754          <a class="code" href="frame_8h.html#a34c247d5417aed64069bbeac7fc09728" title="Reconfigure an existing smoother to output a different number of bytes per frame...">ast_smoother_reconfigure</a>(rtp-&gt;<a class="code" href="structast__rtp.html#a34ee6625e0f7d45c4e35cd409cb42e21">smoother</a>, new_size);
<a name="l03755"></a>03755          <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ga40f8fb2e731031d99f732f515cec680f">option_debug</a>) {
<a name="l03756"></a>03756             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Adjusted smoother to %d ms and %d bytes\n&quot;</span>, current_format_new.cur_ms, new_size);
<a name="l03757"></a>03757          }
<a name="l03758"></a>03758       } <span class="keywordflow">else</span> {
<a name="l03759"></a>03759          <span class="keywordflow">if</span> (!(rtp-&gt;<a class="code" href="structast__rtp.html#a34ee6625e0f7d45c4e35cd409cb42e21">smoother</a> = <a class="code" href="frame_8h.html#a6f1c795e5db00c9eb553e540dce7a503">ast_smoother_new</a>(new_size))) {
<a name="l03760"></a>03760             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create smoother: format: %d ms: %d len: %d\n&quot;</span>, rtp-&gt;<a class="code" href="structast__rtp.html#aad2a54a4541520f7f134aa28717fe1e7">lasttxformat</a>, current_format_new.cur_ms, new_size);
<a name="l03761"></a>03761             <span class="keywordflow">return</span>;
<a name="l03762"></a>03762          }
<a name="l03763"></a>03763          <span class="keywordflow">if</span> (current_format_new.flags) {
<a name="l03764"></a>03764             <a class="code" href="frame_8h.html#a2bf0a4739b534e4f317230763ec3afcb">ast_smoother_set_flags</a>(rtp-&gt;<a class="code" href="structast__rtp.html#a34ee6625e0f7d45c4e35cd409cb42e21">smoother</a>, current_format_new.<a class="code" href="structast__smoother.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a>);
<a name="l03765"></a>03765          }
<a name="l03766"></a>03766          <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ga40f8fb2e731031d99f732f515cec680f">option_debug</a>) {
<a name="l03767"></a>03767             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Created smoother: format: %d ms: %d len: %d\n&quot;</span>, rtp-&gt;<a class="code" href="structast__rtp.html#aad2a54a4541520f7f134aa28717fe1e7">lasttxformat</a>, current_format_new.cur_ms, new_size);
<a name="l03768"></a>03768          }
<a name="l03769"></a>03769       }
<a name="l03770"></a>03770    }
<a name="l03771"></a>03771 
<a name="l03772"></a>03772 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6d2addabf879eb321a660932e3bd57eb"></a><!-- doxytag: member="rtp.h::ast_rtp_destroy" ref="a6d2addabf879eb321a660932e3bd57eb" args="(struct ast_rtp *rtp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_rtp_destroy </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Destroy RTP session </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l03058">3058</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="io_8c_source.html#l00236">ast_io_remove()</a>, <a class="el" href="lock_8h_source.html#l01712">ast_mutex_destroy()</a>, <a class="el" href="sched_8h_source.html#l00051">AST_SCHED_DEL</a>, <a class="el" href="frame_8c_source.html#l00286">ast_smoother_free()</a>, <a class="el" href="logger_8h_source.html#l00079">ast_verbose</a>, <a class="el" href="manager_8h_source.html#l00070">EVENT_FLAG_REPORTING</a>, <a class="el" href="rtp_8c_source.html#l00241">ast_rtcp::expected_prior</a>, <a class="el" href="rtp_8c_source.html#l00160">ast_rtp::io</a>, <a class="el" href="rtp_8c_source.html#l00156">ast_rtp::ioid</a>, <a class="el" href="manager_8h_source.html#l00181">manager_event</a>, <a class="el" href="rtp_8c_source.html#l00242">ast_rtcp::received_prior</a>, <a class="el" href="rtp_8c_source.html#l00249">ast_rtcp::reported_jitter</a>, <a class="el" href="rtp_8c_source.html#l00250">ast_rtcp::reported_lost</a>, <a class="el" href="rtp_8c_source.html#l00244">ast_rtcp::rr_count</a>, <a class="el" href="rtp_8c_source.html#l00170">ast_rtp::rtcp</a>, <a class="el" href="rtp_8c_source.html#l00909">rtcp_debug_test_addr()</a>, <a class="el" href="rtp_8c_source.html#l00248">ast_rtcp::rtt</a>, <a class="el" href="rtp_8c_source.html#l00119">ast_rtp::rxcount</a>, <a class="el" href="rtp_8c_source.html#l00124">ast_rtp::rxjitter</a>, <a class="el" href="rtp_8c_source.html#l00125">ast_rtp::rxtransit</a>, <a class="el" href="rtp_8c_source.html#l00232">ast_rtcp::s</a>, <a class="el" href="rtp_8c_source.html#l00103">ast_rtp::s</a>, <a class="el" href="rtp_8c_source.html#l00159">ast_rtp::sched</a>, <a class="el" href="rtp_8c_source.html#l00243">ast_rtcp::schedid</a>, <a class="el" href="rtp_8c_source.html#l00155">ast_rtp::smoother</a>, <a class="el" href="rtp_8c_source.html#l00245">ast_rtcp::sr_count</a>, <a class="el" href="rtp_8c_source.html#l00106">ast_rtp::ssrc</a>, <a class="el" href="rtp_8c_source.html#l00148">ast_rtp::them</a>, <a class="el" href="rtp_8c_source.html#l00107">ast_rtp::themssrc</a>, and <a class="el" href="rtp_8c_source.html#l00121">ast_rtp::txcount</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l00443">__oh323_destroy()</a>, <a class="el" href="chan__sip_8c_source.html#l05498">__sip_destroy()</a>, <a class="el" href="chan__sip_8c_source.html#l13923">check_peer_ok()</a>, <a class="el" href="chan__h323_8c_source.html#l02337">cleanup_connection()</a>, <a class="el" href="chan__sip_8c_source.html#l05102">create_addr_from_peer()</a>, <a class="el" href="chan__mgcp_8c_source.html#l03977">destroy_endpoint()</a>, <a class="el" href="chan__gtalk_8c_source.html#l01126">gtalk_free_pvt()</a>, <a class="el" href="chan__jingle_8c_source.html#l00926">jingle_free_pvt()</a>, <a class="el" href="chan__mgcp_8c_source.html#l00936">mgcp_hangup()</a>, <a class="el" href="chan__h323_8c_source.html#l01101">oh323_alloc()</a>, <a class="el" href="chan__skinny_8c_source.html#l03780">skinny_hangup()</a>, <a class="el" href="chan__mgcp_8c_source.html#l02610">start_rtp()</a>, <a class="el" href="chan__mgcp_8c_source.html#l00487">unalloc_sub()</a>, and <a class="el" href="chan__unistim_8c_source.html#l03709">unistim_hangup()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03059"></a>03059 {
<a name="l03060"></a>03060    <span class="keywordflow">if</span> (<a class="code" href="rtp_8c.html#a24040ef125f03db4df56ee0113beee9e">rtcp_debug_test_addr</a>(&amp;rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>) || <a class="code" href="rtp_8c.html#af31fe34042d18a4597e04781f84f0e3c">rtcpstats</a>) {
<a name="l03061"></a>03061       <span class="comment">/*Print some info on the call here */</span>
<a name="l03062"></a>03062       <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;  RTP-stats\n&quot;</span>);
<a name="l03063"></a>03063       <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;* Our Receiver:\n&quot;</span>);
<a name="l03064"></a>03064       <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;  SSRC:     %u\n&quot;</span>, rtp-&gt;<a class="code" href="structast__rtp.html#afe92c8ff0d37afbf84f8715f4144ca27">themssrc</a>);
<a name="l03065"></a>03065       <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;  Received packets: %u\n&quot;</span>, rtp-&gt;<a class="code" href="structast__rtp.html#a066dafb1cdc02b25e6c2329ef7e7a810">rxcount</a>);
<a name="l03066"></a>03066       <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;  Lost packets:   %u\n&quot;</span>, rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a> ? (rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#af31acee9b731924c67c51fd05723c731">expected_prior</a> - rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a2b107901d7cf12cb119aad6e54b5adb7">received_prior</a>) : 0);
<a name="l03067"></a>03067       <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;  Jitter:      %.4f\n&quot;</span>, rtp-&gt;<a class="code" href="structast__rtp.html#a80552fd3f7f852d51e944dc4105da800">rxjitter</a>);
<a name="l03068"></a>03068       <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;  Transit:     %.4f\n&quot;</span>, rtp-&gt;<a class="code" href="structast__rtp.html#a03de90eeef260174916d063af8db743b">rxtransit</a>);
<a name="l03069"></a>03069       <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;  RR-count:    %u\n&quot;</span>, rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a> ? rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#abfdd17fa9ca6b018fea2fe58c5738712">rr_count</a> : 0);
<a name="l03070"></a>03070       <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;* Our Sender:\n&quot;</span>);
<a name="l03071"></a>03071       <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;  SSRC:     %u\n&quot;</span>, rtp-&gt;<a class="code" href="structast__rtp.html#a9e10385ac55d32d10ef322d1a08a699d">ssrc</a>);
<a name="l03072"></a>03072       <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;  Sent packets:   %u\n&quot;</span>, rtp-&gt;<a class="code" href="structast__rtp.html#a887918839240a36d118b4e1cb46a4de9">txcount</a>);
<a name="l03073"></a>03073       <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;  Lost packets:   %u\n&quot;</span>, rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a> ? rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a735181229b9c3facc1081e30fe7e532e">reported_lost</a> : 0);
<a name="l03074"></a>03074       <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;  Jitter:      %u\n&quot;</span>, rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a> ? (rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a1b3b9edcf4981174716c8afafd8c10f5">reported_jitter</a> / (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)65536.0) : 0);
<a name="l03075"></a>03075       <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;  SR-count:    %u\n&quot;</span>, rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a> ? rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a2fd3216670496c31020fd37341c0b8fd">sr_count</a> : 0);
<a name="l03076"></a>03076       <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;  RTT:      %f\n&quot;</span>, rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a> ? rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#abc953dca5930a67736d6cd8f72353794">rtt</a> : 0);
<a name="l03077"></a>03077    }
<a name="l03078"></a>03078 
<a name="l03079"></a>03079    <a class="code" href="manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208" title="External routines may send asterisk manager events this way.">manager_event</a>(<a class="code" href="manager_8h.html#a0b1b4140c2836696a6950e92ab48a580">EVENT_FLAG_REPORTING</a>, <span class="stringliteral">&quot;RTPReceiverStat&quot;</span>, <span class="stringliteral">&quot;SSRC: %u\r\n&quot;</span>
<a name="l03080"></a>03080                    <span class="stringliteral">&quot;ReceivedPackets: %u\r\n&quot;</span>
<a name="l03081"></a>03081                    <span class="stringliteral">&quot;LostPackets: %u\r\n&quot;</span>
<a name="l03082"></a>03082                    <span class="stringliteral">&quot;Jitter: %.4f\r\n&quot;</span>
<a name="l03083"></a>03083                    <span class="stringliteral">&quot;Transit: %.4f\r\n&quot;</span>
<a name="l03084"></a>03084                    <span class="stringliteral">&quot;RRCount: %u\r\n&quot;</span>,
<a name="l03085"></a>03085                    rtp-&gt;<a class="code" href="structast__rtp.html#afe92c8ff0d37afbf84f8715f4144ca27">themssrc</a>,
<a name="l03086"></a>03086                    rtp-&gt;<a class="code" href="structast__rtp.html#a066dafb1cdc02b25e6c2329ef7e7a810">rxcount</a>,
<a name="l03087"></a>03087                    rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a> ? (rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#af31acee9b731924c67c51fd05723c731">expected_prior</a> - rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a2b107901d7cf12cb119aad6e54b5adb7">received_prior</a>) : 0,
<a name="l03088"></a>03088                    rtp-&gt;<a class="code" href="structast__rtp.html#a80552fd3f7f852d51e944dc4105da800">rxjitter</a>,
<a name="l03089"></a>03089                    rtp-&gt;<a class="code" href="structast__rtp.html#a03de90eeef260174916d063af8db743b">rxtransit</a>,
<a name="l03090"></a>03090                    rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a> ? rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#abfdd17fa9ca6b018fea2fe58c5738712">rr_count</a> : 0);
<a name="l03091"></a>03091    <a class="code" href="manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208" title="External routines may send asterisk manager events this way.">manager_event</a>(<a class="code" href="manager_8h.html#a0b1b4140c2836696a6950e92ab48a580">EVENT_FLAG_REPORTING</a>, <span class="stringliteral">&quot;RTPSenderStat&quot;</span>, <span class="stringliteral">&quot;SSRC: %u\r\n&quot;</span>
<a name="l03092"></a>03092                    <span class="stringliteral">&quot;SentPackets: %u\r\n&quot;</span>
<a name="l03093"></a>03093                    <span class="stringliteral">&quot;LostPackets: %u\r\n&quot;</span>
<a name="l03094"></a>03094                    <span class="stringliteral">&quot;Jitter: %u\r\n&quot;</span>
<a name="l03095"></a>03095                    <span class="stringliteral">&quot;SRCount: %u\r\n&quot;</span>
<a name="l03096"></a>03096                    <span class="stringliteral">&quot;RTT: %f\r\n&quot;</span>,
<a name="l03097"></a>03097                    rtp-&gt;<a class="code" href="structast__rtp.html#a9e10385ac55d32d10ef322d1a08a699d">ssrc</a>,
<a name="l03098"></a>03098                    rtp-&gt;<a class="code" href="structast__rtp.html#a887918839240a36d118b4e1cb46a4de9">txcount</a>,
<a name="l03099"></a>03099                    rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a> ? rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a735181229b9c3facc1081e30fe7e532e">reported_lost</a> : 0,
<a name="l03100"></a>03100                    rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a> ? rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a1b3b9edcf4981174716c8afafd8c10f5">reported_jitter</a> : 0,
<a name="l03101"></a>03101                    rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a> ? rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a2fd3216670496c31020fd37341c0b8fd">sr_count</a> : 0,
<a name="l03102"></a>03102                    rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a> ? rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#abc953dca5930a67736d6cd8f72353794">rtt</a> : 0);
<a name="l03103"></a>03103    <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a34ee6625e0f7d45c4e35cd409cb42e21">smoother</a>)
<a name="l03104"></a>03104       <a class="code" href="frame_8h.html#a6d3b71e0a81af743bae6c33c02b64f1f">ast_smoother_free</a>(rtp-&gt;<a class="code" href="structast__rtp.html#a34ee6625e0f7d45c4e35cd409cb42e21">smoother</a>);
<a name="l03105"></a>03105    <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a378e4ecae74acafadf99a691f65f2419">ioid</a>)
<a name="l03106"></a>03106       <a class="code" href="io_8h.html#afbf1092b96128d07d0dd08dfa898f4d5" title="Removes an IO context.">ast_io_remove</a>(rtp-&gt;<a class="code" href="structast__rtp.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a>, rtp-&gt;<a class="code" href="structast__rtp.html#a378e4ecae74acafadf99a691f65f2419">ioid</a>);
<a name="l03107"></a>03107    <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a339d22b3e442946380f98ed19e320db2">s</a> &gt; -1)
<a name="l03108"></a>03108       close(rtp-&gt;<a class="code" href="structast__rtp.html#a339d22b3e442946380f98ed19e320db2">s</a>);
<a name="l03109"></a>03109    <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>) {
<a name="l03110"></a>03110       <a class="code" href="sched_8h.html#a25647782014f8dc012994efcd1b81d32" title="a loop construct to ensure that the scheduled task get deleted. The idea is that...">AST_SCHED_DEL</a>(rtp-&gt;<a class="code" href="structast__rtp.html#aea6233539fc73fc5303bf7525ec27e73">sched</a>, rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a1083e2d34bb1a32645f4681a7ee78b41">schedid</a>);
<a name="l03111"></a>03111       close(rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a339d22b3e442946380f98ed19e320db2">s</a>);
<a name="l03112"></a>03112       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>);
<a name="l03113"></a>03113       rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>=NULL;
<a name="l03114"></a>03114    }
<a name="l03115"></a>03115 <span class="preprocessor">#ifdef P2P_INTENSE</span>
<a name="l03116"></a>03116 <span class="preprocessor"></span>   <a class="code" href="lock_8h.html#ab237e70b569019bfb490ab0c3c09b8c5">ast_mutex_destroy</a>(&amp;rtp-&gt;bridge_lock);
<a name="l03117"></a>03117 <span class="preprocessor">#endif</span>
<a name="l03118"></a>03118 <span class="preprocessor"></span>   <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(rtp);
<a name="l03119"></a>03119 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aba89225382987d42ec798462d15930e6"></a><!-- doxytag: member="rtp.h::ast_rtp_early_bridge" ref="aba89225382987d42ec798462d15930e6" args="(struct ast_channel *c0, struct ast_channel *c1)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_rtp_early_bridge </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c1</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>If possible, create an early bridge directly between the devices without having to send a re-invite later. </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l02071">2071</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02037">ast_channel_trylock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="rtp_8h_source.html#l00065">AST_RTP_GET_FAILED</a>, <a class="el" href="rtp_8h_source.html#l00069">AST_RTP_TRY_NATIVE</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="rtp_8c_source.html#l00210">FLAG_NAT_ACTIVE</a>, <a class="el" href="structast__rtp__protocol.html#aef0f5483a05126d99b826a0312ea7992">ast_rtp_protocol::get_codec</a>, <a class="el" href="rtp_8c_source.html#l02057">get_proto()</a>, <a class="el" href="structast__rtp__protocol.html#aad2be0227a36efe9efc1fea51dd407a5">ast_rtp_protocol::get_rtp_info</a>, <a class="el" href="structast__rtp__protocol.html#ae3c52f1d063f37511bf26a747639254a">ast_rtp_protocol::get_trtp_info</a>, <a class="el" href="structast__rtp__protocol.html#aea1ff20567813f95ff79f94c554fff27">ast_rtp_protocol::get_vrtp_info</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="structast__rtp__protocol.html#a321bf6332b1fa0f6c9d85abc03c1f3df">ast_rtp_protocol::set_rtp_peer</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02072"></a>02072 {
<a name="l02073"></a>02073    <span class="keyword">struct </span><a class="code" href="structast__rtp.html" title="Structure representing a RTP session.">ast_rtp</a> *destp = NULL, *srcp = NULL;     <span class="comment">/* Audio RTP Channels */</span>
<a name="l02074"></a>02074    <span class="keyword">struct </span><a class="code" href="structast__rtp.html" title="Structure representing a RTP session.">ast_rtp</a> *vdestp = NULL, *vsrcp = NULL;      <span class="comment">/* Video RTP channels */</span>
<a name="l02075"></a>02075    <span class="keyword">struct </span><a class="code" href="structast__rtp.html" title="Structure representing a RTP session.">ast_rtp</a> *tdestp = NULL, *tsrcp = NULL;      <span class="comment">/* Text RTP channels */</span>
<a name="l02076"></a>02076    <span class="keyword">struct </span><a class="code" href="structast__rtp__protocol.html" title="This is the structure that binds a channel (SIP/Jingle/H.323) to the RTP subsystem...">ast_rtp_protocol</a> *destpr = NULL, *srcpr = NULL;
<a name="l02077"></a>02077    <span class="keyword">enum</span> <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95">ast_rtp_get_result</a> audio_dest_res = <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>, video_dest_res = <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>, text_dest_res = <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>;
<a name="l02078"></a>02078    <span class="keyword">enum</span> <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95">ast_rtp_get_result</a> audio_src_res = <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>, video_src_res = <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>, text_src_res = <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>;
<a name="l02079"></a>02079    <span class="keywordtype">int</span> srccodec, destcodec, nat_active = 0;
<a name="l02080"></a>02080 
<a name="l02081"></a>02081    <span class="comment">/* Lock channels */</span>
<a name="l02082"></a>02082    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(c0);
<a name="l02083"></a>02083    <span class="keywordflow">if</span> (c1) {
<a name="l02084"></a>02084       <span class="keywordflow">while</span> (<a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(c1)) {
<a name="l02085"></a>02085          <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l02086"></a>02086          usleep(1);
<a name="l02087"></a>02087          <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(c0);
<a name="l02088"></a>02088       }
<a name="l02089"></a>02089    }
<a name="l02090"></a>02090 
<a name="l02091"></a>02091    <span class="comment">/* Find channel driver interfaces */</span>
<a name="l02092"></a>02092    destpr = <a class="code" href="rtp_8c.html#aaff70ed852bc78df19b0615bbb1885cd" title="Get channel driver interface structure.">get_proto</a>(c0);
<a name="l02093"></a>02093    <span class="keywordflow">if</span> (c1)
<a name="l02094"></a>02094       srcpr = <a class="code" href="rtp_8c.html#aaff70ed852bc78df19b0615bbb1885cd" title="Get channel driver interface structure.">get_proto</a>(c1);
<a name="l02095"></a>02095    <span class="keywordflow">if</span> (!destpr) {
<a name="l02096"></a>02096       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Channel &apos;%s&apos; has no RTP, not doing anything\n&quot;</span>, c0-&gt;name);
<a name="l02097"></a>02097       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l02098"></a>02098       <span class="keywordflow">if</span> (c1)
<a name="l02099"></a>02099          <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l02100"></a>02100       <span class="keywordflow">return</span> -1;
<a name="l02101"></a>02101    }
<a name="l02102"></a>02102    <span class="keywordflow">if</span> (!srcpr) {
<a name="l02103"></a>02103       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Channel &apos;%s&apos; has no RTP, not doing anything\n&quot;</span>, c1 ? c1-&gt;name : <span class="stringliteral">&quot;&lt;unspecified&gt;&quot;</span>);
<a name="l02104"></a>02104       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l02105"></a>02105       <span class="keywordflow">if</span> (c1)
<a name="l02106"></a>02106          <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l02107"></a>02107       <span class="keywordflow">return</span> -1;
<a name="l02108"></a>02108    }
<a name="l02109"></a>02109 
<a name="l02110"></a>02110    <span class="comment">/* Get audio, video  and text interface (if native bridge is possible) */</span>
<a name="l02111"></a>02111    audio_dest_res = destpr-&gt;<a class="code" href="structast__rtp__protocol.html#aad2be0227a36efe9efc1fea51dd407a5">get_rtp_info</a>(c0, &amp;destp);
<a name="l02112"></a>02112    video_dest_res = destpr-&gt;<a class="code" href="structast__rtp__protocol.html#aea1ff20567813f95ff79f94c554fff27">get_vrtp_info</a> ? destpr-&gt;<a class="code" href="structast__rtp__protocol.html#aea1ff20567813f95ff79f94c554fff27">get_vrtp_info</a>(c0, &amp;vdestp) : <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>;
<a name="l02113"></a>02113    text_dest_res = destpr-&gt;<a class="code" href="structast__rtp__protocol.html#ae3c52f1d063f37511bf26a747639254a">get_trtp_info</a> ? destpr-&gt;<a class="code" href="structast__rtp__protocol.html#ae3c52f1d063f37511bf26a747639254a">get_trtp_info</a>(c0, &amp;tdestp) : <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>;
<a name="l02114"></a>02114    <span class="keywordflow">if</span> (srcpr) {
<a name="l02115"></a>02115       audio_src_res = srcpr-&gt;get_rtp_info(c1, &amp;srcp);
<a name="l02116"></a>02116       video_src_res = srcpr-&gt;get_vrtp_info ? srcpr-&gt;get_vrtp_info(c1, &amp;vsrcp) : <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>;
<a name="l02117"></a>02117       text_src_res = srcpr-&gt;get_trtp_info ? srcpr-&gt;get_trtp_info(c1, &amp;tsrcp) : <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>;
<a name="l02118"></a>02118    }
<a name="l02119"></a>02119 
<a name="l02120"></a>02120    <span class="comment">/* Check if bridge is still possible (In SIP directmedia=no stops this, like NAT) */</span>
<a name="l02121"></a>02121    <span class="keywordflow">if</span> (audio_dest_res != <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ab591abc73866492b4b33dd96d9925136">AST_RTP_TRY_NATIVE</a> || (video_dest_res != <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a> &amp;&amp; video_dest_res != <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ab591abc73866492b4b33dd96d9925136">AST_RTP_TRY_NATIVE</a>)) {
<a name="l02122"></a>02122       <span class="comment">/* Somebody doesn&apos;t want to play... */</span>
<a name="l02123"></a>02123       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l02124"></a>02124       <span class="keywordflow">if</span> (c1)
<a name="l02125"></a>02125          <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l02126"></a>02126       <span class="keywordflow">return</span> -1;
<a name="l02127"></a>02127    }
<a name="l02128"></a>02128    <span class="keywordflow">if</span> (audio_src_res == <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ab591abc73866492b4b33dd96d9925136">AST_RTP_TRY_NATIVE</a> &amp;&amp; (video_src_res == <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a> || video_src_res == <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ab591abc73866492b4b33dd96d9925136">AST_RTP_TRY_NATIVE</a>) &amp;&amp; srcpr-&gt;get_codec)
<a name="l02129"></a>02129       srccodec = srcpr-&gt;get_codec(c1);
<a name="l02130"></a>02130    <span class="keywordflow">else</span>
<a name="l02131"></a>02131       srccodec = 0;
<a name="l02132"></a>02132    <span class="keywordflow">if</span> (audio_dest_res == <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ab591abc73866492b4b33dd96d9925136">AST_RTP_TRY_NATIVE</a> &amp;&amp; (video_dest_res == <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a> || video_dest_res == <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ab591abc73866492b4b33dd96d9925136">AST_RTP_TRY_NATIVE</a>) &amp;&amp; destpr-&gt;<a class="code" href="structast__rtp__protocol.html#aef0f5483a05126d99b826a0312ea7992">get_codec</a>)
<a name="l02133"></a>02133       destcodec = destpr-&gt;<a class="code" href="structast__rtp__protocol.html#aef0f5483a05126d99b826a0312ea7992">get_codec</a>(c0);
<a name="l02134"></a>02134    <span class="keywordflow">else</span>
<a name="l02135"></a>02135       destcodec = 0;
<a name="l02136"></a>02136    <span class="comment">/* Ensure we have at least one matching codec */</span>
<a name="l02137"></a>02137    <span class="keywordflow">if</span> (srcp &amp;&amp; !(srccodec &amp; destcodec)) {
<a name="l02138"></a>02138       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l02139"></a>02139       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l02140"></a>02140       <span class="keywordflow">return</span> 0;
<a name="l02141"></a>02141    }
<a name="l02142"></a>02142    <span class="comment">/* Consider empty media as non-existent */</span>
<a name="l02143"></a>02143    <span class="keywordflow">if</span> (audio_src_res == <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ab591abc73866492b4b33dd96d9925136">AST_RTP_TRY_NATIVE</a> &amp;&amp; !srcp-&gt;them.sin_addr.s_addr)
<a name="l02144"></a>02144       srcp = NULL;
<a name="l02145"></a>02145    <span class="keywordflow">if</span> (srcp &amp;&amp; (srcp-&gt;nat || <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(srcp, <a class="code" href="rtp_8c.html#ab67e21f67a96dd6a9e1b0450ecddecf3">FLAG_NAT_ACTIVE</a>)))
<a name="l02146"></a>02146       nat_active = 1;
<a name="l02147"></a>02147    <span class="comment">/* Bridge media early */</span>
<a name="l02148"></a>02148    <span class="keywordflow">if</span> (destpr-&gt;<a class="code" href="structast__rtp__protocol.html#a321bf6332b1fa0f6c9d85abc03c1f3df">set_rtp_peer</a>(c0, srcp, vsrcp, tsrcp, srccodec, nat_active))
<a name="l02149"></a>02149       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Channel &apos;%s&apos; failed to setup early bridge to &apos;%s&apos;\n&quot;</span>, c0-&gt;name, c1 ? c1-&gt;name : <span class="stringliteral">&quot;&lt;unspecified&gt;&quot;</span>);
<a name="l02150"></a>02150    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l02151"></a>02151    <span class="keywordflow">if</span> (c1)
<a name="l02152"></a>02152       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l02153"></a>02153    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Setting early bridge SDP of &apos;%s&apos; with that of &apos;%s&apos;\n&quot;</span>, c0-&gt;name, c1 ? c1-&gt;name : <span class="stringliteral">&quot;&lt;unspecified&gt;&quot;</span>);
<a name="l02154"></a>02154    <span class="keywordflow">return</span> 0;
<a name="l02155"></a>02155 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9a990d85fb0aac29bda48777f0f86108"></a><!-- doxytag: member="rtp.h::ast_rtp_fd" ref="a9a990d85fb0aac29bda48777f0f86108" args="(struct ast_rtp *rtp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_rtp_fd </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rtp_8c_source.html#l00718">718</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l00103">ast_rtp::s</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l00999">__oh323_new()</a>, <a class="el" href="chan__h323_8c_source.html#l00951">__oh323_rtp_create()</a>, <a class="el" href="chan__h323_8c_source.html#l00332">__oh323_update_info()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00989">gtalk_new()</a>, <a class="el" href="chan__jingle_8c_source.html#l00800">jingle_new()</a>, <a class="el" href="chan__mgcp_8c_source.html#l01470">mgcp_new()</a>, <a class="el" href="rtp_8c_source.html#l04191">p2p_callback_disable()</a>, <a class="el" href="chan__sip_8c_source.html#l06599">sip_new()</a>, <a class="el" href="chan__skinny_8c_source.html#l04268">skinny_new()</a>, <a class="el" href="chan__mgcp_8c_source.html#l02610">start_rtp()</a>, and <a class="el" href="chan__unistim_8c_source.html#l04422">unistim_new()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00719"></a>00719 {
<a name="l00720"></a>00720    <span class="keywordflow">return</span> rtp-&gt;<a class="code" href="structast__rtp.html#a339d22b3e442946380f98ed19e320db2">s</a>;
<a name="l00721"></a>00721 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af7dc32ebdfacbbf446321de6fcfe2d9a"></a><!-- doxytag: member="rtp.h::ast_rtp_get_bridged" ref="af7dc32ebdfacbbf446321de6fcfe2d9a" args="(struct ast_rtp *rtp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__rtp.html">ast_rtp</a>* ast_rtp_get_bridged </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rtp_8c_source.html#l02699">2699</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l00172">ast_rtp::bridged</a>, <a class="el" href="rtp_8c_source.html#l00826">rtp_bridge_lock()</a>, and <a class="el" href="rtp_8c_source.html#l00834">rtp_bridge_unlock()</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l05498">__sip_destroy()</a>, <a class="el" href="rtp_8c_source.html#l01562">ast_rtp_read()</a>, and <a class="el" href="chan__sip_8c_source.html#l14968">dialog_needdestroy()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02700"></a>02700 {
<a name="l02701"></a>02701    <span class="keyword">struct </span><a class="code" href="structast__rtp.html" title="Structure representing a RTP session.">ast_rtp</a> *<a class="code" href="structast__rtp.html#a22611fd046dd9e42a34b4a6e3ace0069">bridged</a> = NULL;
<a name="l02702"></a>02702 
<a name="l02703"></a>02703    <a class="code" href="rtp_8c.html#a67f38276600b7655f400f5b6c6118f8b">rtp_bridge_lock</a>(rtp);
<a name="l02704"></a>02704    bridged = rtp-&gt;<a class="code" href="structast__rtp.html#a22611fd046dd9e42a34b4a6e3ace0069">bridged</a>;
<a name="l02705"></a>02705    <a class="code" href="rtp_8c.html#afabb78b03298d9f7b7e26b60ad0d02e4">rtp_bridge_unlock</a>(rtp);
<a name="l02706"></a>02706 
<a name="l02707"></a>02707    <span class="keywordflow">return</span> bridged;
<a name="l02708"></a>02708 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0af7232148535d9bc024fc01579d4ec8"></a><!-- doxytag: member="rtp.h::ast_rtp_get_current_formats" ref="a0af7232148535d9bc024fc01579d4ec8" args="(struct ast_rtp *rtp, int *astFormats, int *nonAstFormats)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_rtp_get_current_formats </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>astFormats</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>nonAstFormats</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return the union of all of the codecs that were set by rtp_set...() calls They're returned as two distinct sets: AST_FORMATs, and AST_RTPs. </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l02319">2319</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8h_source.html#l00090">rtpPayloadType::code</a>, <a class="el" href="rtp_8c_source.html#l00166">ast_rtp::current_RTP_PT</a>, <a class="el" href="rtp_8h_source.html#l00089">rtpPayloadType::isAstFormat</a>, <a class="el" href="rtp_8h_source.html#l00052">MAX_RTP_PT</a>, <a class="el" href="rtp_8c_source.html#l00826">rtp_bridge_lock()</a>, and <a class="el" href="rtp_8c_source.html#l00834">rtp_bridge_unlock()</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l00603">gtalk_is_answered()</a>, <a class="el" href="chan__gtalk_8c_source.html#l01154">gtalk_newcall()</a>, and <a class="el" href="chan__mgcp_8c_source.html#l01838">process_sdp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02321"></a>02321 {
<a name="l02322"></a>02322    <span class="keywordtype">int</span> pt;
<a name="l02323"></a>02323    
<a name="l02324"></a>02324    <a class="code" href="rtp_8c.html#a67f38276600b7655f400f5b6c6118f8b">rtp_bridge_lock</a>(rtp);
<a name="l02325"></a>02325    
<a name="l02326"></a>02326    *astFormats = *nonAstFormats = 0;
<a name="l02327"></a>02327    <span class="keywordflow">for</span> (pt = 0; pt &lt; <a class="code" href="rtp_8h.html#ac8aa85cd14ebbc20fc0043f6f72b968d">MAX_RTP_PT</a>; ++pt) {
<a name="l02328"></a>02328       <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a326c376c0e9d4d7572cc3706205dbd01">current_RTP_PT</a>[pt].<a class="code" href="structrtpPayloadType.html#a6916911180850cb1b6045fa9b6927b02">isAstFormat</a>) {
<a name="l02329"></a>02329          *astFormats |= rtp-&gt;<a class="code" href="structast__rtp.html#a326c376c0e9d4d7572cc3706205dbd01">current_RTP_PT</a>[pt].<a class="code" href="structrtpPayloadType.html#a45a5b7c00a796a23f01673cef1dbe0a9">code</a>;
<a name="l02330"></a>02330       } <span class="keywordflow">else</span> {
<a name="l02331"></a>02331          *nonAstFormats |= rtp-&gt;<a class="code" href="structast__rtp.html#a326c376c0e9d4d7572cc3706205dbd01">current_RTP_PT</a>[pt].<a class="code" href="structrtpPayloadType.html#a45a5b7c00a796a23f01673cef1dbe0a9">code</a>;
<a name="l02332"></a>02332       }
<a name="l02333"></a>02333    }
<a name="l02334"></a>02334 
<a name="l02335"></a>02335    <a class="code" href="rtp_8c.html#afabb78b03298d9f7b7e26b60ad0d02e4">rtp_bridge_unlock</a>(rtp);
<a name="l02336"></a>02336 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa1ffde0e800995c386729bc5eaf82e7c"></a><!-- doxytag: member="rtp.h::ast_rtp_get_peer" ref="aa1ffde0e800995c386729bc5eaf82e7c" args="(struct ast_rtp *rtp, struct sockaddr_in *them)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_rtp_get_peer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>them</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rtp_8c_source.html#l02681">2681</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l00148">ast_rtp::them</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l20916">acf_channel_read()</a>, <a class="el" href="chan__mgcp_8c_source.html#l02047">add_sdp()</a>, <a class="el" href="rtp_8c_source.html#l03915">bridge_native_loop()</a>, <a class="el" href="chan__sip_8c_source.html#l22343">check_rtp_timeout()</a>, <a class="el" href="chan__gtalk_8c_source.html#l01256">gtalk_update_stun()</a>, <a class="el" href="chan__h323_8c_source.html#l03189">oh323_set_rtp_peer()</a>, <a class="el" href="chan__sip_8c_source.html#l08040">process_sdp()</a>, <a class="el" href="chan__sip_8c_source.html#l25305">sip_set_rtp_peer()</a>, <a class="el" href="chan__skinny_8c_source.html#l02609">skinny_set_rtp_peer()</a>, and <a class="el" href="chan__mgcp_8c_source.html#l02140">transmit_modify_with_sdp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02682"></a>02682 {
<a name="l02683"></a>02683    <span class="keywordflow">if</span> ((<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>-&gt;sin_family != AF_INET) ||
<a name="l02684"></a>02684       (<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>-&gt;sin_port != rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port) ||
<a name="l02685"></a>02685       (<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>-&gt;sin_addr.s_addr != rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr.s_addr)) {
<a name="l02686"></a>02686       <a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>-&gt;sin_family = AF_INET;
<a name="l02687"></a>02687       <a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>-&gt;sin_port = rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port;
<a name="l02688"></a>02688       <a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>-&gt;sin_addr = rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr;
<a name="l02689"></a>02689       <span class="keywordflow">return</span> 1;
<a name="l02690"></a>02690    }
<a name="l02691"></a>02691    <span class="keywordflow">return</span> 0;
<a name="l02692"></a>02692 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae8c09b6f55ec0b7444a9b48038157d22"></a><!-- doxytag: member="rtp.h::ast_rtp_get_qos" ref="ae8c09b6f55ec0b7444a9b48038157d22" args="(struct ast_rtp *rtp, const char *qos, char *buf, unsigned int buflen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_rtp_get_qos </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>qos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>buflen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get QOS stats on a RTP channel. </p>
<dl class="since"><dt><b>Since:</b></dt><dd>1.6.1 </dd></dl>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l02820">2820</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l02784">__ast_rtp_get_qos()</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l20916">acf_channel_read()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02821"></a>02821 {
<a name="l02822"></a>02822    <span class="keywordtype">double</span> value;
<a name="l02823"></a>02823    <span class="keywordtype">int</span> found;
<a name="l02824"></a>02824 
<a name="l02825"></a>02825    value = <a class="code" href="rtp_8c.html#ab81dca76e0e5b8261c7294e680509c94">__ast_rtp_get_qos</a>(rtp, <a class="code" href="chan__iax2_8c.html#a1cc9e939c54c81f5c6cacb377cbb85e6">qos</a>, &amp;found);
<a name="l02826"></a>02826 
<a name="l02827"></a>02827    <span class="keywordflow">if</span> (!found)
<a name="l02828"></a>02828       <span class="keywordflow">return</span> -1;
<a name="l02829"></a>02829 
<a name="l02830"></a>02830    snprintf(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, buflen, <span class="stringliteral">&quot;%.0lf&quot;</span>, value);
<a name="l02831"></a>02831 
<a name="l02832"></a>02832    <span class="keywordflow">return</span> 0;
<a name="l02833"></a>02833 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a78d6d7ba670a9b2eebe039db90b00fb4"></a><!-- doxytag: member="rtp.h::ast_rtp_get_qosvalue" ref="a78d6d7ba670a9b2eebe039db90b00fb4" args="(struct ast_rtp *rtp, enum ast_rtp_qos_vars value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int ast_rtp_get_qosvalue </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="rtp_8h.html#a58b8acdd5acd2a70aa1a6d7040db199f">ast_rtp_qos_vars</a>&nbsp;</td>
          <td class="paramname"> <em>value</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return RTP and RTCP QoS <a class="el" href="structvalues.html">values</a>. </p>
<dl class="since"><dt><b>Since:</b></dt><dd>1.6.1</dd></dl>
<p>Get QoS <a class="el" href="structvalues.html">values</a> from RTP and RTCP data (used in "sip show channelstats") </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l02754">2754</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="rtp_8h_source.html#l00080">AST_RTP_RTT</a>, <a class="el" href="rtp_8h_source.html#l00075">AST_RTP_RXCOUNT</a>, <a class="el" href="rtp_8h_source.html#l00077">AST_RTP_RXJITTER</a>, <a class="el" href="rtp_8h_source.html#l00078">AST_RTP_RXPLOSS</a>, <a class="el" href="rtp_8h_source.html#l00074">AST_RTP_TXCOUNT</a>, <a class="el" href="rtp_8h_source.html#l00076">AST_RTP_TXJITTER</a>, <a class="el" href="rtp_8h_source.html#l00079">AST_RTP_TXPLOSS</a>, <a class="el" href="rtp_8c_source.html#l00241">ast_rtcp::expected_prior</a>, <a class="el" href="logger_8h_source.html#l00119">LOG_DEBUG</a>, <a class="el" href="asterisk_8c_source.html#l00175">option_debug</a>, <a class="el" href="rtp_8c_source.html#l00242">ast_rtcp::received_prior</a>, <a class="el" href="rtp_8c_source.html#l00249">ast_rtcp::reported_jitter</a>, <a class="el" href="rtp_8c_source.html#l00250">ast_rtcp::reported_lost</a>, <a class="el" href="rtp_8c_source.html#l00170">ast_rtp::rtcp</a>, <a class="el" href="rtp_8c_source.html#l00248">ast_rtcp::rtt</a>, <a class="el" href="rtp_8c_source.html#l00119">ast_rtp::rxcount</a>, <a class="el" href="rtp_8c_source.html#l00124">ast_rtp::rxjitter</a>, and <a class="el" href="rtp_8c_source.html#l00121">ast_rtp::txcount</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l15831">show_chanstats_cb()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02755"></a>02755 {
<a name="l02756"></a>02756    <span class="keywordflow">if</span> (rtp == NULL) {
<a name="l02757"></a>02757       <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ga40f8fb2e731031d99f732f515cec680f">option_debug</a> &gt; 1)
<a name="l02758"></a>02758          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;NO RTP Structure? Kidding me? \n&quot;</span>);
<a name="l02759"></a>02759       <span class="keywordflow">return</span> 0;
<a name="l02760"></a>02760    }
<a name="l02761"></a>02761    <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ga40f8fb2e731031d99f732f515cec680f">option_debug</a> &gt; 1 &amp;&amp; rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a> == NULL) {
<a name="l02762"></a>02762       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;NO RTCP structure. Maybe in RTP p2p bridging mode? \n&quot;</span>);
<a name="l02763"></a>02763    }
<a name="l02764"></a>02764 
<a name="l02765"></a>02765    <span class="keywordflow">switch</span> (value) {
<a name="l02766"></a>02766    <span class="keywordflow">case</span> <a class="code" href="rtp_8h.html#a58b8acdd5acd2a70aa1a6d7040db199fa7693b0a1e7eace7864bdc786233f6fcd">AST_RTP_TXCOUNT</a>:
<a name="l02767"></a>02767       <span class="keywordflow">return</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) rtp-&gt;<a class="code" href="structast__rtp.html#a887918839240a36d118b4e1cb46a4de9">txcount</a>;
<a name="l02768"></a>02768    <span class="keywordflow">case</span> <a class="code" href="rtp_8h.html#a58b8acdd5acd2a70aa1a6d7040db199fa3b1506d914a21ac0ab82c85fc67e35d2">AST_RTP_RXCOUNT</a>:
<a name="l02769"></a>02769       <span class="keywordflow">return</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) rtp-&gt;<a class="code" href="structast__rtp.html#a066dafb1cdc02b25e6c2329ef7e7a810">rxcount</a>;
<a name="l02770"></a>02770    <span class="keywordflow">case</span> <a class="code" href="rtp_8h.html#a58b8acdd5acd2a70aa1a6d7040db199fa349dc7902b65436f8fb251d5df5f2711">AST_RTP_TXJITTER</a>:
<a name="l02771"></a>02771       <span class="keywordflow">return</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) (rtp-&gt;<a class="code" href="structast__rtp.html#a80552fd3f7f852d51e944dc4105da800">rxjitter</a> * 1000.0);
<a name="l02772"></a>02772    <span class="keywordflow">case</span> <a class="code" href="rtp_8h.html#a58b8acdd5acd2a70aa1a6d7040db199fa5bf842efa73289a66d780670fd68e9c4">AST_RTP_RXJITTER</a>:
<a name="l02773"></a>02773       <span class="keywordflow">return</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) (rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a> ? (rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a1b3b9edcf4981174716c8afafd8c10f5">reported_jitter</a> / (<span class="keywordtype">unsigned</span> int) 65536.0) : 0);
<a name="l02774"></a>02774    <span class="keywordflow">case</span> <a class="code" href="rtp_8h.html#a58b8acdd5acd2a70aa1a6d7040db199fa61c9ec686ce215425f2d5ce98d6d3603">AST_RTP_RXPLOSS</a>:
<a name="l02775"></a>02775       <span class="keywordflow">return</span> rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a> ? (rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#af31acee9b731924c67c51fd05723c731">expected_prior</a> - rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a2b107901d7cf12cb119aad6e54b5adb7">received_prior</a>) : 0;
<a name="l02776"></a>02776    <span class="keywordflow">case</span> <a class="code" href="rtp_8h.html#a58b8acdd5acd2a70aa1a6d7040db199fada74b59f8703038f54e74dea998d0a5a">AST_RTP_TXPLOSS</a>:
<a name="l02777"></a>02777       <span class="keywordflow">return</span> rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a> ? rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a735181229b9c3facc1081e30fe7e532e">reported_lost</a> : 0;
<a name="l02778"></a>02778    <span class="keywordflow">case</span> <a class="code" href="rtp_8h.html#a58b8acdd5acd2a70aa1a6d7040db199fa00e0735389375cf9b1dd3eb72f83d940">AST_RTP_RTT</a>:
<a name="l02779"></a>02779       <span class="keywordflow">return</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) (rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a> ? (rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#abc953dca5930a67736d6cd8f72353794">rtt</a> * 100) : 0);
<a name="l02780"></a>02780    }
<a name="l02781"></a>02781    <span class="keywordflow">return</span> 0;   <span class="comment">/* To make the compiler happy */</span>
<a name="l02782"></a>02782 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab704d9412f9a12c656f51baf77f65a08"></a><!-- doxytag: member="rtp.h::ast_rtp_get_quality" ref="ab704d9412f9a12c656f51baf77f65a08" args="(struct ast_rtp *rtp, struct ast_rtp_quality *qual, enum ast_rtp_quality_type qtype)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* ast_rtp_get_quality </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__rtp__quality.html">ast_rtp_quality</a> *&nbsp;</td>
          <td class="paramname"> <em>qual</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="rtp_8h.html#a756ea404ff32087dee22a779a8d277a6">ast_rtp_quality_type</a>&nbsp;</td>
          <td class="paramname"> <em>qtype</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return RTCP quality string. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rtp</em>&nbsp;</td><td>An rtp structure to get qos information about.</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>qual</em>&nbsp;</td><td>An (optional) rtp quality structure that will be filled with the quality information described in the <a class="el" href="structast__rtp__quality.html" title="RTCP quality report storage.">ast_rtp_quality</a> structure. This structure is not dependent on any qtype, so a call for any type of information would yield the same results because <a class="el" href="structast__rtp__quality.html" title="RTCP quality report storage.">ast_rtp_quality</a> is not a data type specific to any qos type.</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>qtype</em>&nbsp;</td><td>The quality type you'd like, default should be RTPQOS_SUMMARY which returns basic information about the call. The return from RTPQOS_SUMMARY is basically <a class="el" href="structast__rtp__quality.html" title="RTCP quality report storage.">ast_rtp_quality</a> in a string. The other types are RTPQOS_JITTER, RTPQOS_LOSS and RTPQOS_RTT which will return more specific statistics. </td></tr>
  </table>
  </dd>
</dl>
<dl class="version"><dt><b>Version:</b></dt><dd>1.6.1 added qtype parameter </dd></dl>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l03027">3027</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l02987">__ast_rtp_get_quality()</a>, <a class="el" href="rtp_8c_source.html#l02866">__ast_rtp_get_quality_jitter()</a>, <a class="el" href="rtp_8c_source.html#l02915">__ast_rtp_get_quality_loss()</a>, <a class="el" href="rtp_8c_source.html#l02971">__ast_rtp_get_quality_rtt()</a>, <a class="el" href="rtp_8c_source.html#l00241">ast_rtcp::expected_prior</a>, <a class="el" href="rtp_8h_source.html#l00121">ast_rtp_quality::local_count</a>, <a class="el" href="rtp_8h_source.html#l00120">ast_rtp_quality::local_jitter</a>, <a class="el" href="rtp_8h_source.html#l00119">ast_rtp_quality::local_lostpackets</a>, <a class="el" href="rtp_8h_source.html#l00118">ast_rtp_quality::local_ssrc</a>, <a class="el" href="rtp_8c_source.html#l00242">ast_rtcp::received_prior</a>, <a class="el" href="rtp_8h_source.html#l00125">ast_rtp_quality::remote_count</a>, <a class="el" href="rtp_8h_source.html#l00124">ast_rtp_quality::remote_jitter</a>, <a class="el" href="rtp_8h_source.html#l00123">ast_rtp_quality::remote_lostpackets</a>, <a class="el" href="rtp_8h_source.html#l00122">ast_rtp_quality::remote_ssrc</a>, <a class="el" href="rtp_8c_source.html#l00249">ast_rtcp::reported_jitter</a>, <a class="el" href="rtp_8c_source.html#l00250">ast_rtcp::reported_lost</a>, <a class="el" href="rtp_8c_source.html#l00170">ast_rtp::rtcp</a>, <a class="el" href="rtp_8h_source.html#l00111">RTPQOS_JITTER</a>, <a class="el" href="rtp_8h_source.html#l00112">RTPQOS_LOSS</a>, <a class="el" href="rtp_8h_source.html#l00113">RTPQOS_RTT</a>, <a class="el" href="rtp_8h_source.html#l00110">RTPQOS_SUMMARY</a>, <a class="el" href="rtp_8c_source.html#l00248">ast_rtcp::rtt</a>, <a class="el" href="rtp_8h_source.html#l00126">ast_rtp_quality::rtt</a>, <a class="el" href="rtp_8c_source.html#l00119">ast_rtp::rxcount</a>, <a class="el" href="rtp_8c_source.html#l00124">ast_rtp::rxjitter</a>, <a class="el" href="rtp_8c_source.html#l00106">ast_rtp::ssrc</a>, <a class="el" href="rtp_8c_source.html#l00107">ast_rtp::themssrc</a>, and <a class="el" href="rtp_8c_source.html#l00121">ast_rtp::txcount</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l20916">acf_channel_read()</a>, <a class="el" href="rtp_8c_source.html#l02835">ast_rtp_set_vars()</a>, <a class="el" href="chan__sip_8c_source.html#l21024">handle_request_bye()</a>, and <a class="el" href="chan__sip_8c_source.html#l05956">sip_hangup()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03028"></a>03028 {
<a name="l03029"></a>03029    <span class="keywordflow">if</span> (qual &amp;&amp; rtp) {
<a name="l03030"></a>03030       qual-&gt;<a class="code" href="structast__rtp__quality.html#a345269c0d57add15c919b781d140e011">local_ssrc</a>   = rtp-&gt;<a class="code" href="structast__rtp.html#a9e10385ac55d32d10ef322d1a08a699d">ssrc</a>;
<a name="l03031"></a>03031       qual-&gt;<a class="code" href="structast__rtp__quality.html#aefacf30cd67e10c500a46ffb878231c5">local_jitter</a> = rtp-&gt;<a class="code" href="structast__rtp.html#a80552fd3f7f852d51e944dc4105da800">rxjitter</a>;
<a name="l03032"></a>03032       qual-&gt;<a class="code" href="structast__rtp__quality.html#ac217351226d153aa3b4d04c0e06dce4e">local_count</a>  = rtp-&gt;<a class="code" href="structast__rtp.html#a066dafb1cdc02b25e6c2329ef7e7a810">rxcount</a>;
<a name="l03033"></a>03033       qual-&gt;<a class="code" href="structast__rtp__quality.html#a052c95f741f3e25e6ab9217a01affb53">remote_ssrc</a>  = rtp-&gt;<a class="code" href="structast__rtp.html#afe92c8ff0d37afbf84f8715f4144ca27">themssrc</a>;
<a name="l03034"></a>03034       qual-&gt;<a class="code" href="structast__rtp__quality.html#a8f2976bbc0880a387467334441a9b60e">remote_count</a> = rtp-&gt;<a class="code" href="structast__rtp.html#a887918839240a36d118b4e1cb46a4de9">txcount</a>;
<a name="l03035"></a>03035 
<a name="l03036"></a>03036       <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>) {
<a name="l03037"></a>03037          qual-&gt;<a class="code" href="structast__rtp__quality.html#af942b1527ce61d3e19333fca67cf7499">local_lostpackets</a>  = rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#af31acee9b731924c67c51fd05723c731">expected_prior</a> - rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a2b107901d7cf12cb119aad6e54b5adb7">received_prior</a>;
<a name="l03038"></a>03038          qual-&gt;<a class="code" href="structast__rtp__quality.html#a5cb628d0a1af4affc08064059bee9dbd">remote_lostpackets</a> = rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a735181229b9c3facc1081e30fe7e532e">reported_lost</a>;
<a name="l03039"></a>03039          qual-&gt;<a class="code" href="structast__rtp__quality.html#aaf1b2598fc572dd7eafd438f85212dcd">remote_jitter</a>      = rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a1b3b9edcf4981174716c8afafd8c10f5">reported_jitter</a> / 65536.0;
<a name="l03040"></a>03040          qual-&gt;<a class="code" href="structast__rtp__quality.html#abc953dca5930a67736d6cd8f72353794">rtt</a>                = rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#abc953dca5930a67736d6cd8f72353794">rtt</a>;
<a name="l03041"></a>03041       }
<a name="l03042"></a>03042    }
<a name="l03043"></a>03043 
<a name="l03044"></a>03044    <span class="keywordflow">switch</span> (qtype) {
<a name="l03045"></a>03045    <span class="keywordflow">case</span> <a class="code" href="rtp_8h.html#a756ea404ff32087dee22a779a8d277a6a7f88830a41aa42bfb5e25f40f8184019">RTPQOS_SUMMARY</a>:
<a name="l03046"></a>03046       <span class="keywordflow">return</span> <a class="code" href="rtp_8c.html#af326d3cad5ebb9be27ac6cedd901a605">__ast_rtp_get_quality</a>(rtp);
<a name="l03047"></a>03047    <span class="keywordflow">case</span> <a class="code" href="rtp_8h.html#a756ea404ff32087dee22a779a8d277a6aa977210a30c7eeab8d2592df4e197d4b">RTPQOS_JITTER</a>:
<a name="l03048"></a>03048       <span class="keywordflow">return</span> <a class="code" href="rtp_8c.html#a89408d117ae87f301d7cd0869f6c6f9b">__ast_rtp_get_quality_jitter</a>(rtp);
<a name="l03049"></a>03049    <span class="keywordflow">case</span> <a class="code" href="rtp_8h.html#a756ea404ff32087dee22a779a8d277a6a06685070e92abe94bdd33cd1abaa30c1">RTPQOS_LOSS</a>:
<a name="l03050"></a>03050       <span class="keywordflow">return</span> <a class="code" href="rtp_8c.html#a64f910e3c1755080ab29b5c4d31d17f2">__ast_rtp_get_quality_loss</a>(rtp);
<a name="l03051"></a>03051    <span class="keywordflow">case</span> <a class="code" href="rtp_8h.html#a756ea404ff32087dee22a779a8d277a6acecf9cdfe1b45c0f19c4e9516c0d68ae">RTPQOS_RTT</a>:
<a name="l03052"></a>03052       <span class="keywordflow">return</span> <a class="code" href="rtp_8c.html#a0802bfd23cbf2bc10a3fa89a8cfcc5e6">__ast_rtp_get_quality_rtt</a>(rtp);
<a name="l03053"></a>03053    }
<a name="l03054"></a>03054 
<a name="l03055"></a>03055    <span class="keywordflow">return</span> NULL;
<a name="l03056"></a>03056 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3a2d59587ce0c7d5259a33726f1c1e5c"></a><!-- doxytag: member="rtp.h::ast_rtp_get_rtpholdtimeout" ref="a3a2d59587ce0c7d5259a33726f1c1e5c" args="(struct ast_rtp *rtp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_rtp_get_rtpholdtimeout </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get rtp hold timeout. </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l00778">778</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l00130">ast_rtp::rtpholdtimeout</a>, and <a class="el" href="rtp_8c_source.html#l00129">ast_rtp::rtptimeout</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l22343">check_rtp_timeout()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00779"></a>00779 {
<a name="l00780"></a>00780    <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a96c64be67b0bcd897efa8db0eced9ab8">rtptimeout</a> &lt; 0)   <span class="comment">/* We&apos;re not checking, but remembering the setting (during T.38 transmission) */</span>
<a name="l00781"></a>00781       <span class="keywordflow">return</span> 0;
<a name="l00782"></a>00782    <span class="keywordflow">return</span> rtp-&gt;<a class="code" href="structast__rtp.html#a9c8c363bb6d84360b92945bb18bb0451">rtpholdtimeout</a>;
<a name="l00783"></a>00783 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a003294c332c246f8ad007df22ecd5a16"></a><!-- doxytag: member="rtp.h::ast_rtp_get_rtpkeepalive" ref="a003294c332c246f8ad007df22ecd5a16" args="(struct ast_rtp *rtp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_rtp_get_rtpkeepalive </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get RTP keepalive interval. </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l00786">786</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l00131">ast_rtp::rtpkeepalive</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l22343">check_rtp_timeout()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00787"></a>00787 {
<a name="l00788"></a>00788    <span class="keywordflow">return</span> rtp-&gt;<a class="code" href="structast__rtp.html#a9472cfc2a7a21f124c161f7baaf9d5dc">rtpkeepalive</a>;
<a name="l00789"></a>00789 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a09840fa9ab8d07f139c5d0729cfebe13"></a><!-- doxytag: member="rtp.h::ast_rtp_get_rtptimeout" ref="a09840fa9ab8d07f139c5d0729cfebe13" args="(struct ast_rtp *rtp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_rtp_get_rtptimeout </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get rtp timeout. </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l00770">770</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l00129">ast_rtp::rtptimeout</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l22343">check_rtp_timeout()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00771"></a>00771 {
<a name="l00772"></a>00772    <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a96c64be67b0bcd897efa8db0eced9ab8">rtptimeout</a> &lt; 0)   <span class="comment">/* We&apos;re not checking, but remembering the setting (during T.38 transmission) */</span>
<a name="l00773"></a>00773       <span class="keywordflow">return</span> 0;
<a name="l00774"></a>00774    <span class="keywordflow">return</span> rtp-&gt;<a class="code" href="structast__rtp.html#a96c64be67b0bcd897efa8db0eced9ab8">rtptimeout</a>;
<a name="l00775"></a>00775 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a307269685e6f067a6abe35a184c3bae6"></a><!-- doxytag: member="rtp.h::ast_rtp_get_us" ref="a307269685e6f067a6abe35a184c3bae6" args="(struct ast_rtp *rtp, struct sockaddr_in *us)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_rtp_get_us </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>us</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rtp_8c_source.html#l02694">2694</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l00147">ast_rtp::us</a>.</p>

<p>Referenced by <a class="el" href="chan__mgcp_8c_source.html#l02047">add_sdp()</a>, <a class="el" href="chan__h323_8c_source.html#l01895">external_rtp_create()</a>, <a class="el" href="chan__sip_8c_source.html#l09977">get_our_media_address()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00773">gtalk_create_candidates()</a>, <a class="el" href="chan__skinny_8c_source.html#l05511">handle_open_receive_channel_ack_message()</a>, <a class="el" href="chan__jingle_8c_source.html#l00583">jingle_create_candidates()</a>, <a class="el" href="chan__h323_8c_source.html#l03189">oh323_set_rtp_peer()</a>, <a class="el" href="chan__skinny_8c_source.html#l02609">skinny_set_rtp_peer()</a>, and <a class="el" href="chan__unistim_8c_source.html#l02028">start_rtp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02695"></a>02695 {
<a name="l02696"></a>02696    *<a class="code" href="structast__rtp.html#a3c2346010ce32cf02b7c85203c76a20d">us</a> = rtp-&gt;<a class="code" href="structast__rtp.html#a3c2346010ce32cf02b7c85203c76a20d">us</a>;
<a name="l02697"></a>02697 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a036fcb49050c5f45a075d18b2f20c96a"></a><!-- doxytag: member="rtp.h::ast_rtp_getnat" ref="a036fcb49050c5f45a075d18b2f20c96a" args="(struct ast_rtp *rtp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_rtp_getnat </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rtp_8c_source.html#l00806">806</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, and <a class="el" href="rtp_8c_source.html#l00210">FLAG_NAT_ACTIVE</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l25226">sip_get_rtp_peer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00807"></a>00807 {
<a name="l00808"></a>00808    <span class="keywordflow">return</span> <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(rtp, <a class="code" href="rtp_8c.html#ab67e21f67a96dd6a9e1b0450ecddecf3">FLAG_NAT_ACTIVE</a>);
<a name="l00809"></a>00809 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2e910d500d92f02ebf8d571f585d6dd3"></a><!-- doxytag: member="rtp.h::ast_rtp_init" ref="a2e910d500d92f02ebf8d571f585d6dd3" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_rtp_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize the RTP system in Asterisk. </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l04817">4817</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l04739">__ast_rtp_reload()</a>, and <a class="el" href="cli_8c_source.html#l01927">ast_cli_register_multiple()</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04818"></a>04818 {
<a name="l04819"></a>04819    <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(<a class="code" href="rtp_8c.html#aa5f5020c8ed253374c8aead44db57c16">cli_rtp</a>, <span class="keyword">sizeof</span>(<a class="code" href="rtp_8c.html#aa5f5020c8ed253374c8aead44db57c16">cli_rtp</a>) / <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a>));
<a name="l04820"></a>04820    <a class="code" href="rtp_8c.html#a1dd1c9755cf7af11379a3d23a70c0bcf">__ast_rtp_reload</a>(0);
<a name="l04821"></a>04821 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4daa559b8f2ef25bc33d8f5d8fd937d1"></a><!-- doxytag: member="rtp.h::ast_rtp_lookup_code" ref="a4daa559b8f2ef25bc33d8f5d8fd937d1" args="(struct ast_rtp *rtp, int isAstFormat, int code)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_rtp_lookup_code </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>isAstFormat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>code</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Looks up an RTP code out of our *static* outbound list. </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l02360">2360</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8h_source.html#l00090">rtpPayloadType::code</a>, <a class="el" href="rtp_8c_source.html#l00166">ast_rtp::current_RTP_PT</a>, <a class="el" href="rtp_8h_source.html#l00089">rtpPayloadType::isAstFormat</a>, <a class="el" href="rtp_8h_source.html#l00052">MAX_RTP_PT</a>, <a class="el" href="rtp_8c_source.html#l00826">rtp_bridge_lock()</a>, <a class="el" href="rtp_8c_source.html#l00834">rtp_bridge_unlock()</a>, <a class="el" href="rtp_8c_source.html#l00168">ast_rtp::rtp_lookup_code_cache_code</a>, <a class="el" href="rtp_8c_source.html#l00167">ast_rtp::rtp_lookup_code_cache_isAstFormat</a>, and <a class="el" href="rtp_8c_source.html#l00169">ast_rtp::rtp_lookup_code_cache_result</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l00274">add_codec_to_answer()</a>, <a class="el" href="chan__sip_8c_source.html#l09822">add_codec_to_sdp()</a>, <a class="el" href="chan__sip_8c_source.html#l09955">add_noncodec_to_sdp()</a>, <a class="el" href="chan__mgcp_8c_source.html#l02047">add_sdp()</a>, <a class="el" href="chan__sip_8c_source.html#l09902">add_tcodec_to_sdp()</a>, <a class="el" href="chan__sip_8c_source.html#l09879">add_vcodec_to_sdp()</a>, <a class="el" href="rtp_8c_source.html#l03574">ast_rtp_sendcng()</a>, <a class="el" href="rtp_8c_source.html#l03141">ast_rtp_senddigit_begin()</a>, <a class="el" href="rtp_8c_source.html#l03790">ast_rtp_write()</a>, <a class="el" href="rtp_8c_source.html#l01508">bridge_p2p_rtp_write()</a>, and <a class="el" href="chan__unistim_8c_source.html#l02028">start_rtp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02361"></a>02361 {
<a name="l02362"></a>02362    <span class="keywordtype">int</span> pt = 0;
<a name="l02363"></a>02363 
<a name="l02364"></a>02364    <a class="code" href="rtp_8c.html#a67f38276600b7655f400f5b6c6118f8b">rtp_bridge_lock</a>(rtp);
<a name="l02365"></a>02365 
<a name="l02366"></a>02366    <span class="keywordflow">if</span> (isAstFormat == rtp-&gt;<a class="code" href="structast__rtp.html#ab087642ddcdd0db71470c90429925385">rtp_lookup_code_cache_isAstFormat</a> &amp;&amp;
<a name="l02367"></a>02367       code == rtp-&gt;<a class="code" href="structast__rtp.html#aaf7a119e1a2e85949f9340b0a63f9c4c">rtp_lookup_code_cache_code</a>) {
<a name="l02368"></a>02368       <span class="comment">/* Use our cached mapping, to avoid the overhead of the loop below */</span>
<a name="l02369"></a>02369       pt = rtp-&gt;<a class="code" href="structast__rtp.html#a7c7662b43c622f94d684c20139efc983">rtp_lookup_code_cache_result</a>;
<a name="l02370"></a>02370       <a class="code" href="rtp_8c.html#afabb78b03298d9f7b7e26b60ad0d02e4">rtp_bridge_unlock</a>(rtp);
<a name="l02371"></a>02371       <span class="keywordflow">return</span> pt;
<a name="l02372"></a>02372    }
<a name="l02373"></a>02373 
<a name="l02374"></a>02374    <span class="comment">/* Check the dynamic list first */</span>
<a name="l02375"></a>02375    <span class="keywordflow">for</span> (pt = 0; pt &lt; <a class="code" href="rtp_8h.html#ac8aa85cd14ebbc20fc0043f6f72b968d">MAX_RTP_PT</a>; ++pt) {
<a name="l02376"></a>02376       <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a326c376c0e9d4d7572cc3706205dbd01">current_RTP_PT</a>[pt].<a class="code" href="structrtpPayloadType.html#a45a5b7c00a796a23f01673cef1dbe0a9">code</a> == code &amp;&amp; rtp-&gt;<a class="code" href="structast__rtp.html#a326c376c0e9d4d7572cc3706205dbd01">current_RTP_PT</a>[pt].<a class="code" href="structrtpPayloadType.html#a6916911180850cb1b6045fa9b6927b02">isAstFormat</a> == isAstFormat) {
<a name="l02377"></a>02377          rtp-&gt;<a class="code" href="structast__rtp.html#ab087642ddcdd0db71470c90429925385">rtp_lookup_code_cache_isAstFormat</a> = isAstFormat;
<a name="l02378"></a>02378          rtp-&gt;<a class="code" href="structast__rtp.html#aaf7a119e1a2e85949f9340b0a63f9c4c">rtp_lookup_code_cache_code</a> = code;
<a name="l02379"></a>02379          rtp-&gt;<a class="code" href="structast__rtp.html#a7c7662b43c622f94d684c20139efc983">rtp_lookup_code_cache_result</a> = pt;
<a name="l02380"></a>02380          <a class="code" href="rtp_8c.html#afabb78b03298d9f7b7e26b60ad0d02e4">rtp_bridge_unlock</a>(rtp);
<a name="l02381"></a>02381          <span class="keywordflow">return</span> pt;
<a name="l02382"></a>02382       }
<a name="l02383"></a>02383    }
<a name="l02384"></a>02384 
<a name="l02385"></a>02385    <span class="comment">/* Then the static list */</span>
<a name="l02386"></a>02386    <span class="keywordflow">for</span> (pt = 0; pt &lt; MAX_RTP_PT; ++pt) {
<a name="l02387"></a>02387       <span class="keywordflow">if</span> (<a class="code" href="rtp_8c.html#aee0ddbbc121110ad6d1d3342eddec5f2" title="Mapping between Asterisk codecs and rtp payload types.">static_RTP_PT</a>[pt].code == code &amp;&amp; <a class="code" href="rtp_8c.html#aee0ddbbc121110ad6d1d3342eddec5f2" title="Mapping between Asterisk codecs and rtp payload types.">static_RTP_PT</a>[pt].isAstFormat == isAstFormat) {
<a name="l02388"></a>02388          rtp-&gt;<a class="code" href="structast__rtp.html#ab087642ddcdd0db71470c90429925385">rtp_lookup_code_cache_isAstFormat</a> = isAstFormat;
<a name="l02389"></a>02389          rtp-&gt;<a class="code" href="structast__rtp.html#aaf7a119e1a2e85949f9340b0a63f9c4c">rtp_lookup_code_cache_code</a> = code;
<a name="l02390"></a>02390          rtp-&gt;<a class="code" href="structast__rtp.html#a7c7662b43c622f94d684c20139efc983">rtp_lookup_code_cache_result</a> = pt;
<a name="l02391"></a>02391          <a class="code" href="rtp_8c.html#afabb78b03298d9f7b7e26b60ad0d02e4">rtp_bridge_unlock</a>(rtp);
<a name="l02392"></a>02392          <span class="keywordflow">return</span> pt;
<a name="l02393"></a>02393       }
<a name="l02394"></a>02394    }
<a name="l02395"></a>02395 
<a name="l02396"></a>02396    <a class="code" href="rtp_8c.html#afabb78b03298d9f7b7e26b60ad0d02e4">rtp_bridge_unlock</a>(rtp);
<a name="l02397"></a>02397 
<a name="l02398"></a>02398    <span class="keywordflow">return</span> -1;
<a name="l02399"></a>02399 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a00ae5fb20d1016e2fdf140befbebff05"></a><!-- doxytag: member="rtp.h::ast_rtp_lookup_mime_multiple" ref="a00ae5fb20d1016e2fdf140befbebff05" args="(char *buf, size_t size, const int capability, const int isAstFormat, enum ast_rtp_options options)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* ast_rtp_lookup_mime_multiple </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>capability</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>isAstFormat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="rtp_8h.html#a95ccef8388e3b0e9c9639e393d4081b6">ast_rtp_options</a>&nbsp;</td>
          <td class="paramname"> <em>options</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Build a string of MIME subtype names from a capability list. </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l02433">2433</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="rtp_8c_source.html#l02401">ast_rtp_lookup_mime_subtype()</a>, <a class="el" href="rtp_8h_source.html#l00049">AST_RTP_MAX</a>, <a class="el" href="cdr__custom_8c_source.html#l00058">format</a>, <a class="el" href="func__strings_8c_source.html#l00821">len()</a>, and <a class="el" href="cdr__adaptive__odbc_8c_source.html#l00053">name</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l08040">process_sdp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02435"></a>02435 {
<a name="l02436"></a>02436    <span class="keywordtype">int</span> <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>;
<a name="l02437"></a>02437    <span class="keywordtype">unsigned</span> <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;
<a name="l02438"></a>02438    <span class="keywordtype">char</span> *end = <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>;
<a name="l02439"></a>02439    <span class="keywordtype">char</span> *start = <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>;
<a name="l02440"></a>02440 
<a name="l02441"></a>02441    <span class="keywordflow">if</span> (!<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a> || !size)
<a name="l02442"></a>02442       <span class="keywordflow">return</span> NULL;
<a name="l02443"></a>02443 
<a name="l02444"></a>02444    snprintf(end, size, <span class="stringliteral">&quot;0x%x (&quot;</span>, <a class="code" href="chan__mgcp_8c.html#afa05b14ff7f76f303c784c00c4c63fa7">capability</a>);
<a name="l02445"></a>02445 
<a name="l02446"></a>02446    len = strlen(end);
<a name="l02447"></a>02447    end += len;
<a name="l02448"></a>02448    size -= len;
<a name="l02449"></a>02449    start = end;
<a name="l02450"></a>02450 
<a name="l02451"></a>02451    <span class="keywordflow">for</span> (format = 1; format &lt; <a class="code" href="rtp_8h.html#ae89f572a6b37614f05f4e210afcffa8c">AST_RTP_MAX</a>; format &lt;&lt;= 1) {
<a name="l02452"></a>02452       <span class="keywordflow">if</span> (<a class="code" href="chan__mgcp_8c.html#afa05b14ff7f76f303c784c00c4c63fa7">capability</a> &amp; format) {
<a name="l02453"></a>02453          <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a> = <a class="code" href="rtp_8h.html#ac740a1df73c95aecb587ccc0d46251a5" title="Mapping an Asterisk code into a MIME subtype (string):.">ast_rtp_lookup_mime_subtype</a>(isAstFormat, format, options);
<a name="l02454"></a>02454 
<a name="l02455"></a>02455          snprintf(end, size, <span class="stringliteral">&quot;%s|&quot;</span>, name);
<a name="l02456"></a>02456          len = strlen(end);
<a name="l02457"></a>02457          end += len;
<a name="l02458"></a>02458          size -= len;
<a name="l02459"></a>02459       }
<a name="l02460"></a>02460    }
<a name="l02461"></a>02461 
<a name="l02462"></a>02462    <span class="keywordflow">if</span> (start == end)
<a name="l02463"></a>02463       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(start, <span class="stringliteral">&quot;nothing)&quot;</span>, size); 
<a name="l02464"></a>02464    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (size &gt; 1)
<a name="l02465"></a>02465       *(end -1) = <span class="charliteral">&apos;)&apos;</span>;
<a name="l02466"></a>02466    
<a name="l02467"></a>02467    <span class="keywordflow">return</span> <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>;
<a name="l02468"></a>02468 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac740a1df73c95aecb587ccc0d46251a5"></a><!-- doxytag: member="rtp.h::ast_rtp_lookup_mime_subtype" ref="ac740a1df73c95aecb587ccc0d46251a5" args="(int isAstFormat, int code, enum ast_rtp_options options)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* ast_rtp_lookup_mime_subtype </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>isAstFormat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>code</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="rtp_8h.html#a95ccef8388e3b0e9c9639e393d4081b6">ast_rtp_options</a>&nbsp;</td>
          <td class="paramname"> <em>options</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Mapping an Asterisk code into a MIME subtype (string):. </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l02401">2401</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="frame_8h_source.html#l00249">AST_FORMAT_G726_AAL2</a>, <a class="el" href="rtp_8h_source.html#l00060">AST_RTP_OPT_G726_NONSTANDARD</a>, <a class="el" href="rtp_8h_source.html#l00089">rtpPayloadType::isAstFormat</a>, <a class="el" href="rtp_8c.html#ac28159d67093186b89f90cc742d611f4">mimeTypes</a>, <a class="el" href="rtp_8c_source.html#l01906">mimeType::payloadType</a>, and <a class="el" href="rtp_8c_source.html#l01908">mimeType::subtype</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l09822">add_codec_to_sdp()</a>, <a class="el" href="chan__sip_8c_source.html#l09955">add_noncodec_to_sdp()</a>, <a class="el" href="chan__mgcp_8c_source.html#l02047">add_sdp()</a>, <a class="el" href="chan__sip_8c_source.html#l09902">add_tcodec_to_sdp()</a>, <a class="el" href="chan__sip_8c_source.html#l09879">add_vcodec_to_sdp()</a>, <a class="el" href="rtp_8c_source.html#l02433">ast_rtp_lookup_mime_multiple()</a>, <a class="el" href="chan__mgcp_8c_source.html#l02176">transmit_connect_with_sdp()</a>, and <a class="el" href="chan__mgcp_8c_source.html#l02140">transmit_modify_with_sdp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02403"></a>02403 {
<a name="l02404"></a>02404    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
<a name="l02405"></a>02405 
<a name="l02406"></a>02406    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="rtp_8c.html#ac28159d67093186b89f90cc742d611f4">mimeTypes</a>); ++i) {
<a name="l02407"></a>02407       <span class="keywordflow">if</span> ((<a class="code" href="rtp_8c.html#ac28159d67093186b89f90cc742d611f4">mimeTypes</a>[i].payloadType.code == code) &amp;&amp; (<a class="code" href="rtp_8c.html#ac28159d67093186b89f90cc742d611f4">mimeTypes</a>[i].<a class="code" href="structmimeType.html#a18e919f09824102c5924529a8e2bf3a5">payloadType</a>.<a class="code" href="structrtpPayloadType.html#a6916911180850cb1b6045fa9b6927b02">isAstFormat</a> == isAstFormat)) {
<a name="l02408"></a>02408          <span class="keywordflow">if</span> (isAstFormat &amp;&amp;
<a name="l02409"></a>02409              (code == <a class="code" href="frame_8h.html#a536fbd427f197a33e679c7721afad420">AST_FORMAT_G726_AAL2</a>) &amp;&amp;
<a name="l02410"></a>02410              (options &amp; <a class="code" href="rtp_8h.html#a95ccef8388e3b0e9c9639e393d4081b6ad570d49420fe15c4660793d1fc2f0fc8">AST_RTP_OPT_G726_NONSTANDARD</a>))
<a name="l02411"></a>02411             <span class="keywordflow">return</span> <span class="stringliteral">&quot;G726-32&quot;</span>;
<a name="l02412"></a>02412          <span class="keywordflow">else</span>
<a name="l02413"></a>02413             <span class="keywordflow">return</span> <a class="code" href="rtp_8c.html#ac28159d67093186b89f90cc742d611f4">mimeTypes</a>[i].<a class="code" href="structmimeType.html#a2f076846fbd6b30183ba3ab61e3334e5">subtype</a>;
<a name="l02414"></a>02414       }
<a name="l02415"></a>02415    }
<a name="l02416"></a>02416 
<a name="l02417"></a>02417    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l02418"></a>02418 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9fdf56baeb1e0ca97859d10826bdd1de"></a><!-- doxytag: member="rtp.h::ast_rtp_lookup_pt" ref="a9fdf56baeb1e0ca97859d10826bdd1de" args="(struct ast_rtp *rtp, int pt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structrtpPayloadType.html">rtpPayloadType</a> ast_rtp_lookup_pt </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pt</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Mapping between RTP payload format codes and Asterisk codes:. </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l02338">2338</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8h_source.html#l00090">rtpPayloadType::code</a>, <a class="el" href="rtp_8h_source.html#l00089">rtpPayloadType::isAstFormat</a>, <a class="el" href="rtp_8h_source.html#l00052">MAX_RTP_PT</a>, <a class="el" href="rtp_8c_source.html#l00826">rtp_bridge_lock()</a>, and <a class="el" href="rtp_8c_source.html#l00834">rtp_bridge_unlock()</a>.</p>

<p>Referenced by <a class="el" href="rtp_8c_source.html#l01562">ast_rtp_read()</a>, <a class="el" href="rtp_8c_source.html#l01508">bridge_p2p_rtp_write()</a>, <a class="el" href="chan__sip_8c_source.html#l08730">process_sdp_a_audio()</a>, and <a class="el" href="chan__h323_8c_source.html#l01936">setup_rtp_connection()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02339"></a>02339 {
<a name="l02340"></a>02340    <span class="keyword">struct </span><a class="code" href="structrtpPayloadType.html" title="The value of each payload format mapping:.">rtpPayloadType</a> result;
<a name="l02341"></a>02341 
<a name="l02342"></a>02342    result.isAstFormat = result.code = 0;
<a name="l02343"></a>02343 
<a name="l02344"></a>02344    <span class="keywordflow">if</span> (pt &lt; 0 || pt &gt;= <a class="code" href="rtp_8h.html#ac8aa85cd14ebbc20fc0043f6f72b968d">MAX_RTP_PT</a>) 
<a name="l02345"></a>02345       <span class="keywordflow">return</span> result; <span class="comment">/* bogus payload type */</span>
<a name="l02346"></a>02346 
<a name="l02347"></a>02347    <span class="comment">/* Start with negotiated codecs */</span>
<a name="l02348"></a>02348    <a class="code" href="rtp_8c.html#a67f38276600b7655f400f5b6c6118f8b">rtp_bridge_lock</a>(rtp);
<a name="l02349"></a>02349    result = rtp-&gt;<a class="code" href="structast__rtp.html#a326c376c0e9d4d7572cc3706205dbd01">current_RTP_PT</a>[pt];
<a name="l02350"></a>02350    <a class="code" href="rtp_8c.html#afabb78b03298d9f7b7e26b60ad0d02e4">rtp_bridge_unlock</a>(rtp);
<a name="l02351"></a>02351 
<a name="l02352"></a>02352    <span class="comment">/* If it doesn&apos;t exist, check our static RTP type list, just in case */</span>
<a name="l02353"></a>02353    <span class="keywordflow">if</span> (!result.code) 
<a name="l02354"></a>02354       result = <a class="code" href="rtp_8c.html#aee0ddbbc121110ad6d1d3342eddec5f2" title="Mapping between Asterisk codecs and rtp payload types.">static_RTP_PT</a>[pt];
<a name="l02355"></a>02355 
<a name="l02356"></a>02356    <span class="keywordflow">return</span> result;
<a name="l02357"></a>02357 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af081370a8afd454b1f8cae5bdc55be09"></a><!-- doxytag: member="rtp.h::ast_rtp_lookup_sample_rate" ref="af081370a8afd454b1f8cae5bdc55be09" args="(int isAstFormat, int code)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int ast_rtp_lookup_sample_rate </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>isAstFormat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>code</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get the sample rate associated with known RTP payload types. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>isAstFormat</em>&nbsp;</td><td>True if the value in the 'code' parameter is an AST_FORMAT value </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>code</em>&nbsp;</td><td>Format code, either from AST_FORMAT list or from AST_RTP list</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the sample rate if the format was found, zero if it was not found </dd></dl>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l02420">2420</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="rtp_8h_source.html#l00089">rtpPayloadType::isAstFormat</a>, <a class="el" href="rtp_8c.html#ac28159d67093186b89f90cc742d611f4">mimeTypes</a>, <a class="el" href="rtp_8c_source.html#l01906">mimeType::payloadType</a>, and <a class="el" href="rtp_8c_source.html#l01909">mimeType::sample_rate</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l09822">add_codec_to_sdp()</a>, <a class="el" href="chan__sip_8c_source.html#l09955">add_noncodec_to_sdp()</a>, <a class="el" href="chan__sip_8c_source.html#l09902">add_tcodec_to_sdp()</a>, and <a class="el" href="chan__sip_8c_source.html#l09879">add_vcodec_to_sdp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02421"></a>02421 {
<a name="l02422"></a>02422    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
<a name="l02423"></a>02423 
<a name="l02424"></a>02424    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="rtp_8c.html#ac28159d67093186b89f90cc742d611f4">mimeTypes</a>); ++i) {
<a name="l02425"></a>02425       <span class="keywordflow">if</span> ((<a class="code" href="rtp_8c.html#ac28159d67093186b89f90cc742d611f4">mimeTypes</a>[i].payloadType.code == <a class="code" href="structrtpPayloadType.html#a45a5b7c00a796a23f01673cef1dbe0a9">code</a>) &amp;&amp; (<a class="code" href="rtp_8c.html#ac28159d67093186b89f90cc742d611f4">mimeTypes</a>[i].<a class="code" href="structmimeType.html#a18e919f09824102c5924529a8e2bf3a5">payloadType</a>.<a class="code" href="structrtpPayloadType.html#a6916911180850cb1b6045fa9b6927b02">isAstFormat</a> == <a class="code" href="structrtpPayloadType.html#a6916911180850cb1b6045fa9b6927b02">isAstFormat</a>)) {
<a name="l02426"></a>02426          <span class="keywordflow">return</span> <a class="code" href="rtp_8c.html#ac28159d67093186b89f90cc742d611f4">mimeTypes</a>[i].<a class="code" href="structmimeType.html#a1c086f81c095b0efd7a87ee29fc5ba7e">sample_rate</a>;
<a name="l02427"></a>02427       }
<a name="l02428"></a>02428    }
<a name="l02429"></a>02429 
<a name="l02430"></a>02430    <span class="keywordflow">return</span> 0;
<a name="l02431"></a>02431 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad410e7253fcf8b398328276412d4232e"></a><!-- doxytag: member="rtp.h::ast_rtp_make_compatible" ref="ad410e7253fcf8b398328276412d4232e" args="(struct ast_channel *dest, struct ast_channel *src, int media)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_rtp_make_compatible </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>media</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rtp_8c_source.html#l02157">2157</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02037">ast_channel_trylock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="rtp_8h_source.html#l00065">AST_RTP_GET_FAILED</a>, <a class="el" href="rtp_8c_source.html#l02035">ast_rtp_pt_copy()</a>, <a class="el" href="rtp_8h_source.html#l00069">AST_RTP_TRY_NATIVE</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="rtp_8c_source.html#l00210">FLAG_NAT_ACTIVE</a>, <a class="el" href="structast__rtp__protocol.html#aef0f5483a05126d99b826a0312ea7992">ast_rtp_protocol::get_codec</a>, <a class="el" href="rtp_8c_source.html#l02057">get_proto()</a>, <a class="el" href="structast__rtp__protocol.html#aad2be0227a36efe9efc1fea51dd407a5">ast_rtp_protocol::get_rtp_info</a>, <a class="el" href="structast__rtp__protocol.html#ae3c52f1d063f37511bf26a747639254a">ast_rtp_protocol::get_trtp_info</a>, <a class="el" href="structast__rtp__protocol.html#aea1ff20567813f95ff79f94c554fff27">ast_rtp_protocol::get_vrtp_info</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="structast__rtp__protocol.html#a321bf6332b1fa0f6c9d85abc03c1f3df">ast_rtp_protocol::set_rtp_peer</a>.</p>

<p>Referenced by <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, and <a class="el" href="app__dial_8c_source.html#l00712">do_forward()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02158"></a>02158 {
<a name="l02159"></a>02159    <span class="keyword">struct </span><a class="code" href="structast__rtp.html" title="Structure representing a RTP session.">ast_rtp</a> *destp = NULL, *srcp = NULL;     <span class="comment">/* Audio RTP Channels */</span>
<a name="l02160"></a>02160    <span class="keyword">struct </span><a class="code" href="structast__rtp.html" title="Structure representing a RTP session.">ast_rtp</a> *vdestp = NULL, *vsrcp = NULL;      <span class="comment">/* Video RTP channels */</span>
<a name="l02161"></a>02161    <span class="keyword">struct </span><a class="code" href="structast__rtp.html" title="Structure representing a RTP session.">ast_rtp</a> *tdestp = NULL, *tsrcp = NULL;      <span class="comment">/* Text RTP channels */</span>
<a name="l02162"></a>02162    <span class="keyword">struct </span><a class="code" href="structast__rtp__protocol.html" title="This is the structure that binds a channel (SIP/Jingle/H.323) to the RTP subsystem...">ast_rtp_protocol</a> *destpr = NULL, *srcpr = NULL;
<a name="l02163"></a>02163    <span class="keyword">enum</span> <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95">ast_rtp_get_result</a> audio_dest_res = <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>, video_dest_res = <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>, text_dest_res = <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>;
<a name="l02164"></a>02164    <span class="keyword">enum</span> <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95">ast_rtp_get_result</a> audio_src_res = <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>, video_src_res = <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>, text_src_res = <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>; 
<a name="l02165"></a>02165    <span class="keywordtype">int</span> srccodec, destcodec;
<a name="l02166"></a>02166 
<a name="l02167"></a>02167    <span class="comment">/* Lock channels */</span>
<a name="l02168"></a>02168    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(dest);
<a name="l02169"></a>02169    <span class="keywordflow">while</span> (<a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(src)) {
<a name="l02170"></a>02170       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(dest);
<a name="l02171"></a>02171       usleep(1);
<a name="l02172"></a>02172       <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(dest);
<a name="l02173"></a>02173    }
<a name="l02174"></a>02174 
<a name="l02175"></a>02175    <span class="comment">/* Find channel driver interfaces */</span>
<a name="l02176"></a>02176    <span class="keywordflow">if</span> (!(destpr = <a class="code" href="rtp_8c.html#aaff70ed852bc78df19b0615bbb1885cd" title="Get channel driver interface structure.">get_proto</a>(dest))) {
<a name="l02177"></a>02177       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Channel &apos;%s&apos; has no RTP, not doing anything\n&quot;</span>, dest-&gt;name);
<a name="l02178"></a>02178       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(dest);
<a name="l02179"></a>02179       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(src);
<a name="l02180"></a>02180       <span class="keywordflow">return</span> 0;
<a name="l02181"></a>02181    }
<a name="l02182"></a>02182    <span class="keywordflow">if</span> (!(srcpr = <a class="code" href="rtp_8c.html#aaff70ed852bc78df19b0615bbb1885cd" title="Get channel driver interface structure.">get_proto</a>(src))) {
<a name="l02183"></a>02183       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Channel &apos;%s&apos; has no RTP, not doing anything\n&quot;</span>, src-&gt;name);
<a name="l02184"></a>02184       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(dest);
<a name="l02185"></a>02185       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(src);
<a name="l02186"></a>02186       <span class="keywordflow">return</span> 0;
<a name="l02187"></a>02187    }
<a name="l02188"></a>02188 
<a name="l02189"></a>02189    <span class="comment">/* Get audio and video interface (if native bridge is possible) */</span>
<a name="l02190"></a>02190    audio_dest_res = destpr-&gt;<a class="code" href="structast__rtp__protocol.html#aad2be0227a36efe9efc1fea51dd407a5">get_rtp_info</a>(dest, &amp;destp);
<a name="l02191"></a>02191    video_dest_res = destpr-&gt;<a class="code" href="structast__rtp__protocol.html#aea1ff20567813f95ff79f94c554fff27">get_vrtp_info</a> ? destpr-&gt;<a class="code" href="structast__rtp__protocol.html#aea1ff20567813f95ff79f94c554fff27">get_vrtp_info</a>(dest, &amp;vdestp) : <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>;
<a name="l02192"></a>02192    text_dest_res = destpr-&gt;<a class="code" href="structast__rtp__protocol.html#ae3c52f1d063f37511bf26a747639254a">get_trtp_info</a> ? destpr-&gt;<a class="code" href="structast__rtp__protocol.html#ae3c52f1d063f37511bf26a747639254a">get_trtp_info</a>(dest, &amp;tdestp) : <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>;
<a name="l02193"></a>02193    audio_src_res = srcpr-&gt;get_rtp_info(src, &amp;srcp);
<a name="l02194"></a>02194    video_src_res = srcpr-&gt;get_vrtp_info ? srcpr-&gt;get_vrtp_info(src, &amp;vsrcp) : <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>;
<a name="l02195"></a>02195    text_src_res = srcpr-&gt;get_trtp_info ? srcpr-&gt;get_trtp_info(src, &amp;tsrcp) : <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>;
<a name="l02196"></a>02196 
<a name="l02197"></a>02197    <span class="comment">/* Ensure we have at least one matching codec */</span>
<a name="l02198"></a>02198    <span class="keywordflow">if</span> (srcpr-&gt;get_codec)
<a name="l02199"></a>02199       srccodec = srcpr-&gt;get_codec(src);
<a name="l02200"></a>02200    <span class="keywordflow">else</span>
<a name="l02201"></a>02201       srccodec = 0;
<a name="l02202"></a>02202    <span class="keywordflow">if</span> (destpr-&gt;<a class="code" href="structast__rtp__protocol.html#aef0f5483a05126d99b826a0312ea7992">get_codec</a>)
<a name="l02203"></a>02203       destcodec = destpr-&gt;<a class="code" href="structast__rtp__protocol.html#aef0f5483a05126d99b826a0312ea7992">get_codec</a>(dest);
<a name="l02204"></a>02204    <span class="keywordflow">else</span>
<a name="l02205"></a>02205       destcodec = 0;
<a name="l02206"></a>02206 
<a name="l02207"></a>02207    <span class="comment">/* Check if bridge is still possible (In SIP directmedia=no stops this, like NAT) */</span>
<a name="l02208"></a>02208    <span class="keywordflow">if</span> (audio_dest_res != <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ab591abc73866492b4b33dd96d9925136">AST_RTP_TRY_NATIVE</a> || (video_dest_res != <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a> &amp;&amp; video_dest_res != <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ab591abc73866492b4b33dd96d9925136">AST_RTP_TRY_NATIVE</a>) || audio_src_res != <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ab591abc73866492b4b33dd96d9925136">AST_RTP_TRY_NATIVE</a> || (video_src_res != <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a> &amp;&amp; video_src_res != <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ab591abc73866492b4b33dd96d9925136">AST_RTP_TRY_NATIVE</a>) || !(srccodec &amp; destcodec)) {
<a name="l02209"></a>02209       <span class="comment">/* Somebody doesn&apos;t want to play... */</span>
<a name="l02210"></a>02210       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(dest);
<a name="l02211"></a>02211       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(src);
<a name="l02212"></a>02212       <span class="keywordflow">return</span> 0;
<a name="l02213"></a>02213    }
<a name="l02214"></a>02214    <a class="code" href="rtp_8h.html#a30cfc736f18627e5d0d25196a116faa1" title="Copy payload types between RTP structures.">ast_rtp_pt_copy</a>(destp, srcp);
<a name="l02215"></a>02215    <span class="keywordflow">if</span> (vdestp &amp;&amp; vsrcp)
<a name="l02216"></a>02216       <a class="code" href="rtp_8h.html#a30cfc736f18627e5d0d25196a116faa1" title="Copy payload types between RTP structures.">ast_rtp_pt_copy</a>(vdestp, vsrcp);
<a name="l02217"></a>02217    <span class="keywordflow">if</span> (tdestp &amp;&amp; tsrcp)
<a name="l02218"></a>02218       <a class="code" href="rtp_8h.html#a30cfc736f18627e5d0d25196a116faa1" title="Copy payload types between RTP structures.">ast_rtp_pt_copy</a>(tdestp, tsrcp);
<a name="l02219"></a>02219    <span class="keywordflow">if</span> (media) {
<a name="l02220"></a>02220       <span class="comment">/* Bridge early */</span>
<a name="l02221"></a>02221       <span class="keywordflow">if</span> (destpr-&gt;<a class="code" href="structast__rtp__protocol.html#a321bf6332b1fa0f6c9d85abc03c1f3df">set_rtp_peer</a>(dest, srcp, vsrcp, tsrcp, srccodec, <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(srcp, <a class="code" href="rtp_8c.html#ab67e21f67a96dd6a9e1b0450ecddecf3">FLAG_NAT_ACTIVE</a>)))
<a name="l02222"></a>02222          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Channel &apos;%s&apos; failed to setup early bridge to &apos;%s&apos;\n&quot;</span>, dest-&gt;name, src-&gt;name);
<a name="l02223"></a>02223    }
<a name="l02224"></a>02224    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(dest);
<a name="l02225"></a>02225    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(src);
<a name="l02226"></a>02226    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Seeded SDP of &apos;%s&apos; with that of &apos;%s&apos;\n&quot;</span>, dest-&gt;name, src-&gt;name);
<a name="l02227"></a>02227    <span class="keywordflow">return</span> 1;
<a name="l02228"></a>02228 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7736ea5b51cac9412ae82d6f009d7055"></a><!-- doxytag: member="rtp.h::ast_rtp_new" ref="a7736ea5b51cac9412ae82d6f009d7055" args="(struct sched_context *sched, struct io_context *io, int rtcpenable, int callbackmode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__rtp.html">ast_rtp</a>* ast_rtp_new </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structsched__context.html">sched_context</a> *&nbsp;</td>
          <td class="paramname"> <em>sched</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structio__context.html">io_context</a> *&nbsp;</td>
          <td class="paramname"> <em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>rtcpenable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>callbackmode</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initializate a RTP session. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structsched.html">sched</a></em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>io</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>rtcpenable</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>callbackmode</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>A representation (structure) of an RTP session. </dd></dl>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l02628">2628</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l02533">ast_rtp_new_with_bindaddr()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02629"></a>02629 {
<a name="l02630"></a>02630    <span class="keyword">struct </span>in_addr ia;
<a name="l02631"></a>02631 
<a name="l02632"></a>02632    memset(&amp;ia, 0, <span class="keyword">sizeof</span>(ia));
<a name="l02633"></a>02633    <span class="keywordflow">return</span> <a class="code" href="rtp_8h.html#a10d5296cd50be78954103b0a0c754640" title="Initializate a RTP session using an in_addr structure.">ast_rtp_new_with_bindaddr</a>(sched, io, rtcpenable, callbackmode, ia);
<a name="l02634"></a>02634 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad1235778d2cb1fbe8b1339b43ca3602c"></a><!-- doxytag: member="rtp.h::ast_rtp_new_init" ref="ad1235778d2cb1fbe8b1339b43ca3602c" args="(struct ast_rtp *rtp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_rtp_new_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize a new RTP structure. </p>
<p>reload rtp configuration </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l02519">2519</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01692">ast_mutex_init()</a>, <a class="el" href="utils_8c_source.html#l01401">ast_random()</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="rtp_8c_source.html#l00213">FLAG_HAS_DTMF</a>, <a class="el" href="rtp_8c_source.html#l00157">ast_rtp::seqno</a>, <a class="el" href="rtp_8c_source.html#l00106">ast_rtp::ssrc</a>, <a class="el" href="rtp_8c_source.html#l00087">STRICT_RTP_LEARN</a>, <a class="el" href="rtp_8c_source.html#l00086">STRICT_RTP_OPEN</a>, <a class="el" href="rtp_8c_source.html#l00174">ast_rtp::strict_rtp_state</a>, <a class="el" href="rtp_8c_source.html#l00148">ast_rtp::them</a>, and <a class="el" href="rtp_8c_source.html#l00147">ast_rtp::us</a>.</p>

<p>Referenced by <a class="el" href="rtp_8c_source.html#l02533">ast_rtp_new_with_bindaddr()</a>, and <a class="el" href="chan__sip_8c_source.html#l08040">process_sdp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02520"></a>02520 {
<a name="l02521"></a>02521 <span class="preprocessor">#ifdef P2P_INTENSE</span>
<a name="l02522"></a>02522 <span class="preprocessor"></span>   <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;rtp-&gt;bridge_lock);
<a name="l02523"></a>02523 <span class="preprocessor">#endif</span>
<a name="l02524"></a>02524 <span class="preprocessor"></span>
<a name="l02525"></a>02525    rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_family = AF_INET;
<a name="l02526"></a>02526    rtp-&gt;<a class="code" href="structast__rtp.html#a3c2346010ce32cf02b7c85203c76a20d">us</a>.sin_family = AF_INET;
<a name="l02527"></a>02527    rtp-&gt;<a class="code" href="structast__rtp.html#a9e10385ac55d32d10ef322d1a08a699d">ssrc</a> = <a class="code" href="utils_8h.html#a7b4f10b070e95ba413e258a3e4b03c20">ast_random</a>();
<a name="l02528"></a>02528    rtp-&gt;<a class="code" href="structast__rtp.html#a66d741481aec999a0e8bc17f70db4ebe">seqno</a> = <a class="code" href="utils_8h.html#a7b4f10b070e95ba413e258a3e4b03c20">ast_random</a>() &amp; 0xffff;
<a name="l02529"></a>02529    <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(rtp, <a class="code" href="rtp_8c.html#a3da84400ccc8d31229b3c91d505ca7af">FLAG_HAS_DTMF</a>);
<a name="l02530"></a>02530    rtp-&gt;<a class="code" href="structast__rtp.html#a64730d554c32f13303a5a19f39cbd826">strict_rtp_state</a> = (<a class="code" href="rtp_8c.html#a96336b3ac9e5b66f365f0ca5ba613995">strictrtp</a> ? <a class="code" href="rtp_8c.html#aca6484d75ee9d79a5d4447149f9c8c4ba0c26c1144bb830775979deb20e049368">STRICT_RTP_LEARN</a> : <a class="code" href="rtp_8c.html#aca6484d75ee9d79a5d4447149f9c8c4bab82bff21db6795dfa152e316f6ae6bc1">STRICT_RTP_OPEN</a>);
<a name="l02531"></a>02531 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a858a9803ad1b78fc1b9602bb9cad1411"></a><!-- doxytag: member="rtp.h::ast_rtp_new_source" ref="a858a9803ad1b78fc1b9602bb9cad1411" args="(struct ast_rtp *rtp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_rtp_new_source </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rtp_8c_source.html#l02646">2646</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="utils_8c_source.html#l01401">ast_random()</a>, <a class="el" href="rtp_8c_source.html#l00178">ast_rtp::constantssrc</a>, <a class="el" href="rtp_8c_source.html#l00177">ast_rtp::set_marker_bit</a>, and <a class="el" href="rtp_8c_source.html#l00106">ast_rtp::ssrc</a>.</p>

<p>Referenced by <a class="el" href="chan__mgcp_8c_source.html#l01426">mgcp_indicate()</a>, <a class="el" href="chan__h323_8c_source.html#l00856">oh323_indicate()</a>, <a class="el" href="chan__sip_8c_source.html#l06187">sip_answer()</a>, <a class="el" href="chan__sip_8c_source.html#l06491">sip_indicate()</a>, <a class="el" href="chan__sip_8c_source.html#l06207">sip_write()</a>, and <a class="el" href="chan__skinny_8c_source.html#l04169">skinny_indicate()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02647"></a>02647 {
<a name="l02648"></a>02648    <span class="keywordflow">if</span> (rtp) {
<a name="l02649"></a>02649       rtp-&gt;<a class="code" href="structast__rtp.html#a1089b0c7f83ef826379989c20a11fd4b">set_marker_bit</a> = 1;
<a name="l02650"></a>02650       <span class="keywordflow">if</span> (!rtp-&gt;<a class="code" href="structast__rtp.html#a06f00722236fa7f3e3f695e26a37179b">constantssrc</a>) {
<a name="l02651"></a>02651          rtp-&gt;<a class="code" href="structast__rtp.html#a9e10385ac55d32d10ef322d1a08a699d">ssrc</a> = <a class="code" href="utils_8h.html#a7b4f10b070e95ba413e258a3e4b03c20">ast_random</a>();
<a name="l02652"></a>02652       }
<a name="l02653"></a>02653    }
<a name="l02654"></a>02654 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a10d5296cd50be78954103b0a0c754640"></a><!-- doxytag: member="rtp.h::ast_rtp_new_with_bindaddr" ref="a10d5296cd50be78954103b0a0c754640" args="(struct sched_context *sched, struct io_context *io, int rtcpenable, int callbackmode, struct in_addr in)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__rtp.html">ast_rtp</a>* ast_rtp_new_with_bindaddr </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structsched__context.html">sched_context</a> *&nbsp;</td>
          <td class="paramname"> <em>sched</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structio__context.html">io_context</a> *&nbsp;</td>
          <td class="paramname"> <em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>rtcpenable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>callbackmode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct in_addr&nbsp;</td>
          <td class="paramname"> <em>in</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initializate a RTP session using an in_addr structure. </p>
<p>This fuction gets called by <a class="el" href="rtp_8h.html#a7736ea5b51cac9412ae82d6f009d7055" title="Initializate a RTP session.">ast_rtp_new()</a>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structsched.html">sched</a></em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>io</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>rtcpenable</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>callbackmode</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>in</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>A representation (structure) of an RTP session. </dd></dl>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l02533">2533</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="io_8c_source.html#l00153">ast_io_add()</a>, <a class="el" href="io_8h_source.html#l00033">AST_IO_IN</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8c_source.html#l01401">ast_random()</a>, <a class="el" href="rtp_8c_source.html#l02496">ast_rtcp_new()</a>, <a class="el" href="rtp_8c_source.html#l02519">ast_rtp_new_init()</a>, <a class="el" href="rtp_8c_source.html#l02016">ast_rtp_pt_default()</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="rtp_8c_source.html#l00216">FLAG_CALLBACK_MODE</a>, <a class="el" href="rtp_8c_source.html#l00160">ast_rtp::io</a>, <a class="el" href="rtp_8c_source.html#l00156">ast_rtp::ioid</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="rtp_8c_source.html#l00170">ast_rtp::rtcp</a>, <a class="el" href="rtp_8c_source.html#l02473">rtp_socket()</a>, <a class="el" href="rtp_8c_source.html#l01156">rtpread()</a>, <a class="el" href="rtp_8c_source.html#l00232">ast_rtcp::s</a>, <a class="el" href="rtp_8c_source.html#l00103">ast_rtp::s</a>, <a class="el" href="rtp_8c_source.html#l00159">ast_rtp::sched</a>, <a class="el" href="rtp_8c_source.html#l00233">ast_rtcp::us</a>, and <a class="el" href="rtp_8c_source.html#l00147">ast_rtp::us</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l00951">__oh323_rtp_create()</a>, <a class="el" href="rtp_8c_source.html#l02628">ast_rtp_new()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00909">gtalk_alloc()</a>, <a class="el" href="chan__jingle_8c_source.html#l00741">jingle_alloc()</a>, <a class="el" href="chan__sip_8c_source.html#l07151">sip_alloc()</a>, and <a class="el" href="chan__mgcp_8c_source.html#l02610">start_rtp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02534"></a>02534 {
<a name="l02535"></a>02535    <span class="keyword">struct </span><a class="code" href="structast__rtp.html" title="Structure representing a RTP session.">ast_rtp</a> *rtp;
<a name="l02536"></a>02536    <span class="keywordtype">int</span> x;
<a name="l02537"></a>02537    <span class="keywordtype">int</span> startplace;
<a name="l02538"></a>02538    
<a name="l02539"></a>02539    <span class="keywordflow">if</span> (!(rtp = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*rtp))))
<a name="l02540"></a>02540       <span class="keywordflow">return</span> NULL;
<a name="l02541"></a>02541 
<a name="l02542"></a>02542    <a class="code" href="rtp_8h.html#ad1235778d2cb1fbe8b1339b43ca3602c" title="Initialize a new RTP structure.">ast_rtp_new_init</a>(rtp);
<a name="l02543"></a>02543 
<a name="l02544"></a>02544    rtp-&gt;<a class="code" href="structast__rtp.html#a339d22b3e442946380f98ed19e320db2">s</a> = <a class="code" href="rtp_8c.html#a55bb1a68c0eb9c45c39ccc4924f8ad12" title="Open RTP or RTCP socket for a session. Print a message on failure.">rtp_socket</a>(<span class="stringliteral">&quot;RTP&quot;</span>);
<a name="l02545"></a>02545    <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a339d22b3e442946380f98ed19e320db2">s</a> &lt; 0)
<a name="l02546"></a>02546       <span class="keywordflow">goto</span> fail;
<a name="l02547"></a>02547    <span class="keywordflow">if</span> (sched &amp;&amp; rtcpenable) {
<a name="l02548"></a>02548       rtp-&gt;<a class="code" href="structast__rtp.html#aea6233539fc73fc5303bf7525ec27e73">sched</a> = sched;
<a name="l02549"></a>02549       rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a> = <a class="code" href="rtp_8c.html#a0acdf171f7e8718a377fa0c0a5125455" title="Initialize a new RTCP session.">ast_rtcp_new</a>();
<a name="l02550"></a>02550    }
<a name="l02551"></a>02551    
<a name="l02552"></a>02552    <span class="comment">/*</span>
<a name="l02553"></a>02553 <span class="comment">    * Try to bind the RTP port, x, and possibly the RTCP port, x+1 as well.</span>
<a name="l02554"></a>02554 <span class="comment">    * Start from a random (even, by RTP spec) port number, and</span>
<a name="l02555"></a>02555 <span class="comment">    * iterate until success or no ports are available.</span>
<a name="l02556"></a>02556 <span class="comment">    * Note that the requirement of RTP port being even, or RTCP being the</span>
<a name="l02557"></a>02557 <span class="comment">    * next one, cannot be enforced in presence of a NAT box because the</span>
<a name="l02558"></a>02558 <span class="comment">    * mapping is not under our control.</span>
<a name="l02559"></a>02559 <span class="comment">    */</span>
<a name="l02560"></a>02560    x = (<a class="code" href="rtp_8c.html#a4b0895b04a97fb8d38e0f15dfed4c9e0">rtpend</a> == <a class="code" href="rtp_8c.html#aa3d9ba5adbb6566211600f0ab4a027c7">rtpstart</a>) ? <a class="code" href="rtp_8c.html#aa3d9ba5adbb6566211600f0ab4a027c7">rtpstart</a> : (<a class="code" href="utils_8h.html#a7b4f10b070e95ba413e258a3e4b03c20">ast_random</a>() % (<a class="code" href="rtp_8c.html#a4b0895b04a97fb8d38e0f15dfed4c9e0">rtpend</a> - <a class="code" href="rtp_8c.html#aa3d9ba5adbb6566211600f0ab4a027c7">rtpstart</a>)) + <a class="code" href="rtp_8c.html#aa3d9ba5adbb6566211600f0ab4a027c7">rtpstart</a>;
<a name="l02561"></a>02561    x = x &amp; ~1;    <span class="comment">/* make it an even number */</span>
<a name="l02562"></a>02562    startplace = x;      <span class="comment">/* remember the starting point */</span>
<a name="l02563"></a>02563    <span class="comment">/* this is constant across the loop */</span>
<a name="l02564"></a>02564    rtp-&gt;<a class="code" href="structast__rtp.html#a3c2346010ce32cf02b7c85203c76a20d">us</a>.sin_addr = addr;
<a name="l02565"></a>02565    <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>)
<a name="l02566"></a>02566       rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a3c2346010ce32cf02b7c85203c76a20d">us</a>.sin_addr = addr;
<a name="l02567"></a>02567    <span class="keywordflow">for</span> (;;) {
<a name="l02568"></a>02568       rtp-&gt;<a class="code" href="structast__rtp.html#a3c2346010ce32cf02b7c85203c76a20d">us</a>.sin_port = htons(x);
<a name="l02569"></a>02569       <span class="keywordflow">if</span> (!bind(rtp-&gt;<a class="code" href="structast__rtp.html#a339d22b3e442946380f98ed19e320db2">s</a>, (<span class="keyword">struct</span> sockaddr *)&amp;rtp-&gt;<a class="code" href="structast__rtp.html#a3c2346010ce32cf02b7c85203c76a20d">us</a>, <span class="keyword">sizeof</span>(rtp-&gt;<a class="code" href="structast__rtp.html#a3c2346010ce32cf02b7c85203c76a20d">us</a>))) {
<a name="l02570"></a>02570          <span class="comment">/* bind succeeded, if no rtcp then we are done */</span>
<a name="l02571"></a>02571          <span class="keywordflow">if</span> (!rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>)
<a name="l02572"></a>02572             <span class="keywordflow">break</span>;
<a name="l02573"></a>02573          <span class="comment">/* have rtcp, try to bind it */</span>
<a name="l02574"></a>02574          rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a3c2346010ce32cf02b7c85203c76a20d">us</a>.sin_port = htons(x + 1);
<a name="l02575"></a>02575          <span class="keywordflow">if</span> (!bind(rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a339d22b3e442946380f98ed19e320db2">s</a>, (<span class="keyword">struct</span> sockaddr *)&amp;rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a3c2346010ce32cf02b7c85203c76a20d">us</a>, <span class="keyword">sizeof</span>(rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a3c2346010ce32cf02b7c85203c76a20d">us</a>)))
<a name="l02576"></a>02576             <span class="keywordflow">break</span>;   <span class="comment">/* success again, we are really done */</span>
<a name="l02577"></a>02577          <span class="comment">/*</span>
<a name="l02578"></a>02578 <span class="comment">          * RTCP bind failed, so close and recreate the</span>
<a name="l02579"></a>02579 <span class="comment">          * already bound RTP socket for the next round.</span>
<a name="l02580"></a>02580 <span class="comment">          */</span>
<a name="l02581"></a>02581          close(rtp-&gt;<a class="code" href="structast__rtp.html#a339d22b3e442946380f98ed19e320db2">s</a>);
<a name="l02582"></a>02582          rtp-&gt;<a class="code" href="structast__rtp.html#a339d22b3e442946380f98ed19e320db2">s</a> = <a class="code" href="rtp_8c.html#a55bb1a68c0eb9c45c39ccc4924f8ad12" title="Open RTP or RTCP socket for a session. Print a message on failure.">rtp_socket</a>(<span class="stringliteral">&quot;RTP&quot;</span>);
<a name="l02583"></a>02583          <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a339d22b3e442946380f98ed19e320db2">s</a> &lt; 0)
<a name="l02584"></a>02584             <span class="keywordflow">goto</span> fail;
<a name="l02585"></a>02585       }
<a name="l02586"></a>02586       <span class="comment">/*</span>
<a name="l02587"></a>02587 <span class="comment">       * If we get here, there was an error in one of the bind()</span>
<a name="l02588"></a>02588 <span class="comment">       * calls, so make sure it is nothing unexpected.</span>
<a name="l02589"></a>02589 <span class="comment">       */</span>
<a name="l02590"></a>02590       <span class="keywordflow">if</span> (errno != EADDRINUSE) {
<a name="l02591"></a>02591          <span class="comment">/* We got an error that wasn&apos;t expected, abort! */</span>
<a name="l02592"></a>02592          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unexpected bind error: %s\n&quot;</span>, strerror(errno));
<a name="l02593"></a>02593          <span class="keywordflow">goto</span> fail;
<a name="l02594"></a>02594       }
<a name="l02595"></a>02595       <span class="comment">/*</span>
<a name="l02596"></a>02596 <span class="comment">       * One of the ports is in use. For the next iteration,</span>
<a name="l02597"></a>02597 <span class="comment">       * increment by two and handle wraparound.</span>
<a name="l02598"></a>02598 <span class="comment">       * If we reach the starting point, then declare failure.</span>
<a name="l02599"></a>02599 <span class="comment">       */</span>
<a name="l02600"></a>02600       x += 2;
<a name="l02601"></a>02601       <span class="keywordflow">if</span> (x &gt; <a class="code" href="rtp_8c.html#a4b0895b04a97fb8d38e0f15dfed4c9e0">rtpend</a>)
<a name="l02602"></a>02602          x = (<a class="code" href="rtp_8c.html#aa3d9ba5adbb6566211600f0ab4a027c7">rtpstart</a> + 1) &amp; ~1;
<a name="l02603"></a>02603       <span class="keywordflow">if</span> (x == startplace) {
<a name="l02604"></a>02604          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No RTP ports remaining. Can&apos;t setup media stream for this call.\n&quot;</span>);
<a name="l02605"></a>02605          <span class="keywordflow">goto</span> fail;
<a name="l02606"></a>02606       }
<a name="l02607"></a>02607    }
<a name="l02608"></a>02608    rtp-&gt;<a class="code" href="structast__rtp.html#aea6233539fc73fc5303bf7525ec27e73">sched</a> = sched;
<a name="l02609"></a>02609    rtp-&gt;<a class="code" href="structast__rtp.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a> = io;
<a name="l02610"></a>02610    <span class="keywordflow">if</span> (callbackmode) {
<a name="l02611"></a>02611       rtp-&gt;<a class="code" href="structast__rtp.html#a378e4ecae74acafadf99a691f65f2419">ioid</a> = <a class="code" href="io_8h.html#aa250c3f6541dc5734deb966d6821da7a" title="Adds an IO context.">ast_io_add</a>(rtp-&gt;<a class="code" href="structast__rtp.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a>, rtp-&gt;<a class="code" href="structast__rtp.html#a339d22b3e442946380f98ed19e320db2">s</a>, <a class="code" href="rtp_8c.html#acc27c454a55b589c7a228a8d78542db3">rtpread</a>, <a class="code" href="io_8h.html#a0d9e01f215782a343a1b71b5be362080">AST_IO_IN</a>, rtp);
<a name="l02612"></a>02612       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(rtp, <a class="code" href="rtp_8c.html#ae8197382d4f12048520dcba52cd1461c">FLAG_CALLBACK_MODE</a>);
<a name="l02613"></a>02613    }
<a name="l02614"></a>02614    <a class="code" href="rtp_8h.html#af9ebff17643c46897280902ccd33ff40" title="Set payload types to defaults.">ast_rtp_pt_default</a>(rtp);
<a name="l02615"></a>02615    <span class="keywordflow">return</span> rtp;
<a name="l02616"></a>02616 
<a name="l02617"></a>02617 fail:
<a name="l02618"></a>02618    <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a339d22b3e442946380f98ed19e320db2">s</a> &gt;= 0)
<a name="l02619"></a>02619       close(rtp-&gt;<a class="code" href="structast__rtp.html#a339d22b3e442946380f98ed19e320db2">s</a>);
<a name="l02620"></a>02620    <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>) {
<a name="l02621"></a>02621       close(rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a339d22b3e442946380f98ed19e320db2">s</a>);
<a name="l02622"></a>02622       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>);
<a name="l02623"></a>02623    }
<a name="l02624"></a>02624    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(rtp);
<a name="l02625"></a>02625    <span class="keywordflow">return</span> NULL;
<a name="l02626"></a>02626 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a00b94396faf3f52b0c3ea612a9af334d"></a><!-- doxytag: member="rtp.h::ast_rtp_proto_register" ref="a00b94396faf3f52b0c3ea612a9af334d" args="(struct ast_rtp_protocol *proto)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_rtp_proto_register </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp__protocol.html">ast_rtp_protocol</a> *&nbsp;</td>
          <td class="paramname"> <em>proto</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Register an RTP channel client. </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l03896">3896</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="linkedlists_8h_source.html#l00702">AST_RWLIST_INSERT_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="structast__rtp__protocol.html#a469dabffbf9f8b4a86b7360069260aef">ast_rtp_protocol::list</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="rtp_8h_source.html#l00105">ast_rtp_protocol::type</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l02033">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03897"></a>03897 {
<a name="l03898"></a>03898    <span class="keyword">struct </span><a class="code" href="structast__rtp__protocol.html" title="This is the structure that binds a channel (SIP/Jingle/H.323) to the RTP subsystem...">ast_rtp_protocol</a> *cur;
<a name="l03899"></a>03899 
<a name="l03900"></a>03900    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structprotos.html" title="List of current sessions.">protos</a>);
<a name="l03901"></a>03901    <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="structprotos.html" title="List of current sessions.">protos</a>, cur, <a class="code" href="structast__rtp__protocol.html#a469dabffbf9f8b4a86b7360069260aef">list</a>) { 
<a name="l03902"></a>03902       <span class="keywordflow">if</span> (!strcmp(cur-&gt;<a class="code" href="structast__rtp__protocol.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>, proto-&gt;<a class="code" href="structast__rtp__protocol.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>)) {
<a name="l03903"></a>03903          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Tried to register same protocol &apos;%s&apos; twice\n&quot;</span>, cur-&gt;<a class="code" href="structast__rtp__protocol.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>);
<a name="l03904"></a>03904          <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structprotos.html" title="List of current sessions.">protos</a>);
<a name="l03905"></a>03905          <span class="keywordflow">return</span> -1;
<a name="l03906"></a>03906       }
<a name="l03907"></a>03907    }
<a name="l03908"></a>03908    <a class="code" href="linkedlists_8h.html#aacc5f6b7c25e361d11d40137fd55a8e8">AST_RWLIST_INSERT_HEAD</a>(&amp;<a class="code" href="structprotos.html" title="List of current sessions.">protos</a>, proto, <a class="code" href="structast__rtp__protocol.html#a469dabffbf9f8b4a86b7360069260aef">list</a>);
<a name="l03909"></a>03909    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structprotos.html" title="List of current sessions.">protos</a>);
<a name="l03910"></a>03910    
<a name="l03911"></a>03911    <span class="keywordflow">return</span> 0;
<a name="l03912"></a>03912 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a39d797fe6097e914323998f72b13420c"></a><!-- doxytag: member="rtp.h::ast_rtp_proto_unregister" ref="a39d797fe6097e914323998f72b13420c" args="(struct ast_rtp_protocol *proto)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_rtp_proto_unregister </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp__protocol.html">ast_rtp_protocol</a> *&nbsp;</td>
          <td class="paramname"> <em>proto</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Unregister an RTP channel client. </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l03888">3888</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00860">AST_RWLIST_REMOVE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, and <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l03222">load_module()</a>, and <a class="el" href="chan__gtalk_8c_source.html#l02084">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03889"></a>03889 {
<a name="l03890"></a>03890    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structprotos.html" title="List of current sessions.">protos</a>);
<a name="l03891"></a>03891    <a class="code" href="linkedlists_8h.html#a6091f0518f8b6f443fd9f5150f3ac407">AST_RWLIST_REMOVE</a>(&amp;<a class="code" href="structprotos.html" title="List of current sessions.">protos</a>, proto, <a class="code" href="structast__rtp__protocol.html#a469dabffbf9f8b4a86b7360069260aef">list</a>);
<a name="l03892"></a>03892    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structprotos.html" title="List of current sessions.">protos</a>);
<a name="l03893"></a>03893 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac008cc5d5e4b915062b98ff2f202cc38"></a><!-- doxytag: member="rtp.h::ast_rtp_pt_clear" ref="ac008cc5d5e4b915062b98ff2f202cc38" args="(struct ast_rtp *rtp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_rtp_pt_clear </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Setting RTP payload types from lines in a SDP description:. </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l01995">1995</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8h_source.html#l00090">rtpPayloadType::code</a>, <a class="el" href="rtp_8c_source.html#l00166">ast_rtp::current_RTP_PT</a>, <a class="el" href="rtp_8h_source.html#l00089">rtpPayloadType::isAstFormat</a>, <a class="el" href="rtp_8h_source.html#l00052">MAX_RTP_PT</a>, <a class="el" href="rtp_8c_source.html#l00826">rtp_bridge_lock()</a>, <a class="el" href="rtp_8c_source.html#l00834">rtp_bridge_unlock()</a>, <a class="el" href="rtp_8c_source.html#l00168">ast_rtp::rtp_lookup_code_cache_code</a>, <a class="el" href="rtp_8c_source.html#l00167">ast_rtp::rtp_lookup_code_cache_isAstFormat</a>, and <a class="el" href="rtp_8c_source.html#l00169">ast_rtp::rtp_lookup_code_cache_result</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l00909">gtalk_alloc()</a>, and <a class="el" href="chan__mgcp_8c_source.html#l01838">process_sdp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01996"></a>01996 {
<a name="l01997"></a>01997    <span class="keywordtype">int</span> i;
<a name="l01998"></a>01998 
<a name="l01999"></a>01999    <span class="keywordflow">if</span> (!rtp)
<a name="l02000"></a>02000       <span class="keywordflow">return</span>;
<a name="l02001"></a>02001 
<a name="l02002"></a>02002    <a class="code" href="rtp_8c.html#a67f38276600b7655f400f5b6c6118f8b">rtp_bridge_lock</a>(rtp);
<a name="l02003"></a>02003 
<a name="l02004"></a>02004    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="rtp_8h.html#ac8aa85cd14ebbc20fc0043f6f72b968d">MAX_RTP_PT</a>; ++i) {
<a name="l02005"></a>02005       rtp-&gt;<a class="code" href="structast__rtp.html#a326c376c0e9d4d7572cc3706205dbd01">current_RTP_PT</a>[i].<a class="code" href="structrtpPayloadType.html#a6916911180850cb1b6045fa9b6927b02">isAstFormat</a> = 0;
<a name="l02006"></a>02006       rtp-&gt;<a class="code" href="structast__rtp.html#a326c376c0e9d4d7572cc3706205dbd01">current_RTP_PT</a>[i].<a class="code" href="structrtpPayloadType.html#a45a5b7c00a796a23f01673cef1dbe0a9">code</a> = 0;
<a name="l02007"></a>02007    }
<a name="l02008"></a>02008 
<a name="l02009"></a>02009    rtp-&gt;<a class="code" href="structast__rtp.html#ab087642ddcdd0db71470c90429925385">rtp_lookup_code_cache_isAstFormat</a> = 0;
<a name="l02010"></a>02010    rtp-&gt;<a class="code" href="structast__rtp.html#aaf7a119e1a2e85949f9340b0a63f9c4c">rtp_lookup_code_cache_code</a> = 0;
<a name="l02011"></a>02011    rtp-&gt;<a class="code" href="structast__rtp.html#a7c7662b43c622f94d684c20139efc983">rtp_lookup_code_cache_result</a> = 0;
<a name="l02012"></a>02012 
<a name="l02013"></a>02013    <a class="code" href="rtp_8c.html#afabb78b03298d9f7b7e26b60ad0d02e4">rtp_bridge_unlock</a>(rtp);
<a name="l02014"></a>02014 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a30cfc736f18627e5d0d25196a116faa1"></a><!-- doxytag: member="rtp.h::ast_rtp_pt_copy" ref="a30cfc736f18627e5d0d25196a116faa1" args="(struct ast_rtp *dest, struct ast_rtp *src)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_rtp_pt_copy </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>src</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Copy payload types between RTP structures. </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l02035">2035</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8h_source.html#l00090">rtpPayloadType::code</a>, <a class="el" href="rtp_8c_source.html#l00166">ast_rtp::current_RTP_PT</a>, <a class="el" href="rtp_8h_source.html#l00089">rtpPayloadType::isAstFormat</a>, <a class="el" href="rtp_8h_source.html#l00052">MAX_RTP_PT</a>, <a class="el" href="rtp_8c_source.html#l00826">rtp_bridge_lock()</a>, <a class="el" href="rtp_8c_source.html#l00834">rtp_bridge_unlock()</a>, <a class="el" href="rtp_8c_source.html#l00168">ast_rtp::rtp_lookup_code_cache_code</a>, <a class="el" href="rtp_8c_source.html#l00167">ast_rtp::rtp_lookup_code_cache_isAstFormat</a>, and <a class="el" href="rtp_8c_source.html#l00169">ast_rtp::rtp_lookup_code_cache_result</a>.</p>

<p>Referenced by <a class="el" href="rtp_8c_source.html#l02157">ast_rtp_make_compatible()</a>, and <a class="el" href="chan__sip_8c_source.html#l08040">process_sdp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02036"></a>02036 {
<a name="l02037"></a>02037    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
<a name="l02038"></a>02038 
<a name="l02039"></a>02039    <a class="code" href="rtp_8c.html#a67f38276600b7655f400f5b6c6118f8b">rtp_bridge_lock</a>(dest);
<a name="l02040"></a>02040    <a class="code" href="rtp_8c.html#a67f38276600b7655f400f5b6c6118f8b">rtp_bridge_lock</a>(src);
<a name="l02041"></a>02041 
<a name="l02042"></a>02042    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="rtp_8h.html#ac8aa85cd14ebbc20fc0043f6f72b968d">MAX_RTP_PT</a>; ++i) {
<a name="l02043"></a>02043       dest-&gt;<a class="code" href="structast__rtp.html#a326c376c0e9d4d7572cc3706205dbd01">current_RTP_PT</a>[i].<a class="code" href="structrtpPayloadType.html#a6916911180850cb1b6045fa9b6927b02">isAstFormat</a> = 
<a name="l02044"></a>02044          src-&gt;<a class="code" href="structast__rtp.html#a326c376c0e9d4d7572cc3706205dbd01">current_RTP_PT</a>[i].<a class="code" href="structrtpPayloadType.html#a6916911180850cb1b6045fa9b6927b02">isAstFormat</a>;
<a name="l02045"></a>02045       dest-&gt;<a class="code" href="structast__rtp.html#a326c376c0e9d4d7572cc3706205dbd01">current_RTP_PT</a>[i].<a class="code" href="structrtpPayloadType.html#a45a5b7c00a796a23f01673cef1dbe0a9">code</a> = 
<a name="l02046"></a>02046          src-&gt;<a class="code" href="structast__rtp.html#a326c376c0e9d4d7572cc3706205dbd01">current_RTP_PT</a>[i].<a class="code" href="structrtpPayloadType.html#a45a5b7c00a796a23f01673cef1dbe0a9">code</a>; 
<a name="l02047"></a>02047    }
<a name="l02048"></a>02048    dest-&gt;<a class="code" href="structast__rtp.html#ab087642ddcdd0db71470c90429925385">rtp_lookup_code_cache_isAstFormat</a> = 0;
<a name="l02049"></a>02049    dest-&gt;<a class="code" href="structast__rtp.html#aaf7a119e1a2e85949f9340b0a63f9c4c">rtp_lookup_code_cache_code</a> = 0;
<a name="l02050"></a>02050    dest-&gt;<a class="code" href="structast__rtp.html#a7c7662b43c622f94d684c20139efc983">rtp_lookup_code_cache_result</a> = 0;
<a name="l02051"></a>02051 
<a name="l02052"></a>02052    <a class="code" href="rtp_8c.html#afabb78b03298d9f7b7e26b60ad0d02e4">rtp_bridge_unlock</a>(src);
<a name="l02053"></a>02053    <a class="code" href="rtp_8c.html#afabb78b03298d9f7b7e26b60ad0d02e4">rtp_bridge_unlock</a>(dest);
<a name="l02054"></a>02054 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af9ebff17643c46897280902ccd33ff40"></a><!-- doxytag: member="rtp.h::ast_rtp_pt_default" ref="af9ebff17643c46897280902ccd33ff40" args="(struct ast_rtp *rtp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_rtp_pt_default </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set payload types to defaults. </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l02016">2016</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8h_source.html#l00090">rtpPayloadType::code</a>, <a class="el" href="rtp_8c_source.html#l00166">ast_rtp::current_RTP_PT</a>, <a class="el" href="rtp_8h_source.html#l00089">rtpPayloadType::isAstFormat</a>, <a class="el" href="rtp_8h_source.html#l00052">MAX_RTP_PT</a>, <a class="el" href="rtp_8c_source.html#l00826">rtp_bridge_lock()</a>, <a class="el" href="rtp_8c_source.html#l00834">rtp_bridge_unlock()</a>, <a class="el" href="rtp_8c_source.html#l00168">ast_rtp::rtp_lookup_code_cache_code</a>, <a class="el" href="rtp_8c_source.html#l00167">ast_rtp::rtp_lookup_code_cache_isAstFormat</a>, and <a class="el" href="rtp_8c_source.html#l00169">ast_rtp::rtp_lookup_code_cache_result</a>.</p>

<p>Referenced by <a class="el" href="rtp_8c_source.html#l02533">ast_rtp_new_with_bindaddr()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02017"></a>02017 {
<a name="l02018"></a>02018    <span class="keywordtype">int</span> i;
<a name="l02019"></a>02019 
<a name="l02020"></a>02020    <a class="code" href="rtp_8c.html#a67f38276600b7655f400f5b6c6118f8b">rtp_bridge_lock</a>(rtp);
<a name="l02021"></a>02021 
<a name="l02022"></a>02022    <span class="comment">/* Initialize to default payload types */</span>
<a name="l02023"></a>02023    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="rtp_8h.html#ac8aa85cd14ebbc20fc0043f6f72b968d">MAX_RTP_PT</a>; ++i) {
<a name="l02024"></a>02024       rtp-&gt;<a class="code" href="structast__rtp.html#a326c376c0e9d4d7572cc3706205dbd01">current_RTP_PT</a>[i].<a class="code" href="structrtpPayloadType.html#a6916911180850cb1b6045fa9b6927b02">isAstFormat</a> = <a class="code" href="rtp_8c.html#aee0ddbbc121110ad6d1d3342eddec5f2" title="Mapping between Asterisk codecs and rtp payload types.">static_RTP_PT</a>[i].<a class="code" href="structrtpPayloadType.html#a6916911180850cb1b6045fa9b6927b02">isAstFormat</a>;
<a name="l02025"></a>02025       rtp-&gt;<a class="code" href="structast__rtp.html#a326c376c0e9d4d7572cc3706205dbd01">current_RTP_PT</a>[i].<a class="code" href="structrtpPayloadType.html#a45a5b7c00a796a23f01673cef1dbe0a9">code</a> = <a class="code" href="rtp_8c.html#aee0ddbbc121110ad6d1d3342eddec5f2" title="Mapping between Asterisk codecs and rtp payload types.">static_RTP_PT</a>[i].<a class="code" href="structrtpPayloadType.html#a45a5b7c00a796a23f01673cef1dbe0a9">code</a>;
<a name="l02026"></a>02026    }
<a name="l02027"></a>02027 
<a name="l02028"></a>02028    rtp-&gt;<a class="code" href="structast__rtp.html#ab087642ddcdd0db71470c90429925385">rtp_lookup_code_cache_isAstFormat</a> = 0;
<a name="l02029"></a>02029    rtp-&gt;<a class="code" href="structast__rtp.html#aaf7a119e1a2e85949f9340b0a63f9c4c">rtp_lookup_code_cache_code</a> = 0;
<a name="l02030"></a>02030    rtp-&gt;<a class="code" href="structast__rtp.html#a7c7662b43c622f94d684c20139efc983">rtp_lookup_code_cache_result</a> = 0;
<a name="l02031"></a>02031 
<a name="l02032"></a>02032    <a class="code" href="rtp_8c.html#afabb78b03298d9f7b7e26b60ad0d02e4">rtp_bridge_unlock</a>(rtp);
<a name="l02033"></a>02033 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac0a9d31f175e3de83fa1dda629c11674"></a><!-- doxytag: member="rtp.h::ast_rtp_read" ref="ac0a9d31f175e3de83fa1dda629c11674" args="(struct ast_rtp *rtp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__frame.html">ast_frame</a>* ast_rtp_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rtp_8c_source.html#l01562">1562</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l00149">ast_rtp::altthem</a>, <a class="el" href="utils_8h_source.html#l00678">ast_assert</a>, <a class="el" href="frame_8c_source.html#l01431">ast_codec_get_samples()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8h_source.html#l00273">AST_FORMAT_AUDIO_MASK</a>, <a class="el" href="frame_8h_source.html#l00680">ast_format_rate()</a>, <a class="el" href="frame_8h_source.html#l00253">AST_FORMAT_SLINEAR</a>, <a class="el" href="frame_8h_source.html#l00292">AST_FORMAT_T140</a>, <a class="el" href="frame_8h_source.html#l00290">AST_FORMAT_T140RED</a>, <a class="el" href="frame_8h_source.html#l00288">AST_FORMAT_VIDEO_MASK</a>, <a class="el" href="frame_8h_source.html#l00495">ast_frame_byteswap_be</a>, <a class="el" href="frame_8h_source.html#l00099">AST_FRAME_DTMF_END</a>, <a class="el" href="frame_8h_source.html#l00111">AST_FRAME_TEXT</a>, <a class="el" href="frame_8h_source.html#l00103">AST_FRAME_VIDEO</a>, <a class="el" href="frame_8h_source.html#l00101">AST_FRAME_VOICE</a>, <a class="el" href="frame_8h_source.html#l00128">AST_FRFLAG_HAS_TIMING_INFO</a>, <a class="el" href="frame_8h_source.html#l00203">AST_FRIENDLY_OFFSET</a>, <a class="el" href="utils_8c_source.html#l00431">ast_inet_ntoa()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="frame_8c_source.html#l00124">ast_null_frame</a>, <a class="el" href="rtp_8c_source.html#l00735">ast_rtcp_calc_interval()</a>, <a class="el" href="rtp_8c_source.html#l03557">ast_rtcp_write()</a>, <a class="el" href="rtp_8h_source.html#l00047">AST_RTP_CISCO_DTMF</a>, <a class="el" href="rtp_8h_source.html#l00045">AST_RTP_CN</a>, <a class="el" href="rtp_8h_source.html#l00043">AST_RTP_DTMF</a>, <a class="el" href="rtp_8c_source.html#l02699">ast_rtp_get_bridged()</a>, <a class="el" href="rtp_8c_source.html#l02338">ast_rtp_lookup_pt()</a>, <a class="el" href="rtp_8c_source.html#l03206">ast_rtp_senddigit_continuation()</a>, <a class="el" href="time_8h_source.html#l00176">ast_samp2tv()</a>, <a class="el" href="sched_8c_source.html#l00439">ast_sched_add()</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="time_8h_source.html#l00164">ast_tv()</a>, <a class="el" href="time_8h_source.html#l00089">ast_tvdiff_ms()</a>, <a class="el" href="logger_8h_source.html#l00079">ast_verbose</a>, <a class="el" href="rtp_8c_source.html#l01508">bridge_p2p_rtp_write()</a>, <a class="el" href="rtp_8c_source.html#l00172">ast_rtp::bridged</a>, <a class="el" href="rtp_8c_source.html#l01453">calc_rxstamp()</a>, <a class="el" href="rtp_8h_source.html#l00090">rtpPayloadType::code</a>, <a class="el" href="rtp_8c_source.html#l00123">ast_rtp::cycles</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="frame_8h_source.html#l00147">ast_frame::datalen</a>, <a class="el" href="frame_8h_source.html#l00161">ast_frame::delivery</a>, <a class="el" href="rtp_8c_source.html#l00136">ast_rtp::dtmf_duration</a>, <a class="el" href="rtp_8c_source.html#l00137">ast_rtp::dtmf_timeout</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="http_8c_source.html#l00097">ext</a>, <a class="el" href="rtp_8c_source.html#l00104">ast_rtp::f</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="rtp_8c_source.html#l00210">FLAG_NAT_ACTIVE</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="rtp_8h_source.html#l00089">rtpPayloadType::isAstFormat</a>, <a class="el" href="rtp_8c_source.html#l00135">ast_rtp::lastevent</a>, <a class="el" href="rtp_8c_source.html#l00113">ast_rtp::lastitexttimestamp</a>, <a class="el" href="rtp_8c_source.html#l00111">ast_rtp::lastividtimestamp</a>, <a class="el" href="rtp_8c_source.html#l00127">ast_rtp::lastrxformat</a>, <a class="el" href="rtp_8c_source.html#l00116">ast_rtp::lastrxseqno</a>, <a class="el" href="rtp_8c_source.html#l00110">ast_rtp::lastrxts</a>, <a class="el" href="frame_8h_source.html#l00169">ast_frame::len</a>, <a class="el" href="func__strings_8c_source.html#l00821">len()</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="frame_8h_source.html#l00151">ast_frame::mallocd</a>, <a class="el" href="rtp_8c_source.html#l00145">ast_rtp::nat</a>, <a class="el" href="frame_8h_source.html#l00155">ast_frame::offset</a>, <a class="el" href="asterisk_8c_source.html#l00175">option_debug</a>, <a class="el" href="rtp_8c_source.html#l00923">process_cisco_dtmf()</a>, <a class="el" href="rtp_8c_source.html#l01013">process_rfc2833()</a>, <a class="el" href="rtp_8c_source.html#l01120">process_rfc3389()</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::ptr</a>, <a class="el" href="rtp_8c_source.html#l00105">ast_rtp::rawdata</a>, <a class="el" href="rtp_8c_source.html#l00134">ast_rtp::resp</a>, <a class="el" href="rtp_8c_source.html#l00170">ast_rtp::rtcp</a>, <a class="el" href="rtp_8c_source.html#l00896">rtp_debug_test_addr()</a>, <a class="el" href="rtp_8c_source.html#l00730">rtp_get_rate()</a>, <a class="el" href="rtp_8c_source.html#l00053">RTP_SEQ_MOD</a>, <a class="el" href="rtp_8c_source.html#l00119">ast_rtp::rxcount</a>, <a class="el" href="rtp_8c_source.html#l00158">ast_rtp::rxseqno</a>, <a class="el" href="rtp_8c_source.html#l00108">ast_rtp::rxssrc</a>, <a class="el" href="rtp_8c_source.html#l00103">ast_rtp::s</a>, <a class="el" href="frame_8h_source.html#l00149">ast_frame::samples</a>, <a class="el" href="rtp_8c_source.html#l00159">ast_rtp::sched</a>, <a class="el" href="rtp_8c_source.html#l00243">ast_rtcp::schedid</a>, <a class="el" href="rtp_8c_source.html#l00117">ast_rtp::seedrxseqno</a>, <a class="el" href="rtp_8c_source.html#l00871">send_dtmf()</a>, <a class="el" href="rtp_8c_source.html#l00141">ast_rtp::sending_digit</a>, <a class="el" href="frame_8h_source.html#l00171">ast_frame::seqno</a>, <a class="el" href="frame_8h_source.html#l00157">ast_frame::src</a>, <a class="el" href="rtp_8c_source.html#l00175">ast_rtp::strict_rtp_address</a>, <a class="el" href="rtp_8c_source.html#l00088">STRICT_RTP_CLOSED</a>, <a class="el" href="rtp_8c_source.html#l00087">STRICT_RTP_LEARN</a>, <a class="el" href="rtp_8c_source.html#l00174">ast_rtp::strict_rtp_state</a>, <a class="el" href="rtp_8c_source.html#l00339">STUN_ACCEPT</a>, <a class="el" href="rtp_8c_source.html#l00510">stun_handle_packet()</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, <a class="el" href="rtp_8c_source.html#l00234">ast_rtcp::them</a>, <a class="el" href="rtp_8c_source.html#l00148">ast_rtp::them</a>, <a class="el" href="rtp_8c_source.html#l00107">ast_rtp::themssrc</a>, <a class="el" href="frame_8h_source.html#l00167">ast_frame::ts</a>, and <a class="el" href="res__config__ldap_8c_source.html#l00071">version</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l01385">gtalk_rtp_read()</a>, <a class="el" href="chan__jingle_8c_source.html#l01167">jingle_rtp_read()</a>, <a class="el" href="chan__mgcp_8c_source.html#l01202">mgcp_rtp_read()</a>, <a class="el" href="chan__h323_8c_source.html#l00748">oh323_rtp_read()</a>, <a class="el" href="rtp_8c_source.html#l01156">rtpread()</a>, <a class="el" href="chan__sip_8c_source.html#l06955">sip_rtp_read()</a>, <a class="el" href="chan__skinny_8c_source.html#l03907">skinny_rtp_read()</a>, and <a class="el" href="chan__unistim_8c_source.html#l03905">unistim_rtp_read()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01563"></a>01563 {
<a name="l01564"></a>01564    <span class="keywordtype">int</span> res;
<a name="l01565"></a>01565    <span class="keyword">struct </span>sockaddr_in sock_in;
<a name="l01566"></a>01566    socklen_t <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;
<a name="l01567"></a>01567    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> seqno;
<a name="l01568"></a>01568    <span class="keywordtype">int</span> <a class="code" href="res__config__ldap_8c.html#aad880fc4455c253781e8968f2239d56f">version</a>;
<a name="l01569"></a>01569    <span class="keywordtype">int</span> payloadtype;
<a name="l01570"></a>01570    <span class="keywordtype">int</span> hdrlen = 12;
<a name="l01571"></a>01571    <span class="keywordtype">int</span> padding;
<a name="l01572"></a>01572    <span class="keywordtype">int</span> mark;
<a name="l01573"></a>01573    <span class="keywordtype">int</span> <a class="code" href="http_8c.html#af9b32121c4ad80b0887a3d73fd24de5f">ext</a>;
<a name="l01574"></a>01574    <span class="keywordtype">int</span> cc;
<a name="l01575"></a>01575    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ssrc;
<a name="l01576"></a>01576    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> timestamp;
<a name="l01577"></a>01577    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *rtpheader;
<a name="l01578"></a>01578    <span class="keyword">struct </span><a class="code" href="structrtpPayloadType.html" title="The value of each payload format mapping:.">rtpPayloadType</a> rtpPT;
<a name="l01579"></a>01579    <span class="keyword">struct </span><a class="code" href="structast__rtp.html" title="Structure representing a RTP session.">ast_rtp</a> *<a class="code" href="structast__rtp.html#a22611fd046dd9e42a34b4a6e3ace0069">bridged</a> = NULL;
<a name="l01580"></a>01580    <span class="keywordtype">int</span> prev_seqno;
<a name="l01581"></a>01581    
<a name="l01582"></a>01582    <span class="comment">/* If time is up, kill it */</span>
<a name="l01583"></a>01583    <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#af637078f896cfd75467174c20d0cb217">sending_digit</a>)
<a name="l01584"></a>01584       <a class="code" href="rtp_8c.html#acfdeaf8e752856ad7b49174eee6e9fea" title="Send continuation frame for DTMF.">ast_rtp_senddigit_continuation</a>(rtp);
<a name="l01585"></a>01585 
<a name="l01586"></a>01586    len = <span class="keyword">sizeof</span>(sock_in);
<a name="l01587"></a>01587    
<a name="l01588"></a>01588    <span class="comment">/* Cache where the header will go */</span>
<a name="l01589"></a>01589    res = recvfrom(rtp-&gt;<a class="code" href="structast__rtp.html#a339d22b3e442946380f98ed19e320db2">s</a>, rtp-&gt;<a class="code" href="structast__rtp.html#a8af53bd0e8b4f1e9275d51d2a4065991">rawdata</a> + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>, <span class="keyword">sizeof</span>(rtp-&gt;<a class="code" href="structast__rtp.html#a8af53bd0e8b4f1e9275d51d2a4065991">rawdata</a>) - <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>,
<a name="l01590"></a>01590                0, (<span class="keyword">struct</span> sockaddr *)&amp;sock_in, &amp;len);
<a name="l01591"></a>01591 
<a name="l01592"></a>01592    <span class="comment">/* If strict RTP protection is enabled see if we need to learn this address or if the packet should be dropped */</span>
<a name="l01593"></a>01593    <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a64730d554c32f13303a5a19f39cbd826">strict_rtp_state</a> == <a class="code" href="rtp_8c.html#aca6484d75ee9d79a5d4447149f9c8c4ba0c26c1144bb830775979deb20e049368">STRICT_RTP_LEARN</a>) {
<a name="l01594"></a>01594       <span class="comment">/* Copy over address that this packet was received on */</span>
<a name="l01595"></a>01595       memcpy(&amp;rtp-&gt;<a class="code" href="structast__rtp.html#a4953f3ad9f3006fa1cc3b2b19fa19783">strict_rtp_address</a>, &amp;sock_in, <span class="keyword">sizeof</span>(rtp-&gt;<a class="code" href="structast__rtp.html#a4953f3ad9f3006fa1cc3b2b19fa19783">strict_rtp_address</a>));
<a name="l01596"></a>01596       <span class="comment">/* Now move over to actually protecting the RTP port */</span>
<a name="l01597"></a>01597       rtp-&gt;<a class="code" href="structast__rtp.html#a64730d554c32f13303a5a19f39cbd826">strict_rtp_state</a> = <a class="code" href="rtp_8c.html#aca6484d75ee9d79a5d4447149f9c8c4baff585ea9a2059021ce5a5f4a7ed8895f">STRICT_RTP_CLOSED</a>;
<a name="l01598"></a>01598       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Learned remote address is %s:%d for strict RTP purposes, now protecting the port.\n&quot;</span>, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(rtp-&gt;<a class="code" href="structast__rtp.html#a4953f3ad9f3006fa1cc3b2b19fa19783">strict_rtp_address</a>.sin_addr), ntohs(rtp-&gt;<a class="code" href="structast__rtp.html#a4953f3ad9f3006fa1cc3b2b19fa19783">strict_rtp_address</a>.sin_port));
<a name="l01599"></a>01599    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a64730d554c32f13303a5a19f39cbd826">strict_rtp_state</a> == <a class="code" href="rtp_8c.html#aca6484d75ee9d79a5d4447149f9c8c4baff585ea9a2059021ce5a5f4a7ed8895f">STRICT_RTP_CLOSED</a>) {
<a name="l01600"></a>01600       <span class="comment">/* If the address we previously learned doesn&apos;t match the address this packet came in on simply drop it */</span>
<a name="l01601"></a>01601       <span class="keywordflow">if</span> ((rtp-&gt;<a class="code" href="structast__rtp.html#a4953f3ad9f3006fa1cc3b2b19fa19783">strict_rtp_address</a>.sin_addr.s_addr != sock_in.sin_addr.s_addr) || (rtp-&gt;<a class="code" href="structast__rtp.html#a4953f3ad9f3006fa1cc3b2b19fa19783">strict_rtp_address</a>.sin_port != sock_in.sin_port)) {
<a name="l01602"></a>01602          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Received RTP packet from %s:%d, dropping due to strict RTP protection. Expected it to be from %s:%d\n&quot;</span>, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(sock_in.sin_addr), ntohs(sock_in.sin_port), <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(rtp-&gt;<a class="code" href="structast__rtp.html#a4953f3ad9f3006fa1cc3b2b19fa19783">strict_rtp_address</a>.sin_addr), ntohs(rtp-&gt;<a class="code" href="structast__rtp.html#a4953f3ad9f3006fa1cc3b2b19fa19783">strict_rtp_address</a>.sin_port));
<a name="l01603"></a>01603          <span class="keywordflow">return</span> &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l01604"></a>01604       }
<a name="l01605"></a>01605    }
<a name="l01606"></a>01606 
<a name="l01607"></a>01607    rtpheader = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *)(rtp-&gt;<a class="code" href="structast__rtp.html#a8af53bd0e8b4f1e9275d51d2a4065991">rawdata</a> + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>);
<a name="l01608"></a>01608    <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l01609"></a>01609       <a class="code" href="utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(errno != EBADF);
<a name="l01610"></a>01610       <span class="keywordflow">if</span> (errno != EAGAIN) {
<a name="l01611"></a>01611          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;RTP Read error: %s.  Hanging up.\n&quot;</span>, strerror(errno));
<a name="l01612"></a>01612          <span class="keywordflow">return</span> NULL;
<a name="l01613"></a>01613       }
<a name="l01614"></a>01614       <span class="keywordflow">return</span> &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l01615"></a>01615    }
<a name="l01616"></a>01616    
<a name="l01617"></a>01617    <span class="keywordflow">if</span> (res &lt; hdrlen) {
<a name="l01618"></a>01618       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;RTP Read too short\n&quot;</span>);
<a name="l01619"></a>01619       <span class="keywordflow">return</span> &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l01620"></a>01620    }
<a name="l01621"></a>01621 
<a name="l01622"></a>01622    <span class="comment">/* Get fields */</span>
<a name="l01623"></a>01623    seqno = ntohl(rtpheader[0]);
<a name="l01624"></a>01624 
<a name="l01625"></a>01625    <span class="comment">/* Check RTP version */</span>
<a name="l01626"></a>01626    version = (seqno &amp; 0xC0000000) &gt;&gt; 30;
<a name="l01627"></a>01627    <span class="keywordflow">if</span> (!version) {
<a name="l01628"></a>01628       <span class="comment">/* If the two high bits are 0, this might be a</span>
<a name="l01629"></a>01629 <span class="comment">       * STUN message, so process it. stun_handle_packet()</span>
<a name="l01630"></a>01630 <span class="comment">       * answers to requests, and it returns STUN_ACCEPT</span>
<a name="l01631"></a>01631 <span class="comment">       * if the request is valid.</span>
<a name="l01632"></a>01632 <span class="comment">       */</span>
<a name="l01633"></a>01633       <span class="keywordflow">if</span> ((<a class="code" href="rtp_8c.html#a0599391b62cb92d0a020334f6d63fdd0" title="handle an incoming STUN message.">stun_handle_packet</a>(rtp-&gt;<a class="code" href="structast__rtp.html#a339d22b3e442946380f98ed19e320db2">s</a>, &amp;sock_in, rtp-&gt;<a class="code" href="structast__rtp.html#a8af53bd0e8b4f1e9275d51d2a4065991">rawdata</a> + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>, res, NULL, NULL) == <a class="code" href="rtp_8c.html#a99997ca32f4f4f6e229dd8aaacd71ec0">STUN_ACCEPT</a>) &amp;&amp;
<a name="l01634"></a>01634          (!rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port &amp;&amp; !rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr.s_addr)) {
<a name="l01635"></a>01635          memcpy(&amp;rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>, &amp;sock_in, <span class="keyword">sizeof</span>(rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>));
<a name="l01636"></a>01636       }
<a name="l01637"></a>01637       <span class="keywordflow">return</span> &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l01638"></a>01638    }
<a name="l01639"></a>01639 
<a name="l01640"></a>01640 <span class="preprocessor">#if 0 </span><span class="comment">/* Allow to receive RTP stream with closed transmission path */</span>
<a name="l01641"></a>01641    <span class="comment">/* If we don&apos;t have the other side&apos;s address, then ignore this */</span>
<a name="l01642"></a>01642    <span class="keywordflow">if</span> (!rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr.s_addr || !rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port)
<a name="l01643"></a>01643       <span class="keywordflow">return</span> &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l01644"></a>01644 <span class="preprocessor">#endif</span>
<a name="l01645"></a>01645 <span class="preprocessor"></span>
<a name="l01646"></a>01646    <span class="comment">/* Send to whoever send to us if NAT is turned on */</span>
<a name="l01647"></a>01647    <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#ada540a5f25f7302dc1a3d17ccfa59b10">nat</a>) {
<a name="l01648"></a>01648       <span class="keywordflow">if</span> (((rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr.s_addr != sock_in.sin_addr.s_addr) ||
<a name="l01649"></a>01649           (rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port != sock_in.sin_port)) &amp;&amp; 
<a name="l01650"></a>01650           ((rtp-&gt;<a class="code" href="structast__rtp.html#a567178215831a573c88f6370305a2997">altthem</a>.sin_addr.s_addr != sock_in.sin_addr.s_addr) ||
<a name="l01651"></a>01651           (rtp-&gt;<a class="code" href="structast__rtp.html#a567178215831a573c88f6370305a2997">altthem</a>.sin_port != sock_in.sin_port))) {
<a name="l01652"></a>01652          rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a> = sock_in;
<a name="l01653"></a>01653          <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>) {
<a name="l01654"></a>01654             <span class="keywordtype">int</span> h = 0;
<a name="l01655"></a>01655             memcpy(&amp;rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>, &amp;sock_in, <span class="keyword">sizeof</span>(rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>));
<a name="l01656"></a>01656             h = ntohs(rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port);
<a name="l01657"></a>01657             rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port = htons(h + 1);
<a name="l01658"></a>01658          }
<a name="l01659"></a>01659          rtp-&gt;<a class="code" href="structast__rtp.html#a5406ab4bd6c88a7b08f103e810dfff9e">rxseqno</a> = 0;
<a name="l01660"></a>01660          <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(rtp, <a class="code" href="rtp_8c.html#ab67e21f67a96dd6a9e1b0450ecddecf3">FLAG_NAT_ACTIVE</a>);
<a name="l01661"></a>01661          <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ga40f8fb2e731031d99f732f515cec680f">option_debug</a> || <a class="code" href="rtp_8c.html#a147859009ddb300c602e8e9ca3c85983">rtpdebug</a>)
<a name="l01662"></a>01662             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(0, <span class="stringliteral">&quot;RTP NAT: Got audio from other end. Now sending to address %s:%d\n&quot;</span>, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr), ntohs(rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port));
<a name="l01663"></a>01663       }
<a name="l01664"></a>01664    }
<a name="l01665"></a>01665 
<a name="l01666"></a>01666    <span class="comment">/* If we are bridged to another RTP stream, send direct */</span>
<a name="l01667"></a>01667    <span class="keywordflow">if</span> ((bridged = <a class="code" href="rtp_8h.html#af7dc32ebdfacbbf446321de6fcfe2d9a">ast_rtp_get_bridged</a>(rtp)) &amp;&amp; !<a class="code" href="rtp_8c.html#a5c67ce326f00a810520a5c0bc4500df6" title="Perform a Packet2Packet RTP write.">bridge_p2p_rtp_write</a>(rtp, bridged, rtpheader, res, hdrlen))
<a name="l01668"></a>01668       <span class="keywordflow">return</span> &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l01669"></a>01669 
<a name="l01670"></a>01670    <span class="keywordflow">if</span> (version != 2)
<a name="l01671"></a>01671       <span class="keywordflow">return</span> &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l01672"></a>01672 
<a name="l01673"></a>01673    payloadtype = (seqno &amp; 0x7f0000) &gt;&gt; 16;
<a name="l01674"></a>01674    padding = seqno &amp; (1 &lt;&lt; 29);
<a name="l01675"></a>01675    mark = seqno &amp; (1 &lt;&lt; 23);
<a name="l01676"></a>01676    ext = seqno &amp; (1 &lt;&lt; 28);
<a name="l01677"></a>01677    cc = (seqno &amp; 0xF000000) &gt;&gt; 24;
<a name="l01678"></a>01678    seqno &amp;= 0xffff;
<a name="l01679"></a>01679    timestamp = ntohl(rtpheader[1]);
<a name="l01680"></a>01680    ssrc = ntohl(rtpheader[2]);
<a name="l01681"></a>01681    
<a name="l01682"></a>01682    <span class="keywordflow">if</span> (!mark &amp;&amp; rtp-&gt;<a class="code" href="structast__rtp.html#a943da98a0ca2d0342765831c6c3d5f3f">rxssrc</a> &amp;&amp; rtp-&gt;<a class="code" href="structast__rtp.html#a943da98a0ca2d0342765831c6c3d5f3f">rxssrc</a> != ssrc) {
<a name="l01683"></a>01683       <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ga40f8fb2e731031d99f732f515cec680f">option_debug</a> || <a class="code" href="rtp_8c.html#a147859009ddb300c602e8e9ca3c85983">rtpdebug</a>)
<a name="l01684"></a>01684          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(0, <span class="stringliteral">&quot;Forcing Marker bit, because SSRC has changed\n&quot;</span>);
<a name="l01685"></a>01685       mark = 1;
<a name="l01686"></a>01686    }
<a name="l01687"></a>01687 
<a name="l01688"></a>01688    rtp-&gt;<a class="code" href="structast__rtp.html#a943da98a0ca2d0342765831c6c3d5f3f">rxssrc</a> = ssrc;
<a name="l01689"></a>01689    
<a name="l01690"></a>01690    <span class="keywordflow">if</span> (padding) {
<a name="l01691"></a>01691       <span class="comment">/* Remove padding bytes */</span>
<a name="l01692"></a>01692       res -= rtp-&gt;<a class="code" href="structast__rtp.html#a8af53bd0e8b4f1e9275d51d2a4065991">rawdata</a>[<a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a> + res - 1];
<a name="l01693"></a>01693    }
<a name="l01694"></a>01694    
<a name="l01695"></a>01695    <span class="keywordflow">if</span> (cc) {
<a name="l01696"></a>01696       <span class="comment">/* CSRC fields present */</span>
<a name="l01697"></a>01697       hdrlen += cc*4;
<a name="l01698"></a>01698    }
<a name="l01699"></a>01699 
<a name="l01700"></a>01700    <span class="keywordflow">if</span> (ext) {
<a name="l01701"></a>01701       <span class="comment">/* RTP Extension present */</span>
<a name="l01702"></a>01702       hdrlen += (ntohl(rtpheader[hdrlen/4]) &amp; 0xffff) &lt;&lt; 2;
<a name="l01703"></a>01703       hdrlen += 4;
<a name="l01704"></a>01704       <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ga40f8fb2e731031d99f732f515cec680f">option_debug</a>) {
<a name="l01705"></a>01705          <span class="keywordtype">int</span> profile;
<a name="l01706"></a>01706          profile = (ntohl(rtpheader[3]) &amp; 0xffff0000) &gt;&gt; 16;
<a name="l01707"></a>01707          <span class="keywordflow">if</span> (profile == 0x505a)
<a name="l01708"></a>01708             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Found Zfone extension in RTP stream - zrtp - not supported.\n&quot;</span>);
<a name="l01709"></a>01709          <span class="keywordflow">else</span>
<a name="l01710"></a>01710             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Found unknown RTP Extensions %x\n&quot;</span>, profile);
<a name="l01711"></a>01711       }
<a name="l01712"></a>01712    }
<a name="l01713"></a>01713 
<a name="l01714"></a>01714    <span class="keywordflow">if</span> (res &lt; hdrlen) {
<a name="l01715"></a>01715       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;RTP Read too short (%d, expecting %d)\n&quot;</span>, res, hdrlen);
<a name="l01716"></a>01716       <span class="keywordflow">return</span> &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l01717"></a>01717    }
<a name="l01718"></a>01718 
<a name="l01719"></a>01719    rtp-&gt;<a class="code" href="structast__rtp.html#a066dafb1cdc02b25e6c2329ef7e7a810">rxcount</a>++; <span class="comment">/* Only count reasonably valid packets, this&apos;ll make the rtcp stats more accurate */</span>
<a name="l01720"></a>01720 
<a name="l01721"></a>01721    <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a066dafb1cdc02b25e6c2329ef7e7a810">rxcount</a>==1) {
<a name="l01722"></a>01722       <span class="comment">/* This is the first RTP packet successfully received from source */</span>
<a name="l01723"></a>01723       rtp-&gt;<a class="code" href="structast__rtp.html#a39b8d9a63bb7be44fbb707bb23721092">seedrxseqno</a> = seqno;
<a name="l01724"></a>01724    }
<a name="l01725"></a>01725 
<a name="l01726"></a>01726    <span class="comment">/* Do not schedule RR if RTCP isn&apos;t run */</span>
<a name="l01727"></a>01727    <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a> &amp;&amp; rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr.s_addr &amp;&amp; rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a1083e2d34bb1a32645f4681a7ee78b41">schedid</a> &lt; 1) {
<a name="l01728"></a>01728       <span class="comment">/* Schedule transmission of Receiver Report */</span>
<a name="l01729"></a>01729       rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a1083e2d34bb1a32645f4681a7ee78b41">schedid</a> = <a class="code" href="sched_8h.html#a97176531282ac4e70aa107b2e8ee5543" title="Adds a scheduled event Schedule an event to take place at some point in the future...">ast_sched_add</a>(rtp-&gt;<a class="code" href="structast__rtp.html#aea6233539fc73fc5303bf7525ec27e73">sched</a>, <a class="code" href="rtp_8c.html#ae8c264c840c8c9b4e8ca062746000506">ast_rtcp_calc_interval</a>(rtp), <a class="code" href="rtp_8c.html#aff89c2855ec73ffa6efdc958bb71c2e8" title="Write and RTCP packet to the far end.">ast_rtcp_write</a>, rtp);
<a name="l01730"></a>01730    }
<a name="l01731"></a>01731    <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)rtp-&gt;<a class="code" href="structast__rtp.html#a184e1597cfcf7b28d1cf5d4857892a91">lastrxseqno</a> - (<span class="keywordtype">int</span>)seqno  &gt; 100) <span class="comment">/* if so it would indicate that the sender cycled; allow for misordering */</span>
<a name="l01732"></a>01732       rtp-&gt;<a class="code" href="structast__rtp.html#a93c8f827085bb8e8e17e59ad2495ecc7">cycles</a> += <a class="code" href="rtp_8c.html#af3a188c3caa83026e351d58ef855424a">RTP_SEQ_MOD</a>;
<a name="l01733"></a>01733    
<a name="l01734"></a>01734    prev_seqno = rtp-&gt;<a class="code" href="structast__rtp.html#a184e1597cfcf7b28d1cf5d4857892a91">lastrxseqno</a>;
<a name="l01735"></a>01735 
<a name="l01736"></a>01736    rtp-&gt;<a class="code" href="structast__rtp.html#a184e1597cfcf7b28d1cf5d4857892a91">lastrxseqno</a> = seqno;
<a name="l01737"></a>01737    
<a name="l01738"></a>01738    <span class="keywordflow">if</span> (!rtp-&gt;<a class="code" href="structast__rtp.html#afe92c8ff0d37afbf84f8715f4144ca27">themssrc</a>)
<a name="l01739"></a>01739       rtp-&gt;<a class="code" href="structast__rtp.html#afe92c8ff0d37afbf84f8715f4144ca27">themssrc</a> = ntohl(rtpheader[2]); <span class="comment">/* Record their SSRC to put in future RR */</span>
<a name="l01740"></a>01740    
<a name="l01741"></a>01741    <span class="keywordflow">if</span> (<a class="code" href="rtp_8c.html#a204c446f295fb302b05363d78f2d8d34">rtp_debug_test_addr</a>(&amp;sock_in))
<a name="l01742"></a>01742       <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;Got  RTP packet from    %s:%u (type %-2.2d, seq %-6.6u, ts %-6.6u, len %-6.6u)\n&quot;</span>,
<a name="l01743"></a>01743          <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(sock_in.sin_addr), ntohs(sock_in.sin_port), payloadtype, seqno, timestamp,res - hdrlen);
<a name="l01744"></a>01744 
<a name="l01745"></a>01745    rtpPT = <a class="code" href="rtp_8h.html#a9fdf56baeb1e0ca97859d10826bdd1de" title="Mapping between RTP payload format codes and Asterisk codes:.">ast_rtp_lookup_pt</a>(rtp, payloadtype);
<a name="l01746"></a>01746    <span class="keywordflow">if</span> (!rtpPT.isAstFormat) {
<a name="l01747"></a>01747       <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a> = NULL;
<a name="l01748"></a>01748 
<a name="l01749"></a>01749       <span class="comment">/* This is special in-band data that&apos;s not one of our codecs */</span>
<a name="l01750"></a>01750       <span class="keywordflow">if</span> (rtpPT.code == <a class="code" href="rtp_8h.html#a3cc8001677e3b955b9b5ceb4267a76ec">AST_RTP_DTMF</a>) {
<a name="l01751"></a>01751          <span class="comment">/* It&apos;s special -- rfc2833 process it */</span>
<a name="l01752"></a>01752          <span class="keywordflow">if</span> (<a class="code" href="rtp_8c.html#a204c446f295fb302b05363d78f2d8d34">rtp_debug_test_addr</a>(&amp;sock_in)) {
<a name="l01753"></a>01753             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>;
<a name="l01754"></a>01754             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> event;
<a name="l01755"></a>01755             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> event_end;
<a name="l01756"></a>01756             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> duration;
<a name="l01757"></a>01757             data = rtp-&gt;<a class="code" href="structast__rtp.html#a8af53bd0e8b4f1e9275d51d2a4065991">rawdata</a> + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a> + hdrlen;
<a name="l01758"></a>01758             <span class="keyword">event</span> = ntohl(*((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *)(data)));
<a name="l01759"></a>01759             <span class="keyword">event</span> &gt;&gt;= 24;
<a name="l01760"></a>01760             event_end = ntohl(*((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *)(data)));
<a name="l01761"></a>01761             event_end &lt;&lt;= 8;
<a name="l01762"></a>01762             event_end &gt;&gt;= 24;
<a name="l01763"></a>01763             duration = ntohl(*((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *)(data)));
<a name="l01764"></a>01764             duration &amp;= 0xFFFF;
<a name="l01765"></a>01765             <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;Got  RTP RFC2833 from   %s:%u (type %-2.2d, seq %-6.6u, ts %-6.6u, len %-6.6u, mark %d, event %08x, end %d, duration %-5.5d) \n&quot;</span>, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(sock_in.sin_addr), ntohs(sock_in.sin_port), payloadtype, seqno, timestamp, res - hdrlen, (mark?1:0), event, ((event_end &amp; 0x80)?1:0), duration);
<a name="l01766"></a>01766          }
<a name="l01767"></a>01767          f = <a class="code" href="rtp_8c.html#ad58e8d31a0ace316b213e752c7939ac7" title="Process RTP DTMF and events according to RFC 2833.">process_rfc2833</a>(rtp, rtp-&gt;<a class="code" href="structast__rtp.html#a8af53bd0e8b4f1e9275d51d2a4065991">rawdata</a> + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a> + hdrlen, res - hdrlen, seqno, timestamp);
<a name="l01768"></a>01768       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rtpPT.code == <a class="code" href="rtp_8h.html#afd196e2ba79659dff0799d49494e8b45">AST_RTP_CISCO_DTMF</a>) {
<a name="l01769"></a>01769          <span class="comment">/* It&apos;s really special -- process it the Cisco way */</span>
<a name="l01770"></a>01770          <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a981a2adf6e3b11f40e35adccf12969f2">lastevent</a> &lt;= seqno || (rtp-&gt;<a class="code" href="structast__rtp.html#a981a2adf6e3b11f40e35adccf12969f2">lastevent</a> &gt;= 65530 &amp;&amp; seqno &lt;= 6)) {
<a name="l01771"></a>01771             f = <a class="code" href="rtp_8c.html#a51335dc07892d8a1e1db2ffbaf1178cd">process_cisco_dtmf</a>(rtp, rtp-&gt;<a class="code" href="structast__rtp.html#a8af53bd0e8b4f1e9275d51d2a4065991">rawdata</a> + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a> + hdrlen, res - hdrlen);
<a name="l01772"></a>01772             rtp-&gt;<a class="code" href="structast__rtp.html#a981a2adf6e3b11f40e35adccf12969f2">lastevent</a> = seqno;
<a name="l01773"></a>01773          }
<a name="l01774"></a>01774       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rtpPT.code == <a class="code" href="rtp_8h.html#ad924782a38efb3a8f9edbb92d3135541">AST_RTP_CN</a>) {
<a name="l01775"></a>01775          <span class="comment">/* Comfort Noise */</span>
<a name="l01776"></a>01776          f = <a class="code" href="rtp_8c.html#a663c1a4adafaed5f3c26b2a0c0735365" title="Process Comfort Noise RTP.">process_rfc3389</a>(rtp, rtp-&gt;<a class="code" href="structast__rtp.html#a8af53bd0e8b4f1e9275d51d2a4065991">rawdata</a> + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a> + hdrlen, res - hdrlen);
<a name="l01777"></a>01777       } <span class="keywordflow">else</span> {
<a name="l01778"></a>01778          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Unknown RTP codec %d received from &apos;%s&apos;\n&quot;</span>, payloadtype, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr));
<a name="l01779"></a>01779       }
<a name="l01780"></a>01780       <span class="keywordflow">return</span> f ? f : &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l01781"></a>01781    }
<a name="l01782"></a>01782    rtp-&gt;<a class="code" href="structast__rtp.html#ac39112ee85d1c736329776a40537daf9">lastrxformat</a> = rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = rtpPT.code;
<a name="l01783"></a>01783    rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = (rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> &amp; <a class="code" href="frame_8h.html#a3f680b9c15596de927d507a664fd2803">AST_FORMAT_AUDIO_MASK</a>) ? <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a> : (rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> &amp; <a class="code" href="frame_8h.html#ad048231af8a6271706585e3c8630dc69">AST_FORMAT_VIDEO_MASK</a>) ? <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a17ae96b6ea8a2388bb0d409e8124ff30">AST_FRAME_VIDEO</a> : <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0af7728b18670d3cd075f63d67f8867078">AST_FRAME_TEXT</a>;
<a name="l01784"></a>01784 
<a name="l01785"></a>01785    rtp-&gt;<a class="code" href="structast__rtp.html#a5406ab4bd6c88a7b08f103e810dfff9e">rxseqno</a> = seqno;
<a name="l01786"></a>01786 
<a name="l01787"></a>01787    <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a82decffa117c6037813bb76ce6227e11">dtmf_timeout</a> &amp;&amp; rtp-&gt;<a class="code" href="structast__rtp.html#a82decffa117c6037813bb76ce6227e11">dtmf_timeout</a> &lt; timestamp) {
<a name="l01788"></a>01788       rtp-&gt;<a class="code" href="structast__rtp.html#a82decffa117c6037813bb76ce6227e11">dtmf_timeout</a> = 0;
<a name="l01789"></a>01789 
<a name="l01790"></a>01790       <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a617de34b6fe254a4d2c04e2a064267ee">resp</a>) {
<a name="l01791"></a>01791          <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *f;
<a name="l01792"></a>01792          f = <a class="code" href="rtp_8c.html#a7731cfa4c6712ca675ee296e4f0a1918">send_dtmf</a>(rtp, <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a98e65764bc963016c394bcc1bad6540b">AST_FRAME_DTMF_END</a>);
<a name="l01793"></a>01793          f-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a> = <a class="code" href="time_8h.html#a74e35cffcd45ad6cd7c8587921e8a4c2" title="Computes the difference (in milliseconds) between two struct timeval instances.">ast_tvdiff_ms</a>(<a class="code" href="time_8h.html#a147d132412d7188c1dcebf25b8d31c0c" title="Returns a timeval corresponding to the duration of n samples at rate r. Useful to...">ast_samp2tv</a>(rtp-&gt;<a class="code" href="structast__rtp.html#a19848123ee0962b2880fffaea19a9392">dtmf_duration</a>, <a class="code" href="rtp_8c.html#a8e6e4d6b1e4a0eb553b5e8531dd9eff7">rtp_get_rate</a>(f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>)), <a class="code" href="time_8h.html#af46dec59fc43982d018a757f7b499669" title="Returns a timeval from sec, usec.">ast_tv</a>(0, 0));
<a name="l01794"></a>01794          rtp-&gt;<a class="code" href="structast__rtp.html#a617de34b6fe254a4d2c04e2a064267ee">resp</a> = 0;
<a name="l01795"></a>01795          rtp-&gt;<a class="code" href="structast__rtp.html#a82decffa117c6037813bb76ce6227e11">dtmf_timeout</a> = rtp-&gt;<a class="code" href="structast__rtp.html#a19848123ee0962b2880fffaea19a9392">dtmf_duration</a> = 0;
<a name="l01796"></a>01796          <span class="keywordflow">return</span> f;
<a name="l01797"></a>01797       }
<a name="l01798"></a>01798    }
<a name="l01799"></a>01799 
<a name="l01800"></a>01800    <span class="comment">/* Record received timestamp as last received now */</span>
<a name="l01801"></a>01801    rtp-&gt;<a class="code" href="structast__rtp.html#ab4b9ba00bb47d86340c9c150f17d7c69">lastrxts</a> = timestamp;
<a name="l01802"></a>01802 
<a name="l01803"></a>01803    rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#aed16590d48f41d89f31e0cf347f5cd99">mallocd</a> = 0;
<a name="l01804"></a>01804    rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> = res - hdrlen;
<a name="l01805"></a>01805    rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> = rtp-&gt;<a class="code" href="structast__rtp.html#a8af53bd0e8b4f1e9275d51d2a4065991">rawdata</a> + hdrlen + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>;
<a name="l01806"></a>01806    rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#aed7ea92f45bd273dde380a45ddced592">offset</a> = hdrlen + AST_FRIENDLY_OFFSET;
<a name="l01807"></a>01807    rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#ab793262012344621455faf9266acbac2">seqno</a> = seqno;
<a name="l01808"></a>01808 
<a name="l01809"></a>01809    <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> == <a class="code" href="frame_8h.html#a721e65ac52ff8eca03ea163544e695b6">AST_FORMAT_T140</a> &amp;&amp; (<span class="keywordtype">int</span>)seqno - (prev_seqno+1) &gt; 0 &amp;&amp; (<span class="keywordtype">int</span>)seqno - (prev_seqno+1) &lt; 10) {
<a name="l01810"></a>01810         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *data = rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>;
<a name="l01811"></a>01811         
<a name="l01812"></a>01812         memmove(rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>+3, rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>);
<a name="l01813"></a>01813         rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> +=3;
<a name="l01814"></a>01814         *data++ = 0xEF;
<a name="l01815"></a>01815         *data++ = 0xBF;
<a name="l01816"></a>01816         *data = 0xBD;
<a name="l01817"></a>01817    }
<a name="l01818"></a>01818  
<a name="l01819"></a>01819    <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> == <a class="code" href="frame_8h.html#aa43d17815b58f27836a45fb310d33959">AST_FORMAT_T140RED</a>) {
<a name="l01820"></a>01820       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *data = rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>;
<a name="l01821"></a>01821       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *header_end;
<a name="l01822"></a>01822       <span class="keywordtype">int</span> num_generations;
<a name="l01823"></a>01823       <span class="keywordtype">int</span> header_length;
<a name="l01824"></a>01824       <span class="keywordtype">int</span> length;
<a name="l01825"></a>01825       <span class="keywordtype">int</span> diff =(int)seqno - (prev_seqno+1); <span class="comment">/* if diff = 0, no drop*/</span>
<a name="l01826"></a>01826       <span class="keywordtype">int</span> x;
<a name="l01827"></a>01827 
<a name="l01828"></a>01828       rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="frame_8h.html#a721e65ac52ff8eca03ea163544e695b6">AST_FORMAT_T140</a>;
<a name="l01829"></a>01829       header_end = memchr(data, ((*data) &amp; 0x7f), rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>);
<a name="l01830"></a>01830       <span class="keywordflow">if</span> (header_end == NULL) {
<a name="l01831"></a>01831          <span class="keywordflow">return</span> &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l01832"></a>01832       }
<a name="l01833"></a>01833       header_end++;
<a name="l01834"></a>01834       
<a name="l01835"></a>01835       header_length = header_end - data;
<a name="l01836"></a>01836       num_generations = header_length / 4;
<a name="l01837"></a>01837       length = header_length;
<a name="l01838"></a>01838 
<a name="l01839"></a>01839       <span class="keywordflow">if</span> (!diff) {
<a name="l01840"></a>01840          <span class="keywordflow">for</span> (x = 0; x &lt; num_generations; x++)
<a name="l01841"></a>01841             length += data[x * 4 + 3];
<a name="l01842"></a>01842          
<a name="l01843"></a>01843          <span class="keywordflow">if</span> (!(rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> - length))
<a name="l01844"></a>01844             <span class="keywordflow">return</span> &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l01845"></a>01845          
<a name="l01846"></a>01846          rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> += length;
<a name="l01847"></a>01847          rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> -= length;
<a name="l01848"></a>01848       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (diff &gt; num_generations &amp;&amp; diff &lt; 10) {
<a name="l01849"></a>01849          length -= 3;
<a name="l01850"></a>01850          rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> += length;
<a name="l01851"></a>01851          rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> -= length;
<a name="l01852"></a>01852          
<a name="l01853"></a>01853          data = rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>;
<a name="l01854"></a>01854          *data++ = 0xEF;
<a name="l01855"></a>01855          *data++ = 0xBF;
<a name="l01856"></a>01856          *data = 0xBD;
<a name="l01857"></a>01857       } <span class="keywordflow">else</span>   {
<a name="l01858"></a>01858          <span class="keywordflow">for</span> ( x = 0; x &lt; num_generations - diff; x++) 
<a name="l01859"></a>01859             length += data[x * 4 + 3];
<a name="l01860"></a>01860          
<a name="l01861"></a>01861          rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> += length;
<a name="l01862"></a>01862          rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> -= length;
<a name="l01863"></a>01863       }
<a name="l01864"></a>01864    }
<a name="l01865"></a>01865 
<a name="l01866"></a>01866    <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> &amp; <a class="code" href="frame_8h.html#a3f680b9c15596de927d507a664fd2803">AST_FORMAT_AUDIO_MASK</a>) {
<a name="l01867"></a>01867       rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> = <a class="code" href="frame_8h.html#aedec72ae8357bb6c334111f93d283713" title="Returns the number of samples contained in the frame.">ast_codec_get_samples</a>(&amp;rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>);
<a name="l01868"></a>01868       <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> == <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>) 
<a name="l01869"></a>01869          <a class="code" href="frame_8h.html#a0eb09df2bca453c21ced51b12b52a88b">ast_frame_byteswap_be</a>(&amp;rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>);
<a name="l01870"></a>01870       <a class="code" href="rtp_8c.html#a6134fd2180fca7829793af724a013344">calc_rxstamp</a>(&amp;rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a41a708025486b4c9383e7432e9ba3f0e">delivery</a>, rtp, timestamp, mark);
<a name="l01871"></a>01871       <span class="comment">/* Add timing data to let ast_generic_bridge() put the frame into a jitterbuf */</span>
<a name="l01872"></a>01872       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(&amp;rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>, <a class="code" href="frame_8h.html#a0ae1e3bf78c960c83e2d437efd802058ae8f674e19f6450e2b746c8a52c11649a">AST_FRFLAG_HAS_TIMING_INFO</a>);
<a name="l01873"></a>01873       rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a1eb46dcb363821328c0d2a758549216b">ts</a> = timestamp / (<a class="code" href="rtp_8c.html#a8e6e4d6b1e4a0eb553b5e8531dd9eff7">rtp_get_rate</a>(rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>) / 1000);
<a name="l01874"></a>01874       rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a> = rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> / ((<a class="code" href="frame_8h.html#a29a7b93f4295966d4d441e91bff2b01e" title="Get the sample rate for a given format.">ast_format_rate</a>(rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>) / 1000));
<a name="l01875"></a>01875    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> &amp; <a class="code" href="frame_8h.html#ad048231af8a6271706585e3c8630dc69">AST_FORMAT_VIDEO_MASK</a>) {
<a name="l01876"></a>01876       <span class="comment">/* Video -- samples is # of samples vs. 90000 */</span>
<a name="l01877"></a>01877       <span class="keywordflow">if</span> (!rtp-&gt;<a class="code" href="structast__rtp.html#a19258cc54fe0aafdf3bbe1f4fcc29218">lastividtimestamp</a>)
<a name="l01878"></a>01878          rtp-&gt;<a class="code" href="structast__rtp.html#a19258cc54fe0aafdf3bbe1f4fcc29218">lastividtimestamp</a> = timestamp;
<a name="l01879"></a>01879       rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> = timestamp - rtp-&gt;<a class="code" href="structast__rtp.html#a19258cc54fe0aafdf3bbe1f4fcc29218">lastividtimestamp</a>;
<a name="l01880"></a>01880       rtp-&gt;<a class="code" href="structast__rtp.html#a19258cc54fe0aafdf3bbe1f4fcc29218">lastividtimestamp</a> = timestamp;
<a name="l01881"></a>01881       rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a41a708025486b4c9383e7432e9ba3f0e">delivery</a>.tv_sec = 0;
<a name="l01882"></a>01882       rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a41a708025486b4c9383e7432e9ba3f0e">delivery</a>.tv_usec = 0;
<a name="l01883"></a>01883       <span class="comment">/* Pass the RTP marker bit as bit 0 in the subclass field.</span>
<a name="l01884"></a>01884 <span class="comment">       * This is ok because subclass is actually a bitmask, and</span>
<a name="l01885"></a>01885 <span class="comment">       * the low bits represent audio formats, that are not</span>
<a name="l01886"></a>01886 <span class="comment">       * involved here since we deal with video.</span>
<a name="l01887"></a>01887 <span class="comment">       */</span>
<a name="l01888"></a>01888       <span class="keywordflow">if</span> (mark)
<a name="l01889"></a>01889          rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> |= 0x1;
<a name="l01890"></a>01890    } <span class="keywordflow">else</span> {
<a name="l01891"></a>01891       <span class="comment">/* TEXT -- samples is # of samples vs. 1000 */</span>
<a name="l01892"></a>01892       <span class="keywordflow">if</span> (!rtp-&gt;<a class="code" href="structast__rtp.html#ae62094357b73bc730994119ae220bbd2">lastitexttimestamp</a>)
<a name="l01893"></a>01893          rtp-&gt;<a class="code" href="structast__rtp.html#ae62094357b73bc730994119ae220bbd2">lastitexttimestamp</a> = timestamp;
<a name="l01894"></a>01894       rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> = timestamp - rtp-&gt;<a class="code" href="structast__rtp.html#ae62094357b73bc730994119ae220bbd2">lastitexttimestamp</a>;
<a name="l01895"></a>01895       rtp-&gt;<a class="code" href="structast__rtp.html#ae62094357b73bc730994119ae220bbd2">lastitexttimestamp</a> = timestamp;
<a name="l01896"></a>01896       rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a41a708025486b4c9383e7432e9ba3f0e">delivery</a>.tv_sec = 0;
<a name="l01897"></a>01897       rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a41a708025486b4c9383e7432e9ba3f0e">delivery</a>.tv_usec = 0;
<a name="l01898"></a>01898    }
<a name="l01899"></a>01899    rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a> = <span class="stringliteral">&quot;RTP&quot;</span>;
<a name="l01900"></a>01900    <span class="keywordflow">return</span> &amp;rtp-&gt;<a class="code" href="structast__rtp.html#a735f764b1095611ace084e7c6c06857d">f</a>;
<a name="l01901"></a>01901 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a939d33729da677d7fc093f99c558e8e6"></a><!-- doxytag: member="rtp.h::ast_rtp_reload" ref="a939d33729da677d7fc093f99c558e8e6" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_rtp_reload </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Initialize RTP subsystem </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l04811">4811</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l04739">__ast_rtp_reload()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04812"></a>04812 {
<a name="l04813"></a>04813    <span class="keywordflow">return</span> <a class="code" href="rtp_8c.html#a1dd1c9755cf7af11379a3d23a70c0bcf">__ast_rtp_reload</a>(1);
<a name="l04814"></a>04814 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a40fda91dae06184092d7d70663b19416"></a><!-- doxytag: member="rtp.h::ast_rtp_reset" ref="a40fda91dae06184092d7d70663b19416" args="(struct ast_rtp *rtp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_rtp_reset </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rtp_8c_source.html#l02731">2731</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l00137">ast_rtp::dtmf_timeout</a>, <a class="el" href="rtp_8c_source.html#l00154">ast_rtp::dtmfmute</a>, <a class="el" href="rtp_8c_source.html#l00138">ast_rtp::dtmfsamples</a>, <a class="el" href="rtp_8c_source.html#l00140">ast_rtp::lastdigitts</a>, <a class="el" href="rtp_8c_source.html#l00135">ast_rtp::lastevent</a>, <a class="el" href="rtp_8c_source.html#l00115">ast_rtp::lasteventseqn</a>, <a class="el" href="rtp_8c_source.html#l00113">ast_rtp::lastitexttimestamp</a>, <a class="el" href="rtp_8c_source.html#l00111">ast_rtp::lastividtimestamp</a>, <a class="el" href="rtp_8c_source.html#l00114">ast_rtp::lastotexttimestamp</a>, <a class="el" href="rtp_8c_source.html#l00112">ast_rtp::lastovidtimestamp</a>, <a class="el" href="rtp_8c_source.html#l00127">ast_rtp::lastrxformat</a>, <a class="el" href="rtp_8c_source.html#l00110">ast_rtp::lastrxts</a>, <a class="el" href="rtp_8c_source.html#l00109">ast_rtp::lastts</a>, <a class="el" href="rtp_8c_source.html#l00126">ast_rtp::lasttxformat</a>, <a class="el" href="rtp_8c_source.html#l00150">ast_rtp::rxcore</a>, <a class="el" href="rtp_8c_source.html#l00158">ast_rtp::rxseqno</a>, <a class="el" href="rtp_8c_source.html#l00157">ast_rtp::seqno</a>, and <a class="el" href="rtp_8c_source.html#l00151">ast_rtp::txcore</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02732"></a>02732 {
<a name="l02733"></a>02733    memset(&amp;rtp-&gt;<a class="code" href="structast__rtp.html#a6c1c58433fa534368c6e3ec2fa24037b">rxcore</a>, 0, <span class="keyword">sizeof</span>(rtp-&gt;<a class="code" href="structast__rtp.html#a6c1c58433fa534368c6e3ec2fa24037b">rxcore</a>));
<a name="l02734"></a>02734    memset(&amp;rtp-&gt;<a class="code" href="structast__rtp.html#a3b8c38b9fc18e1d870dfe93c532af41a">txcore</a>, 0, <span class="keyword">sizeof</span>(rtp-&gt;<a class="code" href="structast__rtp.html#a3b8c38b9fc18e1d870dfe93c532af41a">txcore</a>));
<a name="l02735"></a>02735    memset(&amp;rtp-&gt;<a class="code" href="structast__rtp.html#acb642f88034264b2a2e1ef4a89647909">dtmfmute</a>, 0, <span class="keyword">sizeof</span>(rtp-&gt;<a class="code" href="structast__rtp.html#acb642f88034264b2a2e1ef4a89647909">dtmfmute</a>));
<a name="l02736"></a>02736    rtp-&gt;<a class="code" href="structast__rtp.html#a2eb3b9494c999b0dd38c4d40bfdc55b4">lastts</a> = 0;
<a name="l02737"></a>02737    rtp-&gt;<a class="code" href="structast__rtp.html#aed4ece79ac99ad5381829fc0392bc542">lastdigitts</a> = 0;
<a name="l02738"></a>02738    rtp-&gt;<a class="code" href="structast__rtp.html#ab4b9ba00bb47d86340c9c150f17d7c69">lastrxts</a> = 0;
<a name="l02739"></a>02739    rtp-&gt;<a class="code" href="structast__rtp.html#a19258cc54fe0aafdf3bbe1f4fcc29218">lastividtimestamp</a> = 0;
<a name="l02740"></a>02740    rtp-&gt;<a class="code" href="structast__rtp.html#a9a2293b0120398a3a10aed1a98a5ea59">lastovidtimestamp</a> = 0;
<a name="l02741"></a>02741    rtp-&gt;<a class="code" href="structast__rtp.html#ae62094357b73bc730994119ae220bbd2">lastitexttimestamp</a> = 0;
<a name="l02742"></a>02742    rtp-&gt;<a class="code" href="structast__rtp.html#abf1f99fdbacb09d2077fdc250bccc269">lastotexttimestamp</a> = 0;
<a name="l02743"></a>02743    rtp-&gt;<a class="code" href="structast__rtp.html#a4ffa1ce6767ea0893237a918ac1aa251">lasteventseqn</a> = 0;
<a name="l02744"></a>02744    rtp-&gt;<a class="code" href="structast__rtp.html#a981a2adf6e3b11f40e35adccf12969f2">lastevent</a> = 0;
<a name="l02745"></a>02745    rtp-&gt;<a class="code" href="structast__rtp.html#aad2a54a4541520f7f134aa28717fe1e7">lasttxformat</a> = 0;
<a name="l02746"></a>02746    rtp-&gt;<a class="code" href="structast__rtp.html#ac39112ee85d1c736329776a40537daf9">lastrxformat</a> = 0;
<a name="l02747"></a>02747    rtp-&gt;<a class="code" href="structast__rtp.html#a82decffa117c6037813bb76ce6227e11">dtmf_timeout</a> = 0;
<a name="l02748"></a>02748    rtp-&gt;<a class="code" href="structast__rtp.html#a1df09572b336a1f64f36ee43ced45d3d">dtmfsamples</a> = 0;
<a name="l02749"></a>02749    rtp-&gt;<a class="code" href="structast__rtp.html#a66d741481aec999a0e8bc17f70db4ebe">seqno</a> = 0;
<a name="l02750"></a>02750    rtp-&gt;<a class="code" href="structast__rtp.html#a5406ab4bd6c88a7b08f103e810dfff9e">rxseqno</a> = 0;
<a name="l02751"></a>02751 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab1a31f2e24aafee3087c227e50eb4ee8"></a><!-- doxytag: member="rtp.h::ast_rtp_sendcng" ref="ab1a31f2e24aafee3087c227e50eb4ee8" args="(struct ast_rtp *rtp, int level)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_rtp_sendcng </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>level</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>generate comfort noice (CNG) </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l03574">3574</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="utils_8c_source.html#l00431">ast_inet_ntoa()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="rtp_8h_source.html#l00045">AST_RTP_CN</a>, <a class="el" href="rtp_8c_source.html#l02360">ast_rtp_lookup_code()</a>, <a class="el" href="time_8h_source.html#l00164">ast_tv()</a>, <a class="el" href="utils_8c_source.html#l01365">ast_tvadd()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="logger_8h_source.html#l00079">ast_verbose</a>, <a class="el" href="rtp_8c_source.html#l00161">ast_rtp::data</a>, <a class="el" href="rtp_8c_source.html#l00154">ast_rtp::dtmfmute</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="rtp_8c_source.html#l00109">ast_rtp::lastts</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="rtp_8c_source.html#l00896">rtp_debug_test_addr()</a>, <a class="el" href="rtp_8c_source.html#l00103">ast_rtp::s</a>, <a class="el" href="rtp_8c_source.html#l00157">ast_rtp::seqno</a>, <a class="el" href="rtp_8c_source.html#l00106">ast_rtp::ssrc</a>, and <a class="el" href="rtp_8c_source.html#l00148">ast_rtp::them</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l22343">check_rtp_timeout()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03575"></a>03575 {
<a name="l03576"></a>03576    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *rtpheader;
<a name="l03577"></a>03577    <span class="keywordtype">int</span> hdrlen = 12;
<a name="l03578"></a>03578    <span class="keywordtype">int</span> res;
<a name="l03579"></a>03579    <span class="keywordtype">int</span> payload;
<a name="l03580"></a>03580    <span class="keywordtype">char</span> <a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>[256];
<a name="l03581"></a>03581    level = 127 - (level &amp; 0x7f);
<a name="l03582"></a>03582    payload = <a class="code" href="rtp_8h.html#a4daa559b8f2ef25bc33d8f5d8fd937d1" title="Looks up an RTP code out of our *static* outbound list.">ast_rtp_lookup_code</a>(rtp, 0, <a class="code" href="rtp_8h.html#ad924782a38efb3a8f9edbb92d3135541">AST_RTP_CN</a>);
<a name="l03583"></a>03583 
<a name="l03584"></a>03584    <span class="comment">/* If we have no peer, return immediately */</span> 
<a name="l03585"></a>03585    <span class="keywordflow">if</span> (!rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr.s_addr)
<a name="l03586"></a>03586       <span class="keywordflow">return</span> 0;
<a name="l03587"></a>03587 
<a name="l03588"></a>03588    rtp-&gt;<a class="code" href="structast__rtp.html#acb642f88034264b2a2e1ef4a89647909">dtmfmute</a> = <a class="code" href="time_8h.html#a97e1bb8fbd7a103212789e87e7ed6073" title="Returns the sum of two timevals a + b.">ast_tvadd</a>(<a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>(), <a class="code" href="time_8h.html#af46dec59fc43982d018a757f7b499669" title="Returns a timeval from sec, usec.">ast_tv</a>(0, 500000));
<a name="l03589"></a>03589 
<a name="l03590"></a>03590    <span class="comment">/* Get a pointer to the header */</span>
<a name="l03591"></a>03591    rtpheader = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *)data;
<a name="l03592"></a>03592    rtpheader[0] = htonl((2 &lt;&lt; 30) | (1 &lt;&lt; 23) | (payload &lt;&lt; 16) | (rtp-&gt;<a class="code" href="structast__rtp.html#a66d741481aec999a0e8bc17f70db4ebe">seqno</a>++));
<a name="l03593"></a>03593    rtpheader[1] = htonl(rtp-&gt;<a class="code" href="structast__rtp.html#a2eb3b9494c999b0dd38c4d40bfdc55b4">lastts</a>);
<a name="l03594"></a>03594    rtpheader[2] = htonl(rtp-&gt;<a class="code" href="structast__rtp.html#a9e10385ac55d32d10ef322d1a08a699d">ssrc</a>); 
<a name="l03595"></a>03595    data[12] = level;
<a name="l03596"></a>03596    <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port &amp;&amp; rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr.s_addr) {
<a name="l03597"></a>03597       res = sendto(rtp-&gt;<a class="code" href="structast__rtp.html#a339d22b3e442946380f98ed19e320db2">s</a>, (<span class="keywordtype">void</span> *)rtpheader, hdrlen + 1, 0, (<span class="keyword">struct</span> sockaddr *)&amp;rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>, <span class="keyword">sizeof</span>(rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>));
<a name="l03598"></a>03598       <span class="keywordflow">if</span> (res &lt;0) 
<a name="l03599"></a>03599          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;RTP Comfort Noise Transmission error to %s:%d: %s\n&quot;</span>, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr), ntohs(rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port), strerror(errno));
<a name="l03600"></a>03600       <span class="keywordflow">if</span> (<a class="code" href="rtp_8c.html#a204c446f295fb302b05363d78f2d8d34">rtp_debug_test_addr</a>(&amp;rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>))
<a name="l03601"></a>03601          <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;Sent Comfort Noise RTP packet to %s:%u (type %d, seq %u, ts %u, len %d)\n&quot;</span>
<a name="l03602"></a>03602                , <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr), ntohs(rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port), payload, rtp-&gt;<a class="code" href="structast__rtp.html#a66d741481aec999a0e8bc17f70db4ebe">seqno</a>, rtp-&gt;<a class="code" href="structast__rtp.html#a2eb3b9494c999b0dd38c4d40bfdc55b4">lastts</a>,res - hdrlen);         
<a name="l03603"></a>03603          
<a name="l03604"></a>03604    }
<a name="l03605"></a>03605    <span class="keywordflow">return</span> 0;
<a name="l03606"></a>03606 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad67b565977122712cc970d5a12f124b2"></a><!-- doxytag: member="rtp.h::ast_rtp_senddigit_begin" ref="ad67b565977122712cc970d5a12f124b2" args="(struct ast_rtp *rtp, char digit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_rtp_senddigit_begin </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>digit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Send begin frames for DTMF. </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l03141">3141</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="utils_8c_source.html#l00431">ast_inet_ntoa()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="rtp_8h_source.html#l00043">AST_RTP_DTMF</a>, <a class="el" href="rtp_8c_source.html#l02360">ast_rtp_lookup_code()</a>, <a class="el" href="time_8h_source.html#l00164">ast_tv()</a>, <a class="el" href="utils_8c_source.html#l01365">ast_tvadd()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="logger_8h_source.html#l00079">ast_verbose</a>, <a class="el" href="rtp_8c_source.html#l00154">ast_rtp::dtmfmute</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="rtp_8c_source.html#l00140">ast_rtp::lastdigitts</a>, <a class="el" href="rtp_8c_source.html#l00109">ast_rtp::lastts</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="rtp_8c_source.html#l00896">rtp_debug_test_addr()</a>, <a class="el" href="rtp_8c_source.html#l00103">ast_rtp::s</a>, <a class="el" href="rtp_8c_source.html#l00142">ast_rtp::send_digit</a>, <a class="el" href="rtp_8c_source.html#l00144">ast_rtp::send_duration</a>, <a class="el" href="rtp_8c_source.html#l00143">ast_rtp::send_payload</a>, <a class="el" href="rtp_8c_source.html#l00141">ast_rtp::sending_digit</a>, <a class="el" href="rtp_8c_source.html#l00157">ast_rtp::seqno</a>, <a class="el" href="rtp_8c_source.html#l00106">ast_rtp::ssrc</a>, and <a class="el" href="rtp_8c_source.html#l00148">ast_rtp::them</a>.</p>

<p>Referenced by <a class="el" href="chan__mgcp_8c_source.html#l01289">mgcp_senddigit_begin()</a>, <a class="el" href="chan__h323_8c_source.html#l00499">oh323_digit_begin()</a>, and <a class="el" href="chan__sip_8c_source.html#l06358">sip_senddigit_begin()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03142"></a>03142 {
<a name="l03143"></a>03143    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *rtpheader;
<a name="l03144"></a>03144    <span class="keywordtype">int</span> hdrlen = 12, res = 0, i = 0, payload = 0;
<a name="l03145"></a>03145    <span class="keywordtype">char</span> <a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>[256];
<a name="l03146"></a>03146 
<a name="l03147"></a>03147    <span class="keywordflow">if</span> ((digit &lt;= <span class="charliteral">&apos;9&apos;</span>) &amp;&amp; (digit &gt;= <span class="charliteral">&apos;0&apos;</span>))
<a name="l03148"></a>03148       digit -= <span class="charliteral">&apos;0&apos;</span>;
<a name="l03149"></a>03149    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (digit == <span class="charliteral">&apos;*&apos;</span>)
<a name="l03150"></a>03150       digit = 10;
<a name="l03151"></a>03151    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (digit == <span class="charliteral">&apos;#&apos;</span>)
<a name="l03152"></a>03152       digit = 11;
<a name="l03153"></a>03153    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((digit &gt;= <span class="charliteral">&apos;A&apos;</span>) &amp;&amp; (digit &lt;= <span class="charliteral">&apos;D&apos;</span>))
<a name="l03154"></a>03154       digit = digit - <span class="charliteral">&apos;A&apos;</span> + 12;
<a name="l03155"></a>03155    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((digit &gt;= <span class="charliteral">&apos;a&apos;</span>) &amp;&amp; (digit &lt;= <span class="charliteral">&apos;d&apos;</span>))
<a name="l03156"></a>03156       digit = digit - <span class="charliteral">&apos;a&apos;</span> + 12;
<a name="l03157"></a>03157    <span class="keywordflow">else</span> {
<a name="l03158"></a>03158       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Don&apos;t know how to represent &apos;%c&apos;\n&quot;</span>, digit);
<a name="l03159"></a>03159       <span class="keywordflow">return</span> 0;
<a name="l03160"></a>03160    }
<a name="l03161"></a>03161 
<a name="l03162"></a>03162    <span class="comment">/* If we have no peer, return immediately */</span> 
<a name="l03163"></a>03163    <span class="keywordflow">if</span> (!rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr.s_addr || !rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port)
<a name="l03164"></a>03164       <span class="keywordflow">return</span> 0;
<a name="l03165"></a>03165 
<a name="l03166"></a>03166    payload = <a class="code" href="rtp_8h.html#a4daa559b8f2ef25bc33d8f5d8fd937d1" title="Looks up an RTP code out of our *static* outbound list.">ast_rtp_lookup_code</a>(rtp, 0, <a class="code" href="rtp_8h.html#a3cc8001677e3b955b9b5ceb4267a76ec">AST_RTP_DTMF</a>);
<a name="l03167"></a>03167 
<a name="l03168"></a>03168    rtp-&gt;<a class="code" href="structast__rtp.html#acb642f88034264b2a2e1ef4a89647909">dtmfmute</a> = <a class="code" href="time_8h.html#a97e1bb8fbd7a103212789e87e7ed6073" title="Returns the sum of two timevals a + b.">ast_tvadd</a>(<a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>(), <a class="code" href="time_8h.html#af46dec59fc43982d018a757f7b499669" title="Returns a timeval from sec, usec.">ast_tv</a>(0, 500000));
<a name="l03169"></a>03169    rtp-&gt;<a class="code" href="structast__rtp.html#a852e7cb93889aa792fe4be8e5cfdf1ab">send_duration</a> = 160;
<a name="l03170"></a>03170    rtp-&gt;<a class="code" href="structast__rtp.html#aed4ece79ac99ad5381829fc0392bc542">lastdigitts</a> = rtp-&gt;<a class="code" href="structast__rtp.html#a2eb3b9494c999b0dd38c4d40bfdc55b4">lastts</a> + rtp-&gt;<a class="code" href="structast__rtp.html#a852e7cb93889aa792fe4be8e5cfdf1ab">send_duration</a>;
<a name="l03171"></a>03171    
<a name="l03172"></a>03172    <span class="comment">/* Get a pointer to the header */</span>
<a name="l03173"></a>03173    rtpheader = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *)data;
<a name="l03174"></a>03174    rtpheader[0] = htonl((2 &lt;&lt; 30) | (1 &lt;&lt; 23) | (payload &lt;&lt; 16) | (rtp-&gt;<a class="code" href="structast__rtp.html#a66d741481aec999a0e8bc17f70db4ebe">seqno</a>));
<a name="l03175"></a>03175    rtpheader[1] = htonl(rtp-&gt;<a class="code" href="structast__rtp.html#aed4ece79ac99ad5381829fc0392bc542">lastdigitts</a>);
<a name="l03176"></a>03176    rtpheader[2] = htonl(rtp-&gt;<a class="code" href="structast__rtp.html#a9e10385ac55d32d10ef322d1a08a699d">ssrc</a>); 
<a name="l03177"></a>03177 
<a name="l03178"></a>03178    <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) {
<a name="l03179"></a>03179       rtpheader[3] = htonl((digit &lt;&lt; 24) | (0xa &lt;&lt; 16) | (rtp-&gt;<a class="code" href="structast__rtp.html#a852e7cb93889aa792fe4be8e5cfdf1ab">send_duration</a>));
<a name="l03180"></a>03180       res = sendto(rtp-&gt;<a class="code" href="structast__rtp.html#a339d22b3e442946380f98ed19e320db2">s</a>, (<span class="keywordtype">void</span> *) rtpheader, hdrlen + 4, 0, (<span class="keyword">struct</span> sockaddr *) &amp;rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>, <span class="keyword">sizeof</span>(rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>));
<a name="l03181"></a>03181       <span class="keywordflow">if</span> (res &lt; 0) 
<a name="l03182"></a>03182          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;RTP Transmission error to %s:%u: %s\n&quot;</span>,
<a name="l03183"></a>03183             <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr),
<a name="l03184"></a>03184             ntohs(rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port), strerror(errno));
<a name="l03185"></a>03185       <span class="keywordflow">if</span> (<a class="code" href="rtp_8c.html#a204c446f295fb302b05363d78f2d8d34">rtp_debug_test_addr</a>(&amp;rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>))
<a name="l03186"></a>03186          <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;Sent RTP DTMF packet to %s:%u (type %-2.2d, seq %-6.6u, ts %-6.6u, len %-6.6u)\n&quot;</span>,
<a name="l03187"></a>03187                 <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr),
<a name="l03188"></a>03188                 ntohs(rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port), payload, rtp-&gt;<a class="code" href="structast__rtp.html#a66d741481aec999a0e8bc17f70db4ebe">seqno</a>, rtp-&gt;<a class="code" href="structast__rtp.html#aed4ece79ac99ad5381829fc0392bc542">lastdigitts</a>, res - hdrlen);
<a name="l03189"></a>03189       <span class="comment">/* Increment sequence number */</span>
<a name="l03190"></a>03190       rtp-&gt;<a class="code" href="structast__rtp.html#a66d741481aec999a0e8bc17f70db4ebe">seqno</a>++;
<a name="l03191"></a>03191       <span class="comment">/* Increment duration */</span>
<a name="l03192"></a>03192       rtp-&gt;<a class="code" href="structast__rtp.html#a852e7cb93889aa792fe4be8e5cfdf1ab">send_duration</a> += 160;
<a name="l03193"></a>03193       <span class="comment">/* Clear marker bit and set seqno */</span>
<a name="l03194"></a>03194       rtpheader[0] = htonl((2 &lt;&lt; 30) | (payload &lt;&lt; 16) | (rtp-&gt;<a class="code" href="structast__rtp.html#a66d741481aec999a0e8bc17f70db4ebe">seqno</a>));
<a name="l03195"></a>03195    }
<a name="l03196"></a>03196 
<a name="l03197"></a>03197    <span class="comment">/* Since we received a begin, we can safely store the digit and disable any compensation */</span>
<a name="l03198"></a>03198    rtp-&gt;<a class="code" href="structast__rtp.html#af637078f896cfd75467174c20d0cb217">sending_digit</a> = 1;
<a name="l03199"></a>03199    rtp-&gt;<a class="code" href="structast__rtp.html#a0ed4b8b544ecc0632341499d5a8f199e">send_digit</a> = digit;
<a name="l03200"></a>03200    rtp-&gt;<a class="code" href="structast__rtp.html#a73a34cdfca2c2e6b2dec74be721db576">send_payload</a> = payload;
<a name="l03201"></a>03201 
<a name="l03202"></a>03202    <span class="keywordflow">return</span> 0;
<a name="l03203"></a>03203 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a75bc4adaf04f7e5348fc73608c3b1ebc"></a><!-- doxytag: member="rtp.h::ast_rtp_senddigit_end" ref="a75bc4adaf04f7e5348fc73608c3b1ebc" args="(struct ast_rtp *rtp, char digit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_rtp_senddigit_end </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>digit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Send end packets for DTMF. </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l03243">3243</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="utils_8c_source.html#l00431">ast_inet_ntoa()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="time_8h_source.html#l00164">ast_tv()</a>, <a class="el" href="utils_8c_source.html#l01365">ast_tvadd()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="logger_8h_source.html#l00079">ast_verbose</a>, <a class="el" href="rtp_8c_source.html#l00154">ast_rtp::dtmfmute</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="rtp_8c_source.html#l00140">ast_rtp::lastdigitts</a>, <a class="el" href="rtp_8c_source.html#l00109">ast_rtp::lastts</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="rtp_8c_source.html#l00896">rtp_debug_test_addr()</a>, <a class="el" href="rtp_8c_source.html#l00103">ast_rtp::s</a>, <a class="el" href="rtp_8c_source.html#l00142">ast_rtp::send_digit</a>, <a class="el" href="rtp_8c_source.html#l00144">ast_rtp::send_duration</a>, <a class="el" href="rtp_8c_source.html#l00143">ast_rtp::send_payload</a>, <a class="el" href="rtp_8c_source.html#l00141">ast_rtp::sending_digit</a>, <a class="el" href="rtp_8c_source.html#l00157">ast_rtp::seqno</a>, <a class="el" href="rtp_8c_source.html#l00106">ast_rtp::ssrc</a>, and <a class="el" href="rtp_8c_source.html#l00148">ast_rtp::them</a>.</p>

<p>Referenced by <a class="el" href="chan__mgcp_8c_source.html#l01310">mgcp_senddigit_end()</a>, <a class="el" href="chan__h323_8c_source.html#l00540">oh323_digit_end()</a>, and <a class="el" href="chan__sip_8c_source.html#l06382">sip_senddigit_end()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03244"></a>03244 {
<a name="l03245"></a>03245    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *rtpheader;
<a name="l03246"></a>03246    <span class="keywordtype">int</span> hdrlen = 12, res = 0, i = 0;
<a name="l03247"></a>03247    <span class="keywordtype">char</span> <a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>[256];
<a name="l03248"></a>03248    
<a name="l03249"></a>03249    <span class="comment">/* If no address, then bail out */</span>
<a name="l03250"></a>03250    <span class="keywordflow">if</span> (!rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr.s_addr || !rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port)
<a name="l03251"></a>03251       <span class="keywordflow">return</span> 0;
<a name="l03252"></a>03252    
<a name="l03253"></a>03253    <span class="keywordflow">if</span> ((digit &lt;= <span class="charliteral">&apos;9&apos;</span>) &amp;&amp; (digit &gt;= <span class="charliteral">&apos;0&apos;</span>))
<a name="l03254"></a>03254       digit -= <span class="charliteral">&apos;0&apos;</span>;
<a name="l03255"></a>03255    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (digit == <span class="charliteral">&apos;*&apos;</span>)
<a name="l03256"></a>03256       digit = 10;
<a name="l03257"></a>03257    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (digit == <span class="charliteral">&apos;#&apos;</span>)
<a name="l03258"></a>03258       digit = 11;
<a name="l03259"></a>03259    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((digit &gt;= <span class="charliteral">&apos;A&apos;</span>) &amp;&amp; (digit &lt;= <span class="charliteral">&apos;D&apos;</span>))
<a name="l03260"></a>03260       digit = digit - <span class="charliteral">&apos;A&apos;</span> + 12;
<a name="l03261"></a>03261    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((digit &gt;= <span class="charliteral">&apos;a&apos;</span>) &amp;&amp; (digit &lt;= <span class="charliteral">&apos;d&apos;</span>))
<a name="l03262"></a>03262       digit = digit - <span class="charliteral">&apos;a&apos;</span> + 12;
<a name="l03263"></a>03263    <span class="keywordflow">else</span> {
<a name="l03264"></a>03264       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Don&apos;t know how to represent &apos;%c&apos;\n&quot;</span>, digit);
<a name="l03265"></a>03265       <span class="keywordflow">return</span> 0;
<a name="l03266"></a>03266    }
<a name="l03267"></a>03267 
<a name="l03268"></a>03268    rtp-&gt;<a class="code" href="structast__rtp.html#acb642f88034264b2a2e1ef4a89647909">dtmfmute</a> = <a class="code" href="time_8h.html#a97e1bb8fbd7a103212789e87e7ed6073" title="Returns the sum of two timevals a + b.">ast_tvadd</a>(<a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>(), <a class="code" href="time_8h.html#af46dec59fc43982d018a757f7b499669" title="Returns a timeval from sec, usec.">ast_tv</a>(0, 500000));
<a name="l03269"></a>03269 
<a name="l03270"></a>03270    rtpheader = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *)data;
<a name="l03271"></a>03271    rtpheader[1] = htonl(rtp-&gt;<a class="code" href="structast__rtp.html#aed4ece79ac99ad5381829fc0392bc542">lastdigitts</a>);
<a name="l03272"></a>03272    rtpheader[2] = htonl(rtp-&gt;<a class="code" href="structast__rtp.html#a9e10385ac55d32d10ef322d1a08a699d">ssrc</a>);
<a name="l03273"></a>03273    rtpheader[3] = htonl((digit &lt;&lt; 24) | (0xa &lt;&lt; 16) | (rtp-&gt;<a class="code" href="structast__rtp.html#a852e7cb93889aa792fe4be8e5cfdf1ab">send_duration</a>));
<a name="l03274"></a>03274    <span class="comment">/* Set end bit */</span>
<a name="l03275"></a>03275    rtpheader[3] |= htonl((1 &lt;&lt; 23));
<a name="l03276"></a>03276 
<a name="l03277"></a>03277    <span class="comment">/* Send 3 termination packets */</span>
<a name="l03278"></a>03278    <span class="keywordflow">for</span> (i = 0; i &lt; 3; i++) {
<a name="l03279"></a>03279       rtpheader[0] = htonl((2 &lt;&lt; 30) | (rtp-&gt;<a class="code" href="structast__rtp.html#a73a34cdfca2c2e6b2dec74be721db576">send_payload</a> &lt;&lt; 16) | (rtp-&gt;<a class="code" href="structast__rtp.html#a66d741481aec999a0e8bc17f70db4ebe">seqno</a>));
<a name="l03280"></a>03280       res = sendto(rtp-&gt;<a class="code" href="structast__rtp.html#a339d22b3e442946380f98ed19e320db2">s</a>, (<span class="keywordtype">void</span> *) rtpheader, hdrlen + 4, 0, (<span class="keyword">struct</span> sockaddr *) &amp;rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>, <span class="keyword">sizeof</span>(rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>));
<a name="l03281"></a>03281       rtp-&gt;<a class="code" href="structast__rtp.html#a66d741481aec999a0e8bc17f70db4ebe">seqno</a>++;
<a name="l03282"></a>03282       <span class="keywordflow">if</span> (res &lt; 0)
<a name="l03283"></a>03283          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;RTP Transmission error to %s:%d: %s\n&quot;</span>,
<a name="l03284"></a>03284             <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr),
<a name="l03285"></a>03285             ntohs(rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port), strerror(errno));
<a name="l03286"></a>03286       <span class="keywordflow">if</span> (<a class="code" href="rtp_8c.html#a204c446f295fb302b05363d78f2d8d34">rtp_debug_test_addr</a>(&amp;rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>))
<a name="l03287"></a>03287          <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;Sent RTP DTMF packet to %s:%u (type %-2.2d, seq %-6.6u, ts %-6.6u, len %-6.6u)\n&quot;</span>,
<a name="l03288"></a>03288                 <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr),
<a name="l03289"></a>03289                 ntohs(rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port), rtp-&gt;<a class="code" href="structast__rtp.html#a73a34cdfca2c2e6b2dec74be721db576">send_payload</a>, rtp-&gt;<a class="code" href="structast__rtp.html#a66d741481aec999a0e8bc17f70db4ebe">seqno</a>, rtp-&gt;<a class="code" href="structast__rtp.html#aed4ece79ac99ad5381829fc0392bc542">lastdigitts</a>, res - hdrlen);
<a name="l03290"></a>03290    }
<a name="l03291"></a>03291    rtp-&gt;<a class="code" href="structast__rtp.html#a2eb3b9494c999b0dd38c4d40bfdc55b4">lastts</a> += rtp-&gt;<a class="code" href="structast__rtp.html#a852e7cb93889aa792fe4be8e5cfdf1ab">send_duration</a>;
<a name="l03292"></a>03292    rtp-&gt;<a class="code" href="structast__rtp.html#af637078f896cfd75467174c20d0cb217">sending_digit</a> = 0;
<a name="l03293"></a>03293    rtp-&gt;<a class="code" href="structast__rtp.html#a0ed4b8b544ecc0632341499d5a8f199e">send_digit</a> = 0;
<a name="l03294"></a>03294 
<a name="l03295"></a>03295    <span class="keywordflow">return</span> res;
<a name="l03296"></a>03296 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac80a75863b5a15612ec319f181c4da7f"></a><!-- doxytag: member="rtp.h::ast_rtp_set_alt_peer" ref="ac80a75863b5a15612ec319f181c4da7f" args="(struct ast_rtp *rtp, struct sockaddr_in *alt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_rtp_set_alt_peer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>alt</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>set potential alternate source for RTP media </p>
<dl class="since"><dt><b>Since:</b></dt><dd>1.4.26 This function may be used to give the RTP stack a hint that there is a potential second source of media. One case where this is used is when the SIP stack receives a REINVITE to which it will be replying with a 491. In such a scenario, the IP and port information in the SDP of that REINVITE lets us know that we may receive media from that source/those sources even though the SIP transaction was unable to be completed successfully</dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rtp</em>&nbsp;</td><td>The RTP structure we wish to set up an alternate host/port on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>alt</em>&nbsp;</td><td>The address information for the alternate media source </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>void</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l02671">2671</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l00235">ast_rtcp::altthem</a>, <a class="el" href="rtp_8c_source.html#l00149">ast_rtp::altthem</a>, and <a class="el" href="rtp_8c_source.html#l00170">ast_rtp::rtcp</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l19641">handle_request_invite()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02672"></a>02672 {
<a name="l02673"></a>02673    rtp-&gt;<a class="code" href="structast__rtp.html#a567178215831a573c88f6370305a2997">altthem</a>.sin_port = alt-&gt;sin_port;
<a name="l02674"></a>02674    rtp-&gt;<a class="code" href="structast__rtp.html#a567178215831a573c88f6370305a2997">altthem</a>.sin_addr = alt-&gt;sin_addr;
<a name="l02675"></a>02675    <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>) {
<a name="l02676"></a>02676       rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a567178215831a573c88f6370305a2997">altthem</a>.sin_port = htons(ntohs(alt-&gt;sin_port) + 1);
<a name="l02677"></a>02677       rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a567178215831a573c88f6370305a2997">altthem</a>.sin_addr = alt-&gt;sin_addr;
<a name="l02678"></a>02678    }
<a name="l02679"></a>02679 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5919a5a4eef238a45254313d782a864c"></a><!-- doxytag: member="rtp.h::ast_rtp_set_callback" ref="a5919a5a4eef238a45254313d782a864c" args="(struct ast_rtp *rtp, ast_rtp_callback callback)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_rtp_set_callback </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="rtp_8h.html#a8d640c81e33ce90c44ae443dbd9f38cb">ast_rtp_callback</a>&nbsp;</td>
          <td class="paramname"> <em>callback</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rtp_8c_source.html#l00796">796</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l00162">ast_rtp::callback</a>.</p>

<p>Referenced by <a class="el" href="chan__mgcp_8c_source.html#l02610">start_rtp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00797"></a>00797 {
<a name="l00798"></a>00798    rtp-&gt;<a class="code" href="structast__rtp.html#ac7c7a9968aa83f15b39dfe8fd533fd34">callback</a> = callback;
<a name="l00799"></a>00799 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4bbc4b17d1c8afe7d831346edf73e6d2"></a><!-- doxytag: member="rtp.h::ast_rtp_set_constantssrc" ref="a4bbc4b17d1c8afe7d831346edf73e6d2" args="(struct ast_rtp *rtp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_rtp_set_constantssrc </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>When changing sources, don't generate a new SSRC. </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l02641">2641</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l00178">ast_rtp::constantssrc</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l05102">create_addr_from_peer()</a>, and <a class="el" href="chan__sip_8c_source.html#l19641">handle_request_invite()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02642"></a>02642 {
<a name="l02643"></a>02643    rtp-&gt;<a class="code" href="structast__rtp.html#a06f00722236fa7f3e3f695e26a37179b">constantssrc</a> = 1;
<a name="l02644"></a>02644 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adeb9cc3c3a7b7b8bf4a7e63e395a56b6"></a><!-- doxytag: member="rtp.h::ast_rtp_set_data" ref="adeb9cc3c3a7b7b8bf4a7e63e395a56b6" args="(struct ast_rtp *rtp, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_rtp_set_data </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rtp_8c_source.html#l00791">791</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l00161">ast_rtp::data</a>.</p>

<p>Referenced by <a class="el" href="chan__mgcp_8c_source.html#l02610">start_rtp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00792"></a>00792 {
<a name="l00793"></a>00793    rtp-&gt;<a class="code" href="structast__rtp.html#a735984d41155bc1032e09bece8f8d66d">data</a> = <a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>;
<a name="l00794"></a>00794 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a83fe16478ba4b99f0bc1798f1064baef"></a><!-- doxytag: member="rtp.h::ast_rtp_set_m_type" ref="a83fe16478ba4b99f0bc1798f1064baef" args="(struct ast_rtp *rtp, int pt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_rtp_set_m_type </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pt</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Activate payload type. </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l02234">2234</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l00166">ast_rtp::current_RTP_PT</a>, <a class="el" href="rtp_8h_source.html#l00052">MAX_RTP_PT</a>, <a class="el" href="rtp_8c_source.html#l00826">rtp_bridge_lock()</a>, and <a class="el" href="rtp_8c_source.html#l00834">rtp_bridge_unlock()</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l00603">gtalk_is_answered()</a>, <a class="el" href="chan__gtalk_8c_source.html#l01154">gtalk_newcall()</a>, <a class="el" href="chan__jingle_8c_source.html#l00954">jingle_newcall()</a>, and <a class="el" href="chan__mgcp_8c_source.html#l01838">process_sdp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02235"></a>02235 {
<a name="l02236"></a>02236    <span class="keywordflow">if</span> (pt &lt; 0 || pt &gt;= <a class="code" href="rtp_8h.html#ac8aa85cd14ebbc20fc0043f6f72b968d">MAX_RTP_PT</a> || <a class="code" href="rtp_8c.html#aee0ddbbc121110ad6d1d3342eddec5f2" title="Mapping between Asterisk codecs and rtp payload types.">static_RTP_PT</a>[pt].code == 0) 
<a name="l02237"></a>02237       <span class="keywordflow">return</span>; <span class="comment">/* bogus payload type */</span>
<a name="l02238"></a>02238 
<a name="l02239"></a>02239    <a class="code" href="rtp_8c.html#a67f38276600b7655f400f5b6c6118f8b">rtp_bridge_lock</a>(rtp);
<a name="l02240"></a>02240    rtp-&gt;<a class="code" href="structast__rtp.html#a326c376c0e9d4d7572cc3706205dbd01">current_RTP_PT</a>[pt] = <a class="code" href="rtp_8c.html#aee0ddbbc121110ad6d1d3342eddec5f2" title="Mapping between Asterisk codecs and rtp payload types.">static_RTP_PT</a>[pt];
<a name="l02241"></a>02241    <a class="code" href="rtp_8c.html#afabb78b03298d9f7b7e26b60ad0d02e4">rtp_bridge_unlock</a>(rtp);
<a name="l02242"></a>02242 } 
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8731e858c93551d3bb56a2f297a9ef59"></a><!-- doxytag: member="rtp.h::ast_rtp_set_peer" ref="a8731e858c93551d3bb56a2f297a9ef59" args="(struct ast_rtp *rtp, struct sockaddr_in *them)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_rtp_set_peer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>them</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rtp_8c_source.html#l02656">2656</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l00170">ast_rtp::rtcp</a>, <a class="el" href="rtp_8c_source.html#l00158">ast_rtp::rxseqno</a>, <a class="el" href="rtp_8c_source.html#l00087">STRICT_RTP_LEARN</a>, <a class="el" href="rtp_8c_source.html#l00174">ast_rtp::strict_rtp_state</a>, <a class="el" href="rtp_8c_source.html#l00234">ast_rtcp::them</a>, and <a class="el" href="rtp_8c_source.html#l00148">ast_rtp::them</a>.</p>

<p>Referenced by <a class="el" href="chan__skinny_8c_source.html#l05511">handle_open_receive_channel_ack_message()</a>, <a class="el" href="chan__mgcp_8c_source.html#l01838">process_sdp()</a>, <a class="el" href="chan__h323_8c_source.html#l01936">setup_rtp_connection()</a>, and <a class="el" href="chan__unistim_8c_source.html#l02028">start_rtp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02657"></a>02657 {
<a name="l02658"></a>02658    rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port = them-&gt;sin_port;
<a name="l02659"></a>02659    rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr = them-&gt;sin_addr;
<a name="l02660"></a>02660    <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>) {
<a name="l02661"></a>02661       <span class="keywordtype">int</span> h = ntohs(them-&gt;sin_port);
<a name="l02662"></a>02662       rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port = htons(h + 1);
<a name="l02663"></a>02663       rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr = them-&gt;sin_addr;
<a name="l02664"></a>02664    }
<a name="l02665"></a>02665    rtp-&gt;<a class="code" href="structast__rtp.html#a5406ab4bd6c88a7b08f103e810dfff9e">rxseqno</a> = 0;
<a name="l02666"></a>02666    <span class="comment">/* If strict RTP protection is enabled switch back to the learn state so we don&apos;t drop packets from above */</span>
<a name="l02667"></a>02667    <span class="keywordflow">if</span> (<a class="code" href="rtp_8c.html#a96336b3ac9e5b66f365f0ca5ba613995">strictrtp</a>)
<a name="l02668"></a>02668       rtp-&gt;<a class="code" href="structast__rtp.html#a64730d554c32f13303a5a19f39cbd826">strict_rtp_state</a> = <a class="code" href="rtp_8c.html#aca6484d75ee9d79a5d4447149f9c8c4ba0c26c1144bb830775979deb20e049368">STRICT_RTP_LEARN</a>;
<a name="l02669"></a>02669 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3d6eab4ad6579f8616f1f9457aa6bba7"></a><!-- doxytag: member="rtp.h::ast_rtp_set_rtpholdtimeout" ref="a3d6eab4ad6579f8616f1f9457aa6bba7" args="(struct ast_rtp *rtp, int timeout)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_rtp_set_rtpholdtimeout </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>timeout</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set rtp hold timeout. </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l00758">758</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l00130">ast_rtp::rtpholdtimeout</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l22343">check_rtp_timeout()</a>, <a class="el" href="chan__sip_8c_source.html#l05102">create_addr_from_peer()</a>, and <a class="el" href="chan__sip_8c_source.html#l07151">sip_alloc()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00759"></a>00759 {
<a name="l00760"></a>00760    rtp-&gt;<a class="code" href="structast__rtp.html#a9c8c363bb6d84360b92945bb18bb0451">rtpholdtimeout</a> = timeout;
<a name="l00761"></a>00761 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a519628da9d60698b3b630697f6df0ed4"></a><!-- doxytag: member="rtp.h::ast_rtp_set_rtpkeepalive" ref="a519628da9d60698b3b630697f6df0ed4" args="(struct ast_rtp *rtp, int period)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_rtp_set_rtpkeepalive </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>period</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>set RTP keepalive interval </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l00764">764</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l00131">ast_rtp::rtpkeepalive</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l05102">create_addr_from_peer()</a>, and <a class="el" href="chan__sip_8c_source.html#l07151">sip_alloc()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00765"></a>00765 {
<a name="l00766"></a>00766    rtp-&gt;<a class="code" href="structast__rtp.html#a9472cfc2a7a21f124c161f7baaf9d5dc">rtpkeepalive</a> = period;
<a name="l00767"></a>00767 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a02a3ba4e11691cafd933cbb1e6225b3e"></a><!-- doxytag: member="rtp.h::ast_rtp_set_rtpmap_type" ref="a02a3ba4e11691cafd933cbb1e6225b3e" args="(struct ast_rtp *rtp, int pt, char *mimeType, char *mimeSubtype, enum ast_rtp_options options)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_rtp_set_rtpmap_type </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>mimeType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>mimeSubtype</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="rtp_8h.html#a95ccef8388e3b0e9c9639e393d4081b6">ast_rtp_options</a>&nbsp;</td>
          <td class="paramname"> <em>options</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set payload type to a known MIME media type for a codec. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rtp</em>&nbsp;</td><td>RTP structure to modify </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pt</em>&nbsp;</td><td>Payload type entry to modify </td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structmimeType.html">mimeType</a></em>&nbsp;</td><td>top-level MIME type of media stream (typically "audio", "video", "text", etc.) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mimeSubtype</em>&nbsp;</td><td>MIME subtype of media stream (typically a codec name) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>options</em>&nbsp;</td><td>Zero or more flags from the ast_rtp_options enum</td></tr>
  </table>
  </dd>
</dl>
<p>This function 'fills in' an entry in the list of possible <a class="el" href="structformats.html">formats</a> for a media stream associated with an RTP structure.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>if the payload type is out of range </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-2</em>&nbsp;</td><td>if the mimeType/mimeSubtype combination was not found </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l02310">2310</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l02261">ast_rtp_set_rtpmap_type_rate()</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l00951">__oh323_rtp_create()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00603">gtalk_is_answered()</a>, <a class="el" href="chan__gtalk_8c_source.html#l01154">gtalk_newcall()</a>, <a class="el" href="chan__jingle_8c_source.html#l00954">jingle_newcall()</a>, <a class="el" href="chan__mgcp_8c_source.html#l01838">process_sdp()</a>, <a class="el" href="chan__sip_8c_source.html#l08853">process_sdp_a_text()</a>, <a class="el" href="chan__h323_8c_source.html#l02418">set_dtmf_payload()</a>, and <a class="el" href="chan__h323_8c_source.html#l01936">setup_rtp_connection()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02313"></a>02313 {
<a name="l02314"></a>02314    <span class="keywordflow">return</span> <a class="code" href="rtp_8h.html#a1c0ef66aed0fb55f27f44154cce3e238" title="Set payload type to a known MIME media type for a codec with a specific sample rate...">ast_rtp_set_rtpmap_type_rate</a>(rtp, pt, <a class="code" href="structmimeType.html">mimeType</a>, mimeSubtype, options, 0);
<a name="l02315"></a>02315 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1c0ef66aed0fb55f27f44154cce3e238"></a><!-- doxytag: member="rtp.h::ast_rtp_set_rtpmap_type_rate" ref="a1c0ef66aed0fb55f27f44154cce3e238" args="(struct ast_rtp *rtp, int pt, char *mimeType, char *mimeSubtype, enum ast_rtp_options options, unsigned int sample_rate)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_rtp_set_rtpmap_type_rate </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>mimeType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>mimeSubtype</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="rtp_8h.html#a95ccef8388e3b0e9c9639e393d4081b6">ast_rtp_options</a>&nbsp;</td>
          <td class="paramname"> <em>options</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>sample_rate</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set payload type to a known MIME media type for a codec with a specific sample rate. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rtp</em>&nbsp;</td><td>RTP structure to modify </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pt</em>&nbsp;</td><td>Payload type entry to modify </td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structmimeType.html">mimeType</a></em>&nbsp;</td><td>top-level MIME type of media stream (typically "audio", "video", "text", etc.) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mimeSubtype</em>&nbsp;</td><td>MIME subtype of media stream (typically a codec name) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>options</em>&nbsp;</td><td>Zero or more flags from the ast_rtp_options enum </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sample_rate</em>&nbsp;</td><td>The sample rate of the media stream</td></tr>
  </table>
  </dd>
</dl>
<p>This function 'fills in' an entry in the list of possible <a class="el" href="structformats.html">formats</a> for a media stream associated with an RTP structure.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>if the payload type is out of range </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-2</em>&nbsp;</td><td>if the mimeType/mimeSubtype combination was not found</td></tr>
  </table>
  </dd>
</dl>
<p>Set payload type to a known MIME media type for a codec with a specific sample rate.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 if the MIME type was found and set, -1 if it wasn't found </dd></dl>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l02261">2261</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="frame_8h_source.html#l00263">AST_FORMAT_G726</a>, <a class="el" href="frame_8h_source.html#l00249">AST_FORMAT_G726_AAL2</a>, <a class="el" href="rtp_8h_source.html#l00060">AST_RTP_OPT_G726_NONSTANDARD</a>, <a class="el" href="rtp_8h_source.html#l00090">rtpPayloadType::code</a>, <a class="el" href="rtp_8c_source.html#l00166">ast_rtp::current_RTP_PT</a>, <a class="el" href="rtp_8h_source.html#l00089">rtpPayloadType::isAstFormat</a>, <a class="el" href="rtp_8h_source.html#l00052">MAX_RTP_PT</a>, <a class="el" href="rtp_8c.html#ac28159d67093186b89f90cc742d611f4">mimeTypes</a>, <a class="el" href="rtp_8c_source.html#l01906">mimeType::payloadType</a>, <a class="el" href="rtp_8c_source.html#l00826">rtp_bridge_lock()</a>, <a class="el" href="rtp_8c_source.html#l00834">rtp_bridge_unlock()</a>, <a class="el" href="rtp_8c_source.html#l01909">mimeType::sample_rate</a>, <a class="el" href="rtp_8c_source.html#l01908">mimeType::subtype</a>, and <a class="el" href="rtp_8c_source.html#l01907">mimeType::type</a>.</p>

<p>Referenced by <a class="el" href="rtp_8c_source.html#l02310">ast_rtp_set_rtpmap_type()</a>, <a class="el" href="chan__sip_8c_source.html#l08730">process_sdp_a_audio()</a>, and <a class="el" href="chan__sip_8c_source.html#l08819">process_sdp_a_video()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02265"></a>02265 {
<a name="l02266"></a>02266    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
<a name="l02267"></a>02267    <span class="keywordtype">int</span> found = 0;
<a name="l02268"></a>02268 
<a name="l02269"></a>02269    <span class="keywordflow">if</span> (pt &lt; 0 || pt &gt;= <a class="code" href="rtp_8h.html#ac8aa85cd14ebbc20fc0043f6f72b968d">MAX_RTP_PT</a>)
<a name="l02270"></a>02270       <span class="keywordflow">return</span> -1; <span class="comment">/* bogus payload type */</span>
<a name="l02271"></a>02271 
<a name="l02272"></a>02272    <a class="code" href="rtp_8c.html#a67f38276600b7655f400f5b6c6118f8b">rtp_bridge_lock</a>(rtp);
<a name="l02273"></a>02273 
<a name="l02274"></a>02274    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="rtp_8c.html#ac28159d67093186b89f90cc742d611f4">mimeTypes</a>); ++i) {
<a name="l02275"></a>02275       <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structmimeType.html">mimeType</a> *t = &amp;<a class="code" href="rtp_8c.html#ac28159d67093186b89f90cc742d611f4">mimeTypes</a>[i];
<a name="l02276"></a>02276 
<a name="l02277"></a>02277       <span class="keywordflow">if</span> (strcasecmp(mimeSubtype, t-&gt;<a class="code" href="structmimeType.html#a2f076846fbd6b30183ba3ab61e3334e5">subtype</a>)) {
<a name="l02278"></a>02278          <span class="keywordflow">continue</span>;
<a name="l02279"></a>02279       }
<a name="l02280"></a>02280 
<a name="l02281"></a>02281       <span class="keywordflow">if</span> (strcasecmp(<a class="code" href="structmimeType.html">mimeType</a>, t-&gt;<a class="code" href="structmimeType.html#a23506fc4821ab6d9671f3e6222591a96">type</a>)) {
<a name="l02282"></a>02282          <span class="keywordflow">continue</span>;
<a name="l02283"></a>02283       }
<a name="l02284"></a>02284 
<a name="l02285"></a>02285       <span class="comment">/* if both sample rates have been supplied, and they don&apos;t match,</span>
<a name="l02286"></a>02286 <span class="comment">         then this not a match; if one has not been supplied, then the</span>
<a name="l02287"></a>02287 <span class="comment">         rates are not compared */</span>
<a name="l02288"></a>02288       <span class="keywordflow">if</span> (<a class="code" href="structmimeType.html#a1c086f81c095b0efd7a87ee29fc5ba7e">sample_rate</a> &amp;&amp; t-&gt;<a class="code" href="structmimeType.html#a1c086f81c095b0efd7a87ee29fc5ba7e">sample_rate</a> &amp;&amp;
<a name="l02289"></a>02289           (<a class="code" href="structmimeType.html#a1c086f81c095b0efd7a87ee29fc5ba7e">sample_rate</a> != t-&gt;<a class="code" href="structmimeType.html#a1c086f81c095b0efd7a87ee29fc5ba7e">sample_rate</a>)) {
<a name="l02290"></a>02290          <span class="keywordflow">continue</span>;
<a name="l02291"></a>02291       }
<a name="l02292"></a>02292 
<a name="l02293"></a>02293       found = 1;
<a name="l02294"></a>02294       rtp-&gt;<a class="code" href="structast__rtp.html#a326c376c0e9d4d7572cc3706205dbd01">current_RTP_PT</a>[pt] = t-&gt;<a class="code" href="structmimeType.html#a18e919f09824102c5924529a8e2bf3a5">payloadType</a>;
<a name="l02295"></a>02295 
<a name="l02296"></a>02296       <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="structmimeType.html#a18e919f09824102c5924529a8e2bf3a5">payloadType</a>.<a class="code" href="structrtpPayloadType.html#a45a5b7c00a796a23f01673cef1dbe0a9">code</a> == <a class="code" href="frame_8h.html#a030c77081bc2aff5ae5a384769f46418">AST_FORMAT_G726</a>) &amp;&amp;
<a name="l02297"></a>02297           t-&gt;<a class="code" href="structmimeType.html#a18e919f09824102c5924529a8e2bf3a5">payloadType</a>.<a class="code" href="structrtpPayloadType.html#a6916911180850cb1b6045fa9b6927b02">isAstFormat</a> &amp;&amp;
<a name="l02298"></a>02298           (options &amp; <a class="code" href="rtp_8h.html#a95ccef8388e3b0e9c9639e393d4081b6ad570d49420fe15c4660793d1fc2f0fc8">AST_RTP_OPT_G726_NONSTANDARD</a>)) {
<a name="l02299"></a>02299          rtp-&gt;<a class="code" href="structast__rtp.html#a326c376c0e9d4d7572cc3706205dbd01">current_RTP_PT</a>[pt].<a class="code" href="structrtpPayloadType.html#a45a5b7c00a796a23f01673cef1dbe0a9">code</a> = <a class="code" href="frame_8h.html#a536fbd427f197a33e679c7721afad420">AST_FORMAT_G726_AAL2</a>;
<a name="l02300"></a>02300       }
<a name="l02301"></a>02301 
<a name="l02302"></a>02302       <span class="keywordflow">break</span>;
<a name="l02303"></a>02303    }
<a name="l02304"></a>02304 
<a name="l02305"></a>02305    <a class="code" href="rtp_8c.html#afabb78b03298d9f7b7e26b60ad0d02e4">rtp_bridge_unlock</a>(rtp);
<a name="l02306"></a>02306 
<a name="l02307"></a>02307    <span class="keywordflow">return</span> (found ? 0 : -2);
<a name="l02308"></a>02308 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a30d6a83648ee8345a70aa1a2ccd311c7"></a><!-- doxytag: member="rtp.h::ast_rtp_set_rtptimeout" ref="a30d6a83648ee8345a70aa1a2ccd311c7" args="(struct ast_rtp *rtp, int timeout)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_rtp_set_rtptimeout </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>timeout</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set rtp timeout. </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l00752">752</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l00129">ast_rtp::rtptimeout</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l22343">check_rtp_timeout()</a>, <a class="el" href="chan__sip_8c_source.html#l05102">create_addr_from_peer()</a>, and <a class="el" href="chan__sip_8c_source.html#l07151">sip_alloc()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00753"></a>00753 {
<a name="l00754"></a>00754    rtp-&gt;<a class="code" href="structast__rtp.html#a96c64be67b0bcd897efa8db0eced9ab8">rtptimeout</a> = timeout;
<a name="l00755"></a>00755 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa50e1394275ae2a2fd61da5659c5cb57"></a><!-- doxytag: member="rtp.h::ast_rtp_set_rtptimers_onhold" ref="aa50e1394275ae2a2fd61da5659c5cb57" args="(struct ast_rtp *rtp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_rtp_set_rtptimers_onhold </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rtp_8c_source.html#l00745">745</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l00130">ast_rtp::rtpholdtimeout</a>, and <a class="el" href="rtp_8c_source.html#l00129">ast_rtp::rtptimeout</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l17572">handle_response_invite()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00746"></a>00746 {
<a name="l00747"></a>00747    rtp-&gt;<a class="code" href="structast__rtp.html#a96c64be67b0bcd897efa8db0eced9ab8">rtptimeout</a> = (-1) * rtp-&gt;<a class="code" href="structast__rtp.html#a96c64be67b0bcd897efa8db0eced9ab8">rtptimeout</a>;
<a name="l00748"></a>00748    rtp-&gt;<a class="code" href="structast__rtp.html#a9c8c363bb6d84360b92945bb18bb0451">rtpholdtimeout</a> = (-1) * rtp-&gt;<a class="code" href="structast__rtp.html#a9c8c363bb6d84360b92945bb18bb0451">rtpholdtimeout</a>;
<a name="l00749"></a>00749 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a787203f0e9b0ad978ee7d381cb280d2a"></a><!-- doxytag: member="rtp.h::ast_rtp_set_vars" ref="a787203f0e9b0ad978ee7d381cb280d2a" args="(struct ast_channel *chan, struct ast_rtp *rtp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_rtp_set_vars </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set RTPAUDIOQOS(...) variables on a channel when it is being hung up. </p>
<dl class="since"><dt><b>Since:</b></dt><dd>1.6.1 </dd></dl>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l02835">2835</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l04733">ast_bridged_channel()</a>, <a class="el" href="rtp_8c_source.html#l03027">ast_rtp_get_quality()</a>, <a class="el" href="channel_8h_source.html#l00498">ast_channel::bridge</a>, <a class="el" href="pbx_8c_source.html#l09023">pbx_builtin_setvar_helper()</a>, <a class="el" href="rtp_8h_source.html#l00111">RTPQOS_JITTER</a>, <a class="el" href="rtp_8h_source.html#l00112">RTPQOS_LOSS</a>, <a class="el" href="rtp_8h_source.html#l00113">RTPQOS_RTT</a>, and <a class="el" href="rtp_8h_source.html#l00110">RTPQOS_SUMMARY</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l21024">handle_request_bye()</a>, and <a class="el" href="chan__sip_8c_source.html#l05956">sip_hangup()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02835"></a>02835                                                                      {
<a name="l02836"></a>02836    <span class="keywordtype">char</span> *audioqos;
<a name="l02837"></a>02837    <span class="keywordtype">char</span> *audioqos_jitter;
<a name="l02838"></a>02838    <span class="keywordtype">char</span> *audioqos_loss;
<a name="l02839"></a>02839    <span class="keywordtype">char</span> *audioqos_rtt;
<a name="l02840"></a>02840    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="structast__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>;
<a name="l02841"></a>02841 
<a name="l02842"></a>02842    <span class="keywordflow">if</span> (!rtp || !chan)
<a name="l02843"></a>02843       <span class="keywordflow">return</span>;
<a name="l02844"></a>02844 
<a name="l02845"></a>02845    bridge = <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(chan);
<a name="l02846"></a>02846 
<a name="l02847"></a>02847    audioqos        = <a class="code" href="rtp_8h.html#ab704d9412f9a12c656f51baf77f65a08" title="Return RTCP quality string.">ast_rtp_get_quality</a>(rtp, NULL, <a class="code" href="rtp_8h.html#a756ea404ff32087dee22a779a8d277a6a7f88830a41aa42bfb5e25f40f8184019">RTPQOS_SUMMARY</a>);
<a name="l02848"></a>02848    audioqos_jitter = <a class="code" href="rtp_8h.html#ab704d9412f9a12c656f51baf77f65a08" title="Return RTCP quality string.">ast_rtp_get_quality</a>(rtp, NULL, <a class="code" href="rtp_8h.html#a756ea404ff32087dee22a779a8d277a6aa977210a30c7eeab8d2592df4e197d4b">RTPQOS_JITTER</a>);
<a name="l02849"></a>02849    audioqos_loss   = <a class="code" href="rtp_8h.html#ab704d9412f9a12c656f51baf77f65a08" title="Return RTCP quality string.">ast_rtp_get_quality</a>(rtp, NULL, <a class="code" href="rtp_8h.html#a756ea404ff32087dee22a779a8d277a6a06685070e92abe94bdd33cd1abaa30c1">RTPQOS_LOSS</a>);
<a name="l02850"></a>02850    audioqos_rtt    = <a class="code" href="rtp_8h.html#ab704d9412f9a12c656f51baf77f65a08" title="Return RTCP quality string.">ast_rtp_get_quality</a>(rtp, NULL, <a class="code" href="rtp_8h.html#a756ea404ff32087dee22a779a8d277a6acecf9cdfe1b45c0f19c4e9516c0d68ae">RTPQOS_RTT</a>);
<a name="l02851"></a>02851 
<a name="l02852"></a>02852    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;RTPAUDIOQOS&quot;</span>, audioqos);
<a name="l02853"></a>02853    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;RTPAUDIOQOSJITTER&quot;</span>, audioqos_jitter);
<a name="l02854"></a>02854    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;RTPAUDIOQOSLOSS&quot;</span>, audioqos_loss);
<a name="l02855"></a>02855    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;RTPAUDIOQOSRTT&quot;</span>, audioqos_rtt);
<a name="l02856"></a>02856 
<a name="l02857"></a>02857    <span class="keywordflow">if</span> (!bridge)
<a name="l02858"></a>02858       <span class="keywordflow">return</span>;
<a name="l02859"></a>02859 
<a name="l02860"></a>02860    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(bridge, <span class="stringliteral">&quot;RTPAUDIOQOSBRIDGED&quot;</span>, audioqos);
<a name="l02861"></a>02861    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(bridge, <span class="stringliteral">&quot;RTPAUDIOQOSJITTERBRIDGED&quot;</span>, audioqos_jitter);
<a name="l02862"></a>02862    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(bridge, <span class="stringliteral">&quot;RTPAUDIOQOSLOSSBRIDGED&quot;</span>, audioqos_loss);
<a name="l02863"></a>02863    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(bridge, <span class="stringliteral">&quot;RTPAUDIOQOSRTTBRIDGED&quot;</span>, audioqos_rtt);
<a name="l02864"></a>02864 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a60e7859e5819265bbc0ba619f852b0aa"></a><!-- doxytag: member="rtp.h::ast_rtp_setdtmf" ref="a60e7859e5819265bbc0ba619f852b0aa" args="(struct ast_rtp *rtp, int dtmf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_rtp_setdtmf </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>dtmf</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Indicate whether this RTP session is carrying DTMF or not. </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l00811">811</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="utils_8h_source.html#l00092">ast_set2_flag</a>, and <a class="el" href="rtp_8c_source.html#l00213">FLAG_HAS_DTMF</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l05102">create_addr_from_peer()</a>, <a class="el" href="chan__sip_8c_source.html#l19641">handle_request_invite()</a>, <a class="el" href="chan__sip_8c_source.html#l08040">process_sdp()</a>, <a class="el" href="chan__sip_8c_source.html#l07151">sip_alloc()</a>, and <a class="el" href="chan__sip_8c_source.html#l25380">sip_dtmfmode()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00812"></a>00812 {
<a name="l00813"></a>00813    <a class="code" href="utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(rtp, dtmf ? 1 : 0, <a class="code" href="rtp_8c.html#a3da84400ccc8d31229b3c91d505ca7af">FLAG_HAS_DTMF</a>);
<a name="l00814"></a>00814 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af89b655b02f586e920c3a27d06a590b1"></a><!-- doxytag: member="rtp.h::ast_rtp_setdtmfcompensate" ref="af89b655b02f586e920c3a27d06a590b1" args="(struct ast_rtp *rtp, int compensate)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_rtp_setdtmfcompensate </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>compensate</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Compensate for devices that send RFC2833 packets all at once. </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l00816">816</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="utils_8h_source.html#l00092">ast_set2_flag</a>, and <a class="el" href="rtp_8c_source.html#l00217">FLAG_DTMF_COMPENSATE</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l05102">create_addr_from_peer()</a>, <a class="el" href="chan__sip_8c_source.html#l19641">handle_request_invite()</a>, <a class="el" href="chan__sip_8c_source.html#l08040">process_sdp()</a>, and <a class="el" href="chan__sip_8c_source.html#l07151">sip_alloc()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00817"></a>00817 {
<a name="l00818"></a>00818    <a class="code" href="utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(rtp, compensate ? 1 : 0, <a class="code" href="rtp_8c.html#a512509bde2176b98fbdcbceb1a528f6d">FLAG_DTMF_COMPENSATE</a>);
<a name="l00819"></a>00819 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad7fd9b0ac09fc5378dcf120bc5d18c03"></a><!-- doxytag: member="rtp.h::ast_rtp_setnat" ref="ad7fd9b0ac09fc5378dcf120bc5d18c03" args="(struct ast_rtp *rtp, int nat)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_rtp_setnat </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nat</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rtp_8c_source.html#l00801">801</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l00145">ast_rtp::nat</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l00951">__oh323_rtp_create()</a>, <a class="el" href="chan__sip_8c_source.html#l04996">do_setnat()</a>, <a class="el" href="chan__h323_8c_source.html#l00748">oh323_rtp_read()</a>, and <a class="el" href="chan__mgcp_8c_source.html#l02610">start_rtp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00802"></a>00802 {
<a name="l00803"></a>00803    rtp-&gt;<a class="code" href="structast__rtp.html#ada540a5f25f7302dc1a3d17ccfa59b10">nat</a> = <a class="code" href="chan__mgcp_8c.html#ada540a5f25f7302dc1a3d17ccfa59b10">nat</a>;
<a name="l00804"></a>00804 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af8579b7a7b2815a83cd80bf1c23d7824"></a><!-- doxytag: member="rtp.h::ast_rtp_setqos" ref="af8579b7a7b2815a83cd80bf1c23d7824" args="(struct ast_rtp *rtp, int tos, int cos, char *desc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_rtp_setqos </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>tos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>desc</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rtp_8c_source.html#l02636">2636</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="netsock_8c_source.html#l00154">ast_netsock_set_qos()</a>, and <a class="el" href="rtp_8c_source.html#l00103">ast_rtp::s</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l00951">__oh323_rtp_create()</a>, <a class="el" href="chan__sip_8c_source.html#l07151">sip_alloc()</a>, and <a class="el" href="chan__mgcp_8c_source.html#l02610">start_rtp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02637"></a>02637 {
<a name="l02638"></a>02638    <span class="keywordflow">return</span> <a class="code" href="netsock_8h.html#aef64bf03f17c3251f549b08b6620bc24">ast_netsock_set_qos</a>(rtp-&gt;<a class="code" href="structast__rtp.html#a339d22b3e442946380f98ed19e320db2">s</a>, type_of_service, class_of_service, <a class="code" href="channel_8c.html#a710bce51374aba96ab04912897666c35">desc</a>);
<a name="l02639"></a>02639 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7c4ba34d21a78cb29bed9a286858180b"></a><!-- doxytag: member="rtp.h::ast_rtp_setstun" ref="a7c4ba34d21a78cb29bed9a286858180b" args="(struct ast_rtp *rtp, int stun_enable)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_rtp_setstun </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>stun_enable</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Enable STUN capability. </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l00821">821</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="utils_8h_source.html#l00092">ast_set2_flag</a>, and <a class="el" href="rtp_8c_source.html#l00218">FLAG_HAS_STUN</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l00989">gtalk_new()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00822"></a>00822 {
<a name="l00823"></a>00823    <a class="code" href="utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(rtp, stun_enable ? 1 : 0, <a class="code" href="rtp_8c.html#a126661ec52d7d5caab56e2fbfd511d65">FLAG_HAS_STUN</a>);
<a name="l00824"></a>00824 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a55123d53642a71a4bd834fcc0c0f00c5"></a><!-- doxytag: member="rtp.h::ast_rtp_stop" ref="a55123d53642a71a4bd834fcc0c0f00c5" args="(struct ast_rtp *rtp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_rtp_stop </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Stop RTP session, do not destroy structure </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l02710">2710</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="utils_8h_source.html#l00075">ast_clear_flag</a>, <a class="el" href="sched_8h_source.html#l00051">AST_SCHED_DEL</a>, <a class="el" href="rtp_8c_source.html#l00214">FLAG_P2P_SENT_MARK</a>, <a class="el" href="astmm_8h_source.html#l00084">free</a>, <a class="el" href="rtp_8c_source.html#l00179">ast_rtp::red</a>, <a class="el" href="rtp_8c_source.html#l00170">ast_rtp::rtcp</a>, <a class="el" href="rtp_8c_source.html#l00159">ast_rtp::sched</a>, <a class="el" href="rtp_8c_source.html#l00192">rtp_red::schedid</a>, <a class="el" href="rtp_8c_source.html#l00243">ast_rtcp::schedid</a>, <a class="el" href="rtp_8c_source.html#l00234">ast_rtcp::them</a>, and <a class="el" href="rtp_8c_source.html#l00148">ast_rtp::them</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l08040">process_sdp()</a>, <a class="el" href="chan__h323_8c_source.html#l01936">setup_rtp_connection()</a>, and <a class="el" href="chan__sip_8c_source.html#l18253">stop_media_flows()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02711"></a>02711 {
<a name="l02712"></a>02712    <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>) {
<a name="l02713"></a>02713       <a class="code" href="sched_8h.html#a25647782014f8dc012994efcd1b81d32" title="a loop construct to ensure that the scheduled task get deleted. The idea is that...">AST_SCHED_DEL</a>(rtp-&gt;<a class="code" href="structast__rtp.html#aea6233539fc73fc5303bf7525ec27e73">sched</a>, rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#a1083e2d34bb1a32645f4681a7ee78b41">schedid</a>);
<a name="l02714"></a>02714    }
<a name="l02715"></a>02715    <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#af970d6ad39c43d25fcbb1e2bba07189c">red</a>) {
<a name="l02716"></a>02716       <a class="code" href="sched_8h.html#a25647782014f8dc012994efcd1b81d32" title="a loop construct to ensure that the scheduled task get deleted. The idea is that...">AST_SCHED_DEL</a>(rtp-&gt;<a class="code" href="structast__rtp.html#aea6233539fc73fc5303bf7525ec27e73">sched</a>, rtp-&gt;<a class="code" href="structast__rtp.html#af970d6ad39c43d25fcbb1e2bba07189c">red</a>-&gt;<a class="code" href="structrtp__red.html#a1083e2d34bb1a32645f4681a7ee78b41">schedid</a>);
<a name="l02717"></a>02717       <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(rtp-&gt;<a class="code" href="structast__rtp.html#af970d6ad39c43d25fcbb1e2bba07189c">red</a>);
<a name="l02718"></a>02718       rtp-&gt;<a class="code" href="structast__rtp.html#af970d6ad39c43d25fcbb1e2bba07189c">red</a> = NULL;
<a name="l02719"></a>02719    }
<a name="l02720"></a>02720 
<a name="l02721"></a>02721    memset(&amp;rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr, 0, <span class="keyword">sizeof</span>(rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr));
<a name="l02722"></a>02722    memset(&amp;rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port, 0, <span class="keyword">sizeof</span>(rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port));
<a name="l02723"></a>02723    <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>) {
<a name="l02724"></a>02724       memset(&amp;rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr, 0, <span class="keyword">sizeof</span>(rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr));
<a name="l02725"></a>02725       memset(&amp;rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port, 0, <span class="keyword">sizeof</span>(rtp-&gt;<a class="code" href="structast__rtp.html#a76ff89d752f6ec207621cf92c9a93d09">rtcp</a>-&gt;<a class="code" href="structast__rtcp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port));
<a name="l02726"></a>02726    }
<a name="l02727"></a>02727    
<a name="l02728"></a>02728    <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(rtp, <a class="code" href="rtp_8c.html#ad6cbb00f5252760c3114cd269ca05d3c">FLAG_P2P_SENT_MARK</a>);
<a name="l02729"></a>02729 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a07235f64f5a9df68065cfe08ee6d9f44"></a><!-- doxytag: member="rtp.h::ast_rtp_stun_request" ref="a07235f64f5a9df68065cfe08ee6d9f44" args="(struct ast_rtp *rtp, struct sockaddr_in *suggestion, const char *username)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_rtp_stun_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>suggestion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>username</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Send STUN request for an RTP socket Deprecated, this is just a wrapper for <a class="el" href="rtp_8h.html#a07235f64f5a9df68065cfe08ee6d9f44" title="Send STUN request for an RTP socket Deprecated, this is just a wrapper for ast_rtp_stun_request()...">ast_rtp_stun_request()</a>. </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l00700">700</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l00634">ast_stun_request()</a>, and <a class="el" href="rtp_8c_source.html#l00103">ast_rtp::s</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l01256">gtalk_update_stun()</a>, and <a class="el" href="chan__jingle_8c_source.html#l01063">jingle_update_stun()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00701"></a>00701 {
<a name="l00702"></a>00702    <a class="code" href="rtp_8h.html#a494a72723299c0e75e1c2cf092135ea6" title="Generic STUN request send a generic stun request to the server specified.">ast_stun_request</a>(rtp-&gt;<a class="code" href="structast__rtp.html#a339d22b3e442946380f98ed19e320db2">s</a>, suggestion, username, NULL);
<a name="l00703"></a>00703 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af509d36b6cbaefc1c0c5f7c754967555"></a><!-- doxytag: member="rtp.h::ast_rtp_unset_m_type" ref="af509d36b6cbaefc1c0c5f7c754967555" args="(struct ast_rtp *rtp, int pt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_rtp_unset_m_type </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pt</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>clear payload type </p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l02246">2246</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8h_source.html#l00090">rtpPayloadType::code</a>, <a class="el" href="rtp_8c_source.html#l00166">ast_rtp::current_RTP_PT</a>, <a class="el" href="rtp_8h_source.html#l00089">rtpPayloadType::isAstFormat</a>, <a class="el" href="rtp_8h_source.html#l00052">MAX_RTP_PT</a>, <a class="el" href="rtp_8c_source.html#l00826">rtp_bridge_lock()</a>, and <a class="el" href="rtp_8c_source.html#l00834">rtp_bridge_unlock()</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l08730">process_sdp_a_audio()</a>, and <a class="el" href="chan__sip_8c_source.html#l08819">process_sdp_a_video()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02247"></a>02247 {
<a name="l02248"></a>02248    <span class="keywordflow">if</span> (pt &lt; 0 || pt &gt;= <a class="code" href="rtp_8h.html#ac8aa85cd14ebbc20fc0043f6f72b968d">MAX_RTP_PT</a>)
<a name="l02249"></a>02249       <span class="keywordflow">return</span>; <span class="comment">/* bogus payload type */</span>
<a name="l02250"></a>02250 
<a name="l02251"></a>02251    <a class="code" href="rtp_8c.html#a67f38276600b7655f400f5b6c6118f8b">rtp_bridge_lock</a>(rtp);
<a name="l02252"></a>02252    rtp-&gt;<a class="code" href="structast__rtp.html#a326c376c0e9d4d7572cc3706205dbd01">current_RTP_PT</a>[pt].<a class="code" href="structrtpPayloadType.html#a6916911180850cb1b6045fa9b6927b02">isAstFormat</a> = 0;
<a name="l02253"></a>02253    rtp-&gt;<a class="code" href="structast__rtp.html#a326c376c0e9d4d7572cc3706205dbd01">current_RTP_PT</a>[pt].<a class="code" href="structrtpPayloadType.html#a45a5b7c00a796a23f01673cef1dbe0a9">code</a> = 0;
<a name="l02254"></a>02254    <a class="code" href="rtp_8c.html#afabb78b03298d9f7b7e26b60ad0d02e4">rtp_bridge_unlock</a>(rtp);
<a name="l02255"></a>02255 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7a8ffdcbe10f04c3ca29e7cad359a68c"></a><!-- doxytag: member="rtp.h::ast_rtp_write" ref="a7a8ffdcbe10f04c3ca29e7cad359a68c" args="(struct ast_rtp *rtp, struct ast_frame *f)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_rtp_write </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td>
          <td class="paramname"> <em>f</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><dl class="bug"><dt><b><a class="el" href="bug.html#_bug000004">Bug:</a></b></dt><dd>XXX this might never be free'd. Why do we do this? </dd></dl>
</p>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l03790">3790</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="frame_8c_source.html#l01172">ast_codec_pref_getsize()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8h_source.html#l00241">AST_FORMAT_G723_1</a>, <a class="el" href="frame_8h_source.html#l00269">AST_FORMAT_SIREN14</a>, <a class="el" href="frame_8h_source.html#l00267">AST_FORMAT_SIREN7</a>, <a class="el" href="frame_8h_source.html#l00259">AST_FORMAT_SPEEX</a>, <a class="el" href="frame_8h_source.html#l00111">AST_FRAME_TEXT</a>, <a class="el" href="frame_8h_source.html#l00103">AST_FRAME_VIDEO</a>, <a class="el" href="frame_8h_source.html#l00101">AST_FRAME_VOICE</a>, <a class="el" href="frame_8c_source.html#l00474">ast_frdup()</a>, <a class="el" href="frame_8h_source.html#l00462">ast_frfree</a>, <a class="el" href="frame_8c_source.html#l00573">ast_getformatname()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="rtp_8c_source.html#l02360">ast_rtp_lookup_code()</a>, <a class="el" href="rtp_8c_source.html#l03609">ast_rtp_raw_write()</a>, <a class="el" href="frame_8h_source.html#l00565">ast_smoother_feed</a>, <a class="el" href="frame_8h_source.html#l00570">ast_smoother_feed_be</a>, <a class="el" href="frame_8h_source.html#l00355">AST_SMOOTHER_FLAG_BE</a>, <a class="el" href="frame_8c_source.html#l00286">ast_smoother_free()</a>, <a class="el" href="frame_8c_source.html#l00176">ast_smoother_new()</a>, <a class="el" href="frame_8c_source.html#l00236">ast_smoother_read()</a>, <a class="el" href="frame_8c_source.html#l00191">ast_smoother_set_flags()</a>, <a class="el" href="frame_8c_source.html#l00196">ast_smoother_test_flag()</a>, <a class="el" href="frame_8h_source.html#l00440">ast_format_list::cur_ms</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="frame_8h_source.html#l00147">ast_frame::datalen</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="frame_8h_source.html#l00439">ast_format_list::flags</a>, <a class="el" href="frame_8h_source.html#l00434">ast_format_list::fr_len</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="frame_8h_source.html#l00437">ast_format_list::inc_ms</a>, <a class="el" href="rtp_8c_source.html#l00126">ast_rtp::lasttxformat</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="frame_8h_source.html#l00155">ast_frame::offset</a>, <a class="el" href="rtp_8c_source.html#l00171">ast_rtp::pref</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::ptr</a>, <a class="el" href="rtp_8c_source.html#l00179">ast_rtp::red</a>, <a class="el" href="rtp_8c_source.html#l04838">red_t140_to_red()</a>, <a class="el" href="rtp_8c_source.html#l00155">ast_rtp::smoother</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, and <a class="el" href="rtp_8c_source.html#l00148">ast_rtp::them</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l01425">gtalk_write()</a>, <a class="el" href="chan__jingle_8c_source.html#l01207">jingle_write()</a>, <a class="el" href="chan__mgcp_8c_source.html#l01243">mgcp_write()</a>, <a class="el" href="chan__h323_8c_source.html#l00828">oh323_write()</a>, <a class="el" href="rtp_8c_source.html#l04826">red_write()</a>, <a class="el" href="chan__sip_8c_source.html#l06207">sip_write()</a>, <a class="el" href="chan__skinny_8c_source.html#l03964">skinny_write()</a>, and <a class="el" href="chan__unistim_8c_source.html#l03965">unistim_write()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03791"></a>03791 {
<a name="l03792"></a>03792    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *f;
<a name="l03793"></a>03793    <span class="keywordtype">int</span> codec;
<a name="l03794"></a>03794    <span class="keywordtype">int</span> hdrlen = 12;
<a name="l03795"></a>03795    <span class="keywordtype">int</span> <a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>;
<a name="l03796"></a>03796    
<a name="l03797"></a>03797 
<a name="l03798"></a>03798    <span class="comment">/* If we have no peer, return immediately */</span> 
<a name="l03799"></a>03799    <span class="keywordflow">if</span> (!rtp-&gt;<a class="code" href="structast__rtp.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr.s_addr)
<a name="l03800"></a>03800       <span class="keywordflow">return</span> 0;
<a name="l03801"></a>03801 
<a name="l03802"></a>03802    <span class="comment">/* If there is no data length, return immediately */</span>
<a name="l03803"></a>03803    <span class="keywordflow">if</span> (!_f-&gt;datalen &amp;&amp; !rtp-&gt;<a class="code" href="structast__rtp.html#af970d6ad39c43d25fcbb1e2bba07189c">red</a>)
<a name="l03804"></a>03804       <span class="keywordflow">return</span> 0;
<a name="l03805"></a>03805    
<a name="l03806"></a>03806    <span class="comment">/* Make sure we have enough space for RTP header */</span>
<a name="l03807"></a>03807    <span class="keywordflow">if</span> ((_f-&gt;frametype != <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>) &amp;&amp; (_f-&gt;frametype != <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a17ae96b6ea8a2388bb0d409e8124ff30">AST_FRAME_VIDEO</a>) &amp;&amp; (_f-&gt;frametype != <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0af7728b18670d3cd075f63d67f8867078">AST_FRAME_TEXT</a>)) {
<a name="l03808"></a>03808       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;RTP can only send voice, video and text\n&quot;</span>);
<a name="l03809"></a>03809       <span class="keywordflow">return</span> -1;
<a name="l03810"></a>03810    }
<a name="l03811"></a>03811 
<a name="l03812"></a>03812    <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#af970d6ad39c43d25fcbb1e2bba07189c">red</a>) {
<a name="l03813"></a>03813       <span class="comment">/* return 0; */</span>
<a name="l03814"></a>03814       <span class="comment">/* no primary data or generations to send */</span>
<a name="l03815"></a>03815       <span class="keywordflow">if</span> ((_f = <a class="code" href="rtp_8c.html#ae290f54e950a7b43fc6252366758745c" title="Construct a redundant frame.">red_t140_to_red</a>(rtp-&gt;<a class="code" href="structast__rtp.html#af970d6ad39c43d25fcbb1e2bba07189c">red</a>)) == NULL) 
<a name="l03816"></a>03816          <span class="keywordflow">return</span> 0;
<a name="l03817"></a>03817    }
<a name="l03818"></a>03818 
<a name="l03819"></a>03819    <span class="comment">/* The bottom bit of a video subclass contains the marker bit */</span>
<a name="l03820"></a>03820    subclass = _f-&gt;subclass;
<a name="l03821"></a>03821    <span class="keywordflow">if</span> (_f-&gt;frametype == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a17ae96b6ea8a2388bb0d409e8124ff30">AST_FRAME_VIDEO</a>)
<a name="l03822"></a>03822       subclass &amp;= ~0x1;
<a name="l03823"></a>03823 
<a name="l03824"></a>03824    codec = <a class="code" href="rtp_8h.html#a4daa559b8f2ef25bc33d8f5d8fd937d1" title="Looks up an RTP code out of our *static* outbound list.">ast_rtp_lookup_code</a>(rtp, 1, subclass);
<a name="l03825"></a>03825    <span class="keywordflow">if</span> (codec &lt; 0) {
<a name="l03826"></a>03826       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Don&apos;t know how to send format %s packets with RTP\n&quot;</span>, <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(_f-&gt;subclass));
<a name="l03827"></a>03827       <span class="keywordflow">return</span> -1;
<a name="l03828"></a>03828    }
<a name="l03829"></a>03829 
<a name="l03830"></a>03830    <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#aad2a54a4541520f7f134aa28717fe1e7">lasttxformat</a> != subclass) {
<a name="l03831"></a>03831       <span class="comment">/* New format, reset the smoother */</span>
<a name="l03832"></a>03832       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Ooh, format changed from %s to %s\n&quot;</span>, <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(rtp-&gt;<a class="code" href="structast__rtp.html#aad2a54a4541520f7f134aa28717fe1e7">lasttxformat</a>), <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(subclass));
<a name="l03833"></a>03833       rtp-&gt;<a class="code" href="structast__rtp.html#aad2a54a4541520f7f134aa28717fe1e7">lasttxformat</a> = subclass;
<a name="l03834"></a>03834       <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a34ee6625e0f7d45c4e35cd409cb42e21">smoother</a>)
<a name="l03835"></a>03835          <a class="code" href="frame_8h.html#a6d3b71e0a81af743bae6c33c02b64f1f">ast_smoother_free</a>(rtp-&gt;<a class="code" href="structast__rtp.html#a34ee6625e0f7d45c4e35cd409cb42e21">smoother</a>);
<a name="l03836"></a>03836       rtp-&gt;<a class="code" href="structast__rtp.html#a34ee6625e0f7d45c4e35cd409cb42e21">smoother</a> = NULL;
<a name="l03837"></a>03837    }
<a name="l03838"></a>03838 
<a name="l03839"></a>03839    <span class="keywordflow">if</span> (!rtp-&gt;<a class="code" href="structast__rtp.html#a34ee6625e0f7d45c4e35cd409cb42e21">smoother</a>) {
<a name="l03840"></a>03840       <span class="keyword">struct </span><a class="code" href="structast__format__list.html" title="Definition of supported media formats (codecs).">ast_format_list</a> fmt = <a class="code" href="frame_8h.html#ac9789499b866949ab31bab025b497964" title="Get packet size for codec.">ast_codec_pref_getsize</a>(&amp;rtp-&gt;<a class="code" href="structast__rtp.html#a19c23d44fca820c7b8c868f4c9075b56">pref</a>, subclass);
<a name="l03841"></a>03841 
<a name="l03842"></a>03842       <span class="keywordflow">switch</span> (subclass) {
<a name="l03843"></a>03843       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a1a05dee116bf73c0f1ca8410bdb48c62">AST_FORMAT_SPEEX</a>:
<a name="l03844"></a>03844       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ad90b56ed6ada6e4f13224512668e20fb">AST_FORMAT_G723_1</a>:
<a name="l03845"></a>03845       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a13092663dddb1492d81571f9f0ae4506">AST_FORMAT_SIREN7</a>:
<a name="l03846"></a>03846       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a590224283a5c1527fab938e4d02686cc">AST_FORMAT_SIREN14</a>:
<a name="l03847"></a>03847          <span class="comment">/* these are all frame-based codecs and cannot be safely run through</span>
<a name="l03848"></a>03848 <span class="comment">            a smoother */</span>
<a name="l03849"></a>03849          <span class="keywordflow">break</span>;
<a name="l03850"></a>03850       <span class="keywordflow">default</span>:
<a name="l03851"></a>03851          <span class="keywordflow">if</span> (fmt.<a class="code" href="structast__format__list.html#a05368e07b33c55c5588a16887e0d1937">inc_ms</a>) { <span class="comment">/* if codec parameters is set / avoid division by zero */</span>
<a name="l03852"></a>03852             <span class="keywordflow">if</span> (!(rtp-&gt;<a class="code" href="structast__rtp.html#a34ee6625e0f7d45c4e35cd409cb42e21">smoother</a> = <a class="code" href="frame_8h.html#a6f1c795e5db00c9eb553e540dce7a503">ast_smoother_new</a>((fmt.<a class="code" href="structast__format__list.html#a8082330d5592ca639ddd6f7be0c0c39b">cur_ms</a> * fmt.<a class="code" href="structast__format__list.html#a9e1771ccc63dc75f22fb3ea58841fc9c">fr_len</a>) / fmt.<a class="code" href="structast__format__list.html#a05368e07b33c55c5588a16887e0d1937">inc_ms</a>))) {
<a name="l03853"></a>03853                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create smoother: format: %d ms: %d len: %d\n&quot;</span>, subclass, fmt.<a class="code" href="structast__format__list.html#a8082330d5592ca639ddd6f7be0c0c39b">cur_ms</a>, ((fmt.<a class="code" href="structast__format__list.html#a8082330d5592ca639ddd6f7be0c0c39b">cur_ms</a> * fmt.<a class="code" href="structast__format__list.html#a9e1771ccc63dc75f22fb3ea58841fc9c">fr_len</a>) / fmt.<a class="code" href="structast__format__list.html#a05368e07b33c55c5588a16887e0d1937">inc_ms</a>));
<a name="l03854"></a>03854                <span class="keywordflow">return</span> -1;
<a name="l03855"></a>03855             }
<a name="l03856"></a>03856             <span class="keywordflow">if</span> (fmt.<a class="code" href="structast__format__list.html#ac92588540e8c1d014a08cd8a45462b19">flags</a>)
<a name="l03857"></a>03857                <a class="code" href="frame_8h.html#a2bf0a4739b534e4f317230763ec3afcb">ast_smoother_set_flags</a>(rtp-&gt;<a class="code" href="structast__rtp.html#a34ee6625e0f7d45c4e35cd409cb42e21">smoother</a>, fmt.<a class="code" href="structast__format__list.html#ac92588540e8c1d014a08cd8a45462b19">flags</a>);
<a name="l03858"></a>03858             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Created smoother: format: %d ms: %d len: %d\n&quot;</span>, subclass, fmt.<a class="code" href="structast__format__list.html#a8082330d5592ca639ddd6f7be0c0c39b">cur_ms</a>, ((fmt.<a class="code" href="structast__format__list.html#a8082330d5592ca639ddd6f7be0c0c39b">cur_ms</a> * fmt.<a class="code" href="structast__format__list.html#a9e1771ccc63dc75f22fb3ea58841fc9c">fr_len</a>) / fmt.<a class="code" href="structast__format__list.html#a05368e07b33c55c5588a16887e0d1937">inc_ms</a>));
<a name="l03859"></a>03859          }
<a name="l03860"></a>03860       }
<a name="l03861"></a>03861    }
<a name="l03862"></a>03862    <span class="keywordflow">if</span> (rtp-&gt;<a class="code" href="structast__rtp.html#a34ee6625e0f7d45c4e35cd409cb42e21">smoother</a>) {
<a name="l03863"></a>03863       <span class="keywordflow">if</span> (<a class="code" href="frame_8h.html#a3d6997c8a03e68d88c52f784c16c069f">ast_smoother_test_flag</a>(rtp-&gt;<a class="code" href="structast__rtp.html#a34ee6625e0f7d45c4e35cd409cb42e21">smoother</a>, <a class="code" href="frame_8h.html#af2e180889cb2b85cd10823803b9eb005">AST_SMOOTHER_FLAG_BE</a>)) {
<a name="l03864"></a>03864          <a class="code" href="frame_8h.html#a3af01c93b369d5de7caccd2be0b97c4a">ast_smoother_feed_be</a>(rtp-&gt;<a class="code" href="structast__rtp.html#a34ee6625e0f7d45c4e35cd409cb42e21">smoother</a>, _f);
<a name="l03865"></a>03865       } <span class="keywordflow">else</span> {
<a name="l03866"></a>03866          <a class="code" href="frame_8h.html#aab5808a118c74febd13f39746bcce96c">ast_smoother_feed</a>(rtp-&gt;<a class="code" href="structast__rtp.html#a34ee6625e0f7d45c4e35cd409cb42e21">smoother</a>, _f);
<a name="l03867"></a>03867       }
<a name="l03868"></a>03868 
<a name="l03869"></a>03869       <span class="keywordflow">while</span> ((f = <a class="code" href="frame_8h.html#af8d6dcd265eaf403b1b1139770c885d8">ast_smoother_read</a>(rtp-&gt;<a class="code" href="structast__rtp.html#a34ee6625e0f7d45c4e35cd409cb42e21">smoother</a>)) &amp;&amp; (f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>)) {
<a name="l03870"></a>03870          <a class="code" href="rtp_8c.html#a8aca902dc9d1d2540319c23b3c4943e1" title="Write RTP packet with audio or video media frames into UDP packet.">ast_rtp_raw_write</a>(rtp, f, codec);
<a name="l03871"></a>03871       }
<a name="l03872"></a>03872    } <span class="keywordflow">else</span> {
<a name="l03873"></a>03873       <span class="comment">/* Don&apos;t buffer outgoing frames; send them one-per-packet: */</span>
<a name="l03874"></a>03874       <span class="keywordflow">if</span> (_f-&gt;offset &lt; hdrlen) 
<a name="l03875"></a>03875          f = <a class="code" href="frame_8h.html#a4b23720d208128250a765490b1a4f145" title="Copies a frame.">ast_frdup</a>(_f);   <span class="comment">/*! \bug XXX this might never be free&apos;d. Why do we do this? */</span>
<a name="l03876"></a>03876       <span class="keywordflow">else</span>
<a name="l03877"></a>03877          f = _f;
<a name="l03878"></a>03878       <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>)
<a name="l03879"></a>03879          <a class="code" href="rtp_8c.html#a8aca902dc9d1d2540319c23b3c4943e1" title="Write RTP packet with audio or video media frames into UDP packet.">ast_rtp_raw_write</a>(rtp, f, codec);
<a name="l03880"></a>03880       <span class="keywordflow">if</span> (f != _f)
<a name="l03881"></a>03881          <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l03882"></a>03882    }
<a name="l03883"></a>03883       
<a name="l03884"></a>03884    <span class="keywordflow">return</span> 0;
<a name="l03885"></a>03885 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a494a72723299c0e75e1c2cf092135ea6"></a><!-- doxytag: member="rtp.h::ast_stun_request" ref="a494a72723299c0e75e1c2cf092135ea6" args="(int s, struct sockaddr_in *dst, const char *username, struct sockaddr_in *answer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_stun_request </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>username</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>answer</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Generic STUN request send a generic stun request to the server specified. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>s</em>&nbsp;</td><td>the socket used to send the request </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dst</em>&nbsp;</td><td>the address of the STUN server </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>username</em>&nbsp;</td><td>if non null, add the username in the request </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>answer</em>&nbsp;</td><td>if non null, the function waits for a response and puts here the externally visible address. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 on success, other <a class="el" href="structvalues.html">values</a> on error. The interface it may change in the future.</dd></dl>
<p>Generic STUN request send a generic stun request to the server specified.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>s</em>&nbsp;</td><td>the socket used to send the request </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dst</em>&nbsp;</td><td>the address of the STUN server </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>username</em>&nbsp;</td><td>if non null, add the username in the request </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>answer</em>&nbsp;</td><td>if non null, the function waits for a response and puts here the externally visible address. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 on success, other <a class="el" href="structvalues.html">values</a> on error. </dd></dl>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l00634">634</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l00447">append_attr_string()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8h_source.html#l01726">ast_select()</a>, <a class="el" href="rtp_8c_source.html#l00319">stun_header::ies</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="rtp_8c_source.html#l00317">stun_header::msglen</a>, <a class="el" href="rtp_8c_source.html#l00316">stun_header::msgtype</a>, <a class="el" href="rtp_8c_source.html#l00348">STUN_BINDREQ</a>, <a class="el" href="rtp_8c_source.html#l00608">stun_get_mapped()</a>, <a class="el" href="rtp_8c_source.html#l00510">stun_handle_packet()</a>, <a class="el" href="rtp_8c_source.html#l00487">stun_req_id()</a>, <a class="el" href="rtp_8c_source.html#l00480">stun_send()</a>, and <a class="el" href="rtp_8c_source.html#l00363">STUN_USERNAME</a>.</p>

<p>Referenced by <a class="el" href="rtp_8c_source.html#l00700">ast_rtp_stun_request()</a>, <a class="el" href="chan__sip_8c_source.html#l03607">ast_sip_ouraddrfor()</a>, and <a class="el" href="chan__sip_8c_source.html#l24245">reload_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00636"></a>00636 {
<a name="l00637"></a>00637    <span class="keyword">struct </span><a class="code" href="structstun__header.html">stun_header</a> *req;
<a name="l00638"></a>00638    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> reqdata[1024];
<a name="l00639"></a>00639    <span class="keywordtype">int</span> reqlen, reqleft;
<a name="l00640"></a>00640    <span class="keyword">struct </span><a class="code" href="structstun__attr.html">stun_attr</a> *<a class="code" href="structstun__attr.html#add3ba4b027e41df6d301c704fba01f2d">attr</a>;
<a name="l00641"></a>00641    <span class="keywordtype">int</span> res = 0;
<a name="l00642"></a>00642    <span class="keywordtype">int</span> retry;
<a name="l00643"></a>00643    
<a name="l00644"></a>00644    req = (<span class="keyword">struct </span><a class="code" href="structstun__header.html">stun_header</a> *)reqdata;
<a name="l00645"></a>00645    <a class="code" href="rtp_8c.html#add7eb4e6f907c0ab7a1c42cc1ed853b1" title="helper function to generate a random request id">stun_req_id</a>(req);
<a name="l00646"></a>00646    reqlen = 0;
<a name="l00647"></a>00647    reqleft = <span class="keyword">sizeof</span>(reqdata) - <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structstun__header.html">stun_header</a>);
<a name="l00648"></a>00648    req-&gt;<a class="code" href="structstun__header.html#a849329b477142ee81454d566f371e008">msgtype</a> = 0;
<a name="l00649"></a>00649    req-&gt;<a class="code" href="structstun__header.html#aaf6a1387ecab029331e2d6d48a6179f4">msglen</a> = 0;
<a name="l00650"></a>00650    attr = (<span class="keyword">struct </span><a class="code" href="structstun__attr.html">stun_attr</a> *)req-&gt;<a class="code" href="structstun__header.html#a401a6190b88ef972e67575a2d95b2c32">ies</a>;
<a name="l00651"></a>00651    if (username)
<a name="l00652"></a>00652       <a class="code" href="rtp_8c.html#af9fd00095b0279f4bab24fba7a249eb2" title="append a string to an STUN message">append_attr_string</a>(&amp;attr, <a class="code" href="rtp_8c.html#a7fdb97142af9ab7163e0c46091e27ebf">STUN_USERNAME</a>, username, &amp;reqlen, &amp;reqleft);
<a name="l00653"></a>00653    req-&gt;<a class="code" href="structstun__header.html#aaf6a1387ecab029331e2d6d48a6179f4">msglen</a> = htons(reqlen);
<a name="l00654"></a>00654    req-&gt;<a class="code" href="structstun__header.html#a849329b477142ee81454d566f371e008">msgtype</a> = htons(<a class="code" href="rtp_8c.html#a9f7821e6aef705d2aedf21df474f61c9" title="STUN message types &amp;#39;BIND&amp;#39; refers to transactions used to determine the externally...">STUN_BINDREQ</a>);
<a name="l00655"></a>00655    <span class="keywordflow">for</span> (retry = 0; retry &lt; 3; retry++) {  <span class="comment">/* XXX make retries configurable */</span>
<a name="l00656"></a>00656       <span class="comment">/* send request, possibly wait for reply */</span>
<a name="l00657"></a>00657       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> reply_buf[1024];
<a name="l00658"></a>00658       fd_set rfds;
<a name="l00659"></a>00659       <span class="keyword">struct </span>timeval to = { 3, 0 }; <span class="comment">/* timeout, make it configurable */</span>
<a name="l00660"></a>00660       <span class="keyword">struct </span>sockaddr_in src;
<a name="l00661"></a>00661       socklen_t srclen;
<a name="l00662"></a>00662 
<a name="l00663"></a>00663       res = <a class="code" href="rtp_8c.html#ae29344f09db98900eba592c6a2816b62" title="wrapper to send an STUN message">stun_send</a>(<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, dst, req);
<a name="l00664"></a>00664       <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l00665"></a>00665          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;ast_stun_request send #%d failed error %d, retry\n&quot;</span>,
<a name="l00666"></a>00666             retry, res);
<a name="l00667"></a>00667          <span class="keywordflow">continue</span>;
<a name="l00668"></a>00668       }
<a name="l00669"></a>00669       <span class="keywordflow">if</span> (answer == NULL)
<a name="l00670"></a>00670          <span class="keywordflow">break</span>;
<a name="l00671"></a>00671       FD_ZERO(&amp;rfds);
<a name="l00672"></a>00672       FD_SET(<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, &amp;rfds);
<a name="l00673"></a>00673       res = <a class="code" href="channel_8h.html#a056ed4f99440f01c251b2e8ca4501a56" title="Waits for activity on a group of channels.">ast_select</a>(<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a> + 1, &amp;rfds, NULL, NULL, &amp;to);
<a name="l00674"></a>00674       <span class="keywordflow">if</span> (res &lt;= 0)  <span class="comment">/* timeout or error */</span>
<a name="l00675"></a>00675          <span class="keywordflow">continue</span>;
<a name="l00676"></a>00676       memset(&amp;src, <span class="charliteral">&apos;\0&apos;</span>, <span class="keyword">sizeof</span>(src));
<a name="l00677"></a>00677       srclen = <span class="keyword">sizeof</span>(src);
<a name="l00678"></a>00678       <span class="comment">/* XXX pass -1 in the size, because stun_handle_packet might</span>
<a name="l00679"></a>00679 <span class="comment">       * write past the end of the buffer.</span>
<a name="l00680"></a>00680 <span class="comment">       */</span>
<a name="l00681"></a>00681       res = recvfrom(<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, reply_buf, <span class="keyword">sizeof</span>(reply_buf) - 1,
<a name="l00682"></a>00682          0, (<span class="keyword">struct</span> sockaddr *)&amp;src, &amp;srclen);
<a name="l00683"></a>00683       <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l00684"></a>00684          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;ast_stun_request recvfrom #%d failed error %d, retry\n&quot;</span>,
<a name="l00685"></a>00685             retry, res);
<a name="l00686"></a>00686          <span class="keywordflow">continue</span>;
<a name="l00687"></a>00687       }
<a name="l00688"></a>00688       memset(answer, <span class="charliteral">&apos;\0&apos;</span>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr_in));
<a name="l00689"></a>00689       <a class="code" href="rtp_8c.html#a0599391b62cb92d0a020334f6d63fdd0" title="handle an incoming STUN message.">stun_handle_packet</a>(<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, &amp;src, reply_buf, res,
<a name="l00690"></a>00690          <a class="code" href="rtp_8c.html#a02f47d389424487fb9b4483433828adf" title="Extract the STUN_MAPPED_ADDRESS from the stun response. This is used as a callback...">stun_get_mapped</a>, answer);
<a name="l00691"></a>00691       res = 0; <span class="comment">/* signal regular exit */</span>
<a name="l00692"></a>00692       <span class="keywordflow">break</span>;
<a name="l00693"></a>00693    }
<a name="l00694"></a>00694    <span class="keywordflow">return</span> res;
<a name="l00695"></a>00695 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aea735d249de828c184131bdb74863210"></a><!-- doxytag: member="rtp.h::red_buffer_t140" ref="aea735d249de828c184131bdb74863210" args="(struct ast_rtp *rtp, struct ast_frame *f)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void red_buffer_t140 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td>
          <td class="paramname"> <em>f</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Buffer t.140 data. </p>
<p>Buffer t.140 data.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rtp</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>f</em>&nbsp;</td><td>frame </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l04921">4921</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="rtp_8c_source.html#l00195">rtp_red::buf_data</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="frame_8h_source.html#l00147">ast_frame::datalen</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::ptr</a>, <a class="el" href="rtp_8c_source.html#l00179">ast_rtp::red</a>, <a class="el" href="rtp_8c_source.html#l00186">rtp_red::t140</a>, and <a class="el" href="frame_8h_source.html#l00167">ast_frame::ts</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l06207">sip_write()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04922"></a>04922 {
<a name="l04923"></a>04923    <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> &gt; -1) {
<a name="l04924"></a>04924       <span class="keyword">struct </span><a class="code" href="structrtp__red.html">rtp_red</a> *red = rtp-&gt;<a class="code" href="structast__rtp.html#af970d6ad39c43d25fcbb1e2bba07189c">red</a>;
<a name="l04925"></a>04925       memcpy(&amp;red-&gt;<a class="code" href="structrtp__red.html#a7f4fdeaff8e8d4e34a0f75b9863a69e0">buf_data</a>[red-&gt;<a class="code" href="structrtp__red.html#a0a9f2f354cbd850064f42809bcee83dc">t140</a>.<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>], f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>);
<a name="l04926"></a>04926       red-&gt;<a class="code" href="structrtp__red.html#a0a9f2f354cbd850064f42809bcee83dc">t140</a>.<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> += f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>;
<a name="l04927"></a>04927       red-&gt;<a class="code" href="structrtp__red.html#a0a9f2f354cbd850064f42809bcee83dc">t140</a>.<a class="code" href="structast__frame.html#a1eb46dcb363821328c0d2a758549216b">ts</a> = f-&gt;<a class="code" href="structast__frame.html#a1eb46dcb363821328c0d2a758549216b">ts</a>;
<a name="l04928"></a>04928    }
<a name="l04929"></a>04929 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abb328c934231a434fa342680b881e49a"></a><!-- doxytag: member="rtp.h::rtp_red_init" ref="abb328c934231a434fa342680b881e49a" args="(struct ast_rtp *rtp, int ti, int *pt, int num_gen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rtp_red_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ti</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>red_data_pt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>num_gen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initalize t.140 redudancy. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>ti</em>&nbsp;</td><td>time between each t140red frame is sent </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>red_pt</em>&nbsp;</td><td>payloadtype for RTP packet </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pt</em>&nbsp;</td><td>payloadtype numbers for each generation including primary data </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>num_gen</em>&nbsp;</td><td><a class="el" href="structnumber.html" title="Number structure.">number</a> of redundant generations, primary data excluded </td></tr>
  </table>
  </dd>
</dl>
<dl class="since"><dt><b>Since:</b></dt><dd>1.6.1</dd></dl>
<p>Initalize t.140 redudancy.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rtp</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ti</em>&nbsp;</td><td>buffer t140 for ti (msecs) before sending redundant frame </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>red_data_pt</em>&nbsp;</td><td>Payloadtypes for primary- and generation-data </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>num_gen</em>&nbsp;</td><td>numbers of generations (primary generation not encounted) </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="rtp_8c_source.html#l04882">4882</a> of file <a class="el" href="rtp_8c_source.html">rtp.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="frame_8h_source.html#l00290">AST_FORMAT_T140RED</a>, <a class="el" href="frame_8h_source.html#l00111">AST_FRAME_TEXT</a>, <a class="el" href="sched_8c_source.html#l00439">ast_sched_add()</a>, <a class="el" href="rtp_8c_source.html#l00195">rtp_red::buf_data</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="frame_8h_source.html#l00147">ast_frame::datalen</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="rtp_8c_source.html#l00196">rtp_red::hdrlen</a>, <a class="el" href="rtp_8c_source.html#l00191">rtp_red::num_gen</a>, <a class="el" href="rtp_8c_source.html#l00197">rtp_red::prev_ts</a>, <a class="el" href="rtp_8c_source.html#l00188">rtp_red::pt</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::ptr</a>, <a class="el" href="rtp_8c_source.html#l00179">ast_rtp::red</a>, <a class="el" href="rtp_8c_source.html#l04826">red_write()</a>, <a class="el" href="rtp_8c_source.html#l00159">ast_rtp::sched</a>, <a class="el" href="rtp_8c_source.html#l00192">rtp_red::schedid</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, <a class="el" href="rtp_8c_source.html#l00186">rtp_red::t140</a>, <a class="el" href="rtp_8c_source.html#l00187">rtp_red::t140red</a>, <a class="el" href="rtp_8c_source.html#l00194">rtp_red::t140red_data</a>, <a class="el" href="rtp_8c_source.html#l00193">rtp_red::ti</a>, and <a class="el" href="frame_8h_source.html#l00167">ast_frame::ts</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l08040">process_sdp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04883"></a>04883 {
<a name="l04884"></a>04884    <span class="keyword">struct </span><a class="code" href="structrtp__red.html">rtp_red</a> *r;
<a name="l04885"></a>04885    <span class="keywordtype">int</span> x;
<a name="l04886"></a>04886    
<a name="l04887"></a>04887    <span class="keywordflow">if</span> (!(r = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structrtp__red.html">rtp_red</a>))))
<a name="l04888"></a>04888       <span class="keywordflow">return</span> -1;
<a name="l04889"></a>04889 
<a name="l04890"></a>04890    r-&gt;<a class="code" href="structrtp__red.html#a0a9f2f354cbd850064f42809bcee83dc">t140</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0af7728b18670d3cd075f63d67f8867078">AST_FRAME_TEXT</a>;
<a name="l04891"></a>04891    r-&gt;<a class="code" href="structrtp__red.html#a0a9f2f354cbd850064f42809bcee83dc">t140</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="frame_8h.html#aa43d17815b58f27836a45fb310d33959">AST_FORMAT_T140RED</a>;
<a name="l04892"></a>04892    r-&gt;<a class="code" href="structrtp__red.html#a0a9f2f354cbd850064f42809bcee83dc">t140</a>.<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> = &amp;r-&gt;<a class="code" href="structrtp__red.html#a7f4fdeaff8e8d4e34a0f75b9863a69e0">buf_data</a>; 
<a name="l04893"></a>04893 
<a name="l04894"></a>04894    r-&gt;<a class="code" href="structrtp__red.html#a0a9f2f354cbd850064f42809bcee83dc">t140</a>.<a class="code" href="structast__frame.html#a1eb46dcb363821328c0d2a758549216b">ts</a> = 0;
<a name="l04895"></a>04895    r-&gt;<a class="code" href="structrtp__red.html#adfe7111938aee5781b7eb99f86db13cd">t140red</a> = r-&gt;<a class="code" href="structrtp__red.html#a0a9f2f354cbd850064f42809bcee83dc">t140</a>;
<a name="l04896"></a>04896    r-&gt;<a class="code" href="structrtp__red.html#adfe7111938aee5781b7eb99f86db13cd">t140red</a>.<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> = &amp;r-&gt;<a class="code" href="structrtp__red.html#a13f1cf445ea8c204653722d23fc867b2">t140red_data</a>;
<a name="l04897"></a>04897    r-&gt;<a class="code" href="structrtp__red.html#adfe7111938aee5781b7eb99f86db13cd">t140red</a>.<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> = 0;
<a name="l04898"></a>04898    r-&gt;<a class="code" href="structrtp__red.html#ab15c864bf1bd92d2931e58603cfa7898">ti</a> = <a class="code" href="structrtp__red.html#ab15c864bf1bd92d2931e58603cfa7898">ti</a>;
<a name="l04899"></a>04899    r-&gt;<a class="code" href="structrtp__red.html#a616e41679f381ce34cf536b20e24011a">num_gen</a> = <a class="code" href="structrtp__red.html#a616e41679f381ce34cf536b20e24011a">num_gen</a>;
<a name="l04900"></a>04900    r-&gt;<a class="code" href="structrtp__red.html#aba689c8df7cf733548a05ee5c649fd79">hdrlen</a> = <a class="code" href="structrtp__red.html#a616e41679f381ce34cf536b20e24011a">num_gen</a> * 4 + 1;
<a name="l04901"></a>04901    r-&gt;<a class="code" href="structrtp__red.html#ab142ba70d4b23b2c1f230a1f7e7d833a">prev_ts</a> = 0;
<a name="l04902"></a>04902 
<a name="l04903"></a>04903    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="structrtp__red.html#a616e41679f381ce34cf536b20e24011a">num_gen</a>; x++) {
<a name="l04904"></a>04904       r-&gt;<a class="code" href="structrtp__red.html#adc4566d7080c1656aefc4560df8f6093">pt</a>[x] = red_data_pt[x];
<a name="l04905"></a>04905       r-&gt;<a class="code" href="structrtp__red.html#adc4566d7080c1656aefc4560df8f6093">pt</a>[x] |= 1 &lt;&lt; 7; <span class="comment">/* mark redundant generations pt */</span> 
<a name="l04906"></a>04906       r-&gt;<a class="code" href="structrtp__red.html#a13f1cf445ea8c204653722d23fc867b2">t140red_data</a>[x*4] = r-&gt;<a class="code" href="structrtp__red.html#adc4566d7080c1656aefc4560df8f6093">pt</a>[x];
<a name="l04907"></a>04907    }
<a name="l04908"></a>04908    r-&gt;<a class="code" href="structrtp__red.html#a13f1cf445ea8c204653722d23fc867b2">t140red_data</a>[x*4] = r-&gt;<a class="code" href="structrtp__red.html#adc4566d7080c1656aefc4560df8f6093">pt</a>[x] = red_data_pt[x]; <span class="comment">/* primary pt */</span>
<a name="l04909"></a>04909    r-&gt;<a class="code" href="structrtp__red.html#a1083e2d34bb1a32645f4681a7ee78b41">schedid</a> = <a class="code" href="sched_8h.html#a97176531282ac4e70aa107b2e8ee5543" title="Adds a scheduled event Schedule an event to take place at some point in the future...">ast_sched_add</a>(rtp-&gt;<a class="code" href="structast__rtp.html#aea6233539fc73fc5303bf7525ec27e73">sched</a>, <a class="code" href="structrtp__red.html#ab15c864bf1bd92d2931e58603cfa7898">ti</a>, <a class="code" href="rtp_8c.html#af8fe2466849c65c9d60466c769ea5f2d" title="Write t140 redundacy frame.">red_write</a>, rtp);
<a name="l04910"></a>04910    rtp-&gt;<a class="code" href="structast__rtp.html#af970d6ad39c43d25fcbb1e2bba07189c">red</a> = r;
<a name="l04911"></a>04911 
<a name="l04912"></a>04912    r-&gt;<a class="code" href="structrtp__red.html#a0a9f2f354cbd850064f42809bcee83dc">t140</a>.<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> = 0;
<a name="l04913"></a>04913    
<a name="l04914"></a>04914    <span class="keywordflow">return</span> 0;
<a name="l04915"></a>04915 }
</pre></div></p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:23:23 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
