<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:18:49 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_1ab815038f534adda65c8b4ae4993449.html">include</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_16d825f1fa9ecca2e70b1a8d9256d0e6.html">asterisk</a>
  </div>
</div>
<div class="contents">
<h1>_private.h File Reference</h1>
<p>Prototypes for public functions only of internal interest,.  
<a href="#_details">More...</a></p>

<p><a href="__private_8h_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="__private_8h.html#aa3322128c2188bf3d8405d7373c5c483">ast_autoservice_init</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="__private_8h.html#aa0cfcd5a898ed77170a7f2c09581d91a">ast_builtins_init</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">initialize the _full_cmd string in * each of the builtins.  <a href="#aa0cfcd5a898ed77170a7f2c09581d91a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="__private_8h.html#acfffdd54a4bb4777e110dcb3e5118b4c">ast_channels_init</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="__private_8h.html#ade6dbc4196f2fc99250aaafededfb41b">ast_cli_perms_init</a> (int reload)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="__private_8h.html#a1613dc2954f81c1131ad5acd24c1e574">ast_device_state_engine_init</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize the device <a class="el" href="structstate.html">state</a> engine in separate thread.  <a href="#a1613dc2954f81c1131ad5acd24c1e574"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="__private_8h.html#aec784d4f5e2d7d9d6115f85531f17536">ast_event_init</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="__private_8h.html#a6b2ac231f2658dd8169218a8e4cad4ae">ast_features_init</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="__private_8h.html#aeac4fbc3c21ddf2548bc7ae7fab717f3">ast_file_init</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="__private_8h.html#ab02497431dec0900ac24fafa1c8599c6">ast_http_init</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="__private_8h.html#a5998a3b542a4d15b6102bfe9e005de76">ast_http_reload</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="__private_8h.html#af9629ecd6340cb99bf474736b97433d7">ast_indications_init</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Load indications module.  <a href="#af9629ecd6340cb99bf474736b97433d7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="__private_8h.html#a7eef6a8d3d8d5e484c57eb9c6f39fdbf">ast_indications_reload</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Reload indications module.  <a href="#a7eef6a8d3d8d5e484c57eb9c6f39fdbf"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="__private_8h.html#a0d0ff279ff3f2dbbbfb1b49ee6f57add">ast_module_reload</a> (const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Reload asterisk modules.  <a href="#a0d0ff279ff3f2dbbbfb1b49ee6f57add"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="__private_8h.html#a07bf5448c6189024cbc925a3e8ecb5e0">ast_process_pending_reloads</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Process reload <a class="el" href="structrequests.html">requests</a> received during startup.  <a href="#a07bf5448c6189024cbc925a3e8ecb5e0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="__private_8h.html#adb76df37ea8ca7aae2791a447db82430">ast_ssl_init</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="__private_8h.html#a1997b4ca4fdf17e715fddf00f44c9651">ast_term_init</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="__private_8h.html#a14d1423f33a1d054171143c28490368f">ast_timing_init</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="__private_8h.html#a58f95b0d90cc7fe0d44ec5aae481c819">ast_tps_init</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="__private_8h.html#a9069f9a0490be2b041ca552ef07757f0">ast_xmldoc_load_documentation</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Load XML documentation. Provided by <a class="el" href="xmldoc_8c.html" title="XML Documentation API.">xmldoc.c</a>.  <a href="#a9069f9a0490be2b041ca552ef07757f0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="__private_8h.html#a52d9808db8eba7a1ff32fc6686042f04">astdb_init</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="__private_8h.html#abe6bfa12a840493461afe4cb65c935da">astobj2_init</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="__private_8h.html#a472851d5655c8a9b9492c40e5ff32d2d">close_logger</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="__private_8h.html#abc95730f7f0f9420f52e56e525056e6c">dnsmgr_init</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="__private_8h.html#a0eae193f3c757d3cd34ed238b8860ebf">dnsmgr_reload</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="__private_8h.html#a0ede7ff922fb2764dfd455e49dc59bc8">dnsmgr_start_refresh</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="__private_8h.html#ae8a701b0b688879d84514bd36d63ff82">init_framer</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="__private_8h.html#aaa750bd60d48780b89622bb62520dff0">init_logger</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="__private_8h.html#ad68c7bef65928ccdadddf889f105ed9c">load_modules</a> (unsigned int)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="__private_8h.html#ab9a2fcd7b22827d129fc37fc2777c6f4">load_pbx</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="__private_8h.html#a06393c3702f8ab3864a2fdd7857daa90">threadstorage_init</a> (void)</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Prototypes for public functions only of internal interest,. </p>

<p>Definition in file <a class="el" href="__private_8h_source.html">_private.h</a>.</p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="aa3322128c2188bf3d8405d7373c5c483"></a><!-- doxytag: member="_private.h::ast_autoservice_init" ref="aa3322128c2188bf3d8405d7373c5c483" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_autoservice_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Provided by <a class="el" href="autoservice_8c.html" title="Automatic channel service routines.">autoservice.c</a> </p>

<p>Definition at line <a class="el" href="autoservice_8c_source.html#l00318">318</a> of file <a class="el" href="autoservice_8c_source.html">autoservice.c</a>.</p>

<p>References <a class="el" href="autoservice_8c_source.html#l00067">as_cond</a>, and <a class="el" href="lock_8h_source.html#l01729">ast_cond_init()</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00319"></a>00319 {
<a name="l00320"></a>00320    <a class="code" href="lock_8h.html#a21f75f462115427718d78aa66cc61f9b">ast_cond_init</a>(&amp;<a class="code" href="autoservice_8c.html#a7704b73cf5cce4a768fbac243b94b543">as_cond</a>, NULL);
<a name="l00321"></a>00321 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa0cfcd5a898ed77170a7f2c09581d91a"></a><!-- doxytag: member="_private.h::ast_builtins_init" ref="aa0cfcd5a898ed77170a7f2c09581d91a" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_builtins_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>initialize the _full_cmd string in * each of the builtins. </p>
<p>Provided by <a class="el" href="cli_8c.html" title="Standard Command Line Interface.">cli.c</a> </p>

<p>Definition at line <a class="el" href="cli_8c_source.html#l01677">1677</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, and <a class="el" href="cli_8c_source.html#l01927">ast_cli_register_multiple()</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01678"></a>01678 {
<a name="l01679"></a>01679    <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(<a class="code" href="cli_8c.html#a4d8f5feeefd2ef02881efa9181b57913">cli_cli</a>, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="cli_8c.html#a4d8f5feeefd2ef02881efa9181b57913">cli_cli</a>));
<a name="l01680"></a>01680 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acfffdd54a4bb4777e110dcb3e5118b4c"></a><!-- doxytag: member="_private.h::ast_channels_init" ref="acfffdd54a4bb4777e110dcb3e5118b4c" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_channels_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Provided by <a class="el" href="channel_8c.html" title="Channel Management.">channel.c</a> </p>

<p>Definition at line <a class="el" href="channel_8c_source.html#l05561">5561</a> of file <a class="el" href="channel_8c_source.html">channel.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="cli_8c_source.html#l01927">ast_cli_register_multiple()</a>, and <a class="el" href="channel_8c_source.html#l00329">cli_channel</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05562"></a>05562 {
<a name="l05563"></a>05563    <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(<a class="code" href="channel_8c.html#ad74ec6057ffa0240c8dde77284958fbe">cli_channel</a>, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="channel_8c.html#ad74ec6057ffa0240c8dde77284958fbe">cli_channel</a>));
<a name="l05564"></a>05564 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ade6dbc4196f2fc99250aaafededfb41b"></a><!-- doxytag: member="_private.h::ast_cli_perms_init" ref="ade6dbc4196f2fc99250aaafededfb41b" args="(int reload)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_cli_perms_init </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>reload</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Provided by <a class="el" href="cli_8c.html" title="Standard Command Line Interface.">cli.c</a> </p>

<p>Definition at line <a class="el" href="cli_8c_source.html#l01554">1554</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="config_8c_source.html#l00613">ast_category_browse()</a>, <a class="el" href="config_8c_source.html#l00827">ast_config_destroy()</a>, <a class="el" href="config_8c_source.html#l02071">ast_config_load2()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="linkedlists_8h_source.html#l00715">AST_LIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01722">ast_mutex_trylock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="linkedlists_8h_source.html#l00725">AST_RWLIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="config_8c_source.html#l00411">ast_variable_browse()</a>, <a class="el" href="cli_8c_source.html#l00055">cli_perm::command</a>, <a class="el" href="config_8h_source.html#l00043">CONFIG_FLAG_FILEUNCHANGED</a>, <a class="el" href="config_8h_source.html#l00049">CONFIG_STATUS_FILEUNCHANGED</a>, <a class="el" href="cli_8c_source.html#l01538">destroy_user_perms()</a>, <a class="el" href="cli_8c_source.html#l00064">usergroup_cli_perm::gid</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="config_8h_source.html#l00075">ast_variable::name</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="cli_8c_source.html#l00054">cli_perm::permit</a>, <a class="el" href="cli_8c_source.html#l00065">usergroup_cli_perm::perms</a>, <a class="el" href="cli_8c_source.html#l00069">perms_config</a>, <a class="el" href="cli_8c_source.html#l00063">usergroup_cli_perm::uid</a>, and <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l00985">handle_cli_reload_permissions()</a>, and <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01555"></a>01555 {
<a name="l01556"></a>01556    <span class="keyword">struct </span><a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> <a class="code" href="app__rpt_8c.html#a1f57f20c1f46890828791a4827fe8752">config_flags</a> = { <a class="code" href="app__amd_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> ? <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26afa887389dc380bbdcffb65fec379f037">CONFIG_FLAG_FILEUNCHANGED</a> : 0 };
<a name="l01557"></a>01557    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *cfg;
<a name="l01558"></a>01558    <span class="keywordtype">char</span> *cat = NULL;
<a name="l01559"></a>01559    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *v;
<a name="l01560"></a>01560    <span class="keyword">struct </span><a class="code" href="structusergroup__cli__perm.html" title="list of users to apply restrictions.">usergroup_cli_perm</a> *user_group, *cp_entry;
<a name="l01561"></a>01561    <span class="keyword">struct </span><a class="code" href="structcli__perm.html" title="List of restrictions per user.">cli_perm</a> *perm = NULL;
<a name="l01562"></a>01562    <span class="keyword">struct </span>passwd *pw;
<a name="l01563"></a>01563    <span class="keyword">struct </span><a class="code" href="structgroup.html">group</a> *gr;
<a name="l01564"></a>01564 
<a name="l01565"></a>01565    <span class="keywordflow">if</span> (<a class="code" href="lock_8h.html#a036ccafa2339f674a46bc269bbd48c5f">ast_mutex_trylock</a>(&amp;<a class="code" href="cli_8c.html#a69909b2c3c4a62443fc781e20ba3ddc5" title="mutex used to prevent a user from running the &amp;#39;cli reload permissions&amp;#39; command...">permsconfiglock</a>)) {
<a name="l01566"></a>01566       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;You must wait until last &apos;cli reload permissions&apos; command finish\n&quot;</span>);
<a name="l01567"></a>01567       <span class="keywordflow">return</span> 1;
<a name="l01568"></a>01568    }
<a name="l01569"></a>01569 
<a name="l01570"></a>01570    cfg = <a class="code" href="config_8h.html#aab3eac8fa82a86a93c074deb7b77dbc9" title="Load a config file.">ast_config_load2</a>(<a class="code" href="cli_8c.html#ae473ef191024f9043e7388e1a0585791" title="CLI permissions config file.">perms_config</a>, <span class="stringliteral">&quot;&quot;</span> <span class="comment">/* core, can&apos;t reload */</span>, config_flags);
<a name="l01571"></a>01571    <span class="keywordflow">if</span> (!cfg) {
<a name="l01572"></a>01572       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="cli_8c.html#a69909b2c3c4a62443fc781e20ba3ddc5" title="mutex used to prevent a user from running the &amp;#39;cli reload permissions&amp;#39; command...">permsconfiglock</a>);
<a name="l01573"></a>01573       <span class="keywordflow">return</span> 1;
<a name="l01574"></a>01574    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cfg == <a class="code" href="config_8h.html#a846844eb2c4eb44554445936b3770711">CONFIG_STATUS_FILEUNCHANGED</a>) {
<a name="l01575"></a>01575       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="cli_8c.html#a69909b2c3c4a62443fc781e20ba3ddc5" title="mutex used to prevent a user from running the &amp;#39;cli reload permissions&amp;#39; command...">permsconfiglock</a>);
<a name="l01576"></a>01576       <span class="keywordflow">return</span> 0;
<a name="l01577"></a>01577    }
<a name="l01578"></a>01578 
<a name="l01579"></a>01579    <span class="comment">/* free current structures. */</span>
<a name="l01580"></a>01580    <a class="code" href="cli_8c.html#aa09e50353ce1962ccd90b269e3beb793" title="cleanup (free) cli_perms linkedlist.">destroy_user_perms</a>();
<a name="l01581"></a>01581 
<a name="l01582"></a>01582    <span class="keywordflow">while</span> ((cat = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(cfg, cat))) {
<a name="l01583"></a>01583       <span class="keywordflow">if</span> (!strcasecmp(cat, <span class="stringliteral">&quot;general&quot;</span>)) {
<a name="l01584"></a>01584          <span class="comment">/* General options */</span>
<a name="l01585"></a>01585          <span class="keywordflow">for</span> (v = <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(cfg, cat); v; v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l01586"></a>01586             <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;default_perm&quot;</span>)) {
<a name="l01587"></a>01587                <a class="code" href="cli_8c.html#a8b908b1af31513eae2e84e5346661d58" title="Default permissions value 1=Permit 0=Deny.">cli_default_perm</a> = (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;permit&quot;</span>)) ? 1: 0;
<a name="l01588"></a>01588             }
<a name="l01589"></a>01589          }
<a name="l01590"></a>01590          <span class="keywordflow">continue</span>;
<a name="l01591"></a>01591       }
<a name="l01592"></a>01592 
<a name="l01593"></a>01593       <span class="comment">/* users or groups */</span>
<a name="l01594"></a>01594       gr = NULL, pw = NULL;
<a name="l01595"></a>01595       <span class="keywordflow">if</span> (cat[0] == <span class="charliteral">&apos;@&apos;</span>) {
<a name="l01596"></a>01596          <span class="comment">/* This is a group */</span>
<a name="l01597"></a>01597          gr = getgrnam(&amp;cat[1]);
<a name="l01598"></a>01598          <span class="keywordflow">if</span> (!gr) {
<a name="l01599"></a>01599             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a> (<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unknown group &apos;%s&apos;\n&quot;</span>, &amp;cat[1]);
<a name="l01600"></a>01600             <span class="keywordflow">continue</span>;
<a name="l01601"></a>01601          }
<a name="l01602"></a>01602       } <span class="keywordflow">else</span> {
<a name="l01603"></a>01603          <span class="comment">/* This is a user */</span>
<a name="l01604"></a>01604          pw = getpwnam(cat);
<a name="l01605"></a>01605          <span class="keywordflow">if</span> (!pw) {
<a name="l01606"></a>01606             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a> (<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unknown user &apos;%s&apos;\n&quot;</span>, cat);
<a name="l01607"></a>01607             <span class="keywordflow">continue</span>;
<a name="l01608"></a>01608          }
<a name="l01609"></a>01609       }
<a name="l01610"></a>01610       user_group = NULL;
<a name="l01611"></a>01611       <span class="comment">/* Check for duplicates */</span>
<a name="l01612"></a>01612       <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structcli__perms.html" title="List of users and permissions.">cli_perms</a>);
<a name="l01613"></a>01613       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="structcli__perms.html" title="List of users and permissions.">cli_perms</a>, cp_entry, list) {
<a name="l01614"></a>01614          <span class="keywordflow">if</span> ((pw &amp;&amp; cp_entry-&gt;<a class="code" href="structusergroup__cli__perm.html#a60a34315f460179939054acaf3ed8163">uid</a> == pw-&gt;pw_uid) || (gr &amp;&amp; cp_entry-&gt;<a class="code" href="structusergroup__cli__perm.html#a6567680a890171fbaa1a026477a858d3">gid</a> == gr-&gt;gr_gid)) {
<a name="l01615"></a>01615             <span class="comment">/* if it is duplicated, just added this new settings, to </span>
<a name="l01616"></a>01616 <span class="comment">            the current list. */</span>
<a name="l01617"></a>01617             user_group = cp_entry;
<a name="l01618"></a>01618             <span class="keywordflow">break</span>;
<a name="l01619"></a>01619          }
<a name="l01620"></a>01620       }
<a name="l01621"></a>01621       <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structcli__perms.html" title="List of users and permissions.">cli_perms</a>);
<a name="l01622"></a>01622 
<a name="l01623"></a>01623       <span class="keywordflow">if</span> (!user_group) {
<a name="l01624"></a>01624          <span class="comment">/* alloc space for the new user config. */</span>
<a name="l01625"></a>01625          user_group = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*user_group));
<a name="l01626"></a>01626          <span class="keywordflow">if</span> (!user_group) {
<a name="l01627"></a>01627             <span class="keywordflow">continue</span>;
<a name="l01628"></a>01628          }
<a name="l01629"></a>01629          user_group-&gt;<a class="code" href="structusergroup__cli__perm.html#a60a34315f460179939054acaf3ed8163">uid</a> = (pw ? pw-&gt;pw_uid : -1);
<a name="l01630"></a>01630          user_group-&gt;<a class="code" href="structusergroup__cli__perm.html#a6567680a890171fbaa1a026477a858d3">gid</a> = (gr ? gr-&gt;gr_gid : -1);
<a name="l01631"></a>01631          user_group-&gt;<a class="code" href="structusergroup__cli__perm.html#a367ea8bb88f1de1371cb6bbeda0451ba">perms</a> = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*user_group-&gt;<a class="code" href="structusergroup__cli__perm.html#a367ea8bb88f1de1371cb6bbeda0451ba">perms</a>));
<a name="l01632"></a>01632          <span class="keywordflow">if</span> (!user_group-&gt;<a class="code" href="structusergroup__cli__perm.html#a367ea8bb88f1de1371cb6bbeda0451ba">perms</a>) {
<a name="l01633"></a>01633             <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(user_group);
<a name="l01634"></a>01634             <span class="keywordflow">continue</span>;
<a name="l01635"></a>01635          }
<a name="l01636"></a>01636       }
<a name="l01637"></a>01637       <span class="keywordflow">for</span> (v = <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(cfg, cat); v; v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l01638"></a>01638          <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>)) {
<a name="l01639"></a>01639             <span class="comment">/* we need to check this condition cause it could break security. */</span>
<a name="l01640"></a>01640             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Empty permit/deny option in user &apos;%s&apos;\n&quot;</span>, cat);
<a name="l01641"></a>01641             <span class="keywordflow">continue</span>;
<a name="l01642"></a>01642          }
<a name="l01643"></a>01643          <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;permit&quot;</span>)) {
<a name="l01644"></a>01644             perm = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*perm));
<a name="l01645"></a>01645             <span class="keywordflow">if</span> (perm) {
<a name="l01646"></a>01646                perm-&gt;<a class="code" href="structcli__perm.html#ab01e87324485f2f7b5858cab52e6726e">permit</a> = 1;
<a name="l01647"></a>01647                perm-&gt;<a class="code" href="structcli__perm.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01648"></a>01648             }
<a name="l01649"></a>01649          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;deny&quot;</span>)) {
<a name="l01650"></a>01650             perm = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*perm));
<a name="l01651"></a>01651             <span class="keywordflow">if</span> (perm) {
<a name="l01652"></a>01652                perm-&gt;<a class="code" href="structcli__perm.html#ab01e87324485f2f7b5858cab52e6726e">permit</a> = 0;
<a name="l01653"></a>01653                perm-&gt;<a class="code" href="structcli__perm.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01654"></a>01654             }
<a name="l01655"></a>01655          } <span class="keywordflow">else</span> {
<a name="l01656"></a>01656             <span class="comment">/* up to now, only &apos;permit&apos; and &apos;deny&apos; are possible values. */</span>
<a name="l01657"></a>01657             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unknown &apos;%s&apos; option\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);
<a name="l01658"></a>01658             <span class="keywordflow">continue</span>;
<a name="l01659"></a>01659          }
<a name="l01660"></a>01660          <span class="keywordflow">if</span> (perm) {
<a name="l01661"></a>01661             <span class="comment">/* Added the permission to the user&apos;s list. */</span>
<a name="l01662"></a>01662             <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(user_group-&gt;<a class="code" href="structusergroup__cli__perm.html#a367ea8bb88f1de1371cb6bbeda0451ba">perms</a>, perm, list);
<a name="l01663"></a>01663             perm = NULL;
<a name="l01664"></a>01664          }
<a name="l01665"></a>01665       }
<a name="l01666"></a>01666       <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structcli__perms.html" title="List of users and permissions.">cli_perms</a>);
<a name="l01667"></a>01667       <a class="code" href="linkedlists_8h.html#aadda916488b2d151af4426e2f06ad332">AST_RWLIST_INSERT_TAIL</a>(&amp;<a class="code" href="structcli__perms.html" title="List of users and permissions.">cli_perms</a>, user_group, list);
<a name="l01668"></a>01668       <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structcli__perms.html" title="List of users and permissions.">cli_perms</a>);
<a name="l01669"></a>01669    }
<a name="l01670"></a>01670 
<a name="l01671"></a>01671    <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(cfg);
<a name="l01672"></a>01672    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="cli_8c.html#a69909b2c3c4a62443fc781e20ba3ddc5" title="mutex used to prevent a user from running the &amp;#39;cli reload permissions&amp;#39; command...">permsconfiglock</a>);
<a name="l01673"></a>01673    <span class="keywordflow">return</span> 0;
<a name="l01674"></a>01674 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1613dc2954f81c1131ad5acd24c1e574"></a><!-- doxytag: member="_private.h::ast_device_state_engine_init" ref="a1613dc2954f81c1131ad5acd24c1e574" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_device_state_engine_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize the device <a class="el" href="structstate.html">state</a> engine in separate thread. </p>
<p>Provided by <a class="el" href="devicestate_8c.html" title="Device state management.">devicestate.c</a> </p>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00722">722</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01729">ast_cond_init()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8h_source.html#l00384">ast_pthread_create_background</a>, <a class="el" href="devicestate_8c_source.html#l00181">change_thread</a>, <a class="el" href="devicestate_8c_source.html#l00533">do_devstate_changes()</a>, and <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00723"></a>00723 {
<a name="l00724"></a>00724    <a class="code" href="lock_8h.html#a21f75f462115427718d78aa66cc61f9b">ast_cond_init</a>(&amp;<a class="code" href="devicestate_8c.html#aa33e22b03fb6e00eb7f27a34f0e630f1" title="Flag for the queue.">change_pending</a>, NULL);
<a name="l00725"></a>00725    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a595e2f8aa398f4bd21e381c3211235fe">ast_pthread_create_background</a>(&amp;<a class="code" href="devicestate_8c.html#a767b566dd113e1ee0de1634e07c5618d" title="The device state change notification thread.">change_thread</a>, NULL, <a class="code" href="devicestate_8c.html#ad9f83f8d47fb83b4ccff95cb88f43d2b" title="Go through the dev state change queue and update changes in the dev state thread...">do_devstate_changes</a>, NULL) &lt; 0) {
<a name="l00726"></a>00726       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to start device state change thread.\n&quot;</span>);
<a name="l00727"></a>00727       <span class="keywordflow">return</span> -1;
<a name="l00728"></a>00728    }
<a name="l00729"></a>00729 
<a name="l00730"></a>00730    <span class="keywordflow">return</span> 0;
<a name="l00731"></a>00731 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aec784d4f5e2d7d9d6115f85531f17536"></a><!-- doxytag: member="_private.h::ast_event_init" ref="aec784d4f5e2d7d9d6115f85531f17536" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_event_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Provided by <a class="el" href="event_8c.html" title="Internal generic event system.">event.c</a> </p>

<p>Definition at line <a class="el" href="event_8c_source.html#l01289">1289</a> of file <a class="el" href="event_8c_source.html">event.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00727">ao2_container_alloc</a>, <a class="el" href="event_8c.html#a51c4315d37378bad0246dff9c0ebf523">ast_event_cache</a>, <a class="el" href="event_8c_source.html#l01258">ast_event_cmp()</a>, <a class="el" href="event_8c_source.html#l01224">ast_event_hash()</a>, <a class="el" href="event_8c.html#a301e72880aab9fd98fcbb3f721ed0dd5">ast_event_subs</a>, <a class="el" href="dlinkedlists_8h_source.html#l00797">AST_RWDLLIST_HEAD_INIT</a>, <a class="el" href="taskprocessor_8c_source.html#l00407">ast_taskprocessor_get()</a>, <a class="el" href="event_8c_source.html#l00157">container</a>, <a class="el" href="event_8c_source.html#l00159">hash_fn</a>, and <a class="el" href="event_8c_source.html#l00142">NUM_CACHE_BUCKETS</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01290"></a>01290 {
<a name="l01291"></a>01291    <span class="keywordtype">int</span> i;
<a name="l01292"></a>01292 
<a name="l01293"></a>01293    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="event__defs_8h.html#a6fa079412d9d9c1cc539f6d71f37f79fa0b077dc8f7e01b4fd4fd8a54359f0268">AST_EVENT_TOTAL</a>; i++) {
<a name="l01294"></a>01294       <a class="code" href="dlinkedlists_8h.html#ab53efffc0cc9f1f562346f3cdaacdd86" title="Initializes an rwlist head structure.">AST_RWDLLIST_HEAD_INIT</a>(&amp;<a class="code" href="event_8c.html#a301e72880aab9fd98fcbb3f721ed0dd5" title="Event subscriptions The event subscribers are indexed by which event they are subscribed...">ast_event_subs</a>[i]);
<a name="l01295"></a>01295    }
<a name="l01296"></a>01296 
<a name="l01297"></a>01297    <span class="keywordflow">for</span> (i = 0; i &lt; AST_EVENT_TOTAL; i++) {
<a name="l01298"></a>01298       <span class="keywordflow">if</span> (!<a class="code" href="event_8c.html#a51c4315d37378bad0246dff9c0ebf523" title="Event types that are kept in the cache.">ast_event_cache</a>[i].<a class="code" href="event_8c.html#affe6d185cf034f97d9e746dbfc8fb11c" title="Event type specific hash function.">hash_fn</a>) {
<a name="l01299"></a>01299          <span class="comment">/* This event type is not cached. */</span>
<a name="l01300"></a>01300          <span class="keywordflow">continue</span>;
<a name="l01301"></a>01301       }
<a name="l01302"></a>01302 
<a name="l01303"></a>01303       <span class="keywordflow">if</span> (!(<a class="code" href="event_8c.html#a51c4315d37378bad0246dff9c0ebf523" title="Event types that are kept in the cache.">ast_event_cache</a>[i].<a class="code" href="event_8c.html#a7ea220e4d14b05876af4430e9832ce47" title="Container of cached events.">container</a> = <a class="code" href="astobj2_8h.html#a82534c91be59ec9a3d3318ec85ac5695">ao2_container_alloc</a>(<a class="code" href="event_8c.html#aa2c7ce70c25f706f8eafad4001c28daa">NUM_CACHE_BUCKETS</a>,
<a name="l01304"></a>01304             <a class="code" href="event_8c.html#a6fe45949a73e5cf7873252dcf58d27c4">ast_event_hash</a>, <a class="code" href="event_8c.html#a035a5a41a4ae577dc7dcfb6c521f4262">ast_event_cmp</a>))) {
<a name="l01305"></a>01305          <span class="keywordflow">return</span> -1;
<a name="l01306"></a>01306       }
<a name="l01307"></a>01307    }
<a name="l01308"></a>01308 
<a name="l01309"></a>01309    <span class="keywordflow">if</span> (!(<a class="code" href="event_8c.html#a09a2211349df9d6af32a8a88153037a1">event_dispatcher</a> = <a class="code" href="taskprocessor_8h.html#a3d670ce6d9ed07b5db0dae8d2c11d275" title="Get a reference to a taskprocessor with the specified name and create the taskprocessor...">ast_taskprocessor_get</a>(<span class="stringliteral">&quot;core_event_dispatcher&quot;</span>, 0))) {
<a name="l01310"></a>01310       <span class="keywordflow">return</span> -1;
<a name="l01311"></a>01311    }
<a name="l01312"></a>01312 
<a name="l01313"></a>01313    <span class="keywordflow">return</span> 0;
<a name="l01314"></a>01314 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6b2ac231f2658dd8169218a8e4cad4ae"></a><!-- doxytag: member="_private.h::ast_features_init" ref="a6b2ac231f2658dd8169218a8e4cad4ae" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_features_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Provided by <a class="el" href="features_8c.html" title="Routines implementing call features as call pickup, parking and transfer.">features.c</a> </p>

<p>Definition at line <a class="el" href="features_8c_source.html#l04642">4642</a> of file <a class="el" href="features_8c_source.html">features.c</a>.</p>

<p>References <a class="el" href="features_8c_source.html#l04156">action_bridge()</a>, <a class="el" href="astobj2_8h_source.html#l00727">ao2_container_alloc</a>, <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="cli_8c_source.html#l01927">ast_cli_register_multiple()</a>, <a class="el" href="devicestate_8c_source.html#l00369">ast_devstate_prov_add()</a>, <a class="el" href="manager_8h_source.html#l00133">ast_manager_register</a>, <a class="el" href="manager_8c_source.html#l03448">ast_manager_register2()</a>, <a class="el" href="utils_8h_source.html#l00376">ast_pthread_create</a>, <a class="el" href="pbx_8c_source.html#l05062">ast_register_application2()</a>, <a class="el" href="features_8c_source.html#l04524">bridge_exec()</a>, <a class="el" href="features_8c_source.html#l03189">do_parking_thread()</a>, <a class="el" href="manager_8h_source.html#l00062">EVENT_FLAG_CALL</a>, <a class="el" href="features_8c_source.html#l03672">load_config()</a>, <a class="el" href="features_8c_source.html#l04401">manager_park()</a>, <a class="el" href="features_8c_source.html#l04340">manager_parking_status()</a>, <a class="el" href="features_8c_source.html#l00519">metermaidstate()</a>, <a class="el" href="features_8c_source.html#l03249">park_call_exec()</a>, <a class="el" href="features_8c_source.html#l03502">park_exec()</a>, <a class="el" href="features_8c_source.html#l00262">parkcall</a>, <a class="el" href="features_8c_source.html#l00192">parkedcall</a>, <a class="el" href="features_8c_source.html#l00273">parking_thread</a>, <a class="el" href="features_8c_source.html#l00340">parkinglot_cmp_cb()</a>, <a class="el" href="features_8c_source.html#l00333">parkinglot_hash_cb()</a>, and <a class="el" href="features_8c_source.html#l00236">parkinglots</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04643"></a>04643 {
<a name="l04644"></a>04644    <span class="keywordtype">int</span> res;
<a name="l04645"></a>04645 
<a name="l04646"></a>04646    <a class="code" href="module_8h.html#a6814b6d7b0a7d23c41df65124eb77171" title="Register an application.">ast_register_application2</a>(<a class="code" href="features_8c.html#a30cf144e208ddc17e51b2f1e600052e8">app_bridge</a>, <a class="code" href="features_8c.html#a274fc5b522ca5cfc7d7d8e871482480b" title="Bridge channels.">bridge_exec</a>, NULL, NULL, NULL);
<a name="l04647"></a>04647 
<a name="l04648"></a>04648    <a class="code" href="features_8c.html#ad1dd6c1dd542a6e34c68a1c5c5d40509" title="The list of parking lots configured. Always at least one - the default parking lot...">parkinglots</a> = <a class="code" href="astobj2_8h.html#a82534c91be59ec9a3d3318ec85ac5695">ao2_container_alloc</a>(7, <a class="code" href="features_8c.html#a231b8dd6b2803def28a66cc640d3186f">parkinglot_hash_cb</a>, <a class="code" href="features_8c.html#a1798ad70b3c43377f3d89f7c4830b940">parkinglot_cmp_cb</a>);
<a name="l04649"></a>04649 
<a name="l04650"></a>04650    <span class="keywordflow">if</span> ((res = <a class="code" href="features_8c.html#aed5779f84d4ebb67745d801d3ebede43">load_config</a>()))
<a name="l04651"></a>04651       <span class="keywordflow">return</span> res;
<a name="l04652"></a>04652    <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(<a class="code" href="features_8c.html#a53d8f03eb64267f168b7a966a64915f8">cli_features</a>, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="features_8c.html#a53d8f03eb64267f168b7a966a64915f8">cli_features</a>));
<a name="l04653"></a>04653    <a class="code" href="utils_8h.html#a4781fd54a4ca8c7f0f8a32a6cce503c0">ast_pthread_create</a>(&amp;<a class="code" href="features_8c.html#ac66fb87ae86fa37b36fa78286c237fd2">parking_thread</a>, NULL, <a class="code" href="features_8c.html#ad9b02e0b0449b215a699f0a64d19107a" title="Take care of parked calls and unpark them if needed.">do_parking_thread</a>, NULL);
<a name="l04654"></a>04654    res = <a class="code" href="module_8h.html#a6814b6d7b0a7d23c41df65124eb77171" title="Register an application.">ast_register_application2</a>(<a class="code" href="features_8c.html#a45fde2767ab498a74ee0edc3fa3c3dbf">parkedcall</a>, <a class="code" href="features_8c.html#add37fc3ed9c410d20dd4de34644f5c7b">park_exec</a>, NULL, NULL, NULL);
<a name="l04655"></a>04655    <span class="keywordflow">if</span> (!res)
<a name="l04656"></a>04656       res = <a class="code" href="module_8h.html#a6814b6d7b0a7d23c41df65124eb77171" title="Register an application.">ast_register_application2</a>(<a class="code" href="features_8c.html#ac3950a3179488304a97d02de9488c205">parkcall</a>, <a class="code" href="features_8c.html#a2cec676e4ea8d8e13b3852e97fc28552" title="Park a call.">park_call_exec</a>, NULL, NULL, NULL);
<a name="l04657"></a>04657    <span class="keywordflow">if</span> (!res) {
<a name="l04658"></a>04658       <a class="code" href="manager_8h.html#a24c8fe57053553be1a1458d4afe8909b" title="External routines may register/unregister manager callbacks this way.">ast_manager_register</a>(<span class="stringliteral">&quot;ParkedCalls&quot;</span>, 0, <a class="code" href="features_8c.html#ae173627ea061ac13a887ad640feac171" title="Dump parking lot status.">manager_parking_status</a>, <span class="stringliteral">&quot;List parked calls&quot;</span>);
<a name="l04659"></a>04659       <a class="code" href="group__Group__AMI.html#ga332bf7ef48f67d63d849dd9febb18fb2" title="Register a manager command with the manager interface.">ast_manager_register2</a>(<span class="stringliteral">&quot;Park&quot;</span>, <a class="code" href="manager_8h.html#ab5db3cc603d7e798d61cb4cd94fbb4e2">EVENT_FLAG_CALL</a>, <a class="code" href="features_8c.html#a81ea8c1f888844f3ba5aade3be0bbeba" title="Create manager event for parked calls.">manager_park</a>, <span class="stringliteral">&quot;Park a channel&quot;</span>, <a class="code" href="features_8c.html#ab646ce88b1017513554ea26a0d24557b">mandescr_park</a>); 
<a name="l04660"></a>04660       <a class="code" href="group__Group__AMI.html#ga332bf7ef48f67d63d849dd9febb18fb2" title="Register a manager command with the manager interface.">ast_manager_register2</a>(<span class="stringliteral">&quot;Bridge&quot;</span>, <a class="code" href="manager_8h.html#ab5db3cc603d7e798d61cb4cd94fbb4e2">EVENT_FLAG_CALL</a>, <a class="code" href="features_8c.html#a51755e20bdcffb65c53468b7c4eead32" title="Bridge channels together.">action_bridge</a>, <span class="stringliteral">&quot;Bridge two channels already in the PBX&quot;</span>, <a class="code" href="features_8c.html#a88045cf5a2dca0498141f69a5e2d54b3">mandescr_bridge</a>);
<a name="l04661"></a>04661    }
<a name="l04662"></a>04662 
<a name="l04663"></a>04663    res |= <a class="code" href="devicestate_8h.html#ae832fcc32c88962e73025ffeafe2961e" title="Add device state provider.">ast_devstate_prov_add</a>(<span class="stringliteral">&quot;Park&quot;</span>, <a class="code" href="features_8c.html#a803092f58ccdc8d7562ed7c5f2151380" title="metermaids callback from devicestate.c">metermaidstate</a>);
<a name="l04664"></a>04664 
<a name="l04665"></a>04665    <span class="keywordflow">return</span> res;
<a name="l04666"></a>04666 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aeac4fbc3c21ddf2548bc7ae7fab717f3"></a><!-- doxytag: member="_private.h::ast_file_init" ref="aeac4fbc3c21ddf2548bc7ae7fab717f3" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_file_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Provided by <a class="el" href="file_8c.html" title="Generic File Format Support.">file.c</a> </p>

<p>Definition at line <a class="el" href="file_8c_source.html#l01470">1470</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01471"></a>01471 {
<a name="l01472"></a>01472    <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(<a class="code" href="file_8c.html#abaef9acc752363813eb89bb0b72721a7">cli_file</a>, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="file_8c.html#abaef9acc752363813eb89bb0b72721a7">cli_file</a>));
<a name="l01473"></a>01473    <span class="keywordflow">return</span> 0;
<a name="l01474"></a>01474 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab02497431dec0900ac24fafa1c8599c6"></a><!-- doxytag: member="_private.h::ast_http_init" ref="ab02497431dec0900ac24fafa1c8599c6" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_http_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Provided by <a class="el" href="http_8c.html" title="http server for AMI access">http.c</a> </p>

<p>Definition at line <a class="el" href="http_8c_source.html#l01023">1023</a> of file <a class="el" href="http_8c_source.html">http.c</a>.</p>

<p>References <a class="el" href="http_8c_source.html#l00848">__ast_http_load()</a>, <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="cli_8c_source.html#l01927">ast_cli_register_multiple()</a>, <a class="el" href="http_8c_source.html#l00344">ast_http_uri_link()</a>, <a class="el" href="http_8c_source.html#l01019">cli_http</a>, <a class="el" href="http_8c_source.html#l00298">staticuri</a>, and <a class="el" href="http_8c_source.html#l00289">statusuri</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01024"></a>01024 {
<a name="l01025"></a>01025    <a class="code" href="http_8h.html#ac99d56925cf94f8cf3ed0acac52e2d75" title="Register a URI handler.">ast_http_uri_link</a>(&amp;<a class="code" href="http_8c.html#a092e39cea3cca5eca8cf40da0b7a47e1">statusuri</a>);
<a name="l01026"></a>01026    <a class="code" href="http_8h.html#ac99d56925cf94f8cf3ed0acac52e2d75" title="Register a URI handler.">ast_http_uri_link</a>(&amp;<a class="code" href="http_8c.html#ae59ae7f4b3e145d3d7468113fd4166ff">staticuri</a>);
<a name="l01027"></a>01027    <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(<a class="code" href="http_8c.html#a62ac5f089c743a2d4113e518818000fa">cli_http</a>, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="http_8c.html#a62ac5f089c743a2d4113e518818000fa">cli_http</a>));
<a name="l01028"></a>01028 
<a name="l01029"></a>01029    <span class="keywordflow">return</span> <a class="code" href="http_8c.html#a3ce71802a2d0296a3478fcfeb3c21aac">__ast_http_load</a>(0);
<a name="l01030"></a>01030 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5998a3b542a4d15b6102bfe9e005de76"></a><!-- doxytag: member="_private.h::ast_http_reload" ref="a5998a3b542a4d15b6102bfe9e005de76" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_http_reload </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Provided by <a class="el" href="http_8c.html" title="http server for AMI access">http.c</a> </p>

<p>Definition at line <a class="el" href="http_8c_source.html#l01014">1014</a> of file <a class="el" href="http_8c_source.html">http.c</a>.</p>

<p>References <a class="el" href="http_8c_source.html#l00848">__ast_http_load()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01015"></a>01015 {
<a name="l01016"></a>01016    <span class="keywordflow">return</span> <a class="code" href="http_8c.html#a3ce71802a2d0296a3478fcfeb3c21aac">__ast_http_load</a>(1);
<a name="l01017"></a>01017 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af9629ecd6340cb99bf474736b97433d7"></a><!-- doxytag: member="_private.h::ast_indications_init" ref="af9629ecd6340cb99bf474736b97433d7" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_indications_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Load indications module. </p>
<p>Provided by <a class="el" href="indications_8c.html" title="Indication Tone Handling.">indications.c</a> </p>

<p>Definition at line <a class="el" href="indications_8c_source.html#l01106">1106</a> of file <a class="el" href="indications_8c_source.html">indications.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00727">ao2_container_alloc</a>, <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="cli_8c_source.html#l01927">ast_cli_register_multiple()</a>, <a class="el" href="indications_8c_source.html#l01096">ast_tone_zone_cmp()</a>, <a class="el" href="indications_8c_source.html#l01089">ast_tone_zone_hash()</a>, <a class="el" href="indications_8c_source.html#l01030">load_indications()</a>, and <a class="el" href="indications_8c_source.html#l00065">NUM_TONE_ZONE_BUCKETS</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01107"></a>01107 {
<a name="l01108"></a>01108    <span class="keywordflow">if</span> (!(<a class="code" href="indications_8c.html#aa9af3b8f87bfc214ab7feed61fe8e898">ast_tone_zones</a> = <a class="code" href="astobj2_8h.html#a82534c91be59ec9a3d3318ec85ac5695">ao2_container_alloc</a>(<a class="code" href="indications_8c.html#a4bdb50638cb1bc2004b6584c730be131">NUM_TONE_ZONE_BUCKETS</a>,
<a name="l01109"></a>01109          <a class="code" href="indications_8c.html#ab195c7509de4213729f891d93760fe1e">ast_tone_zone_hash</a>, <a class="code" href="indications_8c.html#af8cd198793a277e15825f3b7751c07bc">ast_tone_zone_cmp</a>))) {
<a name="l01110"></a>01110       <span class="keywordflow">return</span> -1;
<a name="l01111"></a>01111    }
<a name="l01112"></a>01112 
<a name="l01113"></a>01113    <span class="keywordflow">if</span> (<a class="code" href="indications_8c.html#a2b57ddcc692c2a87cca9b678b8e66eb5" title="load indications module">load_indications</a>(0)) {
<a name="l01114"></a>01114       <span class="keywordflow">return</span> -1;
<a name="l01115"></a>01115    }
<a name="l01116"></a>01116 
<a name="l01117"></a>01117    <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(<a class="code" href="indications_8c.html#a55a2daa95745b1db123278cef7a60384" title="CLI entries for commands provided by this module.">cli_indications</a>, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="indications_8c.html#a55a2daa95745b1db123278cef7a60384" title="CLI entries for commands provided by this module.">cli_indications</a>));
<a name="l01118"></a>01118 
<a name="l01119"></a>01119    <span class="keywordflow">return</span> 0;
<a name="l01120"></a>01120 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7eef6a8d3d8d5e484c57eb9c6f39fdbf"></a><!-- doxytag: member="_private.h::ast_indications_reload" ref="a7eef6a8d3d8d5e484c57eb9c6f39fdbf" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_indications_reload </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reload indications module. </p>
<p>Provided by <a class="el" href="indications_8c.html" title="Indication Tone Handling.">indications.c</a> </p>

<p>Definition at line <a class="el" href="indications_8c_source.html#l01123">1123</a> of file <a class="el" href="indications_8c_source.html">indications.c</a>.</p>

<p>References <a class="el" href="indications_8c_source.html#l01030">load_indications()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01124"></a>01124 {
<a name="l01125"></a>01125    <span class="keywordflow">return</span> <a class="code" href="indications_8c.html#a2b57ddcc692c2a87cca9b678b8e66eb5" title="load indications module">load_indications</a>(1);
<a name="l01126"></a>01126 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0d0ff279ff3f2dbbbfb1b49ee6f57add"></a><!-- doxytag: member="_private.h::ast_module_reload" ref="a0d0ff279ff3f2dbbbfb1b49ee6f57add" args="(const char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_module_reload </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reload asterisk modules. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>the name of the module to reload</td></tr>
  </table>
  </dd>
</dl>
<p>This function reloads the specified module, or if no modules are specified, it will reload all loaded modules.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>Modules are reloaded using their <a class="el" href="app__amd_8c.html#ad1982509765f4870f1f63412a53ea668">reload()</a> functions, not unloading them and loading them again.</dd></dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 if the specified module was not found. </dd></dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>1</em>&nbsp;</td><td>if the module was found but cannot be reloaded. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>if a reload operation is already in <a class="el" href="structprogress.html">progress</a>. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>2</em>&nbsp;</td><td>if the specfied module was found and reloaded. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="loader_8c_source.html#l00637">637</a> of file <a class="el" href="loader_8c_source.html">loader.c</a>.</p>

<p>References <a class="el" href="options_8h_source.html#l00107">ast_fully_booted</a>, <a class="el" href="asterisk_8c_source.html#l00211">ast_lastreloadtime</a>, <a class="el" href="linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01722">ast_mutex_trylock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="logger_8h_source.html#l00079">ast_verbose</a>, <a class="el" href="loader_8c_source.html#l00091">ast_module::declined</a>, <a class="el" href="module_8h_source.html#l00211">ast_module_info::description</a>, <a class="el" href="structast__module.html#a4602cfc6834c0c5a50ba85844d9e36d3">ast_module::flags</a>, <a class="el" href="loader_8c_source.html#l00085">ast_module::info</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="loader_8c_source.html#l00599">queue_reload_request()</a>, <a class="el" href="structast__module__info.html#a6df96c24939202e4f8837ff51c99d078">ast_module_info::reload</a>, <a class="el" href="loader_8c_source.html#l00094">ast_module::resource</a>, <a class="el" href="loader_8c_source.html#l00308">resource_name_match()</a>, and <a class="el" href="loader_8c_source.html#l00090">ast_module::running</a>.</p>

<p>Referenced by <a class="el" href="manager_8c_source.html#l02794">action_reload()</a>, <a class="el" href="manager_8c_source.html#l01481">action_updateconfig()</a>, <a class="el" href="loader_8c_source.html#l00572">ast_process_pending_reloads()</a>, <a class="el" href="cli_8c_source.html#l00269">handle_reload()</a>, <a class="el" href="manager_8c_source.html#l02938">manager_moduleload()</a>, and <a class="el" href="asterisk_8c_source.html#l03017">monitor_sig_flags()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00638"></a>00638 {
<a name="l00639"></a>00639    <span class="keyword">struct </span><a class="code" href="structast__module.html">ast_module</a> *cur;
<a name="l00640"></a>00640    <span class="keywordtype">int</span> res = 0; <span class="comment">/* return value. 0 = not found, others, see below */</span>
<a name="l00641"></a>00641    <span class="keywordtype">int</span> i;
<a name="l00642"></a>00642 
<a name="l00643"></a>00643    <span class="comment">/* If we aren&apos;t fully booted, we just pretend we reloaded but we queue this</span>
<a name="l00644"></a>00644 <span class="comment">      up to run once we are booted up. */</span>
<a name="l00645"></a>00645    <span class="keywordflow">if</span> (!<a class="code" href="options_8h.html#a6da2c0ee84c135b777b761b443861f19">ast_fully_booted</a>) {
<a name="l00646"></a>00646       <a class="code" href="loader_8c.html#abc4572014dbb249f18af82933dc40050">queue_reload_request</a>(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l00647"></a>00647       <span class="keywordflow">return</span> 0;
<a name="l00648"></a>00648    }
<a name="l00649"></a>00649 
<a name="l00650"></a>00650    <span class="keywordflow">if</span> (<a class="code" href="lock_8h.html#a036ccafa2339f674a46bc269bbd48c5f">ast_mutex_trylock</a>(&amp;<a class="code" href="loader_8c.html#a39a4ab22c3e08054d2efe759d8610f12">reloadlock</a>)) {
<a name="l00651"></a>00651       <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;The previous reload command didn&apos;t finish yet\n&quot;</span>);
<a name="l00652"></a>00652       <span class="keywordflow">return</span> -1;  <span class="comment">/* reload already in progress */</span>
<a name="l00653"></a>00653    }
<a name="l00654"></a>00654    <a class="code" href="options_8h.html#a7cdafc5a121e87659887ffc9abe36760">ast_lastreloadtime</a> = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l00655"></a>00655 
<a name="l00656"></a>00656    <span class="comment">/* Call &quot;predefined&quot; reload here first */</span>
<a name="l00657"></a>00657    <span class="keywordflow">for</span> (i = 0; <a class="code" href="structreload__classes.html">reload_classes</a>[i].name; i++) {
<a name="l00658"></a>00658       <span class="keywordflow">if</span> (!<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a> || !strcasecmp(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <a class="code" href="structreload__classes.html">reload_classes</a>[i].<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>)) {
<a name="l00659"></a>00659          <a class="code" href="structreload__classes.html">reload_classes</a>[i].reload_fn();   <span class="comment">/* XXX should check error ? */</span>
<a name="l00660"></a>00660          res = 2; <span class="comment">/* found and reloaded */</span>
<a name="l00661"></a>00661       }
<a name="l00662"></a>00662    }
<a name="l00663"></a>00663 
<a name="l00664"></a>00664    <span class="keywordflow">if</span> (name &amp;&amp; res) {
<a name="l00665"></a>00665       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="loader_8c.html#a39a4ab22c3e08054d2efe759d8610f12">reloadlock</a>);
<a name="l00666"></a>00666       <span class="keywordflow">return</span> res;
<a name="l00667"></a>00667    }
<a name="l00668"></a>00668 
<a name="l00669"></a>00669    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="structmodule__list.html">module_list</a>);
<a name="l00670"></a>00670    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="structmodule__list.html">module_list</a>, cur, <a class="code" href="structast__module.html#a9fea691ae9aba6d601e329e598441c1a">entry</a>) {
<a name="l00671"></a>00671       <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structast__module__info.html">ast_module_info</a> *info = cur-&gt;<a class="code" href="structast__module.html#a92b847af7c50bfb3566f2eae3602afb1">info</a>;
<a name="l00672"></a>00672 
<a name="l00673"></a>00673       <span class="keywordflow">if</span> (name &amp;&amp; <a class="code" href="loader_8c.html#a97e726834efdf4ce00f0d134cc12654e">resource_name_match</a>(name, cur-&gt;<a class="code" href="structast__module.html#ac88a22a2e7bf6d75bcc8fcc8ff257e9f">resource</a>))
<a name="l00674"></a>00674          <span class="keywordflow">continue</span>;
<a name="l00675"></a>00675 
<a name="l00676"></a>00676       <span class="keywordflow">if</span> (!cur-&gt;<a class="code" href="structast__module.html#a4602cfc6834c0c5a50ba85844d9e36d3">flags</a>.<a class="code" href="structast__module.html#a08d1dda1d258042e77ca92d39a12e619">running</a> || cur-&gt;<a class="code" href="structast__module.html#a4602cfc6834c0c5a50ba85844d9e36d3">flags</a>.<a class="code" href="structast__module.html#a85ddc5d9a4ffbf82da66e98d8f85977e">declined</a>) {
<a name="l00677"></a>00677          <span class="keywordflow">if</span> (!name)
<a name="l00678"></a>00678             <span class="keywordflow">continue</span>;
<a name="l00679"></a>00679          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;The module &apos;%s&apos; was not properly initialized.  &quot;</span>
<a name="l00680"></a>00680             <span class="stringliteral">&quot;Before reloading the module, you must run \&quot;module load %s\&quot; &quot;</span>
<a name="l00681"></a>00681             <span class="stringliteral">&quot;and fix whatever is preventing the module from being initialized.\n&quot;</span>,
<a name="l00682"></a>00682             name, name);
<a name="l00683"></a>00683          res = 2; <span class="comment">/* Don&apos;t report that the module was not found */</span>
<a name="l00684"></a>00684          <span class="keywordflow">break</span>;
<a name="l00685"></a>00685       }
<a name="l00686"></a>00686 
<a name="l00687"></a>00687       <span class="keywordflow">if</span> (!info-&gt;<a class="code" href="structast__module__info.html#a6df96c24939202e4f8837ff51c99d078">reload</a>) { <span class="comment">/* cannot be reloaded */</span>
<a name="l00688"></a>00688          <span class="keywordflow">if</span> (res &lt; 1)   <span class="comment">/* store result if possible */</span>
<a name="l00689"></a>00689             res = 1; <span class="comment">/* 1 = no reload() method */</span>
<a name="l00690"></a>00690          <span class="keywordflow">continue</span>;
<a name="l00691"></a>00691       }
<a name="l00692"></a>00692 
<a name="l00693"></a>00693       res = 2;
<a name="l00694"></a>00694       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Reloading module &apos;%s&apos; (%s)\n&quot;</span>, cur-&gt;<a class="code" href="structast__module.html#ac88a22a2e7bf6d75bcc8fcc8ff257e9f">resource</a>, info-&gt;<a class="code" href="structast__module__info.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a>);
<a name="l00695"></a>00695       info-&gt;<a class="code" href="structast__module__info.html#a6df96c24939202e4f8837ff51c99d078">reload</a>();
<a name="l00696"></a>00696    }
<a name="l00697"></a>00697    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="structmodule__list.html">module_list</a>);
<a name="l00698"></a>00698 
<a name="l00699"></a>00699    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="loader_8c.html#a39a4ab22c3e08054d2efe759d8610f12">reloadlock</a>);
<a name="l00700"></a>00700 
<a name="l00701"></a>00701    <span class="keywordflow">return</span> res;
<a name="l00702"></a>00702 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a07bf5448c6189024cbc925a3e8ecb5e0"></a><!-- doxytag: member="_private.h::ast_process_pending_reloads" ref="a07bf5448c6189024cbc925a3e8ecb5e0" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_process_pending_reloads </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Process reload <a class="el" href="structrequests.html">requests</a> received during startup. </p>
<p>This function <a class="el" href="structrequests.html">requests</a> that the loader execute the pending reload <a class="el" href="structrequests.html">requests</a> that were queued during server startup.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>This function will do nothing if the server has not completely started up. Once called, the reload queue is emptied, and further invocations will have no affect. </dd></dl>

<p>Definition at line <a class="el" href="loader_8c_source.html#l00572">572</a> of file <a class="el" href="loader_8c_source.html">loader.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="options_8h_source.html#l00107">ast_fully_booted</a>, <a class="el" href="linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00817">AST_LIST_REMOVE_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="loader_8c_source.html#l00637">ast_module_reload()</a>, <a class="el" href="loader_8c_source.html#l00121">do_full_reload</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, and <a class="el" href="loader_8c_source.html#l00118">reload_queue_item::module</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00573"></a>00573 {
<a name="l00574"></a>00574    <span class="keyword">struct </span><a class="code" href="structreload__queue__item.html">reload_queue_item</a> *item;
<a name="l00575"></a>00575 
<a name="l00576"></a>00576    <span class="keywordflow">if</span> (!<a class="code" href="options_8h.html#a6da2c0ee84c135b777b761b443861f19">ast_fully_booted</a>) {
<a name="l00577"></a>00577       <span class="keywordflow">return</span>;
<a name="l00578"></a>00578    }
<a name="l00579"></a>00579 
<a name="l00580"></a>00580    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="structreload__queue.html">reload_queue</a>);
<a name="l00581"></a>00581 
<a name="l00582"></a>00582    <span class="keywordflow">if</span> (<a class="code" href="loader_8c.html#a7c997a1dd7a91d37adb9845a44e56535">do_full_reload</a>) {
<a name="l00583"></a>00583       <a class="code" href="loader_8c.html#a7c997a1dd7a91d37adb9845a44e56535">do_full_reload</a> = 0;
<a name="l00584"></a>00584       <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="structreload__queue.html">reload_queue</a>);
<a name="l00585"></a>00585       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Executing deferred reload request.\n&quot;</span>);
<a name="l00586"></a>00586       <a class="code" href="__private_8h.html#a0d0ff279ff3f2dbbbfb1b49ee6f57add" title="Reload asterisk modules.">ast_module_reload</a>(NULL);
<a name="l00587"></a>00587       <span class="keywordflow">return</span>;
<a name="l00588"></a>00588    }
<a name="l00589"></a>00589 
<a name="l00590"></a>00590    <span class="keywordflow">while</span> ((item = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;<a class="code" href="structreload__queue.html">reload_queue</a>, <a class="code" href="structreload__queue__item.html#a81074fd512b6df8214432e03d8133e21">entry</a>))) {
<a name="l00591"></a>00591       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Executing deferred reload request for module &apos;%s&apos;.\n&quot;</span>, item-&gt;<a class="code" href="structreload__queue__item.html#af63def77ab06c90fe93bcdf2157b2a90">module</a>);
<a name="l00592"></a>00592       <a class="code" href="__private_8h.html#a0d0ff279ff3f2dbbbfb1b49ee6f57add" title="Reload asterisk modules.">ast_module_reload</a>(item-&gt;<a class="code" href="structreload__queue__item.html#af63def77ab06c90fe93bcdf2157b2a90">module</a>);
<a name="l00593"></a>00593       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(item);
<a name="l00594"></a>00594    }
<a name="l00595"></a>00595 
<a name="l00596"></a>00596    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="structreload__queue.html">reload_queue</a>);
<a name="l00597"></a>00597 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adb76df37ea8ca7aae2791a447db82430"></a><!-- doxytag: member="_private.h::ast_ssl_init" ref="adb76df37ea8ca7aae2791a447db82430" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_ssl_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Porvided by <a class="el" href="ssl_8c.html" title="Common OpenSSL support code.">ssl.c</a> </p>

<p>Definition at line <a class="el" href="ssl_8c_source.html#l00073">73</a> of file <a class="el" href="ssl_8c_source.html">ssl.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="lock_8h_source.html#l01692">ast_mutex_init()</a>, <a class="el" href="ssl_8c_source.html#l00051">ssl_lock()</a>, and <a class="el" href="ssl_8c_source.html#l00046">ssl_threadid()</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00074"></a>00074 {
<a name="l00075"></a>00075 <span class="preprocessor">#ifdef HAVE_OPENSSL</span>
<a name="l00076"></a>00076 <span class="preprocessor"></span>   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
<a name="l00077"></a>00077 
<a name="l00078"></a>00078    SSL_library_init();
<a name="l00079"></a>00079    SSL_load_error_strings();
<a name="l00080"></a>00080    ERR_load_crypto_strings();
<a name="l00081"></a>00081    ERR_load_BIO_strings();
<a name="l00082"></a>00082    OpenSSL_add_all_algorithms();
<a name="l00083"></a>00083 
<a name="l00084"></a>00084    <span class="comment">/* Make OpenSSL thread-safe. */</span>
<a name="l00085"></a>00085 
<a name="l00086"></a>00086    CRYPTO_set_id_callback(<a class="code" href="ssl_8c.html#ad94d304981015eb43d17982551874afa">ssl_threadid</a>);
<a name="l00087"></a>00087 
<a name="l00088"></a>00088    <a class="code" href="ssl_8c.html#ad1da05251953e4271d230bed11531631">ssl_num_locks</a> = CRYPTO_num_locks();
<a name="l00089"></a>00089    <span class="keywordflow">if</span> (!(<a class="code" href="ssl_8c.html#aa1ba3ccc2441dc9223517472745d0930">ssl_locks</a> = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(<a class="code" href="ssl_8c.html#ad1da05251953e4271d230bed11531631">ssl_num_locks</a>, <span class="keyword">sizeof</span>(<a class="code" href="ssl_8c.html#aa1ba3ccc2441dc9223517472745d0930">ssl_locks</a>[0])))) {
<a name="l00090"></a>00090       <span class="keywordflow">return</span> -1;
<a name="l00091"></a>00091    }
<a name="l00092"></a>00092    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="ssl_8c.html#ad1da05251953e4271d230bed11531631">ssl_num_locks</a>; i++) {
<a name="l00093"></a>00093       <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;<a class="code" href="ssl_8c.html#aa1ba3ccc2441dc9223517472745d0930">ssl_locks</a>[i]);
<a name="l00094"></a>00094    }
<a name="l00095"></a>00095    CRYPTO_set_locking_callback(<a class="code" href="ssl_8c.html#ae9bde8d23ae2b14aa1654236cee42ecf">ssl_lock</a>);
<a name="l00096"></a>00096 
<a name="l00097"></a>00097 <span class="preprocessor">#endif </span><span class="comment">/* HAVE_OPENSSL */</span>
<a name="l00098"></a>00098    <span class="keywordflow">return</span> 0;
<a name="l00099"></a>00099 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1997b4ca4fdf17e715fddf00f44c9651"></a><!-- doxytag: member="_private.h::ast_term_init" ref="a1997b4ca4fdf17e715fddf00f44c9651" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_term_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Provided by <a class="el" href="term_8c.html" title="Terminal Routines.">term.c</a> </p>

<p>Definition at line <a class="el" href="term_8c_source.html#l00083">83</a> of file <a class="el" href="term_8c_source.html">term.c</a>.</p>

<p>References <a class="el" href="options_8h_source.html#l00101">ast_opt_console</a>, <a class="el" href="options_8h_source.html#l00123">ast_opt_force_black_background</a>, <a class="el" href="options_8h_source.html#l00122">ast_opt_light_background</a>, <a class="el" href="options_8h_source.html#l00106">ast_opt_no_color</a>, <a class="el" href="options_8h_source.html#l00099">ast_opt_no_fork</a>, <a class="el" href="term_8h_source.html#l00036">ATTR_BRIGHT</a>, <a class="el" href="term_8h_source.html#l00035">ATTR_RESET</a>, <a class="el" href="term_8h_source.html#l00047">COLOR_BLACK</a>, <a class="el" href="term_8h_source.html#l00053">COLOR_BROWN</a>, <a class="el" href="term_8h_source.html#l00061">COLOR_WHITE</a>, <a class="el" href="term_8c_source.html#l00068">convshort()</a>, and <a class="el" href="term_8h_source.html#l00030">ESC</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00084"></a>00084 {
<a name="l00085"></a>00085    <span class="keywordtype">char</span> *term = getenv(<span class="stringliteral">&quot;TERM&quot;</span>);
<a name="l00086"></a>00086    <span class="keywordtype">char</span> termfile[256] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00087"></a>00087    <span class="keywordtype">char</span> buffer[512] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00088"></a>00088    <span class="keywordtype">int</span> termfd = -1, parseokay = 0, i;
<a name="l00089"></a>00089 
<a name="l00090"></a>00090    <span class="keywordflow">if</span> (!term)
<a name="l00091"></a>00091       <span class="keywordflow">return</span> 0;
<a name="l00092"></a>00092    <span class="keywordflow">if</span> (!<a class="code" href="options_8h.html#a4fe31af40146104d64d4a31535e44400">ast_opt_console</a> || <a class="code" href="options_8h.html#a719a34aedba7c0f9fba501ac4976f432">ast_opt_no_color</a> || !<a class="code" href="options_8h.html#a93b280adefdad68d13fb557f495d2ead">ast_opt_no_fork</a>)
<a name="l00093"></a>00093       <span class="keywordflow">return</span> 0;
<a name="l00094"></a>00094 
<a name="l00095"></a>00095    <span class="keywordflow">for</span> (i=0 ;; i++) {
<a name="l00096"></a>00096       <span class="keywordflow">if</span> (<a class="code" href="term_8c.html#a98f75c41b034c41690c2a1aee7fd401b">termpath</a>[i] == NULL) {
<a name="l00097"></a>00097          <span class="keywordflow">break</span>;
<a name="l00098"></a>00098       }
<a name="l00099"></a>00099       snprintf(termfile, <span class="keyword">sizeof</span>(termfile), <span class="stringliteral">&quot;%s/%c/%s&quot;</span>, <a class="code" href="term_8c.html#a98f75c41b034c41690c2a1aee7fd401b">termpath</a>[i], *term, term);
<a name="l00100"></a>00100       termfd = open(termfile, O_RDONLY);
<a name="l00101"></a>00101       <span class="keywordflow">if</span> (termfd &gt; -1) {
<a name="l00102"></a>00102          <span class="keywordflow">break</span>;
<a name="l00103"></a>00103       }
<a name="l00104"></a>00104    }
<a name="l00105"></a>00105    <span class="keywordflow">if</span> (termfd &gt; -1) {
<a name="l00106"></a>00106       <span class="keywordtype">int</span> actsize = read(termfd, buffer, <span class="keyword">sizeof</span>(buffer) - 1);
<a name="l00107"></a>00107       <span class="keywordtype">short</span> sz_names = <a class="code" href="term_8c.html#a305d2623f41d5f47626398932061b18b">convshort</a>(buffer + 2);
<a name="l00108"></a>00108       <span class="keywordtype">short</span> sz_bools = <a class="code" href="term_8c.html#a305d2623f41d5f47626398932061b18b">convshort</a>(buffer + 4);
<a name="l00109"></a>00109       <span class="keywordtype">short</span> n_nums   = <a class="code" href="term_8c.html#a305d2623f41d5f47626398932061b18b">convshort</a>(buffer + 6);
<a name="l00110"></a>00110 
<a name="l00111"></a>00111       <span class="comment">/* if ((sz_names + sz_bools) &amp; 1)</span>
<a name="l00112"></a>00112 <span class="comment">         sz_bools++; */</span>
<a name="l00113"></a>00113 
<a name="l00114"></a>00114       <span class="keywordflow">if</span> (sz_names + sz_bools + n_nums &lt; actsize) {
<a name="l00115"></a>00115          <span class="comment">/* Offset 13 is defined in /usr/include/term.h, though we do not</span>
<a name="l00116"></a>00116 <span class="comment">          * include it here, as it conflicts with include/asterisk/term.h */</span>
<a name="l00117"></a>00117          <span class="keywordtype">short</span> max_colors = <a class="code" href="term_8c.html#a305d2623f41d5f47626398932061b18b">convshort</a>(buffer + 12 + sz_names + sz_bools + 13 * 2);
<a name="l00118"></a>00118          <span class="keywordflow">if</span> (max_colors &gt; 0) {
<a name="l00119"></a>00119             <a class="code" href="term_8c.html#a125a61a06520f427f3b7f5a8cc2088c4">vt100compat</a> = 1;
<a name="l00120"></a>00120          }
<a name="l00121"></a>00121          parseokay = 1;
<a name="l00122"></a>00122       }
<a name="l00123"></a>00123       close(termfd);
<a name="l00124"></a>00124    }
<a name="l00125"></a>00125 
<a name="l00126"></a>00126    <span class="keywordflow">if</span> (!parseokay) {
<a name="l00127"></a>00127       <span class="comment">/* These comparisons should not be substrings nor case-insensitive, as</span>
<a name="l00128"></a>00128 <span class="comment">       * terminal types are very particular about how they treat suffixes and</span>
<a name="l00129"></a>00129 <span class="comment">       * capitalization.  For example, terminal type &apos;linux-m&apos; does NOT</span>
<a name="l00130"></a>00130 <span class="comment">       * support color, while &apos;linux&apos; does.  Not even all vt100* terminals</span>
<a name="l00131"></a>00131 <span class="comment">       * support color, either (e.g. &apos;vt100+fnkeys&apos;). */</span>
<a name="l00132"></a>00132       <span class="keywordflow">if</span> (!strcmp(term, <span class="stringliteral">&quot;linux&quot;</span>)) {
<a name="l00133"></a>00133          <a class="code" href="term_8c.html#a125a61a06520f427f3b7f5a8cc2088c4">vt100compat</a> = 1;
<a name="l00134"></a>00134       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(term, <span class="stringliteral">&quot;xterm&quot;</span>)) {
<a name="l00135"></a>00135          <a class="code" href="term_8c.html#a125a61a06520f427f3b7f5a8cc2088c4">vt100compat</a> = 1;
<a name="l00136"></a>00136       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(term, <span class="stringliteral">&quot;xterm-color&quot;</span>)) {
<a name="l00137"></a>00137          <a class="code" href="term_8c.html#a125a61a06520f427f3b7f5a8cc2088c4">vt100compat</a> = 1;
<a name="l00138"></a>00138       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncmp(term, <span class="stringliteral">&quot;Eterm&quot;</span>, 5)) {
<a name="l00139"></a>00139          <span class="comment">/* Both entries which start with Eterm support color */</span>
<a name="l00140"></a>00140          <a class="code" href="term_8c.html#a125a61a06520f427f3b7f5a8cc2088c4">vt100compat</a> = 1;
<a name="l00141"></a>00141       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(term, <span class="stringliteral">&quot;vt100&quot;</span>)) {
<a name="l00142"></a>00142          <a class="code" href="term_8c.html#a125a61a06520f427f3b7f5a8cc2088c4">vt100compat</a> = 1;
<a name="l00143"></a>00143       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncmp(term, <span class="stringliteral">&quot;crt&quot;</span>, 3)) {
<a name="l00144"></a>00144          <span class="comment">/* Both crt terminals support color */</span>
<a name="l00145"></a>00145          <a class="code" href="term_8c.html#a125a61a06520f427f3b7f5a8cc2088c4">vt100compat</a> = 1;
<a name="l00146"></a>00146       }
<a name="l00147"></a>00147    }
<a name="l00148"></a>00148 
<a name="l00149"></a>00149    <span class="keywordflow">if</span> (<a class="code" href="term_8c.html#a125a61a06520f427f3b7f5a8cc2088c4">vt100compat</a>) {
<a name="l00150"></a>00150       <span class="comment">/* Make commands show up in nice colors */</span>
<a name="l00151"></a>00151       <span class="keywordflow">if</span> (<a class="code" href="options_8h.html#a91478819e0674b7b7a2c57565c999bb3">ast_opt_light_background</a>) {
<a name="l00152"></a>00152          snprintf(<a class="code" href="term_8c.html#a4fa123c2b4efe8acc469efa44f0d727a">prepdata</a>, <span class="keyword">sizeof</span>(<a class="code" href="term_8c.html#a4fa123c2b4efe8acc469efa44f0d727a">prepdata</a>), <span class="stringliteral">&quot;%c[%dm&quot;</span>, <a class="code" href="term_8h.html#a4af1b6159e447ba72652bb7fcdfa726e">ESC</a>, <a class="code" href="term_8h.html#a928e144dbbe4316dbb854245c7e38de7">COLOR_BROWN</a>);
<a name="l00153"></a>00153          snprintf(<a class="code" href="term_8c.html#a88e11c98fbdd3fbfe9009ad8b34f10e0">enddata</a>, <span class="keyword">sizeof</span>(<a class="code" href="term_8c.html#a88e11c98fbdd3fbfe9009ad8b34f10e0">enddata</a>), <span class="stringliteral">&quot;%c[%dm&quot;</span>, <a class="code" href="term_8h.html#a4af1b6159e447ba72652bb7fcdfa726e">ESC</a>, <a class="code" href="term_8h.html#aba2a7fe77a7501e5844370eec0185207">COLOR_BLACK</a>);
<a name="l00154"></a>00154          snprintf(<a class="code" href="term_8c.html#a98657f6b740d5a69939c4ef651cabffe">quitdata</a>, <span class="keyword">sizeof</span>(<a class="code" href="term_8c.html#a98657f6b740d5a69939c4ef651cabffe">quitdata</a>), <span class="stringliteral">&quot;%c[0m&quot;</span>, <a class="code" href="term_8h.html#a4af1b6159e447ba72652bb7fcdfa726e">ESC</a>);
<a name="l00155"></a>00155       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="options_8h.html#a74dd582c56c0ed1841fd53b3d5081be1">ast_opt_force_black_background</a>) {
<a name="l00156"></a>00156          snprintf(<a class="code" href="term_8c.html#a4fa123c2b4efe8acc469efa44f0d727a">prepdata</a>, <span class="keyword">sizeof</span>(<a class="code" href="term_8c.html#a4fa123c2b4efe8acc469efa44f0d727a">prepdata</a>), <span class="stringliteral">&quot;%c[%d;%d;%dm&quot;</span>, <a class="code" href="term_8h.html#a4af1b6159e447ba72652bb7fcdfa726e">ESC</a>, <a class="code" href="term_8h.html#a065c9e83a8ce8e6711d5a4150f9e5552">ATTR_BRIGHT</a>, <a class="code" href="term_8h.html#a928e144dbbe4316dbb854245c7e38de7">COLOR_BROWN</a>, <a class="code" href="term_8h.html#aba2a7fe77a7501e5844370eec0185207">COLOR_BLACK</a> + 10);
<a name="l00157"></a>00157          snprintf(<a class="code" href="term_8c.html#a88e11c98fbdd3fbfe9009ad8b34f10e0">enddata</a>, <span class="keyword">sizeof</span>(<a class="code" href="term_8c.html#a88e11c98fbdd3fbfe9009ad8b34f10e0">enddata</a>), <span class="stringliteral">&quot;%c[%d;%d;%dm&quot;</span>, <a class="code" href="term_8h.html#a4af1b6159e447ba72652bb7fcdfa726e">ESC</a>, <a class="code" href="term_8h.html#ac8ec4884c0afd4b8e274465fc75bbe9b">ATTR_RESET</a>, <a class="code" href="term_8h.html#a9b44987ffdc2af19b635206b94334b69">COLOR_WHITE</a>, <a class="code" href="term_8h.html#aba2a7fe77a7501e5844370eec0185207">COLOR_BLACK</a> + 10);
<a name="l00158"></a>00158          snprintf(<a class="code" href="term_8c.html#a98657f6b740d5a69939c4ef651cabffe">quitdata</a>, <span class="keyword">sizeof</span>(<a class="code" href="term_8c.html#a98657f6b740d5a69939c4ef651cabffe">quitdata</a>), <span class="stringliteral">&quot;%c[0m&quot;</span>, <a class="code" href="term_8h.html#a4af1b6159e447ba72652bb7fcdfa726e">ESC</a>);
<a name="l00159"></a>00159       } <span class="keywordflow">else</span> {
<a name="l00160"></a>00160          snprintf(<a class="code" href="term_8c.html#a4fa123c2b4efe8acc469efa44f0d727a">prepdata</a>, <span class="keyword">sizeof</span>(<a class="code" href="term_8c.html#a4fa123c2b4efe8acc469efa44f0d727a">prepdata</a>), <span class="stringliteral">&quot;%c[%d;%dm&quot;</span>, <a class="code" href="term_8h.html#a4af1b6159e447ba72652bb7fcdfa726e">ESC</a>, <a class="code" href="term_8h.html#a065c9e83a8ce8e6711d5a4150f9e5552">ATTR_BRIGHT</a>, <a class="code" href="term_8h.html#a928e144dbbe4316dbb854245c7e38de7">COLOR_BROWN</a>);
<a name="l00161"></a>00161          snprintf(<a class="code" href="term_8c.html#a88e11c98fbdd3fbfe9009ad8b34f10e0">enddata</a>, <span class="keyword">sizeof</span>(<a class="code" href="term_8c.html#a88e11c98fbdd3fbfe9009ad8b34f10e0">enddata</a>), <span class="stringliteral">&quot;%c[%d;%dm&quot;</span>, <a class="code" href="term_8h.html#a4af1b6159e447ba72652bb7fcdfa726e">ESC</a>, <a class="code" href="term_8h.html#ac8ec4884c0afd4b8e274465fc75bbe9b">ATTR_RESET</a>, <a class="code" href="term_8h.html#a9b44987ffdc2af19b635206b94334b69">COLOR_WHITE</a>);
<a name="l00162"></a>00162          snprintf(<a class="code" href="term_8c.html#a98657f6b740d5a69939c4ef651cabffe">quitdata</a>, <span class="keyword">sizeof</span>(<a class="code" href="term_8c.html#a98657f6b740d5a69939c4ef651cabffe">quitdata</a>), <span class="stringliteral">&quot;%c[0m&quot;</span>, <a class="code" href="term_8h.html#a4af1b6159e447ba72652bb7fcdfa726e">ESC</a>);
<a name="l00163"></a>00163       }
<a name="l00164"></a>00164    }
<a name="l00165"></a>00165    <span class="keywordflow">return</span> 0;
<a name="l00166"></a>00166 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a14d1423f33a1d054171143c28490368f"></a><!-- doxytag: member="_private.h::ast_timing_init" ref="a14d1423f33a1d054171143c28490368f" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_timing_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Provided by <a class="el" href="timing_8c.html" title="Timing source management.">timing.c</a> </p>

<p>Definition at line <a class="el" href="timing_8c_source.html#l00283">283</a> of file <a class="el" href="timing_8c_source.html">timing.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="cli_8c_source.html#l01927">ast_cli_register_multiple()</a>, <a class="el" href="heap_8c_source.html#l00114">ast_heap_create()</a>, and <a class="el" href="timing_8c_source.html#l00057">timing_holder_cmp()</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00284"></a>00284 {
<a name="l00285"></a>00285    <span class="keywordflow">if</span> (!(<a class="code" href="timing_8c.html#a38607df66c48ce2280bfada876244b00">timing_interfaces</a> = <a class="code" href="heap_8h.html#a2b4b738c784e05941437ff369a399712" title="Create a max heap.">ast_heap_create</a>(2, <a class="code" href="timing_8c.html#abe67ecd5505b48f6197e00bc52748f6d">timing_holder_cmp</a>, 0))) {
<a name="l00286"></a>00286       <span class="keywordflow">return</span> -1;
<a name="l00287"></a>00287    }
<a name="l00288"></a>00288 
<a name="l00289"></a>00289    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(<a class="code" href="timing_8c.html#a947cc0a9dbcc7435920f0c9bb973b23f">cli_timing</a>, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="timing_8c.html#a947cc0a9dbcc7435920f0c9bb973b23f">cli_timing</a>));
<a name="l00290"></a>00290 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a58f95b0d90cc7fe0d44ec5aae481c819"></a><!-- doxytag: member="_private.h::ast_tps_init" ref="a58f95b0d90cc7fe0d44ec5aae481c819" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_tps_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Provided by <a class="el" href="taskprocessor_8c.html" title="Maintain a container of uniquely-named taskprocessor threads that can be shared across...">taskprocessor.c</a> </p>

<p>Definition at line <a class="el" href="taskprocessor_8c_source.html#l00122">122</a> of file <a class="el" href="taskprocessor_8c_source.html">taskprocessor.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00727">ao2_container_alloc</a>, <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="cli_8c_source.html#l01927">ast_cli_register_multiple()</a>, <a class="el" href="lock_8h_source.html#l01729">ast_cond_init()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="taskprocessor_8c_source.html#l00088">cli_ping_cond</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="taskprocessor_8c_source.html#l00116">taskprocessor_clis</a>, <a class="el" href="taskprocessor_8c_source.html#l00338">tps_cmp_cb()</a>, <a class="el" href="taskprocessor_8c_source.html#l00330">tps_hash_cb()</a>, <a class="el" href="taskprocessor_8c_source.html#l00083">TPS_MAX_BUCKETS</a>, and <a class="el" href="taskprocessor_8c_source.html#l00085">tps_singletons</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00123"></a>00123 {
<a name="l00124"></a>00124    <span class="keywordflow">if</span> (!(<a class="code" href="taskprocessor_8c.html#ad2465de7eb87991ce5f1d68b2de2a9e2" title="tps_singletons is the astobj2 container for taskprocessor singletons">tps_singletons</a> = <a class="code" href="astobj2_8h.html#a82534c91be59ec9a3d3318ec85ac5695">ao2_container_alloc</a>(<a class="code" href="taskprocessor_8c.html#a324cc9d868c635cb5bff2e559024b78b">TPS_MAX_BUCKETS</a>, <a class="code" href="taskprocessor_8c.html#ae4e09c51f3627ca1091628718067ed7c" title="The astobj2 hash callback for taskprocessors.">tps_hash_cb</a>, <a class="code" href="taskprocessor_8c.html#ad12172ebca405a9600704348ac059ec2" title="The astobj2 compare callback for taskprocessors.">tps_cmp_cb</a>))) {
<a name="l00125"></a>00125       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;taskprocessor container failed to initialize!\n&quot;</span>);
<a name="l00126"></a>00126       <span class="keywordflow">return</span> -1;
<a name="l00127"></a>00127    }
<a name="l00128"></a>00128 
<a name="l00129"></a>00129    <a class="code" href="lock_8h.html#a21f75f462115427718d78aa66cc61f9b">ast_cond_init</a>(&amp;<a class="code" href="taskprocessor_8c.html#a47aa487359cd29b11f0853913301db54" title="CLI taskprocessor ping &amp;lt;blah&amp;gt;operation requires a ping condition.">cli_ping_cond</a>, NULL);
<a name="l00130"></a>00130 
<a name="l00131"></a>00131    <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(<a class="code" href="taskprocessor_8c.html#a3f1ff5f2bf7938f6d216f04f0057486e">taskprocessor_clis</a>, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="taskprocessor_8c.html#a3f1ff5f2bf7938f6d216f04f0057486e">taskprocessor_clis</a>));
<a name="l00132"></a>00132    <span class="keywordflow">return</span> 0;
<a name="l00133"></a>00133 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9069f9a0490be2b041ca552ef07757f0"></a><!-- doxytag: member="_private.h::ast_xmldoc_load_documentation" ref="a9069f9a0490be2b041ca552ef07757f0" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_xmldoc_load_documentation </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Load XML documentation. Provided by <a class="el" href="xmldoc_8c.html" title="XML Documentation API.">xmldoc.c</a>. </p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>1</em>&nbsp;</td><td>on error. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="xmldoc_8c_source.html#l01765">1765</a> of file <a class="el" href="xmldoc_8c_source.html">xmldoc.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00111">ast_asprintf</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="asterisk_8c_source.html#l00254">ast_config_AST_DATA_DIR</a>, <a class="el" href="config_8c_source.html#l00827">ast_config_destroy()</a>, <a class="el" href="config_8c_source.html#l02071">ast_config_load2()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="asterisk_8c_source.html#l00914">ast_register_atexit()</a>, <a class="el" href="linkedlists_8h_source.html#l00725">AST_RWLIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="config_8c_source.html#l00411">ast_variable_browse()</a>, <a class="el" href="xml_8c_source.html#l00073">ast_xml_close()</a>, <a class="el" href="xml_8c_source.html#l00084">ast_xml_get_root()</a>, <a class="el" href="xml_8c_source.html#l00039">ast_xml_init()</a>, <a class="el" href="xml_8c_source.html#l00179">ast_xml_node_get_name()</a>, <a class="el" href="xml_8c_source.html#l00053">ast_xml_open()</a>, <a class="el" href="config_8h_source.html#l00050">CONFIG_STATUS_FILEINVALID</a>, <a class="el" href="xmldoc_8c_source.html#l00056">documentation_tree::doc</a>, <a class="el" href="structdocumentation__tree.html#a9770eb03f735793008007de780d8b2f1">documentation_tree::entry</a>, <a class="el" href="xmldoc_8c_source.html#l00055">documentation_tree::filename</a>, <a class="el" href="ael__lex_8c_source.html#l00830">GLOB_ABORTED</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="compat_8h_source.html#l00193">MY_GLOB_FLAGS</a>, <a class="el" href="config_8h_source.html#l00075">ast_variable::name</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>, <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>, and <a class="el" href="xmldoc_8c_source.html#l01751">xmldoc_unload_documentation()</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01766"></a>01766 {
<a name="l01767"></a>01767    <span class="keyword">struct </span>ast_xml_node *root_node;
<a name="l01768"></a>01768    <span class="keyword">struct </span>ast_xml_doc *tmpdoc;
<a name="l01769"></a>01769    <span class="keyword">struct </span><a class="code" href="structdocumentation__tree.html" title="XML documentation tree.">documentation_tree</a> *doc_tree;
<a name="l01770"></a>01770    <span class="keywordtype">char</span> *xmlpattern;
<a name="l01771"></a>01771    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *cfg = NULL;
<a name="l01772"></a>01772    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a> = NULL;
<a name="l01773"></a>01773    <span class="keyword">struct </span><a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> cnfflags = { 0 };
<a name="l01774"></a>01774    <span class="keywordtype">int</span> globret, i, dup, duplicate;
<a name="l01775"></a>01775    glob_t globbuf;
<a name="l01776"></a>01776 
<a name="l01777"></a>01777    <span class="comment">/* setup default XML documentation language */</span>
<a name="l01778"></a>01778    snprintf(<a class="code" href="xmldoc_8c.html#a0b2ace3b0a473d2514ce792377817934" title="XML documentation language.">documentation_language</a>, <span class="keyword">sizeof</span>(<a class="code" href="xmldoc_8c.html#a0b2ace3b0a473d2514ce792377817934" title="XML documentation language.">documentation_language</a>), <a class="code" href="xmldoc_8c.html#a5a4442a75c763b05f9145803e4c7dddf" title="Default documentation language.">default_documentation_language</a>);
<a name="l01779"></a>01779 
<a name="l01780"></a>01780    <span class="keywordflow">if</span> ((cfg = <a class="code" href="config_8h.html#aab3eac8fa82a86a93c074deb7b77dbc9" title="Load a config file.">ast_config_load2</a>(<span class="stringliteral">&quot;asterisk.conf&quot;</span>, <span class="stringliteral">&quot;&quot;</span> <span class="comment">/* core can&apos;t reload */</span>, cnfflags)) &amp;&amp; cfg != <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>) {
<a name="l01781"></a>01781       <span class="keywordflow">for</span> (var = <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(cfg, <span class="stringliteral">&quot;options&quot;</span>); var; var = var-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l01782"></a>01782          <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;documentation_language&quot;</span>)) {
<a name="l01783"></a>01783             <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(var-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>)) {
<a name="l01784"></a>01784                snprintf(<a class="code" href="xmldoc_8c.html#a0b2ace3b0a473d2514ce792377817934" title="XML documentation language.">documentation_language</a>, <span class="keyword">sizeof</span>(<a class="code" href="xmldoc_8c.html#a0b2ace3b0a473d2514ce792377817934" title="XML documentation language.">documentation_language</a>), <span class="stringliteral">&quot;%s&quot;</span>, var-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01785"></a>01785             }
<a name="l01786"></a>01786          }
<a name="l01787"></a>01787       }
<a name="l01788"></a>01788       <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(cfg);
<a name="l01789"></a>01789    }
<a name="l01790"></a>01790 
<a name="l01791"></a>01791    <span class="comment">/* initialize the XML library. */</span>
<a name="l01792"></a>01792    <a class="code" href="xml_8h.html#ae7775b891369b2025497d68c1ec2b8b6" title="Initialize the XML library implementation. This function is used to setup everything...">ast_xml_init</a>();
<a name="l01793"></a>01793 
<a name="l01794"></a>01794    <span class="comment">/* register function to be run when asterisk finish. */</span>
<a name="l01795"></a>01795    <a class="code" href="asterisk_8h.html#a9b09e95876dfecb9a8573819da0b255e" title="Register a function to be executed before Asterisk exits.">ast_register_atexit</a>(<a class="code" href="xmldoc_8c.html#acd85ffaccedee3cb1300470803523372" title="Close and unload XML documentation.">xmldoc_unload_documentation</a>);
<a name="l01796"></a>01796 
<a name="l01797"></a>01797    <span class="comment">/* Get every *-LANG.xml file inside $(ASTDATADIR)/documentation */</span>
<a name="l01798"></a>01798    <a class="code" href="astmm_8h.html#aee6f1d27500ac19fa0b842022f987817">ast_asprintf</a>(&amp;xmlpattern, <span class="stringliteral">&quot;%s/documentation{/thirdparty/,/}*-{%s,%.2s_??,%s}.xml&quot;</span>, <a class="code" href="paths_8h.html#a63af4213b5b83f717398d8d62008a50d">ast_config_AST_DATA_DIR</a>,
<a name="l01799"></a>01799          <a class="code" href="xmldoc_8c.html#a0b2ace3b0a473d2514ce792377817934" title="XML documentation language.">documentation_language</a>, <a class="code" href="xmldoc_8c.html#a0b2ace3b0a473d2514ce792377817934" title="XML documentation language.">documentation_language</a>, <a class="code" href="xmldoc_8c.html#a5a4442a75c763b05f9145803e4c7dddf" title="Default documentation language.">default_documentation_language</a>);
<a name="l01800"></a>01800    globbuf.gl_offs = 0;    <span class="comment">/* initialize it to silence gcc */</span>
<a name="l01801"></a>01801    globret = glob(xmlpattern, <a class="code" href="compat_8h.html#aaac7e52043ca7fcf7113eaaf95f6e3b7">MY_GLOB_FLAGS</a>, NULL, &amp;globbuf);
<a name="l01802"></a>01802    <span class="keywordflow">if</span> (globret == GLOB_NOSPACE) {
<a name="l01803"></a>01803       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Glob Expansion of pattern &apos;%s&apos; failed: Not enough memory\n&quot;</span>, xmlpattern);
<a name="l01804"></a>01804       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(xmlpattern);
<a name="l01805"></a>01805       <span class="keywordflow">return</span> 1;
<a name="l01806"></a>01806    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (globret  == <a class="code" href="ael__lex_8c.html#ab5de50cedafa21283878657d05fb2ba8">GLOB_ABORTED</a>) {
<a name="l01807"></a>01807       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Glob Expansion of pattern &apos;%s&apos; failed: Read error\n&quot;</span>, xmlpattern);
<a name="l01808"></a>01808       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(xmlpattern);
<a name="l01809"></a>01809       <span class="keywordflow">return</span> 1;
<a name="l01810"></a>01810    }
<a name="l01811"></a>01811    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(xmlpattern);
<a name="l01812"></a>01812 
<a name="l01813"></a>01813    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structxmldoc__tree.html" title="Container of documentation trees.">xmldoc_tree</a>);
<a name="l01814"></a>01814    <span class="comment">/* loop over expanded files */</span>
<a name="l01815"></a>01815    <span class="keywordflow">for</span> (i = 0; i &lt; globbuf.gl_pathc; i++) {
<a name="l01816"></a>01816       <span class="comment">/* check for duplicates (if we already [try to] open the same file. */</span>
<a name="l01817"></a>01817       duplicate = 0;
<a name="l01818"></a>01818       <span class="keywordflow">for</span> (dup = 0; dup &lt; i; dup++) {
<a name="l01819"></a>01819          <span class="keywordflow">if</span> (!strcmp(globbuf.gl_pathv[i], globbuf.gl_pathv[dup])) {
<a name="l01820"></a>01820             duplicate = 1;
<a name="l01821"></a>01821             <span class="keywordflow">break</span>;
<a name="l01822"></a>01822          }
<a name="l01823"></a>01823       }
<a name="l01824"></a>01824       <span class="keywordflow">if</span> (duplicate) {
<a name="l01825"></a>01825          <span class="keywordflow">continue</span>;
<a name="l01826"></a>01826       }
<a name="l01827"></a>01827       tmpdoc = NULL;
<a name="l01828"></a>01828       tmpdoc = <a class="code" href="xml_8h.html#a3e397160644166df4830521d1dc07272" title="Open an XML document.">ast_xml_open</a>(globbuf.gl_pathv[i]);
<a name="l01829"></a>01829       <span class="keywordflow">if</span> (!tmpdoc) {
<a name="l01830"></a>01830          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not open XML documentation at &apos;%s&apos;\n&quot;</span>, globbuf.gl_pathv[i]);
<a name="l01831"></a>01831          <span class="keywordflow">continue</span>;
<a name="l01832"></a>01832       }
<a name="l01833"></a>01833       <span class="comment">/* Get doc root node and check if it starts with &apos;&lt;docs&gt;&apos; */</span>
<a name="l01834"></a>01834       root_node = <a class="code" href="xml_8h.html#af84bcc8281d822193294dcadd247ac75" title="Get the document root node.">ast_xml_get_root</a>(tmpdoc);
<a name="l01835"></a>01835       <span class="keywordflow">if</span> (!root_node) {
<a name="l01836"></a>01836          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Error getting documentation root node&quot;</span>);
<a name="l01837"></a>01837          <a class="code" href="xml_8h.html#a7bd620a640086cdcbb20610259af6bd1" title="Close an already open document and free the used structure.">ast_xml_close</a>(tmpdoc);
<a name="l01838"></a>01838          <span class="keywordflow">continue</span>;
<a name="l01839"></a>01839       }
<a name="l01840"></a>01840       <span class="comment">/* Check root node name for malformed xmls. */</span>
<a name="l01841"></a>01841       <span class="keywordflow">if</span> (strcmp(<a class="code" href="xml_8h.html#a02cd60b8b2d5d96e78c858429b1b1d11" title="Get the name of a node.">ast_xml_node_get_name</a>(root_node), <span class="stringliteral">&quot;docs&quot;</span>)) {
<a name="l01842"></a>01842          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Documentation file is not well formed!\n&quot;</span>);
<a name="l01843"></a>01843          <a class="code" href="xml_8h.html#a7bd620a640086cdcbb20610259af6bd1" title="Close an already open document and free the used structure.">ast_xml_close</a>(tmpdoc);
<a name="l01844"></a>01844          <span class="keywordflow">continue</span>;
<a name="l01845"></a>01845       }
<a name="l01846"></a>01846       doc_tree = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*doc_tree));
<a name="l01847"></a>01847       <span class="keywordflow">if</span> (!doc_tree) {
<a name="l01848"></a>01848          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to allocate documentation_tree structure!\n&quot;</span>);
<a name="l01849"></a>01849          <a class="code" href="xml_8h.html#a7bd620a640086cdcbb20610259af6bd1" title="Close an already open document and free the used structure.">ast_xml_close</a>(tmpdoc);
<a name="l01850"></a>01850          <span class="keywordflow">continue</span>;
<a name="l01851"></a>01851       }
<a name="l01852"></a>01852       doc_tree-&gt;<a class="code" href="structdocumentation__tree.html#a8702ea03f4a7d2e0bcca01893d9dd5a6">doc</a> = tmpdoc;
<a name="l01853"></a>01853       doc_tree-&gt;<a class="code" href="structdocumentation__tree.html#aeac90097f29f7529968697163cea5c18">filename</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(globbuf.gl_pathv[i]);
<a name="l01854"></a>01854       <a class="code" href="linkedlists_8h.html#aadda916488b2d151af4426e2f06ad332">AST_RWLIST_INSERT_TAIL</a>(&amp;<a class="code" href="structxmldoc__tree.html" title="Container of documentation trees.">xmldoc_tree</a>, doc_tree, entry);
<a name="l01855"></a>01855    }
<a name="l01856"></a>01856    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structxmldoc__tree.html" title="Container of documentation trees.">xmldoc_tree</a>);
<a name="l01857"></a>01857 
<a name="l01858"></a>01858    globfree(&amp;globbuf);
<a name="l01859"></a>01859 
<a name="l01860"></a>01860    <span class="keywordflow">return</span> 0;
<a name="l01861"></a>01861 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a52d9808db8eba7a1ff32fc6686042f04"></a><!-- doxytag: member="_private.h::astdb_init" ref="a52d9808db8eba7a1ff32fc6686042f04" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int astdb_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Provided by <a class="el" href="db_8c.html" title="ASTdb Management.">db.c</a> </p>

<p>Definition at line <a class="el" href="db_8c_source.html#l00665">665</a> of file <a class="el" href="db_8c_source.html">db.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="cli_8c_source.html#l01927">ast_cli_register_multiple()</a>, <a class="el" href="manager_8h_source.html#l00133">ast_manager_register</a>, <a class="el" href="db_8c_source.html#l00054">dbinit()</a>, <a class="el" href="manager_8h_source.html#l00070">EVENT_FLAG_REPORTING</a>, <a class="el" href="manager_8h_source.html#l00061">EVENT_FLAG_SYSTEM</a>, <a class="el" href="db_8c_source.html#l00616">manager_dbdel()</a>, <a class="el" href="db_8c_source.html#l00641">manager_dbdeltree()</a>, <a class="el" href="db_8c_source.html#l00579">manager_dbget()</a>, and <a class="el" href="db_8c_source.html#l00554">manager_dbput()</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00666"></a>00666 {
<a name="l00667"></a>00667    <a class="code" href="db_8c.html#aa0a32443a3a66aae82eab44edfc22304">dbinit</a>();
<a name="l00668"></a>00668    <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(<a class="code" href="db_8c.html#a2956356b5eeaacfec5a223ce1417fc6d">cli_database</a>, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="db_8c.html#a2956356b5eeaacfec5a223ce1417fc6d">cli_database</a>));
<a name="l00669"></a>00669    <a class="code" href="manager_8h.html#a24c8fe57053553be1a1458d4afe8909b" title="External routines may register/unregister manager callbacks this way.">ast_manager_register</a>(<span class="stringliteral">&quot;DBGet&quot;</span>, <a class="code" href="manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a> | <a class="code" href="manager_8h.html#a0b1b4140c2836696a6950e92ab48a580">EVENT_FLAG_REPORTING</a>, <a class="code" href="db_8c.html#a415a23bb61c561440bc3ae9d263461ad">manager_dbget</a>, <span class="stringliteral">&quot;Get DB Entry&quot;</span>);
<a name="l00670"></a>00670    <a class="code" href="manager_8h.html#a24c8fe57053553be1a1458d4afe8909b" title="External routines may register/unregister manager callbacks this way.">ast_manager_register</a>(<span class="stringliteral">&quot;DBPut&quot;</span>, <a class="code" href="manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a>, <a class="code" href="db_8c.html#a63408b76b1f9eed31bcd1211d2081f03">manager_dbput</a>, <span class="stringliteral">&quot;Put DB Entry&quot;</span>);
<a name="l00671"></a>00671    <a class="code" href="manager_8h.html#a24c8fe57053553be1a1458d4afe8909b" title="External routines may register/unregister manager callbacks this way.">ast_manager_register</a>(<span class="stringliteral">&quot;DBDel&quot;</span>, <a class="code" href="manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a>, <a class="code" href="db_8c.html#a03f7dee6cad1dff30caf7133244cd811">manager_dbdel</a>, <span class="stringliteral">&quot;Delete DB Entry&quot;</span>);
<a name="l00672"></a>00672    <a class="code" href="manager_8h.html#a24c8fe57053553be1a1458d4afe8909b" title="External routines may register/unregister manager callbacks this way.">ast_manager_register</a>(<span class="stringliteral">&quot;DBDelTree&quot;</span>, <a class="code" href="manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a>, <a class="code" href="db_8c.html#a274fd536a82bf71830421f6b0ff63702">manager_dbdeltree</a>, <span class="stringliteral">&quot;Delete DB Tree&quot;</span>);
<a name="l00673"></a>00673    <span class="keywordflow">return</span> 0;
<a name="l00674"></a>00674 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abe6bfa12a840493461afe4cb65c935da"></a><!-- doxytag: member="_private.h::astobj2_init" ref="abe6bfa12a840493461afe4cb65c935da" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int astobj2_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Provided by <a class="el" href="astobj2_8c.html">astobj2.c</a> </p>

<p>Definition at line <a class="el" href="astobj2_8c_source.html#l01081">1081</a> of file <a class="el" href="astobj2_8c_source.html">astobj2.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, and <a class="el" href="cli_8c_source.html#l01927">ast_cli_register_multiple()</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01082"></a>01082 {
<a name="l01083"></a>01083 <span class="preprocessor">#ifdef AO2_DEBUG</span>
<a name="l01084"></a>01084 <span class="preprocessor"></span>   <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(cli_astobj2, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(cli_astobj2));
<a name="l01085"></a>01085 <span class="preprocessor">#endif</span>
<a name="l01086"></a>01086 <span class="preprocessor"></span>
<a name="l01087"></a>01087    <span class="keywordflow">return</span> 0;
<a name="l01088"></a>01088 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a472851d5655c8a9b9492c40e5ff32d2d"></a><!-- doxytag: member="_private.h::close_logger" ref="a472851d5655c8a9b9492c40e5ff32d2d" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void close_logger </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Provided by <a class="el" href="logger_8c.html" title="Asterisk Logger.">logger.c</a> </p>

<p>Definition at line <a class="el" href="logger_8c_source.html#l01048">1048</a> of file <a class="el" href="logger_8c_source.html">logger.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01734">ast_cond_signal()</a>, <a class="el" href="linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="lock_8h_source.html#l00082">AST_PTHREADT_NULL</a>, <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="logger_8c_source.html#l00152">close_logger_thread</a>, <a class="el" href="logger_8c_source.html#l00154">eventlog</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="logger_8c_source.html#l00125">logchannel::fileptr</a>, <a class="el" href="structlogchannel.html#a54e8df86539f38f79b480a8c8d95e37a">logchannel::list</a>, <a class="el" href="logger_8c_source.html#l00151">logcond</a>, <a class="el" href="logger_8c_source.html#l00150">logthread</a>, and <a class="el" href="logger_8c_source.html#l00155">qlog</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l01549">quit_handler()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01049"></a>01049 {
<a name="l01050"></a>01050    <span class="keyword">struct </span><a class="code" href="structlogchannel.html">logchannel</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a> = NULL;
<a name="l01051"></a>01051 
<a name="l01052"></a>01052    <span class="comment">/* Stop logger thread */</span>
<a name="l01053"></a>01053    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="structlogmsgs.html">logmsgs</a>);
<a name="l01054"></a>01054    <a class="code" href="logger_8c.html#a38ac6d8ec7483171f8a13fed360b6ced">close_logger_thread</a> = 1;
<a name="l01055"></a>01055    <a class="code" href="lock_8h.html#a02a91e30acdea6d13208d23636d37c87">ast_cond_signal</a>(&amp;<a class="code" href="logger_8c.html#abb118951a9d7c498a6e28454e7eb0bd5">logcond</a>);
<a name="l01056"></a>01056    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="structlogmsgs.html">logmsgs</a>);
<a name="l01057"></a>01057 
<a name="l01058"></a>01058    <span class="keywordflow">if</span> (<a class="code" href="logger_8c.html#a6685bab4f7be49a081c4d2efe4b77a23">logthread</a> != <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>)
<a name="l01059"></a>01059       pthread_join(<a class="code" href="logger_8c.html#a6685bab4f7be49a081c4d2efe4b77a23">logthread</a>, NULL);
<a name="l01060"></a>01060 
<a name="l01061"></a>01061    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structlogchannels.html">logchannels</a>);
<a name="l01062"></a>01062 
<a name="l01063"></a>01063    <span class="keywordflow">if</span> (<a class="code" href="logger_8c.html#ae4fc4e52cb8f2c8872019c2117d32a7d">eventlog</a>) {
<a name="l01064"></a>01064       fclose(<a class="code" href="logger_8c.html#ae4fc4e52cb8f2c8872019c2117d32a7d">eventlog</a>);
<a name="l01065"></a>01065       <a class="code" href="logger_8c.html#ae4fc4e52cb8f2c8872019c2117d32a7d">eventlog</a> = NULL;
<a name="l01066"></a>01066    }
<a name="l01067"></a>01067 
<a name="l01068"></a>01068    <span class="keywordflow">if</span> (<a class="code" href="logger_8c.html#a59cef8b13e5fcb3e2ea61f66ea4bf0e5">qlog</a>) {
<a name="l01069"></a>01069       fclose(<a class="code" href="logger_8c.html#a59cef8b13e5fcb3e2ea61f66ea4bf0e5">qlog</a>);
<a name="l01070"></a>01070       <a class="code" href="logger_8c.html#a59cef8b13e5fcb3e2ea61f66ea4bf0e5">qlog</a> = NULL;
<a name="l01071"></a>01071    }
<a name="l01072"></a>01072 
<a name="l01073"></a>01073    <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="structlogchannels.html">logchannels</a>, f, <a class="code" href="structlogchannel.html#a54e8df86539f38f79b480a8c8d95e37a">list</a>) {
<a name="l01074"></a>01074       <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structlogchannel.html#acc2a21b64b19aeee05b382056974c1e9">fileptr</a> &amp;&amp; (f-&gt;<a class="code" href="structlogchannel.html#acc2a21b64b19aeee05b382056974c1e9">fileptr</a> != stdout) &amp;&amp; (f-&gt;<a class="code" href="structlogchannel.html#acc2a21b64b19aeee05b382056974c1e9">fileptr</a> != stderr)) {
<a name="l01075"></a>01075          fclose(f-&gt;<a class="code" href="structlogchannel.html#acc2a21b64b19aeee05b382056974c1e9">fileptr</a>);
<a name="l01076"></a>01076          f-&gt;<a class="code" href="structlogchannel.html#acc2a21b64b19aeee05b382056974c1e9">fileptr</a> = NULL;
<a name="l01077"></a>01077       }
<a name="l01078"></a>01078    }
<a name="l01079"></a>01079 
<a name="l01080"></a>01080    closelog(); <span class="comment">/* syslog */</span>
<a name="l01081"></a>01081 
<a name="l01082"></a>01082    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structlogchannels.html">logchannels</a>);
<a name="l01083"></a>01083 
<a name="l01084"></a>01084    <span class="keywordflow">return</span>;
<a name="l01085"></a>01085 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abc95730f7f0f9420f52e56e525056e6c"></a><!-- doxytag: member="_private.h::dnsmgr_init" ref="abc95730f7f0f9420f52e56e525056e6c" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dnsmgr_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Provided by <a class="el" href="dnsmgr_8c.html" title="Background DNS update manager.">dnsmgr.c</a> </p>

<p>Definition at line <a class="el" href="dnsmgr_8c_source.html#l00350">350</a> of file <a class="el" href="dnsmgr_8c_source.html">dnsmgr.c</a>.</p>

<p>References <a class="el" href="cli_8c_source.html#l01919">ast_cli_register()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="dnsmgr_8c_source.html#l00347">cli_refresh</a>, <a class="el" href="dnsmgr_8c_source.html#l00346">cli_reload</a>, <a class="el" href="dnsmgr_8c_source.html#l00348">cli_status</a>, <a class="el" href="dnsmgr_8c_source.html#l00367">do_reload()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, and <a class="el" href="sched_8c_source.html#l00239">sched_context_create()</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00351"></a>00351 {
<a name="l00352"></a>00352    <span class="keywordflow">if</span> (!(<a class="code" href="structsched.html">sched</a> = <a class="code" href="sched_8h.html#ad4fd5c63d5d3dcc8e11bec644c601017" title="New schedule context.">sched_context_create</a>())) {
<a name="l00353"></a>00353       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to create schedule context.\n&quot;</span>);
<a name="l00354"></a>00354       <span class="keywordflow">return</span> -1;
<a name="l00355"></a>00355    }
<a name="l00356"></a>00356    <a class="code" href="cli_8h.html#a0ca7e108aceb1cd488bb9e3ee26e4ebc" title="Registers a command or an array of commands.">ast_cli_register</a>(&amp;<a class="code" href="dnsmgr_8c.html#ab5b66ed9cfa2ea543e90ed13a4320817">cli_reload</a>);
<a name="l00357"></a>00357    <a class="code" href="cli_8h.html#a0ca7e108aceb1cd488bb9e3ee26e4ebc" title="Registers a command or an array of commands.">ast_cli_register</a>(&amp;<a class="code" href="dnsmgr_8c.html#a2bfbc88e2118d426be7b9ed59d6cf14f">cli_status</a>);
<a name="l00358"></a>00358    <a class="code" href="cli_8h.html#a0ca7e108aceb1cd488bb9e3ee26e4ebc" title="Registers a command or an array of commands.">ast_cli_register</a>(&amp;<a class="code" href="dnsmgr_8c.html#aa331d52ef44f75eebbe4068a001099ba">cli_refresh</a>);
<a name="l00359"></a>00359    <span class="keywordflow">return</span> <a class="code" href="dnsmgr_8c.html#adeaf0f7f80508d4b4bfd37c5cda21b97">do_reload</a>(1);
<a name="l00360"></a>00360 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0eae193f3c757d3cd34ed238b8860ebf"></a><!-- doxytag: member="_private.h::dnsmgr_reload" ref="a0eae193f3c757d3cd34ed238b8860ebf" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dnsmgr_reload </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Provided by <a class="el" href="dnsmgr_8c.html" title="Background DNS update manager.">dnsmgr.c</a> </p>

<p>Definition at line <a class="el" href="dnsmgr_8c_source.html#l00362">362</a> of file <a class="el" href="dnsmgr_8c_source.html">dnsmgr.c</a>.</p>

<p>References <a class="el" href="dnsmgr_8c_source.html#l00367">do_reload()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00363"></a>00363 {
<a name="l00364"></a>00364    <span class="keywordflow">return</span> <a class="code" href="dnsmgr_8c.html#adeaf0f7f80508d4b4bfd37c5cda21b97">do_reload</a>(0);
<a name="l00365"></a>00365 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0ede7ff922fb2764dfd455e49dc59bc8"></a><!-- doxytag: member="_private.h::dnsmgr_start_refresh" ref="a0ede7ff922fb2764dfd455e49dc59bc8" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dnsmgr_start_refresh </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Provided by <a class="el" href="dnsmgr_8c.html" title="Background DNS update manager.">dnsmgr.c</a> </p>

<p>Definition at line <a class="el" href="dnsmgr_8c_source.html#l00244">244</a> of file <a class="el" href="dnsmgr_8c_source.html">dnsmgr.c</a>.</p>

<p>References <a class="el" href="sched_8c_source.html#l00399">ast_sched_add_variable()</a>, <a class="el" href="sched_8h_source.html#l00051">AST_SCHED_DEL</a>, <a class="el" href="dnsmgr_8c_source.html#l00083">master_refresh_info</a>, and <a class="el" href="dnsmgr_8c_source.html#l00216">refresh_list()</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00245"></a>00245 {
<a name="l00246"></a>00246    <span class="keywordflow">if</span> (<a class="code" href="dnsmgr_8c.html#a9896125bdd6cb3d2605cbb261b4228ea">refresh_sched</a> &gt; -1) {
<a name="l00247"></a>00247       <a class="code" href="sched_8h.html#a25647782014f8dc012994efcd1b81d32" title="a loop construct to ensure that the scheduled task get deleted. The idea is that...">AST_SCHED_DEL</a>(<a class="code" href="structsched.html">sched</a>, <a class="code" href="dnsmgr_8c.html#a9896125bdd6cb3d2605cbb261b4228ea">refresh_sched</a>);
<a name="l00248"></a>00248       <a class="code" href="dnsmgr_8c.html#a9896125bdd6cb3d2605cbb261b4228ea">refresh_sched</a> = <a class="code" href="sched_8h.html#a5d738bcc3c3d38165a59a17a35f6ca2c" title="Schedule callback(data) to happen when ms into the future.">ast_sched_add_variable</a>(<a class="code" href="structsched.html">sched</a>, 100, <a class="code" href="dnsmgr_8c.html#a7f623757756f349de3f28480aeb8b7a6">refresh_list</a>, &amp;<a class="code" href="dnsmgr_8c.html#a809d1040a29742820a4989d585349d5b">master_refresh_info</a>, 1);
<a name="l00249"></a>00249    }
<a name="l00250"></a>00250 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae8a701b0b688879d84514bd36d63ff82"></a><!-- doxytag: member="_private.h::init_framer" ref="ae8a701b0b688879d84514bd36d63ff82" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int init_framer </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Provided by <a class="el" href="frame_8c.html" title="Frame and codec manipulation routines.">frame.c</a> </p>

<p>Definition at line <a class="el" href="frame_8c_source.html#l00968">968</a> of file <a class="el" href="frame_8c_source.html">frame.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, and <a class="el" href="cli_8c_source.html#l01927">ast_cli_register_multiple()</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00969"></a>00969 {
<a name="l00970"></a>00970    <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(<a class="code" href="frame_8c.html#af1a7a13ff239697e9106ed3763072298">my_clis</a>, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="frame_8c.html#af1a7a13ff239697e9106ed3763072298">my_clis</a>));
<a name="l00971"></a>00971    <span class="keywordflow">return</span> 0;   
<a name="l00972"></a>00972 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aaa750bd60d48780b89622bb62520dff0"></a><!-- doxytag: member="_private.h::init_logger" ref="aaa750bd60d48780b89622bb62520dff0" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int init_logger </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Provided by <a class="el" href="logger_8c.html" title="Asterisk Logger.">logger.c</a> </p>

<p>Definition at line <a class="el" href="logger_8c_source.html#l01004">1004</a> of file <a class="el" href="logger_8c_source.html">logger.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="cli_8c_source.html#l01927">ast_cli_register_multiple()</a>, <a class="el" href="lock_8h_source.html#l01744">ast_cond_destroy()</a>, <a class="el" href="lock_8h_source.html#l01729">ast_cond_init()</a>, <a class="el" href="asterisk_8c_source.html#l00255">ast_config_AST_LOG_DIR</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8c_source.html#l01765">ast_mkdir()</a>, <a class="el" href="utils_8h_source.html#l00376">ast_pthread_create</a>, <a class="el" href="logger_8c_source.html#l00465">ast_queue_log()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="logger_8c_source.html#l00823">cli_logger</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="logger_8c_source.html#l00154">eventlog</a>, <a class="el" href="logger_8h_source.html#l00034">EVENTLOG</a>, <a class="el" href="logger_8c_source.html#l00830">handle_SIGXFSZ()</a>, <a class="el" href="logger_8c_source.html#l00320">init_logger_chain()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00130">LOG_EVENT</a>, <a class="el" href="logger_8c_source.html#l00151">logcond</a>, <a class="el" href="logger_8c.html#a2a3c47f5d59c8a5754b5d4fea971c819">logfiles</a>, <a class="el" href="logger_8c_source.html#l00963">logger_thread()</a>, <a class="el" href="logger_8c_source.html#l00150">logthread</a>, and <a class="el" href="logger_8c_source.html#l00155">qlog</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01005"></a>01005 {
<a name="l01006"></a>01006    <span class="keywordtype">char</span> tmp[256];
<a name="l01007"></a>01007    <span class="keywordtype">int</span> res = 0;
<a name="l01008"></a>01008 
<a name="l01009"></a>01009    <span class="comment">/* auto rotate if sig SIGXFSZ comes a-knockin */</span>
<a name="l01010"></a>01010    (void) signal(SIGXFSZ, (<span class="keywordtype">void</span> *) <a class="code" href="logger_8c.html#a1406ca59219e1599fa22449317b13a37">handle_SIGXFSZ</a>);
<a name="l01011"></a>01011 
<a name="l01012"></a>01012    <span class="comment">/* start logger thread */</span>
<a name="l01013"></a>01013    <a class="code" href="lock_8h.html#a21f75f462115427718d78aa66cc61f9b">ast_cond_init</a>(&amp;<a class="code" href="logger_8c.html#abb118951a9d7c498a6e28454e7eb0bd5">logcond</a>, NULL);
<a name="l01014"></a>01014    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a4781fd54a4ca8c7f0f8a32a6cce503c0">ast_pthread_create</a>(&amp;<a class="code" href="logger_8c.html#a6685bab4f7be49a081c4d2efe4b77a23">logthread</a>, NULL, <a class="code" href="logger_8c.html#ac4f7d8da66207fdb53d5f5ecb171032e" title="Actual logging thread.">logger_thread</a>, NULL) &lt; 0) {
<a name="l01015"></a>01015       <a class="code" href="lock_8h.html#a7752bcadc38f1d7a7a8528c538569115">ast_cond_destroy</a>(&amp;<a class="code" href="logger_8c.html#abb118951a9d7c498a6e28454e7eb0bd5">logcond</a>);
<a name="l01016"></a>01016       <span class="keywordflow">return</span> -1;
<a name="l01017"></a>01017    }
<a name="l01018"></a>01018 
<a name="l01019"></a>01019    <span class="comment">/* register the logger cli commands */</span>
<a name="l01020"></a>01020    <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(<a class="code" href="logger_8c.html#ad833b610a71e242ad11a7f3fb5e79b90">cli_logger</a>, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="logger_8c.html#ad833b610a71e242ad11a7f3fb5e79b90">cli_logger</a>));
<a name="l01021"></a>01021 
<a name="l01022"></a>01022    <a class="code" href="utils_8h.html#a7c38859ed90e96df2b0a0fdf843769d0" title="Recursively create directory path.">ast_mkdir</a>(<a class="code" href="paths_8h.html#aea5e16ca2517e2093fdfa0e7fd112f0f">ast_config_AST_LOG_DIR</a>, 0777);
<a name="l01023"></a>01023   
<a name="l01024"></a>01024    <span class="comment">/* create log channels */</span>
<a name="l01025"></a>01025    <a class="code" href="logger_8c.html#aaafd457f419506fd0aad9fcf2f8704e0">init_logger_chain</a>(0 <span class="comment">/* locked */</span>);
<a name="l01026"></a>01026 
<a name="l01027"></a>01027    <span class="comment">/* create the eventlog */</span>
<a name="l01028"></a>01028    <span class="keywordflow">if</span> (<a class="code" href="logger_8c.html#a2a3c47f5d59c8a5754b5d4fea971c819">logfiles</a>.event_log) {
<a name="l01029"></a>01029       snprintf(tmp, <span class="keyword">sizeof</span>(tmp), <span class="stringliteral">&quot;%s/%s&quot;</span>, <a class="code" href="paths_8h.html#aea5e16ca2517e2093fdfa0e7fd112f0f">ast_config_AST_LOG_DIR</a>, <a class="code" href="logger_8h.html#ace977ddb6fd1b76f78736d010bf8601d">EVENTLOG</a>);
<a name="l01030"></a>01030       <a class="code" href="logger_8c.html#ae4fc4e52cb8f2c8872019c2117d32a7d">eventlog</a> = fopen(tmp, <span class="stringliteral">&quot;a&quot;</span>);
<a name="l01031"></a>01031       <span class="keywordflow">if</span> (<a class="code" href="logger_8c.html#ae4fc4e52cb8f2c8872019c2117d32a7d">eventlog</a>) {
<a name="l01032"></a>01032          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#af7c8529df13c84f0c9d1122f36a94a41">LOG_EVENT</a>, <span class="stringliteral">&quot;Started Asterisk Event Logger\n&quot;</span>);
<a name="l01033"></a>01033          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Asterisk Event Logger Started %s\n&quot;</span>, tmp);
<a name="l01034"></a>01034       } <span class="keywordflow">else</span> {
<a name="l01035"></a>01035          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to create event log: %s\n&quot;</span>, strerror(errno));
<a name="l01036"></a>01036          res = -1;
<a name="l01037"></a>01037       }
<a name="l01038"></a>01038    }
<a name="l01039"></a>01039 
<a name="l01040"></a>01040    <span class="keywordflow">if</span> (<a class="code" href="logger_8c.html#a2a3c47f5d59c8a5754b5d4fea971c819">logfiles</a>.queue_log) {
<a name="l01041"></a>01041       snprintf(tmp, <span class="keyword">sizeof</span>(tmp), <span class="stringliteral">&quot;%s/%s&quot;</span>, <a class="code" href="paths_8h.html#aea5e16ca2517e2093fdfa0e7fd112f0f">ast_config_AST_LOG_DIR</a>, <a class="code" href="logger_8c.html#a818fb8d162c63f2848d8bb57bffebd3e">queue_log_name</a>);
<a name="l01042"></a>01042       <a class="code" href="logger_8c.html#a59cef8b13e5fcb3e2ea61f66ea4bf0e5">qlog</a> = fopen(tmp, <span class="stringliteral">&quot;a&quot;</span>);
<a name="l01043"></a>01043       <a class="code" href="logger_8h.html#a9f7a6acbec3680a06af27ae561772915">ast_queue_log</a>(<span class="stringliteral">&quot;NONE&quot;</span>, <span class="stringliteral">&quot;NONE&quot;</span>, <span class="stringliteral">&quot;NONE&quot;</span>, <span class="stringliteral">&quot;QUEUESTART&quot;</span>, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l01044"></a>01044    }
<a name="l01045"></a>01045    <span class="keywordflow">return</span> res;
<a name="l01046"></a>01046 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad68c7bef65928ccdadddf889f105ed9c"></a><!-- doxytag: member="_private.h::load_modules" ref="ad68c7bef65928ccdadddf889f105ed9c" args="(unsigned int)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int load_modules </td>
          <td>(</td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>int</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Provided by <a class="el" href="loader_8c.html" title="Module Loader.">loader.c</a> </p>

<p>Definition at line <a class="el" href="loader_8c_source.html#l00941">941</a> of file <a class="el" href="loader_8c_source.html">loader.c</a>.</p>

<p>References <a class="el" href="loader_8c_source.html#l00848">add_to_load_order()</a>, <a class="el" href="asterisk_8c_source.html#l00250">ast_config_AST_MODULE_DIR</a>, <a class="el" href="config_8c_source.html#l00827">ast_config_destroy()</a>, <a class="el" href="config_8c_source.html#l02071">ast_config_load2()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="linkedlists_8h_source.html#l00665">AST_LIST_HEAD_INIT_NOLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00553">AST_LIST_REMOVE_CURRENT</a>, <a class="el" href="linkedlists_8h_source.html#l00817">AST_LIST_REMOVE_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00528">AST_LIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h_source.html#l00599">AST_LIST_TRAVERSE_SAFE_END</a>, <a class="el" href="linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="module_8h_source.html#l00051">AST_MODULE_CONFIG</a>, <a class="el" href="options_8h_source.html#l00100">ast_opt_quiet</a>, <a class="el" href="utils_8c_source.html#l01311">ast_true()</a>, <a class="el" href="config_8c_source.html#l00411">ast_variable_browse()</a>, <a class="el" href="config_8c_source.html#l00435">ast_variable_retrieve()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="config_8h_source.html#l00050">CONFIG_STATUS_FILEINVALID</a>, <a class="el" href="config_8h_source.html#l00048">CONFIG_STATUS_FILEMISSING</a>, <a class="el" href="adsistub_8c_source.html#l00077">dir</a>, <a class="el" href="loader_8c_source.html#l00080">embedding</a>, <a class="el" href="manager_8h_source.html#l00061">EVENT_FLAG_SYSTEM</a>, <a class="el" href="loader_8c_source.html#l00326">find_resource()</a>, <a class="el" href="structast__module.html#a4602cfc6834c0c5a50ba85844d9e36d3">ast_module::flags</a>, <a class="el" href="loader_8c_source.html#l00086">ast_module::lib</a>, <a class="el" href="loader_8c_source.html#l00883">load_resource_list()</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="manager_8h_source.html#l00181">manager_event</a>, <a class="el" href="config_8h_source.html#l00075">ast_variable::name</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="loader_8c_source.html#l00842">load_order_entry::resource</a>, <a class="el" href="loader_8c_source.html#l00094">ast_module::resource</a>, <a class="el" href="loader_8c_source.html#l00308">resource_name_match()</a>, <a class="el" href="loader_8c_source.html#l00090">ast_module::running</a>, and <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00942"></a>00942 {
<a name="l00943"></a>00943    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *cfg;
<a name="l00944"></a>00944    <span class="keyword">struct </span><a class="code" href="structast__module.html">ast_module</a> *mod;
<a name="l00945"></a>00945    <span class="keyword">struct </span><a class="code" href="structload__order__entry.html">load_order_entry</a> *order;
<a name="l00946"></a>00946    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *v;
<a name="l00947"></a>00947    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> load_count;
<a name="l00948"></a>00948    <span class="keyword">struct </span><a class="code" href="structload__order.html">load_order</a> <a class="code" href="structload__order.html">load_order</a>;
<a name="l00949"></a>00949    <span class="keywordtype">int</span> res = 0;
<a name="l00950"></a>00950    <span class="keyword">struct </span><a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> <a class="code" href="app__rpt_8c.html#a1f57f20c1f46890828791a4827fe8752">config_flags</a> = { 0 };
<a name="l00951"></a>00951    <span class="keywordtype">int</span> modulecount = 0;
<a name="l00952"></a>00952 
<a name="l00953"></a>00953 <span class="preprocessor">#ifdef LOADABLE_MODULES</span>
<a name="l00954"></a>00954 <span class="preprocessor"></span>   <span class="keyword">struct </span>dirent *dirent;
<a name="l00955"></a>00955    DIR *<a class="code" href="adsistub_8c.html#a946c6fe93168120f0fa86002b4e9d575">dir</a>;
<a name="l00956"></a>00956 <span class="preprocessor">#endif</span>
<a name="l00957"></a>00957 <span class="preprocessor"></span>
<a name="l00958"></a>00958    <span class="comment">/* all embedded modules have registered themselves by now */</span>
<a name="l00959"></a>00959    <a class="code" href="loader_8c.html#a79572685332c8840f7c2a8ef83e9b528">embedding</a> = 0;
<a name="l00960"></a>00960 
<a name="l00961"></a>00961    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Asterisk Dynamic Loader Starting:\n&quot;</span>);
<a name="l00962"></a>00962 
<a name="l00963"></a>00963    <a class="code" href="linkedlists_8h.html#a0d1f922e093ac18824a7863fe3f5fa27" title="Initializes a list head structure.">AST_LIST_HEAD_INIT_NOLOCK</a>(&amp;<a class="code" href="structload__order.html">load_order</a>);
<a name="l00964"></a>00964 
<a name="l00965"></a>00965    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="structmodule__list.html">module_list</a>);
<a name="l00966"></a>00966 
<a name="l00967"></a>00967    <span class="keywordflow">if</span> (<a class="code" href="loader_8c.html#a8f35bf1b4933ff38daf3de57967e58b9">embedded_module_list</a>.<a class="code" href="structmodule__list.html#afd7d9987a00cd8bb463a0cf52bb6f4bd">first</a>) {
<a name="l00968"></a>00968       <a class="code" href="structmodule__list.html">module_list</a>.first = <a class="code" href="loader_8c.html#a8f35bf1b4933ff38daf3de57967e58b9">embedded_module_list</a>.<a class="code" href="structmodule__list.html#afd7d9987a00cd8bb463a0cf52bb6f4bd">first</a>;
<a name="l00969"></a>00969       <a class="code" href="structmodule__list.html">module_list</a>.last = <a class="code" href="loader_8c.html#a8f35bf1b4933ff38daf3de57967e58b9">embedded_module_list</a>.<a class="code" href="structmodule__list.html#aa58e2be5dae5322d91f4eef07dceec52">last</a>;
<a name="l00970"></a>00970       <a class="code" href="loader_8c.html#a8f35bf1b4933ff38daf3de57967e58b9">embedded_module_list</a>.<a class="code" href="structmodule__list.html#afd7d9987a00cd8bb463a0cf52bb6f4bd">first</a> = NULL;
<a name="l00971"></a>00971    }
<a name="l00972"></a>00972 
<a name="l00973"></a>00973    cfg = <a class="code" href="config_8h.html#aab3eac8fa82a86a93c074deb7b77dbc9" title="Load a config file.">ast_config_load2</a>(<a class="code" href="module_8h.html#a9d567e7b64d402c1d710b9bd47679cd9" title="Module configuration file.">AST_MODULE_CONFIG</a>, <span class="stringliteral">&quot;&quot;</span> <span class="comment">/* core, can&apos;t reload */</span>, config_flags);
<a name="l00974"></a>00974    <span class="keywordflow">if</span> (cfg == <a class="code" href="config_8h.html#a39bacaabcacf47583204c7634e64a2a0">CONFIG_STATUS_FILEMISSING</a> || cfg == <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>) {
<a name="l00975"></a>00975       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No &apos;%s&apos; found, no modules will be loaded.\n&quot;</span>, <a class="code" href="module_8h.html#a9d567e7b64d402c1d710b9bd47679cd9" title="Module configuration file.">AST_MODULE_CONFIG</a>);
<a name="l00976"></a>00976       <span class="keywordflow">goto</span> done;
<a name="l00977"></a>00977    }
<a name="l00978"></a>00978 
<a name="l00979"></a>00979    <span class="comment">/* first, find all the modules we have been explicitly requested to load */</span>
<a name="l00980"></a>00980    <span class="keywordflow">for</span> (v = <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(cfg, <span class="stringliteral">&quot;modules&quot;</span>); v; v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l00981"></a>00981       <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, preload_only ? <span class="stringliteral">&quot;preload&quot;</span> : <span class="stringliteral">&quot;load&quot;</span>)) {
<a name="l00982"></a>00982          <a class="code" href="loader_8c.html#ab1ab387e2d583ad5ad6bcd6a106e2092">add_to_load_order</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, &amp;<a class="code" href="structload__order.html">load_order</a>);
<a name="l00983"></a>00983       }
<a name="l00984"></a>00984    }
<a name="l00985"></a>00985 
<a name="l00986"></a>00986    <span class="comment">/* check if &apos;autoload&apos; is on */</span>
<a name="l00987"></a>00987    <span class="keywordflow">if</span> (!preload_only &amp;&amp; <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(<a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;modules&quot;</span>, <span class="stringliteral">&quot;autoload&quot;</span>))) {
<a name="l00988"></a>00988       <span class="comment">/* if so, first add all the embedded modules that are not already running to the load order */</span>
<a name="l00989"></a>00989       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="structmodule__list.html">module_list</a>, mod, entry) {
<a name="l00990"></a>00990          <span class="comment">/* if it&apos;s not embedded, skip it */</span>
<a name="l00991"></a>00991          <span class="keywordflow">if</span> (mod-&gt;<a class="code" href="structast__module.html#a5940281c73a2d41b4afdfff28af5859a">lib</a>)
<a name="l00992"></a>00992             <span class="keywordflow">continue</span>;
<a name="l00993"></a>00993 
<a name="l00994"></a>00994          <span class="keywordflow">if</span> (mod-&gt;<a class="code" href="structast__module.html#a4602cfc6834c0c5a50ba85844d9e36d3">flags</a>.<a class="code" href="structast__module.html#a08d1dda1d258042e77ca92d39a12e619">running</a>)
<a name="l00995"></a>00995             <span class="keywordflow">continue</span>;
<a name="l00996"></a>00996 
<a name="l00997"></a>00997          order = <a class="code" href="loader_8c.html#ab1ab387e2d583ad5ad6bcd6a106e2092">add_to_load_order</a>(mod-&gt;<a class="code" href="structast__module.html#ac88a22a2e7bf6d75bcc8fcc8ff257e9f">resource</a>, &amp;<a class="code" href="structload__order.html">load_order</a>);
<a name="l00998"></a>00998       }
<a name="l00999"></a>00999 
<a name="l01000"></a>01000 <span class="preprocessor">#ifdef LOADABLE_MODULES</span>
<a name="l01001"></a>01001 <span class="preprocessor"></span>      <span class="comment">/* if we are allowed to load dynamic modules, scan the directory for</span>
<a name="l01002"></a>01002 <span class="comment">         for all available modules and add them as well */</span>
<a name="l01003"></a>01003       <span class="keywordflow">if</span> ((dir  = opendir(<a class="code" href="paths_8h.html#a5852d8e3bf5485c09b0f3d2c2375eec3">ast_config_AST_MODULE_DIR</a>))) {
<a name="l01004"></a>01004          <span class="keywordflow">while</span> ((dirent = readdir(dir))) {
<a name="l01005"></a>01005             <span class="keywordtype">int</span> ld = strlen(dirent-&gt;d_name);
<a name="l01006"></a>01006 
<a name="l01007"></a>01007             <span class="comment">/* Must end in .so to load it.  */</span>
<a name="l01008"></a>01008 
<a name="l01009"></a>01009             <span class="keywordflow">if</span> (ld &lt; 4)
<a name="l01010"></a>01010                <span class="keywordflow">continue</span>;
<a name="l01011"></a>01011 
<a name="l01012"></a>01012             <span class="keywordflow">if</span> (strcasecmp(dirent-&gt;d_name + ld - 3, <span class="stringliteral">&quot;.so&quot;</span>))
<a name="l01013"></a>01013                <span class="keywordflow">continue</span>;
<a name="l01014"></a>01014 
<a name="l01015"></a>01015             <span class="comment">/* if there is already a module by this name in the module_list,</span>
<a name="l01016"></a>01016 <span class="comment">               skip this file */</span>
<a name="l01017"></a>01017             <span class="keywordflow">if</span> (<a class="code" href="loader_8c.html#abfb73039867fcb82075f230a8bc928cd">find_resource</a>(dirent-&gt;d_name, 0))
<a name="l01018"></a>01018                <span class="keywordflow">continue</span>;
<a name="l01019"></a>01019 
<a name="l01020"></a>01020             <a class="code" href="loader_8c.html#ab1ab387e2d583ad5ad6bcd6a106e2092">add_to_load_order</a>(dirent-&gt;d_name, &amp;<a class="code" href="structload__order.html">load_order</a>);
<a name="l01021"></a>01021          }
<a name="l01022"></a>01022 
<a name="l01023"></a>01023          closedir(dir);
<a name="l01024"></a>01024       } <span class="keywordflow">else</span> {
<a name="l01025"></a>01025          <span class="keywordflow">if</span> (!<a class="code" href="options_8h.html#a0622980cfab96492e3aafce63b2b9c02">ast_opt_quiet</a>)
<a name="l01026"></a>01026             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to open modules directory &apos;%s&apos;.\n&quot;</span>,
<a name="l01027"></a>01027                <a class="code" href="paths_8h.html#a5852d8e3bf5485c09b0f3d2c2375eec3">ast_config_AST_MODULE_DIR</a>);
<a name="l01028"></a>01028       }
<a name="l01029"></a>01029 <span class="preprocessor">#endif</span>
<a name="l01030"></a>01030 <span class="preprocessor"></span>   }
<a name="l01031"></a>01031 
<a name="l01032"></a>01032    <span class="comment">/* now scan the config for any modules we are prohibited from loading and</span>
<a name="l01033"></a>01033 <span class="comment">      remove them from the load order */</span>
<a name="l01034"></a>01034    <span class="keywordflow">for</span> (v = <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(cfg, <span class="stringliteral">&quot;modules&quot;</span>); v; v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l01035"></a>01035       <span class="keywordflow">if</span> (strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;noload&quot;</span>))
<a name="l01036"></a>01036          <span class="keywordflow">continue</span>;
<a name="l01037"></a>01037 
<a name="l01038"></a>01038       <a class="code" href="linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d" title="Loops safely over (traverses) the entries in a list.">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(&amp;<a class="code" href="structload__order.html">load_order</a>, order, entry) {
<a name="l01039"></a>01039          <span class="keywordflow">if</span> (!<a class="code" href="loader_8c.html#a97e726834efdf4ce00f0d134cc12654e">resource_name_match</a>(order-&gt;<a class="code" href="structload__order__entry.html#add9403c2dd81e949c8c4aa872eabdcc7">resource</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>)) {
<a name="l01040"></a>01040             <a class="code" href="linkedlists_8h.html#aa8ac496fa9c717d5afb99a02e1e2760c" title="Removes the current entry from a list during a traversal.">AST_LIST_REMOVE_CURRENT</a>(entry);
<a name="l01041"></a>01041             <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(order-&gt;<a class="code" href="structload__order__entry.html#add9403c2dd81e949c8c4aa872eabdcc7">resource</a>);
<a name="l01042"></a>01042             <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(order);
<a name="l01043"></a>01043          }
<a name="l01044"></a>01044       }
<a name="l01045"></a>01045       <a class="code" href="linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9" title="Closes a safe loop traversal block.">AST_LIST_TRAVERSE_SAFE_END</a>;
<a name="l01046"></a>01046    }
<a name="l01047"></a>01047 
<a name="l01048"></a>01048    <span class="comment">/* we are done with the config now, all the information we need is in the</span>
<a name="l01049"></a>01049 <span class="comment">      load_order list */</span>
<a name="l01050"></a>01050    <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(cfg);
<a name="l01051"></a>01051 
<a name="l01052"></a>01052    load_count = 0;
<a name="l01053"></a>01053    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="structload__order.html">load_order</a>, order, entry)
<a name="l01054"></a>01054       load_count++;
<a name="l01055"></a>01055 
<a name="l01056"></a>01056    if (load_count)
<a name="l01057"></a>01057       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, &quot;%d <a class="code" href="pbx__gtkconsole_8c.html#aa308c88ec23cbe0cb2ac92091eda1d29">modules</a> will be <a class="code" href="cdr__csv_8c.html#a44dd725df865d192f86df4796ffbe2c6">loaded</a>.\n&quot;, load_count);
<a name="l01058"></a>01058 
<a name="l01059"></a>01059    <span class="comment">/* first, load only modules that provide global symbols */</span>
<a name="l01060"></a>01060    if ((res = <a class="code" href="loader_8c.html#a58376fe6725506936c5d9fd05f4bc192">load_resource_list</a>(&amp;<a class="code" href="structload__order.html">load_order</a>, 1, &amp;modulecount)) &lt; 0) {
<a name="l01061"></a>01061       <span class="keywordflow">goto</span> done;
<a name="l01062"></a>01062    }
<a name="l01063"></a>01063 
<a name="l01064"></a>01064    <span class="comment">/* now load everything else */</span>
<a name="l01065"></a>01065    <span class="keywordflow">if</span> ((res = <a class="code" href="loader_8c.html#a58376fe6725506936c5d9fd05f4bc192">load_resource_list</a>(&amp;<a class="code" href="structload__order.html">load_order</a>, 0, &amp;modulecount)) &lt; 0) {
<a name="l01066"></a>01066       <span class="keywordflow">goto</span> done;
<a name="l01067"></a>01067    }
<a name="l01068"></a>01068 
<a name="l01069"></a>01069 done:
<a name="l01070"></a>01070    <span class="keywordflow">while</span> ((order = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;<a class="code" href="structload__order.html">load_order</a>, entry))) {
<a name="l01071"></a>01071       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(order-&gt;<a class="code" href="structload__order__entry.html#add9403c2dd81e949c8c4aa872eabdcc7">resource</a>);
<a name="l01072"></a>01072       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(order);
<a name="l01073"></a>01073    }
<a name="l01074"></a>01074 
<a name="l01075"></a>01075    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="structmodule__list.html">module_list</a>);
<a name="l01076"></a>01076    
<a name="l01077"></a>01077    <span class="comment">/* Tell manager clients that are aggressive at logging in that we&apos;re done</span>
<a name="l01078"></a>01078 <span class="comment">      loading modules. If there&apos;s a DNS problem in chan_sip, we might not</span>
<a name="l01079"></a>01079 <span class="comment">      even reach this */</span>
<a name="l01080"></a>01080    <a class="code" href="manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208" title="External routines may send asterisk manager events this way.">manager_event</a>(<a class="code" href="manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a>, <span class="stringliteral">&quot;ModuleLoadReport&quot;</span>, <span class="stringliteral">&quot;ModuleLoadStatus: Done\r\nModuleSelection: %s\r\nModuleCount: %d\r\n&quot;</span>, preload_only ? <span class="stringliteral">&quot;Preload&quot;</span> : <span class="stringliteral">&quot;All&quot;</span>, modulecount);
<a name="l01081"></a>01081    
<a name="l01082"></a>01082    <span class="keywordflow">return</span> res;
<a name="l01083"></a>01083 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab9a2fcd7b22827d129fc37fc2777c6f4"></a><!-- doxytag: member="_private.h::load_pbx" ref="ab9a2fcd7b22827d129fc37fc2777c6f4" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int load_pbx </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Provided by <a class="el" href="pbx_8c.html" title="Core PBX routines.">pbx.c</a> </p>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09302">9302</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l03289">__ast_custom_function_register()</a>, <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="cli_8c_source.html#l01927">ast_cli_register_multiple()</a>, <a class="el" href="event__defs_8h_source.html#l00047">AST_EVENT_DEVICE_STATE</a>, <a class="el" href="event__defs_8h_source.html#l00058">AST_EVENT_IE_END</a>, <a class="el" href="event_8c_source.html#l00680">ast_event_subscribe()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="manager_8c_source.html#l03448">ast_manager_register2()</a>, <a class="el" href="pbx_8c_source.html#l05062">ast_register_application2()</a>, <a class="el" href="taskprocessor_8c_source.html#l00407">ast_taskprocessor_get()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="pbx_8c.html#a5b85032a1e719d9b83d5699fd350134e">builtins</a>, <a class="el" href="pbx_8c_source.html#l09283">device_state_cb()</a>, <a class="el" href="pbx_8c_source.html#l01074">device_state_sub</a>, <a class="el" href="manager_8h_source.html#l00068">EVENT_FLAG_CONFIG</a>, <a class="el" href="manager_8h_source.html#l00070">EVENT_FLAG_REPORTING</a>, <a class="el" href="pbx_8c_source.html#l03048">exception_function</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="pbx_8c_source.html#l06094">manager_show_dialplan()</a>, <a class="el" href="pbx_8c_source.html#l06147">mandescr_show_dialplan</a>, and <a class="el" href="pbx_8c_source.html#l06363">pbx_cli</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09303"></a>09303 {
<a name="l09304"></a>09304    <span class="keywordtype">int</span> x;
<a name="l09305"></a>09305 
<a name="l09306"></a>09306    <span class="comment">/* Initialize the PBX */</span>
<a name="l09307"></a>09307    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Asterisk PBX Core Initializing\n&quot;</span>);
<a name="l09308"></a>09308    <span class="keywordflow">if</span> (!(<a class="code" href="pbx_8c.html#ad8ddef01864220bd5b800060f0afbe17">device_state_tps</a> = <a class="code" href="taskprocessor_8h.html#a3d670ce6d9ed07b5db0dae8d2c11d275" title="Get a reference to a taskprocessor with the specified name and create the taskprocessor...">ast_taskprocessor_get</a>(<span class="stringliteral">&quot;pbx-core&quot;</span>, 0))) {
<a name="l09309"></a>09309       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;failed to create pbx-core taskprocessor\n&quot;</span>);
<a name="l09310"></a>09310    }
<a name="l09311"></a>09311 
<a name="l09312"></a>09312    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Registering builtin applications:\n&quot;</span>);
<a name="l09313"></a>09313    <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(<a class="code" href="pbx_8c.html#ac7dafac1c16b8b484834c54b532e5d66">pbx_cli</a>, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="pbx_8c.html#ac7dafac1c16b8b484834c54b532e5d66">pbx_cli</a>));
<a name="l09314"></a>09314    <a class="code" href="pbx_8h.html#aad8771c7e3b2170a749946f1a8b758aa" title="Register a custom function.">__ast_custom_function_register</a>(&amp;<a class="code" href="pbx_8c.html#ae51d2f255e1f2ea7fb24e6033a9cba94">exception_function</a>, NULL);
<a name="l09315"></a>09315 
<a name="l09316"></a>09316    <span class="comment">/* Register builtin applications */</span>
<a name="l09317"></a>09317    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="pbx_8c.html#a5b85032a1e719d9b83d5699fd350134e" title="Declaration of builtin applications.">builtins</a>); x++) {
<a name="l09318"></a>09318       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;[%s]\n&quot;</span>, <a class="code" href="pbx_8c.html#a5b85032a1e719d9b83d5699fd350134e" title="Declaration of builtin applications.">builtins</a>[x].<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l09319"></a>09319       <span class="keywordflow">if</span> (<a class="code" href="module_8h.html#a6814b6d7b0a7d23c41df65124eb77171" title="Register an application.">ast_register_application2</a>(<a class="code" href="pbx_8c.html#a5b85032a1e719d9b83d5699fd350134e" title="Declaration of builtin applications.">builtins</a>[x].<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <a class="code" href="pbx_8c.html#a5b85032a1e719d9b83d5699fd350134e" title="Declaration of builtin applications.">builtins</a>[x].execute, NULL, NULL, NULL)) {
<a name="l09320"></a>09320          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to register builtin application &apos;%s&apos;\n&quot;</span>, <a class="code" href="pbx_8c.html#a5b85032a1e719d9b83d5699fd350134e" title="Declaration of builtin applications.">builtins</a>[x].name);
<a name="l09321"></a>09321          <span class="keywordflow">return</span> -1;
<a name="l09322"></a>09322       }
<a name="l09323"></a>09323    }
<a name="l09324"></a>09324 
<a name="l09325"></a>09325    <span class="comment">/* Register manager application */</span>
<a name="l09326"></a>09326    <a class="code" href="group__Group__AMI.html#ga332bf7ef48f67d63d849dd9febb18fb2" title="Register a manager command with the manager interface.">ast_manager_register2</a>(<span class="stringliteral">&quot;ShowDialPlan&quot;</span>, <a class="code" href="manager_8h.html#a36fb89c2a73755209133b6c73fe92e54">EVENT_FLAG_CONFIG</a> | <a class="code" href="manager_8h.html#a0b1b4140c2836696a6950e92ab48a580">EVENT_FLAG_REPORTING</a>, <a class="code" href="pbx_8c.html#a08cb2466bf2b7844066c2e1f62a298db" title="Manager listing of dial plan.">manager_show_dialplan</a>, <span class="stringliteral">&quot;List dialplan&quot;</span>, <a class="code" href="pbx_8c.html#a17bcde67ea91a1acfecbf3d718e86e82">mandescr_show_dialplan</a>);
<a name="l09327"></a>09327 
<a name="l09328"></a>09328    <span class="keywordflow">if</span> (!(<a class="code" href="pbx_8c.html#a51ca11f2c73a7d856c3d3ca3e45fbc31" title="Subscription for device state change events.">device_state_sub</a> = <a class="code" href="event_8h.html#a517ac17630e7658463b66b309a6ce78f" title="Subscribe to events.">ast_event_subscribe</a>(<a class="code" href="event__defs_8h.html#a6fa079412d9d9c1cc539f6d71f37f79fa8900374a138e7dbbc9da893f27923846">AST_EVENT_DEVICE_STATE</a>, <a class="code" href="pbx_8c.html#a6fb2c0a540b83365dcdc10b470116e82">device_state_cb</a>, NULL,
<a name="l09329"></a>09329          <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491a04c78c1362e97d548344c354001c151f">AST_EVENT_IE_END</a>))) {
<a name="l09330"></a>09330       <span class="keywordflow">return</span> -1;
<a name="l09331"></a>09331    }
<a name="l09332"></a>09332 
<a name="l09333"></a>09333    <span class="keywordflow">return</span> 0;
<a name="l09334"></a>09334 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a06393c3702f8ab3864a2fdd7857daa90"></a><!-- doxytag: member="_private.h::threadstorage_init" ref="a06393c3702f8ab3864a2fdd7857daa90" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void threadstorage_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Provided by <a class="el" href="threadstorage_8c.html" title="Debugging support for thread-local-storage objects.">threadstorage.c</a> </p>

<p>Definition at line <a class="el" href="threadstorage_8c_source.html#l00031">31</a> of file <a class="el" href="threadstorage_8c_source.html">threadstorage.c</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00032"></a>00032 {
<a name="l00033"></a>00033 }
</pre></div></p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:18:50 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
