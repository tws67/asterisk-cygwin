<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:23:30 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_1ab815038f534adda65c8b4ae4993449.html">include</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_16d825f1fa9ecca2e70b1a8d9256d0e6.html">asterisk</a>
  </div>
</div>
<div class="contents">
<h1>stringfields.h File Reference</h1>
<p>String fields in structures.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="inline__api_8h_source.html">asterisk/inline_api.h</a>&quot;</code><br/>

<p><a href="stringfields_8h_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__string__field__mgr.html">ast_string_field_mgr</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__string__field__pool.html">ast_string_field_pool</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stringfields_8h.html#a061580e89c55282a7140fa3fdfd52b6d">AST_DECLARE_STRING_FIELDS</a>(field_list)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Declare the fields needed in a structure.  <a href="#a061580e89c55282a7140fa3fdfd52b6d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stringfields_8h.html#a51b5729220efb7cda4393ed35ecdfea2">AST_STRING_FIELD</a>(<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)&nbsp;&nbsp;&nbsp;const <a class="el" href="stringfields_8h.html#abb39dc592226a570e6a73f1b9b09b021">ast_string_field</a> <a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Declare a string field.  <a href="#a51b5729220efb7cda4393ed35ecdfea2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stringfields_8h.html#a8b9f4347fc72720cc5cead952b54abe9">ast_string_field_build</a>(x, field, fmt, args...)&nbsp;&nbsp;&nbsp;__ast_string_field_ptr_build(&amp;(x)-&gt;__field_mgr, &amp;(x)-&gt;__field_mgr_pool, (<a class="el" href="stringfields_8h.html#abb39dc592226a570e6a73f1b9b09b021">ast_string_field</a> *) &amp;(x)-&gt;field, fmt, args)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set a field to a complex (built) value.  <a href="#a8b9f4347fc72720cc5cead952b54abe9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stringfields_8h.html#acbfd7ec6432d941a1239b4fa55503d4c">ast_string_field_build_va</a>(x, field, fmt, args1, args2)&nbsp;&nbsp;&nbsp;__ast_string_field_ptr_build_va(&amp;(x)-&gt;__field_mgr, &amp;(x)-&gt;__field_mgr_pool, (<a class="el" href="stringfields_8h.html#abb39dc592226a570e6a73f1b9b09b021">ast_string_field</a> *) &amp;(x)-&gt;field, fmt, args1, args2)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set a field to a complex (built) value.  <a href="#acbfd7ec6432d941a1239b4fa55503d4c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stringfields_8h.html#abf60f862ae6a141d2f86a0f5e82792de">ast_string_field_free_memory</a>(x)&nbsp;&nbsp;&nbsp;__ast_string_field_init(&amp;(x)-&gt;__field_mgr, &amp;(x)-&gt;__field_mgr_pool, -1, __FILE__, __LINE__, __PRETTY_FUNCTION__)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">free all memory - to be called before destroying the object  <a href="#abf60f862ae6a141d2f86a0f5e82792de"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stringfields_8h.html#a871274fa4fd2687c7a44849a84df3665">ast_string_field_init</a>(x, size)&nbsp;&nbsp;&nbsp;__ast_string_field_init(&amp;(x)-&gt;__field_mgr, &amp;(x)-&gt;__field_mgr_pool, size, __FILE__, __LINE__, __PRETTY_FUNCTION__)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize a field pool and fields.  <a href="#a871274fa4fd2687c7a44849a84df3665"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stringfields_8h.html#a9f55756eaab8a360837a702a1a80426c">ast_string_field_ptr_build</a>(x, ptr, fmt, args...)&nbsp;&nbsp;&nbsp;__ast_string_field_ptr_build(&amp;(x)-&gt;__field_mgr, &amp;(x)-&gt;__field_mgr_pool, (<a class="el" href="stringfields_8h.html#abb39dc592226a570e6a73f1b9b09b021">ast_string_field</a> *) ptr, fmt, args)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set a field to a complex (built) value.  <a href="#a9f55756eaab8a360837a702a1a80426c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stringfields_8h.html#a75a843fcb3b1f4db97a9834e1a519cf4">ast_string_field_ptr_build_va</a>(x, ptr, fmt, args1, args2)&nbsp;&nbsp;&nbsp;__ast_string_field_ptr_build_va(&amp;(x)-&gt;__field_mgr, &amp;(x)-&gt;__field_mgr_pool, (<a class="el" href="stringfields_8h.html#abb39dc592226a570e6a73f1b9b09b021">ast_string_field</a> *) ptr, fmt, args1, args2)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set a field to a complex (built) value with prebuilt va_lists.  <a href="#a75a843fcb3b1f4db97a9834e1a519cf4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stringfields_8h.html#ad5919d2452007db4100fda0d0b656ffa">ast_string_field_ptr_set</a>(x, ptr, data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set a field to a simple string value.  <a href="#ad5919d2452007db4100fda0d0b656ffa"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(x, field, data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set a field to a simple string value.  <a href="#a653461abd6e0d16e4e3326ab90e0501d"></a><br/></td></tr>
<tr><td colspan="2"><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stringfields_8h.html#abb39dc592226a570e6a73f1b9b09b021">ast_string_field</a></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="stringfields_8h.html#abb39dc592226a570e6a73f1b9b09b021">ast_string_field</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stringfields_8h.html#a7466d46d24c1418dbc0c814a03e1a5dc">__ast_string_field_alloc_space</a> (struct <a class="el" href="structast__string__field__mgr.html">ast_string_field_mgr</a> *mgr, struct <a class="el" href="structast__string__field__pool.html">ast_string_field_pool</a> **pool_head, size_t needed)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stringfields_8h.html#a4e24c6a8b5b6ae53764e6a0e9c313506">__ast_string_field_init</a> (struct <a class="el" href="structast__string__field__mgr.html">ast_string_field_mgr</a> *mgr, struct <a class="el" href="structast__string__field__pool.html">ast_string_field_pool</a> **pool_head, int needed, const char *file, int lineno, const char *func)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stringfields_8h.html#a1d75cac4d629dcf89e6fd872206bef58">__ast_string_field_ptr_build</a> (struct <a class="el" href="structast__string__field__mgr.html">ast_string_field_mgr</a> *mgr, struct <a class="el" href="structast__string__field__pool.html">ast_string_field_pool</a> **pool_head, <a class="el" href="stringfields_8h.html#abb39dc592226a570e6a73f1b9b09b021">ast_string_field</a> *ptr, const char *<a class="el" href="chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a>,...)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stringfields_8h.html#ad98e24bec15ed4b5605f336406cbe370">__ast_string_field_ptr_build_va</a> (struct <a class="el" href="structast__string__field__mgr.html">ast_string_field_mgr</a> *mgr, struct <a class="el" href="structast__string__field__pool.html">ast_string_field_pool</a> **pool_head, <a class="el" href="stringfields_8h.html#abb39dc592226a570e6a73f1b9b09b021">ast_string_field</a> *ptr, const char *<a class="el" href="chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a>, va_list a1, va_list a2)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stringfields_8h.html#ac438a66ce99b119c7fb4ee7f787d7232">__ast_string_field_ptr_grow</a> (struct <a class="el" href="structast__string__field__mgr.html">ast_string_field_mgr</a> *mgr, size_t needed, const <a class="el" href="stringfields_8h.html#abb39dc592226a570e6a73f1b9b09b021">ast_string_field</a> *ptr)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="stringfields_8h.html#abd7963f51b12591f39f99c08277ec41d">__ast_string_field_empty</a> []</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>String fields in structures. </p>
<p>This file contains objects and macros used to manage string fields in structures without requiring them to be allocated as fixed-size buffers or requiring individual allocations for for each field.</p>
<p>Using this functionality is quite simple. An example structure with three fields is defined like this:</p>
<div class="fragment"><pre class="fragment">  <span class="keyword">struct </span>sample_fields {
     <span class="keywordtype">int</span> x1;
     <a class="code" href="stringfields_8h.html#a061580e89c55282a7140fa3fdfd52b6d" title="Declare the fields needed in a structure.">AST_DECLARE_STRING_FIELDS</a>(
        <a class="code" href="stringfields_8h.html#a51b5729220efb7cda4393ed35ecdfea2" title="Declare a string field.">AST_STRING_FIELD</a>(foo);
        <a class="code" href="stringfields_8h.html#a51b5729220efb7cda4393ed35ecdfea2" title="Declare a string field.">AST_STRING_FIELD</a>(bar);
        <a class="code" href="stringfields_8h.html#a51b5729220efb7cda4393ed35ecdfea2" title="Declare a string field.">AST_STRING_FIELD</a>(blah);
     );
     <span class="keywordtype">long</span> x2;
  };
</pre></div><p>When an instance of this structure is allocated (either statically or dynamically), the fields and the pool of storage for them must be initialized:</p>
<div class="fragment"><pre class="fragment">  <span class="keyword">struct </span>sample_fields *x;
  
  x = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*x));
  <span class="keywordflow">if</span> (x == NULL || <a class="code" href="stringfields_8h.html#a871274fa4fd2687c7a44849a84df3665" title="Initialize a field pool and fields.">ast_string_field_init</a>(x, 252)) {
   <span class="keywordflow">if</span> (x)
      <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(x);
   x = NULL;
   ... handle error
  }
</pre></div><p>Fields will default to pointing to an empty string, and will revert to that when <a class="el" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set()</a> is called with a NULL argument. A string field will <b>never</b> contain NULL (this feature is not used in this code, but comes from external requirements).</p>
<p><a class="el" href="stringfields_8h.html#a871274fa4fd2687c7a44849a84df3665" title="Initialize a field pool and fields.">ast_string_field_init(x, 0)</a> will reset fields to the initial value while keeping the pool allocated.</p>
<p>Reading the fields is much like using 'const char * const' fields in the structure: you cannot write to the field or to the memory it points to (XXX perhaps the latter is too much of a restriction since <a class="el" href="structvalues.html">values</a> are not shared).</p>
<p>Writing to the fields must be done using the wrapper macros listed below; and assignments are always by value (i.e. strings are copied): <a class="el" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set()</a> stores a simple value; <a class="el" href="stringfields_8h.html#a8b9f4347fc72720cc5cead952b54abe9" title="Set a field to a complex (built) value.">ast_string_field_build()</a> builds the string using a printf-style; <a class="el" href="stringfields_8h.html#acbfd7ec6432d941a1239b4fa55503d4c" title="Set a field to a complex (built) value.">ast_string_field_build_va()</a> is the varargs version of the above (for portability reasons it uses two vararg); variants of these function allow passing a pointer to the field as an argument. </p>
<div class="fragment"><pre class="fragment">  <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(x, foo, <span class="stringliteral">&quot;infinite loop&quot;</span>);
  <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(x, foo, NULL); <span class="comment">// set to an empty string</span>
  <a class="code" href="stringfields_8h.html#ad5919d2452007db4100fda0d0b656ffa" title="Set a field to a simple string value.">ast_string_field_ptr_set</a>(x, &amp;x-&gt;bar, <span class="stringliteral">&quot;right way&quot;</span>);

  <a class="code" href="stringfields_8h.html#a8b9f4347fc72720cc5cead952b54abe9" title="Set a field to a complex (built) value.">ast_string_field_build</a>(x, blah, <span class="stringliteral">&quot;%d %s&quot;</span>, zipcode, city);
  <a class="code" href="stringfields_8h.html#a9f55756eaab8a360837a702a1a80426c" title="Set a field to a complex (built) value.">ast_string_field_ptr_build</a>(x, &amp;x-&gt;blah, <span class="stringliteral">&quot;%d %s&quot;</span>, zipcode, city);

  <a class="code" href="stringfields_8h.html#acbfd7ec6432d941a1239b4fa55503d4c" title="Set a field to a complex (built) value.">ast_string_field_build_va</a>(x, bar, fmt, args1, args2)
  <a class="code" href="stringfields_8h.html#a75a843fcb3b1f4db97a9834e1a519cf4" title="Set a field to a complex (built) value with prebuilt va_lists.">ast_string_field_ptr_build_va</a>(x, &amp;x-&gt;bar, fmt, args1, args2)
</pre></div><p>When the structure instance is no longer needed, the fields and their storage pool must be freed:</p>
<div class="fragment"><pre class="fragment">  <a class="code" href="stringfields_8h.html#abf60f862ae6a141d2f86a0f5e82792de" title="free all memory - to be called before destroying the object">ast_string_field_free_memory</a>(x);
  <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(x);
</pre></div><p>This completes the API description. </p>

<p>Definition in file <a class="el" href="stringfields_8h_source.html">stringfields.h</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a061580e89c55282a7140fa3fdfd52b6d"></a><!-- doxytag: member="stringfields.h::AST_DECLARE_STRING_FIELDS" ref="a061580e89c55282a7140fa3fdfd52b6d" args="(field_list)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_DECLARE_STRING_FIELDS</td>
          <td>(</td>
          <td class="paramtype">field_list&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keyword">struct </span><a class="code" href="structast__string__field__pool.html">ast_string_field_pool</a> *__field_mgr_pool; \
   field_list              \
   <span class="keyword">struct </span><a class="code" href="structast__string__field__mgr.html">ast_string_field_mgr</a> __field_mgr
</pre></div>
<p>Declare the fields needed in a structure. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>field_list</em>&nbsp;</td><td>The list of fields to declare, using <a class="el" href="stringfields_8h.html#a51b5729220efb7cda4393ed35ecdfea2" title="Declare a string field.">AST_STRING_FIELD()</a> for each one. Internally, string fields are stored as a pointer to the head of the pool, followed by individual string fields, and then a struct <a class="el" href="structast__string__field__mgr.html">ast_string_field_mgr</a> which describes the space allocated. We split the two variables so they can be used as markers around the field_list, and this allows us to determine how many entries are in the field, and play with them. In particular, for writing to the fields, we rely on __field_mgr_pool to be a non-const pointer, so we know it has the same size as ast_string_field, and we can use it to locate the fields. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="stringfields_8h_source.html#l00227">227</a> of file <a class="el" href="stringfields_8h_source.html">stringfields.h</a>.</p>

</div>
</div>
<a class="anchor" id="a51b5729220efb7cda4393ed35ecdfea2"></a><!-- doxytag: member="stringfields.h::AST_STRING_FIELD" ref="a51b5729220efb7cda4393ed35ecdfea2" args="(name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_STRING_FIELD</td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;const <a class="el" href="stringfields_8h.html#abb39dc592226a570e6a73f1b9b09b021">ast_string_field</a> <a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Declare a string field. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>The field name </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="stringfields_8h_source.html#l00212">212</a> of file <a class="el" href="stringfields_8h_source.html">stringfields.h</a>.</p>

</div>
</div>
<a class="anchor" id="a8b9f4347fc72720cc5cead952b54abe9"></a><!-- doxytag: member="stringfields.h::ast_string_field_build" ref="a8b9f4347fc72720cc5cead952b54abe9" args="(x, field, fmt, args...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ast_string_field_build</td>
          <td>(</td>
          <td class="paramtype">x, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">field, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fmt, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">args...&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;__ast_string_field_ptr_build(&amp;(x)-&gt;__field_mgr, &amp;(x)-&gt;__field_mgr_pool, (<a class="el" href="stringfields_8h.html#abb39dc592226a570e6a73f1b9b09b021">ast_string_field</a> *) &amp;(x)-&gt;field, fmt, args)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set a field to a complex (built) value. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>x</em>&nbsp;</td><td>Pointer to a structure containing fields </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>field</em>&nbsp;</td><td>Name of the field to set </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fmt</em>&nbsp;</td><td>printf-style format string </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>args</em>&nbsp;</td><td>Arguments for format string </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>nothing </dd></dl>

<p>Definition at line <a class="el" href="stringfields_8h_source.html#l00308">308</a> of file <a class="el" href="stringfields_8h_source.html">stringfields.h</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l00772">__ast_channel_alloc_ap()</a>, <a class="el" href="chan__sip_8c_source.html#l07101">build_callid_pvt()</a>, <a class="el" href="chan__sip_8c_source.html#l07112">build_callid_registry()</a>, <a class="el" href="chan__sip_8c_source.html#l10559">build_contact()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00583">build_profile()</a>, <a class="el" href="chan__sip_8c_source.html#l10578">build_rpid()</a>, <a class="el" href="chan__iax2_8c_source.html#l12156">build_user()</a>, <a class="el" href="chan__sip_8c_source.html#l05102">create_addr_from_peer()</a>, <a class="el" href="chan__sip_8c_source.html#l21175">handle_request_subscribe()</a>, <a class="el" href="chan__sip_8c_source.html#l18268">handle_response()</a>, <a class="el" href="func__odbc_8c_source.html#l00745">init_acf_query()</a>, <a class="el" href="chan__mgcp_8c_source.html#l01470">mgcp_new()</a>, <a class="el" href="chan__sip_8c_source.html#l17435">parse_moved_contact()</a>, <a class="el" href="chan__sip_8c_source.html#l12222">parse_register_contact()</a>, <a class="el" href="chan__sip_8c_source.html#l12557">set_nonce_randdata()</a>, <a class="el" href="chan__sip_8c_source.html#l04476">sip_sendhtml()</a>, <a class="el" href="chan__sip_8c_source.html#l25514">sip_sipredirect()</a>, and <a class="el" href="chan__unistim_8c_source.html#l04422">unistim_new()</a>.</p>

</div>
</div>
<a class="anchor" id="acbfd7ec6432d941a1239b4fa55503d4c"></a><!-- doxytag: member="stringfields.h::ast_string_field_build_va" ref="acbfd7ec6432d941a1239b4fa55503d4c" args="(x, field, fmt, args1, args2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ast_string_field_build_va</td>
          <td>(</td>
          <td class="paramtype">x, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">field, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fmt, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">args1, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">args2&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;__ast_string_field_ptr_build_va(&amp;(x)-&gt;__field_mgr, &amp;(x)-&gt;__field_mgr_pool, (<a class="el" href="stringfields_8h.html#abb39dc592226a570e6a73f1b9b09b021">ast_string_field</a> *) &amp;(x)-&gt;field, fmt, args1, args2)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set a field to a complex (built) value. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>x</em>&nbsp;</td><td>Pointer to a structure containing fields </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>field</em>&nbsp;</td><td>Name of the field to set </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fmt</em>&nbsp;</td><td>printf-style format string </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>args1</em>&nbsp;</td><td>argument one </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>args2</em>&nbsp;</td><td>argument two </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>nothing </dd></dl>

<p>Definition at line <a class="el" href="stringfields_8h_source.html#l00332">332</a> of file <a class="el" href="stringfields_8h_source.html">stringfields.h</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l00772">__ast_channel_alloc_ap()</a>.</p>

</div>
</div>
<a class="anchor" id="abf60f862ae6a141d2f86a0f5e82792de"></a><!-- doxytag: member="stringfields.h::ast_string_field_free_memory" ref="abf60f862ae6a141d2f86a0f5e82792de" args="(x)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ast_string_field_free_memory</td>
          <td>(</td>
          <td class="paramtype">x&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;__ast_string_field_init(&amp;(x)-&gt;__field_mgr, &amp;(x)-&gt;__field_mgr_pool, -1, __FILE__, __LINE__, __PRETTY_FUNCTION__)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>free all memory - to be called before destroying the object </p>

<p>Definition at line <a class="el" href="stringfields_8h_source.html#l00245">245</a> of file <a class="el" href="stringfields_8h_source.html">stringfields.h</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l00772">__ast_channel_alloc_ap()</a>, <a class="el" href="chan__sip_8c_source.html#l05498">__sip_destroy()</a>, <a class="el" href="channel_8c_source.html#l01388">ast_channel_free()</a>, <a class="el" href="pbx_8c_source.html#l03216">ast_custom_function_unregister()</a>, <a class="el" href="pbx_8c_source.html#l06403">ast_unregister_application()</a>, <a class="el" href="features_8c_source.html#l01839">ast_unregister_groups()</a>, <a class="el" href="chan__iax2_8c_source.html#l12156">build_user()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00695">delete_extension()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00257">delete_file()</a>, <a class="el" href="app__jack_8c_source.html#l00340">destroy_jack_data()</a>, <a class="el" href="res__smdi_8c_source.html#l00735">destroy_mailbox_mapping()</a>, <a class="el" href="app__queue_8c_source.html#l01658">destroy_queue()</a>, <a class="el" href="app__meetme_8c_source.html#l05973">destroy_station()</a>, <a class="el" href="app__meetme_8c_source.html#l05959">destroy_trunk()</a>, <a class="el" href="pbx_8c_source.html#l02983">exception_store_free()</a>, <a class="el" href="func__odbc_8c_source.html#l00964">free_acf_query()</a>, <a class="el" href="pbx__spool_8c_source.html#l00101">free_outgoing()</a>, <a class="el" href="func__odbc_8c_source.html#l00745">init_acf_query()</a>, <a class="el" href="cdr__tds_8c_source.html#l00524">load_module()</a>, <a class="el" href="chan__iax2_8c_source.html#l11855">peer_destructor()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00263">profile_destructor()</a>, <a class="el" href="chan__console_8c_source.html#l01304">pvt_destructor()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00303">route_destructor()</a>, <a class="el" href="chan__sip_8c_source.html#l04649">sip_destroy_peer()</a>, <a class="el" href="chan__sip_8c_source.html#l05460">sip_registry_destroy()</a>, <a class="el" href="chan__sip_8c_source.html#l05484">sip_subscribe_mwi_destroy()</a>, <a class="el" href="cdr__tds_8c_source.html#l00385">tds_unload_module()</a>, <a class="el" href="chan__sip_8c_source.html#l09590">temp_pvt_cleanup()</a>, and <a class="el" href="chan__iax2_8c_source.html#l12142">user_destructor()</a>.</p>

</div>
</div>
<a class="anchor" id="a871274fa4fd2687c7a44849a84df3665"></a><!-- doxytag: member="stringfields.h::ast_string_field_init" ref="a871274fa4fd2687c7a44849a84df3665" args="(x, size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ast_string_field_init</td>
          <td>(</td>
          <td class="paramtype">x, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;__ast_string_field_init(&amp;(x)-&gt;__field_mgr, &amp;(x)-&gt;__field_mgr_pool, size, __FILE__, __LINE__, __PRETTY_FUNCTION__)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize a field pool and fields. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>x</em>&nbsp;</td><td>Pointer to a structure containing fields </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>size</em>&nbsp;</td><td>Amount of storage to allocate. Use 0 to reset fields to the default value, and release all but the most recent pool. size&lt;0 (used internally) means free all pools. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 on success, non-zero on failure </dd></dl>

<p>Definition at line <a class="el" href="stringfields_8h_source.html#l00241">241</a> of file <a class="el" href="stringfields_8h_source.html">stringfields.h</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l00772">__ast_channel_alloc_ap()</a>, <a class="el" href="pbx_8c_source.html#l03244">acf_retrieve_docs()</a>, <a class="el" href="app__queue_8c_source.html#l01672">alloc_queue()</a>, <a class="el" href="res__smdi_8c_source.html#l00752">append_mailbox_mapping()</a>, <a class="el" href="pbx_8c_source.html#l05062">ast_register_application2()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00709">build_extension()</a>, <a class="el" href="chan__iax2_8c_source.html#l11880">build_peer()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00583">build_profile()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00556">build_route()</a>, <a class="el" href="chan__iax2_8c_source.html#l12156">build_user()</a>, <a class="el" href="func__odbc_8c_source.html#l00745">init_acf_query()</a>, <a class="el" href="pbx__spool_8c_source.html#l00088">init_outgoing()</a>, <a class="el" href="chan__console_8c_source.html#l01311">init_pvt()</a>, <a class="el" href="app__jack_8c_source.html#l00674">jack_data_alloc()</a>, <a class="el" href="cdr__tds_8c_source.html#l00524">load_module()</a>, <a class="el" href="chan__iax2_8c_source.html#l01763">new_iax()</a>, <a class="el" href="pbx_8c_source.html#l02995">pbx_builtin_raise_exception()</a>, <a class="el" href="features_8c_source.html#l01732">register_group()</a>, <a class="el" href="features_8c_source.html#l01767">register_group_feature()</a>, <a class="el" href="chan__sip_8c_source.html#l07151">sip_alloc()</a>, <a class="el" href="chan__sip_8c_source.html#l07472">sip_register()</a>, <a class="el" href="chan__sip_8c_source.html#l07663">sip_subscribe_mwi()</a>, <a class="el" href="app__meetme_8c_source.html#l06177">sla_build_station()</a>, <a class="el" href="app__meetme_8c_source.html#l06042">sla_build_trunk()</a>, <a class="el" href="cdr__tds_8c_source.html#l00422">tds_load_module()</a>, <a class="el" href="chan__sip_8c_source.html#l23639">temp_peer()</a>, <a class="el" href="chan__sip_8c_source.html#l09582">temp_pvt_init()</a>, and <a class="el" href="chan__sip_8c_source.html#l09600">transmit_response_using_temp()</a>.</p>

</div>
</div>
<a class="anchor" id="a9f55756eaab8a360837a702a1a80426c"></a><!-- doxytag: member="stringfields.h::ast_string_field_ptr_build" ref="a9f55756eaab8a360837a702a1a80426c" args="(x, ptr, fmt, args...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ast_string_field_ptr_build</td>
          <td>(</td>
          <td class="paramtype">x, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ptr, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fmt, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">args...&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;__ast_string_field_ptr_build(&amp;(x)-&gt;__field_mgr, &amp;(x)-&gt;__field_mgr_pool, (<a class="el" href="stringfields_8h.html#abb39dc592226a570e6a73f1b9b09b021">ast_string_field</a> *) ptr, fmt, args)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set a field to a complex (built) value. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>x</em>&nbsp;</td><td>Pointer to a structure containing fields </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ptr</em>&nbsp;</td><td>Pointer to a field within the structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fmt</em>&nbsp;</td><td>printf-style format string </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>args</em>&nbsp;</td><td>Arguments for format string </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>nothing </dd></dl>

<p>Definition at line <a class="el" href="stringfields_8h_source.html#l00297">297</a> of file <a class="el" href="stringfields_8h_source.html">stringfields.h</a>.</p>

</div>
</div>
<a class="anchor" id="a75a843fcb3b1f4db97a9834e1a519cf4"></a><!-- doxytag: member="stringfields.h::ast_string_field_ptr_build_va" ref="a75a843fcb3b1f4db97a9834e1a519cf4" args="(x, ptr, fmt, args1, args2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ast_string_field_ptr_build_va</td>
          <td>(</td>
          <td class="paramtype">x, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ptr, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fmt, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">args1, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">args2&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;__ast_string_field_ptr_build_va(&amp;(x)-&gt;__field_mgr, &amp;(x)-&gt;__field_mgr_pool, (<a class="el" href="stringfields_8h.html#abb39dc592226a570e6a73f1b9b09b021">ast_string_field</a> *) ptr, fmt, args1, args2)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set a field to a complex (built) value with prebuilt va_lists. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>x</em>&nbsp;</td><td>Pointer to a structure containing fields </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ptr</em>&nbsp;</td><td>Pointer to a field within the structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fmt</em>&nbsp;</td><td>printf-style format string </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>args1</em>&nbsp;</td><td>Arguments for format string in va_list format </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>args2</em>&nbsp;</td><td>a second copy of the va_list for the sake of bsd, with no va_list copy operation </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>nothing </dd></dl>

<p>Definition at line <a class="el" href="stringfields_8h_source.html#l00320">320</a> of file <a class="el" href="stringfields_8h_source.html">stringfields.h</a>.</p>

</div>
</div>
<a class="anchor" id="ad5919d2452007db4100fda0d0b656ffa"></a><!-- doxytag: member="stringfields.h::ast_string_field_ptr_set" ref="ad5919d2452007db4100fda0d0b656ffa" args="(x, ptr, data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ast_string_field_ptr_set</td>
          <td>(</td>
          <td class="paramtype">x, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ptr, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">data&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set a field to a simple string value. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>x</em>&nbsp;</td><td>Pointer to a structure containing fields </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ptr</em>&nbsp;</td><td>Pointer to a field within the structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>String value to be copied into the field </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>nothing </dd></dl>

<p>Definition at line <a class="el" href="stringfields_8h_source.html#l00262">262</a> of file <a class="el" href="stringfields_8h_source.html">stringfields.h</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l17039">reply_digest()</a>.</p>

</div>
</div>
<a class="anchor" id="a653461abd6e0d16e4e3326ab90e0501d"></a><!-- doxytag: member="stringfields.h::ast_string_field_set" ref="a653461abd6e0d16e4e3326ab90e0501d" args="(x, field, data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ast_string_field_set</td>
          <td>(</td>
          <td class="paramtype">x, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">field, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">data&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">do</span> {     \
   <a class="code" href="stringfields_8h.html#ad5919d2452007db4100fda0d0b656ffa" title="Set a field to a simple string value.">ast_string_field_ptr_set</a>(x, &amp;(x)-&gt;field, data);    \
   } <span class="keywordflow">while</span> (0)
</pre></div>
<p>Set a field to a simple string value. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>x</em>&nbsp;</td><td>Pointer to a structure containing fields </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>field</em>&nbsp;</td><td>Name of the field to set </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>String value to be copied into the field </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>nothing </dd></dl>

<p>Definition at line <a class="el" href="stringfields_8h_source.html#l00285">285</a> of file <a class="el" href="stringfields_8h_source.html">stringfields.h</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l00772">__ast_channel_alloc_ap()</a>, <a class="el" href="chan__iax2_8c_source.html#l02580">__find_callno()</a>, <a class="el" href="chan__h323_8c_source.html#l00999">__oh323_new()</a>, <a class="el" href="chan__sip_8c_source.html#l10966">__sip_subscribe_mwi_do()</a>, <a class="el" href="pbx_8c_source.html#l03244">acf_retrieve_docs()</a>, <a class="el" href="chan__agent_8c_source.html#l01086">agent_new()</a>, <a class="el" href="app__queue_8c_source.html#l01672">alloc_queue()</a>, <a class="el" href="chan__alsa_8c_source.html#l00536">alsa_new()</a>, <a class="el" href="res__smdi_8c_source.html#l00752">append_mailbox_mapping()</a>, <a class="el" href="pbx__spool_8c_source.html#l00110">apply_outgoing()</a>, <a class="el" href="channel_8c_source.html#l03779">ast_call_forward()</a>, <a class="el" href="cdr_8c_source.html#l00936">ast_cdr_setaccount()</a>, <a class="el" href="channel_8c_source.html#l04296">ast_change_name()</a>, <a class="el" href="channel_8c_source.html#l04393">ast_do_masquerade()</a>, <a class="el" href="chan__iax2_8c_source.html#l05415">ast_iax2_new()</a>, <a class="el" href="pbx_8c_source.html#l05062">ast_register_application2()</a>, <a class="el" href="chan__iax2_8c_source.html#l07812">authenticate_reply()</a>, <a class="el" href="chan__iax2_8c_source.html#l07462">authenticate_request()</a>, <a class="el" href="chan__iax2_8c_source.html#l07515">authenticate_verify()</a>, <a class="el" href="dial_8c_source.html#l00255">begin_dial_channel()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00709">build_extension()</a>, <a class="el" href="chan__iax2_8c_source.html#l11880">build_peer()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00583">build_profile()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00556">build_route()</a>, <a class="el" href="chan__sip_8c_source.html#l10578">build_rpid()</a>, <a class="el" href="chan__iax2_8c_source.html#l12156">build_user()</a>, <a class="el" href="chan__iax2_8c_source.html#l13001">cache_get_callno_locked()</a>, <a class="el" href="chan__iax2_8c_source.html#l07197">check_access()</a>, <a class="el" href="chan__sip_8c_source.html#l13923">check_peer_ok()</a>, <a class="el" href="chan__sip_8c_source.html#l14088">check_user_full()</a>, <a class="el" href="app__meetme_8c_source.html#l01877">conf_start_moh()</a>, <a class="el" href="chan__console_8c_source.html#l00410">console_new()</a>, <a class="el" href="chan__sip_8c_source.html#l05252">create_addr()</a>, <a class="el" href="chan__sip_8c_source.html#l05102">create_addr_from_peer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="app__disa_8c_source.html#l00143">disa_exec()</a>, <a class="el" href="app__dial_8c_source.html#l00712">do_forward()</a>, <a class="el" href="chan__sip_8c_source.html#l10544">extract_uri()</a>, <a class="el" href="features_8c_source.html#l02152">feature_request_and_dial()</a>, <a class="el" href="app__followme_8c_source.html#l00777">findmeexec()</a>, <a class="el" href="chan__sip_8c_source.html#l13667">get_also_info()</a>, <a class="el" href="chan__sip_8c_source.html#l13269">get_destination()</a>, <a class="el" href="chan__sip_8c_source.html#l13195">get_rdnis()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00989">gtalk_new()</a>, <a class="el" href="chan__sip_8c_source.html#l21556">handle_incoming()</a>, <a class="el" href="app__jack_8c_source.html#l00692">handle_options()</a>, <a class="el" href="chan__sip_8c_source.html#l21024">handle_request_bye()</a>, <a class="el" href="chan__sip_8c_source.html#l19641">handle_request_invite()</a>, <a class="el" href="chan__sip_8c_source.html#l19135">handle_request_options()</a>, <a class="el" href="chan__sip_8c_source.html#l20572">handle_request_refer()</a>, <a class="el" href="chan__sip_8c_source.html#l18268">handle_response()</a>, <a class="el" href="chan__sip_8c_source.html#l17572">handle_response_invite()</a>, <a class="el" href="chan__sip_8c_source.html#l17893">handle_response_notify()</a>, <a class="el" href="chan__sip_8c_source.html#l17936">handle_response_subscribe()</a>, <a class="el" href="chan__iax2_8c_source.html#l04777">iax2_call()</a>, <a class="el" href="chan__iax2_8c_source.html#l11561">iax2_request()</a>, <a class="el" href="func__odbc_8c_source.html#l00745">init_acf_query()</a>, <a class="el" href="chan__console_8c_source.html#l01311">init_pvt()</a>, <a class="el" href="app__queue_8c_source.html#l01174">init_queue()</a>, <a class="el" href="chan__sip_8c_source.html#l10657">initreqprep()</a>, <a class="el" href="chan__jingle_8c_source.html#l00800">jingle_new()</a>, <a class="el" href="chan__dahdi_8c_source.html#l17308">load_module()</a>, <a class="el" href="chan__local_8c_source.html#l00518">local_call()</a>, <a class="el" href="chan__mgcp_8c_source.html#l01470">mgcp_new()</a>, <a class="el" href="res__musiconhold_8c_source.html#l00400">moh_handle_digit()</a>, <a class="el" href="dial_8c_source.html#l00535">monitor_dial()</a>, <a class="el" href="chan__nbs_8c_source.html#l00222">nbs_new()</a>, <a class="el" href="chan__iax2_8c_source.html#l01763">new_iax()</a>, <a class="el" href="chan__oss_8c_source.html#l00784">oss_new()</a>, <a class="el" href="chan__sip_8c_source.html#l17435">parse_moved_contact()</a>, <a class="el" href="chan__sip_8c_source.html#l12137">parse_ok_contact()</a>, <a class="el" href="chan__sip_8c_source.html#l12222">parse_register_contact()</a>, <a class="el" href="pbx_8c_source.html#l02995">pbx_builtin_raise_exception()</a>, <a class="el" href="chan__phone_8c_source.html#l00846">phone_new()</a>, <a class="el" href="app__queue_8c_source.html#l01385">queue_set_param()</a>, <a class="el" href="chan__misdn_8c_source.html#l02185">read_config()</a>, <a class="el" href="chan__sip_8c_source.html#l12075">reg_source_db()</a>, <a class="el" href="features_8c_source.html#l01732">register_group()</a>, <a class="el" href="features_8c_source.html#l01767">register_group_feature()</a>, <a class="el" href="chan__iax2_8c_source.html#l07596">register_verify()</a>, <a class="el" href="chan__iax2_8c_source.html#l08505">registry_authrequest()</a>, <a class="el" href="chan__sip_8c_source.html#l13909">replace_cid()</a>, <a class="el" href="chan__sip_8c_source.html#l17039">reply_digest()</a>, <a class="el" href="chan__sip_8c_source.html#l09423">reqprep()</a>, <a class="el" href="chan__sip_8c_source.html#l09357">respprep()</a>, <a class="el" href="app__queue_8c_source.html#l02467">ring_entry()</a>, <a class="el" href="chan__iax2_8c_source.html#l09034">save_osptoken()</a>, <a class="el" href="res__musiconhold_8c_source.html#l00730">set_moh_exec()</a>, <a class="el" href="chan__sip_8c_source.html#l23584">set_peer_defaults()</a>, <a class="el" href="chan__console_8c_source.html#l01229">set_pvt_defaults()</a>, <a class="el" href="chan__sip_8c_source.html#l07151">sip_alloc()</a>, <a class="el" href="chan__sip_8c_source.html#l05373">sip_call()</a>, <a class="el" href="chan__sip_8c_source.html#l06599">sip_new()</a>, <a class="el" href="chan__sip_8c_source.html#l18778">sip_park()</a>, <a class="el" href="chan__sip_8c_source.html#l22876">sip_poke_peer()</a>, <a class="el" href="chan__sip_8c_source.html#l07472">sip_register()</a>, <a class="el" href="chan__sip_8c_source.html#l23066">sip_request_call()</a>, <a class="el" href="chan__sip_8c_source.html#l13165">sip_set_redirstr()</a>, <a class="el" href="chan__sip_8c_source.html#l07663">sip_subscribe_mwi()</a>, <a class="el" href="chan__skinny_8c_source.html#l04268">skinny_new()</a>, <a class="el" href="app__meetme_8c_source.html#l06177">sla_build_station()</a>, <a class="el" href="app__meetme_8c_source.html#l06042">sla_build_trunk()</a>, <a class="el" href="chan__iax2_8c_source.html#l09458">socket_process()</a>, <a class="el" href="chan__console_8c_source.html#l01260">store_callerid()</a>, <a class="el" href="cdr__tds_8c_source.html#l00422">tds_load_module()</a>, <a class="el" href="chan__sip_8c_source.html#l11829">transmit_refer()</a>, <a class="el" href="chan__sip_8c_source.html#l11545">transmit_register()</a>, <a class="el" href="chan__sip_8c_source.html#l09600">transmit_response_using_temp()</a>, <a class="el" href="chan__unistim_8c_source.html#l04422">unistim_new()</a>, <a class="el" href="chan__usbradio_8c_source.html#l02183">usbradio_new()</a>, <a class="el" href="app__voicemail_8c_source.html#l09099">vm_execmain()</a>, and <a class="el" href="app__dial_8c_source.html#l00818">wait_for_answer()</a>.</p>

</div>
</div>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="abb39dc592226a570e6a73f1b9b09b021"></a><!-- doxytag: member="stringfields.h::ast_string_field" ref="abb39dc592226a570e6a73f1b9b09b021" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef const char* <a class="el" href="stringfields_8h.html#abb39dc592226a570e6a73f1b9b09b021">ast_string_field</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="stringfields_8h_source.html#l00114">114</a> of file <a class="el" href="stringfields_8h_source.html">stringfields.h</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a7466d46d24c1418dbc0c814a03e1a5dc"></a><!-- doxytag: member="stringfields.h::__ast_string_field_alloc_space" ref="a7466d46d24c1418dbc0c814a03e1a5dc" args="(struct ast_string_field_mgr *mgr, struct ast_string_field_pool **pool_head, size_t needed)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="stringfields_8h.html#abb39dc592226a570e6a73f1b9b09b021">ast_string_field</a> __ast_string_field_alloc_space </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__string__field__mgr.html">ast_string_field_mgr</a> *&nbsp;</td>
          <td class="paramname"> <em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__string__field__pool.html">ast_string_field_pool</a> **&nbsp;</td>
          <td class="paramname"> <em>pool_head</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>needed</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="utils_8c_source.html#l01568">1568</a> of file <a class="el" href="utils_8c_source.html">utils.c</a>.</p>

<p>References <a class="el" href="utils_8c_source.html#l01480">add_string_pool()</a>, <a class="el" href="stringfields_8h_source.html#l00140">ast_string_field_mgr::last_alloc</a>, <a class="el" href="stringfields_8h_source.html#l00142">ast_string_field_mgr::owner_file</a>, <a class="el" href="stringfields_8h_source.html#l00143">ast_string_field_mgr::owner_func</a>, <a class="el" href="stringfields_8h_source.html#l00144">ast_string_field_mgr::owner_line</a>, <a class="el" href="stringfields_8h_source.html#l00138">ast_string_field_mgr::size</a>, and <a class="el" href="stringfields_8h_source.html#l00139">ast_string_field_mgr::used</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01570"></a>01570 {
<a name="l01571"></a>01571    <span class="keywordtype">char</span> *result = NULL;
<a name="l01572"></a>01572    <span class="keywordtype">size_t</span> space = mgr-&gt;<a class="code" href="structast__string__field__mgr.html#a854352f53b148adc24983a58a1866d66">size</a> - mgr-&gt;<a class="code" href="structast__string__field__mgr.html#ae8cc011bf3ee2d3c19743095ffc0f7a5">used</a>;
<a name="l01573"></a>01573 
<a name="l01574"></a>01574    <span class="keywordflow">if</span> (__builtin_expect(needed &gt; space, 0)) {
<a name="l01575"></a>01575       <span class="keywordtype">size_t</span> new_size = mgr-&gt;<a class="code" href="structast__string__field__mgr.html#a854352f53b148adc24983a58a1866d66">size</a> * 2;
<a name="l01576"></a>01576 
<a name="l01577"></a>01577       <span class="keywordflow">while</span> (new_size &lt; needed)
<a name="l01578"></a>01578          new_size *= 2;
<a name="l01579"></a>01579 
<a name="l01580"></a>01580 <span class="preprocessor">#if defined(__AST_DEBUG_MALLOC)</span>
<a name="l01581"></a>01581 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="utils_8c.html#ad74eb920d81cc82cbbfe3079b8140530" title="add a new block to the pool. We can only allocate from the topmost pool, so the fields...">add_string_pool</a>(mgr, pool_head, new_size, mgr-&gt;<a class="code" href="structast__string__field__mgr.html#acc76495190eef060bf6cfd862823b4d4">owner_file</a>, mgr-&gt;<a class="code" href="structast__string__field__mgr.html#a09087f8ccb4895ce186313e9154f895f">owner_line</a>, mgr-&gt;<a class="code" href="structast__string__field__mgr.html#a7c862795849b24a961d548682343670f">owner_func</a>))
<a name="l01582"></a>01582          <span class="keywordflow">return</span> NULL;
<a name="l01583"></a>01583 <span class="preprocessor">#else</span>
<a name="l01584"></a>01584 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="utils_8c.html#ad74eb920d81cc82cbbfe3079b8140530" title="add a new block to the pool. We can only allocate from the topmost pool, so the fields...">add_string_pool</a>(mgr, pool_head, new_size, __FILE__, __LINE__, __FUNCTION__))
<a name="l01585"></a>01585          <span class="keywordflow">return</span> NULL;
<a name="l01586"></a>01586 <span class="preprocessor">#endif</span>
<a name="l01587"></a>01587 <span class="preprocessor"></span>   }
<a name="l01588"></a>01588 
<a name="l01589"></a>01589    result = (*pool_head)-&gt;base + mgr-&gt;<a class="code" href="structast__string__field__mgr.html#ae8cc011bf3ee2d3c19743095ffc0f7a5">used</a>;
<a name="l01590"></a>01590    mgr-&gt;<a class="code" href="structast__string__field__mgr.html#ae8cc011bf3ee2d3c19743095ffc0f7a5">used</a> += needed;
<a name="l01591"></a>01591    mgr-&gt;<a class="code" href="structast__string__field__mgr.html#a3c2227ec1356c037606f8639bdefda71">last_alloc</a> = result;
<a name="l01592"></a>01592    <span class="keywordflow">return</span> result;
<a name="l01593"></a>01593 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4e24c6a8b5b6ae53764e6a0e9c313506"></a><!-- doxytag: member="stringfields.h::__ast_string_field_init" ref="a4e24c6a8b5b6ae53764e6a0e9c313506" args="(struct ast_string_field_mgr *mgr, struct ast_string_field_pool **pool_head, int needed, const char *file, int lineno, const char *func)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int __ast_string_field_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__string__field__mgr.html">ast_string_field_mgr</a> *&nbsp;</td>
          <td class="paramname"> <em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__string__field__pool.html">ast_string_field_pool</a> **&nbsp;</td>
          <td class="paramname"> <em>pool_head</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>needed</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>lineno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>func</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="utils_8c_source.html#l01514">1514</a> of file <a class="el" href="utils_8c_source.html">utils.c</a>.</p>

<p>References <a class="el" href="utils_8c_source.html#l01480">add_string_pool()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="stringfields_8h_source.html#l00140">ast_string_field_mgr::last_alloc</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="stringfields_8h_source.html#l00142">ast_string_field_mgr::owner_file</a>, <a class="el" href="stringfields_8h_source.html#l00143">ast_string_field_mgr::owner_func</a>, <a class="el" href="stringfields_8h_source.html#l00144">ast_string_field_mgr::owner_line</a>, <a class="el" href="stringfields_8h_source.html#l00127">ast_string_field_pool::prev</a>, and <a class="el" href="stringfields_8h_source.html#l00139">ast_string_field_mgr::used</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01516"></a>01516 {
<a name="l01517"></a>01517    <span class="keyword">const</span> <span class="keywordtype">char</span> **p = (<span class="keyword">const</span> <span class="keywordtype">char</span> **) pool_head + 1;
<a name="l01518"></a>01518    <span class="keyword">struct </span><a class="code" href="structast__string__field__pool.html">ast_string_field_pool</a> *cur = NULL;
<a name="l01519"></a>01519    <span class="keyword">struct </span><a class="code" href="structast__string__field__pool.html">ast_string_field_pool</a> *preserve = NULL;
<a name="l01520"></a>01520 
<a name="l01521"></a>01521    <span class="comment">/* clear fields - this is always necessary */</span>
<a name="l01522"></a>01522    <span class="keywordflow">while</span> ((<span class="keyword">struct</span> <a class="code" href="structast__string__field__mgr.html">ast_string_field_mgr</a> *) p != mgr)
<a name="l01523"></a>01523       *p++ = <a class="code" href="stringfields_8h.html#abd7963f51b12591f39f99c08277ec41d">__ast_string_field_empty</a>;
<a name="l01524"></a>01524    mgr-&gt;<a class="code" href="structast__string__field__mgr.html#a3c2227ec1356c037606f8639bdefda71">last_alloc</a> = NULL;
<a name="l01525"></a>01525 <span class="preprocessor">#if defined(__AST_DEBUG_MALLOC)</span>
<a name="l01526"></a>01526 <span class="preprocessor"></span>   mgr-&gt;<a class="code" href="structast__string__field__mgr.html#acc76495190eef060bf6cfd862823b4d4">owner_file</a> = file;
<a name="l01527"></a>01527    mgr-&gt;<a class="code" href="structast__string__field__mgr.html#a7c862795849b24a961d548682343670f">owner_func</a> = func;
<a name="l01528"></a>01528    mgr-&gt;<a class="code" href="structast__string__field__mgr.html#a09087f8ccb4895ce186313e9154f895f">owner_line</a> = lineno;
<a name="l01529"></a>01529 <span class="preprocessor">#endif</span>
<a name="l01530"></a>01530 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (needed &gt; 0) {    <span class="comment">/* allocate the initial pool */</span>
<a name="l01531"></a>01531       *pool_head = NULL;
<a name="l01532"></a>01532       <span class="keywordflow">return</span> <a class="code" href="utils_8c.html#ad74eb920d81cc82cbbfe3079b8140530" title="add a new block to the pool. We can only allocate from the topmost pool, so the fields...">add_string_pool</a>(mgr, pool_head, needed, file, lineno, func);
<a name="l01533"></a>01533    }
<a name="l01534"></a>01534    <span class="keywordflow">if</span> (needed &lt; 0) {    <span class="comment">/* reset all pools */</span>
<a name="l01535"></a>01535       <span class="keywordflow">if</span> (*pool_head == NULL) {
<a name="l01536"></a>01536          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;trying to reset empty pool\n&quot;</span>);
<a name="l01537"></a>01537          <span class="keywordflow">return</span> -1;
<a name="l01538"></a>01538       }
<a name="l01539"></a>01539       cur = *pool_head;
<a name="l01540"></a>01540    } <span class="keywordflow">else</span> {       <span class="comment">/* preserve the last pool */</span>
<a name="l01541"></a>01541       <span class="keywordflow">if</span> (*pool_head == NULL) {
<a name="l01542"></a>01542          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;trying to reset empty pool\n&quot;</span>);
<a name="l01543"></a>01543          <span class="keywordflow">return</span> -1;
<a name="l01544"></a>01544       }
<a name="l01545"></a>01545       mgr-&gt;<a class="code" href="structast__string__field__mgr.html#ae8cc011bf3ee2d3c19743095ffc0f7a5">used</a> = 0;
<a name="l01546"></a>01546       preserve = *pool_head;
<a name="l01547"></a>01547       cur = preserve-&gt;<a class="code" href="structast__string__field__pool.html#a5782414ec616579b78d42c79ed254962">prev</a>;
<a name="l01548"></a>01548    }
<a name="l01549"></a>01549 
<a name="l01550"></a>01550    <span class="keywordflow">if</span> (preserve) {
<a name="l01551"></a>01551       preserve-&gt;<a class="code" href="structast__string__field__pool.html#a5782414ec616579b78d42c79ed254962">prev</a> = NULL;
<a name="l01552"></a>01552    }
<a name="l01553"></a>01553 
<a name="l01554"></a>01554    <span class="keywordflow">while</span> (cur) {
<a name="l01555"></a>01555       <span class="keyword">struct </span><a class="code" href="structast__string__field__pool.html">ast_string_field_pool</a> *<a class="code" href="structast__string__field__pool.html#a5782414ec616579b78d42c79ed254962">prev</a> = cur-&gt;<a class="code" href="structast__string__field__pool.html#a5782414ec616579b78d42c79ed254962">prev</a>;
<a name="l01556"></a>01556 
<a name="l01557"></a>01557       <span class="keywordflow">if</span> (cur != preserve) {
<a name="l01558"></a>01558          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(cur);
<a name="l01559"></a>01559       }
<a name="l01560"></a>01560       cur = prev;
<a name="l01561"></a>01561    }
<a name="l01562"></a>01562 
<a name="l01563"></a>01563    *pool_head = preserve;
<a name="l01564"></a>01564 
<a name="l01565"></a>01565    <span class="keywordflow">return</span> 0;
<a name="l01566"></a>01566 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1d75cac4d629dcf89e6fd872206bef58"></a><!-- doxytag: member="stringfields.h::__ast_string_field_ptr_build" ref="a1d75cac4d629dcf89e6fd872206bef58" args="(struct ast_string_field_mgr *mgr, struct ast_string_field_pool **pool_head, ast_string_field *ptr, const char *format,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void __ast_string_field_ptr_build </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__string__field__mgr.html">ast_string_field_mgr</a> *&nbsp;</td>
          <td class="paramname"> <em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__string__field__pool.html">ast_string_field_pool</a> **&nbsp;</td>
          <td class="paramname"> <em>pool_head</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stringfields_8h.html#abb39dc592226a570e6a73f1b9b09b021">ast_string_field</a> *&nbsp;</td>
          <td class="paramname"> <em>ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>...</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="utils_8c_source.html#l01674">1674</a> of file <a class="el" href="utils_8c_source.html">utils.c</a>.</p>

<p>References <a class="el" href="utils_8c_source.html#l01618">__ast_string_field_ptr_build_va()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01677"></a>01677 {
<a name="l01678"></a>01678    va_list ap1, ap2;
<a name="l01679"></a>01679 
<a name="l01680"></a>01680    va_start(ap1, <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>);
<a name="l01681"></a>01681    va_start(ap2, <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>);     <span class="comment">/* va_copy does not exist on FreeBSD */</span>
<a name="l01682"></a>01682 
<a name="l01683"></a>01683    <a class="code" href="stringfields_8h.html#ad98e24bec15ed4b5605f336406cbe370">__ast_string_field_ptr_build_va</a>(mgr, pool_head, ptr, <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>, ap1, ap2);
<a name="l01684"></a>01684 
<a name="l01685"></a>01685    va_end(ap1);
<a name="l01686"></a>01686    va_end(ap2);
<a name="l01687"></a>01687 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad98e24bec15ed4b5605f336406cbe370"></a><!-- doxytag: member="stringfields.h::__ast_string_field_ptr_build_va" ref="ad98e24bec15ed4b5605f336406cbe370" args="(struct ast_string_field_mgr *mgr, struct ast_string_field_pool **pool_head, ast_string_field *ptr, const char *format, va_list a1, va_list a2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void __ast_string_field_ptr_build_va </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__string__field__mgr.html">ast_string_field_mgr</a> *&nbsp;</td>
          <td class="paramname"> <em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__string__field__pool.html">ast_string_field_pool</a> **&nbsp;</td>
          <td class="paramname"> <em>pool_head</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stringfields_8h.html#abb39dc592226a570e6a73f1b9b09b021">ast_string_field</a> *&nbsp;</td>
          <td class="paramname"> <em>ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">va_list&nbsp;</td>
          <td class="paramname"> <em>a1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">va_list&nbsp;</td>
          <td class="paramname"> <em>a2</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="utils_8c_source.html#l01618">1618</a> of file <a class="el" href="utils_8c_source.html">utils.c</a>.</p>

<p>References <a class="el" href="utils_8c_source.html#l01480">add_string_pool()</a>, <a class="el" href="chan__dahdi_8c_source.html#l10640">available()</a>, <a class="el" href="stringfields_8h_source.html#l00140">ast_string_field_mgr::last_alloc</a>, <a class="el" href="stringfields_8h_source.html#l00142">ast_string_field_mgr::owner_file</a>, <a class="el" href="stringfields_8h_source.html#l00143">ast_string_field_mgr::owner_func</a>, <a class="el" href="stringfields_8h_source.html#l00144">ast_string_field_mgr::owner_line</a>, <a class="el" href="stringfields_8h_source.html#l00138">ast_string_field_mgr::size</a>, and <a class="el" href="stringfields_8h_source.html#l00139">ast_string_field_mgr::used</a>.</p>

<p>Referenced by <a class="el" href="utils_8c_source.html#l01674">__ast_string_field_ptr_build()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01621"></a>01621 {
<a name="l01622"></a>01622    <span class="keywordtype">size_t</span> needed;
<a name="l01623"></a>01623    <span class="keywordtype">size_t</span> <a class="code" href="chan__dahdi_8c.html#a305c0e17a1db304e7e5d0a4c39e5d9a4">available</a>;
<a name="l01624"></a>01624    <span class="keywordtype">size_t</span> space = mgr-&gt;<a class="code" href="structast__string__field__mgr.html#a854352f53b148adc24983a58a1866d66">size</a> - mgr-&gt;<a class="code" href="structast__string__field__mgr.html#ae8cc011bf3ee2d3c19743095ffc0f7a5">used</a>;
<a name="l01625"></a>01625    <span class="keywordtype">char</span> *target;
<a name="l01626"></a>01626 
<a name="l01627"></a>01627    <span class="comment">/* if the field already has space allocated, try to reuse it;</span>
<a name="l01628"></a>01628 <span class="comment">      otherwise, use the empty space at the end of the current</span>
<a name="l01629"></a>01629 <span class="comment">      pool</span>
<a name="l01630"></a>01630 <span class="comment">   */</span>
<a name="l01631"></a>01631    <span class="keywordflow">if</span> ((*ptr)[0] != <span class="charliteral">&apos;\0&apos;</span>) {
<a name="l01632"></a>01632       target = (<span class="keywordtype">char</span> *) *ptr;
<a name="l01633"></a>01633       available = strlen(target) + 1;
<a name="l01634"></a>01634    } <span class="keywordflow">else</span> {
<a name="l01635"></a>01635       target = (*pool_head)-&gt;base + mgr-&gt;<a class="code" href="structast__string__field__mgr.html#ae8cc011bf3ee2d3c19743095ffc0f7a5">used</a>;
<a name="l01636"></a>01636       available = space;
<a name="l01637"></a>01637    }
<a name="l01638"></a>01638 
<a name="l01639"></a>01639    needed = vsnprintf(target, available, <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>, ap1) + 1;
<a name="l01640"></a>01640 
<a name="l01641"></a>01641    va_end(ap1);
<a name="l01642"></a>01642 
<a name="l01643"></a>01643    <span class="keywordflow">if</span> (needed &gt; available) {
<a name="l01644"></a>01644       <span class="comment">/* if the space needed can be satisfied by using the current</span>
<a name="l01645"></a>01645 <span class="comment">         pool (which could only occur if we tried to use the field&apos;s</span>
<a name="l01646"></a>01646 <span class="comment">         allocated space and failed), then use that space; otherwise</span>
<a name="l01647"></a>01647 <span class="comment">         allocate a new pool</span>
<a name="l01648"></a>01648 <span class="comment">      */</span>
<a name="l01649"></a>01649       <span class="keywordflow">if</span> (needed &gt; space) {
<a name="l01650"></a>01650          <span class="keywordtype">size_t</span> new_size = mgr-&gt;<a class="code" href="structast__string__field__mgr.html#a854352f53b148adc24983a58a1866d66">size</a> * 2;
<a name="l01651"></a>01651 
<a name="l01652"></a>01652          <span class="keywordflow">while</span> (new_size &lt; needed)
<a name="l01653"></a>01653             new_size *= 2;
<a name="l01654"></a>01654          
<a name="l01655"></a>01655 <span class="preprocessor">#if defined(__AST_DEBUG_MALLOC)</span>
<a name="l01656"></a>01656 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (<a class="code" href="utils_8c.html#ad74eb920d81cc82cbbfe3079b8140530" title="add a new block to the pool. We can only allocate from the topmost pool, so the fields...">add_string_pool</a>(mgr, pool_head, new_size, mgr-&gt;<a class="code" href="structast__string__field__mgr.html#acc76495190eef060bf6cfd862823b4d4">owner_file</a>, mgr-&gt;<a class="code" href="structast__string__field__mgr.html#a09087f8ccb4895ce186313e9154f895f">owner_line</a>, mgr-&gt;<a class="code" href="structast__string__field__mgr.html#a7c862795849b24a961d548682343670f">owner_func</a>))
<a name="l01657"></a>01657             <span class="keywordflow">return</span>;
<a name="l01658"></a>01658 <span class="preprocessor">#else</span>
<a name="l01659"></a>01659 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (<a class="code" href="utils_8c.html#ad74eb920d81cc82cbbfe3079b8140530" title="add a new block to the pool. We can only allocate from the topmost pool, so the fields...">add_string_pool</a>(mgr, pool_head, new_size, NULL, 0, NULL))
<a name="l01660"></a>01660             <span class="keywordflow">return</span>;
<a name="l01661"></a>01661 <span class="preprocessor">#endif</span>
<a name="l01662"></a>01662 <span class="preprocessor"></span>      }
<a name="l01663"></a>01663 
<a name="l01664"></a>01664       target = (*pool_head)-&gt;base + mgr-&gt;<a class="code" href="structast__string__field__mgr.html#ae8cc011bf3ee2d3c19743095ffc0f7a5">used</a>;
<a name="l01665"></a>01665       vsprintf(target, <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>, ap2);
<a name="l01666"></a>01666    }
<a name="l01667"></a>01667 
<a name="l01668"></a>01668    <span class="keywordflow">if</span> (*ptr != target) {
<a name="l01669"></a>01669       mgr-&gt;<a class="code" href="structast__string__field__mgr.html#a3c2227ec1356c037606f8639bdefda71">last_alloc</a> = *ptr = target;
<a name="l01670"></a>01670       mgr-&gt;<a class="code" href="structast__string__field__mgr.html#ae8cc011bf3ee2d3c19743095ffc0f7a5">used</a> += needed;
<a name="l01671"></a>01671    }
<a name="l01672"></a>01672 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac438a66ce99b119c7fb4ee7f787d7232"></a><!-- doxytag: member="stringfields.h::__ast_string_field_ptr_grow" ref="ac438a66ce99b119c7fb4ee7f787d7232" args="(struct ast_string_field_mgr *mgr, size_t needed, const ast_string_field *ptr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int __ast_string_field_ptr_grow </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__string__field__mgr.html">ast_string_field_mgr</a> *&nbsp;</td>
          <td class="paramname"> <em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>needed</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="stringfields_8h.html#abb39dc592226a570e6a73f1b9b09b021">ast_string_field</a> *&nbsp;</td>
          <td class="paramname"> <em>ptr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="utils_8c_source.html#l01595">1595</a> of file <a class="el" href="utils_8c_source.html">utils.c</a>.</p>

<p>References <a class="el" href="stringfields_8h_source.html#l00140">ast_string_field_mgr::last_alloc</a>, <a class="el" href="stringfields_8h_source.html#l00138">ast_string_field_mgr::size</a>, and <a class="el" href="stringfields_8h_source.html#l00139">ast_string_field_mgr::used</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01597"></a>01597 {
<a name="l01598"></a>01598    <span class="keywordtype">int</span> grow = needed - (strlen(*ptr) + 1);
<a name="l01599"></a>01599    <span class="keywordtype">size_t</span> space = mgr-&gt;<a class="code" href="structast__string__field__mgr.html#a854352f53b148adc24983a58a1866d66">size</a> - mgr-&gt;<a class="code" href="structast__string__field__mgr.html#ae8cc011bf3ee2d3c19743095ffc0f7a5">used</a>;
<a name="l01600"></a>01600 
<a name="l01601"></a>01601    <span class="keywordflow">if</span> (grow &lt;= 0) {
<a name="l01602"></a>01602       <span class="keywordflow">return</span> 0;
<a name="l01603"></a>01603    }
<a name="l01604"></a>01604 
<a name="l01605"></a>01605    <span class="keywordflow">if</span> (*ptr != mgr-&gt;<a class="code" href="structast__string__field__mgr.html#a3c2227ec1356c037606f8639bdefda71">last_alloc</a>) {
<a name="l01606"></a>01606       <span class="keywordflow">return</span> 1;
<a name="l01607"></a>01607    }
<a name="l01608"></a>01608 
<a name="l01609"></a>01609    <span class="keywordflow">if</span> (space &lt; grow) {
<a name="l01610"></a>01610       <span class="keywordflow">return</span> 1;
<a name="l01611"></a>01611    }
<a name="l01612"></a>01612 
<a name="l01613"></a>01613    mgr-&gt;<a class="code" href="structast__string__field__mgr.html#ae8cc011bf3ee2d3c19743095ffc0f7a5">used</a> += grow;
<a name="l01614"></a>01614 
<a name="l01615"></a>01615    <span class="keywordflow">return</span> 0;
<a name="l01616"></a>01616 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="abd7963f51b12591f39f99c08277ec41d"></a><!-- doxytag: member="stringfields.h::__ast_string_field_empty" ref="abd7963f51b12591f39f99c08277ec41d" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char <a class="el" href="utils_8c.html#abd7963f51b12591f39f99c08277ec41d">__ast_string_field_empty</a>[]</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>the empty string </p>

<p>Definition at line <a class="el" href="utils_8c_source.html#l01474">1474</a> of file <a class="el" href="utils_8c_source.html">utils.c</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:23:30 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
