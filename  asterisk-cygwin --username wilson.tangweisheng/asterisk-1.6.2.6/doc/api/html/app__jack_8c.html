<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:18:56 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_7739c4bd2a7c382676c2c912043775c7.html">apps</a>
  </div>
</div>
<div class="contents">
<h1>app_jack.c File Reference</h1>
<p>Jack Application.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="asterisk_8h_source.html">asterisk.h</a>&quot;</code><br/>
<code>#include &lt;limits.h&gt;</code><br/>
<code>#include &lt;jack/jack.h&gt;</code><br/>
<code>#include &lt;jack/ringbuffer.h&gt;</code><br/>
<code>#include &lt;libresample.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="module_8h_source.html">asterisk/module.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="channel_8h_source.html">asterisk/channel.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="strings_8h_source.html">asterisk/strings.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="lock_8h_source.html">asterisk/lock.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="app_8h_source.html">asterisk/app.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="pbx_8h_source.html">asterisk/pbx.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="audiohook_8h_source.html">asterisk/audiohook.h</a>&quot;</code><br/>

<p><a href="app__jack_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structjack__data.html">jack_data</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__jack_8c.html#a50523edf90e2250de36f0afcbbc030fb">COMMON_OPTIONS</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Common options between the Jack() app and JACK_HOOK() function.  <a href="#a50523edf90e2250de36f0afcbbc030fb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__jack_8c.html#a9a8cd98aea81dc92b5dc594c5b4056ad">RESAMPLE_QUALITY</a>&nbsp;&nbsp;&nbsp;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__jack_8c.html#a3119c147393ef51aa50af08b3172a358">RINGBUFFER_SIZE</a>&nbsp;&nbsp;&nbsp;16384</td></tr>
<tr><td colspan="2"><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom">{ <br/>
&nbsp;&nbsp;<a class="el" href="app__jack_8c.html#a80155586fa275b28773c9b203f52cabaa2e68c9d2bd481b81a234a923cf259877">OPT_SERVER_NAME</a> =  (1 &lt;&lt; 0), 
<a class="el" href="app__jack_8c.html#a80155586fa275b28773c9b203f52cabaa80be01ac3ad9829dd35ee410e5482dee">OPT_INPUT_PORT</a> =  (1 &lt;&lt; 1), 
<a class="el" href="app__jack_8c.html#a80155586fa275b28773c9b203f52cabaad0daca2a5f287cf652d35aaed1922889">OPT_OUTPUT_PORT</a> =  (1 &lt;&lt; 2), 
<a class="el" href="app__jack_8c.html#a80155586fa275b28773c9b203f52cabaaf8158643a36d2168f796acba3a07676f">OPT_NOSTART_SERVER</a> =  (1 &lt;&lt; 3), 
<br/>
&nbsp;&nbsp;<a class="el" href="app__jack_8c.html#a80155586fa275b28773c9b203f52cabaa11996d3c883f5db7570198567618291d">OPT_CLIENT_NAME</a> =  (1 &lt;&lt; 4)
<br/>
 }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom">{ <br/>
&nbsp;&nbsp;<a class="el" href="app__jack_8c.html#a6b7b47dd702d9e331586d485013fd1eaa093e7df6ef7312d35fb4b03f0c3e7c57">OPT_ARG_SERVER_NAME</a>, 
<a class="el" href="app__jack_8c.html#a6b7b47dd702d9e331586d485013fd1eaac22235513ad8e730ca873c0af182a939">OPT_ARG_INPUT_PORT</a>, 
<a class="el" href="app__jack_8c.html#a6b7b47dd702d9e331586d485013fd1eaa7e5c4987d926a3e4a483ff62d7e76f38">OPT_ARG_OUTPUT_PORT</a>, 
<a class="el" href="app__jack_8c.html#a6b7b47dd702d9e331586d485013fd1eaa03ac82a78b9b7c9a19d8d061580e5809">OPT_ARG_CLIENT_NAME</a>, 
<br/>
&nbsp;&nbsp;<a class="el" href="app__jack_8c.html#a6b7b47dd702d9e331586d485013fd1eaaec7326f60e7edad15d96ff935e5616d6">OPT_ARG_ARRAY_SIZE</a>
<br/>
 }</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__jack_8c.html#ae720b800009d2e672dae3cfaa6476cee">alloc_resampler</a> (struct <a class="el" href="structjack__data.html">jack_data</a> *<a class="el" href="structjack__data.html">jack_data</a>, int input)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__jack_8c.html#a87e273cbb9e422262bc069919b99e893">AST_APP_OPTIONS</a> (jack_exec_options, BEGIN_OPTIONS AST_APP_OPTION_ARG('s', OPT_SERVER_NAME, OPT_ARG_SERVER_NAME), AST_APP_OPTION_ARG('i', OPT_INPUT_PORT, OPT_ARG_INPUT_PORT), AST_APP_OPTION_ARG('o', OPT_OUTPUT_PORT, OPT_ARG_OUTPUT_PORT), AST_APP_OPTION('n', OPT_NOSTART_SERVER), AST_APP_OPTION_ARG('c', OPT_CLIENT_NAME, OPT_ARG_CLIENT_NAME), END_OPTIONS)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__jack_8c.html#a1f3ae8640ad47a8669c8ef6ae7552316">AST_MODULE_INFO_STANDARD</a> (ASTERISK_GPL_KEY,&quot;JACK Interface&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structjack__data.html">jack_data</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__jack_8c.html#a297dcd2c82381f6eb3978edd72625982">destroy_jack_data</a> (struct <a class="el" href="structjack__data.html">jack_data</a> *<a class="el" href="structjack__data.html">jack_data</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__jack_8c.html#a5a55d7d70a6ac23bfbf7db0243c2cb85">disable_jack_hook</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__jack_8c.html#a5fdc965653c1368f1edd9e0b70889c50">enable_jack_hook</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, char *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__jack_8c.html#a5ce9b1108dd9f252031ff2a21e4915fb">handle_input</a> (void *<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, jack_nframes_t nframes, struct <a class="el" href="structjack__data.html">jack_data</a> *<a class="el" href="structjack__data.html">jack_data</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle jack input port.  <a href="#a5ce9b1108dd9f252031ff2a21e4915fb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__jack_8c.html#a953046302272e0bb7ed0c3c654ab40ba">handle_jack_audio</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structjack__data.html">jack_data</a> *<a class="el" href="structjack__data.html">jack_data</a>, struct <a class="el" href="structast__frame.html">ast_frame</a> *out_frame)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">handle jack audio  <a href="#a953046302272e0bb7ed0c3c654ab40ba"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__jack_8c.html#a69c7df2c3f47aef6d50e31a750f8faca">handle_options</a> (struct <a class="el" href="structjack__data.html">jack_data</a> *<a class="el" href="structjack__data.html">jack_data</a>, const char *__options_str)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__jack_8c.html#a343f04835e5cb2cabd569304226c9efa">handle_output</a> (void *<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, jack_nframes_t nframes, struct <a class="el" href="structjack__data.html">jack_data</a> *<a class="el" href="structjack__data.html">jack_data</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle jack output port.  <a href="#a343f04835e5cb2cabd569304226c9efa"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__jack_8c.html#a70868f10224e91e14181fe3d3c4b3fbc">init_jack_data</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structjack__data.html">jack_data</a> *<a class="el" href="structjack__data.html">jack_data</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structjack__data.html">jack_data</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__jack_8c.html#a349dbe766b1a0a00bfb9762f9de469ae">jack_data_alloc</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__jack_8c.html#adb75537a3a7d18f51116423d36f16476">jack_exec</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__jack_8c.html#a86211168f3c8ac014e6caa5cc68a0f8c">jack_hook_callback</a> (struct <a class="el" href="structast__audiohook.html">ast_audiohook</a> *audiohook, struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__frame.html">ast_frame</a> *frame, enum <a class="el" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899">ast_audiohook_direction</a> direction)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__jack_8c.html#a6203a95a3dc09553980fae171c904560">jack_hook_ds_destroy</a> (void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__jack_8c.html#a876ae0646f0e78f0fab18eda01fc1008">jack_hook_write</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *cmd, char *data, const char *value)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__jack_8c.html#a1926aa55b7653ba0edc16abd007a1325">jack_process</a> (jack_nframes_t nframes, void *arg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__jack_8c.html#aa368774daa7b40c1ee97aeab5478974f">jack_shutdown</a> (void *arg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__jack_8c.html#af57abd76ce2df847e98d3cee0fa56921">jack_status_to_str</a> (jack_status_t <a class="el" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__jack_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__jack_8c.html#aafb72b66521b4060855b912d62c7b2ba">log_jack_status</a> (const char *<a class="el" href="res__http__post_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a>, jack_status_t <a class="el" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__jack_8c.html#a01d124d44868b3a2bb4c395405ded087">queue_voice_frame</a> (struct <a class="el" href="structjack__data.html">jack_data</a> *<a class="el" href="structjack__data.html">jack_data</a>, struct <a class="el" href="structast__frame.html">ast_frame</a> *<a class="el" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__jack_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a> (void)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__jack_8c.html#aee6aaf3806d66cc97c27873521cae842">jack_app</a> = &quot;JACK&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__datastore__info.html">ast_datastore_info</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__jack_8c.html#a5b3fe7b11051f242e9f440262863a7c2">jack_hook_ds_info</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__custom__function.html">ast_custom_function</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__jack_8c.html#a6c54514b9e379eddcf31f5f060e81bca">jack_hook_function</a></td></tr>
<tr><td class="memItemLeft" >struct {</td></tr>
<tr><td class="memItemLeft" >&nbsp;&nbsp;&nbsp;jack_status_t&nbsp;&nbsp;&nbsp;<a class="el" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a></td></tr>
<tr><td class="memItemLeft" >&nbsp;&nbsp;&nbsp;const char *&nbsp;&nbsp;&nbsp;<a class="el" href="app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a></td></tr>
<tr><td class="memItemLeft" valign="top">}&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__jack_8c.html#a7b0d5721958172c8cd1741749d9cf629">jack_status_table</a> []</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Jack Application. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Russell Bryant &lt;<a href="mailto:russell@digium.com">russell@digium.com</a>&gt;</dd></dl>
<p>This is an application to connect an Asterisk channel to an input and output jack port so that the audio can be processed through another application, or to play audio from another application.</p>
<ul>
<li><a href="http://www.jackaudio.org/">http://www.jackaudio.org/</a></li>
</ul>
<dl class="note"><dt><b>Note:</b></dt><dd>To install libresample, check it out of the following repository: <code>$ svn co <a href="http://svn.digium.com/svn/thirdparty/libresample/trunk">http://svn.digium.com/svn/thirdparty/libresample/trunk</a></code> </dd></dl>

<p>Definition in file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a50523edf90e2250de36f0afcbbc030fb"></a><!-- doxytag: member="app_jack.c::COMMON_OPTIONS" ref="a50523edf90e2250de36f0afcbbc030fb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define COMMON_OPTIONS</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Common options between the Jack() app and JACK_HOOK() function. </p>

<p>Definition at line <a class="el" href="app__jack_8c_source.html#l00066">66</a> of file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9a8cd98aea81dc92b5dc594c5b4056ad"></a><!-- doxytag: member="app_jack.c::RESAMPLE_QUALITY" ref="a9a8cd98aea81dc92b5dc594c5b4056ad" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RESAMPLE_QUALITY&nbsp;&nbsp;&nbsp;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__jack_8c_source.html#l00061">61</a> of file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>

<p>Referenced by <a class="el" href="app__jack_8c_source.html#l00188">alloc_resampler()</a>.</p>

</div>
</div>
<a class="anchor" id="a3119c147393ef51aa50af08b3172a358"></a><!-- doxytag: member="app_jack.c::RINGBUFFER_SIZE" ref="a3119c147393ef51aa50af08b3172a358" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RINGBUFFER_SIZE&nbsp;&nbsp;&nbsp;16384</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__jack_8c_source.html#l00063">63</a> of file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>

<p>Referenced by <a class="el" href="app__jack_8c_source.html#l00387">init_jack_data()</a>.</p>

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="a80155586fa275b28773c9b203f52caba"></a><!-- doxytag: member="app_jack.c::@17" ref="a80155586fa275b28773c9b203f52caba" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a80155586fa275b28773c9b203f52cabaa2e68c9d2bd481b81a234a923cf259877"></a><!-- doxytag: member="OPT_SERVER_NAME" ref="a80155586fa275b28773c9b203f52cabaa2e68c9d2bd481b81a234a923cf259877" args="" -->OPT_SERVER_NAME</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a80155586fa275b28773c9b203f52cabaa80be01ac3ad9829dd35ee410e5482dee"></a><!-- doxytag: member="OPT_INPUT_PORT" ref="a80155586fa275b28773c9b203f52cabaa80be01ac3ad9829dd35ee410e5482dee" args="" -->OPT_INPUT_PORT</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a80155586fa275b28773c9b203f52cabaad0daca2a5f287cf652d35aaed1922889"></a><!-- doxytag: member="OPT_OUTPUT_PORT" ref="a80155586fa275b28773c9b203f52cabaad0daca2a5f287cf652d35aaed1922889" args="" -->OPT_OUTPUT_PORT</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a80155586fa275b28773c9b203f52cabaaf8158643a36d2168f796acba3a07676f"></a><!-- doxytag: member="OPT_NOSTART_SERVER" ref="a80155586fa275b28773c9b203f52cabaaf8158643a36d2168f796acba3a07676f" args="" -->OPT_NOSTART_SERVER</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a80155586fa275b28773c9b203f52cabaa11996d3c883f5db7570198567618291d"></a><!-- doxytag: member="OPT_CLIENT_NAME" ref="a80155586fa275b28773c9b203f52cabaa11996d3c883f5db7570198567618291d" args="" -->OPT_CLIENT_NAME</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="app__jack_8c_source.html#l00648">648</a> of file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00648"></a>00648      {
<a name="l00649"></a>00649    <a class="code" href="app__jack_8c.html#a80155586fa275b28773c9b203f52cabaa2e68c9d2bd481b81a234a923cf259877">OPT_SERVER_NAME</a> =    (1 &lt;&lt; 0),
<a name="l00650"></a>00650    <a class="code" href="app__jack_8c.html#a80155586fa275b28773c9b203f52cabaa80be01ac3ad9829dd35ee410e5482dee">OPT_INPUT_PORT</a> =     (1 &lt;&lt; 1),
<a name="l00651"></a>00651    <a class="code" href="app__jack_8c.html#a80155586fa275b28773c9b203f52cabaad0daca2a5f287cf652d35aaed1922889">OPT_OUTPUT_PORT</a> =    (1 &lt;&lt; 2),
<a name="l00652"></a>00652    <a class="code" href="app__jack_8c.html#a80155586fa275b28773c9b203f52cabaaf8158643a36d2168f796acba3a07676f">OPT_NOSTART_SERVER</a> = (1 &lt;&lt; 3),
<a name="l00653"></a>00653    <a class="code" href="app__jack_8c.html#a80155586fa275b28773c9b203f52cabaa11996d3c883f5db7570198567618291d">OPT_CLIENT_NAME</a> =    (1 &lt;&lt; 4),
<a name="l00654"></a>00654 };
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6b7b47dd702d9e331586d485013fd1ea"></a><!-- doxytag: member="app_jack.c::@18" ref="a6b7b47dd702d9e331586d485013fd1ea" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a6b7b47dd702d9e331586d485013fd1eaa093e7df6ef7312d35fb4b03f0c3e7c57"></a><!-- doxytag: member="OPT_ARG_SERVER_NAME" ref="a6b7b47dd702d9e331586d485013fd1eaa093e7df6ef7312d35fb4b03f0c3e7c57" args="" -->OPT_ARG_SERVER_NAME</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a6b7b47dd702d9e331586d485013fd1eaac22235513ad8e730ca873c0af182a939"></a><!-- doxytag: member="OPT_ARG_INPUT_PORT" ref="a6b7b47dd702d9e331586d485013fd1eaac22235513ad8e730ca873c0af182a939" args="" -->OPT_ARG_INPUT_PORT</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a6b7b47dd702d9e331586d485013fd1eaa7e5c4987d926a3e4a483ff62d7e76f38"></a><!-- doxytag: member="OPT_ARG_OUTPUT_PORT" ref="a6b7b47dd702d9e331586d485013fd1eaa7e5c4987d926a3e4a483ff62d7e76f38" args="" -->OPT_ARG_OUTPUT_PORT</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a6b7b47dd702d9e331586d485013fd1eaa03ac82a78b9b7c9a19d8d061580e5809"></a><!-- doxytag: member="OPT_ARG_CLIENT_NAME" ref="a6b7b47dd702d9e331586d485013fd1eaa03ac82a78b9b7c9a19d8d061580e5809" args="" -->OPT_ARG_CLIENT_NAME</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a6b7b47dd702d9e331586d485013fd1eaaec7326f60e7edad15d96ff935e5616d6"></a><!-- doxytag: member="OPT_ARG_ARRAY_SIZE" ref="a6b7b47dd702d9e331586d485013fd1eaaec7326f60e7edad15d96ff935e5616d6" args="" -->OPT_ARG_ARRAY_SIZE</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="app__jack_8c_source.html#l00656">656</a> of file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00656"></a>00656      {
<a name="l00657"></a>00657    <a class="code" href="app__jack_8c.html#a6b7b47dd702d9e331586d485013fd1eaa093e7df6ef7312d35fb4b03f0c3e7c57">OPT_ARG_SERVER_NAME</a>,
<a name="l00658"></a>00658    <a class="code" href="app__jack_8c.html#a6b7b47dd702d9e331586d485013fd1eaac22235513ad8e730ca873c0af182a939">OPT_ARG_INPUT_PORT</a>,
<a name="l00659"></a>00659    <a class="code" href="app__jack_8c.html#a6b7b47dd702d9e331586d485013fd1eaa7e5c4987d926a3e4a483ff62d7e76f38">OPT_ARG_OUTPUT_PORT</a>,
<a name="l00660"></a>00660    <a class="code" href="app__jack_8c.html#a6b7b47dd702d9e331586d485013fd1eaa03ac82a78b9b7c9a19d8d061580e5809">OPT_ARG_CLIENT_NAME</a>,
<a name="l00661"></a>00661 
<a name="l00662"></a>00662    <span class="comment">/* Must be the last element */</span>
<a name="l00663"></a>00663    <a class="code" href="app__chanspy_8c.html#a99fb83031ce9923c84392b4e92f956b5aec7326f60e7edad15d96ff935e5616d6">OPT_ARG_ARRAY_SIZE</a>,
<a name="l00664"></a>00664 };
</pre></div></p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ae720b800009d2e672dae3cfaa6476cee"></a><!-- doxytag: member="app_jack.c::alloc_resampler" ref="ae720b800009d2e672dae3cfaa6476cee" args="(struct jack_data *jack_data, int input)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int alloc_resampler </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structjack__data.html">jack_data</a> *&nbsp;</td>
          <td class="paramname"> <em>jack_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>input</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__jack_8c_source.html#l00188">188</a> of file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="app__jack_8c_source.html#l00124">jack_data::client</a>, <a class="el" href="app__jack_8c_source.html#l00132">jack_data::input_resample_factor</a>, <a class="el" href="app__jack_8c_source.html#l00131">jack_data::input_resampler</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="app__jack_8c_source.html#l00130">jack_data::output_resample_factor</a>, <a class="el" href="app__jack_8c_source.html#l00129">jack_data::output_resampler</a>, and <a class="el" href="app__jack_8c_source.html#l00061">RESAMPLE_QUALITY</a>.</p>

<p>Referenced by <a class="el" href="app__jack_8c_source.html#l00316">jack_process()</a>, and <a class="el" href="app__jack_8c_source.html#l00515">queue_voice_frame()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00189"></a>00189 {
<a name="l00190"></a>00190    <span class="keywordtype">double</span> from_srate, to_srate, jack_srate;
<a name="l00191"></a>00191    <span class="keywordtype">void</span> **resampler;
<a name="l00192"></a>00192    <span class="keywordtype">double</span> *resample_factor;
<a name="l00193"></a>00193 
<a name="l00194"></a>00194    <span class="keywordflow">if</span> (<a class="code" href="ast__expr2f_8c.html#a5a634cf4429798b1c921a81de8250051">input</a> &amp;&amp; jack_data-&gt;<a class="code" href="structjack__data.html#a41dc9f75ead42d9a6f0d266bab405621">input_resampler</a>)
<a name="l00195"></a>00195       <span class="keywordflow">return</span> 0;
<a name="l00196"></a>00196 
<a name="l00197"></a>00197    <span class="keywordflow">if</span> (!<a class="code" href="ast__expr2f_8c.html#a5a634cf4429798b1c921a81de8250051">input</a> &amp;&amp; jack_data-&gt;<a class="code" href="structjack__data.html#a7f0419971318dac4b9bc6682ebf24768">output_resampler</a>)
<a name="l00198"></a>00198       <span class="keywordflow">return</span> 0;
<a name="l00199"></a>00199 
<a name="l00200"></a>00200    jack_srate = jack_get_sample_rate(jack_data-&gt;<a class="code" href="structjack__data.html#afed7053cd7bdd1cce33dec7213f340ea">client</a>);
<a name="l00201"></a>00201 
<a name="l00202"></a>00202    <span class="comment">/* XXX Hard coded 8 kHz */</span>
<a name="l00203"></a>00203 
<a name="l00204"></a>00204    to_srate = <a class="code" href="ast__expr2f_8c.html#a5a634cf4429798b1c921a81de8250051">input</a> ? 8000.0 : jack_srate; 
<a name="l00205"></a>00205    from_srate = <a class="code" href="ast__expr2f_8c.html#a5a634cf4429798b1c921a81de8250051">input</a> ? jack_srate : 8000.0;
<a name="l00206"></a>00206 
<a name="l00207"></a>00207    resample_factor = <a class="code" href="ast__expr2f_8c.html#a5a634cf4429798b1c921a81de8250051">input</a> ? &amp;jack_data-&gt;<a class="code" href="structjack__data.html#a6271c2db9aa01f38587b22325a88ea9d">input_resample_factor</a> : 
<a name="l00208"></a>00208       &amp;jack_data-&gt;<a class="code" href="structjack__data.html#a1779a34e43822abc58b50a09b2a06de0">output_resample_factor</a>;
<a name="l00209"></a>00209 
<a name="l00210"></a>00210    <span class="keywordflow">if</span> (from_srate == to_srate) {
<a name="l00211"></a>00211       <span class="comment">/* Awesome!  The jack sample rate is the same as ours.</span>
<a name="l00212"></a>00212 <span class="comment">       * Resampling isn&apos;t needed. */</span>
<a name="l00213"></a>00213       *resample_factor = 1.0;
<a name="l00214"></a>00214       <span class="keywordflow">return</span> 0;
<a name="l00215"></a>00215    }
<a name="l00216"></a>00216 
<a name="l00217"></a>00217    *resample_factor = to_srate / from_srate;
<a name="l00218"></a>00218 
<a name="l00219"></a>00219    resampler = <a class="code" href="ast__expr2f_8c.html#a5a634cf4429798b1c921a81de8250051">input</a> ? &amp;jack_data-&gt;<a class="code" href="structjack__data.html#a41dc9f75ead42d9a6f0d266bab405621">input_resampler</a> :
<a name="l00220"></a>00220       &amp;jack_data-&gt;<a class="code" href="structjack__data.html#a7f0419971318dac4b9bc6682ebf24768">output_resampler</a>;
<a name="l00221"></a>00221 
<a name="l00222"></a>00222    <span class="keywordflow">if</span> (!(*resampler = resample_open(<a class="code" href="app__jack_8c.html#a9a8cd98aea81dc92b5dc594c5b4056ad">RESAMPLE_QUALITY</a>, 
<a name="l00223"></a>00223       *resample_factor, *resample_factor))) {
<a name="l00224"></a>00224       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to open %s resampler\n&quot;</span>, 
<a name="l00225"></a>00225          <a class="code" href="ast__expr2f_8c.html#a5a634cf4429798b1c921a81de8250051">input</a> ? <span class="stringliteral">&quot;input&quot;</span> : <span class="stringliteral">&quot;output&quot;</span>);
<a name="l00226"></a>00226       <span class="keywordflow">return</span> -1;
<a name="l00227"></a>00227    }
<a name="l00228"></a>00228 
<a name="l00229"></a>00229    <span class="keywordflow">return</span> 0;
<a name="l00230"></a>00230 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a87e273cbb9e422262bc069919b99e893"></a><!-- doxytag: member="app_jack.c::AST_APP_OPTIONS" ref="a87e273cbb9e422262bc069919b99e893" args="(jack_exec_options, BEGIN_OPTIONS AST_APP_OPTION_ARG('s', OPT_SERVER_NAME, OPT_ARG_SERVER_NAME), AST_APP_OPTION_ARG('i', OPT_INPUT_PORT, OPT_ARG_INPUT_PORT), AST_APP_OPTION_ARG('o', OPT_OUTPUT_PORT, OPT_ARG_OUTPUT_PORT), AST_APP_OPTION('n', OPT_NOSTART_SERVER), AST_APP_OPTION_ARG('c', OPT_CLIENT_NAME, OPT_ARG_CLIENT_NAME), END_OPTIONS)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AST_APP_OPTIONS </td>
          <td>(</td>
          <td class="paramtype">jack_exec_options&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BEGIN_OPTIONS &nbsp;</td>
          <td class="paramname"> <em>AST_APP_OPTION_ARG</em>'s', OPT_SERVER_NAME, OPT_ARG_SERVER_NAME, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">AST_APP_OPTION_ARG('i', OPT_INPUT_PORT, OPT_ARG_INPUT_PORT)&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">AST_APP_OPTION_ARG('o', OPT_OUTPUT_PORT, OPT_ARG_OUTPUT_PORT)&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">AST_APP_OPTION('n', OPT_NOSTART_SERVER)&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">AST_APP_OPTION_ARG('c', OPT_CLIENT_NAME, OPT_ARG_CLIENT_NAME)&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">END_OPTIONS&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a1f3ae8640ad47a8669c8ef6ae7552316"></a><!-- doxytag: member="app_jack.c::AST_MODULE_INFO_STANDARD" ref="a1f3ae8640ad47a8669c8ef6ae7552316" args="(ASTERISK_GPL_KEY,&quot;JACK Interface&quot;)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AST_MODULE_INFO_STANDARD </td>
          <td>(</td>
          <td class="paramtype">ASTERISK_GPL_KEY&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;JACK Interface&quot;&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a297dcd2c82381f6eb3978edd72625982"></a><!-- doxytag: member="app_jack.c::destroy_jack_data" ref="a297dcd2c82381f6eb3978edd72625982" args="(struct jack_data *jack_data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structjack__data.html">jack_data</a>* destroy_jack_data </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structjack__data.html">jack_data</a> *&nbsp;</td>
          <td class="paramname"> <em>jack_data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__jack_8c_source.html#l00340">340</a> of file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>

<p>References <a class="el" href="audiohook_8c_source.html#l00091">ast_audiohook_destroy()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="stringfields_8h_source.html#l00245">ast_string_field_free_memory</a>, <a class="el" href="app__jack_8c_source.html#l00137">jack_data::audiohook</a>, <a class="el" href="app__jack_8c_source.html#l00124">jack_data::client</a>, <a class="el" href="app__jack_8c_source.html#l00134">jack_data::has_audiohook</a>, <a class="el" href="app__jack_8c_source.html#l00125">jack_data::input_port</a>, <a class="el" href="app__jack_8c_source.html#l00127">jack_data::input_rb</a>, <a class="el" href="app__jack_8c_source.html#l00131">jack_data::input_resampler</a>, <a class="el" href="app__jack_8c_source.html#l00126">jack_data::output_port</a>, <a class="el" href="app__jack_8c_source.html#l00128">jack_data::output_rb</a>, and <a class="el" href="app__jack_8c_source.html#l00129">jack_data::output_resampler</a>.</p>

<p>Referenced by <a class="el" href="app__jack_8c_source.html#l00859">enable_jack_hook()</a>, <a class="el" href="app__jack_8c_source.html#l00743">jack_exec()</a>, and <a class="el" href="app__jack_8c_source.html#l00807">jack_hook_ds_destroy()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00341"></a>00341 {
<a name="l00342"></a>00342    <span class="keywordflow">if</span> (jack_data-&gt;<a class="code" href="structjack__data.html#af830efb2d3206ba81602df7945863a2d">input_port</a>) {
<a name="l00343"></a>00343       jack_port_unregister(jack_data-&gt;<a class="code" href="structjack__data.html#afed7053cd7bdd1cce33dec7213f340ea">client</a>, jack_data-&gt;<a class="code" href="structjack__data.html#af830efb2d3206ba81602df7945863a2d">input_port</a>);
<a name="l00344"></a>00344       jack_data-&gt;<a class="code" href="structjack__data.html#af830efb2d3206ba81602df7945863a2d">input_port</a> = NULL;
<a name="l00345"></a>00345    }
<a name="l00346"></a>00346 
<a name="l00347"></a>00347    <span class="keywordflow">if</span> (jack_data-&gt;<a class="code" href="structjack__data.html#a163b2d99fab30f4f80d37b8e5fe6a9a2">output_port</a>) {
<a name="l00348"></a>00348       jack_port_unregister(jack_data-&gt;<a class="code" href="structjack__data.html#afed7053cd7bdd1cce33dec7213f340ea">client</a>, jack_data-&gt;<a class="code" href="structjack__data.html#a163b2d99fab30f4f80d37b8e5fe6a9a2">output_port</a>);
<a name="l00349"></a>00349       jack_data-&gt;<a class="code" href="structjack__data.html#a163b2d99fab30f4f80d37b8e5fe6a9a2">output_port</a> = NULL;
<a name="l00350"></a>00350    }
<a name="l00351"></a>00351 
<a name="l00352"></a>00352    <span class="keywordflow">if</span> (jack_data-&gt;<a class="code" href="structjack__data.html#afed7053cd7bdd1cce33dec7213f340ea">client</a>) {
<a name="l00353"></a>00353       jack_client_close(jack_data-&gt;<a class="code" href="structjack__data.html#afed7053cd7bdd1cce33dec7213f340ea">client</a>);
<a name="l00354"></a>00354       jack_data-&gt;<a class="code" href="structjack__data.html#afed7053cd7bdd1cce33dec7213f340ea">client</a> = NULL;
<a name="l00355"></a>00355    }
<a name="l00356"></a>00356 
<a name="l00357"></a>00357    <span class="keywordflow">if</span> (jack_data-&gt;<a class="code" href="structjack__data.html#a0ef8a9cb712a596b344f3e4b6405daa3">input_rb</a>) {
<a name="l00358"></a>00358       jack_ringbuffer_free(jack_data-&gt;<a class="code" href="structjack__data.html#a0ef8a9cb712a596b344f3e4b6405daa3">input_rb</a>);
<a name="l00359"></a>00359       jack_data-&gt;<a class="code" href="structjack__data.html#a0ef8a9cb712a596b344f3e4b6405daa3">input_rb</a> = NULL;
<a name="l00360"></a>00360    }
<a name="l00361"></a>00361 
<a name="l00362"></a>00362    <span class="keywordflow">if</span> (jack_data-&gt;<a class="code" href="structjack__data.html#a77f80958d20ee20d2fbbacf85b17a588">output_rb</a>) {
<a name="l00363"></a>00363       jack_ringbuffer_free(jack_data-&gt;<a class="code" href="structjack__data.html#a77f80958d20ee20d2fbbacf85b17a588">output_rb</a>);
<a name="l00364"></a>00364       jack_data-&gt;<a class="code" href="structjack__data.html#a77f80958d20ee20d2fbbacf85b17a588">output_rb</a> = NULL;
<a name="l00365"></a>00365    }
<a name="l00366"></a>00366 
<a name="l00367"></a>00367    <span class="keywordflow">if</span> (jack_data-&gt;<a class="code" href="structjack__data.html#a7f0419971318dac4b9bc6682ebf24768">output_resampler</a>) {
<a name="l00368"></a>00368       resample_close(jack_data-&gt;<a class="code" href="structjack__data.html#a7f0419971318dac4b9bc6682ebf24768">output_resampler</a>);
<a name="l00369"></a>00369       jack_data-&gt;<a class="code" href="structjack__data.html#a7f0419971318dac4b9bc6682ebf24768">output_resampler</a> = NULL;
<a name="l00370"></a>00370    }
<a name="l00371"></a>00371    
<a name="l00372"></a>00372    <span class="keywordflow">if</span> (jack_data-&gt;<a class="code" href="structjack__data.html#a41dc9f75ead42d9a6f0d266bab405621">input_resampler</a>) {
<a name="l00373"></a>00373       resample_close(jack_data-&gt;<a class="code" href="structjack__data.html#a41dc9f75ead42d9a6f0d266bab405621">input_resampler</a>);
<a name="l00374"></a>00374       jack_data-&gt;<a class="code" href="structjack__data.html#a41dc9f75ead42d9a6f0d266bab405621">input_resampler</a> = NULL;
<a name="l00375"></a>00375    }
<a name="l00376"></a>00376 
<a name="l00377"></a>00377    <span class="keywordflow">if</span> (jack_data-&gt;<a class="code" href="structjack__data.html#acc7a4aecf4d9e0ebfd9d541d6a20a029">has_audiohook</a>)
<a name="l00378"></a>00378       <a class="code" href="audiohook_8h.html#a9fa661730d6fa6b9b12e410d66a3437b" title="Destroys an audiohook structure.">ast_audiohook_destroy</a>(&amp;jack_data-&gt;<a class="code" href="structjack__data.html#aaf5379c0defdcacdae37add0d0c8af1d">audiohook</a>);
<a name="l00379"></a>00379 
<a name="l00380"></a>00380    <a class="code" href="stringfields_8h.html#abf60f862ae6a141d2f86a0f5e82792de" title="free all memory - to be called before destroying the object">ast_string_field_free_memory</a>(jack_data);
<a name="l00381"></a>00381 
<a name="l00382"></a>00382    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(jack_data);
<a name="l00383"></a>00383 
<a name="l00384"></a>00384    <span class="keywordflow">return</span> NULL;
<a name="l00385"></a>00385 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5a55d7d70a6ac23bfbf7db0243c2cb85"></a><!-- doxytag: member="app_jack.c::disable_jack_hook" ref="a5a55d7d70a6ac23bfbf7db0243c2cb85" args="(struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int disable_jack_hook </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__jack_8c_source.html#l00920">920</a> of file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>

<p>References <a class="el" href="audiohook_8c_source.html#l00383">ast_audiohook_detach()</a>, <a class="el" href="channel_8c_source.html#l01548">ast_channel_datastore_find()</a>, <a class="el" href="channel_8c_source.html#l01543">ast_channel_datastore_remove()</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="datastore_8c_source.html#l00058">ast_datastore_free()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="app__jack_8c_source.html#l00137">jack_data::audiohook</a>, <a class="el" href="datastore_8h_source.html#l00056">ast_datastore::data</a>, and <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>.</p>

<p>Referenced by <a class="el" href="app__jack_8c_source.html#l00948">jack_hook_write()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00921"></a>00921 {
<a name="l00922"></a>00922    <span class="keyword">struct </span><a class="code" href="structast__datastore.html" title="Structure for a data store object.">ast_datastore</a> *datastore;
<a name="l00923"></a>00923    <span class="keyword">struct </span><a class="code" href="structjack__data.html">jack_data</a> *<a class="code" href="structjack__data.html">jack_data</a>;
<a name="l00924"></a>00924 
<a name="l00925"></a>00925    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l00926"></a>00926 
<a name="l00927"></a>00927    <span class="keywordflow">if</span> (!(datastore = <a class="code" href="channel_8h.html#aad1e09cd7c79237d05cffb45d6cdfd7c" title="Find a datastore on a channel.">ast_channel_datastore_find</a>(chan, &amp;<a class="code" href="app__jack_8c.html#a5b3fe7b11051f242e9f440262863a7c2">jack_hook_ds_info</a>, NULL))) {
<a name="l00928"></a>00928       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l00929"></a>00929       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No JACK_HOOK found to disable\n&quot;</span>);
<a name="l00930"></a>00930       <span class="keywordflow">return</span> -1;
<a name="l00931"></a>00931    }
<a name="l00932"></a>00932 
<a name="l00933"></a>00933    <a class="code" href="channel_8h.html#a1ff1c62b6d50823da93a920575c9c0c9" title="Remove a datastore from a channel.">ast_channel_datastore_remove</a>(chan, datastore);
<a name="l00934"></a>00934 
<a name="l00935"></a>00935    jack_data = datastore-&gt;<a class="code" href="structast__datastore.html#a735984d41155bc1032e09bece8f8d66d">data</a>;
<a name="l00936"></a>00936    <a class="code" href="audiohook_8h.html#a88b9ad3730e7adbc3b396bef4e85b12a" title="Detach audiohook from channel.">ast_audiohook_detach</a>(&amp;jack_data-&gt;<a class="code" href="structjack__data.html#aaf5379c0defdcacdae37add0d0c8af1d">audiohook</a>);
<a name="l00937"></a>00937 
<a name="l00938"></a>00938    <span class="comment">/* Keep the channel locked while we destroy the datastore, so that we can</span>
<a name="l00939"></a>00939 <span class="comment">    * ensure that all of the jack stuff is stopped just in case another frame</span>
<a name="l00940"></a>00940 <span class="comment">    * tries to come through the audiohook callback. */</span>
<a name="l00941"></a>00941    <a class="code" href="datastore_8h.html#aee27286888b30c6448a9bce928040a14" title="Free a data store object.">ast_datastore_free</a>(datastore);
<a name="l00942"></a>00942 
<a name="l00943"></a>00943    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l00944"></a>00944 
<a name="l00945"></a>00945    <span class="keywordflow">return</span> 0;
<a name="l00946"></a>00946 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5fdc965653c1368f1edd9e0b70889c50"></a><!-- doxytag: member="app_jack.c::enable_jack_hook" ref="a5fdc965653c1368f1edd9e0b70889c50" args="(struct ast_channel *chan, char *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int enable_jack_hook </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__jack_8c_source.html#l00859">859</a> of file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>

<p>References <a class="el" href="app_8h_source.html#l00338">AST_APP_ARG</a>, <a class="el" href="audiohook_8c_source.html#l00330">ast_audiohook_attach()</a>, <a class="el" href="audiohook_8c_source.html#l00060">ast_audiohook_init()</a>, <a class="el" href="audiohook_8h_source.html#l00039">AST_AUDIOHOOK_TYPE_MANIPULATE</a>, <a class="el" href="channel_8c_source.html#l01534">ast_channel_datastore_add()</a>, <a class="el" href="channel_8c_source.html#l01548">ast_channel_datastore_find()</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="datastore_8h_source.html#l00071">ast_datastore_alloc</a>, <a class="el" href="app_8h_source.html#l00355">AST_DECLARE_APP_ARGS</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="app_8h_source.html#l00387">AST_STANDARD_APP_ARGS</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="app__jack_8c_source.html#l00137">jack_data::audiohook</a>, <a class="el" href="datastore_8h_source.html#l00056">ast_datastore::data</a>, <a class="el" href="app__jack_8c_source.html#l00340">destroy_jack_data()</a>, <a class="el" href="app__jack_8c_source.html#l00692">handle_options()</a>, <a class="el" href="app__jack_8c_source.html#l00134">jack_data::has_audiohook</a>, <a class="el" href="app__jack_8c_source.html#l00387">init_jack_data()</a>, <a class="el" href="app__jack_8c_source.html#l00674">jack_data_alloc()</a>, <a class="el" href="app__jack_8c_source.html#l00819">jack_hook_callback()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="audiohook_8h_source.html#l00100">ast_audiohook::manipulate_callback</a>, and <a class="el" href="strings_8h_source.html#l00072">S_OR</a>.</p>

<p>Referenced by <a class="el" href="app__jack_8c_source.html#l00948">jack_hook_write()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00860"></a>00860 {
<a name="l00861"></a>00861    <span class="keyword">struct </span><a class="code" href="structast__datastore.html" title="Structure for a data store object.">ast_datastore</a> *datastore;
<a name="l00862"></a>00862    <span class="keyword">struct </span><a class="code" href="structjack__data.html">jack_data</a> *<a class="code" href="structjack__data.html">jack_data</a> = NULL;
<a name="l00863"></a>00863    <a class="code" href="app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2" title="Declare a structure to hold an application&amp;#39;s arguments.">AST_DECLARE_APP_ARGS</a>(args,
<a name="l00864"></a>00864       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(mode);
<a name="l00865"></a>00865       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(options);
<a name="l00866"></a>00866    );
<a name="l00867"></a>00867 
<a name="l00868"></a>00868    <a class="code" href="app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8" title="Performs the &amp;#39;standard&amp;#39; argument separation process for an application.">AST_STANDARD_APP_ARGS</a>(args, data);
<a name="l00869"></a>00869 
<a name="l00870"></a>00870    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l00871"></a>00871 
<a name="l00872"></a>00872    <span class="keywordflow">if</span> ((datastore = <a class="code" href="channel_8h.html#aad1e09cd7c79237d05cffb45d6cdfd7c" title="Find a datastore on a channel.">ast_channel_datastore_find</a>(chan, &amp;<a class="code" href="app__jack_8c.html#a5b3fe7b11051f242e9f440262863a7c2">jack_hook_ds_info</a>, NULL))) {
<a name="l00873"></a>00873       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;JACK_HOOK already enabled for &apos;%s&apos;\n&quot;</span>, chan-&gt;name);
<a name="l00874"></a>00874       <span class="keywordflow">goto</span> return_error;
<a name="l00875"></a>00875    }
<a name="l00876"></a>00876 
<a name="l00877"></a>00877    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(args.mode) || strcasecmp(args.mode, <span class="stringliteral">&quot;manipulate&quot;</span>)) {
<a name="l00878"></a>00878       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;&apos;%s&apos; is not a supported mode.  Only manipulate is supported.\n&quot;</span>, 
<a name="l00879"></a>00879          <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(args.mode, <span class="stringliteral">&quot;&lt;none&gt;&quot;</span>));
<a name="l00880"></a>00880       <span class="keywordflow">goto</span> return_error;
<a name="l00881"></a>00881    }
<a name="l00882"></a>00882 
<a name="l00883"></a>00883    <span class="keywordflow">if</span> (!(jack_data = <a class="code" href="app__jack_8c.html#a349dbe766b1a0a00bfb9762f9de469ae">jack_data_alloc</a>()))
<a name="l00884"></a>00884       <span class="keywordflow">goto</span> return_error;
<a name="l00885"></a>00885 
<a name="l00886"></a>00886    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(args.options) &amp;&amp; <a class="code" href="app__jack_8c.html#a69c7df2c3f47aef6d50e31a750f8faca">handle_options</a>(jack_data, args.options))
<a name="l00887"></a>00887       <span class="keywordflow">goto</span> return_error;
<a name="l00888"></a>00888 
<a name="l00889"></a>00889    <span class="keywordflow">if</span> (<a class="code" href="app__jack_8c.html#a70868f10224e91e14181fe3d3c4b3fbc">init_jack_data</a>(chan, jack_data))
<a name="l00890"></a>00890       <span class="keywordflow">goto</span> return_error;
<a name="l00891"></a>00891 
<a name="l00892"></a>00892    <span class="keywordflow">if</span> (!(datastore = <a class="code" href="datastore_8h.html#a666afb07fd77d50782cc10f83e029159">ast_datastore_alloc</a>(&amp;<a class="code" href="app__jack_8c.html#a5b3fe7b11051f242e9f440262863a7c2">jack_hook_ds_info</a>, NULL)))
<a name="l00893"></a>00893       <span class="keywordflow">goto</span> return_error;
<a name="l00894"></a>00894 
<a name="l00895"></a>00895    jack_data-&gt;<a class="code" href="structjack__data.html#acc7a4aecf4d9e0ebfd9d541d6a20a029">has_audiohook</a> = 1;
<a name="l00896"></a>00896    <a class="code" href="audiohook_8h.html#a94bd83e9f3444f406174971481b862c2" title="Initialize an audiohook structure.">ast_audiohook_init</a>(&amp;jack_data-&gt;<a class="code" href="structjack__data.html#aaf5379c0defdcacdae37add0d0c8af1d">audiohook</a>, <a class="code" href="audiohook_8h.html#abce1d2faae234aa016905215014542b0a20dda44508f42e63dc8ed45760affe08">AST_AUDIOHOOK_TYPE_MANIPULATE</a>, <span class="stringliteral">&quot;JACK_HOOK&quot;</span>);
<a name="l00897"></a>00897    jack_data-&gt;<a class="code" href="structjack__data.html#aaf5379c0defdcacdae37add0d0c8af1d">audiohook</a>.<a class="code" href="structast__audiohook.html#a4592709f9cf7b13798a0afcafbd96893">manipulate_callback</a> = <a class="code" href="app__jack_8c.html#a86211168f3c8ac014e6caa5cc68a0f8c">jack_hook_callback</a>;
<a name="l00898"></a>00898 
<a name="l00899"></a>00899    datastore-&gt;<a class="code" href="structast__datastore.html#a735984d41155bc1032e09bece8f8d66d">data</a> = jack_data;
<a name="l00900"></a>00900 
<a name="l00901"></a>00901    <span class="keywordflow">if</span> (<a class="code" href="audiohook_8h.html#a94abfad20db137f9d6a33f641d37ac31" title="Attach audiohook to channel.">ast_audiohook_attach</a>(chan, &amp;jack_data-&gt;<a class="code" href="structjack__data.html#aaf5379c0defdcacdae37add0d0c8af1d">audiohook</a>))
<a name="l00902"></a>00902       <span class="keywordflow">goto</span> return_error;
<a name="l00903"></a>00903 
<a name="l00904"></a>00904    <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a1ed3e98d33d5587948a0e2ef67a81f52" title="Add a datastore to a channel.">ast_channel_datastore_add</a>(chan, datastore))
<a name="l00905"></a>00905       <span class="keywordflow">goto</span> return_error;
<a name="l00906"></a>00906 
<a name="l00907"></a>00907    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l00908"></a>00908 
<a name="l00909"></a>00909    <span class="keywordflow">return</span> 0;
<a name="l00910"></a>00910 
<a name="l00911"></a>00911 return_error:
<a name="l00912"></a>00912    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l00913"></a>00913 
<a name="l00914"></a>00914    <span class="keywordflow">if</span> (jack_data)
<a name="l00915"></a>00915       <a class="code" href="app__jack_8c.html#a297dcd2c82381f6eb3978edd72625982">destroy_jack_data</a>(jack_data);
<a name="l00916"></a>00916 
<a name="l00917"></a>00917    <span class="keywordflow">return</span> -1;
<a name="l00918"></a>00918 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5ce9b1108dd9f252031ff2a21e4915fb"></a><!-- doxytag: member="app_jack.c::handle_input" ref="a5ce9b1108dd9f252031ff2a21e4915fb" args="(void *buf, jack_nframes_t nframes, struct jack_data *jack_data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void handle_input </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">jack_nframes_t&nbsp;</td>
          <td class="paramname"> <em>nframes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structjack__data.html">jack_data</a> *&nbsp;</td>
          <td class="paramname"> <em>jack_data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handle jack input port. </p>
<p>Read nframes <a class="el" href="structnumber.html" title="Number structure.">number</a> of samples from the input buffer, resample it if necessary, and write it into the appropriate ringbuffer. </p>

<p>Definition at line <a class="el" href="app__jack_8c_source.html#l00238">238</a> of file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="app__jack_8c_source.html#l00127">jack_data::input_rb</a>, <a class="el" href="app__jack_8c_source.html#l00132">jack_data::input_resample_factor</a>, <a class="el" href="app__jack_8c_source.html#l00131">jack_data::input_resampler</a>, and <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>.</p>

<p>Referenced by <a class="el" href="app__jack_8c_source.html#l00316">jack_process()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00240"></a>00240 {
<a name="l00241"></a>00241    <span class="keywordtype">short</span> s_buf[nframes];
<a name="l00242"></a>00242    <span class="keywordtype">float</span> *in_buf = <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>;
<a name="l00243"></a>00243    <span class="keywordtype">size_t</span> res;
<a name="l00244"></a>00244    <span class="keywordtype">int</span> i;
<a name="l00245"></a>00245    <span class="keywordtype">size_t</span> write_len = <span class="keyword">sizeof</span>(s_buf);
<a name="l00246"></a>00246 
<a name="l00247"></a>00247    <span class="keywordflow">if</span> (jack_data-&gt;<a class="code" href="structjack__data.html#a41dc9f75ead42d9a6f0d266bab405621">input_resampler</a>) {
<a name="l00248"></a>00248       <span class="keywordtype">int</span> total_in_buf_used = 0;
<a name="l00249"></a>00249       <span class="keywordtype">int</span> total_out_buf_used = 0;
<a name="l00250"></a>00250       <span class="keywordtype">float</span> f_buf[nframes + 1];
<a name="l00251"></a>00251 
<a name="l00252"></a>00252       memset(f_buf, 0, <span class="keyword">sizeof</span>(f_buf));
<a name="l00253"></a>00253 
<a name="l00254"></a>00254       <span class="keywordflow">while</span> (total_in_buf_used &lt; nframes) {
<a name="l00255"></a>00255          <span class="keywordtype">int</span> in_buf_used;
<a name="l00256"></a>00256          <span class="keywordtype">int</span> out_buf_used;
<a name="l00257"></a>00257 
<a name="l00258"></a>00258          out_buf_used = resample_process(jack_data-&gt;<a class="code" href="structjack__data.html#a41dc9f75ead42d9a6f0d266bab405621">input_resampler</a>,
<a name="l00259"></a>00259             jack_data-&gt;<a class="code" href="structjack__data.html#a6271c2db9aa01f38587b22325a88ea9d">input_resample_factor</a>,
<a name="l00260"></a>00260             &amp;in_buf[total_in_buf_used], nframes - total_in_buf_used,
<a name="l00261"></a>00261             0, &amp;in_buf_used,
<a name="l00262"></a>00262             &amp;f_buf[total_out_buf_used], <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(f_buf) - total_out_buf_used);
<a name="l00263"></a>00263 
<a name="l00264"></a>00264          <span class="keywordflow">if</span> (out_buf_used &lt; 0)
<a name="l00265"></a>00265             <span class="keywordflow">break</span>;
<a name="l00266"></a>00266 
<a name="l00267"></a>00267          total_out_buf_used += out_buf_used;
<a name="l00268"></a>00268          total_in_buf_used += in_buf_used;
<a name="l00269"></a>00269    
<a name="l00270"></a>00270          <span class="keywordflow">if</span> (total_out_buf_used == <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(f_buf)) {
<a name="l00271"></a>00271             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Output buffer filled ... need to increase its size, &quot;</span>
<a name="l00272"></a>00272                <span class="stringliteral">&quot;nframes &apos;%d&apos;, total_out_buf_used &apos;%d&apos;\n&quot;</span>, nframes, total_out_buf_used);
<a name="l00273"></a>00273             <span class="keywordflow">break</span>;
<a name="l00274"></a>00274          }
<a name="l00275"></a>00275       }
<a name="l00276"></a>00276 
<a name="l00277"></a>00277       <span class="keywordflow">for</span> (i = 0; i &lt; total_out_buf_used; i++)
<a name="l00278"></a>00278          s_buf[i] = f_buf[i] * (SHRT_MAX / 1.0);
<a name="l00279"></a>00279       
<a name="l00280"></a>00280       write_len = total_out_buf_used * <span class="keyword">sizeof</span>(int16_t);
<a name="l00281"></a>00281    } <span class="keywordflow">else</span> {
<a name="l00282"></a>00282       <span class="comment">/* No resampling needed */</span>
<a name="l00283"></a>00283 
<a name="l00284"></a>00284       <span class="keywordflow">for</span> (i = 0; i &lt; nframes; i++)
<a name="l00285"></a>00285          s_buf[i] = in_buf[i] * (SHRT_MAX / 1.0);
<a name="l00286"></a>00286    }
<a name="l00287"></a>00287 
<a name="l00288"></a>00288    res = jack_ringbuffer_write(jack_data-&gt;<a class="code" href="structjack__data.html#a0ef8a9cb712a596b344f3e4b6405daa3">input_rb</a>, (<span class="keyword">const</span> <span class="keywordtype">char</span> *) s_buf, write_len);
<a name="l00289"></a>00289    <span class="keywordflow">if</span> (res != write_len) {
<a name="l00290"></a>00290       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;Tried to write %d bytes to the ringbuffer, but only wrote %d\n&quot;</span>,
<a name="l00291"></a>00291          (<span class="keywordtype">int</span>) <span class="keyword">sizeof</span>(s_buf), (<span class="keywordtype">int</span>) res);
<a name="l00292"></a>00292    }
<a name="l00293"></a>00293 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a953046302272e0bb7ed0c3c654ab40ba"></a><!-- doxytag: member="app_jack.c::handle_jack_audio" ref="a953046302272e0bb7ed0c3c654ab40ba" args="(struct ast_channel *chan, struct jack_data *jack_data, struct ast_frame *out_frame)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void handle_jack_audio </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structjack__data.html">jack_data</a> *&nbsp;</td>
          <td class="paramname"> <em>jack_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td>
          <td class="paramname"> <em>out_frame</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>handle jack audio </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>chan</em>&nbsp;</td><td>The Asterisk channel to write the frames to if no output frame is provided. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em><a class="el" href="structjack__data.html">jack_data</a></em>&nbsp;</td><td>This is the <a class="el" href="structjack__data.html">jack_data</a> struct that contains the input ringbuffer that audio will be read from. </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>out_frame</em>&nbsp;</td><td>If this argument is non-NULL, then assuming there is enough data avilable in the ringbuffer, the audio in this frame will get replaced with audio from the input buffer. If there is not enough data available to read at this time, then the frame data gets zeroed out.</td></tr>
  </table>
  </dd>
</dl>
<p>Read data from the input ringbuffer, which is the properly resampled audio that was read from the jack input port. Write it to the channel in 20 ms frames, or fill up an output frame instead if one is provided.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>Nothing. </dd></dl>

<p>Definition at line <a class="el" href="app__jack_8c_source.html#l00600">600</a> of file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8h_source.html#l00253">AST_FORMAT_SLINEAR</a>, <a class="el" href="frame_8h_source.html#l00101">AST_FRAME_VOICE</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8c_source.html#l03411">ast_write()</a>, <a class="el" href="adsistub_8c_source.html#l00059">buf</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="frame_8h_source.html#l00147">ast_frame::datalen</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="app__jack_8c_source.html#l00127">jack_data::input_rb</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::ptr</a>, and <a class="el" href="frame_8h_source.html#l00149">ast_frame::samples</a>.</p>

<p>Referenced by <a class="el" href="app__jack_8c_source.html#l00743">jack_exec()</a>, and <a class="el" href="app__jack_8c_source.html#l00819">jack_hook_callback()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00602"></a>00602 {  
<a name="l00603"></a>00603    <span class="keywordtype">short</span> <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[160];
<a name="l00604"></a>00604    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> <a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a> = {
<a name="l00605"></a>00605       .frametype = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>,
<a name="l00606"></a>00606       .subclass = <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>,
<a name="l00607"></a>00607       .src = <span class="stringliteral">&quot;JACK&quot;</span>,
<a name="l00608"></a>00608       .data.ptr = buf,
<a name="l00609"></a>00609       .datalen = <span class="keyword">sizeof</span>(buf),
<a name="l00610"></a>00610       .<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> = <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(buf),
<a name="l00611"></a>00611    };
<a name="l00612"></a>00612 
<a name="l00613"></a>00613    <span class="keywordflow">for</span> (;;) {
<a name="l00614"></a>00614       <span class="keywordtype">size_t</span> res, read_len;
<a name="l00615"></a>00615       <span class="keywordtype">char</span> *read_buf;
<a name="l00616"></a>00616 
<a name="l00617"></a>00617       read_len = out_frame ? out_frame-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> : <span class="keyword">sizeof</span>(buf);
<a name="l00618"></a>00618       read_buf = out_frame ? out_frame-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> : buf;
<a name="l00619"></a>00619 
<a name="l00620"></a>00620       res = jack_ringbuffer_read_space(jack_data-&gt;<a class="code" href="structjack__data.html#a0ef8a9cb712a596b344f3e4b6405daa3">input_rb</a>);
<a name="l00621"></a>00621 
<a name="l00622"></a>00622       <span class="keywordflow">if</span> (res &lt; read_len) {
<a name="l00623"></a>00623          <span class="comment">/* Not enough data ready for another frame, move on ... */</span>
<a name="l00624"></a>00624          <span class="keywordflow">if</span> (out_frame) {
<a name="l00625"></a>00625             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Sending an empty frame for the JACK_HOOK\n&quot;</span>);
<a name="l00626"></a>00626             memset(out_frame-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, 0, out_frame-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>);
<a name="l00627"></a>00627          }
<a name="l00628"></a>00628          <span class="keywordflow">break</span>;
<a name="l00629"></a>00629       }
<a name="l00630"></a>00630 
<a name="l00631"></a>00631       res = jack_ringbuffer_read(jack_data-&gt;<a class="code" href="structjack__data.html#a0ef8a9cb712a596b344f3e4b6405daa3">input_rb</a>, (<span class="keywordtype">char</span> *) read_buf, read_len);
<a name="l00632"></a>00632 
<a name="l00633"></a>00633       <span class="keywordflow">if</span> (res &lt; read_len) {
<a name="l00634"></a>00634          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Error reading from ringbuffer, even though it said there was enough data\n&quot;</span>);
<a name="l00635"></a>00635          <span class="keywordflow">break</span>;
<a name="l00636"></a>00636       }
<a name="l00637"></a>00637 
<a name="l00638"></a>00638       <span class="keywordflow">if</span> (out_frame) {
<a name="l00639"></a>00639          <span class="comment">/* If an output frame was provided, then we just want to fill up the</span>
<a name="l00640"></a>00640 <span class="comment">          * buffer in that frame and return. */</span>
<a name="l00641"></a>00641          <span class="keywordflow">break</span>;
<a name="l00642"></a>00642       }
<a name="l00643"></a>00643 
<a name="l00644"></a>00644       <a class="code" href="channel_8h.html#a79c413d51b7135404d5cacf811649a61" title="Write a frame to a channel This function writes the given frame to the indicated...">ast_write</a>(chan, &amp;f);
<a name="l00645"></a>00645    }
<a name="l00646"></a>00646 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a69c7df2c3f47aef6d50e31a750f8faca"></a><!-- doxytag: member="app_jack.c::handle_options" ref="a69c7df2c3f47aef6d50e31a750f8faca" args="(struct jack_data *jack_data, const char *__options_str)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int handle_options </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structjack__data.html">jack_data</a> *&nbsp;</td>
          <td class="paramname"> <em>jack_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>__options_str</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="note"><dt><b>Note:</b></dt><dd>This must be done before calling <a class="el" href="app__jack_8c.html#a70868f10224e91e14181fe3d3c4b3fbc">init_jack_data()</a>. </dd></dl>

<p>Definition at line <a class="el" href="app__jack_8c_source.html#l00692">692</a> of file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>

<p>References <a class="el" href="app_8c_source.html#l01776">ast_app_parse_options()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="stringfields_8h_source.html#l00285">ast_string_field_set</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="app__jack_8c_source.html#l00135">jack_data::no_start_server</a>, <a class="el" href="app__chanspy_8c_source.html#l00319">OPT_ARG_ARRAY_SIZE</a>, <a class="el" href="app__jack_8c_source.html#l00660">OPT_ARG_CLIENT_NAME</a>, <a class="el" href="app__jack_8c_source.html#l00658">OPT_ARG_INPUT_PORT</a>, <a class="el" href="app__jack_8c_source.html#l00659">OPT_ARG_OUTPUT_PORT</a>, <a class="el" href="app__jack_8c_source.html#l00657">OPT_ARG_SERVER_NAME</a>, <a class="el" href="app__jack_8c_source.html#l00653">OPT_CLIENT_NAME</a>, <a class="el" href="app__jack_8c_source.html#l00650">OPT_INPUT_PORT</a>, <a class="el" href="app__jack_8c_source.html#l00652">OPT_NOSTART_SERVER</a>, <a class="el" href="app__jack_8c_source.html#l00651">OPT_OUTPUT_PORT</a>, <a class="el" href="app__jack_8c_source.html#l00649">OPT_SERVER_NAME</a>, and <a class="el" href="app__skel_8c.html#ac493ead53d01ed4f793a03843d94977e">option_args</a>.</p>

<p>Referenced by <a class="el" href="app__jack_8c_source.html#l00859">enable_jack_hook()</a>, and <a class="el" href="app__jack_8c_source.html#l00743">jack_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00693"></a>00693 {
<a name="l00694"></a>00694    <span class="keyword">struct </span><a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> options = { 0, };
<a name="l00695"></a>00695    <span class="keywordtype">char</span> *<a class="code" href="app__skel_8c.html#ac493ead53d01ed4f793a03843d94977e">option_args</a>[<a class="code" href="app__chanspy_8c.html#a99fb83031ce9923c84392b4e92f956b5aec7326f60e7edad15d96ff935e5616d6">OPT_ARG_ARRAY_SIZE</a>];
<a name="l00696"></a>00696    <span class="keywordtype">char</span> *options_str;
<a name="l00697"></a>00697 
<a name="l00698"></a>00698    options_str = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(__options_str);
<a name="l00699"></a>00699 
<a name="l00700"></a>00700    <a class="code" href="app_8h.html#af40039f1c49c16d0f6fa33fe9c43a0cb" title="Parses a string containing application options and sets flags/arguments.">ast_app_parse_options</a>(jack_exec_options, &amp;options, option_args, options_str);
<a name="l00701"></a>00701 
<a name="l00702"></a>00702    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;options, <a class="code" href="app__jack_8c.html#a80155586fa275b28773c9b203f52cabaa2e68c9d2bd481b81a234a923cf259877">OPT_SERVER_NAME</a>)) {
<a name="l00703"></a>00703       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(option_args[<a class="code" href="app__jack_8c.html#a6b7b47dd702d9e331586d485013fd1eaa093e7df6ef7312d35fb4b03f0c3e7c57">OPT_ARG_SERVER_NAME</a>]))
<a name="l00704"></a>00704          <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(jack_data, server_name, option_args[OPT_ARG_SERVER_NAME]);
<a name="l00705"></a>00705       <span class="keywordflow">else</span> {
<a name="l00706"></a>00706          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;A server name must be provided with the s() option\n&quot;</span>);
<a name="l00707"></a>00707          <span class="keywordflow">return</span> -1;
<a name="l00708"></a>00708       }
<a name="l00709"></a>00709    }
<a name="l00710"></a>00710 
<a name="l00711"></a>00711    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;options, <a class="code" href="app__jack_8c.html#a80155586fa275b28773c9b203f52cabaa11996d3c883f5db7570198567618291d">OPT_CLIENT_NAME</a>)) {
<a name="l00712"></a>00712       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(option_args[<a class="code" href="app__jack_8c.html#a6b7b47dd702d9e331586d485013fd1eaa03ac82a78b9b7c9a19d8d061580e5809">OPT_ARG_CLIENT_NAME</a>]))
<a name="l00713"></a>00713          <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(jack_data, client_name, option_args[OPT_ARG_CLIENT_NAME]);
<a name="l00714"></a>00714       <span class="keywordflow">else</span> {
<a name="l00715"></a>00715          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;A client name must be provided with the c() option\n&quot;</span>);
<a name="l00716"></a>00716          <span class="keywordflow">return</span> -1;
<a name="l00717"></a>00717       }
<a name="l00718"></a>00718    }
<a name="l00719"></a>00719 
<a name="l00720"></a>00720    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;options, <a class="code" href="app__jack_8c.html#a80155586fa275b28773c9b203f52cabaa80be01ac3ad9829dd35ee410e5482dee">OPT_INPUT_PORT</a>)) {
<a name="l00721"></a>00721       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(option_args[<a class="code" href="app__jack_8c.html#a6b7b47dd702d9e331586d485013fd1eaac22235513ad8e730ca873c0af182a939">OPT_ARG_INPUT_PORT</a>]))
<a name="l00722"></a>00722          <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(jack_data, connect_input_port, option_args[OPT_ARG_INPUT_PORT]);
<a name="l00723"></a>00723       <span class="keywordflow">else</span> {
<a name="l00724"></a>00724          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;A name must be provided with the i() option\n&quot;</span>);
<a name="l00725"></a>00725          <span class="keywordflow">return</span> -1;
<a name="l00726"></a>00726       }
<a name="l00727"></a>00727    }
<a name="l00728"></a>00728 
<a name="l00729"></a>00729    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;options, <a class="code" href="app__jack_8c.html#a80155586fa275b28773c9b203f52cabaad0daca2a5f287cf652d35aaed1922889">OPT_OUTPUT_PORT</a>)) {
<a name="l00730"></a>00730       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(option_args[<a class="code" href="app__jack_8c.html#a6b7b47dd702d9e331586d485013fd1eaa7e5c4987d926a3e4a483ff62d7e76f38">OPT_ARG_OUTPUT_PORT</a>]))
<a name="l00731"></a>00731          <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(jack_data, connect_output_port, option_args[OPT_ARG_OUTPUT_PORT]);
<a name="l00732"></a>00732       <span class="keywordflow">else</span> {
<a name="l00733"></a>00733          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;A name must be provided with the o() option\n&quot;</span>);
<a name="l00734"></a>00734          <span class="keywordflow">return</span> -1;
<a name="l00735"></a>00735       }
<a name="l00736"></a>00736    }
<a name="l00737"></a>00737 
<a name="l00738"></a>00738    jack_data-&gt;<a class="code" href="structjack__data.html#aac63692b25679226c319dfd5c99e589b">no_start_server</a> = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;options, <a class="code" href="app__jack_8c.html#a80155586fa275b28773c9b203f52cabaaf8158643a36d2168f796acba3a07676f">OPT_NOSTART_SERVER</a>) ? 1 : 0;
<a name="l00739"></a>00739 
<a name="l00740"></a>00740    <span class="keywordflow">return</span> 0;
<a name="l00741"></a>00741 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a343f04835e5cb2cabd569304226c9efa"></a><!-- doxytag: member="app_jack.c::handle_output" ref="a343f04835e5cb2cabd569304226c9efa" args="(void *buf, jack_nframes_t nframes, struct jack_data *jack_data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void handle_output </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">jack_nframes_t&nbsp;</td>
          <td class="paramname"> <em>nframes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structjack__data.html">jack_data</a> *&nbsp;</td>
          <td class="paramname"> <em>jack_data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handle jack output port. </p>
<p>Read nframes <a class="el" href="structnumber.html" title="Number structure.">number</a> of samples from the ringbuffer and write it out to the output port buffer. </p>

<p>Definition at line <a class="el" href="app__jack_8c_source.html#l00301">301</a> of file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="func__strings_8c_source.html#l00821">len()</a>, and <a class="el" href="app__jack_8c_source.html#l00128">jack_data::output_rb</a>.</p>

<p>Referenced by <a class="el" href="app__jack_8c_source.html#l00316">jack_process()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00303"></a>00303 {
<a name="l00304"></a>00304    <span class="keywordtype">size_t</span> res, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;
<a name="l00305"></a>00305 
<a name="l00306"></a>00306    len = nframes * <span class="keyword">sizeof</span>(float);
<a name="l00307"></a>00307 
<a name="l00308"></a>00308    res = jack_ringbuffer_read(jack_data-&gt;<a class="code" href="structjack__data.html#a77f80958d20ee20d2fbbacf85b17a588">output_rb</a>, <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, len);
<a name="l00309"></a>00309 
<a name="l00310"></a>00310    <span class="keywordflow">if</span> (len != res) {
<a name="l00311"></a>00311       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;Wanted %d bytes to send to the output port, &quot;</span>
<a name="l00312"></a>00312          <span class="stringliteral">&quot;but only got %d\n&quot;</span>, (<span class="keywordtype">int</span>) len, (<span class="keywordtype">int</span>) res);
<a name="l00313"></a>00313    }
<a name="l00314"></a>00314 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a70868f10224e91e14181fe3d3c4b3fbc"></a><!-- doxytag: member="app_jack.c::init_jack_data" ref="a70868f10224e91e14181fe3d3c4b3fbc" args="(struct ast_channel *chan, struct jack_data *jack_data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int init_jack_data </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structjack__data.html">jack_data</a> *&nbsp;</td>
          <td class="paramname"> <em>jack_data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__jack_8c_source.html#l00387">387</a> of file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="app__jack_8c_source.html#l00124">jack_data::client</a>, <a class="el" href="astmm_8h_source.html#l00084">free</a>, <a class="el" href="app__jack_8c_source.html#l00125">jack_data::input_port</a>, <a class="el" href="app__jack_8c_source.html#l00127">jack_data::input_rb</a>, <a class="el" href="app__jack_8c_source.html#l00316">jack_process()</a>, <a class="el" href="app__jack_8c_source.html#l00333">jack_shutdown()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="app__jack_8c_source.html#l00169">log_jack_status()</a>, <a class="el" href="app__jack_8c_source.html#l00135">jack_data::no_start_server</a>, <a class="el" href="app__jack_8c_source.html#l00126">jack_data::output_port</a>, <a class="el" href="app__jack_8c_source.html#l00128">jack_data::output_rb</a>, <a class="el" href="app__jack_8c_source.html#l00063">RINGBUFFER_SIZE</a>, and <a class="el" href="app__jack_8c_source.html#l00141">status</a>.</p>

<p>Referenced by <a class="el" href="app__jack_8c_source.html#l00859">enable_jack_hook()</a>, and <a class="el" href="app__jack_8c_source.html#l00743">jack_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00388"></a>00388 {
<a name="l00389"></a>00389    <span class="keyword">const</span> <span class="keywordtype">char</span> *client_name;
<a name="l00390"></a>00390    jack_status_t <a class="code" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a> = 0;
<a name="l00391"></a>00391    jack_options_t jack_options = JackNullOption;
<a name="l00392"></a>00392 
<a name="l00393"></a>00393    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(jack_data-&gt;client_name)) {
<a name="l00394"></a>00394       client_name = jack_data-&gt;client_name;
<a name="l00395"></a>00395    } <span class="keywordflow">else</span> {
<a name="l00396"></a>00396       <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l00397"></a>00397       client_name = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(chan-&gt;name);
<a name="l00398"></a>00398       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l00399"></a>00399    }
<a name="l00400"></a>00400 
<a name="l00401"></a>00401    <span class="keywordflow">if</span> (!(jack_data-&gt;<a class="code" href="structjack__data.html#a77f80958d20ee20d2fbbacf85b17a588">output_rb</a> = jack_ringbuffer_create(<a class="code" href="app__jack_8c.html#a3119c147393ef51aa50af08b3172a358">RINGBUFFER_SIZE</a>)))
<a name="l00402"></a>00402       <span class="keywordflow">return</span> -1;
<a name="l00403"></a>00403 
<a name="l00404"></a>00404    <span class="keywordflow">if</span> (!(jack_data-&gt;<a class="code" href="structjack__data.html#a0ef8a9cb712a596b344f3e4b6405daa3">input_rb</a> = jack_ringbuffer_create(<a class="code" href="app__jack_8c.html#a3119c147393ef51aa50af08b3172a358">RINGBUFFER_SIZE</a>)))
<a name="l00405"></a>00405       <span class="keywordflow">return</span> -1;
<a name="l00406"></a>00406 
<a name="l00407"></a>00407    <span class="keywordflow">if</span> (jack_data-&gt;<a class="code" href="structjack__data.html#aac63692b25679226c319dfd5c99e589b">no_start_server</a>)
<a name="l00408"></a>00408       jack_options |= JackNoStartServer;
<a name="l00409"></a>00409 
<a name="l00410"></a>00410    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(jack_data-&gt;server_name)) {
<a name="l00411"></a>00411       jack_options |= JackServerName;
<a name="l00412"></a>00412       jack_data-&gt;<a class="code" href="structjack__data.html#afed7053cd7bdd1cce33dec7213f340ea">client</a> = jack_client_open(client_name, jack_options, &amp;status,
<a name="l00413"></a>00413          jack_data-&gt;server_name);
<a name="l00414"></a>00414    } <span class="keywordflow">else</span> {
<a name="l00415"></a>00415       jack_data-&gt;<a class="code" href="structjack__data.html#afed7053cd7bdd1cce33dec7213f340ea">client</a> = jack_client_open(client_name, jack_options, &amp;status);
<a name="l00416"></a>00416    }
<a name="l00417"></a>00417 
<a name="l00418"></a>00418    <span class="keywordflow">if</span> (status)
<a name="l00419"></a>00419       <a class="code" href="app__jack_8c.html#aafb72b66521b4060855b912d62c7b2ba">log_jack_status</a>(<span class="stringliteral">&quot;Client Open Status&quot;</span>, status);
<a name="l00420"></a>00420 
<a name="l00421"></a>00421    <span class="keywordflow">if</span> (!jack_data-&gt;<a class="code" href="structjack__data.html#afed7053cd7bdd1cce33dec7213f340ea">client</a>)
<a name="l00422"></a>00422       <span class="keywordflow">return</span> -1;
<a name="l00423"></a>00423 
<a name="l00424"></a>00424    jack_data-&gt;<a class="code" href="structjack__data.html#af830efb2d3206ba81602df7945863a2d">input_port</a> = jack_port_register(jack_data-&gt;<a class="code" href="structjack__data.html#afed7053cd7bdd1cce33dec7213f340ea">client</a>, <span class="stringliteral">&quot;input&quot;</span>,
<a name="l00425"></a>00425       JACK_DEFAULT_AUDIO_TYPE, JackPortIsInput | JackPortIsTerminal, 0);
<a name="l00426"></a>00426    <span class="keywordflow">if</span> (!jack_data-&gt;<a class="code" href="structjack__data.html#af830efb2d3206ba81602df7945863a2d">input_port</a>) {
<a name="l00427"></a>00427       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create input port for jack port\n&quot;</span>);
<a name="l00428"></a>00428       <span class="keywordflow">return</span> -1;
<a name="l00429"></a>00429    }
<a name="l00430"></a>00430 
<a name="l00431"></a>00431    jack_data-&gt;<a class="code" href="structjack__data.html#a163b2d99fab30f4f80d37b8e5fe6a9a2">output_port</a> = jack_port_register(jack_data-&gt;<a class="code" href="structjack__data.html#afed7053cd7bdd1cce33dec7213f340ea">client</a>, <span class="stringliteral">&quot;output&quot;</span>,
<a name="l00432"></a>00432       JACK_DEFAULT_AUDIO_TYPE, JackPortIsOutput | JackPortIsTerminal, 0);
<a name="l00433"></a>00433    <span class="keywordflow">if</span> (!jack_data-&gt;<a class="code" href="structjack__data.html#a163b2d99fab30f4f80d37b8e5fe6a9a2">output_port</a>) {
<a name="l00434"></a>00434       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create output port for jack port\n&quot;</span>);
<a name="l00435"></a>00435       <span class="keywordflow">return</span> -1;
<a name="l00436"></a>00436    }
<a name="l00437"></a>00437 
<a name="l00438"></a>00438    <span class="keywordflow">if</span> (jack_set_process_callback(jack_data-&gt;<a class="code" href="structjack__data.html#afed7053cd7bdd1cce33dec7213f340ea">client</a>, <a class="code" href="app__jack_8c.html#a1926aa55b7653ba0edc16abd007a1325">jack_process</a>, jack_data)) {
<a name="l00439"></a>00439       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to register process callback with jack client\n&quot;</span>);
<a name="l00440"></a>00440       <span class="keywordflow">return</span> -1;
<a name="l00441"></a>00441    }
<a name="l00442"></a>00442 
<a name="l00443"></a>00443    jack_on_shutdown(jack_data-&gt;<a class="code" href="structjack__data.html#afed7053cd7bdd1cce33dec7213f340ea">client</a>, <a class="code" href="app__jack_8c.html#aa368774daa7b40c1ee97aeab5478974f">jack_shutdown</a>, jack_data);
<a name="l00444"></a>00444 
<a name="l00445"></a>00445    <span class="keywordflow">if</span> (jack_activate(jack_data-&gt;<a class="code" href="structjack__data.html#afed7053cd7bdd1cce33dec7213f340ea">client</a>)) {
<a name="l00446"></a>00446       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to activate jack client\n&quot;</span>);
<a name="l00447"></a>00447       <span class="keywordflow">return</span> -1;
<a name="l00448"></a>00448    }
<a name="l00449"></a>00449 
<a name="l00450"></a>00450    <span class="keywordflow">while</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(jack_data-&gt;connect_input_port)) {
<a name="l00451"></a>00451       <span class="keyword">const</span> <span class="keywordtype">char</span> **ports;
<a name="l00452"></a>00452       <span class="keywordtype">int</span> i;
<a name="l00453"></a>00453 
<a name="l00454"></a>00454       ports = jack_get_ports(jack_data-&gt;<a class="code" href="structjack__data.html#afed7053cd7bdd1cce33dec7213f340ea">client</a>, jack_data-&gt;connect_input_port,
<a name="l00455"></a>00455          NULL, JackPortIsInput);
<a name="l00456"></a>00456 
<a name="l00457"></a>00457       <span class="keywordflow">if</span> (!ports) {
<a name="l00458"></a>00458          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No input port matching &apos;%s&apos; was found\n&quot;</span>,
<a name="l00459"></a>00459             jack_data-&gt;connect_input_port);
<a name="l00460"></a>00460          <span class="keywordflow">break</span>;
<a name="l00461"></a>00461       }
<a name="l00462"></a>00462 
<a name="l00463"></a>00463       <span class="keywordflow">for</span> (i = 0; ports[i]; i++) {
<a name="l00464"></a>00464          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Found port &apos;%s&apos; that matched specified input port &apos;%s&apos;\n&quot;</span>,
<a name="l00465"></a>00465             ports[i], jack_data-&gt;connect_input_port);
<a name="l00466"></a>00466       }
<a name="l00467"></a>00467 
<a name="l00468"></a>00468       <span class="keywordflow">if</span> (jack_connect(jack_data-&gt;<a class="code" href="structjack__data.html#afed7053cd7bdd1cce33dec7213f340ea">client</a>, jack_port_name(jack_data-&gt;<a class="code" href="structjack__data.html#a163b2d99fab30f4f80d37b8e5fe6a9a2">output_port</a>), ports[0])) {
<a name="l00469"></a>00469          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to connect &apos;%s&apos; to &apos;%s&apos;\n&quot;</span>, ports[0],
<a name="l00470"></a>00470             jack_port_name(jack_data-&gt;<a class="code" href="structjack__data.html#a163b2d99fab30f4f80d37b8e5fe6a9a2">output_port</a>));
<a name="l00471"></a>00471       } <span class="keywordflow">else</span> {
<a name="l00472"></a>00472          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Connected &apos;%s&apos; to &apos;%s&apos;\n&quot;</span>, ports[0],
<a name="l00473"></a>00473             jack_port_name(jack_data-&gt;<a class="code" href="structjack__data.html#a163b2d99fab30f4f80d37b8e5fe6a9a2">output_port</a>));
<a name="l00474"></a>00474       }
<a name="l00475"></a>00475 
<a name="l00476"></a>00476       <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>((<span class="keywordtype">void</span> *) ports);
<a name="l00477"></a>00477 
<a name="l00478"></a>00478       <span class="keywordflow">break</span>;
<a name="l00479"></a>00479    }
<a name="l00480"></a>00480 
<a name="l00481"></a>00481    <span class="keywordflow">while</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(jack_data-&gt;connect_output_port)) {
<a name="l00482"></a>00482       <span class="keyword">const</span> <span class="keywordtype">char</span> **ports;
<a name="l00483"></a>00483       <span class="keywordtype">int</span> i;
<a name="l00484"></a>00484 
<a name="l00485"></a>00485       ports = jack_get_ports(jack_data-&gt;<a class="code" href="structjack__data.html#afed7053cd7bdd1cce33dec7213f340ea">client</a>, jack_data-&gt;connect_output_port,
<a name="l00486"></a>00486          NULL, JackPortIsOutput);
<a name="l00487"></a>00487 
<a name="l00488"></a>00488       <span class="keywordflow">if</span> (!ports) {
<a name="l00489"></a>00489          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No output port matching &apos;%s&apos; was found\n&quot;</span>,
<a name="l00490"></a>00490             jack_data-&gt;connect_output_port);
<a name="l00491"></a>00491          <span class="keywordflow">break</span>;
<a name="l00492"></a>00492       }
<a name="l00493"></a>00493 
<a name="l00494"></a>00494       <span class="keywordflow">for</span> (i = 0; ports[i]; i++) {
<a name="l00495"></a>00495          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Found port &apos;%s&apos; that matched specified output port &apos;%s&apos;\n&quot;</span>,
<a name="l00496"></a>00496             ports[i], jack_data-&gt;connect_output_port);
<a name="l00497"></a>00497       }
<a name="l00498"></a>00498 
<a name="l00499"></a>00499       <span class="keywordflow">if</span> (jack_connect(jack_data-&gt;<a class="code" href="structjack__data.html#afed7053cd7bdd1cce33dec7213f340ea">client</a>, ports[0], jack_port_name(jack_data-&gt;<a class="code" href="structjack__data.html#af830efb2d3206ba81602df7945863a2d">input_port</a>))) {
<a name="l00500"></a>00500          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to connect &apos;%s&apos; to &apos;%s&apos;\n&quot;</span>, ports[0],
<a name="l00501"></a>00501             jack_port_name(jack_data-&gt;<a class="code" href="structjack__data.html#af830efb2d3206ba81602df7945863a2d">input_port</a>));
<a name="l00502"></a>00502       } <span class="keywordflow">else</span> {
<a name="l00503"></a>00503          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Connected &apos;%s&apos; to &apos;%s&apos;\n&quot;</span>, ports[0],
<a name="l00504"></a>00504             jack_port_name(jack_data-&gt;<a class="code" href="structjack__data.html#af830efb2d3206ba81602df7945863a2d">input_port</a>));
<a name="l00505"></a>00505       }
<a name="l00506"></a>00506 
<a name="l00507"></a>00507       <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>((<span class="keywordtype">void</span> *) ports);
<a name="l00508"></a>00508 
<a name="l00509"></a>00509       <span class="keywordflow">break</span>;
<a name="l00510"></a>00510    }
<a name="l00511"></a>00511 
<a name="l00512"></a>00512    <span class="keywordflow">return</span> 0;
<a name="l00513"></a>00513 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a349dbe766b1a0a00bfb9762f9de469ae"></a><!-- doxytag: member="app_jack.c::jack_data_alloc" ref="a349dbe766b1a0a00bfb9762f9de469ae" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structjack__data.html">jack_data</a>* jack_data_alloc </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__jack_8c_source.html#l00674">674</a> of file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, and <a class="el" href="stringfields_8h_source.html#l00241">ast_string_field_init</a>.</p>

<p>Referenced by <a class="el" href="app__jack_8c_source.html#l00859">enable_jack_hook()</a>, and <a class="el" href="app__jack_8c_source.html#l00743">jack_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00675"></a>00675 {
<a name="l00676"></a>00676    <span class="keyword">struct </span><a class="code" href="structjack__data.html">jack_data</a> *<a class="code" href="structjack__data.html">jack_data</a>;
<a name="l00677"></a>00677 
<a name="l00678"></a>00678    <span class="keywordflow">if</span> (!(jack_data = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*jack_data))))
<a name="l00679"></a>00679       <span class="keywordflow">return</span> NULL;
<a name="l00680"></a>00680    
<a name="l00681"></a>00681    <span class="keywordflow">if</span> (<a class="code" href="stringfields_8h.html#a871274fa4fd2687c7a44849a84df3665" title="Initialize a field pool and fields.">ast_string_field_init</a>(jack_data, 32)) {
<a name="l00682"></a>00682       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(jack_data);
<a name="l00683"></a>00683       <span class="keywordflow">return</span> NULL;
<a name="l00684"></a>00684    }
<a name="l00685"></a>00685 
<a name="l00686"></a>00686    <span class="keywordflow">return</span> jack_data;
<a name="l00687"></a>00687 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adb75537a3a7d18f51116423d36f16476"></a><!-- doxytag: member="app_jack.c::jack_exec" ref="adb75537a3a7d18f51116423d36f16476" args="(struct ast_channel *chan, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int jack_exec </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__jack_8c_source.html#l00743">743</a> of file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>

<p>References <a class="el" href="app_8h_source.html#l00338">AST_APP_ARG</a>, <a class="el" href="frame_8h_source.html#l00298">AST_CONTROL_HANGUP</a>, <a class="el" href="app_8h_source.html#l00355">AST_DECLARE_APP_ARGS</a>, <a class="el" href="frame_8h_source.html#l00253">AST_FORMAT_SLINEAR</a>, <a class="el" href="frame_8h_source.html#l00105">AST_FRAME_CONTROL</a>, <a class="el" href="frame_8h_source.html#l00101">AST_FRAME_VOICE</a>, <a class="el" href="frame_8h_source.html#l00462">ast_frfree</a>, <a class="el" href="channel_8c_source.html#l03100">ast_read()</a>, <a class="el" href="channel_8c_source.html#l03731">ast_set_read_format()</a>, <a class="el" href="channel_8c_source.html#l03737">ast_set_write_format()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="channel_8c_source.html#l02389">ast_waitfor()</a>, <a class="el" href="app__jack_8c_source.html#l00340">destroy_jack_data()</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="app__jack_8c_source.html#l00600">handle_jack_audio()</a>, <a class="el" href="app__jack_8c_source.html#l00692">handle_options()</a>, <a class="el" href="app__jack_8c_source.html#l00387">init_jack_data()</a>, <a class="el" href="app__jack_8c_source.html#l00674">jack_data_alloc()</a>, <a class="el" href="app__jack_8c_source.html#l00515">queue_voice_frame()</a>, <a class="el" href="app__jack_8c_source.html#l00133">jack_data::stop</a>, and <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>.</p>

<p>Referenced by <a class="el" href="app__jack_8c_source.html#l01011">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00744"></a>00744 {
<a name="l00745"></a>00745    <span class="keyword">struct </span><a class="code" href="structjack__data.html">jack_data</a> *<a class="code" href="structjack__data.html">jack_data</a>;
<a name="l00746"></a>00746    <a class="code" href="app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2" title="Declare a structure to hold an application&amp;#39;s arguments.">AST_DECLARE_APP_ARGS</a>(args,
<a name="l00747"></a>00747       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(options);
<a name="l00748"></a>00748    );
<a name="l00749"></a>00749 
<a name="l00750"></a>00750    <span class="keywordflow">if</span> (!(jack_data = <a class="code" href="app__jack_8c.html#a349dbe766b1a0a00bfb9762f9de469ae">jack_data_alloc</a>()))
<a name="l00751"></a>00751       <span class="keywordflow">return</span> -1;
<a name="l00752"></a>00752 
<a name="l00753"></a>00753    args.options = data;
<a name="l00754"></a>00754 
<a name="l00755"></a>00755    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(args.options) &amp;&amp; <a class="code" href="app__jack_8c.html#a69c7df2c3f47aef6d50e31a750f8faca">handle_options</a>(jack_data, args.options)) {
<a name="l00756"></a>00756       <a class="code" href="app__jack_8c.html#a297dcd2c82381f6eb3978edd72625982">destroy_jack_data</a>(jack_data);
<a name="l00757"></a>00757       <span class="keywordflow">return</span> -1;
<a name="l00758"></a>00758    }
<a name="l00759"></a>00759 
<a name="l00760"></a>00760    <span class="keywordflow">if</span> (<a class="code" href="app__jack_8c.html#a70868f10224e91e14181fe3d3c4b3fbc">init_jack_data</a>(chan, jack_data)) {
<a name="l00761"></a>00761       <a class="code" href="app__jack_8c.html#a297dcd2c82381f6eb3978edd72625982">destroy_jack_data</a>(jack_data);
<a name="l00762"></a>00762       <span class="keywordflow">return</span> -1;
<a name="l00763"></a>00763    }
<a name="l00764"></a>00764 
<a name="l00765"></a>00765    <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a72d53065c6bc2b6092fa41eefa03f1ad" title="Sets read format on channel chan Set read format for channel to whichever component...">ast_set_read_format</a>(chan, <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>)) {
<a name="l00766"></a>00766       <a class="code" href="app__jack_8c.html#a297dcd2c82381f6eb3978edd72625982">destroy_jack_data</a>(jack_data);
<a name="l00767"></a>00767       <span class="keywordflow">return</span> -1;
<a name="l00768"></a>00768    }
<a name="l00769"></a>00769 
<a name="l00770"></a>00770    <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a978161a52d98fdaee374d1f6e1359544" title="Sets write format on channel chan Set write format for channel to whichever component...">ast_set_write_format</a>(chan, <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>)) {
<a name="l00771"></a>00771       <a class="code" href="app__jack_8c.html#a297dcd2c82381f6eb3978edd72625982">destroy_jack_data</a>(jack_data);
<a name="l00772"></a>00772       <span class="keywordflow">return</span> -1;
<a name="l00773"></a>00773    }
<a name="l00774"></a>00774 
<a name="l00775"></a>00775    <span class="keywordflow">while</span> (!jack_data-&gt;<a class="code" href="structjack__data.html#a111277a0849f92b793ed6aa1efe54462">stop</a>) {
<a name="l00776"></a>00776       <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l00777"></a>00777 
<a name="l00778"></a>00778       <a class="code" href="channel_8h.html#a60e0bcaed001e8d5ed1ba0eb2644b3cc" title="Wait for input on a channel.">ast_waitfor</a>(chan, -1);
<a name="l00779"></a>00779 
<a name="l00780"></a>00780       f = <a class="code" href="channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1" title="Reads a frame.">ast_read</a>(chan);
<a name="l00781"></a>00781       <span class="keywordflow">if</span> (!f) {
<a name="l00782"></a>00782          jack_data-&gt;<a class="code" href="structjack__data.html#a111277a0849f92b793ed6aa1efe54462">stop</a> = 1;
<a name="l00783"></a>00783          <span class="keywordflow">continue</span>;
<a name="l00784"></a>00784       }
<a name="l00785"></a>00785 
<a name="l00786"></a>00786       <span class="keywordflow">switch</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a>) {
<a name="l00787"></a>00787       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>:
<a name="l00788"></a>00788          <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> == <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa7dac1c1896ab418c2ff351aae707fba">AST_CONTROL_HANGUP</a>)
<a name="l00789"></a>00789             jack_data-&gt;<a class="code" href="structjack__data.html#a111277a0849f92b793ed6aa1efe54462">stop</a> = 1;
<a name="l00790"></a>00790          <span class="keywordflow">break</span>;
<a name="l00791"></a>00791       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>:
<a name="l00792"></a>00792          <a class="code" href="app__jack_8c.html#a01d124d44868b3a2bb4c395405ded087">queue_voice_frame</a>(jack_data, f);
<a name="l00793"></a>00793       <span class="keywordflow">default</span>:
<a name="l00794"></a>00794          <span class="keywordflow">break</span>;
<a name="l00795"></a>00795       }
<a name="l00796"></a>00796 
<a name="l00797"></a>00797       <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l00798"></a>00798 
<a name="l00799"></a>00799       <a class="code" href="app__jack_8c.html#a953046302272e0bb7ed0c3c654ab40ba" title="handle jack audio">handle_jack_audio</a>(chan, jack_data, NULL);
<a name="l00800"></a>00800    }
<a name="l00801"></a>00801 
<a name="l00802"></a>00802    jack_data = <a class="code" href="app__jack_8c.html#a297dcd2c82381f6eb3978edd72625982">destroy_jack_data</a>(jack_data);
<a name="l00803"></a>00803 
<a name="l00804"></a>00804    <span class="keywordflow">return</span> 0;
<a name="l00805"></a>00805 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a86211168f3c8ac014e6caa5cc68a0f8c"></a><!-- doxytag: member="app_jack.c::jack_hook_callback" ref="a86211168f3c8ac014e6caa5cc68a0f8c" args="(struct ast_audiohook *audiohook, struct ast_channel *chan, struct ast_frame *frame, enum ast_audiohook_direction direction)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int jack_hook_callback </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__audiohook.html">ast_audiohook</a> *&nbsp;</td>
          <td class="paramname"> <em>audiohook</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td>
          <td class="paramname"> <em>frame</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899">ast_audiohook_direction</a>&nbsp;</td>
          <td class="paramname"> <em>direction</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__jack_8c_source.html#l00819">819</a> of file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>

<p>References <a class="el" href="audiohook_8h_source.html#l00050">AST_AUDIOHOOK_DIRECTION_READ</a>, <a class="el" href="audiohook_8h_source.html#l00046">AST_AUDIOHOOK_STATUS_DONE</a>, <a class="el" href="channel_8c_source.html#l01548">ast_channel_datastore_find()</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="frame_8h_source.html#l00253">AST_FORMAT_SLINEAR</a>, <a class="el" href="frame_8h_source.html#l00101">AST_FRAME_VOICE</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="datastore_8h_source.html#l00056">ast_datastore::data</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="app__jack_8c_source.html#l00600">handle_jack_audio()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="app__jack_8c_source.html#l00515">queue_voice_frame()</a>, <a class="el" href="audiohook_8h_source.html#l00091">ast_audiohook::status</a>, and <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>.</p>

<p>Referenced by <a class="el" href="app__jack_8c_source.html#l00859">enable_jack_hook()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00821"></a>00821 {
<a name="l00822"></a>00822    <span class="keyword">struct </span><a class="code" href="structast__datastore.html" title="Structure for a data store object.">ast_datastore</a> *datastore;
<a name="l00823"></a>00823    <span class="keyword">struct </span><a class="code" href="structjack__data.html">jack_data</a> *<a class="code" href="structjack__data.html">jack_data</a>;
<a name="l00824"></a>00824 
<a name="l00825"></a>00825    <span class="keywordflow">if</span> (audiohook-&gt;<a class="code" href="structast__audiohook.html#a9c2c1a66c786d5e486ac428388d62e28">status</a> == <a class="code" href="audiohook_8h.html#acf2dd361123daa6446ade7c7ecfe55ada82b3db86f4b5d34ca212dfb6fec2db14">AST_AUDIOHOOK_STATUS_DONE</a>)
<a name="l00826"></a>00826       <span class="keywordflow">return</span> 0;
<a name="l00827"></a>00827 
<a name="l00828"></a>00828    <span class="keywordflow">if</span> (direction != <a class="code" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899a56916f7012e7fe0ec9b6dd4e4c0e2a65">AST_AUDIOHOOK_DIRECTION_READ</a>)
<a name="l00829"></a>00829       <span class="keywordflow">return</span> 0;
<a name="l00830"></a>00830 
<a name="l00831"></a>00831    <span class="keywordflow">if</span> (frame-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> != <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>)
<a name="l00832"></a>00832       <span class="keywordflow">return</span> 0;
<a name="l00833"></a>00833 
<a name="l00834"></a>00834    <span class="keywordflow">if</span> (frame-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> != <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>) {
<a name="l00835"></a>00835       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Expected frame in SLINEAR for the audiohook, but got format %d\n&quot;</span>,
<a name="l00836"></a>00836          frame-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>);
<a name="l00837"></a>00837       <span class="keywordflow">return</span> 0;
<a name="l00838"></a>00838    }
<a name="l00839"></a>00839 
<a name="l00840"></a>00840    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l00841"></a>00841 
<a name="l00842"></a>00842    <span class="keywordflow">if</span> (!(datastore = <a class="code" href="channel_8h.html#aad1e09cd7c79237d05cffb45d6cdfd7c" title="Find a datastore on a channel.">ast_channel_datastore_find</a>(chan, &amp;<a class="code" href="app__jack_8c.html#a5b3fe7b11051f242e9f440262863a7c2">jack_hook_ds_info</a>, NULL))) {
<a name="l00843"></a>00843       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;JACK_HOOK datastore not found for &apos;%s&apos;\n&quot;</span>, chan-&gt;name);
<a name="l00844"></a>00844       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l00845"></a>00845       <span class="keywordflow">return</span> -1;
<a name="l00846"></a>00846    }
<a name="l00847"></a>00847 
<a name="l00848"></a>00848    jack_data = datastore-&gt;<a class="code" href="structast__datastore.html#a735984d41155bc1032e09bece8f8d66d">data</a>;
<a name="l00849"></a>00849 
<a name="l00850"></a>00850    <a class="code" href="app__jack_8c.html#a01d124d44868b3a2bb4c395405ded087">queue_voice_frame</a>(jack_data, frame);
<a name="l00851"></a>00851 
<a name="l00852"></a>00852    <a class="code" href="app__jack_8c.html#a953046302272e0bb7ed0c3c654ab40ba" title="handle jack audio">handle_jack_audio</a>(chan, jack_data, frame);
<a name="l00853"></a>00853 
<a name="l00854"></a>00854    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l00855"></a>00855 
<a name="l00856"></a>00856    <span class="keywordflow">return</span> 0;
<a name="l00857"></a>00857 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6203a95a3dc09553980fae171c904560"></a><!-- doxytag: member="app_jack.c::jack_hook_ds_destroy" ref="a6203a95a3dc09553980fae171c904560" args="(void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void jack_hook_ds_destroy </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__jack_8c_source.html#l00807">807</a> of file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>

<p>References <a class="el" href="app__jack_8c_source.html#l00340">destroy_jack_data()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00808"></a>00808 {
<a name="l00809"></a>00809    <span class="keyword">struct </span><a class="code" href="structjack__data.html">jack_data</a> *<a class="code" href="structjack__data.html">jack_data</a> = data;
<a name="l00810"></a>00810 
<a name="l00811"></a>00811    <a class="code" href="app__jack_8c.html#a297dcd2c82381f6eb3978edd72625982">destroy_jack_data</a>(jack_data);
<a name="l00812"></a>00812 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a876ae0646f0e78f0fab18eda01fc1008"></a><!-- doxytag: member="app_jack.c::jack_hook_write" ref="a876ae0646f0e78f0fab18eda01fc1008" args="(struct ast_channel *chan, const char *cmd, char *data, const char *value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int jack_hook_write </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>value</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__jack_8c_source.html#l00948">948</a> of file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="app__jack_8c_source.html#l00920">disable_jack_hook()</a>, <a class="el" href="app__jack_8c_source.html#l00859">enable_jack_hook()</a>, and <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00950"></a>00950 {
<a name="l00951"></a>00951    <span class="keywordtype">int</span> res;
<a name="l00952"></a>00952 
<a name="l00953"></a>00953    <span class="keywordflow">if</span> (!strcasecmp(value, <span class="stringliteral">&quot;on&quot;</span>))
<a name="l00954"></a>00954       res = <a class="code" href="app__jack_8c.html#a5fdc965653c1368f1edd9e0b70889c50">enable_jack_hook</a>(chan, data);
<a name="l00955"></a>00955    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(value, <span class="stringliteral">&quot;off&quot;</span>))
<a name="l00956"></a>00956       res = <a class="code" href="app__jack_8c.html#a5a55d7d70a6ac23bfbf7db0243c2cb85">disable_jack_hook</a>(chan);
<a name="l00957"></a>00957    <span class="keywordflow">else</span> {
<a name="l00958"></a>00958       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;&apos;%s&apos; is not a valid value for JACK_HOOK()\n&quot;</span>, value);  
<a name="l00959"></a>00959       res = -1;
<a name="l00960"></a>00960    }
<a name="l00961"></a>00961 
<a name="l00962"></a>00962    <span class="keywordflow">return</span> res;
<a name="l00963"></a>00963 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1926aa55b7653ba0edc16abd007a1325"></a><!-- doxytag: member="app_jack.c::jack_process" ref="a1926aa55b7653ba0edc16abd007a1325" args="(jack_nframes_t nframes, void *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int jack_process </td>
          <td>(</td>
          <td class="paramtype">jack_nframes_t&nbsp;</td>
          <td class="paramname"> <em>nframes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__jack_8c_source.html#l00316">316</a> of file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>

<p>References <a class="el" href="app__jack_8c_source.html#l00188">alloc_resampler()</a>, <a class="el" href="app__jack_8c_source.html#l00238">handle_input()</a>, <a class="el" href="app__jack_8c_source.html#l00301">handle_output()</a>, <a class="el" href="app__jack_8c_source.html#l00125">jack_data::input_port</a>, <a class="el" href="app__jack_8c_source.html#l00132">jack_data::input_resample_factor</a>, and <a class="el" href="app__jack_8c_source.html#l00126">jack_data::output_port</a>.</p>

<p>Referenced by <a class="el" href="app__jack_8c_source.html#l00387">init_jack_data()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00317"></a>00317 {
<a name="l00318"></a>00318    <span class="keyword">struct </span><a class="code" href="structjack__data.html">jack_data</a> *<a class="code" href="structjack__data.html">jack_data</a> = arg;
<a name="l00319"></a>00319    <span class="keywordtype">void</span> *input_port_buf, *output_port_buf;
<a name="l00320"></a>00320 
<a name="l00321"></a>00321    <span class="keywordflow">if</span> (!jack_data-&gt;<a class="code" href="structjack__data.html#a6271c2db9aa01f38587b22325a88ea9d">input_resample_factor</a>)
<a name="l00322"></a>00322       <a class="code" href="app__jack_8c.html#ae720b800009d2e672dae3cfaa6476cee">alloc_resampler</a>(jack_data, 1);
<a name="l00323"></a>00323 
<a name="l00324"></a>00324    input_port_buf = jack_port_get_buffer(jack_data-&gt;<a class="code" href="structjack__data.html#af830efb2d3206ba81602df7945863a2d">input_port</a>, nframes);
<a name="l00325"></a>00325    <a class="code" href="app__jack_8c.html#a5ce9b1108dd9f252031ff2a21e4915fb" title="Handle jack input port.">handle_input</a>(input_port_buf, nframes, jack_data);
<a name="l00326"></a>00326 
<a name="l00327"></a>00327    output_port_buf = jack_port_get_buffer(jack_data-&gt;<a class="code" href="structjack__data.html#a163b2d99fab30f4f80d37b8e5fe6a9a2">output_port</a>, nframes);
<a name="l00328"></a>00328    <a class="code" href="app__jack_8c.html#a343f04835e5cb2cabd569304226c9efa" title="Handle jack output port.">handle_output</a>(output_port_buf, nframes, jack_data);
<a name="l00329"></a>00329 
<a name="l00330"></a>00330    <span class="keywordflow">return</span> 0;
<a name="l00331"></a>00331 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa368774daa7b40c1ee97aeab5478974f"></a><!-- doxytag: member="app_jack.c::jack_shutdown" ref="aa368774daa7b40c1ee97aeab5478974f" args="(void *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void jack_shutdown </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__jack_8c_source.html#l00333">333</a> of file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>

<p>References <a class="el" href="app__jack_8c_source.html#l00133">jack_data::stop</a>.</p>

<p>Referenced by <a class="el" href="app__jack_8c_source.html#l00387">init_jack_data()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00334"></a>00334 {
<a name="l00335"></a>00335    <span class="keyword">struct </span><a class="code" href="structjack__data.html">jack_data</a> *<a class="code" href="structjack__data.html">jack_data</a> = arg;
<a name="l00336"></a>00336 
<a name="l00337"></a>00337    jack_data-&gt;<a class="code" href="structjack__data.html#a111277a0849f92b793ed6aa1efe54462">stop</a> = 1;
<a name="l00338"></a>00338 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af57abd76ce2df847e98d3cee0fa56921"></a><!-- doxytag: member="app_jack.c::jack_status_to_str" ref="af57abd76ce2df847e98d3cee0fa56921" args="(jack_status_t status)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static const char* jack_status_to_str </td>
          <td>(</td>
          <td class="paramtype">jack_status_t&nbsp;</td>
          <td class="paramname"> <em>status</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__jack_8c_source.html#l00157">157</a> of file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, and <a class="el" href="app__jack_8c.html#a7b0d5721958172c8cd1741749d9cf629">jack_status_table</a>.</p>

<p>Referenced by <a class="el" href="app__jack_8c_source.html#l00169">log_jack_status()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00158"></a>00158 {
<a name="l00159"></a>00159    <span class="keywordtype">int</span> i;
<a name="l00160"></a>00160 
<a name="l00161"></a>00161    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="app__jack_8c.html#a7b0d5721958172c8cd1741749d9cf629">jack_status_table</a>); i++) {
<a name="l00162"></a>00162       <span class="keywordflow">if</span> (<a class="code" href="app__jack_8c.html#a7b0d5721958172c8cd1741749d9cf629">jack_status_table</a>[i].<a class="code" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a> == <a class="code" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>)
<a name="l00163"></a>00163          <span class="keywordflow">return</span> <a class="code" href="app__jack_8c.html#a7b0d5721958172c8cd1741749d9cf629">jack_status_table</a>[i].str;
<a name="l00164"></a>00164    }
<a name="l00165"></a>00165 
<a name="l00166"></a>00166    <span class="keywordflow">return</span> <span class="stringliteral">&quot;Unknown Error&quot;</span>;
<a name="l00167"></a>00167 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac3382bf6da54c56b37069bd76bbdf4f9"></a><!-- doxytag: member="app_jack.c::load_module" ref="ac3382bf6da54c56b37069bd76bbdf4f9" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int load_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__jack_8c_source.html#l01011">1011</a> of file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>

<p>References <a class="el" href="pbx_8h_source.html#l01028">ast_custom_function_register</a>, <a class="el" href="module_8h_source.html#l00062">AST_MODULE_LOAD_DECLINE</a>, <a class="el" href="module_8h_source.html#l00061">AST_MODULE_LOAD_SUCCESS</a>, <a class="el" href="module_8h_source.html#l00406">ast_register_application_xml</a>, <a class="el" href="pbx_8c_source.html#l06403">ast_unregister_application()</a>, and <a class="el" href="app__jack_8c_source.html#l00743">jack_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01012"></a>01012 {
<a name="l01013"></a>01013    <span class="keywordflow">if</span> (<a class="code" href="module_8h.html#afba4eb7a910b10969041ae4cd488729d" title="Register an application using XML documentation.">ast_register_application_xml</a>(<a class="code" href="app__jack_8c.html#aee6aaf3806d66cc97c27873521cae842">jack_app</a>, <a class="code" href="app__jack_8c.html#adb75537a3a7d18f51116423d36f16476">jack_exec</a>)) {
<a name="l01014"></a>01014       <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;
<a name="l01015"></a>01015    }
<a name="l01016"></a>01016 
<a name="l01017"></a>01017    <span class="keywordflow">if</span> (<a class="code" href="pbx_8h.html#a8af0e93442a9e468425f63cc52b0ac7b" title="Register a custom function.">ast_custom_function_register</a>(&amp;<a class="code" href="app__jack_8c.html#a6c54514b9e379eddcf31f5f060e81bca">jack_hook_function</a>)) {
<a name="l01018"></a>01018       <a class="code" href="module_8h.html#ad2ca15621101154f29748cf1dac3c3cf" title="Unregister an application.">ast_unregister_application</a>(<a class="code" href="app__jack_8c.html#aee6aaf3806d66cc97c27873521cae842">jack_app</a>);
<a name="l01019"></a>01019       <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;
<a name="l01020"></a>01020    }
<a name="l01021"></a>01021 
<a name="l01022"></a>01022    <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a>;
<a name="l01023"></a>01023 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aafb72b66521b4060855b912d62c7b2ba"></a><!-- doxytag: member="app_jack.c::log_jack_status" ref="aafb72b66521b4060855b912d62c7b2ba" args="(const char *prefix, jack_status_t status)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void log_jack_status </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>prefix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">jack_status_t&nbsp;</td>
          <td class="paramname"> <em>status</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__jack_8c_source.html#l00169">169</a> of file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="strings_8h_source.html#l00576">ast_str_alloca</a>, <a class="el" href="strings_8h_source.html#l00846">ast_str_append()</a>, <a class="el" href="strings_8h_source.html#l00488">ast_str_buffer()</a>, <a class="el" href="strings_8h_source.html#l00825">ast_str_set()</a>, <a class="el" href="devicestate_8c_source.html#l00198">first</a>, <a class="el" href="app__jack_8c_source.html#l00157">jack_status_to_str()</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, and <a class="el" href="app__jack_8c_source.html#l00142">str</a>.</p>

<p>Referenced by <a class="el" href="app__jack_8c_source.html#l00387">init_jack_data()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00170"></a>00170 {
<a name="l00171"></a>00171    <span class="keyword">struct </span><a class="code" href="structast__str.html" title="The descriptor of a dynamic string XXX storage will be optimized later if needed...">ast_str</a> *<a class="code" href="app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a> = <a class="code" href="strings_8h.html#a7fc844c12b769ccded05e7514036e241">ast_str_alloca</a>(512);
<a name="l00172"></a>00172    <span class="keywordtype">int</span> i, <a class="code" href="devicestate_8c.html#abd2135e6f8a41bc900933b1985d97165">first</a> = 0;
<a name="l00173"></a>00173 
<a name="l00174"></a>00174    <span class="keywordflow">for</span> (i = 0; i &lt; (<span class="keyword">sizeof</span>(<a class="code" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>) * 8); i++) {
<a name="l00175"></a>00175       <span class="keywordflow">if</span> (!(<a class="code" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a> &amp; (1 &lt;&lt; i)))
<a name="l00176"></a>00176          <span class="keywordflow">continue</span>;
<a name="l00177"></a>00177 
<a name="l00178"></a>00178       <span class="keywordflow">if</span> (!first) {
<a name="l00179"></a>00179          <a class="code" href="strings_8h.html#a4a3222f04f84c80a1d70f51e2dff00ea" title="Set a dynamic string using variable arguments.">ast_str_set</a>(&amp;str, 0, <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="app__jack_8c.html#af57abd76ce2df847e98d3cee0fa56921">jack_status_to_str</a>((1 &lt;&lt; i)));
<a name="l00180"></a>00180          first = 1;
<a name="l00181"></a>00181       } <span class="keywordflow">else</span>
<a name="l00182"></a>00182          <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(&amp;str, 0, <span class="stringliteral">&quot;, %s&quot;</span>, <a class="code" href="app__jack_8c.html#af57abd76ce2df847e98d3cee0fa56921">jack_status_to_str</a>((1 &lt;&lt; i)));
<a name="l00183"></a>00183    }
<a name="l00184"></a>00184    
<a name="l00185"></a>00185    <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;%s: %s\n&quot;</span>, <a class="code" href="http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a>, <a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(str));
<a name="l00186"></a>00186 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a01d124d44868b3a2bb4c395405ded087"></a><!-- doxytag: member="app_jack.c::queue_voice_frame" ref="a01d124d44868b3a2bb4c395405ded087" args="(struct jack_data *jack_data, struct ast_frame *f)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int queue_voice_frame </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structjack__data.html">jack_data</a> *&nbsp;</td>
          <td class="paramname"> <em>jack_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td>
          <td class="paramname"> <em>f</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__jack_8c_source.html#l00515">515</a> of file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>

<p>References <a class="el" href="app__jack_8c_source.html#l00188">alloc_resampler()</a>, <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="app__jack_8c_source.html#l00128">jack_data::output_rb</a>, <a class="el" href="app__jack_8c_source.html#l00130">jack_data::output_resample_factor</a>, <a class="el" href="app__jack_8c_source.html#l00129">jack_data::output_resampler</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::ptr</a>, and <a class="el" href="frame_8h_source.html#l00149">ast_frame::samples</a>.</p>

<p>Referenced by <a class="el" href="app__jack_8c_source.html#l00743">jack_exec()</a>, and <a class="el" href="app__jack_8c_source.html#l00819">jack_hook_callback()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00516"></a>00516 {
<a name="l00517"></a>00517    <span class="keywordtype">float</span> f_buf[f-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> * 8];
<a name="l00518"></a>00518    <span class="keywordtype">size_t</span> f_buf_used = 0;
<a name="l00519"></a>00519    <span class="keywordtype">int</span> i;
<a name="l00520"></a>00520    int16_t *s_buf = f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>;
<a name="l00521"></a>00521    <span class="keywordtype">size_t</span> res;
<a name="l00522"></a>00522 
<a name="l00523"></a>00523    memset(f_buf, 0, <span class="keyword">sizeof</span>(f_buf));
<a name="l00524"></a>00524 
<a name="l00525"></a>00525    <span class="keywordflow">if</span> (!jack_data-&gt;<a class="code" href="structjack__data.html#a1779a34e43822abc58b50a09b2a06de0">output_resample_factor</a>)
<a name="l00526"></a>00526       <a class="code" href="app__jack_8c.html#ae720b800009d2e672dae3cfaa6476cee">alloc_resampler</a>(jack_data, 0);
<a name="l00527"></a>00527 
<a name="l00528"></a>00528    <span class="keywordflow">if</span> (jack_data-&gt;<a class="code" href="structjack__data.html#a7f0419971318dac4b9bc6682ebf24768">output_resampler</a>) {
<a name="l00529"></a>00529       <span class="keywordtype">float</span> in_buf[f-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>];
<a name="l00530"></a>00530       <span class="keywordtype">int</span> total_in_buf_used = 0;
<a name="l00531"></a>00531       <span class="keywordtype">int</span> total_out_buf_used = 0;
<a name="l00532"></a>00532 
<a name="l00533"></a>00533       memset(in_buf, 0, <span class="keyword">sizeof</span>(in_buf));
<a name="l00534"></a>00534 
<a name="l00535"></a>00535       <span class="keywordflow">for</span> (i = 0; i &lt; f-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>; i++)
<a name="l00536"></a>00536          in_buf[i] = s_buf[i] * (1.0 / SHRT_MAX);
<a name="l00537"></a>00537 
<a name="l00538"></a>00538       <span class="keywordflow">while</span> (total_in_buf_used &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(in_buf)) {
<a name="l00539"></a>00539          <span class="keywordtype">int</span> in_buf_used;
<a name="l00540"></a>00540          <span class="keywordtype">int</span> out_buf_used;
<a name="l00541"></a>00541 
<a name="l00542"></a>00542          out_buf_used = resample_process(jack_data-&gt;<a class="code" href="structjack__data.html#a7f0419971318dac4b9bc6682ebf24768">output_resampler</a>, 
<a name="l00543"></a>00543             jack_data-&gt;<a class="code" href="structjack__data.html#a1779a34e43822abc58b50a09b2a06de0">output_resample_factor</a>,
<a name="l00544"></a>00544             &amp;in_buf[total_in_buf_used], <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(in_buf) - total_in_buf_used, 
<a name="l00545"></a>00545             0, &amp;in_buf_used, 
<a name="l00546"></a>00546             &amp;f_buf[total_out_buf_used], <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(f_buf) - total_out_buf_used);
<a name="l00547"></a>00547 
<a name="l00548"></a>00548          <span class="keywordflow">if</span> (out_buf_used &lt; 0)
<a name="l00549"></a>00549             <span class="keywordflow">break</span>;
<a name="l00550"></a>00550 
<a name="l00551"></a>00551          total_out_buf_used += out_buf_used;
<a name="l00552"></a>00552          total_in_buf_used += in_buf_used;
<a name="l00553"></a>00553 
<a name="l00554"></a>00554          <span class="keywordflow">if</span> (total_out_buf_used == <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(f_buf)) {
<a name="l00555"></a>00555             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Output buffer filled ... need to increase its size\n&quot;</span>);
<a name="l00556"></a>00556             <span class="keywordflow">break</span>;
<a name="l00557"></a>00557          }
<a name="l00558"></a>00558       }
<a name="l00559"></a>00559 
<a name="l00560"></a>00560       f_buf_used = total_out_buf_used;
<a name="l00561"></a>00561       <span class="keywordflow">if</span> (f_buf_used &gt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(f_buf))
<a name="l00562"></a>00562          f_buf_used = <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(f_buf);
<a name="l00563"></a>00563    } <span class="keywordflow">else</span> {
<a name="l00564"></a>00564       <span class="comment">/* No resampling needed */</span>
<a name="l00565"></a>00565 
<a name="l00566"></a>00566       <span class="keywordflow">for</span> (i = 0; i &lt; f-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>; i++)
<a name="l00567"></a>00567          f_buf[i] = s_buf[i] * (1.0 / SHRT_MAX);
<a name="l00568"></a>00568 
<a name="l00569"></a>00569       f_buf_used = f-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>;
<a name="l00570"></a>00570    }
<a name="l00571"></a>00571 
<a name="l00572"></a>00572    res = jack_ringbuffer_write(jack_data-&gt;<a class="code" href="structjack__data.html#a77f80958d20ee20d2fbbacf85b17a588">output_rb</a>, (<span class="keyword">const</span> <span class="keywordtype">char</span> *) f_buf, f_buf_used * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l00573"></a>00573    <span class="keywordflow">if</span> (res != (f_buf_used * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>))) {
<a name="l00574"></a>00574       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;Tried to write %d bytes to the ringbuffer, but only wrote %d\n&quot;</span>,
<a name="l00575"></a>00575          (<span class="keywordtype">int</span>) (f_buf_used * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)), (<span class="keywordtype">int</span>) res);
<a name="l00576"></a>00576    }
<a name="l00577"></a>00577 
<a name="l00578"></a>00578    <span class="keywordflow">return</span> 0;
<a name="l00579"></a>00579 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad09fa931f468002152a3cc2d5ce25eae"></a><!-- doxytag: member="app_jack.c::unload_module" ref="ad09fa931f468002152a3cc2d5ce25eae" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int unload_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__jack_8c_source.html#l01001">1001</a> of file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l03216">ast_custom_function_unregister()</a>, and <a class="el" href="pbx_8c_source.html#l06403">ast_unregister_application()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01002"></a>01002 {
<a name="l01003"></a>01003    <span class="keywordtype">int</span> res;
<a name="l01004"></a>01004 
<a name="l01005"></a>01005    res = <a class="code" href="module_8h.html#ad2ca15621101154f29748cf1dac3c3cf" title="Unregister an application.">ast_unregister_application</a>(<a class="code" href="app__jack_8c.html#aee6aaf3806d66cc97c27873521cae842">jack_app</a>);
<a name="l01006"></a>01006    res |= <a class="code" href="pbx_8h.html#a965977ea9a3144bc203e0ce7a64680a1" title="Unregister a custom function.">ast_custom_function_unregister</a>(&amp;<a class="code" href="app__jack_8c.html#a6c54514b9e379eddcf31f5f060e81bca">jack_hook_function</a>);
<a name="l01007"></a>01007 
<a name="l01008"></a>01008    <span class="keywordflow">return</span> res;
<a name="l01009"></a>01009 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="aee6aaf3806d66cc97c27873521cae842"></a><!-- doxytag: member="app_jack.c::jack_app" ref="aee6aaf3806d66cc97c27873521cae842" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="app__jack_8c.html#aee6aaf3806d66cc97c27873521cae842">jack_app</a> = &quot;JACK&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__jack_8c_source.html#l00115">115</a> of file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5b3fe7b11051f242e9f440262863a7c2"></a><!-- doxytag: member="app_jack.c::jack_hook_ds_info" ref="a5b3fe7b11051f242e9f440262863a7c2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__datastore__info.html">ast_datastore_info</a> <a class="el" href="app__jack_8c.html#a5b3fe7b11051f242e9f440262863a7c2">jack_hook_ds_info</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
   .type = <span class="stringliteral">&quot;JACK_HOOK&quot;</span>,
   .destroy = <a class="code" href="app__jack_8c.html#a6203a95a3dc09553980fae171c904560">jack_hook_ds_destroy</a>,
}
</pre></div>
<p>Definition at line <a class="el" href="app__jack_8c_source.html#l00814">814</a> of file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6c54514b9e379eddcf31f5f060e81bca"></a><!-- doxytag: member="app_jack.c::jack_hook_function" ref="a6c54514b9e379eddcf31f5f060e81bca" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__custom__function.html">ast_custom_function</a> <a class="el" href="app__jack_8c.html#a6c54514b9e379eddcf31f5f060e81bca">jack_hook_function</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__jack_8c_source.html#l00965">965</a> of file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7b0d5721958172c8cd1741749d9cf629"></a><!-- doxytag: member="app_jack.c::jack_status_table" ref="a7b0d5721958172c8cd1741749d9cf629" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct { ... }   <a class="el" href="app__jack_8c.html#a7b0d5721958172c8cd1741749d9cf629">jack_status_table</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="app__jack_8c_source.html#l00157">jack_status_to_str()</a>.</p>

</div>
</div>
<a class="anchor" id="ac191e5810fa65e63095409471eb5648f"></a><!-- doxytag: member="app_jack.c::status" ref="ac191e5810fa65e63095409471eb5648f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">jack_status_t <a class="el" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__jack_8c_source.html#l00141">141</a> of file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l04214">__ast_pbx_run()</a>, <a class="el" href="chan__iax2_8c_source.html#l06324">__iax2_show_peers()</a>, <a class="el" href="chan__sip_8c_source.html#l15349">_sip_show_peer()</a>, <a class="el" href="chan__sip_8c_source.html#l14666">_sip_show_peers()</a>, <a class="el" href="func__odbc_8c_source.html#l00375">acf_odbc_read()</a>, <a class="el" href="func__odbc_8c_source.html#l00203">acf_odbc_write()</a>, <a class="el" href="chan__agent_8c_source.html#l01565">action_agents()</a>, <a class="el" href="manager_8c_source.html#l02590">action_extensionstate()</a>, <a class="el" href="chan__agent_8c_source.html#l00893">agent_hangup()</a>, <a class="el" href="chan__agent_8c_source.html#l00519">agent_read()</a>, <a class="el" href="res__agi_8c_source.html#l03212">agi_exec_full()</a>, <a class="el" href="res__jabber_8c_source.html#l01604">aji_handle_presence()</a>, <a class="el" href="res__jabber_8c_source.html#l01822">aji_handle_subscribe()</a>, <a class="el" href="res__jabber_8c_source.html#l02504">aji_show_clients()</a>, <a class="el" href="res__jabber_8c_source.html#l00432">aji_status_exec()</a>, <a class="el" href="asterisk_8c_source.html#l01001">ast_safe_system()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l01120">build_status()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l01141">build_timeout()</a>, <a class="el" href="app__chanisavail_8c_source.html#l00097">chanavail_exec()</a>, <a class="el" href="asterisk_8c_source.html#l01451">child_handler()</a>, <a class="el" href="chan__iax2_8c_source.html#l07979">complete_dpreply()</a>, <a class="el" href="pbx__dundi_8c_source.html#l02636">dundi_show_peers()</a>, <a class="el" href="chan__agent_8c_source.html#l02497">function_agent()</a>, <a class="el" href="chan__iax2_8c_source.html#l03568">handle_cli_iax2_show_peer()</a>, <a class="el" href="res__config__pgsql_8c_source.html#l01538">handle_cli_realtime_pgsql_status()</a>, <a class="el" href="chan__skinny_8c_source.html#l05511">handle_open_receive_channel_ack_message()</a>, <a class="el" href="http_8c_source.html#l00659">httpd_helper_thread()</a>, <a class="el" href="app__jack_8c_source.html#l00387">init_jack_data()</a>, <a class="el" href="app__queue_8c_source.html#l01956">join_queue()</a>, <a class="el" href="chan__local_8c_source.html#l00582">local_hangup()</a>, <a class="el" href="chan__iax2_8c_source.html#l06668">manager_iax2_show_peer_list()</a>, <a class="el" href="app__osplookup_8c_source.html#l01255">ospauth_exec()</a>, <a class="el" href="app__osplookup_8c_source.html#l01657">ospfinished_exec()</a>, <a class="el" href="app__osplookup_8c_source.html#l01335">osplookup_exec()</a>, <a class="el" href="app__osplookup_8c_source.html#l01503">ospnext_exec()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l01104">parse_status()</a>, <a class="el" href="app__queue_8c_source.html#l05031">queue_exec()</a>, <a class="el" href="app__read_8c_source.html#l00127">read_exec()</a>, <a class="el" href="app__readexten_8c_source.html#l00128">readexten_exec()</a>, <a class="el" href="res__config__ldap_8c_source.html#l01717">realtime_ldap_status()</a>, <a class="el" href="app__queue_8c_source.html#l02467">ring_entry()</a>, <a class="el" href="app__rpt_8c_source.html#l10730">rpt()</a>, <a class="el" href="app__dahdiras_8c_source.html#l00132">run_ras()</a>, <a class="el" href="app__sendtext_8c_source.html#l00075">sendtext_exec()</a>, <a class="el" href="app__url_8c_source.html#l00093">sendurl_exec()</a>, <a class="el" href="chan__unistim_8c_source.html#l02979">show_entry_history()</a>, <a class="el" href="app__transfer_8c_source.html#l00077">transfer_exec()</a>, <a class="el" href="app__queue_8c_source.html#l02845">wait_for_answer()</a>, and <a class="el" href="app__queue_8c_source.html#l03195">wait_our_turn()</a>.</p>

</div>
</div>
<a class="anchor" id="af25d6dc49269fa2003ac7c7fa6f13915"></a><!-- doxytag: member="app_jack.c::str" ref="af25d6dc49269fa2003ac7c7fa6f13915" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="evt_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__jack_8c_source.html#l00142">142</a> of file <a class="el" href="app__jack_8c_source.html">app_jack.c</a>.</p>

<p>Referenced by <a class="el" href="misdn__config_8c_source.html#l00475">_free_port_cfg()</a>, <a class="el" href="func__curl_8c_source.html#l00397">acf_curl_exec()</a>, <a class="el" href="manager_8c_source.html#l01904">action_status()</a>, <a class="el" href="evt_8c_source.html#l00300">add_publish_event()</a>, <a class="el" href="evt_8c_source.html#l00362">add_subscribe_event()</a>, <a class="el" href="chan__usbradio_8c_source.html#l00706">amixer_max()</a>, <a class="el" href="event_8c_source.html#l00680">ast_event_subscribe()</a>, <a class="el" href="hashtab_8c_source.html#l00153">ast_hashtab_hash_string()</a>, <a class="el" href="hashtab_8c_source.html#l00181">ast_hashtab_hash_string_nocase()</a>, <a class="el" href="hashtab_8c_source.html#l00170">ast_hashtab_hash_string_sax()</a>, <a class="el" href="chan__sip_8c_source.html#l19601">do_magic_pickup()</a>, <a class="el" href="app__followme_8c_source.html#l00917">find_realtime()</a>, <a class="el" href="app__playtones_8c_source.html#l00075">handle_playtones()</a>, <a class="el" href="tcptls_8c_source.html#l00128">handle_tcptls_connection()</a>, <a class="el" href="config_8c_source.html#l00137">hash_string()</a>, <a class="el" href="chan__usbradio_8c_source.html#l00877">hid_device_init()</a>, <a class="el" href="chan__usbradio_8c_source.html#l00939">hid_device_mklist()</a>, <a class="el" href="iax2-parser_8c_source.html#l00717">iax_parse_ies()</a>, <a class="el" href="config_8c_source.html#l00083">init_appendbuf()</a>, <a class="el" href="chan__jingle_8c_source.html#l00800">jingle_new()</a>, <a class="el" href="app__jack_8c_source.html#l00169">log_jack_status()</a>, <a class="el" href="event_8c_source.html#l00401">match_ie_val()</a>, <a class="el" href="misdn__config_8c_source.html#l00517">misdn_cfg_get()</a>, <a class="el" href="misdn__config_8c_source.html#l00742">misdn_cfg_get_config_string()</a>, <a class="el" href="misdn__config_8c_source.html#l00847">misdn_cfg_get_next_port()</a>, <a class="el" href="misdn__config_8c_source.html#l00716">misdn_cfg_get_ports_string()</a>, <a class="el" href="misdn__config_8c_source.html#l00681">misdn_cfg_is_group_method()</a>, <a class="el" href="misdn__config_8c_source.html#l00674">misdn_cfg_is_port_valid()</a>, <a class="el" href="config_8c_source.html#l00922">process_text_line()</a>, <a class="el" href="func__strings_8c_source.html#l00508">regex()</a>, <a class="el" href="chan__usbradio_8c_source.html#l00750">setamixer()</a>, <a class="el" href="chan__usbradio_8c_source.html#l01017">usb_get_usbdev()</a>, <a class="el" href="manager_8c_source.html#l03665">variable_count_cmp_fn()</a>, and <a class="el" href="ael_8tab_8c_source.html#l01843">yyparse()</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:18:56 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
