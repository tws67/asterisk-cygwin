<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:23:33 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_1ab815038f534adda65c8b4ae4993449.html">include</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_16d825f1fa9ecca2e70b1a8d9256d0e6.html">asterisk</a>
  </div>
</div>
<div class="contents">
<h1>udptl.h File Reference</h1>
<p>UDPTL support for T.38.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="network_8h_source.html">asterisk/network.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="frame_8h_source.html">asterisk/frame.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="io_8h_source.html">asterisk/io.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="sched_8h_source.html">asterisk/sched.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="channel_8h_source.html">asterisk/channel.h</a>&quot;</code><br/>

<p><a href="udptl_8h_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__udptl__protocol.html">ast_udptl_protocol</a></td></tr>
<tr><td colspan="2"><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef int(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#a04e7bb36362e3da0ab84dbceb6e3dc9e">ast_udptl_callback</a> )(struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl, struct <a class="el" href="structast__frame.html">ast_frame</a> *<a class="el" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>, void *data)</td></tr>
<tr><td colspan="2"><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795">ast_t38_ec_modes</a> { <a class="el" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795afa83e5a16b5198b5d34543cb94114cd6">UDPTL_ERROR_CORRECTION_NONE</a>, 
<a class="el" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795aa0e8972e48ad95a77cbe2c66e174fd76">UDPTL_ERROR_CORRECTION_FEC</a>, 
<a class="el" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795afbc322f60eade115e42b66d4ab4dec83">UDPTL_ERROR_CORRECTION_REDUNDANCY</a>
 }</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#aa36dcbb2b471899ee58d5afb1f4fa49b">ast_udptl_bridge</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c0, struct <a class="el" href="structast__channel.html">ast_channel</a> *c1, int flags, struct <a class="el" href="structast__frame.html">ast_frame</a> **fo, struct <a class="el" href="structast__channel.html">ast_channel</a> **rc)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#a0c14cc450fe0891cbee26ffd74cf77cb">ast_udptl_destroy</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#a424e6e48fcfa491a9ee6da3c8a7162a3">ast_udptl_fd</a> (const struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795">ast_t38_ec_modes</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#a10b606a6ac66cc148ea1c43a508ebb6d">ast_udptl_get_error_correction_scheme</a> (const struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#ad81d6dc0df37c1b771f803c431cc102a">ast_udptl_get_far_max_datagram</a> (const struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#a72d15492e0a4594c95848800a93017f3">ast_udptl_get_far_max_ifp</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">retrieves far max ifp  <a href="#a72d15492e0a4594c95848800a93017f3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#aac14f584f25701499a840fd9b1ee30a5">ast_udptl_get_local_max_datagram</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">retrieves local_max_datagram.  <a href="#aac14f584f25701499a840fd9b1ee30a5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#a7a96d2874c787b03db8c8b21ffcee89c">ast_udptl_get_peer</a> (const struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl, struct sockaddr_in *them)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#ac191d3e1fcdff6075d0eb5f9ebcbb96c">ast_udptl_get_us</a> (const struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl, struct sockaddr_in *us)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#ad68827c8f88b83c06791a96e595ed978">ast_udptl_init</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#a310872d2ca901a1c6d42ca510b69ed48">ast_udptl_new</a> (struct <a class="el" href="structsched__context.html">sched_context</a> *<a class="el" href="structsched.html">sched</a>, struct <a class="el" href="structio__context.html">io_context</a> *<a class="el" href="pbx__dundi_8c.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a>, int callbackmode)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#afbcd53e47ee0ca638b3a44c6ce978263">ast_udptl_new_with_bindaddr</a> (struct <a class="el" href="structsched__context.html">sched_context</a> *<a class="el" href="structsched.html">sched</a>, struct <a class="el" href="structio__context.html">io_context</a> *<a class="el" href="pbx__dundi_8c.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a>, int callbackmode, struct in_addr in)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#a4c3c0f932544c3920055554c473d6576">ast_udptl_proto_register</a> (struct <a class="el" href="structast__udptl__protocol.html">ast_udptl_protocol</a> *proto)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#ac1d0c92d37bf00a7138bf30b11980df5">ast_udptl_proto_unregister</a> (struct <a class="el" href="structast__udptl__protocol.html">ast_udptl_protocol</a> *proto)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#ae0808bce80557e3107c9030bd8a832fe">ast_udptl_read</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#aef56fae41fcf91924375991a5c4e7568">ast_udptl_reload</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#a457795f4074df4221f206ae848290e94">ast_udptl_reset</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#ac410178703bbd10effbedd9823b89f2a">ast_udptl_set_callback</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl, <a class="el" href="udptl_8h.html#a04e7bb36362e3da0ab84dbceb6e3dc9e">ast_udptl_callback</a> callback)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#ab2b6f583b1e2e2efdd87c0f6a7264d42">ast_udptl_set_data</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl, void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#aec066a1e8d5b80dfab8c4a5296e65e48">ast_udptl_set_error_correction_scheme</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl, enum <a class="el" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795">ast_t38_ec_modes</a> ec)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#abb364758e66c04d5d791fc51d2b3ed6d">ast_udptl_set_far_max_datagram</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl, unsigned int max_datagram)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">sets far max datagram size. If max_datagram is = 0, the far max datagram size is set to a default value.  <a href="#abb364758e66c04d5d791fc51d2b3ed6d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#a6c2d98f9407493efbbdc9462717a2d9d">ast_udptl_set_local_max_ifp</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl, unsigned int max_ifp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#a9c846a58b645e848c616a69c24633d1f">ast_udptl_set_m_type</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl, unsigned int pt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#aa610b69fe43ec50c49d39e8613e07a14">ast_udptl_set_peer</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl, const struct sockaddr_in *them)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#a697d541fd523e36f898d699cbfda988f">ast_udptl_set_tag</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl, const char *<a class="el" href="chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a>,...)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Associates a character string 'tag' with a UDPTL session.  <a href="#a697d541fd523e36f898d699cbfda988f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#abb4f854b993e4debf1547eebbb351d46">ast_udptl_set_udptlmap_type</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl, unsigned int pt, char *<a class="el" href="structmimeType.html">mimeType</a>, char *mimeSubtype)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#a76d8051a97100fa917b8c43bf58aac9c">ast_udptl_setnat</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl, int <a class="el" href="chan__mgcp_8c.html#ada540a5f25f7302dc1a3d17ccfa59b10">nat</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#aa37b040d6f8a975f25022e73e125b99e">ast_udptl_setqos</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl, unsigned int <a class="el" href="pbx__dundi_8c.html#a25a9305efab3b493ca2519562fcec3d5">tos</a>, unsigned int <a class="el" href="chan__unistim_8c.html#ae91dad65f553f7afebe4af507803bc7f">cos</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#a3fb4dcecfa292b0aae4fd4dbad1b8551">ast_udptl_stop</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8h.html#aa5fd608ad072447c2ea3e2bffcb02b91">ast_udptl_write</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl, struct <a class="el" href="structast__frame.html">ast_frame</a> *<a class="el" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>)</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>UDPTL support for T.38. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Steve Underwood &lt;<a href="mailto:steveu@coppice.org">steveu@coppice.org</a>&gt; <a class="el" href="udptl_8c.html">udptl.c</a> </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000062">Todo:</a></b></dt><dd>add doxygen documentation to this file! </dd></dl>

<p>Definition in file <a class="el" href="udptl_8h_source.html">udptl.h</a>.</p>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="a04e7bb36362e3da0ab84dbceb6e3dc9e"></a><!-- doxytag: member="udptl.h::ast_udptl_callback" ref="a04e7bb36362e3da0ab84dbceb6e3dc9e" args=")(struct ast_udptl *udptl, struct ast_frame *f, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int(* <a class="el" href="udptl_8h.html#a04e7bb36362e3da0ab84dbceb6e3dc9e">ast_udptl_callback</a>)(struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl, struct <a class="el" href="structast__frame.html">ast_frame</a> *<a class="el" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>, void *data)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8h_source.html#l00057">57</a> of file <a class="el" href="udptl_8h_source.html">udptl.h</a>.</p>

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="af968992af6d7e1186843a2eb371c9795"></a><!-- doxytag: member="udptl.h::ast_t38_ec_modes" ref="af968992af6d7e1186843a2eb371c9795" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795">ast_t38_ec_modes</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="af968992af6d7e1186843a2eb371c9795afa83e5a16b5198b5d34543cb94114cd6"></a><!-- doxytag: member="UDPTL_ERROR_CORRECTION_NONE" ref="af968992af6d7e1186843a2eb371c9795afa83e5a16b5198b5d34543cb94114cd6" args="" -->UDPTL_ERROR_CORRECTION_NONE</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af968992af6d7e1186843a2eb371c9795aa0e8972e48ad95a77cbe2c66e174fd76"></a><!-- doxytag: member="UDPTL_ERROR_CORRECTION_FEC" ref="af968992af6d7e1186843a2eb371c9795aa0e8972e48ad95a77cbe2c66e174fd76" args="" -->UDPTL_ERROR_CORRECTION_FEC</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af968992af6d7e1186843a2eb371c9795afbc322f60eade115e42b66d4ab4dec83"></a><!-- doxytag: member="UDPTL_ERROR_CORRECTION_REDUNDANCY" ref="af968992af6d7e1186843a2eb371c9795afbc322f60eade115e42b66d4ab4dec83" args="" -->UDPTL_ERROR_CORRECTION_REDUNDANCY</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="udptl_8h_source.html#l00036">36</a> of file <a class="el" href="udptl_8h_source.html">udptl.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00036"></a>00036                       {
<a name="l00037"></a>00037     <a class="code" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795afa83e5a16b5198b5d34543cb94114cd6">UDPTL_ERROR_CORRECTION_NONE</a>,
<a name="l00038"></a>00038     <a class="code" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795aa0e8972e48ad95a77cbe2c66e174fd76">UDPTL_ERROR_CORRECTION_FEC</a>,
<a name="l00039"></a>00039     <a class="code" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795afbc322f60eade115e42b66d4ab4dec83">UDPTL_ERROR_CORRECTION_REDUNDANCY</a>
<a name="l00040"></a>00040 };
</pre></div></p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="aa36dcbb2b471899ee58d5afb1f4fa49b"></a><!-- doxytag: member="udptl.h::ast_udptl_bridge" ref="aa36dcbb2b471899ee58d5afb1f4fa49b" args="(struct ast_channel *c0, struct ast_channel *c1, int flags, struct ast_frame **fo, struct ast_channel **rc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_udptl_bridge </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> **&nbsp;</td>
          <td class="paramname"> <em>fo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> **&nbsp;</td>
          <td class="paramname"> <em>rc</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l01150">1150</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02037">ast_channel_trylock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="channel_8c_source.html#l00461">ast_check_hangup()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8h_source.html#l00120">AST_FRAME_MODEM</a>, <a class="el" href="frame_8h_source.html#l00462">ast_frfree</a>, <a class="el" href="utils_8c_source.html#l00431">ast_inet_ntoa()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8c_source.html#l03100">ast_read()</a>, <a class="el" href="udptl_8c_source.html#l01030">ast_udptl_get_peer()</a>, <a class="el" href="channel_8c_source.html#l02384">ast_waitfor_n()</a>, <a class="el" href="channel_8c_source.html#l03411">ast_write()</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="udptl_8c_source.html#l01136">get_proto()</a>, <a class="el" href="structast__udptl__protocol.html#a1db47456e7d9130f00376329f2f648ec">ast_udptl_protocol::get_udptl_info</a>, <a class="el" href="network_8h_source.html#l00090">inaddrcmp()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="channel_8h_source.html#l00408">ast_channel::masq</a>, <a class="el" href="channel_8h_source.html#l00409">ast_channel::masqr</a>, <a class="el" href="structast__udptl__protocol.html#a7e1926497b35afd62a35a5b1faa17d76">ast_udptl_protocol::set_udptl_peer</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01151"></a>01151 {
<a name="l01152"></a>01152    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l01153"></a>01153    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *who;
<a name="l01154"></a>01154    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *cs[3];
<a name="l01155"></a>01155    <span class="keyword">struct </span><a class="code" href="structast__udptl.html" title="Structure for an UDPTL session.">ast_udptl</a> *p0;
<a name="l01156"></a>01156    <span class="keyword">struct </span><a class="code" href="structast__udptl.html" title="Structure for an UDPTL session.">ast_udptl</a> *p1;
<a name="l01157"></a>01157    <span class="keyword">struct </span><a class="code" href="structast__udptl__protocol.html">ast_udptl_protocol</a> *pr0;
<a name="l01158"></a>01158    <span class="keyword">struct </span><a class="code" href="structast__udptl__protocol.html">ast_udptl_protocol</a> *pr1;
<a name="l01159"></a>01159    <span class="keyword">struct </span>sockaddr_in ac0;
<a name="l01160"></a>01160    <span class="keyword">struct </span>sockaddr_in ac1;
<a name="l01161"></a>01161    <span class="keyword">struct </span>sockaddr_in t0;
<a name="l01162"></a>01162    <span class="keyword">struct </span>sockaddr_in t1;
<a name="l01163"></a>01163    <span class="keywordtype">void</span> *pvt0;
<a name="l01164"></a>01164    <span class="keywordtype">void</span> *pvt1;
<a name="l01165"></a>01165    <span class="keywordtype">int</span> to;
<a name="l01166"></a>01166    
<a name="l01167"></a>01167    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(c0);
<a name="l01168"></a>01168    <span class="keywordflow">while</span> (<a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(c1)) {
<a name="l01169"></a>01169       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l01170"></a>01170       usleep(1);
<a name="l01171"></a>01171       <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(c0);
<a name="l01172"></a>01172    }
<a name="l01173"></a>01173    pr0 = <a class="code" href="udptl_8c.html#a81bfe3abc4b0e393b4d6f7570c1f18bf">get_proto</a>(c0);
<a name="l01174"></a>01174    pr1 = <a class="code" href="udptl_8c.html#a81bfe3abc4b0e393b4d6f7570c1f18bf">get_proto</a>(c1);
<a name="l01175"></a>01175    <span class="keywordflow">if</span> (!pr0) {
<a name="l01176"></a>01176       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Can&apos;t find native functions for channel &apos;%s&apos;\n&quot;</span>, c0-&gt;name);
<a name="l01177"></a>01177       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l01178"></a>01178       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l01179"></a>01179       <span class="keywordflow">return</span> -1;
<a name="l01180"></a>01180    }
<a name="l01181"></a>01181    <span class="keywordflow">if</span> (!pr1) {
<a name="l01182"></a>01182       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Can&apos;t find native functions for channel &apos;%s&apos;\n&quot;</span>, c1-&gt;name);
<a name="l01183"></a>01183       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l01184"></a>01184       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l01185"></a>01185       <span class="keywordflow">return</span> -1;
<a name="l01186"></a>01186    }
<a name="l01187"></a>01187    pvt0 = c0-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l01188"></a>01188    pvt1 = c1-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l01189"></a>01189    p0 = pr0-&gt;<a class="code" href="structast__udptl__protocol.html#a1db47456e7d9130f00376329f2f648ec" title="Get UDPTL struct, or NULL if unwilling to transfer.">get_udptl_info</a>(c0);
<a name="l01190"></a>01190    p1 = pr1-&gt;<a class="code" href="structast__udptl__protocol.html#a1db47456e7d9130f00376329f2f648ec" title="Get UDPTL struct, or NULL if unwilling to transfer.">get_udptl_info</a>(c1);
<a name="l01191"></a>01191    <span class="keywordflow">if</span> (!p0 || !p1) {
<a name="l01192"></a>01192       <span class="comment">/* Somebody doesn&apos;t want to play... */</span>
<a name="l01193"></a>01193       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l01194"></a>01194       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l01195"></a>01195       <span class="keywordflow">return</span> -2;
<a name="l01196"></a>01196    }
<a name="l01197"></a>01197    <span class="keywordflow">if</span> (pr0-&gt;<a class="code" href="structast__udptl__protocol.html#a7e1926497b35afd62a35a5b1faa17d76" title="Set UDPTL peer.">set_udptl_peer</a>(c0, p1)) {
<a name="l01198"></a>01198       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Channel &apos;%s&apos; failed to talk to &apos;%s&apos;\n&quot;</span>, c0-&gt;name, c1-&gt;name);
<a name="l01199"></a>01199       memset(&amp;ac1, 0, <span class="keyword">sizeof</span>(ac1));
<a name="l01200"></a>01200    } <span class="keywordflow">else</span> {
<a name="l01201"></a>01201       <span class="comment">/* Store UDPTL peer */</span>
<a name="l01202"></a>01202       <a class="code" href="udptl_8h.html#a7a96d2874c787b03db8c8b21ffcee89c">ast_udptl_get_peer</a>(p1, &amp;ac1);
<a name="l01203"></a>01203    }
<a name="l01204"></a>01204    <span class="keywordflow">if</span> (pr1-&gt;<a class="code" href="structast__udptl__protocol.html#a7e1926497b35afd62a35a5b1faa17d76" title="Set UDPTL peer.">set_udptl_peer</a>(c1, p0)) {
<a name="l01205"></a>01205       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Channel &apos;%s&apos; failed to talk back to &apos;%s&apos;\n&quot;</span>, c1-&gt;name, c0-&gt;name);
<a name="l01206"></a>01206       memset(&amp;ac0, 0, <span class="keyword">sizeof</span>(ac0));
<a name="l01207"></a>01207    } <span class="keywordflow">else</span> {
<a name="l01208"></a>01208       <span class="comment">/* Store UDPTL peer */</span>
<a name="l01209"></a>01209       <a class="code" href="udptl_8h.html#a7a96d2874c787b03db8c8b21ffcee89c">ast_udptl_get_peer</a>(p0, &amp;ac0);
<a name="l01210"></a>01210    }
<a name="l01211"></a>01211    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l01212"></a>01212    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l01213"></a>01213    cs[0] = c0;
<a name="l01214"></a>01214    cs[1] = c1;
<a name="l01215"></a>01215    cs[2] = NULL;
<a name="l01216"></a>01216    <span class="keywordflow">for</span> (;;) {
<a name="l01217"></a>01217       <span class="keywordflow">if</span> ((c0-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a> != pvt0) ||
<a name="l01218"></a>01218          (c1-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a> != pvt1) ||
<a name="l01219"></a>01219          (c0-&gt;<a class="code" href="structast__channel.html#ae38ae730b987d648a6fe1c84c8a13442">masq</a> || c0-&gt;<a class="code" href="structast__channel.html#abb53278bc00235a5ff76fc8badbe6363">masqr</a> || c1-&gt;<a class="code" href="structast__channel.html#ae38ae730b987d648a6fe1c84c8a13442">masq</a> || c1-&gt;<a class="code" href="structast__channel.html#abb53278bc00235a5ff76fc8badbe6363">masqr</a>)) {
<a name="l01220"></a>01220             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Oooh, something is weird, backing out\n&quot;</span>);
<a name="l01221"></a>01221             <span class="comment">/* Tell it to try again later */</span>
<a name="l01222"></a>01222             <span class="keywordflow">return</span> -3;
<a name="l01223"></a>01223       }
<a name="l01224"></a>01224       to = -1;
<a name="l01225"></a>01225       <a class="code" href="udptl_8h.html#a7a96d2874c787b03db8c8b21ffcee89c">ast_udptl_get_peer</a>(p1, &amp;t1);
<a name="l01226"></a>01226       <a class="code" href="udptl_8h.html#a7a96d2874c787b03db8c8b21ffcee89c">ast_udptl_get_peer</a>(p0, &amp;t0);
<a name="l01227"></a>01227       <span class="keywordflow">if</span> (<a class="code" href="network_8h.html#a645471815fc2fff930c75b0494197b3d" title="Compares the source address and port of two sockaddr_in.">inaddrcmp</a>(&amp;t1, &amp;ac1)) {
<a name="l01228"></a>01228          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Oooh, &apos;%s&apos; changed end address to %s:%d\n&quot;</span>, 
<a name="l01229"></a>01229             c1-&gt;name, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(t1.sin_addr), ntohs(t1.sin_port));
<a name="l01230"></a>01230          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Oooh, &apos;%s&apos; was %s:%d\n&quot;</span>, 
<a name="l01231"></a>01231             c1-&gt;name, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(ac1.sin_addr), ntohs(ac1.sin_port));
<a name="l01232"></a>01232          memcpy(&amp;ac1, &amp;t1, <span class="keyword">sizeof</span>(ac1));
<a name="l01233"></a>01233       }
<a name="l01234"></a>01234       <span class="keywordflow">if</span> (<a class="code" href="network_8h.html#a645471815fc2fff930c75b0494197b3d" title="Compares the source address and port of two sockaddr_in.">inaddrcmp</a>(&amp;t0, &amp;ac0)) {
<a name="l01235"></a>01235          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Oooh, &apos;%s&apos; changed end address to %s:%d\n&quot;</span>, 
<a name="l01236"></a>01236             c0-&gt;name, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(t0.sin_addr), ntohs(t0.sin_port));
<a name="l01237"></a>01237          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Oooh, &apos;%s&apos; was %s:%d\n&quot;</span>, 
<a name="l01238"></a>01238             c0-&gt;name, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(ac0.sin_addr), ntohs(ac0.sin_port));
<a name="l01239"></a>01239          memcpy(&amp;ac0, &amp;t0, <span class="keyword">sizeof</span>(ac0));
<a name="l01240"></a>01240       }
<a name="l01241"></a>01241       who = <a class="code" href="channel_8h.html#aec8ce59b78afbd3651f3de011f13290a" title="Waits for input on a group of channels Wait for input on an array of channels for...">ast_waitfor_n</a>(cs, 2, &amp;to);
<a name="l01242"></a>01242       <span class="keywordflow">if</span> (!who) {
<a name="l01243"></a>01243          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Ooh, empty read...\n&quot;</span>);
<a name="l01244"></a>01244          <span class="comment">/* check for hangup / whentohangup */</span>
<a name="l01245"></a>01245          <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd" title="Check to see if a channel is needing hang up.">ast_check_hangup</a>(c0) || <a class="code" href="channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd" title="Check to see if a channel is needing hang up.">ast_check_hangup</a>(c1))
<a name="l01246"></a>01246             <span class="keywordflow">break</span>;
<a name="l01247"></a>01247          <span class="keywordflow">continue</span>;
<a name="l01248"></a>01248       }
<a name="l01249"></a>01249       f = <a class="code" href="channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1" title="Reads a frame.">ast_read</a>(who);
<a name="l01250"></a>01250       <span class="keywordflow">if</span> (!f) {
<a name="l01251"></a>01251          *fo = f;
<a name="l01252"></a>01252          *rc = who;
<a name="l01253"></a>01253          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Oooh, got a %s\n&quot;</span>, f ? <span class="stringliteral">&quot;digit&quot;</span> : <span class="stringliteral">&quot;hangup&quot;</span>);
<a name="l01254"></a>01254          <span class="comment">/* That&apos;s all we needed */</span>
<a name="l01255"></a>01255          <span class="keywordflow">return</span> 0;
<a name="l01256"></a>01256       } <span class="keywordflow">else</span> {
<a name="l01257"></a>01257          <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ad99b86353343f422bda01163898b2eea">AST_FRAME_MODEM</a>) {
<a name="l01258"></a>01258             <span class="comment">/* Forward T.38 frames if they happen upon us */</span>
<a name="l01259"></a>01259             <span class="keywordflow">if</span> (who == c0) {
<a name="l01260"></a>01260                <a class="code" href="channel_8h.html#a79c413d51b7135404d5cacf811649a61" title="Write a frame to a channel This function writes the given frame to the indicated...">ast_write</a>(c1, f);
<a name="l01261"></a>01261             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (who == c1) {
<a name="l01262"></a>01262                <a class="code" href="channel_8h.html#a79c413d51b7135404d5cacf811649a61" title="Write a frame to a channel This function writes the given frame to the indicated...">ast_write</a>(c0, f);
<a name="l01263"></a>01263             }
<a name="l01264"></a>01264          }
<a name="l01265"></a>01265          <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l01266"></a>01266       }
<a name="l01267"></a>01267       <span class="comment">/* Swap priority. Not that it&apos;s a big deal at this point */</span>
<a name="l01268"></a>01268       cs[2] = cs[0];
<a name="l01269"></a>01269       cs[0] = cs[1];
<a name="l01270"></a>01270       cs[1] = cs[2];
<a name="l01271"></a>01271    }
<a name="l01272"></a>01272    <span class="keywordflow">return</span> -1;
<a name="l01273"></a>01273 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0c14cc450fe0891cbee26ffd74cf77cb"></a><!-- doxytag: member="udptl.h::ast_udptl_destroy" ref="a0c14cc450fe0891cbee26ffd74cf77cb" args="(struct ast_udptl *udptl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_udptl_destroy </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l01049">1049</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="io_8c_source.html#l00236">ast_io_remove()</a>, <a class="el" href="udptl_8c_source.html#l00117">ast_udptl::fd</a>, <a class="el" href="udptl_8c_source.html#l00128">ast_udptl::io</a>, <a class="el" href="udptl_8c_source.html#l00126">ast_udptl::ioid</a>, and <a class="el" href="udptl_8c_source.html#l00130">ast_udptl::tag</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l05498">__sip_destroy()</a>, and <a class="el" href="chan__sip_8c_source.html#l05102">create_addr_from_peer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01050"></a>01050 {
<a name="l01051"></a>01051    <span class="keywordflow">if</span> (udptl-&gt;<a class="code" href="structast__udptl.html#a378e4ecae74acafadf99a691f65f2419">ioid</a>)
<a name="l01052"></a>01052       <a class="code" href="io_8h.html#afbf1092b96128d07d0dd08dfa898f4d5" title="Removes an IO context.">ast_io_remove</a>(udptl-&gt;<a class="code" href="structast__udptl.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a>, udptl-&gt;<a class="code" href="structast__udptl.html#a378e4ecae74acafadf99a691f65f2419">ioid</a>);
<a name="l01053"></a>01053    <span class="keywordflow">if</span> (udptl-&gt;<a class="code" href="structast__udptl.html#a6f8059414f0228f0256115e024eeed4b">fd</a> &gt; -1)
<a name="l01054"></a>01054       close(udptl-&gt;<a class="code" href="structast__udptl.html#a6f8059414f0228f0256115e024eeed4b">fd</a>);
<a name="l01055"></a>01055    <span class="keywordflow">if</span> (udptl-&gt;<a class="code" href="structast__udptl.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a>)
<a name="l01056"></a>01056       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(udptl-&gt;<a class="code" href="structast__udptl.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a>);
<a name="l01057"></a>01057    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(udptl);
<a name="l01058"></a>01058 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a424e6e48fcfa491a9ee6da3c8a7162a3"></a><!-- doxytag: member="udptl.h::ast_udptl_fd" ref="a424e6e48fcfa491a9ee6da3c8a7162a3" args="(const struct ast_udptl *udptl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_udptl_fd </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00640">640</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00117">ast_udptl::fd</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l00999">__oh323_new()</a>, and <a class="el" href="chan__sip_8c_source.html#l06599">sip_new()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00641"></a>00641 {
<a name="l00642"></a>00642    <span class="keywordflow">return</span> udptl-&gt;<a class="code" href="structast__udptl.html#a6f8059414f0228f0256115e024eeed4b">fd</a>;
<a name="l00643"></a>00643 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a10b606a6ac66cc148ea1c43a508ebb6d"></a><!-- doxytag: member="udptl.h::ast_udptl_get_error_correction_scheme" ref="a10b606a6ac66cc148ea1c43a508ebb6d" args="(const struct ast_udptl *udptl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795">ast_t38_ec_modes</a> ast_udptl_get_error_correction_scheme </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00831">831</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00136">ast_udptl::error_correction_scheme</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l10016">add_sdp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00832"></a>00832 {
<a name="l00833"></a>00833    <span class="keywordflow">return</span> udptl-&gt;<a class="code" href="structast__udptl.html#ac215dbaf54319e257d2c33ecd70c36c5">error_correction_scheme</a>;
<a name="l00834"></a>00834 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad81d6dc0df37c1b771f803c431cc102a"></a><!-- doxytag: member="udptl.h::ast_udptl_get_far_max_datagram" ref="ad81d6dc0df37c1b771f803c431cc102a" args="(const struct ast_udptl *udptl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int ast_udptl_get_far_max_datagram </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00899">899</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00151">ast_udptl::far_max_datagram</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l08040">process_sdp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00900"></a>00900 {
<a name="l00901"></a>00901    <span class="keywordflow">if</span> (udptl-&gt;<a class="code" href="structast__udptl.html#a57bdb7e31fa5ba4d3f96658d472e5b94">far_max_datagram</a> &lt; 0) {
<a name="l00902"></a>00902       <span class="keywordflow">return</span> 0;
<a name="l00903"></a>00903    }
<a name="l00904"></a>00904    <span class="keywordflow">return</span> udptl-&gt;<a class="code" href="structast__udptl.html#a57bdb7e31fa5ba4d3f96658d472e5b94">far_max_datagram</a>;
<a name="l00905"></a>00905 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a72d15492e0a4594c95848800a93017f3"></a><!-- doxytag: member="udptl.h::ast_udptl_get_far_max_ifp" ref="a72d15492e0a4594c95848800a93017f3" args="(struct ast_udptl *udptl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int ast_udptl_get_far_max_ifp </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>retrieves far max ifp </p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>positive</em>&nbsp;</td><td>value representing max ifp size </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if no value is present </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00907">907</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00763">calculate_far_max_ifp()</a>, and <a class="el" href="udptl_8c_source.html#l00165">ast_udptl::far_max_ifp</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l05019">change_t38_state()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00908"></a>00908 {
<a name="l00909"></a>00909    <span class="keywordflow">if</span> (udptl-&gt;<a class="code" href="structast__udptl.html#a95f0114a9c3434fbe3743868a613480b">far_max_ifp</a> == -1) {
<a name="l00910"></a>00910       <a class="code" href="udptl_8c.html#a541dbf72506ff6bead2d506613979e24">calculate_far_max_ifp</a>(udptl);
<a name="l00911"></a>00911    }
<a name="l00912"></a>00912 
<a name="l00913"></a>00913    <span class="keywordflow">if</span> (udptl-&gt;<a class="code" href="structast__udptl.html#a95f0114a9c3434fbe3743868a613480b">far_max_ifp</a> &lt; 0) {
<a name="l00914"></a>00914       <span class="keywordflow">return</span> 0;
<a name="l00915"></a>00915    }
<a name="l00916"></a>00916    <span class="keywordflow">return</span> udptl-&gt;<a class="code" href="structast__udptl.html#a95f0114a9c3434fbe3743868a613480b">far_max_ifp</a>;
<a name="l00917"></a>00917 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aac14f584f25701499a840fd9b1ee30a5"></a><!-- doxytag: member="udptl.h::ast_udptl_get_local_max_datagram" ref="aac14f584f25701499a840fd9b1ee30a5" args="(struct ast_udptl *udptl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int ast_udptl_get_local_max_datagram </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>retrieves local_max_datagram. </p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>positive</em>&nbsp;</td><td>value representing max datagram size. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if no value is present </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00875">875</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00722">calculate_local_max_datagram()</a>, and <a class="el" href="udptl_8c_source.html#l00157">ast_udptl::local_max_datagram</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l10016">add_sdp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00876"></a>00876 {
<a name="l00877"></a>00877    <span class="keywordflow">if</span> (udptl-&gt;<a class="code" href="structast__udptl.html#aa6de52220e98717c22a45506d1aad1eb">local_max_datagram</a> == -1) {
<a name="l00878"></a>00878       <a class="code" href="udptl_8c.html#ab3acebf54181c51340a4a3fa080525a8">calculate_local_max_datagram</a>(udptl);
<a name="l00879"></a>00879    }
<a name="l00880"></a>00880 
<a name="l00881"></a>00881    <span class="comment">/* this function expects a unsigned value in return. */</span>
<a name="l00882"></a>00882    <span class="keywordflow">if</span> (udptl-&gt;<a class="code" href="structast__udptl.html#aa6de52220e98717c22a45506d1aad1eb">local_max_datagram</a> &lt; 0) {
<a name="l00883"></a>00883       <span class="keywordflow">return</span> 0;
<a name="l00884"></a>00884    }
<a name="l00885"></a>00885    <span class="keywordflow">return</span> udptl-&gt;<a class="code" href="structast__udptl.html#aa6de52220e98717c22a45506d1aad1eb">local_max_datagram</a>;
<a name="l00886"></a>00886 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7a96d2874c787b03db8c8b21ffcee89c"></a><!-- doxytag: member="udptl.h::ast_udptl_get_peer" ref="a7a96d2874c787b03db8c8b21ffcee89c" args="(const struct ast_udptl *udptl, struct sockaddr_in *them)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_udptl_get_peer </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>them</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l01030">1030</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00125">ast_udptl::them</a>.</p>

<p>Referenced by <a class="el" href="udptl_8c_source.html#l01150">ast_udptl_bridge()</a>, and <a class="el" href="chan__sip_8c_source.html#l25198">sip_set_udptl_peer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01031"></a>01031 {
<a name="l01032"></a>01032    memset(them, 0, <span class="keyword">sizeof</span>(*them));
<a name="l01033"></a>01033    them-&gt;sin_family = AF_INET;
<a name="l01034"></a>01034    them-&gt;sin_port = udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port;
<a name="l01035"></a>01035    them-&gt;sin_addr = udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr;
<a name="l01036"></a>01036 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac191d3e1fcdff6075d0eb5f9ebcbb96c"></a><!-- doxytag: member="udptl.h::ast_udptl_get_us" ref="ac191d3e1fcdff6075d0eb5f9ebcbb96c" args="(const struct ast_udptl *udptl, struct sockaddr_in *us)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_udptl_get_us </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>us</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l01038">1038</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00124">ast_udptl::us</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l10016">add_sdp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01039"></a>01039 {
<a name="l01040"></a>01040    memcpy(us, &amp;udptl-&gt;<a class="code" href="structast__udptl.html#a3c2346010ce32cf02b7c85203c76a20d">us</a>, <span class="keyword">sizeof</span>(udptl-&gt;<a class="code" href="structast__udptl.html#a3c2346010ce32cf02b7c85203c76a20d">us</a>));
<a name="l01041"></a>01041 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad68827c8f88b83c06791a96e595ed978"></a><!-- doxytag: member="udptl.h::ast_udptl_init" ref="ad68827c8f88b83c06791a96e595ed978" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_udptl_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l01448">1448</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l01342">__ast_udptl_reload()</a>, <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, and <a class="el" href="cli_8c_source.html#l01927">ast_cli_register_multiple()</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01449"></a>01449 {
<a name="l01450"></a>01450    <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(<a class="code" href="udptl_8c.html#a307853ba74adbc85d4dd57bee618e674">cli_udptl</a>, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="udptl_8c.html#a307853ba74adbc85d4dd57bee618e674">cli_udptl</a>));
<a name="l01451"></a>01451    <a class="code" href="udptl_8c.html#acfdd6fa3b0b7a0acd4a9841c6596809d">__ast_udptl_reload</a>(0);
<a name="l01452"></a>01452 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a310872d2ca901a1c6d42ca510b69ed48"></a><!-- doxytag: member="udptl.h::ast_udptl_new" ref="a310872d2ca901a1c6d42ca510b69ed48" args="(struct sched_context *sched, struct io_context *io, int callbackmode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__udptl.html">ast_udptl</a>* ast_udptl_new </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structsched__context.html">sched_context</a> *&nbsp;</td>
          <td class="paramname"> <em>sched</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structio__context.html">io_context</a> *&nbsp;</td>
          <td class="paramname"> <em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>callbackmode</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00997">997</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00919">ast_udptl_new_with_bindaddr()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00998"></a>00998 {
<a name="l00999"></a>00999    <span class="keyword">struct </span>in_addr ia;
<a name="l01000"></a>01000    memset(&amp;ia, 0, <span class="keyword">sizeof</span>(ia));
<a name="l01001"></a>01001    <span class="keywordflow">return</span> <a class="code" href="udptl_8h.html#afbcd53e47ee0ca638b3a44c6ce978263">ast_udptl_new_with_bindaddr</a>(sched, io, callbackmode, ia);
<a name="l01002"></a>01002 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afbcd53e47ee0ca638b3a44c6ce978263"></a><!-- doxytag: member="udptl.h::ast_udptl_new_with_bindaddr" ref="afbcd53e47ee0ca638b3a44c6ce978263" args="(struct sched_context *sched, struct io_context *io, int callbackmode, struct in_addr in)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__udptl.html">ast_udptl</a>* ast_udptl_new_with_bindaddr </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structsched__context.html">sched_context</a> *&nbsp;</td>
          <td class="paramname"> <em>sched</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structio__context.html">io_context</a> *&nbsp;</td>
          <td class="paramname"> <em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>callbackmode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct in_addr&nbsp;</td>
          <td class="paramname"> <em>in</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00919">919</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="io_8c_source.html#l00153">ast_io_add()</a>, <a class="el" href="io_8h_source.html#l00033">AST_IO_IN</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8c_source.html#l01401">ast_random()</a>, <a class="el" href="udptl_8c_source.html#l00102">udptl_fec_tx_buffer_t::buf_len</a>, <a class="el" href="udptl_8c_source.html#l00107">udptl_fec_rx_buffer_t::buf_len</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="udptl_8c_source.html#l00141">ast_udptl::error_correction_entries</a>, <a class="el" href="udptl_8c_source.html#l00146">ast_udptl::error_correction_span</a>, <a class="el" href="udptl_8c_source.html#l00151">ast_udptl::far_max_datagram</a>, <a class="el" href="udptl_8c_source.html#l00165">ast_udptl::far_max_ifp</a>, <a class="el" href="udptl_8c_source.html#l00117">ast_udptl::fd</a>, <a class="el" href="udptl_8c_source.html#l00123">ast_udptl::flags</a>, <a class="el" href="udptl_8c_source.html#l00128">ast_udptl::io</a>, <a class="el" href="udptl_8c_source.html#l00126">ast_udptl::ioid</a>, <a class="el" href="udptl_8c_source.html#l00157">ast_udptl::local_max_datagram</a>, <a class="el" href="udptl_8c_source.html#l00171">ast_udptl::local_max_ifp</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="udptl_8c_source.html#l00182">ast_udptl::rx</a>, <a class="el" href="udptl_8c_source.html#l00127">ast_udptl::sched</a>, <a class="el" href="udptl_8c_source.html#l00125">ast_udptl::them</a>, <a class="el" href="udptl_8c_source.html#l00181">ast_udptl::tx</a>, <a class="el" href="udptl_8c_source.html#l00099">UDPTL_BUF_MASK</a>, <a class="el" href="udptl_8c_source.html#l00660">udptlread()</a>, and <a class="el" href="udptl_8c_source.html#l00124">ast_udptl::us</a>.</p>

<p>Referenced by <a class="el" href="udptl_8c_source.html#l00997">ast_udptl_new()</a>, <a class="el" href="chan__sip_8c_source.html#l05102">create_addr_from_peer()</a>, <a class="el" href="chan__sip_8c_source.html#l19641">handle_request_invite()</a>, and <a class="el" href="chan__sip_8c_source.html#l07151">sip_alloc()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00920"></a>00920 {
<a name="l00921"></a>00921    <span class="keyword">struct </span><a class="code" href="structast__udptl.html" title="Structure for an UDPTL session.">ast_udptl</a> *udptl;
<a name="l00922"></a>00922    <span class="keywordtype">int</span> x;
<a name="l00923"></a>00923    <span class="keywordtype">int</span> startplace;
<a name="l00924"></a>00924    <span class="keywordtype">int</span> i;
<a name="l00925"></a>00925    <span class="keywordtype">long</span> <span class="keywordtype">int</span> <a class="code" href="structast__udptl.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a>;
<a name="l00926"></a>00926 
<a name="l00927"></a>00927    <span class="keywordflow">if</span> (!(udptl = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*udptl))))
<a name="l00928"></a>00928       <span class="keywordflow">return</span> NULL;
<a name="l00929"></a>00929 
<a name="l00930"></a>00930    udptl-&gt;<a class="code" href="structast__udptl.html#aa3ea4f55135ebfe86fb4d34b891fe618">error_correction_span</a> = <a class="code" href="udptl_8c.html#a1843da2c025cc14346182403c4c9fa53">udptlfecspan</a>;
<a name="l00931"></a>00931    udptl-&gt;<a class="code" href="structast__udptl.html#a53a056eca513e58ba0819110f0e62bc8">error_correction_entries</a> = <a class="code" href="udptl_8c.html#a2d6cbcd43cd796cd91da16fc798be95d">udptlfecentries</a>;
<a name="l00932"></a>00932    
<a name="l00933"></a>00933    udptl-&gt;<a class="code" href="structast__udptl.html#a57bdb7e31fa5ba4d3f96658d472e5b94">far_max_datagram</a> = -1;
<a name="l00934"></a>00934    udptl-&gt;<a class="code" href="structast__udptl.html#a95f0114a9c3434fbe3743868a613480b">far_max_ifp</a> = -1;
<a name="l00935"></a>00935    udptl-&gt;<a class="code" href="structast__udptl.html#a832188d785b133f8195c9c74de833141">local_max_ifp</a> = -1;
<a name="l00936"></a>00936    udptl-&gt;<a class="code" href="structast__udptl.html#aa6de52220e98717c22a45506d1aad1eb">local_max_datagram</a> = -1;
<a name="l00937"></a>00937 
<a name="l00938"></a>00938    <span class="keywordflow">for</span> (i = 0; i &lt;= <a class="code" href="udptl_8c.html#a5fc08f5f3152e66b9eb799375c8eafe5">UDPTL_BUF_MASK</a>; i++) {
<a name="l00939"></a>00939       udptl-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[i].<a class="code" href="structudptl__fec__rx__buffer__t.html#a7666bbf00997cc13da27d55cb05d27c4">buf_len</a> = -1;
<a name="l00940"></a>00940       udptl-&gt;<a class="code" href="structast__udptl.html#af0c6829f8a5272ece732cd1ac1b3094a">tx</a>[i].<a class="code" href="structudptl__fec__tx__buffer__t.html#a7666bbf00997cc13da27d55cb05d27c4">buf_len</a> = -1;
<a name="l00941"></a>00941    }
<a name="l00942"></a>00942 
<a name="l00943"></a>00943    udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_family = AF_INET;
<a name="l00944"></a>00944    udptl-&gt;<a class="code" href="structast__udptl.html#a3c2346010ce32cf02b7c85203c76a20d">us</a>.sin_family = AF_INET;
<a name="l00945"></a>00945 
<a name="l00946"></a>00946    <span class="keywordflow">if</span> ((udptl-&gt;<a class="code" href="structast__udptl.html#a6f8059414f0228f0256115e024eeed4b">fd</a> = socket(AF_INET, SOCK_DGRAM, 0)) &lt; 0) {
<a name="l00947"></a>00947       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(udptl);
<a name="l00948"></a>00948       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to allocate socket: %s\n&quot;</span>, strerror(errno));
<a name="l00949"></a>00949       <span class="keywordflow">return</span> NULL;
<a name="l00950"></a>00950    }
<a name="l00951"></a>00951    flags = fcntl(udptl-&gt;<a class="code" href="structast__udptl.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, F_GETFL);
<a name="l00952"></a>00952    fcntl(udptl-&gt;<a class="code" href="structast__udptl.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, F_SETFL, flags | O_NONBLOCK);
<a name="l00953"></a>00953 <span class="preprocessor">#ifdef SO_NO_CHECK</span>
<a name="l00954"></a>00954 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (nochecksums)
<a name="l00955"></a>00955       setsockopt(udptl-&gt;<a class="code" href="structast__udptl.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, SOL_SOCKET, SO_NO_CHECK, &amp;nochecksums, <span class="keyword">sizeof</span>(nochecksums));
<a name="l00956"></a>00956 <span class="preprocessor">#endif</span>
<a name="l00957"></a>00957 <span class="preprocessor"></span>   <span class="comment">/* Find us a place */</span>
<a name="l00958"></a>00958    x = (<a class="code" href="udptl_8c.html#a3bf0aa3b30cf99c6052f71dd963dc800">udptlstart</a> == <a class="code" href="udptl_8c.html#a6bb07009dda10589e6e1dbad7a48d157">udptlend</a>) ? <a class="code" href="udptl_8c.html#a3bf0aa3b30cf99c6052f71dd963dc800">udptlstart</a> : (<a class="code" href="utils_8h.html#a7b4f10b070e95ba413e258a3e4b03c20">ast_random</a>() % (<a class="code" href="udptl_8c.html#a6bb07009dda10589e6e1dbad7a48d157">udptlend</a> - <a class="code" href="udptl_8c.html#a3bf0aa3b30cf99c6052f71dd963dc800">udptlstart</a>)) + <a class="code" href="udptl_8c.html#a3bf0aa3b30cf99c6052f71dd963dc800">udptlstart</a>;
<a name="l00959"></a>00959    <span class="keywordflow">if</span> (<a class="code" href="udptl_8c.html#a830f7f070798d4b70c3189b8fade1ab7">use_even_ports</a> &amp;&amp; (x &amp; 1)) {
<a name="l00960"></a>00960       ++x;
<a name="l00961"></a>00961    }
<a name="l00962"></a>00962    startplace = x;
<a name="l00963"></a>00963    <span class="keywordflow">for</span> (;;) {
<a name="l00964"></a>00964       udptl-&gt;<a class="code" href="structast__udptl.html#a3c2346010ce32cf02b7c85203c76a20d">us</a>.sin_port = htons(x);
<a name="l00965"></a>00965       udptl-&gt;<a class="code" href="structast__udptl.html#a3c2346010ce32cf02b7c85203c76a20d">us</a>.sin_addr = addr;
<a name="l00966"></a>00966       <span class="keywordflow">if</span> (bind(udptl-&gt;<a class="code" href="structast__udptl.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, (<span class="keyword">struct</span> sockaddr *) &amp;udptl-&gt;<a class="code" href="structast__udptl.html#a3c2346010ce32cf02b7c85203c76a20d">us</a>, <span class="keyword">sizeof</span>(udptl-&gt;<a class="code" href="structast__udptl.html#a3c2346010ce32cf02b7c85203c76a20d">us</a>)) == 0)
<a name="l00967"></a>00967          <span class="keywordflow">break</span>;
<a name="l00968"></a>00968       <span class="keywordflow">if</span> (errno != EADDRINUSE) {
<a name="l00969"></a>00969          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unexpected bind error: %s\n&quot;</span>, strerror(errno));
<a name="l00970"></a>00970          close(udptl-&gt;<a class="code" href="structast__udptl.html#a6f8059414f0228f0256115e024eeed4b">fd</a>);
<a name="l00971"></a>00971          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(udptl);
<a name="l00972"></a>00972          <span class="keywordflow">return</span> NULL;
<a name="l00973"></a>00973       }
<a name="l00974"></a>00974       <span class="keywordflow">if</span> (<a class="code" href="udptl_8c.html#a830f7f070798d4b70c3189b8fade1ab7">use_even_ports</a>) {
<a name="l00975"></a>00975          x += 2;
<a name="l00976"></a>00976       } <span class="keywordflow">else</span> {
<a name="l00977"></a>00977          ++x;
<a name="l00978"></a>00978       }
<a name="l00979"></a>00979       <span class="keywordflow">if</span> (x &gt; <a class="code" href="udptl_8c.html#a6bb07009dda10589e6e1dbad7a48d157">udptlend</a>)
<a name="l00980"></a>00980          x = <a class="code" href="udptl_8c.html#a3bf0aa3b30cf99c6052f71dd963dc800">udptlstart</a>;
<a name="l00981"></a>00981       <span class="keywordflow">if</span> (x == startplace) {
<a name="l00982"></a>00982          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No UDPTL ports remaining\n&quot;</span>);
<a name="l00983"></a>00983          close(udptl-&gt;<a class="code" href="structast__udptl.html#a6f8059414f0228f0256115e024eeed4b">fd</a>);
<a name="l00984"></a>00984          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(udptl);
<a name="l00985"></a>00985          <span class="keywordflow">return</span> NULL;
<a name="l00986"></a>00986       }
<a name="l00987"></a>00987    }
<a name="l00988"></a>00988    <span class="keywordflow">if</span> (io &amp;&amp; sched &amp;&amp; callbackmode) {
<a name="l00989"></a>00989       <span class="comment">/* Operate this one in a callback mode */</span>
<a name="l00990"></a>00990       udptl-&gt;<a class="code" href="structast__udptl.html#aea6233539fc73fc5303bf7525ec27e73">sched</a> = sched;
<a name="l00991"></a>00991       udptl-&gt;<a class="code" href="structast__udptl.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a> = io;
<a name="l00992"></a>00992       udptl-&gt;<a class="code" href="structast__udptl.html#a378e4ecae74acafadf99a691f65f2419">ioid</a> = <a class="code" href="io_8h.html#aa250c3f6541dc5734deb966d6821da7a" title="Adds an IO context.">ast_io_add</a>(udptl-&gt;<a class="code" href="structast__udptl.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a>, udptl-&gt;<a class="code" href="structast__udptl.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <a class="code" href="udptl_8c.html#aca6905df84f7b7a4905a3fadb50139c7">udptlread</a>, <a class="code" href="io_8h.html#a0d9e01f215782a343a1b71b5be362080">AST_IO_IN</a>, udptl);
<a name="l00993"></a>00993    }
<a name="l00994"></a>00994    <span class="keywordflow">return</span> udptl;
<a name="l00995"></a>00995 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4c3c0f932544c3920055554c473d6576"></a><!-- doxytag: member="udptl.h::ast_udptl_proto_register" ref="a4c3c0f932544c3920055554c473d6576" args="(struct ast_udptl_protocol *proto)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_udptl_proto_register </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl__protocol.html">ast_udptl_protocol</a> *&nbsp;</td>
          <td class="paramname"> <em>proto</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l01119">1119</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="linkedlists_8h_source.html#l00725">AST_RWLIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="structast__udptl__protocol.html#ad9b85bd971cfb2b646be8afa37d584f3">ast_udptl_protocol::list</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="udptl_8h_source.html#l00051">ast_udptl_protocol::type</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l25736">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01120"></a>01120 {
<a name="l01121"></a>01121    <span class="keyword">struct </span><a class="code" href="structast__udptl__protocol.html">ast_udptl_protocol</a> *cur;
<a name="l01122"></a>01122 
<a name="l01123"></a>01123    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structprotos.html" title="List of current sessions.">protos</a>);
<a name="l01124"></a>01124    <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="structprotos.html" title="List of current sessions.">protos</a>, cur, <a class="code" href="structast__udptl__protocol.html#ad9b85bd971cfb2b646be8afa37d584f3">list</a>) {
<a name="l01125"></a>01125       <span class="keywordflow">if</span> (cur-&gt;<a class="code" href="structast__udptl__protocol.html#a8ff938fb2f815be425fd2859a21e6d61">type</a> == proto-&gt;<a class="code" href="structast__udptl__protocol.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>) {
<a name="l01126"></a>01126          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Tried to register same protocol &apos;%s&apos; twice\n&quot;</span>, cur-&gt;<a class="code" href="structast__udptl__protocol.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>);
<a name="l01127"></a>01127          <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structprotos.html" title="List of current sessions.">protos</a>);
<a name="l01128"></a>01128          <span class="keywordflow">return</span> -1;
<a name="l01129"></a>01129       }
<a name="l01130"></a>01130    }
<a name="l01131"></a>01131    <a class="code" href="linkedlists_8h.html#aadda916488b2d151af4426e2f06ad332">AST_RWLIST_INSERT_TAIL</a>(&amp;<a class="code" href="structprotos.html" title="List of current sessions.">protos</a>, proto, <a class="code" href="structast__udptl__protocol.html#ad9b85bd971cfb2b646be8afa37d584f3">list</a>);
<a name="l01132"></a>01132    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structprotos.html" title="List of current sessions.">protos</a>);
<a name="l01133"></a>01133    <span class="keywordflow">return</span> 0;
<a name="l01134"></a>01134 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac1d0c92d37bf00a7138bf30b11980df5"></a><!-- doxytag: member="udptl.h::ast_udptl_proto_unregister" ref="ac1d0c92d37bf00a7138bf30b11980df5" args="(struct ast_udptl_protocol *proto)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_udptl_proto_unregister </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl__protocol.html">ast_udptl_protocol</a> *&nbsp;</td>
          <td class="paramname"> <em>proto</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l01112">1112</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00860">AST_RWLIST_REMOVE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, and <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l25834">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01113"></a>01113 {
<a name="l01114"></a>01114    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structprotos.html" title="List of current sessions.">protos</a>);
<a name="l01115"></a>01115    <a class="code" href="linkedlists_8h.html#a6091f0518f8b6f443fd9f5150f3ac407">AST_RWLIST_REMOVE</a>(&amp;<a class="code" href="structprotos.html" title="List of current sessions.">protos</a>, proto, <a class="code" href="structast__udptl__protocol.html#ad9b85bd971cfb2b646be8afa37d584f3">list</a>);
<a name="l01116"></a>01116    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structprotos.html" title="List of current sessions.">protos</a>);
<a name="l01117"></a>01117 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae0808bce80557e3107c9030bd8a832fe"></a><!-- doxytag: member="udptl.h::ast_udptl_read" ref="ae0808bce80557e3107c9030bd8a832fe" args="(struct ast_udptl *udptl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__frame.html">ast_frame</a>* ast_udptl_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00672">672</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="utils_8h_source.html#l00678">ast_assert</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8h_source.html#l00203">AST_FRIENDLY_OFFSET</a>, <a class="el" href="utils_8c_source.html#l00431">ast_inet_ntoa()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="frame_8c_source.html#l00124">ast_null_frame</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="udptl_8c_source.html#l00119">ast_udptl::f</a>, <a class="el" href="udptl_8c_source.html#l00117">ast_udptl::fd</a>, <a class="el" href="func__strings_8c_source.html#l00821">len()</a>, <a class="el" href="udptl_8c_source.html#l00080">LOG_TAG</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="udptl_8c_source.html#l00122">ast_udptl::nat</a>, <a class="el" href="udptl_8c_source.html#l00120">ast_udptl::rawdata</a>, <a class="el" href="udptl_8c_source.html#l00125">ast_udptl::them</a>, <a class="el" href="udptl_8c_source.html#l00187">udptl_debug_test_addr()</a>, and <a class="el" href="udptl_8c_source.html#l00318">udptl_rx_packet()</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l06955">sip_rtp_read()</a>, <a class="el" href="chan__skinny_8c_source.html#l03907">skinny_rtp_read()</a>, and <a class="el" href="udptl_8c_source.html#l00660">udptlread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00673"></a>00673 {
<a name="l00674"></a>00674    <span class="keywordtype">int</span> res;
<a name="l00675"></a>00675    <span class="keyword">struct </span>sockaddr_in sin;
<a name="l00676"></a>00676    socklen_t <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;
<a name="l00677"></a>00677    uint16_t seqno = 0;
<a name="l00678"></a>00678    uint16_t *udptlheader;
<a name="l00679"></a>00679 
<a name="l00680"></a>00680    len = <span class="keyword">sizeof</span>(sin);
<a name="l00681"></a>00681    
<a name="l00682"></a>00682    <span class="comment">/* Cache where the header will go */</span>
<a name="l00683"></a>00683    res = recvfrom(udptl-&gt;<a class="code" href="structast__udptl.html#a6f8059414f0228f0256115e024eeed4b">fd</a>,
<a name="l00684"></a>00684          udptl-&gt;<a class="code" href="structast__udptl.html#a8af53bd0e8b4f1e9275d51d2a4065991">rawdata</a> + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>,
<a name="l00685"></a>00685          <span class="keyword">sizeof</span>(udptl-&gt;<a class="code" href="structast__udptl.html#a8af53bd0e8b4f1e9275d51d2a4065991">rawdata</a>) - <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>,
<a name="l00686"></a>00686          0,
<a name="l00687"></a>00687          (<span class="keyword">struct</span> sockaddr *) &amp;sin,
<a name="l00688"></a>00688          &amp;len);
<a name="l00689"></a>00689    udptlheader = (uint16_t *)(udptl-&gt;<a class="code" href="structast__udptl.html#a8af53bd0e8b4f1e9275d51d2a4065991">rawdata</a> + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>);
<a name="l00690"></a>00690    <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l00691"></a>00691       <span class="keywordflow">if</span> (errno != EAGAIN)
<a name="l00692"></a>00692          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;(%s): UDPTL read error: %s\n&quot;</span>,
<a name="l00693"></a>00693             <a class="code" href="udptl_8c.html#a12f6e5fd71bc2bc7fcfc0583b035c862">LOG_TAG</a>(udptl), strerror(errno));
<a name="l00694"></a>00694       <a class="code" href="utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(errno != EBADF);
<a name="l00695"></a>00695       <span class="keywordflow">return</span> &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l00696"></a>00696    }
<a name="l00697"></a>00697 
<a name="l00698"></a>00698    <span class="comment">/* Ignore if the other side hasn&apos;t been given an address yet. */</span>
<a name="l00699"></a>00699    <span class="keywordflow">if</span> (!udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr.s_addr || !udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port)
<a name="l00700"></a>00700       <span class="keywordflow">return</span> &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l00701"></a>00701 
<a name="l00702"></a>00702    <span class="keywordflow">if</span> (udptl-&gt;<a class="code" href="structast__udptl.html#ada540a5f25f7302dc1a3d17ccfa59b10">nat</a>) {
<a name="l00703"></a>00703       <span class="comment">/* Send to whoever sent to us */</span>
<a name="l00704"></a>00704       <span class="keywordflow">if</span> ((udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr.s_addr != sin.sin_addr.s_addr) ||
<a name="l00705"></a>00705          (udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port != sin.sin_port)) {
<a name="l00706"></a>00706          memcpy(&amp;udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>, &amp;sin, <span class="keyword">sizeof</span>(udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>));
<a name="l00707"></a>00707          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;UDPTL NAT (%s): Using address %s:%d\n&quot;</span>,
<a name="l00708"></a>00708               <a class="code" href="udptl_8c.html#a12f6e5fd71bc2bc7fcfc0583b035c862">LOG_TAG</a>(udptl), <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr), ntohs(udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port));
<a name="l00709"></a>00709       }
<a name="l00710"></a>00710    }
<a name="l00711"></a>00711 
<a name="l00712"></a>00712    <span class="keywordflow">if</span> (<a class="code" href="udptl_8c.html#a01d5961e9d1bf0c8c6244aee64a1ecf9">udptl_debug_test_addr</a>(&amp;sin)) {
<a name="l00713"></a>00713       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;UDPTL (%s): packet from %s:%d (type %d, seq %d, len %d)\n&quot;</span>,
<a name="l00714"></a>00714           <a class="code" href="udptl_8c.html#a12f6e5fd71bc2bc7fcfc0583b035c862">LOG_TAG</a>(udptl), <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(sin.sin_addr), ntohs(sin.sin_port), 0, seqno, res);
<a name="l00715"></a>00715    }
<a name="l00716"></a>00716    <span class="keywordflow">if</span> (<a class="code" href="udptl_8c.html#a0db4385b032d828c9ec822008c79a061">udptl_rx_packet</a>(udptl, udptl-&gt;<a class="code" href="structast__udptl.html#a8af53bd0e8b4f1e9275d51d2a4065991">rawdata</a> + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>, res) &lt; 1)
<a name="l00717"></a>00717       <span class="keywordflow">return</span> &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l00718"></a>00718 
<a name="l00719"></a>00719    <span class="keywordflow">return</span> &amp;udptl-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[0];
<a name="l00720"></a>00720 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aef56fae41fcf91924375991a5c4e7568"></a><!-- doxytag: member="udptl.h::ast_udptl_reload" ref="aef56fae41fcf91924375991a5c4e7568" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_udptl_reload </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="version"><dt><b>Version:</b></dt><dd>1.6.1 return changed to int </dd></dl>

<p>Definition at line <a class="el" href="udptl_8c_source.html#l01442">1442</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l01342">__ast_udptl_reload()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01443"></a>01443 {
<a name="l01444"></a>01444    <a class="code" href="udptl_8c.html#acfdd6fa3b0b7a0acd4a9841c6596809d">__ast_udptl_reload</a>(1);
<a name="l01445"></a>01445    <span class="keywordflow">return</span> 0;
<a name="l01446"></a>01446 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a457795f4074df4221f206ae848290e94"></a><!-- doxytag: member="udptl.h::ast_udptl_reset" ref="a457795f4074df4221f206ae848290e94" args="(struct ast_udptl *udptl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_udptl_reset </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ac410178703bbd10effbedd9823b89f2a"></a><!-- doxytag: member="udptl.h::ast_udptl_set_callback" ref="ac410178703bbd10effbedd9823b89f2a" args="(struct ast_udptl *udptl, ast_udptl_callback callback)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_udptl_set_callback </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="udptl_8h.html#a04e7bb36362e3da0ab84dbceb6e3dc9e">ast_udptl_callback</a>&nbsp;</td>
          <td class="paramname"> <em>callback</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00650">650</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00131">ast_udptl::callback</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00651"></a>00651 {
<a name="l00652"></a>00652    udptl-&gt;<a class="code" href="structast__udptl.html#a221993e4dd934844eb4cce202b381952">callback</a> = callback;
<a name="l00653"></a>00653 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab2b6f583b1e2e2efdd87c0f6a7264d42"></a><!-- doxytag: member="udptl.h::ast_udptl_set_data" ref="ab2b6f583b1e2e2efdd87c0f6a7264d42" args="(struct ast_udptl *udptl, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_udptl_set_data </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00645">645</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00129">ast_udptl::data</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00646"></a>00646 {
<a name="l00647"></a>00647    udptl-&gt;<a class="code" href="structast__udptl.html#a735984d41155bc1032e09bece8f8d66d">data</a> = data;
<a name="l00648"></a>00648 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aec066a1e8d5b80dfab8c4a5296e65e48"></a><!-- doxytag: member="udptl.h::ast_udptl_set_error_correction_scheme" ref="aec066a1e8d5b80dfab8c4a5296e65e48" args="(struct ast_udptl *udptl, enum ast_t38_ec_modes ec)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_udptl_set_error_correction_scheme </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795">ast_t38_ec_modes</a>&nbsp;</td>
          <td class="paramname"> <em>ec</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00836">836</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00141">ast_udptl::error_correction_entries</a>, <a class="el" href="udptl_8c_source.html#l00136">ast_udptl::error_correction_scheme</a>, <a class="el" href="udptl_8c_source.html#l00146">ast_udptl::error_correction_span</a>, <a class="el" href="udptl_8c_source.html#l00165">ast_udptl::far_max_ifp</a>, <a class="el" href="udptl_8c_source.html#l00157">ast_udptl::local_max_datagram</a>, <a class="el" href="udptl_8h_source.html#l00038">UDPTL_ERROR_CORRECTION_FEC</a>, and <a class="el" href="udptl_8h_source.html#l00039">UDPTL_ERROR_CORRECTION_REDUNDANCY</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l08902">process_sdp_a_image()</a>, and <a class="el" href="chan__sip_8c_source.html#l05068">set_t38_capabilities()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00837"></a>00837 {
<a name="l00838"></a>00838    udptl-&gt;<a class="code" href="structast__udptl.html#ac215dbaf54319e257d2c33ecd70c36c5">error_correction_scheme</a> = ec;
<a name="l00839"></a>00839    <span class="keywordflow">switch</span> (ec) {
<a name="l00840"></a>00840    <span class="keywordflow">case</span> <a class="code" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795aa0e8972e48ad95a77cbe2c66e174fd76">UDPTL_ERROR_CORRECTION_FEC</a>:
<a name="l00841"></a>00841       udptl-&gt;<a class="code" href="structast__udptl.html#ac215dbaf54319e257d2c33ecd70c36c5">error_correction_scheme</a> = <a class="code" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795aa0e8972e48ad95a77cbe2c66e174fd76">UDPTL_ERROR_CORRECTION_FEC</a>;
<a name="l00842"></a>00842       <span class="keywordflow">if</span> (udptl-&gt;<a class="code" href="structast__udptl.html#a53a056eca513e58ba0819110f0e62bc8">error_correction_entries</a> == 0) {
<a name="l00843"></a>00843          udptl-&gt;<a class="code" href="structast__udptl.html#a53a056eca513e58ba0819110f0e62bc8">error_correction_entries</a> = 3;
<a name="l00844"></a>00844       }
<a name="l00845"></a>00845       <span class="keywordflow">if</span> (udptl-&gt;<a class="code" href="structast__udptl.html#aa3ea4f55135ebfe86fb4d34b891fe618">error_correction_span</a> == 0) {
<a name="l00846"></a>00846          udptl-&gt;<a class="code" href="structast__udptl.html#aa3ea4f55135ebfe86fb4d34b891fe618">error_correction_span</a> = 3;
<a name="l00847"></a>00847       }
<a name="l00848"></a>00848       <span class="keywordflow">break</span>;
<a name="l00849"></a>00849    <span class="keywordflow">case</span> <a class="code" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795afbc322f60eade115e42b66d4ab4dec83">UDPTL_ERROR_CORRECTION_REDUNDANCY</a>:
<a name="l00850"></a>00850       udptl-&gt;<a class="code" href="structast__udptl.html#ac215dbaf54319e257d2c33ecd70c36c5">error_correction_scheme</a> = <a class="code" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795afbc322f60eade115e42b66d4ab4dec83">UDPTL_ERROR_CORRECTION_REDUNDANCY</a>;
<a name="l00851"></a>00851       <span class="keywordflow">if</span> (udptl-&gt;<a class="code" href="structast__udptl.html#a53a056eca513e58ba0819110f0e62bc8">error_correction_entries</a> == 0) {
<a name="l00852"></a>00852          udptl-&gt;<a class="code" href="structast__udptl.html#a53a056eca513e58ba0819110f0e62bc8">error_correction_entries</a> = 3;
<a name="l00853"></a>00853       }
<a name="l00854"></a>00854       <span class="keywordflow">break</span>;
<a name="l00855"></a>00855    <span class="keywordflow">default</span>:
<a name="l00856"></a>00856       <span class="comment">/* nothing to do */</span>
<a name="l00857"></a>00857       <span class="keywordflow">break</span>;
<a name="l00858"></a>00858    };
<a name="l00859"></a>00859    <span class="comment">/* reset calculated values so they&apos;ll be computed again */</span>
<a name="l00860"></a>00860    udptl-&gt;<a class="code" href="structast__udptl.html#aa6de52220e98717c22a45506d1aad1eb">local_max_datagram</a> = -1;
<a name="l00861"></a>00861    udptl-&gt;<a class="code" href="structast__udptl.html#a95f0114a9c3434fbe3743868a613480b">far_max_ifp</a> = -1;
<a name="l00862"></a>00862 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abb364758e66c04d5d791fc51d2b3ed6d"></a><!-- doxytag: member="udptl.h::ast_udptl_set_far_max_datagram" ref="abb364758e66c04d5d791fc51d2b3ed6d" args="(struct ast_udptl *udptl, unsigned int max_datagram)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_udptl_set_far_max_datagram </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>max_datagram</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>sets far max datagram size. If max_datagram is = 0, the far max datagram size is set to a default value. </p>

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00888">888</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00094">DEFAULT_FAX_MAX_DATAGRAM</a>, <a class="el" href="udptl_8c_source.html#l00151">ast_udptl::far_max_datagram</a>, <a class="el" href="udptl_8c_source.html#l00165">ast_udptl::far_max_ifp</a>, and <a class="el" href="udptl_8c_source.html#l00095">FAX_MAX_DATAGRAM_LIMIT</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l08040">process_sdp()</a>, and <a class="el" href="chan__sip_8c_source.html#l08902">process_sdp_a_image()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00889"></a>00889 {
<a name="l00890"></a>00890    <span class="keywordflow">if</span> (!max_datagram || (max_datagram &gt; <a class="code" href="udptl_8c.html#aa8f3d147dea9bd83782b759502fc60a1">FAX_MAX_DATAGRAM_LIMIT</a>)) {
<a name="l00891"></a>00891       udptl-&gt;<a class="code" href="structast__udptl.html#a57bdb7e31fa5ba4d3f96658d472e5b94">far_max_datagram</a> = <a class="code" href="udptl_8c.html#a840abeaeb2ccc5dca63e7acfeed7ca87">DEFAULT_FAX_MAX_DATAGRAM</a>;
<a name="l00892"></a>00892    } <span class="keywordflow">else</span> {
<a name="l00893"></a>00893       udptl-&gt;<a class="code" href="structast__udptl.html#a57bdb7e31fa5ba4d3f96658d472e5b94">far_max_datagram</a> = max_datagram;
<a name="l00894"></a>00894    }
<a name="l00895"></a>00895    <span class="comment">/* reset calculated values so they&apos;ll be computed again */</span>
<a name="l00896"></a>00896    udptl-&gt;<a class="code" href="structast__udptl.html#a95f0114a9c3434fbe3743868a613480b">far_max_ifp</a> = -1;
<a name="l00897"></a>00897 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6c2d98f9407493efbbdc9462717a2d9d"></a><!-- doxytag: member="udptl.h::ast_udptl_set_local_max_ifp" ref="a6c2d98f9407493efbbdc9462717a2d9d" args="(struct ast_udptl *udptl, unsigned int max_ifp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_udptl_set_local_max_ifp </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>max_ifp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00864">864</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00157">ast_udptl::local_max_datagram</a>, and <a class="el" href="udptl_8c_source.html#l00171">ast_udptl::local_max_ifp</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l06424">interpret_t38_parameters()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00865"></a>00865 {
<a name="l00866"></a>00866    <span class="comment">/* make sure max_ifp is a positive value since a cast will take place when</span>
<a name="l00867"></a>00867 <span class="comment">    * when setting local_max_ifp */</span>
<a name="l00868"></a>00868    <span class="keywordflow">if</span> ((<span class="keywordtype">signed</span> <span class="keywordtype">int</span>) max_ifp &gt; 0) {
<a name="l00869"></a>00869       udptl-&gt;<a class="code" href="structast__udptl.html#a832188d785b133f8195c9c74de833141">local_max_ifp</a> = max_ifp;
<a name="l00870"></a>00870       <span class="comment">/* reset calculated values so they&apos;ll be computed again */</span>
<a name="l00871"></a>00871       udptl-&gt;<a class="code" href="structast__udptl.html#aa6de52220e98717c22a45506d1aad1eb">local_max_datagram</a> = -1;
<a name="l00872"></a>00872    }
<a name="l00873"></a>00873 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9c846a58b645e848c616a69c24633d1f"></a><!-- doxytag: member="udptl.h::ast_udptl_set_m_type" ref="a9c846a58b645e848c616a69c24633d1f" args="(struct ast_udptl *udptl, unsigned int pt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_udptl_set_m_type </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>pt</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="aa610b69fe43ec50c49d39e8613e07a14"></a><!-- doxytag: member="udptl.h::ast_udptl_set_peer" ref="aa610b69fe43ec50c49d39e8613e07a14" args="(struct ast_udptl *udptl, const struct sockaddr_in *them)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_udptl_set_peer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>them</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l01024">1024</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00125">ast_udptl::them</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l08040">process_sdp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01025"></a>01025 {
<a name="l01026"></a>01026    udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port = them-&gt;sin_port;
<a name="l01027"></a>01027    udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr = them-&gt;sin_addr;
<a name="l01028"></a>01028 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a697d541fd523e36f898d699cbfda988f"></a><!-- doxytag: member="udptl.h::ast_udptl_set_tag" ref="a697d541fd523e36f898d699cbfda988f" args="(struct ast_udptl *udptl, const char *format,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_udptl_set_tag </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>...</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Associates a character string 'tag' with a UDPTL session. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>udptl</em>&nbsp;</td><td>The UDPTL session. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>format</em>&nbsp;</td><td>printf-style format string used to construct the tag</td></tr>
  </table>
  </dd>
</dl>
<p>This function <a class="el" href="structformats.html">formats</a> a tag for the specified UDPTL session, so that any log messages generated by the UDPTL stack related to that session will include the tag and the reader of the messages will be able to identify which endpoint caused them to be generated.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>none</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="udptl_8c_source.html#l01004">1004</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="astmm_8h_source.html#l00117">ast_vasprintf</a>, and <a class="el" href="udptl_8c_source.html#l00130">ast_udptl::tag</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l05019">change_t38_state()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01005"></a>01005 {
<a name="l01006"></a>01006    va_list ap;
<a name="l01007"></a>01007 
<a name="l01008"></a>01008    <span class="keywordflow">if</span> (udptl-&gt;<a class="code" href="structast__udptl.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a>) {
<a name="l01009"></a>01009       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(udptl-&gt;<a class="code" href="structast__udptl.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a>);
<a name="l01010"></a>01010       udptl-&gt;<a class="code" href="structast__udptl.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a> = NULL;
<a name="l01011"></a>01011    }
<a name="l01012"></a>01012    va_start(ap, <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>);
<a name="l01013"></a>01013    <span class="keywordflow">if</span> (<a class="code" href="astmm_8h.html#a5a4c348a0a93c313c8463d4756e86270">ast_vasprintf</a>(&amp;udptl-&gt;<a class="code" href="structast__udptl.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a>, <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>, ap) == -1) {
<a name="l01014"></a>01014       udptl-&gt;<a class="code" href="structast__udptl.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a> = NULL;
<a name="l01015"></a>01015    }
<a name="l01016"></a>01016    va_end(ap);
<a name="l01017"></a>01017 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abb4f854b993e4debf1547eebbb351d46"></a><!-- doxytag: member="udptl.h::ast_udptl_set_udptlmap_type" ref="abb4f854b993e4debf1547eebbb351d46" args="(struct ast_udptl *udptl, unsigned int pt, char *mimeType, char *mimeSubtype)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_udptl_set_udptlmap_type </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>pt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>mimeType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>mimeSubtype</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a76d8051a97100fa917b8c43bf58aac9c"></a><!-- doxytag: member="udptl.h::ast_udptl_setnat" ref="a76d8051a97100fa917b8c43bf58aac9c" args="(struct ast_udptl *udptl, int nat)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_udptl_setnat </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nat</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00655">655</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00122">ast_udptl::nat</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l04996">do_setnat()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00656"></a>00656 {
<a name="l00657"></a>00657    udptl-&gt;<a class="code" href="structast__udptl.html#ada540a5f25f7302dc1a3d17ccfa59b10">nat</a> = <a class="code" href="chan__mgcp_8c.html#ada540a5f25f7302dc1a3d17ccfa59b10">nat</a>;
<a name="l00658"></a>00658 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa37b040d6f8a975f25022e73e125b99e"></a><!-- doxytag: member="udptl.h::ast_udptl_setqos" ref="aa37b040d6f8a975f25022e73e125b99e" args="(struct ast_udptl *udptl, unsigned int tos, unsigned int cos)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_udptl_setqos </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>tos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>cos</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l01019">1019</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="netsock_8c_source.html#l00154">ast_netsock_set_qos()</a>, and <a class="el" href="udptl_8c_source.html#l00117">ast_udptl::fd</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l07151">sip_alloc()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01020"></a>01020 {
<a name="l01021"></a>01021    <span class="keywordflow">return</span> <a class="code" href="netsock_8h.html#aef64bf03f17c3251f549b08b6620bc24">ast_netsock_set_qos</a>(udptl-&gt;<a class="code" href="structast__udptl.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <a class="code" href="chan__h323_8c.html#a25a9305efab3b493ca2519562fcec3d5">tos</a>, <a class="code" href="chan__h323_8c.html#ae91dad65f553f7afebe4af507803bc7f">cos</a>, <span class="stringliteral">&quot;UDPTL&quot;</span>);
<a name="l01022"></a>01022 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3fb4dcecfa292b0aae4fd4dbad1b8551"></a><!-- doxytag: member="udptl.h::ast_udptl_stop" ref="a3fb4dcecfa292b0aae4fd4dbad1b8551" args="(struct ast_udptl *udptl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_udptl_stop </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l01043">1043</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00125">ast_udptl::them</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l08040">process_sdp()</a>, and <a class="el" href="chan__sip_8c_source.html#l18253">stop_media_flows()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01044"></a>01044 {
<a name="l01045"></a>01045    memset(&amp;udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr, 0, <span class="keyword">sizeof</span>(udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr));
<a name="l01046"></a>01046    memset(&amp;udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port, 0, <span class="keyword">sizeof</span>(udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port));
<a name="l01047"></a>01047 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa5fd608ad072447c2ea3e2bffcb02b91"></a><!-- doxytag: member="udptl.h::ast_udptl_write" ref="aa5fd608ad072447c2ea3e2bffcb02b91" args="(struct ast_udptl *udptl, struct ast_frame *f)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_udptl_write </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td>
          <td class="paramname"> <em>f</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l01060">1060</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00120">AST_FRAME_MODEM</a>, <a class="el" href="utils_8c_source.html#l00431">ast_inet_ntoa()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="frame_8h_source.html#l00215">AST_MODEM_T38</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="adsistub_8c_source.html#l00059">buf</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="frame_8h_source.html#l00147">ast_frame::datalen</a>, <a class="el" href="udptl_8c_source.html#l00094">DEFAULT_FAX_MAX_DATAGRAM</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="udptl_8c_source.html#l00151">ast_udptl::far_max_datagram</a>, <a class="el" href="udptl_8c_source.html#l00165">ast_udptl::far_max_ifp</a>, <a class="el" href="udptl_8c_source.html#l00117">ast_udptl::fd</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="func__strings_8c_source.html#l00821">len()</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="udptl_8c_source.html#l00080">LOG_TAG</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::ptr</a>, <a class="el" href="app__sms_8c_source.html#l00114">seq</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, <a class="el" href="udptl_8c_source.html#l00125">ast_udptl::them</a>, <a class="el" href="udptl_8c_source.html#l00177">ast_udptl::tx_seq_no</a>, <a class="el" href="udptl_8c_source.html#l00526">udptl_build_packet()</a>, and <a class="el" href="udptl_8c_source.html#l00187">udptl_debug_test_addr()</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l06207">sip_write()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01061"></a>01061 {
<a name="l01062"></a>01062    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="app__sms_8c.html#a8514112da88a5d13451aaf8c9b064017">seq</a>;
<a name="l01063"></a>01063    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> = f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>;
<a name="l01064"></a>01064    <span class="keywordtype">int</span> res;
<a name="l01065"></a>01065    <span class="comment">/* if no max datagram size is provided, use default value */</span>
<a name="l01066"></a>01066    <span class="keyword">const</span> <span class="keywordtype">int</span> bufsize = (<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>-&gt;far_max_datagram &gt; 0) ? <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>-&gt;far_max_datagram : <a class="code" href="udptl_8c.html#a840abeaeb2ccc5dca63e7acfeed7ca87">DEFAULT_FAX_MAX_DATAGRAM</a>;
<a name="l01067"></a>01067    uint8_t <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[bufsize];
<a name="l01068"></a>01068 
<a name="l01069"></a>01069    memset(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>));
<a name="l01070"></a>01070 
<a name="l01071"></a>01071    <span class="comment">/* If we have no peer, return immediately */</span> 
<a name="l01072"></a>01072    <span class="keywordflow">if</span> (<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>-&gt;them.sin_addr.s_addr == INADDR_ANY)
<a name="l01073"></a>01073       <span class="keywordflow">return</span> 0;
<a name="l01074"></a>01074 
<a name="l01075"></a>01075    <span class="comment">/* If there is no data length, return immediately */</span>
<a name="l01076"></a>01076    <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> == 0)
<a name="l01077"></a>01077       <span class="keywordflow">return</span> 0;
<a name="l01078"></a>01078    
<a name="l01079"></a>01079    <span class="keywordflow">if</span> ((f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> != <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ad99b86353343f422bda01163898b2eea">AST_FRAME_MODEM</a>) ||
<a name="l01080"></a>01080        (f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> != <a class="code" href="frame_8h.html#a3a510e4e2673c6870ed5fe0f1eb53732">AST_MODEM_T38</a>)) {
<a name="l01081"></a>01081       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;(%s): UDPTL can only send T.38 data.\n&quot;</span>,
<a name="l01082"></a>01082          <a class="code" href="udptl_8c.html#a12f6e5fd71bc2bc7fcfc0583b035c862">LOG_TAG</a>(<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>));
<a name="l01083"></a>01083       <span class="keywordflow">return</span> -1;
<a name="l01084"></a>01084    }
<a name="l01085"></a>01085 
<a name="l01086"></a>01086    <span class="keywordflow">if</span> (len &gt; <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>-&gt;far_max_ifp) {
<a name="l01087"></a>01087       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,
<a name="l01088"></a>01088          <span class="stringliteral">&quot;(%s): UDPTL asked to send %d bytes of IFP when far end only prepared to accept %d bytes; data loss will occur.&quot;</span>
<a name="l01089"></a>01089          <span class="stringliteral">&quot;You may need to override the T38FaxMaxDatagram value for this endpoint in the channel driver configuration.\n&quot;</span>,
<a name="l01090"></a>01090          <a class="code" href="udptl_8c.html#a12f6e5fd71bc2bc7fcfc0583b035c862">LOG_TAG</a>(<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>), len, <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>-&gt;far_max_ifp);
<a name="l01091"></a>01091       len = <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>-&gt;far_max_ifp;
<a name="l01092"></a>01092    }
<a name="l01093"></a>01093 
<a name="l01094"></a>01094    <span class="comment">/* Save seq_no for debug output because udptl_build_packet increments it */</span>
<a name="l01095"></a>01095    seq = <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>-&gt;tx_seq_no &amp; 0xFFFF;
<a name="l01096"></a>01096 
<a name="l01097"></a>01097    <span class="comment">/* Cook up the UDPTL packet, with the relevant EC info. */</span>
<a name="l01098"></a>01098    len = <a class="code" href="udptl_8c.html#ad2ff9341ea549b0679a80c409637228c">udptl_build_packet</a>(<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <span class="keyword">sizeof</span>(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>), f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, len);
<a name="l01099"></a>01099 
<a name="l01100"></a>01100    <span class="keywordflow">if</span> (len &gt; 0 &amp;&amp; <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>-&gt;them.sin_port &amp;&amp; <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>-&gt;them.sin_addr.s_addr) {
<a name="l01101"></a>01101       <span class="keywordflow">if</span> ((res = sendto(<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>-&gt;fd, <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, len, 0, (<span class="keyword">struct</span> sockaddr *) &amp;<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>-&gt;them, <span class="keyword">sizeof</span>(<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>-&gt;them))) &lt; 0)
<a name="l01102"></a>01102          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;(%s): UDPTL Transmission error to %s:%d: %s\n&quot;</span>,
<a name="l01103"></a>01103             <a class="code" href="udptl_8c.html#a12f6e5fd71bc2bc7fcfc0583b035c862">LOG_TAG</a>(<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>), <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>-&gt;them.sin_addr), ntohs(<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>-&gt;them.sin_port), strerror(errno));
<a name="l01104"></a>01104       <span class="keywordflow">if</span> (<a class="code" href="udptl_8c.html#a01d5961e9d1bf0c8c6244aee64a1ecf9">udptl_debug_test_addr</a>(&amp;<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>-&gt;them))
<a name="l01105"></a>01105          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;UDPTL (%s): packet to %s:%d (type %d, seq %d, len %d)\n&quot;</span>,
<a name="l01106"></a>01106              <a class="code" href="udptl_8c.html#a12f6e5fd71bc2bc7fcfc0583b035c862">LOG_TAG</a>(<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>), <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>-&gt;them.sin_addr), ntohs(<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>-&gt;them.sin_port), 0, seq, len);
<a name="l01107"></a>01107    }
<a name="l01108"></a>01108       
<a name="l01109"></a>01109    <span class="keywordflow">return</span> 0;
<a name="l01110"></a>01110 }
</pre></div></p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:23:33 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
