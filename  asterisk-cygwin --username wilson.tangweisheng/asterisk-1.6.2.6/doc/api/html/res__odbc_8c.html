<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:23:16 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_318a70d4e812a718d9ecaeea98fff199.html">res</a>
  </div>
</div>
<div class="contents">
<h1>res_odbc.c File Reference</h1>
<p>ODBC resource manager.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="asterisk_8h_source.html">asterisk.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="file_8h_source.html">asterisk/file.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="channel_8h_source.html">asterisk/channel.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="config_8h_source.html">asterisk/config.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="pbx_8h_source.html">asterisk/pbx.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="module_8h_source.html">asterisk/module.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="cli_8h_source.html">asterisk/cli.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="lock_8h_source.html">asterisk/lock.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="res__odbc_8h_source.html">asterisk/res_odbc.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="time_8h_source.html">asterisk/time.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="astobj2_8h_source.html">asterisk/astobj2.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="app_8h_source.html">asterisk/app.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="strings_8h_source.html">asterisk/strings.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="threadstorage_8h_source.html">asterisk/threadstorage.h</a>&quot;</code><br/>

<p><a href="res__odbc_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structodbc__class.html">odbc_class</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structodbc__tables.html">odbc_tables</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structodbc__txn__frame.html">odbc_txn_frame</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#af1e97e0585fe2a1631cbc21d501320f6">EOR_TX</a>&nbsp;&nbsp;&nbsp;(void *)(long)3</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a2ca13cc687b31de4a8cb9071cf5208ef">NO_TX</a>&nbsp;&nbsp;&nbsp;(void *)(long)2</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#acc6834ef6d1c44daa24e94fb77a8d98a">USE_TX</a>&nbsp;&nbsp;&nbsp;(void *)(long)1</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a81839a7b716a2b601c380423375a3044">__init_errors_buf</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a88b7c88fed6b80fd18f34f97757dfc04">__reg_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#afeab1257bd17282b95875499393a147a">__unreg_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a8b4d273755ddbc90788622e6d516f5cd">acf_transaction_read</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *cmd, char *data, char *<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, size_t len)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a61a9c819af98717ab644e37d4a7f10b6">acf_transaction_write</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *cmd, char *s, const char *value)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a4774f9275056e3537178e5ce30daf2fa">aoro2_class_cb</a> (void *obj, void *arg, int flags)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a7e917d482947c7704537c0ca191bfde0">aoro2_obj_cb</a> (void *vobj, void *arg, int flags)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">SQLRETURN&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#ac208eda3a7586ac7aaf63949186f95b4">ast_odbc_ast_str_SQLGetData</a> (struct <a class="el" href="structast__str.html">ast_str</a> **<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, int pmaxlen, SQLHSTMT StatementHandle, SQLUSMALLINT ColumnNumber, SQLSMALLINT TargetType, SQLLEN *StrLen_or_Ind)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Wrapper for SQLGetData to use with dynamic strings.  <a href="#ac208eda3a7586ac7aaf63949186f95b4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a9fb64cb1a2fcc8c4f627fba961f84a4e">ast_odbc_backslash_is_escape</a> (struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *obj)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Checks if the database natively supports backslash as an escape character.  <a href="#a9fb64cb1a2fcc8c4f627fba961f84a4e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a8632a3816d017c47147342465a488301">ast_odbc_clear_cache</a> (const char *database, const char *tablename)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Remove a cache entry from memory.  <a href="#a8632a3816d017c47147342465a488301"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">SQLHSTMT&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#ac29fe8d9aba364c43aa8b5c47e48587e">ast_odbc_direct_execute</a> (struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *obj, SQLHSTMT(*exec_cb)(struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *obj, void *data), void *data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Executes an non prepared statement and returns the resulting statement handle.  <a href="#ac29fe8d9aba364c43aa8b5c47e48587e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structodbc__cache__columns.html">odbc_cache_columns</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#afa284d7796514825c1783efdd5f29c68">ast_odbc_find_column</a> (struct <a class="el" href="structodbc__cache__tables.html">odbc_cache_tables</a> *<a class="el" href="cdr__sqlite3__custom_8c.html#aa334abe35e252ebf7a2c7c29572bc60f">table</a>, const char *colname)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find a column entry within a cached table structure.  <a href="#afa284d7796514825c1783efdd5f29c68"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structodbc__cache__tables.html">odbc_cache_tables</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#aa15ed6f1d16784d3e2961c0bef9352c8">ast_odbc_find_table</a> (const char *database, const char *tablename)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find or create an entry describing the table specified.  <a href="#aa15ed6f1d16784d3e2961c0bef9352c8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">SQLHSTMT&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#ad1e82a2b1ba4eda1924d8b8f591de065">ast_odbc_prepare_and_execute</a> (struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *obj, SQLHSTMT(*prepare_cb)(struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *obj, void *data), void *data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Prepares, executes, and returns the resulting statement handle.  <a href="#ad1e82a2b1ba4eda1924d8b8f591de065"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a78d14d1dd01c269c9c0a47b49475eeea">ast_odbc_release_obj</a> (struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *obj)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Releases an ODBC object previously allocated by odbc_request_obj().  <a href="#a78d14d1dd01c269c9c0a47b49475eeea"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#ad34ae2bdba165ef6c7405afc94f2a7f3">ast_odbc_request_obj</a> (const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, int check)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a84fc89afd16a11b3a1095fb108e2a7ec">ast_odbc_request_obj2</a> (const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, struct <a class="el" href="structast__flags.html">ast_flags</a> flags)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Retrieves a connected ODBC object.  <a href="#a84fc89afd16a11b3a1095fb108e2a7ec"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a14e6fc16f400d47e35ef4a0f2b220c53">ast_odbc_retrieve_transaction_obj</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *objname)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Retrieve a stored ODBC object, if a transaction has been started.  <a href="#a14e6fc16f400d47e35ef4a0f2b220c53"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a91a6be5993a0928cd527b584ec3407b7">ast_odbc_sanity_check</a> (struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *obj)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Checks an ODBC object to ensure it is still connected.  <a href="#a91a6be5993a0928cd527b584ec3407b7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#af8da93ee13b95c6aae6a79558869812a">ast_odbc_smart_execute</a> (struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *obj, SQLHSTMT stmt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Executes a prepared statement handle.  <a href="#af8da93ee13b95c6aae6a79558869812a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a2a49ba6d50b0e13140c63cec43cf3db7">commit_exec</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a9f262bdbb941597f050a0eacbf518d51">destroy_table_cache</a> (struct <a class="el" href="structodbc__cache__tables.html">odbc_cache_tables</a> *<a class="el" href="cdr__sqlite3__custom_8c.html#aa334abe35e252ebf7a2c7c29572bc60f">table</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structodbc__txn__frame.html">odbc_txn_frame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a00e68e8fd24bd80b6fd5f4af94e1b993">find_transaction</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *obj, const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, int active)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a80e54e9debaeb3cd948b18b9c425cf4b">handle_cli_odbc_show</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#aca44899b469bbddf9121412dde355864">isolation2text</a> (int iso)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a36bab917a61d04ba199008e31caf13b0">load_odbc_config</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a3c503c85e1a5537b72a364bb4441689b">mark_transaction_active</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structodbc__txn__frame.html">odbc_txn_frame</a> *tx)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a6724d6d8473543d898391aa5ed322d0d">null_hash_fn</a> (const void *obj, const int flags)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a926fb02d40cc6c737ef3bdaa37748346">odbc_class_destructor</a> (void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="res__odbc_8h.html#a105a23abbc3dcfda7728a1a39987b3d6">odbc_status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a5f3e9c3099b36a9c5cf70c19f9935d38">odbc_obj_connect</a> (struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *obj)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a4d57d49f8c33dc81fb16699d63ff8f26">odbc_obj_destructor</a> (void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="res__odbc_8h.html#a105a23abbc3dcfda7728a1a39987b3d6">odbc_status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#ac83b00e5ebe4dcb0af74363ac609c8d5">odbc_obj_disconnect</a> (struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *obj)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a37d2ad3db8f19b56f61d47bfbf7b3dbe">odbc_register_class</a> (struct <a class="el" href="structodbc__class.html">odbc_class</a> *class, int connect)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a0cb988b805f7ef81fa43f5d8096576d2">odbc_release_obj2</a> (struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *obj, struct <a class="el" href="structodbc__txn__frame.html">odbc_txn_frame</a> *tx)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a9b1c173ec21f662bf76dc0f4f848f9a8">odbc_txn_free</a> (void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structodbc__txn__frame.html">odbc_txn_frame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a256f41c7de2821db8c2913ee5b720ec2">release_transaction</a> (struct <a class="el" href="structodbc__txn__frame.html">odbc_txn_frame</a> *tx)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#ae348b1f7286504f427377ac2f34a5207">rollback_exec</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a55a59530704f7603d65dcfff89e54e1f">text2isolation</a> (const char *txt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a> (void)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__module__info.html">ast_module_info</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a> = { .<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = AST_MODULE, .flags = AST_MODFLAG_GLOBAL_SYMBOLS , .<a class="el" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a> = &quot;ODBC resource&quot; , .key = &quot;This paragraph is copyright (c) 2006 by Digium, Inc. \In order for your module to load, it must return this \key via a function called \&quot;key\&quot;. Any code which \includes this paragraph must be licensed under the GNU \General Public License <a class="el" href="res__config__pgsql_8c.html#aad880fc4455c253781e8968f2239d56f">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = &quot;aefddfaffd51bc118c14a748e96eb9a0&quot; , .load = load_module, .unload = unload_module, .reload = reload, }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#ad10e6ff5ddbbabf4740767dce0436391">app_commit</a> = &quot;ODBC_Commit&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a337085be7d10d0e93fddb07541942225">app_rollback</a> = &quot;ODBC_Rollback&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__module__info.html">ast_module_info</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#ae25b9f3970870610911f8850897e8ead">ast_module_info</a> = &amp;<a class="el" href="res__timing__timerfd_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structao2__container.html">ao2_container</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a9412fb74c274dc0c012fd7b4f5b6aa71">class_container</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a16471fdb7e5070f8c0e991360e80ad6a">cli_odbc</a> []</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__threadstorage.html">ast_threadstorage</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a12c713dc409f1b0d877c59abf81a9a00">errors_buf</a> = { .once = PTHREAD_ONCE_INIT , .key_init = __init_errors_buf , .custom_init = NULL , }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__custom__function.html">ast_custom_function</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a1e4b8faa910452a9acca534b7ae5ade2">odbc_function</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__datastore__info.html">ast_datastore_info</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8c.html#a39d901a085de05b4b891f3643347316a">txn_info</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>ODBC resource manager. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Mark Spencer &lt;<a href="mailto:markster@digium.com">markster@digium.com</a>&gt; </dd>
<dd>
Anthony Minessale II &lt;<a href="mailto:anthmct@yahoo.com">anthmct@yahoo.com</a>&gt; </dd>
<dd>
Tilghman Lesher &lt;<a href="mailto:tilghman@digium.com">tilghman@digium.com</a>&gt;</dd></dl>
<ul>
<li>See also: <a class="el" href="cdr_odbc.html">ODBC CDR driver configuration</a> </li>
</ul>

<p>Definition in file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="af1e97e0585fe2a1631cbc21d501320f6"></a><!-- doxytag: member="res_odbc.c::EOR_TX" ref="af1e97e0585fe2a1631cbc21d501320f6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define EOR_TX&nbsp;&nbsp;&nbsp;(void *)(long)3</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l01138">1138</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>Referenced by <a class="el" href="res__odbc_8c_source.html#l01140">aoro2_obj_cb()</a>, and <a class="el" href="res__odbc_8c_source.html#l01156">ast_odbc_request_obj2()</a>.</p>

</div>
</div>
<a class="anchor" id="a2ca13cc687b31de4a8cb9071cf5208ef"></a><!-- doxytag: member="res_odbc.c::NO_TX" ref="a2ca13cc687b31de4a8cb9071cf5208ef" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NO_TX&nbsp;&nbsp;&nbsp;(void *)(long)2</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l01137">1137</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>Referenced by <a class="el" href="res__odbc_8c_source.html#l01140">aoro2_obj_cb()</a>, and <a class="el" href="res__odbc_8c_source.html#l01156">ast_odbc_request_obj2()</a>.</p>

</div>
</div>
<a class="anchor" id="acc6834ef6d1c44daa24e94fb77a8d98a"></a><!-- doxytag: member="res_odbc.c::USE_TX" ref="acc6834ef6d1c44daa24e94fb77a8d98a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define USE_TX&nbsp;&nbsp;&nbsp;(void *)(long)1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l01136">1136</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>Referenced by <a class="el" href="res__odbc_8c_source.html#l01140">aoro2_obj_cb()</a>, and <a class="el" href="res__odbc_8c_source.html#l01156">ast_odbc_request_obj2()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a81839a7b716a2b601c380423375a3044"></a><!-- doxytag: member="res_odbc.c::__init_errors_buf" ref="a81839a7b716a2b601c380423375a3044" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void __init_errors_buf </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l00146">146</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00148"></a>00148 {
</pre></div></p>

</div>
</div>
<a class="anchor" id="a88b7c88fed6b80fd18f34f97757dfc04"></a><!-- doxytag: member="res_odbc.c::__reg_module" ref="a88b7c88fed6b80fd18f34f97757dfc04" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void __reg_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l01702">1702</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

</div>
</div>
<a class="anchor" id="afeab1257bd17282b95875499393a147a"></a><!-- doxytag: member="res_odbc.c::__unreg_module" ref="afeab1257bd17282b95875499393a147a" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void __unreg_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l01702">1702</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

</div>
</div>
<a class="anchor" id="a8b4d273755ddbc90788622e6d516f5cd"></a><!-- doxytag: member="res_odbc.c::acf_transaction_read" ref="a8b4d273755ddbc90788622e6d516f5cd" args="(struct ast_channel *chan, const char *cmd, char *data, char *buf, size_t len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int acf_transaction_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l01464">1464</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="app_8h_source.html#l00338">AST_APP_ARG</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="app_8h_source.html#l00355">AST_DECLARE_APP_ARGS</a>, <a class="el" href="app_8h_source.html#l00387">AST_STANDARD_APP_ARGS</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="res__odbc_8c_source.html#l00204">find_transaction()</a>, <a class="el" href="res__odbc_8c_source.html#l00165">odbc_txn_frame::forcecommit</a>, <a class="el" href="res__odbc_8c_source.html#l00166">odbc_txn_frame::isolation</a>, <a class="el" href="res__odbc_8c_source.html#l00170">isolation2text()</a>, and <a class="el" href="res__odbc_8c_source.html#l00167">odbc_txn_frame::name</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01465"></a>01465 {
<a name="l01466"></a>01466    <a class="code" href="app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2" title="Declare a structure to hold an application&amp;#39;s arguments.">AST_DECLARE_APP_ARGS</a>(args,
<a name="l01467"></a>01467       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(property);
<a name="l01468"></a>01468       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(opt);
<a name="l01469"></a>01469    );
<a name="l01470"></a>01470    <span class="keyword">struct </span><a class="code" href="structodbc__txn__frame.html">odbc_txn_frame</a> *tx;
<a name="l01471"></a>01471 
<a name="l01472"></a>01472    <a class="code" href="app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8" title="Performs the &amp;#39;standard&amp;#39; argument separation process for an application.">AST_STANDARD_APP_ARGS</a>(args, data);
<a name="l01473"></a>01473    <span class="keywordflow">if</span> (strcasecmp(args.property, <span class="stringliteral">&quot;transaction&quot;</span>) == 0) {
<a name="l01474"></a>01474       <span class="keywordflow">if</span> ((tx = <a class="code" href="res__odbc_8c.html#a00e68e8fd24bd80b6fd5f4af94e1b993">find_transaction</a>(chan, NULL, NULL, 1))) {
<a name="l01475"></a>01475          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, tx-&gt;<a class="code" href="structodbc__txn__frame.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>);
<a name="l01476"></a>01476          <span class="keywordflow">return</span> 0;
<a name="l01477"></a>01477       }
<a name="l01478"></a>01478    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcasecmp(args.property, <span class="stringliteral">&quot;isolation&quot;</span>) == 0) {
<a name="l01479"></a>01479       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(args.opt)) {
<a name="l01480"></a>01480          tx = <a class="code" href="res__odbc_8c.html#a00e68e8fd24bd80b6fd5f4af94e1b993">find_transaction</a>(chan, NULL, args.opt, 0);
<a name="l01481"></a>01481       } <span class="keywordflow">else</span> {
<a name="l01482"></a>01482          tx = <a class="code" href="res__odbc_8c.html#a00e68e8fd24bd80b6fd5f4af94e1b993">find_transaction</a>(chan, NULL, NULL, 1);
<a name="l01483"></a>01483       }
<a name="l01484"></a>01484       <span class="keywordflow">if</span> (tx) {
<a name="l01485"></a>01485          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <a class="code" href="res__odbc_8c.html#aca44899b469bbddf9121412dde355864">isolation2text</a>(tx-&gt;<a class="code" href="structodbc__txn__frame.html#a6515c3eadbeefabf86e088a2b9a0332e">isolation</a>), <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>);
<a name="l01486"></a>01486          <span class="keywordflow">return</span> 0;
<a name="l01487"></a>01487       }
<a name="l01488"></a>01488    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcasecmp(args.property, <span class="stringliteral">&quot;forcecommit&quot;</span>) == 0) {
<a name="l01489"></a>01489       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(args.opt)) {
<a name="l01490"></a>01490          tx = <a class="code" href="res__odbc_8c.html#a00e68e8fd24bd80b6fd5f4af94e1b993">find_transaction</a>(chan, NULL, args.opt, 0);
<a name="l01491"></a>01491       } <span class="keywordflow">else</span> {
<a name="l01492"></a>01492          tx = <a class="code" href="res__odbc_8c.html#a00e68e8fd24bd80b6fd5f4af94e1b993">find_transaction</a>(chan, NULL, NULL, 1);
<a name="l01493"></a>01493       }
<a name="l01494"></a>01494       <span class="keywordflow">if</span> (tx) {
<a name="l01495"></a>01495          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, tx-&gt;<a class="code" href="structodbc__txn__frame.html#addaad8ffa7ab4d6ad199b328ecfe234f">forcecommit</a> ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;0&quot;</span>, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>);
<a name="l01496"></a>01496          <span class="keywordflow">return</span> 0;
<a name="l01497"></a>01497       }
<a name="l01498"></a>01498    }
<a name="l01499"></a>01499    <span class="keywordflow">return</span> -1;
<a name="l01500"></a>01500 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a61a9c819af98717ab644e37d4a7f10b6"></a><!-- doxytag: member="res_odbc.c::acf_transaction_write" ref="a61a9c819af98717ab644e37d4a7f10b6" args="(struct ast_channel *chan, const char *cmd, char *s, const char *value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int acf_transaction_write </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>value</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l01502">1502</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="app_8h_source.html#l00338">AST_APP_ARG</a>, <a class="el" href="app_8h_source.html#l00355">AST_DECLARE_APP_ARGS</a>, <a class="el" href="utils_8c_source.html#l01328">ast_false()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="res__odbc_8c_source.html#l01156">ast_odbc_request_obj2()</a>, <a class="el" href="app_8h_source.html#l00387">AST_STANDARD_APP_ARGS</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="utils_8c_source.html#l01311">ast_true()</a>, <a class="el" href="res__odbc_8h_source.html#l00047">odbc_obj::con</a>, <a class="el" href="res__odbc_8c_source.html#l00204">find_transaction()</a>, <a class="el" href="res__odbc_8c_source.html#l00165">odbc_txn_frame::forcecommit</a>, <a class="el" href="res__odbc_8c_source.html#l00166">odbc_txn_frame::isolation</a>, <a class="el" href="res__odbc_8c_source.html#l00129">odbc_class::isolation</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="res__odbc_8c_source.html#l00339">mark_transaction_active()</a>, <a class="el" href="res__odbc_8c_source.html#l00156">odbc_txn_frame::obj</a>, <a class="el" href="pbx_8c_source.html#l09023">pbx_builtin_setvar_helper()</a>, <a class="el" href="res__odbc_8h_source.html#l00041">RES_ODBC_INDEPENDENT_CONNECTION</a>, <a class="el" href="strings_8h_source.html#l00072">S_OR</a>, <a class="el" href="res__odbc_8c_source.html#l00185">text2isolation()</a>, and <a class="el" href="res__odbc_8h_source.html#l00057">odbc_obj::tx</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01503"></a>01503 {
<a name="l01504"></a>01504    <a class="code" href="app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2" title="Declare a structure to hold an application&amp;#39;s arguments.">AST_DECLARE_APP_ARGS</a>(args,
<a name="l01505"></a>01505       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(property);
<a name="l01506"></a>01506       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(opt);
<a name="l01507"></a>01507    );
<a name="l01508"></a>01508    <span class="keyword">struct </span><a class="code" href="structodbc__txn__frame.html">odbc_txn_frame</a> *tx;
<a name="l01509"></a>01509    SQLINTEGER nativeerror=0, numfields=0;
<a name="l01510"></a>01510    SQLSMALLINT diagbytes=0, i;
<a name="l01511"></a>01511    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structstate.html">state</a>[10], diagnostic[256];
<a name="l01512"></a>01512 
<a name="l01513"></a>01513    <a class="code" href="app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8" title="Performs the &amp;#39;standard&amp;#39; argument separation process for an application.">AST_STANDARD_APP_ARGS</a>(args, <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>);
<a name="l01514"></a>01514    <span class="keywordflow">if</span> (strcasecmp(args.property, <span class="stringliteral">&quot;transaction&quot;</span>) == 0) {
<a name="l01515"></a>01515       <span class="comment">/* Set active transaction */</span>
<a name="l01516"></a>01516       <span class="keyword">struct </span><a class="code" href="structodbc__obj.html" title="ODBC container.">odbc_obj</a> *obj;
<a name="l01517"></a>01517       <span class="keywordflow">if</span> ((tx = <a class="code" href="res__odbc_8c.html#a00e68e8fd24bd80b6fd5f4af94e1b993">find_transaction</a>(chan, NULL, value, 0))) {
<a name="l01518"></a>01518          <a class="code" href="res__odbc_8c.html#a3c503c85e1a5537b72a364bb4441689b">mark_transaction_active</a>(chan, tx);
<a name="l01519"></a>01519       } <span class="keywordflow">else</span> {
<a name="l01520"></a>01520          <span class="comment">/* No such transaction, create one */</span>
<a name="l01521"></a>01521          <span class="keyword">struct </span><a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> <a class="code" href="structast__flags.html#ac92588540e8c1d014a08cd8a45462b19">flags</a> = { <a class="code" href="res__odbc_8h.html#a81929fb3d21206b62f55bcb744f71d5da90538ee30927dd290253a4774e361087">RES_ODBC_INDEPENDENT_CONNECTION</a> };
<a name="l01522"></a>01522          <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(args.opt) || !(obj = <a class="code" href="res__odbc_8h.html#a84fc89afd16a11b3a1095fb108e2a7ec" title="Retrieves a connected ODBC object.">ast_odbc_request_obj2</a>(args.opt, flags))) {
<a name="l01523"></a>01523             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not create transaction: invalid database specification &apos;%s&apos;\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(args.opt, <span class="stringliteral">&quot;&quot;</span>));
<a name="l01524"></a>01524             <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;ODBC_RESULT&quot;</span>, <span class="stringliteral">&quot;INVALID_DB&quot;</span>);
<a name="l01525"></a>01525             <span class="keywordflow">return</span> -1;
<a name="l01526"></a>01526          }
<a name="l01527"></a>01527          <span class="keywordflow">if</span> (!(tx = <a class="code" href="res__odbc_8c.html#a00e68e8fd24bd80b6fd5f4af94e1b993">find_transaction</a>(chan, obj, value, 0))) {
<a name="l01528"></a>01528             <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;ODBC_RESULT&quot;</span>, <span class="stringliteral">&quot;FAILED_TO_CREATE&quot;</span>);
<a name="l01529"></a>01529             <span class="keywordflow">return</span> -1;
<a name="l01530"></a>01530          }
<a name="l01531"></a>01531          obj-&gt;<a class="code" href="structodbc__obj.html#abc0ea80cbb3a49c87b90be742126523c">tx</a> = 1;
<a name="l01532"></a>01532       }
<a name="l01533"></a>01533       <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;ODBC_RESULT&quot;</span>, <span class="stringliteral">&quot;OK&quot;</span>);
<a name="l01534"></a>01534       <span class="keywordflow">return</span> 0;
<a name="l01535"></a>01535    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcasecmp(args.property, <span class="stringliteral">&quot;forcecommit&quot;</span>) == 0) {
<a name="l01536"></a>01536       <span class="comment">/* Set what happens when an uncommitted transaction ends without explicit Commit or Rollback */</span>
<a name="l01537"></a>01537       <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(args.opt)) {
<a name="l01538"></a>01538          tx = <a class="code" href="res__odbc_8c.html#a00e68e8fd24bd80b6fd5f4af94e1b993">find_transaction</a>(chan, NULL, NULL, 1);
<a name="l01539"></a>01539       } <span class="keywordflow">else</span> {
<a name="l01540"></a>01540          tx = <a class="code" href="res__odbc_8c.html#a00e68e8fd24bd80b6fd5f4af94e1b993">find_transaction</a>(chan, NULL, args.opt, 0);
<a name="l01541"></a>01541       }
<a name="l01542"></a>01542       <span class="keywordflow">if</span> (!tx) {
<a name="l01543"></a>01543          <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;ODBC_RESULT&quot;</span>, <span class="stringliteral">&quot;FAILED_TO_CREATE&quot;</span>);
<a name="l01544"></a>01544          <span class="keywordflow">return</span> -1;
<a name="l01545"></a>01545       }
<a name="l01546"></a>01546       <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(value)) {
<a name="l01547"></a>01547          tx-&gt;<a class="code" href="structodbc__txn__frame.html#addaad8ffa7ab4d6ad199b328ecfe234f">forcecommit</a> = 1;
<a name="l01548"></a>01548       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a6c3dc0bad204e9dd9890325c1c861e38" title="Make sure something is false. Determine if a string containing a boolean value is...">ast_false</a>(value)) {
<a name="l01549"></a>01549          tx-&gt;<a class="code" href="structodbc__txn__frame.html#addaad8ffa7ab4d6ad199b328ecfe234f">forcecommit</a> = 0;
<a name="l01550"></a>01550       } <span class="keywordflow">else</span> {
<a name="l01551"></a>01551          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Invalid value for forcecommit: &apos;%s&apos;\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(value, <span class="stringliteral">&quot;&quot;</span>));
<a name="l01552"></a>01552          <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;ODBC_RESULT&quot;</span>, <span class="stringliteral">&quot;INVALID_VALUE&quot;</span>);
<a name="l01553"></a>01553          <span class="keywordflow">return</span> -1;
<a name="l01554"></a>01554       }
<a name="l01555"></a>01555 
<a name="l01556"></a>01556       <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;ODBC_RESULT&quot;</span>, <span class="stringliteral">&quot;OK&quot;</span>);
<a name="l01557"></a>01557       <span class="keywordflow">return</span> 0;
<a name="l01558"></a>01558    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcasecmp(args.property, <span class="stringliteral">&quot;isolation&quot;</span>) == 0) {
<a name="l01559"></a>01559       <span class="comment">/* How do uncommitted transactions affect reads? */</span>
<a name="l01560"></a>01560       <span class="keywordtype">int</span> isolation = <a class="code" href="res__odbc_8c.html#a55a59530704f7603d65dcfff89e54e1f">text2isolation</a>(value);
<a name="l01561"></a>01561       <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(args.opt)) {
<a name="l01562"></a>01562          tx = <a class="code" href="res__odbc_8c.html#a00e68e8fd24bd80b6fd5f4af94e1b993">find_transaction</a>(chan, NULL, NULL, 1);
<a name="l01563"></a>01563       } <span class="keywordflow">else</span> {
<a name="l01564"></a>01564          tx = <a class="code" href="res__odbc_8c.html#a00e68e8fd24bd80b6fd5f4af94e1b993">find_transaction</a>(chan, NULL, args.opt, 0);
<a name="l01565"></a>01565       }
<a name="l01566"></a>01566       <span class="keywordflow">if</span> (!tx) {
<a name="l01567"></a>01567          <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;ODBC_RESULT&quot;</span>, <span class="stringliteral">&quot;FAILED_TO_CREATE&quot;</span>);
<a name="l01568"></a>01568          <span class="keywordflow">return</span> -1;
<a name="l01569"></a>01569       }
<a name="l01570"></a>01570       <span class="keywordflow">if</span> (isolation == 0) {
<a name="l01571"></a>01571          <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;ODBC_RESULT&quot;</span>, <span class="stringliteral">&quot;INVALID_VALUE&quot;</span>);
<a name="l01572"></a>01572          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Invalid isolation specification: &apos;%s&apos;\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(value, <span class="stringliteral">&quot;&quot;</span>));
<a name="l01573"></a>01573       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (SQLSetConnectAttr(tx-&gt;<a class="code" href="structodbc__txn__frame.html#ab5dd16c9db5f2ee0f0d6354952c92189">obj</a>-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, SQL_ATTR_TXN_ISOLATION, (<span class="keywordtype">void</span> *)(<span class="keywordtype">long</span>)isolation, 0) == SQL_ERROR) {
<a name="l01574"></a>01574          <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;ODBC_RESULT&quot;</span>, <span class="stringliteral">&quot;SQL_ERROR&quot;</span>);
<a name="l01575"></a>01575          SQLGetDiagField(SQL_HANDLE_DBC, tx-&gt;<a class="code" href="structodbc__txn__frame.html#ab5dd16c9db5f2ee0f0d6354952c92189">obj</a>-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, 1, SQL_DIAG_NUMBER, &amp;numfields, SQL_IS_INTEGER, &amp;diagbytes);
<a name="l01576"></a>01576          <span class="keywordflow">for</span> (i = 0; i &lt; numfields; i++) {
<a name="l01577"></a>01577             SQLGetDiagRec(SQL_HANDLE_DBC, tx-&gt;<a class="code" href="structodbc__txn__frame.html#ab5dd16c9db5f2ee0f0d6354952c92189">obj</a>-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, i + 1, state, &amp;nativeerror, diagnostic, <span class="keyword">sizeof</span>(diagnostic), &amp;diagbytes);
<a name="l01578"></a>01578             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SetConnectAttr (Txn isolation) returned an error: %s: %s\n&quot;</span>, state, diagnostic);
<a name="l01579"></a>01579             <span class="keywordflow">if</span> (i &gt; 10) {
<a name="l01580"></a>01580                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Oh, that was good.  There are really %d diagnostics?\n&quot;</span>, (<span class="keywordtype">int</span>)numfields);
<a name="l01581"></a>01581                <span class="keywordflow">break</span>;
<a name="l01582"></a>01582             }
<a name="l01583"></a>01583          }
<a name="l01584"></a>01584       } <span class="keywordflow">else</span> {
<a name="l01585"></a>01585          <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;ODBC_RESULT&quot;</span>, <span class="stringliteral">&quot;OK&quot;</span>);
<a name="l01586"></a>01586          tx-&gt;<a class="code" href="structodbc__txn__frame.html#a6515c3eadbeefabf86e088a2b9a0332e">isolation</a> = isolation;
<a name="l01587"></a>01587       }
<a name="l01588"></a>01588       <span class="keywordflow">return</span> 0;
<a name="l01589"></a>01589    } <span class="keywordflow">else</span> {
<a name="l01590"></a>01590       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unknown property: &apos;%s&apos;\n&quot;</span>, args.property);
<a name="l01591"></a>01591       <span class="keywordflow">return</span> -1;
<a name="l01592"></a>01592    }
<a name="l01593"></a>01593 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4774f9275056e3537178e5ce30daf2fa"></a><!-- doxytag: member="res_odbc.c::aoro2_class_cb" ref="a4774f9275056e3537178e5ce30daf2fa" args="(void *obj, void *arg, int flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int aoro2_class_cb </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l01126">1126</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00653">CMP_MATCH</a>, <a class="el" href="astobj2_8h_source.html#l00654">CMP_STOP</a>, and <a class="el" href="res__odbc_8c_source.html#l00119">odbc_class::name</a>.</p>

<p>Referenced by <a class="el" href="res__odbc_8c_source.html#l01156">ast_odbc_request_obj2()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01127"></a>01127 {
<a name="l01128"></a>01128    <span class="keyword">struct </span><a class="code" href="structodbc__class.html">odbc_class</a> *<span class="keyword">class </span>= obj;
<a name="l01129"></a>01129    <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a> = arg;
<a name="l01130"></a>01130    <span class="keywordflow">if</span> (!strcmp(class-&gt;name, name) &amp;&amp; !class-&gt;delme) {
<a name="l01131"></a>01131       <span class="keywordflow">return</span> <a class="code" href="astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a> | <a class="code" href="astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a>;
<a name="l01132"></a>01132    }
<a name="l01133"></a>01133    <span class="keywordflow">return</span> 0;
<a name="l01134"></a>01134 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7e917d482947c7704537c0ca191bfde0"></a><!-- doxytag: member="res_odbc.c::aoro2_obj_cb" ref="a7e917d482947c7704537c0ca191bfde0" args="(void *vobj, void *arg, int flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int aoro2_obj_cb </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>vobj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l01140">1140</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="astobj2_8h_source.html#l00653">CMP_MATCH</a>, <a class="el" href="astobj2_8h_source.html#l00654">CMP_STOP</a>, <a class="el" href="res__odbc_8c_source.html#l01138">EOR_TX</a>, <a class="el" href="res__odbc_8h_source.html#l00046">odbc_obj::lock</a>, <a class="el" href="res__odbc_8c_source.html#l01137">NO_TX</a>, <a class="el" href="res__odbc_8h_source.html#l00057">odbc_obj::tx</a>, <a class="el" href="res__odbc_8c_source.html#l01136">USE_TX</a>, and <a class="el" href="res__odbc_8h_source.html#l00055">odbc_obj::used</a>.</p>

<p>Referenced by <a class="el" href="res__odbc_8c_source.html#l01156">ast_odbc_request_obj2()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01141"></a>01141 {
<a name="l01142"></a>01142    <span class="keyword">struct </span><a class="code" href="structodbc__obj.html" title="ODBC container.">odbc_obj</a> *obj = vobj;
<a name="l01143"></a>01143    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;obj-&gt;<a class="code" href="structodbc__obj.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01144"></a>01144    <span class="keywordflow">if</span> ((arg == <a class="code" href="res__odbc_8c.html#a2ca13cc687b31de4a8cb9071cf5208ef">NO_TX</a> &amp;&amp; !obj-&gt;<a class="code" href="structodbc__obj.html#abc0ea80cbb3a49c87b90be742126523c">tx</a>) || (arg == <a class="code" href="res__odbc_8c.html#af1e97e0585fe2a1631cbc21d501320f6">EOR_TX</a> &amp;&amp; !obj-&gt;<a class="code" href="structodbc__obj.html#a2590a5f33b83235fcf8740d3bb9b0e98">used</a>) || (arg == <a class="code" href="res__odbc_8c.html#acc6834ef6d1c44daa24e94fb77a8d98a">USE_TX</a> &amp;&amp; obj-&gt;<a class="code" href="structodbc__obj.html#abc0ea80cbb3a49c87b90be742126523c">tx</a> &amp;&amp; !obj-&gt;<a class="code" href="structodbc__obj.html#a2590a5f33b83235fcf8740d3bb9b0e98">used</a>)) {
<a name="l01145"></a>01145       obj-&gt;<a class="code" href="structodbc__obj.html#a2590a5f33b83235fcf8740d3bb9b0e98">used</a> = 1;
<a name="l01146"></a>01146       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;obj-&gt;<a class="code" href="structodbc__obj.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01147"></a>01147       <span class="keywordflow">return</span> <a class="code" href="astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a> | <a class="code" href="astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a>;
<a name="l01148"></a>01148    }
<a name="l01149"></a>01149    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;obj-&gt;<a class="code" href="structodbc__obj.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01150"></a>01150    <span class="keywordflow">return</span> 0;
<a name="l01151"></a>01151 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac208eda3a7586ac7aaf63949186f95b4"></a><!-- doxytag: member="res_odbc.c::ast_odbc_ast_str_SQLGetData" ref="ac208eda3a7586ac7aaf63949186f95b4" args="(struct ast_str **buf, int pmaxlen, SQLHSTMT StatementHandle, SQLUSMALLINT ColumnNumber, SQLSMALLINT TargetType, SQLLEN *StrLen_or_Ind)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SQLRETURN ast_odbc_ast_str_SQLGetData </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__str.html">ast_str</a> **&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pmaxlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SQLHSTMT&nbsp;</td>
          <td class="paramname"> <em>StatementHandle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SQLUSMALLINT&nbsp;</td>
          <td class="paramname"> <em>ColumnNumber</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SQLSMALLINT&nbsp;</td>
          <td class="paramname"> <em>TargetType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SQLLEN *&nbsp;</td>
          <td class="paramname"> <em>StrLen_or_Ind</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Wrapper for SQLGetData to use with dynamic strings. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buf</em>&nbsp;</td><td>Address of the pointer to the <a class="el" href="structast__str.html" title="The descriptor of a dynamic string XXX storage will be optimized later if needed...">ast_str</a> structure. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pmaxlen</em>&nbsp;</td><td>The maximum size of the resulting string, or 0 for no limit. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>StatementHandle</em>&nbsp;</td><td>The statement handle from which to retrieve data. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ColumnNumber</em>&nbsp;</td><td>Column <a class="el" href="structnumber.html" title="Number structure.">number</a> (1-based offset) for which to retrieve data. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>TargetType</em>&nbsp;</td><td>The SQL constant indicating what kind of data is to be retrieved (usually SQL_CHAR) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>StrLen_or_Ind</em>&nbsp;</td><td>A pointer to a length indicator, specifying the total length of data. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l00678">678</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00488">ast_str_buffer()</a>, <a class="el" href="strings_8h_source.html#l00573">ast_str_make_space()</a>, <a class="el" href="strings_8h_source.html#l00477">ast_str_size()</a>, and <a class="el" href="strings_8h_source.html#l00441">ast_str_update()</a>.</p>

<p>Referenced by <a class="el" href="func__odbc_8c_source.html#l00375">acf_odbc_read()</a>, and <a class="el" href="func__odbc_8c_source.html#l00978">cli_odbc_read()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00679"></a>00679 {
<a name="l00680"></a>00680    SQLRETURN res;
<a name="l00681"></a>00681 
<a name="l00682"></a>00682    <span class="keywordflow">if</span> (pmaxlen == 0) {
<a name="l00683"></a>00683       <span class="keywordflow">if</span> (SQLGetData(StatementHandle, ColumnNumber, TargetType, <a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(*buf), 0, StrLen_or_Ind) == SQL_SUCCESS_WITH_INFO) {
<a name="l00684"></a>00684          <a class="code" href="strings_8h.html#a7f20a4560b028f55b5d723f02f5830cb">ast_str_make_space</a>(buf, *StrLen_or_Ind + 1);
<a name="l00685"></a>00685       }
<a name="l00686"></a>00686    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pmaxlen &gt; 0) {
<a name="l00687"></a>00687       <a class="code" href="strings_8h.html#a7f20a4560b028f55b5d723f02f5830cb">ast_str_make_space</a>(buf, pmaxlen);
<a name="l00688"></a>00688    }
<a name="l00689"></a>00689    res = SQLGetData(StatementHandle, ColumnNumber, TargetType, <a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(*buf), <a class="code" href="strings_8h.html#ab9726d03e7f9f4746876d71bea28de33" title="Returns the current maximum length (without reallocation) of the current buffer.">ast_str_size</a>(*buf), StrLen_or_Ind);
<a name="l00690"></a>00690    <a class="code" href="strings_8h.html#a8887fcac1220a7528e88efc16f751415" title="Update the length of the buffer, after using ast_str merely as a buffer.">ast_str_update</a>(*buf);
<a name="l00691"></a>00691 
<a name="l00692"></a>00692    <span class="keywordflow">return</span> res;
<a name="l00693"></a>00693 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9fb64cb1a2fcc8c4f627fba961f84a4e"></a><!-- doxytag: member="res_odbc.c::ast_odbc_backslash_is_escape" ref="a9fb64cb1a2fcc8c4f627fba961f84a4e" args="(struct odbc_obj *obj)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_odbc_backslash_is_escape </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Checks if the database natively supports backslash as an escape character. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>obj</em>&nbsp;</td><td>The ODBC object </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns 1 if backslash is a native escape character, 0 if an ESCAPE clause is needed to support '\' </dd></dl>

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l01047">1047</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="res__odbc_8c_source.html#l00127">odbc_class::backslash_is_escape</a>, and <a class="el" href="res__odbc_8h_source.html#l00048">odbc_obj::parent</a>.</p>

<p>Referenced by <a class="el" href="cdr__adaptive__odbc_8c_source.html#l00343">odbc_log()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00256">realtime_multi_odbc()</a>, and <a class="el" href="res__config__odbc_8c_source.html#l00111">realtime_odbc()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01048"></a>01048 {
<a name="l01049"></a>01049    <span class="keywordflow">return</span> obj-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a>-&gt;<a class="code" href="structodbc__class.html#a6d5083df37a331ad8166d5f658cc900b">backslash_is_escape</a>;
<a name="l01050"></a>01050 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8632a3816d017c47147342465a488301"></a><!-- doxytag: member="res_odbc.c::ast_odbc_clear_cache" ref="a8632a3816d017c47147342465a488301" args="(const char *database, const char *tablename)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_odbc_clear_cache </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>database</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>tablename</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Remove a cache entry from memory. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>database</em>&nbsp;</td><td>Name of an ODBC class (used to ensure like-named <a class="el" href="structtables.html">tables</a> in different databases are not confused) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tablename</em>&nbsp;</td><td>Tablename for which a cached record should be removed </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if the cache entry was removed, or -1 if no matching entry was found. </td></tr>
  </table>
  </dd>
</dl>
<dl class="since"><dt><b>Since:</b></dt><dd>1.6.1 </dd></dl>

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l00551">551</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00553">AST_LIST_REMOVE_CURRENT</a>, <a class="el" href="linkedlists_8h_source.html#l00541">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h_source.html#l00601">AST_RWLIST_TRAVERSE_SAFE_END</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="res__odbc_8h_source.html#l00074">odbc_cache_tables::connection</a>, <a class="el" href="res__odbc_8c_source.html#l00404">destroy_table_cache()</a>, <a class="el" href="structodbc__class.html#a033c9e1d6a001b7c5dc1a71ab21d0357">odbc_class::list</a>, and <a class="el" href="res__odbc_8h_source.html#l00075">odbc_cache_tables::table</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00552"></a>00552 {
<a name="l00553"></a>00553    <span class="keyword">struct </span><a class="code" href="structodbc__cache__tables.html">odbc_cache_tables</a> *tableptr;
<a name="l00554"></a>00554 
<a name="l00555"></a>00555    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structodbc__tables.html">odbc_tables</a>);
<a name="l00556"></a>00556    <a class="code" href="linkedlists_8h.html#a21be6da4b2146b04b4868c2be5cae750">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>(&amp;<a class="code" href="structodbc__tables.html">odbc_tables</a>, tableptr, <a class="code" href="structodbc__cache__tables.html#a5f5e109ccb3b0383bd2b9ceefc3fa56a">list</a>) {
<a name="l00557"></a>00557       <span class="keywordflow">if</span> (strcmp(tableptr-&gt;<a class="code" href="structodbc__cache__tables.html#a2d51bc73bf08dbc3fcf184c65ce6622c">connection</a>, database) == 0 &amp;&amp; strcmp(tableptr-&gt;<a class="code" href="structodbc__cache__tables.html#abc4810aa7718733bfc48b1973f4c92f8">table</a>, tablename) == 0) {
<a name="l00558"></a>00558          <a class="code" href="linkedlists_8h.html#aa8ac496fa9c717d5afb99a02e1e2760c" title="Removes the current entry from a list during a traversal.">AST_LIST_REMOVE_CURRENT</a>(<a class="code" href="structodbc__cache__tables.html#a5f5e109ccb3b0383bd2b9ceefc3fa56a">list</a>);
<a name="l00559"></a>00559          <a class="code" href="res__odbc_8c.html#a9f262bdbb941597f050a0eacbf518d51">destroy_table_cache</a>(tableptr);
<a name="l00560"></a>00560          <span class="keywordflow">break</span>;
<a name="l00561"></a>00561       }
<a name="l00562"></a>00562    }
<a name="l00563"></a>00563    <a class="code" href="linkedlists_8h.html#a6bf0e81cb6ef01532ddebaba68f6de28">AST_RWLIST_TRAVERSE_SAFE_END</a>
<a name="l00564"></a>00564    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structodbc__tables.html">odbc_tables</a>);
<a name="l00565"></a>00565    <span class="keywordflow">return</span> tableptr ? 0 : -1;
<a name="l00566"></a>00566 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac29fe8d9aba364c43aa8b5c47e48587e"></a><!-- doxytag: member="res_odbc.c::ast_odbc_direct_execute" ref="ac29fe8d9aba364c43aa8b5c47e48587e" args="(struct odbc_obj *obj, SQLHSTMT(*exec_cb)(struct odbc_obj *obj, void *data), void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SQLHSTMT ast_odbc_direct_execute </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SQLHSTMT(*)(struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *obj, void *data)&nbsp;</td>
          <td class="paramname"> <em>exec_cb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Executes an non prepared statement and returns the resulting statement handle. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>obj</em>&nbsp;</td><td>The ODBC object </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>exec_cb</em>&nbsp;</td><td>A function callback, which, when called, should return a statement handle with result <a class="el" href="structcolumns.html">columns</a> bound. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>A parameter to be passed to the exec_cb parameter function, indicating which statement handle is to be prepared. </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>a</em>&nbsp;</td><td>statement handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>NULL</em>&nbsp;</td><td>on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l00568">568</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="res__odbc_8c_source.html#l01411">odbc_obj_connect()</a>, <a class="el" href="res__odbc_8c_source.html#l01374">odbc_obj_disconnect()</a>, <a class="el" href="res__odbc_8h_source.html#l00057">odbc_obj::tx</a>, and <a class="el" href="res__odbc_8h_source.html#l00056">odbc_obj::up</a>.</p>

<p>Referenced by <a class="el" href="func__odbc_8c_source.html#l00375">acf_odbc_read()</a>, <a class="el" href="func__odbc_8c_source.html#l00203">acf_odbc_write()</a>, <a class="el" href="func__odbc_8c_source.html#l00978">cli_odbc_read()</a>, <a class="el" href="func__odbc_8c_source.html#l01177">cli_odbc_write()</a>, and <a class="el" href="cdr__odbc_8c_source.html#l00127">odbc_log()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00569"></a>00569 {
<a name="l00570"></a>00570    <span class="keywordtype">int</span> attempt;
<a name="l00571"></a>00571    SQLHSTMT stmt;
<a name="l00572"></a>00572 
<a name="l00573"></a>00573    <span class="keywordflow">for</span> (attempt = 0; attempt &lt; 2; attempt++) {
<a name="l00574"></a>00574       stmt = exec_cb(obj, data);
<a name="l00575"></a>00575 
<a name="l00576"></a>00576       <span class="keywordflow">if</span> (stmt) {
<a name="l00577"></a>00577          <span class="keywordflow">break</span>;
<a name="l00578"></a>00578       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (obj-&gt;<a class="code" href="structodbc__obj.html#abc0ea80cbb3a49c87b90be742126523c">tx</a>) {
<a name="l00579"></a>00579          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to execute, but unable to reconnect, as we&apos;re transactional.\n&quot;</span>);
<a name="l00580"></a>00580          <span class="keywordflow">break</span>;
<a name="l00581"></a>00581       } <span class="keywordflow">else</span> {
<a name="l00582"></a>00582          obj-&gt;<a class="code" href="structodbc__obj.html#a8042aba89daa6448b14e94e6d0bb63bf">up</a> = 0;
<a name="l00583"></a>00583          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SQL Exec Direct failed.  Attempting a reconnect...\n&quot;</span>);
<a name="l00584"></a>00584 
<a name="l00585"></a>00585          <a class="code" href="res__odbc_8c.html#ac83b00e5ebe4dcb0af74363ac609c8d5">odbc_obj_disconnect</a>(obj);
<a name="l00586"></a>00586          <a class="code" href="res__odbc_8c.html#a5f3e9c3099b36a9c5cf70c19f9935d38">odbc_obj_connect</a>(obj);
<a name="l00587"></a>00587       }
<a name="l00588"></a>00588    }
<a name="l00589"></a>00589 
<a name="l00590"></a>00590    <span class="keywordflow">return</span> stmt;
<a name="l00591"></a>00591 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afa284d7796514825c1783efdd5f29c68"></a><!-- doxytag: member="res_odbc.c::ast_odbc_find_column" ref="afa284d7796514825c1783efdd5f29c68" args="(struct odbc_cache_tables *table, const char *colname)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structodbc__cache__columns.html">odbc_cache_columns</a>* ast_odbc_find_column </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structodbc__cache__tables.html">odbc_cache_tables</a> *&nbsp;</td>
          <td class="paramname"> <em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>colname</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find a column entry within a cached table structure. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>table</em>&nbsp;</td><td>Cached table structure, as returned from <a class="el" href="res__odbc_8h.html#aa15ed6f1d16784d3e2961c0bef9352c8" title="Find or create an entry describing the table specified.">ast_odbc_find_table()</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>colname</em>&nbsp;</td><td>The column name requested </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>A</em>&nbsp;</td><td>structure describing the column type, or NULL, if the column is not found. </td></tr>
  </table>
  </dd>
</dl>
<dl class="since"><dt><b>Since:</b></dt><dd>1.6.1 </dd></dl>

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l00540">540</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, <a class="el" href="structodbc__cache__tables.html#a09f857e5d5d25c0d2065acfbb45afe6c">odbc_cache_tables::columns</a>, <a class="el" href="structodbc__class.html#a033c9e1d6a001b7c5dc1a71ab21d0357">odbc_class::list</a>, and <a class="el" href="res__odbc_8h_source.html#l00063">odbc_cache_columns::name</a>.</p>

<p>Referenced by <a class="el" href="res__config__odbc_8c_source.html#l00485">update2_prepare()</a>, and <a class="el" href="res__config__odbc_8c_source.html#l00404">update_odbc()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00541"></a>00541 {
<a name="l00542"></a>00542    <span class="keyword">struct </span><a class="code" href="structodbc__cache__columns.html">odbc_cache_columns</a> *col;
<a name="l00543"></a>00543    <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;table-&gt;<a class="code" href="structodbc__cache__tables.html#a09f857e5d5d25c0d2065acfbb45afe6c">columns</a>, col, <a class="code" href="structodbc__cache__columns.html#a104d3ecbbd644ca8156e812056c5ce90">list</a>) {
<a name="l00544"></a>00544       <span class="keywordflow">if</span> (strcasecmp(col-&gt;<a class="code" href="structodbc__cache__columns.html#a5ac083a645d964373f022d03df4849c8">name</a>, colname) == 0) {
<a name="l00545"></a>00545          <span class="keywordflow">return</span> col;
<a name="l00546"></a>00546       }
<a name="l00547"></a>00547    }
<a name="l00548"></a>00548    <span class="keywordflow">return</span> NULL;
<a name="l00549"></a>00549 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa15ed6f1d16784d3e2961c0bef9352c8"></a><!-- doxytag: member="res_odbc.c::ast_odbc_find_table" ref="aa15ed6f1d16784d3e2961c0bef9352c8" args="(const char *database, const char *tablename)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structodbc__cache__tables.html">odbc_cache_tables</a>* ast_odbc_find_table </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>database</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>tablename</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find or create an entry describing the table specified. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>database</em>&nbsp;</td><td>Name of an ODBC class on which to query the table </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tablename</em>&nbsp;</td><td>Tablename to describe </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>A</em>&nbsp;</td><td>structure describing the table layout, or NULL, if the table is not found or another error occurs. When a structure is returned, the contained <a class="el" href="structcolumns.html">columns</a> list will be rdlock'ed, to ensure that it will be retained in memory. </td></tr>
  </table>
  </dd>
</dl>
<dl class="since"><dt><b>Since:</b></dt><dd>1.6.1 </dd></dl>

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l00425">425</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="linkedlists_8h_source.html#l00715">AST_LIST_INSERT_TAIL</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="res__odbc_8c_source.html#l01041">ast_odbc_release_obj()</a>, <a class="el" href="res__odbc_8c_source.html#l01331">ast_odbc_request_obj()</a>, <a class="el" href="res__odbc_8c_source.html#l00695">ast_odbc_sanity_check()</a>, <a class="el" href="linkedlists_8h_source.html#l00623">AST_RWLIST_HEAD_INIT</a>, <a class="el" href="linkedlists_8h_source.html#l00725">AST_RWLIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00077">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="structodbc__cache__tables.html#a09f857e5d5d25c0d2065acfbb45afe6c">odbc_cache_tables::columns</a>, <a class="el" href="res__odbc_8h_source.html#l00047">odbc_obj::con</a>, <a class="el" href="res__odbc_8h_source.html#l00074">odbc_cache_tables::connection</a>, <a class="el" href="res__odbc_8h_source.html#l00066">odbc_cache_columns::decimals</a>, <a class="el" href="res__odbc_8c_source.html#l00404">destroy_table_cache()</a>, <a class="el" href="structodbc__class.html#a033c9e1d6a001b7c5dc1a71ab21d0357">odbc_class::list</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="res__odbc_8h_source.html#l00063">odbc_cache_columns::name</a>, <a class="el" href="res__odbc_8h_source.html#l00068">odbc_cache_columns::nullable</a>, <a class="el" href="res__odbc_8h_source.html#l00069">odbc_cache_columns::octetlen</a>, <a class="el" href="res__odbc_8h_source.html#l00067">odbc_cache_columns::radix</a>, <a class="el" href="res__odbc_8h_source.html#l00065">odbc_cache_columns::size</a>, <a class="el" href="res__odbc_8h_source.html#l00075">odbc_cache_tables::table</a>, and <a class="el" href="res__odbc_8h_source.html#l00064">odbc_cache_columns::type</a>.</p>

<p>Referenced by <a class="el" href="res__config__odbc_8c_source.html#l00884">require_odbc()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00485">update2_prepare()</a>, and <a class="el" href="res__config__odbc_8c_source.html#l00404">update_odbc()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00426"></a>00426 {
<a name="l00427"></a>00427    <span class="keyword">struct </span><a class="code" href="structodbc__cache__tables.html">odbc_cache_tables</a> *tableptr;
<a name="l00428"></a>00428    <span class="keyword">struct </span><a class="code" href="structodbc__cache__columns.html">odbc_cache_columns</a> *entry;
<a name="l00429"></a>00429    <span class="keywordtype">char</span> columnname[80];
<a name="l00430"></a>00430    SQLLEN sqlptr;
<a name="l00431"></a>00431    SQLHSTMT stmt = NULL;
<a name="l00432"></a>00432    <span class="keywordtype">int</span> res = 0, error = 0, <span class="keywordflow">try</span> = 0;
<a name="l00433"></a>00433    <span class="keyword">struct </span><a class="code" href="structodbc__obj.html" title="ODBC container.">odbc_obj</a> *obj = <a class="code" href="res__odbc_8h.html#ad34ae2bdba165ef6c7405afc94f2a7f3">ast_odbc_request_obj</a>(database, 0);
<a name="l00434"></a>00434 
<a name="l00435"></a>00435    <a class="code" href="linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc" title="Read locks a list.">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="structodbc__tables.html">odbc_tables</a>);
<a name="l00436"></a>00436    <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="structodbc__tables.html">odbc_tables</a>, tableptr, <a class="code" href="structodbc__obj.html#aea00fd1bbee2b8de5f83330881655694">list</a>) {
<a name="l00437"></a>00437       <span class="keywordflow">if</span> (strcmp(tableptr-&gt;<a class="code" href="structodbc__cache__tables.html#a2d51bc73bf08dbc3fcf184c65ce6622c">connection</a>, database) == 0 &amp;&amp; strcmp(tableptr-&gt;<a class="code" href="structodbc__cache__tables.html#abc4810aa7718733bfc48b1973f4c92f8">table</a>, tablename) == 0) {
<a name="l00438"></a>00438          <span class="keywordflow">break</span>;
<a name="l00439"></a>00439       }
<a name="l00440"></a>00440    }
<a name="l00441"></a>00441    <span class="keywordflow">if</span> (tableptr) {
<a name="l00442"></a>00442       <a class="code" href="linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc" title="Read locks a list.">AST_RWLIST_RDLOCK</a>(&amp;tableptr-&gt;<a class="code" href="structodbc__cache__tables.html#a09f857e5d5d25c0d2065acfbb45afe6c">columns</a>);
<a name="l00443"></a>00443       <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structodbc__tables.html">odbc_tables</a>);
<a name="l00444"></a>00444       <span class="keywordflow">if</span> (obj) {
<a name="l00445"></a>00445          <a class="code" href="res__odbc_8h.html#a78d14d1dd01c269c9c0a47b49475eeea" title="Releases an ODBC object previously allocated by odbc_request_obj().">ast_odbc_release_obj</a>(obj);
<a name="l00446"></a>00446       }
<a name="l00447"></a>00447       <span class="keywordflow">return</span> tableptr;
<a name="l00448"></a>00448    }
<a name="l00449"></a>00449 
<a name="l00450"></a>00450    <span class="keywordflow">if</span> (!obj) {
<a name="l00451"></a>00451       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to retrieve database handle for table description &apos;%s@%s&apos;\n&quot;</span>, tablename, database);
<a name="l00452"></a>00452       <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structodbc__tables.html">odbc_tables</a>);
<a name="l00453"></a>00453       <span class="keywordflow">return</span> NULL;
<a name="l00454"></a>00454    }
<a name="l00455"></a>00455 
<a name="l00456"></a>00456    <span class="comment">/* Table structure not already cached; build it now. */</span>
<a name="l00457"></a>00457    <span class="keywordflow">do</span> {
<a name="l00458"></a>00458       res = SQLAllocHandle(SQL_HANDLE_STMT, obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, &amp;stmt);
<a name="l00459"></a>00459       <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO)) {
<a name="l00460"></a>00460          <span class="keywordflow">if</span> (<span class="keywordflow">try</span> == 0) {
<a name="l00461"></a>00461             <span class="keywordflow">try</span> = 1;
<a name="l00462"></a>00462             <a class="code" href="res__odbc_8h.html#a91a6be5993a0928cd527b584ec3407b7" title="Checks an ODBC object to ensure it is still connected.">ast_odbc_sanity_check</a>(obj);
<a name="l00463"></a>00463             <span class="keywordflow">continue</span>;
<a name="l00464"></a>00464          }
<a name="l00465"></a>00465          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SQL Alloc Handle failed on connection &apos;%s&apos;!\n&quot;</span>, database);
<a name="l00466"></a>00466          <span class="keywordflow">break</span>;
<a name="l00467"></a>00467       }
<a name="l00468"></a>00468 
<a name="l00469"></a>00469       res = SQLColumns(stmt, NULL, 0, NULL, 0, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)tablename, SQL_NTS, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)<span class="stringliteral">&quot;%&quot;</span>, SQL_NTS);
<a name="l00470"></a>00470       <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO)) {
<a name="l00471"></a>00471          <span class="keywordflow">if</span> (<span class="keywordflow">try</span> == 0) {
<a name="l00472"></a>00472             <span class="keywordflow">try</span> = 1;
<a name="l00473"></a>00473             SQLFreeHandle(SQL_HANDLE_STMT, stmt);
<a name="l00474"></a>00474             <a class="code" href="res__odbc_8h.html#a91a6be5993a0928cd527b584ec3407b7" title="Checks an ODBC object to ensure it is still connected.">ast_odbc_sanity_check</a>(obj);
<a name="l00475"></a>00475             <span class="keywordflow">continue</span>;
<a name="l00476"></a>00476          }
<a name="l00477"></a>00477          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to query database columns on connection &apos;%s&apos;.\n&quot;</span>, database);
<a name="l00478"></a>00478          <span class="keywordflow">break</span>;
<a name="l00479"></a>00479       }
<a name="l00480"></a>00480 
<a name="l00481"></a>00481       <span class="keywordflow">if</span> (!(tableptr = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>), <span class="keyword">sizeof</span>(*tableptr) + strlen(database) + 1 + strlen(tablename) + 1))) {
<a name="l00482"></a>00482          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Out of memory creating entry for table &apos;%s&apos; on connection &apos;%s&apos;\n&quot;</span>, tablename, database);
<a name="l00483"></a>00483          <span class="keywordflow">break</span>;
<a name="l00484"></a>00484       }
<a name="l00485"></a>00485 
<a name="l00486"></a>00486       tableptr-&gt;<a class="code" href="structodbc__cache__tables.html#a2d51bc73bf08dbc3fcf184c65ce6622c">connection</a> = (<span class="keywordtype">char</span> *)tableptr + <span class="keyword">sizeof</span>(*tableptr);
<a name="l00487"></a>00487       tableptr-&gt;<a class="code" href="structodbc__cache__tables.html#abc4810aa7718733bfc48b1973f4c92f8">table</a> = (<span class="keywordtype">char</span> *)tableptr + <span class="keyword">sizeof</span>(*tableptr) + strlen(database) + 1;
<a name="l00488"></a>00488       strcpy(tableptr-&gt;<a class="code" href="structodbc__cache__tables.html#a2d51bc73bf08dbc3fcf184c65ce6622c">connection</a>, database); <span class="comment">/* SAFE */</span>
<a name="l00489"></a>00489       strcpy(tableptr-&gt;<a class="code" href="structodbc__cache__tables.html#abc4810aa7718733bfc48b1973f4c92f8">table</a>, tablename); <span class="comment">/* SAFE */</span>
<a name="l00490"></a>00490       <a class="code" href="linkedlists_8h.html#a389aaa73318087dfed0cdd11e1d3090b" title="Initializes an rwlist head structure.">AST_RWLIST_HEAD_INIT</a>(&amp;(tableptr-&gt;<a class="code" href="structodbc__cache__tables.html#a09f857e5d5d25c0d2065acfbb45afe6c">columns</a>));
<a name="l00491"></a>00491 
<a name="l00492"></a>00492       <span class="keywordflow">while</span> ((res = SQLFetch(stmt)) != SQL_NO_DATA &amp;&amp; res != SQL_ERROR) {
<a name="l00493"></a>00493          SQLGetData(stmt,  4, SQL_C_CHAR, columnname, <span class="keyword">sizeof</span>(columnname), &amp;sqlptr);
<a name="l00494"></a>00494 
<a name="l00495"></a>00495          <span class="keywordflow">if</span> (!(entry = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>), <span class="keyword">sizeof</span>(*entry) + strlen(columnname) + 1))) {
<a name="l00496"></a>00496             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Out of memory creating entry for column &apos;%s&apos; in table &apos;%s&apos; on connection &apos;%s&apos;\n&quot;</span>, columnname, tablename, database);
<a name="l00497"></a>00497             error = 1;
<a name="l00498"></a>00498             <span class="keywordflow">break</span>;
<a name="l00499"></a>00499          }
<a name="l00500"></a>00500          entry-&gt;<a class="code" href="structodbc__cache__columns.html#a5ac083a645d964373f022d03df4849c8">name</a> = (<span class="keywordtype">char</span> *)entry + <span class="keyword">sizeof</span>(*entry);
<a name="l00501"></a>00501          strcpy(entry-&gt;<a class="code" href="structodbc__cache__columns.html#a5ac083a645d964373f022d03df4849c8">name</a>, columnname);
<a name="l00502"></a>00502 
<a name="l00503"></a>00503          SQLGetData(stmt,  5, SQL_C_SHORT, &amp;entry-&gt;<a class="code" href="structodbc__cache__columns.html#a713b6299f1d41d81cf4fec75082f0033">type</a>, <span class="keyword">sizeof</span>(entry-&gt;<a class="code" href="structodbc__cache__columns.html#a713b6299f1d41d81cf4fec75082f0033">type</a>), NULL);
<a name="l00504"></a>00504          SQLGetData(stmt,  7, SQL_C_LONG, &amp;entry-&gt;<a class="code" href="structodbc__cache__columns.html#a8f725e63e7aaa7e48a10d571d6bc5c44">size</a>, <span class="keyword">sizeof</span>(entry-&gt;<a class="code" href="structodbc__cache__columns.html#a8f725e63e7aaa7e48a10d571d6bc5c44">size</a>), NULL);
<a name="l00505"></a>00505          SQLGetData(stmt,  9, SQL_C_SHORT, &amp;entry-&gt;<a class="code" href="structodbc__cache__columns.html#a4655a72259cd34e7468eb595a3fb0c94">decimals</a>, <span class="keyword">sizeof</span>(entry-&gt;<a class="code" href="structodbc__cache__columns.html#a4655a72259cd34e7468eb595a3fb0c94">decimals</a>), NULL);
<a name="l00506"></a>00506          SQLGetData(stmt, 10, SQL_C_SHORT, &amp;entry-&gt;<a class="code" href="structodbc__cache__columns.html#a70c49af130fccda5ef1404bf0a994ef9">radix</a>, <span class="keyword">sizeof</span>(entry-&gt;<a class="code" href="structodbc__cache__columns.html#a70c49af130fccda5ef1404bf0a994ef9">radix</a>), NULL);
<a name="l00507"></a>00507          SQLGetData(stmt, 11, SQL_C_SHORT, &amp;entry-&gt;<a class="code" href="structodbc__cache__columns.html#afa2cba5460bd1d85a31e95654006db4a">nullable</a>, <span class="keyword">sizeof</span>(entry-&gt;<a class="code" href="structodbc__cache__columns.html#afa2cba5460bd1d85a31e95654006db4a">nullable</a>), NULL);
<a name="l00508"></a>00508          SQLGetData(stmt, 16, SQL_C_LONG, &amp;entry-&gt;<a class="code" href="structodbc__cache__columns.html#a8c631ed493ba0edb1d8103971f8f7451">octetlen</a>, <span class="keyword">sizeof</span>(entry-&gt;<a class="code" href="structodbc__cache__columns.html#a8c631ed493ba0edb1d8103971f8f7451">octetlen</a>), NULL);
<a name="l00509"></a>00509 
<a name="l00510"></a>00510          <span class="comment">/* Specification states that the octenlen should be the maximum number of bytes</span>
<a name="l00511"></a>00511 <span class="comment">          * returned in a char or binary column, but it seems that some drivers just set</span>
<a name="l00512"></a>00512 <span class="comment">          * it to NULL. (Bad Postgres! No biscuit!) */</span>
<a name="l00513"></a>00513          <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="structodbc__cache__columns.html#a8c631ed493ba0edb1d8103971f8f7451">octetlen</a> == 0) {
<a name="l00514"></a>00514             entry-&gt;<a class="code" href="structodbc__cache__columns.html#a8c631ed493ba0edb1d8103971f8f7451">octetlen</a> = entry-&gt;<a class="code" href="structodbc__cache__columns.html#a8f725e63e7aaa7e48a10d571d6bc5c44">size</a>;
<a name="l00515"></a>00515          }
<a name="l00516"></a>00516 
<a name="l00517"></a>00517          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(10, <span class="stringliteral">&quot;Found %s column with type %hd with len %ld, octetlen %ld, and numlen (%hd,%hd)\n&quot;</span>, entry-&gt;<a class="code" href="structodbc__cache__columns.html#a5ac083a645d964373f022d03df4849c8">name</a>, entry-&gt;<a class="code" href="structodbc__cache__columns.html#a713b6299f1d41d81cf4fec75082f0033">type</a>, (<span class="keywordtype">long</span>) entry-&gt;<a class="code" href="structodbc__cache__columns.html#a8f725e63e7aaa7e48a10d571d6bc5c44">size</a>, (<span class="keywordtype">long</span>) entry-&gt;<a class="code" href="structodbc__cache__columns.html#a8c631ed493ba0edb1d8103971f8f7451">octetlen</a>, entry-&gt;<a class="code" href="structodbc__cache__columns.html#a4655a72259cd34e7468eb595a3fb0c94">decimals</a>, entry-&gt;<a class="code" href="structodbc__cache__columns.html#a70c49af130fccda5ef1404bf0a994ef9">radix</a>);
<a name="l00518"></a>00518          <span class="comment">/* Insert column info into column list */</span>
<a name="l00519"></a>00519          <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;(tableptr-&gt;<a class="code" href="structodbc__cache__tables.html#a09f857e5d5d25c0d2065acfbb45afe6c">columns</a>), entry, <a class="code" href="structodbc__obj.html#aea00fd1bbee2b8de5f83330881655694">list</a>);
<a name="l00520"></a>00520       }
<a name="l00521"></a>00521       SQLFreeHandle(SQL_HANDLE_STMT, stmt);
<a name="l00522"></a>00522 
<a name="l00523"></a>00523       <a class="code" href="linkedlists_8h.html#aadda916488b2d151af4426e2f06ad332">AST_RWLIST_INSERT_TAIL</a>(&amp;<a class="code" href="structodbc__tables.html">odbc_tables</a>, tableptr, <a class="code" href="structodbc__obj.html#aea00fd1bbee2b8de5f83330881655694">list</a>);
<a name="l00524"></a>00524       <a class="code" href="linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc" title="Read locks a list.">AST_RWLIST_RDLOCK</a>(&amp;(tableptr-&gt;<a class="code" href="structodbc__cache__tables.html#a09f857e5d5d25c0d2065acfbb45afe6c">columns</a>));
<a name="l00525"></a>00525       <span class="keywordflow">break</span>;
<a name="l00526"></a>00526    } <span class="keywordflow">while</span> (1);
<a name="l00527"></a>00527 
<a name="l00528"></a>00528    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structodbc__tables.html">odbc_tables</a>);
<a name="l00529"></a>00529 
<a name="l00530"></a>00530    <span class="keywordflow">if</span> (error) {
<a name="l00531"></a>00531       <a class="code" href="res__odbc_8c.html#a9f262bdbb941597f050a0eacbf518d51">destroy_table_cache</a>(tableptr);
<a name="l00532"></a>00532       tableptr = NULL;
<a name="l00533"></a>00533    }
<a name="l00534"></a>00534    <span class="keywordflow">if</span> (obj) {
<a name="l00535"></a>00535       <a class="code" href="res__odbc_8h.html#a78d14d1dd01c269c9c0a47b49475eeea" title="Releases an ODBC object previously allocated by odbc_request_obj().">ast_odbc_release_obj</a>(obj);
<a name="l00536"></a>00536    }
<a name="l00537"></a>00537    <span class="keywordflow">return</span> tableptr;
<a name="l00538"></a>00538 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad1e82a2b1ba4eda1924d8b8f591de065"></a><!-- doxytag: member="res_odbc.c::ast_odbc_prepare_and_execute" ref="ad1e82a2b1ba4eda1924d8b8f591de065" args="(struct odbc_obj *obj, SQLHSTMT(*prepare_cb)(struct odbc_obj *obj, void *data), void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SQLHSTMT ast_odbc_prepare_and_execute </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SQLHSTMT(*)(struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *obj, void *data)&nbsp;</td>
          <td class="paramname"> <em>prepare_cb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Prepares, executes, and returns the resulting statement handle. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>obj</em>&nbsp;</td><td>The ODBC object </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>prepare_cb</em>&nbsp;</td><td>A function callback, which, when called, should return a statement handle prepared, with any necessary parameters or result <a class="el" href="structcolumns.html">columns</a> bound. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>A parameter to be passed to the prepare_cb parameter function, indicating which statement handle is to be prepared. </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>a</em>&nbsp;</td><td>statement handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>NULL</em>&nbsp;</td><td>on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l00593">593</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="res__odbc_8c_source.html#l00695">ast_odbc_sanity_check()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="res__odbc_8h_source.html#l00049">odbc_obj::last_used</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="res__odbc_8h_source.html#l00057">odbc_obj::tx</a>, and <a class="el" href="res__odbc_8h_source.html#l00056">odbc_obj::up</a>.</p>

<p>Referenced by <a class="el" href="res__config__odbc_8c_source.html#l00797">config_odbc()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00709">destroy_odbc()</a>, <a class="el" href="cdr__adaptive__odbc_8c_source.html#l00343">odbc_log()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00256">realtime_multi_odbc()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00111">realtime_odbc()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00633">store_odbc()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00582">update2_odbc()</a>, and <a class="el" href="res__config__odbc_8c_source.html#l00404">update_odbc()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00594"></a>00594 {
<a name="l00595"></a>00595    <span class="keywordtype">int</span> res = 0, i, attempt;
<a name="l00596"></a>00596    SQLINTEGER nativeerror=0, numfields=0;
<a name="l00597"></a>00597    SQLSMALLINT diagbytes=0;
<a name="l00598"></a>00598    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structstate.html">state</a>[10], diagnostic[256];
<a name="l00599"></a>00599    SQLHSTMT stmt;
<a name="l00600"></a>00600 
<a name="l00601"></a>00601    <span class="keywordflow">for</span> (attempt = 0; attempt &lt; 2; attempt++) {
<a name="l00602"></a>00602       <span class="comment">/* This prepare callback may do more than just prepare -- it may also</span>
<a name="l00603"></a>00603 <span class="comment">       * bind parameters, bind results, etc.  The real key, here, is that</span>
<a name="l00604"></a>00604 <span class="comment">       * when we disconnect, all handles become invalid for most databases.</span>
<a name="l00605"></a>00605 <span class="comment">       * We must therefore redo everything when we establish a new</span>
<a name="l00606"></a>00606 <span class="comment">       * connection. */</span>
<a name="l00607"></a>00607       stmt = prepare_cb(obj, data);
<a name="l00608"></a>00608 
<a name="l00609"></a>00609       <span class="keywordflow">if</span> (stmt) {
<a name="l00610"></a>00610          res = SQLExecute(stmt);
<a name="l00611"></a>00611          <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO) &amp;&amp; (res != SQL_NO_DATA)) {
<a name="l00612"></a>00612             <span class="keywordflow">if</span> (res == SQL_ERROR) {
<a name="l00613"></a>00613                SQLGetDiagField(SQL_HANDLE_STMT, stmt, 1, SQL_DIAG_NUMBER, &amp;numfields, SQL_IS_INTEGER, &amp;diagbytes);
<a name="l00614"></a>00614                <span class="keywordflow">for</span> (i = 0; i &lt; numfields; i++) {
<a name="l00615"></a>00615                   SQLGetDiagRec(SQL_HANDLE_STMT, stmt, i + 1, state, &amp;nativeerror, diagnostic, <span class="keyword">sizeof</span>(diagnostic), &amp;diagbytes);
<a name="l00616"></a>00616                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SQL Execute returned an error %d: %s: %s (%d)\n&quot;</span>, res, state, diagnostic, diagbytes);
<a name="l00617"></a>00617                   <span class="keywordflow">if</span> (i &gt; 10) {
<a name="l00618"></a>00618                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Oh, that was good.  There are really %d diagnostics?\n&quot;</span>, (<span class="keywordtype">int</span>)numfields);
<a name="l00619"></a>00619                      <span class="keywordflow">break</span>;
<a name="l00620"></a>00620                   }
<a name="l00621"></a>00621                }
<a name="l00622"></a>00622             }
<a name="l00623"></a>00623 
<a name="l00624"></a>00624             <span class="keywordflow">if</span> (obj-&gt;<a class="code" href="structodbc__obj.html#abc0ea80cbb3a49c87b90be742126523c">tx</a>) {
<a name="l00625"></a>00625                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SQL Execute error, but unable to reconnect, as we&apos;re transactional.\n&quot;</span>);
<a name="l00626"></a>00626                <span class="keywordflow">break</span>;
<a name="l00627"></a>00627             } <span class="keywordflow">else</span> {
<a name="l00628"></a>00628                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SQL Execute error %d! Attempting a reconnect...\n&quot;</span>, res);
<a name="l00629"></a>00629                SQLFreeHandle(SQL_HANDLE_STMT, stmt);
<a name="l00630"></a>00630                stmt = NULL;
<a name="l00631"></a>00631 
<a name="l00632"></a>00632                obj-&gt;<a class="code" href="structodbc__obj.html#a8042aba89daa6448b14e94e6d0bb63bf">up</a> = 0;
<a name="l00633"></a>00633                <span class="comment">/*</span>
<a name="l00634"></a>00634 <span class="comment">                * While this isn&apos;t the best way to try to correct an error, this won&apos;t automatically</span>
<a name="l00635"></a>00635 <span class="comment">                * fail when the statement handle invalidates.</span>
<a name="l00636"></a>00636 <span class="comment">                */</span>
<a name="l00637"></a>00637                <a class="code" href="res__odbc_8h.html#a91a6be5993a0928cd527b584ec3407b7" title="Checks an ODBC object to ensure it is still connected.">ast_odbc_sanity_check</a>(obj);
<a name="l00638"></a>00638                <span class="keywordflow">continue</span>;
<a name="l00639"></a>00639             }
<a name="l00640"></a>00640          } <span class="keywordflow">else</span> {
<a name="l00641"></a>00641             obj-&gt;<a class="code" href="structodbc__obj.html#a43b2c8a8bf77a2504897ff0da9b0aa90">last_used</a> = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l00642"></a>00642          }
<a name="l00643"></a>00643          <span class="keywordflow">break</span>;
<a name="l00644"></a>00644       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (attempt == 0) {
<a name="l00645"></a>00645          <a class="code" href="res__odbc_8h.html#a91a6be5993a0928cd527b584ec3407b7" title="Checks an ODBC object to ensure it is still connected.">ast_odbc_sanity_check</a>(obj);
<a name="l00646"></a>00646       }
<a name="l00647"></a>00647    }
<a name="l00648"></a>00648 
<a name="l00649"></a>00649    <span class="keywordflow">return</span> stmt;
<a name="l00650"></a>00650 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a78d14d1dd01c269c9c0a47b49475eeea"></a><!-- doxytag: member="res_odbc.c::ast_odbc_release_obj" ref="a78d14d1dd01c269c9c0a47b49475eeea" args="(struct odbc_obj *obj)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_odbc_release_obj </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Releases an ODBC object previously allocated by odbc_request_obj(). </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>obj</em>&nbsp;</td><td>The ODBC object </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l01041">1041</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="res__odbc_8c_source.html#l00204">find_transaction()</a>, and <a class="el" href="res__odbc_8c_source.html#l00982">odbc_release_obj2()</a>.</p>

<p>Referenced by <a class="el" href="func__odbc_8c_source.html#l00375">acf_odbc_read()</a>, <a class="el" href="func__odbc_8c_source.html#l00203">acf_odbc_write()</a>, <a class="el" href="res__odbc_8c_source.html#l00425">ast_odbc_find_table()</a>, <a class="el" href="func__odbc_8c_source.html#l00978">cli_odbc_read()</a>, <a class="el" href="func__odbc_8c_source.html#l01177">cli_odbc_write()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00797">config_odbc()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00709">destroy_odbc()</a>, <a class="el" href="cdr__adaptive__odbc_8c_source.html#l00081">load_config()</a>, <a class="el" href="cdr__adaptive__odbc_8c_source.html#l00343">odbc_log()</a>, <a class="el" href="res__odbc_8c_source.html#l00960">odbc_register_class()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00256">realtime_multi_odbc()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00111">realtime_odbc()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00633">store_odbc()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00582">update2_odbc()</a>, and <a class="el" href="res__config__odbc_8c_source.html#l00404">update_odbc()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01042"></a>01042 {
<a name="l01043"></a>01043    <span class="keyword">struct </span><a class="code" href="structodbc__txn__frame.html">odbc_txn_frame</a> *tx = <a class="code" href="res__odbc_8c.html#a00e68e8fd24bd80b6fd5f4af94e1b993">find_transaction</a>(NULL, obj, NULL, 0);
<a name="l01044"></a>01044    <a class="code" href="res__odbc_8c.html#a0cb988b805f7ef81fa43f5d8096576d2">odbc_release_obj2</a>(obj, tx);
<a name="l01045"></a>01045 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad34ae2bdba165ef6c7405afc94f2a7f3"></a><!-- doxytag: member="res_odbc.c::ast_odbc_request_obj" ref="ad34ae2bdba165ef6c7405afc94f2a7f3" args="(const char *name, int check)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structodbc__obj.html">odbc_obj</a>* ast_odbc_request_obj </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>check</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l01331">1331</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="res__odbc_8c_source.html#l01156">ast_odbc_request_obj2()</a>, and <a class="el" href="res__odbc_8h_source.html#l00040">RES_ODBC_SANITY_CHECK</a>.</p>

<p>Referenced by <a class="el" href="func__odbc_8c_source.html#l00375">acf_odbc_read()</a>, <a class="el" href="func__odbc_8c_source.html#l00203">acf_odbc_write()</a>, <a class="el" href="res__odbc_8c_source.html#l00425">ast_odbc_find_table()</a>, <a class="el" href="func__odbc_8c_source.html#l00978">cli_odbc_read()</a>, <a class="el" href="func__odbc_8c_source.html#l01177">cli_odbc_write()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00797">config_odbc()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00709">destroy_odbc()</a>, <a class="el" href="cdr__adaptive__odbc_8c_source.html#l00081">load_config()</a>, <a class="el" href="cdr__adaptive__odbc_8c_source.html#l00343">odbc_log()</a>, <a class="el" href="res__odbc_8c_source.html#l00960">odbc_register_class()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00256">realtime_multi_odbc()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00111">realtime_odbc()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00633">store_odbc()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00582">update2_odbc()</a>, and <a class="el" href="res__config__odbc_8c_source.html#l00404">update_odbc()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01333"></a>01333 {
<a name="l01334"></a>01334    <span class="keyword">struct </span><a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> <a class="code" href="structast__flags.html#ac92588540e8c1d014a08cd8a45462b19">flags</a> = { check ? <a class="code" href="res__odbc_8h.html#a81929fb3d21206b62f55bcb744f71d5dae38953a3ea0dd8ab9f3994656e1e7fef">RES_ODBC_SANITY_CHECK</a> : 0 };
<a name="l01335"></a>01335 <span class="preprocessor">#ifdef DEBUG_THREADS</span>
<a name="l01336"></a>01336 <span class="preprocessor"></span>   <span class="keywordflow">return</span> _ast_odbc_request_obj2(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, flags, file, function, lineno);
<a name="l01337"></a>01337 <span class="preprocessor">#else</span>
<a name="l01338"></a>01338 <span class="preprocessor"></span>   <span class="keywordflow">return</span> <a class="code" href="res__odbc_8h.html#a84fc89afd16a11b3a1095fb108e2a7ec" title="Retrieves a connected ODBC object.">ast_odbc_request_obj2</a>(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, flags);
<a name="l01339"></a>01339 <span class="preprocessor">#endif</span>
<a name="l01340"></a>01340 <span class="preprocessor"></span>}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a84fc89afd16a11b3a1095fb108e2a7ec"></a><!-- doxytag: member="res_odbc.c::ast_odbc_request_obj2" ref="a84fc89afd16a11b3a1095fb108e2a7ec" args="(const char *name, struct ast_flags flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structodbc__obj.html">odbc_obj</a>* ast_odbc_request_obj2 </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__flags.html">ast_flags</a>&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Retrieves a connected ODBC object. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>The name of the ODBC class for which a connection is needed. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>flags</em>&nbsp;</td><td>Set of flags used to control which connection is returned. </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>ODBC</em>&nbsp;</td><td>object </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>NULL</em>&nbsp;</td><td>if there is no connection available with the requested name.</td></tr>
  </table>
  </dd>
</dl>
<p>Connection classes may, in fact, contain multiple connection handles. If the connection is pooled, then each connection will be dedicated to the thread which <a class="el" href="structrequests.html">requests</a> it. Note that all connections should be released when the thread is done by calling odbc_release_obj(), below. </p>

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l01156">1156</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00413">ao2_alloc</a>, <a class="el" href="astobj2_8h_source.html#l00916">ao2_callback</a>, <a class="el" href="astobj2_8h_source.html#l00782">ao2_link</a>, <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>, <a class="el" href="res__odbc_8c_source.html#l01126">aoro2_class_cb()</a>, <a class="el" href="res__odbc_8c_source.html#l01140">aoro2_obj_cb()</a>, <a class="el" href="utils_8h_source.html#l00678">ast_assert</a>, <a class="el" href="lock_8h_source.html#l01964">ast_atomic_fetchadd_int()</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01692">ast_mutex_init()</a>, <a class="el" href="res__odbc_8c_source.html#l00695">ast_odbc_sanity_check()</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="time_8h_source.html#l00056">ast_tvdiff_sec()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="res__odbc_8c_source.html#l00136">class_container</a>, <a class="el" href="res__odbc_8h_source.html#l00047">odbc_obj::con</a>, <a class="el" href="res__odbc_8c_source.html#l00131">odbc_class::count</a>, <a class="el" href="res__odbc_8c_source.html#l01138">EOR_TX</a>, <a class="el" href="res__odbc_8c_source.html#l00132">odbc_class::idlecheck</a>, <a class="el" href="res__odbc_8c_source.html#l00129">odbc_class::isolation</a>, <a class="el" href="res__odbc_8h_source.html#l00049">odbc_obj::last_used</a>, <a class="el" href="res__odbc_8h_source.html#l00046">odbc_obj::lock</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="res__odbc_8c_source.html#l01137">NO_TX</a>, <a class="el" href="res__odbc_8c_source.html#l00133">odbc_class::obj_container</a>, <a class="el" href="res__odbc_8h_source.html#l00036">ODBC_FAIL</a>, <a class="el" href="res__odbc_8c_source.html#l01411">odbc_obj_connect()</a>, <a class="el" href="res__odbc_8c_source.html#l00394">odbc_obj_destructor()</a>, <a class="el" href="res__odbc_8h_source.html#l00048">odbc_obj::parent</a>, <a class="el" href="res__odbc_8h_source.html#l00041">RES_ODBC_INDEPENDENT_CONNECTION</a>, <a class="el" href="res__odbc_8h_source.html#l00040">RES_ODBC_SANITY_CHECK</a>, <a class="el" href="res__odbc_8c_source.html#l01136">USE_TX</a>, and <a class="el" href="res__odbc_8h_source.html#l00055">odbc_obj::used</a>.</p>

<p>Referenced by <a class="el" href="res__odbc_8c_source.html#l01502">acf_transaction_write()</a>, and <a class="el" href="res__odbc_8c_source.html#l01331">ast_odbc_request_obj()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01158"></a>01158 {
<a name="l01159"></a>01159    <span class="keyword">struct </span><a class="code" href="structodbc__obj.html" title="ODBC container.">odbc_obj</a> *obj = NULL;
<a name="l01160"></a>01160    <span class="keyword">struct </span><a class="code" href="structodbc__class.html">odbc_class</a> *<span class="keyword">class</span>;
<a name="l01161"></a>01161    SQLINTEGER nativeerror=0, numfields=0;
<a name="l01162"></a>01162    SQLSMALLINT diagbytes=0, i;
<a name="l01163"></a>01163    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structstate.html">state</a>[10], diagnostic[256];
<a name="l01164"></a>01164 
<a name="l01165"></a>01165    <span class="keywordflow">if</span> (!(<span class="keyword">class</span> = <a class="code" href="astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(<a class="code" href="res__odbc_8c.html#a9412fb74c274dc0c012fd7b4f5b6aa71">class_container</a>, 0, <a class="code" href="res__odbc_8c.html#a4774f9275056e3537178e5ce30daf2fa">aoro2_class_cb</a>, (<span class="keywordtype">char</span> *) <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>))) {
<a name="l01166"></a>01166       <span class="keywordflow">return</span> NULL;
<a name="l01167"></a>01167    }
<a name="l01168"></a>01168 
<a name="l01169"></a>01169    <a class="code" href="utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(<a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<span class="keyword">class</span>, 0) &gt; 1);
<a name="l01170"></a>01170 
<a name="l01171"></a>01171    <span class="keywordflow">if</span> (class-&gt;haspool) {
<a name="l01172"></a>01172       <span class="comment">/* Recycle connections before building another */</span>
<a name="l01173"></a>01173       obj = <a class="code" href="astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(class-&gt;obj_container, 0, <a class="code" href="res__odbc_8c.html#a7e917d482947c7704537c0ca191bfde0">aoro2_obj_cb</a>, <a class="code" href="res__odbc_8c.html#af1e97e0585fe2a1631cbc21d501320f6">EOR_TX</a>);
<a name="l01174"></a>01174 
<a name="l01175"></a>01175       <span class="keywordflow">if</span> (obj) {
<a name="l01176"></a>01176          <a class="code" href="utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(<a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(obj, 0) &gt; 1);
<a name="l01177"></a>01177       }
<a name="l01178"></a>01178 
<a name="l01179"></a>01179       <span class="keywordflow">if</span> (!obj &amp;&amp; (class-&gt;count &lt; class-&gt;limit)) {
<a name="l01180"></a>01180          obj = <a class="code" href="astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*obj), <a class="code" href="res__odbc_8c.html#a4d57d49f8c33dc81fb16699d63ff8f26">odbc_obj_destructor</a>);
<a name="l01181"></a>01181          <span class="keywordflow">if</span> (!obj) {
<a name="l01182"></a>01182             <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<span class="keyword">class</span>, -1);
<a name="l01183"></a>01183             <span class="keywordflow">return</span> NULL;
<a name="l01184"></a>01184          }
<a name="l01185"></a>01185          <a class="code" href="utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(<a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(obj, 0) == 1);
<a name="l01186"></a>01186          <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;obj-&gt;<a class="code" href="structodbc__obj.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01187"></a>01187          <span class="comment">/* obj inherits the outstanding reference to class */</span>
<a name="l01188"></a>01188          obj-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a> = <span class="keyword">class</span>;
<a name="l01189"></a>01189          <span class="keyword">class </span>= NULL;
<a name="l01190"></a>01190          <span class="keywordflow">if</span> (<a class="code" href="res__odbc_8c.html#a5f3e9c3099b36a9c5cf70c19f9935d38">odbc_obj_connect</a>(obj) == <a class="code" href="res__odbc_8h.html#a105a23abbc3dcfda7728a1a39987b3d6a727133c18382293823de31545d7c5175">ODBC_FAIL</a>) {
<a name="l01191"></a>01191             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to connect to %s\n&quot;</span>, name);
<a name="l01192"></a>01192             <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(obj, -1);
<a name="l01193"></a>01193             <a class="code" href="utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(<a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<span class="keyword">class</span>, 0) &gt; 0);
<a name="l01194"></a>01194             obj = NULL;
<a name="l01195"></a>01195          } <span class="keywordflow">else</span> {
<a name="l01196"></a>01196             obj-&gt;<a class="code" href="structodbc__obj.html#a2590a5f33b83235fcf8740d3bb9b0e98">used</a> = 1;
<a name="l01197"></a>01197             <a class="code" href="astobj2_8h.html#a210544bdcc5afe0601d01d6e529c22d8">ao2_link</a>(obj-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a>-&gt;<a class="code" href="structodbc__class.html#a1e3f049fb8753279ce152d1efb9ff16b">obj_container</a>, obj);
<a name="l01198"></a>01198             <a class="code" href="lock_8h.html#a30df186a6f53f66621e88fae2e7adaf9" title="Atomically add v to *p and return * the previous value of *p. This can be used to...">ast_atomic_fetchadd_int</a>(&amp;obj-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a>-&gt;<a class="code" href="structodbc__class.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>, +1);
<a name="l01199"></a>01199          }
<a name="l01200"></a>01200       } <span class="keywordflow">else</span> {
<a name="l01201"></a>01201          <span class="comment">/* Object is not constructed, so delete outstanding reference to class. */</span>
<a name="l01202"></a>01202          <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<span class="keyword">class</span>, -1);
<a name="l01203"></a>01203          <span class="keyword">class </span>= NULL;
<a name="l01204"></a>01204       }
<a name="l01205"></a>01205 
<a name="l01206"></a>01206       <span class="keywordflow">if</span> (obj &amp;&amp; <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="res__odbc_8h.html#a81929fb3d21206b62f55bcb744f71d5da90538ee30927dd290253a4774e361087">RES_ODBC_INDEPENDENT_CONNECTION</a>)) {
<a name="l01207"></a>01207          <span class="comment">/* Ensure this connection has autocommit turned off. */</span>
<a name="l01208"></a>01208          <span class="keywordflow">if</span> (SQLSetConnectAttr(obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, SQL_ATTR_AUTOCOMMIT, (<span class="keywordtype">void</span> *)SQL_AUTOCOMMIT_OFF, 0) == SQL_ERROR) {
<a name="l01209"></a>01209             SQLGetDiagField(SQL_HANDLE_DBC, obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, 1, SQL_DIAG_NUMBER, &amp;numfields, SQL_IS_INTEGER, &amp;diagbytes);
<a name="l01210"></a>01210             <span class="keywordflow">for</span> (i = 0; i &lt; numfields; i++) {
<a name="l01211"></a>01211                SQLGetDiagRec(SQL_HANDLE_DBC, obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, i + 1, state, &amp;nativeerror, diagnostic, <span class="keyword">sizeof</span>(diagnostic), &amp;diagbytes);
<a name="l01212"></a>01212                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SQLSetConnectAttr (Autocommit) returned an error: %s: %s\n&quot;</span>, state, diagnostic);
<a name="l01213"></a>01213                <span class="keywordflow">if</span> (i &gt; 10) {
<a name="l01214"></a>01214                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Oh, that was good.  There are really %d diagnostics?\n&quot;</span>, (<span class="keywordtype">int</span>)numfields);
<a name="l01215"></a>01215                   <span class="keywordflow">break</span>;
<a name="l01216"></a>01216                }
<a name="l01217"></a>01217             }
<a name="l01218"></a>01218          }
<a name="l01219"></a>01219       }
<a name="l01220"></a>01220    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="res__odbc_8h.html#a81929fb3d21206b62f55bcb744f71d5da90538ee30927dd290253a4774e361087">RES_ODBC_INDEPENDENT_CONNECTION</a>)) {
<a name="l01221"></a>01221       <span class="comment">/* Non-pooled connections -- but must use a separate connection handle */</span>
<a name="l01222"></a>01222       <span class="keywordflow">if</span> (!(obj = <a class="code" href="astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(class-&gt;obj_container, 0, <a class="code" href="res__odbc_8c.html#a7e917d482947c7704537c0ca191bfde0">aoro2_obj_cb</a>, <a class="code" href="res__odbc_8c.html#acc6834ef6d1c44daa24e94fb77a8d98a">USE_TX</a>))) {
<a name="l01223"></a>01223          obj = <a class="code" href="astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*obj), <a class="code" href="res__odbc_8c.html#a4d57d49f8c33dc81fb16699d63ff8f26">odbc_obj_destructor</a>);
<a name="l01224"></a>01224          <span class="keywordflow">if</span> (!obj) {
<a name="l01225"></a>01225             <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<span class="keyword">class</span>, -1);
<a name="l01226"></a>01226             <span class="keywordflow">return</span> NULL;
<a name="l01227"></a>01227          }
<a name="l01228"></a>01228          <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;obj-&gt;<a class="code" href="structodbc__obj.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01229"></a>01229          <span class="comment">/* obj inherits the outstanding reference to class */</span>
<a name="l01230"></a>01230          obj-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a> = <span class="keyword">class</span>;
<a name="l01231"></a>01231          <span class="keyword">class </span>= NULL;
<a name="l01232"></a>01232          <span class="keywordflow">if</span> (<a class="code" href="res__odbc_8c.html#a5f3e9c3099b36a9c5cf70c19f9935d38">odbc_obj_connect</a>(obj) == <a class="code" href="res__odbc_8h.html#a105a23abbc3dcfda7728a1a39987b3d6a727133c18382293823de31545d7c5175">ODBC_FAIL</a>) {
<a name="l01233"></a>01233             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to connect to %s\n&quot;</span>, name);
<a name="l01234"></a>01234             <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(obj, -1);
<a name="l01235"></a>01235             obj = NULL;
<a name="l01236"></a>01236          } <span class="keywordflow">else</span> {
<a name="l01237"></a>01237             obj-&gt;<a class="code" href="structodbc__obj.html#a2590a5f33b83235fcf8740d3bb9b0e98">used</a> = 1;
<a name="l01238"></a>01238             <a class="code" href="astobj2_8h.html#a210544bdcc5afe0601d01d6e529c22d8">ao2_link</a>(obj-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a>-&gt;<a class="code" href="structodbc__class.html#a1e3f049fb8753279ce152d1efb9ff16b">obj_container</a>, obj);
<a name="l01239"></a>01239             <a class="code" href="lock_8h.html#a30df186a6f53f66621e88fae2e7adaf9" title="Atomically add v to *p and return * the previous value of *p. This can be used to...">ast_atomic_fetchadd_int</a>(&amp;obj-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a>-&gt;<a class="code" href="structodbc__class.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>, +1);
<a name="l01240"></a>01240          }
<a name="l01241"></a>01241       }
<a name="l01242"></a>01242 
<a name="l01243"></a>01243       <span class="keywordflow">if</span> (obj &amp;&amp; SQLSetConnectAttr(obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, SQL_ATTR_AUTOCOMMIT, (<span class="keywordtype">void</span> *)SQL_AUTOCOMMIT_OFF, 0) == SQL_ERROR) {
<a name="l01244"></a>01244          SQLGetDiagField(SQL_HANDLE_DBC, obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, 1, SQL_DIAG_NUMBER, &amp;numfields, SQL_IS_INTEGER, &amp;diagbytes);
<a name="l01245"></a>01245          <span class="keywordflow">for</span> (i = 0; i &lt; numfields; i++) {
<a name="l01246"></a>01246             SQLGetDiagRec(SQL_HANDLE_DBC, obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, i + 1, state, &amp;nativeerror, diagnostic, <span class="keyword">sizeof</span>(diagnostic), &amp;diagbytes);
<a name="l01247"></a>01247             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SetConnectAttr (Autocommit) returned an error: %s: %s\n&quot;</span>, state, diagnostic);
<a name="l01248"></a>01248             <span class="keywordflow">if</span> (i &gt; 10) {
<a name="l01249"></a>01249                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Oh, that was good.  There are really %d diagnostics?\n&quot;</span>, (<span class="keywordtype">int</span>)numfields);
<a name="l01250"></a>01250                <span class="keywordflow">break</span>;
<a name="l01251"></a>01251             }
<a name="l01252"></a>01252          }
<a name="l01253"></a>01253       }
<a name="l01254"></a>01254    } <span class="keywordflow">else</span> {
<a name="l01255"></a>01255       <span class="comment">/* Non-pooled connection: multiple modules can use the same connection. */</span>
<a name="l01256"></a>01256       <span class="keywordflow">if</span> ((obj = <a class="code" href="astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(class-&gt;obj_container, 0, <a class="code" href="res__odbc_8c.html#a7e917d482947c7704537c0ca191bfde0">aoro2_obj_cb</a>, <a class="code" href="res__odbc_8c.html#a2ca13cc687b31de4a8cb9071cf5208ef">NO_TX</a>))) {
<a name="l01257"></a>01257          <span class="comment">/* Object is not constructed, so delete outstanding reference to class. */</span>
<a name="l01258"></a>01258          <a class="code" href="utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(<a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<span class="keyword">class</span>, 0) &gt; 1);
<a name="l01259"></a>01259          <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<span class="keyword">class</span>, -1);
<a name="l01260"></a>01260          <span class="keyword">class </span>= NULL;
<a name="l01261"></a>01261       } <span class="keywordflow">else</span> {
<a name="l01262"></a>01262          <span class="comment">/* No entry: build one */</span>
<a name="l01263"></a>01263          <span class="keywordflow">if</span> (!(obj = <a class="code" href="astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*obj), <a class="code" href="res__odbc_8c.html#a4d57d49f8c33dc81fb16699d63ff8f26">odbc_obj_destructor</a>))) {
<a name="l01264"></a>01264             <a class="code" href="utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(<a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<span class="keyword">class</span>, 0) &gt; 1);
<a name="l01265"></a>01265             <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<span class="keyword">class</span>, -1);
<a name="l01266"></a>01266             <span class="keywordflow">return</span> NULL;
<a name="l01267"></a>01267          }
<a name="l01268"></a>01268          <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;obj-&gt;<a class="code" href="structodbc__obj.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01269"></a>01269          <span class="comment">/* obj inherits the outstanding reference to class */</span>
<a name="l01270"></a>01270          obj-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a> = <span class="keyword">class</span>;
<a name="l01271"></a>01271          <span class="keyword">class </span>= NULL;
<a name="l01272"></a>01272          <span class="keywordflow">if</span> (<a class="code" href="res__odbc_8c.html#a5f3e9c3099b36a9c5cf70c19f9935d38">odbc_obj_connect</a>(obj) == <a class="code" href="res__odbc_8h.html#a105a23abbc3dcfda7728a1a39987b3d6a727133c18382293823de31545d7c5175">ODBC_FAIL</a>) {
<a name="l01273"></a>01273             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to connect to %s\n&quot;</span>, name);
<a name="l01274"></a>01274             <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(obj, -1);
<a name="l01275"></a>01275             obj = NULL;
<a name="l01276"></a>01276          } <span class="keywordflow">else</span> {
<a name="l01277"></a>01277             <a class="code" href="astobj2_8h.html#a210544bdcc5afe0601d01d6e529c22d8">ao2_link</a>(obj-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a>-&gt;<a class="code" href="structodbc__class.html#a1e3f049fb8753279ce152d1efb9ff16b">obj_container</a>, obj);
<a name="l01278"></a>01278             <a class="code" href="utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(<a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(obj, 0) &gt; 1);
<a name="l01279"></a>01279          }
<a name="l01280"></a>01280       }
<a name="l01281"></a>01281 
<a name="l01282"></a>01282       <span class="keywordflow">if</span> (obj &amp;&amp; SQLSetConnectAttr(obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, SQL_ATTR_AUTOCOMMIT, (<span class="keywordtype">void</span> *)SQL_AUTOCOMMIT_ON, 0) == SQL_ERROR) {
<a name="l01283"></a>01283          SQLGetDiagField(SQL_HANDLE_DBC, obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, 1, SQL_DIAG_NUMBER, &amp;numfields, SQL_IS_INTEGER, &amp;diagbytes);
<a name="l01284"></a>01284          <span class="keywordflow">for</span> (i = 0; i &lt; numfields; i++) {
<a name="l01285"></a>01285             SQLGetDiagRec(SQL_HANDLE_DBC, obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, i + 1, state, &amp;nativeerror, diagnostic, <span class="keyword">sizeof</span>(diagnostic), &amp;diagbytes);
<a name="l01286"></a>01286             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SetConnectAttr (Autocommit) returned an error: %s: %s\n&quot;</span>, state, diagnostic);
<a name="l01287"></a>01287             <span class="keywordflow">if</span> (i &gt; 10) {
<a name="l01288"></a>01288                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Oh, that was good.  There are really %d diagnostics?\n&quot;</span>, (<span class="keywordtype">int</span>)numfields);
<a name="l01289"></a>01289                <span class="keywordflow">break</span>;
<a name="l01290"></a>01290             }
<a name="l01291"></a>01291          }
<a name="l01292"></a>01292       }
<a name="l01293"></a>01293    }
<a name="l01294"></a>01294 
<a name="l01295"></a>01295    <span class="comment">/* Set the isolation property */</span>
<a name="l01296"></a>01296    <span class="keywordflow">if</span> (obj &amp;&amp; SQLSetConnectAttr(obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, SQL_ATTR_TXN_ISOLATION, (<span class="keywordtype">void</span> *)(<span class="keywordtype">long</span>)obj-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a>-&gt;<a class="code" href="structodbc__class.html#a6515c3eadbeefabf86e088a2b9a0332e">isolation</a>, 0) == SQL_ERROR) {
<a name="l01297"></a>01297       SQLGetDiagField(SQL_HANDLE_DBC, obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, 1, SQL_DIAG_NUMBER, &amp;numfields, SQL_IS_INTEGER, &amp;diagbytes);
<a name="l01298"></a>01298       <span class="keywordflow">for</span> (i = 0; i &lt; numfields; i++) {
<a name="l01299"></a>01299          SQLGetDiagRec(SQL_HANDLE_DBC, obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, i + 1, state, &amp;nativeerror, diagnostic, <span class="keyword">sizeof</span>(diagnostic), &amp;diagbytes);
<a name="l01300"></a>01300          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SetConnectAttr (Txn isolation) returned an error: %s: %s\n&quot;</span>, state, diagnostic);
<a name="l01301"></a>01301          <span class="keywordflow">if</span> (i &gt; 10) {
<a name="l01302"></a>01302             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Oh, that was good.  There are really %d diagnostics?\n&quot;</span>, (<span class="keywordtype">int</span>)numfields);
<a name="l01303"></a>01303             <span class="keywordflow">break</span>;
<a name="l01304"></a>01304          }
<a name="l01305"></a>01305       }
<a name="l01306"></a>01306    }
<a name="l01307"></a>01307 
<a name="l01308"></a>01308    <span class="keywordflow">if</span> (obj &amp;&amp; <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="res__odbc_8h.html#a81929fb3d21206b62f55bcb744f71d5dae38953a3ea0dd8ab9f3994656e1e7fef">RES_ODBC_SANITY_CHECK</a>)) {
<a name="l01309"></a>01309       <a class="code" href="res__odbc_8h.html#a91a6be5993a0928cd527b584ec3407b7" title="Checks an ODBC object to ensure it is still connected.">ast_odbc_sanity_check</a>(obj);
<a name="l01310"></a>01310    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (obj &amp;&amp; obj-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a>-&gt;<a class="code" href="structodbc__class.html#a7c18ec907c99979db44845239b00d4aa">idlecheck</a> &gt; 0 &amp;&amp; <a class="code" href="time_8h.html#a3f55930df743fa0d76c353f2643e148b" title="Computes the difference (in seconds) between two struct timeval instances.">ast_tvdiff_sec</a>(<a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>(), obj-&gt;<a class="code" href="structodbc__obj.html#a43b2c8a8bf77a2504897ff0da9b0aa90">last_used</a>) &gt; obj-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a>-&gt;<a class="code" href="structodbc__class.html#a7c18ec907c99979db44845239b00d4aa">idlecheck</a>)
<a name="l01311"></a>01311       <a class="code" href="res__odbc_8c.html#a5f3e9c3099b36a9c5cf70c19f9935d38">odbc_obj_connect</a>(obj);
<a name="l01312"></a>01312 
<a name="l01313"></a>01313 <span class="preprocessor">#ifdef DEBUG_THREADS</span>
<a name="l01314"></a>01314 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (obj) {
<a name="l01315"></a>01315       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(obj-&gt;file, file, <span class="keyword">sizeof</span>(obj-&gt;file));
<a name="l01316"></a>01316       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(obj-&gt;function, function, <span class="keyword">sizeof</span>(obj-&gt;function));
<a name="l01317"></a>01317       obj-&gt;lineno = lineno;
<a name="l01318"></a>01318    }
<a name="l01319"></a>01319 <span class="preprocessor">#endif</span>
<a name="l01320"></a>01320 <span class="preprocessor"></span>   <a class="code" href="utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(<span class="keyword">class</span> == NULL);
<a name="l01321"></a>01321 
<a name="l01322"></a>01322    <span class="keywordflow">if</span> (obj) {
<a name="l01323"></a>01323       <a class="code" href="utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(<a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(obj, 0) &gt; 1);
<a name="l01324"></a>01324    }
<a name="l01325"></a>01325    <span class="keywordflow">return</span> obj;
<a name="l01326"></a>01326 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a14e6fc16f400d47e35ef4a0f2b220c53"></a><!-- doxytag: member="res_odbc.c::ast_odbc_retrieve_transaction_obj" ref="a14e6fc16f400d47e35ef4a0f2b220c53" args="(struct ast_channel *chan, const char *objname)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structodbc__obj.html">odbc_obj</a>* ast_odbc_retrieve_transaction_obj </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>objname</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Retrieve a stored ODBC object, if a transaction has been started. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel associated with the transaction. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>objname</em>&nbsp;</td><td>Name of the database handle. This name corresponds to the name passed to </td></tr>
  </table>
  </dd>
</dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="res__odbc_8c.html#a84fc89afd16a11b3a1095fb108e2a7ec" title="Retrieves a connected ODBC object.">ast_odbc_request_obj2</a> (or formerly, to <a class="el" href="res__odbc_8c.html#ad34ae2bdba165ef6c7405afc94f2a7f3">ast_odbc_request_obj</a>). Note that the existence of this parameter <a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> explicitly allows for multiple transactions to be open at once, albeit to different databases. </dd></dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>A</em>&nbsp;</td><td>stored ODBC object, if a transaction was already started. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>NULL,if</em>&nbsp;</td><td>no transaction yet exists. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l01342">1342</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l01548">ast_channel_datastore_find()</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="linkedlists_8h_source.html#l00172">AST_LIST_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="datastore_8h_source.html#l00056">ast_datastore::data</a>, <a class="el" href="structodbc__class.html#a033c9e1d6a001b7c5dc1a71ab21d0357">odbc_class::list</a>, <a class="el" href="res__odbc_8c_source.html#l00119">odbc_class::name</a>, <a class="el" href="res__odbc_8c_source.html#l00156">odbc_txn_frame::obj</a>, <a class="el" href="res__odbc_8h_source.html#l00048">odbc_obj::parent</a>, and <a class="el" href="res__odbc_8c_source.html#l00148">txn_info</a>.</p>

<p>Referenced by <a class="el" href="func__odbc_8c_source.html#l00203">acf_odbc_write()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01343"></a>01343 {
<a name="l01344"></a>01344    <span class="keyword">struct </span><a class="code" href="structast__datastore.html" title="Structure for a data store object.">ast_datastore</a> *txn_store;
<a name="l01345"></a>01345    <a class="code" href="linkedlists_8h.html#acdb4f56da6b3071d02dcce20072852b0" title="Defines a structure to be used to hold a list of specified type.">AST_LIST_HEAD</a>(, <a class="code" href="structodbc__txn__frame.html">odbc_txn_frame</a>) *oldlist;
<a name="l01346"></a>01346    <span class="keyword">struct </span><a class="code" href="structodbc__txn__frame.html">odbc_txn_frame</a> *txn = NULL;
<a name="l01347"></a>01347 
<a name="l01348"></a>01348    <span class="keywordflow">if</span> (!chan) {
<a name="l01349"></a>01349       <span class="comment">/* No channel == no transaction */</span>
<a name="l01350"></a>01350       <span class="keywordflow">return</span> NULL;
<a name="l01351"></a>01351    }
<a name="l01352"></a>01352 
<a name="l01353"></a>01353    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l01354"></a>01354    <span class="keywordflow">if</span> ((txn_store = <a class="code" href="channel_8h.html#aad1e09cd7c79237d05cffb45d6cdfd7c" title="Find a datastore on a channel.">ast_channel_datastore_find</a>(chan, &amp;<a class="code" href="res__odbc_8c.html#a39d901a085de05b4b891f3643347316a">txn_info</a>, NULL))) {
<a name="l01355"></a>01355       oldlist = txn_store-&gt;<a class="code" href="structast__datastore.html#a735984d41155bc1032e09bece8f8d66d">data</a>;
<a name="l01356"></a>01356    } <span class="keywordflow">else</span> {
<a name="l01357"></a>01357       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l01358"></a>01358       <span class="keywordflow">return</span> NULL;
<a name="l01359"></a>01359    }
<a name="l01360"></a>01360 
<a name="l01361"></a>01361    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(oldlist);
<a name="l01362"></a>01362    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l01363"></a>01363 
<a name="l01364"></a>01364    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(oldlist, txn, <a class="code" href="structodbc__txn__frame.html#a6715fc7084c4f5b7aa8ed33db42c33b5">list</a>) {
<a name="l01365"></a>01365       <span class="keywordflow">if</span> (txn-&gt;<a class="code" href="structodbc__txn__frame.html#ab5dd16c9db5f2ee0f0d6354952c92189">obj</a> &amp;&amp; txn-&gt;<a class="code" href="structodbc__txn__frame.html#ab5dd16c9db5f2ee0f0d6354952c92189">obj</a>-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a> &amp;&amp; !strcmp(txn-&gt;<a class="code" href="structodbc__txn__frame.html#ab5dd16c9db5f2ee0f0d6354952c92189">obj</a>-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a>-&gt;<a class="code" href="structodbc__class.html#a3777dbae63a15da001b2baa317a25149">name</a>, objname)) {
<a name="l01366"></a>01366          <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(oldlist);
<a name="l01367"></a>01367          <span class="keywordflow">return</span> txn-&gt;<a class="code" href="structodbc__txn__frame.html#ab5dd16c9db5f2ee0f0d6354952c92189">obj</a>;
<a name="l01368"></a>01368       }
<a name="l01369"></a>01369    }
<a name="l01370"></a>01370    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(oldlist);
<a name="l01371"></a>01371    <span class="keywordflow">return</span> NULL;
<a name="l01372"></a>01372 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a91a6be5993a0928cd527b584ec3407b7"></a><!-- doxytag: member="res_odbc.c::ast_odbc_sanity_check" ref="a91a6be5993a0928cd527b584ec3407b7" args="(struct odbc_obj *obj)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_odbc_sanity_check </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Checks an ODBC object to ensure it is still connected. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>obj</em>&nbsp;</td><td>The ODBC object </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if connected </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>otherwise. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l00695">695</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="res__odbc_8h_source.html#l00047">odbc_obj::con</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="res__odbc_8c_source.html#l01411">odbc_obj_connect()</a>, <a class="el" href="res__odbc_8c_source.html#l01374">odbc_obj_disconnect()</a>, <a class="el" href="res__odbc_8h_source.html#l00048">odbc_obj::parent</a>, <a class="el" href="res__odbc_8c_source.html#l00123">odbc_class::sanitysql</a>, <a class="el" href="res__odbc_8h_source.html#l00057">odbc_obj::tx</a>, and <a class="el" href="res__odbc_8h_source.html#l00056">odbc_obj::up</a>.</p>

<p>Referenced by <a class="el" href="res__odbc_8c_source.html#l00425">ast_odbc_find_table()</a>, <a class="el" href="res__odbc_8c_source.html#l00593">ast_odbc_prepare_and_execute()</a>, <a class="el" href="res__odbc_8c_source.html#l01156">ast_odbc_request_obj2()</a>, and <a class="el" href="res__odbc_8c_source.html#l00871">handle_cli_odbc_show()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00696"></a>00696 {
<a name="l00697"></a>00697    <span class="keywordtype">char</span> *test_sql = <span class="stringliteral">&quot;select 1&quot;</span>;
<a name="l00698"></a>00698    SQLHSTMT stmt;
<a name="l00699"></a>00699    <span class="keywordtype">int</span> res = 0;
<a name="l00700"></a>00700 
<a name="l00701"></a>00701    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(obj-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a>-&gt;<a class="code" href="structodbc__class.html#af41cb350797c76ea60f9b864e753eb79">sanitysql</a>))
<a name="l00702"></a>00702       test_sql = obj-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a>-&gt;<a class="code" href="structodbc__class.html#af41cb350797c76ea60f9b864e753eb79">sanitysql</a>;
<a name="l00703"></a>00703 
<a name="l00704"></a>00704    <span class="keywordflow">if</span> (obj-&gt;<a class="code" href="structodbc__obj.html#a8042aba89daa6448b14e94e6d0bb63bf">up</a>) {
<a name="l00705"></a>00705       res = SQLAllocHandle(SQL_HANDLE_STMT, obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, &amp;stmt);
<a name="l00706"></a>00706       <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO)) {
<a name="l00707"></a>00707          obj-&gt;<a class="code" href="structodbc__obj.html#a8042aba89daa6448b14e94e6d0bb63bf">up</a> = 0;
<a name="l00708"></a>00708       } <span class="keywordflow">else</span> {
<a name="l00709"></a>00709          res = SQLPrepare(stmt, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)test_sql, SQL_NTS);
<a name="l00710"></a>00710          <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO)) {
<a name="l00711"></a>00711             obj-&gt;<a class="code" href="structodbc__obj.html#a8042aba89daa6448b14e94e6d0bb63bf">up</a> = 0;
<a name="l00712"></a>00712          } <span class="keywordflow">else</span> {
<a name="l00713"></a>00713             res = SQLExecute(stmt);
<a name="l00714"></a>00714             <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO)) {
<a name="l00715"></a>00715                obj-&gt;<a class="code" href="structodbc__obj.html#a8042aba89daa6448b14e94e6d0bb63bf">up</a> = 0;
<a name="l00716"></a>00716             }
<a name="l00717"></a>00717          }
<a name="l00718"></a>00718       }
<a name="l00719"></a>00719       SQLFreeHandle (SQL_HANDLE_STMT, stmt);
<a name="l00720"></a>00720    }
<a name="l00721"></a>00721 
<a name="l00722"></a>00722    <span class="keywordflow">if</span> (!obj-&gt;<a class="code" href="structodbc__obj.html#a8042aba89daa6448b14e94e6d0bb63bf">up</a> &amp;&amp; !obj-&gt;<a class="code" href="structodbc__obj.html#abc0ea80cbb3a49c87b90be742126523c">tx</a>) { <span class="comment">/* Try to reconnect! */</span>
<a name="l00723"></a>00723       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Connection is down attempting to reconnect...\n&quot;</span>);
<a name="l00724"></a>00724       <a class="code" href="res__odbc_8c.html#ac83b00e5ebe4dcb0af74363ac609c8d5">odbc_obj_disconnect</a>(obj);
<a name="l00725"></a>00725       <a class="code" href="res__odbc_8c.html#a5f3e9c3099b36a9c5cf70c19f9935d38">odbc_obj_connect</a>(obj);
<a name="l00726"></a>00726    }
<a name="l00727"></a>00727    <span class="keywordflow">return</span> obj-&gt;<a class="code" href="structodbc__obj.html#a8042aba89daa6448b14e94e6d0bb63bf">up</a>;
<a name="l00728"></a>00728 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af8da93ee13b95c6aae6a79558869812a"></a><!-- doxytag: member="res_odbc.c::ast_odbc_smart_execute" ref="af8da93ee13b95c6aae6a79558869812a" args="(struct odbc_obj *obj, SQLHSTMT stmt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_odbc_smart_execute </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SQLHSTMT&nbsp;</td>
          <td class="paramname"> <em>stmt</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Executes a prepared statement handle. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>obj</em>&nbsp;</td><td>The non-NULL result of odbc_request_obj() </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>stmt</em>&nbsp;</td><td>The prepared statement handle </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<p>This function was originally designed simply to execute a prepared statement handle and to retry if the initial execution failed. Unfortunately, it did this by disconnecting and reconnecting the database handle which on most databases causes the statement handle to become invalid. Therefore, this method has been deprecated in favor of odbc_prepare_and_execute() which allows the statement to be prepared multiple times, if necessary, in case of a loss of connection.</p>
<p>This function really only ever worked with MySQL, where the statement handle is not prepared on the server. If you are not using MySQL, you should avoid it. </p>

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l00652">652</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="res__odbc_8h_source.html#l00049">odbc_obj::last_used</a>, and <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00653"></a>00653 {
<a name="l00654"></a>00654    <span class="keywordtype">int</span> res = 0, i;
<a name="l00655"></a>00655    SQLINTEGER nativeerror=0, numfields=0;
<a name="l00656"></a>00656    SQLSMALLINT diagbytes=0;
<a name="l00657"></a>00657    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structstate.html">state</a>[10], diagnostic[256];
<a name="l00658"></a>00658 
<a name="l00659"></a>00659    res = SQLExecute(stmt);
<a name="l00660"></a>00660    <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO) &amp;&amp; (res != SQL_NO_DATA)) {
<a name="l00661"></a>00661       <span class="keywordflow">if</span> (res == SQL_ERROR) {
<a name="l00662"></a>00662          SQLGetDiagField(SQL_HANDLE_STMT, stmt, 1, SQL_DIAG_NUMBER, &amp;numfields, SQL_IS_INTEGER, &amp;diagbytes);
<a name="l00663"></a>00663          <span class="keywordflow">for</span> (i = 0; i &lt; numfields; i++) {
<a name="l00664"></a>00664             SQLGetDiagRec(SQL_HANDLE_STMT, stmt, i + 1, state, &amp;nativeerror, diagnostic, <span class="keyword">sizeof</span>(diagnostic), &amp;diagbytes);
<a name="l00665"></a>00665             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SQL Execute returned an error %d: %s: %s (%d)\n&quot;</span>, res, state, diagnostic, diagbytes);
<a name="l00666"></a>00666             <span class="keywordflow">if</span> (i &gt; 10) {
<a name="l00667"></a>00667                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Oh, that was good.  There are really %d diagnostics?\n&quot;</span>, (<span class="keywordtype">int</span>)numfields);
<a name="l00668"></a>00668                <span class="keywordflow">break</span>;
<a name="l00669"></a>00669             }
<a name="l00670"></a>00670          }
<a name="l00671"></a>00671       }
<a name="l00672"></a>00672    } <span class="keywordflow">else</span>
<a name="l00673"></a>00673       obj-&gt;<a class="code" href="structodbc__obj.html#a43b2c8a8bf77a2504897ff0da9b0aa90">last_used</a> = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l00674"></a>00674    
<a name="l00675"></a>00675    <span class="keywordflow">return</span> res;
<a name="l00676"></a>00676 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2a49ba6d50b0e13140c63cec43cf3db7"></a><!-- doxytag: member="res_odbc.c::commit_exec" ref="a2a49ba6d50b0e13140c63cec43cf3db7" args="(struct ast_channel *chan, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int commit_exec </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l01052">1052</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="strings_8h_source.html#l00846">ast_str_append()</a>, <a class="el" href="strings_8h_source.html#l00488">ast_str_buffer()</a>, <a class="el" href="strings_8h_source.html#l00431">ast_str_reset()</a>, <a class="el" href="strings_8h_source.html#l00466">ast_str_strlen()</a>, <a class="el" href="strings_8h_source.html#l00637">ast_str_thread_get()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="res__odbc_8h_source.html#l00047">odbc_obj::con</a>, <a class="el" href="res__odbc_8c_source.html#l00146">errors_buf</a>, <a class="el" href="res__odbc_8c_source.html#l00204">find_transaction()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="res__odbc_8c_source.html#l00156">odbc_txn_frame::obj</a>, and <a class="el" href="pbx_8c_source.html#l09023">pbx_builtin_setvar_helper()</a>.</p>

<p>Referenced by <a class="el" href="res__odbc_8c_source.html#l01684">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01053"></a>01053 {
<a name="l01054"></a>01054    <span class="keyword">struct </span><a class="code" href="structodbc__txn__frame.html">odbc_txn_frame</a> *tx;
<a name="l01055"></a>01055    SQLINTEGER nativeerror=0, numfields=0;
<a name="l01056"></a>01056    SQLSMALLINT diagbytes=0, i;
<a name="l01057"></a>01057    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structstate.html">state</a>[10], diagnostic[256];
<a name="l01058"></a>01058 
<a name="l01059"></a>01059    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(data)) {
<a name="l01060"></a>01060       tx = <a class="code" href="res__odbc_8c.html#a00e68e8fd24bd80b6fd5f4af94e1b993">find_transaction</a>(chan, NULL, NULL, 1);
<a name="l01061"></a>01061    } <span class="keywordflow">else</span> {
<a name="l01062"></a>01062       tx = <a class="code" href="res__odbc_8c.html#a00e68e8fd24bd80b6fd5f4af94e1b993">find_transaction</a>(chan, NULL, data, 0);
<a name="l01063"></a>01063    }
<a name="l01064"></a>01064 
<a name="l01065"></a>01065    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;COMMIT_RESULT&quot;</span>, <span class="stringliteral">&quot;OK&quot;</span>);
<a name="l01066"></a>01066 
<a name="l01067"></a>01067    <span class="keywordflow">if</span> (tx) {
<a name="l01068"></a>01068       <span class="keywordflow">if</span> (SQLEndTran(SQL_HANDLE_DBC, tx-&gt;<a class="code" href="structodbc__txn__frame.html#ab5dd16c9db5f2ee0f0d6354952c92189">obj</a>-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, SQL_COMMIT) == SQL_ERROR) {
<a name="l01069"></a>01069          <span class="keyword">struct </span><a class="code" href="structast__str.html" title="The descriptor of a dynamic string XXX storage will be optimized later if needed...">ast_str</a> *errors = <a class="code" href="strings_8h.html#affe8ca3cf8ee9ab07fe29d11bc824ac4" title="Retrieve a thread locally stored dynamic string.">ast_str_thread_get</a>(&amp;<a class="code" href="res__odbc_8c.html#a12c713dc409f1b0d877c59abf81a9a00">errors_buf</a>, 16);
<a name="l01070"></a>01070          <a class="code" href="strings_8h.html#a7820deea616cbb2e28f16d518de91c80" title="Reset the content of a dynamic string. Useful before a series of ast_str_append.">ast_str_reset</a>(errors);
<a name="l01071"></a>01071 
<a name="l01072"></a>01072          <span class="comment">/* Handle possible transaction commit failure */</span>
<a name="l01073"></a>01073          SQLGetDiagField(SQL_HANDLE_DBC, tx-&gt;<a class="code" href="structodbc__txn__frame.html#ab5dd16c9db5f2ee0f0d6354952c92189">obj</a>-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, 1, SQL_DIAG_NUMBER, &amp;numfields, SQL_IS_INTEGER, &amp;diagbytes);
<a name="l01074"></a>01074          <span class="keywordflow">for</span> (i = 0; i &lt; numfields; i++) {
<a name="l01075"></a>01075             SQLGetDiagRec(SQL_HANDLE_DBC, tx-&gt;<a class="code" href="structodbc__txn__frame.html#ab5dd16c9db5f2ee0f0d6354952c92189">obj</a>-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, i + 1, state, &amp;nativeerror, diagnostic, <span class="keyword">sizeof</span>(diagnostic), &amp;diagbytes);
<a name="l01076"></a>01076             <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(&amp;errors, 0, <span class="stringliteral">&quot;%s%s&quot;</span>, <a class="code" href="strings_8h.html#a99409c17a1d20e1c3dc00039b7925a2d" title="Returns the current length of the string stored within buf.">ast_str_strlen</a>(errors) ? <span class="stringliteral">&quot;,&quot;</span> : <span class="stringliteral">&quot;&quot;</span>, state);
<a name="l01077"></a>01077             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SQLEndTran returned an error: %s: %s\n&quot;</span>, state, diagnostic);
<a name="l01078"></a>01078             <span class="keywordflow">if</span> (i &gt; 10) {
<a name="l01079"></a>01079                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Oh, that was good.  There are really %d diagnostics?\n&quot;</span>, (<span class="keywordtype">int</span>)numfields);
<a name="l01080"></a>01080                <span class="keywordflow">break</span>;
<a name="l01081"></a>01081             }
<a name="l01082"></a>01082          }
<a name="l01083"></a>01083          <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;COMMIT_RESULT&quot;</span>, <a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(errors));
<a name="l01084"></a>01084       }
<a name="l01085"></a>01085    }
<a name="l01086"></a>01086    <span class="keywordflow">return</span> 0;
<a name="l01087"></a>01087 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9f262bdbb941597f050a0eacbf518d51"></a><!-- doxytag: member="res_odbc.c::destroy_table_cache" ref="a9f262bdbb941597f050a0eacbf518d51" args="(struct odbc_cache_tables *table)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void destroy_table_cache </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structodbc__cache__tables.html">odbc_cache_tables</a> *&nbsp;</td>
          <td class="paramname"> <em>table</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l00404">404</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="linkedlists_8h_source.html#l00651">AST_RWLIST_HEAD_DESTROY</a>, <a class="el" href="linkedlists_8h_source.html#l00828">AST_RWLIST_REMOVE_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="structodbc__cache__tables.html#a09f857e5d5d25c0d2065acfbb45afe6c">odbc_cache_tables::columns</a>, <a class="el" href="structodbc__class.html#a033c9e1d6a001b7c5dc1a71ab21d0357">odbc_class::list</a>, and <a class="el" href="res__odbc_8h_source.html#l00075">odbc_cache_tables::table</a>.</p>

<p>Referenced by <a class="el" href="res__odbc_8c_source.html#l00551">ast_odbc_clear_cache()</a>, <a class="el" href="res__odbc_8c_source.html#l00425">ast_odbc_find_table()</a>, and <a class="el" href="res__odbc_8c_source.html#l01604">reload()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00404"></a>00404                                                                  {
<a name="l00405"></a>00405    <span class="keyword">struct </span><a class="code" href="structodbc__cache__columns.html">odbc_cache_columns</a> *col;
<a name="l00406"></a>00406    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Destroying table cache for %s\n&quot;</span>, table-&gt;<a class="code" href="structodbc__cache__tables.html#abc4810aa7718733bfc48b1973f4c92f8">table</a>);
<a name="l00407"></a>00407    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;table-&gt;<a class="code" href="structodbc__cache__tables.html#a09f857e5d5d25c0d2065acfbb45afe6c">columns</a>);
<a name="l00408"></a>00408    <span class="keywordflow">while</span> ((col = <a class="code" href="linkedlists_8h.html#a3d3aa4fb3b4ba38ad8d6d255d97e037c">AST_RWLIST_REMOVE_HEAD</a>(&amp;table-&gt;<a class="code" href="structodbc__cache__tables.html#a09f857e5d5d25c0d2065acfbb45afe6c">columns</a>, <a class="code" href="structodbc__cache__columns.html#a104d3ecbbd644ca8156e812056c5ce90">list</a>))) {
<a name="l00409"></a>00409       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(col);
<a name="l00410"></a>00410    }
<a name="l00411"></a>00411    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;table-&gt;<a class="code" href="structodbc__cache__tables.html#a09f857e5d5d25c0d2065acfbb45afe6c">columns</a>);
<a name="l00412"></a>00412    <a class="code" href="linkedlists_8h.html#acc3deb56109ed902edf384070e3f8f42" title="Destroys an rwlist head structure.">AST_RWLIST_HEAD_DESTROY</a>(&amp;table-&gt;<a class="code" href="structodbc__cache__tables.html#a09f857e5d5d25c0d2065acfbb45afe6c">columns</a>);
<a name="l00413"></a>00413    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(table);
<a name="l00414"></a>00414 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a00e68e8fd24bd80b6fd5f4af94e1b993"></a><!-- doxytag: member="res_odbc.c::find_transaction" ref="a00e68e8fd24bd80b6fd5f4af94e1b993" args="(struct ast_channel *chan, struct odbc_obj *obj, const char *name, int active)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structodbc__txn__frame.html">odbc_txn_frame</a>* find_transaction </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>active</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l00204">204</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="res__odbc_8c_source.html#l00164">odbc_txn_frame::active</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="channel_8c_source.html#l01534">ast_channel_datastore_add()</a>, <a class="el" href="channel_8c_source.html#l01548">ast_channel_datastore_find()</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="datastore_8h_source.html#l00071">ast_datastore_alloc</a>, <a class="el" href="datastore_8c_source.html#l00058">ast_datastore_free()</a>, <a class="el" href="linkedlists_8h_source.html#l00172">AST_LIST_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00610">AST_LIST_HEAD_INIT</a>, <a class="el" href="linkedlists_8h_source.html#l00715">AST_LIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="datastore_8h_source.html#l00056">ast_datastore::data</a>, <a class="el" href="res__odbc_8c_source.html#l00128">odbc_class::forcecommit</a>, <a class="el" href="res__odbc_8c_source.html#l00165">odbc_txn_frame::forcecommit</a>, <a class="el" href="res__odbc_8c_source.html#l00129">odbc_class::isolation</a>, <a class="el" href="res__odbc_8c_source.html#l00166">odbc_txn_frame::isolation</a>, <a class="el" href="structodbc__class.html#a033c9e1d6a001b7c5dc1a71ab21d0357">odbc_class::list</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="res__odbc_8c_source.html#l00167">odbc_txn_frame::name</a>, <a class="el" href="res__odbc_8c_source.html#l00156">odbc_txn_frame::obj</a>, <a class="el" href="res__odbc_8c_source.html#l00155">odbc_txn_frame::owner</a>, <a class="el" href="res__odbc_8h_source.html#l00048">odbc_obj::parent</a>, <a class="el" href="res__odbc_8h_source.html#l00057">odbc_obj::tx</a>, <a class="el" href="res__odbc_8h_source.html#l00058">odbc_obj::txf</a>, and <a class="el" href="res__odbc_8c_source.html#l00148">txn_info</a>.</p>

<p>Referenced by <a class="el" href="res__odbc_8c_source.html#l01464">acf_transaction_read()</a>, <a class="el" href="res__odbc_8c_source.html#l01502">acf_transaction_write()</a>, <a class="el" href="res__odbc_8c_source.html#l01041">ast_odbc_release_obj()</a>, <a class="el" href="res__odbc_8c_source.html#l01052">commit_exec()</a>, and <a class="el" href="res__odbc_8c_source.html#l01089">rollback_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00205"></a>00205 {
<a name="l00206"></a>00206    <span class="keyword">struct </span><a class="code" href="structast__datastore.html" title="Structure for a data store object.">ast_datastore</a> *txn_store;
<a name="l00207"></a>00207    <a class="code" href="linkedlists_8h.html#acdb4f56da6b3071d02dcce20072852b0" title="Defines a structure to be used to hold a list of specified type.">AST_LIST_HEAD</a>(, <a class="code" href="structodbc__txn__frame.html">odbc_txn_frame</a>) *oldlist;
<a name="l00208"></a>00208    <span class="keyword">struct </span><a class="code" href="structodbc__txn__frame.html">odbc_txn_frame</a> *txn = NULL;
<a name="l00209"></a>00209 
<a name="l00210"></a>00210    <span class="keywordflow">if</span> (!chan &amp;&amp; obj &amp;&amp; obj-&gt;<a class="code" href="structodbc__obj.html#a3c30e5fedd5867e29dcc58b7abfe3c0d">txf</a> &amp;&amp; obj-&gt;<a class="code" href="structodbc__obj.html#a3c30e5fedd5867e29dcc58b7abfe3c0d">txf</a>-&gt;<a class="code" href="structodbc__txn__frame.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l00211"></a>00211       chan = obj-&gt;<a class="code" href="structodbc__obj.html#a3c30e5fedd5867e29dcc58b7abfe3c0d">txf</a>-&gt;<a class="code" href="structodbc__txn__frame.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l00212"></a>00212    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!chan) {
<a name="l00213"></a>00213       <span class="comment">/* No channel == no transaction */</span>
<a name="l00214"></a>00214       <span class="keywordflow">return</span> NULL;
<a name="l00215"></a>00215    }
<a name="l00216"></a>00216 
<a name="l00217"></a>00217    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l00218"></a>00218    <span class="keywordflow">if</span> ((txn_store = <a class="code" href="channel_8h.html#aad1e09cd7c79237d05cffb45d6cdfd7c" title="Find a datastore on a channel.">ast_channel_datastore_find</a>(chan, &amp;<a class="code" href="res__odbc_8c.html#a39d901a085de05b4b891f3643347316a">txn_info</a>, NULL))) {
<a name="l00219"></a>00219       oldlist = txn_store-&gt;<a class="code" href="structast__datastore.html#a735984d41155bc1032e09bece8f8d66d">data</a>;
<a name="l00220"></a>00220    } <span class="keywordflow">else</span> {
<a name="l00221"></a>00221       <span class="comment">/* Need to create a new datastore */</span>
<a name="l00222"></a>00222       <span class="keywordflow">if</span> (!(txn_store = <a class="code" href="datastore_8h.html#a666afb07fd77d50782cc10f83e029159">ast_datastore_alloc</a>(&amp;<a class="code" href="res__odbc_8c.html#a39d901a085de05b4b891f3643347316a">txn_info</a>, NULL))) {
<a name="l00223"></a>00223          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to allocate a new datastore.  Cannot create a new transaction.\n&quot;</span>);
<a name="l00224"></a>00224          <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l00225"></a>00225          <span class="keywordflow">return</span> NULL;
<a name="l00226"></a>00226       }
<a name="l00227"></a>00227 
<a name="l00228"></a>00228       <span class="keywordflow">if</span> (!(oldlist = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*oldlist)))) {
<a name="l00229"></a>00229          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to allocate datastore list head.  Cannot create a new transaction.\n&quot;</span>);
<a name="l00230"></a>00230          <a class="code" href="datastore_8h.html#aee27286888b30c6448a9bce928040a14" title="Free a data store object.">ast_datastore_free</a>(txn_store);
<a name="l00231"></a>00231          <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l00232"></a>00232          <span class="keywordflow">return</span> NULL;
<a name="l00233"></a>00233       }
<a name="l00234"></a>00234 
<a name="l00235"></a>00235       txn_store-&gt;<a class="code" href="structast__datastore.html#a735984d41155bc1032e09bece8f8d66d">data</a> = oldlist;
<a name="l00236"></a>00236       <a class="code" href="linkedlists_8h.html#a6f42d3bf45cc9af6f794d9d1cf8c45ca" title="Initializes a list head structure.">AST_LIST_HEAD_INIT</a>(oldlist);
<a name="l00237"></a>00237       <a class="code" href="channel_8h.html#a1ed3e98d33d5587948a0e2ef67a81f52" title="Add a datastore to a channel.">ast_channel_datastore_add</a>(chan, txn_store);
<a name="l00238"></a>00238    }
<a name="l00239"></a>00239 
<a name="l00240"></a>00240    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(oldlist);
<a name="l00241"></a>00241    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l00242"></a>00242 
<a name="l00243"></a>00243    <span class="comment">/* Scanning for an object is *fast*.  Scanning for a name is much slower. */</span>
<a name="l00244"></a>00244    <span class="keywordflow">if</span> (obj != NULL || <a class="code" href="structodbc__txn__frame.html#ad89074c5d51acfd1ca5a1d7787d30d37" title="Is this record the current active transaction within the channel? Note that the active...">active</a> == 1) {
<a name="l00245"></a>00245       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(oldlist, txn, <a class="code" href="structodbc__txn__frame.html#a6715fc7084c4f5b7aa8ed33db42c33b5">list</a>) {
<a name="l00246"></a>00246          <span class="keywordflow">if</span> (txn-&gt;<a class="code" href="structodbc__txn__frame.html#ab5dd16c9db5f2ee0f0d6354952c92189">obj</a> == obj || txn-&gt;<a class="code" href="structodbc__txn__frame.html#ad89074c5d51acfd1ca5a1d7787d30d37" title="Is this record the current active transaction within the channel? Note that the active...">active</a>) {
<a name="l00247"></a>00247             <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(oldlist);
<a name="l00248"></a>00248             <span class="keywordflow">return</span> txn;
<a name="l00249"></a>00249          }
<a name="l00250"></a>00250       }
<a name="l00251"></a>00251    }
<a name="l00252"></a>00252 
<a name="l00253"></a>00253    <span class="keywordflow">if</span> (<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a> != NULL) {
<a name="l00254"></a>00254       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(oldlist, txn, <a class="code" href="structodbc__txn__frame.html#a6715fc7084c4f5b7aa8ed33db42c33b5">list</a>) {
<a name="l00255"></a>00255          <span class="keywordflow">if</span> (!strcasecmp(txn-&gt;<a class="code" href="structodbc__txn__frame.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>)) {
<a name="l00256"></a>00256             <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(oldlist);
<a name="l00257"></a>00257             <span class="keywordflow">return</span> txn;
<a name="l00258"></a>00258          }
<a name="l00259"></a>00259       }
<a name="l00260"></a>00260    }
<a name="l00261"></a>00261 
<a name="l00262"></a>00262    <span class="comment">/* Nothing found, create one */</span>
<a name="l00263"></a>00263    <span class="keywordflow">if</span> (<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a> &amp;&amp; obj &amp;&amp; (txn = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*txn) + strlen(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>) + 1))) {
<a name="l00264"></a>00264       <span class="keyword">struct </span><a class="code" href="structodbc__txn__frame.html">odbc_txn_frame</a> *otxn;
<a name="l00265"></a>00265 
<a name="l00266"></a>00266       strcpy(txn-&gt;<a class="code" href="structodbc__txn__frame.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>); <span class="comment">/* SAFE */</span>
<a name="l00267"></a>00267       txn-&gt;<a class="code" href="structodbc__txn__frame.html#ab5dd16c9db5f2ee0f0d6354952c92189">obj</a> = obj;
<a name="l00268"></a>00268       txn-&gt;<a class="code" href="structodbc__txn__frame.html#a6515c3eadbeefabf86e088a2b9a0332e">isolation</a> = obj-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a>-&gt;<a class="code" href="structodbc__class.html#a6515c3eadbeefabf86e088a2b9a0332e">isolation</a>;
<a name="l00269"></a>00269       txn-&gt;<a class="code" href="structodbc__txn__frame.html#addaad8ffa7ab4d6ad199b328ecfe234f">forcecommit</a> = obj-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a>-&gt;<a class="code" href="structodbc__class.html#addaad8ffa7ab4d6ad199b328ecfe234f">forcecommit</a>;
<a name="l00270"></a>00270       txn-&gt;<a class="code" href="structodbc__txn__frame.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = chan;
<a name="l00271"></a>00271       txn-&gt;<a class="code" href="structodbc__txn__frame.html#ad89074c5d51acfd1ca5a1d7787d30d37" title="Is this record the current active transaction within the channel? Note that the active...">active</a> = 1;
<a name="l00272"></a>00272 
<a name="l00273"></a>00273       <span class="comment">/* On creation, the txn becomes active, and all others inactive */</span>
<a name="l00274"></a>00274       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(oldlist, otxn, <a class="code" href="structodbc__txn__frame.html#a6715fc7084c4f5b7aa8ed33db42c33b5">list</a>) {
<a name="l00275"></a>00275          otxn-&gt;<a class="code" href="structodbc__txn__frame.html#ad89074c5d51acfd1ca5a1d7787d30d37" title="Is this record the current active transaction within the channel? Note that the active...">active</a> = 0;
<a name="l00276"></a>00276       }
<a name="l00277"></a>00277       <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(oldlist, txn, <a class="code" href="structodbc__txn__frame.html#a6715fc7084c4f5b7aa8ed33db42c33b5">list</a>);
<a name="l00278"></a>00278 
<a name="l00279"></a>00279       obj-&gt;<a class="code" href="structodbc__obj.html#a3c30e5fedd5867e29dcc58b7abfe3c0d">txf</a> = txn;
<a name="l00280"></a>00280       obj-&gt;<a class="code" href="structodbc__obj.html#abc0ea80cbb3a49c87b90be742126523c">tx</a> = 1;
<a name="l00281"></a>00281    }
<a name="l00282"></a>00282    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(oldlist);
<a name="l00283"></a>00283 
<a name="l00284"></a>00284    <span class="keywordflow">return</span> txn;
<a name="l00285"></a>00285 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a80e54e9debaeb3cd948b18b9c425cf4b"></a><!-- doxytag: member="res_odbc.c::handle_cli_odbc_show" ref="a80e54e9debaeb3cd948b18b9c425cf4b" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_cli_odbc_show </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l00871">871</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="astobj2_8c_source.html#l00795">ao2_iterator_destroy()</a>, <a class="el" href="astobj2_8c_source.html#l00780">ao2_iterator_init()</a>, <a class="el" href="astobj2_8h_source.html#l01120">ao2_iterator_next</a>, <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>, <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="res__odbc_8c_source.html#l00695">ast_odbc_sanity_check()</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="res__odbc_8c_source.html#l00136">class_container</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="res__odbc_8c_source.html#l00131">odbc_class::count</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="res__odbc_8h_source.html#l00046">odbc_obj::lock</a>, <a class="el" href="cli_8h_source.html#l00145">ast_cli_args::n</a>, <a class="el" href="cli_8h_source.html#l00144">ast_cli_args::pos</a>, <a class="el" href="res__odbc_8h_source.html#l00056">odbc_obj::up</a>, <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>, <a class="el" href="res__odbc_8h_source.html#l00055">odbc_obj::used</a>, and <a class="el" href="cli_8h_source.html#l00143">ast_cli_args::word</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00872"></a>00872 {
<a name="l00873"></a>00873    <span class="keyword">struct </span><a class="code" href="structao2__iterator.html" title="When we need to walk through a container, we use an ao2_iterator to keep track of...">ao2_iterator</a> aoi = <a class="code" href="astobj2_8h.html#a288075de687152d297308ea1ea963edb" title="Create an iterator for a container.">ao2_iterator_init</a>(<a class="code" href="res__odbc_8c.html#a9412fb74c274dc0c012fd7b4f5b6aa71">class_container</a>, 0);
<a name="l00874"></a>00874    <span class="keyword">struct </span><a class="code" href="structodbc__class.html">odbc_class</a> *<span class="keyword">class</span>;
<a name="l00875"></a>00875    <span class="keyword">struct </span><a class="code" href="structodbc__obj.html" title="ODBC container.">odbc_obj</a> *current;
<a name="l00876"></a>00876    <span class="keywordtype">int</span> length = 0;
<a name="l00877"></a>00877    <span class="keywordtype">int</span> which = 0;
<a name="l00878"></a>00878    <span class="keywordtype">char</span> *ret = NULL;
<a name="l00879"></a>00879 
<a name="l00880"></a>00880    <span class="keywordflow">switch</span> (cmd) {
<a name="l00881"></a>00881    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l00882"></a>00882       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;odbc show&quot;</span>;
<a name="l00883"></a>00883       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l00884"></a>00884             <span class="stringliteral">&quot;Usage: odbc show [class]\n&quot;</span>
<a name="l00885"></a>00885             <span class="stringliteral">&quot;       List settings of a particular ODBC class or,\n&quot;</span>
<a name="l00886"></a>00886             <span class="stringliteral">&quot;       if not specified, all classes.\n&quot;</span>;
<a name="l00887"></a>00887       <span class="keywordflow">return</span> NULL;
<a name="l00888"></a>00888    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l00889"></a>00889       <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#a1910d262855b71da353ed0d07a6c7823">pos</a> != 2)
<a name="l00890"></a>00890          <span class="keywordflow">return</span> NULL;
<a name="l00891"></a>00891       length = strlen(a-&gt;<a class="code" href="structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>);
<a name="l00892"></a>00892       <span class="keywordflow">while</span> ((<span class="keyword">class</span> = <a class="code" href="astobj2_8h.html#a1cf2fe1aafd3cb9e613eb48535a37ad5">ao2_iterator_next</a>(&amp;aoi))) {
<a name="l00893"></a>00893          <span class="keywordflow">if</span> (!strncasecmp(a-&gt;<a class="code" href="structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>, class-&gt;name, length) &amp;&amp; ++which &gt; a-&gt;<a class="code" href="structast__cli__args.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>) {
<a name="l00894"></a>00894             ret = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(class-&gt;name);
<a name="l00895"></a>00895          }
<a name="l00896"></a>00896          <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<span class="keyword">class</span>, -1);
<a name="l00897"></a>00897          <span class="keywordflow">if</span> (ret) {
<a name="l00898"></a>00898             <span class="keywordflow">break</span>;
<a name="l00899"></a>00899          }
<a name="l00900"></a>00900       }
<a name="l00901"></a>00901       <a class="code" href="astobj2_8h.html#a62d5d9e9d0fa281168e6a08ef4a52450" title="Destroy a container iterator.">ao2_iterator_destroy</a>(&amp;aoi);
<a name="l00902"></a>00902       <span class="keywordflow">if</span> (!ret &amp;&amp; !strncasecmp(a-&gt;<a class="code" href="structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>, <span class="stringliteral">&quot;all&quot;</span>, length) &amp;&amp; ++which &gt; a-&gt;<a class="code" href="structast__cli__args.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>) {
<a name="l00903"></a>00903          ret = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(<span class="stringliteral">&quot;all&quot;</span>);
<a name="l00904"></a>00904       }
<a name="l00905"></a>00905       <span class="keywordflow">return</span> ret;
<a name="l00906"></a>00906    }
<a name="l00907"></a>00907 
<a name="l00908"></a>00908    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;\nODBC DSN Settings\n&quot;</span>);
<a name="l00909"></a>00909    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>,   <span class="stringliteral">&quot;-----------------\n\n&quot;</span>);
<a name="l00910"></a>00910    aoi = <a class="code" href="astobj2_8h.html#a288075de687152d297308ea1ea963edb" title="Create an iterator for a container.">ao2_iterator_init</a>(<a class="code" href="res__odbc_8c.html#a9412fb74c274dc0c012fd7b4f5b6aa71">class_container</a>, 0);
<a name="l00911"></a>00911    <span class="keywordflow">while</span> ((<span class="keyword">class</span> = <a class="code" href="astobj2_8h.html#a1cf2fe1aafd3cb9e613eb48535a37ad5">ao2_iterator_next</a>(&amp;aoi))) {
<a name="l00912"></a>00912       <span class="keywordflow">if</span> ((a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> == 2) || (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> == 3 &amp;&amp; !strcmp(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[2], <span class="stringliteral">&quot;all&quot;</span>)) || (!strcmp(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[2], class-&gt;name))) {
<a name="l00913"></a>00913          <span class="keywordtype">int</span> count = 0;
<a name="l00914"></a>00914          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;  Name:   %s\n  DSN:    %s\n&quot;</span>, class-&gt;name, class-&gt;dsn);
<a name="l00915"></a>00915 
<a name="l00916"></a>00916          <span class="keywordflow">if</span> (class-&gt;haspool) {
<a name="l00917"></a>00917             <span class="keyword">struct </span><a class="code" href="structao2__iterator.html" title="When we need to walk through a container, we use an ao2_iterator to keep track of...">ao2_iterator</a> aoi2 = <a class="code" href="astobj2_8h.html#a288075de687152d297308ea1ea963edb" title="Create an iterator for a container.">ao2_iterator_init</a>(class-&gt;obj_container, 0);
<a name="l00918"></a>00918 
<a name="l00919"></a>00919             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;  Pooled: Yes\n  Limit:  %d\n  Connections in use: %d\n&quot;</span>, class-&gt;limit, class-&gt;count);
<a name="l00920"></a>00920 
<a name="l00921"></a>00921             <span class="keywordflow">while</span> ((current = <a class="code" href="astobj2_8h.html#a1cf2fe1aafd3cb9e613eb48535a37ad5">ao2_iterator_next</a>(&amp;aoi2))) {
<a name="l00922"></a>00922                <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;current-&gt;<a class="code" href="structodbc__obj.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00923"></a>00923 <span class="preprocessor">#ifdef DEBUG_THREADS</span>
<a name="l00924"></a>00924 <span class="preprocessor"></span>               <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;    - Connection %d: %s (%s:%d %s)\n&quot;</span>, ++count,
<a name="l00925"></a>00925                   current-&gt;<a class="code" href="structodbc__obj.html#a2590a5f33b83235fcf8740d3bb9b0e98">used</a> ? <span class="stringliteral">&quot;in use&quot;</span> :
<a name="l00926"></a>00926                   current-&gt;<a class="code" href="structodbc__obj.html#a8042aba89daa6448b14e94e6d0bb63bf">up</a> &amp;&amp; <a class="code" href="res__odbc_8h.html#a91a6be5993a0928cd527b584ec3407b7" title="Checks an ODBC object to ensure it is still connected.">ast_odbc_sanity_check</a>(current) ? <span class="stringliteral">&quot;connected&quot;</span> : <span class="stringliteral">&quot;disconnected&quot;</span>,
<a name="l00927"></a>00927                   current-&gt;file, current-&gt;lineno, current-&gt;function);
<a name="l00928"></a>00928 <span class="preprocessor">#else</span>
<a name="l00929"></a>00929 <span class="preprocessor"></span>               <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;    - Connection %d: %s\n&quot;</span>, ++count,
<a name="l00930"></a>00930                   current-&gt;<a class="code" href="structodbc__obj.html#a2590a5f33b83235fcf8740d3bb9b0e98">used</a> ? <span class="stringliteral">&quot;in use&quot;</span> :
<a name="l00931"></a>00931                   current-&gt;<a class="code" href="structodbc__obj.html#a8042aba89daa6448b14e94e6d0bb63bf">up</a> &amp;&amp; <a class="code" href="res__odbc_8h.html#a91a6be5993a0928cd527b584ec3407b7" title="Checks an ODBC object to ensure it is still connected.">ast_odbc_sanity_check</a>(current) ? <span class="stringliteral">&quot;connected&quot;</span> : <span class="stringliteral">&quot;disconnected&quot;</span>);
<a name="l00932"></a>00932 <span class="preprocessor">#endif</span>
<a name="l00933"></a>00933 <span class="preprocessor"></span>               <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;current-&gt;<a class="code" href="structodbc__obj.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00934"></a>00934                <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(current, -1);
<a name="l00935"></a>00935             }
<a name="l00936"></a>00936             <a class="code" href="astobj2_8h.html#a62d5d9e9d0fa281168e6a08ef4a52450" title="Destroy a container iterator.">ao2_iterator_destroy</a>(&amp;aoi2);
<a name="l00937"></a>00937          } <span class="keywordflow">else</span> {
<a name="l00938"></a>00938             <span class="comment">/* Should only ever be one of these (unless there are transactions) */</span>
<a name="l00939"></a>00939             <span class="keyword">struct </span><a class="code" href="structao2__iterator.html" title="When we need to walk through a container, we use an ao2_iterator to keep track of...">ao2_iterator</a> aoi2 = <a class="code" href="astobj2_8h.html#a288075de687152d297308ea1ea963edb" title="Create an iterator for a container.">ao2_iterator_init</a>(class-&gt;obj_container, 0);
<a name="l00940"></a>00940             <span class="keywordflow">while</span> ((current = <a class="code" href="astobj2_8h.html#a1cf2fe1aafd3cb9e613eb48535a37ad5">ao2_iterator_next</a>(&amp;aoi2))) {
<a name="l00941"></a>00941                <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;  Pooled: No\n  Connected: %s\n&quot;</span>, current-&gt;<a class="code" href="structodbc__obj.html#a2590a5f33b83235fcf8740d3bb9b0e98">used</a> ? <span class="stringliteral">&quot;In use&quot;</span> :
<a name="l00942"></a>00942                   current-&gt;<a class="code" href="structodbc__obj.html#a8042aba89daa6448b14e94e6d0bb63bf">up</a> &amp;&amp; <a class="code" href="res__odbc_8h.html#a91a6be5993a0928cd527b584ec3407b7" title="Checks an ODBC object to ensure it is still connected.">ast_odbc_sanity_check</a>(current) ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>);
<a name="l00943"></a>00943                <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(current, -1);
<a name="l00944"></a>00944             }
<a name="l00945"></a>00945             <a class="code" href="astobj2_8h.html#a62d5d9e9d0fa281168e6a08ef4a52450" title="Destroy a container iterator.">ao2_iterator_destroy</a>(&amp;aoi2);
<a name="l00946"></a>00946          }
<a name="l00947"></a>00947          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00948"></a>00948       }
<a name="l00949"></a>00949       <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<span class="keyword">class</span>, -1);
<a name="l00950"></a>00950    }
<a name="l00951"></a>00951    <a class="code" href="astobj2_8h.html#a62d5d9e9d0fa281168e6a08ef4a52450" title="Destroy a container iterator.">ao2_iterator_destroy</a>(&amp;aoi);
<a name="l00952"></a>00952 
<a name="l00953"></a>00953    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l00954"></a>00954 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aca44899b469bbddf9121412dde355864"></a><!-- doxytag: member="res_odbc.c::isolation2text" ref="aca44899b469bbddf9121412dde355864" args="(int iso)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static const char* isolation2text </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>iso</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l00170">170</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>Referenced by <a class="el" href="res__odbc_8c_source.html#l01464">acf_transaction_read()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00171"></a>00171 {
<a name="l00172"></a>00172    <span class="keywordflow">if</span> (iso == SQL_TXN_READ_COMMITTED) {
<a name="l00173"></a>00173       <span class="keywordflow">return</span> <span class="stringliteral">&quot;read_committed&quot;</span>;
<a name="l00174"></a>00174    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iso == SQL_TXN_READ_UNCOMMITTED) {
<a name="l00175"></a>00175       <span class="keywordflow">return</span> <span class="stringliteral">&quot;read_uncommitted&quot;</span>;
<a name="l00176"></a>00176    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iso == SQL_TXN_SERIALIZABLE) {
<a name="l00177"></a>00177       <span class="keywordflow">return</span> <span class="stringliteral">&quot;serializable&quot;</span>;
<a name="l00178"></a>00178    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iso == SQL_TXN_REPEATABLE_READ) {
<a name="l00179"></a>00179       <span class="keywordflow">return</span> <span class="stringliteral">&quot;repeatable_read&quot;</span>;
<a name="l00180"></a>00180    } <span class="keywordflow">else</span> {
<a name="l00181"></a>00181       <span class="keywordflow">return</span> <span class="stringliteral">&quot;unknown&quot;</span>;
<a name="l00182"></a>00182    }
<a name="l00183"></a>00183 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac3382bf6da54c56b37069bd76bbdf4f9"></a><!-- doxytag: member="res_odbc.c::load_module" ref="ac3382bf6da54c56b37069bd76bbdf4f9" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int load_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l01684">1684</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00727">ao2_container_alloc</a>, <a class="el" href="astobj2_8h_source.html#l00646">ao2_match_by_addr</a>, <a class="el" href="res__odbc_8c_source.html#l01601">app_commit</a>, <a class="el" href="res__odbc_8c_source.html#l01602">app_rollback</a>, <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="cli_8c_source.html#l01927">ast_cli_register_multiple()</a>, <a class="el" href="pbx_8h_source.html#l01028">ast_custom_function_register</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="module_8h_source.html#l00062">AST_MODULE_LOAD_DECLINE</a>, <a class="el" href="module_8h_source.html#l00406">ast_register_application_xml</a>, <a class="el" href="res__odbc_8c_source.html#l00136">class_container</a>, <a class="el" href="res__odbc_8c_source.html#l00956">cli_odbc</a>, <a class="el" href="res__odbc_8c_source.html#l01052">commit_exec()</a>, <a class="el" href="res__odbc_8c_source.html#l00730">load_odbc_config()</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="res__odbc_8c_source.html#l00389">null_hash_fn()</a>, <a class="el" href="res__odbc_8c_source.html#l01595">odbc_function</a>, and <a class="el" href="res__odbc_8c_source.html#l01089">rollback_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01685"></a>01685 {
<a name="l01686"></a>01686    <span class="keywordflow">if</span> (!(<a class="code" href="res__odbc_8c.html#a9412fb74c274dc0c012fd7b4f5b6aa71">class_container</a> = <a class="code" href="astobj2_8h.html#a82534c91be59ec9a3d3318ec85ac5695">ao2_container_alloc</a>(1, <a class="code" href="res__odbc_8c.html#a6724d6d8473543d898391aa5ed322d0d">null_hash_fn</a>, <a class="code" href="astobj2_8h.html#ad3cdef7b57f55d9f43407ab7c15c3422" title="a very common callback is one that matches by address.">ao2_match_by_addr</a>)))
<a name="l01687"></a>01687       <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;
<a name="l01688"></a>01688    <span class="keywordflow">if</span> (<a class="code" href="res__odbc_8c.html#a36bab917a61d04ba199008e31caf13b0">load_odbc_config</a>() == -1)
<a name="l01689"></a>01689       <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;
<a name="l01690"></a>01690    <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(<a class="code" href="res__odbc_8c.html#a16471fdb7e5070f8c0e991360e80ad6a">cli_odbc</a>, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="res__odbc_8c.html#a16471fdb7e5070f8c0e991360e80ad6a">cli_odbc</a>));
<a name="l01691"></a>01691    <a class="code" href="module_8h.html#afba4eb7a910b10969041ae4cd488729d" title="Register an application using XML documentation.">ast_register_application_xml</a>(<a class="code" href="res__odbc_8c.html#ad10e6ff5ddbbabf4740767dce0436391">app_commit</a>, <a class="code" href="res__odbc_8c.html#a2a49ba6d50b0e13140c63cec43cf3db7">commit_exec</a>);
<a name="l01692"></a>01692    <a class="code" href="module_8h.html#afba4eb7a910b10969041ae4cd488729d" title="Register an application using XML documentation.">ast_register_application_xml</a>(<a class="code" href="res__odbc_8c.html#a337085be7d10d0e93fddb07541942225">app_rollback</a>, <a class="code" href="res__odbc_8c.html#ae348b1f7286504f427377ac2f34a5207">rollback_exec</a>);
<a name="l01693"></a>01693    <a class="code" href="pbx_8h.html#a8af0e93442a9e468425f63cc52b0ac7b" title="Register a custom function.">ast_custom_function_register</a>(&amp;<a class="code" href="res__odbc_8c.html#a1e4b8faa910452a9acca534b7ae5ade2">odbc_function</a>);
<a name="l01694"></a>01694    <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;res_odbc loaded.\n&quot;</span>);
<a name="l01695"></a>01695    <span class="keywordflow">return</span> 0;
<a name="l01696"></a>01696 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a36bab917a61d04ba199008e31caf13b0"></a><!-- doxytag: member="res_odbc.c::load_odbc_config" ref="a36bab917a61d04ba199008e31caf13b0" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int load_odbc_config </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l00730">730</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00413">ao2_alloc</a>, <a class="el" href="astobj2_8h_source.html#l00727">ao2_container_alloc</a>, <a class="el" href="astobj2_8h_source.html#l00646">ao2_match_by_addr</a>, <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>, <a class="el" href="config_8c_source.html#l00613">ast_category_browse()</a>, <a class="el" href="config_8c_source.html#l00827">ast_config_destroy()</a>, <a class="el" href="config_8h_source.html#l00139">ast_config_load</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="utils_8c_source.html#l01328">ast_false()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="utils_8c_source.html#l01311">ast_true()</a>, <a class="el" href="config_8c_source.html#l00411">ast_variable_browse()</a>, <a class="el" href="cdr__csv_8c_source.html#l00054">config</a>, <a class="el" href="config_8h_source.html#l00050">CONFIG_STATUS_FILEINVALID</a>, <a class="el" href="config_8h_source.html#l00048">CONFIG_STATUS_FILEMISSING</a>, <a class="el" href="res__odbc_8c_source.html#l00120">odbc_class::dsn</a>, <a class="el" href="devicestate_8c_source.html#l00199">enabled</a>, <a class="el" href="res__odbc_8c_source.html#l00128">odbc_class::forcecommit</a>, <a class="el" href="res__odbc_8c_source.html#l00132">odbc_class::idlecheck</a>, <a class="el" href="res__odbc_8c_source.html#l00129">odbc_class::isolation</a>, <a class="el" href="res__odbc_8c_source.html#l00130">odbc_class::limit</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="config_8h_source.html#l00075">ast_variable::name</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="res__odbc_8c_source.html#l00389">null_hash_fn()</a>, <a class="el" href="res__odbc_8c_source.html#l00370">odbc_class_destructor()</a>, <a class="el" href="res__odbc_8c_source.html#l00960">odbc_register_class()</a>, <a class="el" href="res__odbc_8c_source.html#l00122">odbc_class::password</a>, <a class="el" href="res__odbc_8c_source.html#l00123">odbc_class::sanitysql</a>, <a class="el" href="agi_2strcompat_8c_source.html#l00054">setenv()</a>, <a class="el" href="res__odbc_8c_source.html#l00185">text2isolation()</a>, <a class="el" href="res__odbc_8c_source.html#l00121">odbc_class::username</a>, and <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>.</p>

<p>Referenced by <a class="el" href="res__odbc_8c_source.html#l01684">load_module()</a>, and <a class="el" href="res__odbc_8c_source.html#l01604">reload()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00731"></a>00731 {
<a name="l00732"></a>00732    <span class="keyword">static</span> <span class="keywordtype">char</span> *cfg = <span class="stringliteral">&quot;res_odbc.conf&quot;</span>;
<a name="l00733"></a>00733    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *<a class="code" href="cdr__csv_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>;
<a name="l00734"></a>00734    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *v;
<a name="l00735"></a>00735    <span class="keywordtype">char</span> *cat;
<a name="l00736"></a>00736    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="cdr__odbc_8c.html#a281ed9889d4f4c24980a0c06664ed6e4">dsn</a>, *username, *password, *sanitysql;
<a name="l00737"></a>00737    <span class="keywordtype">int</span> <a class="code" href="devicestate_8c.html#a63be54a0beac1f5717217e1d9e629c71">enabled</a>, pooling, limit, bse, forcecommit, isolation;
<a name="l00738"></a>00738    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> idlecheck;
<a name="l00739"></a>00739    <span class="keywordtype">int</span> preconnect = 0, res = 0;
<a name="l00740"></a>00740    <span class="keyword">struct </span><a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> <a class="code" href="app__rpt_8c.html#a1f57f20c1f46890828791a4827fe8752">config_flags</a> = { 0 };
<a name="l00741"></a>00741 
<a name="l00742"></a>00742    <span class="keyword">struct </span><a class="code" href="structodbc__class.html">odbc_class</a> *<span class="keyword">new</span>;
<a name="l00743"></a>00743 
<a name="l00744"></a>00744    config = <a class="code" href="config_8h.html#a0a07ddd6bbcf44485e01c14c96109482">ast_config_load</a>(cfg, config_flags);
<a name="l00745"></a>00745    <span class="keywordflow">if</span> (config == <a class="code" href="config_8h.html#a39bacaabcacf47583204c7634e64a2a0">CONFIG_STATUS_FILEMISSING</a> || config == <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>) {
<a name="l00746"></a>00746       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to load config file res_odbc.conf\n&quot;</span>);
<a name="l00747"></a>00747       <span class="keywordflow">return</span> -1;
<a name="l00748"></a>00748    }
<a name="l00749"></a>00749    <span class="keywordflow">for</span> (cat = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(config, NULL); cat; cat=<a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(config, cat)) {
<a name="l00750"></a>00750       <span class="keywordflow">if</span> (!strcasecmp(cat, <span class="stringliteral">&quot;ENV&quot;</span>)) {
<a name="l00751"></a>00751          <span class="keywordflow">for</span> (v = <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(config, cat); v; v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l00752"></a>00752             <a class="code" href="agi_2strcompat_8c.html#a1c8b16a3abcb4dc450a0a62b42c554dd">setenv</a>(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, 1);
<a name="l00753"></a>00753             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Adding ENV var: %s=%s\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l00754"></a>00754          }
<a name="l00755"></a>00755       } <span class="keywordflow">else</span> {
<a name="l00756"></a>00756          <span class="comment">/* Reset all to defaults for each class of odbc connections */</span>
<a name="l00757"></a>00757          dsn = username = password = sanitysql = NULL;
<a name="l00758"></a>00758          enabled = 1;
<a name="l00759"></a>00759          preconnect = idlecheck = 0;
<a name="l00760"></a>00760          pooling = 0;
<a name="l00761"></a>00761          limit = 0;
<a name="l00762"></a>00762          bse = 1;
<a name="l00763"></a>00763          forcecommit = 0;
<a name="l00764"></a>00764          isolation = SQL_TXN_READ_COMMITTED;
<a name="l00765"></a>00765          <span class="keywordflow">for</span> (v = <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(config, cat); v; v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l00766"></a>00766             <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;pooling&quot;</span>)) {
<a name="l00767"></a>00767                <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>))
<a name="l00768"></a>00768                   pooling = 1;
<a name="l00769"></a>00769             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;share&quot;</span>, 5)) {
<a name="l00770"></a>00770                <span class="comment">/* &quot;shareconnections&quot; is a little clearer in meaning than &quot;pooling&quot; */</span>
<a name="l00771"></a>00771                <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a6c3dc0bad204e9dd9890325c1c861e38" title="Make sure something is false. Determine if a string containing a boolean value is...">ast_false</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>))
<a name="l00772"></a>00772                   pooling = 1;
<a name="l00773"></a>00773             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;limit&quot;</span>)) {
<a name="l00774"></a>00774                sscanf(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;limit);
<a name="l00775"></a>00775                <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>) &amp;&amp; !limit) {
<a name="l00776"></a>00776                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Limit should be a number, not a boolean: &apos;%s&apos;.  Setting limit to 1023 for ODBC class &apos;%s&apos;.\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, cat);
<a name="l00777"></a>00777                   limit = 1023;
<a name="l00778"></a>00778                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a6c3dc0bad204e9dd9890325c1c861e38" title="Make sure something is false. Determine if a string containing a boolean value is...">ast_false</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>)) {
<a name="l00779"></a>00779                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Limit should be a number, not a boolean: &apos;%s&apos;.  Disabling ODBC class &apos;%s&apos;.\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, cat);
<a name="l00780"></a>00780                   enabled = 0;
<a name="l00781"></a>00781                   <span class="keywordflow">break</span>;
<a name="l00782"></a>00782                }
<a name="l00783"></a>00783             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;idlecheck&quot;</span>)) {
<a name="l00784"></a>00784                sscanf(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;%30u&quot;</span>, &amp;idlecheck);
<a name="l00785"></a>00785             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;enabled&quot;</span>)) {
<a name="l00786"></a>00786                enabled = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l00787"></a>00787             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;pre-connect&quot;</span>)) {
<a name="l00788"></a>00788                preconnect = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l00789"></a>00789             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;dsn&quot;</span>)) {
<a name="l00790"></a>00790                dsn = v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>;
<a name="l00791"></a>00791             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;username&quot;</span>)) {
<a name="l00792"></a>00792                username = v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>;
<a name="l00793"></a>00793             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;password&quot;</span>)) {
<a name="l00794"></a>00794                password = v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>;
<a name="l00795"></a>00795             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;sanitysql&quot;</span>)) {
<a name="l00796"></a>00796                sanitysql = v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>;
<a name="l00797"></a>00797             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;backslash_is_escape&quot;</span>)) {
<a name="l00798"></a>00798                bse = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l00799"></a>00799             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;forcecommit&quot;</span>)) {
<a name="l00800"></a>00800                forcecommit = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l00801"></a>00801             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;isolation&quot;</span>)) {
<a name="l00802"></a>00802                <span class="keywordflow">if</span> ((isolation = <a class="code" href="res__odbc_8c.html#a55a59530704f7603d65dcfff89e54e1f">text2isolation</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>)) == 0) {
<a name="l00803"></a>00803                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unrecognized value for &apos;isolation&apos;: &apos;%s&apos; in section &apos;%s&apos;\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, cat);
<a name="l00804"></a>00804                   isolation = SQL_TXN_READ_COMMITTED;
<a name="l00805"></a>00805                }
<a name="l00806"></a>00806             }
<a name="l00807"></a>00807          }
<a name="l00808"></a>00808 
<a name="l00809"></a>00809          <span class="keywordflow">if</span> (enabled &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(dsn)) {
<a name="l00810"></a>00810             <span class="keyword">new</span> = <a class="code" href="astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*<span class="keyword">new</span>), <a class="code" href="res__odbc_8c.html#a926fb02d40cc6c737ef3bdaa37748346">odbc_class_destructor</a>);
<a name="l00811"></a>00811 
<a name="l00812"></a>00812             <span class="keywordflow">if</span> (!<span class="keyword">new</span>) {
<a name="l00813"></a>00813                res = -1;
<a name="l00814"></a>00814                <span class="keywordflow">break</span>;
<a name="l00815"></a>00815             }
<a name="l00816"></a>00816 
<a name="l00817"></a>00817             SQLAllocHandle(SQL_HANDLE_ENV, SQL_NULL_HANDLE, &amp;new-&gt;env);
<a name="l00818"></a>00818             res = SQLSetEnvAttr(new-&gt;env, SQL_ATTR_ODBC_VERSION, (<span class="keywordtype">void</span> *) SQL_OV_ODBC3, 0);
<a name="l00819"></a>00819 
<a name="l00820"></a>00820             <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO)) {
<a name="l00821"></a>00821                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;res_odbc: Error SetEnv\n&quot;</span>);
<a name="l00822"></a>00822                <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<span class="keyword">new</span>, -1);
<a name="l00823"></a>00823                <span class="keywordflow">return</span> res;
<a name="l00824"></a>00824             }
<a name="l00825"></a>00825 
<a name="l00826"></a>00826             <span class="keyword">new</span>-&gt;obj_container = <a class="code" href="astobj2_8h.html#a82534c91be59ec9a3d3318ec85ac5695">ao2_container_alloc</a>(1, <a class="code" href="res__odbc_8c.html#a6724d6d8473543d898391aa5ed322d0d">null_hash_fn</a>, <a class="code" href="astobj2_8h.html#ad3cdef7b57f55d9f43407ab7c15c3422" title="a very common callback is one that matches by address.">ao2_match_by_addr</a>);
<a name="l00827"></a>00827 
<a name="l00828"></a>00828             <span class="keywordflow">if</span> (pooling) {
<a name="l00829"></a>00829                <span class="keyword">new</span>-&gt;haspool = pooling;
<a name="l00830"></a>00830                <span class="keywordflow">if</span> (limit) {
<a name="l00831"></a>00831                   <span class="keyword">new</span>-&gt;limit = limit;
<a name="l00832"></a>00832                } <span class="keywordflow">else</span> {
<a name="l00833"></a>00833                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Pooling without also setting a limit is pointless.  Changing limit from 0 to 5.\n&quot;</span>);
<a name="l00834"></a>00834                   <span class="keyword">new</span>-&gt;limit = 5;
<a name="l00835"></a>00835                }
<a name="l00836"></a>00836             }
<a name="l00837"></a>00837 
<a name="l00838"></a>00838             <span class="keyword">new</span>-&gt;backslash_is_escape = bse ? 1 : 0;
<a name="l00839"></a>00839             <span class="keyword">new</span>-&gt;forcecommit = forcecommit ? 1 : 0;
<a name="l00840"></a>00840             <span class="keyword">new</span>-&gt;isolation = isolation;
<a name="l00841"></a>00841             <span class="keyword">new</span>-&gt;idlecheck = idlecheck;
<a name="l00842"></a>00842 
<a name="l00843"></a>00843             <span class="keywordflow">if</span> (cat)
<a name="l00844"></a>00844                <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(new-&gt;name, cat, <span class="keyword">sizeof</span>(new-&gt;name));
<a name="l00845"></a>00845             <span class="keywordflow">if</span> (dsn)
<a name="l00846"></a>00846                <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(new-&gt;dsn, dsn, <span class="keyword">sizeof</span>(new-&gt;dsn));
<a name="l00847"></a>00847             <span class="keywordflow">if</span> (username &amp;&amp; !(new-&gt;username = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(username))) {
<a name="l00848"></a>00848                <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<span class="keyword">new</span>, -1);
<a name="l00849"></a>00849                <span class="keywordflow">break</span>;
<a name="l00850"></a>00850             }
<a name="l00851"></a>00851             <span class="keywordflow">if</span> (password &amp;&amp; !(new-&gt;password = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(password))) {
<a name="l00852"></a>00852                <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<span class="keyword">new</span>, -1);
<a name="l00853"></a>00853                <span class="keywordflow">break</span>;
<a name="l00854"></a>00854             }
<a name="l00855"></a>00855             <span class="keywordflow">if</span> (sanitysql &amp;&amp; !(new-&gt;sanitysql = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(sanitysql))) {
<a name="l00856"></a>00856                <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<span class="keyword">new</span>, -1);
<a name="l00857"></a>00857                <span class="keywordflow">break</span>;
<a name="l00858"></a>00858             }
<a name="l00859"></a>00859 
<a name="l00860"></a>00860             <a class="code" href="res__odbc_8c.html#a37d2ad3db8f19b56f61d47bfbf7b3dbe">odbc_register_class</a>(<span class="keyword">new</span>, preconnect);
<a name="l00861"></a>00861             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Registered ODBC class &apos;%s&apos; dsn-&gt;[%s]\n&quot;</span>, cat, dsn);
<a name="l00862"></a>00862             <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<span class="keyword">new</span>, -1);
<a name="l00863"></a>00863             <span class="keyword">new</span> = NULL;
<a name="l00864"></a>00864          }
<a name="l00865"></a>00865       }
<a name="l00866"></a>00866    }
<a name="l00867"></a>00867    <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(config);
<a name="l00868"></a>00868    <span class="keywordflow">return</span> res;
<a name="l00869"></a>00869 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3c503c85e1a5537b72a364bb4441689b"></a><!-- doxytag: member="res_odbc.c::mark_transaction_active" ref="a3c503c85e1a5537b72a364bb4441689b" args="(struct ast_channel *chan, struct odbc_txn_frame *tx)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int mark_transaction_active </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structodbc__txn__frame.html">odbc_txn_frame</a> *&nbsp;</td>
          <td class="paramname"> <em>tx</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l00339">339</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="res__odbc_8c_source.html#l00164">odbc_txn_frame::active</a>, <a class="el" href="channel_8c_source.html#l01548">ast_channel_datastore_find()</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="linkedlists_8h_source.html#l00172">AST_LIST_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="datastore_8h_source.html#l00056">ast_datastore::data</a>, <a class="el" href="structodbc__class.html#a033c9e1d6a001b7c5dc1a71ab21d0357">odbc_class::list</a>, <a class="el" href="res__odbc_8c_source.html#l00155">odbc_txn_frame::owner</a>, and <a class="el" href="res__odbc_8c_source.html#l00148">txn_info</a>.</p>

<p>Referenced by <a class="el" href="res__odbc_8c_source.html#l01502">acf_transaction_write()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00340"></a>00340 {
<a name="l00341"></a>00341    <span class="keyword">struct </span><a class="code" href="structast__datastore.html" title="Structure for a data store object.">ast_datastore</a> *txn_store;
<a name="l00342"></a>00342    <a class="code" href="linkedlists_8h.html#acdb4f56da6b3071d02dcce20072852b0" title="Defines a structure to be used to hold a list of specified type.">AST_LIST_HEAD</a>(, <a class="code" href="structodbc__txn__frame.html">odbc_txn_frame</a>) *oldlist;
<a name="l00343"></a>00343    <span class="keyword">struct </span><a class="code" href="structodbc__txn__frame.html">odbc_txn_frame</a> *<a class="code" href="structodbc__txn__frame.html#ad89074c5d51acfd1ca5a1d7787d30d37" title="Is this record the current active transaction within the channel? Note that the active...">active</a> = NULL, *txn;
<a name="l00344"></a>00344 
<a name="l00345"></a>00345    <span class="keywordflow">if</span> (!chan &amp;&amp; tx &amp;&amp; tx-&gt;<a class="code" href="structodbc__txn__frame.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l00346"></a>00346       chan = tx-&gt;<a class="code" href="structodbc__txn__frame.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l00347"></a>00347    }
<a name="l00348"></a>00348 
<a name="l00349"></a>00349    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l00350"></a>00350    <span class="keywordflow">if</span> (!(txn_store = <a class="code" href="channel_8h.html#aad1e09cd7c79237d05cffb45d6cdfd7c" title="Find a datastore on a channel.">ast_channel_datastore_find</a>(chan, &amp;<a class="code" href="res__odbc_8c.html#a39d901a085de05b4b891f3643347316a">txn_info</a>, NULL))) {
<a name="l00351"></a>00351       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l00352"></a>00352       <span class="keywordflow">return</span> -1;
<a name="l00353"></a>00353    }
<a name="l00354"></a>00354 
<a name="l00355"></a>00355    oldlist = txn_store-&gt;<a class="code" href="structast__datastore.html#a735984d41155bc1032e09bece8f8d66d">data</a>;
<a name="l00356"></a>00356    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(oldlist);
<a name="l00357"></a>00357    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(oldlist, txn, <a class="code" href="structodbc__txn__frame.html#a6715fc7084c4f5b7aa8ed33db42c33b5">list</a>) {
<a name="l00358"></a>00358       <span class="keywordflow">if</span> (txn == tx) {
<a name="l00359"></a>00359          txn-&gt;active = 1;
<a name="l00360"></a>00360          active = txn;
<a name="l00361"></a>00361       } <span class="keywordflow">else</span> {
<a name="l00362"></a>00362          txn-&gt;<a class="code" href="structodbc__txn__frame.html#ad89074c5d51acfd1ca5a1d7787d30d37" title="Is this record the current active transaction within the channel? Note that the active...">active</a> = 0;
<a name="l00363"></a>00363       }
<a name="l00364"></a>00364    }
<a name="l00365"></a>00365    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(oldlist);
<a name="l00366"></a>00366    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l00367"></a>00367    <span class="keywordflow">return</span> active ? 0 : -1;
<a name="l00368"></a>00368 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6724d6d8473543d898391aa5ed322d0d"></a><!-- doxytag: member="res_odbc.c::null_hash_fn" ref="a6724d6d8473543d898391aa5ed322d0d" args="(const void *obj, const int flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int null_hash_fn </td>
          <td>(</td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l00389">389</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>Referenced by <a class="el" href="res__odbc_8c_source.html#l01684">load_module()</a>, and <a class="el" href="res__odbc_8c_source.html#l00730">load_odbc_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00390"></a>00390 {
<a name="l00391"></a>00391    <span class="keywordflow">return</span> 0;
<a name="l00392"></a>00392 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a926fb02d40cc6c737ef3bdaa37748346"></a><!-- doxytag: member="res_odbc.c::odbc_class_destructor" ref="a926fb02d40cc6c737ef3bdaa37748346" args="(void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void odbc_class_destructor </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l00370">370</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>, and <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>.</p>

<p>Referenced by <a class="el" href="res__odbc_8c_source.html#l00730">load_odbc_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00371"></a>00371 {
<a name="l00372"></a>00372    <span class="keyword">struct </span><a class="code" href="structodbc__class.html">odbc_class</a> *<span class="keyword">class </span>= data;
<a name="l00373"></a>00373    <span class="comment">/* Due to refcounts, we can safely assume that any objects with a reference</span>
<a name="l00374"></a>00374 <span class="comment">    * to us will prevent our destruction, so we don&apos;t need to worry about them.</span>
<a name="l00375"></a>00375 <span class="comment">    */</span>
<a name="l00376"></a>00376    <span class="keywordflow">if</span> (class-&gt;username) {
<a name="l00377"></a>00377       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(class-&gt;username);
<a name="l00378"></a>00378    }
<a name="l00379"></a>00379    <span class="keywordflow">if</span> (class-&gt;password) {
<a name="l00380"></a>00380       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(class-&gt;password);
<a name="l00381"></a>00381    }
<a name="l00382"></a>00382    <span class="keywordflow">if</span> (class-&gt;sanitysql) {
<a name="l00383"></a>00383       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(class-&gt;sanitysql);
<a name="l00384"></a>00384    }
<a name="l00385"></a>00385    <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(class-&gt;obj_container, -1);
<a name="l00386"></a>00386    SQLFreeHandle(SQL_HANDLE_ENV, class-&gt;env);
<a name="l00387"></a>00387 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5f3e9c3099b36a9c5cf70c19f9935d38"></a><!-- doxytag: member="res_odbc.c::odbc_obj_connect" ref="a5f3e9c3099b36a9c5cf70c19f9935d38" args="(struct odbc_obj *obj)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="res__odbc_8h.html#a105a23abbc3dcfda7728a1a39987b3d6">odbc_status</a> odbc_obj_connect </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l01411">1411</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="res__odbc_8h_source.html#l00047">odbc_obj::con</a>, <a class="el" href="res__odbc_8c_source.html#l00120">odbc_class::dsn</a>, <a class="el" href="res__odbc_8c_source.html#l00124">odbc_class::env</a>, <a class="el" href="res__odbc_8h_source.html#l00049">odbc_obj::last_used</a>, <a class="el" href="res__odbc_8h_source.html#l00046">odbc_obj::lock</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="adsistub_8c_source.html#l00055">msg</a>, <a class="el" href="res__odbc_8c_source.html#l00119">odbc_class::name</a>, <a class="el" href="res__odbc_8h_source.html#l00036">ODBC_FAIL</a>, <a class="el" href="res__odbc_8c_source.html#l01374">odbc_obj_disconnect()</a>, <a class="el" href="res__odbc_8h_source.html#l00036">ODBC_SUCCESS</a>, <a class="el" href="res__odbc_8h_source.html#l00048">odbc_obj::parent</a>, <a class="el" href="res__odbc_8c_source.html#l00122">odbc_class::password</a>, <a class="el" href="res__odbc_8h_source.html#l00056">odbc_obj::up</a>, and <a class="el" href="res__odbc_8c_source.html#l00121">odbc_class::username</a>.</p>

<p>Referenced by <a class="el" href="res__odbc_8c_source.html#l00568">ast_odbc_direct_execute()</a>, <a class="el" href="res__odbc_8c_source.html#l01156">ast_odbc_request_obj2()</a>, and <a class="el" href="res__odbc_8c_source.html#l00695">ast_odbc_sanity_check()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01412"></a>01412 {
<a name="l01413"></a>01413    <span class="keywordtype">int</span> res;
<a name="l01414"></a>01414    SQLINTEGER err;
<a name="l01415"></a>01415    <span class="keywordtype">short</span> <span class="keywordtype">int</span> mlen;
<a name="l01416"></a>01416    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#a0dee90db1d6eb30329bee1ae6cec036a">msg</a>[200], <a class="code" href="structstate.html">state</a>[10];
<a name="l01417"></a>01417 <span class="preprocessor">#ifdef NEEDTRACE</span>
<a name="l01418"></a>01418 <span class="preprocessor"></span>   SQLINTEGER enable = 1;
<a name="l01419"></a>01419    <span class="keywordtype">char</span> *tracefile = <span class="stringliteral">&quot;/tmp/odbc.trace&quot;</span>;
<a name="l01420"></a>01420 <span class="preprocessor">#endif</span>
<a name="l01421"></a>01421 <span class="preprocessor"></span>   <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;obj-&gt;<a class="code" href="structodbc__obj.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01422"></a>01422 
<a name="l01423"></a>01423    <span class="keywordflow">if</span> (obj-&gt;<a class="code" href="structodbc__obj.html#a8042aba89daa6448b14e94e6d0bb63bf">up</a>) {
<a name="l01424"></a>01424       <a class="code" href="res__odbc_8c.html#ac83b00e5ebe4dcb0af74363ac609c8d5">odbc_obj_disconnect</a>(obj);
<a name="l01425"></a>01425       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Re-connecting %s\n&quot;</span>, obj-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a>-&gt;<a class="code" href="structodbc__class.html#a3777dbae63a15da001b2baa317a25149">name</a>);
<a name="l01426"></a>01426    } <span class="keywordflow">else</span> {
<a name="l01427"></a>01427       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Connecting %s\n&quot;</span>, obj-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a>-&gt;<a class="code" href="structodbc__class.html#a3777dbae63a15da001b2baa317a25149">name</a>);
<a name="l01428"></a>01428    }
<a name="l01429"></a>01429 
<a name="l01430"></a>01430    res = SQLAllocHandle(SQL_HANDLE_DBC, obj-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a>-&gt;<a class="code" href="structodbc__class.html#a9e986b27a58688aa57b320d62b6c3a29">env</a>, &amp;obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>);
<a name="l01431"></a>01431 
<a name="l01432"></a>01432    <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO)) {
<a name="l01433"></a>01433       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;res_odbc: Error AllocHDB %d\n&quot;</span>, res);
<a name="l01434"></a>01434       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;obj-&gt;<a class="code" href="structodbc__obj.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01435"></a>01435       <span class="keywordflow">return</span> <a class="code" href="res__odbc_8h.html#a105a23abbc3dcfda7728a1a39987b3d6a727133c18382293823de31545d7c5175">ODBC_FAIL</a>;
<a name="l01436"></a>01436    }
<a name="l01437"></a>01437    SQLSetConnectAttr(obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, SQL_LOGIN_TIMEOUT, (SQLPOINTER *) 10, 0);
<a name="l01438"></a>01438    SQLSetConnectAttr(obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, SQL_ATTR_CONNECTION_TIMEOUT, (SQLPOINTER *) 10, 0);
<a name="l01439"></a>01439 <span class="preprocessor">#ifdef NEEDTRACE</span>
<a name="l01440"></a>01440 <span class="preprocessor"></span>   SQLSetConnectAttr(obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, SQL_ATTR_TRACE, &amp;enable, SQL_IS_INTEGER);
<a name="l01441"></a>01441    SQLSetConnectAttr(obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, SQL_ATTR_TRACEFILE, tracefile, strlen(tracefile));
<a name="l01442"></a>01442 <span class="preprocessor">#endif</span>
<a name="l01443"></a>01443 <span class="preprocessor"></span>
<a name="l01444"></a>01444    res = SQLConnect(obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>,
<a name="l01445"></a>01445          (SQLCHAR *) obj-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a>-&gt;<a class="code" href="structodbc__class.html#a1524f0152ab56bd2841053338f22aa86">dsn</a>, SQL_NTS,
<a name="l01446"></a>01446          (SQLCHAR *) obj-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a>-&gt;<a class="code" href="structodbc__class.html#a9b20c006bd90a09e1465fb668700e81d">username</a>, SQL_NTS,
<a name="l01447"></a>01447          (SQLCHAR *) obj-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a>-&gt;<a class="code" href="structodbc__class.html#a59460a3ff2c12443d1022e5cc0fba85c">password</a>, SQL_NTS);
<a name="l01448"></a>01448 
<a name="l01449"></a>01449    <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO)) {
<a name="l01450"></a>01450       SQLGetDiagRec(SQL_HANDLE_DBC, obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, 1, state, &amp;err, msg, 100, &amp;mlen);
<a name="l01451"></a>01451       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;obj-&gt;<a class="code" href="structodbc__obj.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01452"></a>01452       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;res_odbc: Error SQLConnect=%d errno=%d %s\n&quot;</span>, res, (<span class="keywordtype">int</span>)err, msg);
<a name="l01453"></a>01453       <span class="keywordflow">return</span> <a class="code" href="res__odbc_8h.html#a105a23abbc3dcfda7728a1a39987b3d6a727133c18382293823de31545d7c5175">ODBC_FAIL</a>;
<a name="l01454"></a>01454    } <span class="keywordflow">else</span> {
<a name="l01455"></a>01455       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;res_odbc: Connected to %s [%s]\n&quot;</span>, obj-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a>-&gt;<a class="code" href="structodbc__class.html#a3777dbae63a15da001b2baa317a25149">name</a>, obj-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a>-&gt;<a class="code" href="structodbc__class.html#a1524f0152ab56bd2841053338f22aa86">dsn</a>);
<a name="l01456"></a>01456       obj-&gt;<a class="code" href="structodbc__obj.html#a8042aba89daa6448b14e94e6d0bb63bf">up</a> = 1;
<a name="l01457"></a>01457       obj-&gt;<a class="code" href="structodbc__obj.html#a43b2c8a8bf77a2504897ff0da9b0aa90">last_used</a> = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l01458"></a>01458    }
<a name="l01459"></a>01459 
<a name="l01460"></a>01460    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;obj-&gt;<a class="code" href="structodbc__obj.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01461"></a>01461    <span class="keywordflow">return</span> <a class="code" href="res__odbc_8h.html#a105a23abbc3dcfda7728a1a39987b3d6ac683a4e66b82f69b00b54e279697fa92">ODBC_SUCCESS</a>;
<a name="l01462"></a>01462 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4d57d49f8c33dc81fb16699d63ff8f26"></a><!-- doxytag: member="res_odbc.c::odbc_obj_destructor" ref="a4d57d49f8c33dc81fb16699d63ff8f26" args="(void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void odbc_obj_destructor </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l00394">394</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>, <a class="el" href="lock_8h_source.html#l01712">ast_mutex_destroy()</a>, <a class="el" href="res__odbc_8h_source.html#l00046">odbc_obj::lock</a>, <a class="el" href="res__odbc_8c_source.html#l01374">odbc_obj_disconnect()</a>, and <a class="el" href="res__odbc_8h_source.html#l00048">odbc_obj::parent</a>.</p>

<p>Referenced by <a class="el" href="res__odbc_8c_source.html#l01156">ast_odbc_request_obj2()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00395"></a>00395 {
<a name="l00396"></a>00396    <span class="keyword">struct </span><a class="code" href="structodbc__obj.html" title="ODBC container.">odbc_obj</a> *obj = data;
<a name="l00397"></a>00397    <span class="keyword">struct </span><a class="code" href="structodbc__class.html">odbc_class</a> *<span class="keyword">class </span>= obj-&gt;parent;
<a name="l00398"></a>00398    obj-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a> = NULL;
<a name="l00399"></a>00399    <a class="code" href="res__odbc_8c.html#ac83b00e5ebe4dcb0af74363ac609c8d5">odbc_obj_disconnect</a>(obj);
<a name="l00400"></a>00400    <a class="code" href="lock_8h.html#ab237e70b569019bfb490ab0c3c09b8c5">ast_mutex_destroy</a>(&amp;obj-&gt;<a class="code" href="structodbc__obj.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00401"></a>00401    <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<span class="keyword">class</span>, -1);
<a name="l00402"></a>00402 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac83b00e5ebe4dcb0af74363ac609c8d5"></a><!-- doxytag: member="res_odbc.c::odbc_obj_disconnect" ref="ac83b00e5ebe4dcb0af74363ac609c8d5" args="(struct odbc_obj *obj)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="res__odbc_8h.html#a105a23abbc3dcfda7728a1a39987b3d6">odbc_status</a> odbc_obj_disconnect </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l01374">1374</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="res__odbc_8h_source.html#l00047">odbc_obj::con</a>, <a class="el" href="res__odbc_8c_source.html#l00120">odbc_class::dsn</a>, <a class="el" href="res__odbc_8h_source.html#l00046">odbc_obj::lock</a>, <a class="el" href="logger_8h_source.html#l00119">LOG_DEBUG</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="adsistub_8c_source.html#l00055">msg</a>, <a class="el" href="res__odbc_8c_source.html#l00119">odbc_class::name</a>, <a class="el" href="res__odbc_8h_source.html#l00036">ODBC_SUCCESS</a>, <a class="el" href="res__odbc_8h_source.html#l00048">odbc_obj::parent</a>, and <a class="el" href="res__odbc_8h_source.html#l00056">odbc_obj::up</a>.</p>

<p>Referenced by <a class="el" href="res__odbc_8c_source.html#l00568">ast_odbc_direct_execute()</a>, <a class="el" href="res__odbc_8c_source.html#l00695">ast_odbc_sanity_check()</a>, <a class="el" href="res__odbc_8c_source.html#l01411">odbc_obj_connect()</a>, and <a class="el" href="res__odbc_8c_source.html#l00394">odbc_obj_destructor()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01375"></a>01375 {
<a name="l01376"></a>01376    <span class="keywordtype">int</span> res;
<a name="l01377"></a>01377    SQLINTEGER err;
<a name="l01378"></a>01378    <span class="keywordtype">short</span> <span class="keywordtype">int</span> mlen;
<a name="l01379"></a>01379    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#a0dee90db1d6eb30329bee1ae6cec036a">msg</a>[200], <a class="code" href="structstate.html">state</a>[10];
<a name="l01380"></a>01380 
<a name="l01381"></a>01381    <span class="comment">/* Nothing to disconnect */</span>
<a name="l01382"></a>01382    <span class="keywordflow">if</span> (!obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>) {
<a name="l01383"></a>01383       <span class="keywordflow">return</span> <a class="code" href="res__odbc_8h.html#a105a23abbc3dcfda7728a1a39987b3d6ac683a4e66b82f69b00b54e279697fa92">ODBC_SUCCESS</a>;
<a name="l01384"></a>01384    }
<a name="l01385"></a>01385 
<a name="l01386"></a>01386    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;obj-&gt;<a class="code" href="structodbc__obj.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01387"></a>01387 
<a name="l01388"></a>01388    res = SQLDisconnect(obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>);
<a name="l01389"></a>01389 
<a name="l01390"></a>01390    <span class="keywordflow">if</span> (obj-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a>) {
<a name="l01391"></a>01391       <span class="keywordflow">if</span> (res == SQL_SUCCESS || res == SQL_SUCCESS_WITH_INFO) {
<a name="l01392"></a>01392          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Disconnected %d from %s [%s]\n&quot;</span>, res, obj-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a>-&gt;<a class="code" href="structodbc__class.html#a3777dbae63a15da001b2baa317a25149">name</a>, obj-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a>-&gt;<a class="code" href="structodbc__class.html#a1524f0152ab56bd2841053338f22aa86">dsn</a>);
<a name="l01393"></a>01393       } <span class="keywordflow">else</span> {
<a name="l01394"></a>01394          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;res_odbc: %s [%s] already disconnected\n&quot;</span>, obj-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a>-&gt;<a class="code" href="structodbc__class.html#a3777dbae63a15da001b2baa317a25149">name</a>, obj-&gt;<a class="code" href="structodbc__obj.html#a2600ffe90b71935f45a9e36a6b5863c6">parent</a>-&gt;<a class="code" href="structodbc__class.html#a1524f0152ab56bd2841053338f22aa86">dsn</a>);
<a name="l01395"></a>01395       }
<a name="l01396"></a>01396    }
<a name="l01397"></a>01397 
<a name="l01398"></a>01398    <span class="keywordflow">if</span> ((res = SQLFreeHandle(SQL_HANDLE_DBC, obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>) == SQL_SUCCESS)) {
<a name="l01399"></a>01399       obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a> = NULL;
<a name="l01400"></a>01400       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Database handle deallocated\n&quot;</span>);
<a name="l01401"></a>01401    } <span class="keywordflow">else</span> {
<a name="l01402"></a>01402       SQLGetDiagRec(SQL_HANDLE_DBC, obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, 1, state, &amp;err, msg, 100, &amp;mlen);
<a name="l01403"></a>01403       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to deallocate database handle? %d errno=%d %s\n&quot;</span>, res, (<span class="keywordtype">int</span>)err, msg);
<a name="l01404"></a>01404    }
<a name="l01405"></a>01405 
<a name="l01406"></a>01406    obj-&gt;<a class="code" href="structodbc__obj.html#a8042aba89daa6448b14e94e6d0bb63bf">up</a> = 0;
<a name="l01407"></a>01407    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;obj-&gt;<a class="code" href="structodbc__obj.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01408"></a>01408    <span class="keywordflow">return</span> <a class="code" href="res__odbc_8h.html#a105a23abbc3dcfda7728a1a39987b3d6ac683a4e66b82f69b00b54e279697fa92">ODBC_SUCCESS</a>;
<a name="l01409"></a>01409 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a37d2ad3db8f19b56f61d47bfbf7b3dbe"></a><!-- doxytag: member="res_odbc.c::odbc_register_class" ref="a37d2ad3db8f19b56f61d47bfbf7b3dbe" args="(struct odbc_class *class, int connect)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int odbc_register_class </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structodbc__class.html">odbc_class</a> *&nbsp;</td>
          <td class="paramname"> <em>class</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>connect</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l00960">960</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00782">ao2_link</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="res__odbc_8c_source.html#l01041">ast_odbc_release_obj()</a>, <a class="el" href="res__odbc_8c_source.html#l01331">ast_odbc_request_obj()</a>, <a class="el" href="res__odbc_8c_source.html#l00136">class_container</a>, and <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>.</p>

<p>Referenced by <a class="el" href="res__odbc_8c_source.html#l00730">load_odbc_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00961"></a>00961 {
<a name="l00962"></a>00962    <span class="keyword">struct </span><a class="code" href="structodbc__obj.html" title="ODBC container.">odbc_obj</a> *obj;
<a name="l00963"></a>00963    <span class="keywordflow">if</span> (<span class="keyword">class</span>) {
<a name="l00964"></a>00964       <a class="code" href="astobj2_8h.html#a210544bdcc5afe0601d01d6e529c22d8">ao2_link</a>(<a class="code" href="res__odbc_8c.html#a9412fb74c274dc0c012fd7b4f5b6aa71">class_container</a>, <span class="keyword">class</span>);
<a name="l00965"></a>00965       <span class="comment">/* I still have a reference in the caller, so a deref is NOT missing here. */</span>
<a name="l00966"></a>00966 
<a name="l00967"></a>00967       <span class="keywordflow">if</span> (preconnect) {
<a name="l00968"></a>00968          <span class="comment">/* Request and release builds a connection */</span>
<a name="l00969"></a>00969          obj = <a class="code" href="res__odbc_8h.html#ad34ae2bdba165ef6c7405afc94f2a7f3">ast_odbc_request_obj</a>(class-&gt;<a class="code" href="structodbc__class.html#a3777dbae63a15da001b2baa317a25149">name</a>, 0);
<a name="l00970"></a>00970          <span class="keywordflow">if</span> (obj) {
<a name="l00971"></a>00971             <a class="code" href="res__odbc_8h.html#a78d14d1dd01c269c9c0a47b49475eeea" title="Releases an ODBC object previously allocated by odbc_request_obj().">ast_odbc_release_obj</a>(obj);
<a name="l00972"></a>00972          }
<a name="l00973"></a>00973       }
<a name="l00974"></a>00974 
<a name="l00975"></a>00975       <span class="keywordflow">return</span> 0;
<a name="l00976"></a>00976    } <span class="keywordflow">else</span> {
<a name="l00977"></a>00977       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Attempted to register a NULL class?\n&quot;</span>);
<a name="l00978"></a>00978       <span class="keywordflow">return</span> -1;
<a name="l00979"></a>00979    }
<a name="l00980"></a>00980 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0cb988b805f7ef81fa43f5d8096576d2"></a><!-- doxytag: member="res_odbc.c::odbc_release_obj2" ref="a0cb988b805f7ef81fa43f5d8096576d2" args="(struct odbc_obj *obj, struct odbc_txn_frame *tx)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void odbc_release_obj2 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structodbc__txn__frame.html">odbc_txn_frame</a> *&nbsp;</td>
          <td class="paramname"> <em>tx</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l00982">982</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="res__odbc_8h_source.html#l00047">odbc_obj::con</a>, <a class="el" href="res__odbc_8c_source.html#l00165">odbc_txn_frame::forcecommit</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="res__odbc_8c_source.html#l00156">odbc_txn_frame::obj</a>, <a class="el" href="res__odbc_8c_source.html#l00287">release_transaction()</a>, <a class="el" href="res__odbc_8h_source.html#l00058">odbc_obj::txf</a>, and <a class="el" href="res__odbc_8h_source.html#l00055">odbc_obj::used</a>.</p>

<p>Referenced by <a class="el" href="res__odbc_8c_source.html#l01041">ast_odbc_release_obj()</a>, and <a class="el" href="res__odbc_8c_source.html#l00287">release_transaction()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00983"></a>00983 {
<a name="l00984"></a>00984    SQLINTEGER nativeerror=0, numfields=0;
<a name="l00985"></a>00985    SQLSMALLINT diagbytes=0, i;
<a name="l00986"></a>00986    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structstate.html">state</a>[10], diagnostic[256];
<a name="l00987"></a>00987 
<a name="l00988"></a>00988    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;odbc_release_obj2(%p) called (obj-&gt;txf = %p)\n&quot;</span>, obj, obj-&gt;<a class="code" href="structodbc__obj.html#a3c30e5fedd5867e29dcc58b7abfe3c0d">txf</a>);
<a name="l00989"></a>00989    <span class="keywordflow">if</span> (tx) {
<a name="l00990"></a>00990       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;called on a transactional handle with %s\n&quot;</span>, tx-&gt;<a class="code" href="structodbc__txn__frame.html#addaad8ffa7ab4d6ad199b328ecfe234f">forcecommit</a> ? <span class="stringliteral">&quot;COMMIT&quot;</span> : <span class="stringliteral">&quot;ROLLBACK&quot;</span>);
<a name="l00991"></a>00991       <span class="keywordflow">if</span> (SQLEndTran(SQL_HANDLE_DBC, obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, tx-&gt;<a class="code" href="structodbc__txn__frame.html#addaad8ffa7ab4d6ad199b328ecfe234f">forcecommit</a> ? SQL_COMMIT : SQL_ROLLBACK) == SQL_ERROR) {
<a name="l00992"></a>00992          <span class="comment">/* Handle possible transaction commit failure */</span>
<a name="l00993"></a>00993          SQLGetDiagField(SQL_HANDLE_DBC, obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, 1, SQL_DIAG_NUMBER, &amp;numfields, SQL_IS_INTEGER, &amp;diagbytes);
<a name="l00994"></a>00994          <span class="keywordflow">for</span> (i = 0; i &lt; numfields; i++) {
<a name="l00995"></a>00995             SQLGetDiagRec(SQL_HANDLE_DBC, obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, i + 1, state, &amp;nativeerror, diagnostic, <span class="keyword">sizeof</span>(diagnostic), &amp;diagbytes);
<a name="l00996"></a>00996             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SQLEndTran returned an error: %s: %s\n&quot;</span>, state, diagnostic);
<a name="l00997"></a>00997             <span class="keywordflow">if</span> (!strcmp((<span class="keywordtype">char</span> *)state, <span class="stringliteral">&quot;25S02&quot;</span>) || !strcmp((<span class="keywordtype">char</span> *)state, <span class="stringliteral">&quot;08007&quot;</span>)) {
<a name="l00998"></a>00998                <span class="comment">/* These codes mean that a commit failed and a transaction</span>
<a name="l00999"></a>00999 <span class="comment">                * is still active. We must rollback, or things will get</span>
<a name="l01000"></a>01000 <span class="comment">                * very, very weird for anybody using the handle next. */</span>
<a name="l01001"></a>01001                SQLEndTran(SQL_HANDLE_DBC, obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, SQL_ROLLBACK);
<a name="l01002"></a>01002             }
<a name="l01003"></a>01003             <span class="keywordflow">if</span> (i &gt; 10) {
<a name="l01004"></a>01004                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Oh, that was good.  There are really %d diagnostics?\n&quot;</span>, (<span class="keywordtype">int</span>)numfields);
<a name="l01005"></a>01005                <span class="keywordflow">break</span>;
<a name="l01006"></a>01006             }
<a name="l01007"></a>01007          }
<a name="l01008"></a>01008       }
<a name="l01009"></a>01009 
<a name="l01010"></a>01010       <span class="comment">/* Transaction is done, reset autocommit */</span>
<a name="l01011"></a>01011       <span class="keywordflow">if</span> (SQLSetConnectAttr(obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, SQL_ATTR_AUTOCOMMIT, (<span class="keywordtype">void</span> *)SQL_AUTOCOMMIT_ON, 0) == SQL_ERROR) {
<a name="l01012"></a>01012          SQLGetDiagField(SQL_HANDLE_DBC, obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, 1, SQL_DIAG_NUMBER, &amp;numfields, SQL_IS_INTEGER, &amp;diagbytes);
<a name="l01013"></a>01013          <span class="keywordflow">for</span> (i = 0; i &lt; numfields; i++) {
<a name="l01014"></a>01014             SQLGetDiagRec(SQL_HANDLE_DBC, obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, i + 1, state, &amp;nativeerror, diagnostic, <span class="keyword">sizeof</span>(diagnostic), &amp;diagbytes);
<a name="l01015"></a>01015             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SetConnectAttr (Autocommit) returned an error: %s: %s\n&quot;</span>, state, diagnostic);
<a name="l01016"></a>01016             <span class="keywordflow">if</span> (i &gt; 10) {
<a name="l01017"></a>01017                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Oh, that was good.  There are really %d diagnostics?\n&quot;</span>, (<span class="keywordtype">int</span>)numfields);
<a name="l01018"></a>01018                <span class="keywordflow">break</span>;
<a name="l01019"></a>01019             }
<a name="l01020"></a>01020          }
<a name="l01021"></a>01021       }
<a name="l01022"></a>01022    }
<a name="l01023"></a>01023 
<a name="l01024"></a>01024 <span class="preprocessor">#ifdef DEBUG_THREADS</span>
<a name="l01025"></a>01025 <span class="preprocessor"></span>   obj-&gt;file[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01026"></a>01026    obj-&gt;function[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01027"></a>01027    obj-&gt;lineno = 0;
<a name="l01028"></a>01028 <span class="preprocessor">#endif</span>
<a name="l01029"></a>01029 <span class="preprocessor"></span>
<a name="l01030"></a>01030    <span class="comment">/* For pooled connections, this frees the connection to be</span>
<a name="l01031"></a>01031 <span class="comment">    * reused.  For non-pooled connections, it does nothing. */</span>
<a name="l01032"></a>01032    obj-&gt;<a class="code" href="structodbc__obj.html#a2590a5f33b83235fcf8740d3bb9b0e98">used</a> = 0;
<a name="l01033"></a>01033    <span class="keywordflow">if</span> (obj-&gt;<a class="code" href="structodbc__obj.html#a3c30e5fedd5867e29dcc58b7abfe3c0d">txf</a>) {
<a name="l01034"></a>01034       <span class="comment">/* Prevent recursion -- transaction is already closed out. */</span>
<a name="l01035"></a>01035       obj-&gt;<a class="code" href="structodbc__obj.html#a3c30e5fedd5867e29dcc58b7abfe3c0d">txf</a>-&gt;<a class="code" href="structodbc__txn__frame.html#ab5dd16c9db5f2ee0f0d6354952c92189">obj</a> = NULL;
<a name="l01036"></a>01036       obj-&gt;<a class="code" href="structodbc__obj.html#a3c30e5fedd5867e29dcc58b7abfe3c0d">txf</a> = <a class="code" href="res__odbc_8c.html#a256f41c7de2821db8c2913ee5b720ec2">release_transaction</a>(obj-&gt;<a class="code" href="structodbc__obj.html#a3c30e5fedd5867e29dcc58b7abfe3c0d">txf</a>);
<a name="l01037"></a>01037    }
<a name="l01038"></a>01038    <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(obj, -1);
<a name="l01039"></a>01039 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9b1c173ec21f662bf76dc0f4f848f9a8"></a><!-- doxytag: member="res_odbc.c::odbc_txn_free" ref="a9b1c173ec21f662bf76dc0f4f848f9a8" args="(void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void odbc_txn_free </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l00323">323</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="linkedlists_8h_source.html#l00172">AST_LIST_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00637">AST_LIST_HEAD_DESTROY</a>, <a class="el" href="linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00817">AST_LIST_REMOVE_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="structodbc__class.html#a033c9e1d6a001b7c5dc1a71ab21d0357">odbc_class::list</a>, and <a class="el" href="res__odbc_8c_source.html#l00287">release_transaction()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00324"></a>00324 {
<a name="l00325"></a>00325    <span class="keyword">struct </span><a class="code" href="structodbc__txn__frame.html">odbc_txn_frame</a> *tx;
<a name="l00326"></a>00326    <a class="code" href="linkedlists_8h.html#acdb4f56da6b3071d02dcce20072852b0" title="Defines a structure to be used to hold a list of specified type.">AST_LIST_HEAD</a>(, <a class="code" href="structodbc__txn__frame.html">odbc_txn_frame</a>) *oldlist = vdata;
<a name="l00327"></a>00327 
<a name="l00328"></a>00328    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;odbc_txn_free(%p) called\n&quot;</span>, vdata);
<a name="l00329"></a>00329 
<a name="l00330"></a>00330    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(oldlist);
<a name="l00331"></a>00331    <span class="keywordflow">while</span> ((tx = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(oldlist, <a class="code" href="structodbc__txn__frame.html#a6715fc7084c4f5b7aa8ed33db42c33b5">list</a>))) {
<a name="l00332"></a>00332       <a class="code" href="res__odbc_8c.html#a256f41c7de2821db8c2913ee5b720ec2">release_transaction</a>(tx);
<a name="l00333"></a>00333    }
<a name="l00334"></a>00334    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(oldlist);
<a name="l00335"></a>00335    <a class="code" href="linkedlists_8h.html#a47bafe663a14b91827082787d7654d7c" title="Destroys a list head structure.">AST_LIST_HEAD_DESTROY</a>(oldlist);
<a name="l00336"></a>00336    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(oldlist);
<a name="l00337"></a>00337 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a256f41c7de2821db8c2913ee5b720ec2"></a><!-- doxytag: member="res_odbc.c::release_transaction" ref="a256f41c7de2821db8c2913ee5b720ec2" args="(struct odbc_txn_frame *tx)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structodbc__txn__frame.html">odbc_txn_frame</a>* release_transaction </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structodbc__txn__frame.html">odbc_txn_frame</a> *&nbsp;</td>
          <td class="paramname"> <em>tx</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l00287">287</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l01548">ast_channel_datastore_find()</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="linkedlists_8h_source.html#l00172">AST_LIST_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00838">AST_LIST_REMOVE</a>, <a class="el" href="linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="datastore_8h_source.html#l00056">ast_datastore::data</a>, <a class="el" href="structodbc__class.html#a033c9e1d6a001b7c5dc1a71ab21d0357">odbc_class::list</a>, <a class="el" href="res__odbc_8c_source.html#l00156">odbc_txn_frame::obj</a>, <a class="el" href="res__odbc_8c_source.html#l00982">odbc_release_obj2()</a>, <a class="el" href="res__odbc_8c_source.html#l00155">odbc_txn_frame::owner</a>, <a class="el" href="res__odbc_8h_source.html#l00058">odbc_obj::txf</a>, and <a class="el" href="res__odbc_8c_source.html#l00148">txn_info</a>.</p>

<p>Referenced by <a class="el" href="res__odbc_8c_source.html#l00982">odbc_release_obj2()</a>, and <a class="el" href="res__odbc_8c_source.html#l00323">odbc_txn_free()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00288"></a>00288 {
<a name="l00289"></a>00289    <span class="keywordflow">if</span> (!tx) {
<a name="l00290"></a>00290       <span class="keywordflow">return</span> NULL;
<a name="l00291"></a>00291    }
<a name="l00292"></a>00292 
<a name="l00293"></a>00293    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;release_transaction(%p) called (tx-&gt;obj = %p, tx-&gt;obj-&gt;txf = %p)\n&quot;</span>, tx, tx-&gt;<a class="code" href="structodbc__txn__frame.html#ab5dd16c9db5f2ee0f0d6354952c92189">obj</a>, tx-&gt;<a class="code" href="structodbc__txn__frame.html#ab5dd16c9db5f2ee0f0d6354952c92189">obj</a> ? tx-&gt;<a class="code" href="structodbc__txn__frame.html#ab5dd16c9db5f2ee0f0d6354952c92189">obj</a>-&gt;<a class="code" href="structodbc__obj.html#a3c30e5fedd5867e29dcc58b7abfe3c0d">txf</a> : NULL);
<a name="l00294"></a>00294 
<a name="l00295"></a>00295    <span class="comment">/* If we have an owner, disassociate */</span>
<a name="l00296"></a>00296    <span class="keywordflow">if</span> (tx-&gt;<a class="code" href="structodbc__txn__frame.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l00297"></a>00297       <span class="keyword">struct </span><a class="code" href="structast__datastore.html" title="Structure for a data store object.">ast_datastore</a> *txn_store;
<a name="l00298"></a>00298       <a class="code" href="linkedlists_8h.html#acdb4f56da6b3071d02dcce20072852b0" title="Defines a structure to be used to hold a list of specified type.">AST_LIST_HEAD</a>(, <a class="code" href="structodbc__txn__frame.html">odbc_txn_frame</a>) *oldlist;
<a name="l00299"></a>00299 
<a name="l00300"></a>00300       <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(tx-&gt;<a class="code" href="structodbc__txn__frame.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l00301"></a>00301       <span class="keywordflow">if</span> ((txn_store = <a class="code" href="channel_8h.html#aad1e09cd7c79237d05cffb45d6cdfd7c" title="Find a datastore on a channel.">ast_channel_datastore_find</a>(tx-&gt;<a class="code" href="structodbc__txn__frame.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, &amp;<a class="code" href="res__odbc_8c.html#a39d901a085de05b4b891f3643347316a">txn_info</a>, NULL))) {
<a name="l00302"></a>00302          oldlist = txn_store-&gt;<a class="code" href="structast__datastore.html#a735984d41155bc1032e09bece8f8d66d">data</a>;
<a name="l00303"></a>00303          <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(oldlist);
<a name="l00304"></a>00304          <a class="code" href="linkedlists_8h.html#aa36e72b77f1b80881cd0a9fcca66ce19" title="Removes a specific entry from a list.">AST_LIST_REMOVE</a>(oldlist, tx, list);
<a name="l00305"></a>00305          <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(oldlist);
<a name="l00306"></a>00306       }
<a name="l00307"></a>00307       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(tx-&gt;<a class="code" href="structodbc__txn__frame.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l00308"></a>00308       tx-&gt;<a class="code" href="structodbc__txn__frame.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = NULL;
<a name="l00309"></a>00309    }
<a name="l00310"></a>00310 
<a name="l00311"></a>00311    <span class="keywordflow">if</span> (tx-&gt;<a class="code" href="structodbc__txn__frame.html#ab5dd16c9db5f2ee0f0d6354952c92189">obj</a>) {
<a name="l00312"></a>00312       <span class="comment">/* If we have any uncommitted transactions, they are handled when we release the object */</span>
<a name="l00313"></a>00313       <span class="keyword">struct </span><a class="code" href="structodbc__obj.html" title="ODBC container.">odbc_obj</a> *obj = tx-&gt;<a class="code" href="structodbc__txn__frame.html#ab5dd16c9db5f2ee0f0d6354952c92189">obj</a>;
<a name="l00314"></a>00314       <span class="comment">/* Prevent recursion during destruction */</span>
<a name="l00315"></a>00315       tx-&gt;<a class="code" href="structodbc__txn__frame.html#ab5dd16c9db5f2ee0f0d6354952c92189">obj</a>-&gt;<a class="code" href="structodbc__obj.html#a3c30e5fedd5867e29dcc58b7abfe3c0d">txf</a> = NULL;
<a name="l00316"></a>00316       tx-&gt;<a class="code" href="structodbc__txn__frame.html#ab5dd16c9db5f2ee0f0d6354952c92189">obj</a> = NULL;
<a name="l00317"></a>00317       <a class="code" href="res__odbc_8c.html#a0cb988b805f7ef81fa43f5d8096576d2">odbc_release_obj2</a>(obj, tx);
<a name="l00318"></a>00318    }
<a name="l00319"></a>00319    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(tx);
<a name="l00320"></a>00320    <span class="keywordflow">return</span> NULL;
<a name="l00321"></a>00321 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad1982509765f4870f1f63412a53ea668"></a><!-- doxytag: member="res_odbc.c::reload" ref="ad1982509765f4870f1f63412a53ea668" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int reload </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l01604">1604</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="astobj2_8c_source.html#l00795">ao2_iterator_destroy()</a>, <a class="el" href="astobj2_8c_source.html#l00780">ao2_iterator_init()</a>, <a class="el" href="astobj2_8h_source.html#l01120">ao2_iterator_next</a>, <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>, <a class="el" href="astobj2_8h_source.html#l00813">ao2_unlink</a>, <a class="el" href="linkedlists_8h_source.html#l00828">AST_RWLIST_REMOVE_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="res__odbc_8c_source.html#l00136">class_container</a>, <a class="el" href="res__odbc_8c_source.html#l00404">destroy_table_cache()</a>, <a class="el" href="structodbc__class.html#a033c9e1d6a001b7c5dc1a71ab21d0357">odbc_class::list</a>, <a class="el" href="res__odbc_8c_source.html#l00730">load_odbc_config()</a>, and <a class="el" href="cdr__odbc_8c_source.html#l00052">table</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01605"></a>01605 {
<a name="l01606"></a>01606    <span class="keyword">struct </span><a class="code" href="structodbc__cache__tables.html">odbc_cache_tables</a> *<a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>;
<a name="l01607"></a>01607    <span class="keyword">struct </span><a class="code" href="structodbc__class.html">odbc_class</a> *<span class="keyword">class</span>;
<a name="l01608"></a>01608    <span class="keyword">struct </span><a class="code" href="structodbc__obj.html" title="ODBC container.">odbc_obj</a> *current;
<a name="l01609"></a>01609    <span class="keyword">struct </span><a class="code" href="structao2__iterator.html" title="When we need to walk through a container, we use an ao2_iterator to keep track of...">ao2_iterator</a> aoi = <a class="code" href="astobj2_8h.html#a288075de687152d297308ea1ea963edb" title="Create an iterator for a container.">ao2_iterator_init</a>(<a class="code" href="res__odbc_8c.html#a9412fb74c274dc0c012fd7b4f5b6aa71">class_container</a>, 0);
<a name="l01610"></a>01610 
<a name="l01611"></a>01611    <span class="comment">/* First, mark all to be purged */</span>
<a name="l01612"></a>01612    <span class="keywordflow">while</span> ((<span class="keyword">class</span> = <a class="code" href="astobj2_8h.html#a1cf2fe1aafd3cb9e613eb48535a37ad5">ao2_iterator_next</a>(&amp;aoi))) {
<a name="l01613"></a>01613       <span class="keyword">class</span>-&gt;delme = 1;
<a name="l01614"></a>01614       <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<span class="keyword">class</span>, -1);
<a name="l01615"></a>01615    }
<a name="l01616"></a>01616    <a class="code" href="astobj2_8h.html#a62d5d9e9d0fa281168e6a08ef4a52450" title="Destroy a container iterator.">ao2_iterator_destroy</a>(&amp;aoi);
<a name="l01617"></a>01617 
<a name="l01618"></a>01618    <a class="code" href="res__odbc_8c.html#a36bab917a61d04ba199008e31caf13b0">load_odbc_config</a>();
<a name="l01619"></a>01619 
<a name="l01620"></a>01620    <span class="comment">/* Purge remaining classes */</span>
<a name="l01621"></a>01621 
<a name="l01622"></a>01622    <span class="comment">/* Note on how this works; this is a case of circular references, so we</span>
<a name="l01623"></a>01623 <span class="comment">    * explicitly do NOT want to use a callback here (or we wind up in</span>
<a name="l01624"></a>01624 <span class="comment">    * recursive hell).</span>
<a name="l01625"></a>01625 <span class="comment">    *</span>
<a name="l01626"></a>01626 <span class="comment">    * 1. Iterate through all the classes.  Note that the classes will currently</span>
<a name="l01627"></a>01627 <span class="comment">    * contain two classes of the same name, one of which is marked delme and</span>
<a name="l01628"></a>01628 <span class="comment">    * will be purged when all remaining objects of the class are released, and</span>
<a name="l01629"></a>01629 <span class="comment">    * the other, which was created above when we re-parsed the config file.</span>
<a name="l01630"></a>01630 <span class="comment">    * 2. On each class, there is a reference held by the master container and</span>
<a name="l01631"></a>01631 <span class="comment">    * a reference held by each connection object.  There are two cases for</span>
<a name="l01632"></a>01632 <span class="comment">    * destruction of the class, noted below.  However, in all cases, all O-refs</span>
<a name="l01633"></a>01633 <span class="comment">    * (references to objects) will first be freed, which will cause the C-refs</span>
<a name="l01634"></a>01634 <span class="comment">    * (references to classes) to be decremented (but never to 0, because the</span>
<a name="l01635"></a>01635 <span class="comment">    * class container still has a reference).</span>
<a name="l01636"></a>01636 <span class="comment">    *    a) If the class has outstanding objects, the C-ref by the class</span>
<a name="l01637"></a>01637 <span class="comment">    *    container will then be freed, which leaves only C-refs by any</span>
<a name="l01638"></a>01638 <span class="comment">    *    outstanding objects.  When the final outstanding object is released</span>
<a name="l01639"></a>01639 <span class="comment">    *    (O-refs held by applications and dialplan functions), it will in turn</span>
<a name="l01640"></a>01640 <span class="comment">    *    free the final C-ref, causing class destruction.</span>
<a name="l01641"></a>01641 <span class="comment">    *    b) If the class has no outstanding objects, when the class container</span>
<a name="l01642"></a>01642 <span class="comment">    *    removes the final C-ref, the class will be destroyed.</span>
<a name="l01643"></a>01643 <span class="comment">    */</span>
<a name="l01644"></a>01644    aoi = <a class="code" href="astobj2_8h.html#a288075de687152d297308ea1ea963edb" title="Create an iterator for a container.">ao2_iterator_init</a>(<a class="code" href="res__odbc_8c.html#a9412fb74c274dc0c012fd7b4f5b6aa71">class_container</a>, 0);
<a name="l01645"></a>01645    <span class="keywordflow">while</span> ((<span class="keyword">class</span> = <a class="code" href="astobj2_8h.html#a1cf2fe1aafd3cb9e613eb48535a37ad5">ao2_iterator_next</a>(&amp;aoi))) { <span class="comment">/* C-ref++ (by iterator) */</span>
<a name="l01646"></a>01646       <span class="keywordflow">if</span> (class-&gt;delme) {
<a name="l01647"></a>01647          <span class="keyword">struct </span><a class="code" href="structao2__iterator.html" title="When we need to walk through a container, we use an ao2_iterator to keep track of...">ao2_iterator</a> aoi2 = <a class="code" href="astobj2_8h.html#a288075de687152d297308ea1ea963edb" title="Create an iterator for a container.">ao2_iterator_init</a>(class-&gt;obj_container, 0);
<a name="l01648"></a>01648          <span class="keywordflow">while</span> ((current = <a class="code" href="astobj2_8h.html#a1cf2fe1aafd3cb9e613eb48535a37ad5">ao2_iterator_next</a>(&amp;aoi2))) { <span class="comment">/* O-ref++ (by iterator) */</span>
<a name="l01649"></a>01649             <a class="code" href="astobj2_8h.html#a1bd301bcff8b41c07adbecf93eb7dce7">ao2_unlink</a>(class-&gt;obj_container, current); <span class="comment">/* unlink O-ref from class (reference handled implicitly) */</span>
<a name="l01650"></a>01650             <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(current, -1); <span class="comment">/* O-ref-- (by iterator) */</span>
<a name="l01651"></a>01651             <span class="comment">/* At this point, either</span>
<a name="l01652"></a>01652 <span class="comment">             * a) there&apos;s an outstanding O-ref, or</span>
<a name="l01653"></a>01653 <span class="comment">             * b) the object has already been destroyed.</span>
<a name="l01654"></a>01654 <span class="comment">             */</span>
<a name="l01655"></a>01655          }
<a name="l01656"></a>01656          <a class="code" href="astobj2_8h.html#a62d5d9e9d0fa281168e6a08ef4a52450" title="Destroy a container iterator.">ao2_iterator_destroy</a>(&amp;aoi2);
<a name="l01657"></a>01657          <a class="code" href="astobj2_8h.html#a1bd301bcff8b41c07adbecf93eb7dce7">ao2_unlink</a>(<a class="code" href="res__odbc_8c.html#a9412fb74c274dc0c012fd7b4f5b6aa71">class_container</a>, <span class="keyword">class</span>); <span class="comment">/* unlink C-ref from container (reference handled implicitly) */</span>
<a name="l01658"></a>01658          <span class="comment">/* At this point, either</span>
<a name="l01659"></a>01659 <span class="comment">          * a) there&apos;s an outstanding O-ref, which holds an outstanding C-ref, or</span>
<a name="l01660"></a>01660 <span class="comment">          * b) the last remaining C-ref is held by the iterator, which will be</span>
<a name="l01661"></a>01661 <span class="comment">          * destroyed in the next step.</span>
<a name="l01662"></a>01662 <span class="comment">          */</span>
<a name="l01663"></a>01663       }
<a name="l01664"></a>01664       <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<span class="keyword">class</span>, -1); <span class="comment">/* C-ref-- (by iterator) */</span>
<a name="l01665"></a>01665    }
<a name="l01666"></a>01666    <a class="code" href="astobj2_8h.html#a62d5d9e9d0fa281168e6a08ef4a52450" title="Destroy a container iterator.">ao2_iterator_destroy</a>(&amp;aoi);
<a name="l01667"></a>01667 
<a name="l01668"></a>01668    <span class="comment">/* Empty the cache; it will get rebuilt the next time the tables are needed. */</span>
<a name="l01669"></a>01669    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structodbc__tables.html">odbc_tables</a>);
<a name="l01670"></a>01670    <span class="keywordflow">while</span> ((table = <a class="code" href="linkedlists_8h.html#a3d3aa4fb3b4ba38ad8d6d255d97e037c">AST_RWLIST_REMOVE_HEAD</a>(&amp;<a class="code" href="structodbc__tables.html">odbc_tables</a>, list))) {
<a name="l01671"></a>01671       <a class="code" href="res__odbc_8c.html#a9f262bdbb941597f050a0eacbf518d51">destroy_table_cache</a>(table);
<a name="l01672"></a>01672    }
<a name="l01673"></a>01673    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structodbc__tables.html">odbc_tables</a>);
<a name="l01674"></a>01674 
<a name="l01675"></a>01675    <span class="keywordflow">return</span> 0;
<a name="l01676"></a>01676 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae348b1f7286504f427377ac2f34a5207"></a><!-- doxytag: member="res_odbc.c::rollback_exec" ref="ae348b1f7286504f427377ac2f34a5207" args="(struct ast_channel *chan, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int rollback_exec </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l01089">1089</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="strings_8h_source.html#l00846">ast_str_append()</a>, <a class="el" href="strings_8h_source.html#l00488">ast_str_buffer()</a>, <a class="el" href="strings_8h_source.html#l00431">ast_str_reset()</a>, <a class="el" href="strings_8h_source.html#l00466">ast_str_strlen()</a>, <a class="el" href="strings_8h_source.html#l00637">ast_str_thread_get()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="res__odbc_8h_source.html#l00047">odbc_obj::con</a>, <a class="el" href="res__odbc_8c_source.html#l00146">errors_buf</a>, <a class="el" href="res__odbc_8c_source.html#l00204">find_transaction()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="res__odbc_8c_source.html#l00156">odbc_txn_frame::obj</a>, and <a class="el" href="pbx_8c_source.html#l09023">pbx_builtin_setvar_helper()</a>.</p>

<p>Referenced by <a class="el" href="res__odbc_8c_source.html#l01684">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01090"></a>01090 {
<a name="l01091"></a>01091    <span class="keyword">struct </span><a class="code" href="structodbc__txn__frame.html">odbc_txn_frame</a> *tx;
<a name="l01092"></a>01092    SQLINTEGER nativeerror=0, numfields=0;
<a name="l01093"></a>01093    SQLSMALLINT diagbytes=0, i;
<a name="l01094"></a>01094    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structstate.html">state</a>[10], diagnostic[256];
<a name="l01095"></a>01095 
<a name="l01096"></a>01096    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(data)) {
<a name="l01097"></a>01097       tx = <a class="code" href="res__odbc_8c.html#a00e68e8fd24bd80b6fd5f4af94e1b993">find_transaction</a>(chan, NULL, NULL, 1);
<a name="l01098"></a>01098    } <span class="keywordflow">else</span> {
<a name="l01099"></a>01099       tx = <a class="code" href="res__odbc_8c.html#a00e68e8fd24bd80b6fd5f4af94e1b993">find_transaction</a>(chan, NULL, data, 0);
<a name="l01100"></a>01100    }
<a name="l01101"></a>01101 
<a name="l01102"></a>01102    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;ROLLBACK_RESULT&quot;</span>, <span class="stringliteral">&quot;OK&quot;</span>);
<a name="l01103"></a>01103 
<a name="l01104"></a>01104    <span class="keywordflow">if</span> (tx) {
<a name="l01105"></a>01105       <span class="keywordflow">if</span> (SQLEndTran(SQL_HANDLE_DBC, tx-&gt;<a class="code" href="structodbc__txn__frame.html#ab5dd16c9db5f2ee0f0d6354952c92189">obj</a>-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, SQL_ROLLBACK) == SQL_ERROR) {
<a name="l01106"></a>01106          <span class="keyword">struct </span><a class="code" href="structast__str.html" title="The descriptor of a dynamic string XXX storage will be optimized later if needed...">ast_str</a> *errors = <a class="code" href="strings_8h.html#affe8ca3cf8ee9ab07fe29d11bc824ac4" title="Retrieve a thread locally stored dynamic string.">ast_str_thread_get</a>(&amp;<a class="code" href="res__odbc_8c.html#a12c713dc409f1b0d877c59abf81a9a00">errors_buf</a>, 16);
<a name="l01107"></a>01107          <a class="code" href="strings_8h.html#a7820deea616cbb2e28f16d518de91c80" title="Reset the content of a dynamic string. Useful before a series of ast_str_append.">ast_str_reset</a>(errors);
<a name="l01108"></a>01108 
<a name="l01109"></a>01109          <span class="comment">/* Handle possible transaction commit failure */</span>
<a name="l01110"></a>01110          SQLGetDiagField(SQL_HANDLE_DBC, tx-&gt;<a class="code" href="structodbc__txn__frame.html#ab5dd16c9db5f2ee0f0d6354952c92189">obj</a>-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, 1, SQL_DIAG_NUMBER, &amp;numfields, SQL_IS_INTEGER, &amp;diagbytes);
<a name="l01111"></a>01111          <span class="keywordflow">for</span> (i = 0; i &lt; numfields; i++) {
<a name="l01112"></a>01112             SQLGetDiagRec(SQL_HANDLE_DBC, tx-&gt;<a class="code" href="structodbc__txn__frame.html#ab5dd16c9db5f2ee0f0d6354952c92189">obj</a>-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, i + 1, state, &amp;nativeerror, diagnostic, <span class="keyword">sizeof</span>(diagnostic), &amp;diagbytes);
<a name="l01113"></a>01113             <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(&amp;errors, 0, <span class="stringliteral">&quot;%s%s&quot;</span>, <a class="code" href="strings_8h.html#a99409c17a1d20e1c3dc00039b7925a2d" title="Returns the current length of the string stored within buf.">ast_str_strlen</a>(errors) ? <span class="stringliteral">&quot;,&quot;</span> : <span class="stringliteral">&quot;&quot;</span>, state);
<a name="l01114"></a>01114             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SQLEndTran returned an error: %s: %s\n&quot;</span>, state, diagnostic);
<a name="l01115"></a>01115             <span class="keywordflow">if</span> (i &gt; 10) {
<a name="l01116"></a>01116                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Oh, that was good.  There are really %d diagnostics?\n&quot;</span>, (<span class="keywordtype">int</span>)numfields);
<a name="l01117"></a>01117                <span class="keywordflow">break</span>;
<a name="l01118"></a>01118             }
<a name="l01119"></a>01119          }
<a name="l01120"></a>01120          <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;ROLLBACK_RESULT&quot;</span>, <a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(errors));
<a name="l01121"></a>01121       }
<a name="l01122"></a>01122    }
<a name="l01123"></a>01123    <span class="keywordflow">return</span> 0;
<a name="l01124"></a>01124 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a55a59530704f7603d65dcfff89e54e1f"></a><!-- doxytag: member="res_odbc.c::text2isolation" ref="a55a59530704f7603d65dcfff89e54e1f" args="(const char *txt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int text2isolation </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>txt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l00185">185</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>Referenced by <a class="el" href="res__odbc_8c_source.html#l01502">acf_transaction_write()</a>, and <a class="el" href="res__odbc_8c_source.html#l00730">load_odbc_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00186"></a>00186 {
<a name="l00187"></a>00187    <span class="keywordflow">if</span> (strncasecmp(txt, <span class="stringliteral">&quot;read_&quot;</span>, 5) == 0) {
<a name="l00188"></a>00188       <span class="keywordflow">if</span> (strncasecmp(txt + 5, <span class="stringliteral">&quot;c&quot;</span>, 1) == 0) {
<a name="l00189"></a>00189          <span class="keywordflow">return</span> SQL_TXN_READ_COMMITTED;
<a name="l00190"></a>00190       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncasecmp(txt + 5, <span class="stringliteral">&quot;u&quot;</span>, 1) == 0) {
<a name="l00191"></a>00191          <span class="keywordflow">return</span> SQL_TXN_READ_UNCOMMITTED;
<a name="l00192"></a>00192       } <span class="keywordflow">else</span> {
<a name="l00193"></a>00193          <span class="keywordflow">return</span> 0;
<a name="l00194"></a>00194       }
<a name="l00195"></a>00195    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncasecmp(txt, <span class="stringliteral">&quot;ser&quot;</span>, 3) == 0) {
<a name="l00196"></a>00196       <span class="keywordflow">return</span> SQL_TXN_SERIALIZABLE;
<a name="l00197"></a>00197    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncasecmp(txt, <span class="stringliteral">&quot;rep&quot;</span>, 3) == 0) {
<a name="l00198"></a>00198       <span class="keywordflow">return</span> SQL_TXN_REPEATABLE_READ;
<a name="l00199"></a>00199    } <span class="keywordflow">else</span> {
<a name="l00200"></a>00200       <span class="keywordflow">return</span> 0;
<a name="l00201"></a>00201    }
<a name="l00202"></a>00202 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad09fa931f468002152a3cc2d5ce25eae"></a><!-- doxytag: member="res_odbc.c::unload_module" ref="ad09fa931f468002152a3cc2d5ce25eae" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int unload_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l01678">1678</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01679"></a>01679 {
<a name="l01680"></a>01680    <span class="comment">/* Prohibit unloading */</span>
<a name="l01681"></a>01681    <span class="keywordflow">return</span> -1;
<a name="l01682"></a>01682 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ab22f32016155f7f403e7178767163d7d"></a><!-- doxytag: member="res_odbc.c::__mod_info" ref="ab22f32016155f7f403e7178767163d7d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__module__info.html">ast_module_info</a> <a class="el" href="res__timing__timerfd_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a> = { .<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = AST_MODULE, .flags = AST_MODFLAG_GLOBAL_SYMBOLS , .<a class="el" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a> = &quot;ODBC resource&quot; , .key = &quot;This paragraph is copyright (c) 2006 by Digium, Inc. \In order for your module to load, it must return this \key via a function called \&quot;key\&quot;. Any code which \includes this paragraph must be licensed under the GNU \General Public License <a class="el" href="res__config__pgsql_8c.html#aad880fc4455c253781e8968f2239d56f">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = &quot;aefddfaffd51bc118c14a748e96eb9a0&quot; , .load = load_module, .unload = unload_module, .reload = reload, }<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l01702">1702</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad10e6ff5ddbbabf4740767dce0436391"></a><!-- doxytag: member="res_odbc.c::app_commit" ref="ad10e6ff5ddbbabf4740767dce0436391" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="res__odbc_8c.html#ad10e6ff5ddbbabf4740767dce0436391">app_commit</a> = &quot;ODBC_Commit&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l01601">1601</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>Referenced by <a class="el" href="res__odbc_8c_source.html#l01684">load_module()</a>.</p>

</div>
</div>
<a class="anchor" id="a337085be7d10d0e93fddb07541942225"></a><!-- doxytag: member="res_odbc.c::app_rollback" ref="a337085be7d10d0e93fddb07541942225" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="res__odbc_8c.html#a337085be7d10d0e93fddb07541942225">app_rollback</a> = &quot;ODBC_Rollback&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l01602">1602</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>Referenced by <a class="el" href="res__odbc_8c_source.html#l01684">load_module()</a>.</p>

</div>
</div>
<a class="anchor" id="ae25b9f3970870610911f8850897e8ead"></a><!-- doxytag: member="res_odbc.c::ast_module_info" ref="ae25b9f3970870610911f8850897e8ead" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__module__info.html">ast_module_info</a>* <a class="el" href="structast__module__info.html">ast_module_info</a> = &amp;<a class="el" href="res__timing__timerfd_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l01702">1702</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9412fb74c274dc0c012fd7b4f5b6aa71"></a><!-- doxytag: member="res_odbc.c::class_container" ref="a9412fb74c274dc0c012fd7b4f5b6aa71" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structao2__container.html">ao2_container</a>* <a class="el" href="res__odbc_8c.html#a9412fb74c274dc0c012fd7b4f5b6aa71">class_container</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l00136">136</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>Referenced by <a class="el" href="res__odbc_8c_source.html#l01156">ast_odbc_request_obj2()</a>, <a class="el" href="res__odbc_8c_source.html#l00871">handle_cli_odbc_show()</a>, <a class="el" href="res__odbc_8c_source.html#l01684">load_module()</a>, <a class="el" href="res__odbc_8c_source.html#l00960">odbc_register_class()</a>, and <a class="el" href="res__odbc_8c_source.html#l01604">reload()</a>.</p>

</div>
</div>
<a class="anchor" id="a16471fdb7e5070f8c0e991360e80ad6a"></a><!-- doxytag: member="res_odbc.c::cli_odbc" ref="a16471fdb7e5070f8c0e991360e80ad6a" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> <a class="el" href="res__odbc_8c.html#a16471fdb7e5070f8c0e991360e80ad6a">cli_odbc</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
   <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="res__odbc_8c.html#a80e54e9debaeb3cd948b18b9c425cf4b">handle_cli_odbc_show</a>, <span class="stringliteral">&quot;List ODBC DSN(s)&quot;</span>)
}
</pre></div>
<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l00956">956</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>Referenced by <a class="el" href="res__odbc_8c_source.html#l01684">load_module()</a>.</p>

</div>
</div>
<a class="anchor" id="a12c713dc409f1b0d877c59abf81a9a00"></a><!-- doxytag: member="res_odbc.c::errors_buf" ref="a12c713dc409f1b0d877c59abf81a9a00" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__threadstorage.html">ast_threadstorage</a> <a class="el" href="res__odbc_8c.html#a12c713dc409f1b0d877c59abf81a9a00">errors_buf</a> = { .once = PTHREAD_ONCE_INIT , .key_init = __init_errors_buf , .custom_init = NULL , }<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l00146">146</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>Referenced by <a class="el" href="res__odbc_8c_source.html#l01052">commit_exec()</a>, and <a class="el" href="res__odbc_8c_source.html#l01089">rollback_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="a1e4b8faa910452a9acca534b7ae5ade2"></a><!-- doxytag: member="res_odbc.c::odbc_function" ref="a1e4b8faa910452a9acca534b7ae5ade2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__custom__function.html">ast_custom_function</a> <a class="el" href="res__odbc_8c.html#a1e4b8faa910452a9acca534b7ae5ade2">odbc_function</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
   .name = <span class="stringliteral">&quot;ODBC&quot;</span>,
   .read = <a class="code" href="res__odbc_8c.html#a8b4d273755ddbc90788622e6d516f5cd">acf_transaction_read</a>,
   .write = <a class="code" href="res__odbc_8c.html#a61a9c819af98717ab644e37d4a7f10b6">acf_transaction_write</a>,
}
</pre></div>
<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l01595">1595</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>Referenced by <a class="el" href="res__odbc_8c_source.html#l01684">load_module()</a>.</p>

</div>
</div>
<a class="anchor" id="a39d901a085de05b4b891f3643347316a"></a><!-- doxytag: member="res_odbc.c::txn_info" ref="a39d901a085de05b4b891f3643347316a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__datastore__info.html">ast_datastore_info</a> <a class="el" href="res__odbc_8c.html#a39d901a085de05b4b891f3643347316a">txn_info</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
   .type = <span class="stringliteral">&quot;ODBC_Transaction&quot;</span>,
   .destroy = <a class="code" href="res__odbc_8c.html#a9b1c173ec21f662bf76dc0f4f848f9a8">odbc_txn_free</a>,
}
</pre></div>
<p>Definition at line <a class="el" href="res__odbc_8c_source.html#l00148">148</a> of file <a class="el" href="res__odbc_8c_source.html">res_odbc.c</a>.</p>

<p>Referenced by <a class="el" href="res__odbc_8c_source.html#l01342">ast_odbc_retrieve_transaction_obj()</a>, <a class="el" href="res__odbc_8c_source.html#l00204">find_transaction()</a>, <a class="el" href="res__odbc_8c_source.html#l00339">mark_transaction_active()</a>, and <a class="el" href="res__odbc_8c_source.html#l00287">release_transaction()</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:23:16 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
