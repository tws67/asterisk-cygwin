<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:23:09 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_318a70d4e812a718d9ecaeea98fff199.html">res</a>
  </div>
</div>
<div class="contents">
<h1>res_ais.c File Reference</h1>
<p>Usage of the SAForum AIS (Application Interface Specification).  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="asterisk_8h_source.html">asterisk.h</a>&quot;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;unistd.h&gt;</code><br/>
<code>#include &lt;errno.h&gt;</code><br/>
<code>#include &lt;signal.h&gt;</code><br/>
<code>#include &lt;pthread.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="ais_8h_source.html">ais/ais.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="module_8h_source.html">asterisk/module.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="options_8h_source.html">asterisk/options.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="logger_8h_source.html">asterisk/logger.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="channel_8h_source.html">asterisk/channel.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="utils_8h_source.html">asterisk/utils.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="cli_8h_source.html">asterisk/cli.h</a>&quot;</code><br/>

<p><a href="res__ais_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structais__error.html">ais_error</a></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__ais_8c.html#a88b7c88fed6b80fd18f34f97757dfc04">__reg_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__ais_8c.html#afeab1257bd17282b95875499393a147a">__unreg_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__ais_8c.html#af80bee72e09581a67de74086704a3120">ais_err2str</a> (SaAisErrorT error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__ais_8c.html#a81f8759565c4d59b2068462bd0a0f05e">ASTERISK_FILE_VERSION</a> (__FILE__,&quot;$Revision: 179164 $&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__ais_8c.html#acaa3dff7e0bbd23d0ecd7583733a5de8">dispatch_thread_handler</a> (void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__ais_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__ais_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a> (void)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__module__info.html">ast_module_info</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__ais_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a> = { .<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = AST_MODULE, .flags = AST_MODFLAG_DEFAULT , .<a class="el" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a> = &quot;SAForum AIS&quot; , .key = &quot;This paragraph is copyright (c) 2006 by Digium, Inc. \In order for your module to load, it must return this \key via a function called \&quot;key\&quot;. Any code which \includes this paragraph must be licensed under the GNU \General Public License <a class="el" href="res__config__pgsql_8c.html#aad880fc4455c253781e8968f2239d56f">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = &quot;aefddfaffd51bc118c14a748e96eb9a0&quot; , .load = load_module, .unload = unload_module, }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structais__error.html">ais_error</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__ais_8c.html#aa8dafd8df747f2b4427c68e94512974e">ais_errors</a> []</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">SaVersionT&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__ais_8c.html#ad5bcd4970d278726940eb36867812aab">ais_version</a> = { 'B', 1, 1 }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__module__info.html">ast_module_info</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__ais_8c.html#ae25b9f3970870610911f8850897e8ead">ast_module_info</a> = &amp;<a class="el" href="res__timing__timerfd_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a></td></tr>
<tr><td class="memItemLeft" >struct {</td></tr>
<tr><td class="memItemLeft" >&nbsp;&nbsp;&nbsp;pthread_t&nbsp;&nbsp;&nbsp;<a class="el" href="res__ais_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a></td></tr>
<tr><td class="memItemLeft" >&nbsp;&nbsp;&nbsp;unsigned int&nbsp;&nbsp;&nbsp;<a class="el" href="res__ais_8c.html#a111277a0849f92b793ed6aa1efe54462">stop</a>:1</td></tr>
<tr><td class="memItemLeft" valign="top">}&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__ais_8c.html#aeb60548ccf5ee220591730d884a2faee">dispatch_thread</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Usage of the SAForum AIS (Application Interface Specification). </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Russell Bryant &lt;<a href="mailto:russell@digium.com">russell@digium.com</a>&gt;</dd></dl>
<ul>
<li><a href="http://www.openais.org/">http://www.openais.org/</a></li>
</ul>
<p>This file contains the common code between the uses of the different AIS services.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>This module is still considered experimental, as it exposes the internal binary format of events between Asterisk servers over a network. However, this format is still subject to change between 1.6.X releases. </dd></dl>

<p>Definition in file <a class="el" href="res__ais_8c_source.html">res_ais.c</a>.</p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a88b7c88fed6b80fd18f34f97757dfc04"></a><!-- doxytag: member="res_ais.c::__reg_module" ref="a88b7c88fed6b80fd18f34f97757dfc04" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void __reg_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__ais_8c_source.html#l00196">196</a> of file <a class="el" href="res__ais_8c_source.html">res_ais.c</a>.</p>

</div>
</div>
<a class="anchor" id="afeab1257bd17282b95875499393a147a"></a><!-- doxytag: member="res_ais.c::__unreg_module" ref="afeab1257bd17282b95875499393a147a" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void __unreg_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__ais_8c_source.html#l00196">196</a> of file <a class="el" href="res__ais_8c_source.html">res_ais.c</a>.</p>

</div>
</div>
<a class="anchor" id="af80bee72e09581a67de74086704a3120"></a><!-- doxytag: member="res_ais.c::ais_err2str" ref="af80bee72e09581a67de74086704a3120" args="(SaAisErrorT error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* ais_err2str </td>
          <td>(</td>
          <td class="paramtype">SaAisErrorT&nbsp;</td>
          <td class="paramname"> <em>error</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__ais_8c_source.html#l00102">102</a> of file <a class="el" href="res__ais_8c_source.html">res_ais.c</a>.</p>

<p>References <a class="el" href="res__ais_8c.html#aa8dafd8df747f2b4427c68e94512974e">ais_errors</a>, <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, and <a class="el" href="res__ais_8c_source.html#l00071">ais_error::desc</a>.</p>

<p>Referenced by <a class="el" href="evt_8c_source.html#l00362">add_subscribe_event()</a>, <a class="el" href="clm_8c_source.html#l00135">ast_ais_clm_load_module()</a>, <a class="el" href="clm_8c_source.html#l00151">ast_ais_clm_unload_module()</a>, <a class="el" href="evt_8c_source.html#l00540">ast_ais_evt_load_module()</a>, <a class="el" href="evt_8c_source.html#l00558">ast_ais_evt_unload_module()</a>, <a class="el" href="evt_8c_source.html#l00172">ast_event_cb()</a>, <a class="el" href="evt_8c_source.html#l00403">build_event_channel()</a>, <a class="el" href="evt_8c_source.html#l00510">event_channel_destroy()</a>, <a class="el" href="evt_8c_source.html#l00118">evt_event_deliver_cb()</a>, and <a class="el" href="evt_8c_source.html#l00495">subscribe_event_destroy()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00103"></a>00103 {
<a name="l00104"></a>00104    <span class="keywordtype">int</span> x;
<a name="l00105"></a>00105 
<a name="l00106"></a>00106    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="res__ais_8c.html#aa8dafd8df747f2b4427c68e94512974e">ais_errors</a>); x++) {
<a name="l00107"></a>00107       <span class="keywordflow">if</span> (<a class="code" href="res__ais_8c.html#aa8dafd8df747f2b4427c68e94512974e">ais_errors</a>[x].error == error)
<a name="l00108"></a>00108          <span class="keywordflow">return</span> <a class="code" href="res__ais_8c.html#aa8dafd8df747f2b4427c68e94512974e">ais_errors</a>[x].<a class="code" href="structais__error.html#a710bce51374aba96ab04912897666c35">desc</a>;
<a name="l00109"></a>00109    }
<a name="l00110"></a>00110 
<a name="l00111"></a>00111    <span class="keywordflow">return</span> <span class="stringliteral">&quot;Unknown&quot;</span>;
<a name="l00112"></a>00112 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a81f8759565c4d59b2068462bd0a0f05e"></a><!-- doxytag: member="res_ais.c::ASTERISK_FILE_VERSION" ref="a81f8759565c4d59b2068462bd0a0f05e" args="(__FILE__,&quot;$Revision: 179164 $&quot;)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ASTERISK_FILE_VERSION </td>
          <td>(</td>
          <td class="paramtype">__FILE__&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;$Revision: 179164 $&quot;&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="acaa3dff7e0bbd23d0ecd7583733a5de8"></a><!-- doxytag: member="res_ais.c::dispatch_thread_handler" ref="acaa3dff7e0bbd23d0ecd7583733a5de8" args="(void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void* dispatch_thread_handler </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__ais_8c_source.html#l00114">114</a> of file <a class="el" href="res__ais_8c_source.html">res_ais.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8h_source.html#l01726">ast_select()</a>, <a class="el" href="clm_8c_source.html#l00048">clm_handle</a>, <a class="el" href="res__ais_8c.html#aeb60548ccf5ee220591730d884a2faee">dispatch_thread</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="evt_8c_source.html#l00057">evt_handle</a>, and <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>.</p>

<p>Referenced by <a class="el" href="res__ais_8c_source.html#l00158">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00115"></a>00115 {
<a name="l00116"></a>00116    SaSelectionObjectT clm_fd, evt_fd, max_fd;
<a name="l00117"></a>00117    <span class="keywordtype">int</span> res;
<a name="l00118"></a>00118    fd_set read_fds;
<a name="l00119"></a>00119    SaAisErrorT ais_res;
<a name="l00120"></a>00120 
<a name="l00121"></a>00121    ais_res = saClmSelectionObjectGet(<a class="code" href="ais_8h.html#aea0d85f7751d3f84fd3849c1f4beb97e">clm_handle</a>, &amp;clm_fd);
<a name="l00122"></a>00122    <span class="keywordflow">if</span> (ais_res != SA_AIS_OK) {
<a name="l00123"></a>00123       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to retrieve select fd for CLM service.  &quot;</span>
<a name="l00124"></a>00124          <span class="stringliteral">&quot;This module will not operate.\n&quot;</span>);
<a name="l00125"></a>00125       <span class="keywordflow">return</span> NULL;
<a name="l00126"></a>00126    }
<a name="l00127"></a>00127 
<a name="l00128"></a>00128    ais_res = saEvtSelectionObjectGet(<a class="code" href="ais_8h.html#a951e99df1077e54574ebdb916b529c85">evt_handle</a>, &amp;evt_fd);
<a name="l00129"></a>00129    <span class="keywordflow">if</span> (ais_res != SA_AIS_OK) {
<a name="l00130"></a>00130       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to retrieve select fd for EVT service.  &quot;</span>
<a name="l00131"></a>00131          <span class="stringliteral">&quot;This module will not operate.\n&quot;</span>);
<a name="l00132"></a>00132       <span class="keywordflow">return</span> NULL;
<a name="l00133"></a>00133    }
<a name="l00134"></a>00134 
<a name="l00135"></a>00135    max_fd = clm_fd &gt; evt_fd ? clm_fd : evt_fd;
<a name="l00136"></a>00136 
<a name="l00137"></a>00137    <span class="keywordflow">while</span> (!<a class="code" href="res__ais_8c.html#aeb60548ccf5ee220591730d884a2faee">dispatch_thread</a>.stop) {
<a name="l00138"></a>00138       FD_ZERO(&amp;read_fds);
<a name="l00139"></a>00139       FD_SET(clm_fd,  &amp;read_fds);
<a name="l00140"></a>00140       FD_SET(evt_fd,  &amp;read_fds);
<a name="l00141"></a>00141 
<a name="l00142"></a>00142       res = <a class="code" href="channel_8h.html#a056ed4f99440f01c251b2e8ca4501a56" title="Waits for activity on a group of channels.">ast_select</a>(max_fd + 1, &amp;read_fds, NULL, NULL, NULL);
<a name="l00143"></a>00143       <span class="keywordflow">if</span> (res == -1 &amp;&amp; errno != EINTR &amp;&amp; errno != EAGAIN) {
<a name="l00144"></a>00144          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Select error (%s) dispatch thread going away now, &quot;</span>
<a name="l00145"></a>00145             <span class="stringliteral">&quot;and the module will no longer operate.\n&quot;</span>, strerror(errno));
<a name="l00146"></a>00146          <span class="keywordflow">break</span>;
<a name="l00147"></a>00147       }
<a name="l00148"></a>00148 
<a name="l00149"></a>00149       <span class="keywordflow">if</span> (FD_ISSET(clm_fd,  &amp;read_fds))
<a name="l00150"></a>00150          saClmDispatch(<a class="code" href="ais_8h.html#aea0d85f7751d3f84fd3849c1f4beb97e">clm_handle</a>,   SA_DISPATCH_ALL);
<a name="l00151"></a>00151       <span class="keywordflow">if</span> (FD_ISSET(evt_fd,  &amp;read_fds))
<a name="l00152"></a>00152          saEvtDispatch(<a class="code" href="ais_8h.html#a951e99df1077e54574ebdb916b529c85">evt_handle</a>,   SA_DISPATCH_ALL);
<a name="l00153"></a>00153    }
<a name="l00154"></a>00154 
<a name="l00155"></a>00155    <span class="keywordflow">return</span> NULL;
<a name="l00156"></a>00156 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac3382bf6da54c56b37069bd76bbdf4f9"></a><!-- doxytag: member="res_ais.c::load_module" ref="ac3382bf6da54c56b37069bd76bbdf4f9" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int load_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__ais_8c_source.html#l00158">158</a> of file <a class="el" href="res__ais_8c_source.html">res_ais.c</a>.</p>

<p>References <a class="el" href="clm_8c_source.html#l00135">ast_ais_clm_load_module()</a>, <a class="el" href="clm_8c_source.html#l00151">ast_ais_clm_unload_module()</a>, <a class="el" href="evt_8c_source.html#l00540">ast_ais_evt_load_module()</a>, <a class="el" href="evt_8c_source.html#l00558">ast_ais_evt_unload_module()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="module_8h_source.html#l00062">AST_MODULE_LOAD_DECLINE</a>, <a class="el" href="module_8h_source.html#l00061">AST_MODULE_LOAD_SUCCESS</a>, <a class="el" href="utils_8h_source.html#l00384">ast_pthread_create_background</a>, <a class="el" href="res__ais_8c.html#aeb60548ccf5ee220591730d884a2faee">dispatch_thread</a>, <a class="el" href="res__ais_8c_source.html#l00114">dispatch_thread_handler()</a>, and <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00159"></a>00159 {
<a name="l00160"></a>00160    <span class="keywordflow">if</span> (<a class="code" href="ais_8h.html#ae0f57703ccd10cc35d8fc0967f67dced">ast_ais_clm_load_module</a>())
<a name="l00161"></a>00161       <span class="keywordflow">goto</span> return_error;
<a name="l00162"></a>00162 
<a name="l00163"></a>00163    <span class="keywordflow">if</span> (<a class="code" href="ais_8h.html#ad3e305185771cb243accfe02011e565a">ast_ais_evt_load_module</a>())
<a name="l00164"></a>00164       <span class="keywordflow">goto</span> evt_failed;
<a name="l00165"></a>00165 
<a name="l00166"></a>00166    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a595e2f8aa398f4bd21e381c3211235fe">ast_pthread_create_background</a>(&amp;<a class="code" href="res__ais_8c.html#aeb60548ccf5ee220591730d884a2faee">dispatch_thread</a>.id, NULL, 
<a name="l00167"></a>00167       <a class="code" href="res__ais_8c.html#acaa3dff7e0bbd23d0ecd7583733a5de8">dispatch_thread_handler</a>, NULL)) {
<a name="l00168"></a>00168       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Error starting AIS dispatch thread.\n&quot;</span>);
<a name="l00169"></a>00169       <span class="keywordflow">goto</span> dispatch_failed;
<a name="l00170"></a>00170    }
<a name="l00171"></a>00171 
<a name="l00172"></a>00172    <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a>;
<a name="l00173"></a>00173 
<a name="l00174"></a>00174 dispatch_failed:
<a name="l00175"></a>00175    <a class="code" href="ais_8h.html#aec7e4b7c6a42429ecb8352127ce6d121">ast_ais_evt_unload_module</a>();
<a name="l00176"></a>00176 evt_failed:
<a name="l00177"></a>00177    <a class="code" href="ais_8h.html#a4ccb0a0a2759a5af1c406bc7a1caae77">ast_ais_clm_unload_module</a>();
<a name="l00178"></a>00178 return_error:
<a name="l00179"></a>00179    <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;
<a name="l00180"></a>00180 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad09fa931f468002152a3cc2d5ce25eae"></a><!-- doxytag: member="res_ais.c::unload_module" ref="ad09fa931f468002152a3cc2d5ce25eae" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int unload_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__ais_8c_source.html#l00182">182</a> of file <a class="el" href="res__ais_8c_source.html">res_ais.c</a>.</p>

<p>References <a class="el" href="clm_8c_source.html#l00151">ast_ais_clm_unload_module()</a>, <a class="el" href="evt_8c_source.html#l00558">ast_ais_evt_unload_module()</a>, <a class="el" href="lock_8h_source.html#l00082">AST_PTHREADT_NULL</a>, and <a class="el" href="res__ais_8c.html#aeb60548ccf5ee220591730d884a2faee">dispatch_thread</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00183"></a>00183 {
<a name="l00184"></a>00184    <a class="code" href="ais_8h.html#a4ccb0a0a2759a5af1c406bc7a1caae77">ast_ais_clm_unload_module</a>();
<a name="l00185"></a>00185    <a class="code" href="ais_8h.html#aec7e4b7c6a42429ecb8352127ce6d121">ast_ais_evt_unload_module</a>();
<a name="l00186"></a>00186 
<a name="l00187"></a>00187    <span class="keywordflow">if</span> (<a class="code" href="res__ais_8c.html#aeb60548ccf5ee220591730d884a2faee">dispatch_thread</a>.id != <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>) {
<a name="l00188"></a>00188       <a class="code" href="res__ais_8c.html#aeb60548ccf5ee220591730d884a2faee">dispatch_thread</a>.stop = 1;
<a name="l00189"></a>00189       pthread_kill(<a class="code" href="res__ais_8c.html#aeb60548ccf5ee220591730d884a2faee">dispatch_thread</a>.id, SIGURG); <span class="comment">/* poke! */</span>
<a name="l00190"></a>00190       pthread_join(<a class="code" href="res__ais_8c.html#aeb60548ccf5ee220591730d884a2faee">dispatch_thread</a>.id, NULL);
<a name="l00191"></a>00191    }
<a name="l00192"></a>00192 
<a name="l00193"></a>00193    <span class="keywordflow">return</span> 0;
<a name="l00194"></a>00194 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ab22f32016155f7f403e7178767163d7d"></a><!-- doxytag: member="res_ais.c::__mod_info" ref="ab22f32016155f7f403e7178767163d7d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__module__info.html">ast_module_info</a> <a class="el" href="res__timing__timerfd_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a> = { .<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = AST_MODULE, .flags = AST_MODFLAG_DEFAULT , .<a class="el" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a> = &quot;SAForum AIS&quot; , .key = &quot;This paragraph is copyright (c) 2006 by Digium, Inc. \In order for your module to load, it must return this \key via a function called \&quot;key\&quot;. Any code which \includes this paragraph must be licensed under the GNU \General Public License <a class="el" href="res__config__pgsql_8c.html#aad880fc4455c253781e8968f2239d56f">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = &quot;aefddfaffd51bc118c14a748e96eb9a0&quot; , .load = load_module, .unload = unload_module, }<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__ais_8c_source.html#l00196">196</a> of file <a class="el" href="res__ais_8c_source.html">res_ais.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa8dafd8df747f2b4427c68e94512974e"></a><!-- doxytag: member="res_ais.c::ais_errors" ref="aa8dafd8df747f2b4427c68e94512974e" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structais__error.html">ais_error</a>  <a class="el" href="res__ais_8c.html#aa8dafd8df747f2b4427c68e94512974e">ais_errors</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="res__ais_8c_source.html#l00102">ais_err2str()</a>.</p>

</div>
</div>
<a class="anchor" id="ad5bcd4970d278726940eb36867812aab"></a><!-- doxytag: member="res_ais.c::ais_version" ref="ad5bcd4970d278726940eb36867812aab" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SaVersionT <a class="el" href="ais_8h.html#ad5bcd4970d278726940eb36867812aab">ais_version</a> = { 'B', 1, 1 }</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__ais_8c_source.html#l00067">67</a> of file <a class="el" href="res__ais_8c_source.html">res_ais.c</a>.</p>

<p>Referenced by <a class="el" href="clm_8c_source.html#l00135">ast_ais_clm_load_module()</a>, and <a class="el" href="evt_8c_source.html#l00540">ast_ais_evt_load_module()</a>.</p>

</div>
</div>
<a class="anchor" id="ae25b9f3970870610911f8850897e8ead"></a><!-- doxytag: member="res_ais.c::ast_module_info" ref="ae25b9f3970870610911f8850897e8ead" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__module__info.html">ast_module_info</a>* <a class="el" href="structast__module__info.html">ast_module_info</a> = &amp;<a class="el" href="res__timing__timerfd_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__ais_8c_source.html#l00196">196</a> of file <a class="el" href="res__ais_8c_source.html">res_ais.c</a>.</p>

</div>
</div>
<a class="anchor" id="aeb60548ccf5ee220591730d884a2faee"></a><!-- doxytag: member="res_ais.c::dispatch_thread" ref="aeb60548ccf5ee220591730d884a2faee" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct { ... }   <a class="el" href="res__ais_8c.html#aeb60548ccf5ee220591730d884a2faee">dispatch_thread</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="res__ais_8c_source.html#l00114">dispatch_thread_handler()</a>, <a class="el" href="res__ais_8c_source.html#l00158">load_module()</a>, and <a class="el" href="res__ais_8c_source.html#l00182">unload_module()</a>.</p>

</div>
</div>
<a class="anchor" id="a2465fd4497a7402ad72da7d6e03f9934"></a><!-- doxytag: member="res_ais.c::id" ref="a2465fd4497a7402ad72da7d6e03f9934" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_t <a class="el" href="res__ais_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__ais_8c_source.html#l00061">61</a> of file <a class="el" href="res__ais_8c_source.html">res_ais.c</a>.</p>

</div>
</div>
<a class="anchor" id="a111277a0849f92b793ed6aa1efe54462"></a><!-- doxytag: member="res_ais.c::stop" ref="a111277a0849f92b793ed6aa1efe54462" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="res__timing__pthread_8c.html#a111277a0849f92b793ed6aa1efe54462">stop</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__ais_8c_source.html#l00062">62</a> of file <a class="el" href="res__ais_8c_source.html">res_ais.c</a>.</p>

<p>Referenced by <a class="el" href="app__controlplayback_8c_source.html#l00128">controlplayback_exec()</a>, <a class="el" href="res__agi_8c_source.html#l01153">handle_controlstreamfile()</a>, and <a class="el" href="app__queue_8c_source.html#l05031">queue_exec()</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:23:09 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
