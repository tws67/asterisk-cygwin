<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:22:05 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_1ab815038f534adda65c8b4ae4993449.html">include</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_16d825f1fa9ecca2e70b1a8d9256d0e6.html">asterisk</a>
  </div>
</div>
<div class="contents">
<h1>features.h File Reference</h1>
<p>Call Parking and Pickup API Includes code and algorithms from the Zapata library.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="pbx_8h_source.html">asterisk/pbx.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="linkedlists_8h_source.html">asterisk/linkedlists.h</a>&quot;</code><br/>

<p><a href="features_8h_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__call__feature.html">ast_call_feature</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#a15a8f2f0ac06ed7209ce480e1d4b6352">AST_FEATURE_RETURN_HANGUP</a>&nbsp;&nbsp;&nbsp;-1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#a3ab7e6a7cee8d7b8cf23190d3b58b0c8">AST_FEATURE_RETURN_KEEPTRYING</a>&nbsp;&nbsp;&nbsp;24</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#a67087b9e4e17fecd92350e2b5cfcb493">AST_FEATURE_RETURN_PARKFAILED</a>&nbsp;&nbsp;&nbsp;25</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#a6fe63cc369dcb5f31ee37b64cc68d4b2">AST_FEATURE_RETURN_PASSDIGITS</a>&nbsp;&nbsp;&nbsp;21</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#ae16feaff434ab443f245cf610797a70c">AST_FEATURE_RETURN_STOREDIGITS</a>&nbsp;&nbsp;&nbsp;22</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#a262aca923fa7156c10fdc92c99d66bc7">AST_FEATURE_RETURN_SUCCESS</a>&nbsp;&nbsp;&nbsp;23</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#aa8cd95ffa7e16936d70678f2fa7c96e1">AST_FEATURE_RETURN_SUCCESSBREAK</a>&nbsp;&nbsp;&nbsp;0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#a15dec7b203bbbe9b2876542e11192038">FEATURE_APP_ARGS_LEN</a>&nbsp;&nbsp;&nbsp;256</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#a5dd21373ce06047f1fc916ef86a3644c">FEATURE_APP_LEN</a>&nbsp;&nbsp;&nbsp;64</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#a1c5e2f1a4178d55ed017613a10d5bd66">FEATURE_EXTEN_LEN</a>&nbsp;&nbsp;&nbsp;32</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#aaa72e2b220201e352ddedb91db4d7f31">FEATURE_MAX_LEN</a>&nbsp;&nbsp;&nbsp;11</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#a5b60615b76d1e41b08f220ed65050e9c">FEATURE_MOH_LEN</a>&nbsp;&nbsp;&nbsp;80</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#af67231f5862bb84b9a1b33b2eacecdc8">FEATURE_SNAME_LEN</a>&nbsp;&nbsp;&nbsp;32</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#a27355650e25223abaafd62101216f2b8">PARK_APP_NAME</a>&nbsp;&nbsp;&nbsp;&quot;Park&quot;</td></tr>
<tr><td colspan="2"><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom">{ <br/>
&nbsp;&nbsp;<a class="el" href="features_8h.html#a1f3b6c692395e5007ff47ce5d9304c1ca7e260a8ce4ea1f7036380328a503f417">AST_FEATURE_FLAG_NEEDSDTMF</a> =  (1 &lt;&lt; 0), 
<a class="el" href="features_8h.html#a1f3b6c692395e5007ff47ce5d9304c1ca1d106267aa4d386c2354dc57b8ec6a40">AST_FEATURE_FLAG_ONPEER</a> =  (1 &lt;&lt; 1), 
<a class="el" href="features_8h.html#a1f3b6c692395e5007ff47ce5d9304c1ca2400fd06fffa892d753ab1957f653d41">AST_FEATURE_FLAG_ONSELF</a> =  (1 &lt;&lt; 2), 
<a class="el" href="features_8h.html#a1f3b6c692395e5007ff47ce5d9304c1cafbc6e73e751f0075b505a5fbdec63056">AST_FEATURE_FLAG_BYCALLEE</a> =  (1 &lt;&lt; 3), 
<br/>
&nbsp;&nbsp;<a class="el" href="features_8h.html#a1f3b6c692395e5007ff47ce5d9304c1ca56f450ad592f4fe14a2619bd13a5c62e">AST_FEATURE_FLAG_BYCALLER</a> =  (1 &lt;&lt; 4), 
<a class="el" href="features_8h.html#a1f3b6c692395e5007ff47ce5d9304c1ca54b7e168009244e5f9bb4182c8fda16c">AST_FEATURE_FLAG_BYBOTH</a> =  (3 &lt;&lt; 3)
<br/>
 }</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p>main call feature structure </p>
 <a href="features_8h.html#a1f3b6c692395e5007ff47ce5d9304c1c">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#a3fe7c7e43b8f3140716d836816bf827f">ast_bridge_call</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__channel.html">ast_channel</a> *peer, struct <a class="el" href="structast__bridge__config.html">ast_bridge_config</a> *<a class="el" href="pbx__lua_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Bridge a call, optionally allowing redirection.  <a href="#a3fe7c7e43b8f3140716d836816bf827f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#a425ed69a5937fc5a26508084a11ceb47">ast_features_reload</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Reload call features from features.conf.  <a href="#a425ed69a5937fc5a26508084a11ceb47"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__call__feature.html">ast_call_feature</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#afe968c2bd566a03c0bc212faa7a37e17">ast_find_call_feature</a> (const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">look for a call feature entry by its sname  <a href="#afe968c2bd566a03c0bc212faa7a37e17"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#a70a2de2bf789996ae5e66142294ca18f">ast_masq_park_call</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *rchan, struct <a class="el" href="structast__channel.html">ast_channel</a> *host, int timeout, int *extout)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Park a call via a masqueraded channel.  <a href="#a70a2de2bf789996ae5e66142294ca18f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#a502948a22446cb0c97d19fc4783b2b5a">ast_park_call</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__channel.html">ast_channel</a> *host, int timeout, int *extout)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Park a call and read back parked location.  <a href="#a502948a22446cb0c97d19fc4783b2b5a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#a716860609c92cd4b7fb8f6eb724ac700">ast_parking_ext</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Determine system parking <a class="el" href="structextension.html">extension</a>.  <a href="#a716860609c92cd4b7fb8f6eb724ac700"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#a4890be42c2add5f52028705d6bc02201">ast_pickup_call</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Pickup a call.  <a href="#a4890be42c2add5f52028705d6bc02201"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#a849b0c1bd72a0339408c7e6026768e40">ast_pickup_ext</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Determine system call pickup <a class="el" href="structextension.html">extension</a>.  <a href="#a849b0c1bd72a0339408c7e6026768e40"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#adea59e175a9f8500c0eb848918849c67">ast_rdlock_call_features</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#aa148867dd4dde459d181fc84be58c0f0">ast_register_feature</a> (struct <a class="el" href="structast__call__feature.html">ast_call_feature</a> *feature)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">register new feature into feature_set  <a href="#aa148867dd4dde459d181fc84be58c0f0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#a7c163c3ad2e31110c5fc9e0d3b27d81d">ast_unlock_call_features</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#ad151dea8a1d676a4eac6206597ae980a">ast_unregister_feature</a> (struct <a class="el" href="structast__call__feature.html">ast_call_feature</a> *feature)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">unregister feature from feature_set  <a href="#ad151dea8a1d676a4eac6206597ae980a"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Call Parking and Pickup API Includes code and algorithms from the Zapata library. </p>

<p>Definition in file <a class="el" href="features_8h_source.html">features.h</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a15a8f2f0ac06ed7209ce480e1d4b6352"></a><!-- doxytag: member="features.h::AST_FEATURE_RETURN_HANGUP" ref="a15a8f2f0ac06ed7209ce480e1d4b6352" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_FEATURE_RETURN_HANGUP&nbsp;&nbsp;&nbsp;-1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="features_8h_source.html#l00064">64</a> of file <a class="el" href="features_8h_source.html">features.h</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l01215">builtin_disconnect()</a>.</p>

</div>
</div>
<a class="anchor" id="a3ab7e6a7cee8d7b8cf23190d3b58b0c8"></a><!-- doxytag: member="features.h::AST_FEATURE_RETURN_KEEPTRYING" ref="a3ab7e6a7cee8d7b8cf23190d3b58b0c8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_FEATURE_RETURN_KEEPTRYING&nbsp;&nbsp;&nbsp;24</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="features_8h_source.html#l00069">69</a> of file <a class="el" href="features_8h_source.html">features.h</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l01903">feature_exec_app()</a>, and <a class="el" href="features_8c_source.html#l01996">feature_interpret()</a>.</p>

</div>
</div>
<a class="anchor" id="a67087b9e4e17fecd92350e2b5cfcb493"></a><!-- doxytag: member="features.h::AST_FEATURE_RETURN_PARKFAILED" ref="a67087b9e4e17fecd92350e2b5cfcb493" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_FEATURE_RETURN_PARKFAILED&nbsp;&nbsp;&nbsp;25</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="features_8h_source.html#l00070">70</a> of file <a class="el" href="features_8h_source.html">features.h</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l01265">builtin_blindtransfer()</a>, and <a class="el" href="features_8c_source.html#l00833">masq_park_call()</a>.</p>

</div>
</div>
<a class="anchor" id="a6fe63cc369dcb5f31ee37b64cc68d4b2"></a><!-- doxytag: member="features.h::AST_FEATURE_RETURN_PASSDIGITS" ref="a6fe63cc369dcb5f31ee37b64cc68d4b2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_FEATURE_RETURN_PASSDIGITS&nbsp;&nbsp;&nbsp;21</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="features_8h_source.html#l00066">66</a> of file <a class="el" href="features_8h_source.html">features.h</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l02441">ast_bridge_call()</a>, and <a class="el" href="features_8c_source.html#l01996">feature_interpret()</a>.</p>

</div>
</div>
<a class="anchor" id="ae16feaff434ab443f245cf610797a70c"></a><!-- doxytag: member="features.h::AST_FEATURE_RETURN_STOREDIGITS" ref="ae16feaff434ab443f245cf610797a70c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_FEATURE_RETURN_STOREDIGITS&nbsp;&nbsp;&nbsp;22</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="features_8h_source.html#l00067">67</a> of file <a class="el" href="features_8h_source.html">features.h</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l01996">feature_interpret()</a>.</p>

</div>
</div>
<a class="anchor" id="a262aca923fa7156c10fdc92c99d66bc7"></a><!-- doxytag: member="features.h::AST_FEATURE_RETURN_SUCCESS" ref="a262aca923fa7156c10fdc92c99d66bc7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_FEATURE_RETURN_SUCCESS&nbsp;&nbsp;&nbsp;23</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="features_8h_source.html#l00068">68</a> of file <a class="el" href="features_8h_source.html">features.h</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l02441">ast_bridge_call()</a>, <a class="el" href="features_8c_source.html#l01396">builtin_atxfer()</a>, <a class="el" href="features_8c_source.html#l01105">builtin_automixmonitor()</a>, <a class="el" href="features_8c_source.html#l01012">builtin_automonitor()</a>, <a class="el" href="features_8c_source.html#l01265">builtin_blindtransfer()</a>, and <a class="el" href="features_8c_source.html#l01903">feature_exec_app()</a>.</p>

</div>
</div>
<a class="anchor" id="aa8cd95ffa7e16936d70678f2fa7c96e1"></a><!-- doxytag: member="features.h::AST_FEATURE_RETURN_SUCCESSBREAK" ref="aa8cd95ffa7e16936d70678f2fa7c96e1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_FEATURE_RETURN_SUCCESSBREAK&nbsp;&nbsp;&nbsp;0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="features_8h_source.html#l00065">65</a> of file <a class="el" href="features_8h_source.html">features.h</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l01903">feature_exec_app()</a>.</p>

</div>
</div>
<a class="anchor" id="a15dec7b203bbbe9b2876542e11192038"></a><!-- doxytag: member="features.h::FEATURE_APP_ARGS_LEN" ref="a15dec7b203bbbe9b2876542e11192038" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FEATURE_APP_ARGS_LEN&nbsp;&nbsp;&nbsp;256</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="features_8h_source.html#l00032">32</a> of file <a class="el" href="features_8h_source.html">features.h</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l03672">load_config()</a>.</p>

</div>
</div>
<a class="anchor" id="a5dd21373ce06047f1fc916ef86a3644c"></a><!-- doxytag: member="features.h::FEATURE_APP_LEN" ref="a5dd21373ce06047f1fc916ef86a3644c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FEATURE_APP_LEN&nbsp;&nbsp;&nbsp;64</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="features_8h_source.html#l00031">31</a> of file <a class="el" href="features_8h_source.html">features.h</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l03672">load_config()</a>.</p>

</div>
</div>
<a class="anchor" id="a1c5e2f1a4178d55ed017613a10d5bd66"></a><!-- doxytag: member="features.h::FEATURE_EXTEN_LEN" ref="a1c5e2f1a4178d55ed017613a10d5bd66" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FEATURE_EXTEN_LEN&nbsp;&nbsp;&nbsp;32</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="features_8h_source.html#l00034">34</a> of file <a class="el" href="features_8h_source.html">features.h</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l03672">load_config()</a>.</p>

</div>
</div>
<a class="anchor" id="aaa72e2b220201e352ddedb91db4d7f31"></a><!-- doxytag: member="features.h::FEATURE_MAX_LEN" ref="aaa72e2b220201e352ddedb91db4d7f31" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FEATURE_MAX_LEN&nbsp;&nbsp;&nbsp;11</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="features_8h_source.html#l00030">30</a> of file <a class="el" href="features_8h_source.html">features.h</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l02441">ast_bridge_call()</a>.</p>

</div>
</div>
<a class="anchor" id="a5b60615b76d1e41b08f220ed65050e9c"></a><!-- doxytag: member="features.h::FEATURE_MOH_LEN" ref="a5b60615b76d1e41b08f220ed65050e9c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FEATURE_MOH_LEN&nbsp;&nbsp;&nbsp;80</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="features_8h_source.html#l00035">35</a> of file <a class="el" href="features_8h_source.html">features.h</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l03672">load_config()</a>.</p>

</div>
</div>
<a class="anchor" id="af67231f5862bb84b9a1b33b2eacecdc8"></a><!-- doxytag: member="features.h::FEATURE_SNAME_LEN" ref="af67231f5862bb84b9a1b33b2eacecdc8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FEATURE_SNAME_LEN&nbsp;&nbsp;&nbsp;32</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="features_8h_source.html#l00033">33</a> of file <a class="el" href="features_8h_source.html">features.h</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l03672">load_config()</a>.</p>

</div>
</div>
<a class="anchor" id="a27355650e25223abaafd62101216f2b8"></a><!-- doxytag: member="features.h::PARK_APP_NAME" ref="a27355650e25223abaafd62101216f2b8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PARK_APP_NAME&nbsp;&nbsp;&nbsp;&quot;Park&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="features_8h_source.html#l00037">37</a> of file <a class="el" href="features_8h_source.html">features.h</a>.</p>

<p>Referenced by <a class="el" href="res__agi_8c_source.html#l01718">handle_exec()</a>.</p>

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="a1f3b6c692395e5007ff47ce5d9304c1c"></a><!-- doxytag: member="features.h::@105" ref="a1f3b6c692395e5007ff47ce5d9304c1c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>main call feature structure </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a1f3b6c692395e5007ff47ce5d9304c1ca7e260a8ce4ea1f7036380328a503f417"></a><!-- doxytag: member="AST_FEATURE_FLAG_NEEDSDTMF" ref="a1f3b6c692395e5007ff47ce5d9304c1ca7e260a8ce4ea1f7036380328a503f417" args="" -->AST_FEATURE_FLAG_NEEDSDTMF</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a1f3b6c692395e5007ff47ce5d9304c1ca1d106267aa4d386c2354dc57b8ec6a40"></a><!-- doxytag: member="AST_FEATURE_FLAG_ONPEER" ref="a1f3b6c692395e5007ff47ce5d9304c1ca1d106267aa4d386c2354dc57b8ec6a40" args="" -->AST_FEATURE_FLAG_ONPEER</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a1f3b6c692395e5007ff47ce5d9304c1ca2400fd06fffa892d753ab1957f653d41"></a><!-- doxytag: member="AST_FEATURE_FLAG_ONSELF" ref="a1f3b6c692395e5007ff47ce5d9304c1ca2400fd06fffa892d753ab1957f653d41" args="" -->AST_FEATURE_FLAG_ONSELF</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a1f3b6c692395e5007ff47ce5d9304c1cafbc6e73e751f0075b505a5fbdec63056"></a><!-- doxytag: member="AST_FEATURE_FLAG_BYCALLEE" ref="a1f3b6c692395e5007ff47ce5d9304c1cafbc6e73e751f0075b505a5fbdec63056" args="" -->AST_FEATURE_FLAG_BYCALLEE</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a1f3b6c692395e5007ff47ce5d9304c1ca56f450ad592f4fe14a2619bd13a5c62e"></a><!-- doxytag: member="AST_FEATURE_FLAG_BYCALLER" ref="a1f3b6c692395e5007ff47ce5d9304c1ca56f450ad592f4fe14a2619bd13a5c62e" args="" -->AST_FEATURE_FLAG_BYCALLER</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a1f3b6c692395e5007ff47ce5d9304c1ca54b7e168009244e5f9bb4182c8fda16c"></a><!-- doxytag: member="AST_FEATURE_FLAG_BYBOTH" ref="a1f3b6c692395e5007ff47ce5d9304c1ca54b7e168009244e5f9bb4182c8fda16c" args="" -->AST_FEATURE_FLAG_BYBOTH</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="features_8h_source.html#l00041">41</a> of file <a class="el" href="features_8h_source.html">features.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00041"></a>00041      {
<a name="l00042"></a>00042    <a class="code" href="features_8h.html#a1f3b6c692395e5007ff47ce5d9304c1ca7e260a8ce4ea1f7036380328a503f417">AST_FEATURE_FLAG_NEEDSDTMF</a> = (1 &lt;&lt; 0),
<a name="l00043"></a>00043    <a class="code" href="features_8h.html#a1f3b6c692395e5007ff47ce5d9304c1ca1d106267aa4d386c2354dc57b8ec6a40">AST_FEATURE_FLAG_ONPEER</a> =    (1 &lt;&lt; 1),
<a name="l00044"></a>00044    <a class="code" href="features_8h.html#a1f3b6c692395e5007ff47ce5d9304c1ca2400fd06fffa892d753ab1957f653d41">AST_FEATURE_FLAG_ONSELF</a> =    (1 &lt;&lt; 2),
<a name="l00045"></a>00045    <a class="code" href="features_8h.html#a1f3b6c692395e5007ff47ce5d9304c1cafbc6e73e751f0075b505a5fbdec63056">AST_FEATURE_FLAG_BYCALLEE</a> =  (1 &lt;&lt; 3),
<a name="l00046"></a>00046    <a class="code" href="features_8h.html#a1f3b6c692395e5007ff47ce5d9304c1ca56f450ad592f4fe14a2619bd13a5c62e">AST_FEATURE_FLAG_BYCALLER</a> =  (1 &lt;&lt; 4),
<a name="l00047"></a>00047    <a class="code" href="features_8h.html#a1f3b6c692395e5007ff47ce5d9304c1ca54b7e168009244e5f9bb4182c8fda16c">AST_FEATURE_FLAG_BYBOTH</a>  =   (3 &lt;&lt; 3),
<a name="l00048"></a>00048 };
</pre></div></p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a3fe7c7e43b8f3140716d836816bf827f"></a><!-- doxytag: member="features.h::ast_bridge_call" ref="a3fe7c7e43b8f3140716d836816bf827f" args="(struct ast_channel *chan, struct ast_channel *peer, struct ast_bridge_config *config)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_bridge_call </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__bridge__config.html">ast_bridge_config</a> *&nbsp;</td>
          <td class="paramname"> <em>config</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Bridge a call, optionally allowing redirection. </p>
<p>Bridge a call, optionally allowing redirection.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan,peer,config</em>&nbsp;</td><td>Set start time, check for two <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>,check if monitor on check for feature activation, create new CDR </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>res</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure to bridge. </td></tr>
  </table>
  </dd>
</dl>

<p><p>append the event to featurecode. we rely on the string being zero-filled, and not overflowing it. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000072">Todo:</a></b></dt><dd>XXX how do we guarantee the latter ? </dd></dl>
<p>append the event to featurecode. we rely on the string being zero-filled, and not overflowing it. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000087">Todo:</a></b></dt><dd>XXX how do we guarantee the latter ? </dd></dl>
</p>

<p>Definition at line <a class="el" href="features_8c_source.html#l02441">2441</a> of file <a class="el" href="features_8c_source.html">features.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="cdr_8h_source.html#l00101">ast_cdr::accountcode</a>, <a class="el" href="features_8c_source.html#l02374">add_features_datastores()</a>, <a class="el" href="channel_8h_source.html#l00473">ast_channel::amaflags</a>, <a class="el" href="cdr_8h_source.html#l00099">ast_cdr::amaflags</a>, <a class="el" href="cdr_8h_source.html#l00089">ast_cdr::answer</a>, <a class="el" href="channel_8h_source.html#l00411">ast_channel::appl</a>, <a class="el" href="channel_8h_source.html#l00167">AST_BRIDGE_RETRY</a>, <a class="el" href="channel_8c_source.html#l04733">ast_bridged_channel()</a>, <a class="el" href="cdr_8c_source.html#l00452">ast_cdr_alloc()</a>, <a class="el" href="cdr_8c_source.html#l00687">ast_cdr_answer()</a>, <a class="el" href="cdr_8h_source.html#l00051">AST_CDR_ANSWERED</a>, <a class="el" href="cdr_8c_source.html#l01234">ast_cdr_detach()</a>, <a class="el" href="cdr_8c_source.html#l00441">ast_cdr_discard()</a>, <a class="el" href="cdr_8c_source.html#l00168">ast_cdr_dup()</a>, <a class="el" href="cdr_8c_source.html#l00879">ast_cdr_end()</a>, <a class="el" href="cdr_8h_source.html#l00035">AST_CDR_FLAG_BRIDGED</a>, <a class="el" href="cdr_8h_source.html#l00036">AST_CDR_FLAG_MAIN</a>, <a class="el" href="cdr_8h_source.html#l00034">AST_CDR_FLAG_POST_DISABLED</a>, <a class="el" href="cdr_8h_source.html#l00048">AST_CDR_NULL</a>, <a class="el" href="cdr_8c_source.html#l00936">ast_cdr_setaccount()</a>, <a class="el" href="cdr_8c_source.html#l00835">ast_cdr_setcid()</a>, <a class="el" href="cdr_8c_source.html#l01105">ast_cdr_specialized_reset()</a>, <a class="el" href="cdr_8c_source.html#l00674">ast_cdr_start()</a>, <a class="el" href="cdr_8c_source.html#l00996">ast_cdr_update()</a>, <a class="el" href="channel_8c_source.html#l05055">ast_channel_bridge()</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="channel_8c_source.html#l05307">ast_channel_setoption()</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="channel_8c_source.html#l00461">ast_check_hangup()</a>, <a class="el" href="utils_8h_source.html#l00075">ast_clear_flag</a>, <a class="el" href="frame_8h_source.html#l00302">AST_CONTROL_BUSY</a>, <a class="el" href="frame_8h_source.html#l00305">AST_CONTROL_CONGESTION</a>, <a class="el" href="frame_8h_source.html#l00306">AST_CONTROL_FLASH</a>, <a class="el" href="frame_8h_source.html#l00298">AST_CONTROL_HANGUP</a>, <a class="el" href="frame_8h_source.html#l00313">AST_CONTROL_HOLD</a>, <a class="el" href="frame_8h_source.html#l00308">AST_CONTROL_OPTION</a>, <a class="el" href="frame_8h_source.html#l00300">AST_CONTROL_RINGING</a>, <a class="el" href="frame_8h_source.html#l00314">AST_CONTROL_UNHOLD</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="cdr_8c_source.html#l00054">ast_default_amaflags</a>, <a class="el" href="app_8c_source.html#l00314">ast_dtmf_stream()</a>, <a class="el" href="pbx_8c_source.html#l04143">ast_exists_extension()</a>, <a class="el" href="channel_8h_source.html#l00583">AST_FEATURE_NO_H_EXTEN</a>, <a class="el" href="channel_8h_source.html#l00576">AST_FEATURE_PLAY_WARNING</a>, <a class="el" href="features_8h_source.html#l00066">AST_FEATURE_RETURN_PASSDIGITS</a>, <a class="el" href="features_8h_source.html#l00068">AST_FEATURE_RETURN_SUCCESS</a>, <a class="el" href="channel_8h_source.html#l00565">AST_FLAG_BRIDGE_HANGUP_DONT</a>, <a class="el" href="channel_8h_source.html#l00561">AST_FLAG_BRIDGE_HANGUP_RUN</a>, <a class="el" href="channel_8h_source.html#l00541">AST_FLAG_IN_AUTOLOOP</a>, <a class="el" href="channel_8h_source.html#l00529">AST_FLAG_ZOMBIE</a>, <a class="el" href="frame_8h_source.html#l00105">AST_FRAME_CONTROL</a>, <a class="el" href="frame_8h_source.html#l00124">AST_FRAME_DTMF</a>, <a class="el" href="frame_8h_source.html#l00122">AST_FRAME_DTMF_BEGIN</a>, <a class="el" href="frame_8h_source.html#l00099">AST_FRAME_DTMF_END</a>, <a class="el" href="frame_8h_source.html#l00462">ast_frfree</a>, <a class="el" href="channel_8c_source.html#l01278">ast_get_channel_by_name_locked()</a>, <a class="el" href="channel_8c_source.html#l03110">ast_indicate()</a>, <a class="el" href="channel_8c_source.html#l03150">ast_indicate_data()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8h_source.html#l00134">AST_MAX_EXTENSION</a>, <a class="el" href="options_8h_source.html#l00116">ast_opt_end_cdr_before_h_exten</a>, <a class="el" href="frame_8h_source.html#l00358">AST_OPTION_FLAG_REQUEST</a>, <a class="el" href="channel_8c_source.html#l01799">ast_raw_answer()</a>, <a class="el" href="utils_8h_source.html#l00092">ast_set2_flag</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="pbx_8c_source.html#l04168">ast_spawn_extension()</a>, <a class="el" href="channel_8h_source.html#l00364">AST_STATE_RINGING</a>, <a class="el" href="channel_8h_source.html#l00365">AST_STATE_UP</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="time_8h_source.html#l00119">ast_tvcmp()</a>, <a class="el" href="time_8h_source.html#l00089">ast_tvdiff_ms()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="time_8h_source.html#l00099">ast_tvzero()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="channel_8h_source.html#l00422">ast_channel::cdr</a>, <a class="el" href="cdr_8h_source.html#l00079">ast_cdr::channel</a>, <a class="el" href="channel_8h_source.html#l00444">ast_channel::cid</a>, <a class="el" href="channel_8h_source.html#l00203">ast_callerid::cid_num</a>, <a class="el" href="channel_8h_source.html#l00503">ast_channel::context</a>, <a class="el" href="frame_8h_source.html#l00424">ast_option_header::data</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="channel_8h_source.html#l00412">ast_channel::data</a>, <a class="el" href="frame_8h_source.html#l00147">ast_frame::datalen</a>, <a class="el" href="cdr_8h_source.html#l00077">ast_cdr::dcontext</a>, <a class="el" href="cdr_8h_source.html#l00097">ast_cdr::disposition</a>, <a class="el" href="cdr_8h_source.html#l00075">ast_cdr::dst</a>, <a class="el" href="cdr_8h_source.html#l00081">ast_cdr::dstchannel</a>, <a class="el" href="structast__bridge__config.html#a03acb9e092c45d88e1fb9e146e5e554e">ast_bridge_config::end_bridge_callback</a>, <a class="el" href="channel_8h_source.html#l00604">ast_bridge_config::end_bridge_callback_data</a>, <a class="el" href="channel_8h_source.html#l00599">ast_bridge_config::end_sound</a>, <a class="el" href="channel_8h_source.html#l00504">ast_channel::exten</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="features_8c_source.html#l01996">feature_interpret()</a>, <a class="el" href="features_8h_source.html#l00030">FEATURE_MAX_LEN</a>, <a class="el" href="features_8c_source.html#l00909">FEATURE_SENSE_CHAN</a>, <a class="el" href="features_8c_source.html#l00910">FEATURE_SENSE_PEER</a>, <a class="el" href="channel_8h_source.html#l00594">ast_bridge_config::feature_timer</a>, <a class="el" href="features_8c_source.html#l00251">featuredigittimeout</a>, <a class="el" href="channel_8h_source.html#l00590">ast_bridge_config::features_callee</a>, <a class="el" href="channel_8h_source.html#l00589">ast_bridge_config::features_caller</a>, <a class="el" href="channel_8h_source.html#l00601">ast_bridge_config::firstpass</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="cdr_8h_source.html#l00083">ast_cdr::lastapp</a>, <a class="el" href="cdr_8h_source.html#l00085">ast_cdr::lastdata</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="features_8c_source.html#l00264">monitor_app</a>, <a class="el" href="features_8c_source.html#l00265">monitor_ok</a>, <a class="el" href="cdr_8h_source.html#l00113">ast_cdr::next</a>, <a class="el" href="pbx_8c_source.html#l08951">pbx_builtin_getvar_helper()</a>, <a class="el" href="pbx_8c_source.html#l09023">pbx_builtin_setvar_helper()</a>, <a class="el" href="pbx_8c_source.html#l01322">pbx_exec()</a>, <a class="el" href="pbx_8c_source.html#l01363">pbx_findapp()</a>, <a class="el" href="features_8c_source.html#l02331">pick_unlocked_cdr()</a>, <a class="el" href="channel_8h_source.html#l00596">ast_bridge_config::play_warning</a>, <a class="el" href="channel_8h_source.html#l00471">ast_channel::priority</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::ptr</a>, <a class="el" href="strings_8h_source.html#l00072">S_OR</a>, <a class="el" href="features_8c_source.html#l02342">set_bridge_features_on_config()</a>, <a class="el" href="features_8c_source.html#l02099">set_config_flags()</a>, <a class="el" href="cdr_8h_source.html#l00087">ast_cdr::start</a>, <a class="el" href="channel_8h_source.html#l00600">ast_bridge_config::start_sound</a>, <a class="el" href="channel_8h_source.html#l00591">ast_bridge_config::start_time</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, <a class="el" href="cdr_8h_source.html#l00106">ast_cdr::uniqueid</a>, <a class="el" href="cdr_8h_source.html#l00108">ast_cdr::userfield</a>, <a class="el" href="channel_8h_source.html#l00491">ast_channel::visible_indication</a>, <a class="el" href="channel_8h_source.html#l00597">ast_bridge_config::warning_freq</a>, and <a class="el" href="channel_8h_source.html#l00598">ast_bridge_config::warning_sound</a>.</p>

<p>Referenced by <a class="el" href="app__followme_8c_source.html#l01003">app_exec()</a>, <a class="el" href="features_8c_source.html#l00412">bridge_call_thread()</a>, <a class="el" href="features_8c_source.html#l04524">bridge_exec()</a>, <a class="el" href="features_8c_source.html#l01396">builtin_atxfer()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="features_8c_source.html#l03335">park_exec_full()</a>, and <a class="el" href="app__queue_8c_source.html#l03569">try_calling()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02442"></a>02442 {
<a name="l02443"></a>02443    <span class="comment">/* Copy voice back and forth between the two channels.  Give the peer</span>
<a name="l02444"></a>02444 <span class="comment">      the ability to transfer calls with &apos;#&lt;extension&apos; syntax. */</span>
<a name="l02445"></a>02445    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l02446"></a>02446    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *who;
<a name="l02447"></a>02447    <span class="keywordtype">char</span> chan_featurecode[<a class="code" href="features_8h.html#aaa72e2b220201e352ddedb91db4d7f31">FEATURE_MAX_LEN</a> + 1]=<span class="stringliteral">&quot;&quot;</span>;
<a name="l02448"></a>02448    <span class="keywordtype">char</span> peer_featurecode[<a class="code" href="features_8h.html#aaa72e2b220201e352ddedb91db4d7f31">FEATURE_MAX_LEN</a> + 1]=<span class="stringliteral">&quot;&quot;</span>;
<a name="l02449"></a>02449    <span class="keywordtype">char</span> orig_channame[<a class="code" href="channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>];
<a name="l02450"></a>02450    <span class="keywordtype">char</span> orig_peername[<a class="code" href="channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>];
<a name="l02451"></a>02451    <span class="keywordtype">int</span> res;
<a name="l02452"></a>02452    <span class="keywordtype">int</span> diff;
<a name="l02453"></a>02453    <span class="keywordtype">int</span> hasfeatures=0;
<a name="l02454"></a>02454    <span class="keywordtype">int</span> hadfeatures=0;
<a name="l02455"></a>02455    <span class="keywordtype">int</span> autoloopflag;
<a name="l02456"></a>02456    <span class="keyword">struct </span><a class="code" href="structast__option__header.html">ast_option_header</a> *aoh;
<a name="l02457"></a>02457    <span class="keyword">struct </span><a class="code" href="structast__bridge__config.html" title="bridge configuration">ast_bridge_config</a> backup_config;
<a name="l02458"></a>02458    <span class="keyword">struct </span><a class="code" href="structast__cdr.html" title="Responsible for call detail data.">ast_cdr</a> *bridge_cdr = NULL;
<a name="l02459"></a>02459    <span class="keyword">struct </span><a class="code" href="structast__cdr.html" title="Responsible for call detail data.">ast_cdr</a> *orig_peer_cdr = NULL;
<a name="l02460"></a>02460    <span class="keyword">struct </span><a class="code" href="structast__cdr.html" title="Responsible for call detail data.">ast_cdr</a> *chan_cdr = <a class="code" href="features_8c.html#a82ec1e5a1738ece6284922cf189ce3f2" title="return the first unlocked cdr in a possible chain">pick_unlocked_cdr</a>(chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>); <span class="comment">/* the proper chan cdr, if there are forked cdrs */</span>
<a name="l02461"></a>02461    <span class="keyword">struct </span><a class="code" href="structast__cdr.html" title="Responsible for call detail data.">ast_cdr</a> *peer_cdr = <a class="code" href="features_8c.html#a82ec1e5a1738ece6284922cf189ce3f2" title="return the first unlocked cdr in a possible chain">pick_unlocked_cdr</a>(peer-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>); <span class="comment">/* the proper chan cdr, if there are forked cdrs */</span>
<a name="l02462"></a>02462    <span class="keyword">struct </span><a class="code" href="structast__cdr.html" title="Responsible for call detail data.">ast_cdr</a> *new_chan_cdr = NULL; <span class="comment">/* the proper chan cdr, if there are forked cdrs */</span>
<a name="l02463"></a>02463    <span class="keyword">struct </span><a class="code" href="structast__cdr.html" title="Responsible for call detail data.">ast_cdr</a> *new_peer_cdr = NULL; <span class="comment">/* the proper chan cdr, if there are forked cdrs */</span>
<a name="l02464"></a>02464 
<a name="l02465"></a>02465    memset(&amp;backup_config, 0, <span class="keyword">sizeof</span>(backup_config));
<a name="l02466"></a>02466 
<a name="l02467"></a>02467    config-&gt;<a class="code" href="structast__bridge__config.html#ab83335d6897e2ea22f24b1b8afd95b0f">start_time</a> = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l02468"></a>02468 
<a name="l02469"></a>02469    <span class="keywordflow">if</span> (chan &amp;&amp; peer) {
<a name="l02470"></a>02470       <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;BRIDGEPEER&quot;</span>, peer-&gt;name);
<a name="l02471"></a>02471       <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(peer, <span class="stringliteral">&quot;BRIDGEPEER&quot;</span>, chan-&gt;name);
<a name="l02472"></a>02472    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (chan) {
<a name="l02473"></a>02473       <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;BLINDTRANSFER&quot;</span>, NULL);
<a name="l02474"></a>02474    }
<a name="l02475"></a>02475 
<a name="l02476"></a>02476    <a class="code" href="features_8c.html#aebf26a3de75e83d0137e596d85522436">set_bridge_features_on_config</a>(config, <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(chan, <span class="stringliteral">&quot;BRIDGE_FEATURES&quot;</span>));
<a name="l02477"></a>02477    <a class="code" href="features_8c.html#a3b41083253e12b6a71f4188e4e74a170">add_features_datastores</a>(chan, peer, config);
<a name="l02478"></a>02478 
<a name="l02479"></a>02479    <span class="comment">/* This is an interesting case.  One example is if a ringing channel gets redirected to</span>
<a name="l02480"></a>02480 <span class="comment">    * an extension that picks up a parked call.  This will make sure that the call taken</span>
<a name="l02481"></a>02481 <span class="comment">    * out of parking gets told that the channel it just got bridged to is still ringing. */</span>
<a name="l02482"></a>02482    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a> &amp;&amp; peer-&gt;<a class="code" href="structast__channel.html#a5ad10add51120d9c9122eca4201dd645">visible_indication</a> != <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a>) {
<a name="l02483"></a>02483       <a class="code" href="channel_8h.html#aef2af15a597c948e97628da6c5c84f28" title="Indicates condition of channel.">ast_indicate</a>(peer, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a>);
<a name="l02484"></a>02484    }
<a name="l02485"></a>02485 
<a name="l02486"></a>02486    <span class="keywordflow">if</span> (<a class="code" href="features_8c.html#a31438b92e816fd5c5b858f7424205aaa">monitor_ok</a>) {
<a name="l02487"></a>02487       <span class="keyword">const</span> <span class="keywordtype">char</span> *monitor_exec;
<a name="l02488"></a>02488       <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *src = NULL;
<a name="l02489"></a>02489       <span class="keywordflow">if</span> (!<a class="code" href="features_8c.html#a1a788862b8ee6dece692ce2b965fbfb3">monitor_app</a>) { 
<a name="l02490"></a>02490          <span class="keywordflow">if</span> (!(<a class="code" href="features_8c.html#a1a788862b8ee6dece692ce2b965fbfb3">monitor_app</a> = <a class="code" href="pbx_8h.html#a0db9808b647984133225652170b22b79" title="Look up an application.">pbx_findapp</a>(<span class="stringliteral">&quot;Monitor&quot;</span>)))
<a name="l02491"></a>02491             <a class="code" href="features_8c.html#a31438b92e816fd5c5b858f7424205aaa">monitor_ok</a>=0;
<a name="l02492"></a>02492       }
<a name="l02493"></a>02493       <span class="keywordflow">if</span> ((monitor_exec = <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(chan, <span class="stringliteral">&quot;AUTO_MONITOR&quot;</span>))) 
<a name="l02494"></a>02494          src = chan;
<a name="l02495"></a>02495       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((monitor_exec = <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(peer, <span class="stringliteral">&quot;AUTO_MONITOR&quot;</span>)))
<a name="l02496"></a>02496          src = peer;
<a name="l02497"></a>02497       <span class="keywordflow">if</span> (<a class="code" href="features_8c.html#a1a788862b8ee6dece692ce2b965fbfb3">monitor_app</a> &amp;&amp; src) {
<a name="l02498"></a>02498          <span class="keywordtype">char</span> *tmp = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(monitor_exec);
<a name="l02499"></a>02499          <a class="code" href="pbx_8h.html#afb87ff7a4504ef6031a45ae4170acaad" title="Execute an application.">pbx_exec</a>(src, <a class="code" href="features_8c.html#a1a788862b8ee6dece692ce2b965fbfb3">monitor_app</a>, tmp);
<a name="l02500"></a>02500       }
<a name="l02501"></a>02501    }
<a name="l02502"></a>02502 
<a name="l02503"></a>02503    <a class="code" href="features_8c.html#ae6d5d03f4835d75bcc1fbc119c646ddb">set_config_flags</a>(chan, peer, config);
<a name="l02504"></a>02504    config-&gt;<a class="code" href="structast__bridge__config.html#a1c72cdec53606007c15bd661d74d07d4">firstpass</a> = 1;
<a name="l02505"></a>02505 
<a name="l02506"></a>02506    <span class="comment">/* Answer if need be */</span>
<a name="l02507"></a>02507    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) {
<a name="l02508"></a>02508       <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a8b05a8419e1abb88ae5dde4070b6b7f6" title="Answer a channel.">ast_raw_answer</a>(chan, 1)) {
<a name="l02509"></a>02509          <span class="keywordflow">return</span> -1;
<a name="l02510"></a>02510       }
<a name="l02511"></a>02511    }
<a name="l02512"></a>02512 
<a name="l02513"></a>02513    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(orig_channame,chan-&gt;name,<span class="keyword">sizeof</span>(orig_channame));
<a name="l02514"></a>02514    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(orig_peername,peer-&gt;name,<span class="keyword">sizeof</span>(orig_peername));
<a name="l02515"></a>02515    orig_peer_cdr = peer_cdr;
<a name="l02516"></a>02516    
<a name="l02517"></a>02517    <span class="keywordflow">if</span> (!chan_cdr || (chan_cdr &amp;&amp; !<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan_cdr, <a class="code" href="cdr_8h.html#ad1c97f787a4ae3481dd9b48fef118572">AST_CDR_FLAG_POST_DISABLED</a>))) {
<a name="l02518"></a>02518       
<a name="l02519"></a>02519       <span class="keywordflow">if</span> (chan_cdr) {
<a name="l02520"></a>02520          <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(chan_cdr, <a class="code" href="cdr_8h.html#a171b52de554369b58cb121312f46bff1">AST_CDR_FLAG_MAIN</a>);
<a name="l02521"></a>02521          <a class="code" href="cdr_8h.html#a92b2e3b685887b48d228f7546ae1a9f1">ast_cdr_update</a>(chan);
<a name="l02522"></a>02522          bridge_cdr = <a class="code" href="cdr_8h.html#a7e8acc90934bc4647dd675a251d9e6ab" title="Duplicate a record.">ast_cdr_dup</a>(chan_cdr);
<a name="l02523"></a>02523          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#ae7697234189954ec7c6a81b4ab691b85">lastapp</a>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(chan-&gt;<a class="code" href="structast__channel.html#a1fe656155481623fac9882b1f79bc5a3">appl</a>, <span class="stringliteral">&quot;&quot;</span>), <span class="keyword">sizeof</span>(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#ae7697234189954ec7c6a81b4ab691b85">lastapp</a>));
<a name="l02524"></a>02524          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#a2176704f41b4368f2dfa94b64bfcfb6a">lastdata</a>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(chan-&gt;<a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>, <span class="stringliteral">&quot;&quot;</span>), <span class="keyword">sizeof</span>(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#a2176704f41b4368f2dfa94b64bfcfb6a">lastdata</a>));
<a name="l02525"></a>02525          <span class="keywordflow">if</span> (peer_cdr &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(peer_cdr-&gt;<a class="code" href="structast__cdr.html#a2d480b13820a3a97582a1a138036aa25">userfield</a>)) {
<a name="l02526"></a>02526             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#a2d480b13820a3a97582a1a138036aa25">userfield</a>, peer_cdr-&gt;<a class="code" href="structast__cdr.html#a2d480b13820a3a97582a1a138036aa25">userfield</a>, <span class="keyword">sizeof</span>(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#a2d480b13820a3a97582a1a138036aa25">userfield</a>));
<a name="l02527"></a>02527          }
<a name="l02528"></a>02528          <span class="keywordflow">if</span> (peer_cdr &amp;&amp; <a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(peer-&gt;accountcode)) {
<a name="l02529"></a>02529             <a class="code" href="cdr_8h.html#af6bbc762c1482a5489a761733d785813" title="Set account code, will generate AMI event.">ast_cdr_setaccount</a>(peer, chan-&gt;accountcode);
<a name="l02530"></a>02530          }
<a name="l02531"></a>02531 
<a name="l02532"></a>02532       } <span class="keywordflow">else</span> {
<a name="l02533"></a>02533          <span class="comment">/* better yet, in a xfer situation, find out why the chan cdr got zapped (pun unintentional) */</span>
<a name="l02534"></a>02534          bridge_cdr = <a class="code" href="cdr_8h.html#a29ba08b358224b4c820e5df826273b5b" title="Allocate a CDR record.">ast_cdr_alloc</a>(); <span class="comment">/* this should be really, really rare/impossible? */</span>
<a name="l02535"></a>02535          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#a6396dbd53fd6fedc1fc3ba2743f00eca">channel</a>, chan-&gt;name, <span class="keyword">sizeof</span>(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#a6396dbd53fd6fedc1fc3ba2743f00eca">channel</a>));
<a name="l02536"></a>02536          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#a0d43f7cac6179c7c4f9521f3138195b4">dstchannel</a>, peer-&gt;name, <span class="keyword">sizeof</span>(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#a0d43f7cac6179c7c4f9521f3138195b4">dstchannel</a>));
<a name="l02537"></a>02537          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#aa7a934e4f070b98b9113d24737a40ec5">uniqueid</a>, chan-&gt;uniqueid, <span class="keyword">sizeof</span>(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#aa7a934e4f070b98b9113d24737a40ec5">uniqueid</a>));
<a name="l02538"></a>02538          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#ae7697234189954ec7c6a81b4ab691b85">lastapp</a>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(chan-&gt;<a class="code" href="structast__channel.html#a1fe656155481623fac9882b1f79bc5a3">appl</a>, <span class="stringliteral">&quot;&quot;</span>), <span class="keyword">sizeof</span>(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#ae7697234189954ec7c6a81b4ab691b85">lastapp</a>));
<a name="l02539"></a>02539          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#a2176704f41b4368f2dfa94b64bfcfb6a">lastdata</a>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(chan-&gt;<a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>, <span class="stringliteral">&quot;&quot;</span>), <span class="keyword">sizeof</span>(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#a2176704f41b4368f2dfa94b64bfcfb6a">lastdata</a>));
<a name="l02540"></a>02540          <a class="code" href="cdr_8h.html#a19f0809fbe171d4223ae48808a27ac15" title="Initialize based on a channel.">ast_cdr_setcid</a>(bridge_cdr, chan);
<a name="l02541"></a>02541          bridge_cdr-&gt;<a class="code" href="structast__cdr.html#a1f9669e5d9d64aa831cd9db2dd71534f">disposition</a> = (chan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) ?  <a class="code" href="cdr_8h.html#ac7614ef6faaa8b913df85f229f0e037e">AST_CDR_ANSWERED</a> : <a class="code" href="cdr_8h.html#af20894acc82ed87553fc81355890f152">AST_CDR_NULL</a>;
<a name="l02542"></a>02542          bridge_cdr-&gt;<a class="code" href="structast__cdr.html#aa2112d5526f7d98a80d5da0abea1cc7d">amaflags</a> = chan-&gt;<a class="code" href="structast__channel.html#ad2cfb0f821c065261382a9298bb5a16b">amaflags</a> ? chan-&gt;<a class="code" href="structast__channel.html#ad2cfb0f821c065261382a9298bb5a16b">amaflags</a> :  <a class="code" href="cdr_8h.html#a40d6ca75f86ae72a310c1cdceab8d345">ast_default_amaflags</a>;
<a name="l02543"></a>02543          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>, chan-&gt;accountcode, <span class="keyword">sizeof</span>(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>));
<a name="l02544"></a>02544          <span class="comment">/* Destination information */</span>
<a name="l02545"></a>02545          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#ab30db746a1bf5c869a5dc9dbfaa864d4">dst</a>, chan-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, <span class="keyword">sizeof</span>(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#ab30db746a1bf5c869a5dc9dbfaa864d4">dst</a>));
<a name="l02546"></a>02546          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#af27d556683a4a28e6564618bcf00bec1">dcontext</a>, chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <span class="keyword">sizeof</span>(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#af27d556683a4a28e6564618bcf00bec1">dcontext</a>));
<a name="l02547"></a>02547          <span class="keywordflow">if</span> (peer_cdr) {
<a name="l02548"></a>02548             bridge_cdr-&gt;<a class="code" href="structast__cdr.html#ad80305b5e16da9c2675d5f057bd69386">start</a> = peer_cdr-&gt;<a class="code" href="structast__cdr.html#ad80305b5e16da9c2675d5f057bd69386">start</a>;
<a name="l02549"></a>02549             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#a2d480b13820a3a97582a1a138036aa25">userfield</a>, peer_cdr-&gt;<a class="code" href="structast__cdr.html#a2d480b13820a3a97582a1a138036aa25">userfield</a>, <span class="keyword">sizeof</span>(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#a2d480b13820a3a97582a1a138036aa25">userfield</a>));
<a name="l02550"></a>02550          } <span class="keywordflow">else</span> {
<a name="l02551"></a>02551             <a class="code" href="cdr_8h.html#af788ef701483a64b77656f272843bcd4" title="Start a call.">ast_cdr_start</a>(bridge_cdr);
<a name="l02552"></a>02552          }
<a name="l02553"></a>02553       }
<a name="l02554"></a>02554       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(4,<span class="stringliteral">&quot;bridge answer set, chan answer set\n&quot;</span>);
<a name="l02555"></a>02555       <span class="comment">/* peer_cdr-&gt;answer will be set when a macro runs on the peer;</span>
<a name="l02556"></a>02556 <span class="comment">         in that case, the bridge answer will be delayed while the</span>
<a name="l02557"></a>02557 <span class="comment">         macro plays on the peer channel. The peer answered the call</span>
<a name="l02558"></a>02558 <span class="comment">         before the macro started playing. To the phone system,</span>
<a name="l02559"></a>02559 <span class="comment">         this is billable time for the call, even tho the caller</span>
<a name="l02560"></a>02560 <span class="comment">         hears nothing but ringing while the macro does its thing. */</span>
<a name="l02561"></a>02561 
<a name="l02562"></a>02562       <span class="comment">/* Another case where the peer cdr&apos;s time will be set, is when</span>
<a name="l02563"></a>02563 <span class="comment">         A self-parks by pickup up phone and dialing 700, then B</span>
<a name="l02564"></a>02564 <span class="comment">         picks up A by dialing its parking slot; there may be more </span>
<a name="l02565"></a>02565 <span class="comment">         practical paths that get the same result, tho... in which</span>
<a name="l02566"></a>02566 <span class="comment">         case you get the previous answer time from the Park... which</span>
<a name="l02567"></a>02567 <span class="comment">         is before the bridge&apos;s start time, so I added in the </span>
<a name="l02568"></a>02568 <span class="comment">         tvcmp check to the if below */</span>
<a name="l02569"></a>02569 
<a name="l02570"></a>02570       <span class="keywordflow">if</span> (peer_cdr &amp;&amp; !<a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(peer_cdr-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a>) &amp;&amp; <a class="code" href="time_8h.html#acc9e13e54ed18f92956c748a38f82430" title="Compres two struct timeval instances returning -1, 0, 1 if the first arg is smaller...">ast_tvcmp</a>(peer_cdr-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a>, bridge_cdr-&gt;<a class="code" href="structast__cdr.html#ad80305b5e16da9c2675d5f057bd69386">start</a>) &gt;= 0) {
<a name="l02571"></a>02571          bridge_cdr-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a> = peer_cdr-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a>;
<a name="l02572"></a>02572          bridge_cdr-&gt;<a class="code" href="structast__cdr.html#a1f9669e5d9d64aa831cd9db2dd71534f">disposition</a> = peer_cdr-&gt;<a class="code" href="structast__cdr.html#a1f9669e5d9d64aa831cd9db2dd71534f">disposition</a>;
<a name="l02573"></a>02573          <span class="keywordflow">if</span> (chan_cdr) {
<a name="l02574"></a>02574             chan_cdr-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a> = peer_cdr-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a>;
<a name="l02575"></a>02575             chan_cdr-&gt;<a class="code" href="structast__cdr.html#a1f9669e5d9d64aa831cd9db2dd71534f">disposition</a> = peer_cdr-&gt;<a class="code" href="structast__cdr.html#a1f9669e5d9d64aa831cd9db2dd71534f">disposition</a>;
<a name="l02576"></a>02576          }
<a name="l02577"></a>02577       } <span class="keywordflow">else</span> {
<a name="l02578"></a>02578          <a class="code" href="cdr_8h.html#afec38ce5d72ac5bfda689d3a2c877012" title="Answer a call.">ast_cdr_answer</a>(bridge_cdr);
<a name="l02579"></a>02579          <span class="keywordflow">if</span> (chan_cdr) {
<a name="l02580"></a>02580             <a class="code" href="cdr_8h.html#afec38ce5d72ac5bfda689d3a2c877012" title="Answer a call.">ast_cdr_answer</a>(chan_cdr); <span class="comment">/* for the sake of cli status checks */</span>
<a name="l02581"></a>02581          }
<a name="l02582"></a>02582       }
<a name="l02583"></a>02583       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan,<a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a833a312f49eac50f239fd42dc9e61ffb">AST_FLAG_BRIDGE_HANGUP_DONT</a>) &amp;&amp; (chan_cdr || peer_cdr)) {
<a name="l02584"></a>02584          <span class="keywordflow">if</span> (chan_cdr) {
<a name="l02585"></a>02585             <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(chan_cdr, <a class="code" href="cdr_8h.html#a61e17153131c3f7832cf2f3224fcfec4">AST_CDR_FLAG_BRIDGED</a>);
<a name="l02586"></a>02586          }
<a name="l02587"></a>02587          <span class="keywordflow">if</span> (peer_cdr) {
<a name="l02588"></a>02588             <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(peer_cdr, <a class="code" href="cdr_8h.html#a61e17153131c3f7832cf2f3224fcfec4">AST_CDR_FLAG_BRIDGED</a>);
<a name="l02589"></a>02589          }
<a name="l02590"></a>02590       }
<a name="l02591"></a>02591    }
<a name="l02592"></a>02592    <span class="keywordflow">for</span> (;;) {
<a name="l02593"></a>02593       <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *other; <span class="comment">/* used later */</span>
<a name="l02594"></a>02594    
<a name="l02595"></a>02595       res = <a class="code" href="channel_8h.html#a475a9c0a7714ec4499b2fab283388a69" title="Bridge two channels together.">ast_channel_bridge</a>(chan, peer, config, &amp;f, &amp;who);
<a name="l02596"></a>02596       
<a name="l02597"></a>02597       <span class="comment">/* When frame is not set, we are probably involved in a situation</span>
<a name="l02598"></a>02598 <span class="comment">         where we&apos;ve timed out.</span>
<a name="l02599"></a>02599 <span class="comment">         When frame is set, we&apos;ll come this code twice; once for DTMF_BEGIN</span>
<a name="l02600"></a>02600 <span class="comment">         and also for DTMF_END. If we flow into the following &apos;if&apos; for both, then </span>
<a name="l02601"></a>02601 <span class="comment">         our wait times are cut in half, as both will subtract from the</span>
<a name="l02602"></a>02602 <span class="comment">         feature_timer. Not good!</span>
<a name="l02603"></a>02603 <span class="comment">      */</span>
<a name="l02604"></a>02604       <span class="keywordflow">if</span> (config-&gt;<a class="code" href="structast__bridge__config.html#af083a5b636f7b870cea1aea1eeadf6ff">feature_timer</a> &amp;&amp; (!f || f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a98e65764bc963016c394bcc1bad6540b">AST_FRAME_DTMF_END</a>)) {
<a name="l02605"></a>02605          <span class="comment">/* Update time limit for next pass */</span>
<a name="l02606"></a>02606          diff = <a class="code" href="time_8h.html#a74e35cffcd45ad6cd7c8587921e8a4c2" title="Computes the difference (in milliseconds) between two struct timeval instances.">ast_tvdiff_ms</a>(<a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>(), config-&gt;<a class="code" href="structast__bridge__config.html#ab83335d6897e2ea22f24b1b8afd95b0f">start_time</a>);
<a name="l02607"></a>02607          <span class="keywordflow">if</span> (res == <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05ac83c1441a620f7bdae5ef84692f8e7a5">AST_BRIDGE_RETRY</a>) {
<a name="l02608"></a>02608             <span class="comment">/* The feature fully timed out but has not been updated. Skip</span>
<a name="l02609"></a>02609 <span class="comment">             * the potential round error from the diff calculation and</span>
<a name="l02610"></a>02610 <span class="comment">             * explicitly set to expired. */</span>
<a name="l02611"></a>02611             config-&gt;<a class="code" href="structast__bridge__config.html#af083a5b636f7b870cea1aea1eeadf6ff">feature_timer</a> = -1;
<a name="l02612"></a>02612          } <span class="keywordflow">else</span> {
<a name="l02613"></a>02613             config-&gt;<a class="code" href="structast__bridge__config.html#af083a5b636f7b870cea1aea1eeadf6ff">feature_timer</a> -= diff;
<a name="l02614"></a>02614          }
<a name="l02615"></a>02615 
<a name="l02616"></a>02616          <span class="keywordflow">if</span> (hasfeatures) {
<a name="l02617"></a>02617             <span class="comment">/* Running on backup config, meaning a feature might be being</span>
<a name="l02618"></a>02618 <span class="comment">               activated, but that&apos;s no excuse to keep things going </span>
<a name="l02619"></a>02619 <span class="comment">               indefinitely! */</span>
<a name="l02620"></a>02620             <span class="keywordflow">if</span> (backup_config.feature_timer &amp;&amp; ((backup_config.feature_timer -= diff) &lt;= 0)) {
<a name="l02621"></a>02621                <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Timed out, realtime this time!\n&quot;</span>);
<a name="l02622"></a>02622                config-&gt;<a class="code" href="structast__bridge__config.html#af083a5b636f7b870cea1aea1eeadf6ff">feature_timer</a> = 0;
<a name="l02623"></a>02623                who = chan;
<a name="l02624"></a>02624                <span class="keywordflow">if</span> (f)
<a name="l02625"></a>02625                   <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l02626"></a>02626                f = NULL;
<a name="l02627"></a>02627                res = 0;
<a name="l02628"></a>02628             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (config-&gt;<a class="code" href="structast__bridge__config.html#af083a5b636f7b870cea1aea1eeadf6ff">feature_timer</a> &lt;= 0) {
<a name="l02629"></a>02629                <span class="comment">/* Not *really* out of time, just out of time for</span>
<a name="l02630"></a>02630 <span class="comment">                  digits to come in for features. */</span>
<a name="l02631"></a>02631                <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Timed out for feature!\n&quot;</span>);
<a name="l02632"></a>02632                <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(peer_featurecode)) {
<a name="l02633"></a>02633                   <a class="code" href="app_8h.html#af20b8ac2e28e659be352bbaecdf0ab03" title="Send DTMF to a channel.">ast_dtmf_stream</a>(chan, peer, peer_featurecode, 0, 0);
<a name="l02634"></a>02634                   memset(peer_featurecode, 0, <span class="keyword">sizeof</span>(peer_featurecode));
<a name="l02635"></a>02635                }
<a name="l02636"></a>02636                <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(chan_featurecode)) {
<a name="l02637"></a>02637                   <a class="code" href="app_8h.html#af20b8ac2e28e659be352bbaecdf0ab03" title="Send DTMF to a channel.">ast_dtmf_stream</a>(peer, chan, chan_featurecode, 0, 0);
<a name="l02638"></a>02638                   memset(chan_featurecode, 0, <span class="keyword">sizeof</span>(chan_featurecode));
<a name="l02639"></a>02639                }
<a name="l02640"></a>02640                <span class="keywordflow">if</span> (f)
<a name="l02641"></a>02641                   <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l02642"></a>02642                hasfeatures = !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(chan_featurecode) || !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(peer_featurecode);
<a name="l02643"></a>02643                <span class="keywordflow">if</span> (!hasfeatures) {
<a name="l02644"></a>02644                   <span class="comment">/* Restore original (possibly time modified) bridge config */</span>
<a name="l02645"></a>02645                   memcpy(config, &amp;backup_config, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__bridge__config.html" title="bridge configuration">ast_bridge_config</a>));
<a name="l02646"></a>02646                   memset(&amp;backup_config, 0, <span class="keyword">sizeof</span>(backup_config));
<a name="l02647"></a>02647                }
<a name="l02648"></a>02648                hadfeatures = hasfeatures;
<a name="l02649"></a>02649                <span class="comment">/* Continue as we were */</span>
<a name="l02650"></a>02650                <span class="keywordflow">continue</span>;
<a name="l02651"></a>02651             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!f) {
<a name="l02652"></a>02652                <span class="comment">/* The bridge returned without a frame and there is a feature in progress.</span>
<a name="l02653"></a>02653 <span class="comment">                * However, we don&apos;t think the feature has quite yet timed out, so just</span>
<a name="l02654"></a>02654 <span class="comment">                * go back into the bridge. */</span>
<a name="l02655"></a>02655                <span class="keywordflow">continue</span>;
<a name="l02656"></a>02656             }
<a name="l02657"></a>02657          } <span class="keywordflow">else</span> {
<a name="l02658"></a>02658             <span class="keywordflow">if</span> (config-&gt;<a class="code" href="structast__bridge__config.html#af083a5b636f7b870cea1aea1eeadf6ff">feature_timer</a> &lt;=0) {
<a name="l02659"></a>02659                <span class="comment">/* We ran out of time */</span>
<a name="l02660"></a>02660                config-&gt;<a class="code" href="structast__bridge__config.html#af083a5b636f7b870cea1aea1eeadf6ff">feature_timer</a> = 0;
<a name="l02661"></a>02661                who = chan;
<a name="l02662"></a>02662                <span class="keywordflow">if</span> (f)
<a name="l02663"></a>02663                   <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l02664"></a>02664                f = NULL;
<a name="l02665"></a>02665                res = 0;
<a name="l02666"></a>02666             }
<a name="l02667"></a>02667          }
<a name="l02668"></a>02668       }
<a name="l02669"></a>02669       <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l02670"></a>02670          <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a26796fa52cc5857446eec8d16a4b718d">AST_FLAG_ZOMBIE</a>) &amp;&amp; !<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(peer, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a26796fa52cc5857446eec8d16a4b718d">AST_FLAG_ZOMBIE</a>) &amp;&amp; !<a class="code" href="channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd" title="Check to see if a channel is needing hang up.">ast_check_hangup</a>(chan) &amp;&amp; !<a class="code" href="channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd" title="Check to see if a channel is needing hang up.">ast_check_hangup</a>(peer))
<a name="l02671"></a>02671             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Bridge failed on channels %s and %s\n&quot;</span>, chan-&gt;name, peer-&gt;name);
<a name="l02672"></a>02672          <span class="keywordflow">goto</span> before_you_go;
<a name="l02673"></a>02673       }
<a name="l02674"></a>02674       
<a name="l02675"></a>02675       <span class="keywordflow">if</span> (!f || (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a> &amp;&amp;
<a name="l02676"></a>02676             (f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> == <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa7dac1c1896ab418c2ff351aae707fba">AST_CONTROL_HANGUP</a> || f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> == <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875">AST_CONTROL_BUSY</a> || 
<a name="l02677"></a>02677                f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> == <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a850bb06a1702741c93a3fd67cc9637ab">AST_CONTROL_CONGESTION</a>))) {
<a name="l02678"></a>02678          res = -1;
<a name="l02679"></a>02679          <span class="keywordflow">break</span>;
<a name="l02680"></a>02680       }
<a name="l02681"></a>02681       <span class="comment">/* many things should be sent to the &apos;other&apos; channel */</span>
<a name="l02682"></a>02682       other = (who == chan) ? peer : chan;
<a name="l02683"></a>02683       <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>) {
<a name="l02684"></a>02684          <span class="keywordflow">switch</span> (f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>) {
<a name="l02685"></a>02685          <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a>:
<a name="l02686"></a>02686          <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ae8f2cd460fdc81e0a774434fa002e4bf">AST_CONTROL_FLASH</a>:
<a name="l02687"></a>02687          <span class="keywordflow">case</span> -1:
<a name="l02688"></a>02688             <a class="code" href="channel_8h.html#aef2af15a597c948e97628da6c5c84f28" title="Indicates condition of channel.">ast_indicate</a>(other, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>);
<a name="l02689"></a>02689             <span class="keywordflow">break</span>;
<a name="l02690"></a>02690          <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ab99a3d1c08c5ae8bca078c7cd1ec02f5">AST_CONTROL_HOLD</a>:
<a name="l02691"></a>02691          <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>:
<a name="l02692"></a>02692             <a class="code" href="channel_8h.html#aa8c3522af1bc639cbd5b38f5fdf171fa" title="Indicates condition of channel, with payload.">ast_indicate_data</a>(other, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>, f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>);
<a name="l02693"></a>02693             <span class="keywordflow">break</span>;
<a name="l02694"></a>02694          <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ac4106406e269667ff84ee49e0a634f94">AST_CONTROL_OPTION</a>:
<a name="l02695"></a>02695             aoh = f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>;
<a name="l02696"></a>02696             <span class="comment">/* Forward option Requests */</span>
<a name="l02697"></a>02697             <span class="keywordflow">if</span> (aoh &amp;&amp; aoh-&gt;flag == <a class="code" href="frame_8h.html#aaec646e296938635ffb97c5c7d6b05c8">AST_OPTION_FLAG_REQUEST</a>) {
<a name="l02698"></a>02698                <a class="code" href="channel_8h.html#adcfd8d241b6de48068ead143ac29978d" title="Sets an option on a channel.">ast_channel_setoption</a>(other, ntohs(aoh-&gt;option), aoh-&gt;<a class="code" href="structast__option__header.html#ac3c027f9a365f5741871df5ace13943f">data</a>, 
<a name="l02699"></a>02699                   f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> - <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__option__header.html">ast_option_header</a>), 0);
<a name="l02700"></a>02700             }
<a name="l02701"></a>02701             <span class="keywordflow">break</span>;
<a name="l02702"></a>02702          }
<a name="l02703"></a>02703       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a9b350360a64b55c7590f1ec03db480be">AST_FRAME_DTMF_BEGIN</a>) {
<a name="l02704"></a>02704          <span class="comment">/* eat it */</span>
<a name="l02705"></a>02705       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#a248afd6c02044259a386f6b7aee922a2">AST_FRAME_DTMF</a>) {
<a name="l02706"></a>02706          <span class="keywordtype">char</span> *featurecode;
<a name="l02707"></a>02707          <span class="keywordtype">int</span> sense;
<a name="l02708"></a>02708 
<a name="l02709"></a>02709          hadfeatures = hasfeatures;
<a name="l02710"></a>02710          <span class="comment">/* This cannot overrun because the longest feature is one shorter than our buffer */</span>
<a name="l02711"></a>02711          <span class="keywordflow">if</span> (who == chan) {
<a name="l02712"></a>02712             sense = <a class="code" href="features_8c.html#a43d76622becf50779cbf68a3419a42e5">FEATURE_SENSE_CHAN</a>;
<a name="l02713"></a>02713             featurecode = chan_featurecode;
<a name="l02714"></a>02714          } <span class="keywordflow">else</span>  {
<a name="l02715"></a>02715             sense = <a class="code" href="features_8c.html#a715d6b99230466c16f14e1d0fa77ffac">FEATURE_SENSE_PEER</a>;
<a name="l02716"></a>02716             featurecode = peer_featurecode;
<a name="l02717"></a>02717          }<span class="comment"></span>
<a name="l02718"></a>02718 <span class="comment">         /*! append the event to featurecode. we rely on the string being zero-filled, and</span>
<a name="l02719"></a>02719 <span class="comment">          * not overflowing it. </span>
<a name="l02720"></a>02720 <span class="comment">          * \todo XXX how do we guarantee the latter ?</span>
<a name="l02721"></a>02721 <span class="comment">          */</span>
<a name="l02722"></a>02722          featurecode[strlen(featurecode)] = f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>;
<a name="l02723"></a>02723          <span class="comment">/* Get rid of the frame before we start doing &quot;stuff&quot; with the channels */</span>
<a name="l02724"></a>02724          <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l02725"></a>02725          f = NULL;
<a name="l02726"></a>02726          config-&gt;<a class="code" href="structast__bridge__config.html#af083a5b636f7b870cea1aea1eeadf6ff">feature_timer</a> = backup_config.feature_timer;
<a name="l02727"></a>02727          res = <a class="code" href="features_8c.html#ae89302e12bbcc8ffec898244cc3b73fe" title="Check the dynamic features.">feature_interpret</a>(chan, peer, config, featurecode, sense);
<a name="l02728"></a>02728          <span class="keywordflow">switch</span>(res) {
<a name="l02729"></a>02729          <span class="keywordflow">case</span> <a class="code" href="features_8h.html#a6fe63cc369dcb5f31ee37b64cc68d4b2">AST_FEATURE_RETURN_PASSDIGITS</a>:
<a name="l02730"></a>02730             <a class="code" href="app_8h.html#af20b8ac2e28e659be352bbaecdf0ab03" title="Send DTMF to a channel.">ast_dtmf_stream</a>(other, who, featurecode, 0, 0);
<a name="l02731"></a>02731             <span class="comment">/* Fall through */</span>
<a name="l02732"></a>02732          <span class="keywordflow">case</span> <a class="code" href="features_8h.html#a262aca923fa7156c10fdc92c99d66bc7">AST_FEATURE_RETURN_SUCCESS</a>:
<a name="l02733"></a>02733             memset(featurecode, 0, <span class="keyword">sizeof</span>(chan_featurecode));
<a name="l02734"></a>02734             <span class="keywordflow">break</span>;
<a name="l02735"></a>02735          }
<a name="l02736"></a>02736          <span class="keywordflow">if</span> (res &gt;= <a class="code" href="features_8h.html#a6fe63cc369dcb5f31ee37b64cc68d4b2">AST_FEATURE_RETURN_PASSDIGITS</a>) {
<a name="l02737"></a>02737             res = 0;
<a name="l02738"></a>02738          } <span class="keywordflow">else</span> 
<a name="l02739"></a>02739             <span class="keywordflow">break</span>;
<a name="l02740"></a>02740          hasfeatures = !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(chan_featurecode) || !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(peer_featurecode);
<a name="l02741"></a>02741          <span class="keywordflow">if</span> (hadfeatures &amp;&amp; !hasfeatures) {
<a name="l02742"></a>02742             <span class="comment">/* Restore backup */</span>
<a name="l02743"></a>02743             memcpy(config, &amp;backup_config, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__bridge__config.html" title="bridge configuration">ast_bridge_config</a>));
<a name="l02744"></a>02744             memset(&amp;backup_config, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__bridge__config.html" title="bridge configuration">ast_bridge_config</a>));
<a name="l02745"></a>02745          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hasfeatures) {
<a name="l02746"></a>02746             <span class="keywordflow">if</span> (!hadfeatures) {
<a name="l02747"></a>02747                <span class="comment">/* Backup configuration */</span>
<a name="l02748"></a>02748                memcpy(&amp;backup_config, config, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__bridge__config.html" title="bridge configuration">ast_bridge_config</a>));
<a name="l02749"></a>02749                <span class="comment">/* Setup temporary config options */</span>
<a name="l02750"></a>02750                config-&gt;<a class="code" href="structast__bridge__config.html#af3d16394c849390df1c8f72569faeb37">play_warning</a> = 0;
<a name="l02751"></a>02751                <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(&amp;(config-&gt;<a class="code" href="structast__bridge__config.html#aa9510db9c5a776dfbd1aaab8c48970f0">features_caller</a>), <a class="code" href="channel_8h.html#a7495a48740c9d555f7fbcb48246dbd93ae6373d88ce4e9e5d9b7031272a9bc5ab">AST_FEATURE_PLAY_WARNING</a>);
<a name="l02752"></a>02752                <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(&amp;(config-&gt;<a class="code" href="structast__bridge__config.html#a725b051d26c3350f8cd04467b4202c60">features_callee</a>), <a class="code" href="channel_8h.html#a7495a48740c9d555f7fbcb48246dbd93ae6373d88ce4e9e5d9b7031272a9bc5ab">AST_FEATURE_PLAY_WARNING</a>);
<a name="l02753"></a>02753                config-&gt;<a class="code" href="structast__bridge__config.html#abc09654c9b36de6b0bd0bfd92d31c0c0">warning_freq</a> = 0;
<a name="l02754"></a>02754                config-&gt;<a class="code" href="structast__bridge__config.html#a1fa6cb6235cf4abe198a8561e3c18bae">warning_sound</a> = NULL;
<a name="l02755"></a>02755                config-&gt;<a class="code" href="structast__bridge__config.html#a0b23b4ebfc857809d07d1ced94c9a6eb">end_sound</a> = NULL;
<a name="l02756"></a>02756                config-&gt;<a class="code" href="structast__bridge__config.html#af134a8361d8611e10872c9c0f806ba64">start_sound</a> = NULL;
<a name="l02757"></a>02757                config-&gt;<a class="code" href="structast__bridge__config.html#a1c72cdec53606007c15bd661d74d07d4">firstpass</a> = 0;
<a name="l02758"></a>02758             }
<a name="l02759"></a>02759             config-&gt;<a class="code" href="structast__bridge__config.html#ab83335d6897e2ea22f24b1b8afd95b0f">start_time</a> = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l02760"></a>02760             config-&gt;<a class="code" href="structast__bridge__config.html#af083a5b636f7b870cea1aea1eeadf6ff">feature_timer</a> = <a class="code" href="features_8c.html#a846427c0fcd8e7f387e43b465f74e810">featuredigittimeout</a>;
<a name="l02761"></a>02761             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Set time limit to %ld\n&quot;</span>, config-&gt;<a class="code" href="structast__bridge__config.html#af083a5b636f7b870cea1aea1eeadf6ff">feature_timer</a>);
<a name="l02762"></a>02762          }
<a name="l02763"></a>02763       }
<a name="l02764"></a>02764       <span class="keywordflow">if</span> (f)
<a name="l02765"></a>02765          <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l02766"></a>02766 
<a name="l02767"></a>02767    }
<a name="l02768"></a>02768    before_you_go:
<a name="l02769"></a>02769 
<a name="l02770"></a>02770    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan,<a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a833a312f49eac50f239fd42dc9e61ffb">AST_FLAG_BRIDGE_HANGUP_DONT</a>)) {
<a name="l02771"></a>02771       <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(chan,<a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a833a312f49eac50f239fd42dc9e61ffb">AST_FLAG_BRIDGE_HANGUP_DONT</a>); <span class="comment">/* its job is done */</span>
<a name="l02772"></a>02772       <span class="keywordflow">if</span> (bridge_cdr) {
<a name="l02773"></a>02773          <a class="code" href="cdr_8h.html#a0a672ffbd29adf8622596a36ccb25e65" title="Discard and free a CDR record.">ast_cdr_discard</a>(bridge_cdr);
<a name="l02774"></a>02774          <span class="comment">/* QUESTION: should we copy bridge_cdr fields to the peer before we throw it away? */</span>
<a name="l02775"></a>02775       }
<a name="l02776"></a>02776       <span class="keywordflow">return</span> res; <span class="comment">/* if we shouldn&apos;t do the h-exten, we shouldn&apos;t do the bridge cdr, either! */</span>
<a name="l02777"></a>02777    }
<a name="l02778"></a>02778 
<a name="l02779"></a>02779    <span class="keywordflow">if</span> (config-&gt;<a class="code" href="structast__bridge__config.html#a03acb9e092c45d88e1fb9e146e5e554e">end_bridge_callback</a>) {
<a name="l02780"></a>02780       config-&gt;<a class="code" href="structast__bridge__config.html#a03acb9e092c45d88e1fb9e146e5e554e">end_bridge_callback</a>(config-&gt;<a class="code" href="structast__bridge__config.html#a30cb875f49910a9515ee92d8dfdf8b83">end_bridge_callback_data</a>);
<a name="l02781"></a>02781    }
<a name="l02782"></a>02782 
<a name="l02783"></a>02783    <span class="comment">/* run the hangup exten on the chan object IFF it was NOT involved in a parking situation </span>
<a name="l02784"></a>02784 <span class="comment">    * if it were, then chan belongs to a different thread now, and might have been hung up long</span>
<a name="l02785"></a>02785 <span class="comment">     * ago.</span>
<a name="l02786"></a>02786 <span class="comment">    */</span>
<a name="l02787"></a>02787    <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;(config-&gt;<a class="code" href="structast__bridge__config.html#aa9510db9c5a776dfbd1aaab8c48970f0">features_caller</a>),<a class="code" href="channel_8h.html#a7495a48740c9d555f7fbcb48246dbd93a84500213ed3a17d1959c36062a7ba474">AST_FEATURE_NO_H_EXTEN</a>) &amp;&amp;
<a name="l02788"></a>02788       <a class="code" href="pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7" title="Determine whether an extension exists.">ast_exists_extension</a>(chan, chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <span class="stringliteral">&quot;h&quot;</span>, 1, chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>)) {
<a name="l02789"></a>02789       <span class="keyword">struct </span><a class="code" href="structast__cdr.html" title="Responsible for call detail data.">ast_cdr</a> *swapper = NULL;
<a name="l02790"></a>02790       <span class="keywordtype">char</span> savelastapp[<a class="code" href="channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>];
<a name="l02791"></a>02791       <span class="keywordtype">char</span> savelastdata[<a class="code" href="channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>];
<a name="l02792"></a>02792       <span class="keywordtype">char</span> save_exten[<a class="code" href="channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>];
<a name="l02793"></a>02793       <span class="keywordtype">int</span>  save_prio;
<a name="l02794"></a>02794       <span class="keywordtype">int</span>  found = 0;   <span class="comment">/* set if we find at least one match */</span>
<a name="l02795"></a>02795       <span class="keywordtype">int</span>  spawn_error = 0;
<a name="l02796"></a>02796       
<a name="l02797"></a>02797       autoloopflag = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a5ff4f7a94a36fcc2b8628186cb643d4b">AST_FLAG_IN_AUTOLOOP</a>);
<a name="l02798"></a>02798       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a5ff4f7a94a36fcc2b8628186cb643d4b">AST_FLAG_IN_AUTOLOOP</a>);
<a name="l02799"></a>02799       <span class="keywordflow">if</span> (bridge_cdr &amp;&amp; <a class="code" href="options_8h.html#ac4df5fcd7bf0175ad37e2da65e91e75b">ast_opt_end_cdr_before_h_exten</a>) {
<a name="l02800"></a>02800          <a class="code" href="cdr_8h.html#a9884cbdaef20e9f266bc2220772bf52b" title="End a call.">ast_cdr_end</a>(bridge_cdr);
<a name="l02801"></a>02801       }
<a name="l02802"></a>02802       <span class="comment">/* swap the bridge cdr and the chan cdr for a moment, and let the endbridge</span>
<a name="l02803"></a>02803 <span class="comment">         dialplan code operate on it */</span>
<a name="l02804"></a>02804       <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l02805"></a>02805       <span class="keywordflow">if</span> (bridge_cdr) {
<a name="l02806"></a>02806          swapper = chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>;
<a name="l02807"></a>02807          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(savelastapp, bridge_cdr-&gt;<a class="code" href="structast__cdr.html#ae7697234189954ec7c6a81b4ab691b85">lastapp</a>, <span class="keyword">sizeof</span>(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#ae7697234189954ec7c6a81b4ab691b85">lastapp</a>));
<a name="l02808"></a>02808          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(savelastdata, bridge_cdr-&gt;<a class="code" href="structast__cdr.html#a2176704f41b4368f2dfa94b64bfcfb6a">lastdata</a>, <span class="keyword">sizeof</span>(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#a2176704f41b4368f2dfa94b64bfcfb6a">lastdata</a>));
<a name="l02809"></a>02809          chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a> = bridge_cdr;
<a name="l02810"></a>02810       }
<a name="l02811"></a>02811       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(save_exten, chan-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, <span class="keyword">sizeof</span>(save_exten));
<a name="l02812"></a>02812       save_prio = chan-&gt;<a class="code" href="structast__channel.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>;
<a name="l02813"></a>02813       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(chan-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, <span class="stringliteral">&quot;h&quot;</span>, <span class="keyword">sizeof</span>(chan-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>));
<a name="l02814"></a>02814       chan-&gt;<a class="code" href="structast__channel.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> = 1;
<a name="l02815"></a>02815       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l02816"></a>02816       <span class="keywordflow">while</span> ((spawn_error = <a class="code" href="pbx_8h.html#a94ca71e502d95d1cb0a815072e059aee" title="Launch a new extension (i.e. new stack).">ast_spawn_extension</a>(chan, chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, chan-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, chan-&gt;<a class="code" href="structast__channel.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>, chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>, &amp;found, 1)) == 0) {
<a name="l02817"></a>02817          chan-&gt;<a class="code" href="structast__channel.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>++;
<a name="l02818"></a>02818       }
<a name="l02819"></a>02819       <span class="keywordflow">if</span> (spawn_error &amp;&amp; (!<a class="code" href="pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7" title="Determine whether an extension exists.">ast_exists_extension</a>(chan, chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, chan-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, chan-&gt;<a class="code" href="structast__channel.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>, chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>) || <a class="code" href="channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd" title="Check to see if a channel is needing hang up.">ast_check_hangup</a>(chan))) {
<a name="l02820"></a>02820          <span class="comment">/* if the extension doesn&apos;t exist or a hangup occurred, this isn&apos;t really a spawn error */</span>
<a name="l02821"></a>02821          spawn_error = 0;
<a name="l02822"></a>02822       }
<a name="l02823"></a>02823       <span class="keywordflow">if</span> (found &amp;&amp; spawn_error) {
<a name="l02824"></a>02824          <span class="comment">/* Something bad happened, or a hangup has been requested. */</span>
<a name="l02825"></a>02825          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Spawn extension (%s,%s,%d) exited non-zero on &apos;%s&apos;\n&quot;</span>, chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, chan-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, chan-&gt;<a class="code" href="structast__channel.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>, chan-&gt;name);
<a name="l02826"></a>02826          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Spawn extension (%s, %s, %d) exited non-zero on &apos;%s&apos;\n&quot;</span>, chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, chan-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, chan-&gt;<a class="code" href="structast__channel.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>, chan-&gt;name);
<a name="l02827"></a>02827       }
<a name="l02828"></a>02828       <span class="comment">/* swap it back */</span>
<a name="l02829"></a>02829       <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l02830"></a>02830       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(chan-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, save_exten, <span class="keyword">sizeof</span>(chan-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>));
<a name="l02831"></a>02831       chan-&gt;<a class="code" href="structast__channel.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> = save_prio;
<a name="l02832"></a>02832       <span class="keywordflow">if</span> (bridge_cdr) {
<a name="l02833"></a>02833          <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a> == bridge_cdr) {
<a name="l02834"></a>02834             chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a> = swapper;
<a name="l02835"></a>02835          } <span class="keywordflow">else</span> {
<a name="l02836"></a>02836             bridge_cdr = NULL;
<a name="l02837"></a>02837          }
<a name="l02838"></a>02838       }
<a name="l02839"></a>02839       <span class="keywordflow">if</span> (!spawn_error) {
<a name="l02840"></a>02840          <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a3f96b2798b1f93fa27bc2dff7dfd9a26">AST_FLAG_BRIDGE_HANGUP_RUN</a>);
<a name="l02841"></a>02841       }
<a name="l02842"></a>02842       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l02843"></a>02843       <span class="comment">/* protect the lastapp/lastdata against the effects of the hangup/dialplan code */</span>
<a name="l02844"></a>02844       <span class="keywordflow">if</span> (bridge_cdr) {
<a name="l02845"></a>02845          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#ae7697234189954ec7c6a81b4ab691b85">lastapp</a>, savelastapp, <span class="keyword">sizeof</span>(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#ae7697234189954ec7c6a81b4ab691b85">lastapp</a>));
<a name="l02846"></a>02846          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#a2176704f41b4368f2dfa94b64bfcfb6a">lastdata</a>, savelastdata, <span class="keyword">sizeof</span>(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#a2176704f41b4368f2dfa94b64bfcfb6a">lastdata</a>));
<a name="l02847"></a>02847       }
<a name="l02848"></a>02848       <a class="code" href="utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(chan, autoloopflag, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a5ff4f7a94a36fcc2b8628186cb643d4b">AST_FLAG_IN_AUTOLOOP</a>);
<a name="l02849"></a>02849    }
<a name="l02850"></a>02850    
<a name="l02851"></a>02851    <span class="comment">/* obey the NoCDR() wishes. -- move the DISABLED flag to the bridge CDR if it was set on the channel during the bridge... */</span>
<a name="l02852"></a>02852    new_chan_cdr = <a class="code" href="features_8c.html#a82ec1e5a1738ece6284922cf189ce3f2" title="return the first unlocked cdr in a possible chain">pick_unlocked_cdr</a>(chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>); <span class="comment">/* the proper chan cdr, if there are forked cdrs */</span>
<a name="l02853"></a>02853    <span class="keywordflow">if</span> (bridge_cdr &amp;&amp; new_chan_cdr &amp;&amp; <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(new_chan_cdr, <a class="code" href="cdr_8h.html#ad1c97f787a4ae3481dd9b48fef118572">AST_CDR_FLAG_POST_DISABLED</a>))
<a name="l02854"></a>02854       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(bridge_cdr, <a class="code" href="cdr_8h.html#ad1c97f787a4ae3481dd9b48fef118572">AST_CDR_FLAG_POST_DISABLED</a>);
<a name="l02855"></a>02855 
<a name="l02856"></a>02856    <span class="comment">/* we can post the bridge CDR at this point */</span>
<a name="l02857"></a>02857    <span class="keywordflow">if</span> (bridge_cdr) {
<a name="l02858"></a>02858       <a class="code" href="cdr_8h.html#a9884cbdaef20e9f266bc2220772bf52b" title="End a call.">ast_cdr_end</a>(bridge_cdr);
<a name="l02859"></a>02859       <a class="code" href="cdr_8h.html#aaac5bba86e430704119f70df937701f8" title="Detaches the detail record for posting (and freeing) either now or at a later time...">ast_cdr_detach</a>(bridge_cdr);
<a name="l02860"></a>02860    }
<a name="l02861"></a>02861    
<a name="l02862"></a>02862    <span class="comment">/* do a specialized reset on the beginning channel</span>
<a name="l02863"></a>02863 <span class="comment">      CDR&apos;s, if they still exist, so as not to mess up</span>
<a name="l02864"></a>02864 <span class="comment">      issues in future bridges;</span>
<a name="l02865"></a>02865 <span class="comment">      </span>
<a name="l02866"></a>02866 <span class="comment">      Here are the rules of the game:</span>
<a name="l02867"></a>02867 <span class="comment">      1. The chan and peer channel pointers will not change</span>
<a name="l02868"></a>02868 <span class="comment">         during the life of the bridge.</span>
<a name="l02869"></a>02869 <span class="comment">      2. But, in transfers, the channel names will change.</span>
<a name="l02870"></a>02870 <span class="comment">         between the time the bridge is started, and the</span>
<a name="l02871"></a>02871 <span class="comment">         time the channel ends. </span>
<a name="l02872"></a>02872 <span class="comment">         Usually, when a channel changes names, it will</span>
<a name="l02873"></a>02873 <span class="comment">         also change CDR pointers.</span>
<a name="l02874"></a>02874 <span class="comment">      3. Usually, only one of the two channels (chan or peer)</span>
<a name="l02875"></a>02875 <span class="comment">         will change names.</span>
<a name="l02876"></a>02876 <span class="comment">      4. Usually, if a channel changes names during a bridge,</span>
<a name="l02877"></a>02877 <span class="comment">         it is because of a transfer. Usually, in these situations,</span>
<a name="l02878"></a>02878 <span class="comment">         it is normal to see 2 bridges running simultaneously, and</span>
<a name="l02879"></a>02879 <span class="comment">         it is not unusual to see the two channels that change</span>
<a name="l02880"></a>02880 <span class="comment">         swapped between bridges.</span>
<a name="l02881"></a>02881 <span class="comment">      5. After a bridge occurs, we have 2 or 3 channels&apos; CDRs</span>
<a name="l02882"></a>02882 <span class="comment">         to attend to; if the chan or peer changed names,</span>
<a name="l02883"></a>02883 <span class="comment">         we have the before and after attached CDR&apos;s.</span>
<a name="l02884"></a>02884 <span class="comment">   */</span>
<a name="l02885"></a>02885    
<a name="l02886"></a>02886    <span class="keywordflow">if</span> (new_chan_cdr) {
<a name="l02887"></a>02887       <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *chan_ptr = NULL;
<a name="l02888"></a>02888  
<a name="l02889"></a>02889       <span class="keywordflow">if</span> (strcasecmp(orig_channame, chan-&gt;name) != 0) { 
<a name="l02890"></a>02890          <span class="comment">/* old channel */</span>
<a name="l02891"></a>02891          chan_ptr = <a class="code" href="channel_8h.html#a03e8287876c59ddc00f5567064b2b9ca" title="Get channel by name or uniqueid (locks channel).">ast_get_channel_by_name_locked</a>(orig_channame);
<a name="l02892"></a>02892          <span class="keywordflow">if</span> (chan_ptr) {
<a name="l02893"></a>02893             <span class="keywordflow">if</span> (!<a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(chan_ptr)) {
<a name="l02894"></a>02894                <span class="keyword">struct </span><a class="code" href="structast__cdr.html" title="Responsible for call detail data.">ast_cdr</a> *cur;
<a name="l02895"></a>02895                <span class="keywordflow">for</span> (cur = chan_ptr-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>; cur; cur = cur-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>) {
<a name="l02896"></a>02896                   <span class="keywordflow">if</span> (cur == chan_cdr) {
<a name="l02897"></a>02897                      <span class="keywordflow">break</span>;
<a name="l02898"></a>02898                   }
<a name="l02899"></a>02899                }
<a name="l02900"></a>02900                <span class="keywordflow">if</span> (cur)
<a name="l02901"></a>02901                   <a class="code" href="cdr_8h.html#af676cf6077871ee6988a5defa6f81798">ast_cdr_specialized_reset</a>(chan_cdr,0);
<a name="l02902"></a>02902             }
<a name="l02903"></a>02903             <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan_ptr);
<a name="l02904"></a>02904          }
<a name="l02905"></a>02905          <span class="comment">/* new channel */</span>
<a name="l02906"></a>02906          <a class="code" href="cdr_8h.html#af676cf6077871ee6988a5defa6f81798">ast_cdr_specialized_reset</a>(new_chan_cdr,0);
<a name="l02907"></a>02907       } <span class="keywordflow">else</span> {
<a name="l02908"></a>02908          <a class="code" href="cdr_8h.html#af676cf6077871ee6988a5defa6f81798">ast_cdr_specialized_reset</a>(chan_cdr,0); <span class="comment">/* nothing changed, reset the chan_cdr  */</span>
<a name="l02909"></a>02909       }
<a name="l02910"></a>02910    }
<a name="l02911"></a>02911    
<a name="l02912"></a>02912    {
<a name="l02913"></a>02913       <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *chan_ptr = NULL;
<a name="l02914"></a>02914       new_peer_cdr = <a class="code" href="features_8c.html#a82ec1e5a1738ece6284922cf189ce3f2" title="return the first unlocked cdr in a possible chain">pick_unlocked_cdr</a>(peer-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>); <span class="comment">/* the proper chan cdr, if there are forked cdrs */</span>
<a name="l02915"></a>02915       <span class="keywordflow">if</span> (new_chan_cdr &amp;&amp; <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(new_chan_cdr, <a class="code" href="cdr_8h.html#ad1c97f787a4ae3481dd9b48fef118572">AST_CDR_FLAG_POST_DISABLED</a>) &amp;&amp; new_peer_cdr &amp;&amp; !<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(new_peer_cdr, <a class="code" href="cdr_8h.html#ad1c97f787a4ae3481dd9b48fef118572">AST_CDR_FLAG_POST_DISABLED</a>))
<a name="l02916"></a>02916          <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(new_peer_cdr, <a class="code" href="cdr_8h.html#ad1c97f787a4ae3481dd9b48fef118572">AST_CDR_FLAG_POST_DISABLED</a>); <span class="comment">/* DISABLED is viral-- it will propagate across a bridge */</span>
<a name="l02917"></a>02917       <span class="keywordflow">if</span> (strcasecmp(orig_peername, peer-&gt;name) != 0) { 
<a name="l02918"></a>02918          <span class="comment">/* old channel */</span>
<a name="l02919"></a>02919          chan_ptr = <a class="code" href="channel_8h.html#a03e8287876c59ddc00f5567064b2b9ca" title="Get channel by name or uniqueid (locks channel).">ast_get_channel_by_name_locked</a>(orig_peername);
<a name="l02920"></a>02920          <span class="keywordflow">if</span> (chan_ptr) {
<a name="l02921"></a>02921             <span class="keywordflow">if</span> (!<a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(chan_ptr)) {
<a name="l02922"></a>02922                <span class="keyword">struct </span><a class="code" href="structast__cdr.html" title="Responsible for call detail data.">ast_cdr</a> *cur;
<a name="l02923"></a>02923                <span class="keywordflow">for</span> (cur = chan_ptr-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>; cur; cur = cur-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>) {
<a name="l02924"></a>02924                   <span class="keywordflow">if</span> (cur == peer_cdr) {
<a name="l02925"></a>02925                      <span class="keywordflow">break</span>;
<a name="l02926"></a>02926                   }
<a name="l02927"></a>02927                }
<a name="l02928"></a>02928                <span class="keywordflow">if</span> (cur)
<a name="l02929"></a>02929                   <a class="code" href="cdr_8h.html#af676cf6077871ee6988a5defa6f81798">ast_cdr_specialized_reset</a>(peer_cdr,0);
<a name="l02930"></a>02930             }
<a name="l02931"></a>02931             <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan_ptr);
<a name="l02932"></a>02932          }
<a name="l02933"></a>02933          <span class="comment">/* new channel */</span>
<a name="l02934"></a>02934          <span class="keywordflow">if</span> (new_peer_cdr) {
<a name="l02935"></a>02935             <a class="code" href="cdr_8h.html#af676cf6077871ee6988a5defa6f81798">ast_cdr_specialized_reset</a>(new_peer_cdr, 0);
<a name="l02936"></a>02936          }
<a name="l02937"></a>02937       } <span class="keywordflow">else</span> {
<a name="l02938"></a>02938          <a class="code" href="cdr_8h.html#af676cf6077871ee6988a5defa6f81798">ast_cdr_specialized_reset</a>(peer_cdr,0); <span class="comment">/* nothing changed, reset the peer_cdr  */</span>
<a name="l02939"></a>02939       }
<a name="l02940"></a>02940    }
<a name="l02941"></a>02941    
<a name="l02942"></a>02942    <span class="keywordflow">return</span> res;
<a name="l02943"></a>02943 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a425ed69a5937fc5a26508084a11ceb47"></a><!-- doxytag: member="features.h::ast_features_reload" ref="a425ed69a5937fc5a26508084a11ceb47" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_features_reload </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reload call features from features.conf. </p>

<p>Definition at line <a class="el" href="features_8c_source.html#l04079">4079</a> of file <a class="el" href="features_8c_source.html">features.c</a>.</p>

<p>References <a class="el" href="features_8c_source.html#l03672">load_config()</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l04093">handle_features_reload()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04080"></a>04080 {
<a name="l04081"></a>04081    <span class="keywordtype">int</span> res;
<a name="l04082"></a>04082    <span class="comment">/* Release parking lot list */</span>
<a name="l04083"></a>04083    <span class="comment">//ASTOBJ_CONTAINER_MARKALL(&amp;parkinglots);</span>
<a name="l04084"></a>04084    <span class="comment">// TODO: I don&apos;t think any marking is necessary</span>
<a name="l04085"></a>04085 
<a name="l04086"></a>04086    <span class="comment">/* Reload configuration */</span>
<a name="l04087"></a>04087    res = <a class="code" href="features_8c.html#aed5779f84d4ebb67745d801d3ebede43">load_config</a>();
<a name="l04088"></a>04088    
<a name="l04089"></a>04089    <span class="comment">//ASTOBJ_CONTAINER_PRUNE_MARKED(&amp;parkinglots, parkinglot_destroy);</span>
<a name="l04090"></a>04090    <span class="keywordflow">return</span> res;
<a name="l04091"></a>04091 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afe968c2bd566a03c0bc212faa7a37e17"></a><!-- doxytag: member="features.h::ast_find_call_feature" ref="afe968c2bd566a03c0bc212faa7a37e17" args="(const char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__call__feature.html">ast_call_feature</a>* ast_find_call_feature </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>look for a call feature entry by its sname </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>a string ptr, should match "automon", "blindxfer", "atxfer", etc. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="features_8c_source.html#l01884">1884</a> of file <a class="el" href="features_8c_source.html">features.c</a>.</p>

<p>References <a class="el" href="features_8c_source.html#l01693">FEATURES_COUNT</a>, and <a class="el" href="features_8h_source.html#l00053">ast_call_feature::sname</a>.</p>

<p>Referenced by <a class="el" href="manager_8c_source.html#l02168">action_atxfer()</a>, <a class="el" href="chan__sip_8c_source.html#l16615">handle_request_info()</a>, and <a class="el" href="features_8c_source.html#l03672">load_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01885"></a>01885 {
<a name="l01886"></a>01886    <span class="keywordtype">int</span> x;
<a name="l01887"></a>01887    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="features_8c.html#a6b4ef6d37a4790e15ce87945840cc350">FEATURES_COUNT</a>; x++) {
<a name="l01888"></a>01888       <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <a class="code" href="features_8c.html#a51fb76347e22614ff1495de1af0c5e62">builtin_features</a>[x].sname))
<a name="l01889"></a>01889          <span class="keywordflow">return</span> &amp;<a class="code" href="features_8c.html#a51fb76347e22614ff1495de1af0c5e62">builtin_features</a>[x];
<a name="l01890"></a>01890    }
<a name="l01891"></a>01891    <span class="keywordflow">return</span> NULL;
<a name="l01892"></a>01892 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a70a2de2bf789996ae5e66142294ca18f"></a><!-- doxytag: member="features.h::ast_masq_park_call" ref="a70a2de2bf789996ae5e66142294ca18f" args="(struct ast_channel *rchan, struct ast_channel *host, int timeout, int *extout)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_masq_park_call </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>rchan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>host</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>timeout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>extout</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Park a call via a masqueraded channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rchan</em>&nbsp;</td><td>the real channel to be parked </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>host</em>&nbsp;</td><td>the channel to have the parking read to. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>timeout</em>&nbsp;</td><td>is a timeout in milliseconds </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>extout</em>&nbsp;</td><td>is a parameter to an int that will hold the parked location, or NULL if you want.</td></tr>
  </table>
  </dd>
</dl>
<p>Masquerade the channel rchan into a new, empty channel which is then parked with ast_park_call </p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="features_8c_source.html#l00894">894</a> of file <a class="el" href="features_8c_source.html">features.c</a>.</p>

<p>References <a class="el" href="features_8c_source.html#l00833">masq_park_call()</a>.</p>

<p>Referenced by <a class="el" href="res__agi_8c_source.html#l01718">handle_exec()</a>, <a class="el" href="chan__skinny_8c_source.html#l05662">handle_soft_key_event_message()</a>, <a class="el" href="chan__skinny_8c_source.html#l04699">handle_stimulus_message()</a>, <a class="el" href="features_8c_source.html#l04401">manager_park()</a>, <a class="el" href="chan__mgcp_8c_source.html#l02637">mgcp_ss()</a>, <a class="el" href="app__parkandannounce_8c_source.html#l00088">parkandannounce_exec()</a>, <a class="el" href="app__rpt_8c_source.html#l13122">rpt_exec()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00895"></a>00895 {
<a name="l00896"></a>00896    <span class="keywordflow">return</span> <a class="code" href="features_8c.html#a87a222a1d617d1917126357f27861442">masq_park_call</a>(rchan, peer, timeout, extout, 0, NULL);
<a name="l00897"></a>00897 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a502948a22446cb0c97d19fc4783b2b5a"></a><!-- doxytag: member="features.h::ast_park_call" ref="a502948a22446cb0c97d19fc4783b2b5a" args="(struct ast_channel *chan, struct ast_channel *host, int timeout, int *extout)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_park_call </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>timeout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>extout</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Park a call and read back parked location. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>the channel to actually be parked </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>host</em>&nbsp;</td><td>the channel which will have the parked location read to. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>timeout</em>&nbsp;</td><td>is a timeout in milliseconds </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>extout</em>&nbsp;</td><td>is a parameter to an int that will hold the parked location, or NULL if you want.</td></tr>
  </table>
  </dd>
</dl>
<p>Park the channel chan, and read back the parked location to the host. If the call is not picked up within a specified period of time, then the call will return to the last step that it was in (in terms of exten, priority and context) </p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="features_8c_source.html#l00823">823</a> of file <a class="el" href="features_8c_source.html">features.c</a>.</p>

<p>References <a class="el" href="features_8c_source.html#l00678">park_call_full()</a>, and <a class="el" href="features_8c_source.html#l00553">ast_park_call_args::timeout</a>.</p>

<p>Referenced by <a class="el" href="chan__iax2_8c_source.html#l08921">iax_park_thread()</a>, and <a class="el" href="chan__sip_8c_source.html#l18706">sip_park_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00824"></a>00824 {
<a name="l00825"></a>00825    <span class="keyword">struct </span><a class="code" href="structast__park__call__args.html">ast_park_call_args</a> args = {
<a name="l00826"></a>00826       .timeout = <a class="code" href="structast__park__call__args.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>,
<a name="l00827"></a>00827       .extout = <a class="code" href="structast__park__call__args.html#a1d7b0cf33a765e5f0f70e0535709fe9e">extout</a>,
<a name="l00828"></a>00828    };
<a name="l00829"></a>00829 
<a name="l00830"></a>00830    <span class="keywordflow">return</span> <a class="code" href="features_8c.html#af750802cffe6ab46e36412a8a47a68e2">park_call_full</a>(chan, peer, &amp;args);
<a name="l00831"></a>00831 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a716860609c92cd4b7fb8f6eb724ac700"></a><!-- doxytag: member="features.h::ast_parking_ext" ref="a716860609c92cd4b7fb8f6eb724ac700" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* ast_parking_ext </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Determine system parking <a class="el" href="structextension.html">extension</a>. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>the call parking <a class="el" href="structextension.html">extension</a> for drivers that provide special call parking help </dd></dl>

<p>Definition at line <a class="el" href="features_8c_source.html#l00315">315</a> of file <a class="el" href="features_8c_source.html">features.c</a>.</p>

<p>References <a class="el" href="features_8c_source.html#l00239">parking_ext</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l03554">build_parkinglot()</a>, <a class="el" href="features_8c_source.html#l01396">builtin_atxfer()</a>, <a class="el" href="features_8c_source.html#l01265">builtin_blindtransfer()</a>, <a class="el" href="chan__iax2_8c_source.html#l08855">dp_lookup()</a>, <a class="el" href="chan__sip_8c_source.html#l20572">handle_request_refer()</a>, <a class="el" href="features_8c_source.html#l03672">load_config()</a>, <a class="el" href="chan__mgcp_8c_source.html#l02637">mgcp_ss()</a>, <a class="el" href="chan__iax2_8c_source.html#l09458">socket_process()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00316"></a>00316 {
<a name="l00317"></a>00317    <span class="keywordflow">return</span> <a class="code" href="features_8c.html#aab2f16f83e13b9eeac2c69a864d877ed">parking_ext</a>;
<a name="l00318"></a>00318 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4890be42c2add5f52028705d6bc02201"></a><!-- doxytag: member="features.h::ast_pickup_call" ref="a4890be42c2add5f52028705d6bc02201" args="(struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_pickup_call </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Pickup a call. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel that initiated pickup.</td></tr>
  </table>
  </dd>
</dl>
<p>Walk list of <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>, checking it is not itself, channel is pbx one, check that the callgroup for both <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> are the same and the channel is ringing. Answer calling channel, flag channel as answered on queue, masq <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> together. </p>

<p>Definition at line <a class="el" href="features_8c_source.html#l04475">4475</a> of file <a class="el" href="features_8c_source.html">features.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l01951">ast_answer()</a>, <a class="el" href="channel_8c_source.html#l04217">ast_channel_masquerade()</a>, <a class="el" href="channel_8c_source.html#l01310">ast_channel_search_locked()</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="frame_8h_source.html#l00301">AST_CONTROL_ANSWER</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8c_source.html#l01123">ast_queue_control()</a>, <a class="el" href="file_8c_source.html#l01342">ast_stream_and_wait()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="features_8c_source.html#l04455">find_channel_by_group()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="features_8c_source.html#l00246">pickupfailsound</a>, and <a class="el" href="features_8c_source.html#l00245">pickupsound</a>.</p>

<p>Referenced by <a class="el" href="chan__misdn_8c_source.html#l04379">cb_events()</a>, <a class="el" href="chan__sip_8c_source.html#l19641">handle_request_invite()</a>, <a class="el" href="chan__mgcp_8c_source.html#l02637">mgcp_ss()</a>, <a class="el" href="app__directed__pickup_8c_source.html#l00235">pickup_exec()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04476"></a>04476 {
<a name="l04477"></a>04477    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *cur = <a class="code" href="channel_8h.html#a4c61dfe488472b90f811c319cdba7741" title="Search for a channel based on the passed channel matching callback Search for a channel...">ast_channel_search_locked</a>(<a class="code" href="features_8c.html#a1d1eac183cc14bd4a8bc679fc68200e4">find_channel_by_group</a>, chan);
<a name="l04478"></a>04478 
<a name="l04479"></a>04479    <span class="keywordflow">if</span> (cur) {
<a name="l04480"></a>04480       <span class="keywordtype">int</span> res = -1;
<a name="l04481"></a>04481       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Call pickup on chan &apos;%s&apos; by &apos;%s&apos;\n&quot;</span>,cur-&gt;name, chan-&gt;name);
<a name="l04482"></a>04482       res = <a class="code" href="channel_8h.html#aec583a3e25358ee552a4f3df53914cd0" title="Answer a channel.">ast_answer</a>(chan);
<a name="l04483"></a>04483       <span class="keywordflow">if</span> (res)
<a name="l04484"></a>04484          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to answer &apos;%s&apos;\n&quot;</span>, chan-&gt;name);
<a name="l04485"></a>04485       res = <a class="code" href="channel_8h.html#a60f9d2b0ab8b7a839902313321163b28" title="Queue a control frame with payload.">ast_queue_control</a>(chan, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>);
<a name="l04486"></a>04486       <span class="keywordflow">if</span> (res)
<a name="l04487"></a>04487          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to queue answer on &apos;%s&apos;\n&quot;</span>, chan-&gt;name);
<a name="l04488"></a>04488       res = <a class="code" href="channel_8h.html#a84fa04f019436467dc17f9bdd5341dce" title="Weird function made for call transfers.">ast_channel_masquerade</a>(cur, chan);
<a name="l04489"></a>04489       <span class="keywordflow">if</span> (res)
<a name="l04490"></a>04490          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to masquerade &apos;%s&apos; into &apos;%s&apos;\n&quot;</span>, chan-&gt;name, cur-&gt;name);     <span class="comment">/* Done */</span>
<a name="l04491"></a>04491       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="features_8c.html#a584b06b24c055eed20fe7e1e32f577f5">pickupsound</a>)) {
<a name="l04492"></a>04492          <a class="code" href="file_8h.html#a95b94a020720147325a486e210b36775" title="stream file until digit If the file name is non-empty, try to play it.">ast_stream_and_wait</a>(cur, <a class="code" href="features_8c.html#a584b06b24c055eed20fe7e1e32f577f5">pickupsound</a>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l04493"></a>04493       }
<a name="l04494"></a>04494       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(cur);
<a name="l04495"></a>04495       <span class="keywordflow">return</span> res;
<a name="l04496"></a>04496    } <span class="keywordflow">else</span>   {
<a name="l04497"></a>04497       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;No call pickup possible...\n&quot;</span>);
<a name="l04498"></a>04498       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="features_8c.html#accc7698698a0f2d7c9cf718fd88b35bd">pickupfailsound</a>)) {
<a name="l04499"></a>04499          <a class="code" href="file_8h.html#a95b94a020720147325a486e210b36775" title="stream file until digit If the file name is non-empty, try to play it.">ast_stream_and_wait</a>(chan, <a class="code" href="features_8c.html#accc7698698a0f2d7c9cf718fd88b35bd">pickupfailsound</a>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l04500"></a>04500       }
<a name="l04501"></a>04501    }
<a name="l04502"></a>04502    <span class="keywordflow">return</span> -1;
<a name="l04503"></a>04503 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a849b0c1bd72a0339408c7e6026768e40"></a><!-- doxytag: member="features.h::ast_pickup_ext" ref="a849b0c1bd72a0339408c7e6026768e40" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* ast_pickup_ext </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Determine system call pickup <a class="el" href="structextension.html">extension</a>. </p>

<p>Definition at line <a class="el" href="features_8c_source.html#l00320">320</a> of file <a class="el" href="features_8c_source.html">features.c</a>.</p>

<p>References <a class="el" href="features_8c_source.html#l00194">pickup_ext</a>.</p>

<p>Referenced by <a class="el" href="chan__misdn_8c_source.html#l04379">cb_events()</a>, <a class="el" href="chan__sip_8c_source.html#l13269">get_destination()</a>, <a class="el" href="features_8c_source.html#l04019">handle_feature_show()</a>, <a class="el" href="chan__sip_8c_source.html#l19641">handle_request_invite()</a>, <a class="el" href="chan__mgcp_8c_source.html#l02637">mgcp_ss()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00321"></a>00321 {
<a name="l00322"></a>00322    <span class="keywordflow">return</span> <a class="code" href="features_8c.html#a7af3a76f3f29d5a21be63ef43f89840e">pickup_ext</a>;
<a name="l00323"></a>00323 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adea59e175a9f8500c0eb848918849c67"></a><!-- doxytag: member="features.h::ast_rdlock_call_features" ref="adea59e175a9f8500c0eb848918849c67" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_rdlock_call_features </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="features_8c_source.html#l01874">1874</a> of file <a class="el" href="features_8c_source.html">features.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01796">ast_rwlock_rdlock()</a>, and <a class="el" href="features_8c_source.html#l01695">features_lock</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l16615">handle_request_info()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01875"></a>01875 {
<a name="l01876"></a>01876    <a class="code" href="lock_8h.html#ae6703edce409c34119e27bdca1186d10">ast_rwlock_rdlock</a>(&amp;<a class="code" href="features_8c.html#a7ec4971298483245322468cd41fdf103">features_lock</a>);
<a name="l01877"></a>01877 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa148867dd4dde459d181fc84be58c0f0"></a><!-- doxytag: member="features.h::ast_register_feature" ref="aa148867dd4dde459d181fc84be58c0f0" args="(struct ast_call_feature *feature)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_register_feature </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__call__feature.html">ast_call_feature</a> *&nbsp;</td>
          <td class="paramname"> <em>feature</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>register new feature into feature_set </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>feature</em>&nbsp;</td><td>an <a class="el" href="structast__call__feature.html">ast_call_feature</a> object which contains a keysequence and a callback function which is called when this keysequence is pressed during a call. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="features_8c_source.html#l01711">1711</a> of file <a class="el" href="features_8c_source.html">features.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="linkedlists_8h_source.html#l00702">AST_RWLIST_INSERT_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, and <a class="el" href="features_8h_source.html#l00053">ast_call_feature::sname</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l03672">load_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01712"></a>01712 {
<a name="l01713"></a>01713    <span class="keywordflow">if</span> (!feature) {
<a name="l01714"></a>01714       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;You didn&apos;t pass a feature!\n&quot;</span>);
<a name="l01715"></a>01715       <span class="keywordflow">return</span>;
<a name="l01716"></a>01716    }
<a name="l01717"></a>01717   
<a name="l01718"></a>01718    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structfeature__list.html">feature_list</a>);
<a name="l01719"></a>01719    <a class="code" href="linkedlists_8h.html#aacc5f6b7c25e361d11d40137fd55a8e8">AST_RWLIST_INSERT_HEAD</a>(&amp;<a class="code" href="structfeature__list.html">feature_list</a>,feature,feature_entry);
<a name="l01720"></a>01720    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structfeature__list.html">feature_list</a>);
<a name="l01721"></a>01721 
<a name="l01722"></a>01722    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Registered Feature &apos;%s&apos;\n&quot;</span>,feature-&gt;<a class="code" href="structast__call__feature.html#a63c4048019f00ef118af9c631c1e7665">sname</a>);
<a name="l01723"></a>01723 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7c163c3ad2e31110c5fc9e0d3b27d81d"></a><!-- doxytag: member="features.h::ast_unlock_call_features" ref="a7c163c3ad2e31110c5fc9e0d3b27d81d" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_unlock_call_features </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="features_8c_source.html#l01879">1879</a> of file <a class="el" href="features_8c_source.html">features.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01791">ast_rwlock_unlock()</a>, and <a class="el" href="features_8c_source.html#l01695">features_lock</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l16615">handle_request_info()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01880"></a>01880 {
<a name="l01881"></a>01881    <a class="code" href="lock_8h.html#a21ce13cd6c771d5855f47ae7a1dd50b6">ast_rwlock_unlock</a>(&amp;<a class="code" href="features_8c.html#a7ec4971298483245322468cd41fdf103">features_lock</a>);
<a name="l01882"></a>01882 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad151dea8a1d676a4eac6206597ae980a"></a><!-- doxytag: member="features.h::ast_unregister_feature" ref="ad151dea8a1d676a4eac6206597ae980a" args="(struct ast_call_feature *feature)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_unregister_feature </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__call__feature.html">ast_call_feature</a> *&nbsp;</td>
          <td class="paramname"> <em>feature</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>unregister feature from feature_set </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>feature</em>&nbsp;</td><td>the <a class="el" href="structast__call__feature.html">ast_call_feature</a> object which was registered before </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="features_8c_source.html#l01799">1799</a> of file <a class="el" href="features_8c_source.html">features.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="linkedlists_8h_source.html#l00860">AST_RWLIST_REMOVE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, and <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01800"></a>01800 {
<a name="l01801"></a>01801    <span class="keywordflow">if</span> (!feature) {
<a name="l01802"></a>01802       <span class="keywordflow">return</span>;
<a name="l01803"></a>01803    }
<a name="l01804"></a>01804 
<a name="l01805"></a>01805    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structfeature__list.html">feature_list</a>);
<a name="l01806"></a>01806    <a class="code" href="linkedlists_8h.html#a6091f0518f8b6f443fd9f5150f3ac407">AST_RWLIST_REMOVE</a>(&amp;<a class="code" href="structfeature__list.html">feature_list</a>, feature, feature_entry);
<a name="l01807"></a>01807    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structfeature__list.html">feature_list</a>);
<a name="l01808"></a>01808 
<a name="l01809"></a>01809    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(feature);
<a name="l01810"></a>01810 }
</pre></div></p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:22:05 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
