<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:20:19 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_0ca6ff3bf6b340411b2c6edd15b1a34d.html">channels</a>
  </div>
</div>
<div class="contents">
<h1>chan_local.c File Reference</h1>
<p>Local Proxy Channel.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="asterisk_8h_source.html">asterisk.h</a>&quot;</code><br/>
<code>#include &lt;fcntl.h&gt;</code><br/>
<code>#include &lt;sys/signal.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="lock_8h_source.html">asterisk/lock.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="channel_8h_source.html">asterisk/channel.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="config_8h_source.html">asterisk/config.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="module_8h_source.html">asterisk/module.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="pbx_8h_source.html">asterisk/pbx.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="sched_8h_source.html">asterisk/sched.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="io_8h_source.html">asterisk/io.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="rtp_8h_source.html">asterisk/rtp.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="acl_8h_source.html">asterisk/acl.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="callerid_8h_source.html">asterisk/callerid.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="file_8h_source.html">asterisk/file.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="cli_8h_source.html">asterisk/cli.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="app_8h_source.html">asterisk/app.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="musiconhold_8h_source.html">asterisk/musiconhold.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="manager_8h_source.html">asterisk/manager.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="stringfields_8h_source.html">asterisk/stringfields.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="devicestate_8h_source.html">asterisk/devicestate.h</a>&quot;</code><br/>

<p><a href="chan__local_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlocal__pvt.html">local_pvt</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#a48b854202c838869c110779e5a2ba0ca">IS_OUTBOUND</a>(a, b)&nbsp;&nbsp;&nbsp;(a == b-&gt;<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a> ? 1 : 0)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#abdf68cad2071def38a4a463ee670a5d0">LOCAL_ALREADY_MASQED</a>&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 2)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#a49d74dc878eb11a494b6fe4b3f47e38e">LOCAL_BRIDGE</a>&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 5)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#ae3db3ff32ac1599fd324b0a274e64a4f">LOCAL_CANCEL_QUEUE</a>&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 1)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#a2a06cfc908e9a039bacb589e2757ad3b">LOCAL_GLARE_DETECT</a>&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 0)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#a86ae99b603592b39c2ce36e3a0f5f05f">LOCAL_LAUNCHED_PBX</a>&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 3)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#ac86645f50a371a56ef6ef719880456fc">LOCAL_MOH_PASSTHRU</a>&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 6)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#a6c7c11e8c44954b7c3859ea316e67ce7">LOCAL_NO_OPTIMIZATION</a>&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 4)</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#af4bb13751e13ce8190e87bf2e3d9b987">AST_LIST_HEAD_STATIC</a> (locals, <a class="el" href="structlocal__pvt.html">local_pvt</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#a62e1ca89b7dfa490acdb1a9da6ed0fc5">AST_MODULE_INFO_STANDARD</a> (ASTERISK_GPL_KEY,&quot;Local Proxy Channel (Note: used internally by other <a class="el" href="pbx__gtkconsole_8c.html#aa308c88ec23cbe0cb2ac92091eda1d29">modules</a>)&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#acd2b033eb75d8aefd37655ffac524194">check_bridge</a> (struct <a class="el" href="structlocal__pvt.html">local_pvt</a> *p, int isoutbound)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Load module into PBX, register channel.  <a href="#ac3382bf6da54c56b37069bd76bbdf4f9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structlocal__pvt.html">local_pvt</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#af2e11386ac23ab7cf3acfa310f3af13f">local_alloc</a> (const char *data, int <a class="el" href="chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create a call structure.  <a href="#af2e11386ac23ab7cf3acfa310f3af13f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#a0404513ea4901c32c16962a861c344ce">local_answer</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#a82d9ee28013e015705c2fc5c2a2585ac">local_bridgedchannel</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__channel.html">ast_channel</a> *bridge)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return the bridged channel of a Local channel.  <a href="#a82d9ee28013e015705c2fc5c2a2585ac"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#a6fc079801b157ae7eeed4c8b905d76e3">local_call</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast, char *dest, int timeout)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initiate new call, part of PBX interface dest is the dial string.  <a href="#a6fc079801b157ae7eeed4c8b905d76e3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#ae84a08878f0fe743c4d04406378127ab">local_devicestate</a> (void *data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Adds devicestate to local <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>.  <a href="#ae84a08878f0fe743c4d04406378127ab"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#a802318a5ecac4ca675dd47e487c51dc4">local_digit_begin</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast, char digit)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#ad833c5642f35faf293cacd4590637228">local_digit_end</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast, char digit, unsigned int duration)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#acf188e90f068e7ca1f82e705fb679f73">local_fixup</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *oldchan, struct <a class="el" href="structast__channel.html">ast_channel</a> *newchan)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#ad93a911b38a7898024708bc097b57aaa">local_hangup</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Hangup a call through the local proxy channel.  <a href="#ad93a911b38a7898024708bc097b57aaa"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#a47dace02b55c7a3669166a3a5b92fa44">local_indicate</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast, int condition, const void *data, size_t datalen)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#a76d745a387bc08cb48428b9328b79bbb">local_new</a> (struct <a class="el" href="structlocal__pvt.html">local_pvt</a> *p, int <a class="el" href="structstate.html">state</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Start new local channel.  <a href="#a76d745a387bc08cb48428b9328b79bbb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structlocal__pvt.html">local_pvt</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#ad3baf6d2d68dc30a2ab0a8adb8e1d6aa">local_pvt_destroy</a> (struct <a class="el" href="structlocal__pvt.html">local_pvt</a> *pvt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#ad70e2cf6223c9683a8054d8558809c8d">local_queue_frame</a> (struct <a class="el" href="structlocal__pvt.html">local_pvt</a> *p, int isoutbound, struct <a class="el" href="structast__frame.html">ast_frame</a> *<a class="el" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>, struct <a class="el" href="structast__channel.html">ast_channel</a> *us, int us_locked)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#a45e696a779e1b168d43a1ed313570808">local_read</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#ae84ba38185efef100f8601e316fa8f7b">local_request</a> (const char *<a class="el" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, int <a class="el" href="chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a>, void *data, int *<a class="el" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Part of PBX interface.  <a href="#ae84ba38185efef100f8601e316fa8f7b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#ace2da02c3367a13e66cda78b7c4125cf">local_sendhtml</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast, int subclass, const char *data, int datalen)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#a47ef603eb487e86888bde68d93eb64d8">local_sendtext</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast, const char *<a class="el" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#ab2145cc56f9475cc6d567bcce74b9f93">local_write</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast, struct <a class="el" href="structast__frame.html">ast_frame</a> *<a class="el" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#a36c5d4ca60db345cd702a5ed9f0c4ca6">locals_show</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">CLI command "local show channels".  <a href="#a36c5d4ca60db345cd702a5ed9f0c4ca6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unload the local proxy channel from Asterisk.  <a href="#ad09fa931f468002152a3cc2d5ce25eae"></a><br/></td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#ab56419f942fd8b5e73abe4e71afdf913">cli_local</a> []</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__jb__conf.html">ast_jb_conf</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#a959ba7417108e51365bb97ba1dded4db">g_jb_conf</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__channel__tech.html">ast_channel_tech</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#a6d83e64e81a38a3cd94555a85fe07130">local_tech</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__local_8c.html#a71535bf985a1a06d548fd73a0a0ec32c">tdesc</a> [] = &quot;Local Proxy Channel Driver&quot;</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Local Proxy Channel. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Mark Spencer &lt;<a href="mailto:markster@digium.com">markster@digium.com</a>&gt; </dd></dl>

<p>Definition in file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a48b854202c838869c110779e5a2ba0ca"></a><!-- doxytag: member="chan_local.c::IS_OUTBOUND" ref="a48b854202c838869c110779e5a2ba0ca" args="(a, b)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IS_OUTBOUND</td>
          <td>(</td>
          <td class="paramtype">a, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">b&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;(a == b-&gt;<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a> ? 1 : 0)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00055">55</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

<p>Referenced by <a class="el" href="chan__local_8c_source.html#l00267">local_answer()</a>, <a class="el" href="chan__local_8c_source.html#l00438">local_digit_begin()</a>, <a class="el" href="chan__local_8c_source.html#l00457">local_digit_end()</a>, <a class="el" href="chan__local_8c_source.html#l00582">local_hangup()</a>, <a class="el" href="chan__local_8c_source.html#l00409">local_indicate()</a>, <a class="el" href="chan__local_8c_source.html#l00496">local_sendhtml()</a>, <a class="el" href="chan__local_8c_source.html#l00477">local_sendtext()</a>, and <a class="el" href="chan__local_8c_source.html#l00362">local_write()</a>.</p>

</div>
</div>
<a class="anchor" id="abdf68cad2071def38a4a463ee670a5d0"></a><!-- doxytag: member="chan_local.c::LOCAL_ALREADY_MASQED" ref="abdf68cad2071def38a4a463ee670a5d0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOCAL_ALREADY_MASQED&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 2)</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Already masqueraded </p>

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00119">119</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

<p>Referenced by <a class="el" href="chan__local_8c_source.html#l00289">check_bridge()</a>, and <a class="el" href="chan__local_8c_source.html#l00362">local_write()</a>.</p>

</div>
</div>
<a class="anchor" id="a49d74dc878eb11a494b6fe4b3f47e38e"></a><!-- doxytag: member="chan_local.c::LOCAL_BRIDGE" ref="a49d74dc878eb11a494b6fe4b3f47e38e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOCAL_BRIDGE&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 5)</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Report back the "true" channel as being bridged to </p>

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00122">122</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

<p>Referenced by <a class="el" href="chan__local_8c_source.html#l00670">local_alloc()</a>, and <a class="el" href="chan__local_8c_source.html#l00176">local_bridgedchannel()</a>.</p>

</div>
</div>
<a class="anchor" id="ae3db3ff32ac1599fd324b0a274e64a4f"></a><!-- doxytag: member="chan_local.c::LOCAL_CANCEL_QUEUE" ref="ae3db3ff32ac1599fd324b0a274e64a4f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOCAL_CANCEL_QUEUE&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 1)</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Cancel queue </p>

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00118">118</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

<p>Referenced by <a class="el" href="chan__local_8c_source.html#l00582">local_hangup()</a>, and <a class="el" href="chan__local_8c_source.html#l00206">local_queue_frame()</a>.</p>

</div>
</div>
<a class="anchor" id="a2a06cfc908e9a039bacb589e2757ad3b"></a><!-- doxytag: member="chan_local.c::LOCAL_GLARE_DETECT" ref="a2a06cfc908e9a039bacb589e2757ad3b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOCAL_GLARE_DETECT&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 0)</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Detect glare on hangup </p>

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00117">117</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

<p>Referenced by <a class="el" href="chan__local_8c_source.html#l00582">local_hangup()</a>, and <a class="el" href="chan__local_8c_source.html#l00206">local_queue_frame()</a>.</p>

</div>
</div>
<a class="anchor" id="a86ae99b603592b39c2ce36e3a0f5f05f"></a><!-- doxytag: member="chan_local.c::LOCAL_LAUNCHED_PBX" ref="a86ae99b603592b39c2ce36e3a0f5f05f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOCAL_LAUNCHED_PBX&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 3)</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>PBX was launched </p>

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00120">120</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

<p>Referenced by <a class="el" href="chan__local_8c_source.html#l00518">local_call()</a>, and <a class="el" href="chan__local_8c_source.html#l00582">local_hangup()</a>.</p>

</div>
</div>
<a class="anchor" id="ac86645f50a371a56ef6ef719880456fc"></a><!-- doxytag: member="chan_local.c::LOCAL_MOH_PASSTHRU" ref="ac86645f50a371a56ef6ef719880456fc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOCAL_MOH_PASSTHRU&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 6)</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Pass through music on hold start/stop frames </p>

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00123">123</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

<p>Referenced by <a class="el" href="chan__local_8c_source.html#l00670">local_alloc()</a>, and <a class="el" href="chan__local_8c_source.html#l00409">local_indicate()</a>.</p>

</div>
</div>
<a class="anchor" id="a6c7c11e8c44954b7c3859ea316e67ce7"></a><!-- doxytag: member="chan_local.c::LOCAL_NO_OPTIMIZATION" ref="a6c7c11e8c44954b7c3859ea316e67ce7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOCAL_NO_OPTIMIZATION&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 4)</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Do not optimize using masquerading </p>

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00121">121</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

<p>Referenced by <a class="el" href="chan__local_8c_source.html#l00289">check_bridge()</a>, and <a class="el" href="chan__local_8c_source.html#l00670">local_alloc()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="af4bb13751e13ce8190e87bf2e3d9b987"></a><!-- doxytag: member="chan_local.c::AST_LIST_HEAD_STATIC" ref="af4bb13751e13ce8190e87bf2e3d9b987" args="(locals, local_pvt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static AST_LIST_HEAD_STATIC </td>
          <td>(</td>
          <td class="paramtype">locals&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structlocal__pvt.html">local_pvt</a>&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a62e1ca89b7dfa490acdb1a9da6ed0fc5"></a><!-- doxytag: member="chan_local.c::AST_MODULE_INFO_STANDARD" ref="a62e1ca89b7dfa490acdb1a9da6ed0fc5" args="(ASTERISK_GPL_KEY,&quot;Local Proxy Channel (Note: used internally by other modules)&quot;)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AST_MODULE_INFO_STANDARD </td>
          <td>(</td>
          <td class="paramtype">ASTERISK_GPL_KEY&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;Local Proxy Channel (Note: used internally by other <a class="el" href="pbx__gtkconsole_8c.html#aa308c88ec23cbe0cb2ac92091eda1d29">modules</a>)&quot;&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="acd2b033eb75d8aefd37655ffac524194"></a><!-- doxytag: member="chan_local.c::check_bridge" ref="acd2b033eb75d8aefd37655ffac524194" args="(struct local_pvt *p, int isoutbound)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void check_bridge </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlocal__pvt.html">local_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>isoutbound</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00289">289</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00405">ast_channel::_bridge</a>, <a class="el" href="app_8c_source.html#l01094">ast_app_group_update()</a>, <a class="el" href="channel_8c_source.html#l04733">ast_bridged_channel()</a>, <a class="el" href="channel_8c_source.html#l04217">ast_channel_masquerade()</a>, <a class="el" href="lock_8h_source.html#l02037">ast_channel_trylock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="channel_8c_source.html#l00461">ast_check_hangup()</a>, <a class="el" href="linkedlists_8h_source.html#l00449">AST_LIST_EMPTY</a>, <a class="el" href="lock_8h_source.html#l01722">ast_mutex_trylock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="channel_8h_source.html#l00421">ast_channel::audiohooks</a>, <a class="el" href="chan__local_8c_source.html#l00111">local_pvt::chan</a>, <a class="el" href="chan__local_8c_source.html#l00119">LOCAL_ALREADY_MASQED</a>, <a class="el" href="chan__local_8c_source.html#l00121">LOCAL_NO_OPTIMIZATION</a>, <a class="el" href="channel_8h_source.html#l00425">ast_channel::monitor</a>, and <a class="el" href="chan__local_8c_source.html#l00110">local_pvt::owner</a>.</p>

<p>Referenced by <a class="el" href="chan__local_8c_source.html#l00362">local_write()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00290"></a>00290 {
<a name="l00291"></a>00291    <span class="keyword">struct </span><a class="code" href="structast__channel__monitor.html">ast_channel_monitor</a> *tmp;
<a name="l00292"></a>00292    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(p, <a class="code" href="chan__local_8c.html#abdf68cad2071def38a4a463ee670a5d0">LOCAL_ALREADY_MASQED</a>) || <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(p, <a class="code" href="chan__local_8c.html#a6c7c11e8c44954b7c3859ea316e67ce7">LOCAL_NO_OPTIMIZATION</a>) || !p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a> || !p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> || (p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a> != <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>)))
<a name="l00293"></a>00293       <span class="keywordflow">return</span>;
<a name="l00294"></a>00294 
<a name="l00295"></a>00295    <span class="comment">/* only do the masquerade if we are being called on the outbound channel,</span>
<a name="l00296"></a>00296 <span class="comment">      if it has been bridged to another channel and if there are no pending</span>
<a name="l00297"></a>00297 <span class="comment">      frames on the owner channel (because they would be transferred to the</span>
<a name="l00298"></a>00298 <span class="comment">      outbound channel during the masquerade)</span>
<a name="l00299"></a>00299 <span class="comment">   */</span>
<a name="l00300"></a>00300    <span class="keywordflow">if</span> (isoutbound &amp;&amp; p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a> <span class="comment">/* Not ast_bridged_channel!  Only go one step! */</span> &amp;&amp; <a class="code" href="linkedlists_8h.html#a4a1884cde93e53bef32ca85c194a1d05" title="Checks whether the specified list contains any entries.">AST_LIST_EMPTY</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;readq)) {
<a name="l00301"></a>00301       <span class="comment">/* Masquerade bridged channel into owner */</span>
<a name="l00302"></a>00302       <span class="comment">/* Lock everything we need, one by one, and give up if</span>
<a name="l00303"></a>00303 <span class="comment">         we can&apos;t get everything.  Remember, we&apos;ll get another</span>
<a name="l00304"></a>00304 <span class="comment">         chance in just a little bit */</span>
<a name="l00305"></a>00305       <span class="keywordflow">if</span> (!<a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a>)) {
<a name="l00306"></a>00306          <span class="keywordflow">if</span> (!<a class="code" href="channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd" title="Check to see if a channel is needing hang up.">ast_check_hangup</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a>)) {
<a name="l00307"></a>00307             <span class="keywordflow">if</span> (!<a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {
<a name="l00308"></a>00308                <span class="keywordflow">if</span> (!<a class="code" href="channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd" title="Check to see if a channel is needing hang up.">ast_check_hangup</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {
<a name="l00309"></a>00309                   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a4254cefdfaeb5200f89e7ba3ae6f0922">monitor</a> &amp;&amp; !p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a>-&gt;<a class="code" href="structast__channel.html#a4254cefdfaeb5200f89e7ba3ae6f0922">monitor</a>) {
<a name="l00310"></a>00310                      <span class="comment">/* If a local channel is being monitored, we don&apos;t want a masquerade</span>
<a name="l00311"></a>00311 <span class="comment">                      * to cause the monitor to go away. Since the masquerade swaps the monitors,</span>
<a name="l00312"></a>00312 <span class="comment">                      * pre-swapping the monitors before the masquerade will ensure that the monitor</span>
<a name="l00313"></a>00313 <span class="comment">                      * ends up where it is expected.</span>
<a name="l00314"></a>00314 <span class="comment">                      */</span>
<a name="l00315"></a>00315                      tmp = p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a4254cefdfaeb5200f89e7ba3ae6f0922">monitor</a>;
<a name="l00316"></a>00316                      p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a4254cefdfaeb5200f89e7ba3ae6f0922">monitor</a> = p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a>-&gt;<a class="code" href="structast__channel.html#a4254cefdfaeb5200f89e7ba3ae6f0922">monitor</a>;
<a name="l00317"></a>00317                      p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a>-&gt;<a class="code" href="structast__channel.html#a4254cefdfaeb5200f89e7ba3ae6f0922">monitor</a> = tmp;
<a name="l00318"></a>00318                   }
<a name="l00319"></a>00319                   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>) {
<a name="l00320"></a>00320                      <span class="keyword">struct </span><a class="code" href="structast__audiohook__list.html">ast_audiohook_list</a> *audiohooks_swapper;
<a name="l00321"></a>00321                      audiohooks_swapper = p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>;
<a name="l00322"></a>00322                      p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a> = p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>;
<a name="l00323"></a>00323                      p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a> = audiohooks_swapper;
<a name="l00324"></a>00324                   }
<a name="l00325"></a>00325                   <a class="code" href="app_8h.html#a69e90e401aa3da48a6eef5139727cbb3" title="Update all group counting for a channel to a new one.">ast_app_group_update</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l00326"></a>00326                   <a class="code" href="channel_8h.html#a84fa04f019436467dc17f9bdd5341dce" title="Weird function made for call transfers.">ast_channel_masquerade</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a>);
<a name="l00327"></a>00327                   <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(p, <a class="code" href="chan__local_8c.html#abdf68cad2071def38a4a463ee670a5d0">LOCAL_ALREADY_MASQED</a>);
<a name="l00328"></a>00328                }
<a name="l00329"></a>00329                <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l00330"></a>00330             }
<a name="l00331"></a>00331             <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a>);
<a name="l00332"></a>00332          }
<a name="l00333"></a>00333       }
<a name="l00334"></a>00334    <span class="comment">/* We only allow masquerading in one &apos;direction&apos;... it&apos;s important to preserve the state</span>
<a name="l00335"></a>00335 <span class="comment">      (group variables, etc.) that live on p-&gt;chan-&gt;_bridge (and were put there by the dialplan)</span>
<a name="l00336"></a>00336 <span class="comment">      when the local channels go away.</span>
<a name="l00337"></a>00337 <span class="comment">   */</span>
<a name="l00338"></a>00338 <span class="preprocessor">#if 0</span>
<a name="l00339"></a>00339 <span class="preprocessor"></span>   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!isoutbound &amp;&amp; p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a> &amp;&amp; p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a> &amp;&amp; <a class="code" href="linkedlists_8h.html#a4a1884cde93e53bef32ca85c194a1d05" title="Checks whether the specified list contains any entries.">AST_LIST_EMPTY</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;readq)) {
<a name="l00340"></a>00340       <span class="comment">/* Masquerade bridged channel into chan */</span>
<a name="l00341"></a>00341       <span class="keywordflow">if</span> (!<a class="code" href="lock_8h.html#a036ccafa2339f674a46bc269bbd48c5f">ast_mutex_trylock</a>(&amp;(p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a>)-&gt;lock)) {
<a name="l00342"></a>00342          <span class="keywordflow">if</span> (!<a class="code" href="channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd" title="Check to see if a channel is needing hang up.">ast_check_hangup</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a>)) {
<a name="l00343"></a>00343             <span class="keywordflow">if</span> (!<a class="code" href="lock_8h.html#a036ccafa2339f674a46bc269bbd48c5f">ast_mutex_trylock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;lock)) {
<a name="l00344"></a>00344                <span class="keywordflow">if</span> (!<a class="code" href="channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd" title="Check to see if a channel is needing hang up.">ast_check_hangup</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>)) {
<a name="l00345"></a>00345                   <a class="code" href="channel_8h.html#a84fa04f019436467dc17f9bdd5341dce" title="Weird function made for call transfers.">ast_channel_masquerade</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a>);
<a name="l00346"></a>00346                   <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(p, <a class="code" href="chan__local_8c.html#abdf68cad2071def38a4a463ee670a5d0">LOCAL_ALREADY_MASQED</a>);
<a name="l00347"></a>00347                }
<a name="l00348"></a>00348                <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;lock);
<a name="l00349"></a>00349             }
<a name="l00350"></a>00350          }
<a name="l00351"></a>00351          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;(p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a>)-&gt;lock);
<a name="l00352"></a>00352       }
<a name="l00353"></a>00353 <span class="preprocessor">#endif</span>
<a name="l00354"></a>00354 <span class="preprocessor"></span>   }
<a name="l00355"></a>00355 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac3382bf6da54c56b37069bd76bbdf4f9"></a><!-- doxytag: member="chan_local.c::load_module" ref="ac3382bf6da54c56b37069bd76bbdf4f9" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int load_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Load module into PBX, register channel. </p>

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00854">854</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l00557">ast_channel_register()</a>, <a class="el" href="cli_8c_source.html#l01927">ast_cli_register_multiple()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="module_8h_source.html#l00065">AST_MODULE_LOAD_FAILURE</a>, <a class="el" href="module_8h_source.html#l00061">AST_MODULE_LOAD_SUCCESS</a>, <a class="el" href="chan__local_8c_source.html#l00849">cli_local</a>, and <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00855"></a>00855 {
<a name="l00856"></a>00856    <span class="comment">/* Make sure we can register our channel type */</span>
<a name="l00857"></a>00857    <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#ab5f3776fda943e52820ceeee5835c1b4" title="Register a channel technology (a new channel driver) Called by a channel module to...">ast_channel_register</a>(&amp;<a class="code" href="chan__local_8c.html#a6d83e64e81a38a3cd94555a85fe07130">local_tech</a>)) {
<a name="l00858"></a>00858       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to register channel class &apos;Local&apos;\n&quot;</span>);
<a name="l00859"></a>00859       <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa8724da3ad620df86524280e760add388">AST_MODULE_LOAD_FAILURE</a>;
<a name="l00860"></a>00860    }
<a name="l00861"></a>00861    <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(<a class="code" href="chan__local_8c.html#ab56419f942fd8b5e73abe4e71afdf913">cli_local</a>, <span class="keyword">sizeof</span>(<a class="code" href="chan__local_8c.html#ab56419f942fd8b5e73abe4e71afdf913">cli_local</a>) / <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a>));
<a name="l00862"></a>00862    <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a>;
<a name="l00863"></a>00863 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af2e11386ac23ab7cf3acfa310f3af13f"></a><!-- doxytag: member="chan_local.c::local_alloc" ref="af2e11386ac23ab7cf3acfa310f3af13f" args="(const char *data, int format)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structlocal__pvt.html">local_pvt</a>* local_alloc </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>format</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create a call structure. </p>

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00670">670</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="pbx_8c_source.html#l04143">ast_exists_extension()</a>, <a class="el" href="abstract__jb_8h_source.html#l00043">AST_JB_ENABLED</a>, <a class="el" href="linkedlists_8h_source.html#l00695">AST_LIST_INSERT_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01692">ast_mutex_init()</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="chan__local_8c_source.html#l00106">local_pvt::context</a>, <a class="el" href="chan__local_8c_source.html#l00107">local_pvt::exten</a>, <a class="el" href="chan__local_8c_source.html#l00109">local_pvt::jb_conf</a>, <a class="el" href="chan__local_8c_source.html#l00122">LOCAL_BRIDGE</a>, <a class="el" href="chan__local_8c_source.html#l00123">LOCAL_MOH_PASSTHRU</a>, <a class="el" href="chan__local_8c_source.html#l00121">LOCAL_NO_OPTIMIZATION</a>, <a class="el" href="chan__local_8c_source.html#l00168">local_pvt_destroy()</a>, <a class="el" href="chan__local_8c_source.html#l00104">local_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, and <a class="el" href="chan__local_8c_source.html#l00108">local_pvt::reqformat</a>.</p>

<p>Referenced by <a class="el" href="chan__local_8c_source.html#l00798">local_request()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00671"></a>00671 {
<a name="l00672"></a>00672    <span class="keyword">struct </span><a class="code" href="structlocal__pvt.html">local_pvt</a> *tmp = NULL;
<a name="l00673"></a>00673    <span class="keywordtype">char</span> *c = NULL, *opts = NULL;
<a name="l00674"></a>00674 
<a name="l00675"></a>00675    <span class="keywordflow">if</span> (!(tmp = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*tmp))))
<a name="l00676"></a>00676       <span class="keywordflow">return</span> NULL;
<a name="l00677"></a>00677 
<a name="l00678"></a>00678    <span class="comment">/* Initialize private structure information */</span>
<a name="l00679"></a>00679    <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;tmp-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00680"></a>00680    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp-&gt;<a class="code" href="structlocal__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>, data, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structlocal__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>));
<a name="l00681"></a>00681 
<a name="l00682"></a>00682    memcpy(&amp;tmp-&gt;<a class="code" href="structlocal__pvt.html#a09abe21e12f90d900a42e110cd0e3310">jb_conf</a>, &amp;<a class="code" href="chan__local_8c.html#a959ba7417108e51365bb97ba1dded4db">g_jb_conf</a>, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structlocal__pvt.html#a09abe21e12f90d900a42e110cd0e3310">jb_conf</a>));
<a name="l00683"></a>00683 
<a name="l00684"></a>00684    <span class="comment">/* Look for options */</span>
<a name="l00685"></a>00685    <span class="keywordflow">if</span> ((opts = strchr(tmp-&gt;<a class="code" href="structlocal__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>, <span class="charliteral">&apos;/&apos;</span>))) {
<a name="l00686"></a>00686       *opts++ = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00687"></a>00687       <span class="keywordflow">if</span> (strchr(opts, <span class="charliteral">&apos;n&apos;</span>))
<a name="l00688"></a>00688          <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(tmp, <a class="code" href="chan__local_8c.html#a6c7c11e8c44954b7c3859ea316e67ce7">LOCAL_NO_OPTIMIZATION</a>);
<a name="l00689"></a>00689       <span class="keywordflow">if</span> (strchr(opts, <span class="charliteral">&apos;j&apos;</span>)) {
<a name="l00690"></a>00690          <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(tmp, <a class="code" href="chan__local_8c.html#a6c7c11e8c44954b7c3859ea316e67ce7">LOCAL_NO_OPTIMIZATION</a>))
<a name="l00691"></a>00691             <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(&amp;tmp-&gt;<a class="code" href="structlocal__pvt.html#a09abe21e12f90d900a42e110cd0e3310">jb_conf</a>, <a class="code" href="abstract__jb_8h.html#aad393aa3e173d7f081ab4bbc6ba5027daf49c3e265d3ff27e62d8c38779d89dd9">AST_JB_ENABLED</a>);
<a name="l00692"></a>00692          <span class="keywordflow">else</span> {
<a name="l00693"></a>00693             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;You must use the &apos;n&apos; option for chan_local &quot;</span>
<a name="l00694"></a>00694                <span class="stringliteral">&quot;to use the &apos;j&apos; option to enable the jitterbuffer\n&quot;</span>);
<a name="l00695"></a>00695          }
<a name="l00696"></a>00696       }
<a name="l00697"></a>00697       <span class="keywordflow">if</span> (strchr(opts, <span class="charliteral">&apos;b&apos;</span>)) {
<a name="l00698"></a>00698          <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(tmp, <a class="code" href="chan__local_8c.html#a49d74dc878eb11a494b6fe4b3f47e38e">LOCAL_BRIDGE</a>);
<a name="l00699"></a>00699       }
<a name="l00700"></a>00700       <span class="keywordflow">if</span> (strchr(opts, <span class="charliteral">&apos;m&apos;</span>)) {
<a name="l00701"></a>00701          <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(tmp, <a class="code" href="chan__local_8c.html#ac86645f50a371a56ef6ef719880456fc">LOCAL_MOH_PASSTHRU</a>);
<a name="l00702"></a>00702       }
<a name="l00703"></a>00703    }
<a name="l00704"></a>00704 
<a name="l00705"></a>00705    <span class="comment">/* Look for a context */</span>
<a name="l00706"></a>00706    <span class="keywordflow">if</span> ((c = strchr(tmp-&gt;<a class="code" href="structlocal__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>, <span class="charliteral">&apos;@&apos;</span>)))
<a name="l00707"></a>00707       *c++ = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00708"></a>00708 
<a name="l00709"></a>00709    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp-&gt;<a class="code" href="structlocal__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, c ? c : <span class="stringliteral">&quot;default&quot;</span>, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structlocal__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>));
<a name="l00710"></a>00710 
<a name="l00711"></a>00711    tmp-&gt;<a class="code" href="structlocal__pvt.html#a1485d446d8c32da1836fa47a11e164ce">reqformat</a> = <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>;
<a name="l00712"></a>00712 
<a name="l00713"></a>00713 <span class="preprocessor">#if 0</span>
<a name="l00714"></a>00714 <span class="preprocessor"></span>   <span class="comment">/* We can&apos;t do this check here, because we don&apos;t know the CallerID yet, and</span>
<a name="l00715"></a>00715 <span class="comment">    * the CallerID could potentially affect what step is actually taken (or</span>
<a name="l00716"></a>00716 <span class="comment">    * even if that step exists). */</span>
<a name="l00717"></a>00717    <span class="keywordflow">if</span> (!<a class="code" href="pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7" title="Determine whether an extension exists.">ast_exists_extension</a>(NULL, tmp-&gt;<a class="code" href="structlocal__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, tmp-&gt;<a class="code" href="structlocal__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>, 1, NULL)) {
<a name="l00718"></a>00718       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;No such extension/context %s@%s creating local channel\n&quot;</span>, tmp-&gt;<a class="code" href="structlocal__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>, tmp-&gt;<a class="code" href="structlocal__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>);
<a name="l00719"></a>00719       tmp = <a class="code" href="chan__local_8c.html#ad3baf6d2d68dc30a2ab0a8adb8e1d6aa">local_pvt_destroy</a>(tmp);
<a name="l00720"></a>00720    } <span class="keywordflow">else</span> {
<a name="l00721"></a>00721 <span class="preprocessor">#endif</span>
<a name="l00722"></a>00722 <span class="preprocessor"></span>      <span class="comment">/* Add to list */</span>
<a name="l00723"></a>00723       <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;locals);
<a name="l00724"></a>00724       <a class="code" href="linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307" title="Inserts a list entry at the head of a list.">AST_LIST_INSERT_HEAD</a>(&amp;locals, tmp, list);
<a name="l00725"></a>00725       <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;locals);
<a name="l00726"></a>00726 <span class="preprocessor">#if 0</span>
<a name="l00727"></a>00727 <span class="preprocessor"></span>   }
<a name="l00728"></a>00728 <span class="preprocessor">#endif</span>
<a name="l00729"></a>00729 <span class="preprocessor"></span>   
<a name="l00730"></a>00730    <span class="keywordflow">return</span> tmp;
<a name="l00731"></a>00731 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0404513ea4901c32c16962a861c344ce"></a><!-- doxytag: member="chan_local.c::local_answer" ref="a0404513ea4901c32c16962a861c344ce" args="(struct ast_channel *ast)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int local_answer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00267">267</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00301">AST_CONTROL_ANSWER</a>, <a class="el" href="frame_8h_source.html#l00105">AST_FRAME_CONTROL</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="chan__local_8c_source.html#l00055">IS_OUTBOUND</a>, <a class="el" href="chan__local_8c_source.html#l00206">local_queue_frame()</a>, <a class="el" href="chan__local_8c_source.html#l00104">local_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00268"></a>00268 {
<a name="l00269"></a>00269    <span class="keyword">struct </span><a class="code" href="structlocal__pvt.html">local_pvt</a> *p = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l00270"></a>00270    <span class="keywordtype">int</span> isoutbound;
<a name="l00271"></a>00271    <span class="keywordtype">int</span> res = -1;
<a name="l00272"></a>00272 
<a name="l00273"></a>00273    <span class="keywordflow">if</span> (!p)
<a name="l00274"></a>00274       <span class="keywordflow">return</span> -1;
<a name="l00275"></a>00275 
<a name="l00276"></a>00276    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00277"></a>00277    isoutbound = <a class="code" href="chan__local_8c.html#a48b854202c838869c110779e5a2ba0ca">IS_OUTBOUND</a>(ast, p);
<a name="l00278"></a>00278    <span class="keywordflow">if</span> (isoutbound) {
<a name="l00279"></a>00279       <span class="comment">/* Pass along answer since somebody answered us */</span>
<a name="l00280"></a>00280       <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> answer = { <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a> };
<a name="l00281"></a>00281       res = <a class="code" href="chan__local_8c.html#ad70e2cf6223c9683a8054d8558809c8d">local_queue_frame</a>(p, isoutbound, &amp;answer, ast, 1);
<a name="l00282"></a>00282    } <span class="keywordflow">else</span>
<a name="l00283"></a>00283       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Huh?  Local is being asked to answer?\n&quot;</span>);
<a name="l00284"></a>00284    <span class="keywordflow">if</span> (!res)
<a name="l00285"></a>00285       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00286"></a>00286    <span class="keywordflow">return</span> res;
<a name="l00287"></a>00287 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a82d9ee28013e015705c2fc5c2a2585ac"></a><!-- doxytag: member="chan_local.c::local_bridgedchannel" ref="a82d9ee28013e015705c2fc5c2a2585ac" args="(struct ast_channel *chan, struct ast_channel *bridge)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__channel.html">ast_channel</a> * local_bridgedchannel </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return the bridged channel of a Local channel. </p>

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00176">176</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00405">ast_channel::_bridge</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="chan__local_8c_source.html#l00111">local_pvt::chan</a>, <a class="el" href="chan__local_8c_source.html#l00122">LOCAL_BRIDGE</a>, <a class="el" href="chan__local_8c_source.html#l00104">local_pvt::lock</a>, <a class="el" href="chan__local_8c_source.html#l00110">local_pvt::owner</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00177"></a>00177 {
<a name="l00178"></a>00178    <span class="keyword">struct </span><a class="code" href="structlocal__pvt.html">local_pvt</a> *p = bridge-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l00179"></a>00179    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *bridged = bridge;
<a name="l00180"></a>00180 
<a name="l00181"></a>00181    <span class="keywordflow">if</span> (!p) {
<a name="l00182"></a>00182       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Asked for bridged channel on &apos;%s&apos;/&apos;%s&apos;, returning &lt;none&gt;\n&quot;</span>,
<a name="l00183"></a>00183          chan-&gt;name, bridge-&gt;name);
<a name="l00184"></a>00184       <span class="keywordflow">return</span> NULL;
<a name="l00185"></a>00185    }
<a name="l00186"></a>00186 
<a name="l00187"></a>00187    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00188"></a>00188 
<a name="l00189"></a>00189    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(p, <a class="code" href="chan__local_8c.html#a49d74dc878eb11a494b6fe4b3f47e38e">LOCAL_BRIDGE</a>)) {
<a name="l00190"></a>00190       <span class="comment">/* Find the opposite channel */</span>
<a name="l00191"></a>00191       bridged = (bridge == p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> ? p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a> : p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l00192"></a>00192       
<a name="l00193"></a>00193       <span class="comment">/* Now see if the opposite channel is bridged to anything */</span>
<a name="l00194"></a>00194       <span class="keywordflow">if</span> (!bridged) {
<a name="l00195"></a>00195          bridged = bridge;
<a name="l00196"></a>00196       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bridged-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a>) {
<a name="l00197"></a>00197          bridged = bridged-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a>;
<a name="l00198"></a>00198       }
<a name="l00199"></a>00199    }
<a name="l00200"></a>00200 
<a name="l00201"></a>00201    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00202"></a>00202 
<a name="l00203"></a>00203    <span class="keywordflow">return</span> bridged;
<a name="l00204"></a>00204 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6fc079801b157ae7eeed4c8b905d76e3"></a><!-- doxytag: member="chan_local.c::local_call" ref="a6fc079801b157ae7eeed4c8b905d76e3" args="(struct ast_channel *ast, char *dest, int timeout)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int local_call </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>timeout</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initiate new call, part of PBX interface dest is the dial string. </p>

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00518">518</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

<p>References <a class="el" href="chan__iax2_8c_source.html#l00328">accountcode</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="cdr_8c_source.html#l00996">ast_cdr_update()</a>, <a class="el" href="channel_8c_source.html#l01517">ast_channel_datastore_inherit()</a>, <a class="el" href="pbx_8c_source.html#l04143">ast_exists_extension()</a>, <a class="el" href="channel_8h_source.html#l00554">AST_FLAG_ANSWERED_ELSEWHERE</a>, <a class="el" href="linkedlists_8h_source.html#l00715">AST_LIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="pbx_8c_source.html#l04559">ast_pbx_start()</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="stringfields_8h_source.html#l00285">ast_string_field_set</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="channel_8h_source.html#l00461">ast_channel::cdrflags</a>, <a class="el" href="chan__local_8c_source.html#l00111">local_pvt::chan</a>, <a class="el" href="channel_8h_source.html#l00444">ast_channel::cid</a>, <a class="el" href="channel_8h_source.html#l00205">ast_callerid::cid_ani</a>, <a class="el" href="channel_8h_source.html#l00208">ast_callerid::cid_ani2</a>, <a class="el" href="channel_8h_source.html#l00202">ast_callerid::cid_dnid</a>, <a class="el" href="channel_8h_source.html#l00204">ast_callerid::cid_name</a>, <a class="el" href="channel_8h_source.html#l00203">ast_callerid::cid_num</a>, <a class="el" href="channel_8h_source.html#l00207">ast_callerid::cid_pres</a>, <a class="el" href="channel_8h_source.html#l00206">ast_callerid::cid_rdnis</a>, <a class="el" href="channel_8h_source.html#l00210">ast_callerid::cid_tns</a>, <a class="el" href="channel_8h_source.html#l00209">ast_callerid::cid_ton</a>, <a class="el" href="channel_8h_source.html#l00503">ast_channel::context</a>, <a class="el" href="channel_8h_source.html#l00504">ast_channel::exten</a>, <a class="el" href="chan__alsa_8c_source.html#l00106">language</a>, <a class="el" href="func__strings_8c_source.html#l00821">len()</a>, <a class="el" href="chan__local_8c_source.html#l00120">LOCAL_LAUNCHED_PBX</a>, <a class="el" href="chan__local_8c_source.html#l00104">local_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="chan__mgcp_8c_source.html#l00146">musicclass</a>, <a class="el" href="chanvars_8h_source.html#l00031">ast_var_t::name</a>, <a class="el" href="chan__local_8c_source.html#l00110">local_pvt::owner</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, and <a class="el" href="channel_8h_source.html#l00446">ast_channel::varshead</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00519"></a>00519 {
<a name="l00520"></a>00520    <span class="keyword">struct </span><a class="code" href="structlocal__pvt.html">local_pvt</a> *p = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l00521"></a>00521    <span class="keywordtype">int</span> res;
<a name="l00522"></a>00522    <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a> *varptr = NULL, *<span class="keyword">new</span>;
<a name="l00523"></a>00523    <span class="keywordtype">size_t</span> <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, namelen;
<a name="l00524"></a>00524 
<a name="l00525"></a>00525    <span class="keywordflow">if</span> (!p)
<a name="l00526"></a>00526       <span class="keywordflow">return</span> -1;
<a name="l00527"></a>00527    
<a name="l00528"></a>00528    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00529"></a>00529 
<a name="l00530"></a>00530    <span class="comment">/*</span>
<a name="l00531"></a>00531 <span class="comment">    * Note that cid_num and cid_name aren&apos;t passed in the ast_channel_alloc</span>
<a name="l00532"></a>00532 <span class="comment">    * call, so it&apos;s done here instead.</span>
<a name="l00533"></a>00533 <span class="comment">    */</span>
<a name="l00534"></a>00534    p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#aa54ab157f47ac529034d524781e2a7e2">cid_dnid</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#aa54ab157f47ac529034d524781e2a7e2">cid_dnid</a>);
<a name="l00535"></a>00535    p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>);
<a name="l00536"></a>00536    p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a>);
<a name="l00537"></a>00537    p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a4791c5f3aedc8782678867a1741f4131">cid_rdnis</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a4791c5f3aedc8782678867a1741f4131">cid_rdnis</a>);
<a name="l00538"></a>00538    p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a7bb8ad258e687da69d6933ab48320df7">cid_ani</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a7bb8ad258e687da69d6933ab48320df7">cid_ani</a>);
<a name="l00539"></a>00539    p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a5674af3fa5ce1dd1fe052be1477d4110">cid_pres</a> = p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a5674af3fa5ce1dd1fe052be1477d4110">cid_pres</a>;
<a name="l00540"></a>00540    p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a9540aaac76be952860ef25d607eb33fb">cid_ani2</a> = p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a9540aaac76be952860ef25d607eb33fb">cid_ani2</a>;
<a name="l00541"></a>00541    p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#aff456ca48d31a9813584e799064cf88e">cid_ton</a> = p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#aff456ca48d31a9813584e799064cf88e">cid_ton</a>;
<a name="l00542"></a>00542    p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#aae7e57d784da2bfe6b85cb36516edca0">cid_tns</a> = p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#aae7e57d784da2bfe6b85cb36516edca0">cid_tns</a>;
<a name="l00543"></a>00543    <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <a class="code" href="chan__alsa_8c.html#adf416dc058363e2fd5750c77e2d78bee">language</a>, p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;language);
<a name="l00544"></a>00544    <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <a class="code" href="chan__iax2_8c.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>, p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;accountcode);
<a name="l00545"></a>00545    <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <a class="code" href="chan__mgcp_8c.html#abc34958c9b03014779727e5ca61b93e5">musicclass</a>, p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;musicclass);
<a name="l00546"></a>00546    <a class="code" href="cdr_8h.html#a92b2e3b685887b48d228f7546ae1a9f1">ast_cdr_update</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>);
<a name="l00547"></a>00547    p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#a45c4bec79a4bc84fdd2d2c67f6605a6c">cdrflags</a> = p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a45c4bec79a4bc84fdd2d2c67f6605a6c">cdrflags</a>;
<a name="l00548"></a>00548 
<a name="l00549"></a>00549    <span class="keywordflow">if</span> (!<a class="code" href="pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7" title="Determine whether an extension exists.">ast_exists_extension</a>(NULL, p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, 1, p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>)) {
<a name="l00550"></a>00550       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;No such extension/context %s@%s while calling Local channel\n&quot;</span>, p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>);
<a name="l00551"></a>00551       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00552"></a>00552       <span class="keywordflow">return</span> -1;
<a name="l00553"></a>00553    }
<a name="l00554"></a>00554 
<a name="l00555"></a>00555    <span class="comment">/* Make sure we inherit the ANSWERED_ELSEWHERE flag if it&apos;s set on the queue/dial call request in the dialplan */</span>
<a name="l00556"></a>00556    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(ast, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329ac2c6da6c29fad431dfb87caf552315d7">AST_FLAG_ANSWERED_ELSEWHERE</a>)) {
<a name="l00557"></a>00557       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329ac2c6da6c29fad431dfb87caf552315d7">AST_FLAG_ANSWERED_ELSEWHERE</a>);
<a name="l00558"></a>00558    }
<a name="l00559"></a>00559 
<a name="l00560"></a>00560    <span class="comment">/* copy the channel variables from the incoming channel to the outgoing channel */</span>
<a name="l00561"></a>00561    <span class="comment">/* Note that due to certain assumptions, they MUST be in the same order */</span>
<a name="l00562"></a>00562    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>, varptr, entries) {
<a name="l00563"></a>00563       namelen = strlen(varptr-&gt;<a class="code" href="structast__var__t.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>);
<a name="l00564"></a>00564       len = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a>) + namelen + strlen(varptr-&gt;<a class="code" href="structast__var__t.html#a4e9aec275e566b978a3ccb4e043d8c61">value</a>) + 2;
<a name="l00565"></a>00565       <span class="keywordflow">if</span> ((<span class="keyword">new</span> = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, len))) {
<a name="l00566"></a>00566          memcpy(<span class="keyword">new</span>, varptr, len);
<a name="l00567"></a>00567          <span class="keyword">new</span>-&gt;value = &amp;(<span class="keyword">new</span>-&gt;name[0]) + namelen + 1;
<a name="l00568"></a>00568          <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>, <span class="keyword">new</span>, entries);
<a name="l00569"></a>00569       }
<a name="l00570"></a>00570    }
<a name="l00571"></a>00571    <a class="code" href="channel_8h.html#a6ce892974f59537bda03a71319b452e2" title="Inherit datastores from a parent to a child.">ast_channel_datastore_inherit</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>);
<a name="l00572"></a>00572 
<a name="l00573"></a>00573    <span class="comment">/* Start switch on sub channel */</span>
<a name="l00574"></a>00574    <span class="keywordflow">if</span> (!(res = <a class="code" href="pbx_8h.html#a9a937fbb3b5f4e68880a9c5714a29ce5" title="Create a new thread and start the PBX.">ast_pbx_start</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>)))
<a name="l00575"></a>00575       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(p, <a class="code" href="chan__local_8c.html#a86ae99b603592b39c2ce36e3a0f5f05f">LOCAL_LAUNCHED_PBX</a>);
<a name="l00576"></a>00576 
<a name="l00577"></a>00577    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00578"></a>00578    <span class="keywordflow">return</span> res;
<a name="l00579"></a>00579 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae84a08878f0fe743c4d04406378127ab"></a><!-- doxytag: member="chan_local.c::local_devicestate" ref="ae84a08878f0fe743c4d04406378127ab" args="(void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int local_devicestate </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Adds devicestate to local <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>. </p>

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00128">128</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="devicestate_8h_source.html#l00054">AST_DEVICE_INUSE</a>, <a class="el" href="devicestate_8h_source.html#l00056">AST_DEVICE_INVALID</a>, <a class="el" href="devicestate_8h_source.html#l00053">AST_DEVICE_NOT_INUSE</a>, <a class="el" href="pbx_8c_source.html#l04143">ast_exists_extension()</a>, <a class="el" href="linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="chan__local_8c_source.html#l00106">local_pvt::context</a>, <a class="el" href="chan__local_8c_source.html#l00107">local_pvt::exten</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="chan__local_8c_source.html#l00110">local_pvt::owner</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00129"></a>00129 {
<a name="l00130"></a>00130    <span class="keywordtype">char</span> *<a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a> = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(data);
<a name="l00131"></a>00131    <span class="keywordtype">char</span> *<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a> = NULL, *opts = NULL;
<a name="l00132"></a>00132    <span class="keywordtype">int</span> res;
<a name="l00133"></a>00133    <span class="keyword">struct </span><a class="code" href="structlocal__pvt.html">local_pvt</a> *lp;
<a name="l00134"></a>00134 
<a name="l00135"></a>00135    <span class="keywordflow">if</span> (!(context = strchr(exten, <span class="charliteral">&apos;@&apos;</span>))) {
<a name="l00136"></a>00136       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Someone used Local/%s somewhere without a @context. This is bad.\n&quot;</span>, exten);
<a name="l00137"></a>00137       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea9c008e1d20858cbc3275c157e02ebc94">AST_DEVICE_INVALID</a>; 
<a name="l00138"></a>00138    }
<a name="l00139"></a>00139 
<a name="l00140"></a>00140    *context++ = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00141"></a>00141 
<a name="l00142"></a>00142    <span class="comment">/* Strip options if they exist */</span>
<a name="l00143"></a>00143    <span class="keywordflow">if</span> ((opts = strchr(context, <span class="charliteral">&apos;/&apos;</span>)))
<a name="l00144"></a>00144       *opts = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00145"></a>00145 
<a name="l00146"></a>00146    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(3, <span class="stringliteral">&quot;Checking if extension %s@%s exists (devicestate)\n&quot;</span>, exten, context);
<a name="l00147"></a>00147 
<a name="l00148"></a>00148    res = <a class="code" href="pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7" title="Determine whether an extension exists.">ast_exists_extension</a>(NULL, context, exten, 1, NULL);
<a name="l00149"></a>00149    <span class="keywordflow">if</span> (!res)      
<a name="l00150"></a>00150       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea9c008e1d20858cbc3275c157e02ebc94">AST_DEVICE_INVALID</a>;
<a name="l00151"></a>00151    
<a name="l00152"></a>00152    res = <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeadee91fc4886ffc7b4efb8459cef48fe2">AST_DEVICE_NOT_INUSE</a>;
<a name="l00153"></a>00153    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;locals);
<a name="l00154"></a>00154    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;locals, lp, list) {
<a name="l00155"></a>00155       <span class="keywordflow">if</span> (!strcmp(exten, lp-&gt;<a class="code" href="structlocal__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>) &amp;&amp; !strcmp(context, lp-&gt;<a class="code" href="structlocal__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>) &amp;&amp; lp-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l00156"></a>00156          res = <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea23aa227468c09b5ebd0fb01b4c895190">AST_DEVICE_INUSE</a>;
<a name="l00157"></a>00157          <span class="keywordflow">break</span>;
<a name="l00158"></a>00158       }
<a name="l00159"></a>00159    }
<a name="l00160"></a>00160    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;locals);
<a name="l00161"></a>00161 
<a name="l00162"></a>00162    <span class="keywordflow">return</span> res;
<a name="l00163"></a>00163 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a802318a5ecac4ca675dd47e487c51dc4"></a><!-- doxytag: member="chan_local.c::local_digit_begin" ref="a802318a5ecac4ca675dd47e487c51dc4" args="(struct ast_channel *ast, char digit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int local_digit_begin </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>digit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00438">438</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00122">AST_FRAME_DTMF_BEGIN</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="chan__local_8c_source.html#l00055">IS_OUTBOUND</a>, <a class="el" href="chan__local_8c_source.html#l00206">local_queue_frame()</a>, <a class="el" href="chan__local_8c_source.html#l00104">local_pvt::lock</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00439"></a>00439 {
<a name="l00440"></a>00440    <span class="keyword">struct </span><a class="code" href="structlocal__pvt.html">local_pvt</a> *p = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l00441"></a>00441    <span class="keywordtype">int</span> res = -1;
<a name="l00442"></a>00442    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> <a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a> = { <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a9b350360a64b55c7590f1ec03db480be">AST_FRAME_DTMF_BEGIN</a>, };
<a name="l00443"></a>00443    <span class="keywordtype">int</span> isoutbound;
<a name="l00444"></a>00444 
<a name="l00445"></a>00445    <span class="keywordflow">if</span> (!p)
<a name="l00446"></a>00446       <span class="keywordflow">return</span> -1;
<a name="l00447"></a>00447 
<a name="l00448"></a>00448    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00449"></a>00449    isoutbound = <a class="code" href="chan__local_8c.html#a48b854202c838869c110779e5a2ba0ca">IS_OUTBOUND</a>(ast, p);
<a name="l00450"></a>00450    f.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = digit;
<a name="l00451"></a>00451    <span class="keywordflow">if</span> (!(res = <a class="code" href="chan__local_8c.html#ad70e2cf6223c9683a8054d8558809c8d">local_queue_frame</a>(p, isoutbound, &amp;f, ast, 0)))
<a name="l00452"></a>00452       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00453"></a>00453 
<a name="l00454"></a>00454    <span class="keywordflow">return</span> res;
<a name="l00455"></a>00455 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad833c5642f35faf293cacd4590637228"></a><!-- doxytag: member="chan_local.c::local_digit_end" ref="ad833c5642f35faf293cacd4590637228" args="(struct ast_channel *ast, char digit, unsigned int duration)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int local_digit_end </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>digit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>duration</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00457">457</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00099">AST_FRAME_DTMF_END</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="chan__local_8c_source.html#l00055">IS_OUTBOUND</a>, <a class="el" href="frame_8h_source.html#l00169">ast_frame::len</a>, <a class="el" href="chan__local_8c_source.html#l00206">local_queue_frame()</a>, <a class="el" href="chan__local_8c_source.html#l00104">local_pvt::lock</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00458"></a>00458 {
<a name="l00459"></a>00459    <span class="keyword">struct </span><a class="code" href="structlocal__pvt.html">local_pvt</a> *p = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l00460"></a>00460    <span class="keywordtype">int</span> res = -1;
<a name="l00461"></a>00461    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> <a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a> = { <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a98e65764bc963016c394bcc1bad6540b">AST_FRAME_DTMF_END</a>, };
<a name="l00462"></a>00462    <span class="keywordtype">int</span> isoutbound;
<a name="l00463"></a>00463 
<a name="l00464"></a>00464    <span class="keywordflow">if</span> (!p)
<a name="l00465"></a>00465       <span class="keywordflow">return</span> -1;
<a name="l00466"></a>00466 
<a name="l00467"></a>00467    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00468"></a>00468    isoutbound = <a class="code" href="chan__local_8c.html#a48b854202c838869c110779e5a2ba0ca">IS_OUTBOUND</a>(ast, p);
<a name="l00469"></a>00469    f.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = digit;
<a name="l00470"></a>00470    f.<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a> = duration;
<a name="l00471"></a>00471    <span class="keywordflow">if</span> (!(res = <a class="code" href="chan__local_8c.html#ad70e2cf6223c9683a8054d8558809c8d">local_queue_frame</a>(p, isoutbound, &amp;f, ast, 0)))
<a name="l00472"></a>00472       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00473"></a>00473 
<a name="l00474"></a>00474    <span class="keywordflow">return</span> res;
<a name="l00475"></a>00475 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acf188e90f068e7ca1f82e705fb679f73"></a><!-- doxytag: member="chan_local.c::local_fixup" ref="acf188e90f068e7ca1f82e705fb679f73" args="(struct ast_channel *oldchan, struct ast_channel *newchan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int local_fixup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>oldchan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>newchan</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00387">387</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="chan__local_8c_source.html#l00111">local_pvt::chan</a>, <a class="el" href="chan__local_8c_source.html#l00104">local_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__local_8c_source.html#l00110">local_pvt::owner</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00388"></a>00388 {
<a name="l00389"></a>00389    <span class="keyword">struct </span><a class="code" href="structlocal__pvt.html">local_pvt</a> *p = newchan-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l00390"></a>00390 
<a name="l00391"></a>00391    <span class="keywordflow">if</span> (!p)
<a name="l00392"></a>00392       <span class="keywordflow">return</span> -1;
<a name="l00393"></a>00393 
<a name="l00394"></a>00394    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00395"></a>00395 
<a name="l00396"></a>00396    <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> != oldchan) &amp;&amp; (p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a> != oldchan)) {
<a name="l00397"></a>00397       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Old channel wasn&apos;t %p but was %p/%p\n&quot;</span>, oldchan, p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>);
<a name="l00398"></a>00398       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00399"></a>00399       <span class="keywordflow">return</span> -1;
<a name="l00400"></a>00400    }
<a name="l00401"></a>00401    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> == oldchan)
<a name="l00402"></a>00402       p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = newchan;
<a name="l00403"></a>00403    <span class="keywordflow">else</span>
<a name="l00404"></a>00404       p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a> = newchan;
<a name="l00405"></a>00405    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00406"></a>00406    <span class="keywordflow">return</span> 0;
<a name="l00407"></a>00407 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad93a911b38a7898024708bc097b57aaa"></a><!-- doxytag: member="chan_local.c::local_hangup" ref="ad93a911b38a7898024708bc097b57aaa" args="(struct ast_channel *ast)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int local_hangup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Hangup a call through the local proxy channel. </p>

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00582">582</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02037">ast_channel_trylock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="utils_8h_source.html#l00075">ast_clear_flag</a>, <a class="el" href="frame_8h_source.html#l00298">AST_CONTROL_HANGUP</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="channel_8h_source.html#l00554">AST_FLAG_ANSWERED_ELSEWHERE</a>, <a class="el" href="frame_8h_source.html#l00105">AST_FRAME_CONTROL</a>, <a class="el" href="channel_8c_source.html#l01690">ast_hangup()</a>, <a class="el" href="linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00838">AST_LIST_REMOVE</a>, <a class="el" href="linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="module_8h_source.html#l00241">ast_module_user_remove</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="channel_8c_source.html#l01091">ast_queue_hangup()</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="chan__local_8c_source.html#l00111">local_pvt::chan</a>, <a class="el" href="lock_8h_source.html#l01676">DEADLOCK_AVOIDANCE</a>, <a class="el" href="channel_8h_source.html#l00479">ast_channel::hangupcause</a>, <a class="el" href="chan__local_8c_source.html#l00055">IS_OUTBOUND</a>, <a class="el" href="chan__local_8c_source.html#l00118">LOCAL_CANCEL_QUEUE</a>, <a class="el" href="chan__local_8c_source.html#l00117">LOCAL_GLARE_DETECT</a>, <a class="el" href="chan__local_8c_source.html#l00120">LOCAL_LAUNCHED_PBX</a>, <a class="el" href="chan__local_8c_source.html#l00168">local_pvt_destroy()</a>, <a class="el" href="chan__local_8c_source.html#l00206">local_queue_frame()</a>, <a class="el" href="chan__local_8c_source.html#l00104">local_pvt::lock</a>, <a class="el" href="chan__local_8c_source.html#l00110">local_pvt::owner</a>, <a class="el" href="pbx_8c_source.html#l08951">pbx_builtin_getvar_helper()</a>, <a class="el" href="pbx_8c_source.html#l09023">pbx_builtin_setvar_helper()</a>, <a class="el" href="app__jack_8c_source.html#l00141">status</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, <a class="el" href="chan__local_8c_source.html#l00113">local_pvt::u_chan</a>, and <a class="el" href="chan__local_8c_source.html#l00112">local_pvt::u_owner</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00583"></a>00583 {
<a name="l00584"></a>00584    <span class="keyword">struct </span><a class="code" href="structlocal__pvt.html">local_pvt</a> *p = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l00585"></a>00585    <span class="keywordtype">int</span> isoutbound;
<a name="l00586"></a>00586    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> <a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a> = { <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa7dac1c1896ab418c2ff351aae707fba">AST_CONTROL_HANGUP</a>, .data.uint32 = ast-&gt;<a class="code" href="structast__channel.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a> };
<a name="l00587"></a>00587    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *ochan = NULL;
<a name="l00588"></a>00588    <span class="keywordtype">int</span> glaredetect = 0, res = 0;
<a name="l00589"></a>00589 
<a name="l00590"></a>00590    <span class="keywordflow">if</span> (!p)
<a name="l00591"></a>00591       <span class="keywordflow">return</span> -1;
<a name="l00592"></a>00592 
<a name="l00593"></a>00593    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00594"></a>00594 
<a name="l00595"></a>00595    isoutbound = <a class="code" href="chan__local_8c.html#a48b854202c838869c110779e5a2ba0ca">IS_OUTBOUND</a>(ast, p);
<a name="l00596"></a>00596 
<a name="l00597"></a>00597    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a> &amp;&amp; <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(ast, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329ac2c6da6c29fad431dfb87caf552315d7">AST_FLAG_ANSWERED_ELSEWHERE</a>)) {
<a name="l00598"></a>00598       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329ac2c6da6c29fad431dfb87caf552315d7">AST_FLAG_ANSWERED_ELSEWHERE</a>);
<a name="l00599"></a>00599       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;This local call has the ANSWERED_ELSEWHERE flag set.\n&quot;</span>);
<a name="l00600"></a>00600    }
<a name="l00601"></a>00601 
<a name="l00602"></a>00602    <span class="keywordflow">if</span> (isoutbound) {
<a name="l00603"></a>00603       <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a> = <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <span class="stringliteral">&quot;DIALSTATUS&quot;</span>);
<a name="l00604"></a>00604       <span class="keywordflow">if</span> ((status) &amp;&amp; (p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {
<a name="l00605"></a>00605          <span class="comment">/* Deadlock avoidance */</span>
<a name="l00606"></a>00606          <span class="keywordflow">while</span> (p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; <a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {
<a name="l00607"></a>00607             <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00608"></a>00608             <span class="keywordflow">if</span> (ast) {
<a name="l00609"></a>00609                <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(ast);
<a name="l00610"></a>00610             }
<a name="l00611"></a>00611             usleep(1);
<a name="l00612"></a>00612             <span class="keywordflow">if</span> (ast) {
<a name="l00613"></a>00613                <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(ast);
<a name="l00614"></a>00614             }
<a name="l00615"></a>00615             <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00616"></a>00616          }
<a name="l00617"></a>00617          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l00618"></a>00618             <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <span class="stringliteral">&quot;CHANLOCALSTATUS&quot;</span>, status);
<a name="l00619"></a>00619             <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l00620"></a>00620          }
<a name="l00621"></a>00621       }
<a name="l00622"></a>00622       p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a> = NULL;
<a name="l00623"></a>00623       <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(p, <a class="code" href="chan__local_8c.html#a86ae99b603592b39c2ce36e3a0f5f05f">LOCAL_LAUNCHED_PBX</a>);
<a name="l00624"></a>00624       <a class="code" href="module_8h.html#aac87725d61b6daf4ce7d7b505f1b68c9">ast_module_user_remove</a>(p-&gt;<a class="code" href="structlocal__pvt.html#ad920feae5f5f7513158358b903ed4714">u_chan</a>);
<a name="l00625"></a>00625    } <span class="keywordflow">else</span> {
<a name="l00626"></a>00626       <a class="code" href="module_8h.html#aac87725d61b6daf4ce7d7b505f1b68c9">ast_module_user_remove</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a5ebd3686d41172c162916c155d01a4d4">u_owner</a>);
<a name="l00627"></a>00627       <span class="keywordflow">while</span> (p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a> &amp;&amp; <a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>)) {
<a name="l00628"></a>00628          <a class="code" href="lock_8h.html#a851106e971b4611a38cb4be8b39d9fcf">DEADLOCK_AVOIDANCE</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00629"></a>00629       }
<a name="l00630"></a>00630       p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = NULL;
<a name="l00631"></a>00631       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>) {
<a name="l00632"></a>00632          <a class="code" href="channel_8h.html#a30bcf0418189567bc84ff32034f79f28" title="Queue a hangup frame.">ast_queue_hangup</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>);
<a name="l00633"></a>00633          <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>);
<a name="l00634"></a>00634       }
<a name="l00635"></a>00635    }
<a name="l00636"></a>00636    
<a name="l00637"></a>00637    ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a> = NULL;
<a name="l00638"></a>00638    
<a name="l00639"></a>00639    <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; !p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>) {
<a name="l00640"></a>00640       <span class="comment">/* Okay, done with the private part now, too. */</span>
<a name="l00641"></a>00641       glaredetect = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(p, <a class="code" href="chan__local_8c.html#a2a06cfc908e9a039bacb589e2757ad3b">LOCAL_GLARE_DETECT</a>);
<a name="l00642"></a>00642       <span class="comment">/* If we have a queue holding, don&apos;t actually destroy p yet, but</span>
<a name="l00643"></a>00643 <span class="comment">         let local_queue do it. */</span>
<a name="l00644"></a>00644       <span class="keywordflow">if</span> (glaredetect)
<a name="l00645"></a>00645          <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(p, <a class="code" href="chan__local_8c.html#ae3db3ff32ac1599fd324b0a274e64a4f">LOCAL_CANCEL_QUEUE</a>);
<a name="l00646"></a>00646       <span class="comment">/* Remove from list */</span>
<a name="l00647"></a>00647       <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;locals);
<a name="l00648"></a>00648       <a class="code" href="linkedlists_8h.html#aa36e72b77f1b80881cd0a9fcca66ce19" title="Removes a specific entry from a list.">AST_LIST_REMOVE</a>(&amp;locals, p, list);
<a name="l00649"></a>00649       <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;locals);
<a name="l00650"></a>00650       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00651"></a>00651       <span class="comment">/* And destroy */</span>
<a name="l00652"></a>00652       <span class="keywordflow">if</span> (!glaredetect) {
<a name="l00653"></a>00653          p = <a class="code" href="chan__local_8c.html#ad3baf6d2d68dc30a2ab0a8adb8e1d6aa">local_pvt_destroy</a>(p);
<a name="l00654"></a>00654       }
<a name="l00655"></a>00655       <span class="keywordflow">return</span> 0;
<a name="l00656"></a>00656    }
<a name="l00657"></a>00657    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a> &amp;&amp; !<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(p, <a class="code" href="chan__local_8c.html#a86ae99b603592b39c2ce36e3a0f5f05f">LOCAL_LAUNCHED_PBX</a>))
<a name="l00658"></a>00658       <span class="comment">/* Need to actually hangup since there is no PBX */</span>
<a name="l00659"></a>00659       ochan = p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>;
<a name="l00660"></a>00660    <span class="keywordflow">else</span>
<a name="l00661"></a>00661       res = <a class="code" href="chan__local_8c.html#ad70e2cf6223c9683a8054d8558809c8d">local_queue_frame</a>(p, isoutbound, &amp;f, NULL, 1);
<a name="l00662"></a>00662    <span class="keywordflow">if</span> (!res)
<a name="l00663"></a>00663       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00664"></a>00664    <span class="keywordflow">if</span> (ochan)
<a name="l00665"></a>00665       <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(ochan);
<a name="l00666"></a>00666    <span class="keywordflow">return</span> 0;
<a name="l00667"></a>00667 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a47dace02b55c7a3669166a3a5b92fa44"></a><!-- doxytag: member="chan_local.c::local_indicate" ref="a47dace02b55c7a3669166a3a5b92fa44" args="(struct ast_channel *ast, int condition, const void *data, size_t datalen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int local_indicate </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>condition</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>datalen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00409">409</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00313">AST_CONTROL_HOLD</a>, <a class="el" href="frame_8h_source.html#l00314">AST_CONTROL_UNHOLD</a>, <a class="el" href="frame_8h_source.html#l00105">AST_FRAME_CONTROL</a>, <a class="el" href="channel_8c_source.html#l05538">ast_moh_start()</a>, <a class="el" href="channel_8c_source.html#l05549">ast_moh_stop()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="frame_8h_source.html#l00147">ast_frame::datalen</a>, <a class="el" href="chan__local_8c_source.html#l00055">IS_OUTBOUND</a>, <a class="el" href="chan__local_8c_source.html#l00123">LOCAL_MOH_PASSTHRU</a>, <a class="el" href="chan__local_8c_source.html#l00206">local_queue_frame()</a>, <a class="el" href="chan__local_8c_source.html#l00104">local_pvt::lock</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::ptr</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00410"></a>00410 {
<a name="l00411"></a>00411    <span class="keyword">struct </span><a class="code" href="structlocal__pvt.html">local_pvt</a> *p = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l00412"></a>00412    <span class="keywordtype">int</span> res = 0;
<a name="l00413"></a>00413    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> <a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a> = { <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>, };
<a name="l00414"></a>00414    <span class="keywordtype">int</span> isoutbound;
<a name="l00415"></a>00415 
<a name="l00416"></a>00416    <span class="keywordflow">if</span> (!p)
<a name="l00417"></a>00417       <span class="keywordflow">return</span> -1;
<a name="l00418"></a>00418 
<a name="l00419"></a>00419    <span class="comment">/* If this is an MOH hold or unhold, do it on the Local channel versus real channel */</span>
<a name="l00420"></a>00420    <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(p, <a class="code" href="chan__local_8c.html#ac86645f50a371a56ef6ef719880456fc">LOCAL_MOH_PASSTHRU</a>) &amp;&amp; condition == <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ab99a3d1c08c5ae8bca078c7cd1ec02f5">AST_CONTROL_HOLD</a>) {
<a name="l00421"></a>00421       <a class="code" href="musiconhold_8h.html#a2acec01f2fddd8ca494d874003815cf7" title="Turn on music on hold on a given channel.">ast_moh_start</a>(ast, <a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>, NULL);
<a name="l00422"></a>00422    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(p, <a class="code" href="chan__local_8c.html#ac86645f50a371a56ef6ef719880456fc">LOCAL_MOH_PASSTHRU</a>) &amp;&amp; condition == <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>) {
<a name="l00423"></a>00423       <a class="code" href="musiconhold_8h.html#a52fead32f69533450f3c05b2e6960149" title="Turn off music on hold on a given channel.">ast_moh_stop</a>(ast);
<a name="l00424"></a>00424    } <span class="keywordflow">else</span> {
<a name="l00425"></a>00425       <span class="comment">/* Queue up a frame representing the indication as a control frame */</span>
<a name="l00426"></a>00426       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00427"></a>00427       isoutbound = <a class="code" href="chan__local_8c.html#a48b854202c838869c110779e5a2ba0ca">IS_OUTBOUND</a>(ast, p);
<a name="l00428"></a>00428       f.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = condition;
<a name="l00429"></a>00429       f.<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> = (<span class="keywordtype">void</span>*)<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>;
<a name="l00430"></a>00430       f.<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> = <a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>;
<a name="l00431"></a>00431       <span class="keywordflow">if</span> (!(res = <a class="code" href="chan__local_8c.html#ad70e2cf6223c9683a8054d8558809c8d">local_queue_frame</a>(p, isoutbound, &amp;f, ast, 1)))
<a name="l00432"></a>00432          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00433"></a>00433    }
<a name="l00434"></a>00434 
<a name="l00435"></a>00435    <span class="keywordflow">return</span> res;
<a name="l00436"></a>00436 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a76d745a387bc08cb48428b9328b79bbb"></a><!-- doxytag: member="chan_local.c::local_new" ref="a76d745a387bc08cb48428b9328b79bbb" args="(struct local_pvt *p, int state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__channel.html">ast_channel</a>* local_new </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlocal__pvt.html">local_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>state</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Start new local channel. </p>

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00734">734</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00473">ast_channel::amaflags</a>, <a class="el" href="channel_8c_source.html#l00711">ast_best_codec()</a>, <a class="el" href="channel_8h_source.html#l00730">ast_channel_alloc</a>, <a class="el" href="channel_8c_source.html#l01388">ast_channel_free()</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="abstract__jb_8c_source.html#l00610">ast_jb_configure()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="module_8h_source.html#l00240">ast_module_user_add</a>, <a class="el" href="utils_8c_source.html#l01401">ast_random()</a>, <a class="el" href="channel_8h_source.html#l00363">AST_STATE_RING</a>, <a class="el" href="chan__local_8c_source.html#l00111">local_pvt::chan</a>, <a class="el" href="channel_8h_source.html#l00503">ast_channel::context</a>, <a class="el" href="chan__local_8c_source.html#l00106">local_pvt::context</a>, <a class="el" href="channel_8h_source.html#l00504">ast_channel::exten</a>, <a class="el" href="chan__local_8c_source.html#l00107">local_pvt::exten</a>, <a class="el" href="chan__local_8c_source.html#l00109">local_pvt::jb_conf</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="channel_8h_source.html#l00482">ast_channel::nativeformats</a>, <a class="el" href="chan__local_8c_source.html#l00110">local_pvt::owner</a>, <a class="el" href="channel_8h_source.html#l00471">ast_channel::priority</a>, <a class="el" href="channel_8h_source.html#l00485">ast_channel::rawreadformat</a>, <a class="el" href="channel_8h_source.html#l00486">ast_channel::rawwriteformat</a>, <a class="el" href="channel_8h_source.html#l00483">ast_channel::readformat</a>, <a class="el" href="chan__local_8c_source.html#l00108">local_pvt::reqformat</a>, <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, <a class="el" href="chan__local_8c_source.html#l00113">local_pvt::u_chan</a>, <a class="el" href="chan__local_8c_source.html#l00112">local_pvt::u_owner</a>, and <a class="el" href="channel_8h_source.html#l00484">ast_channel::writeformat</a>.</p>

<p>Referenced by <a class="el" href="chan__local_8c_source.html#l00798">local_request()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00735"></a>00735 {
<a name="l00736"></a>00736    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *tmp = NULL, *tmp2 = NULL;
<a name="l00737"></a>00737    <span class="keywordtype">int</span> randnum = <a class="code" href="utils_8h.html#a7b4f10b070e95ba413e258a3e4b03c20">ast_random</a>() &amp; 0xffff, fmt = 0;
<a name="l00738"></a>00738    <span class="keyword">const</span> <span class="keywordtype">char</span> *t;
<a name="l00739"></a>00739    <span class="keywordtype">int</span> ama;
<a name="l00740"></a>00740 
<a name="l00741"></a>00741    <span class="comment">/* Allocate two new Asterisk channels */</span>
<a name="l00742"></a>00742    <span class="comment">/* safe accountcode */</span>
<a name="l00743"></a>00743    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;accountcode)
<a name="l00744"></a>00744       t = p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;accountcode;
<a name="l00745"></a>00745    <span class="keywordflow">else</span>
<a name="l00746"></a>00746       t = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00747"></a>00747 
<a name="l00748"></a>00748    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)
<a name="l00749"></a>00749       ama = p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#ad2cfb0f821c065261382a9298bb5a16b">amaflags</a>;
<a name="l00750"></a>00750    <span class="keywordflow">else</span>
<a name="l00751"></a>00751       ama = 0;
<a name="l00752"></a>00752    <span class="keywordflow">if</span> (!(tmp = <a class="code" href="channel_8h.html#adfbceb39821586c0f9be0c47496a4e18">ast_channel_alloc</a>(1, <a class="code" href="structstate.html">state</a>, 0, 0, t, p-&gt;<a class="code" href="structlocal__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>, p-&gt;<a class="code" href="structlocal__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, ama, <span class="stringliteral">&quot;Local/%s@%s-%04x;1&quot;</span>, p-&gt;<a class="code" href="structlocal__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>, p-&gt;<a class="code" href="structlocal__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, randnum)) 
<a name="l00753"></a>00753          || !(tmp2 = <a class="code" href="channel_8h.html#adfbceb39821586c0f9be0c47496a4e18">ast_channel_alloc</a>(1, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>, 0, 0, t, p-&gt;<a class="code" href="structlocal__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>, p-&gt;<a class="code" href="structlocal__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, ama, <span class="stringliteral">&quot;Local/%s@%s-%04x;2&quot;</span>, p-&gt;<a class="code" href="structlocal__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>, p-&gt;<a class="code" href="structlocal__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, randnum))) {
<a name="l00754"></a>00754       <span class="keywordflow">if</span> (tmp)
<a name="l00755"></a>00755          <a class="code" href="channel_8h.html#a239d899b30002db4e8b08c055ac9d8e5" title="Free a channel structure.">ast_channel_free</a>(tmp);
<a name="l00756"></a>00756       <span class="keywordflow">if</span> (tmp2)
<a name="l00757"></a>00757          <a class="code" href="channel_8h.html#a239d899b30002db4e8b08c055ac9d8e5" title="Free a channel structure.">ast_channel_free</a>(tmp2);
<a name="l00758"></a>00758       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to allocate channel structure(s)\n&quot;</span>);
<a name="l00759"></a>00759       <span class="keywordflow">return</span> NULL;
<a name="l00760"></a>00760    } 
<a name="l00761"></a>00761 
<a name="l00762"></a>00762    tmp2-&gt;tech = tmp-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a> = &amp;<a class="code" href="chan__local_8c.html#a6d83e64e81a38a3cd94555a85fe07130">local_tech</a>;
<a name="l00763"></a>00763 
<a name="l00764"></a>00764    tmp-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a> = p-&gt;<a class="code" href="structlocal__pvt.html#a1485d446d8c32da1836fa47a11e164ce">reqformat</a>;
<a name="l00765"></a>00765    tmp2-&gt;nativeformats = p-&gt;<a class="code" href="structlocal__pvt.html#a1485d446d8c32da1836fa47a11e164ce">reqformat</a>;
<a name="l00766"></a>00766 
<a name="l00767"></a>00767    <span class="comment">/* Determine our read/write format and set it on each channel */</span>
<a name="l00768"></a>00768    fmt = <a class="code" href="channel_8h.html#a4d78194779a26341c3ec7298b450b9ed" title="Pick the best audio codec.">ast_best_codec</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a1485d446d8c32da1836fa47a11e164ce">reqformat</a>);
<a name="l00769"></a>00769    tmp-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a> = fmt;
<a name="l00770"></a>00770    tmp2-&gt;writeformat = fmt;
<a name="l00771"></a>00771    tmp-&gt;<a class="code" href="structast__channel.html#a045b6dfdee84adceb7e86b6c5c4f9a86">rawwriteformat</a> = fmt;
<a name="l00772"></a>00772    tmp2-&gt;rawwriteformat = fmt;
<a name="l00773"></a>00773    tmp-&gt;<a class="code" href="structast__channel.html#ab7786a0f5b9a9ebf83daed87be4f3868">readformat</a> = fmt;
<a name="l00774"></a>00774    tmp2-&gt;readformat = fmt;
<a name="l00775"></a>00775    tmp-&gt;<a class="code" href="structast__channel.html#a6fcf944239e3718e282e0ba7512e66c6">rawreadformat</a> = fmt;
<a name="l00776"></a>00776    tmp2-&gt;rawreadformat = fmt;
<a name="l00777"></a>00777 
<a name="l00778"></a>00778    tmp-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a> = p;
<a name="l00779"></a>00779    tmp2-&gt;tech_pvt = p;
<a name="l00780"></a>00780 
<a name="l00781"></a>00781    p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = tmp;
<a name="l00782"></a>00782    p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a> = tmp2;
<a name="l00783"></a>00783    p-&gt;<a class="code" href="structlocal__pvt.html#a5ebd3686d41172c162916c155d01a4d4">u_owner</a> = <a class="code" href="module_8h.html#ab941a600dc47b469ab225f140bc0973f">ast_module_user_add</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l00784"></a>00784    p-&gt;<a class="code" href="structlocal__pvt.html#ad920feae5f5f7513158358b903ed4714">u_chan</a> = <a class="code" href="module_8h.html#ab941a600dc47b469ab225f140bc0973f">ast_module_user_add</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>);
<a name="l00785"></a>00785 
<a name="l00786"></a>00786    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, p-&gt;<a class="code" href="structlocal__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>));
<a name="l00787"></a>00787    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp2-&gt;context, p-&gt;<a class="code" href="structlocal__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <span class="keyword">sizeof</span>(tmp2-&gt;context));
<a name="l00788"></a>00788    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp2-&gt;exten, p-&gt;<a class="code" href="structlocal__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>));
<a name="l00789"></a>00789    tmp-&gt;<a class="code" href="structast__channel.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> = 1;
<a name="l00790"></a>00790    tmp2-&gt;priority = 1;
<a name="l00791"></a>00791 
<a name="l00792"></a>00792    <a class="code" href="abstract__jb_8h.html#a0981c84ac90dd79bc2a0fdd90aa6efba" title="Configures a jitterbuffer on a channel.">ast_jb_configure</a>(tmp, &amp;p-&gt;<a class="code" href="structlocal__pvt.html#a09abe21e12f90d900a42e110cd0e3310">jb_conf</a>);
<a name="l00793"></a>00793 
<a name="l00794"></a>00794    <span class="keywordflow">return</span> tmp;
<a name="l00795"></a>00795 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad3baf6d2d68dc30a2ab0a8adb8e1d6aa"></a><!-- doxytag: member="chan_local.c::local_pvt_destroy" ref="ad3baf6d2d68dc30a2ab0a8adb8e1d6aa" args="(struct local_pvt *pvt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structlocal__pvt.html">local_pvt</a>* local_pvt_destroy </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlocal__pvt.html">local_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>pvt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="note"><dt><b>Note:</b></dt><dd>Assumes the pvt is no longer in the pvts list </dd></dl>

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00168">168</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="lock_8h_source.html#l01712">ast_mutex_destroy()</a>, and <a class="el" href="chan__local_8c_source.html#l00104">local_pvt::lock</a>.</p>

<p>Referenced by <a class="el" href="chan__local_8c_source.html#l00670">local_alloc()</a>, <a class="el" href="chan__local_8c_source.html#l00582">local_hangup()</a>, <a class="el" href="chan__local_8c_source.html#l00206">local_queue_frame()</a>, and <a class="el" href="chan__local_8c_source.html#l00798">local_request()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00169"></a>00169 {
<a name="l00170"></a>00170    <a class="code" href="lock_8h.html#ab237e70b569019bfb490ab0c3c09b8c5">ast_mutex_destroy</a>(&amp;pvt-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00171"></a>00171    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(pvt);
<a name="l00172"></a>00172    <span class="keywordflow">return</span> NULL;
<a name="l00173"></a>00173 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad70e2cf6223c9683a8054d8558809c8d"></a><!-- doxytag: member="chan_local.c::local_queue_frame" ref="ad70e2cf6223c9683a8054d8558809c8d" args="(struct local_pvt *p, int isoutbound, struct ast_frame *f, struct ast_channel *us, int us_locked)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int local_queue_frame </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlocal__pvt.html">local_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>isoutbound</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td>
          <td class="paramname"> <em>f</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>us</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>us_locked</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00206">206</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02037">ast_channel_trylock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="utils_8h_source.html#l00075">ast_clear_flag</a>, <a class="el" href="frame_8h_source.html#l00300">AST_CONTROL_RINGING</a>, <a class="el" href="frame_8h_source.html#l00105">AST_FRAME_CONTROL</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01722">ast_mutex_trylock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="channel_8c_source.html#l01080">ast_queue_frame()</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="channel_8c_source.html#l04695">ast_setstate()</a>, <a class="el" href="channel_8h_source.html#l00364">AST_STATE_RINGING</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="chan__local_8c_source.html#l00111">local_pvt::chan</a>, <a class="el" href="lock_8h_source.html#l01671">CHANNEL_DEADLOCK_AVOIDANCE</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="channel_8h_source.html#l00404">ast_channel::generator</a>, <a class="el" href="chan__local_8c_source.html#l00118">LOCAL_CANCEL_QUEUE</a>, <a class="el" href="chan__local_8c_source.html#l00117">LOCAL_GLARE_DETECT</a>, <a class="el" href="chan__local_8c_source.html#l00168">local_pvt_destroy()</a>, <a class="el" href="chan__local_8c_source.html#l00104">local_pvt::lock</a>, <a class="el" href="chan__local_8c_source.html#l00110">local_pvt::owner</a>, and <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>.</p>

<p>Referenced by <a class="el" href="chan__local_8c_source.html#l00267">local_answer()</a>, <a class="el" href="chan__local_8c_source.html#l00438">local_digit_begin()</a>, <a class="el" href="chan__local_8c_source.html#l00457">local_digit_end()</a>, <a class="el" href="chan__local_8c_source.html#l00582">local_hangup()</a>, <a class="el" href="chan__local_8c_source.html#l00409">local_indicate()</a>, <a class="el" href="chan__local_8c_source.html#l00496">local_sendhtml()</a>, <a class="el" href="chan__local_8c_source.html#l00477">local_sendtext()</a>, and <a class="el" href="chan__local_8c_source.html#l00362">local_write()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00208"></a>00208 {
<a name="l00209"></a>00209    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *other = NULL;
<a name="l00210"></a>00210 
<a name="l00211"></a>00211    <span class="comment">/* Recalculate outbound channel */</span>
<a name="l00212"></a>00212    other = isoutbound ? p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> : p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>;
<a name="l00213"></a>00213 
<a name="l00214"></a>00214    <span class="keywordflow">if</span> (!other) {
<a name="l00215"></a>00215       <span class="keywordflow">return</span> 0;
<a name="l00216"></a>00216    }
<a name="l00217"></a>00217 
<a name="l00218"></a>00218    <span class="comment">/* do not queue frame if generator is on both local channels */</span>
<a name="l00219"></a>00219    <span class="keywordflow">if</span> (us &amp;&amp; us-&gt;<a class="code" href="structast__channel.html#a4e855ab0f984741b9083b2c5a0fdfe18">generator</a> &amp;&amp; other-&gt;<a class="code" href="structast__channel.html#a4e855ab0f984741b9083b2c5a0fdfe18">generator</a>) {
<a name="l00220"></a>00220       <span class="keywordflow">return</span> 0;
<a name="l00221"></a>00221    }
<a name="l00222"></a>00222 
<a name="l00223"></a>00223    <span class="comment">/* Set glare detection */</span>
<a name="l00224"></a>00224    <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(p, <a class="code" href="chan__local_8c.html#a2a06cfc908e9a039bacb589e2757ad3b">LOCAL_GLARE_DETECT</a>);
<a name="l00225"></a>00225 
<a name="l00226"></a>00226    <span class="comment">/* Ensure that we have both channels locked */</span>
<a name="l00227"></a>00227    <span class="keywordflow">while</span> (other &amp;&amp; <a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(other)) {
<a name="l00228"></a>00228       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00229"></a>00229       <span class="keywordflow">if</span> (us &amp;&amp; us_locked) {
<a name="l00230"></a>00230          <span class="keywordflow">do</span> {
<a name="l00231"></a>00231             <a class="code" href="lock_8h.html#a7b1d6c8183a6f6f42a98239da3d1c7ca">CHANNEL_DEADLOCK_AVOIDANCE</a>(us);
<a name="l00232"></a>00232          } <span class="keywordflow">while</span> (<a class="code" href="lock_8h.html#a036ccafa2339f674a46bc269bbd48c5f">ast_mutex_trylock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>));
<a name="l00233"></a>00233       } <span class="keywordflow">else</span> {
<a name="l00234"></a>00234          usleep(1);
<a name="l00235"></a>00235          <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00236"></a>00236       }
<a name="l00237"></a>00237       other = isoutbound ? p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> : p-&gt;<a class="code" href="structlocal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>;
<a name="l00238"></a>00238    }
<a name="l00239"></a>00239 
<a name="l00240"></a>00240    <span class="comment">/* Since glare detection only occurs within this function, and because</span>
<a name="l00241"></a>00241 <span class="comment">    * a pvt flag cannot be set without having the pvt lock, this is the only</span>
<a name="l00242"></a>00242 <span class="comment">    * location where we could detect a cancelling of the queue. */</span>
<a name="l00243"></a>00243    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(p, <a class="code" href="chan__local_8c.html#ae3db3ff32ac1599fd324b0a274e64a4f">LOCAL_CANCEL_QUEUE</a>)) {
<a name="l00244"></a>00244       <span class="comment">/* We had a glare on the hangup.  Forget all this business,</span>
<a name="l00245"></a>00245 <span class="comment">      return and destroy p.  */</span>
<a name="l00246"></a>00246       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00247"></a>00247       p = <a class="code" href="chan__local_8c.html#ad3baf6d2d68dc30a2ab0a8adb8e1d6aa">local_pvt_destroy</a>(p);
<a name="l00248"></a>00248       <span class="keywordflow">if</span> (other) {
<a name="l00249"></a>00249          <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(other);
<a name="l00250"></a>00250       }
<a name="l00251"></a>00251       <span class="keywordflow">return</span> -1;
<a name="l00252"></a>00252    }
<a name="l00253"></a>00253 
<a name="l00254"></a>00254    <span class="keywordflow">if</span> (other) {
<a name="l00255"></a>00255       <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a> &amp;&amp; f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> == <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a>) {
<a name="l00256"></a>00256          <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(other, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>);
<a name="l00257"></a>00257       }
<a name="l00258"></a>00258       <a class="code" href="channel_8h.html#a6cbcba5661d55216968cde8fdf913c89" title="Queue one or more frames to a channel&amp;#39;s frame queue.">ast_queue_frame</a>(other, f);
<a name="l00259"></a>00259       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(other);
<a name="l00260"></a>00260    }
<a name="l00261"></a>00261 
<a name="l00262"></a>00262    <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(p, <a class="code" href="chan__local_8c.html#a2a06cfc908e9a039bacb589e2757ad3b">LOCAL_GLARE_DETECT</a>);
<a name="l00263"></a>00263 
<a name="l00264"></a>00264    <span class="keywordflow">return</span> 0;
<a name="l00265"></a>00265 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a45e696a779e1b168d43a1ed313570808"></a><!-- doxytag: member="chan_local.c::local_read" ref="a45e696a779e1b168d43a1ed313570808" args="(struct ast_channel *ast)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__frame.html">ast_frame</a> * local_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00357">357</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

<p>References <a class="el" href="frame_8c_source.html#l00124">ast_null_frame</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00358"></a>00358 {
<a name="l00359"></a>00359    <span class="keywordflow">return</span> &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l00360"></a>00360 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae84ba38185efef100f8601e316fa8f7b"></a><!-- doxytag: member="chan_local.c::local_request" ref="ae84ba38185efef100f8601e316fa8f7b" args="(const char *type, int format, void *data, int *cause)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__channel.html">ast_channel</a> * local_request </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>cause</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Part of PBX interface. </p>

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00798">798</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00838">AST_LIST_REMOVE</a>, <a class="el" href="linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="channel_8h_source.html#l00359">AST_STATE_DOWN</a>, <a class="el" href="chan__local_8c_source.html#l00111">local_pvt::chan</a>, <a class="el" href="chan__local_8c_source.html#l00670">local_alloc()</a>, <a class="el" href="chan__local_8c_source.html#l00734">local_new()</a>, and <a class="el" href="chan__local_8c_source.html#l00168">local_pvt_destroy()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00799"></a>00799 {
<a name="l00800"></a>00800    <span class="keyword">struct </span><a class="code" href="structlocal__pvt.html">local_pvt</a> *p = NULL;
<a name="l00801"></a>00801    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a> = NULL;
<a name="l00802"></a>00802 
<a name="l00803"></a>00803    <span class="comment">/* Allocate a new private structure and then Asterisk channel */</span>
<a name="l00804"></a>00804    <span class="keywordflow">if</span> ((p = <a class="code" href="chan__local_8c.html#af2e11386ac23ab7cf3acfa310f3af13f" title="Create a call structure.">local_alloc</a>(<a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>, <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>))) {
<a name="l00805"></a>00805       <span class="keywordflow">if</span> (!(chan = <a class="code" href="chan__local_8c.html#a76d745a387bc08cb48428b9328b79bbb" title="Start new local channel.">local_new</a>(p, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>))) {
<a name="l00806"></a>00806          <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;locals);
<a name="l00807"></a>00807          <a class="code" href="linkedlists_8h.html#aa36e72b77f1b80881cd0a9fcca66ce19" title="Removes a specific entry from a list.">AST_LIST_REMOVE</a>(&amp;locals, p, list);
<a name="l00808"></a>00808          <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;locals);
<a name="l00809"></a>00809          p = <a class="code" href="chan__local_8c.html#ad3baf6d2d68dc30a2ab0a8adb8e1d6aa">local_pvt_destroy</a>(p);
<a name="l00810"></a>00810       }
<a name="l00811"></a>00811    }
<a name="l00812"></a>00812 
<a name="l00813"></a>00813    <span class="keywordflow">return</span> chan;
<a name="l00814"></a>00814 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ace2da02c3367a13e66cda78b7c4125cf"></a><!-- doxytag: member="chan_local.c::local_sendhtml" ref="ace2da02c3367a13e66cda78b7c4125cf" args="(struct ast_channel *ast, int subclass, const char *data, int datalen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int local_sendhtml </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>subclass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>datalen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00496">496</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00115">AST_FRAME_HTML</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="frame_8h_source.html#l00147">ast_frame::datalen</a>, <a class="el" href="chan__local_8c_source.html#l00055">IS_OUTBOUND</a>, <a class="el" href="chan__local_8c_source.html#l00206">local_queue_frame()</a>, <a class="el" href="chan__local_8c_source.html#l00104">local_pvt::lock</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::ptr</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00497"></a>00497 {
<a name="l00498"></a>00498    <span class="keyword">struct </span><a class="code" href="structlocal__pvt.html">local_pvt</a> *p = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l00499"></a>00499    <span class="keywordtype">int</span> res = -1;
<a name="l00500"></a>00500    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> <a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a> = { <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a3d91bab33583f560197e21532a02a895">AST_FRAME_HTML</a>, };
<a name="l00501"></a>00501    <span class="keywordtype">int</span> isoutbound;
<a name="l00502"></a>00502 
<a name="l00503"></a>00503    <span class="keywordflow">if</span> (!p)
<a name="l00504"></a>00504       <span class="keywordflow">return</span> -1;
<a name="l00505"></a>00505    
<a name="l00506"></a>00506    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00507"></a>00507    isoutbound = <a class="code" href="chan__local_8c.html#a48b854202c838869c110779e5a2ba0ca">IS_OUTBOUND</a>(ast, p);
<a name="l00508"></a>00508    f.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>;
<a name="l00509"></a>00509    f.<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> = (<span class="keywordtype">char</span> *)<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>;
<a name="l00510"></a>00510    f.<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> = <a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>;
<a name="l00511"></a>00511    <span class="keywordflow">if</span> (!(res = <a class="code" href="chan__local_8c.html#ad70e2cf6223c9683a8054d8558809c8d">local_queue_frame</a>(p, isoutbound, &amp;f, ast, 0)))
<a name="l00512"></a>00512       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00513"></a>00513    <span class="keywordflow">return</span> res;
<a name="l00514"></a>00514 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a47ef603eb487e86888bde68d93eb64d8"></a><!-- doxytag: member="chan_local.c::local_sendtext" ref="a47ef603eb487e86888bde68d93eb64d8" args="(struct ast_channel *ast, const char *text)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int local_sendtext </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>text</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00477">477</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00111">AST_FRAME_TEXT</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="frame_8h_source.html#l00147">ast_frame::datalen</a>, <a class="el" href="chan__local_8c_source.html#l00055">IS_OUTBOUND</a>, <a class="el" href="chan__local_8c_source.html#l00206">local_queue_frame()</a>, <a class="el" href="chan__local_8c_source.html#l00104">local_pvt::lock</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::ptr</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00478"></a>00478 {
<a name="l00479"></a>00479    <span class="keyword">struct </span><a class="code" href="structlocal__pvt.html">local_pvt</a> *p = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l00480"></a>00480    <span class="keywordtype">int</span> res = -1;
<a name="l00481"></a>00481    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> <a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a> = { <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0af7728b18670d3cd075f63d67f8867078">AST_FRAME_TEXT</a>, };
<a name="l00482"></a>00482    <span class="keywordtype">int</span> isoutbound;
<a name="l00483"></a>00483 
<a name="l00484"></a>00484    <span class="keywordflow">if</span> (!p)
<a name="l00485"></a>00485       <span class="keywordflow">return</span> -1;
<a name="l00486"></a>00486 
<a name="l00487"></a>00487    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00488"></a>00488    isoutbound = <a class="code" href="chan__local_8c.html#a48b854202c838869c110779e5a2ba0ca">IS_OUTBOUND</a>(ast, p);
<a name="l00489"></a>00489    f.<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> = (<span class="keywordtype">char</span> *) <a class="code" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>;
<a name="l00490"></a>00490    f.<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> = strlen(<a class="code" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>) + 1;
<a name="l00491"></a>00491    <span class="keywordflow">if</span> (!(res = <a class="code" href="chan__local_8c.html#ad70e2cf6223c9683a8054d8558809c8d">local_queue_frame</a>(p, isoutbound, &amp;f, ast, 0)))
<a name="l00492"></a>00492       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00493"></a>00493    <span class="keywordflow">return</span> res;
<a name="l00494"></a>00494 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab2145cc56f9475cc6d567bcce74b9f93"></a><!-- doxytag: member="chan_local.c::local_write" ref="ab2145cc56f9475cc6d567bcce74b9f93" args="(struct ast_channel *ast, struct ast_frame *f)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int local_write </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td>
          <td class="paramname"> <em>f</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00362">362</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8h_source.html#l00103">AST_FRAME_VIDEO</a>, <a class="el" href="frame_8h_source.html#l00101">AST_FRAME_VOICE</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="chan__local_8c_source.html#l00289">check_bridge()</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="chan__local_8c_source.html#l00055">IS_OUTBOUND</a>, <a class="el" href="chan__local_8c_source.html#l00119">LOCAL_ALREADY_MASQED</a>, <a class="el" href="chan__local_8c_source.html#l00206">local_queue_frame()</a>, <a class="el" href="chan__local_8c_source.html#l00104">local_pvt::lock</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00363"></a>00363 {
<a name="l00364"></a>00364    <span class="keyword">struct </span><a class="code" href="structlocal__pvt.html">local_pvt</a> *p = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l00365"></a>00365    <span class="keywordtype">int</span> res = -1;
<a name="l00366"></a>00366    <span class="keywordtype">int</span> isoutbound;
<a name="l00367"></a>00367 
<a name="l00368"></a>00368    <span class="keywordflow">if</span> (!p)
<a name="l00369"></a>00369       <span class="keywordflow">return</span> -1;
<a name="l00370"></a>00370 
<a name="l00371"></a>00371    <span class="comment">/* Just queue for delivery to the other side */</span>
<a name="l00372"></a>00372    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00373"></a>00373    isoutbound = <a class="code" href="chan__local_8c.html#a48b854202c838869c110779e5a2ba0ca">IS_OUTBOUND</a>(ast, p);
<a name="l00374"></a>00374    <span class="keywordflow">if</span> (f &amp;&amp; (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a> || f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a17ae96b6ea8a2388bb0d409e8124ff30">AST_FRAME_VIDEO</a>))
<a name="l00375"></a>00375       <a class="code" href="chan__local_8c.html#acd2b033eb75d8aefd37655ffac524194">check_bridge</a>(p, isoutbound);
<a name="l00376"></a>00376    <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(p, <a class="code" href="chan__local_8c.html#abdf68cad2071def38a4a463ee670a5d0">LOCAL_ALREADY_MASQED</a>))
<a name="l00377"></a>00377       res = <a class="code" href="chan__local_8c.html#ad70e2cf6223c9683a8054d8558809c8d">local_queue_frame</a>(p, isoutbound, f, ast, 1);
<a name="l00378"></a>00378    <span class="keywordflow">else</span> {
<a name="l00379"></a>00379       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Not posting to queue since already masked on &apos;%s&apos;\n&quot;</span>, ast-&gt;name);
<a name="l00380"></a>00380       res = 0;
<a name="l00381"></a>00381    }
<a name="l00382"></a>00382    <span class="keywordflow">if</span> (!res)
<a name="l00383"></a>00383       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00384"></a>00384    <span class="keywordflow">return</span> res;
<a name="l00385"></a>00385 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a36c5d4ca60db345cd702a5ed9f0c4ca6"></a><!-- doxytag: member="chan_local.c::locals_show" ref="a36c5d4ca60db345cd702a5ed9f0c4ca6" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* locals_show </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>CLI command "local show channels". </p>

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00817">817</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="linkedlists_8h_source.html#l00449">AST_LIST_EMPTY</a>, <a class="el" href="linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="chan__local_8c_source.html#l00106">local_pvt::context</a>, <a class="el" href="chan__local_8c_source.html#l00107">local_pvt::exten</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="chan__local_8c_source.html#l00104">local_pvt::lock</a>, <a class="el" href="chan__local_8c_source.html#l00110">local_pvt::owner</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00818"></a>00818 {
<a name="l00819"></a>00819    <span class="keyword">struct </span><a class="code" href="structlocal__pvt.html">local_pvt</a> *p = NULL;
<a name="l00820"></a>00820 
<a name="l00821"></a>00821    <span class="keywordflow">switch</span> (cmd) {
<a name="l00822"></a>00822    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l00823"></a>00823       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;local show channels&quot;</span>;
<a name="l00824"></a>00824       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l00825"></a>00825          <span class="stringliteral">&quot;Usage: local show channels\n&quot;</span>
<a name="l00826"></a>00826          <span class="stringliteral">&quot;       Provides summary information on active local proxy channels.\n&quot;</span>;
<a name="l00827"></a>00827       <span class="keywordflow">return</span> NULL;
<a name="l00828"></a>00828    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l00829"></a>00829       <span class="keywordflow">return</span> NULL;
<a name="l00830"></a>00830    }
<a name="l00831"></a>00831 
<a name="l00832"></a>00832    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != 3)
<a name="l00833"></a>00833       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l00834"></a>00834 
<a name="l00835"></a>00835    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;locals);
<a name="l00836"></a>00836    <span class="keywordflow">if</span> (!<a class="code" href="linkedlists_8h.html#a4a1884cde93e53bef32ca85c194a1d05" title="Checks whether the specified list contains any entries.">AST_LIST_EMPTY</a>(&amp;locals)) {
<a name="l00837"></a>00837       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;locals, p, list) {
<a name="l00838"></a>00838          <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00839"></a>00839          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;%s -- %s@%s\n&quot;</span>, p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> ? p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name : <span class="stringliteral">&quot;&lt;unowned&gt;&quot;</span>, p-&gt;<a class="code" href="structlocal__pvt.html#a78d4847658b695383d849efd12399b38">exten</a>, p-&gt;<a class="code" href="structlocal__pvt.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>);
<a name="l00840"></a>00840          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structlocal__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00841"></a>00841       }
<a name="l00842"></a>00842    } <span class="keywordflow">else</span>
<a name="l00843"></a>00843       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;No local channels in use\n&quot;</span>);
<a name="l00844"></a>00844    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;locals);
<a name="l00845"></a>00845 
<a name="l00846"></a>00846    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l00847"></a>00847 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad09fa931f468002152a3cc2d5ce25eae"></a><!-- doxytag: member="chan_local.c::unload_module" ref="ad09fa931f468002152a3cc2d5ce25eae" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int unload_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Unload the local proxy channel from Asterisk. </p>

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00866">866</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l00587">ast_channel_unregister()</a>, <a class="el" href="cli_8c_source.html#l01937">ast_cli_unregister_multiple()</a>, <a class="el" href="linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8c_source.html#l01666">ast_softhangup()</a>, <a class="el" href="channel_8h_source.html#l00638">AST_SOFTHANGUP_APPUNLOAD</a>, <a class="el" href="chan__local_8c_source.html#l00849">cli_local</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="chan__local_8c_source.html#l00110">local_pvt::owner</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00867"></a>00867 {
<a name="l00868"></a>00868    <span class="keyword">struct </span><a class="code" href="structlocal__pvt.html">local_pvt</a> *p = NULL;
<a name="l00869"></a>00869 
<a name="l00870"></a>00870    <span class="comment">/* First, take us out of the channel loop */</span>
<a name="l00871"></a>00871    <a class="code" href="cli_8h.html#a56b6b59ee2eaa994597a5b0f4e9f9d09" title="Unregister multiple commands.">ast_cli_unregister_multiple</a>(<a class="code" href="chan__local_8c.html#ab56419f942fd8b5e73abe4e71afdf913">cli_local</a>, <span class="keyword">sizeof</span>(<a class="code" href="chan__local_8c.html#ab56419f942fd8b5e73abe4e71afdf913">cli_local</a>) / <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a>));
<a name="l00872"></a>00872    <a class="code" href="channel_8h.html#a53b708b7fc71dcbcd33acae0ad4d7ef8" title="Unregister a channel technology.">ast_channel_unregister</a>(&amp;<a class="code" href="chan__local_8c.html#a6d83e64e81a38a3cd94555a85fe07130">local_tech</a>);
<a name="l00873"></a>00873    <span class="keywordflow">if</span> (!<a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;locals)) {
<a name="l00874"></a>00874       <span class="comment">/* Hangup all interfaces if they have an owner */</span>
<a name="l00875"></a>00875       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;locals, p, list) {
<a name="l00876"></a>00876          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)
<a name="l00877"></a>00877             <a class="code" href="channel_8h.html#ac2d6607253f7e8b272d4e845474eaa9b" title="Softly hangup up a channel.">ast_softhangup</a>(p-&gt;<a class="code" href="structlocal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709aeeafae6abd77156800ec76b0ff7d3867">AST_SOFTHANGUP_APPUNLOAD</a>);
<a name="l00878"></a>00878       }
<a name="l00879"></a>00879       <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;locals);
<a name="l00880"></a>00880    } <span class="keywordflow">else</span> {
<a name="l00881"></a>00881       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to lock the monitor\n&quot;</span>);
<a name="l00882"></a>00882       <span class="keywordflow">return</span> -1;
<a name="l00883"></a>00883    }     
<a name="l00884"></a>00884    <span class="keywordflow">return</span> 0;
<a name="l00885"></a>00885 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ab56419f942fd8b5e73abe4e71afdf913"></a><!-- doxytag: member="chan_local.c::cli_local" ref="ab56419f942fd8b5e73abe4e71afdf913" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> <a class="el" href="chan__local_8c.html#ab56419f942fd8b5e73abe4e71afdf913">cli_local</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
   <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="chan__local_8c.html#a36c5d4ca60db345cd702a5ed9f0c4ca6" title="CLI command &amp;quot;local show channels&amp;quot;.">locals_show</a>, <span class="stringliteral">&quot;List status of local channels&quot;</span>),
}
</pre></div>
<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00849">849</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

<p>Referenced by <a class="el" href="chan__local_8c_source.html#l00854">load_module()</a>, and <a class="el" href="chan__local_8c_source.html#l00866">unload_module()</a>.</p>

</div>
</div>
<a class="anchor" id="a959ba7417108e51365bb97ba1dded4db"></a><!-- doxytag: member="chan_local.c::g_jb_conf" ref="a959ba7417108e51365bb97ba1dded4db" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__jb__conf.html">ast_jb_conf</a> <a class="el" href="chan__local_8c.html#a959ba7417108e51365bb97ba1dded4db">g_jb_conf</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00057">57</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6d83e64e81a38a3cd94555a85fe07130"></a><!-- doxytag: member="chan_local.c::local_tech" ref="a6d83e64e81a38a3cd94555a85fe07130" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__channel__tech.html">ast_channel_tech</a> <a class="el" href="chan__local_8c.html#a6d83e64e81a38a3cd94555a85fe07130">local_tech</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00081">81</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

</div>
</div>
<a class="anchor" id="a71535bf985a1a06d548fd73a0a0ec32c"></a><!-- doxytag: member="chan_local.c::tdesc" ref="a71535bf985a1a06d548fd73a0a0ec32c" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char <a class="el" href="chan__usbradio_8c.html#a206197bcdc50090e511e22b33a2166a9">tdesc</a>[] = &quot;Local Proxy Channel Driver&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__local_8c_source.html#l00053">53</a> of file <a class="el" href="chan__local_8c_source.html">chan_local.c</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:20:19 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
