<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:23:32 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_afe38fc0ccf2e9eefca5d5c6b03503d9.html">main</a>
  </div>
</div>
<div class="contents">
<h1>udptl.c File Reference</h1>
<p>UDPTL support for T.38 faxing.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="asterisk_8h_source.html">asterisk.h</a>&quot;</code><br/>
<code>#include &lt;sys/time.h&gt;</code><br/>
<code>#include &lt;signal.h&gt;</code><br/>
<code>#include &lt;fcntl.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="udptl_8h_source.html">asterisk/udptl.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="frame_8h_source.html">asterisk/frame.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="channel_8h_source.html">asterisk/channel.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="acl_8h_source.html">asterisk/acl.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="config_8h_source.html">asterisk/config.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="lock_8h_source.html">asterisk/lock.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="utils_8h_source.html">asterisk/utils.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="netsock_8h_source.html">asterisk/netsock.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="cli_8h_source.html">asterisk/cli.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="unaligned_8h_source.html">asterisk/unaligned.h</a>&quot;</code><br/>

<p><a href="udptl_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__udptl.html">ast_udptl</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Structure for an UDPTL session.  <a href="structast__udptl.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structprotos.html">protos</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">List of current <a class="el" href="structsessions.html">sessions</a>.  <a href="structprotos.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structudptl__fec__rx__buffer__t.html">udptl_fec_rx_buffer_t</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structudptl__fec__tx__buffer__t.html">udptl_fec_tx_buffer_t</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a840abeaeb2ccc5dca63e7acfeed7ca87">DEFAULT_FAX_MAX_DATAGRAM</a>&nbsp;&nbsp;&nbsp;400</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#aa8f3d147dea9bd83782b759502fc60a1">FAX_MAX_DATAGRAM_LIMIT</a>&nbsp;&nbsp;&nbsp;1400</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a7cebef58b6e2f580a8e74b7c133cd34b">LOCAL_FAX_MAX_DATAGRAM</a>&nbsp;&nbsp;&nbsp;1400</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a12f6e5fd71bc2bc7fcfc0583b035c862">LOG_TAG</a>(u)&nbsp;&nbsp;&nbsp;S_OR(u-&gt;tag, &quot;no tag&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a0113380b09f0d4b8cc6a98d70e4ef822">MAX_FEC_ENTRIES</a>&nbsp;&nbsp;&nbsp;5</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a71b4edaf9975b131d08a7672db96ae0e">MAX_FEC_SPAN</a>&nbsp;&nbsp;&nbsp;5</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a5fc08f5f3152e66b9eb799375c8eafe5">UDPTL_BUF_MASK</a>&nbsp;&nbsp;&nbsp;15</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a48303cfd0f3317077b5334e1b6e0897f">UDPTL_MTU</a>&nbsp;&nbsp;&nbsp;1200</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#acfdd6fa3b0b7a0acd4a9841c6596809d">__ast_udptl_reload</a> (int reload)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#aa36dcbb2b471899ee58d5afb1f4fa49b">ast_udptl_bridge</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c0, struct <a class="el" href="structast__channel.html">ast_channel</a> *c1, int flags, struct <a class="el" href="structast__frame.html">ast_frame</a> **fo, struct <a class="el" href="structast__channel.html">ast_channel</a> **rc)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a0c14cc450fe0891cbee26ffd74cf77cb">ast_udptl_destroy</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a424e6e48fcfa491a9ee6da3c8a7162a3">ast_udptl_fd</a> (const struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795">ast_t38_ec_modes</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a10b606a6ac66cc148ea1c43a508ebb6d">ast_udptl_get_error_correction_scheme</a> (const struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#ad81d6dc0df37c1b771f803c431cc102a">ast_udptl_get_far_max_datagram</a> (const struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a72d15492e0a4594c95848800a93017f3">ast_udptl_get_far_max_ifp</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">retrieves far max ifp  <a href="#a72d15492e0a4594c95848800a93017f3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#aac14f584f25701499a840fd9b1ee30a5">ast_udptl_get_local_max_datagram</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">retrieves local_max_datagram.  <a href="#aac14f584f25701499a840fd9b1ee30a5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a7a96d2874c787b03db8c8b21ffcee89c">ast_udptl_get_peer</a> (const struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl, struct sockaddr_in *them)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#ac191d3e1fcdff6075d0eb5f9ebcbb96c">ast_udptl_get_us</a> (const struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl, struct sockaddr_in *us)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#ad68827c8f88b83c06791a96e595ed978">ast_udptl_init</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a310872d2ca901a1c6d42ca510b69ed48">ast_udptl_new</a> (struct <a class="el" href="structsched__context.html">sched_context</a> *<a class="el" href="structsched.html">sched</a>, struct <a class="el" href="structio__context.html">io_context</a> *<a class="el" href="pbx__dundi_8c.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a>, int callbackmode)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a60e9774baa6ec8d1c3fdc0e002ac9bd7">ast_udptl_new_with_bindaddr</a> (struct <a class="el" href="structsched__context.html">sched_context</a> *<a class="el" href="structsched.html">sched</a>, struct <a class="el" href="structio__context.html">io_context</a> *<a class="el" href="pbx__dundi_8c.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a>, int callbackmode, struct in_addr addr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a4c3c0f932544c3920055554c473d6576">ast_udptl_proto_register</a> (struct <a class="el" href="structast__udptl__protocol.html">ast_udptl_protocol</a> *proto)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#ac1d0c92d37bf00a7138bf30b11980df5">ast_udptl_proto_unregister</a> (struct <a class="el" href="structast__udptl__protocol.html">ast_udptl_protocol</a> *proto)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#ae0808bce80557e3107c9030bd8a832fe">ast_udptl_read</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#aef56fae41fcf91924375991a5c4e7568">ast_udptl_reload</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#ac410178703bbd10effbedd9823b89f2a">ast_udptl_set_callback</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl, <a class="el" href="udptl_8h.html#a04e7bb36362e3da0ab84dbceb6e3dc9e">ast_udptl_callback</a> callback)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#ab2b6f583b1e2e2efdd87c0f6a7264d42">ast_udptl_set_data</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl, void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#aec066a1e8d5b80dfab8c4a5296e65e48">ast_udptl_set_error_correction_scheme</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl, enum <a class="el" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795">ast_t38_ec_modes</a> ec)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#abb364758e66c04d5d791fc51d2b3ed6d">ast_udptl_set_far_max_datagram</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl, unsigned int max_datagram)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">sets far max datagram size. If max_datagram is = 0, the far max datagram size is set to a default value.  <a href="#abb364758e66c04d5d791fc51d2b3ed6d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a6c2d98f9407493efbbdc9462717a2d9d">ast_udptl_set_local_max_ifp</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl, unsigned int max_ifp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#aa610b69fe43ec50c49d39e8613e07a14">ast_udptl_set_peer</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl, const struct sockaddr_in *them)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a697d541fd523e36f898d699cbfda988f">ast_udptl_set_tag</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl, const char *<a class="el" href="chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a>,...)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Associates a character string 'tag' with a UDPTL session.  <a href="#a697d541fd523e36f898d699cbfda988f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a76d8051a97100fa917b8c43bf58aac9c">ast_udptl_setnat</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl, int <a class="el" href="chan__mgcp_8c.html#ada540a5f25f7302dc1a3d17ccfa59b10">nat</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#aa37b040d6f8a975f25022e73e125b99e">ast_udptl_setqos</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl, unsigned int <a class="el" href="pbx__dundi_8c.html#a25a9305efab3b493ca2519562fcec3d5">tos</a>, unsigned int <a class="el" href="chan__unistim_8c.html#ae91dad65f553f7afebe4af507803bc7f">cos</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a3fb4dcecfa292b0aae4fd4dbad1b8551">ast_udptl_stop</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a5c5bda796bcae234c457fb56fb106b0b">ast_udptl_write</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *s, struct <a class="el" href="structast__frame.html">ast_frame</a> *<a class="el" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a541dbf72506ff6bead2d506613979e24">calculate_far_max_ifp</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#ab3acebf54181c51340a4a3fa080525a8">calculate_local_max_datagram</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#ae31d7a712ec76b9ee8515efecca0cc07">decode_length</a> (uint8_t *<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, unsigned int limit, unsigned int *len, unsigned int *pvalue)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#acad8de64155e849783a598df19ce849c">decode_open_type</a> (uint8_t *<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, unsigned int limit, unsigned int *len, const uint8_t **p_object, unsigned int *p_num_octets)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a6c54931735c591c100df527a9e0936e1">encode_length</a> (uint8_t *<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, unsigned int *len, unsigned int value)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a139e3cb1abd258f2bd35a94b6573ca2c">encode_open_type</a> (const struct <a class="el" href="structast__udptl.html">ast_udptl</a> *udptl, uint8_t *<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, unsigned int buflen, unsigned int *len, const uint8_t *data, unsigned int num_octets)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__udptl__protocol.html">ast_udptl_protocol</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a81bfe3abc4b0e393b4d6f7570c1f18bf">get_proto</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a9b115851b62ac2f257cabce0cee1f67e">handle_cli_udptl_set_debug</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#ad2ff9341ea549b0679a80c409637228c">udptl_build_packet</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *s, uint8_t *<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, unsigned int buflen, uint8_t *ifp, unsigned int ifp_len)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a01d5961e9d1bf0c8c6244aee64a1ecf9">udptl_debug_test_addr</a> (const struct sockaddr_in *addr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a0db4385b032d828c9ec822008c79a061">udptl_rx_packet</a> (struct <a class="el" href="structast__udptl.html">ast_udptl</a> *s, uint8_t *<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, unsigned int len)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#aca6905df84f7b7a4905a3fadb50139c7">udptlread</a> (int *<a class="el" href="res__ais_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>, int fd, short <a class="el" href="chan__dahdi_8c.html#aff2cd0cadc675280f2ee4b7c45bb9944">events</a>, void *cbdata)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a307853ba74adbc85d4dd57bee618e674">cli_udptl</a> []</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#ade9088978427552c6020fd7453eedb57">udptldebug</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct sockaddr_in&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a3e1327ae66b0837cebb4c734a9bdd3f5">udptldebugaddr</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a6bb07009dda10589e6e1dbad7a48d157">udptlend</a> = 4599</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a2d6cbcd43cd796cd91da16fc798be95d">udptlfecentries</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a1843da2c025cc14346182403c4c9fa53">udptlfecspan</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a3bf0aa3b30cf99c6052f71dd963dc800">udptlstart</a> = 4500</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="udptl_8c.html#a830f7f070798d4b70c3189b8fade1ab7">use_even_ports</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>UDPTL support for T.38 faxing. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Mark Spencer &lt;<a href="mailto:markster@digium.com">markster@digium.com</a>&gt; </dd>
<dd>
Steve Underwood &lt;<a href="mailto:steveu@coppice.org">steveu@coppice.org</a>&gt; </dd>
<dd>
Kevin P. Fleming &lt;<a href="mailto:kpfleming@digium.com">kpfleming@digium.com</a>&gt; </dd></dl>

<p>Definition in file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a840abeaeb2ccc5dca63e7acfeed7ca87"></a><!-- doxytag: member="udptl.c::DEFAULT_FAX_MAX_DATAGRAM" ref="a840abeaeb2ccc5dca63e7acfeed7ca87" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEFAULT_FAX_MAX_DATAGRAM&nbsp;&nbsp;&nbsp;400</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00094">94</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>Referenced by <a class="el" href="udptl_8c_source.html#l00888">ast_udptl_set_far_max_datagram()</a>, and <a class="el" href="udptl_8c_source.html#l01060">ast_udptl_write()</a>.</p>

</div>
</div>
<a class="anchor" id="aa8f3d147dea9bd83782b759502fc60a1"></a><!-- doxytag: member="udptl.c::FAX_MAX_DATAGRAM_LIMIT" ref="aa8f3d147dea9bd83782b759502fc60a1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FAX_MAX_DATAGRAM_LIMIT&nbsp;&nbsp;&nbsp;1400</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00095">95</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>Referenced by <a class="el" href="udptl_8c_source.html#l00888">ast_udptl_set_far_max_datagram()</a>.</p>

</div>
</div>
<a class="anchor" id="a7cebef58b6e2f580a8e74b7c133cd34b"></a><!-- doxytag: member="udptl.c::LOCAL_FAX_MAX_DATAGRAM" ref="a7cebef58b6e2f580a8e74b7c133cd34b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOCAL_FAX_MAX_DATAGRAM&nbsp;&nbsp;&nbsp;1400</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00093">93</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>Referenced by <a class="el" href="udptl_8c_source.html#l00722">calculate_local_max_datagram()</a>, <a class="el" href="udptl_8c_source.html#l00526">udptl_build_packet()</a>, and <a class="el" href="udptl_8c_source.html#l00318">udptl_rx_packet()</a>.</p>

</div>
</div>
<a class="anchor" id="a12f6e5fd71bc2bc7fcfc0583b035c862"></a><!-- doxytag: member="udptl.c::LOG_TAG" ref="a12f6e5fd71bc2bc7fcfc0583b035c862" args="(u)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOG_TAG</td>
          <td>(</td>
          <td class="paramtype">u&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;S_OR(u-&gt;tag, &quot;no tag&quot;)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00080">80</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>Referenced by <a class="el" href="udptl_8c_source.html#l00672">ast_udptl_read()</a>, <a class="el" href="udptl_8c_source.html#l01060">ast_udptl_write()</a>, <a class="el" href="udptl_8c_source.html#l00763">calculate_far_max_ifp()</a>, <a class="el" href="udptl_8c_source.html#l00722">calculate_local_max_datagram()</a>, <a class="el" href="udptl_8c_source.html#l00284">encode_open_type()</a>, and <a class="el" href="udptl_8c_source.html#l00526">udptl_build_packet()</a>.</p>

</div>
</div>
<a class="anchor" id="a0113380b09f0d4b8cc6a98d70e4ef822"></a><!-- doxytag: member="udptl.c::MAX_FEC_ENTRIES" ref="a0113380b09f0d4b8cc6a98d70e4ef822" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_FEC_ENTRIES&nbsp;&nbsp;&nbsp;5</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00096">96</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>Referenced by <a class="el" href="udptl_8c_source.html#l01342">__ast_udptl_reload()</a>.</p>

</div>
</div>
<a class="anchor" id="a71b4edaf9975b131d08a7672db96ae0e"></a><!-- doxytag: member="udptl.c::MAX_FEC_SPAN" ref="a71b4edaf9975b131d08a7672db96ae0e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_FEC_SPAN&nbsp;&nbsp;&nbsp;5</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00097">97</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>Referenced by <a class="el" href="udptl_8c_source.html#l01342">__ast_udptl_reload()</a>.</p>

</div>
</div>
<a class="anchor" id="a5fc08f5f3152e66b9eb799375c8eafe5"></a><!-- doxytag: member="udptl.c::UDPTL_BUF_MASK" ref="a5fc08f5f3152e66b9eb799375c8eafe5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define UDPTL_BUF_MASK&nbsp;&nbsp;&nbsp;15</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00099">99</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>Referenced by <a class="el" href="udptl_8c_source.html#l00919">ast_udptl_new_with_bindaddr()</a>, <a class="el" href="udptl_8c_source.html#l00526">udptl_build_packet()</a>, and <a class="el" href="udptl_8c_source.html#l00318">udptl_rx_packet()</a>.</p>

</div>
</div>
<a class="anchor" id="a48303cfd0f3317077b5334e1b6e0897f"></a><!-- doxytag: member="udptl.c::UDPTL_MTU" ref="a48303cfd0f3317077b5334e1b6e0897f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define UDPTL_MTU&nbsp;&nbsp;&nbsp;1200</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00071">71</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="acfdd6fa3b0b7a0acd4a9841c6596809d"></a><!-- doxytag: member="udptl.c::__ast_udptl_reload" ref="acfdd6fa3b0b7a0acd4a9841c6596809d" args="(int reload)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void __ast_udptl_reload </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>reload</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l01342">1342</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="config_8c_source.html#l00827">ast_config_destroy()</a>, <a class="el" href="config_8c_source.html#l02071">ast_config_load2()</a>, <a class="el" href="utils_8c_source.html#l01328">ast_false()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8c_source.html#l01311">ast_true()</a>, <a class="el" href="config_8c_source.html#l00435">ast_variable_retrieve()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="config_8h_source.html#l00043">CONFIG_FLAG_FILEUNCHANGED</a>, <a class="el" href="config_8h_source.html#l00050">CONFIG_STATUS_FILEINVALID</a>, <a class="el" href="config_8h_source.html#l00048">CONFIG_STATUS_FILEMISSING</a>, <a class="el" href="config_8h_source.html#l00049">CONFIG_STATUS_FILEUNCHANGED</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="udptl_8c_source.html#l00096">MAX_FEC_ENTRIES</a>, <a class="el" href="udptl_8c_source.html#l00097">MAX_FEC_SPAN</a>, and <a class="el" href="aesopt_8h_source.html#l00399">s</a>.</p>

<p>Referenced by <a class="el" href="udptl_8c_source.html#l01448">ast_udptl_init()</a>, and <a class="el" href="udptl_8c_source.html#l01442">ast_udptl_reload()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01343"></a>01343 {
<a name="l01344"></a>01344    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *cfg;
<a name="l01345"></a>01345    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>;
<a name="l01346"></a>01346    <span class="keyword">struct </span><a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> <a class="code" href="app__rpt_8c.html#a1f57f20c1f46890828791a4827fe8752">config_flags</a> = { <a class="code" href="app__amd_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> ? <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26afa887389dc380bbdcffb65fec379f037">CONFIG_FLAG_FILEUNCHANGED</a> : 0 };
<a name="l01347"></a>01347 
<a name="l01348"></a>01348    cfg = <a class="code" href="config_8h.html#aab3eac8fa82a86a93c074deb7b77dbc9" title="Load a config file.">ast_config_load2</a>(<span class="stringliteral">&quot;udptl.conf&quot;</span>, <span class="stringliteral">&quot;udptl&quot;</span>, config_flags);
<a name="l01349"></a>01349    <span class="keywordflow">if</span> (cfg == <a class="code" href="config_8h.html#a39bacaabcacf47583204c7634e64a2a0">CONFIG_STATUS_FILEMISSING</a> || cfg == <a class="code" href="config_8h.html#a846844eb2c4eb44554445936b3770711">CONFIG_STATUS_FILEUNCHANGED</a> || cfg == <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>) {
<a name="l01350"></a>01350       <span class="keywordflow">return</span>;
<a name="l01351"></a>01351    }
<a name="l01352"></a>01352 
<a name="l01353"></a>01353    <a class="code" href="udptl_8c.html#a3bf0aa3b30cf99c6052f71dd963dc800">udptlstart</a> = 4500;
<a name="l01354"></a>01354    <a class="code" href="udptl_8c.html#a6bb07009dda10589e6e1dbad7a48d157">udptlend</a> = 4999;
<a name="l01355"></a>01355    <a class="code" href="udptl_8c.html#a2d6cbcd43cd796cd91da16fc798be95d">udptlfecentries</a> = 0;
<a name="l01356"></a>01356    <a class="code" href="udptl_8c.html#a1843da2c025cc14346182403c4c9fa53">udptlfecspan</a> = 0;
<a name="l01357"></a>01357    <a class="code" href="udptl_8c.html#a830f7f070798d4b70c3189b8fade1ab7">use_even_ports</a> = 0;
<a name="l01358"></a>01358 
<a name="l01359"></a>01359    <span class="keywordflow">if</span> (cfg) {
<a name="l01360"></a>01360       <span class="keywordflow">if</span> ((s = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;udptlstart&quot;</span>))) {
<a name="l01361"></a>01361          <a class="code" href="udptl_8c.html#a3bf0aa3b30cf99c6052f71dd963dc800">udptlstart</a> = atoi(s);
<a name="l01362"></a>01362          <span class="keywordflow">if</span> (<a class="code" href="udptl_8c.html#a3bf0aa3b30cf99c6052f71dd963dc800">udptlstart</a> &lt; 1024) {
<a name="l01363"></a>01363             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Ports under 1024 are not allowed for T.38.\n&quot;</span>);
<a name="l01364"></a>01364             <a class="code" href="udptl_8c.html#a3bf0aa3b30cf99c6052f71dd963dc800">udptlstart</a> = 1024;
<a name="l01365"></a>01365          }
<a name="l01366"></a>01366          <span class="keywordflow">if</span> (<a class="code" href="udptl_8c.html#a3bf0aa3b30cf99c6052f71dd963dc800">udptlstart</a> &gt; 65535) {
<a name="l01367"></a>01367             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Ports over 65535 are invalid.\n&quot;</span>);
<a name="l01368"></a>01368             <a class="code" href="udptl_8c.html#a3bf0aa3b30cf99c6052f71dd963dc800">udptlstart</a> = 65535;
<a name="l01369"></a>01369          }
<a name="l01370"></a>01370       }
<a name="l01371"></a>01371       <span class="keywordflow">if</span> ((s = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;udptlend&quot;</span>))) {
<a name="l01372"></a>01372          <a class="code" href="udptl_8c.html#a6bb07009dda10589e6e1dbad7a48d157">udptlend</a> = atoi(s);
<a name="l01373"></a>01373          <span class="keywordflow">if</span> (<a class="code" href="udptl_8c.html#a6bb07009dda10589e6e1dbad7a48d157">udptlend</a> &lt; 1024) {
<a name="l01374"></a>01374             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Ports under 1024 are not allowed for T.38.\n&quot;</span>);
<a name="l01375"></a>01375             <a class="code" href="udptl_8c.html#a6bb07009dda10589e6e1dbad7a48d157">udptlend</a> = 1024;
<a name="l01376"></a>01376          }
<a name="l01377"></a>01377          <span class="keywordflow">if</span> (<a class="code" href="udptl_8c.html#a6bb07009dda10589e6e1dbad7a48d157">udptlend</a> &gt; 65535) {
<a name="l01378"></a>01378             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Ports over 65535 are invalid.\n&quot;</span>);
<a name="l01379"></a>01379             <a class="code" href="udptl_8c.html#a6bb07009dda10589e6e1dbad7a48d157">udptlend</a> = 65535;
<a name="l01380"></a>01380          }
<a name="l01381"></a>01381       }
<a name="l01382"></a>01382       <span class="keywordflow">if</span> ((s = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;udptlchecksums&quot;</span>))) {
<a name="l01383"></a>01383 <span class="preprocessor">#ifdef SO_NO_CHECK</span>
<a name="l01384"></a>01384 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a6c3dc0bad204e9dd9890325c1c861e38" title="Make sure something is false. Determine if a string containing a boolean value is...">ast_false</a>(s))
<a name="l01385"></a>01385             nochecksums = 1;
<a name="l01386"></a>01386          <span class="keywordflow">else</span>
<a name="l01387"></a>01387             nochecksums = 0;
<a name="l01388"></a>01388 <span class="preprocessor">#else</span>
<a name="l01389"></a>01389 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a6c3dc0bad204e9dd9890325c1c861e38" title="Make sure something is false. Determine if a string containing a boolean value is...">ast_false</a>(s))
<a name="l01390"></a>01390             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Disabling UDPTL checksums is not supported on this operating system!\n&quot;</span>);
<a name="l01391"></a>01391 <span class="preprocessor">#endif</span>
<a name="l01392"></a>01392 <span class="preprocessor"></span>      }
<a name="l01393"></a>01393       <span class="keywordflow">if</span> ((s = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;T38FaxUdpEC&quot;</span>))) {
<a name="l01394"></a>01394          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;T38FaxUdpEC in udptl.conf is no longer supported; use the t38pt_udptl configuration option in sip.conf instead.\n&quot;</span>);
<a name="l01395"></a>01395       }
<a name="l01396"></a>01396       <span class="keywordflow">if</span> ((s = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;T38FaxMaxDatagram&quot;</span>))) {
<a name="l01397"></a>01397          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;T38FaxMaxDatagram in udptl.conf is no longer supported; value is now supplied by T.38 applications.\n&quot;</span>);
<a name="l01398"></a>01398       }
<a name="l01399"></a>01399       <span class="keywordflow">if</span> ((s = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;UDPTLFECEntries&quot;</span>))) {
<a name="l01400"></a>01400          <a class="code" href="udptl_8c.html#a2d6cbcd43cd796cd91da16fc798be95d">udptlfecentries</a> = atoi(s);
<a name="l01401"></a>01401          <span class="keywordflow">if</span> (<a class="code" href="udptl_8c.html#a2d6cbcd43cd796cd91da16fc798be95d">udptlfecentries</a> &lt; 1) {
<a name="l01402"></a>01402             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Too small UDPTLFECEntries value.  Defaulting to 1.\n&quot;</span>);
<a name="l01403"></a>01403             <a class="code" href="udptl_8c.html#a2d6cbcd43cd796cd91da16fc798be95d">udptlfecentries</a> = 1;
<a name="l01404"></a>01404          }
<a name="l01405"></a>01405          <span class="keywordflow">if</span> (<a class="code" href="udptl_8c.html#a2d6cbcd43cd796cd91da16fc798be95d">udptlfecentries</a> &gt; <a class="code" href="udptl_8c.html#a0113380b09f0d4b8cc6a98d70e4ef822">MAX_FEC_ENTRIES</a>) {
<a name="l01406"></a>01406             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Too large UDPTLFECEntries value.  Defaulting to %d.\n&quot;</span>, <a class="code" href="udptl_8c.html#a0113380b09f0d4b8cc6a98d70e4ef822">MAX_FEC_ENTRIES</a>);
<a name="l01407"></a>01407             <a class="code" href="udptl_8c.html#a2d6cbcd43cd796cd91da16fc798be95d">udptlfecentries</a> = <a class="code" href="udptl_8c.html#a0113380b09f0d4b8cc6a98d70e4ef822">MAX_FEC_ENTRIES</a>;
<a name="l01408"></a>01408          }
<a name="l01409"></a>01409       }
<a name="l01410"></a>01410       <span class="keywordflow">if</span> ((s = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;UDPTLFECSpan&quot;</span>))) {
<a name="l01411"></a>01411          <a class="code" href="udptl_8c.html#a1843da2c025cc14346182403c4c9fa53">udptlfecspan</a> = atoi(s);
<a name="l01412"></a>01412          <span class="keywordflow">if</span> (<a class="code" href="udptl_8c.html#a1843da2c025cc14346182403c4c9fa53">udptlfecspan</a> &lt; 1) {
<a name="l01413"></a>01413             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Too small UDPTLFECSpan value.  Defaulting to 1.\n&quot;</span>);
<a name="l01414"></a>01414             <a class="code" href="udptl_8c.html#a1843da2c025cc14346182403c4c9fa53">udptlfecspan</a> = 1;
<a name="l01415"></a>01415          }
<a name="l01416"></a>01416          <span class="keywordflow">if</span> (<a class="code" href="udptl_8c.html#a1843da2c025cc14346182403c4c9fa53">udptlfecspan</a> &gt; <a class="code" href="udptl_8c.html#a71b4edaf9975b131d08a7672db96ae0e">MAX_FEC_SPAN</a>) {
<a name="l01417"></a>01417             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Too large UDPTLFECSpan value.  Defaulting to %d.\n&quot;</span>, <a class="code" href="udptl_8c.html#a71b4edaf9975b131d08a7672db96ae0e">MAX_FEC_SPAN</a>);
<a name="l01418"></a>01418             <a class="code" href="udptl_8c.html#a1843da2c025cc14346182403c4c9fa53">udptlfecspan</a> = <a class="code" href="udptl_8c.html#a71b4edaf9975b131d08a7672db96ae0e">MAX_FEC_SPAN</a>;
<a name="l01419"></a>01419          }
<a name="l01420"></a>01420       }
<a name="l01421"></a>01421       <span class="keywordflow">if</span> ((s = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;use_even_ports&quot;</span>))) {
<a name="l01422"></a>01422          <a class="code" href="udptl_8c.html#a830f7f070798d4b70c3189b8fade1ab7">use_even_ports</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(s);
<a name="l01423"></a>01423       }
<a name="l01424"></a>01424       <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(cfg);
<a name="l01425"></a>01425    }
<a name="l01426"></a>01426    <span class="keywordflow">if</span> (<a class="code" href="udptl_8c.html#a3bf0aa3b30cf99c6052f71dd963dc800">udptlstart</a> &gt;= <a class="code" href="udptl_8c.html#a6bb07009dda10589e6e1dbad7a48d157">udptlend</a>) {
<a name="l01427"></a>01427       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unreasonable values for UDPTL start/end ports; defaulting to 4500-4999.\n&quot;</span>);
<a name="l01428"></a>01428       <a class="code" href="udptl_8c.html#a3bf0aa3b30cf99c6052f71dd963dc800">udptlstart</a> = 4500;
<a name="l01429"></a>01429       <a class="code" href="udptl_8c.html#a6bb07009dda10589e6e1dbad7a48d157">udptlend</a> = 4999;
<a name="l01430"></a>01430    }
<a name="l01431"></a>01431    <span class="keywordflow">if</span> (<a class="code" href="udptl_8c.html#a830f7f070798d4b70c3189b8fade1ab7">use_even_ports</a> &amp;&amp; (<a class="code" href="udptl_8c.html#a3bf0aa3b30cf99c6052f71dd963dc800">udptlstart</a> &amp; 1)) {
<a name="l01432"></a>01432       ++<a class="code" href="udptl_8c.html#a3bf0aa3b30cf99c6052f71dd963dc800">udptlstart</a>;
<a name="l01433"></a>01433       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Odd numbered udptlstart specified but use_even_ports enabled. udptlstart is now %d\n&quot;</span>, <a class="code" href="udptl_8c.html#a3bf0aa3b30cf99c6052f71dd963dc800">udptlstart</a>);
<a name="l01434"></a>01434    }
<a name="l01435"></a>01435    <span class="keywordflow">if</span> (<a class="code" href="udptl_8c.html#a830f7f070798d4b70c3189b8fade1ab7">use_even_ports</a> &amp;&amp; (<a class="code" href="udptl_8c.html#a6bb07009dda10589e6e1dbad7a48d157">udptlend</a> &amp; 1)) {
<a name="l01436"></a>01436       --<a class="code" href="udptl_8c.html#a6bb07009dda10589e6e1dbad7a48d157">udptlend</a>;
<a name="l01437"></a>01437       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Odd numbered udptlend specified but use_event_ports enabled. udptlend is now %d\n&quot;</span>, <a class="code" href="udptl_8c.html#a6bb07009dda10589e6e1dbad7a48d157">udptlend</a>);
<a name="l01438"></a>01438    }
<a name="l01439"></a>01439    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;UDPTL allocating from port range %d -&gt; %d\n&quot;</span>, <a class="code" href="udptl_8c.html#a3bf0aa3b30cf99c6052f71dd963dc800">udptlstart</a>, <a class="code" href="udptl_8c.html#a6bb07009dda10589e6e1dbad7a48d157">udptlend</a>);
<a name="l01440"></a>01440 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa36dcbb2b471899ee58d5afb1f4fa49b"></a><!-- doxytag: member="udptl.c::ast_udptl_bridge" ref="aa36dcbb2b471899ee58d5afb1f4fa49b" args="(struct ast_channel *c0, struct ast_channel *c1, int flags, struct ast_frame **fo, struct ast_channel **rc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_udptl_bridge </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> **&nbsp;</td>
          <td class="paramname"> <em>fo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> **&nbsp;</td>
          <td class="paramname"> <em>rc</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l01150">1150</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02037">ast_channel_trylock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="channel_8c_source.html#l00461">ast_check_hangup()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8h_source.html#l00120">AST_FRAME_MODEM</a>, <a class="el" href="frame_8h_source.html#l00462">ast_frfree</a>, <a class="el" href="utils_8c_source.html#l00431">ast_inet_ntoa()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8c_source.html#l03100">ast_read()</a>, <a class="el" href="udptl_8c_source.html#l01030">ast_udptl_get_peer()</a>, <a class="el" href="channel_8c_source.html#l02384">ast_waitfor_n()</a>, <a class="el" href="channel_8c_source.html#l03411">ast_write()</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="udptl_8c_source.html#l01136">get_proto()</a>, <a class="el" href="structast__udptl__protocol.html#a1db47456e7d9130f00376329f2f648ec">ast_udptl_protocol::get_udptl_info</a>, <a class="el" href="network_8h_source.html#l00090">inaddrcmp()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="channel_8h_source.html#l00408">ast_channel::masq</a>, <a class="el" href="channel_8h_source.html#l00409">ast_channel::masqr</a>, <a class="el" href="structast__udptl__protocol.html#a7e1926497b35afd62a35a5b1faa17d76">ast_udptl_protocol::set_udptl_peer</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01151"></a>01151 {
<a name="l01152"></a>01152    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l01153"></a>01153    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *who;
<a name="l01154"></a>01154    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *cs[3];
<a name="l01155"></a>01155    <span class="keyword">struct </span><a class="code" href="structast__udptl.html" title="Structure for an UDPTL session.">ast_udptl</a> *p0;
<a name="l01156"></a>01156    <span class="keyword">struct </span><a class="code" href="structast__udptl.html" title="Structure for an UDPTL session.">ast_udptl</a> *p1;
<a name="l01157"></a>01157    <span class="keyword">struct </span><a class="code" href="structast__udptl__protocol.html">ast_udptl_protocol</a> *pr0;
<a name="l01158"></a>01158    <span class="keyword">struct </span><a class="code" href="structast__udptl__protocol.html">ast_udptl_protocol</a> *pr1;
<a name="l01159"></a>01159    <span class="keyword">struct </span>sockaddr_in ac0;
<a name="l01160"></a>01160    <span class="keyword">struct </span>sockaddr_in ac1;
<a name="l01161"></a>01161    <span class="keyword">struct </span>sockaddr_in t0;
<a name="l01162"></a>01162    <span class="keyword">struct </span>sockaddr_in t1;
<a name="l01163"></a>01163    <span class="keywordtype">void</span> *pvt0;
<a name="l01164"></a>01164    <span class="keywordtype">void</span> *pvt1;
<a name="l01165"></a>01165    <span class="keywordtype">int</span> to;
<a name="l01166"></a>01166    
<a name="l01167"></a>01167    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(c0);
<a name="l01168"></a>01168    <span class="keywordflow">while</span> (<a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(c1)) {
<a name="l01169"></a>01169       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l01170"></a>01170       usleep(1);
<a name="l01171"></a>01171       <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(c0);
<a name="l01172"></a>01172    }
<a name="l01173"></a>01173    pr0 = <a class="code" href="udptl_8c.html#a81bfe3abc4b0e393b4d6f7570c1f18bf">get_proto</a>(c0);
<a name="l01174"></a>01174    pr1 = <a class="code" href="udptl_8c.html#a81bfe3abc4b0e393b4d6f7570c1f18bf">get_proto</a>(c1);
<a name="l01175"></a>01175    <span class="keywordflow">if</span> (!pr0) {
<a name="l01176"></a>01176       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Can&apos;t find native functions for channel &apos;%s&apos;\n&quot;</span>, c0-&gt;name);
<a name="l01177"></a>01177       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l01178"></a>01178       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l01179"></a>01179       <span class="keywordflow">return</span> -1;
<a name="l01180"></a>01180    }
<a name="l01181"></a>01181    <span class="keywordflow">if</span> (!pr1) {
<a name="l01182"></a>01182       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Can&apos;t find native functions for channel &apos;%s&apos;\n&quot;</span>, c1-&gt;name);
<a name="l01183"></a>01183       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l01184"></a>01184       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l01185"></a>01185       <span class="keywordflow">return</span> -1;
<a name="l01186"></a>01186    }
<a name="l01187"></a>01187    pvt0 = c0-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l01188"></a>01188    pvt1 = c1-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l01189"></a>01189    p0 = pr0-&gt;<a class="code" href="structast__udptl__protocol.html#a1db47456e7d9130f00376329f2f648ec" title="Get UDPTL struct, or NULL if unwilling to transfer.">get_udptl_info</a>(c0);
<a name="l01190"></a>01190    p1 = pr1-&gt;<a class="code" href="structast__udptl__protocol.html#a1db47456e7d9130f00376329f2f648ec" title="Get UDPTL struct, or NULL if unwilling to transfer.">get_udptl_info</a>(c1);
<a name="l01191"></a>01191    <span class="keywordflow">if</span> (!p0 || !p1) {
<a name="l01192"></a>01192       <span class="comment">/* Somebody doesn&apos;t want to play... */</span>
<a name="l01193"></a>01193       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l01194"></a>01194       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l01195"></a>01195       <span class="keywordflow">return</span> -2;
<a name="l01196"></a>01196    }
<a name="l01197"></a>01197    <span class="keywordflow">if</span> (pr0-&gt;<a class="code" href="structast__udptl__protocol.html#a7e1926497b35afd62a35a5b1faa17d76" title="Set UDPTL peer.">set_udptl_peer</a>(c0, p1)) {
<a name="l01198"></a>01198       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Channel &apos;%s&apos; failed to talk to &apos;%s&apos;\n&quot;</span>, c0-&gt;name, c1-&gt;name);
<a name="l01199"></a>01199       memset(&amp;ac1, 0, <span class="keyword">sizeof</span>(ac1));
<a name="l01200"></a>01200    } <span class="keywordflow">else</span> {
<a name="l01201"></a>01201       <span class="comment">/* Store UDPTL peer */</span>
<a name="l01202"></a>01202       <a class="code" href="udptl_8h.html#a7a96d2874c787b03db8c8b21ffcee89c">ast_udptl_get_peer</a>(p1, &amp;ac1);
<a name="l01203"></a>01203    }
<a name="l01204"></a>01204    <span class="keywordflow">if</span> (pr1-&gt;<a class="code" href="structast__udptl__protocol.html#a7e1926497b35afd62a35a5b1faa17d76" title="Set UDPTL peer.">set_udptl_peer</a>(c1, p0)) {
<a name="l01205"></a>01205       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Channel &apos;%s&apos; failed to talk back to &apos;%s&apos;\n&quot;</span>, c1-&gt;name, c0-&gt;name);
<a name="l01206"></a>01206       memset(&amp;ac0, 0, <span class="keyword">sizeof</span>(ac0));
<a name="l01207"></a>01207    } <span class="keywordflow">else</span> {
<a name="l01208"></a>01208       <span class="comment">/* Store UDPTL peer */</span>
<a name="l01209"></a>01209       <a class="code" href="udptl_8h.html#a7a96d2874c787b03db8c8b21ffcee89c">ast_udptl_get_peer</a>(p0, &amp;ac0);
<a name="l01210"></a>01210    }
<a name="l01211"></a>01211    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l01212"></a>01212    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l01213"></a>01213    cs[0] = c0;
<a name="l01214"></a>01214    cs[1] = c1;
<a name="l01215"></a>01215    cs[2] = NULL;
<a name="l01216"></a>01216    <span class="keywordflow">for</span> (;;) {
<a name="l01217"></a>01217       <span class="keywordflow">if</span> ((c0-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a> != pvt0) ||
<a name="l01218"></a>01218          (c1-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a> != pvt1) ||
<a name="l01219"></a>01219          (c0-&gt;<a class="code" href="structast__channel.html#ae38ae730b987d648a6fe1c84c8a13442">masq</a> || c0-&gt;<a class="code" href="structast__channel.html#abb53278bc00235a5ff76fc8badbe6363">masqr</a> || c1-&gt;<a class="code" href="structast__channel.html#ae38ae730b987d648a6fe1c84c8a13442">masq</a> || c1-&gt;<a class="code" href="structast__channel.html#abb53278bc00235a5ff76fc8badbe6363">masqr</a>)) {
<a name="l01220"></a>01220             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Oooh, something is weird, backing out\n&quot;</span>);
<a name="l01221"></a>01221             <span class="comment">/* Tell it to try again later */</span>
<a name="l01222"></a>01222             <span class="keywordflow">return</span> -3;
<a name="l01223"></a>01223       }
<a name="l01224"></a>01224       to = -1;
<a name="l01225"></a>01225       <a class="code" href="udptl_8h.html#a7a96d2874c787b03db8c8b21ffcee89c">ast_udptl_get_peer</a>(p1, &amp;t1);
<a name="l01226"></a>01226       <a class="code" href="udptl_8h.html#a7a96d2874c787b03db8c8b21ffcee89c">ast_udptl_get_peer</a>(p0, &amp;t0);
<a name="l01227"></a>01227       <span class="keywordflow">if</span> (<a class="code" href="network_8h.html#a645471815fc2fff930c75b0494197b3d" title="Compares the source address and port of two sockaddr_in.">inaddrcmp</a>(&amp;t1, &amp;ac1)) {
<a name="l01228"></a>01228          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Oooh, &apos;%s&apos; changed end address to %s:%d\n&quot;</span>, 
<a name="l01229"></a>01229             c1-&gt;name, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(t1.sin_addr), ntohs(t1.sin_port));
<a name="l01230"></a>01230          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Oooh, &apos;%s&apos; was %s:%d\n&quot;</span>, 
<a name="l01231"></a>01231             c1-&gt;name, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(ac1.sin_addr), ntohs(ac1.sin_port));
<a name="l01232"></a>01232          memcpy(&amp;ac1, &amp;t1, <span class="keyword">sizeof</span>(ac1));
<a name="l01233"></a>01233       }
<a name="l01234"></a>01234       <span class="keywordflow">if</span> (<a class="code" href="network_8h.html#a645471815fc2fff930c75b0494197b3d" title="Compares the source address and port of two sockaddr_in.">inaddrcmp</a>(&amp;t0, &amp;ac0)) {
<a name="l01235"></a>01235          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Oooh, &apos;%s&apos; changed end address to %s:%d\n&quot;</span>, 
<a name="l01236"></a>01236             c0-&gt;name, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(t0.sin_addr), ntohs(t0.sin_port));
<a name="l01237"></a>01237          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Oooh, &apos;%s&apos; was %s:%d\n&quot;</span>, 
<a name="l01238"></a>01238             c0-&gt;name, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(ac0.sin_addr), ntohs(ac0.sin_port));
<a name="l01239"></a>01239          memcpy(&amp;ac0, &amp;t0, <span class="keyword">sizeof</span>(ac0));
<a name="l01240"></a>01240       }
<a name="l01241"></a>01241       who = <a class="code" href="channel_8h.html#aec8ce59b78afbd3651f3de011f13290a" title="Waits for input on a group of channels Wait for input on an array of channels for...">ast_waitfor_n</a>(cs, 2, &amp;to);
<a name="l01242"></a>01242       <span class="keywordflow">if</span> (!who) {
<a name="l01243"></a>01243          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Ooh, empty read...\n&quot;</span>);
<a name="l01244"></a>01244          <span class="comment">/* check for hangup / whentohangup */</span>
<a name="l01245"></a>01245          <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd" title="Check to see if a channel is needing hang up.">ast_check_hangup</a>(c0) || <a class="code" href="channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd" title="Check to see if a channel is needing hang up.">ast_check_hangup</a>(c1))
<a name="l01246"></a>01246             <span class="keywordflow">break</span>;
<a name="l01247"></a>01247          <span class="keywordflow">continue</span>;
<a name="l01248"></a>01248       }
<a name="l01249"></a>01249       f = <a class="code" href="channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1" title="Reads a frame.">ast_read</a>(who);
<a name="l01250"></a>01250       <span class="keywordflow">if</span> (!f) {
<a name="l01251"></a>01251          *fo = f;
<a name="l01252"></a>01252          *rc = who;
<a name="l01253"></a>01253          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Oooh, got a %s\n&quot;</span>, f ? <span class="stringliteral">&quot;digit&quot;</span> : <span class="stringliteral">&quot;hangup&quot;</span>);
<a name="l01254"></a>01254          <span class="comment">/* That&apos;s all we needed */</span>
<a name="l01255"></a>01255          <span class="keywordflow">return</span> 0;
<a name="l01256"></a>01256       } <span class="keywordflow">else</span> {
<a name="l01257"></a>01257          <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ad99b86353343f422bda01163898b2eea">AST_FRAME_MODEM</a>) {
<a name="l01258"></a>01258             <span class="comment">/* Forward T.38 frames if they happen upon us */</span>
<a name="l01259"></a>01259             <span class="keywordflow">if</span> (who == c0) {
<a name="l01260"></a>01260                <a class="code" href="channel_8h.html#a79c413d51b7135404d5cacf811649a61" title="Write a frame to a channel This function writes the given frame to the indicated...">ast_write</a>(c1, f);
<a name="l01261"></a>01261             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (who == c1) {
<a name="l01262"></a>01262                <a class="code" href="channel_8h.html#a79c413d51b7135404d5cacf811649a61" title="Write a frame to a channel This function writes the given frame to the indicated...">ast_write</a>(c0, f);
<a name="l01263"></a>01263             }
<a name="l01264"></a>01264          }
<a name="l01265"></a>01265          <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l01266"></a>01266       }
<a name="l01267"></a>01267       <span class="comment">/* Swap priority. Not that it&apos;s a big deal at this point */</span>
<a name="l01268"></a>01268       cs[2] = cs[0];
<a name="l01269"></a>01269       cs[0] = cs[1];
<a name="l01270"></a>01270       cs[1] = cs[2];
<a name="l01271"></a>01271    }
<a name="l01272"></a>01272    <span class="keywordflow">return</span> -1;
<a name="l01273"></a>01273 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0c14cc450fe0891cbee26ffd74cf77cb"></a><!-- doxytag: member="udptl.c::ast_udptl_destroy" ref="a0c14cc450fe0891cbee26ffd74cf77cb" args="(struct ast_udptl *udptl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_udptl_destroy </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l01049">1049</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="io_8c_source.html#l00236">ast_io_remove()</a>, <a class="el" href="udptl_8c_source.html#l00117">ast_udptl::fd</a>, <a class="el" href="udptl_8c_source.html#l00128">ast_udptl::io</a>, <a class="el" href="udptl_8c_source.html#l00126">ast_udptl::ioid</a>, and <a class="el" href="udptl_8c_source.html#l00130">ast_udptl::tag</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l05498">__sip_destroy()</a>, and <a class="el" href="chan__sip_8c_source.html#l05102">create_addr_from_peer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01050"></a>01050 {
<a name="l01051"></a>01051    <span class="keywordflow">if</span> (udptl-&gt;<a class="code" href="structast__udptl.html#a378e4ecae74acafadf99a691f65f2419">ioid</a>)
<a name="l01052"></a>01052       <a class="code" href="io_8h.html#afbf1092b96128d07d0dd08dfa898f4d5" title="Removes an IO context.">ast_io_remove</a>(udptl-&gt;<a class="code" href="structast__udptl.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a>, udptl-&gt;<a class="code" href="structast__udptl.html#a378e4ecae74acafadf99a691f65f2419">ioid</a>);
<a name="l01053"></a>01053    <span class="keywordflow">if</span> (udptl-&gt;<a class="code" href="structast__udptl.html#a6f8059414f0228f0256115e024eeed4b">fd</a> &gt; -1)
<a name="l01054"></a>01054       close(udptl-&gt;<a class="code" href="structast__udptl.html#a6f8059414f0228f0256115e024eeed4b">fd</a>);
<a name="l01055"></a>01055    <span class="keywordflow">if</span> (udptl-&gt;<a class="code" href="structast__udptl.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a>)
<a name="l01056"></a>01056       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(udptl-&gt;<a class="code" href="structast__udptl.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a>);
<a name="l01057"></a>01057    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(udptl);
<a name="l01058"></a>01058 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a424e6e48fcfa491a9ee6da3c8a7162a3"></a><!-- doxytag: member="udptl.c::ast_udptl_fd" ref="a424e6e48fcfa491a9ee6da3c8a7162a3" args="(const struct ast_udptl *udptl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_udptl_fd </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00640">640</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00117">ast_udptl::fd</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l00999">__oh323_new()</a>, and <a class="el" href="chan__sip_8c_source.html#l06599">sip_new()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00641"></a>00641 {
<a name="l00642"></a>00642    <span class="keywordflow">return</span> udptl-&gt;<a class="code" href="structast__udptl.html#a6f8059414f0228f0256115e024eeed4b">fd</a>;
<a name="l00643"></a>00643 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a10b606a6ac66cc148ea1c43a508ebb6d"></a><!-- doxytag: member="udptl.c::ast_udptl_get_error_correction_scheme" ref="a10b606a6ac66cc148ea1c43a508ebb6d" args="(const struct ast_udptl *udptl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795">ast_t38_ec_modes</a> ast_udptl_get_error_correction_scheme </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00831">831</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00136">ast_udptl::error_correction_scheme</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l10016">add_sdp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00832"></a>00832 {
<a name="l00833"></a>00833    <span class="keywordflow">return</span> udptl-&gt;<a class="code" href="structast__udptl.html#ac215dbaf54319e257d2c33ecd70c36c5">error_correction_scheme</a>;
<a name="l00834"></a>00834 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad81d6dc0df37c1b771f803c431cc102a"></a><!-- doxytag: member="udptl.c::ast_udptl_get_far_max_datagram" ref="ad81d6dc0df37c1b771f803c431cc102a" args="(const struct ast_udptl *udptl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int ast_udptl_get_far_max_datagram </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00899">899</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00151">ast_udptl::far_max_datagram</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l08040">process_sdp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00900"></a>00900 {
<a name="l00901"></a>00901    <span class="keywordflow">if</span> (udptl-&gt;<a class="code" href="structast__udptl.html#a57bdb7e31fa5ba4d3f96658d472e5b94">far_max_datagram</a> &lt; 0) {
<a name="l00902"></a>00902       <span class="keywordflow">return</span> 0;
<a name="l00903"></a>00903    }
<a name="l00904"></a>00904    <span class="keywordflow">return</span> udptl-&gt;<a class="code" href="structast__udptl.html#a57bdb7e31fa5ba4d3f96658d472e5b94">far_max_datagram</a>;
<a name="l00905"></a>00905 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a72d15492e0a4594c95848800a93017f3"></a><!-- doxytag: member="udptl.c::ast_udptl_get_far_max_ifp" ref="a72d15492e0a4594c95848800a93017f3" args="(struct ast_udptl *udptl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int ast_udptl_get_far_max_ifp </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>retrieves far max ifp </p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>positive</em>&nbsp;</td><td>value representing max ifp size </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if no value is present </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00907">907</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00763">calculate_far_max_ifp()</a>, and <a class="el" href="udptl_8c_source.html#l00165">ast_udptl::far_max_ifp</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l05019">change_t38_state()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00908"></a>00908 {
<a name="l00909"></a>00909    <span class="keywordflow">if</span> (udptl-&gt;<a class="code" href="structast__udptl.html#a95f0114a9c3434fbe3743868a613480b">far_max_ifp</a> == -1) {
<a name="l00910"></a>00910       <a class="code" href="udptl_8c.html#a541dbf72506ff6bead2d506613979e24">calculate_far_max_ifp</a>(udptl);
<a name="l00911"></a>00911    }
<a name="l00912"></a>00912 
<a name="l00913"></a>00913    <span class="keywordflow">if</span> (udptl-&gt;<a class="code" href="structast__udptl.html#a95f0114a9c3434fbe3743868a613480b">far_max_ifp</a> &lt; 0) {
<a name="l00914"></a>00914       <span class="keywordflow">return</span> 0;
<a name="l00915"></a>00915    }
<a name="l00916"></a>00916    <span class="keywordflow">return</span> udptl-&gt;<a class="code" href="structast__udptl.html#a95f0114a9c3434fbe3743868a613480b">far_max_ifp</a>;
<a name="l00917"></a>00917 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aac14f584f25701499a840fd9b1ee30a5"></a><!-- doxytag: member="udptl.c::ast_udptl_get_local_max_datagram" ref="aac14f584f25701499a840fd9b1ee30a5" args="(struct ast_udptl *udptl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int ast_udptl_get_local_max_datagram </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>retrieves local_max_datagram. </p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>positive</em>&nbsp;</td><td>value representing max datagram size. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if no value is present </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00875">875</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00722">calculate_local_max_datagram()</a>, and <a class="el" href="udptl_8c_source.html#l00157">ast_udptl::local_max_datagram</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l10016">add_sdp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00876"></a>00876 {
<a name="l00877"></a>00877    <span class="keywordflow">if</span> (udptl-&gt;<a class="code" href="structast__udptl.html#aa6de52220e98717c22a45506d1aad1eb">local_max_datagram</a> == -1) {
<a name="l00878"></a>00878       <a class="code" href="udptl_8c.html#ab3acebf54181c51340a4a3fa080525a8">calculate_local_max_datagram</a>(udptl);
<a name="l00879"></a>00879    }
<a name="l00880"></a>00880 
<a name="l00881"></a>00881    <span class="comment">/* this function expects a unsigned value in return. */</span>
<a name="l00882"></a>00882    <span class="keywordflow">if</span> (udptl-&gt;<a class="code" href="structast__udptl.html#aa6de52220e98717c22a45506d1aad1eb">local_max_datagram</a> &lt; 0) {
<a name="l00883"></a>00883       <span class="keywordflow">return</span> 0;
<a name="l00884"></a>00884    }
<a name="l00885"></a>00885    <span class="keywordflow">return</span> udptl-&gt;<a class="code" href="structast__udptl.html#aa6de52220e98717c22a45506d1aad1eb">local_max_datagram</a>;
<a name="l00886"></a>00886 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7a96d2874c787b03db8c8b21ffcee89c"></a><!-- doxytag: member="udptl.c::ast_udptl_get_peer" ref="a7a96d2874c787b03db8c8b21ffcee89c" args="(const struct ast_udptl *udptl, struct sockaddr_in *them)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_udptl_get_peer </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>them</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l01030">1030</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00125">ast_udptl::them</a>.</p>

<p>Referenced by <a class="el" href="udptl_8c_source.html#l01150">ast_udptl_bridge()</a>, and <a class="el" href="chan__sip_8c_source.html#l25198">sip_set_udptl_peer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01031"></a>01031 {
<a name="l01032"></a>01032    memset(them, 0, <span class="keyword">sizeof</span>(*them));
<a name="l01033"></a>01033    them-&gt;sin_family = AF_INET;
<a name="l01034"></a>01034    them-&gt;sin_port = udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port;
<a name="l01035"></a>01035    them-&gt;sin_addr = udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr;
<a name="l01036"></a>01036 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac191d3e1fcdff6075d0eb5f9ebcbb96c"></a><!-- doxytag: member="udptl.c::ast_udptl_get_us" ref="ac191d3e1fcdff6075d0eb5f9ebcbb96c" args="(const struct ast_udptl *udptl, struct sockaddr_in *us)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_udptl_get_us </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>us</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l01038">1038</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00124">ast_udptl::us</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l10016">add_sdp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01039"></a>01039 {
<a name="l01040"></a>01040    memcpy(us, &amp;udptl-&gt;<a class="code" href="structast__udptl.html#a3c2346010ce32cf02b7c85203c76a20d">us</a>, <span class="keyword">sizeof</span>(udptl-&gt;<a class="code" href="structast__udptl.html#a3c2346010ce32cf02b7c85203c76a20d">us</a>));
<a name="l01041"></a>01041 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad68827c8f88b83c06791a96e595ed978"></a><!-- doxytag: member="udptl.c::ast_udptl_init" ref="ad68827c8f88b83c06791a96e595ed978" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_udptl_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l01448">1448</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l01342">__ast_udptl_reload()</a>, <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, and <a class="el" href="cli_8c_source.html#l01927">ast_cli_register_multiple()</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01449"></a>01449 {
<a name="l01450"></a>01450    <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(<a class="code" href="udptl_8c.html#a307853ba74adbc85d4dd57bee618e674">cli_udptl</a>, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="udptl_8c.html#a307853ba74adbc85d4dd57bee618e674">cli_udptl</a>));
<a name="l01451"></a>01451    <a class="code" href="udptl_8c.html#acfdd6fa3b0b7a0acd4a9841c6596809d">__ast_udptl_reload</a>(0);
<a name="l01452"></a>01452 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a310872d2ca901a1c6d42ca510b69ed48"></a><!-- doxytag: member="udptl.c::ast_udptl_new" ref="a310872d2ca901a1c6d42ca510b69ed48" args="(struct sched_context *sched, struct io_context *io, int callbackmode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__udptl.html">ast_udptl</a>* ast_udptl_new </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structsched__context.html">sched_context</a> *&nbsp;</td>
          <td class="paramname"> <em>sched</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structio__context.html">io_context</a> *&nbsp;</td>
          <td class="paramname"> <em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>callbackmode</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00997">997</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00919">ast_udptl_new_with_bindaddr()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00998"></a>00998 {
<a name="l00999"></a>00999    <span class="keyword">struct </span>in_addr ia;
<a name="l01000"></a>01000    memset(&amp;ia, 0, <span class="keyword">sizeof</span>(ia));
<a name="l01001"></a>01001    <span class="keywordflow">return</span> <a class="code" href="udptl_8h.html#afbcd53e47ee0ca638b3a44c6ce978263">ast_udptl_new_with_bindaddr</a>(sched, io, callbackmode, ia);
<a name="l01002"></a>01002 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a60e9774baa6ec8d1c3fdc0e002ac9bd7"></a><!-- doxytag: member="udptl.c::ast_udptl_new_with_bindaddr" ref="a60e9774baa6ec8d1c3fdc0e002ac9bd7" args="(struct sched_context *sched, struct io_context *io, int callbackmode, struct in_addr addr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__udptl.html">ast_udptl</a>* ast_udptl_new_with_bindaddr </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structsched__context.html">sched_context</a> *&nbsp;</td>
          <td class="paramname"> <em>sched</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structio__context.html">io_context</a> *&nbsp;</td>
          <td class="paramname"> <em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>callbackmode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct in_addr&nbsp;</td>
          <td class="paramname"> <em>addr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00919">919</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="io_8c_source.html#l00153">ast_io_add()</a>, <a class="el" href="io_8h_source.html#l00033">AST_IO_IN</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8c_source.html#l01401">ast_random()</a>, <a class="el" href="udptl_8c_source.html#l00102">udptl_fec_tx_buffer_t::buf_len</a>, <a class="el" href="udptl_8c_source.html#l00107">udptl_fec_rx_buffer_t::buf_len</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="udptl_8c_source.html#l00141">ast_udptl::error_correction_entries</a>, <a class="el" href="udptl_8c_source.html#l00146">ast_udptl::error_correction_span</a>, <a class="el" href="udptl_8c_source.html#l00151">ast_udptl::far_max_datagram</a>, <a class="el" href="udptl_8c_source.html#l00165">ast_udptl::far_max_ifp</a>, <a class="el" href="udptl_8c_source.html#l00117">ast_udptl::fd</a>, <a class="el" href="udptl_8c_source.html#l00123">ast_udptl::flags</a>, <a class="el" href="udptl_8c_source.html#l00128">ast_udptl::io</a>, <a class="el" href="udptl_8c_source.html#l00126">ast_udptl::ioid</a>, <a class="el" href="udptl_8c_source.html#l00157">ast_udptl::local_max_datagram</a>, <a class="el" href="udptl_8c_source.html#l00171">ast_udptl::local_max_ifp</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="udptl_8c_source.html#l00182">ast_udptl::rx</a>, <a class="el" href="udptl_8c_source.html#l00127">ast_udptl::sched</a>, <a class="el" href="udptl_8c_source.html#l00125">ast_udptl::them</a>, <a class="el" href="udptl_8c_source.html#l00181">ast_udptl::tx</a>, <a class="el" href="udptl_8c_source.html#l00099">UDPTL_BUF_MASK</a>, <a class="el" href="udptl_8c_source.html#l00660">udptlread()</a>, and <a class="el" href="udptl_8c_source.html#l00124">ast_udptl::us</a>.</p>

<p>Referenced by <a class="el" href="udptl_8c_source.html#l00997">ast_udptl_new()</a>, <a class="el" href="chan__sip_8c_source.html#l05102">create_addr_from_peer()</a>, <a class="el" href="chan__sip_8c_source.html#l19641">handle_request_invite()</a>, and <a class="el" href="chan__sip_8c_source.html#l07151">sip_alloc()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00920"></a>00920 {
<a name="l00921"></a>00921    <span class="keyword">struct </span><a class="code" href="structast__udptl.html" title="Structure for an UDPTL session.">ast_udptl</a> *udptl;
<a name="l00922"></a>00922    <span class="keywordtype">int</span> x;
<a name="l00923"></a>00923    <span class="keywordtype">int</span> startplace;
<a name="l00924"></a>00924    <span class="keywordtype">int</span> i;
<a name="l00925"></a>00925    <span class="keywordtype">long</span> <span class="keywordtype">int</span> <a class="code" href="structast__udptl.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a>;
<a name="l00926"></a>00926 
<a name="l00927"></a>00927    <span class="keywordflow">if</span> (!(udptl = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*udptl))))
<a name="l00928"></a>00928       <span class="keywordflow">return</span> NULL;
<a name="l00929"></a>00929 
<a name="l00930"></a>00930    udptl-&gt;<a class="code" href="structast__udptl.html#aa3ea4f55135ebfe86fb4d34b891fe618">error_correction_span</a> = <a class="code" href="udptl_8c.html#a1843da2c025cc14346182403c4c9fa53">udptlfecspan</a>;
<a name="l00931"></a>00931    udptl-&gt;<a class="code" href="structast__udptl.html#a53a056eca513e58ba0819110f0e62bc8">error_correction_entries</a> = <a class="code" href="udptl_8c.html#a2d6cbcd43cd796cd91da16fc798be95d">udptlfecentries</a>;
<a name="l00932"></a>00932    
<a name="l00933"></a>00933    udptl-&gt;<a class="code" href="structast__udptl.html#a57bdb7e31fa5ba4d3f96658d472e5b94">far_max_datagram</a> = -1;
<a name="l00934"></a>00934    udptl-&gt;<a class="code" href="structast__udptl.html#a95f0114a9c3434fbe3743868a613480b">far_max_ifp</a> = -1;
<a name="l00935"></a>00935    udptl-&gt;<a class="code" href="structast__udptl.html#a832188d785b133f8195c9c74de833141">local_max_ifp</a> = -1;
<a name="l00936"></a>00936    udptl-&gt;<a class="code" href="structast__udptl.html#aa6de52220e98717c22a45506d1aad1eb">local_max_datagram</a> = -1;
<a name="l00937"></a>00937 
<a name="l00938"></a>00938    <span class="keywordflow">for</span> (i = 0; i &lt;= <a class="code" href="udptl_8c.html#a5fc08f5f3152e66b9eb799375c8eafe5">UDPTL_BUF_MASK</a>; i++) {
<a name="l00939"></a>00939       udptl-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[i].<a class="code" href="structudptl__fec__rx__buffer__t.html#a7666bbf00997cc13da27d55cb05d27c4">buf_len</a> = -1;
<a name="l00940"></a>00940       udptl-&gt;<a class="code" href="structast__udptl.html#af0c6829f8a5272ece732cd1ac1b3094a">tx</a>[i].<a class="code" href="structudptl__fec__tx__buffer__t.html#a7666bbf00997cc13da27d55cb05d27c4">buf_len</a> = -1;
<a name="l00941"></a>00941    }
<a name="l00942"></a>00942 
<a name="l00943"></a>00943    udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_family = AF_INET;
<a name="l00944"></a>00944    udptl-&gt;<a class="code" href="structast__udptl.html#a3c2346010ce32cf02b7c85203c76a20d">us</a>.sin_family = AF_INET;
<a name="l00945"></a>00945 
<a name="l00946"></a>00946    <span class="keywordflow">if</span> ((udptl-&gt;<a class="code" href="structast__udptl.html#a6f8059414f0228f0256115e024eeed4b">fd</a> = socket(AF_INET, SOCK_DGRAM, 0)) &lt; 0) {
<a name="l00947"></a>00947       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(udptl);
<a name="l00948"></a>00948       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to allocate socket: %s\n&quot;</span>, strerror(errno));
<a name="l00949"></a>00949       <span class="keywordflow">return</span> NULL;
<a name="l00950"></a>00950    }
<a name="l00951"></a>00951    flags = fcntl(udptl-&gt;<a class="code" href="structast__udptl.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, F_GETFL);
<a name="l00952"></a>00952    fcntl(udptl-&gt;<a class="code" href="structast__udptl.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, F_SETFL, flags | O_NONBLOCK);
<a name="l00953"></a>00953 <span class="preprocessor">#ifdef SO_NO_CHECK</span>
<a name="l00954"></a>00954 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (nochecksums)
<a name="l00955"></a>00955       setsockopt(udptl-&gt;<a class="code" href="structast__udptl.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, SOL_SOCKET, SO_NO_CHECK, &amp;nochecksums, <span class="keyword">sizeof</span>(nochecksums));
<a name="l00956"></a>00956 <span class="preprocessor">#endif</span>
<a name="l00957"></a>00957 <span class="preprocessor"></span>   <span class="comment">/* Find us a place */</span>
<a name="l00958"></a>00958    x = (<a class="code" href="udptl_8c.html#a3bf0aa3b30cf99c6052f71dd963dc800">udptlstart</a> == <a class="code" href="udptl_8c.html#a6bb07009dda10589e6e1dbad7a48d157">udptlend</a>) ? <a class="code" href="udptl_8c.html#a3bf0aa3b30cf99c6052f71dd963dc800">udptlstart</a> : (<a class="code" href="utils_8h.html#a7b4f10b070e95ba413e258a3e4b03c20">ast_random</a>() % (<a class="code" href="udptl_8c.html#a6bb07009dda10589e6e1dbad7a48d157">udptlend</a> - <a class="code" href="udptl_8c.html#a3bf0aa3b30cf99c6052f71dd963dc800">udptlstart</a>)) + <a class="code" href="udptl_8c.html#a3bf0aa3b30cf99c6052f71dd963dc800">udptlstart</a>;
<a name="l00959"></a>00959    <span class="keywordflow">if</span> (<a class="code" href="udptl_8c.html#a830f7f070798d4b70c3189b8fade1ab7">use_even_ports</a> &amp;&amp; (x &amp; 1)) {
<a name="l00960"></a>00960       ++x;
<a name="l00961"></a>00961    }
<a name="l00962"></a>00962    startplace = x;
<a name="l00963"></a>00963    <span class="keywordflow">for</span> (;;) {
<a name="l00964"></a>00964       udptl-&gt;<a class="code" href="structast__udptl.html#a3c2346010ce32cf02b7c85203c76a20d">us</a>.sin_port = htons(x);
<a name="l00965"></a>00965       udptl-&gt;<a class="code" href="structast__udptl.html#a3c2346010ce32cf02b7c85203c76a20d">us</a>.sin_addr = addr;
<a name="l00966"></a>00966       <span class="keywordflow">if</span> (bind(udptl-&gt;<a class="code" href="structast__udptl.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, (<span class="keyword">struct</span> sockaddr *) &amp;udptl-&gt;<a class="code" href="structast__udptl.html#a3c2346010ce32cf02b7c85203c76a20d">us</a>, <span class="keyword">sizeof</span>(udptl-&gt;<a class="code" href="structast__udptl.html#a3c2346010ce32cf02b7c85203c76a20d">us</a>)) == 0)
<a name="l00967"></a>00967          <span class="keywordflow">break</span>;
<a name="l00968"></a>00968       <span class="keywordflow">if</span> (errno != EADDRINUSE) {
<a name="l00969"></a>00969          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unexpected bind error: %s\n&quot;</span>, strerror(errno));
<a name="l00970"></a>00970          close(udptl-&gt;<a class="code" href="structast__udptl.html#a6f8059414f0228f0256115e024eeed4b">fd</a>);
<a name="l00971"></a>00971          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(udptl);
<a name="l00972"></a>00972          <span class="keywordflow">return</span> NULL;
<a name="l00973"></a>00973       }
<a name="l00974"></a>00974       <span class="keywordflow">if</span> (<a class="code" href="udptl_8c.html#a830f7f070798d4b70c3189b8fade1ab7">use_even_ports</a>) {
<a name="l00975"></a>00975          x += 2;
<a name="l00976"></a>00976       } <span class="keywordflow">else</span> {
<a name="l00977"></a>00977          ++x;
<a name="l00978"></a>00978       }
<a name="l00979"></a>00979       <span class="keywordflow">if</span> (x &gt; <a class="code" href="udptl_8c.html#a6bb07009dda10589e6e1dbad7a48d157">udptlend</a>)
<a name="l00980"></a>00980          x = <a class="code" href="udptl_8c.html#a3bf0aa3b30cf99c6052f71dd963dc800">udptlstart</a>;
<a name="l00981"></a>00981       <span class="keywordflow">if</span> (x == startplace) {
<a name="l00982"></a>00982          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No UDPTL ports remaining\n&quot;</span>);
<a name="l00983"></a>00983          close(udptl-&gt;<a class="code" href="structast__udptl.html#a6f8059414f0228f0256115e024eeed4b">fd</a>);
<a name="l00984"></a>00984          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(udptl);
<a name="l00985"></a>00985          <span class="keywordflow">return</span> NULL;
<a name="l00986"></a>00986       }
<a name="l00987"></a>00987    }
<a name="l00988"></a>00988    <span class="keywordflow">if</span> (io &amp;&amp; sched &amp;&amp; callbackmode) {
<a name="l00989"></a>00989       <span class="comment">/* Operate this one in a callback mode */</span>
<a name="l00990"></a>00990       udptl-&gt;<a class="code" href="structast__udptl.html#aea6233539fc73fc5303bf7525ec27e73">sched</a> = sched;
<a name="l00991"></a>00991       udptl-&gt;<a class="code" href="structast__udptl.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a> = io;
<a name="l00992"></a>00992       udptl-&gt;<a class="code" href="structast__udptl.html#a378e4ecae74acafadf99a691f65f2419">ioid</a> = <a class="code" href="io_8h.html#aa250c3f6541dc5734deb966d6821da7a" title="Adds an IO context.">ast_io_add</a>(udptl-&gt;<a class="code" href="structast__udptl.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a>, udptl-&gt;<a class="code" href="structast__udptl.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <a class="code" href="udptl_8c.html#aca6905df84f7b7a4905a3fadb50139c7">udptlread</a>, <a class="code" href="io_8h.html#a0d9e01f215782a343a1b71b5be362080">AST_IO_IN</a>, udptl);
<a name="l00993"></a>00993    }
<a name="l00994"></a>00994    <span class="keywordflow">return</span> udptl;
<a name="l00995"></a>00995 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4c3c0f932544c3920055554c473d6576"></a><!-- doxytag: member="udptl.c::ast_udptl_proto_register" ref="a4c3c0f932544c3920055554c473d6576" args="(struct ast_udptl_protocol *proto)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_udptl_proto_register </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl__protocol.html">ast_udptl_protocol</a> *&nbsp;</td>
          <td class="paramname"> <em>proto</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l01119">1119</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="linkedlists_8h_source.html#l00725">AST_RWLIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="structast__udptl__protocol.html#ad9b85bd971cfb2b646be8afa37d584f3">ast_udptl_protocol::list</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="udptl_8h_source.html#l00051">ast_udptl_protocol::type</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l25736">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01120"></a>01120 {
<a name="l01121"></a>01121    <span class="keyword">struct </span><a class="code" href="structast__udptl__protocol.html">ast_udptl_protocol</a> *cur;
<a name="l01122"></a>01122 
<a name="l01123"></a>01123    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structprotos.html" title="List of current sessions.">protos</a>);
<a name="l01124"></a>01124    <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="structprotos.html" title="List of current sessions.">protos</a>, cur, <a class="code" href="structast__udptl__protocol.html#ad9b85bd971cfb2b646be8afa37d584f3">list</a>) {
<a name="l01125"></a>01125       <span class="keywordflow">if</span> (cur-&gt;<a class="code" href="structast__udptl__protocol.html#a8ff938fb2f815be425fd2859a21e6d61">type</a> == proto-&gt;<a class="code" href="structast__udptl__protocol.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>) {
<a name="l01126"></a>01126          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Tried to register same protocol &apos;%s&apos; twice\n&quot;</span>, cur-&gt;<a class="code" href="structast__udptl__protocol.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>);
<a name="l01127"></a>01127          <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structprotos.html" title="List of current sessions.">protos</a>);
<a name="l01128"></a>01128          <span class="keywordflow">return</span> -1;
<a name="l01129"></a>01129       }
<a name="l01130"></a>01130    }
<a name="l01131"></a>01131    <a class="code" href="linkedlists_8h.html#aadda916488b2d151af4426e2f06ad332">AST_RWLIST_INSERT_TAIL</a>(&amp;<a class="code" href="structprotos.html" title="List of current sessions.">protos</a>, proto, <a class="code" href="structast__udptl__protocol.html#ad9b85bd971cfb2b646be8afa37d584f3">list</a>);
<a name="l01132"></a>01132    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structprotos.html" title="List of current sessions.">protos</a>);
<a name="l01133"></a>01133    <span class="keywordflow">return</span> 0;
<a name="l01134"></a>01134 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac1d0c92d37bf00a7138bf30b11980df5"></a><!-- doxytag: member="udptl.c::ast_udptl_proto_unregister" ref="ac1d0c92d37bf00a7138bf30b11980df5" args="(struct ast_udptl_protocol *proto)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_udptl_proto_unregister </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl__protocol.html">ast_udptl_protocol</a> *&nbsp;</td>
          <td class="paramname"> <em>proto</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l01112">1112</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00860">AST_RWLIST_REMOVE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, and <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l25834">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01113"></a>01113 {
<a name="l01114"></a>01114    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structprotos.html" title="List of current sessions.">protos</a>);
<a name="l01115"></a>01115    <a class="code" href="linkedlists_8h.html#a6091f0518f8b6f443fd9f5150f3ac407">AST_RWLIST_REMOVE</a>(&amp;<a class="code" href="structprotos.html" title="List of current sessions.">protos</a>, proto, <a class="code" href="structast__udptl__protocol.html#ad9b85bd971cfb2b646be8afa37d584f3">list</a>);
<a name="l01116"></a>01116    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structprotos.html" title="List of current sessions.">protos</a>);
<a name="l01117"></a>01117 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae0808bce80557e3107c9030bd8a832fe"></a><!-- doxytag: member="udptl.c::ast_udptl_read" ref="ae0808bce80557e3107c9030bd8a832fe" args="(struct ast_udptl *udptl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__frame.html">ast_frame</a>* ast_udptl_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00672">672</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="utils_8h_source.html#l00678">ast_assert</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8h_source.html#l00203">AST_FRIENDLY_OFFSET</a>, <a class="el" href="utils_8c_source.html#l00431">ast_inet_ntoa()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="frame_8c_source.html#l00124">ast_null_frame</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="udptl_8c_source.html#l00119">ast_udptl::f</a>, <a class="el" href="udptl_8c_source.html#l00117">ast_udptl::fd</a>, <a class="el" href="func__strings_8c_source.html#l00821">len()</a>, <a class="el" href="udptl_8c_source.html#l00080">LOG_TAG</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="udptl_8c_source.html#l00122">ast_udptl::nat</a>, <a class="el" href="udptl_8c_source.html#l00120">ast_udptl::rawdata</a>, <a class="el" href="udptl_8c_source.html#l00125">ast_udptl::them</a>, <a class="el" href="udptl_8c_source.html#l00187">udptl_debug_test_addr()</a>, and <a class="el" href="udptl_8c_source.html#l00318">udptl_rx_packet()</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l06955">sip_rtp_read()</a>, <a class="el" href="chan__skinny_8c_source.html#l03907">skinny_rtp_read()</a>, and <a class="el" href="udptl_8c_source.html#l00660">udptlread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00673"></a>00673 {
<a name="l00674"></a>00674    <span class="keywordtype">int</span> res;
<a name="l00675"></a>00675    <span class="keyword">struct </span>sockaddr_in sin;
<a name="l00676"></a>00676    socklen_t <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;
<a name="l00677"></a>00677    uint16_t seqno = 0;
<a name="l00678"></a>00678    uint16_t *udptlheader;
<a name="l00679"></a>00679 
<a name="l00680"></a>00680    len = <span class="keyword">sizeof</span>(sin);
<a name="l00681"></a>00681    
<a name="l00682"></a>00682    <span class="comment">/* Cache where the header will go */</span>
<a name="l00683"></a>00683    res = recvfrom(udptl-&gt;<a class="code" href="structast__udptl.html#a6f8059414f0228f0256115e024eeed4b">fd</a>,
<a name="l00684"></a>00684          udptl-&gt;<a class="code" href="structast__udptl.html#a8af53bd0e8b4f1e9275d51d2a4065991">rawdata</a> + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>,
<a name="l00685"></a>00685          <span class="keyword">sizeof</span>(udptl-&gt;<a class="code" href="structast__udptl.html#a8af53bd0e8b4f1e9275d51d2a4065991">rawdata</a>) - <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>,
<a name="l00686"></a>00686          0,
<a name="l00687"></a>00687          (<span class="keyword">struct</span> sockaddr *) &amp;sin,
<a name="l00688"></a>00688          &amp;len);
<a name="l00689"></a>00689    udptlheader = (uint16_t *)(udptl-&gt;<a class="code" href="structast__udptl.html#a8af53bd0e8b4f1e9275d51d2a4065991">rawdata</a> + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>);
<a name="l00690"></a>00690    <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l00691"></a>00691       <span class="keywordflow">if</span> (errno != EAGAIN)
<a name="l00692"></a>00692          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;(%s): UDPTL read error: %s\n&quot;</span>,
<a name="l00693"></a>00693             <a class="code" href="udptl_8c.html#a12f6e5fd71bc2bc7fcfc0583b035c862">LOG_TAG</a>(udptl), strerror(errno));
<a name="l00694"></a>00694       <a class="code" href="utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(errno != EBADF);
<a name="l00695"></a>00695       <span class="keywordflow">return</span> &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l00696"></a>00696    }
<a name="l00697"></a>00697 
<a name="l00698"></a>00698    <span class="comment">/* Ignore if the other side hasn&apos;t been given an address yet. */</span>
<a name="l00699"></a>00699    <span class="keywordflow">if</span> (!udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr.s_addr || !udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port)
<a name="l00700"></a>00700       <span class="keywordflow">return</span> &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l00701"></a>00701 
<a name="l00702"></a>00702    <span class="keywordflow">if</span> (udptl-&gt;<a class="code" href="structast__udptl.html#ada540a5f25f7302dc1a3d17ccfa59b10">nat</a>) {
<a name="l00703"></a>00703       <span class="comment">/* Send to whoever sent to us */</span>
<a name="l00704"></a>00704       <span class="keywordflow">if</span> ((udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr.s_addr != sin.sin_addr.s_addr) ||
<a name="l00705"></a>00705          (udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port != sin.sin_port)) {
<a name="l00706"></a>00706          memcpy(&amp;udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>, &amp;sin, <span class="keyword">sizeof</span>(udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>));
<a name="l00707"></a>00707          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;UDPTL NAT (%s): Using address %s:%d\n&quot;</span>,
<a name="l00708"></a>00708               <a class="code" href="udptl_8c.html#a12f6e5fd71bc2bc7fcfc0583b035c862">LOG_TAG</a>(udptl), <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr), ntohs(udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port));
<a name="l00709"></a>00709       }
<a name="l00710"></a>00710    }
<a name="l00711"></a>00711 
<a name="l00712"></a>00712    <span class="keywordflow">if</span> (<a class="code" href="udptl_8c.html#a01d5961e9d1bf0c8c6244aee64a1ecf9">udptl_debug_test_addr</a>(&amp;sin)) {
<a name="l00713"></a>00713       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;UDPTL (%s): packet from %s:%d (type %d, seq %d, len %d)\n&quot;</span>,
<a name="l00714"></a>00714           <a class="code" href="udptl_8c.html#a12f6e5fd71bc2bc7fcfc0583b035c862">LOG_TAG</a>(udptl), <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(sin.sin_addr), ntohs(sin.sin_port), 0, seqno, res);
<a name="l00715"></a>00715    }
<a name="l00716"></a>00716    <span class="keywordflow">if</span> (<a class="code" href="udptl_8c.html#a0db4385b032d828c9ec822008c79a061">udptl_rx_packet</a>(udptl, udptl-&gt;<a class="code" href="structast__udptl.html#a8af53bd0e8b4f1e9275d51d2a4065991">rawdata</a> + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>, res) &lt; 1)
<a name="l00717"></a>00717       <span class="keywordflow">return</span> &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l00718"></a>00718 
<a name="l00719"></a>00719    <span class="keywordflow">return</span> &amp;udptl-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[0];
<a name="l00720"></a>00720 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aef56fae41fcf91924375991a5c4e7568"></a><!-- doxytag: member="udptl.c::ast_udptl_reload" ref="aef56fae41fcf91924375991a5c4e7568" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_udptl_reload </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="version"><dt><b>Version:</b></dt><dd>1.6.1 return changed to int </dd></dl>

<p>Definition at line <a class="el" href="udptl_8c_source.html#l01442">1442</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l01342">__ast_udptl_reload()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01443"></a>01443 {
<a name="l01444"></a>01444    <a class="code" href="udptl_8c.html#acfdd6fa3b0b7a0acd4a9841c6596809d">__ast_udptl_reload</a>(1);
<a name="l01445"></a>01445    <span class="keywordflow">return</span> 0;
<a name="l01446"></a>01446 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac410178703bbd10effbedd9823b89f2a"></a><!-- doxytag: member="udptl.c::ast_udptl_set_callback" ref="ac410178703bbd10effbedd9823b89f2a" args="(struct ast_udptl *udptl, ast_udptl_callback callback)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_udptl_set_callback </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="udptl_8h.html#a04e7bb36362e3da0ab84dbceb6e3dc9e">ast_udptl_callback</a>&nbsp;</td>
          <td class="paramname"> <em>callback</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00650">650</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00131">ast_udptl::callback</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00651"></a>00651 {
<a name="l00652"></a>00652    udptl-&gt;<a class="code" href="structast__udptl.html#a221993e4dd934844eb4cce202b381952">callback</a> = callback;
<a name="l00653"></a>00653 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab2b6f583b1e2e2efdd87c0f6a7264d42"></a><!-- doxytag: member="udptl.c::ast_udptl_set_data" ref="ab2b6f583b1e2e2efdd87c0f6a7264d42" args="(struct ast_udptl *udptl, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_udptl_set_data </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00645">645</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00129">ast_udptl::data</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00646"></a>00646 {
<a name="l00647"></a>00647    udptl-&gt;<a class="code" href="structast__udptl.html#a735984d41155bc1032e09bece8f8d66d">data</a> = data;
<a name="l00648"></a>00648 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aec066a1e8d5b80dfab8c4a5296e65e48"></a><!-- doxytag: member="udptl.c::ast_udptl_set_error_correction_scheme" ref="aec066a1e8d5b80dfab8c4a5296e65e48" args="(struct ast_udptl *udptl, enum ast_t38_ec_modes ec)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_udptl_set_error_correction_scheme </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795">ast_t38_ec_modes</a>&nbsp;</td>
          <td class="paramname"> <em>ec</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00836">836</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00141">ast_udptl::error_correction_entries</a>, <a class="el" href="udptl_8c_source.html#l00136">ast_udptl::error_correction_scheme</a>, <a class="el" href="udptl_8c_source.html#l00146">ast_udptl::error_correction_span</a>, <a class="el" href="udptl_8c_source.html#l00165">ast_udptl::far_max_ifp</a>, <a class="el" href="udptl_8c_source.html#l00157">ast_udptl::local_max_datagram</a>, <a class="el" href="udptl_8h_source.html#l00038">UDPTL_ERROR_CORRECTION_FEC</a>, and <a class="el" href="udptl_8h_source.html#l00039">UDPTL_ERROR_CORRECTION_REDUNDANCY</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l08902">process_sdp_a_image()</a>, and <a class="el" href="chan__sip_8c_source.html#l05068">set_t38_capabilities()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00837"></a>00837 {
<a name="l00838"></a>00838    udptl-&gt;<a class="code" href="structast__udptl.html#ac215dbaf54319e257d2c33ecd70c36c5">error_correction_scheme</a> = ec;
<a name="l00839"></a>00839    <span class="keywordflow">switch</span> (ec) {
<a name="l00840"></a>00840    <span class="keywordflow">case</span> <a class="code" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795aa0e8972e48ad95a77cbe2c66e174fd76">UDPTL_ERROR_CORRECTION_FEC</a>:
<a name="l00841"></a>00841       udptl-&gt;<a class="code" href="structast__udptl.html#ac215dbaf54319e257d2c33ecd70c36c5">error_correction_scheme</a> = <a class="code" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795aa0e8972e48ad95a77cbe2c66e174fd76">UDPTL_ERROR_CORRECTION_FEC</a>;
<a name="l00842"></a>00842       <span class="keywordflow">if</span> (udptl-&gt;<a class="code" href="structast__udptl.html#a53a056eca513e58ba0819110f0e62bc8">error_correction_entries</a> == 0) {
<a name="l00843"></a>00843          udptl-&gt;<a class="code" href="structast__udptl.html#a53a056eca513e58ba0819110f0e62bc8">error_correction_entries</a> = 3;
<a name="l00844"></a>00844       }
<a name="l00845"></a>00845       <span class="keywordflow">if</span> (udptl-&gt;<a class="code" href="structast__udptl.html#aa3ea4f55135ebfe86fb4d34b891fe618">error_correction_span</a> == 0) {
<a name="l00846"></a>00846          udptl-&gt;<a class="code" href="structast__udptl.html#aa3ea4f55135ebfe86fb4d34b891fe618">error_correction_span</a> = 3;
<a name="l00847"></a>00847       }
<a name="l00848"></a>00848       <span class="keywordflow">break</span>;
<a name="l00849"></a>00849    <span class="keywordflow">case</span> <a class="code" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795afbc322f60eade115e42b66d4ab4dec83">UDPTL_ERROR_CORRECTION_REDUNDANCY</a>:
<a name="l00850"></a>00850       udptl-&gt;<a class="code" href="structast__udptl.html#ac215dbaf54319e257d2c33ecd70c36c5">error_correction_scheme</a> = <a class="code" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795afbc322f60eade115e42b66d4ab4dec83">UDPTL_ERROR_CORRECTION_REDUNDANCY</a>;
<a name="l00851"></a>00851       <span class="keywordflow">if</span> (udptl-&gt;<a class="code" href="structast__udptl.html#a53a056eca513e58ba0819110f0e62bc8">error_correction_entries</a> == 0) {
<a name="l00852"></a>00852          udptl-&gt;<a class="code" href="structast__udptl.html#a53a056eca513e58ba0819110f0e62bc8">error_correction_entries</a> = 3;
<a name="l00853"></a>00853       }
<a name="l00854"></a>00854       <span class="keywordflow">break</span>;
<a name="l00855"></a>00855    <span class="keywordflow">default</span>:
<a name="l00856"></a>00856       <span class="comment">/* nothing to do */</span>
<a name="l00857"></a>00857       <span class="keywordflow">break</span>;
<a name="l00858"></a>00858    };
<a name="l00859"></a>00859    <span class="comment">/* reset calculated values so they&apos;ll be computed again */</span>
<a name="l00860"></a>00860    udptl-&gt;<a class="code" href="structast__udptl.html#aa6de52220e98717c22a45506d1aad1eb">local_max_datagram</a> = -1;
<a name="l00861"></a>00861    udptl-&gt;<a class="code" href="structast__udptl.html#a95f0114a9c3434fbe3743868a613480b">far_max_ifp</a> = -1;
<a name="l00862"></a>00862 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abb364758e66c04d5d791fc51d2b3ed6d"></a><!-- doxytag: member="udptl.c::ast_udptl_set_far_max_datagram" ref="abb364758e66c04d5d791fc51d2b3ed6d" args="(struct ast_udptl *udptl, unsigned int max_datagram)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_udptl_set_far_max_datagram </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>max_datagram</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>sets far max datagram size. If max_datagram is = 0, the far max datagram size is set to a default value. </p>

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00888">888</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00094">DEFAULT_FAX_MAX_DATAGRAM</a>, <a class="el" href="udptl_8c_source.html#l00151">ast_udptl::far_max_datagram</a>, <a class="el" href="udptl_8c_source.html#l00165">ast_udptl::far_max_ifp</a>, and <a class="el" href="udptl_8c_source.html#l00095">FAX_MAX_DATAGRAM_LIMIT</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l08040">process_sdp()</a>, and <a class="el" href="chan__sip_8c_source.html#l08902">process_sdp_a_image()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00889"></a>00889 {
<a name="l00890"></a>00890    <span class="keywordflow">if</span> (!max_datagram || (max_datagram &gt; <a class="code" href="udptl_8c.html#aa8f3d147dea9bd83782b759502fc60a1">FAX_MAX_DATAGRAM_LIMIT</a>)) {
<a name="l00891"></a>00891       udptl-&gt;<a class="code" href="structast__udptl.html#a57bdb7e31fa5ba4d3f96658d472e5b94">far_max_datagram</a> = <a class="code" href="udptl_8c.html#a840abeaeb2ccc5dca63e7acfeed7ca87">DEFAULT_FAX_MAX_DATAGRAM</a>;
<a name="l00892"></a>00892    } <span class="keywordflow">else</span> {
<a name="l00893"></a>00893       udptl-&gt;<a class="code" href="structast__udptl.html#a57bdb7e31fa5ba4d3f96658d472e5b94">far_max_datagram</a> = max_datagram;
<a name="l00894"></a>00894    }
<a name="l00895"></a>00895    <span class="comment">/* reset calculated values so they&apos;ll be computed again */</span>
<a name="l00896"></a>00896    udptl-&gt;<a class="code" href="structast__udptl.html#a95f0114a9c3434fbe3743868a613480b">far_max_ifp</a> = -1;
<a name="l00897"></a>00897 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6c2d98f9407493efbbdc9462717a2d9d"></a><!-- doxytag: member="udptl.c::ast_udptl_set_local_max_ifp" ref="a6c2d98f9407493efbbdc9462717a2d9d" args="(struct ast_udptl *udptl, unsigned int max_ifp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_udptl_set_local_max_ifp </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>max_ifp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00864">864</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00157">ast_udptl::local_max_datagram</a>, and <a class="el" href="udptl_8c_source.html#l00171">ast_udptl::local_max_ifp</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l06424">interpret_t38_parameters()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00865"></a>00865 {
<a name="l00866"></a>00866    <span class="comment">/* make sure max_ifp is a positive value since a cast will take place when</span>
<a name="l00867"></a>00867 <span class="comment">    * when setting local_max_ifp */</span>
<a name="l00868"></a>00868    <span class="keywordflow">if</span> ((<span class="keywordtype">signed</span> <span class="keywordtype">int</span>) max_ifp &gt; 0) {
<a name="l00869"></a>00869       udptl-&gt;<a class="code" href="structast__udptl.html#a832188d785b133f8195c9c74de833141">local_max_ifp</a> = max_ifp;
<a name="l00870"></a>00870       <span class="comment">/* reset calculated values so they&apos;ll be computed again */</span>
<a name="l00871"></a>00871       udptl-&gt;<a class="code" href="structast__udptl.html#aa6de52220e98717c22a45506d1aad1eb">local_max_datagram</a> = -1;
<a name="l00872"></a>00872    }
<a name="l00873"></a>00873 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa610b69fe43ec50c49d39e8613e07a14"></a><!-- doxytag: member="udptl.c::ast_udptl_set_peer" ref="aa610b69fe43ec50c49d39e8613e07a14" args="(struct ast_udptl *udptl, const struct sockaddr_in *them)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_udptl_set_peer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>them</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l01024">1024</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00125">ast_udptl::them</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l08040">process_sdp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01025"></a>01025 {
<a name="l01026"></a>01026    udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port = them-&gt;sin_port;
<a name="l01027"></a>01027    udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr = them-&gt;sin_addr;
<a name="l01028"></a>01028 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a697d541fd523e36f898d699cbfda988f"></a><!-- doxytag: member="udptl.c::ast_udptl_set_tag" ref="a697d541fd523e36f898d699cbfda988f" args="(struct ast_udptl *udptl, const char *format,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_udptl_set_tag </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>...</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Associates a character string 'tag' with a UDPTL session. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>udptl</em>&nbsp;</td><td>The UDPTL session. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>format</em>&nbsp;</td><td>printf-style format string used to construct the tag</td></tr>
  </table>
  </dd>
</dl>
<p>This function <a class="el" href="structformats.html">formats</a> a tag for the specified UDPTL session, so that any log messages generated by the UDPTL stack related to that session will include the tag and the reader of the messages will be able to identify which endpoint caused them to be generated.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>none</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="udptl_8c_source.html#l01004">1004</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="astmm_8h_source.html#l00117">ast_vasprintf</a>, and <a class="el" href="udptl_8c_source.html#l00130">ast_udptl::tag</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l05019">change_t38_state()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01005"></a>01005 {
<a name="l01006"></a>01006    va_list ap;
<a name="l01007"></a>01007 
<a name="l01008"></a>01008    <span class="keywordflow">if</span> (udptl-&gt;<a class="code" href="structast__udptl.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a>) {
<a name="l01009"></a>01009       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(udptl-&gt;<a class="code" href="structast__udptl.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a>);
<a name="l01010"></a>01010       udptl-&gt;<a class="code" href="structast__udptl.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a> = NULL;
<a name="l01011"></a>01011    }
<a name="l01012"></a>01012    va_start(ap, <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>);
<a name="l01013"></a>01013    <span class="keywordflow">if</span> (<a class="code" href="astmm_8h.html#a5a4c348a0a93c313c8463d4756e86270">ast_vasprintf</a>(&amp;udptl-&gt;<a class="code" href="structast__udptl.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a>, <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>, ap) == -1) {
<a name="l01014"></a>01014       udptl-&gt;<a class="code" href="structast__udptl.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a> = NULL;
<a name="l01015"></a>01015    }
<a name="l01016"></a>01016    va_end(ap);
<a name="l01017"></a>01017 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a76d8051a97100fa917b8c43bf58aac9c"></a><!-- doxytag: member="udptl.c::ast_udptl_setnat" ref="a76d8051a97100fa917b8c43bf58aac9c" args="(struct ast_udptl *udptl, int nat)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_udptl_setnat </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nat</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00655">655</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00122">ast_udptl::nat</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l04996">do_setnat()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00656"></a>00656 {
<a name="l00657"></a>00657    udptl-&gt;<a class="code" href="structast__udptl.html#ada540a5f25f7302dc1a3d17ccfa59b10">nat</a> = <a class="code" href="chan__mgcp_8c.html#ada540a5f25f7302dc1a3d17ccfa59b10">nat</a>;
<a name="l00658"></a>00658 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa37b040d6f8a975f25022e73e125b99e"></a><!-- doxytag: member="udptl.c::ast_udptl_setqos" ref="aa37b040d6f8a975f25022e73e125b99e" args="(struct ast_udptl *udptl, unsigned int tos, unsigned int cos)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_udptl_setqos </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>tos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>cos</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l01019">1019</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="netsock_8c_source.html#l00154">ast_netsock_set_qos()</a>, and <a class="el" href="udptl_8c_source.html#l00117">ast_udptl::fd</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l07151">sip_alloc()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01020"></a>01020 {
<a name="l01021"></a>01021    <span class="keywordflow">return</span> <a class="code" href="netsock_8h.html#aef64bf03f17c3251f549b08b6620bc24">ast_netsock_set_qos</a>(udptl-&gt;<a class="code" href="structast__udptl.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <a class="code" href="chan__h323_8c.html#a25a9305efab3b493ca2519562fcec3d5">tos</a>, <a class="code" href="chan__h323_8c.html#ae91dad65f553f7afebe4af507803bc7f">cos</a>, <span class="stringliteral">&quot;UDPTL&quot;</span>);
<a name="l01022"></a>01022 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3fb4dcecfa292b0aae4fd4dbad1b8551"></a><!-- doxytag: member="udptl.c::ast_udptl_stop" ref="a3fb4dcecfa292b0aae4fd4dbad1b8551" args="(struct ast_udptl *udptl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_udptl_stop </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l01043">1043</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00125">ast_udptl::them</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l08040">process_sdp()</a>, and <a class="el" href="chan__sip_8c_source.html#l18253">stop_media_flows()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01044"></a>01044 {
<a name="l01045"></a>01045    memset(&amp;udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr, 0, <span class="keyword">sizeof</span>(udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr));
<a name="l01046"></a>01046    memset(&amp;udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port, 0, <span class="keyword">sizeof</span>(udptl-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port));
<a name="l01047"></a>01047 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5c5bda796bcae234c457fb56fb106b0b"></a><!-- doxytag: member="udptl.c::ast_udptl_write" ref="a5c5bda796bcae234c457fb56fb106b0b" args="(struct ast_udptl *s, struct ast_frame *f)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_udptl_write </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td>
          <td class="paramname"> <em>f</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l01060">1060</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00120">AST_FRAME_MODEM</a>, <a class="el" href="utils_8c_source.html#l00431">ast_inet_ntoa()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="frame_8h_source.html#l00215">AST_MODEM_T38</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="adsistub_8c_source.html#l00059">buf</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="frame_8h_source.html#l00147">ast_frame::datalen</a>, <a class="el" href="udptl_8c_source.html#l00094">DEFAULT_FAX_MAX_DATAGRAM</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="udptl_8c_source.html#l00151">ast_udptl::far_max_datagram</a>, <a class="el" href="udptl_8c_source.html#l00165">ast_udptl::far_max_ifp</a>, <a class="el" href="udptl_8c_source.html#l00117">ast_udptl::fd</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="func__strings_8c_source.html#l00821">len()</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="udptl_8c_source.html#l00080">LOG_TAG</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::ptr</a>, <a class="el" href="app__sms_8c_source.html#l00114">seq</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, <a class="el" href="udptl_8c_source.html#l00125">ast_udptl::them</a>, <a class="el" href="udptl_8c_source.html#l00177">ast_udptl::tx_seq_no</a>, <a class="el" href="udptl_8c_source.html#l00526">udptl_build_packet()</a>, and <a class="el" href="udptl_8c_source.html#l00187">udptl_debug_test_addr()</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l06207">sip_write()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01061"></a>01061 {
<a name="l01062"></a>01062    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="app__sms_8c.html#a8514112da88a5d13451aaf8c9b064017">seq</a>;
<a name="l01063"></a>01063    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> = f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>;
<a name="l01064"></a>01064    <span class="keywordtype">int</span> res;
<a name="l01065"></a>01065    <span class="comment">/* if no max datagram size is provided, use default value */</span>
<a name="l01066"></a>01066    <span class="keyword">const</span> <span class="keywordtype">int</span> bufsize = (s-&gt;<a class="code" href="structast__udptl.html#a57bdb7e31fa5ba4d3f96658d472e5b94">far_max_datagram</a> &gt; 0) ? s-&gt;<a class="code" href="structast__udptl.html#a57bdb7e31fa5ba4d3f96658d472e5b94">far_max_datagram</a> : <a class="code" href="udptl_8c.html#a840abeaeb2ccc5dca63e7acfeed7ca87">DEFAULT_FAX_MAX_DATAGRAM</a>;
<a name="l01067"></a>01067    uint8_t <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[bufsize];
<a name="l01068"></a>01068 
<a name="l01069"></a>01069    memset(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>));
<a name="l01070"></a>01070 
<a name="l01071"></a>01071    <span class="comment">/* If we have no peer, return immediately */</span> 
<a name="l01072"></a>01072    <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr.s_addr == INADDR_ANY)
<a name="l01073"></a>01073       <span class="keywordflow">return</span> 0;
<a name="l01074"></a>01074 
<a name="l01075"></a>01075    <span class="comment">/* If there is no data length, return immediately */</span>
<a name="l01076"></a>01076    <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> == 0)
<a name="l01077"></a>01077       <span class="keywordflow">return</span> 0;
<a name="l01078"></a>01078    
<a name="l01079"></a>01079    <span class="keywordflow">if</span> ((f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> != <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ad99b86353343f422bda01163898b2eea">AST_FRAME_MODEM</a>) ||
<a name="l01080"></a>01080        (f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> != <a class="code" href="frame_8h.html#a3a510e4e2673c6870ed5fe0f1eb53732">AST_MODEM_T38</a>)) {
<a name="l01081"></a>01081       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;(%s): UDPTL can only send T.38 data.\n&quot;</span>,
<a name="l01082"></a>01082          <a class="code" href="udptl_8c.html#a12f6e5fd71bc2bc7fcfc0583b035c862">LOG_TAG</a>(s));
<a name="l01083"></a>01083       <span class="keywordflow">return</span> -1;
<a name="l01084"></a>01084    }
<a name="l01085"></a>01085 
<a name="l01086"></a>01086    <span class="keywordflow">if</span> (len &gt; s-&gt;<a class="code" href="structast__udptl.html#a95f0114a9c3434fbe3743868a613480b">far_max_ifp</a>) {
<a name="l01087"></a>01087       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,
<a name="l01088"></a>01088          <span class="stringliteral">&quot;(%s): UDPTL asked to send %d bytes of IFP when far end only prepared to accept %d bytes; data loss will occur.&quot;</span>
<a name="l01089"></a>01089          <span class="stringliteral">&quot;You may need to override the T38FaxMaxDatagram value for this endpoint in the channel driver configuration.\n&quot;</span>,
<a name="l01090"></a>01090          <a class="code" href="udptl_8c.html#a12f6e5fd71bc2bc7fcfc0583b035c862">LOG_TAG</a>(s), len, s-&gt;<a class="code" href="structast__udptl.html#a95f0114a9c3434fbe3743868a613480b">far_max_ifp</a>);
<a name="l01091"></a>01091       len = s-&gt;<a class="code" href="structast__udptl.html#a95f0114a9c3434fbe3743868a613480b">far_max_ifp</a>;
<a name="l01092"></a>01092    }
<a name="l01093"></a>01093 
<a name="l01094"></a>01094    <span class="comment">/* Save seq_no for debug output because udptl_build_packet increments it */</span>
<a name="l01095"></a>01095    seq = s-&gt;<a class="code" href="structast__udptl.html#a0224da9d658e4e4ea2981d7ca7860aa3">tx_seq_no</a> &amp; 0xFFFF;
<a name="l01096"></a>01096 
<a name="l01097"></a>01097    <span class="comment">/* Cook up the UDPTL packet, with the relevant EC info. */</span>
<a name="l01098"></a>01098    len = <a class="code" href="udptl_8c.html#ad2ff9341ea549b0679a80c409637228c">udptl_build_packet</a>(s, <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <span class="keyword">sizeof</span>(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>), f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, len);
<a name="l01099"></a>01099 
<a name="l01100"></a>01100    <span class="keywordflow">if</span> (len &gt; 0 &amp;&amp; s-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port &amp;&amp; s-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr.s_addr) {
<a name="l01101"></a>01101       <span class="keywordflow">if</span> ((res = sendto(s-&gt;<a class="code" href="structast__udptl.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, len, 0, (<span class="keyword">struct</span> sockaddr *) &amp;s-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>, <span class="keyword">sizeof</span>(s-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>))) &lt; 0)
<a name="l01102"></a>01102          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;(%s): UDPTL Transmission error to %s:%d: %s\n&quot;</span>,
<a name="l01103"></a>01103             <a class="code" href="udptl_8c.html#a12f6e5fd71bc2bc7fcfc0583b035c862">LOG_TAG</a>(s), <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(s-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr), ntohs(s-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port), strerror(errno));
<a name="l01104"></a>01104       <span class="keywordflow">if</span> (<a class="code" href="udptl_8c.html#a01d5961e9d1bf0c8c6244aee64a1ecf9">udptl_debug_test_addr</a>(&amp;s-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>))
<a name="l01105"></a>01105          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;UDPTL (%s): packet to %s:%d (type %d, seq %d, len %d)\n&quot;</span>,
<a name="l01106"></a>01106              <a class="code" href="udptl_8c.html#a12f6e5fd71bc2bc7fcfc0583b035c862">LOG_TAG</a>(s), <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(s-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_addr), ntohs(s-&gt;<a class="code" href="structast__udptl.html#aaf2178b155c6b17c2da143fb7e12eb78">them</a>.sin_port), 0, seq, len);
<a name="l01107"></a>01107    }
<a name="l01108"></a>01108       
<a name="l01109"></a>01109    <span class="keywordflow">return</span> 0;
<a name="l01110"></a>01110 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a541dbf72506ff6bead2d506613979e24"></a><!-- doxytag: member="udptl.c::calculate_far_max_ifp" ref="a541dbf72506ff6bead2d506613979e24" args="(struct ast_udptl *udptl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void calculate_far_max_ifp </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00763">763</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="udptl_8c_source.html#l00141">ast_udptl::error_correction_entries</a>, <a class="el" href="udptl_8c_source.html#l00136">ast_udptl::error_correction_scheme</a>, <a class="el" href="udptl_8c_source.html#l00151">ast_udptl::far_max_datagram</a>, <a class="el" href="udptl_8c_source.html#l00165">ast_udptl::far_max_ifp</a>, <a class="el" href="udptl_8c_source.html#l00080">LOG_TAG</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="udptl_8h_source.html#l00038">UDPTL_ERROR_CORRECTION_FEC</a>, <a class="el" href="udptl_8h_source.html#l00037">UDPTL_ERROR_CORRECTION_NONE</a>, and <a class="el" href="udptl_8h_source.html#l00039">UDPTL_ERROR_CORRECTION_REDUNDANCY</a>.</p>

<p>Referenced by <a class="el" href="udptl_8c_source.html#l00907">ast_udptl_get_far_max_ifp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00764"></a>00764 {
<a name="l00765"></a>00765    <span class="keywordtype">unsigned</span> new_max = 0;
<a name="l00766"></a>00766 
<a name="l00767"></a>00767    <span class="keywordflow">if</span> (udptl-&gt;<a class="code" href="structast__udptl.html#a57bdb7e31fa5ba4d3f96658d472e5b94">far_max_datagram</a> == -1) {
<a name="l00768"></a>00768       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;(%s): Cannot calculate far_max_ifp before far_max_datagram has been set.\n&quot;</span>,
<a name="l00769"></a>00769          <a class="code" href="udptl_8c.html#a12f6e5fd71bc2bc7fcfc0583b035c862">LOG_TAG</a>(udptl));
<a name="l00770"></a>00770       udptl-&gt;<a class="code" href="structast__udptl.html#a95f0114a9c3434fbe3743868a613480b">far_max_ifp</a> = -1;
<a name="l00771"></a>00771       <span class="keywordflow">return</span>;
<a name="l00772"></a>00772    }
<a name="l00773"></a>00773 
<a name="l00774"></a>00774    <span class="comment">/* the goal here is to supply the local endpoint (application</span>
<a name="l00775"></a>00775 <span class="comment">    * or bridged channel) a maximum IFP value that will allow it</span>
<a name="l00776"></a>00776 <span class="comment">    * to effectively and efficiently transfer image data at its</span>
<a name="l00777"></a>00777 <span class="comment">    * selected bit rate, taking into account the selected error</span>
<a name="l00778"></a>00778 <span class="comment">    * correction mode, but without overrunning the far endpoint&apos;s</span>
<a name="l00779"></a>00779 <span class="comment">    * datagram buffer. this is complicated by the fact that some</span>
<a name="l00780"></a>00780 <span class="comment">    * far endpoints send us bogus (small) max datagram values,</span>
<a name="l00781"></a>00781 <span class="comment">    * which would result in either buffer overrun or no error</span>
<a name="l00782"></a>00782 <span class="comment">    * correction. we try to accomodate those, but if the supplied</span>
<a name="l00783"></a>00783 <span class="comment">    * value is too small to do so, we&apos;ll emit warning messages and</span>
<a name="l00784"></a>00784 <span class="comment">    * the user will have to use configuration options to override</span>
<a name="l00785"></a>00785 <span class="comment">    * the max datagram value supplied by the far endpoint.</span>
<a name="l00786"></a>00786 <span class="comment">    */</span>
<a name="l00787"></a>00787    <span class="keywordflow">switch</span> (udptl-&gt;<a class="code" href="structast__udptl.html#ac215dbaf54319e257d2c33ecd70c36c5">error_correction_scheme</a>) {
<a name="l00788"></a>00788    <span class="keywordflow">case</span> <a class="code" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795afa83e5a16b5198b5d34543cb94114cd6">UDPTL_ERROR_CORRECTION_NONE</a>:
<a name="l00789"></a>00789       <span class="comment">/* need room for sequence number, length indicator, redundancy</span>
<a name="l00790"></a>00790 <span class="comment">       * indicator and following length indicator</span>
<a name="l00791"></a>00791 <span class="comment">       */</span>
<a name="l00792"></a>00792       new_max = udptl-&gt;<a class="code" href="structast__udptl.html#a57bdb7e31fa5ba4d3f96658d472e5b94">far_max_datagram</a> - 5;
<a name="l00793"></a>00793       <span class="keywordflow">break</span>;
<a name="l00794"></a>00794    <span class="keywordflow">case</span> <a class="code" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795afbc322f60eade115e42b66d4ab4dec83">UDPTL_ERROR_CORRECTION_REDUNDANCY</a>:
<a name="l00795"></a>00795       <span class="comment">/* for this case, we&apos;d like to send as many error correction entries</span>
<a name="l00796"></a>00796 <span class="comment">       * as possible (up to the number we&apos;re configured for), but we&apos;ll settle</span>
<a name="l00797"></a>00797 <span class="comment">       * for sending fewer if the configured number would cause the</span>
<a name="l00798"></a>00798 <span class="comment">       * calculated max IFP to be too small for effective operation</span>
<a name="l00799"></a>00799 <span class="comment">       *</span>
<a name="l00800"></a>00800 <span class="comment">       * need room for sequence number, length indicators and the</span>
<a name="l00801"></a>00801 <span class="comment">       * configured number of redundant packets</span>
<a name="l00802"></a>00802 <span class="comment">       *</span>
<a name="l00803"></a>00803 <span class="comment">       * note: we purposely don&apos;t allow error_correction_entries to drop to</span>
<a name="l00804"></a>00804 <span class="comment">       * zero in this loop; we&apos;d rather send smaller IFPs (and thus reduce</span>
<a name="l00805"></a>00805 <span class="comment">       * the image data transfer rate) than sacrifice redundancy completely</span>
<a name="l00806"></a>00806 <span class="comment">       */</span>
<a name="l00807"></a>00807       <span class="keywordflow">for</span> (;;) {
<a name="l00808"></a>00808          new_max = (udptl-&gt;<a class="code" href="structast__udptl.html#a57bdb7e31fa5ba4d3f96658d472e5b94">far_max_datagram</a> - 8) / (udptl-&gt;<a class="code" href="structast__udptl.html#a53a056eca513e58ba0819110f0e62bc8">error_correction_entries</a> + 1);
<a name="l00809"></a>00809 
<a name="l00810"></a>00810          <span class="keywordflow">if</span> ((new_max &lt; 80) &amp;&amp; (udptl-&gt;<a class="code" href="structast__udptl.html#a53a056eca513e58ba0819110f0e62bc8">error_correction_entries</a> &gt; 1)) {
<a name="l00811"></a>00811             <span class="comment">/* the max ifp is not large enough, subtract an</span>
<a name="l00812"></a>00812 <span class="comment">             * error correction entry and calculate again</span>
<a name="l00813"></a>00813 <span class="comment">             * */</span>
<a name="l00814"></a>00814             --udptl-&gt;<a class="code" href="structast__udptl.html#a53a056eca513e58ba0819110f0e62bc8">error_correction_entries</a>;
<a name="l00815"></a>00815          } <span class="keywordflow">else</span> {
<a name="l00816"></a>00816             <span class="keywordflow">break</span>;
<a name="l00817"></a>00817          }
<a name="l00818"></a>00818       }
<a name="l00819"></a>00819       <span class="keywordflow">break</span>;
<a name="l00820"></a>00820    <span class="keywordflow">case</span> <a class="code" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795aa0e8972e48ad95a77cbe2c66e174fd76">UDPTL_ERROR_CORRECTION_FEC</a>:
<a name="l00821"></a>00821       <span class="comment">/* need room for sequence number, length indicators and a</span>
<a name="l00822"></a>00822 <span class="comment">       * a single IFP of the maximum size expected</span>
<a name="l00823"></a>00823 <span class="comment">       */</span>
<a name="l00824"></a>00824       new_max = (udptl-&gt;<a class="code" href="structast__udptl.html#a57bdb7e31fa5ba4d3f96658d472e5b94">far_max_datagram</a> - 10) / 2;
<a name="l00825"></a>00825       <span class="keywordflow">break</span>;
<a name="l00826"></a>00826    }
<a name="l00827"></a>00827    <span class="comment">/* subtract 5% of space for insurance */</span>
<a name="l00828"></a>00828    udptl-&gt;<a class="code" href="structast__udptl.html#a95f0114a9c3434fbe3743868a613480b">far_max_ifp</a> = new_max * 0.95;
<a name="l00829"></a>00829 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab3acebf54181c51340a4a3fa080525a8"></a><!-- doxytag: member="udptl.c::calculate_local_max_datagram" ref="ab3acebf54181c51340a4a3fa080525a8" args="(struct ast_udptl *udptl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void calculate_local_max_datagram </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00722">722</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="udptl_8c_source.html#l00136">ast_udptl::error_correction_scheme</a>, <a class="el" href="udptl_8c_source.html#l00093">LOCAL_FAX_MAX_DATAGRAM</a>, <a class="el" href="udptl_8c_source.html#l00157">ast_udptl::local_max_datagram</a>, <a class="el" href="udptl_8c_source.html#l00171">ast_udptl::local_max_ifp</a>, <a class="el" href="udptl_8c_source.html#l00080">LOG_TAG</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="utils_8h_source.html#l00224">MIN</a>, <a class="el" href="udptl_8h_source.html#l00038">UDPTL_ERROR_CORRECTION_FEC</a>, <a class="el" href="udptl_8h_source.html#l00037">UDPTL_ERROR_CORRECTION_NONE</a>, and <a class="el" href="udptl_8h_source.html#l00039">UDPTL_ERROR_CORRECTION_REDUNDANCY</a>.</p>

<p>Referenced by <a class="el" href="udptl_8c_source.html#l00875">ast_udptl_get_local_max_datagram()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00723"></a>00723 {
<a name="l00724"></a>00724    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> new_max = 0;
<a name="l00725"></a>00725 
<a name="l00726"></a>00726    <span class="keywordflow">if</span> (udptl-&gt;<a class="code" href="structast__udptl.html#a832188d785b133f8195c9c74de833141">local_max_ifp</a> == -1) {
<a name="l00727"></a>00727       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;(%s): Cannot calculate local_max_datagram before local_max_ifp has been set.\n&quot;</span>,
<a name="l00728"></a>00728          <a class="code" href="udptl_8c.html#a12f6e5fd71bc2bc7fcfc0583b035c862">LOG_TAG</a>(udptl));
<a name="l00729"></a>00729       udptl-&gt;<a class="code" href="structast__udptl.html#aa6de52220e98717c22a45506d1aad1eb">local_max_datagram</a> = -1;
<a name="l00730"></a>00730       <span class="keywordflow">return</span>;
<a name="l00731"></a>00731    }
<a name="l00732"></a>00732 
<a name="l00733"></a>00733    <span class="comment">/* calculate the amount of space required to receive an IFP</span>
<a name="l00734"></a>00734 <span class="comment">    * of the maximum size supported by the application/endpoint</span>
<a name="l00735"></a>00735 <span class="comment">    * that we are delivering them to (local endpoint), and add</span>
<a name="l00736"></a>00736 <span class="comment">    * the amount of space required to support the selected</span>
<a name="l00737"></a>00737 <span class="comment">    * error correction mode</span>
<a name="l00738"></a>00738 <span class="comment">    */</span>
<a name="l00739"></a>00739    <span class="keywordflow">switch</span> (udptl-&gt;<a class="code" href="structast__udptl.html#ac215dbaf54319e257d2c33ecd70c36c5">error_correction_scheme</a>) {
<a name="l00740"></a>00740    <span class="keywordflow">case</span> <a class="code" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795afa83e5a16b5198b5d34543cb94114cd6">UDPTL_ERROR_CORRECTION_NONE</a>:
<a name="l00741"></a>00741       <span class="comment">/* need room for sequence number, length indicator, redundancy</span>
<a name="l00742"></a>00742 <span class="comment">       * indicator and following length indicator</span>
<a name="l00743"></a>00743 <span class="comment">       */</span>
<a name="l00744"></a>00744       new_max = 5 + udptl-&gt;<a class="code" href="structast__udptl.html#a832188d785b133f8195c9c74de833141">local_max_ifp</a>;
<a name="l00745"></a>00745       <span class="keywordflow">break</span>;
<a name="l00746"></a>00746    <span class="keywordflow">case</span> <a class="code" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795afbc322f60eade115e42b66d4ab4dec83">UDPTL_ERROR_CORRECTION_REDUNDANCY</a>:
<a name="l00747"></a>00747       <span class="comment">/* need room for sequence number, length indicators, plus</span>
<a name="l00748"></a>00748 <span class="comment">       * room for up to 3 redundancy packets</span>
<a name="l00749"></a>00749 <span class="comment">       */</span>
<a name="l00750"></a>00750       new_max = 5 + udptl-&gt;<a class="code" href="structast__udptl.html#a832188d785b133f8195c9c74de833141">local_max_ifp</a> + 2 + (3 * udptl-&gt;<a class="code" href="structast__udptl.html#a832188d785b133f8195c9c74de833141">local_max_ifp</a>);
<a name="l00751"></a>00751       <span class="keywordflow">break</span>;
<a name="l00752"></a>00752    <span class="keywordflow">case</span> <a class="code" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795aa0e8972e48ad95a77cbe2c66e174fd76">UDPTL_ERROR_CORRECTION_FEC</a>:
<a name="l00753"></a>00753       <span class="comment">/* need room for sequence number, length indicators and a</span>
<a name="l00754"></a>00754 <span class="comment">       * a single IFP of the maximum size expected</span>
<a name="l00755"></a>00755 <span class="comment">       */</span>
<a name="l00756"></a>00756       new_max = 5 + udptl-&gt;<a class="code" href="structast__udptl.html#a832188d785b133f8195c9c74de833141">local_max_ifp</a> + 4 + udptl-&gt;<a class="code" href="structast__udptl.html#a832188d785b133f8195c9c74de833141">local_max_ifp</a>;
<a name="l00757"></a>00757       <span class="keywordflow">break</span>;
<a name="l00758"></a>00758    }
<a name="l00759"></a>00759    <span class="comment">/* add 5% extra space for insurance, but no larger than LOCAL_FAX_MAX_DATAGRAM */</span>
<a name="l00760"></a>00760    udptl-&gt;<a class="code" href="structast__udptl.html#aa6de52220e98717c22a45506d1aad1eb">local_max_datagram</a> = <a class="code" href="utils_8h.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(new_max * 1.05, <a class="code" href="udptl_8c.html#a7cebef58b6e2f580a8e74b7c133cd34b">LOCAL_FAX_MAX_DATAGRAM</a>);
<a name="l00761"></a>00761 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae31d7a712ec76b9ee8515efecca0cc07"></a><!-- doxytag: member="udptl.c::decode_length" ref="ae31d7a712ec76b9ee8515efecca0cc07" args="(uint8_t *buf, unsigned int limit, unsigned int *len, unsigned int *pvalue)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int decode_length </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>limit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&nbsp;</td>
          <td class="paramname"> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&nbsp;</td>
          <td class="paramname"> <em>pvalue</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00200">200</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>Referenced by <a class="el" href="udptl_8c_source.html#l00225">decode_open_type()</a>, and <a class="el" href="udptl_8c_source.html#l00318">udptl_rx_packet()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00201"></a>00201 {
<a name="l00202"></a>00202    <span class="keywordflow">if</span> (*<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> &gt;= limit)
<a name="l00203"></a>00203       <span class="keywordflow">return</span> -1;
<a name="l00204"></a>00204    <span class="keywordflow">if</span> ((<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[*<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>] &amp; 0x80) == 0) {
<a name="l00205"></a>00205       *pvalue = <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[*<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>];
<a name="l00206"></a>00206       (*len)++;
<a name="l00207"></a>00207       <span class="keywordflow">return</span> 0;
<a name="l00208"></a>00208    }
<a name="l00209"></a>00209    <span class="keywordflow">if</span> ((<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[*<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>] &amp; 0x40) == 0) {
<a name="l00210"></a>00210       <span class="keywordflow">if</span> (*<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> == limit - 1)
<a name="l00211"></a>00211          <span class="keywordflow">return</span> -1;
<a name="l00212"></a>00212       *pvalue = (<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[*<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>] &amp; 0x3F) &lt;&lt; 8;
<a name="l00213"></a>00213       (*len)++;
<a name="l00214"></a>00214       *pvalue |= <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[*<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>];
<a name="l00215"></a>00215       (*len)++;
<a name="l00216"></a>00216       <span class="keywordflow">return</span> 0;
<a name="l00217"></a>00217    }
<a name="l00218"></a>00218    *pvalue = (<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[*<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>] &amp; 0x3F) &lt;&lt; 14;
<a name="l00219"></a>00219    (*len)++;
<a name="l00220"></a>00220    <span class="comment">/* Indicate we have a fragment */</span>
<a name="l00221"></a>00221    <span class="keywordflow">return</span> 1;
<a name="l00222"></a>00222 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acad8de64155e849783a598df19ce849c"></a><!-- doxytag: member="udptl.c::decode_open_type" ref="acad8de64155e849783a598df19ce849c" args="(uint8_t *buf, unsigned int limit, unsigned int *len, const uint8_t **p_object, unsigned int *p_num_octets)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int decode_open_type </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>limit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&nbsp;</td>
          <td class="paramname"> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t **&nbsp;</td>
          <td class="paramname"> <em>p_object</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&nbsp;</td>
          <td class="paramname"> <em>p_num_octets</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00225">225</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00200">decode_length()</a>.</p>

<p>Referenced by <a class="el" href="udptl_8c_source.html#l00318">udptl_rx_packet()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00226"></a>00226 {
<a name="l00227"></a>00227    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> octet_cnt;
<a name="l00228"></a>00228    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> octet_idx;
<a name="l00229"></a>00229    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> length;
<a name="l00230"></a>00230    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
<a name="l00231"></a>00231    <span class="keyword">const</span> uint8_t **pbuf;
<a name="l00232"></a>00232 
<a name="l00233"></a>00233    <span class="keywordflow">for</span> (octet_idx = 0, *p_num_octets = 0; ; octet_idx += octet_cnt) {
<a name="l00234"></a>00234       octet_cnt = 0;
<a name="l00235"></a>00235       <span class="keywordflow">if</span> ((length = <a class="code" href="udptl_8c.html#ae31d7a712ec76b9ee8515efecca0cc07">decode_length</a>(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, limit, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, &amp;octet_cnt)) &lt; 0)
<a name="l00236"></a>00236          <span class="keywordflow">return</span> -1;
<a name="l00237"></a>00237       <span class="keywordflow">if</span> (octet_cnt &gt; 0) {
<a name="l00238"></a>00238          *p_num_octets += octet_cnt;
<a name="l00239"></a>00239 
<a name="l00240"></a>00240          pbuf = &amp;p_object[octet_idx];
<a name="l00241"></a>00241          i = 0;
<a name="l00242"></a>00242          <span class="comment">/* Make sure the buffer contains at least the number of bits requested */</span>
<a name="l00243"></a>00243          <span class="keywordflow">if</span> ((*<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> + octet_cnt) &gt; limit)
<a name="l00244"></a>00244             <span class="keywordflow">return</span> -1;
<a name="l00245"></a>00245 
<a name="l00246"></a>00246          *pbuf = &amp;<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[*<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>];
<a name="l00247"></a>00247          *<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> += octet_cnt;
<a name="l00248"></a>00248       }
<a name="l00249"></a>00249       <span class="keywordflow">if</span> (length == 0)
<a name="l00250"></a>00250          <span class="keywordflow">break</span>;
<a name="l00251"></a>00251    }
<a name="l00252"></a>00252    <span class="keywordflow">return</span> 0;
<a name="l00253"></a>00253 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6c54931735c591c100df527a9e0936e1"></a><!-- doxytag: member="udptl.c::encode_length" ref="a6c54931735c591c100df527a9e0936e1" args="(uint8_t *buf, unsigned int *len, unsigned int value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static unsigned int encode_length </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&nbsp;</td>
          <td class="paramname"> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>value</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00256">256</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>Referenced by <a class="el" href="udptl_8c_source.html#l00284">encode_open_type()</a>, and <a class="el" href="udptl_8c_source.html#l00526">udptl_build_packet()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00257"></a>00257 {
<a name="l00258"></a>00258    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> multiplier;
<a name="l00259"></a>00259 
<a name="l00260"></a>00260    <span class="keywordflow">if</span> (value &lt; 0x80) {
<a name="l00261"></a>00261       <span class="comment">/* 1 octet */</span>
<a name="l00262"></a>00262       <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[*<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>] = value;
<a name="l00263"></a>00263       (*len)++;
<a name="l00264"></a>00264       <span class="keywordflow">return</span> value;
<a name="l00265"></a>00265    }
<a name="l00266"></a>00266    <span class="keywordflow">if</span> (value &lt; 0x4000) {
<a name="l00267"></a>00267       <span class="comment">/* 2 octets */</span>
<a name="l00268"></a>00268       <span class="comment">/* Set the first bit of the first octet */</span>
<a name="l00269"></a>00269       <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[*<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>] = ((0x8000 | value) &gt;&gt; 8) &amp; 0xFF;
<a name="l00270"></a>00270       (*len)++;
<a name="l00271"></a>00271       <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[*<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>] = value &amp; 0xFF;
<a name="l00272"></a>00272       (*len)++;
<a name="l00273"></a>00273       <span class="keywordflow">return</span> value;
<a name="l00274"></a>00274    }
<a name="l00275"></a>00275    <span class="comment">/* Fragmentation */</span>
<a name="l00276"></a>00276    multiplier = (value &lt; 0x10000) ? (value &gt;&gt; 14) : 4;
<a name="l00277"></a>00277    <span class="comment">/* Set the first 2 bits of the octet */</span>
<a name="l00278"></a>00278    <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[*<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>] = 0xC0 | multiplier;
<a name="l00279"></a>00279    (*len)++;
<a name="l00280"></a>00280    <span class="keywordflow">return</span> multiplier &lt;&lt; 14;
<a name="l00281"></a>00281 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a139e3cb1abd258f2bd35a94b6573ca2c"></a><!-- doxytag: member="udptl.c::encode_open_type" ref="a139e3cb1abd258f2bd35a94b6573ca2c" args="(const struct ast_udptl *udptl, uint8_t *buf, unsigned int buflen, unsigned int *len, const uint8_t *data, unsigned int num_octets)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int encode_open_type </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>udptl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>buflen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&nbsp;</td>
          <td class="paramname"> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>num_octets</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00284">284</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="udptl_8c_source.html#l00256">encode_length()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, and <a class="el" href="udptl_8c_source.html#l00080">LOG_TAG</a>.</p>

<p>Referenced by <a class="el" href="udptl_8c_source.html#l00526">udptl_build_packet()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00286"></a>00286 {
<a name="l00287"></a>00287    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> enclen;
<a name="l00288"></a>00288    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> octet_idx;
<a name="l00289"></a>00289    uint8_t zero_byte;
<a name="l00290"></a>00290 
<a name="l00291"></a>00291    <span class="comment">/* If open type is of zero length, add a single zero byte (10.1) */</span>
<a name="l00292"></a>00292    <span class="keywordflow">if</span> (num_octets == 0) {
<a name="l00293"></a>00293       zero_byte = 0;
<a name="l00294"></a>00294       data = &amp;zero_byte;
<a name="l00295"></a>00295       num_octets = 1;
<a name="l00296"></a>00296    }
<a name="l00297"></a>00297    <span class="comment">/* Encode the open type */</span>
<a name="l00298"></a>00298    <span class="keywordflow">for</span> (octet_idx = 0; ; num_octets -= enclen, octet_idx += enclen) {
<a name="l00299"></a>00299       <span class="keywordflow">if</span> ((enclen = <a class="code" href="udptl_8c.html#a6c54931735c591c100df527a9e0936e1">encode_length</a>(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, num_octets)) &lt; 0)
<a name="l00300"></a>00300          <span class="keywordflow">return</span> -1;
<a name="l00301"></a>00301       <span class="keywordflow">if</span> (enclen + *<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> &gt; buflen) {
<a name="l00302"></a>00302          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;(%s): Buffer overflow detected (%d + %d &gt; %d)\n&quot;</span>,
<a name="l00303"></a>00303             <a class="code" href="udptl_8c.html#a12f6e5fd71bc2bc7fcfc0583b035c862">LOG_TAG</a>(udptl), enclen, *<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, buflen);
<a name="l00304"></a>00304          <span class="keywordflow">return</span> -1;
<a name="l00305"></a>00305       }
<a name="l00306"></a>00306       <span class="keywordflow">if</span> (enclen &gt; 0) {
<a name="l00307"></a>00307          memcpy(&amp;<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[*<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>], &amp;data[octet_idx], enclen);
<a name="l00308"></a>00308          *<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> += enclen;
<a name="l00309"></a>00309       }
<a name="l00310"></a>00310       <span class="keywordflow">if</span> (enclen &gt;= num_octets)
<a name="l00311"></a>00311          <span class="keywordflow">break</span>;
<a name="l00312"></a>00312    }
<a name="l00313"></a>00313 
<a name="l00314"></a>00314    <span class="keywordflow">return</span> 0;
<a name="l00315"></a>00315 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a81bfe3abc4b0e393b4d6f7570c1f18bf"></a><!-- doxytag: member="udptl.c::get_proto" ref="a81bfe3abc4b0e393b4d6f7570c1f18bf" args="(struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__udptl__protocol.html">ast_udptl_protocol</a>* get_proto </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l01136">1136</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00077">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="structast__udptl__protocol.html#ad9b85bd971cfb2b646be8afa37d584f3">ast_udptl_protocol::list</a>, <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>, <a class="el" href="channel_8h_source.html#l00226">ast_channel_tech::type</a>, and <a class="el" href="udptl_8h_source.html#l00051">ast_udptl_protocol::type</a>.</p>

<p>Referenced by <a class="el" href="udptl_8c_source.html#l01150">ast_udptl_bridge()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01137"></a>01137 {
<a name="l01138"></a>01138    <span class="keyword">struct </span><a class="code" href="structast__udptl__protocol.html">ast_udptl_protocol</a> *cur = NULL;
<a name="l01139"></a>01139 
<a name="l01140"></a>01140    <a class="code" href="linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc" title="Read locks a list.">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="structprotos.html" title="List of current sessions.">protos</a>);
<a name="l01141"></a>01141    <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="structprotos.html" title="List of current sessions.">protos</a>, cur, <a class="code" href="structast__udptl__protocol.html#ad9b85bd971cfb2b646be8afa37d584f3">list</a>) {
<a name="l01142"></a>01142       <span class="keywordflow">if</span> (cur-&gt;<a class="code" href="structast__udptl__protocol.html#a8ff938fb2f815be425fd2859a21e6d61">type</a> == chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>)
<a name="l01143"></a>01143          <span class="keywordflow">break</span>;
<a name="l01144"></a>01144    }
<a name="l01145"></a>01145    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structprotos.html" title="List of current sessions.">protos</a>);
<a name="l01146"></a>01146 
<a name="l01147"></a>01147    <span class="keywordflow">return</span> cur;
<a name="l01148"></a>01148 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9b115851b62ac2f257cabce0cee1f67e"></a><!-- doxytag: member="udptl.c::handle_cli_udptl_set_debug" ref="a9b115851b62ac2f257cabce0cee1f67e" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_cli_udptl_set_debug </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l01275">1275</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="utils_8c_source.html#l00182">ast_gethostbyname()</a>, <a class="el" href="utils_8c_source.html#l00431">ast_inet_ntoa()</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="chan__skinny_8c_source.html#l00982">hp</a>, <a class="el" href="udptl_8c_source.html#l00085">udptldebugaddr</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01276"></a>01276 {
<a name="l01277"></a>01277    <span class="keyword">struct </span>hostent *<a class="code" href="chan__skinny_8c.html#aa0f575fa3882aa394cc287edba645a35">hp</a>;
<a name="l01278"></a>01278    <span class="keyword">struct </span><a class="code" href="structast__hostent.html">ast_hostent</a> <a class="code" href="chan__skinny_8c.html#a9e435aef83f14da6d3d5ec44f821558e">ahp</a>;
<a name="l01279"></a>01279    <span class="keywordtype">int</span> port;
<a name="l01280"></a>01280    <span class="keywordtype">char</span> *p;
<a name="l01281"></a>01281    <span class="keywordtype">char</span> *arg;
<a name="l01282"></a>01282 
<a name="l01283"></a>01283    <span class="keywordflow">switch</span> (cmd) {
<a name="l01284"></a>01284    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l01285"></a>01285       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;udptl set debug {on|off|ip}&quot;</span>;
<a name="l01286"></a>01286       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> = 
<a name="l01287"></a>01287          <span class="stringliteral">&quot;Usage: udptl set debug {on|off|ip host[:port]}\n&quot;</span>
<a name="l01288"></a>01288          <span class="stringliteral">&quot;       Enable or disable dumping of UDPTL packets.\n&quot;</span>
<a name="l01289"></a>01289          <span class="stringliteral">&quot;       If ip is specified, limit the dumped packets to those to and from\n&quot;</span>
<a name="l01290"></a>01290          <span class="stringliteral">&quot;       the specified &apos;host&apos; with optional port.\n&quot;</span>;
<a name="l01291"></a>01291       <span class="keywordflow">return</span> NULL;
<a name="l01292"></a>01292    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l01293"></a>01293       <span class="keywordflow">return</span> NULL;
<a name="l01294"></a>01294    }
<a name="l01295"></a>01295 
<a name="l01296"></a>01296    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> &lt; 4 || a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> &gt; 5)
<a name="l01297"></a>01297       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l01298"></a>01298 
<a name="l01299"></a>01299    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> == 4) {
<a name="l01300"></a>01300       <span class="keywordflow">if</span> (!strncasecmp(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3], <span class="stringliteral">&quot;on&quot;</span>, 2)) {
<a name="l01301"></a>01301          <a class="code" href="udptl_8c.html#ade9088978427552c6020fd7453eedb57">udptldebug</a> = 1;
<a name="l01302"></a>01302          memset(&amp;<a class="code" href="udptl_8c.html#a3e1327ae66b0837cebb4c734a9bdd3f5">udptldebugaddr</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="udptl_8c.html#a3e1327ae66b0837cebb4c734a9bdd3f5">udptldebugaddr</a>));
<a name="l01303"></a>01303          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;UDPTL Debugging Enabled\n&quot;</span>);
<a name="l01304"></a>01304       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncasecmp(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3], <span class="stringliteral">&quot;off&quot;</span>, 3)) {
<a name="l01305"></a>01305          <a class="code" href="udptl_8c.html#ade9088978427552c6020fd7453eedb57">udptldebug</a> = 0;
<a name="l01306"></a>01306          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;UDPTL Debugging Disabled\n&quot;</span>);
<a name="l01307"></a>01307       } <span class="keywordflow">else</span> {
<a name="l01308"></a>01308          <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l01309"></a>01309       }
<a name="l01310"></a>01310    } <span class="keywordflow">else</span> {
<a name="l01311"></a>01311       <span class="keywordflow">if</span> (strncasecmp(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3], <span class="stringliteral">&quot;ip&quot;</span>, 2))
<a name="l01312"></a>01312          <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l01313"></a>01313       port = 0;
<a name="l01314"></a>01314       arg = a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[4];
<a name="l01315"></a>01315       p = strstr(arg, <span class="stringliteral">&quot;:&quot;</span>);
<a name="l01316"></a>01316       <span class="keywordflow">if</span> (p) {
<a name="l01317"></a>01317          *p = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01318"></a>01318          p++;
<a name="l01319"></a>01319          port = atoi(p);
<a name="l01320"></a>01320       }
<a name="l01321"></a>01321       hp = <a class="code" href="utils_8h.html#ad3b63ee1041593219ef0765b28d70442" title="Thread-safe gethostbyname function to use in Asterisk.">ast_gethostbyname</a>(arg, &amp;<a class="code" href="chan__skinny_8c.html#a9e435aef83f14da6d3d5ec44f821558e">ahp</a>);
<a name="l01322"></a>01322       <span class="keywordflow">if</span> (hp == NULL)
<a name="l01323"></a>01323          <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l01324"></a>01324       <a class="code" href="udptl_8c.html#a3e1327ae66b0837cebb4c734a9bdd3f5">udptldebugaddr</a>.sin_family = AF_INET;
<a name="l01325"></a>01325       memcpy(&amp;<a class="code" href="udptl_8c.html#a3e1327ae66b0837cebb4c734a9bdd3f5">udptldebugaddr</a>.sin_addr, hp-&gt;h_addr, <span class="keyword">sizeof</span>(<a class="code" href="udptl_8c.html#a3e1327ae66b0837cebb4c734a9bdd3f5">udptldebugaddr</a>.sin_addr));
<a name="l01326"></a>01326       <a class="code" href="udptl_8c.html#a3e1327ae66b0837cebb4c734a9bdd3f5">udptldebugaddr</a>.sin_port = htons(port);
<a name="l01327"></a>01327       <span class="keywordflow">if</span> (port == 0)
<a name="l01328"></a>01328          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;UDPTL Debugging Enabled for IP: %s\n&quot;</span>, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(<a class="code" href="udptl_8c.html#a3e1327ae66b0837cebb4c734a9bdd3f5">udptldebugaddr</a>.sin_addr));
<a name="l01329"></a>01329       <span class="keywordflow">else</span>
<a name="l01330"></a>01330          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;UDPTL Debugging Enabled for IP: %s:%d\n&quot;</span>, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(<a class="code" href="udptl_8c.html#a3e1327ae66b0837cebb4c734a9bdd3f5">udptldebugaddr</a>.sin_addr), port);
<a name="l01331"></a>01331       <a class="code" href="udptl_8c.html#ade9088978427552c6020fd7453eedb57">udptldebug</a> = 1;
<a name="l01332"></a>01332    }
<a name="l01333"></a>01333 
<a name="l01334"></a>01334    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l01335"></a>01335 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad2ff9341ea549b0679a80c409637228c"></a><!-- doxytag: member="udptl.c::udptl_build_packet" ref="ad2ff9341ea549b0679a80c409637228c" args="(struct ast_udptl *s, uint8_t *buf, unsigned int buflen, uint8_t *ifp, unsigned int ifp_len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int udptl_build_packet </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>buflen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>ifp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>ifp_len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00526">526</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="udptl_8c_source.html#l00103">udptl_fec_tx_buffer_t::buf</a>, <a class="el" href="udptl_8c_source.html#l00102">udptl_fec_tx_buffer_t::buf_len</a>, <a class="el" href="udptl_8c_source.html#l00256">encode_length()</a>, <a class="el" href="udptl_8c_source.html#l00284">encode_open_type()</a>, <a class="el" href="udptl_8c_source.html#l00141">ast_udptl::error_correction_entries</a>, <a class="el" href="udptl_8c_source.html#l00136">ast_udptl::error_correction_scheme</a>, <a class="el" href="udptl_8c_source.html#l00146">ast_udptl::error_correction_span</a>, <a class="el" href="func__strings_8c_source.html#l00821">len()</a>, <a class="el" href="udptl_8c_source.html#l00093">LOCAL_FAX_MAX_DATAGRAM</a>, <a class="el" href="udptl_8c_source.html#l00080">LOG_TAG</a>, <a class="el" href="app__sms_8c_source.html#l00114">seq</a>, <a class="el" href="udptl_8c_source.html#l00181">ast_udptl::tx</a>, <a class="el" href="udptl_8c_source.html#l00177">ast_udptl::tx_seq_no</a>, <a class="el" href="udptl_8c_source.html#l00099">UDPTL_BUF_MASK</a>, <a class="el" href="udptl_8h_source.html#l00038">UDPTL_ERROR_CORRECTION_FEC</a>, <a class="el" href="udptl_8h_source.html#l00037">UDPTL_ERROR_CORRECTION_NONE</a>, <a class="el" href="udptl_8h_source.html#l00039">UDPTL_ERROR_CORRECTION_REDUNDANCY</a>, and <a class="el" href="udptl_8c_source.html#l00173">ast_udptl::verbose</a>.</p>

<p>Referenced by <a class="el" href="udptl_8c_source.html#l01060">ast_udptl_write()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00527"></a>00527 {
<a name="l00528"></a>00528    uint8_t fec[<a class="code" href="udptl_8c.html#a7cebef58b6e2f580a8e74b7c133cd34b">LOCAL_FAX_MAX_DATAGRAM</a> * 2];
<a name="l00529"></a>00529    <span class="keywordtype">int</span> i;
<a name="l00530"></a>00530    <span class="keywordtype">int</span> j;
<a name="l00531"></a>00531    <span class="keywordtype">int</span> <a class="code" href="app__sms_8c.html#a8514112da88a5d13451aaf8c9b064017">seq</a>;
<a name="l00532"></a>00532    <span class="keywordtype">int</span> entry;
<a name="l00533"></a>00533    <span class="keywordtype">int</span> entries;
<a name="l00534"></a>00534    <span class="keywordtype">int</span> span;
<a name="l00535"></a>00535    <span class="keywordtype">int</span> m;
<a name="l00536"></a>00536    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;
<a name="l00537"></a>00537    <span class="keywordtype">int</span> limit;
<a name="l00538"></a>00538    <span class="keywordtype">int</span> high_tide;
<a name="l00539"></a>00539 
<a name="l00540"></a>00540    seq = s-&gt;<a class="code" href="structast__udptl.html#a0224da9d658e4e4ea2981d7ca7860aa3">tx_seq_no</a> &amp; 0xFFFF;
<a name="l00541"></a>00541 
<a name="l00542"></a>00542    <span class="comment">/* Map the sequence number to an entry in the circular buffer */</span>
<a name="l00543"></a>00543    entry = seq &amp; <a class="code" href="udptl_8c.html#a5fc08f5f3152e66b9eb799375c8eafe5">UDPTL_BUF_MASK</a>;
<a name="l00544"></a>00544 
<a name="l00545"></a>00545    <span class="comment">/* We save the message in a circular buffer, for generating FEC or</span>
<a name="l00546"></a>00546 <span class="comment">      redundancy sets later on. */</span>
<a name="l00547"></a>00547    s-&gt;<a class="code" href="structast__udptl.html#af0c6829f8a5272ece732cd1ac1b3094a">tx</a>[entry].<a class="code" href="structudptl__fec__tx__buffer__t.html#a7666bbf00997cc13da27d55cb05d27c4">buf_len</a> = ifp_len;
<a name="l00548"></a>00548    memcpy(s-&gt;<a class="code" href="structast__udptl.html#af0c6829f8a5272ece732cd1ac1b3094a">tx</a>[entry].<a class="code" href="structudptl__fec__tx__buffer__t.html#adf280a92c2ded8d54991b3ae3cb97ccf">buf</a>, ifp, ifp_len);
<a name="l00549"></a>00549    
<a name="l00550"></a>00550    <span class="comment">/* Build the UDPTLPacket */</span>
<a name="l00551"></a>00551 
<a name="l00552"></a>00552    len = 0;
<a name="l00553"></a>00553    <span class="comment">/* Encode the sequence number */</span>
<a name="l00554"></a>00554    <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[len++] = (seq &gt;&gt; 8) &amp; 0xFF;
<a name="l00555"></a>00555    <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[len++] = seq &amp; 0xFF;
<a name="l00556"></a>00556 
<a name="l00557"></a>00557    <span class="comment">/* Encode the primary IFP packet */</span>
<a name="l00558"></a>00558    <span class="keywordflow">if</span> (<a class="code" href="udptl_8c.html#a139e3cb1abd258f2bd35a94b6573ca2c">encode_open_type</a>(s, <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, buflen, &amp;len, ifp, ifp_len) &lt; 0)
<a name="l00559"></a>00559       <span class="keywordflow">return</span> -1;
<a name="l00560"></a>00560 
<a name="l00561"></a>00561    <span class="comment">/* Encode the appropriate type of error recovery information */</span>
<a name="l00562"></a>00562    <span class="keywordflow">switch</span> (s-&gt;<a class="code" href="structast__udptl.html#ac215dbaf54319e257d2c33ecd70c36c5">error_correction_scheme</a>)
<a name="l00563"></a>00563    {
<a name="l00564"></a>00564    <span class="keywordflow">case</span> <a class="code" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795afa83e5a16b5198b5d34543cb94114cd6">UDPTL_ERROR_CORRECTION_NONE</a>:
<a name="l00565"></a>00565       <span class="comment">/* Encode the error recovery type */</span>
<a name="l00566"></a>00566       <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[len++] = 0x00;
<a name="l00567"></a>00567       <span class="comment">/* The number of entries will always be zero, so it is pointless allowing</span>
<a name="l00568"></a>00568 <span class="comment">         for the fragmented case here. */</span>
<a name="l00569"></a>00569       <span class="keywordflow">if</span> (<a class="code" href="udptl_8c.html#a6c54931735c591c100df527a9e0936e1">encode_length</a>(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, &amp;len, 0) &lt; 0)
<a name="l00570"></a>00570          <span class="keywordflow">return</span> -1;
<a name="l00571"></a>00571       <span class="keywordflow">break</span>;
<a name="l00572"></a>00572    <span class="keywordflow">case</span> <a class="code" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795afbc322f60eade115e42b66d4ab4dec83">UDPTL_ERROR_CORRECTION_REDUNDANCY</a>:
<a name="l00573"></a>00573       <span class="comment">/* Encode the error recovery type */</span>
<a name="l00574"></a>00574       <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[len++] = 0x00;
<a name="l00575"></a>00575       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structast__udptl.html#a0224da9d658e4e4ea2981d7ca7860aa3">tx_seq_no</a> &gt; s-&gt;<a class="code" href="structast__udptl.html#a53a056eca513e58ba0819110f0e62bc8">error_correction_entries</a>)
<a name="l00576"></a>00576          entries = s-&gt;<a class="code" href="structast__udptl.html#a53a056eca513e58ba0819110f0e62bc8">error_correction_entries</a>;
<a name="l00577"></a>00577       <span class="keywordflow">else</span>
<a name="l00578"></a>00578          entries = s-&gt;<a class="code" href="structast__udptl.html#a0224da9d658e4e4ea2981d7ca7860aa3">tx_seq_no</a>;
<a name="l00579"></a>00579       <span class="comment">/* The number of entries will always be small, so it is pointless allowing</span>
<a name="l00580"></a>00580 <span class="comment">         for the fragmented case here. */</span>
<a name="l00581"></a>00581       <span class="keywordflow">if</span> (<a class="code" href="udptl_8c.html#a6c54931735c591c100df527a9e0936e1">encode_length</a>(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, &amp;len, entries) &lt; 0)
<a name="l00582"></a>00582          <span class="keywordflow">return</span> -1;
<a name="l00583"></a>00583       <span class="comment">/* Encode the elements */</span>
<a name="l00584"></a>00584       <span class="keywordflow">for</span> (i = 0; i &lt; entries; i++) {
<a name="l00585"></a>00585          j = (entry - i - 1) &amp; UDPTL_BUF_MASK;
<a name="l00586"></a>00586          <span class="keywordflow">if</span> (<a class="code" href="udptl_8c.html#a139e3cb1abd258f2bd35a94b6573ca2c">encode_open_type</a>(s, <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, buflen, &amp;len, s-&gt;<a class="code" href="structast__udptl.html#af0c6829f8a5272ece732cd1ac1b3094a">tx</a>[j].<a class="code" href="structudptl__fec__tx__buffer__t.html#adf280a92c2ded8d54991b3ae3cb97ccf">buf</a>, s-&gt;<a class="code" href="structast__udptl.html#af0c6829f8a5272ece732cd1ac1b3094a">tx</a>[j].<a class="code" href="structudptl__fec__tx__buffer__t.html#a7666bbf00997cc13da27d55cb05d27c4">buf_len</a>) &lt; 0) {
<a name="l00587"></a>00587             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;(%s): Encoding failed at i=%d, j=%d\n&quot;</span>,
<a name="l00588"></a>00588                  <a class="code" href="udptl_8c.html#a12f6e5fd71bc2bc7fcfc0583b035c862">LOG_TAG</a>(s), i, j);
<a name="l00589"></a>00589             <span class="keywordflow">return</span> -1;
<a name="l00590"></a>00590          }
<a name="l00591"></a>00591       }
<a name="l00592"></a>00592       <span class="keywordflow">break</span>;
<a name="l00593"></a>00593    <span class="keywordflow">case</span> <a class="code" href="udptl_8h.html#af968992af6d7e1186843a2eb371c9795aa0e8972e48ad95a77cbe2c66e174fd76">UDPTL_ERROR_CORRECTION_FEC</a>:
<a name="l00594"></a>00594       span = s-&gt;<a class="code" href="structast__udptl.html#aa3ea4f55135ebfe86fb4d34b891fe618">error_correction_span</a>;
<a name="l00595"></a>00595       entries = s-&gt;<a class="code" href="structast__udptl.html#a53a056eca513e58ba0819110f0e62bc8">error_correction_entries</a>;
<a name="l00596"></a>00596       <span class="keywordflow">if</span> (seq &lt; s-&gt;error_correction_span*s-&gt;<a class="code" href="structast__udptl.html#a53a056eca513e58ba0819110f0e62bc8">error_correction_entries</a>) {
<a name="l00597"></a>00597          <span class="comment">/* In the initial stages, wind up the FEC smoothly */</span>
<a name="l00598"></a>00598          entries = seq/s-&gt;<a class="code" href="structast__udptl.html#aa3ea4f55135ebfe86fb4d34b891fe618">error_correction_span</a>;
<a name="l00599"></a>00599          <span class="keywordflow">if</span> (seq &lt; s-&gt;error_correction_span)
<a name="l00600"></a>00600             span = 0;
<a name="l00601"></a>00601       }
<a name="l00602"></a>00602       <span class="comment">/* Encode the error recovery type */</span>
<a name="l00603"></a>00603       <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[len++] = 0x80;
<a name="l00604"></a>00604       <span class="comment">/* Span is defined as an inconstrained integer, which it dumb. It will only</span>
<a name="l00605"></a>00605 <span class="comment">         ever be a small value. Treat it as such. */</span>
<a name="l00606"></a>00606       <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[len++] = 1;
<a name="l00607"></a>00607       <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[len++] = span;
<a name="l00608"></a>00608       <span class="comment">/* The number of entries is defined as a length, but will only ever be a small</span>
<a name="l00609"></a>00609 <span class="comment">         value. Treat it as such. */</span>
<a name="l00610"></a>00610       <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[len++] = entries;
<a name="l00611"></a>00611       <span class="keywordflow">for</span> (m = 0; m &lt; entries; m++) {
<a name="l00612"></a>00612          <span class="comment">/* Make an XOR&apos;ed entry the maximum length */</span>
<a name="l00613"></a>00613          limit = (entry + m) &amp; UDPTL_BUF_MASK;
<a name="l00614"></a>00614          high_tide = 0;
<a name="l00615"></a>00615          <span class="keywordflow">for</span> (i = (limit - span*entries) &amp; UDPTL_BUF_MASK; i != limit; i = (i + entries) &amp; UDPTL_BUF_MASK) {
<a name="l00616"></a>00616             <span class="keywordflow">if</span> (high_tide &lt; s-&gt;tx[i].buf_len) {
<a name="l00617"></a>00617                <span class="keywordflow">for</span> (j = 0; j &lt; high_tide; j++)
<a name="l00618"></a>00618                   fec[j] ^= s-&gt;<a class="code" href="structast__udptl.html#af0c6829f8a5272ece732cd1ac1b3094a">tx</a>[i].<a class="code" href="structudptl__fec__tx__buffer__t.html#adf280a92c2ded8d54991b3ae3cb97ccf">buf</a>[j];
<a name="l00619"></a>00619                for ( ; j &lt; s-&gt;<a class="code" href="structast__udptl.html#af0c6829f8a5272ece732cd1ac1b3094a">tx</a>[i].<a class="code" href="structudptl__fec__tx__buffer__t.html#a7666bbf00997cc13da27d55cb05d27c4">buf_len</a>; j++)
<a name="l00620"></a>00620                   fec[j] = s-&gt;<a class="code" href="structast__udptl.html#af0c6829f8a5272ece732cd1ac1b3094a">tx</a>[i].<a class="code" href="structudptl__fec__tx__buffer__t.html#adf280a92c2ded8d54991b3ae3cb97ccf">buf</a>[j];
<a name="l00621"></a>00621                high_tide = s-&gt;<a class="code" href="structast__udptl.html#af0c6829f8a5272ece732cd1ac1b3094a">tx</a>[i].<a class="code" href="structudptl__fec__tx__buffer__t.html#a7666bbf00997cc13da27d55cb05d27c4">buf_len</a>;
<a name="l00622"></a>00622             } <span class="keywordflow">else</span> {
<a name="l00623"></a>00623                <span class="keywordflow">for</span> (j = 0; j &lt; s-&gt;<a class="code" href="structast__udptl.html#af0c6829f8a5272ece732cd1ac1b3094a">tx</a>[i].<a class="code" href="structudptl__fec__tx__buffer__t.html#a7666bbf00997cc13da27d55cb05d27c4">buf_len</a>; j++)
<a name="l00624"></a>00624                   fec[j] ^= s-&gt;<a class="code" href="structast__udptl.html#af0c6829f8a5272ece732cd1ac1b3094a">tx</a>[i].<a class="code" href="structudptl__fec__tx__buffer__t.html#adf280a92c2ded8d54991b3ae3cb97ccf">buf</a>[j];
<a name="l00625"></a>00625             }
<a name="l00626"></a>00626          }
<a name="l00627"></a>00627          <span class="keywordflow">if</span> (<a class="code" href="udptl_8c.html#a139e3cb1abd258f2bd35a94b6573ca2c">encode_open_type</a>(s, <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, buflen, &amp;len, fec, high_tide) &lt; 0)
<a name="l00628"></a>00628             <span class="keywordflow">return</span> -1;
<a name="l00629"></a>00629       }
<a name="l00630"></a>00630       <span class="keywordflow">break</span>;
<a name="l00631"></a>00631    }
<a name="l00632"></a>00632 
<a name="l00633"></a>00633    <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structast__udptl.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l00634"></a>00634       fprintf(stderr, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00635"></a>00635 
<a name="l00636"></a>00636    s-&gt;<a class="code" href="structast__udptl.html#a0224da9d658e4e4ea2981d7ca7860aa3">tx_seq_no</a>++;
<a name="l00637"></a>00637    <span class="keywordflow">return</span> len;
<a name="l00638"></a>00638 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a01d5961e9d1bf0c8c6244aee64a1ecf9"></a><!-- doxytag: member="udptl.c::udptl_debug_test_addr" ref="a01d5961e9d1bf0c8c6244aee64a1ecf9" args="(const struct sockaddr_in *addr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int udptl_debug_test_addr </td>
          <td>(</td>
          <td class="paramtype">const struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>addr</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00187">187</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00085">udptldebugaddr</a>.</p>

<p>Referenced by <a class="el" href="udptl_8c_source.html#l00672">ast_udptl_read()</a>, and <a class="el" href="udptl_8c_source.html#l01060">ast_udptl_write()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00188"></a>00188 {
<a name="l00189"></a>00189    <span class="keywordflow">if</span> (<a class="code" href="udptl_8c.html#ade9088978427552c6020fd7453eedb57">udptldebug</a> == 0)
<a name="l00190"></a>00190       <span class="keywordflow">return</span> 0;
<a name="l00191"></a>00191    <span class="keywordflow">if</span> (<a class="code" href="udptl_8c.html#a3e1327ae66b0837cebb4c734a9bdd3f5">udptldebugaddr</a>.sin_addr.s_addr) {
<a name="l00192"></a>00192       <span class="keywordflow">if</span> (((ntohs(<a class="code" href="udptl_8c.html#a3e1327ae66b0837cebb4c734a9bdd3f5">udptldebugaddr</a>.sin_port) != 0) &amp;&amp;
<a name="l00193"></a>00193            (<a class="code" href="udptl_8c.html#a3e1327ae66b0837cebb4c734a9bdd3f5">udptldebugaddr</a>.sin_port != addr-&gt;sin_port)) ||
<a name="l00194"></a>00194           (<a class="code" href="udptl_8c.html#a3e1327ae66b0837cebb4c734a9bdd3f5">udptldebugaddr</a>.sin_addr.s_addr != addr-&gt;sin_addr.s_addr))
<a name="l00195"></a>00195          <span class="keywordflow">return</span> 0;
<a name="l00196"></a>00196    }
<a name="l00197"></a>00197    <span class="keywordflow">return</span> 1;
<a name="l00198"></a>00198 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0db4385b032d828c9ec822008c79a061"></a><!-- doxytag: member="udptl.c::udptl_rx_packet" ref="a0db4385b032d828c9ec822008c79a061" args="(struct ast_udptl *s, uint8_t *buf, unsigned int len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int udptl_rx_packet </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__udptl.html">ast_udptl</a> *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00318">318</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00120">AST_FRAME_MODEM</a>, <a class="el" href="linkedlists_8h_source.html#l00438">AST_LIST_NEXT</a>, <a class="el" href="frame_8h_source.html#l00215">AST_MODEM_T38</a>, <a class="el" href="udptl_8c_source.html#l00108">udptl_fec_rx_buffer_t::buf</a>, <a class="el" href="udptl_8c_source.html#l00107">udptl_fec_rx_buffer_t::buf_len</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="frame_8h_source.html#l00147">ast_frame::datalen</a>, <a class="el" href="udptl_8c_source.html#l00200">decode_length()</a>, <a class="el" href="udptl_8c_source.html#l00225">decode_open_type()</a>, <a class="el" href="udptl_8c_source.html#l00119">ast_udptl::f</a>, <a class="el" href="udptl_8c_source.html#l00110">udptl_fec_rx_buffer_t::fec</a>, <a class="el" href="udptl_8c_source.html#l00112">udptl_fec_rx_buffer_t::fec_entries</a>, <a class="el" href="udptl_8c_source.html#l00109">udptl_fec_rx_buffer_t::fec_len</a>, <a class="el" href="udptl_8c_source.html#l00111">udptl_fec_rx_buffer_t::fec_span</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="udptl_8c_source.html#l00093">LOCAL_FAX_MAX_DATAGRAM</a>, <a class="el" href="frame_8h_source.html#l00151">ast_frame::mallocd</a>, <a class="el" href="frame_8h_source.html#l00155">ast_frame::offset</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::ptr</a>, <a class="el" href="udptl_8c_source.html#l00182">ast_udptl::rx</a>, <a class="el" href="udptl_8c_source.html#l00178">ast_udptl::rx_seq_no</a>, <a class="el" href="frame_8h_source.html#l00171">ast_frame::seqno</a>, <a class="el" href="frame_8h_source.html#l00157">ast_frame::src</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, <a class="el" href="app__minivm_8c_source.html#l00406">TRUE</a>, and <a class="el" href="udptl_8c_source.html#l00099">UDPTL_BUF_MASK</a>.</p>

<p>Referenced by <a class="el" href="udptl_8c_source.html#l00672">ast_udptl_read()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00319"></a>00319 {
<a name="l00320"></a>00320    <span class="keywordtype">int</span> stat1;
<a name="l00321"></a>00321    <span class="keywordtype">int</span> stat2;
<a name="l00322"></a>00322    <span class="keywordtype">int</span> i;
<a name="l00323"></a>00323    <span class="keywordtype">int</span> j;
<a name="l00324"></a>00324    <span class="keywordtype">int</span> k;
<a name="l00325"></a>00325    <span class="keywordtype">int</span> l;
<a name="l00326"></a>00326    <span class="keywordtype">int</span> m;
<a name="l00327"></a>00327    <span class="keywordtype">int</span> x;
<a name="l00328"></a>00328    <span class="keywordtype">int</span> limit;
<a name="l00329"></a>00329    <span class="keywordtype">int</span> which;
<a name="l00330"></a>00330    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ptr;
<a name="l00331"></a>00331    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count;
<a name="l00332"></a>00332    <span class="keywordtype">int</span> total_count;
<a name="l00333"></a>00333    <span class="keywordtype">int</span> seq_no;
<a name="l00334"></a>00334    <span class="keyword">const</span> uint8_t *ifp;
<a name="l00335"></a>00335    <span class="keyword">const</span> uint8_t *data;
<a name="l00336"></a>00336    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ifp_len;
<a name="l00337"></a>00337    <span class="keywordtype">int</span> repaired[16];
<a name="l00338"></a>00338    <span class="keyword">const</span> uint8_t *bufs[16];
<a name="l00339"></a>00339    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lengths[16];
<a name="l00340"></a>00340    <span class="keywordtype">int</span> span;
<a name="l00341"></a>00341    <span class="keywordtype">int</span> entries;
<a name="l00342"></a>00342    <span class="keywordtype">int</span> ifp_no;
<a name="l00343"></a>00343 
<a name="l00344"></a>00344    ptr = 0;
<a name="l00345"></a>00345    ifp_no = 0;
<a name="l00346"></a>00346    memset(&amp;s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[0], 0, <span class="keyword">sizeof</span>(s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[0]));
<a name="l00347"></a>00347 
<a name="l00348"></a>00348    <span class="comment">/* Decode seq_number */</span>
<a name="l00349"></a>00349    <span class="keywordflow">if</span> (ptr + 2 &gt; <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>)
<a name="l00350"></a>00350       <span class="keywordflow">return</span> -1;
<a name="l00351"></a>00351    seq_no = (<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[0] &lt;&lt; 8) | <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[1];
<a name="l00352"></a>00352    ptr += 2;
<a name="l00353"></a>00353 
<a name="l00354"></a>00354    <span class="comment">/* Break out the primary packet */</span>
<a name="l00355"></a>00355    <span class="keywordflow">if</span> ((stat1 = <a class="code" href="udptl_8c.html#acad8de64155e849783a598df19ce849c">decode_open_type</a>(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, &amp;ptr, &amp;ifp, &amp;ifp_len)) != 0)
<a name="l00356"></a>00356       <span class="keywordflow">return</span> -1;
<a name="l00357"></a>00357    <span class="comment">/* Decode error_recovery */</span>
<a name="l00358"></a>00358    <span class="keywordflow">if</span> (ptr + 1 &gt; <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>)
<a name="l00359"></a>00359       <span class="keywordflow">return</span> -1;
<a name="l00360"></a>00360    <span class="keywordflow">if</span> ((<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[ptr++] &amp; 0x80) == 0) {
<a name="l00361"></a>00361       <span class="comment">/* Secondary packet mode for error recovery */</span>
<a name="l00362"></a>00362       <span class="keywordflow">if</span> (seq_no &gt; s-&gt;<a class="code" href="structast__udptl.html#a62313163b2e2302c6566074e8ace159e">rx_seq_no</a>) {
<a name="l00363"></a>00363          <span class="comment">/* We received a later packet than we expected, so we need to check if we can fill in the gap from the</span>
<a name="l00364"></a>00364 <span class="comment">            secondary packets. */</span>
<a name="l00365"></a>00365          total_count = 0;
<a name="l00366"></a>00366          <span class="keywordflow">do</span> {
<a name="l00367"></a>00367             <span class="keywordflow">if</span> ((stat2 = <a class="code" href="udptl_8c.html#ae31d7a712ec76b9ee8515efecca0cc07">decode_length</a>(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, &amp;ptr, &amp;count)) &lt; 0)
<a name="l00368"></a>00368                <span class="keywordflow">return</span> -1;
<a name="l00369"></a>00369             <span class="keywordflow">for</span> (i = 0; i &lt; count; i++) {
<a name="l00370"></a>00370                <span class="keywordflow">if</span> ((stat1 = <a class="code" href="udptl_8c.html#acad8de64155e849783a598df19ce849c">decode_open_type</a>(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, &amp;ptr, &amp;bufs[total_count + i], &amp;lengths[total_count + i])) != 0)
<a name="l00371"></a>00371                   <span class="keywordflow">return</span> -1;
<a name="l00372"></a>00372             }
<a name="l00373"></a>00373             total_count += count;
<a name="l00374"></a>00374          }
<a name="l00375"></a>00375          <span class="keywordflow">while</span> (stat2 &gt; 0);
<a name="l00376"></a>00376          <span class="comment">/* Step through in reverse order, so we go oldest to newest */</span>
<a name="l00377"></a>00377          <span class="keywordflow">for</span> (i = total_count; i &gt; 0; i--) {
<a name="l00378"></a>00378             <span class="keywordflow">if</span> (seq_no - i &gt;= s-&gt;<a class="code" href="structast__udptl.html#a62313163b2e2302c6566074e8ace159e">rx_seq_no</a>) {
<a name="l00379"></a>00379                <span class="comment">/* This one wasn&apos;t seen before */</span>
<a name="l00380"></a>00380                <span class="comment">/* Decode the secondary IFP packet */</span>
<a name="l00381"></a>00381                <span class="comment">//fprintf(stderr, &quot;Secondary %d, len %d\n&quot;, seq_no - i, lengths[i - 1]);</span>
<a name="l00382"></a>00382                s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no].<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ad99b86353343f422bda01163898b2eea">AST_FRAME_MODEM</a>;
<a name="l00383"></a>00383                s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no].<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="frame_8h.html#a3a510e4e2673c6870ed5fe0f1eb53732">AST_MODEM_T38</a>;
<a name="l00384"></a>00384 
<a name="l00385"></a>00385                s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no].<a class="code" href="structast__frame.html#aed16590d48f41d89f31e0cf347f5cd99">mallocd</a> = 0;
<a name="l00386"></a>00386                s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no].<a class="code" href="structast__frame.html#ab793262012344621455faf9266acbac2">seqno</a> = seq_no - i;
<a name="l00387"></a>00387                s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no].<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> = lengths[i - 1];
<a name="l00388"></a>00388                s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no].<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> = (uint8_t *) bufs[i - 1];
<a name="l00389"></a>00389                s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no].<a class="code" href="structast__frame.html#aed7ea92f45bd273dde380a45ddced592">offset</a> = 0;
<a name="l00390"></a>00390                s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no].<a class="code" href="structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a> = <span class="stringliteral">&quot;UDPTL&quot;</span>;
<a name="l00391"></a>00391                <span class="keywordflow">if</span> (ifp_no &gt; 0)
<a name="l00392"></a>00392                   <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(&amp;s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no - 1], frame_list) = &amp;s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no];
<a name="l00393"></a>00393                <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(&amp;s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no], frame_list) = NULL;
<a name="l00394"></a>00394                ifp_no++;
<a name="l00395"></a>00395             }
<a name="l00396"></a>00396          }
<a name="l00397"></a>00397       }
<a name="l00398"></a>00398    }
<a name="l00399"></a>00399    <span class="keywordflow">else</span>
<a name="l00400"></a>00400    {
<a name="l00401"></a>00401       <span class="comment">/* FEC mode for error recovery */</span>
<a name="l00402"></a>00402       <span class="comment">/* Our buffers cannot tolerate overlength IFP packets in FEC mode */</span>
<a name="l00403"></a>00403       <span class="keywordflow">if</span> (ifp_len &gt; <a class="code" href="udptl_8c.html#a7cebef58b6e2f580a8e74b7c133cd34b">LOCAL_FAX_MAX_DATAGRAM</a>)
<a name="l00404"></a>00404          <span class="keywordflow">return</span> -1;
<a name="l00405"></a>00405       <span class="comment">/* Update any missed slots in the buffer */</span>
<a name="l00406"></a>00406       <span class="keywordflow">for</span> ( ; seq_no &gt; s-&gt;<a class="code" href="structast__udptl.html#a62313163b2e2302c6566074e8ace159e">rx_seq_no</a>; s-&gt;<a class="code" href="structast__udptl.html#a62313163b2e2302c6566074e8ace159e">rx_seq_no</a>++) {
<a name="l00407"></a>00407          x = s-&gt;<a class="code" href="structast__udptl.html#a62313163b2e2302c6566074e8ace159e">rx_seq_no</a> &amp; <a class="code" href="udptl_8c.html#a5fc08f5f3152e66b9eb799375c8eafe5">UDPTL_BUF_MASK</a>;
<a name="l00408"></a>00408          s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[x].<a class="code" href="structudptl__fec__rx__buffer__t.html#a7666bbf00997cc13da27d55cb05d27c4">buf_len</a> = -1;
<a name="l00409"></a>00409          s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[x].<a class="code" href="structudptl__fec__rx__buffer__t.html#aaa33cae998bd7b4544845e3c9ea4014f">fec_len</a>[0] = 0;
<a name="l00410"></a>00410          s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[x].<a class="code" href="structudptl__fec__rx__buffer__t.html#ae946559f80e742802d3c41bb9d54c201">fec_span</a> = 0;
<a name="l00411"></a>00411          s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[x].<a class="code" href="structudptl__fec__rx__buffer__t.html#a47d90b4ddd6ebbeff08cadc1cf07f6f4">fec_entries</a> = 0;
<a name="l00412"></a>00412       }
<a name="l00413"></a>00413 
<a name="l00414"></a>00414       x = seq_no &amp; <a class="code" href="udptl_8c.html#a5fc08f5f3152e66b9eb799375c8eafe5">UDPTL_BUF_MASK</a>;
<a name="l00415"></a>00415 
<a name="l00416"></a>00416       memset(repaired, 0, <span class="keyword">sizeof</span>(repaired));
<a name="l00417"></a>00417 
<a name="l00418"></a>00418       <span class="comment">/* Save the new IFP packet */</span>
<a name="l00419"></a>00419       memcpy(s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[x].<a class="code" href="structudptl__fec__rx__buffer__t.html#adf280a92c2ded8d54991b3ae3cb97ccf">buf</a>, ifp, ifp_len);
<a name="l00420"></a>00420       s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[x].<a class="code" href="structudptl__fec__rx__buffer__t.html#a7666bbf00997cc13da27d55cb05d27c4">buf_len</a> = ifp_len;
<a name="l00421"></a>00421       repaired[x] = <a class="code" href="app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00422"></a>00422 
<a name="l00423"></a>00423       <span class="comment">/* Decode the FEC packets */</span>
<a name="l00424"></a>00424       <span class="comment">/* The span is defined as an unconstrained integer, but will never be more</span>
<a name="l00425"></a>00425 <span class="comment">         than a small value. */</span>
<a name="l00426"></a>00426       <span class="keywordflow">if</span> (ptr + 2 &gt; <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>)
<a name="l00427"></a>00427          <span class="keywordflow">return</span> -1;
<a name="l00428"></a>00428       <span class="keywordflow">if</span> (<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[ptr++] != 1)
<a name="l00429"></a>00429          <span class="keywordflow">return</span> -1;
<a name="l00430"></a>00430       span = <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[ptr++];
<a name="l00431"></a>00431       s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[x].<a class="code" href="structudptl__fec__rx__buffer__t.html#ae946559f80e742802d3c41bb9d54c201">fec_span</a> = span;
<a name="l00432"></a>00432 
<a name="l00433"></a>00433       <span class="comment">/* The number of entries is defined as a length, but will only ever be a small</span>
<a name="l00434"></a>00434 <span class="comment">         value. Treat it as such. */</span>
<a name="l00435"></a>00435       <span class="keywordflow">if</span> (ptr + 1 &gt; <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>)
<a name="l00436"></a>00436          <span class="keywordflow">return</span> -1;
<a name="l00437"></a>00437       entries = <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[ptr++];
<a name="l00438"></a>00438       s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[x].<a class="code" href="structudptl__fec__rx__buffer__t.html#a47d90b4ddd6ebbeff08cadc1cf07f6f4">fec_entries</a> = entries;
<a name="l00439"></a>00439 
<a name="l00440"></a>00440       <span class="comment">/* Decode the elements */</span>
<a name="l00441"></a>00441       <span class="keywordflow">for</span> (i = 0; i &lt; entries; i++) {
<a name="l00442"></a>00442          <span class="keywordflow">if</span> ((stat1 = <a class="code" href="udptl_8c.html#acad8de64155e849783a598df19ce849c">decode_open_type</a>(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, &amp;ptr, &amp;data, &amp;s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[x].<a class="code" href="structudptl__fec__rx__buffer__t.html#aaa33cae998bd7b4544845e3c9ea4014f">fec_len</a>[i])) != 0)
<a name="l00443"></a>00443             <span class="keywordflow">return</span> -1;
<a name="l00444"></a>00444          <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[x].<a class="code" href="structudptl__fec__rx__buffer__t.html#aaa33cae998bd7b4544845e3c9ea4014f">fec_len</a>[i] &gt; <a class="code" href="udptl_8c.html#a7cebef58b6e2f580a8e74b7c133cd34b">LOCAL_FAX_MAX_DATAGRAM</a>)
<a name="l00445"></a>00445             <span class="keywordflow">return</span> -1;
<a name="l00446"></a>00446 
<a name="l00447"></a>00447          <span class="comment">/* Save the new FEC data */</span>
<a name="l00448"></a>00448          memcpy(s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[x].<a class="code" href="structudptl__fec__rx__buffer__t.html#a41cd56bf2c54d88565344c24841bc517">fec</a>[i], data, s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[x].<a class="code" href="structudptl__fec__rx__buffer__t.html#aaa33cae998bd7b4544845e3c9ea4014f">fec_len</a>[i]);
<a name="l00449"></a>00449 <span class="preprocessor">#if 0</span>
<a name="l00450"></a>00450 <span class="preprocessor"></span>         fprintf(stderr, <span class="stringliteral">&quot;FEC: &quot;</span>);
<a name="l00451"></a>00451          <span class="keywordflow">for</span> (j = 0; j &lt; s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[x].<a class="code" href="structudptl__fec__rx__buffer__t.html#aaa33cae998bd7b4544845e3c9ea4014f">fec_len</a>[i]; j++)
<a name="l00452"></a>00452             fprintf(stderr, <span class="stringliteral">&quot;%02X &quot;</span>, data[j]);
<a name="l00453"></a>00453          fprintf(stderr, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00454"></a>00454 <span class="preprocessor">#endif</span>
<a name="l00455"></a>00455 <span class="preprocessor"></span>      }
<a name="l00456"></a>00456 
<a name="l00457"></a>00457       <span class="comment">/* See if we can reconstruct anything which is missing */</span>
<a name="l00458"></a>00458       <span class="comment">/* TODO: this does not comprehensively hunt back and repair everything that is possible */</span>
<a name="l00459"></a>00459       <span class="keywordflow">for</span> (l = x; l != ((x - (16 - span*entries)) &amp; UDPTL_BUF_MASK); l = (l - 1) &amp; UDPTL_BUF_MASK) {
<a name="l00460"></a>00460          <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[l].<a class="code" href="structudptl__fec__rx__buffer__t.html#aaa33cae998bd7b4544845e3c9ea4014f">fec_len</a>[0] &lt;= 0)
<a name="l00461"></a>00461             <span class="keywordflow">continue</span>;
<a name="l00462"></a>00462          <span class="keywordflow">for</span> (m = 0; m &lt; s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[l].<a class="code" href="structudptl__fec__rx__buffer__t.html#a47d90b4ddd6ebbeff08cadc1cf07f6f4">fec_entries</a>; m++) {
<a name="l00463"></a>00463             limit = (l + m) &amp; UDPTL_BUF_MASK;
<a name="l00464"></a>00464             <span class="keywordflow">for</span> (which = -1, k = (limit - s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[l].<a class="code" href="structudptl__fec__rx__buffer__t.html#ae946559f80e742802d3c41bb9d54c201">fec_span</a> * s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[l].<a class="code" href="structudptl__fec__rx__buffer__t.html#a47d90b4ddd6ebbeff08cadc1cf07f6f4">fec_entries</a>) &amp; UDPTL_BUF_MASK; k != limit; k = (k + s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[l].<a class="code" href="structudptl__fec__rx__buffer__t.html#a47d90b4ddd6ebbeff08cadc1cf07f6f4">fec_entries</a>) &amp; UDPTL_BUF_MASK) {
<a name="l00465"></a>00465                <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[k].<a class="code" href="structudptl__fec__rx__buffer__t.html#a7666bbf00997cc13da27d55cb05d27c4">buf_len</a> &lt;= 0)
<a name="l00466"></a>00466                   which = (which == -1) ? k : -2;
<a name="l00467"></a>00467             }
<a name="l00468"></a>00468             <span class="keywordflow">if</span> (which &gt;= 0) {
<a name="l00469"></a>00469                <span class="comment">/* Repairable */</span>
<a name="l00470"></a>00470                <span class="keywordflow">for</span> (j = 0; j &lt; s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[l].<a class="code" href="structudptl__fec__rx__buffer__t.html#aaa33cae998bd7b4544845e3c9ea4014f">fec_len</a>[m]; j++) {
<a name="l00471"></a>00471                   s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[which].<a class="code" href="structudptl__fec__rx__buffer__t.html#adf280a92c2ded8d54991b3ae3cb97ccf">buf</a>[j] = s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[l].<a class="code" href="structudptl__fec__rx__buffer__t.html#a41cd56bf2c54d88565344c24841bc517">fec</a>[m][j];
<a name="l00472"></a>00472                   <span class="keywordflow">for</span> (k = (limit - s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[l].<a class="code" href="structudptl__fec__rx__buffer__t.html#ae946559f80e742802d3c41bb9d54c201">fec_span</a> * s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[l].<a class="code" href="structudptl__fec__rx__buffer__t.html#a47d90b4ddd6ebbeff08cadc1cf07f6f4">fec_entries</a>) &amp; UDPTL_BUF_MASK; k != limit; k = (k + s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[l].<a class="code" href="structudptl__fec__rx__buffer__t.html#a47d90b4ddd6ebbeff08cadc1cf07f6f4">fec_entries</a>) &amp; UDPTL_BUF_MASK)
<a name="l00473"></a>00473                      s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[which].<a class="code" href="structudptl__fec__rx__buffer__t.html#adf280a92c2ded8d54991b3ae3cb97ccf">buf</a>[j] ^= (s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[k].<a class="code" href="structudptl__fec__rx__buffer__t.html#a7666bbf00997cc13da27d55cb05d27c4">buf_len</a> &gt; j) ? s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[k].<a class="code" href="structudptl__fec__rx__buffer__t.html#adf280a92c2ded8d54991b3ae3cb97ccf">buf</a>[j] : 0;
<a name="l00474"></a>00474                }
<a name="l00475"></a>00475                s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[which].<a class="code" href="structudptl__fec__rx__buffer__t.html#a7666bbf00997cc13da27d55cb05d27c4">buf_len</a> = s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[l].<a class="code" href="structudptl__fec__rx__buffer__t.html#aaa33cae998bd7b4544845e3c9ea4014f">fec_len</a>[m];
<a name="l00476"></a>00476                repaired[which] = <a class="code" href="app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00477"></a>00477             }
<a name="l00478"></a>00478          }
<a name="l00479"></a>00479       }
<a name="l00480"></a>00480       <span class="comment">/* Now play any new packets forwards in time */</span>
<a name="l00481"></a>00481       <span class="keywordflow">for</span> (l = (x + 1) &amp; UDPTL_BUF_MASK, j = seq_no - UDPTL_BUF_MASK; l != x; l = (l + 1) &amp; UDPTL_BUF_MASK, j++) {
<a name="l00482"></a>00482          <span class="keywordflow">if</span> (repaired[l]) {
<a name="l00483"></a>00483             <span class="comment">//fprintf(stderr, &quot;Fixed packet %d, len %d\n&quot;, j, l);</span>
<a name="l00484"></a>00484             s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no].<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ad99b86353343f422bda01163898b2eea">AST_FRAME_MODEM</a>;
<a name="l00485"></a>00485             s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no].<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="frame_8h.html#a3a510e4e2673c6870ed5fe0f1eb53732">AST_MODEM_T38</a>;
<a name="l00486"></a>00486          
<a name="l00487"></a>00487             s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no].<a class="code" href="structast__frame.html#aed16590d48f41d89f31e0cf347f5cd99">mallocd</a> = 0;
<a name="l00488"></a>00488             s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no].<a class="code" href="structast__frame.html#ab793262012344621455faf9266acbac2">seqno</a> = j;
<a name="l00489"></a>00489             s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no].<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> = s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[l].<a class="code" href="structudptl__fec__rx__buffer__t.html#a7666bbf00997cc13da27d55cb05d27c4">buf_len</a>;
<a name="l00490"></a>00490             s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no].<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> = s-&gt;<a class="code" href="structast__udptl.html#a88620be29521fa573c4dea697a7a4258">rx</a>[l].<a class="code" href="structudptl__fec__rx__buffer__t.html#adf280a92c2ded8d54991b3ae3cb97ccf">buf</a>;
<a name="l00491"></a>00491             s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no].<a class="code" href="structast__frame.html#aed7ea92f45bd273dde380a45ddced592">offset</a> = 0;
<a name="l00492"></a>00492             s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no].<a class="code" href="structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a> = <span class="stringliteral">&quot;UDPTL&quot;</span>;
<a name="l00493"></a>00493             <span class="keywordflow">if</span> (ifp_no &gt; 0)
<a name="l00494"></a>00494                <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(&amp;s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no - 1], frame_list) = &amp;s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no];
<a name="l00495"></a>00495             <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(&amp;s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no], frame_list) = NULL;
<a name="l00496"></a>00496             ifp_no++;
<a name="l00497"></a>00497          }
<a name="l00498"></a>00498       }
<a name="l00499"></a>00499    }
<a name="l00500"></a>00500 
<a name="l00501"></a>00501    <span class="comment">/* If packets are received out of sequence, we may have already processed this packet from the error</span>
<a name="l00502"></a>00502 <span class="comment">      recovery information in a packet already received. */</span>
<a name="l00503"></a>00503    <span class="keywordflow">if</span> (seq_no &gt;= s-&gt;<a class="code" href="structast__udptl.html#a62313163b2e2302c6566074e8ace159e">rx_seq_no</a>) {
<a name="l00504"></a>00504       <span class="comment">/* Decode the primary IFP packet */</span>
<a name="l00505"></a>00505       s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no].<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ad99b86353343f422bda01163898b2eea">AST_FRAME_MODEM</a>;
<a name="l00506"></a>00506       s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no].<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="frame_8h.html#a3a510e4e2673c6870ed5fe0f1eb53732">AST_MODEM_T38</a>;
<a name="l00507"></a>00507       
<a name="l00508"></a>00508       s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no].<a class="code" href="structast__frame.html#aed16590d48f41d89f31e0cf347f5cd99">mallocd</a> = 0;
<a name="l00509"></a>00509       s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no].<a class="code" href="structast__frame.html#ab793262012344621455faf9266acbac2">seqno</a> = seq_no;
<a name="l00510"></a>00510       s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no].<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> = ifp_len;
<a name="l00511"></a>00511       s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no].<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> = (uint8_t *) ifp;
<a name="l00512"></a>00512       s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no].<a class="code" href="structast__frame.html#aed7ea92f45bd273dde380a45ddced592">offset</a> = 0;
<a name="l00513"></a>00513       s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no].<a class="code" href="structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a> = <span class="stringliteral">&quot;UDPTL&quot;</span>;
<a name="l00514"></a>00514       <span class="keywordflow">if</span> (ifp_no &gt; 0)
<a name="l00515"></a>00515          <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(&amp;s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no - 1], frame_list) = &amp;s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no];
<a name="l00516"></a>00516       <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(&amp;s-&gt;<a class="code" href="structast__udptl.html#a90f2de0c2fe1997e3c842ff0a32e4edc">f</a>[ifp_no], frame_list) = NULL;
<a name="l00517"></a>00517 
<a name="l00518"></a>00518       ifp_no++;
<a name="l00519"></a>00519    }
<a name="l00520"></a>00520 
<a name="l00521"></a>00521    s-&gt;<a class="code" href="structast__udptl.html#a62313163b2e2302c6566074e8ace159e">rx_seq_no</a> = seq_no + 1;
<a name="l00522"></a>00522    <span class="keywordflow">return</span> ifp_no;
<a name="l00523"></a>00523 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aca6905df84f7b7a4905a3fadb50139c7"></a><!-- doxytag: member="udptl.c::udptlread" ref="aca6905df84f7b7a4905a3fadb50139c7" args="(int *id, int fd, short events, void *cbdata)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int udptlread </td>
          <td>(</td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short&nbsp;</td>
          <td class="paramname"> <em>events</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>cbdata</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00660">660</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>References <a class="el" href="udptl_8c_source.html#l00672">ast_udptl_read()</a>, <a class="el" href="udptl_8c_source.html#l00131">ast_udptl::callback</a>, <a class="el" href="udptl_8c_source.html#l00129">ast_udptl::data</a>, and <a class="el" href="format__g726_8c_source.html#l00177">f</a>.</p>

<p>Referenced by <a class="el" href="udptl_8c_source.html#l00919">ast_udptl_new_with_bindaddr()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00661"></a>00661 {
<a name="l00662"></a>00662    <span class="keyword">struct </span><a class="code" href="structast__udptl.html" title="Structure for an UDPTL session.">ast_udptl</a> *udptl = cbdata;
<a name="l00663"></a>00663    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l00664"></a>00664 
<a name="l00665"></a>00665    <span class="keywordflow">if</span> ((f = <a class="code" href="udptl_8h.html#ae0808bce80557e3107c9030bd8a832fe">ast_udptl_read</a>(udptl))) {
<a name="l00666"></a>00666       <span class="keywordflow">if</span> (udptl-&gt;<a class="code" href="structast__udptl.html#a221993e4dd934844eb4cce202b381952">callback</a>)
<a name="l00667"></a>00667          udptl-&gt;<a class="code" href="structast__udptl.html#a221993e4dd934844eb4cce202b381952">callback</a>(udptl, f, udptl-&gt;<a class="code" href="structast__udptl.html#a735984d41155bc1032e09bece8f8d66d">data</a>);
<a name="l00668"></a>00668    }
<a name="l00669"></a>00669    <span class="keywordflow">return</span> 1;
<a name="l00670"></a>00670 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a307853ba74adbc85d4dd57bee618e674"></a><!-- doxytag: member="udptl.c::cli_udptl" ref="a307853ba74adbc85d4dd57bee618e674" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> <a class="el" href="udptl_8c.html#a307853ba74adbc85d4dd57bee618e674">cli_udptl</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
   <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="udptl_8c.html#a9b115851b62ac2f257cabce0cee1f67e">handle_cli_udptl_set_debug</a>, <span class="stringliteral">&quot;Enable/Disable UDPTL debugging&quot;</span>)
}
</pre></div>
<p>Definition at line <a class="el" href="udptl_8c_source.html#l01338">1338</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

</div>
</div>
<a class="anchor" id="ade9088978427552c6020fd7453eedb57"></a><!-- doxytag: member="udptl.c::udptldebug" ref="ade9088978427552c6020fd7453eedb57" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="udptl_8c.html#ade9088978427552c6020fd7453eedb57">udptldebug</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Are we debugging? </p>

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00084">84</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3e1327ae66b0837cebb4c734a9bdd3f5"></a><!-- doxytag: member="udptl.c::udptldebugaddr" ref="a3e1327ae66b0837cebb4c734a9bdd3f5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct sockaddr_in <a class="el" href="udptl_8c.html#a3e1327ae66b0837cebb4c734a9bdd3f5">udptldebugaddr</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Debug packets to/from this host </p>

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00085">85</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

<p>Referenced by <a class="el" href="udptl_8c_source.html#l01275">handle_cli_udptl_set_debug()</a>, and <a class="el" href="udptl_8c_source.html#l00187">udptl_debug_test_addr()</a>.</p>

</div>
</div>
<a class="anchor" id="a6bb07009dda10589e6e1dbad7a48d157"></a><!-- doxytag: member="udptl.c::udptlend" ref="a6bb07009dda10589e6e1dbad7a48d157" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="udptl_8c.html#a6bb07009dda10589e6e1dbad7a48d157">udptlend</a> = 4599<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00083">83</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

</div>
</div>
<a class="anchor" id="a2d6cbcd43cd796cd91da16fc798be95d"></a><!-- doxytag: member="udptl.c::udptlfecentries" ref="a2d6cbcd43cd796cd91da16fc798be95d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="udptl_8c.html#a2d6cbcd43cd796cd91da16fc798be95d">udptlfecentries</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00089">89</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1843da2c025cc14346182403c4c9fa53"></a><!-- doxytag: member="udptl.c::udptlfecspan" ref="a1843da2c025cc14346182403c4c9fa53" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="udptl_8c.html#a1843da2c025cc14346182403c4c9fa53">udptlfecspan</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00090">90</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3bf0aa3b30cf99c6052f71dd963dc800"></a><!-- doxytag: member="udptl.c::udptlstart" ref="a3bf0aa3b30cf99c6052f71dd963dc800" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="udptl_8c.html#a3bf0aa3b30cf99c6052f71dd963dc800">udptlstart</a> = 4500<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00082">82</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

</div>
</div>
<a class="anchor" id="a830f7f070798d4b70c3189b8fade1ab7"></a><!-- doxytag: member="udptl.c::use_even_ports" ref="a830f7f070798d4b70c3189b8fade1ab7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="udptl_8c.html#a830f7f070798d4b70c3189b8fade1ab7">use_even_ports</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="udptl_8c_source.html#l00091">91</a> of file <a class="el" href="udptl_8c_source.html">udptl.c</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:23:33 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
