<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:23:15 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_318a70d4e812a718d9ecaeea98fff199.html">res</a>
  </div>
</div>
<div class="contents">
<h1>res_limit.c File Reference</h1>
<p>Resource <a class="el" href="structlimits.html">limits</a>.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="asterisk_8h_source.html">asterisk.h</a>&quot;</code><br/>
<code>#include &lt;ctype.h&gt;</code><br/>
<code>#include &lt;sys/time.h&gt;</code><br/>
<code>#include &lt;sys/resource.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="module_8h_source.html">asterisk/module.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="cli_8h_source.html">asterisk/cli.h</a>&quot;</code><br/>

<p><a href="res__limit_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlimits.html">limits</a></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__limit_8c.html#a88b7c88fed6b80fd18f34f97757dfc04">__reg_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__limit_8c.html#afeab1257bd17282b95875499393a147a">__unreg_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__limit_8c.html#a4db68003600106733e786f0e037ace63">complete_ulimit</a> (struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__limit_8c.html#a5611403fddc200321397e8f94887d19f">handle_cli_ulimit</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__limit_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__limit_8c.html#af452aadec79963848a8e9e6e40338f3a">str2desc</a> (const char *string)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__limit_8c.html#ae104ef2d56ecc50b12d9a7e4cd4bc5ed">str2limit</a> (const char *string)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__limit_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a> (void)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__module__info.html">ast_module_info</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__limit_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a> = { .<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = AST_MODULE, .flags = AST_MODFLAG_DEFAULT , .<a class="el" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a> = &quot;Resource <a class="el" href="structlimits.html">limits</a>&quot; , .key = &quot;This paragraph is copyright (c) 2006 by Digium, Inc. \In order for your module to load, it must return this \key via a function called \&quot;key\&quot;. Any code which \includes this paragraph must be licensed under the GNU \General Public License <a class="el" href="res__config__pgsql_8c.html#aad880fc4455c253781e8968f2239d56f">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = &quot;aefddfaffd51bc118c14a748e96eb9a0&quot; , .load = load_module, .unload = unload_module, }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__module__info.html">ast_module_info</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__limit_8c.html#ae25b9f3970870610911f8850897e8ead">ast_module_info</a> = &amp;<a class="el" href="res__timing__timerfd_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__limit_8c.html#a5d8312f7cd56d2e2e4ff65c76bfb9a55">cli_ulimit</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Resource <a class="el" href="structlimits.html">limits</a>. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Tilghman Lesher &lt;<a href="mailto:res_limit_200607@the-tilghman.com">res_limit_200607@the-tilghman.com</a>&gt; </dd></dl>

<p>Definition in file <a class="el" href="res__limit_8c_source.html">res_limit.c</a>.</p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a88b7c88fed6b80fd18f34f97757dfc04"></a><!-- doxytag: member="res_limit.c::__reg_module" ref="a88b7c88fed6b80fd18f34f97757dfc04" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void __reg_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__limit_8c_source.html#l00214">214</a> of file <a class="el" href="res__limit_8c_source.html">res_limit.c</a>.</p>

</div>
</div>
<a class="anchor" id="afeab1257bd17282b95875499393a147a"></a><!-- doxytag: member="res_limit.c::__unreg_module" ref="afeab1257bd17282b95875499393a147a" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void __unreg_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__limit_8c_source.html#l00214">214</a> of file <a class="el" href="res__limit_8c_source.html">res_limit.c</a>.</p>

</div>
</div>
<a class="anchor" id="a4db68003600106733e786f0e037ace63"></a><!-- doxytag: member="res_limit.c::complete_ulimit" ref="a4db68003600106733e786f0e037ace63" args="(struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* complete_ulimit </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__limit_8c_source.html#l00085">85</a> of file <a class="el" href="res__limit_8c_source.html">res_limit.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="cli_8h_source.html#l00145">ast_cli_args::n</a>, <a class="el" href="cli_8h_source.html#l00144">ast_cli_args::pos</a>, and <a class="el" href="cli_8h_source.html#l00143">ast_cli_args::word</a>.</p>

<p>Referenced by <a class="el" href="res__limit_8c_source.html#l00101">handle_cli_ulimit()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00086"></a>00086 {
<a name="l00087"></a>00087    <span class="keywordtype">int</span> which = 0, i;
<a name="l00088"></a>00088    <span class="keywordtype">int</span> wordlen = strlen(a-&gt;<a class="code" href="structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>);
<a name="l00089"></a>00089 
<a name="l00090"></a>00090    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#a1910d262855b71da353ed0d07a6c7823">pos</a> &gt; 1)
<a name="l00091"></a>00091       <span class="keywordflow">return</span> NULL;
<a name="l00092"></a>00092    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="structlimits.html">limits</a>); i++) {
<a name="l00093"></a>00093       <span class="keywordflow">if</span> (!strncasecmp(<a class="code" href="structlimits.html">limits</a>[i].clicmd, a-&gt;<a class="code" href="structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>, wordlen)) {
<a name="l00094"></a>00094          <span class="keywordflow">if</span> (++which &gt; a-&gt;<a class="code" href="structast__cli__args.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>)
<a name="l00095"></a>00095             <span class="keywordflow">return</span> <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(<a class="code" href="structlimits.html">limits</a>[i].clicmd);
<a name="l00096"></a>00096       }
<a name="l00097"></a>00097    }
<a name="l00098"></a>00098    <span class="keywordflow">return</span> NULL;
<a name="l00099"></a>00099 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5611403fddc200321397e8f94887d19f"></a><!-- doxytag: member="res_limit.c::handle_cli_ulimit" ref="a5611403fddc200321397e8f94887d19f" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_cli_ulimit </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__limit_8c_source.html#l00101">101</a> of file <a class="el" href="res__limit_8c_source.html">res_limit.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="cli_8h_source.html#l00045">CLI_FAILURE</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00134">CLI_HANDLER</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="res__limit_8c_source.html#l00085">complete_ulimit()</a>, <a class="el" href="channel_8c_source.html#l00138">desc</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="res__limit_8c_source.html#l00075">str2desc()</a>, <a class="el" href="res__limit_8c_source.html#l00065">str2limit()</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00102"></a>00102 {
<a name="l00103"></a>00103    <span class="keywordtype">int</span> resource;
<a name="l00104"></a>00104    <span class="keyword">struct </span>rlimit rlimit = { 0, 0 };
<a name="l00105"></a>00105 
<a name="l00106"></a>00106    <span class="keywordflow">switch</span> (cmd) {
<a name="l00107"></a>00107    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l00108"></a>00108       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;ulimit&quot;</span>;
<a name="l00109"></a>00109       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l00110"></a>00110          <span class="stringliteral">&quot;Usage: ulimit {data|&quot;</span>
<a name="l00111"></a>00111 <span class="preprocessor">#ifdef RLIMIT_RSS</span>
<a name="l00112"></a>00112 <span class="preprocessor"></span>         <span class="stringliteral">&quot;limit|&quot;</span>
<a name="l00113"></a>00113 <span class="preprocessor">#endif</span>
<a name="l00114"></a>00114 <span class="preprocessor"></span>         <span class="stringliteral">&quot;file|&quot;</span>
<a name="l00115"></a>00115 <span class="preprocessor">#ifdef RLIMIT_RSS</span>
<a name="l00116"></a>00116 <span class="preprocessor"></span>         <span class="stringliteral">&quot;memory|&quot;</span>
<a name="l00117"></a>00117 <span class="preprocessor">#endif</span>
<a name="l00118"></a>00118 <span class="preprocessor"></span>         <span class="stringliteral">&quot;stack|time|&quot;</span>
<a name="l00119"></a>00119 <span class="preprocessor">#ifdef RLIMIT_NPROC</span>
<a name="l00120"></a>00120 <span class="preprocessor"></span>         <span class="stringliteral">&quot;processes|&quot;</span>
<a name="l00121"></a>00121 <span class="preprocessor">#endif</span>
<a name="l00122"></a>00122 <span class="preprocessor"></span><span class="preprocessor">#ifdef VMEM_DEF</span>
<a name="l00123"></a>00123 <span class="preprocessor"></span>         <span class="stringliteral">&quot;virtual|&quot;</span>
<a name="l00124"></a>00124 <span class="preprocessor">#endif</span>
<a name="l00125"></a>00125 <span class="preprocessor"></span>         <span class="stringliteral">&quot;core|descriptors} [&lt;num&gt;]\n&quot;</span>
<a name="l00126"></a>00126          <span class="stringliteral">&quot;       Shows or sets the corresponding resource limit.\n&quot;</span>
<a name="l00127"></a>00127          <span class="stringliteral">&quot;         data          Process data segment [readonly]\n&quot;</span>
<a name="l00128"></a>00128 <span class="preprocessor">#ifdef RLIMIT_RSS</span>
<a name="l00129"></a>00129 <span class="preprocessor"></span>         <span class="stringliteral">&quot;         lock          Memory lock size [readonly]\n&quot;</span>
<a name="l00130"></a>00130 <span class="preprocessor">#endif</span>
<a name="l00131"></a>00131 <span class="preprocessor"></span>         <span class="stringliteral">&quot;         file          File size\n&quot;</span>
<a name="l00132"></a>00132 <span class="preprocessor">#ifdef RLIMIT_RSS</span>
<a name="l00133"></a>00133 <span class="preprocessor"></span>         <span class="stringliteral">&quot;         memory        Process resident memory [readonly]\n&quot;</span>
<a name="l00134"></a>00134 <span class="preprocessor">#endif</span>
<a name="l00135"></a>00135 <span class="preprocessor"></span>         <span class="stringliteral">&quot;         stack         Process stack size [readonly]\n&quot;</span>
<a name="l00136"></a>00136          <span class="stringliteral">&quot;         time          CPU usage [readonly]\n&quot;</span>
<a name="l00137"></a>00137 <span class="preprocessor">#ifdef RLIMIT_NPROC</span>
<a name="l00138"></a>00138 <span class="preprocessor"></span>         <span class="stringliteral">&quot;         processes     Child processes\n&quot;</span>
<a name="l00139"></a>00139 <span class="preprocessor">#endif</span>
<a name="l00140"></a>00140 <span class="preprocessor"></span><span class="preprocessor">#ifdef VMEM_DEF</span>
<a name="l00141"></a>00141 <span class="preprocessor"></span>         <span class="stringliteral">&quot;         virtual       Process virtual memory [readonly]\n&quot;</span>
<a name="l00142"></a>00142 <span class="preprocessor">#endif</span>
<a name="l00143"></a>00143 <span class="preprocessor"></span>         <span class="stringliteral">&quot;         core          Core dump file size\n&quot;</span>
<a name="l00144"></a>00144          <span class="stringliteral">&quot;         descriptors   Number of file descriptors\n&quot;</span>;
<a name="l00145"></a>00145       <span class="keywordflow">return</span> NULL;
<a name="l00146"></a>00146    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l00147"></a>00147       <span class="keywordflow">return</span> <a class="code" href="res__limit_8c.html#a4db68003600106733e786f0e037ace63">complete_ulimit</a>(a);
<a name="l00148"></a>00148    }
<a name="l00149"></a>00149 
<a name="l00150"></a>00150    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> &gt; 3)
<a name="l00151"></a>00151       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l00152"></a>00152 
<a name="l00153"></a>00153    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> == 1) {
<a name="l00154"></a>00154       <span class="keywordtype">char</span> arg2[15];
<a name="l00155"></a>00155       <span class="keywordtype">char</span> *newargv[2] = { <span class="stringliteral">&quot;ulimit&quot;</span>, arg2 };
<a name="l00156"></a>00156       <span class="keywordflow">for</span> (resource = 0; resource &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="structlimits.html">limits</a>); resource++) {
<a name="l00157"></a>00157          <span class="keyword">struct </span><a class="code" href="structast__cli__args.html">ast_cli_args</a> newArgs = { .argv = newargv, .argc = 2 };
<a name="l00158"></a>00158          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(arg2, <a class="code" href="structlimits.html">limits</a>[resource].clicmd, <span class="keyword">sizeof</span>(arg2));
<a name="l00159"></a>00159          <a class="code" href="res__limit_8c.html#a5611403fddc200321397e8f94887d19f">handle_cli_ulimit</a>(e, <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea2e4a68503bbadbeacf842a24c7d7f2df">CLI_HANDLER</a>, &amp;newArgs);
<a name="l00160"></a>00160       }
<a name="l00161"></a>00161       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l00162"></a>00162    } <span class="keywordflow">else</span> {
<a name="l00163"></a>00163       resource = <a class="code" href="res__limit_8c.html#ae104ef2d56ecc50b12d9a7e4cd4bc5ed">str2limit</a>(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[1]);
<a name="l00164"></a>00164       <span class="keywordflow">if</span> (resource == -1) {
<a name="l00165"></a>00165          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Unknown resource\n&quot;</span>);
<a name="l00166"></a>00166          <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;
<a name="l00167"></a>00167       }
<a name="l00168"></a>00168 
<a name="l00169"></a>00169       <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> == 3) {
<a name="l00170"></a>00170          <span class="keywordtype">int</span> x;
<a name="l00171"></a>00171 <span class="preprocessor">#ifdef RLIMIT_NPROC</span>
<a name="l00172"></a>00172 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (resource != RLIMIT_NOFILE &amp;&amp; resource != RLIMIT_CORE &amp;&amp; resource != RLIMIT_NPROC &amp;&amp; resource != RLIMIT_FSIZE) {
<a name="l00173"></a>00173 <span class="preprocessor">#else</span>
<a name="l00174"></a>00174 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (resource != RLIMIT_NOFILE &amp;&amp; resource != RLIMIT_CORE &amp;&amp; resource != RLIMIT_FSIZE) {
<a name="l00175"></a>00175 <span class="preprocessor">#endif</span>
<a name="l00176"></a>00176 <span class="preprocessor"></span>            <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Resource not permitted to be set\n&quot;</span>);
<a name="l00177"></a>00177             <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;
<a name="l00178"></a>00178          }
<a name="l00179"></a>00179 
<a name="l00180"></a>00180          sscanf(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[2], <span class="stringliteral">&quot;%30d&quot;</span>, &amp;x);
<a name="l00181"></a>00181          rlimit.rlim_max = rlimit.rlim_cur = x;
<a name="l00182"></a>00182          setrlimit(resource, &amp;rlimit);
<a name="l00183"></a>00183          <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l00184"></a>00184       } <span class="keywordflow">else</span> {
<a name="l00185"></a>00185          <span class="keywordflow">if</span> (!getrlimit(resource, &amp;rlimit)) {
<a name="l00186"></a>00186             <span class="keywordtype">char</span> printlimit[32];
<a name="l00187"></a>00187             <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="channel_8c.html#a710bce51374aba96ab04912897666c35">desc</a>;
<a name="l00188"></a>00188             <span class="keywordflow">if</span> (rlimit.rlim_max == RLIM_INFINITY)
<a name="l00189"></a>00189                <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(printlimit, <span class="stringliteral">&quot;effectively unlimited&quot;</span>, <span class="keyword">sizeof</span>(printlimit));
<a name="l00190"></a>00190             <span class="keywordflow">else</span>
<a name="l00191"></a>00191                snprintf(printlimit, <span class="keyword">sizeof</span>(printlimit), <span class="stringliteral">&quot;limited to %d&quot;</span>, (<span class="keywordtype">int</span>) rlimit.rlim_cur);
<a name="l00192"></a>00192             desc = <a class="code" href="res__limit_8c.html#af452aadec79963848a8e9e6e40338f3a">str2desc</a>(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[1]);
<a name="l00193"></a>00193             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;%c%s (%s) is %s.\n&quot;</span>, toupper(desc[0]), desc + 1, a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[1], printlimit);
<a name="l00194"></a>00194          } <span class="keywordflow">else</span>
<a name="l00195"></a>00195             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Could not retrieve resource limits for %s: %s\n&quot;</span>, <a class="code" href="res__limit_8c.html#af452aadec79963848a8e9e6e40338f3a">str2desc</a>(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[1]), strerror(errno));
<a name="l00196"></a>00196          <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l00197"></a>00197       }
<a name="l00198"></a>00198    }
<a name="l00199"></a>00199 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac3382bf6da54c56b37069bd76bbdf4f9"></a><!-- doxytag: member="res_limit.c::load_module" ref="ac3382bf6da54c56b37069bd76bbdf4f9" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int load_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__limit_8c_source.html#l00209">209</a> of file <a class="el" href="res__limit_8c_source.html">res_limit.c</a>.</p>

<p>References <a class="el" href="cli_8c_source.html#l01919">ast_cli_register()</a>, <a class="el" href="module_8h_source.html#l00065">AST_MODULE_LOAD_FAILURE</a>, and <a class="el" href="module_8h_source.html#l00061">AST_MODULE_LOAD_SUCCESS</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00210"></a>00210 {
<a name="l00211"></a>00211    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0ca7e108aceb1cd488bb9e3ee26e4ebc" title="Registers a command or an array of commands.">ast_cli_register</a>(&amp;<a class="code" href="res__limit_8c.html#a5d8312f7cd56d2e2e4ff65c76bfb9a55">cli_ulimit</a>) ? <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa8724da3ad620df86524280e760add388">AST_MODULE_LOAD_FAILURE</a> : <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a>;
<a name="l00212"></a>00212 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af452aadec79963848a8e9e6e40338f3a"></a><!-- doxytag: member="res_limit.c::str2desc" ref="af452aadec79963848a8e9e6e40338f3a" args="(const char *string)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static const char* str2desc </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>string</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__limit_8c_source.html#l00075">75</a> of file <a class="el" href="res__limit_8c_source.html">res_limit.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, and <a class="el" href="channel_8c_source.html#l00138">desc</a>.</p>

<p>Referenced by <a class="el" href="res__limit_8c_source.html#l00101">handle_cli_ulimit()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00076"></a>00076 {
<a name="l00077"></a>00077    <span class="keywordtype">size_t</span> i;
<a name="l00078"></a>00078    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="structlimits.html">limits</a>); i++) {
<a name="l00079"></a>00079       <span class="keywordflow">if</span> (!strcmp(<span class="keywordtype">string</span>, <a class="code" href="structlimits.html">limits</a>[i].clicmd))
<a name="l00080"></a>00080          <span class="keywordflow">return</span> <a class="code" href="structlimits.html">limits</a>[i].<a class="code" href="channel_8c.html#a710bce51374aba96ab04912897666c35">desc</a>;
<a name="l00081"></a>00081    }
<a name="l00082"></a>00082    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&lt;unknown&gt;&quot;</span>;
<a name="l00083"></a>00083 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae104ef2d56ecc50b12d9a7e4cd4bc5ed"></a><!-- doxytag: member="res_limit.c::str2limit" ref="ae104ef2d56ecc50b12d9a7e4cd4bc5ed" args="(const char *string)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int str2limit </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>string</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__limit_8c_source.html#l00065">65</a> of file <a class="el" href="res__limit_8c_source.html">res_limit.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>.</p>

<p>Referenced by <a class="el" href="res__limit_8c_source.html#l00101">handle_cli_ulimit()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00066"></a>00066 {
<a name="l00067"></a>00067    <span class="keywordtype">size_t</span> i;
<a name="l00068"></a>00068    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="structlimits.html">limits</a>); i++) {
<a name="l00069"></a>00069       <span class="keywordflow">if</span> (!strcasecmp(<span class="keywordtype">string</span>, <a class="code" href="structlimits.html">limits</a>[i].clicmd))
<a name="l00070"></a>00070          <span class="keywordflow">return</span> <a class="code" href="structlimits.html">limits</a>[i].resource;
<a name="l00071"></a>00071    }
<a name="l00072"></a>00072    <span class="keywordflow">return</span> -1;
<a name="l00073"></a>00073 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad09fa931f468002152a3cc2d5ce25eae"></a><!-- doxytag: member="res_limit.c::unload_module" ref="ad09fa931f468002152a3cc2d5ce25eae" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int unload_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__limit_8c_source.html#l00204">204</a> of file <a class="el" href="res__limit_8c_source.html">res_limit.c</a>.</p>

<p>References <a class="el" href="cli_8c_source.html#l01913">ast_cli_unregister()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00205"></a>00205 {
<a name="l00206"></a>00206    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a3189e6720486808603d13f5d2b58daf4" title="Unregisters a command or an array of commands.">ast_cli_unregister</a>(&amp;<a class="code" href="res__limit_8c.html#a5d8312f7cd56d2e2e4ff65c76bfb9a55">cli_ulimit</a>);
<a name="l00207"></a>00207 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ab22f32016155f7f403e7178767163d7d"></a><!-- doxytag: member="res_limit.c::__mod_info" ref="ab22f32016155f7f403e7178767163d7d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__module__info.html">ast_module_info</a> <a class="el" href="res__timing__timerfd_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a> = { .<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = AST_MODULE, .flags = AST_MODFLAG_DEFAULT , .<a class="el" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a> = &quot;Resource <a class="el" href="structlimits.html">limits</a>&quot; , .key = &quot;This paragraph is copyright (c) 2006 by Digium, Inc. \In order for your module to load, it must return this \key via a function called \&quot;key\&quot;. Any code which \includes this paragraph must be licensed under the GNU \General Public License <a class="el" href="res__config__pgsql_8c.html#aad880fc4455c253781e8968f2239d56f">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = &quot;aefddfaffd51bc118c14a748e96eb9a0&quot; , .load = load_module, .unload = unload_module, }<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__limit_8c_source.html#l00214">214</a> of file <a class="el" href="res__limit_8c_source.html">res_limit.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae25b9f3970870610911f8850897e8ead"></a><!-- doxytag: member="res_limit.c::ast_module_info" ref="ae25b9f3970870610911f8850897e8ead" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__module__info.html">ast_module_info</a>* <a class="el" href="structast__module__info.html">ast_module_info</a> = &amp;<a class="el" href="res__timing__timerfd_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__limit_8c_source.html#l00214">214</a> of file <a class="el" href="res__limit_8c_source.html">res_limit.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5d8312f7cd56d2e2e4ff65c76bfb9a55"></a><!-- doxytag: member="res_limit.c::cli_ulimit" ref="a5d8312f7cd56d2e2e4ff65c76bfb9a55" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> <a class="el" href="res__limit_8c.html#a5d8312f7cd56d2e2e4ff65c76bfb9a55">cli_ulimit</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment">
   <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="res__limit_8c.html#a5611403fddc200321397e8f94887d19f">handle_cli_ulimit</a>, <span class="stringliteral">&quot;Set or show process resource limits&quot;</span>)
</pre></div>
<p>Definition at line <a class="el" href="res__limit_8c_source.html#l00201">201</a> of file <a class="el" href="res__limit_8c_source.html">res_limit.c</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:23:15 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
