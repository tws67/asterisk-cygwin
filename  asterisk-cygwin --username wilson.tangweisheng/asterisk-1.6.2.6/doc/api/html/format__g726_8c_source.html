<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:18:40 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_82791ee1be5f6f515099a8d449099fbd.html">formats</a>
  </div>
</div>
<div class="contents">
<h1>format_g726.c</h1><a href="format__g726_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Asterisk -- An open source telephony toolkit.</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * Copyright (c) 2004 - 2005, inAccess Networks</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * Michael Manousos &lt;manousos@inaccessnetworks.com&gt;</span>
<a name="l00007"></a>00007 <span class="comment"> *</span>
<a name="l00008"></a>00008 <span class="comment"> * See http://www.asterisk.org for more information about</span>
<a name="l00009"></a>00009 <span class="comment"> * the Asterisk project. Please do not directly contact</span>
<a name="l00010"></a>00010 <span class="comment"> * any of the maintainers of this project for assistance;</span>
<a name="l00011"></a>00011 <span class="comment"> * the project provides a web site, mailing lists and IRC</span>
<a name="l00012"></a>00012 <span class="comment"> * channels for your use.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * This program is free software, distributed under the terms of</span>
<a name="l00015"></a>00015 <span class="comment"> * the GNU General Public License Version 2. See the LICENSE file</span>
<a name="l00016"></a>00016 <span class="comment"> * at the top of the source tree.</span>
<a name="l00017"></a>00017 <span class="comment"> */</span>
<a name="l00018"></a>00018 <span class="comment"></span>
<a name="l00019"></a>00019 <span class="comment">/*!\file</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * \brief Headerless G.726 (16/24/32/40kbps) data format for Asterisk.</span>
<a name="l00022"></a>00022 <span class="comment"> * </span>
<a name="l00023"></a>00023 <span class="comment"> * File name extensions:</span>
<a name="l00024"></a>00024 <span class="comment"> * \arg 40 kbps: g726-40</span>
<a name="l00025"></a>00025 <span class="comment"> * \arg 32 kbps: g726-32</span>
<a name="l00026"></a>00026 <span class="comment"> * \arg 24 kbps: g726-24</span>
<a name="l00027"></a>00027 <span class="comment"> * \arg 16 kbps: g726-16</span>
<a name="l00028"></a>00028 <span class="comment"> * \ingroup formats</span>
<a name="l00029"></a>00029 <span class="comment"> */</span>
<a name="l00030"></a>00030  
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="asterisk_8h.html" title="Asterisk main include file. File version handling, generic pbx functions.">asterisk.h</a>&quot;</span>
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 <a class="code" href="asterisk_8h.html#ab0390be60f8c539a2662df2faf9985c7" title="Register/unregister a source code file with the core.">ASTERISK_FILE_VERSION</a>(__FILE__, <span class="stringliteral">&quot;$Revision: 233694 $&quot;</span>)
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;asterisk/mod_format.h&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="module_8h.html" title="Asterisk module definitions.">asterisk/module.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="endian_8h.html" title="Asterisk architecture endianess compatibility definitions.">asterisk/endian.h</a>&quot;</span>
<a name="l00038"></a>00038 
<a name="l00039"></a><a class="code" href="format__g726_8c.html#ab7c94dc3bfc87ebe0fb0231f97369340">00039</a> <span class="preprocessor">#define  RATE_40     0</span>
<a name="l00040"></a><a class="code" href="format__g726_8c.html#a73141f840d28dfc4281378107511f96f">00040</a> <span class="preprocessor"></span><span class="preprocessor">#define  RATE_32     1</span>
<a name="l00041"></a><a class="code" href="format__g726_8c.html#ac20b1249c0fd8eafc13b049442067956">00041</a> <span class="preprocessor"></span><span class="preprocessor">#define  RATE_24     2</span>
<a name="l00042"></a><a class="code" href="format__g726_8c.html#a1087aa667d92790b51c67516d7bc02df">00042</a> <span class="preprocessor"></span><span class="preprocessor">#define  RATE_16     3</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span>
<a name="l00044"></a>00044 <span class="comment">/* We can only read/write chunks of FRAME_TIME ms G.726 data */</span>
<a name="l00045"></a><a class="code" href="format__g726_8c.html#ab50ebddbf2f210d61bcc9013973747a1">00045</a> <span class="preprocessor">#define  FRAME_TIME  10 </span><span class="comment">/* 10 ms size */</span>
<a name="l00046"></a>00046 
<a name="l00047"></a><a class="code" href="format__g726_8c.html#a6821bafc3c88dfb2e433a095df9940c6">00047</a> <span class="preprocessor">#define  BUF_SIZE (5*FRAME_TIME) </span><span class="comment">/* max frame size in bytes ? */</span>
<a name="l00048"></a>00048 <span class="comment">/* Frame sizes in bytes */</span>
<a name="l00049"></a><a class="code" href="format__g726_8c.html#ab9b9df9925ea7c54e551aa412bf0c59c">00049</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="format__g726_8c.html#ab9b9df9925ea7c54e551aa412bf0c59c">frame_size</a>[4] = { 
<a name="l00050"></a>00050       <a class="code" href="format__g726_8c.html#ab50ebddbf2f210d61bcc9013973747a1">FRAME_TIME</a> * 5,
<a name="l00051"></a>00051       <a class="code" href="format__g726_8c.html#ab50ebddbf2f210d61bcc9013973747a1">FRAME_TIME</a> * 4,
<a name="l00052"></a>00052       FRAME_TIME * 3,
<a name="l00053"></a>00053       FRAME_TIME * 2
<a name="l00054"></a>00054 };
<a name="l00055"></a>00055 
<a name="l00056"></a><a class="code" href="structg726__desc.html">00056</a> <span class="keyword">struct </span><a class="code" href="structg726__desc.html">g726_desc</a>  {
<a name="l00057"></a><a class="code" href="structg726__desc.html#a7a829e6fd74e94e0edf10550470d844c">00057</a>    <span class="keywordtype">int</span> <a class="code" href="structg726__desc.html#a7a829e6fd74e94e0edf10550470d844c">rate</a>;   <span class="comment">/* RATE_* defines */</span>
<a name="l00058"></a>00058 };
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="comment">/*</span>
<a name="l00061"></a>00061 <span class="comment"> * Rate dependant format functions (open, rewrite)</span>
<a name="l00062"></a>00062 <span class="comment"> */</span>
<a name="l00063"></a><a class="code" href="format__g726_8c.html#a5764901745e229298de45e6df97c3b49">00063</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="format__g726_8c.html#a5764901745e229298de45e6df97c3b49">g726_open</a>(<span class="keyword">struct</span> <a class="code" href="structast__filestream.html" title="This structure is allocated by file.c in one chunk, together with buf_size and desc_size...">ast_filestream</a> *tmp, <span class="keywordtype">int</span> rate)
<a name="l00064"></a>00064 {
<a name="l00065"></a>00065    <span class="keyword">struct </span><a class="code" href="structg726__desc.html">g726_desc</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a> = (<span class="keyword">struct </span><a class="code" href="structg726__desc.html">g726_desc</a> *)tmp-&gt;<a class="code" href="structast__filestream.html#a1cb76d737bf6f5b53e6c970073cba051">_private</a>;
<a name="l00066"></a>00066    s-&gt;<a class="code" href="structg726__desc.html#a7a829e6fd74e94e0edf10550470d844c">rate</a> = rate;
<a name="l00067"></a>00067    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Created filestream G.726-%dk.\n&quot;</span>, 40 - s-&gt;<a class="code" href="structg726__desc.html#a7a829e6fd74e94e0edf10550470d844c">rate</a> * 8);
<a name="l00068"></a>00068    <span class="keywordflow">return</span> 0;
<a name="l00069"></a>00069 }
<a name="l00070"></a>00070 
<a name="l00071"></a><a class="code" href="format__g726_8c.html#a62b044ad7452122a4680ab86149d5abf">00071</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="format__g726_8c.html#a62b044ad7452122a4680ab86149d5abf">g726_40_open</a>(<span class="keyword">struct</span> <a class="code" href="structast__filestream.html" title="This structure is allocated by file.c in one chunk, together with buf_size and desc_size...">ast_filestream</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l00072"></a>00072 {
<a name="l00073"></a>00073    <span class="keywordflow">return</span> <a class="code" href="format__g726_8c.html#a5764901745e229298de45e6df97c3b49">g726_open</a>(s, <a class="code" href="format__g726_8c.html#ab7c94dc3bfc87ebe0fb0231f97369340">RATE_40</a>);
<a name="l00074"></a>00074 }
<a name="l00075"></a>00075 
<a name="l00076"></a><a class="code" href="format__g726_8c.html#a39d66aef1ee7035c97dd0bd24441d0f0">00076</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="format__g726_8c.html#a39d66aef1ee7035c97dd0bd24441d0f0">g726_32_open</a>(<span class="keyword">struct</span> <a class="code" href="structast__filestream.html" title="This structure is allocated by file.c in one chunk, together with buf_size and desc_size...">ast_filestream</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l00077"></a>00077 {
<a name="l00078"></a>00078    <span class="keywordflow">return</span> <a class="code" href="format__g726_8c.html#a5764901745e229298de45e6df97c3b49">g726_open</a>(s, <a class="code" href="format__g726_8c.html#a73141f840d28dfc4281378107511f96f">RATE_32</a>);
<a name="l00079"></a>00079 }
<a name="l00080"></a>00080 
<a name="l00081"></a><a class="code" href="format__g726_8c.html#adf6d42e4ffdd9d2e582687cb75df87bc">00081</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="format__g726_8c.html#adf6d42e4ffdd9d2e582687cb75df87bc">g726_24_open</a>(<span class="keyword">struct</span> <a class="code" href="structast__filestream.html" title="This structure is allocated by file.c in one chunk, together with buf_size and desc_size...">ast_filestream</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l00082"></a>00082 {
<a name="l00083"></a>00083    <span class="keywordflow">return</span> <a class="code" href="format__g726_8c.html#a5764901745e229298de45e6df97c3b49">g726_open</a>(s, <a class="code" href="format__g726_8c.html#ac20b1249c0fd8eafc13b049442067956">RATE_24</a>);
<a name="l00084"></a>00084 }
<a name="l00085"></a>00085 
<a name="l00086"></a><a class="code" href="format__g726_8c.html#a8215b2657c18be3e30464397d9197174">00086</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="format__g726_8c.html#a8215b2657c18be3e30464397d9197174">g726_16_open</a>(<span class="keyword">struct</span> <a class="code" href="structast__filestream.html" title="This structure is allocated by file.c in one chunk, together with buf_size and desc_size...">ast_filestream</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l00087"></a>00087 {
<a name="l00088"></a>00088    <span class="keywordflow">return</span> <a class="code" href="format__g726_8c.html#a5764901745e229298de45e6df97c3b49">g726_open</a>(s, <a class="code" href="format__g726_8c.html#a1087aa667d92790b51c67516d7bc02df">RATE_16</a>);
<a name="l00089"></a>00089 }
<a name="l00090"></a>00090 
<a name="l00091"></a><a class="code" href="format__g726_8c.html#a4eb6a5d5025d979f0beaf666b25cc7c7">00091</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="format__g726_8c.html#a4eb6a5d5025d979f0beaf666b25cc7c7">g726_40_rewrite</a>(<span class="keyword">struct</span> <a class="code" href="structast__filestream.html" title="This structure is allocated by file.c in one chunk, together with buf_size and desc_size...">ast_filestream</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ael__lex_8c.html#a43be22b7a1b528eaf759e034ec581543">comment</a>)
<a name="l00092"></a>00092 {
<a name="l00093"></a>00093    <span class="keywordflow">return</span> <a class="code" href="format__g726_8c.html#a5764901745e229298de45e6df97c3b49">g726_open</a>(s, <a class="code" href="format__g726_8c.html#ab7c94dc3bfc87ebe0fb0231f97369340">RATE_40</a>);
<a name="l00094"></a>00094 }
<a name="l00095"></a>00095 
<a name="l00096"></a><a class="code" href="format__g726_8c.html#abe1bd13e1a6af2fd88a6cb2cb51f3677">00096</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="format__g726_8c.html#abe1bd13e1a6af2fd88a6cb2cb51f3677">g726_32_rewrite</a>(<span class="keyword">struct</span> <a class="code" href="structast__filestream.html" title="This structure is allocated by file.c in one chunk, together with buf_size and desc_size...">ast_filestream</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ael__lex_8c.html#a43be22b7a1b528eaf759e034ec581543">comment</a>)
<a name="l00097"></a>00097 {
<a name="l00098"></a>00098    <span class="keywordflow">return</span> <a class="code" href="format__g726_8c.html#a5764901745e229298de45e6df97c3b49">g726_open</a>(s, <a class="code" href="format__g726_8c.html#a73141f840d28dfc4281378107511f96f">RATE_32</a>);
<a name="l00099"></a>00099 }
<a name="l00100"></a>00100 
<a name="l00101"></a><a class="code" href="format__g726_8c.html#a8bc4350160c588b9550c862c99987939">00101</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="format__g726_8c.html#a8bc4350160c588b9550c862c99987939">g726_24_rewrite</a>(<span class="keyword">struct</span> <a class="code" href="structast__filestream.html" title="This structure is allocated by file.c in one chunk, together with buf_size and desc_size...">ast_filestream</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ael__lex_8c.html#a43be22b7a1b528eaf759e034ec581543">comment</a>)
<a name="l00102"></a>00102 {
<a name="l00103"></a>00103    <span class="keywordflow">return</span> <a class="code" href="format__g726_8c.html#a5764901745e229298de45e6df97c3b49">g726_open</a>(s, <a class="code" href="format__g726_8c.html#ac20b1249c0fd8eafc13b049442067956">RATE_24</a>);
<a name="l00104"></a>00104 }
<a name="l00105"></a>00105 
<a name="l00106"></a><a class="code" href="format__g726_8c.html#ab3f300755054be917d730869c10bcdc3">00106</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="format__g726_8c.html#ab3f300755054be917d730869c10bcdc3">g726_16_rewrite</a>(<span class="keyword">struct</span> <a class="code" href="structast__filestream.html" title="This structure is allocated by file.c in one chunk, together with buf_size and desc_size...">ast_filestream</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ael__lex_8c.html#a43be22b7a1b528eaf759e034ec581543">comment</a>)
<a name="l00107"></a>00107 {
<a name="l00108"></a>00108    <span class="keywordflow">return</span> <a class="code" href="format__g726_8c.html#a5764901745e229298de45e6df97c3b49">g726_open</a>(s, <a class="code" href="format__g726_8c.html#a1087aa667d92790b51c67516d7bc02df">RATE_16</a>);
<a name="l00109"></a>00109 }
<a name="l00110"></a>00110 
<a name="l00111"></a>00111 <span class="comment">/*</span>
<a name="l00112"></a>00112 <span class="comment"> * Rate independent format functions (read, write)</span>
<a name="l00113"></a>00113 <span class="comment"> */</span>
<a name="l00114"></a>00114 
<a name="l00115"></a><a class="code" href="format__g726_8c.html#a9653eed28b20792a67d0171c470b54d7">00115</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a9653eed28b20792a67d0171c470b54d7">g726_read</a>(<span class="keyword">struct</span> <a class="code" href="structast__filestream.html" title="This structure is allocated by file.c in one chunk, together with buf_size and desc_size...">ast_filestream</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, <span class="keywordtype">int</span> *whennext)
<a name="l00116"></a>00116 {
<a name="l00117"></a>00117    <span class="keywordtype">int</span> res;
<a name="l00118"></a>00118    <span class="keyword">struct </span><a class="code" href="structg726__desc.html">g726_desc</a> *fs = (<span class="keyword">struct </span><a class="code" href="structg726__desc.html">g726_desc</a> *)s-&gt;<a class="code" href="structast__filestream.html#a1cb76d737bf6f5b53e6c970073cba051">_private</a>;
<a name="l00119"></a>00119 
<a name="l00120"></a>00120    <span class="comment">/* Send a frame from the file to the appropriate channel */</span>
<a name="l00121"></a>00121    s-&gt;<a class="code" href="structast__filestream.html#a0e0e3398d4f54057ddca440cae05f3d4">fr</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>;
<a name="l00122"></a>00122    s-&gt;<a class="code" href="structast__filestream.html#a0e0e3398d4f54057ddca440cae05f3d4">fr</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="frame_8h.html#a030c77081bc2aff5ae5a384769f46418">AST_FORMAT_G726</a>;
<a name="l00123"></a>00123    s-&gt;<a class="code" href="structast__filestream.html#a0e0e3398d4f54057ddca440cae05f3d4">fr</a>.<a class="code" href="structast__frame.html#aed16590d48f41d89f31e0cf347f5cd99">mallocd</a> = 0;
<a name="l00124"></a>00124    <a class="code" href="frame_8h.html#ac8bc210573f6b9c55ef38662bddc4675">AST_FRAME_SET_BUFFER</a>(&amp;s-&gt;<a class="code" href="structast__filestream.html#a0e0e3398d4f54057ddca440cae05f3d4">fr</a>, s-&gt;<a class="code" href="structast__filestream.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>, <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>, frame_size[fs-&gt;<a class="code" href="structg726__desc.html#a7a829e6fd74e94e0edf10550470d844c">rate</a>]);
<a name="l00125"></a>00125    s-&gt;<a class="code" href="structast__filestream.html#a0e0e3398d4f54057ddca440cae05f3d4">fr</a>.<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> = 8 * <a class="code" href="format__g726_8c.html#ab50ebddbf2f210d61bcc9013973747a1">FRAME_TIME</a>;
<a name="l00126"></a>00126    <span class="keywordflow">if</span> ((res = fread(s-&gt;<a class="code" href="structast__filestream.html#a0e0e3398d4f54057ddca440cae05f3d4">fr</a>.<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, 1, s-&gt;<a class="code" href="structast__filestream.html#a0e0e3398d4f54057ddca440cae05f3d4">fr</a>.<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>, s-&gt;<a class="code" href="structast__filestream.html#a3efb0e1a16208deecbd84c15401f7cf8">f</a>)) != s-&gt;<a class="code" href="structast__filestream.html#a0e0e3398d4f54057ddca440cae05f3d4">fr</a>.<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>) {
<a name="l00127"></a>00127       <span class="keywordflow">if</span> (res)
<a name="l00128"></a>00128          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Short read (%d) (%s)!\n&quot;</span>, res, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l00129"></a>00129       <span class="keywordflow">return</span> NULL;
<a name="l00130"></a>00130    }
<a name="l00131"></a>00131    *whennext = s-&gt;<a class="code" href="structast__filestream.html#a0e0e3398d4f54057ddca440cae05f3d4">fr</a>.<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>;
<a name="l00132"></a>00132    <span class="keywordflow">return</span> &amp;s-&gt;<a class="code" href="structast__filestream.html#a0e0e3398d4f54057ddca440cae05f3d4">fr</a>;
<a name="l00133"></a>00133 }
<a name="l00134"></a>00134 
<a name="l00135"></a><a class="code" href="format__g726_8c.html#a4babfc8a9765801eb0dadb6194fbf643">00135</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="format__g726_8c.html#a4babfc8a9765801eb0dadb6194fbf643">g726_write</a>(<span class="keyword">struct</span> <a class="code" href="structast__filestream.html" title="This structure is allocated by file.c in one chunk, together with buf_size and desc_size...">ast_filestream</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>)
<a name="l00136"></a>00136 {
<a name="l00137"></a>00137    <span class="keywordtype">int</span> res;
<a name="l00138"></a>00138    <span class="keyword">struct </span><a class="code" href="structg726__desc.html">g726_desc</a> *fs = (<span class="keyword">struct </span><a class="code" href="structg726__desc.html">g726_desc</a> *)s-&gt;<a class="code" href="structast__filestream.html#a1cb76d737bf6f5b53e6c970073cba051">_private</a>;
<a name="l00139"></a>00139 
<a name="l00140"></a>00140    if (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> != <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>) {
<a name="l00141"></a>00141       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Asked to write non-voice frame!\n&quot;</span>);
<a name="l00142"></a>00142       <span class="keywordflow">return</span> -1;
<a name="l00143"></a>00143    }
<a name="l00144"></a>00144    <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> != <a class="code" href="frame_8h.html#a030c77081bc2aff5ae5a384769f46418">AST_FORMAT_G726</a>) {
<a name="l00145"></a>00145       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Asked to write non-G726 frame (%d)!\n&quot;</span>, 
<a name="l00146"></a>00146                   f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>);
<a name="l00147"></a>00147       <span class="keywordflow">return</span> -1;
<a name="l00148"></a>00148    }
<a name="l00149"></a>00149    <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> % frame_size[fs-&gt;<a class="code" href="structg726__desc.html#a7a829e6fd74e94e0edf10550470d844c">rate</a>]) {
<a name="l00150"></a>00150       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid data length %d, should be multiple of %d\n&quot;</span>, 
<a name="l00151"></a>00151                   f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>, frame_size[fs-&gt;<a class="code" href="structg726__desc.html#a7a829e6fd74e94e0edf10550470d844c">rate</a>]);
<a name="l00152"></a>00152       <span class="keywordflow">return</span> -1;
<a name="l00153"></a>00153    }
<a name="l00154"></a>00154    <span class="keywordflow">if</span> ((res = <a class="code" href="ast__expr2f_8c.html#a8541b986268a39ba1b07d9e912d31732">fwrite</a>(f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, 1, f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>, s-&gt;<a class="code" href="structast__filestream.html#a3efb0e1a16208deecbd84c15401f7cf8">f</a>)) != f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>) {
<a name="l00155"></a>00155       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Bad write (%d/%d): %s\n&quot;</span>, 
<a name="l00156"></a>00156             res, frame_size[fs-&gt;<a class="code" href="structg726__desc.html#a7a829e6fd74e94e0edf10550470d844c">rate</a>], strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l00157"></a>00157          <span class="keywordflow">return</span> -1;
<a name="l00158"></a>00158    }
<a name="l00159"></a>00159    <span class="keywordflow">return</span> 0;
<a name="l00160"></a>00160 }
<a name="l00161"></a>00161 
<a name="l00162"></a><a class="code" href="format__g726_8c.html#af2b256607d4d270301e19713b35b26cf">00162</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="format__g726_8c.html#af2b256607d4d270301e19713b35b26cf">g726_seek</a>(<span class="keyword">struct</span> <a class="code" href="structast__filestream.html" title="This structure is allocated by file.c in one chunk, together with buf_size and desc_size...">ast_filestream</a> *fs, off_t sample_offset, <span class="keywordtype">int</span> whence)
<a name="l00163"></a>00163 {
<a name="l00164"></a>00164    <span class="keywordflow">return</span> -1;
<a name="l00165"></a>00165 }
<a name="l00166"></a>00166 
<a name="l00167"></a><a class="code" href="format__g726_8c.html#ad57e5da7a691976a62a854532274094c">00167</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="format__g726_8c.html#ad57e5da7a691976a62a854532274094c">g726_trunc</a>(<span class="keyword">struct</span> <a class="code" href="structast__filestream.html" title="This structure is allocated by file.c in one chunk, together with buf_size and desc_size...">ast_filestream</a> *fs)
<a name="l00168"></a>00168 {
<a name="l00169"></a>00169    <span class="keywordflow">return</span> -1;
<a name="l00170"></a>00170 }
<a name="l00171"></a>00171 
<a name="l00172"></a><a class="code" href="format__g726_8c.html#ae9098dc116d3142337387302d56ba2c9">00172</a> <span class="keyword">static</span> off_t <a class="code" href="format__g726_8c.html#ae9098dc116d3142337387302d56ba2c9">g726_tell</a>(<span class="keyword">struct</span> <a class="code" href="structast__filestream.html" title="This structure is allocated by file.c in one chunk, together with buf_size and desc_size...">ast_filestream</a> *fs)
<a name="l00173"></a>00173 {
<a name="l00174"></a>00174    <span class="keywordflow">return</span> -1;
<a name="l00175"></a>00175 }
<a name="l00176"></a>00176 
<a name="l00177"></a><a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">00177</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structast__format.html" title="Each supported file format is described by the following structure.">ast_format</a> <a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>[] = {
<a name="l00178"></a>00178    {
<a name="l00179"></a>00179       .<a class="code" href="structast__format.html#a3777dbae63a15da001b2baa317a25149">name</a> = <span class="stringliteral">&quot;g726-40&quot;</span>,
<a name="l00180"></a>00180       .exts = <span class="stringliteral">&quot;g726-40&quot;</span>,
<a name="l00181"></a>00181       .format = <a class="code" href="frame_8h.html#a030c77081bc2aff5ae5a384769f46418">AST_FORMAT_G726</a>,
<a name="l00182"></a>00182       .open = <a class="code" href="format__g726_8c.html#a62b044ad7452122a4680ab86149d5abf">g726_40_open</a>,
<a name="l00183"></a>00183       .rewrite = <a class="code" href="format__g726_8c.html#a4eb6a5d5025d979f0beaf666b25cc7c7">g726_40_rewrite</a>,
<a name="l00184"></a>00184       .write = <a class="code" href="format__g726_8c.html#a4babfc8a9765801eb0dadb6194fbf643">g726_write</a>,
<a name="l00185"></a>00185       .seek = <a class="code" href="format__g726_8c.html#af2b256607d4d270301e19713b35b26cf">g726_seek</a>,
<a name="l00186"></a>00186       .trunc = <a class="code" href="format__g726_8c.html#ad57e5da7a691976a62a854532274094c">g726_trunc</a>,
<a name="l00187"></a>00187       .tell = <a class="code" href="format__g726_8c.html#ae9098dc116d3142337387302d56ba2c9">g726_tell</a>,
<a name="l00188"></a>00188       .read = <a class="code" href="format__g726_8c.html#a9653eed28b20792a67d0171c470b54d7">g726_read</a>,
<a name="l00189"></a>00189       .buf_size = <a class="code" href="format__g726_8c.html#a6821bafc3c88dfb2e433a095df9940c6">BUF_SIZE</a> + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>,
<a name="l00190"></a>00190       .desc_size = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structg726__desc.html">g726_desc</a>),
<a name="l00191"></a>00191    },
<a name="l00192"></a>00192    {
<a name="l00193"></a>00193       .name = <span class="stringliteral">&quot;g726-32&quot;</span>,
<a name="l00194"></a>00194       .exts = <span class="stringliteral">&quot;g726-32&quot;</span>,
<a name="l00195"></a>00195       .format = <a class="code" href="frame_8h.html#a030c77081bc2aff5ae5a384769f46418">AST_FORMAT_G726</a>,
<a name="l00196"></a>00196       .open = <a class="code" href="format__g726_8c.html#a39d66aef1ee7035c97dd0bd24441d0f0">g726_32_open</a>,
<a name="l00197"></a>00197       .rewrite = <a class="code" href="format__g726_8c.html#abe1bd13e1a6af2fd88a6cb2cb51f3677">g726_32_rewrite</a>,
<a name="l00198"></a>00198       .write = <a class="code" href="format__g726_8c.html#a4babfc8a9765801eb0dadb6194fbf643">g726_write</a>,
<a name="l00199"></a>00199       .seek = <a class="code" href="format__g726_8c.html#af2b256607d4d270301e19713b35b26cf">g726_seek</a>,
<a name="l00200"></a>00200       .trunc = <a class="code" href="format__g726_8c.html#ad57e5da7a691976a62a854532274094c">g726_trunc</a>,
<a name="l00201"></a>00201       .tell = <a class="code" href="format__g726_8c.html#ae9098dc116d3142337387302d56ba2c9">g726_tell</a>,
<a name="l00202"></a>00202       .read = <a class="code" href="format__g726_8c.html#a9653eed28b20792a67d0171c470b54d7">g726_read</a>,
<a name="l00203"></a>00203       .buf_size = <a class="code" href="format__g726_8c.html#a6821bafc3c88dfb2e433a095df9940c6">BUF_SIZE</a> + AST_FRIENDLY_OFFSET,
<a name="l00204"></a>00204       .desc_size = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structg726__desc.html">g726_desc</a>),
<a name="l00205"></a>00205    },
<a name="l00206"></a>00206    {
<a name="l00207"></a>00207       .name = <span class="stringliteral">&quot;g726-24&quot;</span>,
<a name="l00208"></a>00208       .exts = <span class="stringliteral">&quot;g726-24&quot;</span>,
<a name="l00209"></a>00209       .format = <a class="code" href="frame_8h.html#a030c77081bc2aff5ae5a384769f46418">AST_FORMAT_G726</a>,
<a name="l00210"></a>00210       .open = <a class="code" href="format__g726_8c.html#adf6d42e4ffdd9d2e582687cb75df87bc">g726_24_open</a>,
<a name="l00211"></a>00211       .rewrite = <a class="code" href="format__g726_8c.html#a8bc4350160c588b9550c862c99987939">g726_24_rewrite</a>,
<a name="l00212"></a>00212       .write = <a class="code" href="format__g726_8c.html#a4babfc8a9765801eb0dadb6194fbf643">g726_write</a>,
<a name="l00213"></a>00213       .seek = <a class="code" href="format__g726_8c.html#af2b256607d4d270301e19713b35b26cf">g726_seek</a>,
<a name="l00214"></a>00214       .trunc = <a class="code" href="format__g726_8c.html#ad57e5da7a691976a62a854532274094c">g726_trunc</a>,
<a name="l00215"></a>00215       .tell = <a class="code" href="format__g726_8c.html#ae9098dc116d3142337387302d56ba2c9">g726_tell</a>,
<a name="l00216"></a>00216       .read = <a class="code" href="format__g726_8c.html#a9653eed28b20792a67d0171c470b54d7">g726_read</a>,
<a name="l00217"></a>00217       .buf_size = <a class="code" href="format__g726_8c.html#a6821bafc3c88dfb2e433a095df9940c6">BUF_SIZE</a> + AST_FRIENDLY_OFFSET,
<a name="l00218"></a>00218       .desc_size = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structg726__desc.html">g726_desc</a>),
<a name="l00219"></a>00219    },
<a name="l00220"></a>00220    {
<a name="l00221"></a>00221       .name = <span class="stringliteral">&quot;g726-16&quot;</span>,
<a name="l00222"></a>00222       .exts = <span class="stringliteral">&quot;g726-16&quot;</span>,
<a name="l00223"></a>00223       .format = <a class="code" href="frame_8h.html#a030c77081bc2aff5ae5a384769f46418">AST_FORMAT_G726</a>,
<a name="l00224"></a>00224       .open = <a class="code" href="format__g726_8c.html#a8215b2657c18be3e30464397d9197174">g726_16_open</a>,
<a name="l00225"></a>00225       .rewrite = <a class="code" href="format__g726_8c.html#ab3f300755054be917d730869c10bcdc3">g726_16_rewrite</a>,
<a name="l00226"></a>00226       .write = <a class="code" href="format__g726_8c.html#a4babfc8a9765801eb0dadb6194fbf643">g726_write</a>,
<a name="l00227"></a>00227       .seek = <a class="code" href="format__g726_8c.html#af2b256607d4d270301e19713b35b26cf">g726_seek</a>,
<a name="l00228"></a>00228       .trunc = <a class="code" href="format__g726_8c.html#ad57e5da7a691976a62a854532274094c">g726_trunc</a>,
<a name="l00229"></a>00229       .tell = <a class="code" href="format__g726_8c.html#ae9098dc116d3142337387302d56ba2c9">g726_tell</a>,
<a name="l00230"></a>00230       .read = <a class="code" href="format__g726_8c.html#a9653eed28b20792a67d0171c470b54d7">g726_read</a>,
<a name="l00231"></a>00231       .buf_size = <a class="code" href="format__g726_8c.html#a6821bafc3c88dfb2e433a095df9940c6">BUF_SIZE</a> + AST_FRIENDLY_OFFSET,
<a name="l00232"></a>00232       .desc_size = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structg726__desc.html">g726_desc</a>),
<a name="l00233"></a>00233    },
<a name="l00234"></a>00234    {  .format = 0 }  <span class="comment">/* terminator */</span>
<a name="l00235"></a>00235 };
<a name="l00236"></a>00236 
<a name="l00237"></a><a class="code" href="format__g726_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">00237</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="format__g726_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>(<span class="keywordtype">void</span>)
<a name="l00238"></a>00238 {
<a name="l00239"></a>00239    <span class="keywordtype">int</span> i;
<a name="l00240"></a>00240 
<a name="l00241"></a>00241    <span class="keywordflow">for</span> (i = 0; f[i].<a class="code" href="structast__format.html#a317afff57d87a89158c2b038d37b2b08">format</a> ; i++) {
<a name="l00242"></a>00242       <span class="keywordflow">if</span> (<a class="code" href="mod__format_8h.html#a6f9f0f613a5ada6d99ac365ad62ea713">ast_format_register</a>(&amp;f[i])) {   <span class="comment">/* errors are fatal */</span>
<a name="l00243"></a>00243          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to register format %s.\n&quot;</span>, f[i].<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l00244"></a>00244          <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa8724da3ad620df86524280e760add388">AST_MODULE_LOAD_FAILURE</a>;
<a name="l00245"></a>00245       }
<a name="l00246"></a>00246    }
<a name="l00247"></a>00247    <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a>;
<a name="l00248"></a>00248 }
<a name="l00249"></a>00249 
<a name="l00250"></a><a class="code" href="format__g726_8c.html#ad09fa931f468002152a3cc2d5ce25eae">00250</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="agent_8c.html#a95bac1db604c69a01ef7b3995342cd7a">unload_module</a>(<span class="keywordtype">void</span>)
<a name="l00251"></a>00251 {
<a name="l00252"></a>00252    <span class="keywordtype">int</span> i;
<a name="l00253"></a>00253 
<a name="l00254"></a>00254    <span class="keywordflow">for</span> (i = 0; f[i].<a class="code" href="structast__format.html#a317afff57d87a89158c2b038d37b2b08">format</a> ; i++) {
<a name="l00255"></a>00255       <span class="keywordflow">if</span> (<a class="code" href="mod__format_8h.html#a356574c4ec4b2e89b8128b86b086af4e" title="Unregisters a file format.">ast_format_unregister</a>(f[i].<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>))
<a name="l00256"></a>00256          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to unregister format %s.\n&quot;</span>, f[i].name);
<a name="l00257"></a>00257    }
<a name="l00258"></a>00258    <span class="keywordflow">return</span>(0);
<a name="l00259"></a>00259 }  
<a name="l00260"></a>00260 
<a name="l00261"></a>00261 <a class="code" href="module_8h.html#a9f4aa0e21486bdbcef428335268690c9">AST_MODULE_INFO</a>(<a class="code" href="module_8h.html#aba2c8d4be709a254658b21a834f8294a" title="The text the key() function should return.">ASTERISK_GPL_KEY</a>, <a class="code" href="module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a>, <span class="stringliteral">&quot;Raw G.726 (16/24/32/40kbps) data&quot;</span>,
<a name="l00262"></a>00262    .load = <a class="code" href="format__g726_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>,
<a name="l00263"></a>00263    .unload = <a class="code" href="agent_8c.html#a95bac1db604c69a01ef7b3995342cd7a">unload_module</a>,
<a name="l00264"></a>00264    .load_pri = 10,
<a name="l00265"></a>00265 );
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:18:40 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
