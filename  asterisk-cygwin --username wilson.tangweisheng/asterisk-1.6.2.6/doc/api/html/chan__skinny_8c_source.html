<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:18:36 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_0ca6ff3bf6b340411b2c6edd15b1a34d.html">channels</a>
  </div>
</div>
<div class="contents">
<h1>chan_skinny.c</h1><a href="chan__skinny_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Asterisk -- An open source telephony toolkit.</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * Copyright (C) 1999 - 2005, Digium, Inc.</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * chan_skinny was developed by Jeremy McNamara &amp; Florian Overkamp</span>
<a name="l00007"></a>00007 <span class="comment"> * chan_skinny was heavily modified/fixed by North Antara</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * See http://www.asterisk.org for more information about</span>
<a name="l00010"></a>00010 <span class="comment"> * the Asterisk project. Please do not directly contact</span>
<a name="l00011"></a>00011 <span class="comment"> * any of the maintainers of this project for assistance;</span>
<a name="l00012"></a>00012 <span class="comment"> * the project provides a web site, mailing lists and IRC</span>
<a name="l00013"></a>00013 <span class="comment"> * channels for your use.</span>
<a name="l00014"></a>00014 <span class="comment"> *</span>
<a name="l00015"></a>00015 <span class="comment"> * This program is free software, distributed under the terms of</span>
<a name="l00016"></a>00016 <span class="comment"> * the GNU General Public License Version 2. See the LICENSE file</span>
<a name="l00017"></a>00017 <span class="comment"> * at the top of the source tree.</span>
<a name="l00018"></a>00018 <span class="comment"> */</span>
<a name="l00019"></a>00019 <span class="comment"></span>
<a name="l00020"></a>00020 <span class="comment">/*! \file</span>
<a name="l00021"></a>00021 <span class="comment"> *</span>
<a name="l00022"></a>00022 <span class="comment"> * \brief Implementation of the Skinny protocol</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> * \author Jeremy McNamara &amp; Florian Overkamp &amp; North Antara</span>
<a name="l00025"></a>00025 <span class="comment"> * \ingroup channel_drivers</span>
<a name="l00026"></a>00026 <span class="comment"> */</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="asterisk_8h.html" title="Asterisk main include file. File version handling, generic pbx functions.">asterisk.h</a>&quot;</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <a class="code" href="asterisk_8h.html#ab0390be60f8c539a2662df2faf9985c7" title="Register/unregister a source code file with the core.">ASTERISK_FILE_VERSION</a>(__FILE__, <span class="stringliteral">&quot;$Revision: 249895 $&quot;</span>)
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;sys/socket.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span><span class="preprocessor">#include &lt;netinet/in.h&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;netinet/tcp.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;sys/ioctl.h&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;net/if.h&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;fcntl.h&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;netdb.h&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;arpa/inet.h&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;sys/signal.h&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;signal.h&gt;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &lt;ctype.h&gt;</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="lock_8h.html" title="Asterisk locking-related definitions:ast_mutext_t, ast_rwlock_t and related functions;atomic...">asterisk/lock.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="channel_8h.html" title="General Asterisk PBX channel definitions.">asterisk/channel.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="config_8h.html" title="Configuration File Parser.">asterisk/config.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="module_8h.html" title="Asterisk module definitions.">asterisk/module.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="pbx_8h.html" title="Core PBX routines and definitions.">asterisk/pbx.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="sched_8h.html" title="Scheduler Routines (derived from cheops).">asterisk/sched.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="io_8h.html" title="I/O Management (derived from Cheops-NG).">asterisk/io.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="rtp_8h.html" title="Supports RTP and RTCP with Symmetric RTP support for NAT traversal.">asterisk/rtp.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="netsock_8h.html" title="Network socket handling.">asterisk/netsock.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="acl_8h.html" title="Access Control of various sorts.">asterisk/acl.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="callerid_8h.html" title="CallerID (and other GR30) management and generation Includes code and algorithms...">asterisk/callerid.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="cli_8h.html" title="Standard Command Line Interface.">asterisk/cli.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="manager_8h.html" title="The AMI - Asterisk Manager Interface - is a TCP protocol created to manage Asterisk...">asterisk/manager.h</a>&quot;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="say_8h.html" title="Say numbers and dates (maybe words one day too).">asterisk/say.h</a>&quot;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;<a class="code" href="cdr_8h.html" title="Call Detail Record API.">asterisk/cdr.h</a>&quot;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="astdb_8h.html" title="Persistant data storage (akin to *doze registry).">asterisk/astdb.h</a>&quot;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="features_8h.html" title="Call Parking and Pickup API Includes code and algorithms from the Zapata library...">asterisk/features.h</a>&quot;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="app_8h.html" title="Application convenience functions, designed to give consistent look and feel to Asterisk...">asterisk/app.h</a>&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="musiconhold_8h.html" title="Music on hold handling.">asterisk/musiconhold.h</a>&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="utils_8h.html" title="Utility functions.">asterisk/utils.h</a>&quot;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="dsp_8h.html" title="Convenient Signal Processing routines.">asterisk/dsp.h</a>&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;<a class="code" href="stringfields_8h.html" title="String fields in structures.">asterisk/stringfields.h</a>&quot;</span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;<a class="code" href="abstract__jb_8h.html" title="Common implementation-independent jitterbuffer stuff.">asterisk/abstract_jb.h</a>&quot;</span>
<a name="l00068"></a>00068 <span class="preprocessor">#include &quot;<a class="code" href="threadstorage_8h.html" title="Definitions to aid in the use of thread local storage.">asterisk/threadstorage.h</a>&quot;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include &quot;<a class="code" href="devicestate_8h.html" title="Device state management.">asterisk/devicestate.h</a>&quot;</span>
<a name="l00070"></a>00070 <span class="preprocessor">#include &quot;<a class="code" href="event_8h.html">asterisk/event.h</a>&quot;</span>
<a name="l00071"></a>00071 <span class="preprocessor">#include &quot;<a class="code" href="indications_8h.html" title="Tone Indication Support.">asterisk/indications.h</a>&quot;</span>
<a name="l00072"></a>00072 <span class="preprocessor">#include &quot;<a class="code" href="linkedlists_8h.html" title="A set of macros to manage forward-linked lists.">asterisk/linkedlists.h</a>&quot;</span>
<a name="l00073"></a>00073 
<a name="l00074"></a>00074 <span class="preprocessor">#ifdef SKINNY_DEVMODE</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVONLY(code)  \</span>
<a name="l00076"></a>00076 <span class="preprocessor">   code</span>
<a name="l00077"></a>00077 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00078"></a><a class="code" href="chan__skinny_8c.html#af74ed86d376b6d64e63fa69f16d4ce1f">00078</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVONLY(code)</span>
<a name="l00079"></a>00079 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00080"></a>00080 <span class="preprocessor"></span>
<a name="l00081"></a>00081 <span class="comment">/*************************************</span>
<a name="l00082"></a>00082 <span class="comment"> * Skinny/Asterisk Protocol Settings *</span>
<a name="l00083"></a>00083 <span class="comment"> *************************************/</span>
<a name="l00084"></a><a class="code" href="chan__skinny_8c.html#a71535bf985a1a06d548fd73a0a0ec32c">00084</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="app__voicemail_8c.html#adb02bb3719cdf90c200c1ca30caa26a2">tdesc</a>[] = <span class="stringliteral">&quot;Skinny Client Control Protocol (Skinny)&quot;</span>;
<a name="l00085"></a><a class="code" href="chan__skinny_8c.html#a9ee8d742a1fbcff45f97842b92952610">00085</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="chan__skinny_8c.html#a9ee8d742a1fbcff45f97842b92952610">config</a>[] = <span class="stringliteral">&quot;skinny.conf&quot;</span>;
<a name="l00086"></a>00086 
<a name="l00087"></a><a class="code" href="chan__skinny_8c.html#aa3cf69d5b7888322971cac1bf8dd8ed0">00087</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#aa3cf69d5b7888322971cac1bf8dd8ed0">default_capability</a> = <a class="code" href="frame_8h.html#ab602cf455d4a96a3adba2e3ba8cd2b2c">AST_FORMAT_ULAW</a> | <a class="code" href="frame_8h.html#aa58cc980a9c9108522effc64e9aff2d6">AST_FORMAT_ALAW</a>;
<a name="l00088"></a><a class="code" href="chan__skinny_8c.html#a8825096054254f7ab84afdfe5083f564">00088</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__codec__pref.html">ast_codec_pref</a> <a class="code" href="chan__skinny_8c.html#a8825096054254f7ab84afdfe5083f564">default_prefs</a>;
<a name="l00089"></a>00089 
<a name="l00090"></a><a class="code" href="chan__skinny_8c.html#a844a39ac2662cbc0d7eaa6122ac5ae71">00090</a> <span class="keyword">enum</span> <a class="code" href="chan__skinny_8c.html#a844a39ac2662cbc0d7eaa6122ac5ae71">skinny_codecs</a> {
<a name="l00091"></a><a class="code" href="chan__skinny_8c.html#a844a39ac2662cbc0d7eaa6122ac5ae71ac9f09a33a0a55d0ae8035371435217bd">00091</a>    <a class="code" href="chan__skinny_8c.html#a844a39ac2662cbc0d7eaa6122ac5ae71ac9f09a33a0a55d0ae8035371435217bd">SKINNY_CODEC_ALAW</a> = 2,
<a name="l00092"></a><a class="code" href="chan__skinny_8c.html#a844a39ac2662cbc0d7eaa6122ac5ae71a4e2f1fe7a095d3200609ba5b38443831">00092</a>    <a class="code" href="chan__skinny_8c.html#a844a39ac2662cbc0d7eaa6122ac5ae71a4e2f1fe7a095d3200609ba5b38443831">SKINNY_CODEC_ULAW</a> = 4,
<a name="l00093"></a><a class="code" href="chan__skinny_8c.html#a844a39ac2662cbc0d7eaa6122ac5ae71a78f84a441f7ee1fd3dc5e4e5b806a07d">00093</a>    <a class="code" href="chan__skinny_8c.html#a844a39ac2662cbc0d7eaa6122ac5ae71a78f84a441f7ee1fd3dc5e4e5b806a07d">SKINNY_CODEC_G723_1</a> = 9,
<a name="l00094"></a><a class="code" href="chan__skinny_8c.html#a844a39ac2662cbc0d7eaa6122ac5ae71a6cb2cab00c618310f5cb9f3d52bda154">00094</a>    <a class="code" href="chan__skinny_8c.html#a844a39ac2662cbc0d7eaa6122ac5ae71a6cb2cab00c618310f5cb9f3d52bda154">SKINNY_CODEC_G729A</a> = 12,
<a name="l00095"></a><a class="code" href="chan__skinny_8c.html#a844a39ac2662cbc0d7eaa6122ac5ae71ac4fa98d11dc256eb65904786fbc28517">00095</a>    <a class="code" href="chan__skinny_8c.html#a844a39ac2662cbc0d7eaa6122ac5ae71ac4fa98d11dc256eb65904786fbc28517">SKINNY_CODEC_G726_32</a> = 82, <span class="comment">/* XXX Which packing order does this translate to? */</span>
<a name="l00096"></a><a class="code" href="chan__skinny_8c.html#a844a39ac2662cbc0d7eaa6122ac5ae71a48e1eb3a3d96993b9754643d9ec3c950">00096</a>    <a class="code" href="chan__skinny_8c.html#a844a39ac2662cbc0d7eaa6122ac5ae71a48e1eb3a3d96993b9754643d9ec3c950">SKINNY_CODEC_H261</a> = 100,
<a name="l00097"></a><a class="code" href="chan__skinny_8c.html#a844a39ac2662cbc0d7eaa6122ac5ae71a4d00a1ea7a1cdd28f6d452057c01f665">00097</a>    <a class="code" href="chan__skinny_8c.html#a844a39ac2662cbc0d7eaa6122ac5ae71a4d00a1ea7a1cdd28f6d452057c01f665">SKINNY_CODEC_H263</a> = 101
<a name="l00098"></a>00098 };
<a name="l00099"></a>00099 
<a name="l00100"></a><a class="code" href="chan__skinny_8c.html#aeffadc396b98efd62e385678a8c1cf62">00100</a> <span class="preprocessor">#define DEFAULT_SKINNY_PORT 2000</span>
<a name="l00101"></a><a class="code" href="chan__skinny_8c.html#ac92b1ca5df61c89413c2588028c01ef8">00101</a> <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_SKINNY_BACKLOG 2</span>
<a name="l00102"></a><a class="code" href="chan__skinny_8c.html#af113e81b9ed86ff1591580de9d8b1d52">00102</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_MAX_PACKET 1000</span>
<a name="l00103"></a>00103 <span class="preprocessor"></span>
<a name="l00104"></a>00104 <span class="keyword">static</span> <span class="keyword">struct </span>{
<a name="l00105"></a><a class="code" href="chan__skinny_8c.html#a25a9305efab3b493ca2519562fcec3d5">00105</a>    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="chan__h323_8c.html#a25a9305efab3b493ca2519562fcec3d5">tos</a>;
<a name="l00106"></a><a class="code" href="chan__skinny_8c.html#a1ecad4a80d0e6f5b8ec6ab4c44021d18">00106</a>    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="chan__mgcp_8c.html#a1ecad4a80d0e6f5b8ec6ab4c44021d18">tos_audio</a>;
<a name="l00107"></a><a class="code" href="chan__skinny_8c.html#a0a41428ca9cf82e2f19c3768439e8d85">00107</a>    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a0a41428ca9cf82e2f19c3768439e8d85">tos_video</a>;
<a name="l00108"></a><a class="code" href="chan__skinny_8c.html#ae91dad65f553f7afebe4af507803bc7f">00108</a>    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="chan__h323_8c.html#ae91dad65f553f7afebe4af507803bc7f">cos</a>;
<a name="l00109"></a><a class="code" href="chan__skinny_8c.html#a3e2114722f6cb731593296a831290a7d">00109</a>    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="chan__mgcp_8c.html#a3e2114722f6cb731593296a831290a7d">cos_audio</a>;
<a name="l00110"></a><a class="code" href="chan__skinny_8c.html#a5518532a82b65b23fc59243e4f570e9d">00110</a>    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a5518532a82b65b23fc59243e4f570e9d">cos_video</a>;
<a name="l00111"></a>00111 } <a class="code" href="chan__skinny_8c.html#abe7ea21619e746bb9b12fe3e47bc861b">qos</a> = { 0, 0, 0, 0, 0, 0 };
<a name="l00112"></a>00112 
<a name="l00113"></a><a class="code" href="chan__skinny_8c.html#a3606f7605de5f4adcdf32f2570c86f32">00113</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a3606f7605de5f4adcdf32f2570c86f32">keep_alive</a> = 120;
<a name="l00114"></a><a class="code" href="chan__skinny_8c.html#af08260c0f894e7dacddcc65881e21fe1">00114</a> <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="chan__skinny_8c.html#af08260c0f894e7dacddcc65881e21fe1">global_vmexten</a>[<a class="code" href="channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>];      <span class="comment">/* Voicemail pilot number */</span>
<a name="l00115"></a><a class="code" href="chan__skinny_8c.html#a17ed4e86c02577dfabab4ab53195236d">00115</a> <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="chan__skinny_8c.html#a17ed4e86c02577dfabab4ab53195236d">used_context</a>[<a class="code" href="channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>]; <span class="comment">/* placeholder to check if context are already used in regcontext */</span>
<a name="l00116"></a><a class="code" href="chan__skinny_8c.html#a4d41e07a86f9575719f396ac801b0208">00116</a> <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="chan__skinny_8c.html#a4d41e07a86f9575719f396ac801b0208">regcontext</a>[<a class="code" href="channel_8h.html#abcf1aea85b924e9cd605040b86241e2a">AST_MAX_CONTEXT</a>];     <span class="comment">/* Context for auto-extension */</span>
<a name="l00117"></a><a class="code" href="chan__skinny_8c.html#a4d44486240bfa969fd6cf04fab65c097">00117</a> <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="chan__skinny_8c.html#a4d44486240bfa969fd6cf04fab65c097">date_format</a>[6] = <span class="stringliteral">&quot;D-M-Y&quot;</span>;
<a name="l00118"></a><a class="code" href="chan__skinny_8c.html#a888b22690bce1fb41f95ec190d2417de">00118</a> <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="chan__skinny_8c.html#a888b22690bce1fb41f95ec190d2417de">version_id</a>[16] = <span class="stringliteral">&quot;P002F202&quot;</span>;
<a name="l00119"></a>00119 
<a name="l00120"></a>00120 <span class="preprocessor">#if __BYTE_ORDER == __LITTLE_ENDIAN</span>
<a name="l00121"></a><a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">00121</a> <span class="preprocessor"></span><span class="preprocessor">#define letohl(x) (x)</span>
<a name="l00122"></a><a class="code" href="chan__skinny_8c.html#ac45ea15de0297911c0b0bd4da5ccb1c4">00122</a> <span class="preprocessor"></span><span class="preprocessor">#define letohs(x) (x)</span>
<a name="l00123"></a><a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">00123</a> <span class="preprocessor"></span><span class="preprocessor">#define htolel(x) (x)</span>
<a name="l00124"></a><a class="code" href="chan__skinny_8c.html#a1987a601aa87be6fb2374127af70bb0c">00124</a> <span class="preprocessor"></span><span class="preprocessor">#define htoles(x) (x)</span>
<a name="l00125"></a>00125 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00126"></a>00126 <span class="preprocessor"></span><span class="preprocessor">#if defined(HAVE_BYTESWAP_H)</span>
<a name="l00127"></a>00127 <span class="preprocessor"></span><span class="preprocessor">#include &lt;byteswap.h&gt;</span>
<a name="l00128"></a>00128 <span class="preprocessor">#define letohl(x) bswap_32(x)</span>
<a name="l00129"></a>00129 <span class="preprocessor"></span><span class="preprocessor">#define letohs(x) bswap_16(x)</span>
<a name="l00130"></a>00130 <span class="preprocessor"></span><span class="preprocessor">#define htolel(x) bswap_32(x)</span>
<a name="l00131"></a>00131 <span class="preprocessor"></span><span class="preprocessor">#define htoles(x) bswap_16(x)</span>
<a name="l00132"></a>00132 <span class="preprocessor"></span><span class="preprocessor">#elif defined(HAVE_SYS_ENDIAN_SWAP16)</span>
<a name="l00133"></a>00133 <span class="preprocessor"></span><span class="preprocessor">#include &lt;sys/endian.h&gt;</span>
<a name="l00134"></a>00134 <span class="preprocessor">#define letohl(x) __swap32(x)</span>
<a name="l00135"></a>00135 <span class="preprocessor"></span><span class="preprocessor">#define letohs(x) __swap16(x)</span>
<a name="l00136"></a>00136 <span class="preprocessor"></span><span class="preprocessor">#define htolel(x) __swap32(x)</span>
<a name="l00137"></a>00137 <span class="preprocessor"></span><span class="preprocessor">#define htoles(x) __swap16(x)</span>
<a name="l00138"></a>00138 <span class="preprocessor"></span><span class="preprocessor">#elif defined(HAVE_SYS_ENDIAN_BSWAP16)</span>
<a name="l00139"></a>00139 <span class="preprocessor"></span><span class="preprocessor">#include &lt;sys/endian.h&gt;</span>
<a name="l00140"></a>00140 <span class="preprocessor">#define letohl(x) bswap32(x)</span>
<a name="l00141"></a>00141 <span class="preprocessor"></span><span class="preprocessor">#define letohs(x) bswap16(x)</span>
<a name="l00142"></a>00142 <span class="preprocessor"></span><span class="preprocessor">#define htolel(x) bswap32(x)</span>
<a name="l00143"></a>00143 <span class="preprocessor"></span><span class="preprocessor">#define htoles(x) bswap16(x)</span>
<a name="l00144"></a>00144 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00145"></a>00145 <span class="preprocessor"></span><span class="preprocessor">#define __bswap_16(x) \</span>
<a name="l00146"></a>00146 <span class="preprocessor">   ((((x) &amp; 0xff00) &gt;&gt; 8) | \</span>
<a name="l00147"></a>00147 <span class="preprocessor">    (((x) &amp; 0x00ff) &lt;&lt; 8))</span>
<a name="l00148"></a>00148 <span class="preprocessor"></span><span class="preprocessor">#define __bswap_32(x) \</span>
<a name="l00149"></a>00149 <span class="preprocessor">   ((((x) &amp; 0xff000000) &gt;&gt; 24) | \</span>
<a name="l00150"></a>00150 <span class="preprocessor">    (((x) &amp; 0x00ff0000) &gt;&gt;  8) | \</span>
<a name="l00151"></a>00151 <span class="preprocessor">    (((x) &amp; 0x0000ff00) &lt;&lt;  8) | \</span>
<a name="l00152"></a>00152 <span class="preprocessor">    (((x) &amp; 0x000000ff) &lt;&lt; 24))</span>
<a name="l00153"></a>00153 <span class="preprocessor"></span><span class="preprocessor">#define letohl(x) __bswap_32(x)</span>
<a name="l00154"></a>00154 <span class="preprocessor"></span><span class="preprocessor">#define letohs(x) __bswap_16(x)</span>
<a name="l00155"></a>00155 <span class="preprocessor"></span><span class="preprocessor">#define htolel(x) __bswap_32(x)</span>
<a name="l00156"></a>00156 <span class="preprocessor"></span><span class="preprocessor">#define htoles(x) __bswap_16(x)</span>
<a name="l00157"></a>00157 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00158"></a>00158 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00159"></a>00159 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00160"></a>00160 <span class="comment">/*! Global jitterbuffer configuration - by default, jb is disabled */</span>
<a name="l00161"></a><a class="code" href="chan__skinny_8c.html#a2d8d5920e90ccbad7832926becdadb29">00161</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__jb__conf.html" title="General jitterbuffer configuration.">ast_jb_conf</a> <a class="code" href="chan__skinny_8c.html#a2d8d5920e90ccbad7832926becdadb29">default_jbconf</a> =
<a name="l00162"></a>00162 {
<a name="l00163"></a>00163    .<a class="code" href="structast__jb__conf.html#ac92588540e8c1d014a08cd8a45462b19" title="Combination of the AST_JB_ENABLED, AST_JB_FORCED and AST_JB_LOG flags.">flags</a> = 0,
<a name="l00164"></a>00164    .max_size = -1,
<a name="l00165"></a>00165    .resync_threshold = -1,
<a name="l00166"></a>00166    .impl = <span class="stringliteral">&quot;&quot;</span>,
<a name="l00167"></a>00167    .target_extra = -1,
<a name="l00168"></a>00168 };
<a name="l00169"></a><a class="code" href="chan__skinny_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">00169</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__jb__conf.html" title="General jitterbuffer configuration.">ast_jb_conf</a> <a class="code" href="chan__skinny_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">global_jbconf</a>;
<a name="l00170"></a>00170 
<a name="l00171"></a>00171 <span class="preprocessor">#ifdef SKINNY_DEVMODE</span>
<a name="l00172"></a>00172 <span class="preprocessor"></span><a class="code" href="threadstorage_8h.html#ac268c0a8272ec11e73269392507fb1a6" title="Define a thread storage variable.">AST_THREADSTORAGE</a>(message2str_threadbuf);
<a name="l00173"></a>00173 <span class="preprocessor">#define MESSAGE2STR_BUFSIZE   35</span>
<a name="l00174"></a>00174 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00175"></a>00175 <span class="preprocessor"></span>
<a name="l00176"></a>00176 <a class="code" href="threadstorage_8h.html#ac268c0a8272ec11e73269392507fb1a6" title="Define a thread storage variable.">AST_THREADSTORAGE</a>(device2str_threadbuf);
<a name="l00177"></a><a class="code" href="chan__skinny_8c.html#af6d6ad028a582984d92f9ed46f91b78a">00177</a> <span class="preprocessor">#define DEVICE2STR_BUFSIZE   15</span>
<a name="l00178"></a>00178 <span class="preprocessor"></span>
<a name="l00179"></a>00179 <a class="code" href="threadstorage_8h.html#ac268c0a8272ec11e73269392507fb1a6" title="Define a thread storage variable.">AST_THREADSTORAGE</a>(control2str_threadbuf);
<a name="l00180"></a><a class="code" href="chan__skinny_8c.html#a2e749660fda8587e74d25b70e5b5504d">00180</a> <span class="preprocessor">#define CONTROL2STR_BUFSIZE   100</span>
<a name="l00181"></a>00181 <span class="preprocessor"></span>
<a name="l00182"></a>00182 <span class="comment">/*********************</span>
<a name="l00183"></a>00183 <span class="comment"> * Protocol Messages *</span>
<a name="l00184"></a>00184 <span class="comment"> *********************/</span>
<a name="l00185"></a>00185 <span class="comment">/* message types */</span>
<a name="l00186"></a><a class="code" href="chan__skinny_8c.html#a9e35a268fd7c3a1b2cb28c295c816160">00186</a> <span class="preprocessor">#define KEEP_ALIVE_MESSAGE 0x0000</span>
<a name="l00187"></a>00187 <span class="preprocessor"></span><span class="comment">/* no additional struct */</span>
<a name="l00188"></a>00188 
<a name="l00189"></a><a class="code" href="chan__skinny_8c.html#aec789812d6cc0ff846fb308745e91531">00189</a> <span class="preprocessor">#define REGISTER_MESSAGE 0x0001</span>
<a name="l00190"></a><a class="code" href="structregister__message.html">00190</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structregister__message.html">register_message</a> {
<a name="l00191"></a><a class="code" href="structregister__message.html#acd328517a6cf718155c2e6e22b671ca9">00191</a>    <span class="keywordtype">char</span> <a class="code" href="structregister__message.html#acd328517a6cf718155c2e6e22b671ca9">name</a>[16];
<a name="l00192"></a><a class="code" href="structregister__message.html#afd551fffaf8f74bacc431cef46ae812b">00192</a>    uint32_t <a class="code" href="structregister__message.html#afd551fffaf8f74bacc431cef46ae812b">userId</a>;
<a name="l00193"></a><a class="code" href="structregister__message.html#a9ed36c4f5392e9f1819ec7c9eb9aff80">00193</a>    uint32_t <a class="code" href="structregister__message.html#a9ed36c4f5392e9f1819ec7c9eb9aff80">instance</a>;
<a name="l00194"></a><a class="code" href="structregister__message.html#a69ddb9c845da426f636d9dd0dbed4e7e">00194</a>    uint32_t <a class="code" href="structregister__message.html#a69ddb9c845da426f636d9dd0dbed4e7e">ip</a>;
<a name="l00195"></a><a class="code" href="structregister__message.html#ad44b615021ed3ccb734fcaf583ef4a03">00195</a>    uint32_t <a class="code" href="structregister__message.html#ad44b615021ed3ccb734fcaf583ef4a03">type</a>;
<a name="l00196"></a><a class="code" href="structregister__message.html#a544f40ab65ea4cec6ca3409b70c189d6">00196</a>    uint32_t <a class="code" href="structregister__message.html#a544f40ab65ea4cec6ca3409b70c189d6">maxStreams</a>;
<a name="l00197"></a>00197 };
<a name="l00198"></a>00198 
<a name="l00199"></a><a class="code" href="chan__skinny_8c.html#aa1b2b6b1bab1095ef0753afc2582d29d">00199</a> <span class="preprocessor">#define IP_PORT_MESSAGE 0x0002</span>
<a name="l00200"></a>00200 <span class="preprocessor"></span>
<a name="l00201"></a><a class="code" href="chan__skinny_8c.html#a1d5b89af9a01395da0daefcbcc8fd8bb">00201</a> <span class="preprocessor">#define KEYPAD_BUTTON_MESSAGE 0x0003</span>
<a name="l00202"></a><a class="code" href="structkeypad__button__message.html">00202</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structkeypad__button__message.html">keypad_button_message</a> {
<a name="l00203"></a><a class="code" href="structkeypad__button__message.html#a9ee7e63d91ac13e63dbad259aa1b52a6">00203</a>    uint32_t <a class="code" href="structkeypad__button__message.html#a9ee7e63d91ac13e63dbad259aa1b52a6">button</a>;
<a name="l00204"></a><a class="code" href="structkeypad__button__message.html#a3c8ec1b11804b48f666007331e0c90ba">00204</a>    uint32_t <a class="code" href="structkeypad__button__message.html#a3c8ec1b11804b48f666007331e0c90ba">lineInstance</a>;
<a name="l00205"></a><a class="code" href="structkeypad__button__message.html#a8c5b70179481930bfaef1fa8f6aaba74">00205</a>    uint32_t <a class="code" href="structkeypad__button__message.html#a8c5b70179481930bfaef1fa8f6aaba74">callReference</a>;
<a name="l00206"></a>00206 };
<a name="l00207"></a>00207 
<a name="l00208"></a>00208 
<a name="l00209"></a><a class="code" href="chan__skinny_8c.html#a67e29aa17c48ffce8b07634ac656c172">00209</a> <span class="preprocessor">#define ENBLOC_CALL_MESSAGE 0x0004</span>
<a name="l00210"></a><a class="code" href="structenbloc__call__message.html">00210</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structenbloc__call__message.html">enbloc_call_message</a> {
<a name="l00211"></a><a class="code" href="structenbloc__call__message.html#aaa9b00db6f95d4932ee8d3b825c73bca">00211</a>    <span class="keywordtype">char</span> <a class="code" href="structenbloc__call__message.html#aaa9b00db6f95d4932ee8d3b825c73bca">calledParty</a>[24];
<a name="l00212"></a>00212 };
<a name="l00213"></a>00213 
<a name="l00214"></a><a class="code" href="chan__skinny_8c.html#a8caf5d84aafa52ecdd3a86a08620850c">00214</a> <span class="preprocessor">#define STIMULUS_MESSAGE 0x0005</span>
<a name="l00215"></a><a class="code" href="structstimulus__message.html">00215</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structstimulus__message.html">stimulus_message</a> {
<a name="l00216"></a><a class="code" href="structstimulus__message.html#af793c4f4a8ade380472caa8035905848">00216</a>    uint32_t <a class="code" href="structstimulus__message.html#af793c4f4a8ade380472caa8035905848">stimulus</a>;
<a name="l00217"></a><a class="code" href="structstimulus__message.html#a9343bb7a21618047055c833ea497d1fe">00217</a>    uint32_t <a class="code" href="structstimulus__message.html#a9343bb7a21618047055c833ea497d1fe">stimulusInstance</a>;
<a name="l00218"></a><a class="code" href="structstimulus__message.html#aa056c11f2f813407952d829437cec263">00218</a>    uint32_t <a class="code" href="structstimulus__message.html#aa056c11f2f813407952d829437cec263">callreference</a>;
<a name="l00219"></a>00219 };
<a name="l00220"></a>00220 
<a name="l00221"></a><a class="code" href="chan__skinny_8c.html#a258aee0512dcbdce20a4ec7c9174efec">00221</a> <span class="preprocessor">#define OFFHOOK_MESSAGE 0x0006</span>
<a name="l00222"></a><a class="code" href="structoffhook__message.html">00222</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structoffhook__message.html">offhook_message</a> {
<a name="l00223"></a><a class="code" href="structoffhook__message.html#a9ed36c4f5392e9f1819ec7c9eb9aff80">00223</a>    uint32_t <a class="code" href="structoffhook__message.html#a9ed36c4f5392e9f1819ec7c9eb9aff80">instance</a>;
<a name="l00224"></a><a class="code" href="structoffhook__message.html#aa68938e371fea91ad4b64381877bd381">00224</a>    uint32_t <a class="code" href="structoffhook__message.html#aa68938e371fea91ad4b64381877bd381">reference</a>;
<a name="l00225"></a>00225 };
<a name="l00226"></a>00226 
<a name="l00227"></a><a class="code" href="chan__skinny_8c.html#a195491206014b7ee4a2950b8af3c8a82">00227</a> <span class="preprocessor">#define ONHOOK_MESSAGE 0x0007</span>
<a name="l00228"></a><a class="code" href="structonhook__message.html">00228</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structonhook__message.html">onhook_message</a> {
<a name="l00229"></a><a class="code" href="structonhook__message.html#a9ed36c4f5392e9f1819ec7c9eb9aff80">00229</a>    uint32_t <a class="code" href="structonhook__message.html#a9ed36c4f5392e9f1819ec7c9eb9aff80">instance</a>;
<a name="l00230"></a><a class="code" href="structonhook__message.html#aa68938e371fea91ad4b64381877bd381">00230</a>    uint32_t <a class="code" href="structonhook__message.html#aa68938e371fea91ad4b64381877bd381">reference</a>;
<a name="l00231"></a>00231 };
<a name="l00232"></a>00232 
<a name="l00233"></a><a class="code" href="chan__skinny_8c.html#aff32b9bb805415bcfea5b23ebb62b661">00233</a> <span class="preprocessor">#define CAPABILITIES_RES_MESSAGE 0x0010</span>
<a name="l00234"></a><a class="code" href="structstation__capabilities.html">00234</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structstation__capabilities.html">station_capabilities</a> {
<a name="l00235"></a><a class="code" href="structstation__capabilities.html#a86c2d4142c7f419d8d327bc261fa851f">00235</a>    uint32_t <a class="code" href="structstation__capabilities.html#a86c2d4142c7f419d8d327bc261fa851f">codec</a>;
<a name="l00236"></a><a class="code" href="structstation__capabilities.html#a40463b645a8340db77d51cbbacf2a9ee">00236</a>    uint32_t <a class="code" href="structstation__capabilities.html#a40463b645a8340db77d51cbbacf2a9ee">frames</a>;
<a name="l00237"></a>00237    <span class="keyword">union </span>{
<a name="l00238"></a><a class="code" href="structstation__capabilities.html#a5211a1ec9cf0ea440be3eb8539d34092">00238</a>       <span class="keywordtype">char</span> <a class="code" href="structstation__capabilities.html#a5211a1ec9cf0ea440be3eb8539d34092">res</a>[8];
<a name="l00239"></a><a class="code" href="structstation__capabilities.html#a82e0b1311e54c51fa587134c4f9bad50">00239</a>       uint32_t <a class="code" href="structstation__capabilities.html#a82e0b1311e54c51fa587134c4f9bad50">rate</a>;
<a name="l00240"></a>00240    } <a class="code" href="structstation__capabilities.html#a7dcf17c59bf4eb5c4d2044b47c8048bb">payloads</a>;
<a name="l00241"></a>00241 };
<a name="l00242"></a>00242 
<a name="l00243"></a><a class="code" href="chan__skinny_8c.html#aa12950ed52268059264cbac73630a91a">00243</a> <span class="preprocessor">#define SKINNY_MAX_CAPABILITIES 18</span>
<a name="l00244"></a>00244 <span class="preprocessor"></span>
<a name="l00245"></a><a class="code" href="structcapabilities__res__message.html">00245</a> <span class="keyword">struct </span><a class="code" href="structcapabilities__res__message.html">capabilities_res_message</a> {
<a name="l00246"></a><a class="code" href="structcapabilities__res__message.html#a86988a65e0d3ece7990c032c159786d6">00246</a>    uint32_t <a class="code" href="structcapabilities__res__message.html#a86988a65e0d3ece7990c032c159786d6">count</a>;
<a name="l00247"></a><a class="code" href="structcapabilities__res__message.html#ac665dc2214c0a6f27c0b17f5d88032ea">00247</a>    <span class="keyword">struct </span><a class="code" href="structstation__capabilities.html">station_capabilities</a> <a class="code" href="structcapabilities__res__message.html#ac665dc2214c0a6f27c0b17f5d88032ea">caps</a>[<a class="code" href="chan__skinny_8c.html#aa12950ed52268059264cbac73630a91a">SKINNY_MAX_CAPABILITIES</a>];
<a name="l00248"></a>00248 };
<a name="l00249"></a>00249 
<a name="l00250"></a><a class="code" href="chan__skinny_8c.html#a79d95555682062db176dfd2a5e9c0752">00250</a> <span class="preprocessor">#define SPEED_DIAL_STAT_REQ_MESSAGE 0x000A</span>
<a name="l00251"></a><a class="code" href="structspeed__dial__stat__req__message.html">00251</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structspeed__dial__stat__req__message.html">speed_dial_stat_req_message</a> {
<a name="l00252"></a><a class="code" href="structspeed__dial__stat__req__message.html#acd27bc25ce21f3ab7dfe7d0c53763f04">00252</a>    uint32_t <a class="code" href="structspeed__dial__stat__req__message.html#acd27bc25ce21f3ab7dfe7d0c53763f04">speedDialNumber</a>;
<a name="l00253"></a>00253 };
<a name="l00254"></a>00254 
<a name="l00255"></a><a class="code" href="chan__skinny_8c.html#a610dfde5df1301f6c347b10415678e0f">00255</a> <span class="preprocessor">#define LINE_STATE_REQ_MESSAGE 0x000B</span>
<a name="l00256"></a><a class="code" href="structline__state__req__message.html">00256</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structline__state__req__message.html">line_state_req_message</a> {
<a name="l00257"></a><a class="code" href="structline__state__req__message.html#a987293a1c8fcaf937487ecbe613f0c52">00257</a>    uint32_t <a class="code" href="structline__state__req__message.html#a987293a1c8fcaf937487ecbe613f0c52">lineNumber</a>;
<a name="l00258"></a>00258 };
<a name="l00259"></a>00259 
<a name="l00260"></a><a class="code" href="chan__skinny_8c.html#ad0232ebceef396ab30795eb9348d7cac">00260</a> <span class="preprocessor">#define TIME_DATE_REQ_MESSAGE 0x000D</span>
<a name="l00261"></a><a class="code" href="chan__skinny_8c.html#a2eafa2761d0f30c216c041a97cad9c30">00261</a> <span class="preprocessor"></span><span class="preprocessor">#define BUTTON_TEMPLATE_REQ_MESSAGE 0x000E</span>
<a name="l00262"></a><a class="code" href="chan__skinny_8c.html#ad4deebb4a9be4ed5eaf37f0ddb7ea361">00262</a> <span class="preprocessor"></span><span class="preprocessor">#define VERSION_REQ_MESSAGE 0x000F</span>
<a name="l00263"></a><a class="code" href="chan__skinny_8c.html#a36c56f4d73172d09aaf26225c2446963">00263</a> <span class="preprocessor"></span><span class="preprocessor">#define SERVER_REQUEST_MESSAGE 0x0012</span>
<a name="l00264"></a>00264 <span class="preprocessor"></span>
<a name="l00265"></a><a class="code" href="chan__skinny_8c.html#ae2a02a450e18eeb46029c20efadd4ab3">00265</a> <span class="preprocessor">#define ALARM_MESSAGE 0x0020</span>
<a name="l00266"></a><a class="code" href="structalarm__message.html">00266</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structalarm__message.html">alarm_message</a> {
<a name="l00267"></a><a class="code" href="structalarm__message.html#a828489cf2ab29edf8bf8cc9cbd2ecff4">00267</a>    uint32_t <a class="code" href="structalarm__message.html#a828489cf2ab29edf8bf8cc9cbd2ecff4">alarmSeverity</a>;
<a name="l00268"></a><a class="code" href="structalarm__message.html#a6e7842182520ec6229e0903bf023290c">00268</a>    <span class="keywordtype">char</span> <a class="code" href="structalarm__message.html#a6e7842182520ec6229e0903bf023290c">displayMessage</a>[80];
<a name="l00269"></a><a class="code" href="structalarm__message.html#a63a575f488eaea2eed5847b7a4640281">00269</a>    uint32_t <a class="code" href="structalarm__message.html#a63a575f488eaea2eed5847b7a4640281">alarmParam1</a>;
<a name="l00270"></a><a class="code" href="structalarm__message.html#a5ab6b72d81c896f4c469856a79b86575">00270</a>    uint32_t <a class="code" href="structalarm__message.html#a5ab6b72d81c896f4c469856a79b86575">alarmParam2</a>;
<a name="l00271"></a>00271 };
<a name="l00272"></a>00272 
<a name="l00273"></a><a class="code" href="chan__skinny_8c.html#a95a2cd4add7896f4feabe8dc6b0744b6">00273</a> <span class="preprocessor">#define OPEN_RECEIVE_CHANNEL_ACK_MESSAGE 0x0022</span>
<a name="l00274"></a><a class="code" href="structopen__receive__channel__ack__message.html">00274</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structopen__receive__channel__ack__message.html">open_receive_channel_ack_message</a> {
<a name="l00275"></a><a class="code" href="structopen__receive__channel__ack__message.html#ade20423e91627f07e610924cb0081623">00275</a>    uint32_t <a class="code" href="structopen__receive__channel__ack__message.html#ade20423e91627f07e610924cb0081623">status</a>;
<a name="l00276"></a><a class="code" href="structopen__receive__channel__ack__message.html#a597bb7df7851baf554b7310863015b2e">00276</a>    uint32_t <a class="code" href="structopen__receive__channel__ack__message.html#a597bb7df7851baf554b7310863015b2e">ipAddr</a>;
<a name="l00277"></a><a class="code" href="structopen__receive__channel__ack__message.html#a83a04ad582de2b7d36b96f9db429c2c6">00277</a>    uint32_t <a class="code" href="structopen__receive__channel__ack__message.html#a83a04ad582de2b7d36b96f9db429c2c6">port</a>;
<a name="l00278"></a><a class="code" href="structopen__receive__channel__ack__message.html#af22e6c78114fae653c45640e3c2b6f7a">00278</a>    uint32_t <a class="code" href="structopen__receive__channel__ack__message.html#af22e6c78114fae653c45640e3c2b6f7a">passThruId</a>;
<a name="l00279"></a>00279 };
<a name="l00280"></a>00280 
<a name="l00281"></a><a class="code" href="chan__skinny_8c.html#a95a0727067965ab3ce6652eefaee5afc">00281</a> <span class="preprocessor">#define SOFT_KEY_SET_REQ_MESSAGE 0x0025</span>
<a name="l00282"></a>00282 <span class="preprocessor"></span>
<a name="l00283"></a><a class="code" href="chan__skinny_8c.html#a8fdb22d136247b1f7980bbaf1ed2b7ce">00283</a> <span class="preprocessor">#define SOFT_KEY_EVENT_MESSAGE 0x0026</span>
<a name="l00284"></a><a class="code" href="structsoft__key__event__message.html">00284</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structsoft__key__event__message.html">soft_key_event_message</a> {
<a name="l00285"></a><a class="code" href="structsoft__key__event__message.html#a4358d46dc0a917c9906274cf85132904">00285</a>    uint32_t <a class="code" href="structsoft__key__event__message.html#a4358d46dc0a917c9906274cf85132904">softKeyEvent</a>;
<a name="l00286"></a><a class="code" href="structsoft__key__event__message.html#a9ed36c4f5392e9f1819ec7c9eb9aff80">00286</a>    uint32_t <a class="code" href="structsoft__key__event__message.html#a9ed36c4f5392e9f1819ec7c9eb9aff80">instance</a>;
<a name="l00287"></a><a class="code" href="structsoft__key__event__message.html#aa056c11f2f813407952d829437cec263">00287</a>    uint32_t <a class="code" href="structsoft__key__event__message.html#aa056c11f2f813407952d829437cec263">callreference</a>;
<a name="l00288"></a>00288 };
<a name="l00289"></a>00289 
<a name="l00290"></a><a class="code" href="chan__skinny_8c.html#a33d2f7a83eef8e9bd1b39f8e38c150f7">00290</a> <span class="preprocessor">#define UNREGISTER_MESSAGE 0x0027</span>
<a name="l00291"></a><a class="code" href="chan__skinny_8c.html#aaa8ae193940da9236d260041a3a8a5c4">00291</a> <span class="preprocessor"></span><span class="preprocessor">#define SOFT_KEY_TEMPLATE_REQ_MESSAGE 0x0028</span>
<a name="l00292"></a><a class="code" href="chan__skinny_8c.html#a9f3bcf87db314d362bb2ca29ed73c71c">00292</a> <span class="preprocessor"></span><span class="preprocessor">#define HEADSET_STATUS_MESSAGE 0x002B</span>
<a name="l00293"></a><a class="code" href="chan__skinny_8c.html#acffbaca19a4702b6ae9284d1902b67f9">00293</a> <span class="preprocessor"></span><span class="preprocessor">#define REGISTER_AVAILABLE_LINES_MESSAGE 0x002D</span>
<a name="l00294"></a>00294 <span class="preprocessor"></span>
<a name="l00295"></a><a class="code" href="chan__skinny_8c.html#a3fb821358598b476576f3b098586498f">00295</a> <span class="preprocessor">#define REGISTER_ACK_MESSAGE 0x0081</span>
<a name="l00296"></a><a class="code" href="structregister__ack__message.html">00296</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structregister__ack__message.html">register_ack_message</a> {
<a name="l00297"></a><a class="code" href="structregister__ack__message.html#aa7c63ac4bd47bf61251998dd8c9b63ea">00297</a>    uint32_t <a class="code" href="structregister__ack__message.html#aa7c63ac4bd47bf61251998dd8c9b63ea">keepAlive</a>;
<a name="l00298"></a><a class="code" href="structregister__ack__message.html#a05c27f79b3e6af4e4a8c19ce8bccefb7">00298</a>    <span class="keywordtype">char</span> <a class="code" href="structregister__ack__message.html#a05c27f79b3e6af4e4a8c19ce8bccefb7">dateTemplate</a>[6];
<a name="l00299"></a><a class="code" href="structregister__ack__message.html#a7be363918d3701aef294dc8cd25f6d80">00299</a>    <span class="keywordtype">char</span> <a class="code" href="structregister__ack__message.html#a7be363918d3701aef294dc8cd25f6d80">res</a>[2];
<a name="l00300"></a><a class="code" href="structregister__ack__message.html#a80e8d2b07d4ba102a31aea2fe00730b1">00300</a>    uint32_t <a class="code" href="structregister__ack__message.html#a80e8d2b07d4ba102a31aea2fe00730b1">secondaryKeepAlive</a>;
<a name="l00301"></a><a class="code" href="structregister__ack__message.html#a4b9c948b588ab48f4bd3866b36624669">00301</a>    <span class="keywordtype">char</span> <a class="code" href="structregister__ack__message.html#a4b9c948b588ab48f4bd3866b36624669">res2</a>[4];
<a name="l00302"></a>00302 };
<a name="l00303"></a>00303 
<a name="l00304"></a><a class="code" href="chan__skinny_8c.html#ad2488ba493987c5230f95cb86958dc76">00304</a> <span class="preprocessor">#define START_TONE_MESSAGE 0x0082</span>
<a name="l00305"></a><a class="code" href="structstart__tone__message.html">00305</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structstart__tone__message.html">start_tone_message</a> {
<a name="l00306"></a><a class="code" href="structstart__tone__message.html#affe196e5ade32fb5073c2d5bae82fcc3">00306</a>    uint32_t <a class="code" href="structstart__tone__message.html#affe196e5ade32fb5073c2d5bae82fcc3">tone</a>;
<a name="l00307"></a><a class="code" href="structstart__tone__message.html#a255ac0cfa2a98311b2aa3976bdfacf98">00307</a>    uint32_t <a class="code" href="structstart__tone__message.html#a255ac0cfa2a98311b2aa3976bdfacf98">space</a>;
<a name="l00308"></a><a class="code" href="structstart__tone__message.html#a9ed36c4f5392e9f1819ec7c9eb9aff80">00308</a>    uint32_t <a class="code" href="structstart__tone__message.html#a9ed36c4f5392e9f1819ec7c9eb9aff80">instance</a>;
<a name="l00309"></a><a class="code" href="structstart__tone__message.html#aa68938e371fea91ad4b64381877bd381">00309</a>    uint32_t <a class="code" href="structstart__tone__message.html#aa68938e371fea91ad4b64381877bd381">reference</a>;
<a name="l00310"></a>00310 };
<a name="l00311"></a>00311 
<a name="l00312"></a><a class="code" href="chan__skinny_8c.html#a6c341d198f3726cac8d9e26d4fdb8c58">00312</a> <span class="preprocessor">#define STOP_TONE_MESSAGE 0x0083</span>
<a name="l00313"></a><a class="code" href="structstop__tone__message.html">00313</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structstop__tone__message.html">stop_tone_message</a> {
<a name="l00314"></a><a class="code" href="structstop__tone__message.html#a9ed36c4f5392e9f1819ec7c9eb9aff80">00314</a>    uint32_t <a class="code" href="structstop__tone__message.html#a9ed36c4f5392e9f1819ec7c9eb9aff80">instance</a>;
<a name="l00315"></a><a class="code" href="structstop__tone__message.html#aa68938e371fea91ad4b64381877bd381">00315</a>    uint32_t <a class="code" href="structstop__tone__message.html#aa68938e371fea91ad4b64381877bd381">reference</a>;
<a name="l00316"></a>00316 };
<a name="l00317"></a>00317 
<a name="l00318"></a><a class="code" href="chan__skinny_8c.html#ae7bbfbe01b4deecb01153f047d12497b">00318</a> <span class="preprocessor">#define SET_RINGER_MESSAGE 0x0085</span>
<a name="l00319"></a><a class="code" href="structset__ringer__message.html">00319</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structset__ringer__message.html">set_ringer_message</a> {
<a name="l00320"></a><a class="code" href="structset__ringer__message.html#aa8164b9b4b32a6aa9770cb5bc9f6b544">00320</a>    uint32_t <a class="code" href="structset__ringer__message.html#aa8164b9b4b32a6aa9770cb5bc9f6b544">ringerMode</a>;
<a name="l00321"></a><a class="code" href="structset__ringer__message.html#a1946df298d8390034825068792632dbb">00321</a>    uint32_t <a class="code" href="structset__ringer__message.html#a1946df298d8390034825068792632dbb">unknown1</a>; <span class="comment">/* See notes in transmit_ringer_mode */</span>
<a name="l00322"></a><a class="code" href="structset__ringer__message.html#a562d73948591ea69ac50c6db50f3a54e">00322</a>    uint32_t <a class="code" href="structset__ringer__message.html#a562d73948591ea69ac50c6db50f3a54e">unknown2</a>;
<a name="l00323"></a><a class="code" href="structset__ringer__message.html#aa5cc11f805a6af19ee9ed50a53d1cef3">00323</a>    uint32_t <a class="code" href="structset__ringer__message.html#aa5cc11f805a6af19ee9ed50a53d1cef3">space</a>[2];
<a name="l00324"></a>00324 };
<a name="l00325"></a>00325 
<a name="l00326"></a><a class="code" href="chan__skinny_8c.html#a1ea4574da323c63a872fffd8f134f1af">00326</a> <span class="preprocessor">#define SET_LAMP_MESSAGE 0x0086</span>
<a name="l00327"></a><a class="code" href="structset__lamp__message.html">00327</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structset__lamp__message.html">set_lamp_message</a> {
<a name="l00328"></a><a class="code" href="structset__lamp__message.html#af793c4f4a8ade380472caa8035905848">00328</a>    uint32_t <a class="code" href="structset__lamp__message.html#af793c4f4a8ade380472caa8035905848">stimulus</a>;
<a name="l00329"></a><a class="code" href="structset__lamp__message.html#a9343bb7a21618047055c833ea497d1fe">00329</a>    uint32_t <a class="code" href="structset__lamp__message.html#a9343bb7a21618047055c833ea497d1fe">stimulusInstance</a>;
<a name="l00330"></a><a class="code" href="structset__lamp__message.html#afecdde89163215e9c3f609f583ca43a7">00330</a>    uint32_t <a class="code" href="structset__lamp__message.html#afecdde89163215e9c3f609f583ca43a7">deviceStimulus</a>;
<a name="l00331"></a>00331 };
<a name="l00332"></a>00332 
<a name="l00333"></a><a class="code" href="chan__skinny_8c.html#ace96029ade576fdaa306b409a2639890">00333</a> <span class="preprocessor">#define SET_SPEAKER_MESSAGE 0x0088</span>
<a name="l00334"></a><a class="code" href="structset__speaker__message.html">00334</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structset__speaker__message.html">set_speaker_message</a> {
<a name="l00335"></a><a class="code" href="structset__speaker__message.html#a6b29e4f37f4482274af785ad5ffe96a7">00335</a>    uint32_t <a class="code" href="structset__speaker__message.html#a6b29e4f37f4482274af785ad5ffe96a7">mode</a>;
<a name="l00336"></a>00336 };
<a name="l00337"></a>00337 
<a name="l00338"></a>00338 <span class="comment">/* XXX When do we need to use this? */</span>
<a name="l00339"></a><a class="code" href="chan__skinny_8c.html#aa1669b84b2c634fca96d1e74efe28f21">00339</a> <span class="preprocessor">#define SET_MICROPHONE_MESSAGE 0x0089</span>
<a name="l00340"></a><a class="code" href="structset__microphone__message.html">00340</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structset__microphone__message.html">set_microphone_message</a> {
<a name="l00341"></a><a class="code" href="structset__microphone__message.html#a6b29e4f37f4482274af785ad5ffe96a7">00341</a>    uint32_t <a class="code" href="structset__microphone__message.html#a6b29e4f37f4482274af785ad5ffe96a7">mode</a>;
<a name="l00342"></a>00342 };
<a name="l00343"></a>00343 
<a name="l00344"></a><a class="code" href="chan__skinny_8c.html#aa8c4fd39788d87301b7b97543537a12c">00344</a> <span class="preprocessor">#define START_MEDIA_TRANSMISSION_MESSAGE 0x008A</span>
<a name="l00345"></a><a class="code" href="structmedia__qualifier.html">00345</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structmedia__qualifier.html">media_qualifier</a> {
<a name="l00346"></a><a class="code" href="structmedia__qualifier.html#a3f52bd316aba6dea4bc6374f5e4b0258">00346</a>    uint32_t <a class="code" href="structmedia__qualifier.html#a3f52bd316aba6dea4bc6374f5e4b0258">precedence</a>;
<a name="l00347"></a><a class="code" href="structmedia__qualifier.html#af22582b468205e3b1c3681dc5c28aa6b">00347</a>    uint32_t <a class="code" href="structmedia__qualifier.html#af22582b468205e3b1c3681dc5c28aa6b">vad</a>;
<a name="l00348"></a><a class="code" href="structmedia__qualifier.html#ab55cdaa8e99da057ceeb21efdd56909a">00348</a>    uint16_t <a class="code" href="structmedia__qualifier.html#ab55cdaa8e99da057ceeb21efdd56909a">packets</a>;
<a name="l00349"></a><a class="code" href="structmedia__qualifier.html#a497243c8d5b9134495d3a68af76693c8">00349</a>    uint32_t <a class="code" href="structmedia__qualifier.html#a497243c8d5b9134495d3a68af76693c8">bitRate</a>;
<a name="l00350"></a>00350 };
<a name="l00351"></a>00351 
<a name="l00352"></a><a class="code" href="structstart__media__transmission__message.html">00352</a> <span class="keyword">struct </span><a class="code" href="structstart__media__transmission__message.html">start_media_transmission_message</a> {
<a name="l00353"></a><a class="code" href="structstart__media__transmission__message.html#aad8282aaef639f3310f833e9b44a541e">00353</a>    uint32_t <a class="code" href="structstart__media__transmission__message.html#aad8282aaef639f3310f833e9b44a541e">conferenceId</a>;
<a name="l00354"></a><a class="code" href="structstart__media__transmission__message.html#ae7a8ce78da6117ddd5e98de15f85af23">00354</a>    uint32_t <a class="code" href="structstart__media__transmission__message.html#ae7a8ce78da6117ddd5e98de15f85af23">passThruPartyId</a>;
<a name="l00355"></a><a class="code" href="structstart__media__transmission__message.html#ac4946ecf0faa3d0281b86b9df56cbc6f">00355</a>    uint32_t <a class="code" href="structstart__media__transmission__message.html#ac4946ecf0faa3d0281b86b9df56cbc6f">remoteIp</a>;
<a name="l00356"></a><a class="code" href="structstart__media__transmission__message.html#a52c51c79d848efbf9fbf291a2f2645c6">00356</a>    uint32_t <a class="code" href="structstart__media__transmission__message.html#a52c51c79d848efbf9fbf291a2f2645c6">remotePort</a>;
<a name="l00357"></a><a class="code" href="structstart__media__transmission__message.html#ada112a060915d95bc25fb2917272914f">00357</a>    uint32_t <a class="code" href="structstart__media__transmission__message.html#ada112a060915d95bc25fb2917272914f">packetSize</a>;
<a name="l00358"></a><a class="code" href="structstart__media__transmission__message.html#aaf0b83c81dec67533a9edcf9f4c3c760">00358</a>    uint32_t <a class="code" href="structstart__media__transmission__message.html#aaf0b83c81dec67533a9edcf9f4c3c760">payloadType</a>;
<a name="l00359"></a><a class="code" href="structstart__media__transmission__message.html#a5304bc4afe911142322308d69ffe6466">00359</a>    <span class="keyword">struct </span><a class="code" href="structmedia__qualifier.html">media_qualifier</a> <a class="code" href="structstart__media__transmission__message.html#a5304bc4afe911142322308d69ffe6466">qualifier</a>;
<a name="l00360"></a><a class="code" href="structstart__media__transmission__message.html#a665732cbebfa3e10dfda9e200fc179a6">00360</a>    uint32_t <a class="code" href="structstart__media__transmission__message.html#a665732cbebfa3e10dfda9e200fc179a6">space</a>[16];
<a name="l00361"></a>00361 };
<a name="l00362"></a>00362 
<a name="l00363"></a><a class="code" href="chan__skinny_8c.html#acb883512e3f609a62dde13c5d5cb4879">00363</a> <span class="preprocessor">#define STOP_MEDIA_TRANSMISSION_MESSAGE 0x008B</span>
<a name="l00364"></a><a class="code" href="structstop__media__transmission__message.html">00364</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structstop__media__transmission__message.html">stop_media_transmission_message</a> {
<a name="l00365"></a><a class="code" href="structstop__media__transmission__message.html#aad8282aaef639f3310f833e9b44a541e">00365</a>    uint32_t <a class="code" href="structstop__media__transmission__message.html#aad8282aaef639f3310f833e9b44a541e">conferenceId</a>;
<a name="l00366"></a><a class="code" href="structstop__media__transmission__message.html#ae7a8ce78da6117ddd5e98de15f85af23">00366</a>    uint32_t <a class="code" href="structstop__media__transmission__message.html#ae7a8ce78da6117ddd5e98de15f85af23">passThruPartyId</a>;
<a name="l00367"></a><a class="code" href="structstop__media__transmission__message.html#a632529daf45d3e778a9a1991e28e17fc">00367</a>    uint32_t <a class="code" href="structstop__media__transmission__message.html#a632529daf45d3e778a9a1991e28e17fc">space</a>[3];
<a name="l00368"></a>00368 };
<a name="l00369"></a>00369 
<a name="l00370"></a><a class="code" href="chan__skinny_8c.html#a7fb2c263aa8febc00c4da70f073ca9b7">00370</a> <span class="preprocessor">#define CALL_INFO_MESSAGE 0x008F</span>
<a name="l00371"></a><a class="code" href="structcall__info__message.html">00371</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structcall__info__message.html">call_info_message</a> {
<a name="l00372"></a><a class="code" href="structcall__info__message.html#a34632365a3c39125e0bdafc01503c191">00372</a>    <span class="keywordtype">char</span> <a class="code" href="structcall__info__message.html#a34632365a3c39125e0bdafc01503c191">callingPartyName</a>[40];
<a name="l00373"></a><a class="code" href="structcall__info__message.html#a8f62c05987b8a452f1208a72a43e643e">00373</a>    <span class="keywordtype">char</span> <a class="code" href="structcall__info__message.html#a8f62c05987b8a452f1208a72a43e643e">callingParty</a>[24];
<a name="l00374"></a><a class="code" href="structcall__info__message.html#ab896d88e09a770904adb218aaf9b635f">00374</a>    <span class="keywordtype">char</span> <a class="code" href="structcall__info__message.html#ab896d88e09a770904adb218aaf9b635f">calledPartyName</a>[40];
<a name="l00375"></a><a class="code" href="structcall__info__message.html#aaa9b00db6f95d4932ee8d3b825c73bca">00375</a>    <span class="keywordtype">char</span> <a class="code" href="structcall__info__message.html#aaa9b00db6f95d4932ee8d3b825c73bca">calledParty</a>[24];
<a name="l00376"></a><a class="code" href="structcall__info__message.html#a9ed36c4f5392e9f1819ec7c9eb9aff80">00376</a>    uint32_t <a class="code" href="structcall__info__message.html#a9ed36c4f5392e9f1819ec7c9eb9aff80">instance</a>;
<a name="l00377"></a><a class="code" href="structcall__info__message.html#aa68938e371fea91ad4b64381877bd381">00377</a>    uint32_t <a class="code" href="structcall__info__message.html#aa68938e371fea91ad4b64381877bd381">reference</a>;
<a name="l00378"></a><a class="code" href="structcall__info__message.html#ad44b615021ed3ccb734fcaf583ef4a03">00378</a>    uint32_t <a class="code" href="structcall__info__message.html#ad44b615021ed3ccb734fcaf583ef4a03">type</a>;
<a name="l00379"></a><a class="code" href="structcall__info__message.html#a7548702b6da21b433d5305849b21e181">00379</a>    <span class="keywordtype">char</span> <a class="code" href="structcall__info__message.html#a7548702b6da21b433d5305849b21e181">originalCalledPartyName</a>[40];
<a name="l00380"></a><a class="code" href="structcall__info__message.html#a9906d0bb5d40918d1886cfeadab8a2ba">00380</a>    <span class="keywordtype">char</span> <a class="code" href="structcall__info__message.html#a9906d0bb5d40918d1886cfeadab8a2ba">originalCalledParty</a>[24];
<a name="l00381"></a><a class="code" href="structcall__info__message.html#a48452593648c34bb39cd72ec3fb54c2a">00381</a>    <span class="keywordtype">char</span> <a class="code" href="structcall__info__message.html#a48452593648c34bb39cd72ec3fb54c2a">lastRedirectingPartyName</a>[40];
<a name="l00382"></a><a class="code" href="structcall__info__message.html#aec5dbcd64d7cb5a830b08cb71622a138">00382</a>    <span class="keywordtype">char</span> <a class="code" href="structcall__info__message.html#aec5dbcd64d7cb5a830b08cb71622a138">lastRedirectingParty</a>[24];
<a name="l00383"></a><a class="code" href="structcall__info__message.html#a211a0e22a5579bdb86254754a80dfdb7">00383</a>    uint32_t <a class="code" href="structcall__info__message.html#a211a0e22a5579bdb86254754a80dfdb7">originalCalledPartyRedirectReason</a>;
<a name="l00384"></a><a class="code" href="structcall__info__message.html#ad0242c30736ce0106e4e87b36eec15cc">00384</a>    uint32_t <a class="code" href="structcall__info__message.html#ad0242c30736ce0106e4e87b36eec15cc">lastRedirectingReason</a>;
<a name="l00385"></a><a class="code" href="structcall__info__message.html#a3d54325c5872fbddf8fdd59d4b513f4b">00385</a>    <span class="keywordtype">char</span> <a class="code" href="structcall__info__message.html#a3d54325c5872fbddf8fdd59d4b513f4b">callingPartyVoiceMailbox</a>[24];
<a name="l00386"></a><a class="code" href="structcall__info__message.html#a7b2987bcc38dbbfb81d755b610f07909">00386</a>    <span class="keywordtype">char</span> <a class="code" href="structcall__info__message.html#a7b2987bcc38dbbfb81d755b610f07909">calledPartyVoiceMailbox</a>[24];
<a name="l00387"></a><a class="code" href="structcall__info__message.html#a774446e383ec5e069e7617f0855f61b7">00387</a>    <span class="keywordtype">char</span> <a class="code" href="structcall__info__message.html#a774446e383ec5e069e7617f0855f61b7">originalCalledPartyVoiceMailbox</a>[24];
<a name="l00388"></a><a class="code" href="structcall__info__message.html#a172390015fa2bad4bd0fe11d3cffe8d3">00388</a>    <span class="keywordtype">char</span> <a class="code" href="structcall__info__message.html#a172390015fa2bad4bd0fe11d3cffe8d3">lastRedirectingVoiceMailbox</a>[24];
<a name="l00389"></a><a class="code" href="structcall__info__message.html#a632529daf45d3e778a9a1991e28e17fc">00389</a>    uint32_t <a class="code" href="structcall__info__message.html#a632529daf45d3e778a9a1991e28e17fc">space</a>[3];
<a name="l00390"></a>00390 };
<a name="l00391"></a>00391 
<a name="l00392"></a><a class="code" href="chan__skinny_8c.html#a3fde9ebcac20096752caa92845e4862a">00392</a> <span class="preprocessor">#define FORWARD_STAT_MESSAGE 0x0090</span>
<a name="l00393"></a><a class="code" href="structforward__stat__message.html">00393</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structforward__stat__message.html">forward_stat_message</a> {
<a name="l00394"></a><a class="code" href="structforward__stat__message.html#a0efc2cd005b4b368e86dc6898dfc1663">00394</a>    uint32_t <a class="code" href="structforward__stat__message.html#a0efc2cd005b4b368e86dc6898dfc1663">activeforward</a>;
<a name="l00395"></a><a class="code" href="structforward__stat__message.html#a987293a1c8fcaf937487ecbe613f0c52">00395</a>    uint32_t <a class="code" href="structforward__stat__message.html#a987293a1c8fcaf937487ecbe613f0c52">lineNumber</a>;
<a name="l00396"></a><a class="code" href="structforward__stat__message.html#aeea300cffcc2fdbb4fbd2130b23f127c">00396</a>    uint32_t <a class="code" href="structforward__stat__message.html#aeea300cffcc2fdbb4fbd2130b23f127c">fwdall</a>;
<a name="l00397"></a><a class="code" href="structforward__stat__message.html#a2a34e8a2d2777cf9b7ca0596732befd2">00397</a>    <span class="keywordtype">char</span> <a class="code" href="structforward__stat__message.html#a2a34e8a2d2777cf9b7ca0596732befd2">fwdallnum</a>[24];
<a name="l00398"></a><a class="code" href="structforward__stat__message.html#a1c3cbe199ec696d90ca356b34a79d55a">00398</a>    uint32_t <a class="code" href="structforward__stat__message.html#a1c3cbe199ec696d90ca356b34a79d55a">fwdbusy</a>;
<a name="l00399"></a><a class="code" href="structforward__stat__message.html#aa2fa55c22378257cdd94037cd2871d13">00399</a>    <span class="keywordtype">char</span> <a class="code" href="structforward__stat__message.html#aa2fa55c22378257cdd94037cd2871d13">fwdbusynum</a>[24];
<a name="l00400"></a><a class="code" href="structforward__stat__message.html#a5cedc24a4c8a47b4b07509728c9991e8">00400</a>    uint32_t <a class="code" href="structforward__stat__message.html#a5cedc24a4c8a47b4b07509728c9991e8">fwdnoanswer</a>;
<a name="l00401"></a><a class="code" href="structforward__stat__message.html#ad53edfe4cc9f758d9ed850e79e478209">00401</a>    <span class="keywordtype">char</span> <a class="code" href="structforward__stat__message.html#ad53edfe4cc9f758d9ed850e79e478209">fwdnoanswernum</a>[24];
<a name="l00402"></a>00402 };
<a name="l00403"></a>00403 
<a name="l00404"></a><a class="code" href="chan__skinny_8c.html#a552f2cd0b0e5021c1a1d60d7e79e5488">00404</a> <span class="preprocessor">#define SPEED_DIAL_STAT_RES_MESSAGE 0x0091</span>
<a name="l00405"></a><a class="code" href="structspeed__dial__stat__res__message.html">00405</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structspeed__dial__stat__res__message.html">speed_dial_stat_res_message</a> {
<a name="l00406"></a><a class="code" href="structspeed__dial__stat__res__message.html#acd27bc25ce21f3ab7dfe7d0c53763f04">00406</a>    uint32_t <a class="code" href="structspeed__dial__stat__res__message.html#acd27bc25ce21f3ab7dfe7d0c53763f04">speedDialNumber</a>;
<a name="l00407"></a><a class="code" href="structspeed__dial__stat__res__message.html#a2e227f2e07370c68d9abeaca3dc883fb">00407</a>    <span class="keywordtype">char</span> <a class="code" href="structspeed__dial__stat__res__message.html#a2e227f2e07370c68d9abeaca3dc883fb">speedDialDirNumber</a>[24];
<a name="l00408"></a><a class="code" href="structspeed__dial__stat__res__message.html#a33a668a02f35239d4d39ccaf1c30c273">00408</a>    <span class="keywordtype">char</span> <a class="code" href="structspeed__dial__stat__res__message.html#a33a668a02f35239d4d39ccaf1c30c273">speedDialDisplayName</a>[40];
<a name="l00409"></a>00409 };
<a name="l00410"></a>00410 
<a name="l00411"></a><a class="code" href="chan__skinny_8c.html#a2181f1d209288ce7edad5fc7bc07a9c1">00411</a> <span class="preprocessor">#define LINE_STAT_RES_MESSAGE 0x0092</span>
<a name="l00412"></a><a class="code" href="structline__stat__res__message.html">00412</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structline__stat__res__message.html">line_stat_res_message</a> {
<a name="l00413"></a><a class="code" href="structline__stat__res__message.html#a987293a1c8fcaf937487ecbe613f0c52">00413</a>    uint32_t <a class="code" href="structline__stat__res__message.html#a987293a1c8fcaf937487ecbe613f0c52">lineNumber</a>;
<a name="l00414"></a><a class="code" href="structline__stat__res__message.html#a7b3df44a29beab3b350e067cbfb7075b">00414</a>    <span class="keywordtype">char</span> <a class="code" href="structline__stat__res__message.html#a7b3df44a29beab3b350e067cbfb7075b">lineDirNumber</a>[24];
<a name="l00415"></a><a class="code" href="structline__stat__res__message.html#a54c4c4fcc87cdc8712a6b9808f7e4215">00415</a>    <span class="keywordtype">char</span> <a class="code" href="structline__stat__res__message.html#a54c4c4fcc87cdc8712a6b9808f7e4215">lineDisplayName</a>[24];
<a name="l00416"></a><a class="code" href="structline__stat__res__message.html#af9c0df9d7d2e2b4eb9f486eda3672e92">00416</a>    uint32_t <a class="code" href="structline__stat__res__message.html#af9c0df9d7d2e2b4eb9f486eda3672e92">space</a>[15];
<a name="l00417"></a>00417 };
<a name="l00418"></a>00418 
<a name="l00419"></a><a class="code" href="chan__skinny_8c.html#a05d20dbd5d289408e887b7c267ec3eea">00419</a> <span class="preprocessor">#define DEFINETIMEDATE_MESSAGE 0x0094</span>
<a name="l00420"></a><a class="code" href="structdefinetimedate__message.html">00420</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structdefinetimedate__message.html">definetimedate_message</a> {
<a name="l00421"></a><a class="code" href="structdefinetimedate__message.html#aac3a162d2f192fe2360aba534eac7198">00421</a>    uint32_t <a class="code" href="structdefinetimedate__message.html#aac3a162d2f192fe2360aba534eac7198">year</a>; <span class="comment">/* since 1900 */</span>
<a name="l00422"></a><a class="code" href="structdefinetimedate__message.html#a55a5fa57878363d803833666ddf3c16f">00422</a>    uint32_t <a class="code" href="structdefinetimedate__message.html#a55a5fa57878363d803833666ddf3c16f">month</a>;
<a name="l00423"></a><a class="code" href="structdefinetimedate__message.html#ab470c6489808456f63cfd7f94df28712">00423</a>    uint32_t <a class="code" href="structdefinetimedate__message.html#ab470c6489808456f63cfd7f94df28712">dayofweek</a>; <span class="comment">/* monday = 1 */</span>
<a name="l00424"></a><a class="code" href="structdefinetimedate__message.html#a897ed87b95b7a37afeeb935ca0b2366b">00424</a>    uint32_t <a class="code" href="structdefinetimedate__message.html#a897ed87b95b7a37afeeb935ca0b2366b">day</a>;
<a name="l00425"></a><a class="code" href="structdefinetimedate__message.html#a26d5bae76d83086900174b266fd2cd82">00425</a>    uint32_t <a class="code" href="structdefinetimedate__message.html#a26d5bae76d83086900174b266fd2cd82">hour</a>;
<a name="l00426"></a><a class="code" href="structdefinetimedate__message.html#aa4bd38811c26969cc4d8cd6723199530">00426</a>    uint32_t <a class="code" href="structdefinetimedate__message.html#aa4bd38811c26969cc4d8cd6723199530">minute</a>;
<a name="l00427"></a><a class="code" href="structdefinetimedate__message.html#a6d5694839ec935781627e5c52de21fda">00427</a>    uint32_t <a class="code" href="structdefinetimedate__message.html#a6d5694839ec935781627e5c52de21fda">seconds</a>;
<a name="l00428"></a><a class="code" href="structdefinetimedate__message.html#a62744aa03cd35aa3b6955f8ff972edb2">00428</a>    uint32_t <a class="code" href="structdefinetimedate__message.html#a62744aa03cd35aa3b6955f8ff972edb2">milliseconds</a>;
<a name="l00429"></a><a class="code" href="structdefinetimedate__message.html#ab20b0c7772544cf5d318507f34231fbe">00429</a>    uint32_t <a class="code" href="structdefinetimedate__message.html#ab20b0c7772544cf5d318507f34231fbe">timestamp</a>;
<a name="l00430"></a>00430 };
<a name="l00431"></a>00431 
<a name="l00432"></a><a class="code" href="chan__skinny_8c.html#aa0698f06ea990283d266b4fad44a49c1">00432</a> <span class="preprocessor">#define BUTTON_TEMPLATE_RES_MESSAGE 0x0097</span>
<a name="l00433"></a><a class="code" href="structbutton__definition.html">00433</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structbutton__definition.html">button_definition</a> {
<a name="l00434"></a><a class="code" href="structbutton__definition.html#a9354e42b02d44b23794884f29cc25d78">00434</a>    uint8_t <a class="code" href="structbutton__definition.html#a9354e42b02d44b23794884f29cc25d78">instanceNumber</a>;
<a name="l00435"></a><a class="code" href="structbutton__definition.html#aca4595173e9d8b5d9c6dfcc94d15f74a">00435</a>    uint8_t <a class="code" href="structbutton__definition.html#aca4595173e9d8b5d9c6dfcc94d15f74a">buttonDefinition</a>;
<a name="l00436"></a>00436 };
<a name="l00437"></a>00437 
<a name="l00438"></a><a class="code" href="structbutton__definition__template.html">00438</a> <span class="keyword">struct </span><a class="code" href="structbutton__definition__template.html">button_definition_template</a> {
<a name="l00439"></a><a class="code" href="structbutton__definition__template.html#aca4595173e9d8b5d9c6dfcc94d15f74a">00439</a>    uint8_t <a class="code" href="structbutton__definition__template.html#aca4595173e9d8b5d9c6dfcc94d15f74a">buttonDefinition</a>;
<a name="l00440"></a>00440    <span class="comment">/* for now, anything between 0xB0 and 0xCF is custom */</span>
<a name="l00441"></a>00441    <span class="comment">/*int custom;*/</span>
<a name="l00442"></a>00442 };
<a name="l00443"></a>00443 
<a name="l00444"></a><a class="code" href="chan__skinny_8c.html#a33435da098fa6baba656162b287d03ad">00444</a> <span class="preprocessor">#define STIMULUS_REDIAL 0x01</span>
<a name="l00445"></a><a class="code" href="chan__skinny_8c.html#a5e78a80b19eee87e834b2f2b699c85f2">00445</a> <span class="preprocessor"></span><span class="preprocessor">#define STIMULUS_SPEEDDIAL 0x02</span>
<a name="l00446"></a><a class="code" href="chan__skinny_8c.html#a68441ee5fadb36ee720812ba7f0ee460">00446</a> <span class="preprocessor"></span><span class="preprocessor">#define STIMULUS_HOLD 0x03</span>
<a name="l00447"></a><a class="code" href="chan__skinny_8c.html#ab3db0778b0a139e240053a7996b4a9e4">00447</a> <span class="preprocessor"></span><span class="preprocessor">#define STIMULUS_TRANSFER 0x04</span>
<a name="l00448"></a><a class="code" href="chan__skinny_8c.html#af3ac1b0d1c42719b924361fb782507e5">00448</a> <span class="preprocessor"></span><span class="preprocessor">#define STIMULUS_FORWARDALL 0x05</span>
<a name="l00449"></a><a class="code" href="chan__skinny_8c.html#aa9a56439f327c8e4795abdd03bfeca10">00449</a> <span class="preprocessor"></span><span class="preprocessor">#define STIMULUS_FORWARDBUSY 0x06</span>
<a name="l00450"></a><a class="code" href="chan__skinny_8c.html#acbcce2f0a7ce5f5734548811ba160923">00450</a> <span class="preprocessor"></span><span class="preprocessor">#define STIMULUS_FORWARDNOANSWER 0x07</span>
<a name="l00451"></a><a class="code" href="chan__skinny_8c.html#aac6715ad310106017794df7beecb0b7e">00451</a> <span class="preprocessor"></span><span class="preprocessor">#define STIMULUS_DISPLAY 0x08</span>
<a name="l00452"></a><a class="code" href="chan__skinny_8c.html#af5c47ae0f0932f1d461f5b7b4cc0b095">00452</a> <span class="preprocessor"></span><span class="preprocessor">#define STIMULUS_LINE 0x09</span>
<a name="l00453"></a><a class="code" href="chan__skinny_8c.html#add30eeef22fe342e5e7e92354ece088e">00453</a> <span class="preprocessor"></span><span class="preprocessor">#define STIMULUS_VOICEMAIL 0x0F</span>
<a name="l00454"></a><a class="code" href="chan__skinny_8c.html#a656a13497d245442343eac5445948896">00454</a> <span class="preprocessor"></span><span class="preprocessor">#define STIMULUS_AUTOANSWER 0x11</span>
<a name="l00455"></a><a class="code" href="chan__skinny_8c.html#a01245cf7008ec6fc7a898f2add35d1bd">00455</a> <span class="preprocessor"></span><span class="preprocessor">#define STIMULUS_DND 0x3F</span>
<a name="l00456"></a><a class="code" href="chan__skinny_8c.html#aef34632dd58c9bb98615297efcc1c964">00456</a> <span class="preprocessor"></span><span class="preprocessor">#define STIMULUS_CONFERENCE 0x7D</span>
<a name="l00457"></a><a class="code" href="chan__skinny_8c.html#a43375044fa9c80f030190f7f2f507d9b">00457</a> <span class="preprocessor"></span><span class="preprocessor">#define STIMULUS_CALLPARK 0x7E</span>
<a name="l00458"></a><a class="code" href="chan__skinny_8c.html#a47cdf2923775497e961c2050a0590f3f">00458</a> <span class="preprocessor"></span><span class="preprocessor">#define STIMULUS_CALLPICKUP 0x7F</span>
<a name="l00459"></a><a class="code" href="chan__skinny_8c.html#ae07f16d153305fae849d6470af9940a3">00459</a> <span class="preprocessor"></span><span class="preprocessor">#define STIMULUS_NONE 0xFF</span>
<a name="l00460"></a>00460 <span class="preprocessor"></span>
<a name="l00461"></a>00461 <span class="comment">/* Button types */</span>
<a name="l00462"></a><a class="code" href="chan__skinny_8c.html#ad42c94940dcf4f9dfcbadb66768a232e">00462</a> <span class="preprocessor">#define BT_REDIAL STIMULUS_REDIAL</span>
<a name="l00463"></a><a class="code" href="chan__skinny_8c.html#a6c4119bfe726809a67361ef8873aebb1">00463</a> <span class="preprocessor"></span><span class="preprocessor">#define BT_SPEEDDIAL STIMULUS_SPEEDDIAL</span>
<a name="l00464"></a><a class="code" href="chan__skinny_8c.html#a66496dc99061becc829b16fb6a77b932">00464</a> <span class="preprocessor"></span><span class="preprocessor">#define BT_HOLD STIMULUS_HOLD</span>
<a name="l00465"></a><a class="code" href="chan__skinny_8c.html#ad694b8a6767c0471620203a76c163c94">00465</a> <span class="preprocessor"></span><span class="preprocessor">#define BT_TRANSFER STIMULUS_TRANSFER</span>
<a name="l00466"></a><a class="code" href="chan__skinny_8c.html#a717fbb6c33d3e97eda9e83439fcfc9f6">00466</a> <span class="preprocessor"></span><span class="preprocessor">#define BT_FORWARDALL STIMULUS_FORWARDALL</span>
<a name="l00467"></a><a class="code" href="chan__skinny_8c.html#a618b15fa4033ccaeedc692f108a08e8d">00467</a> <span class="preprocessor"></span><span class="preprocessor">#define BT_FORWARDBUSY STIMULUS_FORWARDBUSY</span>
<a name="l00468"></a><a class="code" href="chan__skinny_8c.html#a1933284ff47ec7d35a2efe6d978b43dc">00468</a> <span class="preprocessor"></span><span class="preprocessor">#define BT_FORWARDNOANSWER STIMULUS_FORWARDNOANSWER</span>
<a name="l00469"></a><a class="code" href="chan__skinny_8c.html#ad78a3be084759b7516f88e3ac5bc3878">00469</a> <span class="preprocessor"></span><span class="preprocessor">#define BT_DISPLAY STIMULUS_DISPLAY</span>
<a name="l00470"></a><a class="code" href="chan__skinny_8c.html#a081aff21e0bee826b43a1e779321a5e0">00470</a> <span class="preprocessor"></span><span class="preprocessor">#define BT_LINE STIMULUS_LINE</span>
<a name="l00471"></a><a class="code" href="chan__skinny_8c.html#ae9c3820ed2b487507e8c713c7fb1db03">00471</a> <span class="preprocessor"></span><span class="preprocessor">#define BT_VOICEMAIL STIMULUS_VOICEMAIL</span>
<a name="l00472"></a><a class="code" href="chan__skinny_8c.html#a49c707165dd28b53392431079678e0ae">00472</a> <span class="preprocessor"></span><span class="preprocessor">#define BT_AUTOANSWER STIMULUS_AUTOANSWER</span>
<a name="l00473"></a><a class="code" href="chan__skinny_8c.html#a2554115383df15624de008b9d302ae8b">00473</a> <span class="preprocessor"></span><span class="preprocessor">#define BT_DND STIMULUS_DND</span>
<a name="l00474"></a><a class="code" href="chan__skinny_8c.html#aab811d3a4b1b82a685a59c95a451bc56">00474</a> <span class="preprocessor"></span><span class="preprocessor">#define BT_CONFERENCE STIMULUS_CONFERENCE</span>
<a name="l00475"></a><a class="code" href="chan__skinny_8c.html#a5fac0c713656df7ee579325a7755da46">00475</a> <span class="preprocessor"></span><span class="preprocessor">#define BT_CALLPARK STIMULUS_CALLPARK</span>
<a name="l00476"></a><a class="code" href="chan__skinny_8c.html#a9e3e6f834e1aed198207e1f91c7c4942">00476</a> <span class="preprocessor"></span><span class="preprocessor">#define BT_CALLPICKUP STIMULUS_CALLPICKUP</span>
<a name="l00477"></a><a class="code" href="chan__skinny_8c.html#afaba3e566686d3d7a3f42c20aa5e882d">00477</a> <span class="preprocessor"></span><span class="preprocessor">#define BT_NONE 0x00</span>
<a name="l00478"></a>00478 <span class="preprocessor"></span>
<a name="l00479"></a>00479 <span class="comment">/* Custom button types - add our own between 0xB0 and 0xCF.</span>
<a name="l00480"></a>00480 <span class="comment">   This may need to be revised in the future,</span>
<a name="l00481"></a>00481 <span class="comment">   if stimuluses are ever added in this range. */</span>
<a name="l00482"></a><a class="code" href="chan__skinny_8c.html#ad25614879b5f61a397dd7e6afc94e315">00482</a> <span class="preprocessor">#define BT_CUST_LINESPEEDDIAL 0xB0 </span><span class="comment">/* line or speeddial with/without hint */</span>
<a name="l00483"></a><a class="code" href="chan__skinny_8c.html#a79703f70916908d1d8a2cbb2c319a287">00483</a> <span class="preprocessor">#define BT_CUST_LINE 0xB1          </span><span class="comment">/* line or speeddial with hint only */</span>
<a name="l00484"></a>00484 
<a name="l00485"></a><a class="code" href="structbutton__template__res__message.html">00485</a> <span class="keyword">struct </span><a class="code" href="structbutton__template__res__message.html">button_template_res_message</a> {
<a name="l00486"></a><a class="code" href="structbutton__template__res__message.html#a8bfe0684eb73994b284e34cbab2ab7ec">00486</a>    uint32_t <a class="code" href="structbutton__template__res__message.html#a8bfe0684eb73994b284e34cbab2ab7ec">buttonOffset</a>;
<a name="l00487"></a><a class="code" href="structbutton__template__res__message.html#aa100098f03a37452cf695a63ec6cc205">00487</a>    uint32_t <a class="code" href="structbutton__template__res__message.html#aa100098f03a37452cf695a63ec6cc205">buttonCount</a>;
<a name="l00488"></a><a class="code" href="structbutton__template__res__message.html#a119c7a9d583c29cc7454bf18f9328527">00488</a>    uint32_t <a class="code" href="structbutton__template__res__message.html#a119c7a9d583c29cc7454bf18f9328527">totalButtonCount</a>;
<a name="l00489"></a><a class="code" href="structbutton__template__res__message.html#aa40104e9b00b6ca099695c7494cf0c93">00489</a>    <span class="keyword">struct </span><a class="code" href="structbutton__definition.html">button_definition</a> <a class="code" href="structbutton__template__res__message.html#aa40104e9b00b6ca099695c7494cf0c93">definition</a>[42];
<a name="l00490"></a>00490 };
<a name="l00491"></a>00491 
<a name="l00492"></a><a class="code" href="chan__skinny_8c.html#a12901431f5ab5e4cb9df9edc664e6d85">00492</a> <span class="preprocessor">#define VERSION_RES_MESSAGE 0x0098</span>
<a name="l00493"></a><a class="code" href="structversion__res__message.html">00493</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structversion__res__message.html">version_res_message</a> {
<a name="l00494"></a><a class="code" href="structversion__res__message.html#a2eaaed79d5d4970bf38f17ccbfdbb035">00494</a>    <span class="keywordtype">char</span> <a class="code" href="structversion__res__message.html#a2eaaed79d5d4970bf38f17ccbfdbb035">version</a>[16];
<a name="l00495"></a>00495 };
<a name="l00496"></a>00496 
<a name="l00497"></a><a class="code" href="chan__skinny_8c.html#aaf7fd74b57aa572a32636909926de80b">00497</a> <span class="preprocessor">#define DISPLAYTEXT_MESSAGE 0x0099</span>
<a name="l00498"></a><a class="code" href="structdisplaytext__message.html">00498</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structdisplaytext__message.html">displaytext_message</a> {
<a name="l00499"></a><a class="code" href="structdisplaytext__message.html#a9c7ea79a50fa206ad34689d0ba2f00fc">00499</a>    <span class="keywordtype">char</span> <a class="code" href="structdisplaytext__message.html#a9c7ea79a50fa206ad34689d0ba2f00fc">text</a>[40];
<a name="l00500"></a>00500 };
<a name="l00501"></a>00501 
<a name="l00502"></a><a class="code" href="chan__skinny_8c.html#a75bd8c2deb5ab3092e1c1a3bb59b1996">00502</a> <span class="preprocessor">#define CLEAR_NOTIFY_MESSAGE  0x0115</span>
<a name="l00503"></a><a class="code" href="chan__skinny_8c.html#ad3ef1afdcb3cc2dc465820495d6a3826">00503</a> <span class="preprocessor"></span><span class="preprocessor">#define CLEAR_DISPLAY_MESSAGE 0x009A</span>
<a name="l00504"></a>00504 <span class="preprocessor"></span>
<a name="l00505"></a><a class="code" href="chan__skinny_8c.html#adb5145c2019b8a1d29b20b7b482f8f17">00505</a> <span class="preprocessor">#define CAPABILITIES_REQ_MESSAGE 0x009B</span>
<a name="l00506"></a>00506 <span class="preprocessor"></span>
<a name="l00507"></a><a class="code" href="chan__skinny_8c.html#a8a678ba2da3542aefebf876d6849ad6a">00507</a> <span class="preprocessor">#define REGISTER_REJ_MESSAGE 0x009D</span>
<a name="l00508"></a><a class="code" href="structregister__rej__message.html">00508</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structregister__rej__message.html">register_rej_message</a> {
<a name="l00509"></a><a class="code" href="structregister__rej__message.html#ae277b64cf6cfc5934fc43b096023feed">00509</a>    <span class="keywordtype">char</span> <a class="code" href="structregister__rej__message.html#ae277b64cf6cfc5934fc43b096023feed">errMsg</a>[33];
<a name="l00510"></a>00510 };
<a name="l00511"></a>00511 
<a name="l00512"></a><a class="code" href="chan__skinny_8c.html#acfb45c382a52256b57620a7340c20a69">00512</a> <span class="preprocessor">#define SERVER_RES_MESSAGE 0x009E</span>
<a name="l00513"></a><a class="code" href="structserver__identifier.html">00513</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structserver__identifier.html">server_identifier</a> {
<a name="l00514"></a><a class="code" href="structserver__identifier.html#a24f34926c446be4afb4b2fef4538e524">00514</a>    <span class="keywordtype">char</span> <a class="code" href="structserver__identifier.html#a24f34926c446be4afb4b2fef4538e524">serverName</a>[48];
<a name="l00515"></a>00515 };
<a name="l00516"></a>00516 
<a name="l00517"></a><a class="code" href="structserver__res__message.html">00517</a> <span class="keyword">struct </span><a class="code" href="structserver__res__message.html">server_res_message</a> {
<a name="l00518"></a><a class="code" href="structserver__res__message.html#a79e782cec3d53c0ec6b5922620d6a74f">00518</a>    <span class="keyword">struct </span><a class="code" href="structserver__identifier.html">server_identifier</a> <a class="code" href="structserver__res__message.html#a79e782cec3d53c0ec6b5922620d6a74f">server</a>[5];
<a name="l00519"></a><a class="code" href="structserver__res__message.html#a610e7308d2c7e6410d1728a991afd82e">00519</a>    uint32_t <a class="code" href="structserver__res__message.html#a610e7308d2c7e6410d1728a991afd82e">serverListenPort</a>[5];
<a name="l00520"></a><a class="code" href="structserver__res__message.html#a696fd8eaa59bbf6a3b8c4d20c3a39ee0">00520</a>    uint32_t <a class="code" href="structserver__res__message.html#a696fd8eaa59bbf6a3b8c4d20c3a39ee0">serverIpAddr</a>[5];
<a name="l00521"></a>00521 };
<a name="l00522"></a>00522 
<a name="l00523"></a><a class="code" href="chan__skinny_8c.html#afb6f653351a09b4b3bbbb0fbd3ba4f1e">00523</a> <span class="preprocessor">#define RESET_MESSAGE 0x009F</span>
<a name="l00524"></a><a class="code" href="structreset__message.html">00524</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structreset__message.html">reset_message</a> {
<a name="l00525"></a><a class="code" href="structreset__message.html#a7a8191f03b981d7fd9ea45a66270833b">00525</a>    uint32_t <a class="code" href="structreset__message.html#a7a8191f03b981d7fd9ea45a66270833b">resetType</a>;
<a name="l00526"></a>00526 };
<a name="l00527"></a>00527 
<a name="l00528"></a><a class="code" href="chan__skinny_8c.html#abc0af116eb82cd2fef2601d565c64ecc">00528</a> <span class="preprocessor">#define KEEP_ALIVE_ACK_MESSAGE 0x0100</span>
<a name="l00529"></a>00529 <span class="preprocessor"></span>
<a name="l00530"></a><a class="code" href="chan__skinny_8c.html#a88a234a4bca9e3085c77555b00774758">00530</a> <span class="preprocessor">#define OPEN_RECEIVE_CHANNEL_MESSAGE 0x0105</span>
<a name="l00531"></a><a class="code" href="structopen__receive__channel__message.html">00531</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structopen__receive__channel__message.html">open_receive_channel_message</a> {
<a name="l00532"></a><a class="code" href="structopen__receive__channel__message.html#aad8282aaef639f3310f833e9b44a541e">00532</a>    uint32_t <a class="code" href="structopen__receive__channel__message.html#aad8282aaef639f3310f833e9b44a541e">conferenceId</a>;
<a name="l00533"></a><a class="code" href="structopen__receive__channel__message.html#a042688e766f041125ca9e83e7d6e1e5b">00533</a>    uint32_t <a class="code" href="structopen__receive__channel__message.html#a042688e766f041125ca9e83e7d6e1e5b">partyId</a>;
<a name="l00534"></a><a class="code" href="structopen__receive__channel__message.html#a9b36626dc275b826b3249e374a34e89b">00534</a>    uint32_t <a class="code" href="structopen__receive__channel__message.html#a9b36626dc275b826b3249e374a34e89b">packets</a>;
<a name="l00535"></a><a class="code" href="structopen__receive__channel__message.html#ae44a58b4520a788452773ea854fa0959">00535</a>    uint32_t <a class="code" href="structopen__receive__channel__message.html#ae44a58b4520a788452773ea854fa0959">capability</a>;
<a name="l00536"></a><a class="code" href="structopen__receive__channel__message.html#a1f7eaad8cc185c3307255e95e7eb238e">00536</a>    uint32_t <a class="code" href="structopen__receive__channel__message.html#a1f7eaad8cc185c3307255e95e7eb238e">echo</a>;
<a name="l00537"></a><a class="code" href="structopen__receive__channel__message.html#a32678c62007e0748dae550bd1007a07d">00537</a>    uint32_t <a class="code" href="structopen__receive__channel__message.html#a32678c62007e0748dae550bd1007a07d">bitrate</a>;
<a name="l00538"></a><a class="code" href="structopen__receive__channel__message.html#a665732cbebfa3e10dfda9e200fc179a6">00538</a>    uint32_t <a class="code" href="structopen__receive__channel__message.html#a665732cbebfa3e10dfda9e200fc179a6">space</a>[16];
<a name="l00539"></a>00539 };
<a name="l00540"></a>00540 
<a name="l00541"></a><a class="code" href="chan__skinny_8c.html#a60c800146db7344c89b2941999f236d4">00541</a> <span class="preprocessor">#define CLOSE_RECEIVE_CHANNEL_MESSAGE 0x0106</span>
<a name="l00542"></a><a class="code" href="structclose__receive__channel__message.html">00542</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structclose__receive__channel__message.html">close_receive_channel_message</a> {
<a name="l00543"></a><a class="code" href="structclose__receive__channel__message.html#aad8282aaef639f3310f833e9b44a541e">00543</a>    uint32_t <a class="code" href="structclose__receive__channel__message.html#aad8282aaef639f3310f833e9b44a541e">conferenceId</a>;
<a name="l00544"></a><a class="code" href="structclose__receive__channel__message.html#a042688e766f041125ca9e83e7d6e1e5b">00544</a>    uint32_t <a class="code" href="structclose__receive__channel__message.html#a042688e766f041125ca9e83e7d6e1e5b">partyId</a>;
<a name="l00545"></a><a class="code" href="structclose__receive__channel__message.html#aa5cc11f805a6af19ee9ed50a53d1cef3">00545</a>    uint32_t <a class="code" href="structclose__receive__channel__message.html#aa5cc11f805a6af19ee9ed50a53d1cef3">space</a>[2];
<a name="l00546"></a>00546 };
<a name="l00547"></a>00547 
<a name="l00548"></a><a class="code" href="chan__skinny_8c.html#aa48c2edb2669fe7c10ed6b6b5efa2e05">00548</a> <span class="preprocessor">#define SOFT_KEY_TEMPLATE_RES_MESSAGE 0x0108</span>
<a name="l00549"></a>00549 <span class="preprocessor"></span>
<a name="l00550"></a><a class="code" href="structsoft__key__template__definition.html">00550</a> <span class="keyword">struct </span><a class="code" href="structsoft__key__template__definition.html">soft_key_template_definition</a> {
<a name="l00551"></a><a class="code" href="structsoft__key__template__definition.html#a1883ef31f5782570d4b98402fe19e47f">00551</a>    <span class="keywordtype">char</span> <a class="code" href="structsoft__key__template__definition.html#a1883ef31f5782570d4b98402fe19e47f">softKeyLabel</a>[16];
<a name="l00552"></a><a class="code" href="structsoft__key__template__definition.html#a4358d46dc0a917c9906274cf85132904">00552</a>    uint32_t <a class="code" href="structsoft__key__template__definition.html#a4358d46dc0a917c9906274cf85132904">softKeyEvent</a>;
<a name="l00553"></a>00553 };
<a name="l00554"></a>00554 
<a name="l00555"></a><a class="code" href="chan__skinny_8c.html#aab983751d9fb47d03d07a9e9dd2b4776">00555</a> <span class="preprocessor">#define KEYDEF_ONHOOK 0</span>
<a name="l00556"></a><a class="code" href="chan__skinny_8c.html#aad5f46f88fa82da05103795046e110b7">00556</a> <span class="preprocessor"></span><span class="preprocessor">#define KEYDEF_CONNECTED 1</span>
<a name="l00557"></a><a class="code" href="chan__skinny_8c.html#a1c1b2ec6acc543dbd96c917364d733e3">00557</a> <span class="preprocessor"></span><span class="preprocessor">#define KEYDEF_ONHOLD 2</span>
<a name="l00558"></a><a class="code" href="chan__skinny_8c.html#a529cdb7507128859a179f79e1966eb53">00558</a> <span class="preprocessor"></span><span class="preprocessor">#define KEYDEF_RINGIN 3</span>
<a name="l00559"></a><a class="code" href="chan__skinny_8c.html#a32b4dedb91edf80328d5cda72166bf6e">00559</a> <span class="preprocessor"></span><span class="preprocessor">#define KEYDEF_OFFHOOK 4</span>
<a name="l00560"></a><a class="code" href="chan__skinny_8c.html#ac14d8ee9813b5766c4161fac6c66432d">00560</a> <span class="preprocessor"></span><span class="preprocessor">#define KEYDEF_CONNWITHTRANS 5</span>
<a name="l00561"></a><a class="code" href="chan__skinny_8c.html#a526c9d413d9b96dfea81eae19b0619b5">00561</a> <span class="preprocessor"></span><span class="preprocessor">#define KEYDEF_DADFD 6 </span><span class="comment">/* Digits After Dialing First Digit */</span>
<a name="l00562"></a><a class="code" href="chan__skinny_8c.html#a73c8243c4af2fae81ddd15e650203a58">00562</a> <span class="preprocessor">#define KEYDEF_CONNWITHCONF 7</span>
<a name="l00563"></a><a class="code" href="chan__skinny_8c.html#ae18cb03403da5513c2c6ac0c32c4c939">00563</a> <span class="preprocessor"></span><span class="preprocessor">#define KEYDEF_RINGOUT 8</span>
<a name="l00564"></a><a class="code" href="chan__skinny_8c.html#a0d46746cfe50b67c811cd2fc042e0729">00564</a> <span class="preprocessor"></span><span class="preprocessor">#define KEYDEF_OFFHOOKWITHFEAT 9</span>
<a name="l00565"></a><a class="code" href="chan__skinny_8c.html#adca111bd3e13f311a71c0aff5f89b081">00565</a> <span class="preprocessor"></span><span class="preprocessor">#define KEYDEF_UNKNOWN 10</span>
<a name="l00566"></a>00566 <span class="preprocessor"></span>
<a name="l00567"></a><a class="code" href="chan__skinny_8c.html#ae3ccec26212b7c55493ffa4865cbb88d">00567</a> <span class="preprocessor">#define SOFTKEY_NONE 0x00</span>
<a name="l00568"></a><a class="code" href="chan__skinny_8c.html#a32dc8fa6b998e84ecd2dd709774e25e9">00568</a> <span class="preprocessor"></span><span class="preprocessor">#define SOFTKEY_REDIAL 0x01</span>
<a name="l00569"></a><a class="code" href="chan__skinny_8c.html#aee0ce143cf0a49d49c86cabcf1c829cc">00569</a> <span class="preprocessor"></span><span class="preprocessor">#define SOFTKEY_NEWCALL 0x02</span>
<a name="l00570"></a><a class="code" href="chan__skinny_8c.html#ab185c974c2da13dfd3d0fba53d1c4966">00570</a> <span class="preprocessor"></span><span class="preprocessor">#define SOFTKEY_HOLD 0x03</span>
<a name="l00571"></a><a class="code" href="chan__skinny_8c.html#a666157a09f886de9effc7d648ad7dde8">00571</a> <span class="preprocessor"></span><span class="preprocessor">#define SOFTKEY_TRNSFER 0x04</span>
<a name="l00572"></a><a class="code" href="chan__skinny_8c.html#a0045f3127762983aa2efee3a41e37c40">00572</a> <span class="preprocessor"></span><span class="preprocessor">#define SOFTKEY_CFWDALL 0x05</span>
<a name="l00573"></a><a class="code" href="chan__skinny_8c.html#a744ad78b0f1ed0a0f678528bc64b1b86">00573</a> <span class="preprocessor"></span><span class="preprocessor">#define SOFTKEY_CFWDBUSY 0x06</span>
<a name="l00574"></a><a class="code" href="chan__skinny_8c.html#a3c6159fb829fb3916ace06ed837f7b04">00574</a> <span class="preprocessor"></span><span class="preprocessor">#define SOFTKEY_CFWDNOANSWER 0x07</span>
<a name="l00575"></a><a class="code" href="chan__skinny_8c.html#a8faf0f3196e7a21d01dbbb7719bf11e7">00575</a> <span class="preprocessor"></span><span class="preprocessor">#define SOFTKEY_BKSPC 0x08</span>
<a name="l00576"></a><a class="code" href="chan__skinny_8c.html#aabbdbf515a0e193662eb006117759b00">00576</a> <span class="preprocessor"></span><span class="preprocessor">#define SOFTKEY_ENDCALL 0x09</span>
<a name="l00577"></a><a class="code" href="chan__skinny_8c.html#af1726f9c94deb2725bdd8fabf57f1a53">00577</a> <span class="preprocessor"></span><span class="preprocessor">#define SOFTKEY_RESUME 0x0A</span>
<a name="l00578"></a><a class="code" href="chan__skinny_8c.html#a3b3e11372b76c65944afdea7205fa209">00578</a> <span class="preprocessor"></span><span class="preprocessor">#define SOFTKEY_ANSWER 0x0B</span>
<a name="l00579"></a><a class="code" href="chan__skinny_8c.html#a62c9ec7d264add3d067520147bcf73ef">00579</a> <span class="preprocessor"></span><span class="preprocessor">#define SOFTKEY_INFO 0x0C</span>
<a name="l00580"></a><a class="code" href="chan__skinny_8c.html#a50a64a17998ee0c20b7ea929f06f7371">00580</a> <span class="preprocessor"></span><span class="preprocessor">#define SOFTKEY_CONFRN 0x0D</span>
<a name="l00581"></a><a class="code" href="chan__skinny_8c.html#a572b1d3a412d0e3eec76ed6888d88885">00581</a> <span class="preprocessor"></span><span class="preprocessor">#define SOFTKEY_PARK 0x0E</span>
<a name="l00582"></a><a class="code" href="chan__skinny_8c.html#aba3c2540666fbf54305aeaa2cfd85fef">00582</a> <span class="preprocessor"></span><span class="preprocessor">#define SOFTKEY_JOIN 0x0F</span>
<a name="l00583"></a><a class="code" href="chan__skinny_8c.html#a4b72ea00639536a0cc23d112890d4bc2">00583</a> <span class="preprocessor"></span><span class="preprocessor">#define SOFTKEY_MEETME 0x10</span>
<a name="l00584"></a><a class="code" href="chan__skinny_8c.html#aa4f7a1e0fe94c644277ca765f1d5862c">00584</a> <span class="preprocessor"></span><span class="preprocessor">#define SOFTKEY_PICKUP 0x11</span>
<a name="l00585"></a><a class="code" href="chan__skinny_8c.html#add8c1a6457db2951e7a1ca2395e3da62">00585</a> <span class="preprocessor"></span><span class="preprocessor">#define SOFTKEY_GPICKUP 0x12</span>
<a name="l00586"></a><a class="code" href="chan__skinny_8c.html#a5673732b39310cef6a6f21820d95be71">00586</a> <span class="preprocessor"></span><span class="preprocessor">#define SOFTKEY_DND 0x13</span>
<a name="l00587"></a><a class="code" href="chan__skinny_8c.html#a62fbd966d85772d1fe647b14d017df3f">00587</a> <span class="preprocessor"></span><span class="preprocessor">#define SOFTKEY_IDIVERT 0x14</span>
<a name="l00588"></a>00588 <span class="preprocessor"></span>
<a name="l00589"></a><a class="code" href="chan__skinny_8c.html#aad84a156f8b9295691bb77ea45dfdce4">00589</a> <span class="keyword">struct </span><a class="code" href="structsoft__key__template__definition.html">soft_key_template_definition</a> <a class="code" href="chan__skinny_8c.html#aad84a156f8b9295691bb77ea45dfdce4">soft_key_template_default</a>[] = {
<a name="l00590"></a>00590    { <span class="stringliteral">&quot;\200\001&quot;</span>, <a class="code" href="chan__skinny_8c.html#a32dc8fa6b998e84ecd2dd709774e25e9">SOFTKEY_REDIAL</a> },
<a name="l00591"></a>00591    { <span class="stringliteral">&quot;\200\002&quot;</span>, <a class="code" href="chan__skinny_8c.html#aee0ce143cf0a49d49c86cabcf1c829cc">SOFTKEY_NEWCALL</a> },
<a name="l00592"></a>00592    { <span class="stringliteral">&quot;\200\003&quot;</span>, <a class="code" href="chan__skinny_8c.html#ab185c974c2da13dfd3d0fba53d1c4966">SOFTKEY_HOLD</a> },
<a name="l00593"></a>00593    { <span class="stringliteral">&quot;\200\004&quot;</span>, <a class="code" href="chan__skinny_8c.html#a666157a09f886de9effc7d648ad7dde8">SOFTKEY_TRNSFER</a> },
<a name="l00594"></a>00594    { <span class="stringliteral">&quot;\200\005&quot;</span>, <a class="code" href="chan__skinny_8c.html#a0045f3127762983aa2efee3a41e37c40">SOFTKEY_CFWDALL</a> },
<a name="l00595"></a>00595    { <span class="stringliteral">&quot;\200\006&quot;</span>, <a class="code" href="chan__skinny_8c.html#a744ad78b0f1ed0a0f678528bc64b1b86">SOFTKEY_CFWDBUSY</a> },
<a name="l00596"></a>00596    { <span class="stringliteral">&quot;\200\007&quot;</span>, <a class="code" href="chan__skinny_8c.html#a3c6159fb829fb3916ace06ed837f7b04">SOFTKEY_CFWDNOANSWER</a> },
<a name="l00597"></a>00597    { <span class="stringliteral">&quot;\200\010&quot;</span>, <a class="code" href="chan__skinny_8c.html#a8faf0f3196e7a21d01dbbb7719bf11e7">SOFTKEY_BKSPC</a> },
<a name="l00598"></a>00598    { <span class="stringliteral">&quot;\200\011&quot;</span>, <a class="code" href="chan__skinny_8c.html#aabbdbf515a0e193662eb006117759b00">SOFTKEY_ENDCALL</a> },
<a name="l00599"></a>00599    { <span class="stringliteral">&quot;\200\012&quot;</span>, <a class="code" href="chan__skinny_8c.html#af1726f9c94deb2725bdd8fabf57f1a53">SOFTKEY_RESUME</a> },
<a name="l00600"></a>00600    { <span class="stringliteral">&quot;\200\013&quot;</span>, <a class="code" href="chan__skinny_8c.html#a3b3e11372b76c65944afdea7205fa209">SOFTKEY_ANSWER</a> },
<a name="l00601"></a>00601    { <span class="stringliteral">&quot;\200\014&quot;</span>, <a class="code" href="chan__skinny_8c.html#a62c9ec7d264add3d067520147bcf73ef">SOFTKEY_INFO</a> },
<a name="l00602"></a>00602    { <span class="stringliteral">&quot;\200\015&quot;</span>, <a class="code" href="chan__skinny_8c.html#a50a64a17998ee0c20b7ea929f06f7371">SOFTKEY_CONFRN</a> },
<a name="l00603"></a>00603    { <span class="stringliteral">&quot;\200\016&quot;</span>, <a class="code" href="chan__skinny_8c.html#a572b1d3a412d0e3eec76ed6888d88885">SOFTKEY_PARK</a> },
<a name="l00604"></a>00604    { <span class="stringliteral">&quot;\200\017&quot;</span>, <a class="code" href="chan__skinny_8c.html#aba3c2540666fbf54305aeaa2cfd85fef">SOFTKEY_JOIN</a> },
<a name="l00605"></a>00605    { <span class="stringliteral">&quot;\200\020&quot;</span>, <a class="code" href="chan__skinny_8c.html#a4b72ea00639536a0cc23d112890d4bc2">SOFTKEY_MEETME</a> },
<a name="l00606"></a>00606    { <span class="stringliteral">&quot;\200\021&quot;</span>, <a class="code" href="chan__skinny_8c.html#aa4f7a1e0fe94c644277ca765f1d5862c">SOFTKEY_PICKUP</a> },
<a name="l00607"></a>00607    { <span class="stringliteral">&quot;\200\022&quot;</span>, <a class="code" href="chan__skinny_8c.html#add8c1a6457db2951e7a1ca2395e3da62">SOFTKEY_GPICKUP</a> },
<a name="l00608"></a>00608    { <span class="stringliteral">&quot;\200\077&quot;</span>, <a class="code" href="chan__skinny_8c.html#a5673732b39310cef6a6f21820d95be71">SOFTKEY_DND</a> },
<a name="l00609"></a>00609    { <span class="stringliteral">&quot;\200\120&quot;</span>, <a class="code" href="chan__skinny_8c.html#a62fbd966d85772d1fe647b14d017df3f">SOFTKEY_IDIVERT</a> },
<a name="l00610"></a>00610 };
<a name="l00611"></a>00611 
<a name="l00612"></a>00612 <span class="comment">/* Localized message &quot;codes&quot; (in octal)</span>
<a name="l00613"></a>00613 <span class="comment">   Below is en_US (taken from a 7970)</span>
<a name="l00614"></a>00614 <span class="comment"></span>
<a name="l00615"></a>00615 <span class="comment">   \200\xxx</span>
<a name="l00616"></a>00616 <span class="comment">       \000: ???</span>
<a name="l00617"></a>00617 <span class="comment">       \001: Redial</span>
<a name="l00618"></a>00618 <span class="comment">       \002: New Call</span>
<a name="l00619"></a>00619 <span class="comment">       \003: Hold</span>
<a name="l00620"></a>00620 <span class="comment">       \004: Transfer</span>
<a name="l00621"></a>00621 <span class="comment">       \005: CFwdALL</span>
<a name="l00622"></a>00622 <span class="comment">       \006: CFwdBusy</span>
<a name="l00623"></a>00623 <span class="comment">       \007: CFwdNoAnswer</span>
<a name="l00624"></a>00624 <span class="comment">       \010: &lt;&lt;</span>
<a name="l00625"></a>00625 <span class="comment">       \011: EndCall</span>
<a name="l00626"></a>00626 <span class="comment">       \012: Resume</span>
<a name="l00627"></a>00627 <span class="comment">       \013: Answer</span>
<a name="l00628"></a>00628 <span class="comment">       \014: Info</span>
<a name="l00629"></a>00629 <span class="comment">       \015: Confrn</span>
<a name="l00630"></a>00630 <span class="comment">       \016: Park</span>
<a name="l00631"></a>00631 <span class="comment">       \017: Join</span>
<a name="l00632"></a>00632 <span class="comment">       \020: MeetMe</span>
<a name="l00633"></a>00633 <span class="comment">       \021: PickUp</span>
<a name="l00634"></a>00634 <span class="comment">       \022: GPickUp</span>
<a name="l00635"></a>00635 <span class="comment">       \023: Your current options</span>
<a name="l00636"></a>00636 <span class="comment">       \024: Off Hook</span>
<a name="l00637"></a>00637 <span class="comment">       \025: On Hook</span>
<a name="l00638"></a>00638 <span class="comment">       \026: Ring out</span>
<a name="l00639"></a>00639 <span class="comment">       \027: From</span>
<a name="l00640"></a>00640 <span class="comment">       \030: Connected</span>
<a name="l00641"></a>00641 <span class="comment">       \031: Busy</span>
<a name="l00642"></a>00642 <span class="comment">       \032: Line In Use</span>
<a name="l00643"></a>00643 <span class="comment">       \033: Call Waiting</span>
<a name="l00644"></a>00644 <span class="comment">       \034: Call Transfer</span>
<a name="l00645"></a>00645 <span class="comment">       \035: Call Park</span>
<a name="l00646"></a>00646 <span class="comment">       \036: Call Proceed</span>
<a name="l00647"></a>00647 <span class="comment">       \037: In Use Remote</span>
<a name="l00648"></a>00648 <span class="comment">       \040: Enter number</span>
<a name="l00649"></a>00649 <span class="comment">       \041: Call park At</span>
<a name="l00650"></a>00650 <span class="comment">       \042: Primary Only</span>
<a name="l00651"></a>00651 <span class="comment">       \043: Temp Fail</span>
<a name="l00652"></a>00652 <span class="comment">       \044: You Have VoiceMail</span>
<a name="l00653"></a>00653 <span class="comment">       \045: Forwarded to</span>
<a name="l00654"></a>00654 <span class="comment">       \046: Can Not Complete Conference</span>
<a name="l00655"></a>00655 <span class="comment">       \047: No Conference Bridge</span>
<a name="l00656"></a>00656 <span class="comment">       \050: Can Not Hold Primary Control</span>
<a name="l00657"></a>00657 <span class="comment">       \051: Invalid Conference Participant</span>
<a name="l00658"></a>00658 <span class="comment">       \052: In Conference Already</span>
<a name="l00659"></a>00659 <span class="comment">       \053: No Participant Info</span>
<a name="l00660"></a>00660 <span class="comment">       \054: Exceed Maximum Parties</span>
<a name="l00661"></a>00661 <span class="comment">       \055: Key Is Not Active</span>
<a name="l00662"></a>00662 <span class="comment">       \056: Error No License</span>
<a name="l00663"></a>00663 <span class="comment">       \057: Error DBConfig</span>
<a name="l00664"></a>00664 <span class="comment">       \060: Error Database</span>
<a name="l00665"></a>00665 <span class="comment">       \061: Error Pass Limit</span>
<a name="l00666"></a>00666 <span class="comment">       \062: Error Unknown</span>
<a name="l00667"></a>00667 <span class="comment">       \063: Error Mismatch</span>
<a name="l00668"></a>00668 <span class="comment">       \064: Conference</span>
<a name="l00669"></a>00669 <span class="comment">       \065: Park Number</span>
<a name="l00670"></a>00670 <span class="comment">       \066: Private</span>
<a name="l00671"></a>00671 <span class="comment">       \067: Not Enough Bandwidth</span>
<a name="l00672"></a>00672 <span class="comment">       \070: Unknown Number</span>
<a name="l00673"></a>00673 <span class="comment">       \071: RmLstC</span>
<a name="l00674"></a>00674 <span class="comment">       \072: Voicemail</span>
<a name="l00675"></a>00675 <span class="comment">       \073: ImmDiv</span>
<a name="l00676"></a>00676 <span class="comment">       \074: Intrcpt</span>
<a name="l00677"></a>00677 <span class="comment">       \075: SetWtch</span>
<a name="l00678"></a>00678 <span class="comment">       \076: TrnsfVM</span>
<a name="l00679"></a>00679 <span class="comment">       \077: DND</span>
<a name="l00680"></a>00680 <span class="comment">       \100: DivAll</span>
<a name="l00681"></a>00681 <span class="comment">       \101: CallBack</span>
<a name="l00682"></a>00682 <span class="comment">       \102: Network congestion,rerouting</span>
<a name="l00683"></a>00683 <span class="comment">       \103: Barge</span>
<a name="l00684"></a>00684 <span class="comment">       \104: Failed to setup Barge</span>
<a name="l00685"></a>00685 <span class="comment">       \105: Another Barge exists</span>
<a name="l00686"></a>00686 <span class="comment">       \106: Incompatible device type</span>
<a name="l00687"></a>00687 <span class="comment">       \107: No Park Number Available</span>
<a name="l00688"></a>00688 <span class="comment">       \110: CallPark Reversion</span>
<a name="l00689"></a>00689 <span class="comment">       \111: Service is not Active</span>
<a name="l00690"></a>00690 <span class="comment">       \112: High Traffic Try Again Later</span>
<a name="l00691"></a>00691 <span class="comment">       \113: QRT</span>
<a name="l00692"></a>00692 <span class="comment">       \114: MCID</span>
<a name="l00693"></a>00693 <span class="comment">       \115: DirTrfr</span>
<a name="l00694"></a>00694 <span class="comment">       \116: Select</span>
<a name="l00695"></a>00695 <span class="comment">       \117: ConfList</span>
<a name="l00696"></a>00696 <span class="comment">       \120: iDivert</span>
<a name="l00697"></a>00697 <span class="comment">       \121: cBarge</span>
<a name="l00698"></a>00698 <span class="comment">       \122: Can Not Complete Transfer</span>
<a name="l00699"></a>00699 <span class="comment">       \123: Can Not Join Calls</span>
<a name="l00700"></a>00700 <span class="comment">       \124: Mcid Successful</span>
<a name="l00701"></a>00701 <span class="comment">       \125: Number Not Configured</span>
<a name="l00702"></a>00702 <span class="comment">       \126: Security Error</span>
<a name="l00703"></a>00703 <span class="comment">       \127: Video Bandwidth Unavailable</span>
<a name="l00704"></a>00704 <span class="comment">       \130: VidMode</span>
<a name="l00705"></a>00705 <span class="comment">       \131: Max Call Duration Timeout</span>
<a name="l00706"></a>00706 <span class="comment">       \132: Max Hold Duration Timeout</span>
<a name="l00707"></a>00707 <span class="comment">       \133: OPickUp</span>
<a name="l00708"></a>00708 <span class="comment">       \134: ???</span>
<a name="l00709"></a>00709 <span class="comment">       \135: ???</span>
<a name="l00710"></a>00710 <span class="comment">       \136: ???</span>
<a name="l00711"></a>00711 <span class="comment">       \137: ???</span>
<a name="l00712"></a>00712 <span class="comment">       \140: ???</span>
<a name="l00713"></a>00713 <span class="comment">       \141: External Transfer Restricted</span>
<a name="l00714"></a>00714 <span class="comment">       \142: ???</span>
<a name="l00715"></a>00715 <span class="comment">       \143: ???</span>
<a name="l00716"></a>00716 <span class="comment">       \144: ???</span>
<a name="l00717"></a>00717 <span class="comment">       \145: Mac Address</span>
<a name="l00718"></a>00718 <span class="comment">       \146: Host Name</span>
<a name="l00719"></a>00719 <span class="comment">       \147: Domain Name</span>
<a name="l00720"></a>00720 <span class="comment">       \150: IP Address</span>
<a name="l00721"></a>00721 <span class="comment">       \151: Subnet Mask</span>
<a name="l00722"></a>00722 <span class="comment">       \152: TFTP Server 1</span>
<a name="l00723"></a>00723 <span class="comment">       \153: Default Router 1</span>
<a name="l00724"></a>00724 <span class="comment">       \154: Default Router 2</span>
<a name="l00725"></a>00725 <span class="comment">       \155: Default Router 3</span>
<a name="l00726"></a>00726 <span class="comment">       \156: Default Router 4</span>
<a name="l00727"></a>00727 <span class="comment">       \157: Default Router 5</span>
<a name="l00728"></a>00728 <span class="comment">       \160: DNS Server 1</span>
<a name="l00729"></a>00729 <span class="comment">       \161: DNS Server 2</span>
<a name="l00730"></a>00730 <span class="comment">       \162: DNS Server 3</span>
<a name="l00731"></a>00731 <span class="comment">       \163: DNS Server 4</span>
<a name="l00732"></a>00732 <span class="comment">       \164: DNS Server 5</span>
<a name="l00733"></a>00733 <span class="comment">       \165: Operational VLAN Id</span>
<a name="l00734"></a>00734 <span class="comment">       \166: Admin. VLAN Id</span>
<a name="l00735"></a>00735 <span class="comment">       \167: CallManager 1</span>
<a name="l00736"></a>00736 <span class="comment">       \170: CallManager 2</span>
<a name="l00737"></a>00737 <span class="comment">       \171: CallManager 3</span>
<a name="l00738"></a>00738 <span class="comment">       \172: CallManager 4</span>
<a name="l00739"></a>00739 <span class="comment">       \173: CallManager 5</span>
<a name="l00740"></a>00740 <span class="comment">       \174: Information URL</span>
<a name="l00741"></a>00741 <span class="comment">       \175: Directories URL</span>
<a name="l00742"></a>00742 <span class="comment">       \176: Messages URL</span>
<a name="l00743"></a>00743 <span class="comment">       \177: Services URL</span>
<a name="l00744"></a>00744 <span class="comment"> */</span>
<a name="l00745"></a>00745 
<a name="l00746"></a><a class="code" href="structsoft__key__definitions.html">00746</a> <span class="keyword">struct </span><a class="code" href="structsoft__key__definitions.html">soft_key_definitions</a> {
<a name="l00747"></a><a class="code" href="structsoft__key__definitions.html#a858b33a55c1de4c9bc94b982fc722754">00747</a>    <span class="keyword">const</span> uint8_t <a class="code" href="structsoft__key__definitions.html#a858b33a55c1de4c9bc94b982fc722754">mode</a>;
<a name="l00748"></a><a class="code" href="structsoft__key__definitions.html#a841d7c4569174bfa7f45657449a69b6f">00748</a>    <span class="keyword">const</span> uint8_t *<a class="code" href="structsoft__key__definitions.html#a841d7c4569174bfa7f45657449a69b6f">defaults</a>;
<a name="l00749"></a><a class="code" href="structsoft__key__definitions.html#ada8f9c34ea6de0264c2d808acf540ad2">00749</a>    <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="structsoft__key__definitions.html#ada8f9c34ea6de0264c2d808acf540ad2">count</a>;
<a name="l00750"></a>00750 };
<a name="l00751"></a>00751 
<a name="l00752"></a><a class="code" href="chan__skinny_8c.html#a815562de85c22c6f5222a45ccf20b64c">00752</a> <span class="keyword">static</span> <span class="keyword">const</span> uint8_t <a class="code" href="chan__skinny_8c.html#a815562de85c22c6f5222a45ccf20b64c">soft_key_default_onhook</a>[] = {
<a name="l00753"></a>00753    <a class="code" href="chan__skinny_8c.html#a32dc8fa6b998e84ecd2dd709774e25e9">SOFTKEY_REDIAL</a>,
<a name="l00754"></a>00754    <a class="code" href="chan__skinny_8c.html#aee0ce143cf0a49d49c86cabcf1c829cc">SOFTKEY_NEWCALL</a>,
<a name="l00755"></a>00755    <a class="code" href="chan__skinny_8c.html#a0045f3127762983aa2efee3a41e37c40">SOFTKEY_CFWDALL</a>,
<a name="l00756"></a>00756    <a class="code" href="chan__skinny_8c.html#a744ad78b0f1ed0a0f678528bc64b1b86">SOFTKEY_CFWDBUSY</a>,
<a name="l00757"></a>00757    <a class="code" href="chan__skinny_8c.html#a5673732b39310cef6a6f21820d95be71">SOFTKEY_DND</a>,
<a name="l00758"></a>00758    <span class="comment">/*SOFTKEY_GPICKUP,</span>
<a name="l00759"></a>00759 <span class="comment">   SOFTKEY_CONFRN,*/</span>
<a name="l00760"></a>00760 };
<a name="l00761"></a>00761 
<a name="l00762"></a><a class="code" href="chan__skinny_8c.html#a0667a78cfbac7038a1d11c16ba6a7179">00762</a> <span class="keyword">static</span> <span class="keyword">const</span> uint8_t <a class="code" href="chan__skinny_8c.html#a0667a78cfbac7038a1d11c16ba6a7179">soft_key_default_connected</a>[] = {
<a name="l00763"></a>00763    <a class="code" href="chan__skinny_8c.html#ab185c974c2da13dfd3d0fba53d1c4966">SOFTKEY_HOLD</a>,
<a name="l00764"></a>00764    <a class="code" href="chan__skinny_8c.html#aabbdbf515a0e193662eb006117759b00">SOFTKEY_ENDCALL</a>,
<a name="l00765"></a>00765    <a class="code" href="chan__skinny_8c.html#a666157a09f886de9effc7d648ad7dde8">SOFTKEY_TRNSFER</a>,
<a name="l00766"></a>00766    <a class="code" href="chan__skinny_8c.html#a572b1d3a412d0e3eec76ed6888d88885">SOFTKEY_PARK</a>,
<a name="l00767"></a>00767    <a class="code" href="chan__skinny_8c.html#a0045f3127762983aa2efee3a41e37c40">SOFTKEY_CFWDALL</a>,
<a name="l00768"></a>00768    <a class="code" href="chan__skinny_8c.html#a744ad78b0f1ed0a0f678528bc64b1b86">SOFTKEY_CFWDBUSY</a>,
<a name="l00769"></a>00769 };
<a name="l00770"></a>00770 
<a name="l00771"></a><a class="code" href="chan__skinny_8c.html#a86fc6917dda3a2a55f4eafc293ecd49e">00771</a> <span class="keyword">static</span> <span class="keyword">const</span> uint8_t <a class="code" href="chan__skinny_8c.html#a86fc6917dda3a2a55f4eafc293ecd49e">soft_key_default_onhold</a>[] = {
<a name="l00772"></a>00772    <a class="code" href="chan__skinny_8c.html#af1726f9c94deb2725bdd8fabf57f1a53">SOFTKEY_RESUME</a>,
<a name="l00773"></a>00773    <a class="code" href="chan__skinny_8c.html#aee0ce143cf0a49d49c86cabcf1c829cc">SOFTKEY_NEWCALL</a>,
<a name="l00774"></a>00774    <a class="code" href="chan__skinny_8c.html#aabbdbf515a0e193662eb006117759b00">SOFTKEY_ENDCALL</a>,
<a name="l00775"></a>00775    <a class="code" href="chan__skinny_8c.html#a666157a09f886de9effc7d648ad7dde8">SOFTKEY_TRNSFER</a>,
<a name="l00776"></a>00776 };
<a name="l00777"></a>00777 
<a name="l00778"></a><a class="code" href="chan__skinny_8c.html#af29a8ef9f4bbcc04e455e3002498e3d7">00778</a> <span class="keyword">static</span> <span class="keyword">const</span> uint8_t <a class="code" href="chan__skinny_8c.html#af29a8ef9f4bbcc04e455e3002498e3d7">soft_key_default_ringin</a>[] = {
<a name="l00779"></a>00779    <a class="code" href="chan__skinny_8c.html#a3b3e11372b76c65944afdea7205fa209">SOFTKEY_ANSWER</a>,
<a name="l00780"></a>00780    <a class="code" href="chan__skinny_8c.html#aabbdbf515a0e193662eb006117759b00">SOFTKEY_ENDCALL</a>,
<a name="l00781"></a>00781    <a class="code" href="chan__skinny_8c.html#a666157a09f886de9effc7d648ad7dde8">SOFTKEY_TRNSFER</a>,
<a name="l00782"></a>00782 };
<a name="l00783"></a>00783 
<a name="l00784"></a><a class="code" href="chan__skinny_8c.html#a84e0277622bc76fb08e79401238bc684">00784</a> <span class="keyword">static</span> <span class="keyword">const</span> uint8_t <a class="code" href="chan__skinny_8c.html#a84e0277622bc76fb08e79401238bc684">soft_key_default_offhook</a>[] = {
<a name="l00785"></a>00785    <a class="code" href="chan__skinny_8c.html#a32dc8fa6b998e84ecd2dd709774e25e9">SOFTKEY_REDIAL</a>,
<a name="l00786"></a>00786    <a class="code" href="chan__skinny_8c.html#aabbdbf515a0e193662eb006117759b00">SOFTKEY_ENDCALL</a>,
<a name="l00787"></a>00787    <a class="code" href="chan__skinny_8c.html#a0045f3127762983aa2efee3a41e37c40">SOFTKEY_CFWDALL</a>,
<a name="l00788"></a>00788    <a class="code" href="chan__skinny_8c.html#a744ad78b0f1ed0a0f678528bc64b1b86">SOFTKEY_CFWDBUSY</a>,
<a name="l00789"></a>00789    <span class="comment">/*SOFTKEY_GPICKUP,*/</span>
<a name="l00790"></a>00790 };
<a name="l00791"></a>00791 
<a name="l00792"></a><a class="code" href="chan__skinny_8c.html#a20c8372eacb3685db5a2cff96555d215">00792</a> <span class="keyword">static</span> <span class="keyword">const</span> uint8_t <a class="code" href="chan__skinny_8c.html#a20c8372eacb3685db5a2cff96555d215">soft_key_default_connwithtrans</a>[] = {
<a name="l00793"></a>00793    <a class="code" href="chan__skinny_8c.html#ab185c974c2da13dfd3d0fba53d1c4966">SOFTKEY_HOLD</a>,
<a name="l00794"></a>00794    <a class="code" href="chan__skinny_8c.html#aabbdbf515a0e193662eb006117759b00">SOFTKEY_ENDCALL</a>,
<a name="l00795"></a>00795    <a class="code" href="chan__skinny_8c.html#a666157a09f886de9effc7d648ad7dde8">SOFTKEY_TRNSFER</a>,
<a name="l00796"></a>00796    <a class="code" href="chan__skinny_8c.html#a572b1d3a412d0e3eec76ed6888d88885">SOFTKEY_PARK</a>,
<a name="l00797"></a>00797    <a class="code" href="chan__skinny_8c.html#a0045f3127762983aa2efee3a41e37c40">SOFTKEY_CFWDALL</a>,
<a name="l00798"></a>00798    <a class="code" href="chan__skinny_8c.html#a744ad78b0f1ed0a0f678528bc64b1b86">SOFTKEY_CFWDBUSY</a>,
<a name="l00799"></a>00799 };
<a name="l00800"></a>00800 
<a name="l00801"></a><a class="code" href="chan__skinny_8c.html#a4c29acb28402920280164751e852f1b6">00801</a> <span class="keyword">static</span> <span class="keyword">const</span> uint8_t <a class="code" href="chan__skinny_8c.html#a4c29acb28402920280164751e852f1b6">soft_key_default_dadfd</a>[] = {
<a name="l00802"></a>00802    <a class="code" href="chan__skinny_8c.html#a8faf0f3196e7a21d01dbbb7719bf11e7">SOFTKEY_BKSPC</a>,
<a name="l00803"></a>00803    <a class="code" href="chan__skinny_8c.html#aabbdbf515a0e193662eb006117759b00">SOFTKEY_ENDCALL</a>,
<a name="l00804"></a>00804 };
<a name="l00805"></a>00805 
<a name="l00806"></a><a class="code" href="chan__skinny_8c.html#ab6da3e1e98802660151ac05e707473ca">00806</a> <span class="keyword">static</span> <span class="keyword">const</span> uint8_t <a class="code" href="chan__skinny_8c.html#ab6da3e1e98802660151ac05e707473ca">soft_key_default_connwithconf</a>[] = {
<a name="l00807"></a>00807    <a class="code" href="chan__skinny_8c.html#ae3ccec26212b7c55493ffa4865cbb88d">SOFTKEY_NONE</a>,
<a name="l00808"></a>00808 };
<a name="l00809"></a>00809 
<a name="l00810"></a><a class="code" href="chan__skinny_8c.html#abb2d1f1f8867d0b06cc5ef1978409923">00810</a> <span class="keyword">static</span> <span class="keyword">const</span> uint8_t <a class="code" href="chan__skinny_8c.html#abb2d1f1f8867d0b06cc5ef1978409923">soft_key_default_ringout</a>[] = {
<a name="l00811"></a>00811    <a class="code" href="chan__skinny_8c.html#ae3ccec26212b7c55493ffa4865cbb88d">SOFTKEY_NONE</a>,
<a name="l00812"></a>00812    <a class="code" href="chan__skinny_8c.html#aabbdbf515a0e193662eb006117759b00">SOFTKEY_ENDCALL</a>,
<a name="l00813"></a>00813 };
<a name="l00814"></a>00814 
<a name="l00815"></a><a class="code" href="chan__skinny_8c.html#a766fe5bf5f76a8b76bf10ccdafd26c46">00815</a> <span class="keyword">static</span> <span class="keyword">const</span> uint8_t <a class="code" href="chan__skinny_8c.html#a766fe5bf5f76a8b76bf10ccdafd26c46">soft_key_default_offhookwithfeat</a>[] = {
<a name="l00816"></a>00816    <a class="code" href="chan__skinny_8c.html#a32dc8fa6b998e84ecd2dd709774e25e9">SOFTKEY_REDIAL</a>,
<a name="l00817"></a>00817    <a class="code" href="chan__skinny_8c.html#aabbdbf515a0e193662eb006117759b00">SOFTKEY_ENDCALL</a>,
<a name="l00818"></a>00818    <a class="code" href="chan__skinny_8c.html#a666157a09f886de9effc7d648ad7dde8">SOFTKEY_TRNSFER</a>,
<a name="l00819"></a>00819 };
<a name="l00820"></a>00820 
<a name="l00821"></a><a class="code" href="chan__skinny_8c.html#afe35ecd523687f3986c140c1638790a2">00821</a> <span class="keyword">static</span> <span class="keyword">const</span> uint8_t <a class="code" href="chan__skinny_8c.html#afe35ecd523687f3986c140c1638790a2">soft_key_default_unknown</a>[] = {
<a name="l00822"></a>00822    <a class="code" href="chan__skinny_8c.html#ae3ccec26212b7c55493ffa4865cbb88d">SOFTKEY_NONE</a>,
<a name="l00823"></a>00823 };
<a name="l00824"></a>00824 
<a name="l00825"></a><a class="code" href="chan__skinny_8c.html#ac79dc4d661a8fa110c7314dbb782f52d">00825</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structsoft__key__definitions.html">soft_key_definitions</a> <a class="code" href="chan__skinny_8c.html#ac79dc4d661a8fa110c7314dbb782f52d">soft_key_default_definitions</a>[] = {
<a name="l00826"></a>00826    {<a class="code" href="chan__skinny_8c.html#aab983751d9fb47d03d07a9e9dd2b4776">KEYDEF_ONHOOK</a>, soft_key_default_onhook, <span class="keyword">sizeof</span>(soft_key_default_onhook) / <span class="keyword">sizeof</span>(uint8_t)},
<a name="l00827"></a>00827    {<a class="code" href="chan__skinny_8c.html#aad5f46f88fa82da05103795046e110b7">KEYDEF_CONNECTED</a>, soft_key_default_connected, <span class="keyword">sizeof</span>(soft_key_default_connected) / <span class="keyword">sizeof</span>(uint8_t)},
<a name="l00828"></a>00828    {<a class="code" href="chan__skinny_8c.html#a1c1b2ec6acc543dbd96c917364d733e3">KEYDEF_ONHOLD</a>, soft_key_default_onhold, <span class="keyword">sizeof</span>(soft_key_default_onhold) / <span class="keyword">sizeof</span>(uint8_t)},
<a name="l00829"></a>00829    {<a class="code" href="chan__skinny_8c.html#a529cdb7507128859a179f79e1966eb53">KEYDEF_RINGIN</a>, soft_key_default_ringin, <span class="keyword">sizeof</span>(soft_key_default_ringin) / <span class="keyword">sizeof</span>(uint8_t)},
<a name="l00830"></a>00830    {<a class="code" href="chan__skinny_8c.html#a32b4dedb91edf80328d5cda72166bf6e">KEYDEF_OFFHOOK</a>, soft_key_default_offhook, <span class="keyword">sizeof</span>(soft_key_default_offhook) / <span class="keyword">sizeof</span>(uint8_t)},
<a name="l00831"></a>00831    {<a class="code" href="chan__skinny_8c.html#ac14d8ee9813b5766c4161fac6c66432d">KEYDEF_CONNWITHTRANS</a>, soft_key_default_connwithtrans, <span class="keyword">sizeof</span>(soft_key_default_connwithtrans) / <span class="keyword">sizeof</span>(uint8_t)},
<a name="l00832"></a>00832    {<a class="code" href="chan__skinny_8c.html#a526c9d413d9b96dfea81eae19b0619b5">KEYDEF_DADFD</a>, soft_key_default_dadfd, <span class="keyword">sizeof</span>(soft_key_default_dadfd) / <span class="keyword">sizeof</span>(uint8_t)},
<a name="l00833"></a>00833    {<a class="code" href="chan__skinny_8c.html#a73c8243c4af2fae81ddd15e650203a58">KEYDEF_CONNWITHCONF</a>, soft_key_default_connwithconf, <span class="keyword">sizeof</span>(soft_key_default_connwithconf) / <span class="keyword">sizeof</span>(uint8_t)},
<a name="l00834"></a>00834    {<a class="code" href="chan__skinny_8c.html#ae18cb03403da5513c2c6ac0c32c4c939">KEYDEF_RINGOUT</a>, soft_key_default_ringout, <span class="keyword">sizeof</span>(soft_key_default_ringout) / <span class="keyword">sizeof</span>(uint8_t)},
<a name="l00835"></a>00835    {<a class="code" href="chan__skinny_8c.html#a0d46746cfe50b67c811cd2fc042e0729">KEYDEF_OFFHOOKWITHFEAT</a>, soft_key_default_offhookwithfeat, <span class="keyword">sizeof</span>(soft_key_default_offhookwithfeat) / <span class="keyword">sizeof</span>(uint8_t)},
<a name="l00836"></a>00836    {<a class="code" href="chan__skinny_8c.html#adca111bd3e13f311a71c0aff5f89b081">KEYDEF_UNKNOWN</a>, soft_key_default_unknown, <span class="keyword">sizeof</span>(soft_key_default_unknown) / <span class="keyword">sizeof</span>(uint8_t)}
<a name="l00837"></a>00837 };
<a name="l00838"></a>00838 
<a name="l00839"></a><a class="code" href="structsoft__key__template__res__message.html">00839</a> <span class="keyword">struct </span><a class="code" href="structsoft__key__template__res__message.html">soft_key_template_res_message</a> {
<a name="l00840"></a><a class="code" href="structsoft__key__template__res__message.html#aeb69bb0f70da60dbba0bf2e7c5fdd33d">00840</a>    uint32_t <a class="code" href="structsoft__key__template__res__message.html#aeb69bb0f70da60dbba0bf2e7c5fdd33d">softKeyOffset</a>;
<a name="l00841"></a><a class="code" href="structsoft__key__template__res__message.html#a8db1b287e91a13a96808f529a4dc49e9">00841</a>    uint32_t <a class="code" href="structsoft__key__template__res__message.html#a8db1b287e91a13a96808f529a4dc49e9">softKeyCount</a>;
<a name="l00842"></a><a class="code" href="structsoft__key__template__res__message.html#a48b489a0ba6479db34f7c580f40af762">00842</a>    uint32_t <a class="code" href="structsoft__key__template__res__message.html#a48b489a0ba6479db34f7c580f40af762">totalSoftKeyCount</a>;
<a name="l00843"></a><a class="code" href="structsoft__key__template__res__message.html#ad6fd242c4e813675148ea902f327e4f1">00843</a>    <span class="keyword">struct </span><a class="code" href="structsoft__key__template__definition.html">soft_key_template_definition</a> <a class="code" href="structsoft__key__template__res__message.html#ad6fd242c4e813675148ea902f327e4f1">softKeyTemplateDefinition</a>[32];
<a name="l00844"></a>00844 };
<a name="l00845"></a>00845 
<a name="l00846"></a><a class="code" href="chan__skinny_8c.html#aee3cbe69978806b2ccea81e6931e5f06">00846</a> <span class="preprocessor">#define SOFT_KEY_SET_RES_MESSAGE 0x0109</span>
<a name="l00847"></a>00847 <span class="preprocessor"></span>
<a name="l00848"></a><a class="code" href="structsoft__key__set__definition.html">00848</a> <span class="keyword">struct </span><a class="code" href="structsoft__key__set__definition.html">soft_key_set_definition</a> {
<a name="l00849"></a><a class="code" href="structsoft__key__set__definition.html#a29a5f3fd75bf8ffa5df8c331c1ac3e18">00849</a>    uint8_t <a class="code" href="structsoft__key__set__definition.html#a29a5f3fd75bf8ffa5df8c331c1ac3e18">softKeyTemplateIndex</a>[16];
<a name="l00850"></a><a class="code" href="structsoft__key__set__definition.html#ac85b46723c412dd2807ee7345621cc3f">00850</a>    uint16_t <a class="code" href="structsoft__key__set__definition.html#ac85b46723c412dd2807ee7345621cc3f">softKeyInfoIndex</a>[16];
<a name="l00851"></a>00851 };
<a name="l00852"></a>00852 
<a name="l00853"></a><a class="code" href="structsoft__key__set__res__message.html">00853</a> <span class="keyword">struct </span><a class="code" href="structsoft__key__set__res__message.html">soft_key_set_res_message</a> {
<a name="l00854"></a><a class="code" href="structsoft__key__set__res__message.html#a9e0609aa98d8027663e88c42524a391f">00854</a>    uint32_t <a class="code" href="structsoft__key__set__res__message.html#a9e0609aa98d8027663e88c42524a391f">softKeySetOffset</a>;
<a name="l00855"></a><a class="code" href="structsoft__key__set__res__message.html#a821d404bc80c2b793f4d0bd3f125928b">00855</a>    uint32_t <a class="code" href="structsoft__key__set__res__message.html#a821d404bc80c2b793f4d0bd3f125928b">softKeySetCount</a>;
<a name="l00856"></a><a class="code" href="structsoft__key__set__res__message.html#a626519dd0d8e97afdb9ab94f3f0514af">00856</a>    uint32_t <a class="code" href="structsoft__key__set__res__message.html#a626519dd0d8e97afdb9ab94f3f0514af">totalSoftKeySetCount</a>;
<a name="l00857"></a><a class="code" href="structsoft__key__set__res__message.html#ab19f86d91e65941777c4e0c5a840fdae">00857</a>    <span class="keyword">struct </span><a class="code" href="structsoft__key__set__definition.html">soft_key_set_definition</a> <a class="code" href="structsoft__key__set__res__message.html#ab19f86d91e65941777c4e0c5a840fdae">softKeySetDefinition</a>[16];
<a name="l00858"></a><a class="code" href="structsoft__key__set__res__message.html#a97e3bb97951482c8cf4d55a2d0bfcb62">00858</a>    uint32_t <a class="code" href="structsoft__key__set__res__message.html#a97e3bb97951482c8cf4d55a2d0bfcb62">res</a>;
<a name="l00859"></a>00859 };
<a name="l00860"></a>00860 
<a name="l00861"></a><a class="code" href="chan__skinny_8c.html#acf9ff0dcbbb7c545417a22affaddc03a">00861</a> <span class="preprocessor">#define SELECT_SOFT_KEYS_MESSAGE 0x0110</span>
<a name="l00862"></a><a class="code" href="structselect__soft__keys__message.html">00862</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structselect__soft__keys__message.html">select_soft_keys_message</a> {
<a name="l00863"></a><a class="code" href="structselect__soft__keys__message.html#a9ed36c4f5392e9f1819ec7c9eb9aff80">00863</a>    uint32_t <a class="code" href="structselect__soft__keys__message.html#a9ed36c4f5392e9f1819ec7c9eb9aff80">instance</a>;
<a name="l00864"></a><a class="code" href="structselect__soft__keys__message.html#aa68938e371fea91ad4b64381877bd381">00864</a>    uint32_t <a class="code" href="structselect__soft__keys__message.html#aa68938e371fea91ad4b64381877bd381">reference</a>;
<a name="l00865"></a><a class="code" href="structselect__soft__keys__message.html#adc2041b10f838792513938afdd303d8a">00865</a>    uint32_t <a class="code" href="structselect__soft__keys__message.html#adc2041b10f838792513938afdd303d8a">softKeySetIndex</a>;
<a name="l00866"></a><a class="code" href="structselect__soft__keys__message.html#ad25df21c508e777301c2d307ee3d07af">00866</a>    uint32_t <a class="code" href="structselect__soft__keys__message.html#ad25df21c508e777301c2d307ee3d07af">validKeyMask</a>;
<a name="l00867"></a>00867 };
<a name="l00868"></a>00868 
<a name="l00869"></a><a class="code" href="chan__skinny_8c.html#a2d6255614b0eec8c48bc371afdb18443">00869</a> <span class="preprocessor">#define CALL_STATE_MESSAGE 0x0111</span>
<a name="l00870"></a><a class="code" href="structcall__state__message.html">00870</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structcall__state__message.html">call_state_message</a> {
<a name="l00871"></a><a class="code" href="structcall__state__message.html#a02033745eb42ba576e671f4a24c39c48">00871</a>    uint32_t <a class="code" href="structcall__state__message.html#a02033745eb42ba576e671f4a24c39c48">callState</a>;
<a name="l00872"></a><a class="code" href="structcall__state__message.html#a3c8ec1b11804b48f666007331e0c90ba">00872</a>    uint32_t <a class="code" href="structcall__state__message.html#a3c8ec1b11804b48f666007331e0c90ba">lineInstance</a>;
<a name="l00873"></a><a class="code" href="structcall__state__message.html#a8c5b70179481930bfaef1fa8f6aaba74">00873</a>    uint32_t <a class="code" href="structcall__state__message.html#a8c5b70179481930bfaef1fa8f6aaba74">callReference</a>;
<a name="l00874"></a><a class="code" href="structcall__state__message.html#a632529daf45d3e778a9a1991e28e17fc">00874</a>    uint32_t <a class="code" href="structcall__state__message.html#a632529daf45d3e778a9a1991e28e17fc">space</a>[3];
<a name="l00875"></a>00875 };
<a name="l00876"></a>00876 
<a name="l00877"></a><a class="code" href="chan__skinny_8c.html#ae459fe08b297c169d379436bd538f440">00877</a> <span class="preprocessor">#define DISPLAY_PROMPT_STATUS_MESSAGE 0x0112</span>
<a name="l00878"></a><a class="code" href="structdisplay__prompt__status__message.html">00878</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structdisplay__prompt__status__message.html">display_prompt_status_message</a> {
<a name="l00879"></a><a class="code" href="structdisplay__prompt__status__message.html#abdf697e332017cc49abf0735c2eae589">00879</a>    uint32_t <a class="code" href="structdisplay__prompt__status__message.html#abdf697e332017cc49abf0735c2eae589">messageTimeout</a>;
<a name="l00880"></a><a class="code" href="structdisplay__prompt__status__message.html#a85294cb46cae34e2921c7051bdabfdd6">00880</a>    <span class="keywordtype">char</span> <a class="code" href="structdisplay__prompt__status__message.html#a85294cb46cae34e2921c7051bdabfdd6">promptMessage</a>[32];
<a name="l00881"></a><a class="code" href="structdisplay__prompt__status__message.html#a3c8ec1b11804b48f666007331e0c90ba">00881</a>    uint32_t <a class="code" href="structdisplay__prompt__status__message.html#a3c8ec1b11804b48f666007331e0c90ba">lineInstance</a>;
<a name="l00882"></a><a class="code" href="structdisplay__prompt__status__message.html#a8c5b70179481930bfaef1fa8f6aaba74">00882</a>    uint32_t <a class="code" href="structdisplay__prompt__status__message.html#a8c5b70179481930bfaef1fa8f6aaba74">callReference</a>;
<a name="l00883"></a><a class="code" href="structdisplay__prompt__status__message.html#a632529daf45d3e778a9a1991e28e17fc">00883</a>    uint32_t <a class="code" href="structdisplay__prompt__status__message.html#a632529daf45d3e778a9a1991e28e17fc">space</a>[3];
<a name="l00884"></a>00884 };
<a name="l00885"></a>00885 
<a name="l00886"></a><a class="code" href="chan__skinny_8c.html#a2f74ea6fd6eab3eafc9fc39213034e9e">00886</a> <span class="preprocessor">#define CLEAR_PROMPT_MESSAGE  0x0113</span>
<a name="l00887"></a><a class="code" href="structclear__prompt__message.html">00887</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structclear__prompt__message.html">clear_prompt_message</a> {
<a name="l00888"></a><a class="code" href="structclear__prompt__message.html#a3c8ec1b11804b48f666007331e0c90ba">00888</a>    uint32_t <a class="code" href="structclear__prompt__message.html#a3c8ec1b11804b48f666007331e0c90ba">lineInstance</a>;
<a name="l00889"></a><a class="code" href="structclear__prompt__message.html#a8c5b70179481930bfaef1fa8f6aaba74">00889</a>    uint32_t <a class="code" href="structclear__prompt__message.html#a8c5b70179481930bfaef1fa8f6aaba74">callReference</a>;
<a name="l00890"></a>00890 };
<a name="l00891"></a>00891 
<a name="l00892"></a><a class="code" href="chan__skinny_8c.html#a5ba13eec8f847d9d500c58f2f9503b95">00892</a> <span class="preprocessor">#define DISPLAY_NOTIFY_MESSAGE 0x0114</span>
<a name="l00893"></a><a class="code" href="structdisplay__notify__message.html">00893</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structdisplay__notify__message.html">display_notify_message</a> {
<a name="l00894"></a><a class="code" href="structdisplay__notify__message.html#ab90d738fa36461d19bce3455a553f0f1">00894</a>    uint32_t <a class="code" href="structdisplay__notify__message.html#ab90d738fa36461d19bce3455a553f0f1">displayTimeout</a>;
<a name="l00895"></a><a class="code" href="structdisplay__notify__message.html#a5eb30c11452cfefd9c9480037eabf99d">00895</a>    <span class="keywordtype">char</span> <a class="code" href="structdisplay__notify__message.html#a5eb30c11452cfefd9c9480037eabf99d">displayMessage</a>[100];
<a name="l00896"></a>00896 };
<a name="l00897"></a>00897 
<a name="l00898"></a><a class="code" href="chan__skinny_8c.html#af303fb67f64cde967ad9434875897f45">00898</a> <span class="preprocessor">#define ACTIVATE_CALL_PLANE_MESSAGE 0x0116</span>
<a name="l00899"></a><a class="code" href="structactivate__call__plane__message.html">00899</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structactivate__call__plane__message.html">activate_call_plane_message</a> {
<a name="l00900"></a><a class="code" href="structactivate__call__plane__message.html#a3c8ec1b11804b48f666007331e0c90ba">00900</a>    uint32_t <a class="code" href="structactivate__call__plane__message.html#a3c8ec1b11804b48f666007331e0c90ba">lineInstance</a>;
<a name="l00901"></a>00901 };
<a name="l00902"></a>00902 
<a name="l00903"></a><a class="code" href="chan__skinny_8c.html#a63b744d9de3913b89d002761073a0879">00903</a> <span class="preprocessor">#define DIALED_NUMBER_MESSAGE 0x011D</span>
<a name="l00904"></a><a class="code" href="structdialed__number__message.html">00904</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structdialed__number__message.html">dialed_number_message</a> {
<a name="l00905"></a><a class="code" href="structdialed__number__message.html#a559dde9437a7990069ccb75635e0be50">00905</a>    <span class="keywordtype">char</span> <a class="code" href="structdialed__number__message.html#a559dde9437a7990069ccb75635e0be50">dialedNumber</a>[24];
<a name="l00906"></a><a class="code" href="structdialed__number__message.html#a3c8ec1b11804b48f666007331e0c90ba">00906</a>    uint32_t <a class="code" href="structdialed__number__message.html#a3c8ec1b11804b48f666007331e0c90ba">lineInstance</a>;
<a name="l00907"></a><a class="code" href="structdialed__number__message.html#a8c5b70179481930bfaef1fa8f6aaba74">00907</a>    uint32_t <a class="code" href="structdialed__number__message.html#a8c5b70179481930bfaef1fa8f6aaba74">callReference</a>;
<a name="l00908"></a>00908 };
<a name="l00909"></a>00909 
<a name="l00910"></a><a class="code" href="unionskinny__data.html">00910</a> <span class="keyword">union </span><a class="code" href="unionskinny__data.html">skinny_data</a> {
<a name="l00911"></a><a class="code" href="unionskinny__data.html#a00a93cc2ecf0e10506731d164fd2e49d">00911</a>    <span class="keyword">struct </span><a class="code" href="structalarm__message.html">alarm_message</a> <a class="code" href="unionskinny__data.html#a00a93cc2ecf0e10506731d164fd2e49d">alarm</a>;
<a name="l00912"></a><a class="code" href="unionskinny__data.html#a883cd321c7b885c8eb325344e8a45e01">00912</a>    <span class="keyword">struct </span><a class="code" href="structspeed__dial__stat__req__message.html">speed_dial_stat_req_message</a> <a class="code" href="unionskinny__data.html#a883cd321c7b885c8eb325344e8a45e01">speeddialreq</a>;
<a name="l00913"></a><a class="code" href="unionskinny__data.html#aceb9d5d9b0983f8fb0e5523310274dc4">00913</a>    <span class="keyword">struct </span><a class="code" href="structregister__message.html">register_message</a> <a class="code" href="unionskinny__data.html#aceb9d5d9b0983f8fb0e5523310274dc4">reg</a>;
<a name="l00914"></a><a class="code" href="unionskinny__data.html#aab36685c6e9d5c3e2c01d568f2304663">00914</a>    <span class="keyword">struct </span><a class="code" href="structregister__ack__message.html">register_ack_message</a> <a class="code" href="unionskinny__data.html#aab36685c6e9d5c3e2c01d568f2304663">regack</a>;
<a name="l00915"></a><a class="code" href="unionskinny__data.html#a439767f912c8dce1e74fb1c3c45ee17b">00915</a>    <span class="keyword">struct </span><a class="code" href="structregister__rej__message.html">register_rej_message</a> <a class="code" href="unionskinny__data.html#a439767f912c8dce1e74fb1c3c45ee17b">regrej</a>;
<a name="l00916"></a><a class="code" href="unionskinny__data.html#a99fd8190ffcee05962cae3d8518033cc">00916</a>    <span class="keyword">struct </span><a class="code" href="structcapabilities__res__message.html">capabilities_res_message</a> <a class="code" href="unionskinny__data.html#a99fd8190ffcee05962cae3d8518033cc">caps</a>;
<a name="l00917"></a><a class="code" href="unionskinny__data.html#ab39e2139ac39eb022bbe54356481ec1d">00917</a>    <span class="keyword">struct </span><a class="code" href="structversion__res__message.html">version_res_message</a> <a class="code" href="unionskinny__data.html#ab39e2139ac39eb022bbe54356481ec1d">version</a>;
<a name="l00918"></a><a class="code" href="unionskinny__data.html#aeccc27699eb18669c1753cc2fd3ba382">00918</a>    <span class="keyword">struct </span><a class="code" href="structbutton__template__res__message.html">button_template_res_message</a> <a class="code" href="unionskinny__data.html#aeccc27699eb18669c1753cc2fd3ba382">buttontemplate</a>;
<a name="l00919"></a><a class="code" href="unionskinny__data.html#a0f450f5076cf5881aefe3fa6bc381edd">00919</a>    <span class="keyword">struct </span><a class="code" href="structdisplaytext__message.html">displaytext_message</a> <a class="code" href="unionskinny__data.html#a0f450f5076cf5881aefe3fa6bc381edd">displaytext</a>;
<a name="l00920"></a><a class="code" href="unionskinny__data.html#aaa71639d4715a03ba89b940efb207a6c">00920</a>    <span class="keyword">struct </span><a class="code" href="structdisplay__prompt__status__message.html">display_prompt_status_message</a> <a class="code" href="unionskinny__data.html#aaa71639d4715a03ba89b940efb207a6c">displaypromptstatus</a>;
<a name="l00921"></a><a class="code" href="unionskinny__data.html#a69f5aa4af56adffb6bf9f024b0da437f">00921</a>    <span class="keyword">struct </span><a class="code" href="structclear__prompt__message.html">clear_prompt_message</a> <a class="code" href="unionskinny__data.html#a69f5aa4af56adffb6bf9f024b0da437f">clearpromptstatus</a>;
<a name="l00922"></a><a class="code" href="unionskinny__data.html#ac6a060847a0ae4c9ce457a22c4df61fa">00922</a>    <span class="keyword">struct </span><a class="code" href="structdefinetimedate__message.html">definetimedate_message</a> <a class="code" href="unionskinny__data.html#ac6a060847a0ae4c9ce457a22c4df61fa">definetimedate</a>;
<a name="l00923"></a><a class="code" href="unionskinny__data.html#acfcbe2888df992727f690e1fbccd4e74">00923</a>    <span class="keyword">struct </span><a class="code" href="structstart__tone__message.html">start_tone_message</a> <a class="code" href="unionskinny__data.html#acfcbe2888df992727f690e1fbccd4e74">starttone</a>;
<a name="l00924"></a><a class="code" href="unionskinny__data.html#a42d52a186dbacb2769d37ae6c08543ff">00924</a>    <span class="keyword">struct </span><a class="code" href="structstop__tone__message.html">stop_tone_message</a> <a class="code" href="unionskinny__data.html#a42d52a186dbacb2769d37ae6c08543ff">stoptone</a>;
<a name="l00925"></a><a class="code" href="unionskinny__data.html#a23a2176cab0bee9f41d7b1af10f8f6cd">00925</a>    <span class="keyword">struct </span><a class="code" href="structspeed__dial__stat__res__message.html">speed_dial_stat_res_message</a> <a class="code" href="unionskinny__data.html#a23a2176cab0bee9f41d7b1af10f8f6cd">speeddial</a>;
<a name="l00926"></a><a class="code" href="unionskinny__data.html#ac8bbcfcff4905989003310cb08dedc92">00926</a>    <span class="keyword">struct </span><a class="code" href="structline__state__req__message.html">line_state_req_message</a> <a class="code" href="unionskinny__data.html#ac8bbcfcff4905989003310cb08dedc92">line</a>;
<a name="l00927"></a><a class="code" href="unionskinny__data.html#a0622af8a74c6dd3ce12a70c2013f3744">00927</a>    <span class="keyword">struct </span><a class="code" href="structline__stat__res__message.html">line_stat_res_message</a> <a class="code" href="unionskinny__data.html#a0622af8a74c6dd3ce12a70c2013f3744">linestat</a>;
<a name="l00928"></a><a class="code" href="unionskinny__data.html#a2c1c09cd3cb77663c2963dd040506edd">00928</a>    <span class="keyword">struct </span><a class="code" href="structsoft__key__set__res__message.html">soft_key_set_res_message</a> <a class="code" href="unionskinny__data.html#a2c1c09cd3cb77663c2963dd040506edd">softkeysets</a>;
<a name="l00929"></a><a class="code" href="unionskinny__data.html#a72600783648a844a5e45e185f42e00c4">00929</a>    <span class="keyword">struct </span><a class="code" href="structsoft__key__template__res__message.html">soft_key_template_res_message</a> <a class="code" href="unionskinny__data.html#a72600783648a844a5e45e185f42e00c4">softkeytemplate</a>;
<a name="l00930"></a><a class="code" href="unionskinny__data.html#a1e9a94870602b6a3227fe3ce05d3c13a">00930</a>    <span class="keyword">struct </span><a class="code" href="structserver__res__message.html">server_res_message</a> <a class="code" href="unionskinny__data.html#a1e9a94870602b6a3227fe3ce05d3c13a">serverres</a>;
<a name="l00931"></a><a class="code" href="unionskinny__data.html#af94af305e2c5f2374e813e4eb240296c">00931</a>    <span class="keyword">struct </span><a class="code" href="structreset__message.html">reset_message</a> <a class="code" href="unionskinny__data.html#af94af305e2c5f2374e813e4eb240296c">reset</a>;
<a name="l00932"></a><a class="code" href="unionskinny__data.html#a65f7cdca57eaef927ca936afde633f52">00932</a>    <span class="keyword">struct </span><a class="code" href="structset__lamp__message.html">set_lamp_message</a> <a class="code" href="unionskinny__data.html#a65f7cdca57eaef927ca936afde633f52">setlamp</a>;
<a name="l00933"></a><a class="code" href="unionskinny__data.html#a6708800c9c04790dc4ed17d8adf05ed7">00933</a>    <span class="keyword">struct </span><a class="code" href="structset__ringer__message.html">set_ringer_message</a> <a class="code" href="unionskinny__data.html#a6708800c9c04790dc4ed17d8adf05ed7">setringer</a>;
<a name="l00934"></a><a class="code" href="unionskinny__data.html#aa2c88f018f286fe417fe6d5da2f98d7d">00934</a>    <span class="keyword">struct </span><a class="code" href="structcall__state__message.html">call_state_message</a> <a class="code" href="unionskinny__data.html#aa2c88f018f286fe417fe6d5da2f98d7d">callstate</a>;
<a name="l00935"></a><a class="code" href="unionskinny__data.html#a23815068e4a04a658a8bd00aabab71fc">00935</a>    <span class="keyword">struct </span><a class="code" href="structkeypad__button__message.html">keypad_button_message</a> <a class="code" href="unionskinny__data.html#a23815068e4a04a658a8bd00aabab71fc">keypad</a>;
<a name="l00936"></a><a class="code" href="unionskinny__data.html#aa3ac92f8ade1b2cc658c0c5b3ce7d32a">00936</a>    <span class="keyword">struct </span><a class="code" href="structselect__soft__keys__message.html">select_soft_keys_message</a> <a class="code" href="unionskinny__data.html#aa3ac92f8ade1b2cc658c0c5b3ce7d32a">selectsoftkey</a>;
<a name="l00937"></a><a class="code" href="unionskinny__data.html#a77702a509517291eaa6e1e919179233b">00937</a>    <span class="keyword">struct </span><a class="code" href="structactivate__call__plane__message.html">activate_call_plane_message</a> <a class="code" href="unionskinny__data.html#a77702a509517291eaa6e1e919179233b">activatecallplane</a>;
<a name="l00938"></a><a class="code" href="unionskinny__data.html#aee5c3dbb8f03b80b242ed1b447d25886">00938</a>    <span class="keyword">struct </span><a class="code" href="structstimulus__message.html">stimulus_message</a> <a class="code" href="unionskinny__data.html#aee5c3dbb8f03b80b242ed1b447d25886">stimulus</a>;
<a name="l00939"></a><a class="code" href="unionskinny__data.html#a29a4718641ccff30ca7b21d7710c8bd3">00939</a>    <span class="keyword">struct </span><a class="code" href="structoffhook__message.html">offhook_message</a> <a class="code" href="unionskinny__data.html#a29a4718641ccff30ca7b21d7710c8bd3">offhook</a>;
<a name="l00940"></a><a class="code" href="unionskinny__data.html#a1351994edcbe98ad38854153208d91d0">00940</a>    <span class="keyword">struct </span><a class="code" href="structonhook__message.html">onhook_message</a> <a class="code" href="unionskinny__data.html#a1351994edcbe98ad38854153208d91d0">onhook</a>;
<a name="l00941"></a><a class="code" href="unionskinny__data.html#a3751b807b8ae3a843e2a57d1963a8b4f">00941</a>    <span class="keyword">struct </span><a class="code" href="structset__speaker__message.html">set_speaker_message</a> <a class="code" href="unionskinny__data.html#a3751b807b8ae3a843e2a57d1963a8b4f">setspeaker</a>;
<a name="l00942"></a><a class="code" href="unionskinny__data.html#a0f8fb34867e607e388414b68163a7ab9">00942</a>    <span class="keyword">struct </span><a class="code" href="structset__microphone__message.html">set_microphone_message</a> <a class="code" href="unionskinny__data.html#a0f8fb34867e607e388414b68163a7ab9">setmicrophone</a>;
<a name="l00943"></a><a class="code" href="unionskinny__data.html#a25554386850201091cc8f9e0e9031b63">00943</a>    <span class="keyword">struct </span><a class="code" href="structcall__info__message.html">call_info_message</a> <a class="code" href="unionskinny__data.html#a25554386850201091cc8f9e0e9031b63">callinfo</a>;
<a name="l00944"></a><a class="code" href="unionskinny__data.html#a42e0451ac6706cc1e6140aa7f48472a3">00944</a>    <span class="keyword">struct </span><a class="code" href="structstart__media__transmission__message.html">start_media_transmission_message</a> <a class="code" href="unionskinny__data.html#a42e0451ac6706cc1e6140aa7f48472a3">startmedia</a>;
<a name="l00945"></a><a class="code" href="unionskinny__data.html#a684ad1caea9173fbc13ab7be0ae45d9b">00945</a>    <span class="keyword">struct </span><a class="code" href="structstop__media__transmission__message.html">stop_media_transmission_message</a> <a class="code" href="unionskinny__data.html#a684ad1caea9173fbc13ab7be0ae45d9b">stopmedia</a>;
<a name="l00946"></a><a class="code" href="unionskinny__data.html#aa8faa33e2246e6407be4c17a64ce04c1">00946</a>    <span class="keyword">struct </span><a class="code" href="structopen__receive__channel__message.html">open_receive_channel_message</a> <a class="code" href="unionskinny__data.html#aa8faa33e2246e6407be4c17a64ce04c1">openreceivechannel</a>;
<a name="l00947"></a><a class="code" href="unionskinny__data.html#a5a6cde0861dd60fad6a45fbae0633e44">00947</a>    <span class="keyword">struct </span><a class="code" href="structopen__receive__channel__ack__message.html">open_receive_channel_ack_message</a> <a class="code" href="unionskinny__data.html#a5a6cde0861dd60fad6a45fbae0633e44">openreceivechannelack</a>;
<a name="l00948"></a><a class="code" href="unionskinny__data.html#a6e736b9cb16ec299bd33005a41fc4884">00948</a>    <span class="keyword">struct </span><a class="code" href="structclose__receive__channel__message.html">close_receive_channel_message</a> <a class="code" href="unionskinny__data.html#a6e736b9cb16ec299bd33005a41fc4884">closereceivechannel</a>;
<a name="l00949"></a><a class="code" href="unionskinny__data.html#a1b277f925972224699c8d5e398e5ed6d">00949</a>    <span class="keyword">struct </span><a class="code" href="structdisplay__notify__message.html">display_notify_message</a> <a class="code" href="unionskinny__data.html#a1b277f925972224699c8d5e398e5ed6d">displaynotify</a>;
<a name="l00950"></a><a class="code" href="unionskinny__data.html#a2d5eae5cb69465289c72e06c47d3ba01">00950</a>    <span class="keyword">struct </span><a class="code" href="structdialed__number__message.html">dialed_number_message</a> <a class="code" href="unionskinny__data.html#a2d5eae5cb69465289c72e06c47d3ba01">dialednumber</a>;
<a name="l00951"></a><a class="code" href="unionskinny__data.html#aac712770efa4df6178f5dd12bb346907">00951</a>    <span class="keyword">struct </span><a class="code" href="structsoft__key__event__message.html">soft_key_event_message</a> <a class="code" href="unionskinny__data.html#aac712770efa4df6178f5dd12bb346907">softkeyeventmessage</a>;
<a name="l00952"></a><a class="code" href="unionskinny__data.html#a8b760cddc80b9386b1ed58030b170a30">00952</a>    <span class="keyword">struct </span><a class="code" href="structenbloc__call__message.html">enbloc_call_message</a> <a class="code" href="unionskinny__data.html#a8b760cddc80b9386b1ed58030b170a30">enbloccallmessage</a>;
<a name="l00953"></a><a class="code" href="unionskinny__data.html#a31da68884fbffe3a0099f5e4121b9d76">00953</a>    <span class="keyword">struct </span><a class="code" href="structforward__stat__message.html">forward_stat_message</a> <a class="code" href="unionskinny__data.html#a31da68884fbffe3a0099f5e4121b9d76">forwardstat</a>;
<a name="l00954"></a>00954 };
<a name="l00955"></a>00955 
<a name="l00956"></a>00956 <span class="comment">/* packet composition */</span>
<a name="l00957"></a><a class="code" href="structskinny__req.html">00957</a> <span class="keyword">struct </span><a class="code" href="structskinny__req.html">skinny_req</a> {
<a name="l00958"></a><a class="code" href="structskinny__req.html#afed088663f8704004425cdae2120b9b3">00958</a>    <span class="keywordtype">int</span> <a class="code" href="structskinny__req.html#afed088663f8704004425cdae2120b9b3">len</a>;
<a name="l00959"></a><a class="code" href="structskinny__req.html#aac31eb68bff694554a182bd796b2f1c5">00959</a>    <span class="keywordtype">int</span> <a class="code" href="structskinny__req.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;
<a name="l00960"></a><a class="code" href="structskinny__req.html#a88859ce72faebb79ea0a2bca00a0f46b">00960</a>    <span class="keywordtype">int</span> <a class="code" href="structskinny__req.html#a88859ce72faebb79ea0a2bca00a0f46b">e</a>;
<a name="l00961"></a><a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">00961</a>    <span class="keyword">union </span><a class="code" href="unionskinny__data.html">skinny_data</a> <a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>;
<a name="l00962"></a>00962 };
<a name="l00963"></a>00963 
<a name="l00964"></a>00964 <span class="comment">/* XXX This is the combined size of the variables above.  (len, res, e)</span>
<a name="l00965"></a>00965 <span class="comment">   If more are added, this MUST change.</span>
<a name="l00966"></a>00966 <span class="comment">   (sizeof(skinny_req) - sizeof(skinny_data)) DOES NOT WORK on all systems (amd64?). */</span>
<a name="l00967"></a><a class="code" href="chan__skinny_8c.html#a61a919d439daa2a587713f7bc615734c">00967</a> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a61a919d439daa2a587713f7bc615734c">skinny_header_size</a> = 12;
<a name="l00968"></a>00968 
<a name="l00969"></a>00969 <span class="comment">/*****************************</span>
<a name="l00970"></a>00970 <span class="comment"> * Asterisk specific globals *</span>
<a name="l00971"></a>00971 <span class="comment"> *****************************/</span>
<a name="l00972"></a>00972 
<a name="l00973"></a><a class="code" href="chan__skinny_8c.html#a7af1a229503a9bef7747f704271515d6">00973</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a7af1a229503a9bef7747f704271515d6">skinnydebug</a> = 0;
<a name="l00974"></a><a class="code" href="chan__skinny_8c.html#a3f33857933c786a6cbf62a75e214bcf6">00974</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a3f33857933c786a6cbf62a75e214bcf6">skinnyreload</a> = 0;
<a name="l00975"></a>00975 
<a name="l00976"></a>00976 <span class="comment">/* a hostname, portnumber, socket and such is usefull for VoIP protocols */</span>
<a name="l00977"></a><a class="code" href="chan__skinny_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">00977</a> <span class="keyword">static</span> <span class="keyword">struct </span>sockaddr_in <a class="code" href="chan__skinny_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>;
<a name="l00978"></a><a class="code" href="chan__skinny_8c.html#afd883a715000d3dd9e65f40e6585f644">00978</a> <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="chan__skinny_8c.html#afd883a715000d3dd9e65f40e6585f644">ourhost</a>[256];
<a name="l00979"></a><a class="code" href="chan__skinny_8c.html#a7821b54b29c7b74aba79884f13b3ec03">00979</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a7821b54b29c7b74aba79884f13b3ec03">ourport</a>;
<a name="l00980"></a><a class="code" href="chan__skinny_8c.html#a1d084b82cb21102ba46ea60d3cd9c085">00980</a> <span class="keyword">static</span> <span class="keyword">struct </span>in_addr <a class="code" href="chan__skinny_8c.html#a1d084b82cb21102ba46ea60d3cd9c085">__ourip</a>;
<a name="l00981"></a><a class="code" href="chan__skinny_8c.html#a9e435aef83f14da6d3d5ec44f821558e">00981</a> <span class="keyword">struct </span><a class="code" href="structast__hostent.html">ast_hostent</a> <a class="code" href="chan__skinny_8c.html#a9e435aef83f14da6d3d5ec44f821558e">ahp</a>;
<a name="l00982"></a><a class="code" href="chan__skinny_8c.html#aa0f575fa3882aa394cc287edba645a35">00982</a> <span class="keyword">struct </span>hostent *<a class="code" href="chan__skinny_8c.html#aa0f575fa3882aa394cc287edba645a35">hp</a>;
<a name="l00983"></a><a class="code" href="chan__skinny_8c.html#a11d538b4c102a7a0eaa659457ea554a9">00983</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a11d538b4c102a7a0eaa659457ea554a9">skinnysock</a> = -1;
<a name="l00984"></a><a class="code" href="chan__skinny_8c.html#a3227f576808ac49b045784401c9fdea6">00984</a> <span class="keyword">static</span> pthread_t <a class="code" href="chan__skinny_8c.html#a3227f576808ac49b045784401c9fdea6">accept_t</a>;
<a name="l00985"></a><a class="code" href="chan__skinny_8c.html#a445c4d0d3e79e43aa4641d8bc8f648c7">00985</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a445c4d0d3e79e43aa4641d8bc8f648c7">callnums</a> = 1;
<a name="l00986"></a>00986 
<a name="l00987"></a><a class="code" href="chan__skinny_8c.html#af1d2fd59588cba882a9566324087a8a5">00987</a> <span class="preprocessor">#define SKINNY_DEVICE_UNKNOWN -1</span>
<a name="l00988"></a><a class="code" href="chan__skinny_8c.html#a8bf5a11e3d0cc22ee77a88151b9bee6b">00988</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_NONE 0</span>
<a name="l00989"></a><a class="code" href="chan__skinny_8c.html#a3f3cd69f7c3fbc2a03f357123c699713">00989</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_30SPPLUS 1</span>
<a name="l00990"></a><a class="code" href="chan__skinny_8c.html#af39bd902ef207e030753286d65681c7c">00990</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_12SPPLUS 2</span>
<a name="l00991"></a><a class="code" href="chan__skinny_8c.html#ad18902e12cbd352d1af5cb39e4b370ca">00991</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_12SP 3</span>
<a name="l00992"></a><a class="code" href="chan__skinny_8c.html#ac1db4bfd5d17f22afbc4bf80d6337d54">00992</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_12 4</span>
<a name="l00993"></a><a class="code" href="chan__skinny_8c.html#ad1629fcaedb5583acbff4481fc3affb4">00993</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_30VIP 5</span>
<a name="l00994"></a><a class="code" href="chan__skinny_8c.html#a8d87016fbefca28ff0756886e24aa1f3">00994</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_7910 6</span>
<a name="l00995"></a><a class="code" href="chan__skinny_8c.html#a21bbc062b4e4c70b3789ef050b73174f">00995</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_7960 7</span>
<a name="l00996"></a><a class="code" href="chan__skinny_8c.html#a13b2375dace6af91acc78d6c694b1f88">00996</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_7940 8</span>
<a name="l00997"></a><a class="code" href="chan__skinny_8c.html#afa9c2c4a21e3a321cf0c2c4adec1a05f">00997</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_7935 9</span>
<a name="l00998"></a><a class="code" href="chan__skinny_8c.html#a5916bc0fad835957681082ac3848bd2e">00998</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_ATA186 12 </span><span class="comment">/* Cisco ATA-186 */</span>
<a name="l00999"></a><a class="code" href="chan__skinny_8c.html#a7178ace67146a2004b92c3cf46aec2c9">00999</a> <span class="preprocessor">#define SKINNY_DEVICE_7941 115</span>
<a name="l01000"></a><a class="code" href="chan__skinny_8c.html#ae306befb4a743eb3e38f3f2bb2dbd59f">01000</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_7971 119</span>
<a name="l01001"></a><a class="code" href="chan__skinny_8c.html#a5bc5ce4a9c8f4198130d3ce756324f68">01001</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_7914 124 </span><span class="comment">/* Expansion module */</span>
<a name="l01002"></a><a class="code" href="chan__skinny_8c.html#ac3cd7f69be6e51d64b6688a80a65fc92">01002</a> <span class="preprocessor">#define SKINNY_DEVICE_7985 302</span>
<a name="l01003"></a><a class="code" href="chan__skinny_8c.html#a92da7b5faa7ec3709f054f179937082c">01003</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_7911 307</span>
<a name="l01004"></a><a class="code" href="chan__skinny_8c.html#a81e679dbd7beefb8f09015996b53bd27">01004</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_7961GE 308</span>
<a name="l01005"></a><a class="code" href="chan__skinny_8c.html#a171ee3ea3cd771beb545e9741196516d">01005</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_7941GE 309</span>
<a name="l01006"></a><a class="code" href="chan__skinny_8c.html#a8dd826d1782563f838ed10bfcabe2e05">01006</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_7931 348</span>
<a name="l01007"></a><a class="code" href="chan__skinny_8c.html#a2cf2ea66eb12030fe401f0f68fa2623d">01007</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_7921 365</span>
<a name="l01008"></a><a class="code" href="chan__skinny_8c.html#ab68f0d8b6cb25f78ad3b7491f20fcd8e">01008</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_7906 369</span>
<a name="l01009"></a><a class="code" href="chan__skinny_8c.html#a4ae851d94958aab0ec8c3410f7e2a15d">01009</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_7962 404 </span><span class="comment">/* Not found */</span>
<a name="l01010"></a><a class="code" href="chan__skinny_8c.html#a3bb0cce3c6fbeabf3fa67e0a316cf535">01010</a> <span class="preprocessor">#define SKINNY_DEVICE_7937 431</span>
<a name="l01011"></a><a class="code" href="chan__skinny_8c.html#a10266707a30856e2d0f3205b5e4a1ccd">01011</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_7942 434</span>
<a name="l01012"></a><a class="code" href="chan__skinny_8c.html#a11d00fd199be58f222cafe9df0e4669e">01012</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_7945 435</span>
<a name="l01013"></a><a class="code" href="chan__skinny_8c.html#ab61a7c473b18188f04fb35186ed35976">01013</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_7965 436</span>
<a name="l01014"></a><a class="code" href="chan__skinny_8c.html#a669bfc638ff207829d2e063533bcd7e8">01014</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_7975 437</span>
<a name="l01015"></a><a class="code" href="chan__skinny_8c.html#a433816a4c8748c37ec6ff4d6fe0430aa">01015</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_7905 20000</span>
<a name="l01016"></a><a class="code" href="chan__skinny_8c.html#a14da74571081caf219c70f4dc49499d8">01016</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_7920 30002</span>
<a name="l01017"></a><a class="code" href="chan__skinny_8c.html#af3a42f7afa01b1dbffacd7d07f9751b5">01017</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_7970 30006</span>
<a name="l01018"></a><a class="code" href="chan__skinny_8c.html#a51c12165871b57ce6a1deffecea01b17">01018</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_7912 30007</span>
<a name="l01019"></a><a class="code" href="chan__skinny_8c.html#a9a7988ad601a91351534202a8e1ad43e">01019</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_7902 30008</span>
<a name="l01020"></a><a class="code" href="chan__skinny_8c.html#aa82c3d86ef6e9bdda657d0637a56f0b3">01020</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_CIPC 30016 </span><span class="comment">/* Cisco IP Communicator */</span>
<a name="l01021"></a><a class="code" href="chan__skinny_8c.html#a47e3aa64ee6a6f5e659bad94b9576eee">01021</a> <span class="preprocessor">#define SKINNY_DEVICE_7961 30018</span>
<a name="l01022"></a><a class="code" href="chan__skinny_8c.html#a6e10ac13a55648f43ab0769552b3dc8e">01022</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_7936 30019</span>
<a name="l01023"></a><a class="code" href="chan__skinny_8c.html#a032655a31a1da3ff3a8853e8511d9dd9">01023</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DEVICE_SCCPGATEWAY_AN 30027 </span><span class="comment">/* Analog gateway */</span>
<a name="l01024"></a><a class="code" href="chan__skinny_8c.html#a62fe3f5742eb03458a14f2dd241d093a">01024</a> <span class="preprocessor">#define SKINNY_DEVICE_SCCPGATEWAY_BRI 30028 </span><span class="comment">/* BRI gateway */</span>
<a name="l01025"></a>01025 
<a name="l01026"></a><a class="code" href="chan__skinny_8c.html#a379fd834cea6549831c799ed002b52f7">01026</a> <span class="preprocessor">#define SKINNY_SPEAKERON 1</span>
<a name="l01027"></a><a class="code" href="chan__skinny_8c.html#a0c90019de529b77fb06d587393ec42bf">01027</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_SPEAKEROFF 2</span>
<a name="l01028"></a>01028 <span class="preprocessor"></span>
<a name="l01029"></a><a class="code" href="chan__skinny_8c.html#a405c80c900a60f29ee07bb26d48b71c8">01029</a> <span class="preprocessor">#define SKINNY_MICON 1</span>
<a name="l01030"></a><a class="code" href="chan__skinny_8c.html#a701494bb66426a27068ffa8aa05ba99a">01030</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_MICOFF 2</span>
<a name="l01031"></a>01031 <span class="preprocessor"></span>
<a name="l01032"></a><a class="code" href="chan__skinny_8c.html#a2e10f13253ac5069f50f7f66b9511537">01032</a> <span class="preprocessor">#define SKINNY_OFFHOOK 1</span>
<a name="l01033"></a><a class="code" href="chan__skinny_8c.html#ad38b06a5edcc17eaa553739944e702e1">01033</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_ONHOOK 2</span>
<a name="l01034"></a><a class="code" href="chan__skinny_8c.html#ae470ea8c2ed3420d624ea6f61b640a8a">01034</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_RINGOUT 3</span>
<a name="l01035"></a><a class="code" href="chan__skinny_8c.html#a6bed741ef5e86581671d6c63ae9267c8">01035</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_RINGIN 4</span>
<a name="l01036"></a><a class="code" href="chan__skinny_8c.html#a1b0b13fd37b0eec0ebbc6031c91d4662">01036</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_CONNECTED 5</span>
<a name="l01037"></a><a class="code" href="chan__skinny_8c.html#a068d6f987aefda74cc4eccf378f0e26f">01037</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_BUSY 6</span>
<a name="l01038"></a><a class="code" href="chan__skinny_8c.html#a0d089cd7065341d1b915456ace035ac2">01038</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_CONGESTION 7</span>
<a name="l01039"></a><a class="code" href="chan__skinny_8c.html#a4a2a093850ad1fe42d691104a8efcb5a">01039</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_HOLD 8</span>
<a name="l01040"></a><a class="code" href="chan__skinny_8c.html#aa1ba3673377bfb3503a3d15ae745a1e4">01040</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_CALLWAIT 9</span>
<a name="l01041"></a><a class="code" href="chan__skinny_8c.html#a146aaa954b9c0009b40fbeb1d55eee42">01041</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_TRANSFER 10</span>
<a name="l01042"></a><a class="code" href="chan__skinny_8c.html#afad6acabdbac762a1fafbf60cd3a4bd7">01042</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_PARK 11</span>
<a name="l01043"></a><a class="code" href="chan__skinny_8c.html#a2d1224352bf30cb08f222355450e4930">01043</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_PROGRESS 12</span>
<a name="l01044"></a><a class="code" href="chan__skinny_8c.html#a171401581bc9313c20cec69fe8ddc7ee">01044</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_CALLREMOTEMULTILINE 13</span>
<a name="l01045"></a><a class="code" href="chan__skinny_8c.html#aec9d41fe3802e98195d0472a93b22d94">01045</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_INVALID 14</span>
<a name="l01046"></a>01046 <span class="preprocessor"></span>
<a name="l01047"></a><a class="code" href="chan__skinny_8c.html#a2c63c304c5e6eff4a0b13617eb4a9bed">01047</a> <span class="preprocessor">#define SKINNY_SILENCE 0x00</span>
<a name="l01048"></a><a class="code" href="chan__skinny_8c.html#a12616ab9d64a36f7c2f372084a3663c8">01048</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_DIALTONE 0x21</span>
<a name="l01049"></a><a class="code" href="chan__skinny_8c.html#afe81f121e37b9b5a707f27f80e7f20f5">01049</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_BUSYTONE 0x23</span>
<a name="l01050"></a><a class="code" href="chan__skinny_8c.html#aa0c8daef788c72c3901d6d93bd873b1c">01050</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_ALERT 0x24</span>
<a name="l01051"></a><a class="code" href="chan__skinny_8c.html#aceb6a87185d21366d7f3f21fd69cee90">01051</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_REORDER 0x25</span>
<a name="l01052"></a><a class="code" href="chan__skinny_8c.html#ab0051964ea7b68461644ee964e3add4e">01052</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_CALLWAITTONE 0x2D</span>
<a name="l01053"></a><a class="code" href="chan__skinny_8c.html#ae95c7584fbc0dffa9560c78254a40166">01053</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_NOTONE 0x7F</span>
<a name="l01054"></a>01054 <span class="preprocessor"></span>
<a name="l01055"></a><a class="code" href="chan__skinny_8c.html#a87243536bbb96a314e88cfadd810f639">01055</a> <span class="preprocessor">#define SKINNY_LAMP_OFF 1</span>
<a name="l01056"></a><a class="code" href="chan__skinny_8c.html#a360e677a1a8e92ab455b8c354a15d969">01056</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_LAMP_ON 2</span>
<a name="l01057"></a><a class="code" href="chan__skinny_8c.html#a7de4e252b70c1f9022529a7de2c16344">01057</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_LAMP_WINK 3</span>
<a name="l01058"></a><a class="code" href="chan__skinny_8c.html#a4e1cd9416902608f4249e5ecd8caf578">01058</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_LAMP_FLASH 4</span>
<a name="l01059"></a><a class="code" href="chan__skinny_8c.html#a92de27dd35149317b1c4cf78025b5b23">01059</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_LAMP_BLINK 5</span>
<a name="l01060"></a>01060 <span class="preprocessor"></span>
<a name="l01061"></a><a class="code" href="chan__skinny_8c.html#aecd793ced0012f548eaf003e4609e994">01061</a> <span class="preprocessor">#define SKINNY_RING_OFF 1</span>
<a name="l01062"></a><a class="code" href="chan__skinny_8c.html#a4278efdb24cd17e04eff48e39475dd4e">01062</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_RING_INSIDE 2</span>
<a name="l01063"></a><a class="code" href="chan__skinny_8c.html#ab31f54fa7ccafd41d215c62b7049f314">01063</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_RING_OUTSIDE 3</span>
<a name="l01064"></a><a class="code" href="chan__skinny_8c.html#a8706ef649ebdbbbb7d42fb703afef886">01064</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_RING_FEATURE 4</span>
<a name="l01065"></a>01065 <span class="preprocessor"></span>
<a name="l01066"></a><a class="code" href="chan__skinny_8c.html#a1a77767cd4cfc70d096da50a2fefecd7">01066</a> <span class="preprocessor">#define SKINNY_CFWD_ALL       (1 &lt;&lt; 0)</span>
<a name="l01067"></a><a class="code" href="chan__skinny_8c.html#a6cd59fd0c6c79219d38f437a485ce844">01067</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_CFWD_BUSY      (1 &lt;&lt; 1)</span>
<a name="l01068"></a><a class="code" href="chan__skinny_8c.html#a805d890f6df0e6cf5d9f281791d2a318">01068</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_CFWD_NOANSWER  (1 &lt;&lt; 2)</span>
<a name="l01069"></a>01069 <span class="preprocessor"></span>
<a name="l01070"></a>01070 <span class="comment">/* Skinny rtp stream modes. Do we really need this? */</span>
<a name="l01071"></a><a class="code" href="chan__skinny_8c.html#a145b82eaad8652b0b1573e2be1abc90e">01071</a> <span class="preprocessor">#define SKINNY_CX_SENDONLY 0</span>
<a name="l01072"></a><a class="code" href="chan__skinny_8c.html#a7300c46280f93b446c8e13b404f55e36">01072</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_CX_RECVONLY 1</span>
<a name="l01073"></a><a class="code" href="chan__skinny_8c.html#ac56d16f9c5cdbcc4b81eb63f9039e0e6">01073</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_CX_SENDRECV 2</span>
<a name="l01074"></a><a class="code" href="chan__skinny_8c.html#ad224f7081e86cc7699777aca6f03fd73">01074</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_CX_CONF 3</span>
<a name="l01075"></a><a class="code" href="chan__skinny_8c.html#ac28e82a8a12bb1b37e3a8c520c7bc6dc">01075</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_CX_CONFERENCE 3</span>
<a name="l01076"></a><a class="code" href="chan__skinny_8c.html#a0f17e966b4ee0638f788cd0c4320a203">01076</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_CX_MUTE 4</span>
<a name="l01077"></a><a class="code" href="chan__skinny_8c.html#a2aefadaebf9f3da51e9fbd92c998dc6b">01077</a> <span class="preprocessor"></span><span class="preprocessor">#define SKINNY_CX_INACTIVE 4</span>
<a name="l01078"></a>01078 <span class="preprocessor"></span>
<a name="l01079"></a>01079 <span class="preprocessor">#if 0</span>
<a name="l01080"></a>01080 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">char</span> *skinny_cxmodes[] = {
<a name="l01081"></a>01081    <span class="stringliteral">&quot;sendonly&quot;</span>,
<a name="l01082"></a>01082    <span class="stringliteral">&quot;recvonly&quot;</span>,
<a name="l01083"></a>01083    <span class="stringliteral">&quot;sendrecv&quot;</span>,
<a name="l01084"></a>01084    <span class="stringliteral">&quot;confrnce&quot;</span>,
<a name="l01085"></a>01085    <span class="stringliteral">&quot;inactive&quot;</span>
<a name="l01086"></a>01086 };
<a name="l01087"></a>01087 <span class="preprocessor">#endif</span>
<a name="l01088"></a>01088 <span class="preprocessor"></span>
<a name="l01089"></a>01089 <span class="comment">/* driver scheduler */</span>
<a name="l01090"></a><a class="code" href="chan__skinny_8c.html#aea6233539fc73fc5303bf7525ec27e73">01090</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structsched__context.html">sched_context</a> *<a class="code" href="structsched.html">sched</a> = NULL;
<a name="l01091"></a><a class="code" href="chan__skinny_8c.html#abda48311b6abe5a4dd8b6904ddde0a6d">01091</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structio__context.html" title="Global IO variables are now in a struct in order to be made threadsafe.">io_context</a> *<a class="code" href="chan__skinny_8c.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a>;
<a name="l01092"></a>01092 
<a name="l01093"></a>01093 <span class="comment">/* Protect the monitoring thread, so only one process can kill or start it, and not</span>
<a name="l01094"></a>01094 <span class="comment">   when it&apos;s doing something critical. */</span>
<a name="l01095"></a>01095 <a class="code" href="lock_8h.html#ac840092853644cea0a186efdc58985f5">AST_MUTEX_DEFINE_STATIC</a>(monlock);
<a name="l01096"></a>01096 <span class="comment">/* Protect the network socket */</span>
<a name="l01097"></a>01097 <a class="code" href="lock_8h.html#ac840092853644cea0a186efdc58985f5">AST_MUTEX_DEFINE_STATIC</a>(netlock);
<a name="l01098"></a>01098 
<a name="l01099"></a>01099 <span class="comment">/* This is the thread for the monitor which checks for input on the channels</span>
<a name="l01100"></a>01100 <span class="comment">   which are not currently in use. */</span>
<a name="l01101"></a><a class="code" href="chan__skinny_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503">01101</a> <span class="keyword">static</span> pthread_t <a class="code" href="chan__skinny_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503">monitor_thread</a> = <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>;
<a name="l01102"></a>01102 
<a name="l01103"></a>01103 <span class="comment">/* Wait up to 16 seconds for first digit */</span>
<a name="l01104"></a><a class="code" href="chan__skinny_8c.html#afd3be8e865f060b68db4d7c966489e0a">01104</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#afd3be8e865f060b68db4d7c966489e0a">firstdigittimeout</a> = 16000;
<a name="l01105"></a>01105 
<a name="l01106"></a>01106 <span class="comment">/* How long to wait for following digits */</span>
<a name="l01107"></a><a class="code" href="chan__skinny_8c.html#aa319ef1606201db158ce7195fb8eed45">01107</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#aa319ef1606201db158ce7195fb8eed45">gendigittimeout</a> = 8000;
<a name="l01108"></a>01108 
<a name="l01109"></a>01109 <span class="comment">/* How long to wait for an extra digit, if there is an ambiguous match */</span>
<a name="l01110"></a><a class="code" href="chan__skinny_8c.html#a24514343553b05c66e5b7d16e2df45cc">01110</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a24514343553b05c66e5b7d16e2df45cc">matchdigittimeout</a> = 3000;
<a name="l01111"></a>01111 
<a name="l01112"></a><a class="code" href="structskinny__subchannel.html">01112</a> <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> {
<a name="l01113"></a><a class="code" href="structskinny__subchannel.html#adf04f66344e3fb0a6f6a69bf39d19902">01113</a>    <a class="code" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a> <a class="code" href="structskinny__subchannel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>;
<a name="l01114"></a><a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">01114</a>    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l01115"></a><a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">01115</a>    <span class="keyword">struct </span><a class="code" href="structast__rtp.html" title="Structure representing a RTP session.">ast_rtp</a> *<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a>;
<a name="l01116"></a><a class="code" href="structskinny__subchannel.html#a65e8f978abd3f0206026969c627200a9">01116</a>    <span class="keyword">struct </span><a class="code" href="structast__rtp.html" title="Structure representing a RTP session.">ast_rtp</a> *<a class="code" href="structskinny__subchannel.html#a65e8f978abd3f0206026969c627200a9">vrtp</a>;
<a name="l01117"></a><a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">01117</a>    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>;
<a name="l01118"></a>01118    <span class="comment">/* time_t lastouttime; */</span> <span class="comment">/* Unused */</span>
<a name="l01119"></a><a class="code" href="structskinny__subchannel.html#a4fb4072ccd44ea481eecfa5e74818db4">01119</a>    <span class="keywordtype">int</span> <a class="code" href="structprogress.html">progress</a>;
<a name="l01120"></a><a class="code" href="structskinny__subchannel.html#a44a0c9c7696fa5078c94c60140e83f5f">01120</a>    <span class="keywordtype">int</span> <a class="code" href="structskinny__subchannel.html#a44a0c9c7696fa5078c94c60140e83f5f">ringing</a>;
<a name="l01121"></a><a class="code" href="structskinny__subchannel.html#a46585eaf56ac8588fa673c1c089f0238">01121</a>    <span class="keywordtype">int</span> <a class="code" href="structskinny__subchannel.html#a46585eaf56ac8588fa673c1c089f0238">onhold</a>;
<a name="l01122"></a>01122    <span class="comment">/* int lastout; */</span> <span class="comment">/* Unused */</span>
<a name="l01123"></a><a class="code" href="structskinny__subchannel.html#a4650e5e1429f8982af64b9c42c8c53d3">01123</a>    <span class="keywordtype">int</span> <a class="code" href="structskinny__subchannel.html#a4650e5e1429f8982af64b9c42c8c53d3">cxmode</a>;
<a name="l01124"></a><a class="code" href="structskinny__subchannel.html#ada540a5f25f7302dc1a3d17ccfa59b10">01124</a>    <span class="keywordtype">int</span> <a class="code" href="structskinny__subchannel.html#ada540a5f25f7302dc1a3d17ccfa59b10">nat</a>;
<a name="l01125"></a><a class="code" href="structskinny__subchannel.html#a586fc7c710ade15aabab8f223e53fdd9">01125</a>    <span class="keywordtype">int</span> <a class="code" href="structoutgoing.html">outgoing</a>;
<a name="l01126"></a><a class="code" href="structskinny__subchannel.html#ac43993a73742eff145b861107a1afa0d">01126</a>    <span class="keywordtype">int</span> <a class="code" href="structskinny__subchannel.html#ac43993a73742eff145b861107a1afa0d">alreadygone</a>;
<a name="l01127"></a><a class="code" href="structskinny__subchannel.html#a9d49074e0655a086adb6bcc670b06f23">01127</a>    <span class="keywordtype">int</span> <a class="code" href="structskinny__subchannel.html#a9d49074e0655a086adb6bcc670b06f23">blindxfer</a>;
<a name="l01128"></a><a class="code" href="structskinny__subchannel.html#a04f1e042676be8f4763d8d5a9000b1e5">01128</a>    <span class="keywordtype">int</span> <a class="code" href="structskinny__subchannel.html#a04f1e042676be8f4763d8d5a9000b1e5">xferor</a>;
<a name="l01129"></a>01129 
<a name="l01130"></a>01130 
<a name="l01131"></a>01131    <a class="code" href="linkedlists_8h.html#a67508a613c8f337732e35d9367b43ae7" title="Declare a forward link structure inside a list entry.">AST_LIST_ENTRY</a>(<a class="code" href="structskinny__subchannel.html">skinny_subchannel</a>) list;
<a name="l01132"></a>01132    struct <a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *related;
<a name="l01133"></a>01133    struct <a class="code" href="structskinny__line.html">skinny_line</a> *parent;
<a name="l01134"></a>01134 };
<a name="l01135"></a>01135 
<a name="l01136"></a><a class="code" href="chan__skinny_8c.html#ae5dc85a5d8ede916fd4c3f50ff488cd1">01136</a> <span class="preprocessor">#define SKINNY_LINE_OPTIONS            \</span>
<a name="l01137"></a>01137 <span class="preprocessor">   char name[80];             \</span>
<a name="l01138"></a>01138 <span class="preprocessor">   char label[24];               \</span>
<a name="l01139"></a>01139 <span class="preprocessor">   char accountcode[AST_MAX_ACCOUNT_CODE];      \</span>
<a name="l01140"></a>01140 <span class="preprocessor">   char exten[AST_MAX_EXTENSION];         \</span>
<a name="l01141"></a>01141 <span class="preprocessor">   char context[AST_MAX_CONTEXT];         \</span>
<a name="l01142"></a>01142 <span class="preprocessor">   char language[MAX_LANGUAGE];        \</span>
<a name="l01143"></a>01143 <span class="preprocessor">   char cid_num[AST_MAX_EXTENSION];       \</span>
<a name="l01144"></a>01144 <span class="preprocessor">   char cid_name[AST_MAX_EXTENSION];      \</span>
<a name="l01145"></a>01145 <span class="preprocessor">   char lastcallerid[AST_MAX_EXTENSION];     \</span>
<a name="l01146"></a>01146 <span class="preprocessor">   int cfwdtype;              \</span>
<a name="l01147"></a>01147 <span class="preprocessor">   char call_forward_all[AST_MAX_EXTENSION]; \</span>
<a name="l01148"></a>01148 <span class="preprocessor">   char call_forward_busy[AST_MAX_EXTENSION];   \</span>
<a name="l01149"></a>01149 <span class="preprocessor">   char call_forward_noanswer[AST_MAX_EXTENSION];  \</span>
<a name="l01150"></a>01150 <span class="preprocessor">   char mailbox[AST_MAX_EXTENSION];    \</span>
<a name="l01151"></a>01151 <span class="preprocessor">   char vmexten[AST_MAX_EXTENSION];    \</span>
<a name="l01152"></a>01152 <span class="preprocessor">   char regexten[AST_MAX_EXTENSION];      \</span>
<a name="l01153"></a>01153 <span class="preprocessor">   char regcontext[AST_MAX_CONTEXT];      \</span>
<a name="l01154"></a>01154 <span class="preprocessor">   char parkinglot[AST_MAX_CONTEXT];      \</span>
<a name="l01155"></a>01155 <span class="preprocessor">   char mohinterpret[MAX_MUSICCLASS];     \</span>
<a name="l01156"></a>01156 <span class="preprocessor">   char mohsuggest[MAX_MUSICCLASS];    \</span>
<a name="l01157"></a>01157 <span class="preprocessor">   char lastnumberdialed[AST_MAX_EXTENSION]; \</span>
<a name="l01158"></a>01158 <span class="preprocessor">   int curtone;               \</span>
<a name="l01159"></a>01159 <span class="preprocessor">   ast_group_t callgroup;           \</span>
<a name="l01160"></a>01160 <span class="preprocessor">   ast_group_t pickupgroup;         \</span>
<a name="l01161"></a>01161 <span class="preprocessor">   int callwaiting;           \</span>
<a name="l01162"></a>01162 <span class="preprocessor">   int transfer;              \</span>
<a name="l01163"></a>01163 <span class="preprocessor">   int threewaycalling;          \</span>
<a name="l01164"></a>01164 <span class="preprocessor">   int mwiblink;              \</span>
<a name="l01165"></a>01165 <span class="preprocessor">   int cancallforward;           \</span>
<a name="l01166"></a>01166 <span class="preprocessor">   int getforward;               \</span>
<a name="l01167"></a>01167 <span class="preprocessor">   int callreturn;               \</span>
<a name="l01168"></a>01168 <span class="preprocessor">   int dnd;             \</span>
<a name="l01169"></a>01169 <span class="preprocessor">   int hascallerid;           \</span>
<a name="l01170"></a>01170 <span class="preprocessor">   int hidecallerid;          \</span>
<a name="l01171"></a>01171 <span class="preprocessor">   int amaflags;              \</span>
<a name="l01172"></a>01172 <span class="preprocessor">   int type;               \</span>
<a name="l01173"></a>01173 <span class="preprocessor">   int instance;              \</span>
<a name="l01174"></a>01174 <span class="preprocessor">   int group;              \</span>
<a name="l01175"></a>01175 <span class="preprocessor">   int needdestroy;           \</span>
<a name="l01176"></a>01176 <span class="preprocessor">   int confcapability;           \</span>
<a name="l01177"></a>01177 <span class="preprocessor">   struct ast_codec_pref confprefs;    \</span>
<a name="l01178"></a>01178 <span class="preprocessor">   int capability;               \</span>
<a name="l01179"></a>01179 <span class="preprocessor">   struct ast_codec_pref prefs;        \</span>
<a name="l01180"></a>01180 <span class="preprocessor">   int nonCodecCapability;          \</span>
<a name="l01181"></a>01181 <span class="preprocessor">   int onhooktime;               \</span>
<a name="l01182"></a>01182 <span class="preprocessor">   int msgstate;              \</span>
<a name="l01183"></a>01183 <span class="preprocessor">   int immediate;             \</span>
<a name="l01184"></a>01184 <span class="preprocessor">   int hookstate;             \</span>
<a name="l01185"></a>01185 <span class="preprocessor">   int nat;             \</span>
<a name="l01186"></a>01186 <span class="preprocessor">   int directmedia;           \</span>
<a name="l01187"></a>01187 <span class="preprocessor">   int prune;</span>
<a name="l01188"></a>01188 <span class="preprocessor"></span>
<a name="l01189"></a><a class="code" href="structskinny__line.html">01189</a> <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> {
<a name="l01190"></a>01190    <a class="code" href="chan__skinny_8c.html#ae5dc85a5d8ede916fd4c3f50ff488cd1">SKINNY_LINE_OPTIONS</a>
<a name="l01191"></a><a class="code" href="structskinny__line.html#ae5e68fb86600e9f1e67bb18aaa19f78a">01191</a>    <a class="code" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a> <a class="code" href="structskinny__subchannel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>;
<a name="l01192"></a><a class="code" href="structskinny__line.html#a7dec0df43032d5c53d9a125030385a30">01192</a>    <span class="keyword">struct </span><a class="code" href="structast__event__sub.html" title="Event subscription.">ast_event_sub</a> *mwi_event_sub; <span class="comment">/* Event based MWI */</span>
<a name="l01193"></a><a class="code" href="structskinny__line.html#aedffa4337f76fdcdc808e16affbafd04">01193</a>    <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *activesub;
<a name="l01194"></a>01194    <a class="code" href="linkedlists_8h.html#acdb4f56da6b3071d02dcce20072852b0" title="Defines a structure to be used to hold a list of specified type.">AST_LIST_HEAD</a>(, <a class="code" href="structskinny__subchannel.html">skinny_subchannel</a>) sub;
<a name="l01195"></a>01195    <a class="code" href="linkedlists_8h.html#a67508a613c8f337732e35d9367b43ae7" title="Declare a forward link structure inside a list entry.">AST_LIST_ENTRY</a>(<a class="code" href="structskinny__line.html">skinny_line</a>) list;
<a name="l01196"></a>01196    <a class="code" href="linkedlists_8h.html#a67508a613c8f337732e35d9367b43ae7" title="Declare a forward link structure inside a list entry.">AST_LIST_ENTRY</a>(<a class="code" href="structskinny__line.html">skinny_line</a>) all;
<a name="l01197"></a>01197    struct <a class="code" href="structskinny__device.html">skinny_device</a> *device;
<a name="l01198"></a>01198    struct <a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *chanvars; <span class="comment">/*!&lt; Channel variables to set for inbound call */</span>
<a name="l01199"></a>01199    <span class="keywordtype">int</span> newmsgs;
<a name="l01200"></a>01200 };
<a name="l01201"></a>01201 
<a name="l01202"></a><a class="code" href="structskinny__line__options.html">01202</a> struct <a class="code" href="structskinny__line__options.html">skinny_line_options</a>{
<a name="l01203"></a>01203    <a class="code" href="chan__skinny_8c.html#ae5dc85a5d8ede916fd4c3f50ff488cd1">SKINNY_LINE_OPTIONS</a>
<a name="l01204"></a>01204 } <a class="code" href="chan__skinny_8c.html#a1ff5f7d1d41bc8f06fc676e62f11839f">default_line_struct</a> = {
<a name="l01205"></a>01205    .callwaiting = 1,
<a name="l01206"></a>01206    .transfer = 1,
<a name="l01207"></a>01207    .mwiblink = 0,
<a name="l01208"></a>01208    .dnd = 0,
<a name="l01209"></a>01209    .hidecallerid = 0,
<a name="l01210"></a>01210    .amaflags = 0,
<a name="l01211"></a>01211    .instance = 0,
<a name="l01212"></a>01212    .directmedia = 0,
<a name="l01213"></a>01213    .nat = 0,
<a name="l01214"></a>01214    .confcapability = <a class="code" href="frame_8h.html#ab602cf455d4a96a3adba2e3ba8cd2b2c">AST_FORMAT_ULAW</a> | <a class="code" href="frame_8h.html#aa58cc980a9c9108522effc64e9aff2d6">AST_FORMAT_ALAW</a>,
<a name="l01215"></a>01215    .capability = 0,
<a name="l01216"></a>01216    .getforward = 0,
<a name="l01217"></a>01217    .needdestroy = 0,
<a name="l01218"></a>01218    .prune = 0,
<a name="l01219"></a>01219    .hookstate = <a class="code" href="chan__skinny_8c.html#ad38b06a5edcc17eaa553739944e702e1">SKINNY_ONHOOK</a>,
<a name="l01220"></a>01220 };
<a name="l01221"></a><a class="code" href="chan__skinny_8c.html#a6e99a595511d5057826b95311fa49465">01221</a> <span class="keyword">struct </span><a class="code" href="structskinny__line__options.html">skinny_line_options</a> *<a class="code" href="chan__skinny_8c.html#a6e99a595511d5057826b95311fa49465">default_line</a> = &amp;<a class="code" href="chan__skinny_8c.html#a1ff5f7d1d41bc8f06fc676e62f11839f">default_line_struct</a>;
<a name="l01222"></a>01222 
<a name="l01223"></a>01223 <span class="keyword">static</span> <a class="code" href="linkedlists_8h.html#a10f9ed9242a397abf76de1ed1fa33c3b" title="Defines a structure to be used to hold a list of specified type, statically initialized...">AST_LIST_HEAD_STATIC</a>(lines, <a class="code" href="structskinny__line.html">skinny_line</a>);
<a name="l01224"></a>01224 
<a name="l01225"></a><a class="code" href="structskinny__speeddial.html">01225</a> <span class="keyword">struct </span><a class="code" href="structskinny__speeddial.html">skinny_speeddial</a> {
<a name="l01226"></a><a class="code" href="structskinny__speeddial.html#adf04f66344e3fb0a6f6a69bf39d19902">01226</a>    <a class="code" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a> <a class="code" href="structskinny__subchannel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>;
<a name="l01227"></a><a class="code" href="structskinny__speeddial.html#ab20c01b68c97d3477a795c85e6c37be9">01227</a>    <span class="keywordtype">char</span> label[42];
<a name="l01228"></a><a class="code" href="structskinny__speeddial.html#ac25ea00ee3f082df06e0cf468cbde240">01228</a>    <span class="keywordtype">char</span> <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>[<a class="code" href="channel_8h.html#abcf1aea85b924e9cd605040b86241e2a">AST_MAX_CONTEXT</a>];
<a name="l01229"></a><a class="code" href="structskinny__speeddial.html#a78d4847658b695383d849efd12399b38">01229</a>    <span class="keywordtype">char</span> <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>[<a class="code" href="channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>];
<a name="l01230"></a><a class="code" href="structskinny__speeddial.html#a6fd216872447cfe5f757d2ce47fea6fb">01230</a>    <span class="keywordtype">int</span> instance;
<a name="l01231"></a><a class="code" href="structskinny__speeddial.html#a70382561daaa758a201b7a711d566e24">01231</a>    <span class="keywordtype">int</span> <a class="code" href="pbx_8c.html#a70382561daaa758a201b7a711d566e24">stateid</a>;
<a name="l01232"></a><a class="code" href="structskinny__speeddial.html#a0078d2e3ae10f15d7634c01199f33d4f">01232</a>    <span class="keywordtype">int</span> laststate;
<a name="l01233"></a><a class="code" href="structskinny__speeddial.html#ad3d414cdb71376b88dc5ce91a2a6118e">01233</a>    <span class="keywordtype">int</span> isHint;
<a name="l01234"></a>01234 
<a name="l01235"></a>01235    <a class="code" href="linkedlists_8h.html#a67508a613c8f337732e35d9367b43ae7" title="Declare a forward link structure inside a list entry.">AST_LIST_ENTRY</a>(<a class="code" href="structskinny__speeddial.html">skinny_speeddial</a>) list;
<a name="l01236"></a>01236    struct <a class="code" href="structskinny__device.html">skinny_device</a> *parent;
<a name="l01237"></a>01237 };
<a name="l01238"></a>01238 
<a name="l01239"></a><a class="code" href="structskinny__addon.html">01239</a> struct <a class="code" href="structskinny__addon.html">skinny_addon</a> {
<a name="l01240"></a><a class="code" href="structskinny__addon.html#adf04f66344e3fb0a6f6a69bf39d19902">01240</a>    <a class="code" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a> <a class="code" href="structskinny__subchannel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>;
<a name="l01241"></a><a class="code" href="structskinny__addon.html#a33e6e7edca48ac1ff105d85011dfc454">01241</a>    <span class="keywordtype">char</span> <a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>[10];
<a name="l01242"></a>01242    <a class="code" href="linkedlists_8h.html#a67508a613c8f337732e35d9367b43ae7" title="Declare a forward link structure inside a list entry.">AST_LIST_ENTRY</a>(skinny_addon) list;
<a name="l01243"></a>01243    struct <a class="code" href="structskinny__device.html">skinny_device</a> *parent;
<a name="l01244"></a>01244 };
<a name="l01245"></a>01245 
<a name="l01246"></a><a class="code" href="chan__skinny_8c.html#a20185c5e569b4f8b26e80fc4f32ce216">01246</a> <span class="preprocessor">#define SKINNY_DEVICE_OPTIONS             \</span>
<a name="l01247"></a>01247 <span class="preprocessor">   char name[80];                \</span>
<a name="l01248"></a>01248 <span class="preprocessor">   char id[16];                  \</span>
<a name="l01249"></a>01249 <span class="preprocessor">   char version_id[16];             \</span>
<a name="l01250"></a>01250 <span class="preprocessor">   char exten[AST_MAX_EXTENSION];            \</span>
<a name="l01251"></a>01251 <span class="preprocessor">   char vmexten[AST_MAX_EXTENSION];       \</span>
<a name="l01252"></a>01252 <span class="preprocessor">   int type;                  \</span>
<a name="l01253"></a>01253 <span class="preprocessor">   int registered;                  \</span>
<a name="l01254"></a>01254 <span class="preprocessor">   int lastlineinstance;               \</span>
<a name="l01255"></a>01255 <span class="preprocessor">   int lastcallreference;              \</span>
<a name="l01256"></a>01256 <span class="preprocessor">   int confcapability;              \</span>
<a name="l01257"></a>01257 <span class="preprocessor">   struct ast_codec_pref confprefs;       \</span>
<a name="l01258"></a>01258 <span class="preprocessor">   int capability;                  \</span>
<a name="l01259"></a>01259 <span class="preprocessor">   int earlyrtp;                 \</span>
<a name="l01260"></a>01260 <span class="preprocessor">   int transfer;                 \</span>
<a name="l01261"></a>01261 <span class="preprocessor">   int callwaiting;              \</span>
<a name="l01262"></a>01262 <span class="preprocessor">   int mwiblink;                 \</span>
<a name="l01263"></a>01263 <span class="preprocessor">   int dnd;                \</span>
<a name="l01264"></a>01264 <span class="preprocessor">   int prune;</span>
<a name="l01265"></a>01265 <span class="preprocessor"></span>
<a name="l01266"></a><a class="code" href="structskinny__device.html">01266</a> <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> {
<a name="l01267"></a>01267    <a class="code" href="chan__skinny_8c.html#a20185c5e569b4f8b26e80fc4f32ce216">SKINNY_DEVICE_OPTIONS</a>
<a name="l01268"></a><a class="code" href="structskinny__device.html#ae868bc1a499690a02fc8052577229df9">01268</a>    <span class="keyword">struct </span>type *<a class="code" href="devicestate_8c.html#abd2135e6f8a41bc900933b1985d97165">first</a>;
<a name="l01269"></a><a class="code" href="structskinny__device.html#a099ce3d856d66dc52a7737d4d5b8daab">01269</a>    <span class="keyword">struct </span>type *<a class="code" href="devicestate_8c.html#a43a8def62ee15449794285cbbc0f79af">last</a>;
<a name="l01270"></a><a class="code" href="structskinny__device.html#adf04f66344e3fb0a6f6a69bf39d19902">01270</a>    <a class="code" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a> lock;
<a name="l01271"></a><a class="code" href="structskinny__device.html#afdf3b1ca80400cc6bd5bfe2bb1cb7e65">01271</a>    <span class="keyword">struct </span>sockaddr_in addr;
<a name="l01272"></a><a class="code" href="structskinny__device.html#aff045cc68524670d4355f882c7ac6271">01272</a>    <span class="keyword">struct </span>in_addr ourip;
<a name="l01273"></a><a class="code" href="structskinny__device.html#a6c6c2b6adbe74acc944bc0c55b16c8f4">01273</a>    <span class="keyword">struct </span><a class="code" href="structast__ha.html" title="internal representation of acl entries In principle user applications would have...">ast_ha</a> *ha;
<a name="l01274"></a><a class="code" href="structskinny__device.html#a730a1864781691273d9f28b5ad1dadfd">01274</a>    <span class="keyword">struct </span><a class="code" href="structskinnysession.html">skinnysession</a> *session;
<a name="l01275"></a><a class="code" href="structskinny__device.html#a70da1427655ecdaa64e57324e51f440b">01275</a>    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *activeline;
<a name="l01276"></a>01276    <a class="code" href="linkedlists_8h.html#acdb4f56da6b3071d02dcce20072852b0" title="Defines a structure to be used to hold a list of specified type.">AST_LIST_HEAD</a>(, <a class="code" href="structskinny__line.html">skinny_line</a>) lines;
<a name="l01277"></a>01277    <a class="code" href="linkedlists_8h.html#acdb4f56da6b3071d02dcce20072852b0" title="Defines a structure to be used to hold a list of specified type.">AST_LIST_HEAD</a>(, <a class="code" href="structskinny__speeddial.html">skinny_speeddial</a>) speeddials;
<a name="l01278"></a>01278    <a class="code" href="linkedlists_8h.html#acdb4f56da6b3071d02dcce20072852b0" title="Defines a structure to be used to hold a list of specified type.">AST_LIST_HEAD</a>(, skinny_addon) addons;
<a name="l01279"></a>01279    <a class="code" href="linkedlists_8h.html#a67508a613c8f337732e35d9367b43ae7" title="Declare a forward link structure inside a list entry.">AST_LIST_ENTRY</a>(<a class="code" href="structskinny__device.html">skinny_device</a>) list;
<a name="l01280"></a>01280 };
<a name="l01281"></a>01281 
<a name="l01282"></a><a class="code" href="structskinny__device__options.html">01282</a> struct <a class="code" href="structskinny__device__options.html">skinny_device_options</a>{
<a name="l01283"></a>01283    <a class="code" href="chan__skinny_8c.html#a20185c5e569b4f8b26e80fc4f32ce216">SKINNY_DEVICE_OPTIONS</a>
<a name="l01284"></a>01284 } <a class="code" href="chan__skinny_8c.html#ae3ac7b464520c606a7b5e114091a7798">default_device_struct</a> = {
<a name="l01285"></a>01285    .transfer = 1,
<a name="l01286"></a>01286    .earlyrtp = 1,
<a name="l01287"></a>01287    .callwaiting = 1,
<a name="l01288"></a>01288    .mwiblink = 0,
<a name="l01289"></a>01289    .dnd = 0,
<a name="l01290"></a>01290    .confcapability = <a class="code" href="frame_8h.html#ab602cf455d4a96a3adba2e3ba8cd2b2c">AST_FORMAT_ULAW</a> | <a class="code" href="frame_8h.html#aa58cc980a9c9108522effc64e9aff2d6">AST_FORMAT_ALAW</a>,
<a name="l01291"></a>01291    .capability = 0,
<a name="l01292"></a>01292    .prune = 0,
<a name="l01293"></a>01293 };
<a name="l01294"></a><a class="code" href="chan__skinny_8c.html#aea5308550d9d24974ceb40dd660b2fd9">01294</a> <span class="keyword">struct </span><a class="code" href="structskinny__device__options.html">skinny_device_options</a> *<a class="code" href="chan__skinny_8c.html#aea5308550d9d24974ceb40dd660b2fd9">default_device</a> = &amp;<a class="code" href="chan__skinny_8c.html#ae3ac7b464520c606a7b5e114091a7798">default_device_struct</a>;
<a name="l01295"></a>01295    
<a name="l01296"></a>01296 <span class="keyword">static</span> <a class="code" href="linkedlists_8h.html#a10f9ed9242a397abf76de1ed1fa33c3b" title="Defines a structure to be used to hold a list of specified type, statically initialized...">AST_LIST_HEAD_STATIC</a>(<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>, <a class="code" href="structskinny__device.html">skinny_device</a>);
<a name="l01297"></a>01297 
<a name="l01298"></a>01298 <span class="comment">/*static struct ast_jb_conf default_jbconf =</span>
<a name="l01299"></a>01299 <span class="comment">{</span>
<a name="l01300"></a>01300 <span class="comment">   .flags = 0,</span>
<a name="l01301"></a>01301 <span class="comment">   .max_size = -1,</span>
<a name="l01302"></a>01302 <span class="comment">   .resync_threshold = -1,</span>
<a name="l01303"></a>01303 <span class="comment">   .impl = &quot;&quot;</span>
<a name="l01304"></a>01304 <span class="comment">};</span>
<a name="l01305"></a>01305 <span class="comment">static struct ast_jb_conf global_jbconf;*/</span>
<a name="l01306"></a>01306 
<a name="l01307"></a><a class="code" href="structskinnysession.html">01307</a> <span class="keyword">struct </span><a class="code" href="structskinnysession.html">skinnysession</a> {
<a name="l01308"></a><a class="code" href="structskinnysession.html#aa49d6a06775253352589280dc7f30018">01308</a>    pthread_t t;
<a name="l01309"></a><a class="code" href="structskinnysession.html#adf04f66344e3fb0a6f6a69bf39d19902">01309</a>    <a class="code" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a> lock;
<a name="l01310"></a><a class="code" href="structskinnysession.html#ac7cbd331d33fcd5a6f81a257975e4cd5">01310</a>    <span class="keyword">struct </span>sockaddr_in sin;
<a name="l01311"></a><a class="code" href="structskinnysession.html#a6f8059414f0228f0256115e024eeed4b">01311</a>    <span class="keywordtype">int</span> fd;
<a name="l01312"></a><a class="code" href="structskinnysession.html#ad5c7d4962dc867066ef0c2fd430bfa96">01312</a>    <span class="keywordtype">char</span> <a class="code" href="app__voicemail_8c.html#ac70fbae4ed48b5b48ff4b49f01e29f86" title="utility used by inchar(), for base_encode()">inbuf</a>[<a class="code" href="chan__skinny_8c.html#af113e81b9ed86ff1591580de9d8b1d52">SKINNY_MAX_PACKET</a>];
<a name="l01313"></a><a class="code" href="structskinnysession.html#add02b47ccdba2203fd3d2ae04d6180ea">01313</a>    <span class="keywordtype">char</span> outbuf[<a class="code" href="chan__skinny_8c.html#af113e81b9ed86ff1591580de9d8b1d52">SKINNY_MAX_PACKET</a>];
<a name="l01314"></a><a class="code" href="structskinnysession.html#a70701ca9c2641bcb1740286273a0473a">01314</a>    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *device;
<a name="l01315"></a>01315    <a class="code" href="linkedlists_8h.html#a67508a613c8f337732e35d9367b43ae7" title="Declare a forward link structure inside a list entry.">AST_LIST_ENTRY</a>(<a class="code" href="structskinnysession.html">skinnysession</a>) list;
<a name="l01316"></a>01316 };
<a name="l01317"></a>01317 
<a name="l01318"></a>01318 static <a class="code" href="linkedlists_8h.html#a10f9ed9242a397abf76de1ed1fa33c3b" title="Defines a structure to be used to hold a list of specified type, statically initialized...">AST_LIST_HEAD_STATIC</a>(<a class="code" href="structsessions.html">sessions</a>, <a class="code" href="structskinnysession.html">skinnysession</a>);
<a name="l01319"></a>01319 
<a name="l01320"></a>01320 static struct <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="chan__skinny_8c.html#a2e70d14d4ce2c4135bee603be0a3264d">skinny_request</a>(const <span class="keywordtype">char</span> *type, <span class="keywordtype">int</span> <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>, <span class="keywordtype">void</span> *data, <span class="keywordtype">int</span> *<a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>);
<a name="l01321"></a>01321 static <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#ad7cca1158f92f6fd2716c633fa141f50">skinny_devicestate</a>(<span class="keywordtype">void</span> *data);
<a name="l01322"></a>01322 static <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a0a988e663d92ee91aba280fb97e1640f">skinny_call</a>(struct <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *ast, <span class="keywordtype">char</span> *dest, <span class="keywordtype">int</span> timeout);
<a name="l01323"></a>01323 static <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#acbddfa3c6c07d0f530dce92d04c42c19">skinny_hangup</a>(struct <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *ast);
<a name="l01324"></a>01324 static <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#afac661ab214a4a68d115b3a1c70fdb32">skinny_answer</a>(struct <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *ast);
<a name="l01325"></a>01325 static struct <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="chan__skinny_8c.html#ade22bc3bb339cf936adbcd5a32f07537">skinny_read</a>(struct <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *ast);
<a name="l01326"></a>01326 static <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a9e4a5b612101b227ea903b83bd9a863a">skinny_write</a>(struct <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *ast, struct <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *frame);
<a name="l01327"></a>01327 static <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#aa6752ab977ca12d5f27c6c6970dae085">skinny_indicate</a>(struct <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *ast, <span class="keywordtype">int</span> ind, const <span class="keywordtype">void</span> *data, <span class="keywordtype">size_t</span> datalen);
<a name="l01328"></a>01328 static <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#aa67baa68e813caec6b66dac51d58f1f2">skinny_fixup</a>(struct <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *oldchan, struct <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *newchan);
<a name="l01329"></a>01329 static <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a60a505427fdd444c262281da8d1eb251">skinny_senddigit_begin</a>(struct <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *ast, <span class="keywordtype">char</span> digit);
<a name="l01330"></a>01330 static <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a76035e956bb8c2cfc5e6412fd6c02c55">skinny_senddigit_end</a>(struct <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *ast, <span class="keywordtype">char</span> digit, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> duration);
<a name="l01331"></a>01331 static <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a9900f684e2e692200c87ade6605b3570">handle_time_date_req_message</a>(struct <a class="code" href="structskinny__req.html">skinny_req</a> *req, struct skinnysession *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>);
<a name="l01332"></a>01332 static <span class="keywordtype">void</span> <a class="code" href="chan__skinny_8c.html#a46e4523f99409c6696dc775ed6a5e5ed">mwi_event_cb</a>(const struct <a class="code" href="structast__event.html" title="An event.">ast_event</a> *event, <span class="keywordtype">void</span> *userdata);
<a name="l01333"></a>01333 static <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#aa53f60b698c21b4f290b5defcf53ef9b">skinny_reload</a>(<span class="keywordtype">void</span>);
<a name="l01334"></a>01334 
<a name="l01335"></a><a class="code" href="chan__skinny_8c.html#af6c38f501b802babce30ed7dd08fc686">01335</a> static const struct <a class="code" href="structast__channel__tech.html" title="Structure to describe a channel &amp;quot;technology&amp;quot;, ie a channel driver See for...">ast_channel_tech</a> <a class="code" href="chan__skinny_8c.html#af6c38f501b802babce30ed7dd08fc686">skinny_tech</a> = {
<a name="l01336"></a>01336    .<a class="code" href="structast__channel__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a> = <span class="stringliteral">&quot;Skinny&quot;</span>,
<a name="l01337"></a>01337    .description = tdesc,
<a name="l01338"></a>01338    .capabilities = <a class="code" href="frame_8h.html#a3f680b9c15596de927d507a664fd2803">AST_FORMAT_AUDIO_MASK</a>,
<a name="l01339"></a>01339    .properties = <a class="code" href="channel_8h.html#a4f126a0a9b1d8c6a8f46a051ef8830bba54130226ec87f80c48ee98aa5cc9168c" title="Channels have this property if they can accept input with jitter; i.e. most VoIP...">AST_CHAN_TP_WANTSJITTER</a> | <a class="code" href="channel_8h.html#a4f126a0a9b1d8c6a8f46a051ef8830bbafb2c9cea57f7fc8e0350ed6f60cbb892" title="Channels have this property if they can create jitter; i.e. most VoIP channels.">AST_CHAN_TP_CREATESJITTER</a>,
<a name="l01340"></a>01340    .requester = <a class="code" href="chan__skinny_8c.html#a2e70d14d4ce2c4135bee603be0a3264d">skinny_request</a>,
<a name="l01341"></a>01341    .devicestate = <a class="code" href="chan__skinny_8c.html#ad7cca1158f92f6fd2716c633fa141f50">skinny_devicestate</a>,
<a name="l01342"></a>01342    .call = <a class="code" href="chan__skinny_8c.html#a0a988e663d92ee91aba280fb97e1640f">skinny_call</a>,
<a name="l01343"></a>01343    .hangup = <a class="code" href="chan__skinny_8c.html#acbddfa3c6c07d0f530dce92d04c42c19">skinny_hangup</a>,
<a name="l01344"></a>01344    .answer = <a class="code" href="chan__skinny_8c.html#afac661ab214a4a68d115b3a1c70fdb32">skinny_answer</a>,
<a name="l01345"></a>01345    .read = <a class="code" href="chan__skinny_8c.html#ade22bc3bb339cf936adbcd5a32f07537">skinny_read</a>,
<a name="l01346"></a>01346    .write = <a class="code" href="chan__skinny_8c.html#a9e4a5b612101b227ea903b83bd9a863a">skinny_write</a>,
<a name="l01347"></a>01347    .indicate = <a class="code" href="chan__skinny_8c.html#aa6752ab977ca12d5f27c6c6970dae085">skinny_indicate</a>,
<a name="l01348"></a>01348    .fixup = <a class="code" href="chan__skinny_8c.html#aa67baa68e813caec6b66dac51d58f1f2">skinny_fixup</a>,
<a name="l01349"></a>01349    .send_digit_begin = <a class="code" href="chan__skinny_8c.html#a60a505427fdd444c262281da8d1eb251">skinny_senddigit_begin</a>,
<a name="l01350"></a>01350    .send_digit_end = <a class="code" href="chan__skinny_8c.html#a76035e956bb8c2cfc5e6412fd6c02c55">skinny_senddigit_end</a>,
<a name="l01351"></a>01351    .bridge = <a class="code" href="rtp_8h.html#af45b92414bcb435f50e82c819e77649c" title="The RTP bridge.">ast_rtp_bridge</a>,  
<a name="l01352"></a>01352 };
<a name="l01353"></a>01353 
<a name="l01354"></a>01354 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#abe88d7d15a546c75f3bd8f13a6f15fe8">skinny_extensionstate_cb</a>(<span class="keywordtype">char</span> *<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <span class="keywordtype">char</span>* <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, <span class="keywordtype">int</span> <a class="code" href="structstate.html">state</a>, <span class="keywordtype">void</span> *data);
<a name="l01355"></a>01355 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#aea5421cbe4655ae065e67067694eca68">skinny_transfer</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub);
<a name="l01356"></a>01356 
<a name="l01357"></a><a class="code" href="chan__skinny_8c.html#a777f6b11a8e0eb771de41dfe998bb570">01357</a> <span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="chan__skinny_8c.html#a777f6b11a8e0eb771de41dfe998bb570">get_button_template</a>(<span class="keyword">struct</span> <a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, <span class="keyword">struct</span> <a class="code" href="structbutton__definition__template.html">button_definition_template</a> *btn)
<a name="l01358"></a>01358 {
<a name="l01359"></a>01359    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d = s-&gt;<a class="code" href="structskinnysession.html#a70701ca9c2641bcb1740286273a0473a">device</a>;
<a name="l01360"></a>01360    <span class="keyword">struct </span>skinny_addon *a;
<a name="l01361"></a>01361    <span class="keywordtype">int</span> i;
<a name="l01362"></a>01362 
<a name="l01363"></a>01363    <span class="keywordflow">switch</span> (d-&gt;type) {
<a name="l01364"></a>01364       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a3f3cd69f7c3fbc2a03f357123c699713">SKINNY_DEVICE_30SPPLUS</a>:
<a name="l01365"></a>01365       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#ad1629fcaedb5583acbff4481fc3affb4">SKINNY_DEVICE_30VIP</a>:
<a name="l01366"></a>01366          <span class="comment">/* 13 rows, 2 columns */</span>
<a name="l01367"></a>01367          <span class="keywordflow">for</span> (i = 0; i &lt; 4; i++)
<a name="l01368"></a>01368             (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#a79703f70916908d1d8a2cbb2c319a287">BT_CUST_LINE</a>;
<a name="l01369"></a>01369          (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#ad42c94940dcf4f9dfcbadb66768a232e">BT_REDIAL</a>;
<a name="l01370"></a>01370          (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#ae9c3820ed2b487507e8c713c7fb1db03">BT_VOICEMAIL</a>;
<a name="l01371"></a>01371          (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#a5fac0c713656df7ee579325a7755da46">BT_CALLPARK</a>;
<a name="l01372"></a>01372          (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#a717fbb6c33d3e97eda9e83439fcfc9f6">BT_FORWARDALL</a>;
<a name="l01373"></a>01373          (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#aab811d3a4b1b82a685a59c95a451bc56">BT_CONFERENCE</a>;
<a name="l01374"></a>01374          <span class="keywordflow">for</span> (i = 0; i &lt; 4; i++)
<a name="l01375"></a>01375             (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#afaba3e566686d3d7a3f42c20aa5e882d">BT_NONE</a>;
<a name="l01376"></a>01376          <span class="keywordflow">for</span> (i = 0; i &lt; 13; i++)
<a name="l01377"></a>01377             (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#a6c4119bfe726809a67361ef8873aebb1">BT_SPEEDDIAL</a>;
<a name="l01378"></a>01378          
<a name="l01379"></a>01379          <span class="keywordflow">break</span>;
<a name="l01380"></a>01380       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#af39bd902ef207e030753286d65681c7c">SKINNY_DEVICE_12SPPLUS</a>:
<a name="l01381"></a>01381       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#ad18902e12cbd352d1af5cb39e4b370ca">SKINNY_DEVICE_12SP</a>:
<a name="l01382"></a>01382       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#ac1db4bfd5d17f22afbc4bf80d6337d54">SKINNY_DEVICE_12</a>:
<a name="l01383"></a>01383          <span class="comment">/* 6 rows, 2 columns */</span>
<a name="l01384"></a>01384          <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++)
<a name="l01385"></a>01385             (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#a79703f70916908d1d8a2cbb2c319a287">BT_CUST_LINE</a>;
<a name="l01386"></a>01386          <span class="keywordflow">for</span> (i = 0; i &lt; 4; i++)
<a name="l01387"></a>01387             (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#a6c4119bfe726809a67361ef8873aebb1">BT_SPEEDDIAL</a>;
<a name="l01388"></a>01388          (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#a66496dc99061becc829b16fb6a77b932">BT_HOLD</a>;
<a name="l01389"></a>01389          (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#ad42c94940dcf4f9dfcbadb66768a232e">BT_REDIAL</a>;
<a name="l01390"></a>01390          (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#ad694b8a6767c0471620203a76c163c94">BT_TRANSFER</a>;
<a name="l01391"></a>01391          (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#a717fbb6c33d3e97eda9e83439fcfc9f6">BT_FORWARDALL</a>;
<a name="l01392"></a>01392          (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#a5fac0c713656df7ee579325a7755da46">BT_CALLPARK</a>;
<a name="l01393"></a>01393          (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#ae9c3820ed2b487507e8c713c7fb1db03">BT_VOICEMAIL</a>;
<a name="l01394"></a>01394          <span class="keywordflow">break</span>;
<a name="l01395"></a>01395       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a8d87016fbefca28ff0756886e24aa1f3">SKINNY_DEVICE_7910</a>:
<a name="l01396"></a>01396          (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#a081aff21e0bee826b43a1e779321a5e0">BT_LINE</a>;
<a name="l01397"></a>01397          (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#a66496dc99061becc829b16fb6a77b932">BT_HOLD</a>;
<a name="l01398"></a>01398          (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#ad694b8a6767c0471620203a76c163c94">BT_TRANSFER</a>;
<a name="l01399"></a>01399          (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#ad78a3be084759b7516f88e3ac5bc3878">BT_DISPLAY</a>;
<a name="l01400"></a>01400          (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#ae9c3820ed2b487507e8c713c7fb1db03">BT_VOICEMAIL</a>;
<a name="l01401"></a>01401          (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#aab811d3a4b1b82a685a59c95a451bc56">BT_CONFERENCE</a>;
<a name="l01402"></a>01402          (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#a717fbb6c33d3e97eda9e83439fcfc9f6">BT_FORWARDALL</a>;
<a name="l01403"></a>01403          <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++)
<a name="l01404"></a>01404             (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#a6c4119bfe726809a67361ef8873aebb1">BT_SPEEDDIAL</a>;
<a name="l01405"></a>01405          (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#ad42c94940dcf4f9dfcbadb66768a232e">BT_REDIAL</a>;
<a name="l01406"></a>01406          <span class="keywordflow">break</span>;
<a name="l01407"></a>01407       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a21bbc062b4e4c70b3789ef050b73174f">SKINNY_DEVICE_7960</a>:
<a name="l01408"></a>01408       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a47e3aa64ee6a6f5e659bad94b9576eee">SKINNY_DEVICE_7961</a>:
<a name="l01409"></a>01409       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a81e679dbd7beefb8f09015996b53bd27">SKINNY_DEVICE_7961GE</a>:
<a name="l01410"></a>01410       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a4ae851d94958aab0ec8c3410f7e2a15d">SKINNY_DEVICE_7962</a>:
<a name="l01411"></a>01411       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#ab61a7c473b18188f04fb35186ed35976">SKINNY_DEVICE_7965</a>:
<a name="l01412"></a>01412          <span class="keywordflow">for</span> (i = 0; i &lt; 6; i++)
<a name="l01413"></a>01413             (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#ad25614879b5f61a397dd7e6afc94e315">BT_CUST_LINESPEEDDIAL</a>;
<a name="l01414"></a>01414          <span class="keywordflow">break</span>;
<a name="l01415"></a>01415       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a13b2375dace6af91acc78d6c694b1f88">SKINNY_DEVICE_7940</a>:
<a name="l01416"></a>01416       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a7178ace67146a2004b92c3cf46aec2c9">SKINNY_DEVICE_7941</a>:
<a name="l01417"></a>01417       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a171ee3ea3cd771beb545e9741196516d">SKINNY_DEVICE_7941GE</a>:
<a name="l01418"></a>01418       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a10266707a30856e2d0f3205b5e4a1ccd">SKINNY_DEVICE_7942</a>:
<a name="l01419"></a>01419       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a11d00fd199be58f222cafe9df0e4669e">SKINNY_DEVICE_7945</a>:
<a name="l01420"></a>01420          <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++)
<a name="l01421"></a>01421             (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#ad25614879b5f61a397dd7e6afc94e315">BT_CUST_LINESPEEDDIAL</a>;
<a name="l01422"></a>01422          <span class="keywordflow">break</span>;
<a name="l01423"></a>01423       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#afa9c2c4a21e3a321cf0c2c4adec1a05f">SKINNY_DEVICE_7935</a>:
<a name="l01424"></a>01424       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a6e10ac13a55648f43ab0769552b3dc8e">SKINNY_DEVICE_7936</a>:
<a name="l01425"></a>01425          <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++)
<a name="l01426"></a>01426             (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#a081aff21e0bee826b43a1e779321a5e0">BT_LINE</a>;
<a name="l01427"></a>01427          <span class="keywordflow">break</span>;
<a name="l01428"></a>01428       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a5916bc0fad835957681082ac3848bd2e">SKINNY_DEVICE_ATA186</a>:
<a name="l01429"></a>01429          (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#a081aff21e0bee826b43a1e779321a5e0">BT_LINE</a>;
<a name="l01430"></a>01430          <span class="keywordflow">break</span>;
<a name="l01431"></a>01431       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#af3a42f7afa01b1dbffacd7d07f9751b5">SKINNY_DEVICE_7970</a>:
<a name="l01432"></a>01432       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#ae306befb4a743eb3e38f3f2bb2dbd59f">SKINNY_DEVICE_7971</a>:
<a name="l01433"></a>01433       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a669bfc638ff207829d2e063533bcd7e8">SKINNY_DEVICE_7975</a>:
<a name="l01434"></a>01434       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#aa82c3d86ef6e9bdda657d0637a56f0b3">SKINNY_DEVICE_CIPC</a>:
<a name="l01435"></a>01435          <span class="keywordflow">for</span> (i = 0; i &lt; 8; i++)
<a name="l01436"></a>01436             (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#ad25614879b5f61a397dd7e6afc94e315">BT_CUST_LINESPEEDDIAL</a>;
<a name="l01437"></a>01437          <span class="keywordflow">break</span>;
<a name="l01438"></a>01438       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#ac3cd7f69be6e51d64b6688a80a65fc92">SKINNY_DEVICE_7985</a>:
<a name="l01439"></a>01439          <span class="comment">/* XXX I have no idea what the buttons look like on these. */</span>
<a name="l01440"></a>01440          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unsupported device type &apos;%d (7985)&apos; found.\n&quot;</span>, d-&gt;type);
<a name="l01441"></a>01441          <span class="keywordflow">break</span>;
<a name="l01442"></a>01442       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a51c12165871b57ce6a1deffecea01b17">SKINNY_DEVICE_7912</a>:
<a name="l01443"></a>01443       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a92da7b5faa7ec3709f054f179937082c">SKINNY_DEVICE_7911</a>:
<a name="l01444"></a>01444       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a433816a4c8748c37ec6ff4d6fe0430aa">SKINNY_DEVICE_7905</a>:
<a name="l01445"></a>01445          (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#a081aff21e0bee826b43a1e779321a5e0">BT_LINE</a>;
<a name="l01446"></a>01446          (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#a66496dc99061becc829b16fb6a77b932">BT_HOLD</a>;
<a name="l01447"></a>01447          <span class="keywordflow">break</span>;
<a name="l01448"></a>01448       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a14da74571081caf219c70f4dc49499d8">SKINNY_DEVICE_7920</a>:
<a name="l01449"></a>01449          <span class="comment">/* XXX I don&apos;t know if this is right. */</span>
<a name="l01450"></a>01450          <span class="keywordflow">for</span> (i = 0; i &lt; 4; i++)
<a name="l01451"></a>01451             (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#ad25614879b5f61a397dd7e6afc94e315">BT_CUST_LINESPEEDDIAL</a>;
<a name="l01452"></a>01452          <span class="keywordflow">break</span>;
<a name="l01453"></a>01453       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a2cf2ea66eb12030fe401f0f68fa2623d">SKINNY_DEVICE_7921</a>:
<a name="l01454"></a>01454          <span class="keywordflow">for</span> (i = 0; i &lt; 6; i++)
<a name="l01455"></a>01455             (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#ad25614879b5f61a397dd7e6afc94e315">BT_CUST_LINESPEEDDIAL</a>;
<a name="l01456"></a>01456          <span class="keywordflow">break</span>;
<a name="l01457"></a>01457       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a9a7988ad601a91351534202a8e1ad43e">SKINNY_DEVICE_7902</a>:
<a name="l01458"></a>01458          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unsupported device type &apos;%d (7902)&apos; found.\n&quot;</span>, d-&gt;type);
<a name="l01459"></a>01459          <span class="keywordflow">break</span>;
<a name="l01460"></a>01460       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#ab68f0d8b6cb25f78ad3b7491f20fcd8e">SKINNY_DEVICE_7906</a>:
<a name="l01461"></a>01461          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unsupported device type &apos;%d (7906)&apos; found.\n&quot;</span>, d-&gt;type);
<a name="l01462"></a>01462          <span class="keywordflow">break</span>;
<a name="l01463"></a>01463       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a8dd826d1782563f838ed10bfcabe2e05">SKINNY_DEVICE_7931</a>:
<a name="l01464"></a>01464          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unsupported device type &apos;%d (7931)&apos; found.\n&quot;</span>, d-&gt;type);
<a name="l01465"></a>01465          <span class="keywordflow">break</span>;
<a name="l01466"></a>01466       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a3bb0cce3c6fbeabf3fa67e0a316cf535">SKINNY_DEVICE_7937</a>:
<a name="l01467"></a>01467          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unsupported device type &apos;%d (7937)&apos; found.\n&quot;</span>, d-&gt;type);
<a name="l01468"></a>01468          <span class="keywordflow">break</span>;
<a name="l01469"></a>01469       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a5bc5ce4a9c8f4198130d3ce756324f68">SKINNY_DEVICE_7914</a>:
<a name="l01470"></a>01470          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unsupported device type &apos;%d (7914)&apos; found.  Expansion module registered by itself?\n&quot;</span>, d-&gt;type);
<a name="l01471"></a>01471          <span class="keywordflow">break</span>;
<a name="l01472"></a>01472       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a032655a31a1da3ff3a8853e8511d9dd9">SKINNY_DEVICE_SCCPGATEWAY_AN</a>:
<a name="l01473"></a>01473       <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a62fe3f5742eb03458a14f2dd241d093a">SKINNY_DEVICE_SCCPGATEWAY_BRI</a>:
<a name="l01474"></a>01474          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unsupported device type &apos;%d (SCCP gateway)&apos; found.\n&quot;</span>, d-&gt;type);
<a name="l01475"></a>01475          <span class="keywordflow">break</span>;
<a name="l01476"></a>01476       <span class="keywordflow">default</span>:
<a name="l01477"></a>01477          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unknown device type &apos;%d&apos; found.\n&quot;</span>, d-&gt;type);
<a name="l01478"></a>01478          <span class="keywordflow">break</span>;
<a name="l01479"></a>01479    }
<a name="l01480"></a>01480 
<a name="l01481"></a>01481    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;d-&gt;addons);
<a name="l01482"></a>01482    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;addons, a, list) {
<a name="l01483"></a>01483       <span class="keywordflow">if</span> (!strcasecmp(a-&gt;<a class="code" href="structskinny__addon.html#a33e6e7edca48ac1ff105d85011dfc454">type</a>, <span class="stringliteral">&quot;7914&quot;</span>)) {
<a name="l01484"></a>01484          <span class="keywordflow">for</span> (i = 0; i &lt; 14; i++)
<a name="l01485"></a>01485             (btn++)-&gt;buttonDefinition = <a class="code" href="chan__skinny_8c.html#ad25614879b5f61a397dd7e6afc94e315">BT_CUST_LINESPEEDDIAL</a>;
<a name="l01486"></a>01486       } <span class="keywordflow">else</span> {
<a name="l01487"></a>01487          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unknown addon type &apos;%s&apos; found.  Skipping.\n&quot;</span>, a-&gt;<a class="code" href="structskinny__addon.html#a33e6e7edca48ac1ff105d85011dfc454">type</a>);
<a name="l01488"></a>01488       }
<a name="l01489"></a>01489    }
<a name="l01490"></a>01490    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;d-&gt;addons);
<a name="l01491"></a>01491 
<a name="l01492"></a>01492    <span class="keywordflow">return</span> btn;
<a name="l01493"></a>01493 }
<a name="l01494"></a>01494 
<a name="l01495"></a><a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">01495</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structskinny__req.html">skinny_req</a> *<a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keywordtype">size_t</span> size, <span class="keywordtype">int</span> response_message)
<a name="l01496"></a>01496 {
<a name="l01497"></a>01497    <span class="keyword">struct </span><a class="code" href="structskinny__req.html">skinny_req</a> *req;
<a name="l01498"></a>01498 
<a name="l01499"></a>01499    <span class="keywordflow">if</span> (!(req = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, skinny_header_size + size + 4)))
<a name="l01500"></a>01500       <span class="keywordflow">return</span> NULL;
<a name="l01501"></a>01501 
<a name="l01502"></a>01502    req-&gt;<a class="code" href="structskinny__req.html#afed088663f8704004425cdae2120b9b3">len</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(size+4);
<a name="l01503"></a>01503    req-&gt;<a class="code" href="structskinny__req.html#a88859ce72faebb79ea0a2bca00a0f46b">e</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(response_message);
<a name="l01504"></a>01504 
<a name="l01505"></a>01505    <span class="keywordflow">return</span> req;
<a name="l01506"></a>01506 }
<a name="l01507"></a>01507 
<a name="l01508"></a><a class="code" href="chan__skinny_8c.html#a7b9ecaa4bb1481a9a5666e91c88a3968">01508</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *<a class="code" href="chan__skinny_8c.html#a7b9ecaa4bb1481a9a5666e91c88a3968">find_line_by_instance</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__device.html">skinny_device</a> *d, <span class="keywordtype">int</span> instance)
<a name="l01509"></a>01509 {
<a name="l01510"></a>01510    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l;
<a name="l01511"></a>01511 
<a name="l01512"></a>01512    <span class="comment">/*Dialing from on hook or on a 7920 uses instance 0 in requests</span>
<a name="l01513"></a>01513 <span class="comment">     but we need to start looking at instance 1 */</span>
<a name="l01514"></a>01514 
<a name="l01515"></a>01515    <span class="keywordflow">if</span> (!instance)
<a name="l01516"></a>01516       instance = 1;
<a name="l01517"></a>01517 
<a name="l01518"></a>01518    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;lines, l, list){
<a name="l01519"></a>01519       <span class="keywordflow">if</span> (l-&gt;instance == instance)
<a name="l01520"></a>01520          <span class="keywordflow">break</span>;
<a name="l01521"></a>01521    }
<a name="l01522"></a>01522 
<a name="l01523"></a>01523    <span class="keywordflow">if</span> (!l) {
<a name="l01524"></a>01524       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not find line with instance &apos;%d&apos; on device &apos;%s&apos;\n&quot;</span>, instance, d-&gt;name);
<a name="l01525"></a>01525    }
<a name="l01526"></a>01526    <span class="keywordflow">return</span> l;
<a name="l01527"></a>01527 }
<a name="l01528"></a>01528 
<a name="l01529"></a><a class="code" href="chan__skinny_8c.html#a2a4f825b302983d41ab43a9e3387da4b">01529</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *<a class="code" href="chan__skinny_8c.html#a2a4f825b302983d41ab43a9e3387da4b">find_line_by_name</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *dest)
<a name="l01530"></a>01530 {
<a name="l01531"></a>01531    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l;
<a name="l01532"></a>01532    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *tmpl = NULL;
<a name="l01533"></a>01533    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d;
<a name="l01534"></a>01534    <span class="keywordtype">char</span> line[256];
<a name="l01535"></a>01535    <span class="keywordtype">char</span> *at;
<a name="l01536"></a>01536    <span class="keywordtype">char</span> *device;
<a name="l01537"></a>01537    <span class="keywordtype">int</span> checkdevice = 0;
<a name="l01538"></a>01538 
<a name="l01539"></a>01539    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(line, dest, <span class="keyword">sizeof</span>(line));
<a name="l01540"></a>01540    at = strchr(line, <span class="charliteral">&apos;@&apos;</span>);
<a name="l01541"></a>01541    <span class="keywordflow">if</span> (at)
<a name="l01542"></a>01542       *at++ = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01543"></a>01543    device = at;
<a name="l01544"></a>01544 
<a name="l01545"></a>01545    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(device))
<a name="l01546"></a>01546       checkdevice = 1;
<a name="l01547"></a>01547 
<a name="l01548"></a>01548    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>);
<a name="l01549"></a>01549    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>, d, list){
<a name="l01550"></a>01550       <span class="keywordflow">if</span> (checkdevice &amp;&amp; tmpl)
<a name="l01551"></a>01551          <span class="keywordflow">break</span>;
<a name="l01552"></a>01552       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!checkdevice) {
<a name="l01553"></a>01553          <span class="comment">/* This is a match, since we&apos;re checking for line on every device. */</span>
<a name="l01554"></a>01554       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(d-&gt;name, device)) {
<a name="l01555"></a>01555          <span class="keywordflow">if</span> (skinnydebug)
<a name="l01556"></a>01556             <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Found device: %s\n&quot;</span>, d-&gt;name);
<a name="l01557"></a>01557       } <span class="keywordflow">else</span>
<a name="l01558"></a>01558          <span class="keywordflow">continue</span>;
<a name="l01559"></a>01559 
<a name="l01560"></a>01560       <span class="comment">/* Found the device (or we don&apos;t care which device) */</span>
<a name="l01561"></a>01561       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;lines, l, list){
<a name="l01562"></a>01562          <span class="comment">/* Search for the right line */</span>
<a name="l01563"></a>01563          <span class="keywordflow">if</span> (!strcasecmp(l-&gt;name, line)) {
<a name="l01564"></a>01564             <span class="keywordflow">if</span> (tmpl) {
<a name="l01565"></a>01565                <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Ambiguous line name: %s\n&quot;</span>, line);
<a name="l01566"></a>01566                <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>);
<a name="l01567"></a>01567                <span class="keywordflow">return</span> NULL;
<a name="l01568"></a>01568             } <span class="keywordflow">else</span>
<a name="l01569"></a>01569                tmpl = l;
<a name="l01570"></a>01570          }
<a name="l01571"></a>01571       }
<a name="l01572"></a>01572    }
<a name="l01573"></a>01573    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>);
<a name="l01574"></a>01574    <span class="keywordflow">return</span> tmpl;
<a name="l01575"></a>01575 }
<a name="l01576"></a>01576 <span class="comment"></span>
<a name="l01577"></a>01577 <span class="comment">/*!</span>
<a name="l01578"></a>01578 <span class="comment"> * implement the setvar config line</span>
<a name="l01579"></a>01579 <span class="comment"> */</span>
<a name="l01580"></a><a class="code" href="chan__skinny_8c.html#aeb7b46c1c2ecae89c0bb53a53f5684d2">01580</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="chan__skinny_8c.html#aeb7b46c1c2ecae89c0bb53a53f5684d2">add_var</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <span class="keyword">struct</span> <a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *list)
<a name="l01581"></a>01581 {
<a name="l01582"></a>01582    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *tmpvar = NULL;
<a name="l01583"></a>01583    <span class="keywordtype">char</span> *varname = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(buf), *varval = NULL;
<a name="l01584"></a>01584 
<a name="l01585"></a>01585    <span class="keywordflow">if</span> ((varval = strchr(varname,<span class="charliteral">&apos;=&apos;</span>))) {
<a name="l01586"></a>01586       *varval++ = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01587"></a>01587       <span class="keywordflow">if</span> ((tmpvar = <a class="code" href="config_8h.html#a08e94d96f459e7301a74daf32035423b">ast_variable_new</a>(varname, varval, <span class="stringliteral">&quot;&quot;</span>))) {
<a name="l01588"></a>01588          tmpvar-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a> = list;
<a name="l01589"></a>01589          list = tmpvar;
<a name="l01590"></a>01590       }
<a name="l01591"></a>01591    }
<a name="l01592"></a>01592    <span class="keywordflow">return</span> list;
<a name="l01593"></a>01593 }
<a name="l01594"></a>01594 
<a name="l01595"></a>01595 <span class="comment">/* It&apos;s quicker/easier to find the subchannel when we know the instance number too */</span>
<a name="l01596"></a><a class="code" href="chan__skinny_8c.html#a10c715ff96a500b77ddc4442fa17cf55">01596</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *<a class="code" href="chan__skinny_8c.html#a10c715ff96a500b77ddc4442fa17cf55">find_subchannel_by_instance_reference</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__device.html">skinny_device</a> *d, <span class="keywordtype">int</span> instance, <span class="keywordtype">int</span> reference)
<a name="l01597"></a>01597 {
<a name="l01598"></a>01598    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l = <a class="code" href="chan__skinny_8c.html#a7b9ecaa4bb1481a9a5666e91c88a3968">find_line_by_instance</a>(d, instance);
<a name="l01599"></a>01599    <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub;
<a name="l01600"></a>01600 
<a name="l01601"></a>01601    <span class="keywordflow">if</span> (!l) {
<a name="l01602"></a>01602       <span class="keywordflow">return</span> NULL;
<a name="l01603"></a>01603    }
<a name="l01604"></a>01604 
<a name="l01605"></a>01605    <span class="comment">/* 7920 phones set call reference to 0, so use the first</span>
<a name="l01606"></a>01606 <span class="comment">      sub-channel on the list.</span>
<a name="l01607"></a>01607 <span class="comment">           This MIGHT need more love to be right */</span>
<a name="l01608"></a>01608    <span class="keywordflow">if</span> (!reference)
<a name="l01609"></a>01609       sub = <a class="code" href="linkedlists_8h.html#adf1959c5c03a3a706da97ad2f49617e5" title="Returns the first entry contained in a list.">AST_LIST_FIRST</a>(&amp;l-&gt;sub);
<a name="l01610"></a>01610    <span class="keywordflow">else</span> {
<a name="l01611"></a>01611       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;l-&gt;sub, sub, list) {
<a name="l01612"></a>01612          <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a> == reference)
<a name="l01613"></a>01613             <span class="keywordflow">break</span>;
<a name="l01614"></a>01614       }
<a name="l01615"></a>01615    }
<a name="l01616"></a>01616    <span class="keywordflow">if</span> (!sub) {
<a name="l01617"></a>01617       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not find subchannel with reference &apos;%d&apos; on &apos;%s&apos;\n&quot;</span>, reference, d-&gt;name);
<a name="l01618"></a>01618    }
<a name="l01619"></a>01619    <span class="keywordflow">return</span> sub;
<a name="l01620"></a>01620 }
<a name="l01621"></a>01621 
<a name="l01622"></a>01622 <span class="comment">/* Find the subchannel when we only have the callid - this shouldn&apos;t happen often */</span>
<a name="l01623"></a><a class="code" href="chan__skinny_8c.html#acaafecebc752534270c786c48539a9ee">01623</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *<a class="code" href="chan__skinny_8c.html#acaafecebc752534270c786c48539a9ee">find_subchannel_by_reference</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__device.html">skinny_device</a> *d, <span class="keywordtype">int</span> reference)
<a name="l01624"></a>01624 {
<a name="l01625"></a>01625    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l;
<a name="l01626"></a>01626    <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub = NULL;
<a name="l01627"></a>01627 
<a name="l01628"></a>01628    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;lines, l, list){
<a name="l01629"></a>01629       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;l-&gt;sub, sub, list){
<a name="l01630"></a>01630          <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a> == reference)
<a name="l01631"></a>01631             <span class="keywordflow">break</span>;
<a name="l01632"></a>01632       }
<a name="l01633"></a>01633       <span class="keywordflow">if</span> (sub)
<a name="l01634"></a>01634          <span class="keywordflow">break</span>;
<a name="l01635"></a>01635    }
<a name="l01636"></a>01636 
<a name="l01637"></a>01637    <span class="keywordflow">if</span> (!l) {
<a name="l01638"></a>01638       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not find any lines that contained a subchannel with reference &apos;%d&apos; on device &apos;%s&apos;\n&quot;</span>, reference, d-&gt;name);
<a name="l01639"></a>01639    } <span class="keywordflow">else</span> {
<a name="l01640"></a>01640       <span class="keywordflow">if</span> (!sub) {
<a name="l01641"></a>01641          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not find subchannel with reference &apos;%d&apos; on &apos;%s@%s&apos;\n&quot;</span>, reference, l-&gt;name, d-&gt;name);
<a name="l01642"></a>01642       }
<a name="l01643"></a>01643    }
<a name="l01644"></a>01644    <span class="keywordflow">return</span> sub;
<a name="l01645"></a>01645 }
<a name="l01646"></a>01646 
<a name="l01647"></a><a class="code" href="chan__skinny_8c.html#a0be9e6c1ec02d36ff811d63a5b9ca022">01647</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structskinny__speeddial.html">skinny_speeddial</a> *<a class="code" href="chan__skinny_8c.html#a0be9e6c1ec02d36ff811d63a5b9ca022">find_speeddial_by_instance</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__device.html">skinny_device</a> *d, <span class="keywordtype">int</span> <a class="code" href="structskinny__speeddial.html#a6fd216872447cfe5f757d2ce47fea6fb">instance</a>, <span class="keywordtype">int</span> <a class="code" href="structskinny__speeddial.html#ad3d414cdb71376b88dc5ce91a2a6118e">isHint</a>)
<a name="l01648"></a>01648 {
<a name="l01649"></a>01649    <span class="keyword">struct </span><a class="code" href="structskinny__speeddial.html">skinny_speeddial</a> *sd;
<a name="l01650"></a>01650 
<a name="l01651"></a>01651    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;speeddials, sd, list) {
<a name="l01652"></a>01652       <span class="keywordflow">if</span> (sd-&gt;<a class="code" href="structskinny__speeddial.html#ad3d414cdb71376b88dc5ce91a2a6118e">isHint</a> == isHint &amp;&amp; sd-&gt;<a class="code" href="structskinny__speeddial.html#a6fd216872447cfe5f757d2ce47fea6fb">instance</a> == instance)
<a name="l01653"></a>01653          <span class="keywordflow">break</span>;
<a name="l01654"></a>01654    }
<a name="l01655"></a>01655 
<a name="l01656"></a>01656    <span class="keywordflow">if</span> (!sd) {
<a name="l01657"></a>01657       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not find speeddial with instance &apos;%d&apos; on device &apos;%s&apos;\n&quot;</span>, instance, d-&gt;name);
<a name="l01658"></a>01658    }
<a name="l01659"></a>01659    <span class="keywordflow">return</span> sd;
<a name="l01660"></a>01660 }
<a name="l01661"></a>01661 
<a name="l01662"></a><a class="code" href="chan__skinny_8c.html#a615827788544df4e5a9788b858d8a7f6">01662</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a615827788544df4e5a9788b858d8a7f6">codec_skinny2ast</a>(<span class="keyword">enum</span> <a class="code" href="chan__skinny_8c.html#a844a39ac2662cbc0d7eaa6122ac5ae71">skinny_codecs</a> skinnycodec)
<a name="l01663"></a>01663 {
<a name="l01664"></a>01664    <span class="keywordflow">switch</span> (skinnycodec) {
<a name="l01665"></a>01665    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a844a39ac2662cbc0d7eaa6122ac5ae71ac9f09a33a0a55d0ae8035371435217bd">SKINNY_CODEC_ALAW</a>:
<a name="l01666"></a>01666       <span class="keywordflow">return</span> <a class="code" href="frame_8h.html#aa58cc980a9c9108522effc64e9aff2d6">AST_FORMAT_ALAW</a>;
<a name="l01667"></a>01667    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a844a39ac2662cbc0d7eaa6122ac5ae71a4e2f1fe7a095d3200609ba5b38443831">SKINNY_CODEC_ULAW</a>:
<a name="l01668"></a>01668       <span class="keywordflow">return</span> <a class="code" href="frame_8h.html#ab602cf455d4a96a3adba2e3ba8cd2b2c">AST_FORMAT_ULAW</a>;
<a name="l01669"></a>01669    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a844a39ac2662cbc0d7eaa6122ac5ae71a78f84a441f7ee1fd3dc5e4e5b806a07d">SKINNY_CODEC_G723_1</a>:
<a name="l01670"></a>01670       <span class="keywordflow">return</span> <a class="code" href="frame_8h.html#ad90b56ed6ada6e4f13224512668e20fb">AST_FORMAT_G723_1</a>;
<a name="l01671"></a>01671    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a844a39ac2662cbc0d7eaa6122ac5ae71a6cb2cab00c618310f5cb9f3d52bda154">SKINNY_CODEC_G729A</a>:
<a name="l01672"></a>01672       <span class="keywordflow">return</span> <a class="code" href="frame_8h.html#a8c5f13161448f613baaf42dea11f520a">AST_FORMAT_G729A</a>;
<a name="l01673"></a>01673    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a844a39ac2662cbc0d7eaa6122ac5ae71ac4fa98d11dc256eb65904786fbc28517">SKINNY_CODEC_G726_32</a>:
<a name="l01674"></a>01674       <span class="keywordflow">return</span> <a class="code" href="frame_8h.html#a536fbd427f197a33e679c7721afad420">AST_FORMAT_G726_AAL2</a>; <span class="comment">/* XXX Is this right? */</span>
<a name="l01675"></a>01675    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a844a39ac2662cbc0d7eaa6122ac5ae71a48e1eb3a3d96993b9754643d9ec3c950">SKINNY_CODEC_H261</a>:
<a name="l01676"></a>01676       <span class="keywordflow">return</span> <a class="code" href="frame_8h.html#a876fb06c385409451b7842fe1af6c42e">AST_FORMAT_H261</a>;
<a name="l01677"></a>01677    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a844a39ac2662cbc0d7eaa6122ac5ae71a4d00a1ea7a1cdd28f6d452057c01f665">SKINNY_CODEC_H263</a>:
<a name="l01678"></a>01678       <span class="keywordflow">return</span> <a class="code" href="frame_8h.html#a750506bc6e9117c66a5a6ad2dc82bc85">AST_FORMAT_H263</a>;
<a name="l01679"></a>01679    <span class="keywordflow">default</span>:
<a name="l01680"></a>01680       <span class="keywordflow">return</span> 0;
<a name="l01681"></a>01681    }
<a name="l01682"></a>01682 }
<a name="l01683"></a>01683 
<a name="l01684"></a><a class="code" href="chan__skinny_8c.html#a8e3a410f226a1ae0959bc3604421bcb7">01684</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a8e3a410f226a1ae0959bc3604421bcb7">codec_ast2skinny</a>(<span class="keywordtype">int</span> astcodec)
<a name="l01685"></a>01685 {
<a name="l01686"></a>01686    <span class="keywordflow">switch</span> (astcodec) {
<a name="l01687"></a>01687    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aa58cc980a9c9108522effc64e9aff2d6">AST_FORMAT_ALAW</a>:
<a name="l01688"></a>01688       <span class="keywordflow">return</span> <a class="code" href="chan__skinny_8c.html#a844a39ac2662cbc0d7eaa6122ac5ae71ac9f09a33a0a55d0ae8035371435217bd">SKINNY_CODEC_ALAW</a>;
<a name="l01689"></a>01689    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ab602cf455d4a96a3adba2e3ba8cd2b2c">AST_FORMAT_ULAW</a>:
<a name="l01690"></a>01690       <span class="keywordflow">return</span> <a class="code" href="chan__skinny_8c.html#a844a39ac2662cbc0d7eaa6122ac5ae71a4e2f1fe7a095d3200609ba5b38443831">SKINNY_CODEC_ULAW</a>;
<a name="l01691"></a>01691    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ad90b56ed6ada6e4f13224512668e20fb">AST_FORMAT_G723_1</a>:
<a name="l01692"></a>01692       <span class="keywordflow">return</span> <a class="code" href="chan__skinny_8c.html#a844a39ac2662cbc0d7eaa6122ac5ae71a78f84a441f7ee1fd3dc5e4e5b806a07d">SKINNY_CODEC_G723_1</a>;
<a name="l01693"></a>01693    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a8c5f13161448f613baaf42dea11f520a">AST_FORMAT_G729A</a>:
<a name="l01694"></a>01694       <span class="keywordflow">return</span> <a class="code" href="chan__skinny_8c.html#a844a39ac2662cbc0d7eaa6122ac5ae71a6cb2cab00c618310f5cb9f3d52bda154">SKINNY_CODEC_G729A</a>;
<a name="l01695"></a>01695    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a536fbd427f197a33e679c7721afad420">AST_FORMAT_G726_AAL2</a>: <span class="comment">/* XXX Is this right? */</span>
<a name="l01696"></a>01696       <span class="keywordflow">return</span> <a class="code" href="chan__skinny_8c.html#a844a39ac2662cbc0d7eaa6122ac5ae71ac4fa98d11dc256eb65904786fbc28517">SKINNY_CODEC_G726_32</a>;
<a name="l01697"></a>01697    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a876fb06c385409451b7842fe1af6c42e">AST_FORMAT_H261</a>:
<a name="l01698"></a>01698       <span class="keywordflow">return</span> <a class="code" href="chan__skinny_8c.html#a844a39ac2662cbc0d7eaa6122ac5ae71a48e1eb3a3d96993b9754643d9ec3c950">SKINNY_CODEC_H261</a>;
<a name="l01699"></a>01699    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a750506bc6e9117c66a5a6ad2dc82bc85">AST_FORMAT_H263</a>:
<a name="l01700"></a>01700       <span class="keywordflow">return</span> <a class="code" href="chan__skinny_8c.html#a844a39ac2662cbc0d7eaa6122ac5ae71a4d00a1ea7a1cdd28f6d452057c01f665">SKINNY_CODEC_H263</a>;
<a name="l01701"></a>01701    <span class="keywordflow">default</span>:
<a name="l01702"></a>01702       <span class="keywordflow">return</span> 0;
<a name="l01703"></a>01703    }
<a name="l01704"></a>01704 }
<a name="l01705"></a>01705 
<a name="l01706"></a><a class="code" href="chan__skinny_8c.html#ab04a8ea6a900e9b9327d8e896b61899b">01706</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#ab04a8ea6a900e9b9327d8e896b61899b">set_callforwards</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__line.html">skinny_line</a> *l, <span class="keyword">const</span> <span class="keywordtype">char</span> *cfwd, <span class="keywordtype">int</span> cfwdtype)
<a name="l01707"></a>01707 {
<a name="l01708"></a>01708    <span class="keywordflow">if</span> (!l)
<a name="l01709"></a>01709       <span class="keywordflow">return</span> 0;
<a name="l01710"></a>01710 
<a name="l01711"></a>01711    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(cfwd)) {
<a name="l01712"></a>01712       <span class="keywordflow">if</span> (cfwdtype &amp; <a class="code" href="chan__skinny_8c.html#a1a77767cd4cfc70d096da50a2fefecd7">SKINNY_CFWD_ALL</a>) {
<a name="l01713"></a>01713          l-&gt;cfwdtype |= SKINNY_CFWD_ALL;
<a name="l01714"></a>01714          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(l-&gt;call_forward_all, cfwd, <span class="keyword">sizeof</span>(l-&gt;call_forward_all));
<a name="l01715"></a>01715       }
<a name="l01716"></a>01716       <span class="keywordflow">if</span> (cfwdtype &amp; <a class="code" href="chan__skinny_8c.html#a6cd59fd0c6c79219d38f437a485ce844">SKINNY_CFWD_BUSY</a>) {
<a name="l01717"></a>01717          l-&gt;cfwdtype |= SKINNY_CFWD_BUSY;
<a name="l01718"></a>01718          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(l-&gt;call_forward_busy, cfwd, <span class="keyword">sizeof</span>(l-&gt;call_forward_busy));
<a name="l01719"></a>01719       }
<a name="l01720"></a>01720       <span class="keywordflow">if</span> (cfwdtype &amp; <a class="code" href="chan__skinny_8c.html#a805d890f6df0e6cf5d9f281791d2a318">SKINNY_CFWD_NOANSWER</a>) {
<a name="l01721"></a>01721          l-&gt;cfwdtype |= SKINNY_CFWD_NOANSWER;
<a name="l01722"></a>01722          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(l-&gt;call_forward_noanswer, cfwd, <span class="keyword">sizeof</span>(l-&gt;call_forward_noanswer));
<a name="l01723"></a>01723       }
<a name="l01724"></a>01724    } <span class="keywordflow">else</span> {
<a name="l01725"></a>01725       <span class="keywordflow">if</span> (cfwdtype &amp; <a class="code" href="chan__skinny_8c.html#a1a77767cd4cfc70d096da50a2fefecd7">SKINNY_CFWD_ALL</a>) {
<a name="l01726"></a>01726          l-&gt;cfwdtype &amp;= ~SKINNY_CFWD_ALL;
<a name="l01727"></a>01727          memset(l-&gt;call_forward_all, 0, <span class="keyword">sizeof</span>(l-&gt;call_forward_all));
<a name="l01728"></a>01728       }
<a name="l01729"></a>01729       <span class="keywordflow">if</span> (cfwdtype &amp; <a class="code" href="chan__skinny_8c.html#a6cd59fd0c6c79219d38f437a485ce844">SKINNY_CFWD_BUSY</a>) {
<a name="l01730"></a>01730          l-&gt;cfwdtype &amp;= ~SKINNY_CFWD_BUSY;
<a name="l01731"></a>01731          memset(l-&gt;call_forward_busy, 0, <span class="keyword">sizeof</span>(l-&gt;call_forward_busy));
<a name="l01732"></a>01732       }
<a name="l01733"></a>01733       <span class="keywordflow">if</span> (cfwdtype &amp; <a class="code" href="chan__skinny_8c.html#a805d890f6df0e6cf5d9f281791d2a318">SKINNY_CFWD_NOANSWER</a>) {
<a name="l01734"></a>01734          l-&gt;cfwdtype &amp;= ~SKINNY_CFWD_NOANSWER;
<a name="l01735"></a>01735          memset(l-&gt;call_forward_noanswer, 0, <span class="keyword">sizeof</span>(l-&gt;call_forward_noanswer));
<a name="l01736"></a>01736       }
<a name="l01737"></a>01737    }
<a name="l01738"></a>01738    <span class="keywordflow">return</span> l-&gt;cfwdtype;
<a name="l01739"></a>01739 }
<a name="l01740"></a>01740 
<a name="l01741"></a><a class="code" href="chan__skinny_8c.html#aa1ca2cdc74f2438ac4aa7e1f9200518a">01741</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__skinny_8c.html#aa1ca2cdc74f2438ac4aa7e1f9200518a">cleanup_stale_contexts</a>(<span class="keywordtype">char</span> *<span class="keyword">new</span>, <span class="keywordtype">char</span> *old)
<a name="l01742"></a>01742 {
<a name="l01743"></a>01743    <span class="keywordtype">char</span> *oldcontext, *newcontext, *stalecontext, *stringp, newlist[<a class="code" href="channel_8h.html#abcf1aea85b924e9cd605040b86241e2a">AST_MAX_CONTEXT</a>];
<a name="l01744"></a>01744 
<a name="l01745"></a>01745    <span class="keywordflow">while</span> ((oldcontext = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;old, <span class="stringliteral">&quot;&amp;&quot;</span>))) {
<a name="l01746"></a>01746       stalecontext = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01747"></a>01747       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(newlist, <span class="keyword">new</span>, <span class="keyword">sizeof</span>(newlist));
<a name="l01748"></a>01748       stringp = newlist;
<a name="l01749"></a>01749       <span class="keywordflow">while</span> ((newcontext = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;stringp, <span class="stringliteral">&quot;&amp;&quot;</span>))) {
<a name="l01750"></a>01750          <span class="keywordflow">if</span> (strcmp(newcontext, oldcontext) == 0) {
<a name="l01751"></a>01751             <span class="comment">/* This is not the context you&apos;re looking for */</span>
<a name="l01752"></a>01752             stalecontext = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01753"></a>01753             <span class="keywordflow">break</span>;
<a name="l01754"></a>01754          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(newcontext, oldcontext)) {
<a name="l01755"></a>01755             stalecontext = oldcontext;
<a name="l01756"></a>01756          }
<a name="l01757"></a>01757          
<a name="l01758"></a>01758       }
<a name="l01759"></a>01759       <span class="keywordflow">if</span> (stalecontext)
<a name="l01760"></a>01760          <a class="code" href="pbx_8h.html#a9546b830c22c693a2baed08e48569401" title="Destroy a context (matches the specified context (or ANY context if NULL).">ast_context_destroy</a>(<a class="code" href="pbx_8h.html#a2af2d2771e5347b18454a05dbc98e35f" title="Find a context.">ast_context_find</a>(stalecontext), <span class="stringliteral">&quot;Skinny&quot;</span>);
<a name="l01761"></a>01761    }
<a name="l01762"></a>01762 }
<a name="l01763"></a>01763 
<a name="l01764"></a><a class="code" href="chan__skinny_8c.html#ab740e9adfd62344315e02e25c0ff13af">01764</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__skinny_8c.html#ab740e9adfd62344315e02e25c0ff13af">register_exten</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__line.html">skinny_line</a> *l)
<a name="l01765"></a>01765 {
<a name="l01766"></a>01766    <span class="keywordtype">char</span> multi[256];
<a name="l01767"></a>01767    <span class="keywordtype">char</span> *stringp, *<a class="code" href="http_8c.html#af9b32121c4ad80b0887a3d73fd24de5f">ext</a>, *<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>;
<a name="l01768"></a>01768 
<a name="l01769"></a>01769    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(regcontext))
<a name="l01770"></a>01770       <span class="keywordflow">return</span>;
<a name="l01771"></a>01771 
<a name="l01772"></a>01772    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(multi, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(l-&gt;regexten, l-&gt;name), <span class="keyword">sizeof</span>(multi));
<a name="l01773"></a>01773    stringp = multi;
<a name="l01774"></a>01774    <span class="keywordflow">while</span> ((ext = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;stringp, <span class="stringliteral">&quot;&amp;&quot;</span>))) {
<a name="l01775"></a>01775       <span class="keywordflow">if</span> ((context = strchr(ext, <span class="charliteral">&apos;@&apos;</span>))) {
<a name="l01776"></a>01776          *context++ = <span class="charliteral">&apos;\0&apos;</span>; <span class="comment">/* split ext@context */</span>
<a name="l01777"></a>01777          <span class="keywordflow">if</span> (!<a class="code" href="pbx_8h.html#a2af2d2771e5347b18454a05dbc98e35f" title="Find a context.">ast_context_find</a>(context)) {
<a name="l01778"></a>01778             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Context %s must exist in regcontext= in skinny.conf!\n&quot;</span>, context);
<a name="l01779"></a>01779             <span class="keywordflow">continue</span>;
<a name="l01780"></a>01780          }
<a name="l01781"></a>01781       } <span class="keywordflow">else</span> {
<a name="l01782"></a>01782          context = regcontext;
<a name="l01783"></a>01783       }
<a name="l01784"></a>01784       <a class="code" href="pbx_8h.html#a07176e8d314eb68b3b50279fafa11390" title="Add and extension to an extension context.">ast_add_extension</a>(context, 1, ext, 1, NULL, NULL, <span class="stringliteral">&quot;Noop&quot;</span>,
<a name="l01785"></a>01785           <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(l-&gt;name), <a class="code" href="utils_8h.html#a4e6aceb50eca868b7c38064c6c1a4789" title="free() wrapper">ast_free_ptr</a>, <span class="stringliteral">&quot;Skinny&quot;</span>);
<a name="l01786"></a>01786    }
<a name="l01787"></a>01787 }
<a name="l01788"></a>01788 
<a name="l01789"></a><a class="code" href="chan__skinny_8c.html#ae456c964b75f4dff4d73df78f39db454">01789</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__skinny_8c.html#ae456c964b75f4dff4d73df78f39db454">unregister_exten</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__line.html">skinny_line</a> *l)
<a name="l01790"></a>01790 {
<a name="l01791"></a>01791    <span class="keywordtype">char</span> multi[256];
<a name="l01792"></a>01792    <span class="keywordtype">char</span> *stringp, *<a class="code" href="http_8c.html#af9b32121c4ad80b0887a3d73fd24de5f">ext</a>, *<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>;
<a name="l01793"></a>01793 
<a name="l01794"></a>01794    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(regcontext))
<a name="l01795"></a>01795       <span class="keywordflow">return</span>;
<a name="l01796"></a>01796 
<a name="l01797"></a>01797    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(multi, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(l-&gt;regexten, l-&gt;name), <span class="keyword">sizeof</span>(multi));
<a name="l01798"></a>01798    stringp = multi;
<a name="l01799"></a>01799    <span class="keywordflow">while</span> ((ext = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;stringp, <span class="stringliteral">&quot;&amp;&quot;</span>))) {
<a name="l01800"></a>01800       <span class="keywordflow">if</span> ((context = strchr(ext, <span class="charliteral">&apos;@&apos;</span>))) {
<a name="l01801"></a>01801          *context++ = <span class="charliteral">&apos;\0&apos;</span>; <span class="comment">/* split ext@context */</span>
<a name="l01802"></a>01802          <span class="keywordflow">if</span> (!<a class="code" href="pbx_8h.html#a2af2d2771e5347b18454a05dbc98e35f" title="Find a context.">ast_context_find</a>(context)) {
<a name="l01803"></a>01803             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Context %s must exist in regcontext= in skinny.conf!\n&quot;</span>, context);
<a name="l01804"></a>01804             <span class="keywordflow">continue</span>;
<a name="l01805"></a>01805          }
<a name="l01806"></a>01806       } <span class="keywordflow">else</span> {
<a name="l01807"></a>01807          context = regcontext;
<a name="l01808"></a>01808       }
<a name="l01809"></a>01809       <a class="code" href="pbx_8h.html#a721c6ba091102f155a586e09b2a526bf" title="Simply remove extension from context.">ast_context_remove_extension</a>(context, ext, 1, NULL);
<a name="l01810"></a>01810    }
<a name="l01811"></a>01811 }
<a name="l01812"></a>01812 
<a name="l01813"></a><a class="code" href="chan__skinny_8c.html#a3fe6385caa677e3d51eb12df891b0d4e">01813</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a3fe6385caa677e3d51eb12df891b0d4e">skinny_register</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__req.html">skinny_req</a> *req, <span class="keyword">struct</span> <a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l01814"></a>01814 {
<a name="l01815"></a>01815    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d;
<a name="l01816"></a>01816    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l;
<a name="l01817"></a>01817    <span class="keyword">struct </span><a class="code" href="structskinny__speeddial.html">skinny_speeddial</a> *sd;
<a name="l01818"></a>01818    <span class="keyword">struct </span>sockaddr_in sin;
<a name="l01819"></a>01819    socklen_t slen;
<a name="l01820"></a>01820    <span class="keywordtype">int</span> instance;
<a name="l01821"></a>01821 
<a name="l01822"></a>01822    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>);
<a name="l01823"></a>01823    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>, d, list){
<a name="l01824"></a>01824       <span class="keywordflow">if</span> (!strcasecmp(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aceb9d5d9b0983f8fb0e5523310274dc4">reg</a>.<a class="code" href="structregister__message.html#acd328517a6cf718155c2e6e22b671ca9">name</a>, d-&gt;id)
<a name="l01825"></a>01825             &amp;&amp; <a class="code" href="acl_8h.html#aac0540803fb28e105697e917bd0f252b" title="Check IP address with host access list.">ast_apply_ha</a>(d-&gt;<a class="code" href="structskinny__device.html#a6c6c2b6adbe74acc944bc0c55b16c8f4">ha</a>, &amp;(s-&gt;<a class="code" href="structskinnysession.html#ac7cbd331d33fcd5a6f81a257975e4cd5">sin</a>))) {
<a name="l01826"></a>01826          s-&gt;<a class="code" href="structskinnysession.html#a70701ca9c2641bcb1740286273a0473a">device</a> = d;
<a name="l01827"></a>01827          d-&gt;type = <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aceb9d5d9b0983f8fb0e5523310274dc4">reg</a>.<a class="code" href="structregister__message.html#ad44b615021ed3ccb734fcaf583ef4a03">type</a>);
<a name="l01828"></a>01828          <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(d-&gt;version_id)) {
<a name="l01829"></a>01829             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(d-&gt;version_id, version_id, <span class="keyword">sizeof</span>(d-&gt;version_id));
<a name="l01830"></a>01830          }
<a name="l01831"></a>01831          d-&gt;registered = 1;
<a name="l01832"></a>01832          d-&gt;<a class="code" href="structskinny__device.html#a730a1864781691273d9f28b5ad1dadfd">session</a> = s;
<a name="l01833"></a>01833 
<a name="l01834"></a>01834          slen = <span class="keyword">sizeof</span>(sin);
<a name="l01835"></a>01835          <span class="keywordflow">if</span> (getsockname(s-&gt;<a class="code" href="structskinnysession.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, (<span class="keyword">struct</span> sockaddr *)&amp;sin, &amp;slen)) {
<a name="l01836"></a>01836             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot get socket name\n&quot;</span>);
<a name="l01837"></a>01837             sin.sin_addr = <a class="code" href="chan__skinny_8c.html#a1d084b82cb21102ba46ea60d3cd9c085">__ourip</a>;
<a name="l01838"></a>01838          }
<a name="l01839"></a>01839          d-&gt;<a class="code" href="structskinny__device.html#aff045cc68524670d4355f882c7ac6271">ourip</a> = sin.sin_addr;
<a name="l01840"></a>01840 
<a name="l01841"></a>01841          <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;speeddials, sd, list) {
<a name="l01842"></a>01842             sd-&gt;<a class="code" href="structskinny__speeddial.html#a70382561daaa758a201b7a711d566e24">stateid</a> = <a class="code" href="pbx_8h.html#aa3a30d0a841ee2bc0d87af763a99629f" title="Registers a state change callback.">ast_extension_state_add</a>(sd-&gt;<a class="code" href="structskinny__speeddial.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, sd-&gt;<a class="code" href="structskinny__speeddial.html#a78d4847658b695383d849efd12399b38">exten</a>, <a class="code" href="chan__skinny_8c.html#abe88d7d15a546c75f3bd8f13a6f15fe8">skinny_extensionstate_cb</a>, sd);
<a name="l01843"></a>01843          }
<a name="l01844"></a>01844          instance = 0;
<a name="l01845"></a>01845          <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;lines, l, list) {
<a name="l01846"></a>01846             instance++;
<a name="l01847"></a>01847          }
<a name="l01848"></a>01848          <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;lines, l, list) {
<a name="l01849"></a>01849             <span class="comment">/* FIXME: All sorts of issues will occur if this line is already connected to a device */</span>
<a name="l01850"></a>01850             <span class="keywordflow">if</span> (l-&gt;device) {
<a name="l01851"></a>01851                <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Line %s already connected to %s. Not connecting to %s.\n&quot;</span>, l-&gt;name, l-&gt;device-&gt;name, d-&gt;name);
<a name="l01852"></a>01852             } <span class="keywordflow">else</span> {
<a name="l01853"></a>01853                l-&gt;device = d;
<a name="l01854"></a>01854                l-&gt;capability = l-&gt;confcapability &amp; d-&gt;capability;
<a name="l01855"></a>01855                l-&gt;prefs = l-&gt;confprefs;
<a name="l01856"></a>01856                <span class="keywordflow">if</span> (!l-&gt;prefs.order[0]) {
<a name="l01857"></a>01857                   l-&gt;prefs = d-&gt;confprefs;
<a name="l01858"></a>01858                }
<a name="l01859"></a>01859                <span class="comment">/* l-&gt;capability = d-&gt;capability;</span>
<a name="l01860"></a>01860 <span class="comment">               l-&gt;prefs = d-&gt;prefs; */</span>
<a name="l01861"></a>01861                l-&gt;instance = instance;
<a name="l01862"></a>01862                l-&gt;newmsgs = <a class="code" href="app_8h.html#ae5953304e56862ac7efc1fed0ac6732f" title="Determine if a given mailbox has any voicemail If folder is NULL, defaults to &amp;quot;INBOX&amp;quot;...">ast_app_has_voicemail</a>(l-&gt;mailbox, NULL);
<a name="l01863"></a>01863                <a class="code" href="chan__skinny_8c.html#ab04a8ea6a900e9b9327d8e896b61899b">set_callforwards</a>(l, NULL, 0);
<a name="l01864"></a>01864                <a class="code" href="chan__skinny_8c.html#ab740e9adfd62344315e02e25c0ff13af">register_exten</a>(l);
<a name="l01865"></a>01865                <span class="comment">/* initialize MWI on line and device */</span>
<a name="l01866"></a>01866                <a class="code" href="chan__skinny_8c.html#a46e4523f99409c6696dc775ed6a5e5ed">mwi_event_cb</a>(0, l);
<a name="l01867"></a>01867                <a class="code" href="devicestate_8h.html#ac91fd8b93a2095c18ab86bd61c19ae46" title="Tells Asterisk the State for Device is changed.">ast_devstate_changed</a>(<a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeadee91fc4886ffc7b4efb8459cef48fe2">AST_DEVICE_NOT_INUSE</a>, <span class="stringliteral">&quot;Skinny/%s@%s&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l01868"></a>01868             }
<a name="l01869"></a>01869             --instance;
<a name="l01870"></a>01870          }
<a name="l01871"></a>01871          <span class="keywordflow">break</span>;
<a name="l01872"></a>01872       }
<a name="l01873"></a>01873    }
<a name="l01874"></a>01874    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>);
<a name="l01875"></a>01875    <span class="keywordflow">if</span> (!d) {
<a name="l01876"></a>01876       <span class="keywordflow">return</span> 0;
<a name="l01877"></a>01877    }
<a name="l01878"></a>01878    <span class="keywordflow">return</span> 1;
<a name="l01879"></a>01879 }
<a name="l01880"></a>01880 
<a name="l01881"></a><a class="code" href="chan__skinny_8c.html#aac25ed22beafaebfee5acb276c2e0d28">01881</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#aac25ed22beafaebfee5acb276c2e0d28">skinny_unregister</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__req.html">skinny_req</a> *req, <span class="keyword">struct</span> <a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l01882"></a>01882 {
<a name="l01883"></a>01883    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d;
<a name="l01884"></a>01884    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l;
<a name="l01885"></a>01885    <span class="keyword">struct </span><a class="code" href="structskinny__speeddial.html">skinny_speeddial</a> *sd;
<a name="l01886"></a>01886 
<a name="l01887"></a>01887    d = s-&gt;<a class="code" href="structskinnysession.html#a70701ca9c2641bcb1740286273a0473a">device</a>;
<a name="l01888"></a>01888 
<a name="l01889"></a>01889    <span class="keywordflow">if</span> (d) {
<a name="l01890"></a>01890       d-&gt;<a class="code" href="structskinny__device.html#a730a1864781691273d9f28b5ad1dadfd">session</a> = NULL;
<a name="l01891"></a>01891       d-&gt;registered = 0;
<a name="l01892"></a>01892 
<a name="l01893"></a>01893       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;speeddials, sd, list) {
<a name="l01894"></a>01894          <span class="keywordflow">if</span> (sd-&gt;<a class="code" href="structskinny__speeddial.html#a70382561daaa758a201b7a711d566e24">stateid</a> &gt; -1)
<a name="l01895"></a>01895             <a class="code" href="pbx_8h.html#a6740b689b39aa1503d1b858daf730873" title="Deletes a registered state change callback by ID.">ast_extension_state_del</a>(sd-&gt;<a class="code" href="structskinny__speeddial.html#a70382561daaa758a201b7a711d566e24">stateid</a>, NULL);
<a name="l01896"></a>01896       }
<a name="l01897"></a>01897       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;lines, l, list) {
<a name="l01898"></a>01898          <span class="keywordflow">if</span> (l-&gt;device == d) {
<a name="l01899"></a>01899             l-&gt;device = NULL;
<a name="l01900"></a>01900             l-&gt;capability = 0;
<a name="l01901"></a>01901             <a class="code" href="frame_8h.html#a35aa1fb72e1993a14156a6b912034ef9" title="Parse an &amp;quot;allow&amp;quot; or &amp;quot;deny&amp;quot; line in a channel or device configuration...">ast_parse_allow_disallow</a>(&amp;l-&gt;prefs, &amp;l-&gt;capability, <span class="stringliteral">&quot;all&quot;</span>, 0);       
<a name="l01902"></a>01902             l-&gt;instance = 0;
<a name="l01903"></a>01903             <a class="code" href="chan__skinny_8c.html#ae456c964b75f4dff4d73df78f39db454">unregister_exten</a>(l);
<a name="l01904"></a>01904             <a class="code" href="devicestate_8h.html#ac91fd8b93a2095c18ab86bd61c19ae46" title="Tells Asterisk the State for Device is changed.">ast_devstate_changed</a>(<a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeafac147cbabf3ccb80e50e86027710549">AST_DEVICE_UNAVAILABLE</a>, <span class="stringliteral">&quot;Skinny/%s@%s&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l01905"></a>01905          }
<a name="l01906"></a>01906       }
<a name="l01907"></a>01907    }
<a name="l01908"></a>01908 
<a name="l01909"></a>01909    <span class="keywordflow">return</span> -1; <span class="comment">/* main loop will destroy the session */</span>
<a name="l01910"></a>01910 }
<a name="l01911"></a>01911 
<a name="l01912"></a>01912 <span class="preprocessor">#ifdef SKINNY_DEVMODE</span>
<a name="l01913"></a>01913 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">char</span> *message2str(<span class="keywordtype">int</span> type)
<a name="l01914"></a>01914 {
<a name="l01915"></a>01915    <span class="keywordtype">char</span> *tmp;
<a name="l01916"></a>01916 
<a name="l01917"></a>01917    <span class="keywordflow">switch</span> (type) {
<a name="l01918"></a>01918    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a9e35a268fd7c3a1b2cb28c295c816160">KEEP_ALIVE_MESSAGE</a>:
<a name="l01919"></a>01919       <span class="keywordflow">return</span> <span class="stringliteral">&quot;KEEP_ALIVE_MESSAGE&quot;</span>;
<a name="l01920"></a>01920    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#aec789812d6cc0ff846fb308745e91531">REGISTER_MESSAGE</a>:
<a name="l01921"></a>01921       <span class="keywordflow">return</span> <span class="stringliteral">&quot;REGISTER_MESSAGE&quot;</span>;
<a name="l01922"></a>01922    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#aa1b2b6b1bab1095ef0753afc2582d29d">IP_PORT_MESSAGE</a>:
<a name="l01923"></a>01923       <span class="keywordflow">return</span> <span class="stringliteral">&quot;IP_PORT_MESSAGE&quot;</span>;
<a name="l01924"></a>01924    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a1d5b89af9a01395da0daefcbcc8fd8bb">KEYPAD_BUTTON_MESSAGE</a>:
<a name="l01925"></a>01925       <span class="keywordflow">return</span> <span class="stringliteral">&quot;KEYPAD_BUTTON_MESSAGE&quot;</span>;
<a name="l01926"></a>01926    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a67e29aa17c48ffce8b07634ac656c172">ENBLOC_CALL_MESSAGE</a>:
<a name="l01927"></a>01927       <span class="keywordflow">return</span> <span class="stringliteral">&quot;ENBLOC_CALL_MESSAGE&quot;</span>;
<a name="l01928"></a>01928    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a8caf5d84aafa52ecdd3a86a08620850c">STIMULUS_MESSAGE</a>:
<a name="l01929"></a>01929       <span class="keywordflow">return</span> <span class="stringliteral">&quot;STIMULUS_MESSAGE&quot;</span>;
<a name="l01930"></a>01930    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a258aee0512dcbdce20a4ec7c9174efec">OFFHOOK_MESSAGE</a>:
<a name="l01931"></a>01931       <span class="keywordflow">return</span> <span class="stringliteral">&quot;OFFHOOK_MESSAGE&quot;</span>;
<a name="l01932"></a>01932    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a195491206014b7ee4a2950b8af3c8a82">ONHOOK_MESSAGE</a>:
<a name="l01933"></a>01933       <span class="keywordflow">return</span> <span class="stringliteral">&quot;ONHOOK_MESSAGE&quot;</span>;
<a name="l01934"></a>01934    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#aff32b9bb805415bcfea5b23ebb62b661">CAPABILITIES_RES_MESSAGE</a>:
<a name="l01935"></a>01935       <span class="keywordflow">return</span> <span class="stringliteral">&quot;CAPABILITIES_RES_MESSAGE&quot;</span>;
<a name="l01936"></a>01936    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a79d95555682062db176dfd2a5e9c0752">SPEED_DIAL_STAT_REQ_MESSAGE</a>:
<a name="l01937"></a>01937       <span class="keywordflow">return</span> <span class="stringliteral">&quot;SPEED_DIAL_STAT_REQ_MESSAGE&quot;</span>;
<a name="l01938"></a>01938    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a610dfde5df1301f6c347b10415678e0f">LINE_STATE_REQ_MESSAGE</a>:
<a name="l01939"></a>01939       <span class="keywordflow">return</span> <span class="stringliteral">&quot;LINE_STATE_REQ_MESSAGE&quot;</span>;
<a name="l01940"></a>01940    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#ad0232ebceef396ab30795eb9348d7cac">TIME_DATE_REQ_MESSAGE</a>:
<a name="l01941"></a>01941       <span class="keywordflow">return</span> <span class="stringliteral">&quot;TIME_DATE_REQ_MESSAGE&quot;</span>;
<a name="l01942"></a>01942    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a2eafa2761d0f30c216c041a97cad9c30">BUTTON_TEMPLATE_REQ_MESSAGE</a>:
<a name="l01943"></a>01943       <span class="keywordflow">return</span> <span class="stringliteral">&quot;BUTTON_TEMPLATE_REQ_MESSAGE&quot;</span>;
<a name="l01944"></a>01944    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#ad4deebb4a9be4ed5eaf37f0ddb7ea361">VERSION_REQ_MESSAGE</a>:
<a name="l01945"></a>01945       <span class="keywordflow">return</span> <span class="stringliteral">&quot;VERSION_REQ_MESSAGE&quot;</span>;
<a name="l01946"></a>01946    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a36c56f4d73172d09aaf26225c2446963">SERVER_REQUEST_MESSAGE</a>:
<a name="l01947"></a>01947       <span class="keywordflow">return</span> <span class="stringliteral">&quot;SERVER_REQUEST_MESSAGE&quot;</span>;
<a name="l01948"></a>01948    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#ae2a02a450e18eeb46029c20efadd4ab3">ALARM_MESSAGE</a>:
<a name="l01949"></a>01949       <span class="keywordflow">return</span> <span class="stringliteral">&quot;ALARM_MESSAGE&quot;</span>;
<a name="l01950"></a>01950    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a95a2cd4add7896f4feabe8dc6b0744b6">OPEN_RECEIVE_CHANNEL_ACK_MESSAGE</a>:
<a name="l01951"></a>01951       <span class="keywordflow">return</span> <span class="stringliteral">&quot;OPEN_RECEIVE_CHANNEL_ACK_MESSAGE&quot;</span>;
<a name="l01952"></a>01952    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a95a0727067965ab3ce6652eefaee5afc">SOFT_KEY_SET_REQ_MESSAGE</a>:
<a name="l01953"></a>01953       <span class="keywordflow">return</span> <span class="stringliteral">&quot;SOFT_KEY_SET_REQ_MESSAGE&quot;</span>;
<a name="l01954"></a>01954    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a8fdb22d136247b1f7980bbaf1ed2b7ce">SOFT_KEY_EVENT_MESSAGE</a>:
<a name="l01955"></a>01955       <span class="keywordflow">return</span> <span class="stringliteral">&quot;SOFT_KEY_EVENT_MESSAGE&quot;</span>;
<a name="l01956"></a>01956    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a33d2f7a83eef8e9bd1b39f8e38c150f7">UNREGISTER_MESSAGE</a>:
<a name="l01957"></a>01957       <span class="keywordflow">return</span> <span class="stringliteral">&quot;UNREGISTER_MESSAGE&quot;</span>;
<a name="l01958"></a>01958    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#aaa8ae193940da9236d260041a3a8a5c4">SOFT_KEY_TEMPLATE_REQ_MESSAGE</a>:
<a name="l01959"></a>01959       <span class="keywordflow">return</span> <span class="stringliteral">&quot;SOFT_KEY_TEMPLATE_REQ_MESSAGE&quot;</span>;
<a name="l01960"></a>01960    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a9f3bcf87db314d362bb2ca29ed73c71c">HEADSET_STATUS_MESSAGE</a>:
<a name="l01961"></a>01961       <span class="keywordflow">return</span> <span class="stringliteral">&quot;HEADSET_STATUS_MESSAGE&quot;</span>;
<a name="l01962"></a>01962    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#acffbaca19a4702b6ae9284d1902b67f9">REGISTER_AVAILABLE_LINES_MESSAGE</a>:
<a name="l01963"></a>01963       <span class="keywordflow">return</span> <span class="stringliteral">&quot;REGISTER_AVAILABLE_LINES_MESSAGE&quot;</span>;
<a name="l01964"></a>01964    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a3fb821358598b476576f3b098586498f">REGISTER_ACK_MESSAGE</a>:
<a name="l01965"></a>01965       <span class="keywordflow">return</span> <span class="stringliteral">&quot;REGISTER_ACK_MESSAGE&quot;</span>;
<a name="l01966"></a>01966    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#ad2488ba493987c5230f95cb86958dc76">START_TONE_MESSAGE</a>:
<a name="l01967"></a>01967       <span class="keywordflow">return</span> <span class="stringliteral">&quot;START_TONE_MESSAGE&quot;</span>;
<a name="l01968"></a>01968    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a6c341d198f3726cac8d9e26d4fdb8c58">STOP_TONE_MESSAGE</a>:
<a name="l01969"></a>01969       <span class="keywordflow">return</span> <span class="stringliteral">&quot;STOP_TONE_MESSAGE&quot;</span>;
<a name="l01970"></a>01970    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#ae7bbfbe01b4deecb01153f047d12497b">SET_RINGER_MESSAGE</a>:
<a name="l01971"></a>01971       <span class="keywordflow">return</span> <span class="stringliteral">&quot;SET_RINGER_MESSAGE&quot;</span>;
<a name="l01972"></a>01972    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a1ea4574da323c63a872fffd8f134f1af">SET_LAMP_MESSAGE</a>:
<a name="l01973"></a>01973       <span class="keywordflow">return</span> <span class="stringliteral">&quot;SET_LAMP_MESSAGE&quot;</span>;
<a name="l01974"></a>01974    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#ace96029ade576fdaa306b409a2639890">SET_SPEAKER_MESSAGE</a>:
<a name="l01975"></a>01975       <span class="keywordflow">return</span> <span class="stringliteral">&quot;SET_SPEAKER_MESSAGE&quot;</span>;
<a name="l01976"></a>01976    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#aa1669b84b2c634fca96d1e74efe28f21">SET_MICROPHONE_MESSAGE</a>:
<a name="l01977"></a>01977       <span class="keywordflow">return</span> <span class="stringliteral">&quot;SET_MICROPHONE_MESSAGE&quot;</span>;
<a name="l01978"></a>01978    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#aa8c4fd39788d87301b7b97543537a12c">START_MEDIA_TRANSMISSION_MESSAGE</a>:
<a name="l01979"></a>01979       <span class="keywordflow">return</span> <span class="stringliteral">&quot;START_MEDIA_TRANSMISSION_MESSAGE&quot;</span>;
<a name="l01980"></a>01980    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#acb883512e3f609a62dde13c5d5cb4879">STOP_MEDIA_TRANSMISSION_MESSAGE</a>:
<a name="l01981"></a>01981       <span class="keywordflow">return</span> <span class="stringliteral">&quot;STOP_MEDIA_TRANSMISSION_MESSAGE&quot;</span>;
<a name="l01982"></a>01982    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a7fb2c263aa8febc00c4da70f073ca9b7">CALL_INFO_MESSAGE</a>:
<a name="l01983"></a>01983       <span class="keywordflow">return</span> <span class="stringliteral">&quot;CALL_INFO_MESSAGE&quot;</span>;
<a name="l01984"></a>01984    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a3fde9ebcac20096752caa92845e4862a">FORWARD_STAT_MESSAGE</a>:
<a name="l01985"></a>01985       <span class="keywordflow">return</span> <span class="stringliteral">&quot;FORWARD_STAT_MESSAGE&quot;</span>;
<a name="l01986"></a>01986    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a552f2cd0b0e5021c1a1d60d7e79e5488">SPEED_DIAL_STAT_RES_MESSAGE</a>:
<a name="l01987"></a>01987       <span class="keywordflow">return</span> <span class="stringliteral">&quot;SPEED_DIAL_STAT_RES_MESSAGE&quot;</span>;
<a name="l01988"></a>01988    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a2181f1d209288ce7edad5fc7bc07a9c1">LINE_STAT_RES_MESSAGE</a>:
<a name="l01989"></a>01989       <span class="keywordflow">return</span> <span class="stringliteral">&quot;LINE_STAT_RES_MESSAGE&quot;</span>;
<a name="l01990"></a>01990    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a05d20dbd5d289408e887b7c267ec3eea">DEFINETIMEDATE_MESSAGE</a>:
<a name="l01991"></a>01991       <span class="keywordflow">return</span> <span class="stringliteral">&quot;DEFINETIMEDATE_MESSAGE&quot;</span>;
<a name="l01992"></a>01992    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#aa0698f06ea990283d266b4fad44a49c1">BUTTON_TEMPLATE_RES_MESSAGE</a>:
<a name="l01993"></a>01993       <span class="keywordflow">return</span> <span class="stringliteral">&quot;BUTTON_TEMPLATE_RES_MESSAGE&quot;</span>;
<a name="l01994"></a>01994    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a12901431f5ab5e4cb9df9edc664e6d85">VERSION_RES_MESSAGE</a>:
<a name="l01995"></a>01995       <span class="keywordflow">return</span> <span class="stringliteral">&quot;VERSION_RES_MESSAGE&quot;</span>;
<a name="l01996"></a>01996    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#aaf7fd74b57aa572a32636909926de80b">DISPLAYTEXT_MESSAGE</a>:
<a name="l01997"></a>01997       <span class="keywordflow">return</span> <span class="stringliteral">&quot;DISPLAYTEXT_MESSAGE&quot;</span>;
<a name="l01998"></a>01998    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a75bd8c2deb5ab3092e1c1a3bb59b1996">CLEAR_NOTIFY_MESSAGE</a>:
<a name="l01999"></a>01999       <span class="keywordflow">return</span> <span class="stringliteral">&quot;CLEAR_NOTIFY_MESSAGE&quot;</span>;
<a name="l02000"></a>02000    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#ad3ef1afdcb3cc2dc465820495d6a3826">CLEAR_DISPLAY_MESSAGE</a>:
<a name="l02001"></a>02001       <span class="keywordflow">return</span> <span class="stringliteral">&quot;CLEAR_DISPLAY_MESSAGE&quot;</span>;
<a name="l02002"></a>02002    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#adb5145c2019b8a1d29b20b7b482f8f17">CAPABILITIES_REQ_MESSAGE</a>:
<a name="l02003"></a>02003       <span class="keywordflow">return</span> <span class="stringliteral">&quot;CAPABILITIES_REQ_MESSAGE&quot;</span>;
<a name="l02004"></a>02004    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a8a678ba2da3542aefebf876d6849ad6a">REGISTER_REJ_MESSAGE</a>:
<a name="l02005"></a>02005       <span class="keywordflow">return</span> <span class="stringliteral">&quot;REGISTER_REJ_MESSAGE&quot;</span>;
<a name="l02006"></a>02006    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#acfb45c382a52256b57620a7340c20a69">SERVER_RES_MESSAGE</a>:
<a name="l02007"></a>02007       <span class="keywordflow">return</span> <span class="stringliteral">&quot;SERVER_RES_MESSAGE&quot;</span>;
<a name="l02008"></a>02008    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#afb6f653351a09b4b3bbbb0fbd3ba4f1e">RESET_MESSAGE</a>:
<a name="l02009"></a>02009       <span class="keywordflow">return</span> <span class="stringliteral">&quot;RESET_MESSAGE&quot;</span>;
<a name="l02010"></a>02010    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#abc0af116eb82cd2fef2601d565c64ecc">KEEP_ALIVE_ACK_MESSAGE</a>:
<a name="l02011"></a>02011       <span class="keywordflow">return</span> <span class="stringliteral">&quot;KEEP_ALIVE_ACK_MESSAGE&quot;</span>;
<a name="l02012"></a>02012    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a88a234a4bca9e3085c77555b00774758">OPEN_RECEIVE_CHANNEL_MESSAGE</a>:
<a name="l02013"></a>02013       <span class="keywordflow">return</span> <span class="stringliteral">&quot;OPEN_RECEIVE_CHANNEL_MESSAGE&quot;</span>;
<a name="l02014"></a>02014    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a60c800146db7344c89b2941999f236d4">CLOSE_RECEIVE_CHANNEL_MESSAGE</a>:
<a name="l02015"></a>02015       <span class="keywordflow">return</span> <span class="stringliteral">&quot;CLOSE_RECEIVE_CHANNEL_MESSAGE&quot;</span>;
<a name="l02016"></a>02016    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#aa48c2edb2669fe7c10ed6b6b5efa2e05">SOFT_KEY_TEMPLATE_RES_MESSAGE</a>:
<a name="l02017"></a>02017       <span class="keywordflow">return</span> <span class="stringliteral">&quot;SOFT_KEY_TEMPLATE_RES_MESSAGE&quot;</span>;
<a name="l02018"></a>02018    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#aee3cbe69978806b2ccea81e6931e5f06">SOFT_KEY_SET_RES_MESSAGE</a>:
<a name="l02019"></a>02019       <span class="keywordflow">return</span> <span class="stringliteral">&quot;SOFT_KEY_SET_RES_MESSAGE&quot;</span>;
<a name="l02020"></a>02020    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#acf9ff0dcbbb7c545417a22affaddc03a">SELECT_SOFT_KEYS_MESSAGE</a>:
<a name="l02021"></a>02021       <span class="keywordflow">return</span> <span class="stringliteral">&quot;SELECT_SOFT_KEYS_MESSAGE&quot;</span>;
<a name="l02022"></a>02022    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a2d6255614b0eec8c48bc371afdb18443">CALL_STATE_MESSAGE</a>:
<a name="l02023"></a>02023       <span class="keywordflow">return</span> <span class="stringliteral">&quot;CALL_STATE_MESSAGE&quot;</span>;
<a name="l02024"></a>02024    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#ae459fe08b297c169d379436bd538f440">DISPLAY_PROMPT_STATUS_MESSAGE</a>:
<a name="l02025"></a>02025       <span class="keywordflow">return</span> <span class="stringliteral">&quot;DISPLAY_PROMPT_STATUS_MESSAGE&quot;</span>;
<a name="l02026"></a>02026    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a2f74ea6fd6eab3eafc9fc39213034e9e">CLEAR_PROMPT_MESSAGE</a>:
<a name="l02027"></a>02027       <span class="keywordflow">return</span> <span class="stringliteral">&quot;CLEAR_PROMPT_MESSAGE&quot;</span>;
<a name="l02028"></a>02028    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a5ba13eec8f847d9d500c58f2f9503b95">DISPLAY_NOTIFY_MESSAGE</a>:
<a name="l02029"></a>02029       <span class="keywordflow">return</span> <span class="stringliteral">&quot;DISPLAY_NOTIFY_MESSAGE&quot;</span>;
<a name="l02030"></a>02030    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#af303fb67f64cde967ad9434875897f45">ACTIVATE_CALL_PLANE_MESSAGE</a>:
<a name="l02031"></a>02031       <span class="keywordflow">return</span> <span class="stringliteral">&quot;ACTIVATE_CALL_PLANE_MESSAGE&quot;</span>;
<a name="l02032"></a>02032    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a63b744d9de3913b89d002761073a0879">DIALED_NUMBER_MESSAGE</a>:
<a name="l02033"></a>02033       <span class="keywordflow">return</span> <span class="stringliteral">&quot;DIALED_NUMBER_MESSAGE&quot;</span>;
<a name="l02034"></a>02034    <span class="keywordflow">default</span>:
<a name="l02035"></a>02035       <span class="keywordflow">if</span> (!(tmp = <a class="code" href="threadstorage_8h.html#a9153839e218c987b2ae47cbd39ac1ab5" title="Retrieve thread storage.">ast_threadstorage_get</a>(&amp;message2str_threadbuf, MESSAGE2STR_BUFSIZE)))
<a name="l02036"></a>02036          <span class="keywordflow">return</span> <span class="stringliteral">&quot;Unknown&quot;</span>;
<a name="l02037"></a>02037       snprintf(tmp, MESSAGE2STR_BUFSIZE, <span class="stringliteral">&quot;UNKNOWN_MESSAGE-%d&quot;</span>, type);
<a name="l02038"></a>02038       <span class="keywordflow">return</span> tmp;
<a name="l02039"></a>02039    }
<a name="l02040"></a>02040 }
<a name="l02041"></a>02041 <span class="preprocessor">#endif</span>
<a name="l02042"></a>02042 <span class="preprocessor"></span>
<a name="l02043"></a><a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">02043</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__device.html">skinny_device</a> *d, <span class="keyword">struct</span> <a class="code" href="structskinny__req.html">skinny_req</a> *req)
<a name="l02044"></a>02044 {
<a name="l02045"></a>02045    <span class="keyword">struct </span><a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a> = d-&gt;<a class="code" href="structskinny__device.html#a730a1864781691273d9f28b5ad1dadfd">session</a>;
<a name="l02046"></a>02046    <span class="keywordtype">int</span> res = 0;
<a name="l02047"></a>02047 
<a name="l02048"></a>02048    <span class="keywordflow">if</span> (!s) {
<a name="l02049"></a>02049       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Asked to transmit to a non-existent session!\n&quot;</span>);
<a name="l02050"></a>02050       <span class="keywordflow">return</span> -1;
<a name="l02051"></a>02051    }
<a name="l02052"></a>02052 
<a name="l02053"></a>02053    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;s-&gt;<a class="code" href="structskinnysession.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l02054"></a>02054 
<a name="l02055"></a>02055    <a class="code" href="chan__skinny_8c.html#af74ed86d376b6d64e63fa69f16d4ce1f">SKINNY_DEVONLY</a>(<span class="keywordflow">if</span> (skinnydebug&gt;1) <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(4, <span class="stringliteral">&quot;Transmitting %s to %s\n&quot;</span>, message2str(req-&gt;<a class="code" href="structskinny__req.html#a88859ce72faebb79ea0a2bca00a0f46b">e</a>), d-&gt;name);)
<a name="l02056"></a>02056 
<a name="l02057"></a>02057    <span class="keywordflow">if</span> (<a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#afed088663f8704004425cdae2120b9b3">len</a> &gt; <a class="code" href="chan__skinny_8c.html#af113e81b9ed86ff1591580de9d8b1d52">SKINNY_MAX_PACKET</a>) || <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#afed088663f8704004425cdae2120b9b3">len</a> &lt; 0)) {
<a name="l02058"></a>02058       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;transmit_response: the length of the request is out of bounds\n&quot;</span>);
<a name="l02059"></a>02059       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;s-&gt;<a class="code" href="structskinnysession.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l02060"></a>02060       <span class="keywordflow">return</span> -1;
<a name="l02061"></a>02061    }
<a name="l02062"></a>02062 
<a name="l02063"></a>02063    memset(s-&gt;<a class="code" href="structskinnysession.html#add02b47ccdba2203fd3d2ae04d6180ea">outbuf</a>, 0, <span class="keyword">sizeof</span>(s-&gt;<a class="code" href="structskinnysession.html#add02b47ccdba2203fd3d2ae04d6180ea">outbuf</a>));
<a name="l02064"></a>02064    memcpy(s-&gt;<a class="code" href="structskinnysession.html#add02b47ccdba2203fd3d2ae04d6180ea">outbuf</a>, req, skinny_header_size);
<a name="l02065"></a>02065    memcpy(s-&gt;<a class="code" href="structskinnysession.html#add02b47ccdba2203fd3d2ae04d6180ea">outbuf</a>+skinny_header_size, &amp;req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>, <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#afed088663f8704004425cdae2120b9b3">len</a>));
<a name="l02066"></a>02066 
<a name="l02067"></a>02067    res = write(s-&gt;<a class="code" href="structskinnysession.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, s-&gt;<a class="code" href="structskinnysession.html#add02b47ccdba2203fd3d2ae04d6180ea">outbuf</a>, <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#afed088663f8704004425cdae2120b9b3">len</a>)+8);
<a name="l02068"></a>02068    
<a name="l02069"></a>02069    <span class="keywordflow">if</span> (res != <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#afed088663f8704004425cdae2120b9b3">len</a>)+8) {
<a name="l02070"></a>02070       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Transmit: write only sent %d out of %d bytes: %s\n&quot;</span>, res, <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#afed088663f8704004425cdae2120b9b3">len</a>)+8, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l02071"></a>02071       <span class="keywordflow">if</span> (res == -1) {
<a name="l02072"></a>02072          <span class="keywordflow">if</span> (skinnydebug)
<a name="l02073"></a>02073             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Transmit: Skinny Client was lost, unregistering\n&quot;</span>);
<a name="l02074"></a>02074          <a class="code" href="chan__skinny_8c.html#aac25ed22beafaebfee5acb276c2e0d28">skinny_unregister</a>(NULL, s);
<a name="l02075"></a>02075       }
<a name="l02076"></a>02076       
<a name="l02077"></a>02077    }
<a name="l02078"></a>02078    
<a name="l02079"></a>02079    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(req);
<a name="l02080"></a>02080    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;s-&gt;<a class="code" href="structskinnysession.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l02081"></a>02081    <span class="keywordflow">return</span> 1;
<a name="l02082"></a>02082 }
<a name="l02083"></a>02083 
<a name="l02084"></a><a class="code" href="chan__skinny_8c.html#a9d00b95f44b64f37d738f1ddc2ef972f">02084</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__skinny_8c.html#a9d00b95f44b64f37d738f1ddc2ef972f">transmit_speaker_mode</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__device.html">skinny_device</a> *d, <span class="keywordtype">int</span> mode)
<a name="l02085"></a>02085 {
<a name="l02086"></a>02086    <span class="keyword">struct </span><a class="code" href="structskinny__req.html">skinny_req</a> *req;
<a name="l02087"></a>02087 
<a name="l02088"></a>02088    <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structset__speaker__message.html">set_speaker_message</a>), <a class="code" href="chan__skinny_8c.html#ace96029ade576fdaa306b409a2639890">SET_SPEAKER_MESSAGE</a>)))
<a name="l02089"></a>02089       <span class="keywordflow">return</span>;
<a name="l02090"></a>02090 
<a name="l02091"></a>02091    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a3751b807b8ae3a843e2a57d1963a8b4f">setspeaker</a>.<a class="code" href="structset__speaker__message.html#a6b29e4f37f4482274af785ad5ffe96a7">mode</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(mode);
<a name="l02092"></a>02092    <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l02093"></a>02093 }
<a name="l02094"></a>02094 <span class="comment">/*</span>
<a name="l02095"></a>02095 <span class="comment">static void transmit_microphone_mode(struct skinny_device *d, int mode)</span>
<a name="l02096"></a>02096 <span class="comment">{</span>
<a name="l02097"></a>02097 <span class="comment">   struct skinny_req *req;</span>
<a name="l02098"></a>02098 <span class="comment"></span>
<a name="l02099"></a>02099 <span class="comment">   if (!(req = req_alloc(sizeof(struct set_microphone_message), SET_MICROPHONE_MESSAGE)))</span>
<a name="l02100"></a>02100 <span class="comment">      return;</span>
<a name="l02101"></a>02101 <span class="comment"></span>
<a name="l02102"></a>02102 <span class="comment">   req-&gt;data.setmicrophone.mode = htolel(mode);</span>
<a name="l02103"></a>02103 <span class="comment">   transmit_response(d, req);</span>
<a name="l02104"></a>02104 <span class="comment">}</span>
<a name="l02105"></a>02105 <span class="comment">*/</span>
<a name="l02106"></a>02106 
<a name="l02107"></a><a class="code" href="chan__skinny_8c.html#acb127c917ed7c5e9a7dd7e700f5b9cd9">02107</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__skinny_8c.html#acb127c917ed7c5e9a7dd7e700f5b9cd9">transmit_callinfo</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__device.html">skinny_device</a> *d, <span class="keyword">const</span> <span class="keywordtype">char</span> *fromname, <span class="keyword">const</span> <span class="keywordtype">char</span> *fromnum, <span class="keyword">const</span> <span class="keywordtype">char</span> *toname, <span class="keyword">const</span> <span class="keywordtype">char</span> *tonum, <span class="keywordtype">int</span> instance, <span class="keywordtype">int</span> <a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>, <span class="keywordtype">int</span> calltype)
<a name="l02108"></a>02108 {
<a name="l02109"></a>02109    <span class="keyword">struct </span><a class="code" href="structskinny__req.html">skinny_req</a> *req;
<a name="l02110"></a>02110 
<a name="l02111"></a>02111    <span class="comment">/* We should not be able to get here without a device */</span>
<a name="l02112"></a>02112    <span class="keywordflow">if</span> (!d)
<a name="l02113"></a>02113       <span class="keywordflow">return</span>;
<a name="l02114"></a>02114 
<a name="l02115"></a>02115    <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structcall__info__message.html">call_info_message</a>), <a class="code" href="chan__skinny_8c.html#a7fb2c263aa8febc00c4da70f073ca9b7">CALL_INFO_MESSAGE</a>)))
<a name="l02116"></a>02116       <span class="keywordflow">return</span>;
<a name="l02117"></a>02117 
<a name="l02118"></a>02118    <span class="keywordflow">if</span> (skinnydebug)
<a name="l02119"></a>02119          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Setting Callinfo to %s(%s) from %s(%s) on %s(%d)\n&quot;</span>, fromname, fromnum, toname, tonum, d-&gt;name, instance);
<a name="l02120"></a>02120 
<a name="l02121"></a>02121    <span class="keywordflow">if</span> (fromname) {
<a name="l02122"></a>02122       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a25554386850201091cc8f9e0e9031b63">callinfo</a>.<a class="code" href="structcall__info__message.html#a34632365a3c39125e0bdafc01503c191">callingPartyName</a>, fromname, <span class="keyword">sizeof</span>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a25554386850201091cc8f9e0e9031b63">callinfo</a>.<a class="code" href="structcall__info__message.html#a34632365a3c39125e0bdafc01503c191">callingPartyName</a>));
<a name="l02123"></a>02123    }
<a name="l02124"></a>02124    <span class="keywordflow">if</span> (fromnum) {
<a name="l02125"></a>02125       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a25554386850201091cc8f9e0e9031b63">callinfo</a>.<a class="code" href="structcall__info__message.html#a8f62c05987b8a452f1208a72a43e643e">callingParty</a>, fromnum, <span class="keyword">sizeof</span>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a25554386850201091cc8f9e0e9031b63">callinfo</a>.<a class="code" href="structcall__info__message.html#a8f62c05987b8a452f1208a72a43e643e">callingParty</a>));
<a name="l02126"></a>02126    }
<a name="l02127"></a>02127    <span class="keywordflow">if</span> (toname) {
<a name="l02128"></a>02128       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a25554386850201091cc8f9e0e9031b63">callinfo</a>.<a class="code" href="structcall__info__message.html#ab896d88e09a770904adb218aaf9b635f">calledPartyName</a>, toname, <span class="keyword">sizeof</span>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a25554386850201091cc8f9e0e9031b63">callinfo</a>.<a class="code" href="structcall__info__message.html#ab896d88e09a770904adb218aaf9b635f">calledPartyName</a>));
<a name="l02129"></a>02129    }
<a name="l02130"></a>02130    <span class="keywordflow">if</span> (tonum) {
<a name="l02131"></a>02131       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a25554386850201091cc8f9e0e9031b63">callinfo</a>.<a class="code" href="structcall__info__message.html#aaa9b00db6f95d4932ee8d3b825c73bca">calledParty</a>, tonum, <span class="keyword">sizeof</span>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a25554386850201091cc8f9e0e9031b63">callinfo</a>.<a class="code" href="structcall__info__message.html#aaa9b00db6f95d4932ee8d3b825c73bca">calledParty</a>));
<a name="l02132"></a>02132    }
<a name="l02133"></a>02133    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a25554386850201091cc8f9e0e9031b63">callinfo</a>.<a class="code" href="structcall__info__message.html#a9ed36c4f5392e9f1819ec7c9eb9aff80">instance</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(instance);
<a name="l02134"></a>02134    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a25554386850201091cc8f9e0e9031b63">callinfo</a>.<a class="code" href="structcall__info__message.html#aa68938e371fea91ad4b64381877bd381">reference</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(callid);
<a name="l02135"></a>02135    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a25554386850201091cc8f9e0e9031b63">callinfo</a>.<a class="code" href="structcall__info__message.html#ad44b615021ed3ccb734fcaf583ef4a03">type</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(calltype);
<a name="l02136"></a>02136    <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l02137"></a>02137 }
<a name="l02138"></a>02138 
<a name="l02139"></a><a class="code" href="chan__skinny_8c.html#ae0cb986aeace802ace6a240d73c7335c">02139</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__skinny_8c.html#ae0cb986aeace802ace6a240d73c7335c">transmit_connect</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__device.html">skinny_device</a> *d, <span class="keyword">struct</span> <a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub)
<a name="l02140"></a>02140 {
<a name="l02141"></a>02141    <span class="keyword">struct </span><a class="code" href="structskinny__req.html">skinny_req</a> *req;
<a name="l02142"></a>02142    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l = sub-&gt;parent;
<a name="l02143"></a>02143    <span class="keyword">struct </span><a class="code" href="structast__format__list.html" title="Definition of supported media formats (codecs).">ast_format_list</a> fmt;
<a name="l02144"></a>02144 
<a name="l02145"></a>02145    <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structopen__receive__channel__message.html">open_receive_channel_message</a>), <a class="code" href="chan__skinny_8c.html#a88a234a4bca9e3085c77555b00774758">OPEN_RECEIVE_CHANNEL_MESSAGE</a>)))
<a name="l02146"></a>02146       <span class="keywordflow">return</span>;
<a name="l02147"></a>02147 
<a name="l02148"></a>02148    fmt = <a class="code" href="frame_8h.html#ac9789499b866949ab31bab025b497964" title="Get packet size for codec.">ast_codec_pref_getsize</a>(&amp;l-&gt;prefs, <a class="code" href="channel_8h.html#a4d78194779a26341c3ec7298b450b9ed" title="Pick the best audio codec.">ast_best_codec</a>(l-&gt;capability));
<a name="l02149"></a>02149 
<a name="l02150"></a>02150    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aa8faa33e2246e6407be4c17a64ce04c1">openreceivechannel</a>.<a class="code" href="structopen__receive__channel__message.html#aad8282aaef639f3310f833e9b44a541e">conferenceId</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l02151"></a>02151    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aa8faa33e2246e6407be4c17a64ce04c1">openreceivechannel</a>.<a class="code" href="structopen__receive__channel__message.html#a042688e766f041125ca9e83e7d6e1e5b">partyId</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l02152"></a>02152    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aa8faa33e2246e6407be4c17a64ce04c1">openreceivechannel</a>.<a class="code" href="structopen__receive__channel__message.html#a9b36626dc275b826b3249e374a34e89b">packets</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(fmt.<a class="code" href="structast__format__list.html#a8082330d5592ca639ddd6f7be0c0c39b">cur_ms</a>);
<a name="l02153"></a>02153    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aa8faa33e2246e6407be4c17a64ce04c1">openreceivechannel</a>.<a class="code" href="structopen__receive__channel__message.html#ae44a58b4520a788452773ea854fa0959">capability</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(<a class="code" href="chan__skinny_8c.html#a8e3a410f226a1ae0959bc3604421bcb7">codec_ast2skinny</a>(fmt.<a class="code" href="structast__format__list.html#ad1e28a1a66a25529b0b61b9ca4e66d44">bits</a>));
<a name="l02154"></a>02154    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aa8faa33e2246e6407be4c17a64ce04c1">openreceivechannel</a>.<a class="code" href="structopen__receive__channel__message.html#a1f7eaad8cc185c3307255e95e7eb238e">echo</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(0);
<a name="l02155"></a>02155    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aa8faa33e2246e6407be4c17a64ce04c1">openreceivechannel</a>.<a class="code" href="structopen__receive__channel__message.html#a32678c62007e0748dae550bd1007a07d">bitrate</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(0);
<a name="l02156"></a>02156    <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l02157"></a>02157 }
<a name="l02158"></a>02158 
<a name="l02159"></a><a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">02159</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__device.html">skinny_device</a> *d, <span class="keywordtype">int</span> tone, <span class="keywordtype">int</span> instance, <span class="keywordtype">int</span> reference)
<a name="l02160"></a>02160 {
<a name="l02161"></a>02161    <span class="keyword">struct </span><a class="code" href="structskinny__req.html">skinny_req</a> *req;
<a name="l02162"></a>02162 
<a name="l02163"></a>02163    <span class="keywordflow">if</span> (tone == <a class="code" href="chan__skinny_8c.html#ae95c7584fbc0dffa9560c78254a40166">SKINNY_NOTONE</a>) {
<a name="l02164"></a>02164       <span class="comment">/* This is bad, mmm&apos;kay? */</span>
<a name="l02165"></a>02165       <span class="keywordflow">return</span>;
<a name="l02166"></a>02166    }
<a name="l02167"></a>02167 
<a name="l02168"></a>02168    <span class="keywordflow">if</span> (tone &gt; 0) {
<a name="l02169"></a>02169       <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structstart__tone__message.html">start_tone_message</a>), <a class="code" href="chan__skinny_8c.html#ad2488ba493987c5230f95cb86958dc76">START_TONE_MESSAGE</a>)))
<a name="l02170"></a>02170          <span class="keywordflow">return</span>;
<a name="l02171"></a>02171       req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#acfcbe2888df992727f690e1fbccd4e74">starttone</a>.<a class="code" href="structstart__tone__message.html#affe196e5ade32fb5073c2d5bae82fcc3">tone</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(tone);
<a name="l02172"></a>02172       req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#acfcbe2888df992727f690e1fbccd4e74">starttone</a>.<a class="code" href="structstart__tone__message.html#a9ed36c4f5392e9f1819ec7c9eb9aff80">instance</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(instance);
<a name="l02173"></a>02173       req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#acfcbe2888df992727f690e1fbccd4e74">starttone</a>.<a class="code" href="structstart__tone__message.html#aa68938e371fea91ad4b64381877bd381">reference</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(reference);
<a name="l02174"></a>02174    } <span class="keywordflow">else</span> {
<a name="l02175"></a>02175       <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structstop__tone__message.html">stop_tone_message</a>), <a class="code" href="chan__skinny_8c.html#a6c341d198f3726cac8d9e26d4fdb8c58">STOP_TONE_MESSAGE</a>)))
<a name="l02176"></a>02176          <span class="keywordflow">return</span>;
<a name="l02177"></a>02177       req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a42d52a186dbacb2769d37ae6c08543ff">stoptone</a>.<a class="code" href="structstop__tone__message.html#a9ed36c4f5392e9f1819ec7c9eb9aff80">instance</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(instance);
<a name="l02178"></a>02178       req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a42d52a186dbacb2769d37ae6c08543ff">stoptone</a>.<a class="code" href="structstop__tone__message.html#aa68938e371fea91ad4b64381877bd381">reference</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(reference);
<a name="l02179"></a>02179    }
<a name="l02180"></a>02180 
<a name="l02181"></a>02181    <span class="comment">//Bad, tone is already set so this is redundant and a change to the if above</span>
<a name="l02182"></a>02182    <span class="comment">//may lead to issues where we try to set a tone to a stop_tone_message</span>
<a name="l02183"></a>02183    <span class="comment">//if (tone &gt; 0) {</span>
<a name="l02184"></a>02184    <span class="comment">// req-&gt;data.starttone.tone = htolel(tone);</span>
<a name="l02185"></a>02185    <span class="comment">//}</span>
<a name="l02186"></a>02186    <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l02187"></a>02187 }
<a name="l02188"></a>02188 
<a name="l02189"></a><a class="code" href="chan__skinny_8c.html#a5364d4b25cac8ec6f4572faf1434383d">02189</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__skinny_8c.html#a5364d4b25cac8ec6f4572faf1434383d">transmit_selectsoftkeys</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__device.html">skinny_device</a> *d, <span class="keywordtype">int</span> instance, <span class="keywordtype">int</span> <a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>, <span class="keywordtype">int</span> softkey)
<a name="l02190"></a>02190 {
<a name="l02191"></a>02191    <span class="keyword">struct </span><a class="code" href="structskinny__req.html">skinny_req</a> *req;
<a name="l02192"></a>02192 
<a name="l02193"></a>02193    <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structselect__soft__keys__message.html">select_soft_keys_message</a>), <a class="code" href="chan__skinny_8c.html#acf9ff0dcbbb7c545417a22affaddc03a">SELECT_SOFT_KEYS_MESSAGE</a>)))
<a name="l02194"></a>02194       <span class="keywordflow">return</span>;
<a name="l02195"></a>02195 
<a name="l02196"></a>02196    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aa3ac92f8ade1b2cc658c0c5b3ce7d32a">selectsoftkey</a>.<a class="code" href="structselect__soft__keys__message.html#a9ed36c4f5392e9f1819ec7c9eb9aff80">instance</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(instance);
<a name="l02197"></a>02197    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aa3ac92f8ade1b2cc658c0c5b3ce7d32a">selectsoftkey</a>.<a class="code" href="structselect__soft__keys__message.html#aa68938e371fea91ad4b64381877bd381">reference</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(callid);
<a name="l02198"></a>02198    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aa3ac92f8ade1b2cc658c0c5b3ce7d32a">selectsoftkey</a>.<a class="code" href="structselect__soft__keys__message.html#adc2041b10f838792513938afdd303d8a">softKeySetIndex</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(softkey);
<a name="l02199"></a>02199    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aa3ac92f8ade1b2cc658c0c5b3ce7d32a">selectsoftkey</a>.<a class="code" href="structselect__soft__keys__message.html#ad25df21c508e777301c2d307ee3d07af">validKeyMask</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(0xFFFFFFFF);
<a name="l02200"></a>02200    <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l02201"></a>02201 }
<a name="l02202"></a>02202 
<a name="l02203"></a><a class="code" href="chan__skinny_8c.html#aa16aabd900fdb4bd057303387115959f">02203</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__skinny_8c.html#aa16aabd900fdb4bd057303387115959f">transmit_lamp_indication</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__device.html">skinny_device</a> *d, <span class="keywordtype">int</span> stimulus, <span class="keywordtype">int</span> instance, <span class="keywordtype">int</span> indication)
<a name="l02204"></a>02204 {
<a name="l02205"></a>02205    <span class="keyword">struct </span><a class="code" href="structskinny__req.html">skinny_req</a> *req;
<a name="l02206"></a>02206 
<a name="l02207"></a>02207    <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structset__lamp__message.html">set_lamp_message</a>), <a class="code" href="chan__skinny_8c.html#a1ea4574da323c63a872fffd8f134f1af">SET_LAMP_MESSAGE</a>)))
<a name="l02208"></a>02208       <span class="keywordflow">return</span>;
<a name="l02209"></a>02209 
<a name="l02210"></a>02210    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a65f7cdca57eaef927ca936afde633f52">setlamp</a>.<a class="code" href="structset__lamp__message.html#af793c4f4a8ade380472caa8035905848">stimulus</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(stimulus);
<a name="l02211"></a>02211    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a65f7cdca57eaef927ca936afde633f52">setlamp</a>.<a class="code" href="structset__lamp__message.html#a9343bb7a21618047055c833ea497d1fe">stimulusInstance</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(instance);
<a name="l02212"></a>02212    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a65f7cdca57eaef927ca936afde633f52">setlamp</a>.<a class="code" href="structset__lamp__message.html#afecdde89163215e9c3f609f583ca43a7">deviceStimulus</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(indication);
<a name="l02213"></a>02213    <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l02214"></a>02214 }
<a name="l02215"></a>02215 
<a name="l02216"></a><a class="code" href="chan__skinny_8c.html#a4f65a9ef12827334502722b4cd8919c6">02216</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__skinny_8c.html#a4f65a9ef12827334502722b4cd8919c6">transmit_ringer_mode</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__device.html">skinny_device</a> *d, <span class="keywordtype">int</span> mode)
<a name="l02217"></a>02217 {
<a name="l02218"></a>02218    <span class="keyword">struct </span><a class="code" href="structskinny__req.html">skinny_req</a> *req;
<a name="l02219"></a>02219 
<a name="l02220"></a>02220    <span class="keywordflow">if</span> (skinnydebug)
<a name="l02221"></a>02221       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Setting ringer mode to &apos;%d&apos;.\n&quot;</span>, mode);
<a name="l02222"></a>02222 
<a name="l02223"></a>02223    <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structset__ringer__message.html">set_ringer_message</a>), <a class="code" href="chan__skinny_8c.html#ae7bbfbe01b4deecb01153f047d12497b">SET_RINGER_MESSAGE</a>)))
<a name="l02224"></a>02224       <span class="keywordflow">return</span>;
<a name="l02225"></a>02225 
<a name="l02226"></a>02226    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a6708800c9c04790dc4ed17d8adf05ed7">setringer</a>.<a class="code" href="structset__ringer__message.html#aa8164b9b4b32a6aa9770cb5bc9f6b544">ringerMode</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(mode);
<a name="l02227"></a>02227    <span class="comment">/* XXX okay, I don&apos;t quite know what this is, but here&apos;s what happens (on a 7960).</span>
<a name="l02228"></a>02228 <span class="comment">      Note: The phone will always show as ringing on the display.</span>
<a name="l02229"></a>02229 <span class="comment"></span>
<a name="l02230"></a>02230 <span class="comment">      1: phone will audibly ring over and over</span>
<a name="l02231"></a>02231 <span class="comment">      2: phone will audibly ring only once</span>
<a name="l02232"></a>02232 <span class="comment">      any other value, will NOT cause the phone to audibly ring</span>
<a name="l02233"></a>02233 <span class="comment">   */</span>
<a name="l02234"></a>02234    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a6708800c9c04790dc4ed17d8adf05ed7">setringer</a>.<a class="code" href="structset__ringer__message.html#a1946df298d8390034825068792632dbb">unknown1</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(1);
<a name="l02235"></a>02235    <span class="comment">/* XXX the value here doesn&apos;t seem to change anything.  Must be higher than 0.</span>
<a name="l02236"></a>02236 <span class="comment">      Perhaps a packet capture can shed some light on this. */</span>
<a name="l02237"></a>02237    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a6708800c9c04790dc4ed17d8adf05ed7">setringer</a>.<a class="code" href="structset__ringer__message.html#a562d73948591ea69ac50c6db50f3a54e">unknown2</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(1);
<a name="l02238"></a>02238    <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l02239"></a>02239 }
<a name="l02240"></a>02240 
<a name="l02241"></a><a class="code" href="chan__skinny_8c.html#ad2e667cc9fa19462ea433bac21b74c7b">02241</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__skinny_8c.html#ad2e667cc9fa19462ea433bac21b74c7b">transmit_displaymessage</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__device.html">skinny_device</a> *d, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>, <span class="keywordtype">int</span> instance, <span class="keywordtype">int</span> reference)
<a name="l02242"></a>02242 {
<a name="l02243"></a>02243    <span class="keyword">struct </span><a class="code" href="structskinny__req.html">skinny_req</a> *req;
<a name="l02244"></a>02244 
<a name="l02245"></a>02245    <span class="keywordflow">if</span> (text == 0) {
<a name="l02246"></a>02246       <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(0, <a class="code" href="chan__skinny_8c.html#ad3ef1afdcb3cc2dc465820495d6a3826">CLEAR_DISPLAY_MESSAGE</a>)))
<a name="l02247"></a>02247          <span class="keywordflow">return</span>;
<a name="l02248"></a>02248 
<a name="l02249"></a>02249       <span class="comment">//what do we want hear CLEAR_DISPLAY_MESSAGE or CLEAR_PROMPT_STATUS???</span>
<a name="l02250"></a>02250       <span class="comment">//if we are clearing the display, it appears there is no instance and refernece info (size 0)</span>
<a name="l02251"></a>02251       <span class="comment">//req-&gt;data.clearpromptstatus.lineInstance = instance;</span>
<a name="l02252"></a>02252       <span class="comment">//req-&gt;data.clearpromptstatus.callReference = reference;</span>
<a name="l02253"></a>02253 
<a name="l02254"></a>02254       <span class="comment">/* send datetime message. We have to do it here because it will clear the display on the phone if we do it elsewhere */</span>
<a name="l02255"></a>02255       <a class="code" href="chan__skinny_8c.html#a9900f684e2e692200c87ade6605b3570">handle_time_date_req_message</a>(NULL, d-&gt;<a class="code" href="structskinny__device.html#a730a1864781691273d9f28b5ad1dadfd">session</a>);
<a name="l02256"></a>02256 
<a name="l02257"></a>02257       <span class="keywordflow">if</span> (skinnydebug)
<a name="l02258"></a>02258          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Clearing Display\n&quot;</span>);
<a name="l02259"></a>02259    } <span class="keywordflow">else</span> {
<a name="l02260"></a>02260       <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structdisplaytext__message.html">displaytext_message</a>), <a class="code" href="chan__skinny_8c.html#aaf7fd74b57aa572a32636909926de80b">DISPLAYTEXT_MESSAGE</a>)))
<a name="l02261"></a>02261          <span class="keywordflow">return</span>;
<a name="l02262"></a>02262 
<a name="l02263"></a>02263       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a0f450f5076cf5881aefe3fa6bc381edd">displaytext</a>.<a class="code" href="structdisplaytext__message.html#a9c7ea79a50fa206ad34689d0ba2f00fc">text</a>, text, <span class="keyword">sizeof</span>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a0f450f5076cf5881aefe3fa6bc381edd">displaytext</a>.<a class="code" href="structdisplaytext__message.html#a9c7ea79a50fa206ad34689d0ba2f00fc">text</a>));
<a name="l02264"></a>02264       <span class="keywordflow">if</span> (skinnydebug)
<a name="l02265"></a>02265          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Displaying message &apos;%s&apos;\n&quot;</span>, req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a0f450f5076cf5881aefe3fa6bc381edd">displaytext</a>.<a class="code" href="structdisplaytext__message.html#a9c7ea79a50fa206ad34689d0ba2f00fc">text</a>);
<a name="l02266"></a>02266    }
<a name="l02267"></a>02267 
<a name="l02268"></a>02268    <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l02269"></a>02269 }
<a name="l02270"></a>02270 
<a name="l02271"></a><a class="code" href="chan__skinny_8c.html#a8122a36b30f8a86ffe3a06548fa8903c">02271</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__skinny_8c.html#a8122a36b30f8a86ffe3a06548fa8903c">transmit_displaynotify</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__device.html">skinny_device</a> *d, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>, <span class="keywordtype">int</span> t)
<a name="l02272"></a>02272 {
<a name="l02273"></a>02273    <span class="keyword">struct </span><a class="code" href="structskinny__req.html">skinny_req</a> *req;
<a name="l02274"></a>02274 
<a name="l02275"></a>02275    <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structdisplay__notify__message.html">display_notify_message</a>), <a class="code" href="chan__skinny_8c.html#a5ba13eec8f847d9d500c58f2f9503b95">DISPLAY_NOTIFY_MESSAGE</a>)))
<a name="l02276"></a>02276       <span class="keywordflow">return</span>;
<a name="l02277"></a>02277 
<a name="l02278"></a>02278    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a1b277f925972224699c8d5e398e5ed6d">displaynotify</a>.<a class="code" href="structdisplay__notify__message.html#a5eb30c11452cfefd9c9480037eabf99d">displayMessage</a>, text, <span class="keyword">sizeof</span>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a1b277f925972224699c8d5e398e5ed6d">displaynotify</a>.<a class="code" href="structdisplay__notify__message.html#a5eb30c11452cfefd9c9480037eabf99d">displayMessage</a>));
<a name="l02279"></a>02279    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a1b277f925972224699c8d5e398e5ed6d">displaynotify</a>.<a class="code" href="structdisplay__notify__message.html#ab90d738fa36461d19bce3455a553f0f1">displayTimeout</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(t);
<a name="l02280"></a>02280 
<a name="l02281"></a>02281    <span class="keywordflow">if</span> (skinnydebug)
<a name="l02282"></a>02282       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Displaying notify &apos;%s&apos;\n&quot;</span>, text);
<a name="l02283"></a>02283 
<a name="l02284"></a>02284    <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l02285"></a>02285 }
<a name="l02286"></a>02286 
<a name="l02287"></a><a class="code" href="chan__skinny_8c.html#a2c3127d93ed4f2dac8c6526a8b0ebd7d">02287</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__skinny_8c.html#a2c3127d93ed4f2dac8c6526a8b0ebd7d">transmit_displaypromptstatus</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__device.html">skinny_device</a> *d, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>, <span class="keywordtype">int</span> t, <span class="keywordtype">int</span> instance, <span class="keywordtype">int</span> <a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>)
<a name="l02288"></a>02288 {
<a name="l02289"></a>02289    <span class="keyword">struct </span><a class="code" href="structskinny__req.html">skinny_req</a> *req;
<a name="l02290"></a>02290 
<a name="l02291"></a>02291    <span class="keywordflow">if</span> (text == 0) {
<a name="l02292"></a>02292       <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structclear__prompt__message.html">clear_prompt_message</a>), <a class="code" href="chan__skinny_8c.html#a2f74ea6fd6eab3eafc9fc39213034e9e">CLEAR_PROMPT_MESSAGE</a>)))
<a name="l02293"></a>02293          <span class="keywordflow">return</span>;
<a name="l02294"></a>02294 
<a name="l02295"></a>02295       req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a69f5aa4af56adffb6bf9f024b0da437f">clearpromptstatus</a>.<a class="code" href="structclear__prompt__message.html#a3c8ec1b11804b48f666007331e0c90ba">lineInstance</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(instance);
<a name="l02296"></a>02296       req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a69f5aa4af56adffb6bf9f024b0da437f">clearpromptstatus</a>.<a class="code" href="structclear__prompt__message.html#a8c5b70179481930bfaef1fa8f6aaba74">callReference</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(callid);
<a name="l02297"></a>02297 
<a name="l02298"></a>02298       <span class="keywordflow">if</span> (skinnydebug)
<a name="l02299"></a>02299          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Clearing Prompt\n&quot;</span>);
<a name="l02300"></a>02300    } <span class="keywordflow">else</span> {
<a name="l02301"></a>02301       <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structdisplay__prompt__status__message.html">display_prompt_status_message</a>), <a class="code" href="chan__skinny_8c.html#ae459fe08b297c169d379436bd538f440">DISPLAY_PROMPT_STATUS_MESSAGE</a>)))
<a name="l02302"></a>02302          <span class="keywordflow">return</span>;
<a name="l02303"></a>02303 
<a name="l02304"></a>02304       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aaa71639d4715a03ba89b940efb207a6c">displaypromptstatus</a>.<a class="code" href="structdisplay__prompt__status__message.html#a85294cb46cae34e2921c7051bdabfdd6">promptMessage</a>, text, <span class="keyword">sizeof</span>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aaa71639d4715a03ba89b940efb207a6c">displaypromptstatus</a>.<a class="code" href="structdisplay__prompt__status__message.html#a85294cb46cae34e2921c7051bdabfdd6">promptMessage</a>));
<a name="l02305"></a>02305       req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aaa71639d4715a03ba89b940efb207a6c">displaypromptstatus</a>.<a class="code" href="structdisplay__prompt__status__message.html#abdf697e332017cc49abf0735c2eae589">messageTimeout</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(t);
<a name="l02306"></a>02306       req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aaa71639d4715a03ba89b940efb207a6c">displaypromptstatus</a>.<a class="code" href="structdisplay__prompt__status__message.html#a3c8ec1b11804b48f666007331e0c90ba">lineInstance</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(instance);
<a name="l02307"></a>02307       req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aaa71639d4715a03ba89b940efb207a6c">displaypromptstatus</a>.<a class="code" href="structdisplay__prompt__status__message.html#a8c5b70179481930bfaef1fa8f6aaba74">callReference</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(callid);
<a name="l02308"></a>02308 
<a name="l02309"></a>02309       <span class="keywordflow">if</span> (skinnydebug)
<a name="l02310"></a>02310          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Displaying Prompt Status &apos;%s&apos;\n&quot;</span>, text);
<a name="l02311"></a>02311    }
<a name="l02312"></a>02312 
<a name="l02313"></a>02313    <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l02314"></a>02314 }
<a name="l02315"></a>02315 
<a name="l02316"></a><a class="code" href="chan__skinny_8c.html#a122fa20b73095a6195119dd979dfb6c1">02316</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__skinny_8c.html#a122fa20b73095a6195119dd979dfb6c1">transmit_dialednumber</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__device.html">skinny_device</a> *d, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>, <span class="keywordtype">int</span> instance, <span class="keywordtype">int</span> <a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>)
<a name="l02317"></a>02317 {
<a name="l02318"></a>02318    <span class="keyword">struct </span><a class="code" href="structskinny__req.html">skinny_req</a> *req;
<a name="l02319"></a>02319 
<a name="l02320"></a>02320    <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structdialed__number__message.html">dialed_number_message</a>), <a class="code" href="chan__skinny_8c.html#a63b744d9de3913b89d002761073a0879">DIALED_NUMBER_MESSAGE</a>)))
<a name="l02321"></a>02321       <span class="keywordflow">return</span>;
<a name="l02322"></a>02322 
<a name="l02323"></a>02323    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a2d5eae5cb69465289c72e06c47d3ba01">dialednumber</a>.<a class="code" href="structdialed__number__message.html#a559dde9437a7990069ccb75635e0be50">dialedNumber</a>, text, <span class="keyword">sizeof</span>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a2d5eae5cb69465289c72e06c47d3ba01">dialednumber</a>.<a class="code" href="structdialed__number__message.html#a559dde9437a7990069ccb75635e0be50">dialedNumber</a>));
<a name="l02324"></a>02324    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a2d5eae5cb69465289c72e06c47d3ba01">dialednumber</a>.<a class="code" href="structdialed__number__message.html#a3c8ec1b11804b48f666007331e0c90ba">lineInstance</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(instance);
<a name="l02325"></a>02325    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a2d5eae5cb69465289c72e06c47d3ba01">dialednumber</a>.<a class="code" href="structdialed__number__message.html#a8c5b70179481930bfaef1fa8f6aaba74">callReference</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(callid);
<a name="l02326"></a>02326 
<a name="l02327"></a>02327    <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l02328"></a>02328 }
<a name="l02329"></a>02329 
<a name="l02330"></a><a class="code" href="chan__skinny_8c.html#a875522082ab6d17f72cbf3ad88708a9b">02330</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__skinny_8c.html#a875522082ab6d17f72cbf3ad88708a9b">transmit_closereceivechannel</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__device.html">skinny_device</a> *d, <span class="keyword">struct</span> <a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub)
<a name="l02331"></a>02331 {
<a name="l02332"></a>02332    <span class="keyword">struct </span><a class="code" href="structskinny__req.html">skinny_req</a> *req;
<a name="l02333"></a>02333 
<a name="l02334"></a>02334    <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structclose__receive__channel__message.html">close_receive_channel_message</a>), <a class="code" href="chan__skinny_8c.html#a60c800146db7344c89b2941999f236d4">CLOSE_RECEIVE_CHANNEL_MESSAGE</a>)))
<a name="l02335"></a>02335       <span class="keywordflow">return</span>;
<a name="l02336"></a>02336 
<a name="l02337"></a>02337    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a6e736b9cb16ec299bd33005a41fc4884">closereceivechannel</a>.<a class="code" href="structclose__receive__channel__message.html#aad8282aaef639f3310f833e9b44a541e">conferenceId</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(0);
<a name="l02338"></a>02338    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a6e736b9cb16ec299bd33005a41fc4884">closereceivechannel</a>.<a class="code" href="structclose__receive__channel__message.html#a042688e766f041125ca9e83e7d6e1e5b">partyId</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l02339"></a>02339    <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l02340"></a>02340 }
<a name="l02341"></a>02341 
<a name="l02342"></a><a class="code" href="chan__skinny_8c.html#ae4983e199d8ab27568a4e09f740379d1">02342</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__skinny_8c.html#ae4983e199d8ab27568a4e09f740379d1">transmit_stopmediatransmission</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__device.html">skinny_device</a> *d, <span class="keyword">struct</span> <a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub)
<a name="l02343"></a>02343 {
<a name="l02344"></a>02344    <span class="keyword">struct </span><a class="code" href="structskinny__req.html">skinny_req</a> *req;
<a name="l02345"></a>02345 
<a name="l02346"></a>02346    <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structstop__media__transmission__message.html">stop_media_transmission_message</a>), <a class="code" href="chan__skinny_8c.html#acb883512e3f609a62dde13c5d5cb4879">STOP_MEDIA_TRANSMISSION_MESSAGE</a>)))
<a name="l02347"></a>02347       <span class="keywordflow">return</span>;
<a name="l02348"></a>02348 
<a name="l02349"></a>02349    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a684ad1caea9173fbc13ab7be0ae45d9b">stopmedia</a>.<a class="code" href="structstop__media__transmission__message.html#aad8282aaef639f3310f833e9b44a541e">conferenceId</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(0);
<a name="l02350"></a>02350    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a684ad1caea9173fbc13ab7be0ae45d9b">stopmedia</a>.<a class="code" href="structstop__media__transmission__message.html#ae7a8ce78da6117ddd5e98de15f85af23">passThruPartyId</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l02351"></a>02351    <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l02352"></a>02352 }
<a name="l02353"></a>02353 
<a name="l02354"></a><a class="code" href="chan__skinny_8c.html#a6b694923ed4fb4da7b7e8fbcf650cbf1">02354</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__skinny_8c.html#a6b694923ed4fb4da7b7e8fbcf650cbf1">transmit_activatecallplane</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__device.html">skinny_device</a> *d, <span class="keyword">struct</span> <a class="code" href="structskinny__line.html">skinny_line</a> *l)
<a name="l02355"></a>02355 {
<a name="l02356"></a>02356    <span class="keyword">struct </span><a class="code" href="structskinny__req.html">skinny_req</a> *req;
<a name="l02357"></a>02357 
<a name="l02358"></a>02358    <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structactivate__call__plane__message.html">activate_call_plane_message</a>), <a class="code" href="chan__skinny_8c.html#af303fb67f64cde967ad9434875897f45">ACTIVATE_CALL_PLANE_MESSAGE</a>)))
<a name="l02359"></a>02359       <span class="keywordflow">return</span>;
<a name="l02360"></a>02360 
<a name="l02361"></a>02361    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a77702a509517291eaa6e1e919179233b">activatecallplane</a>.<a class="code" href="structactivate__call__plane__message.html#a3c8ec1b11804b48f666007331e0c90ba">lineInstance</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(l-&gt;instance);
<a name="l02362"></a>02362    <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l02363"></a>02363 }
<a name="l02364"></a>02364 
<a name="l02365"></a><a class="code" href="chan__skinny_8c.html#a891052a3d2334a56e4b5df01988ad8fb">02365</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__skinny_8c.html#a891052a3d2334a56e4b5df01988ad8fb">transmit_callstateonly</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__device.html">skinny_device</a> *d, <span class="keyword">struct</span> <a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub, <span class="keywordtype">int</span> <a class="code" href="structstate.html">state</a>)
<a name="l02366"></a>02366 {
<a name="l02367"></a>02367    <span class="keyword">struct </span><a class="code" href="structskinny__req.html">skinny_req</a> *req;
<a name="l02368"></a>02368 
<a name="l02369"></a>02369    <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structcall__state__message.html">call_state_message</a>), <a class="code" href="chan__skinny_8c.html#a2d6255614b0eec8c48bc371afdb18443">CALL_STATE_MESSAGE</a>)))
<a name="l02370"></a>02370       <span class="keywordflow">return</span>;
<a name="l02371"></a>02371 
<a name="l02372"></a>02372    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aa2c88f018f286fe417fe6d5da2f98d7d">callstate</a>.<a class="code" href="structcall__state__message.html#a02033745eb42ba576e671f4a24c39c48">callState</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(state);
<a name="l02373"></a>02373    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aa2c88f018f286fe417fe6d5da2f98d7d">callstate</a>.<a class="code" href="structcall__state__message.html#a3c8ec1b11804b48f666007331e0c90ba">lineInstance</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(sub-&gt;parent-&gt;instance);
<a name="l02374"></a>02374    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aa2c88f018f286fe417fe6d5da2f98d7d">callstate</a>.<a class="code" href="structcall__state__message.html#a8c5b70179481930bfaef1fa8f6aaba74">callReference</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l02375"></a>02375    <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l02376"></a>02376 }
<a name="l02377"></a>02377 
<a name="l02378"></a><a class="code" href="chan__skinny_8c.html#a0cb936a217935cdbaa71cc6cb5171b44">02378</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__skinny_8c.html#a0cb936a217935cdbaa71cc6cb5171b44">transmit_callstate</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__device.html">skinny_device</a> *d, <span class="keywordtype">int</span> instance, <span class="keywordtype">int</span> <a class="code" href="structstate.html">state</a>, <span class="keywordtype">unsigned</span> <a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>)
<a name="l02379"></a>02379 {
<a name="l02380"></a>02380    <span class="keyword">struct </span><a class="code" href="structskinny__req.html">skinny_req</a> *req;
<a name="l02381"></a>02381 
<a name="l02382"></a>02382    <span class="keywordflow">if</span> (state == <a class="code" href="chan__skinny_8c.html#ad38b06a5edcc17eaa553739944e702e1">SKINNY_ONHOOK</a>) {
<a name="l02383"></a>02383       <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structclose__receive__channel__message.html">close_receive_channel_message</a>), <a class="code" href="chan__skinny_8c.html#a60c800146db7344c89b2941999f236d4">CLOSE_RECEIVE_CHANNEL_MESSAGE</a>)))
<a name="l02384"></a>02384          <span class="keywordflow">return</span>;
<a name="l02385"></a>02385 
<a name="l02386"></a>02386       req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a6e736b9cb16ec299bd33005a41fc4884">closereceivechannel</a>.<a class="code" href="structclose__receive__channel__message.html#aad8282aaef639f3310f833e9b44a541e">conferenceId</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(callid);
<a name="l02387"></a>02387       req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a6e736b9cb16ec299bd33005a41fc4884">closereceivechannel</a>.<a class="code" href="structclose__receive__channel__message.html#a042688e766f041125ca9e83e7d6e1e5b">partyId</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(callid);
<a name="l02388"></a>02388       <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l02389"></a>02389 
<a name="l02390"></a>02390       <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structstop__media__transmission__message.html">stop_media_transmission_message</a>), <a class="code" href="chan__skinny_8c.html#acb883512e3f609a62dde13c5d5cb4879">STOP_MEDIA_TRANSMISSION_MESSAGE</a>)))
<a name="l02391"></a>02391          <span class="keywordflow">return</span>;
<a name="l02392"></a>02392 
<a name="l02393"></a>02393       req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a684ad1caea9173fbc13ab7be0ae45d9b">stopmedia</a>.<a class="code" href="structstop__media__transmission__message.html#aad8282aaef639f3310f833e9b44a541e">conferenceId</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(callid);
<a name="l02394"></a>02394       req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a684ad1caea9173fbc13ab7be0ae45d9b">stopmedia</a>.<a class="code" href="structstop__media__transmission__message.html#ae7a8ce78da6117ddd5e98de15f85af23">passThruPartyId</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(callid);
<a name="l02395"></a>02395       <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l02396"></a>02396 
<a name="l02397"></a>02397       <a class="code" href="chan__skinny_8c.html#a9d00b95f44b64f37d738f1ddc2ef972f">transmit_speaker_mode</a>(d, <a class="code" href="chan__skinny_8c.html#a0c90019de529b77fb06d587393ec42bf">SKINNY_SPEAKEROFF</a>);
<a name="l02398"></a>02398 
<a name="l02399"></a>02399       <a class="code" href="chan__skinny_8c.html#a2c3127d93ed4f2dac8c6526a8b0ebd7d">transmit_displaypromptstatus</a>(d, NULL, 0, instance, callid);
<a name="l02400"></a>02400    }
<a name="l02401"></a>02401 
<a name="l02402"></a>02402    <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structcall__state__message.html">call_state_message</a>), <a class="code" href="chan__skinny_8c.html#a2d6255614b0eec8c48bc371afdb18443">CALL_STATE_MESSAGE</a>)))
<a name="l02403"></a>02403       <span class="keywordflow">return</span>;
<a name="l02404"></a>02404 
<a name="l02405"></a>02405    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aa2c88f018f286fe417fe6d5da2f98d7d">callstate</a>.<a class="code" href="structcall__state__message.html#a02033745eb42ba576e671f4a24c39c48">callState</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(state);
<a name="l02406"></a>02406    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aa2c88f018f286fe417fe6d5da2f98d7d">callstate</a>.<a class="code" href="structcall__state__message.html#a3c8ec1b11804b48f666007331e0c90ba">lineInstance</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(instance);
<a name="l02407"></a>02407    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aa2c88f018f286fe417fe6d5da2f98d7d">callstate</a>.<a class="code" href="structcall__state__message.html#a8c5b70179481930bfaef1fa8f6aaba74">callReference</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(callid);
<a name="l02408"></a>02408    <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l02409"></a>02409 
<a name="l02410"></a>02410    <span class="keywordflow">if</span> (state == <a class="code" href="chan__skinny_8c.html#ad38b06a5edcc17eaa553739944e702e1">SKINNY_ONHOOK</a>) {
<a name="l02411"></a>02411       <a class="code" href="chan__skinny_8c.html#a5364d4b25cac8ec6f4572faf1434383d">transmit_selectsoftkeys</a>(d, 0, 0, <a class="code" href="chan__skinny_8c.html#aab983751d9fb47d03d07a9e9dd2b4776">KEYDEF_ONHOOK</a>);
<a name="l02412"></a>02412    }
<a name="l02413"></a>02413 
<a name="l02414"></a>02414    <span class="keywordflow">if</span> (state == <a class="code" href="chan__skinny_8c.html#a2e10f13253ac5069f50f7f66b9511537">SKINNY_OFFHOOK</a> || state == <a class="code" href="chan__skinny_8c.html#ad38b06a5edcc17eaa553739944e702e1">SKINNY_ONHOOK</a>) {
<a name="l02415"></a>02415       <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structactivate__call__plane__message.html">activate_call_plane_message</a>), <a class="code" href="chan__skinny_8c.html#af303fb67f64cde967ad9434875897f45">ACTIVATE_CALL_PLANE_MESSAGE</a>)))
<a name="l02416"></a>02416          <span class="keywordflow">return</span>;
<a name="l02417"></a>02417 
<a name="l02418"></a>02418       req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a77702a509517291eaa6e1e919179233b">activatecallplane</a>.<a class="code" href="structactivate__call__plane__message.html#a3c8ec1b11804b48f666007331e0c90ba">lineInstance</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(instance);
<a name="l02419"></a>02419       <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l02420"></a>02420    }
<a name="l02421"></a>02421 }
<a name="l02422"></a>02422 
<a name="l02423"></a>02423 
<a name="l02424"></a><a class="code" href="chan__skinny_8c.html#aa51e51361738b28e24f83d7ec6b4c0f3">02424</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__skinny_8c.html#aa51e51361738b28e24f83d7ec6b4c0f3">transmit_cfwdstate</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__device.html">skinny_device</a> *d, <span class="keyword">struct</span> <a class="code" href="structskinny__line.html">skinny_line</a> *l)
<a name="l02425"></a>02425 {
<a name="l02426"></a>02426    <span class="keyword">struct </span><a class="code" href="structskinny__req.html">skinny_req</a> *req;
<a name="l02427"></a>02427    <span class="keywordtype">int</span> anyon = 0;
<a name="l02428"></a>02428 
<a name="l02429"></a>02429    <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structforward__stat__message.html">forward_stat_message</a>), <a class="code" href="chan__skinny_8c.html#a3fde9ebcac20096752caa92845e4862a">FORWARD_STAT_MESSAGE</a>)))
<a name="l02430"></a>02430       <span class="keywordflow">return</span>;
<a name="l02431"></a>02431 
<a name="l02432"></a>02432    <span class="keywordflow">if</span> (l-&gt;cfwdtype &amp; <a class="code" href="chan__skinny_8c.html#a1a77767cd4cfc70d096da50a2fefecd7">SKINNY_CFWD_ALL</a>) {
<a name="l02433"></a>02433       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(l-&gt;call_forward_all)) {
<a name="l02434"></a>02434          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a31da68884fbffe3a0099f5e4121b9d76">forwardstat</a>.<a class="code" href="structforward__stat__message.html#a2a34e8a2d2777cf9b7ca0596732befd2">fwdallnum</a>, l-&gt;call_forward_all, <span class="keyword">sizeof</span>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a31da68884fbffe3a0099f5e4121b9d76">forwardstat</a>.<a class="code" href="structforward__stat__message.html#a2a34e8a2d2777cf9b7ca0596732befd2">fwdallnum</a>));
<a name="l02435"></a>02435          req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a31da68884fbffe3a0099f5e4121b9d76">forwardstat</a>.<a class="code" href="structforward__stat__message.html#aeea300cffcc2fdbb4fbd2130b23f127c">fwdall</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(1);
<a name="l02436"></a>02436          anyon++;
<a name="l02437"></a>02437       } <span class="keywordflow">else</span> {
<a name="l02438"></a>02438          req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a31da68884fbffe3a0099f5e4121b9d76">forwardstat</a>.<a class="code" href="structforward__stat__message.html#aeea300cffcc2fdbb4fbd2130b23f127c">fwdall</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(0);
<a name="l02439"></a>02439       }
<a name="l02440"></a>02440    }
<a name="l02441"></a>02441    <span class="keywordflow">if</span> (l-&gt;cfwdtype &amp; <a class="code" href="chan__skinny_8c.html#a6cd59fd0c6c79219d38f437a485ce844">SKINNY_CFWD_BUSY</a>) {
<a name="l02442"></a>02442       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(l-&gt;call_forward_busy)) {
<a name="l02443"></a>02443          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a31da68884fbffe3a0099f5e4121b9d76">forwardstat</a>.<a class="code" href="structforward__stat__message.html#aa2fa55c22378257cdd94037cd2871d13">fwdbusynum</a>, l-&gt;call_forward_busy, <span class="keyword">sizeof</span>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a31da68884fbffe3a0099f5e4121b9d76">forwardstat</a>.<a class="code" href="structforward__stat__message.html#aa2fa55c22378257cdd94037cd2871d13">fwdbusynum</a>));
<a name="l02444"></a>02444          req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a31da68884fbffe3a0099f5e4121b9d76">forwardstat</a>.<a class="code" href="structforward__stat__message.html#a1c3cbe199ec696d90ca356b34a79d55a">fwdbusy</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(1);
<a name="l02445"></a>02445          anyon++;
<a name="l02446"></a>02446       } <span class="keywordflow">else</span> {
<a name="l02447"></a>02447          req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a31da68884fbffe3a0099f5e4121b9d76">forwardstat</a>.<a class="code" href="structforward__stat__message.html#a1c3cbe199ec696d90ca356b34a79d55a">fwdbusy</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(0);
<a name="l02448"></a>02448       }
<a name="l02449"></a>02449    }
<a name="l02450"></a>02450    <span class="keywordflow">if</span> (l-&gt;cfwdtype &amp; <a class="code" href="chan__skinny_8c.html#a805d890f6df0e6cf5d9f281791d2a318">SKINNY_CFWD_NOANSWER</a>) {
<a name="l02451"></a>02451       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(l-&gt;call_forward_noanswer)) {
<a name="l02452"></a>02452          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a31da68884fbffe3a0099f5e4121b9d76">forwardstat</a>.<a class="code" href="structforward__stat__message.html#ad53edfe4cc9f758d9ed850e79e478209">fwdnoanswernum</a>, l-&gt;call_forward_noanswer, <span class="keyword">sizeof</span>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a31da68884fbffe3a0099f5e4121b9d76">forwardstat</a>.<a class="code" href="structforward__stat__message.html#ad53edfe4cc9f758d9ed850e79e478209">fwdnoanswernum</a>));
<a name="l02453"></a>02453          req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a31da68884fbffe3a0099f5e4121b9d76">forwardstat</a>.<a class="code" href="structforward__stat__message.html#a5cedc24a4c8a47b4b07509728c9991e8">fwdnoanswer</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(1);
<a name="l02454"></a>02454          anyon++;
<a name="l02455"></a>02455       } <span class="keywordflow">else</span> {
<a name="l02456"></a>02456          req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a31da68884fbffe3a0099f5e4121b9d76">forwardstat</a>.<a class="code" href="structforward__stat__message.html#a5cedc24a4c8a47b4b07509728c9991e8">fwdnoanswer</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(0);
<a name="l02457"></a>02457       }
<a name="l02458"></a>02458    }
<a name="l02459"></a>02459    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a31da68884fbffe3a0099f5e4121b9d76">forwardstat</a>.<a class="code" href="structforward__stat__message.html#a987293a1c8fcaf937487ecbe613f0c52">lineNumber</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(l-&gt;instance);
<a name="l02460"></a>02460    <span class="keywordflow">if</span> (anyon)
<a name="l02461"></a>02461       req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a31da68884fbffe3a0099f5e4121b9d76">forwardstat</a>.<a class="code" href="structforward__stat__message.html#a0efc2cd005b4b368e86dc6898dfc1663">activeforward</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(7);
<a name="l02462"></a>02462    <span class="keywordflow">else</span>
<a name="l02463"></a>02463       req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a31da68884fbffe3a0099f5e4121b9d76">forwardstat</a>.<a class="code" href="structforward__stat__message.html#a0efc2cd005b4b368e86dc6898dfc1663">activeforward</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(0);
<a name="l02464"></a>02464 
<a name="l02465"></a>02465    <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l02466"></a>02466 }
<a name="l02467"></a>02467 
<a name="l02468"></a><a class="code" href="chan__skinny_8c.html#abe88d7d15a546c75f3bd8f13a6f15fe8">02468</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#abe88d7d15a546c75f3bd8f13a6f15fe8">skinny_extensionstate_cb</a>(<span class="keywordtype">char</span> *<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <span class="keywordtype">char</span> *<a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, <span class="keywordtype">int</span> <a class="code" href="structstate.html">state</a>, <span class="keywordtype">void</span> *<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>)
<a name="l02469"></a>02469 {
<a name="l02470"></a>02470    <span class="keyword">struct </span><a class="code" href="structskinny__speeddial.html">skinny_speeddial</a> *sd = data;
<a name="l02471"></a>02471    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d = sd-&gt;parent;
<a name="l02472"></a>02472    <span class="keywordtype">char</span> hint[<a class="code" href="channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>];
<a name="l02473"></a>02473    <span class="keywordtype">int</span> callstate = <a class="code" href="chan__skinny_8c.html#a171401581bc9313c20cec69fe8ddc7ee">SKINNY_CALLREMOTEMULTILINE</a>;
<a name="l02474"></a>02474    <span class="keywordtype">int</span> lamp = <a class="code" href="chan__skinny_8c.html#a87243536bbb96a314e88cfadd810f639">SKINNY_LAMP_OFF</a>;
<a name="l02475"></a>02475 
<a name="l02476"></a>02476    <span class="keywordflow">switch</span> (state) {
<a name="l02477"></a>02477    <span class="keywordflow">case</span> <a class="code" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625faf53cb090b99fb8e952c8151990bd4192">AST_EXTENSION_DEACTIVATED</a>: <span class="comment">/* Retry after a while */</span>
<a name="l02478"></a>02478    <span class="keywordflow">case</span> <a class="code" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa3e2a2f5572580f74e94b6d5e80261ea7">AST_EXTENSION_REMOVED</a>:     <span class="comment">/* Extension is gone */</span>
<a name="l02479"></a>02479       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Extension state: Watcher for hint %s %s. Notify Device %s\n&quot;</span>, exten, state == <a class="code" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625faf53cb090b99fb8e952c8151990bd4192">AST_EXTENSION_DEACTIVATED</a> ? <span class="stringliteral">&quot;deactivated&quot;</span> : <span class="stringliteral">&quot;removed&quot;</span>, d-&gt;name);
<a name="l02480"></a>02480       sd-&gt;<a class="code" href="structskinny__speeddial.html#a70382561daaa758a201b7a711d566e24">stateid</a> = -1;
<a name="l02481"></a>02481       callstate = <a class="code" href="chan__skinny_8c.html#ad38b06a5edcc17eaa553739944e702e1">SKINNY_ONHOOK</a>;
<a name="l02482"></a>02482       lamp = <a class="code" href="chan__skinny_8c.html#a87243536bbb96a314e88cfadd810f639">SKINNY_LAMP_OFF</a>;
<a name="l02483"></a>02483       <span class="keywordflow">break</span>;
<a name="l02484"></a>02484    <span class="keywordflow">case</span> <a class="code" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa4063bf4e94e14df04126be6f08cc7bfc">AST_EXTENSION_RINGING</a>:
<a name="l02485"></a>02485    <span class="keywordflow">case</span> <a class="code" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa5820eb407f3a3dbc5046c97ad43ee1f3">AST_EXTENSION_UNAVAILABLE</a>:
<a name="l02486"></a>02486       callstate = <a class="code" href="chan__skinny_8c.html#a6bed741ef5e86581671d6c63ae9267c8">SKINNY_RINGIN</a>;
<a name="l02487"></a>02487       lamp = <a class="code" href="chan__skinny_8c.html#a92de27dd35149317b1c4cf78025b5b23">SKINNY_LAMP_BLINK</a>;
<a name="l02488"></a>02488       <span class="keywordflow">break</span>;
<a name="l02489"></a>02489    <span class="keywordflow">case</span> <a class="code" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fad62d357f0ccde2a718c374a0a4af2b98">AST_EXTENSION_BUSY</a>: <span class="comment">/* callstate = SKINNY_BUSY wasn&apos;t wanting to work - I&apos;ll settle for this */</span>
<a name="l02490"></a>02490    <span class="keywordflow">case</span> <a class="code" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa47e9214860b5f9b887945f7cd1baec1a">AST_EXTENSION_INUSE</a>:
<a name="l02491"></a>02491       callstate = <a class="code" href="chan__skinny_8c.html#a171401581bc9313c20cec69fe8ddc7ee">SKINNY_CALLREMOTEMULTILINE</a>;
<a name="l02492"></a>02492       lamp = <a class="code" href="chan__skinny_8c.html#a360e677a1a8e92ab455b8c354a15d969">SKINNY_LAMP_ON</a>;
<a name="l02493"></a>02493       <span class="keywordflow">break</span>;
<a name="l02494"></a>02494    <span class="keywordflow">case</span> <a class="code" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa83180bb058ded006c01229431fc887f9">AST_EXTENSION_ONHOLD</a>:
<a name="l02495"></a>02495       callstate = <a class="code" href="chan__skinny_8c.html#a4a2a093850ad1fe42d691104a8efcb5a">SKINNY_HOLD</a>;
<a name="l02496"></a>02496       lamp = <a class="code" href="chan__skinny_8c.html#a7de4e252b70c1f9022529a7de2c16344">SKINNY_LAMP_WINK</a>;
<a name="l02497"></a>02497       <span class="keywordflow">break</span>;
<a name="l02498"></a>02498    <span class="keywordflow">case</span> <a class="code" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa435abb1e907b1cee83ec44d2d77866e6">AST_EXTENSION_NOT_INUSE</a>:
<a name="l02499"></a>02499    <span class="keywordflow">default</span>:
<a name="l02500"></a>02500       callstate = <a class="code" href="chan__skinny_8c.html#ad38b06a5edcc17eaa553739944e702e1">SKINNY_ONHOOK</a>;
<a name="l02501"></a>02501       lamp = <a class="code" href="chan__skinny_8c.html#a87243536bbb96a314e88cfadd810f639">SKINNY_LAMP_OFF</a>;
<a name="l02502"></a>02502       <span class="keywordflow">break</span>;
<a name="l02503"></a>02503    }
<a name="l02504"></a>02504 
<a name="l02505"></a>02505    <span class="keywordflow">if</span> (<a class="code" href="pbx_8h.html#ac778ac642def88a06e5d59e11a964c43" title="If an extension hint exists, return non-zero.">ast_get_hint</a>(hint, <span class="keyword">sizeof</span>(hint), NULL, 0, NULL, sd-&gt;<a class="code" href="structskinny__speeddial.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, sd-&gt;<a class="code" href="structskinny__speeddial.html#a78d4847658b695383d849efd12399b38">exten</a>)) {
<a name="l02506"></a>02506       <span class="comment">/* If they are not registered, we will override notification and show no availability */</span>
<a name="l02507"></a>02507       <span class="keywordflow">if</span> (<a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee" title="Device States.">ast_device_state</a>(hint) == <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeafac147cbabf3ccb80e50e86027710549">AST_DEVICE_UNAVAILABLE</a>) {
<a name="l02508"></a>02508          callstate = <a class="code" href="chan__skinny_8c.html#ad38b06a5edcc17eaa553739944e702e1">SKINNY_ONHOOK</a>;
<a name="l02509"></a>02509          lamp = <a class="code" href="chan__skinny_8c.html#a4e1cd9416902608f4249e5ecd8caf578">SKINNY_LAMP_FLASH</a>;
<a name="l02510"></a>02510       }
<a name="l02511"></a>02511    }
<a name="l02512"></a>02512 
<a name="l02513"></a>02513    <a class="code" href="chan__skinny_8c.html#aa16aabd900fdb4bd057303387115959f">transmit_lamp_indication</a>(d, <a class="code" href="chan__skinny_8c.html#af5c47ae0f0932f1d461f5b7b4cc0b095">STIMULUS_LINE</a>, sd-&gt;<a class="code" href="structskinny__speeddial.html#a6fd216872447cfe5f757d2ce47fea6fb">instance</a>, lamp);
<a name="l02514"></a>02514    <a class="code" href="chan__skinny_8c.html#a0cb936a217935cdbaa71cc6cb5171b44">transmit_callstate</a>(d, sd-&gt;<a class="code" href="structskinny__speeddial.html#a6fd216872447cfe5f757d2ce47fea6fb">instance</a>, callstate, 0);
<a name="l02515"></a>02515    sd-&gt;<a class="code" href="structskinny__speeddial.html#a0078d2e3ae10f15d7634c01199f33d4f">laststate</a> = state;
<a name="l02516"></a>02516 
<a name="l02517"></a>02517    <span class="keywordflow">return</span> 0;
<a name="l02518"></a>02518 }
<a name="l02519"></a>02519 
<a name="l02520"></a><a class="code" href="chan__skinny_8c.html#a46e4523f99409c6696dc775ed6a5e5ed">02520</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__skinny_8c.html#a46e4523f99409c6696dc775ed6a5e5ed">mwi_event_cb</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structast__event.html" title="An event.">ast_event</a> *event, <span class="keywordtype">void</span> *userdata)
<a name="l02521"></a>02521 {
<a name="l02522"></a>02522    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l = userdata;
<a name="l02523"></a>02523    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d = l-&gt;device;
<a name="l02524"></a>02524    <span class="keywordflow">if</span> (d) {
<a name="l02525"></a>02525       <span class="keyword">struct </span><a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a> = d-&gt;<a class="code" href="structskinny__device.html#a730a1864781691273d9f28b5ad1dadfd">session</a>;
<a name="l02526"></a>02526       <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l2;
<a name="l02527"></a>02527       <span class="keywordtype">int</span> new_msgs = 0;
<a name="l02528"></a>02528       <span class="keywordtype">int</span> dev_msgs = 0;
<a name="l02529"></a>02529 
<a name="l02530"></a>02530       <span class="keywordflow">if</span> (s) {
<a name="l02531"></a>02531          <span class="keywordflow">if</span> (event) {
<a name="l02532"></a>02532             l-&gt;newmsgs = <a class="code" href="event_8h.html#a317f6947b933acd0da82df6e9a4672e5" title="Get the value of an information element that has an integer payload.">ast_event_get_ie_uint</a>(event, <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491aff40847f0450f17c96e94e721aee38f2" title="Number of new messages Used by: AST_EVENT_MWI Payload type: UINT.">AST_EVENT_IE_NEWMSGS</a>);
<a name="l02533"></a>02533          }
<a name="l02534"></a>02534 
<a name="l02535"></a>02535          <span class="keywordflow">if</span> (l-&gt;newmsgs) {
<a name="l02536"></a>02536             <a class="code" href="chan__skinny_8c.html#aa16aabd900fdb4bd057303387115959f">transmit_lamp_indication</a>(d, <a class="code" href="chan__skinny_8c.html#add30eeef22fe342e5e7e92354ece088e">STIMULUS_VOICEMAIL</a>, l-&gt;instance, l-&gt;mwiblink?<a class="code" href="chan__skinny_8c.html#a92de27dd35149317b1c4cf78025b5b23">SKINNY_LAMP_BLINK</a>:<a class="code" href="chan__skinny_8c.html#a360e677a1a8e92ab455b8c354a15d969">SKINNY_LAMP_ON</a>);
<a name="l02537"></a>02537          } <span class="keywordflow">else</span> {
<a name="l02538"></a>02538             <a class="code" href="chan__skinny_8c.html#aa16aabd900fdb4bd057303387115959f">transmit_lamp_indication</a>(d, <a class="code" href="chan__skinny_8c.html#add30eeef22fe342e5e7e92354ece088e">STIMULUS_VOICEMAIL</a>, l-&gt;instance, <a class="code" href="chan__skinny_8c.html#a87243536bbb96a314e88cfadd810f639">SKINNY_LAMP_OFF</a>);
<a name="l02539"></a>02539          }
<a name="l02540"></a>02540 
<a name="l02541"></a>02541          <span class="comment">/* find out wether the device lamp should be on or off */</span>
<a name="l02542"></a>02542          <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;lines, l2, list) {
<a name="l02543"></a>02543             <span class="keywordflow">if</span> (l2-&gt;newmsgs) {
<a name="l02544"></a>02544                dev_msgs++;
<a name="l02545"></a>02545             }
<a name="l02546"></a>02546          }
<a name="l02547"></a>02547 
<a name="l02548"></a>02548          <span class="keywordflow">if</span> (dev_msgs) {
<a name="l02549"></a>02549             <a class="code" href="chan__skinny_8c.html#aa16aabd900fdb4bd057303387115959f">transmit_lamp_indication</a>(d, <a class="code" href="chan__skinny_8c.html#add30eeef22fe342e5e7e92354ece088e">STIMULUS_VOICEMAIL</a>, 0, d-&gt;mwiblink?<a class="code" href="chan__skinny_8c.html#a92de27dd35149317b1c4cf78025b5b23">SKINNY_LAMP_BLINK</a>:<a class="code" href="chan__skinny_8c.html#a360e677a1a8e92ab455b8c354a15d969">SKINNY_LAMP_ON</a>);
<a name="l02550"></a>02550          } <span class="keywordflow">else</span> {
<a name="l02551"></a>02551             <a class="code" href="chan__skinny_8c.html#aa16aabd900fdb4bd057303387115959f">transmit_lamp_indication</a>(d, <a class="code" href="chan__skinny_8c.html#add30eeef22fe342e5e7e92354ece088e">STIMULUS_VOICEMAIL</a>, 0, <a class="code" href="chan__skinny_8c.html#a87243536bbb96a314e88cfadd810f639">SKINNY_LAMP_OFF</a>);
<a name="l02552"></a>02552          }
<a name="l02553"></a>02553          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Skinny mwi_event_cb found %d new messages\n&quot;</span>, new_msgs);
<a name="l02554"></a>02554       }
<a name="l02555"></a>02555    }
<a name="l02556"></a>02556 }
<a name="l02557"></a>02557 
<a name="l02558"></a>02558 <span class="comment">/* I do not believe skinny can deal with video.</span>
<a name="l02559"></a>02559 <span class="comment">   Anyone know differently? */</span>
<a name="l02560"></a>02560 <span class="comment">/* Yes, it can.  Currently 7985 and Cisco VT Advantage do video. */</span>
<a name="l02561"></a><a class="code" href="chan__skinny_8c.html#aa50aa354502f1dfa660ef303646914bb">02561</a> <span class="keyword">static</span> <span class="keyword">enum</span> <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95">ast_rtp_get_result</a> <a class="code" href="chan__skinny_8c.html#aa50aa354502f1dfa660ef303646914bb">skinny_get_vrtp_peer</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c, <span class="keyword">struct</span> <a class="code" href="structast__rtp.html" title="Structure representing a RTP session.">ast_rtp</a> **<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a>)
<a name="l02562"></a>02562 {
<a name="l02563"></a>02563    <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub = NULL;
<a name="l02564"></a>02564 
<a name="l02565"></a>02565    <span class="keywordflow">if</span> (!(sub = c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>) || !(sub-&gt;<a class="code" href="structskinny__subchannel.html#a65e8f978abd3f0206026969c627200a9">vrtp</a>))
<a name="l02566"></a>02566       <span class="keywordflow">return</span> <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>;
<a name="l02567"></a>02567 
<a name="l02568"></a>02568    *rtp = sub-&gt;<a class="code" href="structskinny__subchannel.html#a65e8f978abd3f0206026969c627200a9">vrtp</a>;
<a name="l02569"></a>02569 
<a name="l02570"></a>02570    <span class="keywordflow">return</span> <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ab591abc73866492b4b33dd96d9925136">AST_RTP_TRY_NATIVE</a>;
<a name="l02571"></a>02571 }
<a name="l02572"></a>02572 
<a name="l02573"></a><a class="code" href="chan__skinny_8c.html#add5a0c1b301395afe1888987dba7a792">02573</a> <span class="keyword">static</span> <span class="keyword">enum</span> <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95">ast_rtp_get_result</a> <a class="code" href="chan__skinny_8c.html#add5a0c1b301395afe1888987dba7a792">skinny_get_rtp_peer</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c, <span class="keyword">struct</span> <a class="code" href="structast__rtp.html" title="Structure representing a RTP session.">ast_rtp</a> **<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a>)
<a name="l02574"></a>02574 {
<a name="l02575"></a>02575    <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub = NULL;
<a name="l02576"></a>02576    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l;
<a name="l02577"></a>02577    <span class="keyword">enum</span> <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95">ast_rtp_get_result</a> res = <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ab591abc73866492b4b33dd96d9925136">AST_RTP_TRY_NATIVE</a>;
<a name="l02578"></a>02578 
<a name="l02579"></a>02579    <span class="keywordflow">if</span> (skinnydebug)
<a name="l02580"></a>02580       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;skinny_get_rtp_peer() Channel = %s\n&quot;</span>, c-&gt;name);
<a name="l02581"></a>02581 
<a name="l02582"></a>02582 
<a name="l02583"></a>02583    <span class="keywordflow">if</span> (!(sub = c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>))
<a name="l02584"></a>02584       <span class="keywordflow">return</span> <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>;
<a name="l02585"></a>02585 
<a name="l02586"></a>02586    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;sub-&gt;<a class="code" href="structskinny__subchannel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l02587"></a>02587 
<a name="l02588"></a>02588    <span class="keywordflow">if</span> (!(sub-&gt;<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a>)){
<a name="l02589"></a>02589       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;sub-&gt;<a class="code" href="structskinny__subchannel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l02590"></a>02590       <span class="keywordflow">return</span> <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>;
<a name="l02591"></a>02591    }
<a name="l02592"></a>02592    
<a name="l02593"></a>02593    *rtp = sub-&gt;<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a>;
<a name="l02594"></a>02594 
<a name="l02595"></a>02595    l = sub-&gt;parent;
<a name="l02596"></a>02596 
<a name="l02597"></a>02597    <span class="keywordflow">if</span> (!l-&gt;directmedia || l-&gt;nat){
<a name="l02598"></a>02598       res = <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95a8bc993394ab95ca4c2ac98f9477518fe">AST_RTP_TRY_PARTIAL</a>;
<a name="l02599"></a>02599       <span class="keywordflow">if</span> (skinnydebug)
<a name="l02600"></a>02600          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;skinny_get_rtp_peer() Using AST_RTP_TRY_PARTIAL \n&quot;</span>);
<a name="l02601"></a>02601    }
<a name="l02602"></a>02602 
<a name="l02603"></a>02603    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;sub-&gt;<a class="code" href="structskinny__subchannel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l02604"></a>02604 
<a name="l02605"></a>02605    <span class="keywordflow">return</span> res;
<a name="l02606"></a>02606 
<a name="l02607"></a>02607 }
<a name="l02608"></a>02608 
<a name="l02609"></a><a class="code" href="chan__skinny_8c.html#a03c2f8945a4c93426308ae7359e3cdc0">02609</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a03c2f8945a4c93426308ae7359e3cdc0">skinny_set_rtp_peer</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c, <span class="keyword">struct</span> <a class="code" href="structast__rtp.html" title="Structure representing a RTP session.">ast_rtp</a> *<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, <span class="keyword">struct</span> <a class="code" href="structast__rtp.html" title="Structure representing a RTP session.">ast_rtp</a> *<a class="code" href="structskinny__subchannel.html#a65e8f978abd3f0206026969c627200a9">vrtp</a>, <span class="keyword">struct</span> <a class="code" href="structast__rtp.html" title="Structure representing a RTP session.">ast_rtp</a> *trtp, <span class="keywordtype">int</span> codecs, <span class="keywordtype">int</span> nat_active)
<a name="l02610"></a>02610 {
<a name="l02611"></a>02611    <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub;
<a name="l02612"></a>02612    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l;
<a name="l02613"></a>02613    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d;
<a name="l02614"></a>02614    <span class="keyword">struct </span><a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>;
<a name="l02615"></a>02615    <span class="keyword">struct </span><a class="code" href="structast__format__list.html" title="Definition of supported media formats (codecs).">ast_format_list</a> fmt;
<a name="l02616"></a>02616    <span class="keyword">struct </span>sockaddr_in us;
<a name="l02617"></a>02617    <span class="keyword">struct </span>sockaddr_in them;
<a name="l02618"></a>02618    <span class="keyword">struct </span><a class="code" href="structskinny__req.html">skinny_req</a> *req;
<a name="l02619"></a>02619    
<a name="l02620"></a>02620    sub = c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l02621"></a>02621 
<a name="l02622"></a>02622    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>)
<a name="l02623"></a>02623       <span class="keywordflow">return</span> 0;
<a name="l02624"></a>02624 
<a name="l02625"></a>02625    <span class="keywordflow">if</span> (!sub) {
<a name="l02626"></a>02626       <span class="keywordflow">return</span> -1;
<a name="l02627"></a>02627    }
<a name="l02628"></a>02628 
<a name="l02629"></a>02629    l = sub-&gt;parent;
<a name="l02630"></a>02630    d = l-&gt;device;
<a name="l02631"></a>02631    s = d-&gt;<a class="code" href="structskinny__device.html#a730a1864781691273d9f28b5ad1dadfd">session</a>;
<a name="l02632"></a>02632 
<a name="l02633"></a>02633    <span class="keywordflow">if</span> (rtp){
<a name="l02634"></a>02634       <a class="code" href="rtp_8h.html#aa1ffde0e800995c386729bc5eaf82e7c">ast_rtp_get_peer</a>(rtp, &amp;them);
<a name="l02635"></a>02635 
<a name="l02636"></a>02636       <span class="comment">/* Shutdown any early-media or previous media on re-invite */</span>
<a name="l02637"></a>02637       <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structstop__media__transmission__message.html">stop_media_transmission_message</a>), <a class="code" href="chan__skinny_8c.html#acb883512e3f609a62dde13c5d5cb4879">STOP_MEDIA_TRANSMISSION_MESSAGE</a>)))
<a name="l02638"></a>02638          <span class="keywordflow">return</span> -1;
<a name="l02639"></a>02639 
<a name="l02640"></a>02640       req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a684ad1caea9173fbc13ab7be0ae45d9b">stopmedia</a>.<a class="code" href="structstop__media__transmission__message.html#aad8282aaef639f3310f833e9b44a541e">conferenceId</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l02641"></a>02641       req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a684ad1caea9173fbc13ab7be0ae45d9b">stopmedia</a>.<a class="code" href="structstop__media__transmission__message.html#ae7a8ce78da6117ddd5e98de15f85af23">passThruPartyId</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l02642"></a>02642       <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l02643"></a>02643 
<a name="l02644"></a>02644       <span class="keywordflow">if</span> (skinnydebug)
<a name="l02645"></a>02645          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Peerip = %s:%d\n&quot;</span>, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(them.sin_addr), ntohs(them.sin_port));
<a name="l02646"></a>02646 
<a name="l02647"></a>02647       <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structstart__media__transmission__message.html">start_media_transmission_message</a>), <a class="code" href="chan__skinny_8c.html#aa8c4fd39788d87301b7b97543537a12c">START_MEDIA_TRANSMISSION_MESSAGE</a>)))
<a name="l02648"></a>02648          <span class="keywordflow">return</span> -1;
<a name="l02649"></a>02649 
<a name="l02650"></a>02650       fmt = <a class="code" href="frame_8h.html#ac9789499b866949ab31bab025b497964" title="Get packet size for codec.">ast_codec_pref_getsize</a>(&amp;l-&gt;prefs, <a class="code" href="channel_8h.html#a4d78194779a26341c3ec7298b450b9ed" title="Pick the best audio codec.">ast_best_codec</a>(l-&gt;capability));
<a name="l02651"></a>02651 
<a name="l02652"></a>02652       <span class="keywordflow">if</span> (skinnydebug)
<a name="l02653"></a>02653          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Setting payloadType to &apos;%d&apos; (%d ms)\n&quot;</span>, fmt.<a class="code" href="structast__format__list.html#ad1e28a1a66a25529b0b61b9ca4e66d44">bits</a>, fmt.<a class="code" href="structast__format__list.html#a8082330d5592ca639ddd6f7be0c0c39b">cur_ms</a>);
<a name="l02654"></a>02654 
<a name="l02655"></a>02655       req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a42e0451ac6706cc1e6140aa7f48472a3">startmedia</a>.<a class="code" href="structstart__media__transmission__message.html#aad8282aaef639f3310f833e9b44a541e">conferenceId</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l02656"></a>02656       req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a42e0451ac6706cc1e6140aa7f48472a3">startmedia</a>.<a class="code" href="structstart__media__transmission__message.html#ae7a8ce78da6117ddd5e98de15f85af23">passThruPartyId</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l02657"></a>02657       <span class="keywordflow">if</span> (!(l-&gt;directmedia) || (l-&gt;nat)){
<a name="l02658"></a>02658          <a class="code" href="rtp_8h.html#a307269685e6f067a6abe35a184c3bae6">ast_rtp_get_us</a>(rtp, &amp;us);
<a name="l02659"></a>02659          req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a42e0451ac6706cc1e6140aa7f48472a3">startmedia</a>.<a class="code" href="structstart__media__transmission__message.html#ac4946ecf0faa3d0281b86b9df56cbc6f">remoteIp</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(d-&gt;<a class="code" href="structskinny__device.html#aff045cc68524670d4355f882c7ac6271">ourip</a>.s_addr);
<a name="l02660"></a>02660          req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a42e0451ac6706cc1e6140aa7f48472a3">startmedia</a>.<a class="code" href="structstart__media__transmission__message.html#a52c51c79d848efbf9fbf291a2f2645c6">remotePort</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(ntohs(us.sin_port));
<a name="l02661"></a>02661       } <span class="keywordflow">else</span> {
<a name="l02662"></a>02662          req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a42e0451ac6706cc1e6140aa7f48472a3">startmedia</a>.<a class="code" href="structstart__media__transmission__message.html#ac4946ecf0faa3d0281b86b9df56cbc6f">remoteIp</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(them.sin_addr.s_addr);
<a name="l02663"></a>02663          req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a42e0451ac6706cc1e6140aa7f48472a3">startmedia</a>.<a class="code" href="structstart__media__transmission__message.html#a52c51c79d848efbf9fbf291a2f2645c6">remotePort</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(ntohs(them.sin_port));
<a name="l02664"></a>02664       }
<a name="l02665"></a>02665       req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a42e0451ac6706cc1e6140aa7f48472a3">startmedia</a>.<a class="code" href="structstart__media__transmission__message.html#ada112a060915d95bc25fb2917272914f">packetSize</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(fmt.<a class="code" href="structast__format__list.html#a8082330d5592ca639ddd6f7be0c0c39b">cur_ms</a>);
<a name="l02666"></a>02666       req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a42e0451ac6706cc1e6140aa7f48472a3">startmedia</a>.<a class="code" href="structstart__media__transmission__message.html#aaf0b83c81dec67533a9edcf9f4c3c760">payloadType</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(<a class="code" href="chan__skinny_8c.html#a8e3a410f226a1ae0959bc3604421bcb7">codec_ast2skinny</a>(fmt.<a class="code" href="structast__format__list.html#ad1e28a1a66a25529b0b61b9ca4e66d44">bits</a>));
<a name="l02667"></a>02667       req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a42e0451ac6706cc1e6140aa7f48472a3">startmedia</a>.<a class="code" href="structstart__media__transmission__message.html#a5304bc4afe911142322308d69ffe6466">qualifier</a>.<a class="code" href="structmedia__qualifier.html#a3f52bd316aba6dea4bc6374f5e4b0258">precedence</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(127);
<a name="l02668"></a>02668       req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a42e0451ac6706cc1e6140aa7f48472a3">startmedia</a>.<a class="code" href="structstart__media__transmission__message.html#a5304bc4afe911142322308d69ffe6466">qualifier</a>.<a class="code" href="structmedia__qualifier.html#af22582b468205e3b1c3681dc5c28aa6b">vad</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(0);
<a name="l02669"></a>02669       req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a42e0451ac6706cc1e6140aa7f48472a3">startmedia</a>.<a class="code" href="structstart__media__transmission__message.html#a5304bc4afe911142322308d69ffe6466">qualifier</a>.<a class="code" href="structmedia__qualifier.html#ab55cdaa8e99da057ceeb21efdd56909a">packets</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(0);
<a name="l02670"></a>02670       req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a42e0451ac6706cc1e6140aa7f48472a3">startmedia</a>.<a class="code" href="structstart__media__transmission__message.html#a5304bc4afe911142322308d69ffe6466">qualifier</a>.<a class="code" href="structmedia__qualifier.html#a497243c8d5b9134495d3a68af76693c8">bitRate</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(0);
<a name="l02671"></a>02671       <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l02672"></a>02672 
<a name="l02673"></a>02673       <span class="keywordflow">return</span> 0;
<a name="l02674"></a>02674    }
<a name="l02675"></a>02675    <span class="comment">/* Need a return here to break the bridge */</span>
<a name="l02676"></a>02676    <span class="keywordflow">return</span> 0;
<a name="l02677"></a>02677 }
<a name="l02678"></a>02678 
<a name="l02679"></a><a class="code" href="chan__skinny_8c.html#a9ab841fc2038e3f502fdc47d0a0fb5d9">02679</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__rtp__protocol.html" title="This is the structure that binds a channel (SIP/Jingle/H.323) to the RTP subsystem...">ast_rtp_protocol</a> <a class="code" href="chan__skinny_8c.html#a9ab841fc2038e3f502fdc47d0a0fb5d9">skinny_rtp</a> = {
<a name="l02680"></a>02680    .<a class="code" href="structast__rtp__protocol.html#a8ff938fb2f815be425fd2859a21e6d61">type</a> = <span class="stringliteral">&quot;Skinny&quot;</span>,
<a name="l02681"></a>02681    .get_rtp_info = <a class="code" href="chan__skinny_8c.html#add5a0c1b301395afe1888987dba7a792">skinny_get_rtp_peer</a>,
<a name="l02682"></a>02682    .get_vrtp_info = <a class="code" href="chan__skinny_8c.html#aa50aa354502f1dfa660ef303646914bb">skinny_get_vrtp_peer</a>,
<a name="l02683"></a>02683    .set_rtp_peer = <a class="code" href="chan__skinny_8c.html#a03c2f8945a4c93426308ae7359e3cdc0">skinny_set_rtp_peer</a>,
<a name="l02684"></a>02684 };
<a name="l02685"></a>02685 
<a name="l02686"></a><a class="code" href="chan__skinny_8c.html#a092e3458bbcb8f2c2f2d10ed8ea26a97">02686</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="chan__skinny_8c.html#a092e3458bbcb8f2c2f2d10ed8ea26a97">handle_skinny_set_debug</a>(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="structast__cli__args.html">ast_cli_args</a> *a)
<a name="l02687"></a>02687 {
<a name="l02688"></a>02688    <span class="keywordflow">switch</span> (cmd) {
<a name="l02689"></a>02689    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l02690"></a>02690 <span class="preprocessor">#ifdef SKINNY_DEVMODE</span>
<a name="l02691"></a>02691 <span class="preprocessor"></span>      e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;skinny set debug {off|on|packet}&quot;</span>;
<a name="l02692"></a>02692       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l02693"></a>02693          <span class="stringliteral">&quot;Usage: skinny set debug {off|on|packet}\n&quot;</span>
<a name="l02694"></a>02694          <span class="stringliteral">&quot;       Enables/Disables dumping of Skinny packets for debugging purposes\n&quot;</span>;
<a name="l02695"></a>02695 <span class="preprocessor">#else</span>
<a name="l02696"></a>02696 <span class="preprocessor"></span>      e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;skinny set debug {off|on}&quot;</span>;
<a name="l02697"></a>02697       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l02698"></a>02698          <span class="stringliteral">&quot;Usage: skinny set debug {off|on}\n&quot;</span>
<a name="l02699"></a>02699          <span class="stringliteral">&quot;       Enables/Disables dumping of Skinny packets for debugging purposes\n&quot;</span>;
<a name="l02700"></a>02700 <span class="preprocessor">#endif</span>
<a name="l02701"></a>02701 <span class="preprocessor"></span>      <span class="keywordflow">return</span> NULL;
<a name="l02702"></a>02702    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l02703"></a>02703       <span class="keywordflow">return</span> NULL;
<a name="l02704"></a>02704    }
<a name="l02705"></a>02705    
<a name="l02706"></a>02706    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>)
<a name="l02707"></a>02707       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l02708"></a>02708 
<a name="l02709"></a>02709    <span class="keywordflow">if</span> (!strncasecmp(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a> - 1], <span class="stringliteral">&quot;on&quot;</span>, 2)) {
<a name="l02710"></a>02710       skinnydebug = 1;
<a name="l02711"></a>02711       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Skinny Debugging Enabled\n&quot;</span>);
<a name="l02712"></a>02712       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l02713"></a>02713    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncasecmp(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a> - 1], <span class="stringliteral">&quot;off&quot;</span>, 3)) {
<a name="l02714"></a>02714       skinnydebug = 0;
<a name="l02715"></a>02715       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Skinny Debugging Disabled\n&quot;</span>);
<a name="l02716"></a>02716       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l02717"></a>02717 <span class="preprocessor">#ifdef SKINNY_DEVMODE</span>
<a name="l02718"></a>02718 <span class="preprocessor"></span>   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncasecmp(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a> - 1], <span class="stringliteral">&quot;packet&quot;</span>, 6)) {
<a name="l02719"></a>02719       skinnydebug = 2;
<a name="l02720"></a>02720       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Skinny Debugging Enabled including Packets\n&quot;</span>);
<a name="l02721"></a>02721       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l02722"></a>02722 <span class="preprocessor">#endif</span>
<a name="l02723"></a>02723 <span class="preprocessor"></span>   } <span class="keywordflow">else</span> {
<a name="l02724"></a>02724       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l02725"></a>02725    }
<a name="l02726"></a>02726 }
<a name="l02727"></a>02727 
<a name="l02728"></a><a class="code" href="chan__skinny_8c.html#aa9263b2b877126867940d57b86a8132d">02728</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="chan__skinny_8c.html#aa9263b2b877126867940d57b86a8132d">handle_skinny_reload</a>(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="structast__cli__args.html">ast_cli_args</a> *a)
<a name="l02729"></a>02729 {
<a name="l02730"></a>02730    <span class="keywordflow">switch</span> (cmd) {
<a name="l02731"></a>02731    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l02732"></a>02732       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;skinny reload&quot;</span>;
<a name="l02733"></a>02733       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l02734"></a>02734          <span class="stringliteral">&quot;Usage: skinny reload\n&quot;</span>
<a name="l02735"></a>02735          <span class="stringliteral">&quot;       Reloads the chan_skinny configuration\n&quot;</span>;
<a name="l02736"></a>02736       <span class="keywordflow">return</span> NULL;
<a name="l02737"></a>02737    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l02738"></a>02738       <span class="keywordflow">return</span> NULL;
<a name="l02739"></a>02739    }
<a name="l02740"></a>02740    
<a name="l02741"></a>02741    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>)
<a name="l02742"></a>02742       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l02743"></a>02743 
<a name="l02744"></a>02744    <a class="code" href="chan__skinny_8c.html#aa53f60b698c21b4f290b5defcf53ef9b">skinny_reload</a>();
<a name="l02745"></a>02745    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l02746"></a>02746 
<a name="l02747"></a>02747 }
<a name="l02748"></a>02748 
<a name="l02749"></a><a class="code" href="chan__skinny_8c.html#a77b3d102d05720db559c40b9d419ca72">02749</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="chan__skinny_8c.html#a77b3d102d05720db559c40b9d419ca72">complete_skinny_devices</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ael_8tab_8c.html#a836535f59bf515522a395858a8029d42">word</a>, <span class="keywordtype">int</span> <a class="code" href="structstate.html">state</a>)
<a name="l02750"></a>02750 {
<a name="l02751"></a>02751    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d;
<a name="l02752"></a>02752    <span class="keywordtype">char</span> *result = NULL;
<a name="l02753"></a>02753    <span class="keywordtype">int</span> wordlen = strlen(word), which = 0;
<a name="l02754"></a>02754 
<a name="l02755"></a>02755    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>, d, list) {
<a name="l02756"></a>02756       <span class="keywordflow">if</span> (!strncasecmp(word, d-&gt;id, wordlen) &amp;&amp; ++which &gt; state)
<a name="l02757"></a>02757          result = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(d-&gt;id);
<a name="l02758"></a>02758    }
<a name="l02759"></a>02759 
<a name="l02760"></a>02760    <span class="keywordflow">return</span> result;
<a name="l02761"></a>02761 }
<a name="l02762"></a>02762 
<a name="l02763"></a><a class="code" href="chan__skinny_8c.html#a1330941685fd5dc9308d2f91dd7b70d1">02763</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="chan__skinny_8c.html#a1330941685fd5dc9308d2f91dd7b70d1">complete_skinny_show_device</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *line, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ael_8tab_8c.html#a836535f59bf515522a395858a8029d42">word</a>, <span class="keywordtype">int</span> pos, <span class="keywordtype">int</span> <a class="code" href="structstate.html">state</a>)
<a name="l02764"></a>02764 {
<a name="l02765"></a>02765    <span class="keywordflow">return</span> (pos == 3 ? <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(<a class="code" href="chan__skinny_8c.html#a77b3d102d05720db559c40b9d419ca72">complete_skinny_devices</a>(word, state)) : NULL);
<a name="l02766"></a>02766 }
<a name="l02767"></a>02767 
<a name="l02768"></a><a class="code" href="chan__skinny_8c.html#acc3e276fa79c2b4a0c67a5a588540439">02768</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="chan__skinny_8c.html#acc3e276fa79c2b4a0c67a5a588540439">complete_skinny_reset</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *line, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ael_8tab_8c.html#a836535f59bf515522a395858a8029d42">word</a>, <span class="keywordtype">int</span> pos, <span class="keywordtype">int</span> <a class="code" href="structstate.html">state</a>)
<a name="l02769"></a>02769 {
<a name="l02770"></a>02770    <span class="keywordflow">return</span> (pos == 2 ? <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(<a class="code" href="chan__skinny_8c.html#a77b3d102d05720db559c40b9d419ca72">complete_skinny_devices</a>(word, state)) : NULL);
<a name="l02771"></a>02771 }
<a name="l02772"></a>02772 
<a name="l02773"></a><a class="code" href="chan__skinny_8c.html#aa1d32ef00ccadf4ded249067f83e8426">02773</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="chan__skinny_8c.html#aa1d32ef00ccadf4ded249067f83e8426">complete_skinny_show_line</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *line, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ael_8tab_8c.html#a836535f59bf515522a395858a8029d42">word</a>, <span class="keywordtype">int</span> pos, <span class="keywordtype">int</span> <a class="code" href="structstate.html">state</a>)
<a name="l02774"></a>02774 {
<a name="l02775"></a>02775    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d;
<a name="l02776"></a>02776    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l;
<a name="l02777"></a>02777    <span class="keywordtype">char</span> *result = NULL;
<a name="l02778"></a>02778    <span class="keywordtype">int</span> wordlen = strlen(word), which = 0;
<a name="l02779"></a>02779 
<a name="l02780"></a>02780    <span class="keywordflow">if</span> (pos != 3)
<a name="l02781"></a>02781       <span class="keywordflow">return</span> NULL;
<a name="l02782"></a>02782    
<a name="l02783"></a>02783    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>, d, list) {
<a name="l02784"></a>02784       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;lines, l, list) {
<a name="l02785"></a>02785          <span class="keywordflow">if</span> (!strncasecmp(word, l-&gt;name, wordlen) &amp;&amp; ++which &gt; state)
<a name="l02786"></a>02786             result = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(l-&gt;name);
<a name="l02787"></a>02787       }
<a name="l02788"></a>02788    }
<a name="l02789"></a>02789 
<a name="l02790"></a>02790    <span class="keywordflow">return</span> result;
<a name="l02791"></a>02791 }
<a name="l02792"></a>02792 
<a name="l02793"></a><a class="code" href="chan__skinny_8c.html#a90b8b765d7701285c46cd5b10f116605">02793</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="chan__skinny_8c.html#a90b8b765d7701285c46cd5b10f116605">handle_skinny_reset</a>(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="structast__cli__args.html">ast_cli_args</a> *a)
<a name="l02794"></a>02794 {
<a name="l02795"></a>02795    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d;
<a name="l02796"></a>02796    <span class="keyword">struct </span><a class="code" href="structskinny__req.html">skinny_req</a> *req;
<a name="l02797"></a>02797 
<a name="l02798"></a>02798    <span class="keywordflow">switch</span> (cmd) {
<a name="l02799"></a>02799    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l02800"></a>02800       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;skinny reset&quot;</span>;
<a name="l02801"></a>02801       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l02802"></a>02802          <span class="stringliteral">&quot;Usage: skinny reset &lt;DeviceId|DeviceName|all&gt; [restart]\n&quot;</span>
<a name="l02803"></a>02803          <span class="stringliteral">&quot;       Causes a Skinny device to reset itself, optionally with a full restart\n&quot;</span>;
<a name="l02804"></a>02804       <span class="keywordflow">return</span> NULL;
<a name="l02805"></a>02805    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l02806"></a>02806       <span class="keywordflow">return</span> <a class="code" href="chan__skinny_8c.html#acc3e276fa79c2b4a0c67a5a588540439">complete_skinny_reset</a>(a-&gt;<a class="code" href="structast__cli__args.html#a2a7a1aa13a4f14075411123a4495593c">line</a>, a-&gt;<a class="code" href="structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>, a-&gt;<a class="code" href="structast__cli__args.html#a1910d262855b71da353ed0d07a6c7823">pos</a>, a-&gt;<a class="code" href="structast__cli__args.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>);
<a name="l02807"></a>02807    }
<a name="l02808"></a>02808 
<a name="l02809"></a>02809    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> &lt; 3 || a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> &gt; 4)
<a name="l02810"></a>02810       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l02811"></a>02811 
<a name="l02812"></a>02812    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>);
<a name="l02813"></a>02813    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>, d, list) {
<a name="l02814"></a>02814       <span class="keywordtype">int</span> fullrestart = 0;
<a name="l02815"></a>02815       <span class="keywordflow">if</span> (!strcasecmp(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[2], d-&gt;id) || !strcasecmp(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[2], d-&gt;name) || !strcasecmp(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[2], <span class="stringliteral">&quot;all&quot;</span>)) {
<a name="l02816"></a>02816          <span class="keywordflow">if</span> (!(d-&gt;<a class="code" href="structskinny__device.html#a730a1864781691273d9f28b5ad1dadfd">session</a>))
<a name="l02817"></a>02817             <span class="keywordflow">continue</span>;
<a name="l02818"></a>02818 
<a name="l02819"></a>02819          <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structreset__message.html">reset_message</a>), <a class="code" href="chan__skinny_8c.html#afb6f653351a09b4b3bbbb0fbd3ba4f1e">RESET_MESSAGE</a>)))
<a name="l02820"></a>02820             <span class="keywordflow">continue</span>;
<a name="l02821"></a>02821 
<a name="l02822"></a>02822          <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> == 4 &amp;&amp; !strcasecmp(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3], <span class="stringliteral">&quot;restart&quot;</span>))
<a name="l02823"></a>02823             fullrestart = 1;
<a name="l02824"></a>02824 
<a name="l02825"></a>02825          <span class="keywordflow">if</span> (fullrestart)
<a name="l02826"></a>02826             req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#af94af305e2c5f2374e813e4eb240296c">reset</a>.<a class="code" href="structreset__message.html#a7a8191f03b981d7fd9ea45a66270833b">resetType</a> = 2;
<a name="l02827"></a>02827          <span class="keywordflow">else</span>
<a name="l02828"></a>02828             req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#af94af305e2c5f2374e813e4eb240296c">reset</a>.<a class="code" href="structreset__message.html#a7a8191f03b981d7fd9ea45a66270833b">resetType</a> = 1;
<a name="l02829"></a>02829 
<a name="l02830"></a>02830          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;%s device %s.\n&quot;</span>, (fullrestart) ? <span class="stringliteral">&quot;Restarting&quot;</span> : <span class="stringliteral">&quot;Resetting&quot;</span>, d-&gt;id);
<a name="l02831"></a>02831          <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l02832"></a>02832       }
<a name="l02833"></a>02833    }
<a name="l02834"></a>02834    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>);
<a name="l02835"></a>02835    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l02836"></a>02836 }
<a name="l02837"></a>02837 
<a name="l02838"></a><a class="code" href="chan__skinny_8c.html#ae45808725375598a00ceb17749f33207">02838</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="chan__skinny_8c.html#ae45808725375598a00ceb17749f33207">device2str</a>(<span class="keywordtype">int</span> type)
<a name="l02839"></a>02839 {
<a name="l02840"></a>02840    <span class="keywordtype">char</span> *tmp;
<a name="l02841"></a>02841 
<a name="l02842"></a>02842    <span class="keywordflow">switch</span> (type) {
<a name="l02843"></a>02843    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a8bf5a11e3d0cc22ee77a88151b9bee6b">SKINNY_DEVICE_NONE</a>:
<a name="l02844"></a>02844       <span class="keywordflow">return</span> <span class="stringliteral">&quot;No Device&quot;</span>;
<a name="l02845"></a>02845    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a3f3cd69f7c3fbc2a03f357123c699713">SKINNY_DEVICE_30SPPLUS</a>:
<a name="l02846"></a>02846       <span class="keywordflow">return</span> <span class="stringliteral">&quot;30SP Plus&quot;</span>;
<a name="l02847"></a>02847    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#af39bd902ef207e030753286d65681c7c">SKINNY_DEVICE_12SPPLUS</a>:
<a name="l02848"></a>02848       <span class="keywordflow">return</span> <span class="stringliteral">&quot;12SP Plus&quot;</span>;
<a name="l02849"></a>02849    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#ad18902e12cbd352d1af5cb39e4b370ca">SKINNY_DEVICE_12SP</a>:
<a name="l02850"></a>02850       <span class="keywordflow">return</span> <span class="stringliteral">&quot;12SP&quot;</span>;
<a name="l02851"></a>02851    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#ac1db4bfd5d17f22afbc4bf80d6337d54">SKINNY_DEVICE_12</a>:
<a name="l02852"></a>02852       <span class="keywordflow">return</span> <span class="stringliteral">&quot;12&quot;</span>;
<a name="l02853"></a>02853    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#ad1629fcaedb5583acbff4481fc3affb4">SKINNY_DEVICE_30VIP</a>:
<a name="l02854"></a>02854       <span class="keywordflow">return</span> <span class="stringliteral">&quot;30VIP&quot;</span>;
<a name="l02855"></a>02855    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a8d87016fbefca28ff0756886e24aa1f3">SKINNY_DEVICE_7910</a>:
<a name="l02856"></a>02856       <span class="keywordflow">return</span> <span class="stringliteral">&quot;7910&quot;</span>;
<a name="l02857"></a>02857    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a21bbc062b4e4c70b3789ef050b73174f">SKINNY_DEVICE_7960</a>:
<a name="l02858"></a>02858       <span class="keywordflow">return</span> <span class="stringliteral">&quot;7960&quot;</span>;
<a name="l02859"></a>02859    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a13b2375dace6af91acc78d6c694b1f88">SKINNY_DEVICE_7940</a>:
<a name="l02860"></a>02860       <span class="keywordflow">return</span> <span class="stringliteral">&quot;7940&quot;</span>;
<a name="l02861"></a>02861    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#afa9c2c4a21e3a321cf0c2c4adec1a05f">SKINNY_DEVICE_7935</a>:
<a name="l02862"></a>02862       <span class="keywordflow">return</span> <span class="stringliteral">&quot;7935&quot;</span>;
<a name="l02863"></a>02863    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a5916bc0fad835957681082ac3848bd2e">SKINNY_DEVICE_ATA186</a>:
<a name="l02864"></a>02864       <span class="keywordflow">return</span> <span class="stringliteral">&quot;ATA186&quot;</span>;
<a name="l02865"></a>02865    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a7178ace67146a2004b92c3cf46aec2c9">SKINNY_DEVICE_7941</a>:
<a name="l02866"></a>02866       <span class="keywordflow">return</span> <span class="stringliteral">&quot;7941&quot;</span>;
<a name="l02867"></a>02867    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#ae306befb4a743eb3e38f3f2bb2dbd59f">SKINNY_DEVICE_7971</a>:
<a name="l02868"></a>02868       <span class="keywordflow">return</span> <span class="stringliteral">&quot;7971&quot;</span>;
<a name="l02869"></a>02869    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a5bc5ce4a9c8f4198130d3ce756324f68">SKINNY_DEVICE_7914</a>:
<a name="l02870"></a>02870       <span class="keywordflow">return</span> <span class="stringliteral">&quot;7914&quot;</span>;
<a name="l02871"></a>02871    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#ac3cd7f69be6e51d64b6688a80a65fc92">SKINNY_DEVICE_7985</a>:
<a name="l02872"></a>02872       <span class="keywordflow">return</span> <span class="stringliteral">&quot;7985&quot;</span>;
<a name="l02873"></a>02873    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a92da7b5faa7ec3709f054f179937082c">SKINNY_DEVICE_7911</a>:
<a name="l02874"></a>02874       <span class="keywordflow">return</span> <span class="stringliteral">&quot;7911&quot;</span>;
<a name="l02875"></a>02875    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a81e679dbd7beefb8f09015996b53bd27">SKINNY_DEVICE_7961GE</a>:
<a name="l02876"></a>02876       <span class="keywordflow">return</span> <span class="stringliteral">&quot;7961GE&quot;</span>;
<a name="l02877"></a>02877    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a171ee3ea3cd771beb545e9741196516d">SKINNY_DEVICE_7941GE</a>:
<a name="l02878"></a>02878       <span class="keywordflow">return</span> <span class="stringliteral">&quot;7941GE&quot;</span>;
<a name="l02879"></a>02879    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a8dd826d1782563f838ed10bfcabe2e05">SKINNY_DEVICE_7931</a>:
<a name="l02880"></a>02880       <span class="keywordflow">return</span> <span class="stringliteral">&quot;7931&quot;</span>;
<a name="l02881"></a>02881    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a2cf2ea66eb12030fe401f0f68fa2623d">SKINNY_DEVICE_7921</a>:
<a name="l02882"></a>02882       <span class="keywordflow">return</span> <span class="stringliteral">&quot;7921&quot;</span>;
<a name="l02883"></a>02883    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#ab68f0d8b6cb25f78ad3b7491f20fcd8e">SKINNY_DEVICE_7906</a>:
<a name="l02884"></a>02884       <span class="keywordflow">return</span> <span class="stringliteral">&quot;7906&quot;</span>;
<a name="l02885"></a>02885    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a4ae851d94958aab0ec8c3410f7e2a15d">SKINNY_DEVICE_7962</a>:
<a name="l02886"></a>02886       <span class="keywordflow">return</span> <span class="stringliteral">&quot;7962&quot;</span>;
<a name="l02887"></a>02887    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a3bb0cce3c6fbeabf3fa67e0a316cf535">SKINNY_DEVICE_7937</a>:
<a name="l02888"></a>02888       <span class="keywordflow">return</span> <span class="stringliteral">&quot;7937&quot;</span>;
<a name="l02889"></a>02889    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a10266707a30856e2d0f3205b5e4a1ccd">SKINNY_DEVICE_7942</a>:
<a name="l02890"></a>02890       <span class="keywordflow">return</span> <span class="stringliteral">&quot;7942&quot;</span>;
<a name="l02891"></a>02891    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a11d00fd199be58f222cafe9df0e4669e">SKINNY_DEVICE_7945</a>:
<a name="l02892"></a>02892       <span class="keywordflow">return</span> <span class="stringliteral">&quot;7945&quot;</span>;
<a name="l02893"></a>02893    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#ab61a7c473b18188f04fb35186ed35976">SKINNY_DEVICE_7965</a>:
<a name="l02894"></a>02894       <span class="keywordflow">return</span> <span class="stringliteral">&quot;7965&quot;</span>;
<a name="l02895"></a>02895    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a669bfc638ff207829d2e063533bcd7e8">SKINNY_DEVICE_7975</a>:
<a name="l02896"></a>02896       <span class="keywordflow">return</span> <span class="stringliteral">&quot;7975&quot;</span>;
<a name="l02897"></a>02897    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a433816a4c8748c37ec6ff4d6fe0430aa">SKINNY_DEVICE_7905</a>:
<a name="l02898"></a>02898       <span class="keywordflow">return</span> <span class="stringliteral">&quot;7905&quot;</span>;
<a name="l02899"></a>02899    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a14da74571081caf219c70f4dc49499d8">SKINNY_DEVICE_7920</a>:
<a name="l02900"></a>02900       <span class="keywordflow">return</span> <span class="stringliteral">&quot;7920&quot;</span>;
<a name="l02901"></a>02901    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#af3a42f7afa01b1dbffacd7d07f9751b5">SKINNY_DEVICE_7970</a>:
<a name="l02902"></a>02902       <span class="keywordflow">return</span> <span class="stringliteral">&quot;7970&quot;</span>;
<a name="l02903"></a>02903    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a51c12165871b57ce6a1deffecea01b17">SKINNY_DEVICE_7912</a>:
<a name="l02904"></a>02904       <span class="keywordflow">return</span> <span class="stringliteral">&quot;7912&quot;</span>;
<a name="l02905"></a>02905    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a9a7988ad601a91351534202a8e1ad43e">SKINNY_DEVICE_7902</a>:
<a name="l02906"></a>02906       <span class="keywordflow">return</span> <span class="stringliteral">&quot;7902&quot;</span>;
<a name="l02907"></a>02907    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#aa82c3d86ef6e9bdda657d0637a56f0b3">SKINNY_DEVICE_CIPC</a>:
<a name="l02908"></a>02908       <span class="keywordflow">return</span> <span class="stringliteral">&quot;IP Communicator&quot;</span>;
<a name="l02909"></a>02909    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a47e3aa64ee6a6f5e659bad94b9576eee">SKINNY_DEVICE_7961</a>:
<a name="l02910"></a>02910       <span class="keywordflow">return</span> <span class="stringliteral">&quot;7961&quot;</span>;
<a name="l02911"></a>02911    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a6e10ac13a55648f43ab0769552b3dc8e">SKINNY_DEVICE_7936</a>:
<a name="l02912"></a>02912       <span class="keywordflow">return</span> <span class="stringliteral">&quot;7936&quot;</span>;
<a name="l02913"></a>02913    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a032655a31a1da3ff3a8853e8511d9dd9">SKINNY_DEVICE_SCCPGATEWAY_AN</a>:
<a name="l02914"></a>02914       <span class="keywordflow">return</span> <span class="stringliteral">&quot;SCCPGATEWAY_AN&quot;</span>;
<a name="l02915"></a>02915    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a62fe3f5742eb03458a14f2dd241d093a">SKINNY_DEVICE_SCCPGATEWAY_BRI</a>:
<a name="l02916"></a>02916       <span class="keywordflow">return</span> <span class="stringliteral">&quot;SCCPGATEWAY_BRI&quot;</span>;
<a name="l02917"></a>02917    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#af1d2fd59588cba882a9566324087a8a5">SKINNY_DEVICE_UNKNOWN</a>:
<a name="l02918"></a>02918       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Unknown&quot;</span>;
<a name="l02919"></a>02919    <span class="keywordflow">default</span>:
<a name="l02920"></a>02920       <span class="keywordflow">if</span> (!(tmp = <a class="code" href="threadstorage_8h.html#a9153839e218c987b2ae47cbd39ac1ab5" title="Retrieve thread storage.">ast_threadstorage_get</a>(&amp;device2str_threadbuf, <a class="code" href="chan__skinny_8c.html#af6d6ad028a582984d92f9ed46f91b78a">DEVICE2STR_BUFSIZE</a>)))
<a name="l02921"></a>02921          <span class="keywordflow">return</span> <span class="stringliteral">&quot;Unknown&quot;</span>;
<a name="l02922"></a>02922       snprintf(tmp, <a class="code" href="chan__skinny_8c.html#af6d6ad028a582984d92f9ed46f91b78a">DEVICE2STR_BUFSIZE</a>, <span class="stringliteral">&quot;UNKNOWN-%d&quot;</span>, type);
<a name="l02923"></a>02923       <span class="keywordflow">return</span> tmp;
<a name="l02924"></a>02924    }
<a name="l02925"></a>02925 }
<a name="l02926"></a>02926 <span class="comment"></span>
<a name="l02927"></a>02927 <span class="comment">/*! \brief Print codec list from preference to CLI/manager */</span>
<a name="l02928"></a><a class="code" href="chan__skinny_8c.html#a99c9993b8383b245d513d855fccdc7b9">02928</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__skinny_8c.html#a99c9993b8383b245d513d855fccdc7b9" title="Print codec list from preference to CLI/manager.">print_codec_to_cli</a>(<span class="keywordtype">int</span> fd, <span class="keyword">struct</span> <a class="code" href="structast__codec__pref.html">ast_codec_pref</a> *pref)
<a name="l02929"></a>02929 {
<a name="l02930"></a>02930    <span class="keywordtype">int</span> x, codec;
<a name="l02931"></a>02931 
<a name="l02932"></a>02932    <span class="keywordflow">for</span>(x = 0; x &lt; 32 ; x++) {
<a name="l02933"></a>02933       codec = <a class="code" href="frame_8h.html#af9dd4cbc4b715644df1afe4964169c9b" title="Codec located at a particular place in the preference index.">ast_codec_pref_index</a>(pref, x);
<a name="l02934"></a>02934       <span class="keywordflow">if</span> (!codec)
<a name="l02935"></a>02935          <span class="keywordflow">break</span>;
<a name="l02936"></a>02936       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(codec));
<a name="l02937"></a>02937       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;:%d&quot;</span>, pref-&gt;<a class="code" href="structast__codec__pref.html#a2b0514c4f4584036696b7b6e83985906">framing</a>[x]);
<a name="l02938"></a>02938       <span class="keywordflow">if</span> (x &lt; 31 &amp;&amp; <a class="code" href="frame_8h.html#af9dd4cbc4b715644df1afe4964169c9b" title="Codec located at a particular place in the preference index.">ast_codec_pref_index</a>(pref, x + 1))
<a name="l02939"></a>02939          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;,&quot;</span>);
<a name="l02940"></a>02940    }
<a name="l02941"></a>02941    <span class="keywordflow">if</span> (!x)
<a name="l02942"></a>02942       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;none&quot;</span>);
<a name="l02943"></a>02943 }
<a name="l02944"></a>02944 
<a name="l02945"></a><a class="code" href="chan__skinny_8c.html#a4c171021840024203e5664942cb797bb">02945</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="chan__skinny_8c.html#a4c171021840024203e5664942cb797bb">_skinny_show_devices</a>(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> *<a class="code" href="res__adsi_8c.html#ac7af894858cf396a219d632f40afdc8d">total</a>, <span class="keyword">struct</span> <a class="code" href="structmansession.html">mansession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structmessage.html">message</a> *m, <span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span> *argv[])
<a name="l02946"></a>02946 {
<a name="l02947"></a>02947    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d;
<a name="l02948"></a>02948    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l;
<a name="l02949"></a>02949    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="app__queue_8c.html#acd1f0e9b4730ec60f62cb0806cb06ef1">id</a>;
<a name="l02950"></a>02950    <span class="keywordtype">char</span> idtext[256] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l02951"></a>02951    <span class="keywordtype">int</span> total_devices = 0;
<a name="l02952"></a>02952 
<a name="l02953"></a>02953    <span class="keywordflow">if</span> (s) { <span class="comment">/* Manager - get ActionID */</span>
<a name="l02954"></a>02954       <span class="keywordtype">id</span> = <a class="code" href="group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556" title="Get header from mananger transaction.">astman_get_header</a>(m, <span class="stringliteral">&quot;ActionID&quot;</span>);
<a name="l02955"></a>02955       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<span class="keywordtype">id</span>))
<a name="l02956"></a>02956          snprintf(idtext, <span class="keyword">sizeof</span>(idtext), <span class="stringliteral">&quot;ActionID: %s\r\n&quot;</span>, <span class="keywordtype">id</span>);
<a name="l02957"></a>02957    }
<a name="l02958"></a>02958 
<a name="l02959"></a>02959    <span class="keywordflow">switch</span> (argc) {
<a name="l02960"></a>02960    <span class="keywordflow">case</span> 3:
<a name="l02961"></a>02961       <span class="keywordflow">break</span>;
<a name="l02962"></a>02962    <span class="keywordflow">default</span>:
<a name="l02963"></a>02963       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l02964"></a>02964    }
<a name="l02965"></a>02965 
<a name="l02966"></a>02966    <span class="keywordflow">if</span> (!s) {
<a name="l02967"></a>02967       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Name                 DeviceId         IP              Type            R NL\n&quot;</span>);
<a name="l02968"></a>02968       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;-------------------- ---------------- --------------- --------------- - --\n&quot;</span>);
<a name="l02969"></a>02969    }
<a name="l02970"></a>02970 
<a name="l02971"></a>02971    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>);
<a name="l02972"></a>02972    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>, d, list) {
<a name="l02973"></a>02973       <span class="keywordtype">int</span> numlines = 0;
<a name="l02974"></a>02974       total_devices++;
<a name="l02975"></a>02975       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;lines, l, list) {
<a name="l02976"></a>02976          numlines++;
<a name="l02977"></a>02977       }
<a name="l02978"></a>02978       <span class="keywordflow">if</span> (!s) {
<a name="l02979"></a>02979          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-20s %-16s %-15s %-15s %c %2d\n&quot;</span>,
<a name="l02980"></a>02980             d-&gt;name,
<a name="l02981"></a>02981             d-&gt;id,
<a name="l02982"></a>02982             d-&gt;<a class="code" href="structskinny__device.html#a730a1864781691273d9f28b5ad1dadfd">session</a>?<a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(d-&gt;<a class="code" href="structskinny__device.html#a730a1864781691273d9f28b5ad1dadfd">session</a>-&gt;<a class="code" href="structskinnysession.html#ac7cbd331d33fcd5a6f81a257975e4cd5">sin</a>.sin_addr):<span class="stringliteral">&quot;&quot;</span>,
<a name="l02983"></a>02983             <a class="code" href="chan__skinny_8c.html#ae45808725375598a00ceb17749f33207">device2str</a>(d-&gt;type),
<a name="l02984"></a>02984             d-&gt;registered?<span class="charliteral">&apos;Y&apos;</span>:<span class="charliteral">&apos;N&apos;</span>,
<a name="l02985"></a>02985             numlines);
<a name="l02986"></a>02986       } <span class="keywordflow">else</span> {
<a name="l02987"></a>02987          <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s,
<a name="l02988"></a>02988             <span class="stringliteral">&quot;Event: DeviceEntry\r\n%s&quot;</span>
<a name="l02989"></a>02989             <span class="stringliteral">&quot;Channeltype: SKINNY\r\n&quot;</span>
<a name="l02990"></a>02990             <span class="stringliteral">&quot;ObjectName: %s\r\n&quot;</span>
<a name="l02991"></a>02991             <span class="stringliteral">&quot;ChannelObjectType: device\r\n&quot;</span>
<a name="l02992"></a>02992             <span class="stringliteral">&quot;DeviceId: %s\r\n&quot;</span>
<a name="l02993"></a>02993             <span class="stringliteral">&quot;IPaddress: %s\r\n&quot;</span>
<a name="l02994"></a>02994             <span class="stringliteral">&quot;Type: %s\r\n&quot;</span>
<a name="l02995"></a>02995             <span class="stringliteral">&quot;Devicestatus: %s\r\n&quot;</span>
<a name="l02996"></a>02996             <span class="stringliteral">&quot;NumberOfLines: %d\r\n&quot;</span>,
<a name="l02997"></a>02997             idtext,
<a name="l02998"></a>02998             d-&gt;name,
<a name="l02999"></a>02999             d-&gt;id,
<a name="l03000"></a>03000             d-&gt;<a class="code" href="structskinny__device.html#a730a1864781691273d9f28b5ad1dadfd">session</a>?<a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(d-&gt;<a class="code" href="structskinny__device.html#a730a1864781691273d9f28b5ad1dadfd">session</a>-&gt;<a class="code" href="structskinnysession.html#ac7cbd331d33fcd5a6f81a257975e4cd5">sin</a>.sin_addr):<span class="stringliteral">&quot;-none-&quot;</span>,
<a name="l03001"></a>03001             <a class="code" href="chan__skinny_8c.html#ae45808725375598a00ceb17749f33207">device2str</a>(d-&gt;type),
<a name="l03002"></a>03002             d-&gt;registered?<span class="stringliteral">&quot;registered&quot;</span>:<span class="stringliteral">&quot;unregistered&quot;</span>,
<a name="l03003"></a>03003             numlines);
<a name="l03004"></a>03004       }
<a name="l03005"></a>03005    }
<a name="l03006"></a>03006    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>);
<a name="l03007"></a>03007 
<a name="l03008"></a>03008    <span class="keywordflow">if</span> (total)
<a name="l03009"></a>03009       *total = total_devices;
<a name="l03010"></a>03010    
<a name="l03011"></a>03011    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l03012"></a>03012 }
<a name="l03013"></a>03013 
<a name="l03014"></a><a class="code" href="chan__skinny_8c.html#a5e5c6c43f047a96d0d24880bb00e0884">03014</a> <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="chan__skinny_8c.html#a5e5c6c43f047a96d0d24880bb00e0884">mandescr_show_devices</a>[] =
<a name="l03015"></a>03015 <span class="stringliteral">&quot;Description: Lists Skinny devices in text format with details on current status.\n&quot;</span>
<a name="l03016"></a>03016 <span class="stringliteral">&quot;Devicelist will follow as separate events, followed by a final event called\n&quot;</span>
<a name="l03017"></a>03017 <span class="stringliteral">&quot;DevicelistComplete.\n&quot;</span>
<a name="l03018"></a>03018 <span class="stringliteral">&quot;Variables: \n&quot;</span>
<a name="l03019"></a>03019 <span class="stringliteral">&quot;  ActionID: &lt;id&gt; Action ID for this transaction. Will be returned.\n&quot;</span>;
<a name="l03020"></a>03020 <span class="comment"></span>
<a name="l03021"></a>03021 <span class="comment">/*! \brief  Show SKINNY devices in the manager API */</span>
<a name="l03022"></a>03022 <span class="comment">/*    Inspired from chan_sip */</span>
<a name="l03023"></a><a class="code" href="chan__skinny_8c.html#a19dd4f20ea170713fc94f3d787e453ec">03023</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a19dd4f20ea170713fc94f3d787e453ec" title="Show SKINNY devices in the manager API.">manager_skinny_show_devices</a>(<span class="keyword">struct</span> <a class="code" href="structmansession.html">mansession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structmessage.html">message</a> *m)
<a name="l03024"></a>03024 {
<a name="l03025"></a>03025    <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span> = <a class="code" href="group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556" title="Get header from mananger transaction.">astman_get_header</a>(m, <span class="stringliteral">&quot;ActionID&quot;</span>);
<a name="l03026"></a>03026    <span class="keyword">const</span> <span class="keywordtype">char</span> *a[] = {<span class="stringliteral">&quot;skinny&quot;</span>, <span class="stringliteral">&quot;show&quot;</span>, <span class="stringliteral">&quot;devices&quot;</span>};
<a name="l03027"></a>03027    <span class="keywordtype">char</span> idtext[256] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l03028"></a>03028    <span class="keywordtype">int</span> <a class="code" href="res__adsi_8c.html#ac7af894858cf396a219d632f40afdc8d">total</a> = 0;
<a name="l03029"></a>03029 
<a name="l03030"></a>03030    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<span class="keywordtype">id</span>))
<a name="l03031"></a>03031       snprintf(idtext, <span class="keyword">sizeof</span>(idtext), <span class="stringliteral">&quot;ActionID: %s\r\n&quot;</span>, <span class="keywordtype">id</span>);
<a name="l03032"></a>03032 
<a name="l03033"></a>03033    <a class="code" href="group__Group__AMI.html#ga0ee6ee1f4d200f711e2983bffe770a72" title="Send ack in manager list transaction.">astman_send_listack</a>(s, m, <span class="stringliteral">&quot;Device status list will follow&quot;</span>, <span class="stringliteral">&quot;start&quot;</span>);
<a name="l03034"></a>03034    <span class="comment">/* List the devices in separate manager events */</span>
<a name="l03035"></a>03035    <a class="code" href="chan__skinny_8c.html#a4c171021840024203e5664942cb797bb">_skinny_show_devices</a>(-1, &amp;total, s, m, 3, a);
<a name="l03036"></a>03036    <span class="comment">/* Send final confirmation */</span>
<a name="l03037"></a>03037    <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s,
<a name="l03038"></a>03038    <span class="stringliteral">&quot;Event: DevicelistComplete\r\n&quot;</span>
<a name="l03039"></a>03039    <span class="stringliteral">&quot;EventList: Complete\r\n&quot;</span>
<a name="l03040"></a>03040    <span class="stringliteral">&quot;ListItems: %d\r\n&quot;</span>
<a name="l03041"></a>03041    <span class="stringliteral">&quot;%s&quot;</span>
<a name="l03042"></a>03042    <span class="stringliteral">&quot;\r\n&quot;</span>, total, idtext);
<a name="l03043"></a>03043    <span class="keywordflow">return</span> 0;
<a name="l03044"></a>03044 }
<a name="l03045"></a>03045 
<a name="l03046"></a><a class="code" href="chan__skinny_8c.html#ae40517f2290aaf18acf058abb998173e">03046</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="chan__skinny_8c.html#ae40517f2290aaf18acf058abb998173e">handle_skinny_show_devices</a>(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="structast__cli__args.html">ast_cli_args</a> *a)
<a name="l03047"></a>03047 {
<a name="l03048"></a>03048 
<a name="l03049"></a>03049    <span class="keywordflow">switch</span> (cmd) {
<a name="l03050"></a>03050    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l03051"></a>03051       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;skinny show devices&quot;</span>;
<a name="l03052"></a>03052       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l03053"></a>03053          <span class="stringliteral">&quot;Usage: skinny show devices\n&quot;</span>
<a name="l03054"></a>03054          <span class="stringliteral">&quot;       Lists all devices known to the Skinny subsystem.\n&quot;</span>;
<a name="l03055"></a>03055       <span class="keywordflow">return</span> NULL;
<a name="l03056"></a>03056    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l03057"></a>03057       <span class="keywordflow">return</span> NULL;
<a name="l03058"></a>03058    }
<a name="l03059"></a>03059 
<a name="l03060"></a>03060    <span class="keywordflow">return</span> <a class="code" href="chan__skinny_8c.html#a4c171021840024203e5664942cb797bb">_skinny_show_devices</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, NULL, NULL, NULL, a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a>, (<span class="keyword">const</span> <span class="keywordtype">char</span> **) a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>);
<a name="l03061"></a>03061 }
<a name="l03062"></a>03062 
<a name="l03063"></a><a class="code" href="chan__skinny_8c.html#a94ba73270a0d23cb1cd62ae1d97599bd">03063</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="chan__skinny_8c.html#a94ba73270a0d23cb1cd62ae1d97599bd">_skinny_show_device</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">int</span> fd, <span class="keyword">struct</span> <a class="code" href="structmansession.html">mansession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structmessage.html">message</a> *m, <span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span> *argv[])
<a name="l03064"></a>03064 {
<a name="l03065"></a>03065    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d;
<a name="l03066"></a>03066    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l;
<a name="l03067"></a>03067    <span class="keyword">struct </span><a class="code" href="structskinny__speeddial.html">skinny_speeddial</a> *sd;
<a name="l03068"></a>03068    <span class="keyword">struct </span>skinny_addon *sa;
<a name="l03069"></a>03069    <span class="keywordtype">char</span> codec_buf[512];
<a name="l03070"></a>03070 
<a name="l03071"></a>03071    <span class="keywordflow">if</span> (argc &lt; 4) {
<a name="l03072"></a>03072       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l03073"></a>03073    }
<a name="l03074"></a>03074 
<a name="l03075"></a>03075    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>);
<a name="l03076"></a>03076    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>, d, list) {
<a name="l03077"></a>03077       <span class="keywordflow">if</span> (!strcasecmp(argv[3], d-&gt;id) || !strcasecmp(argv[3], d-&gt;name)) {
<a name="l03078"></a>03078          <span class="keywordtype">int</span> numlines = 0, numaddons = 0, numspeeddials = 0;
<a name="l03079"></a>03079 
<a name="l03080"></a>03080          <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;lines, l, list){
<a name="l03081"></a>03081             numlines++;
<a name="l03082"></a>03082          }
<a name="l03083"></a>03083 
<a name="l03084"></a>03084          <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;addons, sa, list) {
<a name="l03085"></a>03085             numaddons++;
<a name="l03086"></a>03086          }
<a name="l03087"></a>03087 
<a name="l03088"></a>03088          <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;speeddials, sd, list) {
<a name="l03089"></a>03089             numspeeddials++;
<a name="l03090"></a>03090          }
<a name="l03091"></a>03091 
<a name="l03092"></a>03092          <span class="keywordflow">if</span> (type == 0) { <span class="comment">/* CLI */</span>
<a name="l03093"></a>03093             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Name:        %s\n&quot;</span>, d-&gt;name);
<a name="l03094"></a>03094             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Id:          %s\n&quot;</span>, d-&gt;id);
<a name="l03095"></a>03095             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;version:     %s\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(d-&gt;version_id, <span class="stringliteral">&quot;Unknown&quot;</span>));
<a name="l03096"></a>03096             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Ip address:  %s\n&quot;</span>, (d-&gt;<a class="code" href="structskinny__device.html#a730a1864781691273d9f28b5ad1dadfd">session</a> ? <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(d-&gt;<a class="code" href="structskinny__device.html#a730a1864781691273d9f28b5ad1dadfd">session</a>-&gt;<a class="code" href="structskinnysession.html#ac7cbd331d33fcd5a6f81a257975e4cd5">sin</a>.sin_addr) : <span class="stringliteral">&quot;Unknown&quot;</span>));
<a name="l03097"></a>03097             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Port:        %d\n&quot;</span>, (d-&gt;<a class="code" href="structskinny__device.html#a730a1864781691273d9f28b5ad1dadfd">session</a> ? ntohs(d-&gt;<a class="code" href="structskinny__device.html#a730a1864781691273d9f28b5ad1dadfd">session</a>-&gt;<a class="code" href="structskinnysession.html#ac7cbd331d33fcd5a6f81a257975e4cd5">sin</a>.sin_port) : 0));
<a name="l03098"></a>03098             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Device Type: %s\n&quot;</span>, <a class="code" href="chan__skinny_8c.html#ae45808725375598a00ceb17749f33207">device2str</a>(d-&gt;type));
<a name="l03099"></a>03099             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Conf Codecs:&quot;</span>);
<a name="l03100"></a>03100             <a class="code" href="frame_8h.html#a37cdc7e78686b0bfa4e47e645f782b30" title="Get the names of a set of formats.">ast_getformatname_multiple</a>(codec_buf, <span class="keyword">sizeof</span>(codec_buf) - 1, d-&gt;confcapability);
<a name="l03101"></a>03101             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%s\n&quot;</span>, codec_buf);
<a name="l03102"></a>03102             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Neg Codecs: &quot;</span>);
<a name="l03103"></a>03103             <a class="code" href="frame_8h.html#a37cdc7e78686b0bfa4e47e645f782b30" title="Get the names of a set of formats.">ast_getformatname_multiple</a>(codec_buf, <span class="keyword">sizeof</span>(codec_buf) - 1, d-&gt;capability);
<a name="l03104"></a>03104             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%s\n&quot;</span>, codec_buf);
<a name="l03105"></a>03105             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Registered:  %s\n&quot;</span>, (d-&gt;registered ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>));
<a name="l03106"></a>03106             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Lines:       %d\n&quot;</span>, numlines);
<a name="l03107"></a>03107             <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;lines, l, list) {
<a name="l03108"></a>03108                <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;  %s (%s)\n&quot;</span>, l-&gt;name, l-&gt;label);
<a name="l03109"></a>03109             }
<a name="l03110"></a>03110             <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;addons, sa, list) {
<a name="l03111"></a>03111                numaddons++;
<a name="l03112"></a>03112             }  
<a name="l03113"></a>03113             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Addons:      %d\n&quot;</span>, numaddons);
<a name="l03114"></a>03114             <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;addons, sa, list) {
<a name="l03115"></a>03115                <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;  %s\n&quot;</span>, sa-&gt;<a class="code" href="structskinny__addon.html#a33e6e7edca48ac1ff105d85011dfc454">type</a>);
<a name="l03116"></a>03116             }
<a name="l03117"></a>03117             <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;speeddials, sd, list) {
<a name="l03118"></a>03118                numspeeddials++;
<a name="l03119"></a>03119             }
<a name="l03120"></a>03120             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Speeddials:  %d\n&quot;</span>, numspeeddials);
<a name="l03121"></a>03121             <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;speeddials, sd, list) {
<a name="l03122"></a>03122                <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;  %s (%s) ishint: %d\n&quot;</span>, sd-&gt;<a class="code" href="structskinny__speeddial.html#a78d4847658b695383d849efd12399b38">exten</a>, sd-&gt;<a class="code" href="structskinny__speeddial.html#ab20c01b68c97d3477a795c85e6c37be9">label</a>, sd-&gt;<a class="code" href="structskinny__speeddial.html#ad3d414cdb71376b88dc5ce91a2a6118e">isHint</a>);
<a name="l03123"></a>03123             }
<a name="l03124"></a>03124          } <span class="keywordflow">else</span> { <span class="comment">/* manager */</span>
<a name="l03125"></a>03125             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Channeltype: SKINNY\r\n&quot;</span>);
<a name="l03126"></a>03126             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;ObjectName: %s\r\n&quot;</span>, d-&gt;name);
<a name="l03127"></a>03127             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;ChannelObjectType: device\r\n&quot;</span>);
<a name="l03128"></a>03128             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Id: %s\r\n&quot;</span>, d-&gt;id);
<a name="l03129"></a>03129             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;version: %s\r\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(d-&gt;version_id, <span class="stringliteral">&quot;Unknown&quot;</span>));
<a name="l03130"></a>03130             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Ipaddress: %s\r\n&quot;</span>, (d-&gt;<a class="code" href="structskinny__device.html#a730a1864781691273d9f28b5ad1dadfd">session</a> ? <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(d-&gt;<a class="code" href="structskinny__device.html#a730a1864781691273d9f28b5ad1dadfd">session</a>-&gt;<a class="code" href="structskinnysession.html#ac7cbd331d33fcd5a6f81a257975e4cd5">sin</a>.sin_addr) : <span class="stringliteral">&quot;Unknown&quot;</span>));
<a name="l03131"></a>03131             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Port: %d\r\n&quot;</span>, (d-&gt;<a class="code" href="structskinny__device.html#a730a1864781691273d9f28b5ad1dadfd">session</a> ? ntohs(d-&gt;<a class="code" href="structskinny__device.html#a730a1864781691273d9f28b5ad1dadfd">session</a>-&gt;<a class="code" href="structskinnysession.html#ac7cbd331d33fcd5a6f81a257975e4cd5">sin</a>.sin_port) : 0));
<a name="l03132"></a>03132             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;DeviceType: %s\r\n&quot;</span>, <a class="code" href="chan__skinny_8c.html#ae45808725375598a00ceb17749f33207">device2str</a>(d-&gt;type));
<a name="l03133"></a>03133             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Codecs: &quot;</span>);
<a name="l03134"></a>03134             <a class="code" href="frame_8h.html#a37cdc7e78686b0bfa4e47e645f782b30" title="Get the names of a set of formats.">ast_getformatname_multiple</a>(codec_buf, <span class="keyword">sizeof</span>(codec_buf) -1, d-&gt;confcapability);
<a name="l03135"></a>03135             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;%s\r\n&quot;</span>, codec_buf);
<a name="l03136"></a>03136             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;CodecOrder: &quot;</span>);
<a name="l03137"></a>03137             <a class="code" href="frame_8h.html#a37cdc7e78686b0bfa4e47e645f782b30" title="Get the names of a set of formats.">ast_getformatname_multiple</a>(codec_buf, <span class="keyword">sizeof</span>(codec_buf) -1, d-&gt;capability);
<a name="l03138"></a>03138             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;%s\r\n&quot;</span>, codec_buf);
<a name="l03139"></a>03139             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Devicestatus: %s\r\n&quot;</span>, (d-&gt;registered?<span class="stringliteral">&quot;registered&quot;</span>:<span class="stringliteral">&quot;unregistered&quot;</span>));
<a name="l03140"></a>03140             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;NumberOfLines: %d\r\n&quot;</span>, numlines);
<a name="l03141"></a>03141             <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;lines, l, list) {
<a name="l03142"></a>03142                <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Line: %s (%s)\r\n&quot;</span>, l-&gt;name, l-&gt;label);
<a name="l03143"></a>03143             }
<a name="l03144"></a>03144             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;NumberOfAddons: %d\r\n&quot;</span>, numaddons);
<a name="l03145"></a>03145             <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;addons, sa, list) {
<a name="l03146"></a>03146                <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Addon: %s\r\n&quot;</span>, sa-&gt;<a class="code" href="structskinny__addon.html#a33e6e7edca48ac1ff105d85011dfc454">type</a>);
<a name="l03147"></a>03147             }
<a name="l03148"></a>03148             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;NumberOfSpeeddials: %d\r\n&quot;</span>, numspeeddials);
<a name="l03149"></a>03149             <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;speeddials, sd, list) {
<a name="l03150"></a>03150                <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Speeddial: %s (%s) ishint: %d\r\n&quot;</span>, sd-&gt;<a class="code" href="structskinny__speeddial.html#a78d4847658b695383d849efd12399b38">exten</a>, sd-&gt;<a class="code" href="structskinny__speeddial.html#ab20c01b68c97d3477a795c85e6c37be9">label</a>, sd-&gt;<a class="code" href="structskinny__speeddial.html#ad3d414cdb71376b88dc5ce91a2a6118e">isHint</a>);
<a name="l03151"></a>03151             }
<a name="l03152"></a>03152          }
<a name="l03153"></a>03153       }
<a name="l03154"></a>03154    }
<a name="l03155"></a>03155    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>);
<a name="l03156"></a>03156    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l03157"></a>03157 }
<a name="l03158"></a>03158 
<a name="l03159"></a><a class="code" href="chan__skinny_8c.html#ad44c1690168c6ca3cc1d1f4b413db89e">03159</a> <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="chan__skinny_8c.html#ad44c1690168c6ca3cc1d1f4b413db89e">mandescr_show_device</a>[] =
<a name="l03160"></a>03160 <span class="stringliteral">&quot;Description: Show one SKINNY device with details on current status.\n&quot;</span>
<a name="l03161"></a>03161 <span class="stringliteral">&quot;Variables: \n&quot;</span>
<a name="l03162"></a>03162 <span class="stringliteral">&quot;  Device: &lt;name&gt;           The device name you want to check.\n&quot;</span>
<a name="l03163"></a>03163 <span class="stringliteral">&quot;  ActionID: &lt;id&gt;   Optional action ID for this AMI transaction.\n&quot;</span>;
<a name="l03164"></a>03164 
<a name="l03165"></a><a class="code" href="chan__skinny_8c.html#a603b2c3fc96fb332fef1787046574afd">03165</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a603b2c3fc96fb332fef1787046574afd">manager_skinny_show_device</a>(<span class="keyword">struct</span> <a class="code" href="structmansession.html">mansession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structmessage.html">message</a> *m)
<a name="l03166"></a>03166 {
<a name="l03167"></a>03167    <span class="keyword">const</span> <span class="keywordtype">char</span> *a[4];
<a name="l03168"></a>03168    <span class="keyword">const</span> <span class="keywordtype">char</span> *device;
<a name="l03169"></a>03169 
<a name="l03170"></a>03170    device = <a class="code" href="group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556" title="Get header from mananger transaction.">astman_get_header</a>(m, <span class="stringliteral">&quot;Device&quot;</span>);
<a name="l03171"></a>03171    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(device)) {
<a name="l03172"></a>03172       <a class="code" href="group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c" title="Send error in manager transaction.">astman_send_error</a>(s, m, <span class="stringliteral">&quot;Device: &lt;name&gt; missing.&quot;</span>);
<a name="l03173"></a>03173       <span class="keywordflow">return</span> 0;
<a name="l03174"></a>03174    }
<a name="l03175"></a>03175    a[0] = <span class="stringliteral">&quot;skinny&quot;</span>;
<a name="l03176"></a>03176    a[1] = <span class="stringliteral">&quot;show&quot;</span>;
<a name="l03177"></a>03177    a[2] = <span class="stringliteral">&quot;device&quot;</span>;
<a name="l03178"></a>03178    a[3] = device;
<a name="l03179"></a>03179 
<a name="l03180"></a>03180    <a class="code" href="chan__skinny_8c.html#a94ba73270a0d23cb1cd62ae1d97599bd">_skinny_show_device</a>(1, -1, s, m, 4, a);
<a name="l03181"></a>03181    <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;\r\n\r\n&quot;</span> );
<a name="l03182"></a>03182    <span class="keywordflow">return</span> 0;
<a name="l03183"></a>03183 }
<a name="l03184"></a>03184 <span class="comment"></span>
<a name="l03185"></a>03185 <span class="comment">/*! \brief Show device information */</span>
<a name="l03186"></a><a class="code" href="chan__skinny_8c.html#a6aeb19612127b1e5b27bbaf1950b922d">03186</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="chan__skinny_8c.html#a6aeb19612127b1e5b27bbaf1950b922d" title="Show device information.">handle_skinny_show_device</a>(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="structast__cli__args.html">ast_cli_args</a> *a)
<a name="l03187"></a>03187 {
<a name="l03188"></a>03188    <span class="keywordflow">switch</span> (cmd) {
<a name="l03189"></a>03189    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l03190"></a>03190       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;skinny show device&quot;</span>;
<a name="l03191"></a>03191       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l03192"></a>03192          <span class="stringliteral">&quot;Usage: skinny show device &lt;DeviceId|DeviceName&gt;\n&quot;</span>
<a name="l03193"></a>03193          <span class="stringliteral">&quot;       Lists all deviceinformation of a specific device known to the Skinny subsystem.\n&quot;</span>;
<a name="l03194"></a>03194       <span class="keywordflow">return</span> NULL;
<a name="l03195"></a>03195    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l03196"></a>03196       <span class="keywordflow">return</span> <a class="code" href="chan__skinny_8c.html#a1330941685fd5dc9308d2f91dd7b70d1">complete_skinny_show_device</a>(a-&gt;<a class="code" href="structast__cli__args.html#a2a7a1aa13a4f14075411123a4495593c">line</a>, a-&gt;<a class="code" href="structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>, a-&gt;<a class="code" href="structast__cli__args.html#a1910d262855b71da353ed0d07a6c7823">pos</a>, a-&gt;<a class="code" href="structast__cli__args.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>);
<a name="l03197"></a>03197    }
<a name="l03198"></a>03198 
<a name="l03199"></a>03199    <span class="keywordflow">return</span> <a class="code" href="chan__skinny_8c.html#a94ba73270a0d23cb1cd62ae1d97599bd">_skinny_show_device</a>(0, a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, NULL, NULL, a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a>, (<span class="keyword">const</span> <span class="keywordtype">char</span> **) a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>);
<a name="l03200"></a>03200 }
<a name="l03201"></a>03201 
<a name="l03202"></a><a class="code" href="chan__skinny_8c.html#a5f3ec549e6cecb56ef831b35af377e1a">03202</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="chan__skinny_8c.html#a5f3ec549e6cecb56ef831b35af377e1a">_skinny_show_lines</a>(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> *<a class="code" href="res__adsi_8c.html#ac7af894858cf396a219d632f40afdc8d">total</a>, <span class="keyword">struct</span> <a class="code" href="structmansession.html">mansession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structmessage.html">message</a> *m, <span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span> *argv[])
<a name="l03203"></a>03203 {
<a name="l03204"></a>03204    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l;
<a name="l03205"></a>03205    <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub;
<a name="l03206"></a>03206    <span class="keywordtype">int</span> total_lines = 0;
<a name="l03207"></a>03207    <span class="keywordtype">int</span> verbose = 0;
<a name="l03208"></a>03208    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="app__queue_8c.html#acd1f0e9b4730ec60f62cb0806cb06ef1">id</a>;
<a name="l03209"></a>03209    <span class="keywordtype">char</span> idtext[256] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l03210"></a>03210 
<a name="l03211"></a>03211    <span class="keywordflow">if</span> (s) { <span class="comment">/* Manager - get ActionID */</span>
<a name="l03212"></a>03212       <span class="keywordtype">id</span> = <a class="code" href="group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556" title="Get header from mananger transaction.">astman_get_header</a>(m, <span class="stringliteral">&quot;ActionID&quot;</span>);
<a name="l03213"></a>03213       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<span class="keywordtype">id</span>))
<a name="l03214"></a>03214          snprintf(idtext, <span class="keyword">sizeof</span>(idtext), <span class="stringliteral">&quot;ActionID: %s\r\n&quot;</span>, <span class="keywordtype">id</span>);
<a name="l03215"></a>03215    }
<a name="l03216"></a>03216 
<a name="l03217"></a>03217    <span class="keywordflow">switch</span> (argc) {
<a name="l03218"></a>03218    <span class="keywordflow">case</span> 4:
<a name="l03219"></a>03219       verbose = 1;
<a name="l03220"></a>03220       <span class="keywordflow">break</span>;
<a name="l03221"></a>03221    <span class="keywordflow">case</span> 3:
<a name="l03222"></a>03222       verbose = 0;
<a name="l03223"></a>03223       <span class="keywordflow">break</span>;
<a name="l03224"></a>03224    <span class="keywordflow">default</span>:
<a name="l03225"></a>03225       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l03226"></a>03226    }
<a name="l03227"></a>03227 
<a name="l03228"></a>03228    <span class="keywordflow">if</span> (!s) {
<a name="l03229"></a>03229       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Name                 Device Name          Instance Label               \n&quot;</span>);
<a name="l03230"></a>03230       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;-------------------- -------------------- -------- --------------------\n&quot;</span>);
<a name="l03231"></a>03231    }
<a name="l03232"></a>03232    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;lines);
<a name="l03233"></a>03233    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;lines, l, all) {
<a name="l03234"></a>03234       total_lines++;
<a name="l03235"></a>03235       <span class="keywordflow">if</span> (!s) {
<a name="l03236"></a>03236          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-20s %-20s %8d %-20s\n&quot;</span>,
<a name="l03237"></a>03237             l-&gt;name,
<a name="l03238"></a>03238             (l-&gt;device ? l-&gt;device-&gt;name : <span class="stringliteral">&quot;Not connected&quot;</span>),
<a name="l03239"></a>03239             l-&gt;instance,
<a name="l03240"></a>03240             l-&gt;label);
<a name="l03241"></a>03241          <span class="keywordflow">if</span> (verbose) {
<a name="l03242"></a>03242             <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;l-&gt;sub, sub, list) {
<a name="l03243"></a>03243                <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;  %s&gt; %s to %s\n&quot;</span>,
<a name="l03244"></a>03244                   (sub == l-&gt;<a class="code" href="structskinny__line.html#aedffa4337f76fdcdc808e16affbafd04">activesub</a>?<span class="stringliteral">&quot;Active  &quot;</span>:<span class="stringliteral">&quot;Inactive&quot;</span>),
<a name="l03245"></a>03245                   sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name,
<a name="l03246"></a>03246                   (<a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)?<a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)-&gt;name:<span class="stringliteral">&quot;&quot;</span>)
<a name="l03247"></a>03247                );
<a name="l03248"></a>03248             }
<a name="l03249"></a>03249          }
<a name="l03250"></a>03250       } <span class="keywordflow">else</span> {
<a name="l03251"></a>03251          <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s,
<a name="l03252"></a>03252             <span class="stringliteral">&quot;Event: LineEntry\r\n%s&quot;</span>
<a name="l03253"></a>03253             <span class="stringliteral">&quot;Channeltype: SKINNY\r\n&quot;</span>
<a name="l03254"></a>03254             <span class="stringliteral">&quot;ObjectName: %s\r\n&quot;</span>
<a name="l03255"></a>03255             <span class="stringliteral">&quot;ChannelObjectType: line\r\n&quot;</span>
<a name="l03256"></a>03256             <span class="stringliteral">&quot;Device: %s\r\n&quot;</span>
<a name="l03257"></a>03257             <span class="stringliteral">&quot;Instance: %d\r\n&quot;</span>
<a name="l03258"></a>03258             <span class="stringliteral">&quot;Label: %s\r\n&quot;</span>,
<a name="l03259"></a>03259             idtext,
<a name="l03260"></a>03260             l-&gt;name,
<a name="l03261"></a>03261             (l-&gt;device?l-&gt;device-&gt;name:<span class="stringliteral">&quot;None&quot;</span>),
<a name="l03262"></a>03262             l-&gt;instance,
<a name="l03263"></a>03263             l-&gt;label);
<a name="l03264"></a>03264       }
<a name="l03265"></a>03265       <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;lines);
<a name="l03266"></a>03266    }
<a name="l03267"></a>03267 
<a name="l03268"></a>03268    <span class="keywordflow">if</span> (total) {
<a name="l03269"></a>03269       *total = total_lines;
<a name="l03270"></a>03270    }
<a name="l03271"></a>03271 
<a name="l03272"></a>03272    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l03273"></a>03273 }
<a name="l03274"></a>03274 
<a name="l03275"></a><a class="code" href="chan__skinny_8c.html#a1f1de5e1fada16afeaa394c7f655f6b3">03275</a> <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="chan__skinny_8c.html#a1f1de5e1fada16afeaa394c7f655f6b3">mandescr_show_lines</a>[] =
<a name="l03276"></a>03276 <span class="stringliteral">&quot;Description: Lists Skinny lines in text format with details on current status.\n&quot;</span>
<a name="l03277"></a>03277 <span class="stringliteral">&quot;Linelist will follow as separate events, followed by a final event called\n&quot;</span>
<a name="l03278"></a>03278 <span class="stringliteral">&quot;LinelistComplete.\n&quot;</span>
<a name="l03279"></a>03279 <span class="stringliteral">&quot;Variables: \n&quot;</span>
<a name="l03280"></a>03280 <span class="stringliteral">&quot;  ActionID: &lt;id&gt; Action ID for this transaction. Will be returned.\n&quot;</span>;
<a name="l03281"></a>03281 <span class="comment"></span>
<a name="l03282"></a>03282 <span class="comment">/*! \brief  Show Skinny lines in the manager API */</span>
<a name="l03283"></a>03283 <span class="comment">/*    Inspired from chan_sip */</span>
<a name="l03284"></a><a class="code" href="chan__skinny_8c.html#a1ac9ad552f6392f35b494cb0cf075fe6">03284</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a1ac9ad552f6392f35b494cb0cf075fe6" title="Show Skinny lines in the manager API.">manager_skinny_show_lines</a>(<span class="keyword">struct</span> <a class="code" href="structmansession.html">mansession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structmessage.html">message</a> *m)
<a name="l03285"></a>03285 {
<a name="l03286"></a>03286    <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span> = <a class="code" href="group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556" title="Get header from mananger transaction.">astman_get_header</a>(m, <span class="stringliteral">&quot;ActionID&quot;</span>);
<a name="l03287"></a>03287    <span class="keyword">const</span> <span class="keywordtype">char</span> *a[] = {<span class="stringliteral">&quot;skinny&quot;</span>, <span class="stringliteral">&quot;show&quot;</span>, <span class="stringliteral">&quot;lines&quot;</span>};
<a name="l03288"></a>03288    <span class="keywordtype">char</span> idtext[256] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l03289"></a>03289    <span class="keywordtype">int</span> <a class="code" href="res__adsi_8c.html#ac7af894858cf396a219d632f40afdc8d">total</a> = 0;
<a name="l03290"></a>03290 
<a name="l03291"></a>03291    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<span class="keywordtype">id</span>))
<a name="l03292"></a>03292       snprintf(idtext, <span class="keyword">sizeof</span>(idtext), <span class="stringliteral">&quot;ActionID: %s\r\n&quot;</span>, <span class="keywordtype">id</span>);
<a name="l03293"></a>03293 
<a name="l03294"></a>03294    <a class="code" href="group__Group__AMI.html#ga0ee6ee1f4d200f711e2983bffe770a72" title="Send ack in manager list transaction.">astman_send_listack</a>(s, m, <span class="stringliteral">&quot;Line status list will follow&quot;</span>, <span class="stringliteral">&quot;start&quot;</span>);
<a name="l03295"></a>03295    <span class="comment">/* List the lines in separate manager events */</span>
<a name="l03296"></a>03296    <a class="code" href="chan__skinny_8c.html#a5f3ec549e6cecb56ef831b35af377e1a">_skinny_show_lines</a>(-1, &amp;total, s, m, 3, a);
<a name="l03297"></a>03297    <span class="comment">/* Send final confirmation */</span>
<a name="l03298"></a>03298    <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s,
<a name="l03299"></a>03299    <span class="stringliteral">&quot;Event: LinelistComplete\r\n&quot;</span>
<a name="l03300"></a>03300    <span class="stringliteral">&quot;EventList: Complete\r\n&quot;</span>
<a name="l03301"></a>03301    <span class="stringliteral">&quot;ListItems: %d\r\n&quot;</span>
<a name="l03302"></a>03302    <span class="stringliteral">&quot;%s&quot;</span>
<a name="l03303"></a>03303    <span class="stringliteral">&quot;\r\n&quot;</span>, total, idtext);
<a name="l03304"></a>03304    <span class="keywordflow">return</span> 0;
<a name="l03305"></a>03305 }
<a name="l03306"></a>03306 
<a name="l03307"></a><a class="code" href="chan__skinny_8c.html#aa141f086a05a7250a05aef742a4875c8">03307</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="chan__skinny_8c.html#aa141f086a05a7250a05aef742a4875c8">handle_skinny_show_lines</a>(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="structast__cli__args.html">ast_cli_args</a> *a)
<a name="l03308"></a>03308 {
<a name="l03309"></a>03309    <span class="keywordtype">int</span> verbose = 0;
<a name="l03310"></a>03310 
<a name="l03311"></a>03311    <span class="keywordflow">switch</span> (cmd) {
<a name="l03312"></a>03312    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l03313"></a>03313       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;skinny show lines [verbose]&quot;</span>;
<a name="l03314"></a>03314       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l03315"></a>03315          <span class="stringliteral">&quot;Usage: skinny show lines\n&quot;</span>
<a name="l03316"></a>03316          <span class="stringliteral">&quot;       Lists all lines known to the Skinny subsystem.\n&quot;</span>
<a name="l03317"></a>03317          <span class="stringliteral">&quot;       If &apos;verbose&apos; is specified, the output includes\n&quot;</span>
<a name="l03318"></a>03318          <span class="stringliteral">&quot;       information about subs for each line.\n&quot;</span>;
<a name="l03319"></a>03319       <span class="keywordflow">return</span> NULL;
<a name="l03320"></a>03320    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l03321"></a>03321       <span class="keywordflow">return</span> NULL;
<a name="l03322"></a>03322    }
<a name="l03323"></a>03323 
<a name="l03324"></a>03324    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> == e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>) {
<a name="l03325"></a>03325       <span class="keywordflow">if</span> (!strcasecmp(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>-1], <span class="stringliteral">&quot;verbose&quot;</span>)) {
<a name="l03326"></a>03326          verbose = 1;
<a name="l03327"></a>03327       } <span class="keywordflow">else</span> {
<a name="l03328"></a>03328          <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l03329"></a>03329       }
<a name="l03330"></a>03330    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a> - 1) {
<a name="l03331"></a>03331       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l03332"></a>03332    }
<a name="l03333"></a>03333 
<a name="l03334"></a>03334    <span class="keywordflow">return</span> <a class="code" href="chan__skinny_8c.html#a5f3ec549e6cecb56ef831b35af377e1a">_skinny_show_lines</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, NULL, NULL, NULL, a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a>, (<span class="keyword">const</span> <span class="keywordtype">char</span> **) a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>);
<a name="l03335"></a>03335 }
<a name="l03336"></a>03336 
<a name="l03337"></a><a class="code" href="chan__skinny_8c.html#a67bdebd523722eec9a784e69cbb8545d">03337</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="chan__skinny_8c.html#a67bdebd523722eec9a784e69cbb8545d">_skinny_show_line</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">int</span> fd, <span class="keyword">struct</span> <a class="code" href="structmansession.html">mansession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structmessage.html">message</a> *m, <span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span> *argv[])
<a name="l03338"></a>03338 {
<a name="l03339"></a>03339    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d;
<a name="l03340"></a>03340    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l;
<a name="l03341"></a>03341    <span class="keyword">struct </span><a class="code" href="structast__codec__pref.html">ast_codec_pref</a> *pref;
<a name="l03342"></a>03342    <span class="keywordtype">int</span> x = 0, codec = 0;
<a name="l03343"></a>03343    <span class="keywordtype">char</span> codec_buf[512];
<a name="l03344"></a>03344    <span class="keywordtype">char</span> group_buf[256];
<a name="l03345"></a>03345    <span class="keywordtype">char</span> cbuf[256];
<a name="l03346"></a>03346 
<a name="l03347"></a>03347    <span class="keywordflow">switch</span> (argc) {
<a name="l03348"></a>03348    <span class="keywordflow">case</span> 4:
<a name="l03349"></a>03349       <span class="keywordflow">break</span>;
<a name="l03350"></a>03350    <span class="keywordflow">case</span> 6:
<a name="l03351"></a>03351       <span class="keywordflow">break</span>;
<a name="l03352"></a>03352    <span class="keywordflow">default</span>:
<a name="l03353"></a>03353       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l03354"></a>03354    }
<a name="l03355"></a>03355 
<a name="l03356"></a>03356    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>);
<a name="l03357"></a>03357 
<a name="l03358"></a>03358    <span class="comment">/* Show all lines matching the one supplied */</span>
<a name="l03359"></a>03359    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>, d, list) {
<a name="l03360"></a>03360       <span class="keywordflow">if</span> (argc == 6 &amp;&amp; (strcasecmp(argv[5], d-&gt;id) &amp;&amp; strcasecmp(argv[5], d-&gt;name))) {
<a name="l03361"></a>03361          <span class="keywordflow">continue</span>;
<a name="l03362"></a>03362       }
<a name="l03363"></a>03363       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;lines, l, list) {
<a name="l03364"></a>03364          <span class="keywordflow">if</span> (strcasecmp(argv[3], l-&gt;name)) {
<a name="l03365"></a>03365             <span class="keywordflow">continue</span>;
<a name="l03366"></a>03366          }
<a name="l03367"></a>03367          <span class="keywordflow">if</span> (type == 0) { <span class="comment">/* CLI */</span>
<a name="l03368"></a>03368             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Line:             %s\n&quot;</span>, l-&gt;name);
<a name="l03369"></a>03369             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;On Device:        %s\n&quot;</span>, d-&gt;name);
<a name="l03370"></a>03370             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Line Label:       %s\n&quot;</span>, l-&gt;label);
<a name="l03371"></a>03371             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Extension:        %s\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(l-&gt;exten, <span class="stringliteral">&quot;&lt;not set&gt;&quot;</span>));
<a name="l03372"></a>03372             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Context:          %s\n&quot;</span>, l-&gt;context);
<a name="l03373"></a>03373             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;CallGroup:        %s\n&quot;</span>, <a class="code" href="channel_8h.html#a092d4e67b0bda0f99b02a1534ee75408" title="print call- and pickup groups into buffer">ast_print_group</a>(group_buf, <span class="keyword">sizeof</span>(group_buf), l-&gt;callgroup));
<a name="l03374"></a>03374             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;PickupGroup:      %s\n&quot;</span>, <a class="code" href="channel_8h.html#a092d4e67b0bda0f99b02a1534ee75408" title="print call- and pickup groups into buffer">ast_print_group</a>(group_buf, <span class="keyword">sizeof</span>(group_buf), l-&gt;pickupgroup));
<a name="l03375"></a>03375             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Language:         %s\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(l-&gt;language, <span class="stringliteral">&quot;&lt;not set&gt;&quot;</span>));
<a name="l03376"></a>03376             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Accountcode:      %s\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(l-&gt;accountcode, <span class="stringliteral">&quot;&lt;not set&gt;&quot;</span>));
<a name="l03377"></a>03377             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;AmaFlag:          %s\n&quot;</span>, <a class="code" href="cdr_8h.html#ac28b55abfc64e10c72d87078382a99ed">ast_cdr_flags2str</a>(l-&gt;amaflags));
<a name="l03378"></a>03378             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;CallerId Number:  %s\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(l-&gt;cid_num, <span class="stringliteral">&quot;&lt;not set&gt;&quot;</span>));
<a name="l03379"></a>03379             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;CallerId Name:    %s\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(l-&gt;cid_name, <span class="stringliteral">&quot;&lt;not set&gt;&quot;</span>));
<a name="l03380"></a>03380             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Hide CallerId:    %s\n&quot;</span>, (l-&gt;hidecallerid ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>));
<a name="l03381"></a>03381             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;CFwdAll:          %s\n&quot;</span>, <a class="code" href="strings_8h.html#a38a896048b2ca84076864505f0aa8f01" title="returns the equivalent of logic or for strings, with an additional boolean check:...">S_COR</a>((l-&gt;cfwdtype &amp; <a class="code" href="chan__skinny_8c.html#a1a77767cd4cfc70d096da50a2fefecd7">SKINNY_CFWD_ALL</a>), l-&gt;call_forward_all, <span class="stringliteral">&quot;&lt;not set&gt;&quot;</span>));
<a name="l03382"></a>03382             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;CFwdBusy:         %s\n&quot;</span>, <a class="code" href="strings_8h.html#a38a896048b2ca84076864505f0aa8f01" title="returns the equivalent of logic or for strings, with an additional boolean check:...">S_COR</a>((l-&gt;cfwdtype &amp; <a class="code" href="chan__skinny_8c.html#a6cd59fd0c6c79219d38f437a485ce844">SKINNY_CFWD_BUSY</a>), l-&gt;call_forward_busy, <span class="stringliteral">&quot;&lt;not set&gt;&quot;</span>));
<a name="l03383"></a>03383             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;CFwdNoAnswer:     %s\n&quot;</span>, <a class="code" href="strings_8h.html#a38a896048b2ca84076864505f0aa8f01" title="returns the equivalent of logic or for strings, with an additional boolean check:...">S_COR</a>((l-&gt;cfwdtype &amp; <a class="code" href="chan__skinny_8c.html#a805d890f6df0e6cf5d9f281791d2a318">SKINNY_CFWD_NOANSWER</a>), l-&gt;call_forward_noanswer, <span class="stringliteral">&quot;&lt;not set&gt;&quot;</span>));
<a name="l03384"></a>03384             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;VoicemailBox:     %s\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(l-&gt;mailbox, <span class="stringliteral">&quot;&lt;not set&gt;&quot;</span>));
<a name="l03385"></a>03385             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;VoicemailNumber:  %s\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(l-&gt;vmexten, <span class="stringliteral">&quot;&lt;not set&gt;&quot;</span>));
<a name="l03386"></a>03386             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;MWIblink:         %d\n&quot;</span>, l-&gt;mwiblink);
<a name="l03387"></a>03387             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Regextension:     %s\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(l-&gt;regexten, <span class="stringliteral">&quot;&lt;not set&gt;&quot;</span>));
<a name="l03388"></a>03388             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Regcontext:       %s\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(l-&gt;regcontext, <span class="stringliteral">&quot;&lt;not set&gt;&quot;</span>));
<a name="l03389"></a>03389             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;MoHInterpret:     %s\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(l-&gt;mohinterpret, <span class="stringliteral">&quot;&lt;not set&gt;&quot;</span>));
<a name="l03390"></a>03390             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;MoHSuggest:       %s\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(l-&gt;mohsuggest, <span class="stringliteral">&quot;&lt;not set&gt;&quot;</span>));
<a name="l03391"></a>03391             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Last dialed nr:   %s\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(l-&gt;lastnumberdialed, <span class="stringliteral">&quot;&lt;no calls made yet&gt;&quot;</span>));
<a name="l03392"></a>03392             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Last CallerID:    %s\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(l-&gt;lastcallerid, <span class="stringliteral">&quot;&lt;not set&gt;&quot;</span>));
<a name="l03393"></a>03393             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Transfer enabled: %s\n&quot;</span>, (l-&gt;transfer ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>));
<a name="l03394"></a>03394             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Callwaiting:      %s\n&quot;</span>, (l-&gt;callwaiting ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>));
<a name="l03395"></a>03395             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;3Way Calling:     %s\n&quot;</span>, (l-&gt;threewaycalling ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>));
<a name="l03396"></a>03396             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Can forward:      %s\n&quot;</span>, (l-&gt;cancallforward ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>));
<a name="l03397"></a>03397             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Do Not Disturb:   %s\n&quot;</span>, (l-&gt;dnd ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>));
<a name="l03398"></a>03398             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;NAT:              %s\n&quot;</span>, (l-&gt;nat ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>));
<a name="l03399"></a>03399             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;immediate:        %s\n&quot;</span>, (l-&gt;immediate ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>));
<a name="l03400"></a>03400             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Group:            %d\n&quot;</span>, l-&gt;group);
<a name="l03401"></a>03401             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Parkinglot:       %s\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(l-&gt;parkinglot, <span class="stringliteral">&quot;&lt;not set&gt;&quot;</span>));
<a name="l03402"></a>03402             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Conf Codecs:      &quot;</span>);
<a name="l03403"></a>03403             <a class="code" href="frame_8h.html#a37cdc7e78686b0bfa4e47e645f782b30" title="Get the names of a set of formats.">ast_getformatname_multiple</a>(codec_buf, <span class="keyword">sizeof</span>(codec_buf) - 1, l-&gt;confcapability);
<a name="l03404"></a>03404             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%s\n&quot;</span>, codec_buf);
<a name="l03405"></a>03405             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Neg Codecs:       &quot;</span>);
<a name="l03406"></a>03406             <a class="code" href="frame_8h.html#a37cdc7e78686b0bfa4e47e645f782b30" title="Get the names of a set of formats.">ast_getformatname_multiple</a>(codec_buf, <span class="keyword">sizeof</span>(codec_buf) - 1, l-&gt;capability);
<a name="l03407"></a>03407             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%s\n&quot;</span>, codec_buf);
<a name="l03408"></a>03408             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Codec Order:      (&quot;</span>);
<a name="l03409"></a>03409             <a class="code" href="chan__skinny_8c.html#a99c9993b8383b245d513d855fccdc7b9" title="Print codec list from preference to CLI/manager.">print_codec_to_cli</a>(fd, &amp;l-&gt;prefs);
<a name="l03410"></a>03410             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;)\n&quot;</span>);
<a name="l03411"></a>03411             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l03412"></a>03412          } <span class="keywordflow">else</span> { <span class="comment">/* manager */</span>
<a name="l03413"></a>03413             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Channeltype: SKINNY\r\n&quot;</span>);
<a name="l03414"></a>03414             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;ObjectName: %s\r\n&quot;</span>, l-&gt;name);
<a name="l03415"></a>03415             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;ChannelObjectType: line\r\n&quot;</span>);
<a name="l03416"></a>03416             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Device: %s\r\n&quot;</span>, d-&gt;name);
<a name="l03417"></a>03417             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;LineLabel: %s\r\n&quot;</span>, l-&gt;label);
<a name="l03418"></a>03418             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Extension: %s\r\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(l-&gt;exten, <span class="stringliteral">&quot;&lt;not set&gt;&quot;</span>));
<a name="l03419"></a>03419             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Context: %s\r\n&quot;</span>, l-&gt;context);
<a name="l03420"></a>03420             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;CallGroup: %s\r\n&quot;</span>, <a class="code" href="channel_8h.html#a092d4e67b0bda0f99b02a1534ee75408" title="print call- and pickup groups into buffer">ast_print_group</a>(group_buf, <span class="keyword">sizeof</span>(group_buf), l-&gt;callgroup));
<a name="l03421"></a>03421             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;PickupGroup: %s\r\n&quot;</span>, <a class="code" href="channel_8h.html#a092d4e67b0bda0f99b02a1534ee75408" title="print call- and pickup groups into buffer">ast_print_group</a>(group_buf, <span class="keyword">sizeof</span>(group_buf), l-&gt;pickupgroup));
<a name="l03422"></a>03422             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Language: %s\r\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(l-&gt;language, <span class="stringliteral">&quot;&lt;not set&gt;&quot;</span>));
<a name="l03423"></a>03423             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Accountcode: %s\r\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(l-&gt;accountcode, <span class="stringliteral">&quot;&lt;not set&gt;&quot;</span>));
<a name="l03424"></a>03424             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;AMAflags: %s\r\n&quot;</span>, <a class="code" href="cdr_8h.html#ac28b55abfc64e10c72d87078382a99ed">ast_cdr_flags2str</a>(l-&gt;amaflags));
<a name="l03425"></a>03425             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Callerid: %s\r\n&quot;</span>, <a class="code" href="callerid_8h.html#a1c25633b1ed63682c95ec613d7cbe559">ast_callerid_merge</a>(cbuf, <span class="keyword">sizeof</span>(cbuf), l-&gt;cid_name, l-&gt;cid_num, <span class="stringliteral">&quot;&quot;</span>));
<a name="l03426"></a>03426             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;HideCallerId: %s\r\n&quot;</span>, (l-&gt;hidecallerid ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>));
<a name="l03427"></a>03427             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;CFwdAll: %s\r\n&quot;</span>, <a class="code" href="strings_8h.html#a38a896048b2ca84076864505f0aa8f01" title="returns the equivalent of logic or for strings, with an additional boolean check:...">S_COR</a>((l-&gt;cfwdtype &amp; <a class="code" href="chan__skinny_8c.html#a1a77767cd4cfc70d096da50a2fefecd7">SKINNY_CFWD_ALL</a>), l-&gt;call_forward_all, <span class="stringliteral">&quot;&lt;not set&gt;&quot;</span>));
<a name="l03428"></a>03428             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;CFwdBusy: %s\r\n&quot;</span>, <a class="code" href="strings_8h.html#a38a896048b2ca84076864505f0aa8f01" title="returns the equivalent of logic or for strings, with an additional boolean check:...">S_COR</a>((l-&gt;cfwdtype &amp; <a class="code" href="chan__skinny_8c.html#a6cd59fd0c6c79219d38f437a485ce844">SKINNY_CFWD_BUSY</a>), l-&gt;call_forward_busy, <span class="stringliteral">&quot;&lt;not set&gt;&quot;</span>));
<a name="l03429"></a>03429             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;CFwdNoAnswer: %s\r\n&quot;</span>, <a class="code" href="strings_8h.html#a38a896048b2ca84076864505f0aa8f01" title="returns the equivalent of logic or for strings, with an additional boolean check:...">S_COR</a>((l-&gt;cfwdtype &amp; <a class="code" href="chan__skinny_8c.html#a805d890f6df0e6cf5d9f281791d2a318">SKINNY_CFWD_NOANSWER</a>), l-&gt;call_forward_noanswer, <span class="stringliteral">&quot;&lt;not set&gt;&quot;</span>));
<a name="l03430"></a>03430             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;VoicemailBox: %s\r\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(l-&gt;mailbox, <span class="stringliteral">&quot;&lt;not set&gt;&quot;</span>));
<a name="l03431"></a>03431             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;VoicemailNumber: %s\r\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(l-&gt;vmexten, <span class="stringliteral">&quot;&lt;not set&gt;&quot;</span>));
<a name="l03432"></a>03432             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;MWIblink: %d\r\n&quot;</span>, l-&gt;mwiblink);
<a name="l03433"></a>03433             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;RegExtension: %s\r\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(l-&gt;regexten, <span class="stringliteral">&quot;&lt;not set&gt;&quot;</span>));
<a name="l03434"></a>03434             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Regcontext: %s\r\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(l-&gt;regcontext, <span class="stringliteral">&quot;&lt;not set&gt;&quot;</span>));
<a name="l03435"></a>03435             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;MoHInterpret: %s\r\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(l-&gt;mohinterpret, <span class="stringliteral">&quot;&lt;not set&gt;&quot;</span>));
<a name="l03436"></a>03436             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;MoHSuggest: %s\r\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(l-&gt;mohsuggest, <span class="stringliteral">&quot;&lt;not set&gt;&quot;</span>));
<a name="l03437"></a>03437             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;LastDialedNr: %s\r\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(l-&gt;lastnumberdialed, <span class="stringliteral">&quot;&lt;no calls made yet&gt;&quot;</span>));
<a name="l03438"></a>03438             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;LastCallerID: %s\r\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(l-&gt;lastcallerid, <span class="stringliteral">&quot;&lt;not set&gt;&quot;</span>));
<a name="l03439"></a>03439             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Transfer: %s\r\n&quot;</span>, (l-&gt;transfer ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>));
<a name="l03440"></a>03440             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Callwaiting: %s\r\n&quot;</span>, (l-&gt;callwaiting ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>));
<a name="l03441"></a>03441             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;3WayCalling: %s\r\n&quot;</span>, (l-&gt;threewaycalling ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>));
<a name="l03442"></a>03442             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;CanForward: %s\r\n&quot;</span>, (l-&gt;cancallforward ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>));
<a name="l03443"></a>03443             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;DoNotDisturb: %s\r\n&quot;</span>, (l-&gt;dnd ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>));
<a name="l03444"></a>03444             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;NAT: %s\r\n&quot;</span>, (l-&gt;nat ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>));
<a name="l03445"></a>03445             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;immediate: %s\r\n&quot;</span>, (l-&gt;immediate ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>));
<a name="l03446"></a>03446             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Group: %d\r\n&quot;</span>, l-&gt;group);
<a name="l03447"></a>03447             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Parkinglot: %s\r\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(l-&gt;parkinglot, <span class="stringliteral">&quot;&lt;not set&gt;&quot;</span>));
<a name="l03448"></a>03448             <a class="code" href="frame_8h.html#a37cdc7e78686b0bfa4e47e645f782b30" title="Get the names of a set of formats.">ast_getformatname_multiple</a>(codec_buf, <span class="keyword">sizeof</span>(codec_buf) - 1, l-&gt;confcapability);
<a name="l03449"></a>03449             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Codecs: %s\r\n&quot;</span>, codec_buf);
<a name="l03450"></a>03450             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;CodecOrder: &quot;</span>);
<a name="l03451"></a>03451             pref = &amp;l-&gt;prefs;
<a name="l03452"></a>03452             <span class="keywordflow">for</span>(x = 0; x &lt; 32 ; x++) {
<a name="l03453"></a>03453                codec = <a class="code" href="frame_8h.html#af9dd4cbc4b715644df1afe4964169c9b" title="Codec located at a particular place in the preference index.">ast_codec_pref_index</a>(pref, x);
<a name="l03454"></a>03454                <span class="keywordflow">if</span> (!codec)
<a name="l03455"></a>03455                   <span class="keywordflow">break</span>;
<a name="l03456"></a>03456                <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(codec));
<a name="l03457"></a>03457                <span class="keywordflow">if</span> (x &lt; 31 &amp;&amp; <a class="code" href="frame_8h.html#af9dd4cbc4b715644df1afe4964169c9b" title="Codec located at a particular place in the preference index.">ast_codec_pref_index</a>(pref, x+1))
<a name="l03458"></a>03458                   <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;,&quot;</span>);
<a name="l03459"></a>03459             }
<a name="l03460"></a>03460             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;\r\n&quot;</span>);
<a name="l03461"></a>03461          }
<a name="l03462"></a>03462       }
<a name="l03463"></a>03463    }
<a name="l03464"></a>03464    
<a name="l03465"></a>03465    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>);
<a name="l03466"></a>03466    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l03467"></a>03467 }
<a name="l03468"></a>03468 
<a name="l03469"></a><a class="code" href="chan__skinny_8c.html#a2193fe3c36be63b25002e47f39f1fc05">03469</a> <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="chan__skinny_8c.html#a2193fe3c36be63b25002e47f39f1fc05">mandescr_show_line</a>[] =
<a name="l03470"></a>03470 <span class="stringliteral">&quot;Description: Show one SKINNY line with details on current status.\n&quot;</span>
<a name="l03471"></a>03471 <span class="stringliteral">&quot;Variables: \n&quot;</span>
<a name="l03472"></a>03472 <span class="stringliteral">&quot;  Line: &lt;name&gt;           The line name you want to check.\n&quot;</span>
<a name="l03473"></a>03473 <span class="stringliteral">&quot;  ActionID: &lt;id&gt;   Optional action ID for this AMI transaction.\n&quot;</span>;
<a name="l03474"></a>03474 
<a name="l03475"></a><a class="code" href="chan__skinny_8c.html#a665787ef574f276e9a42fcfc3db4dbb4">03475</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a665787ef574f276e9a42fcfc3db4dbb4">manager_skinny_show_line</a>(<span class="keyword">struct</span> <a class="code" href="structmansession.html">mansession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structmessage.html">message</a> *m)
<a name="l03476"></a>03476 {
<a name="l03477"></a>03477    <span class="keyword">const</span> <span class="keywordtype">char</span> *a[4];
<a name="l03478"></a>03478    <span class="keyword">const</span> <span class="keywordtype">char</span> *line;
<a name="l03479"></a>03479 
<a name="l03480"></a>03480    line = <a class="code" href="group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556" title="Get header from mananger transaction.">astman_get_header</a>(m, <span class="stringliteral">&quot;Line&quot;</span>);
<a name="l03481"></a>03481    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(line)) {
<a name="l03482"></a>03482       <a class="code" href="group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c" title="Send error in manager transaction.">astman_send_error</a>(s, m, <span class="stringliteral">&quot;Line: &lt;name&gt; missing.&quot;</span>);
<a name="l03483"></a>03483       <span class="keywordflow">return</span> 0;
<a name="l03484"></a>03484    }
<a name="l03485"></a>03485    a[0] = <span class="stringliteral">&quot;skinny&quot;</span>;
<a name="l03486"></a>03486    a[1] = <span class="stringliteral">&quot;show&quot;</span>;
<a name="l03487"></a>03487    a[2] = <span class="stringliteral">&quot;line&quot;</span>;
<a name="l03488"></a>03488    a[3] = line;
<a name="l03489"></a>03489 
<a name="l03490"></a>03490    <a class="code" href="chan__skinny_8c.html#a67bdebd523722eec9a784e69cbb8545d">_skinny_show_line</a>(1, -1, s, m, 4, a);
<a name="l03491"></a>03491    <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;\r\n\r\n&quot;</span> );
<a name="l03492"></a>03492    <span class="keywordflow">return</span> 0;
<a name="l03493"></a>03493 }
<a name="l03494"></a>03494 <span class="comment"></span>
<a name="l03495"></a>03495 <span class="comment">/*! \brief List line information. */</span>
<a name="l03496"></a><a class="code" href="chan__skinny_8c.html#ab2c8a9b4d1c45221578f1c38d56205d1">03496</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="chan__skinny_8c.html#ab2c8a9b4d1c45221578f1c38d56205d1" title="List line information.">handle_skinny_show_line</a>(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="structast__cli__args.html">ast_cli_args</a> *a)
<a name="l03497"></a>03497 {
<a name="l03498"></a>03498    <span class="keywordflow">switch</span> (cmd) {
<a name="l03499"></a>03499    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l03500"></a>03500       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;skinny show line&quot;</span>;
<a name="l03501"></a>03501       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l03502"></a>03502          <span class="stringliteral">&quot;Usage: skinny show line &lt;Line&gt; [ on &lt;DeviceID|DeviceName&gt; ]\n&quot;</span>
<a name="l03503"></a>03503          <span class="stringliteral">&quot;       List all lineinformation of a specific line known to the Skinny subsystem.\n&quot;</span>;
<a name="l03504"></a>03504       <span class="keywordflow">return</span> NULL;
<a name="l03505"></a>03505    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l03506"></a>03506       <span class="keywordflow">return</span> <a class="code" href="chan__skinny_8c.html#aa1d32ef00ccadf4ded249067f83e8426">complete_skinny_show_line</a>(a-&gt;<a class="code" href="structast__cli__args.html#a2a7a1aa13a4f14075411123a4495593c">line</a>, a-&gt;<a class="code" href="structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>, a-&gt;<a class="code" href="structast__cli__args.html#a1910d262855b71da353ed0d07a6c7823">pos</a>, a-&gt;<a class="code" href="structast__cli__args.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>);
<a name="l03507"></a>03507    }
<a name="l03508"></a>03508 
<a name="l03509"></a>03509    <span class="keywordflow">return</span> <a class="code" href="chan__skinny_8c.html#a67bdebd523722eec9a784e69cbb8545d">_skinny_show_line</a>(0, a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, NULL, NULL, a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a>, (<span class="keyword">const</span> <span class="keywordtype">char</span> **) a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>);
<a name="l03510"></a>03510 }
<a name="l03511"></a>03511 <span class="comment"></span>
<a name="l03512"></a>03512 <span class="comment">/*! \brief List global settings for the Skinny subsystem. */</span>
<a name="l03513"></a><a class="code" href="chan__skinny_8c.html#aac76ce73e7e3ed21fe0b3b86e31c0f75">03513</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="chan__skinny_8c.html#aac76ce73e7e3ed21fe0b3b86e31c0f75" title="List global settings for the Skinny subsystem.">handle_skinny_show_settings</a>(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="structast__cli__args.html">ast_cli_args</a> *a)
<a name="l03514"></a>03514 {
<a name="l03515"></a>03515    <span class="keywordflow">switch</span> (cmd) {
<a name="l03516"></a>03516    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l03517"></a>03517       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;skinny show settings&quot;</span>;
<a name="l03518"></a>03518       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l03519"></a>03519          <span class="stringliteral">&quot;Usage: skinny show settings\n&quot;</span>
<a name="l03520"></a>03520          <span class="stringliteral">&quot;       Lists all global configuration settings of the Skinny subsystem.\n&quot;</span>;
<a name="l03521"></a>03521       <span class="keywordflow">return</span> NULL;
<a name="l03522"></a>03522    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l03523"></a>03523       <span class="keywordflow">return</span> NULL;
<a name="l03524"></a>03524    }  
<a name="l03525"></a>03525 
<a name="l03526"></a>03526    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != 3)
<a name="l03527"></a>03527       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l03528"></a>03528 
<a name="l03529"></a>03529    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;\nGlobal Settings:\n&quot;</span>);
<a name="l03530"></a>03530    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;  Skinny Port:            %d\n&quot;</span>, ntohs(<a class="code" href="chan__skinny_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>.sin_port));
<a name="l03531"></a>03531    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;  Bindaddress:            %s\n&quot;</span>, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(<a class="code" href="chan__skinny_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>.sin_addr));
<a name="l03532"></a>03532    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;  KeepAlive:              %d\n&quot;</span>, keep_alive);
<a name="l03533"></a>03533    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;  Date Format:            %s\n&quot;</span>, date_format);
<a name="l03534"></a>03534    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;  Voice Mail Extension:   %s\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(global_vmexten, <span class="stringliteral">&quot;(not set)&quot;</span>));
<a name="l03535"></a>03535    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;  Reg. context:           %s\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(regcontext, <span class="stringliteral">&quot;(not set)&quot;</span>));
<a name="l03536"></a>03536    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;  Jitterbuffer enabled:   %s\n&quot;</span>, (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;<a class="code" href="chan__skinny_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">global_jbconf</a>, <a class="code" href="abstract__jb_8h.html#aad393aa3e173d7f081ab4bbc6ba5027daf49c3e265d3ff27e62d8c38779d89dd9">AST_JB_ENABLED</a>) ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>));
<a name="l03537"></a>03537    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;  Jitterbuffer forced:    %s\n&quot;</span>, (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;<a class="code" href="chan__skinny_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">global_jbconf</a>, <a class="code" href="abstract__jb_8h.html#aad393aa3e173d7f081ab4bbc6ba5027dac9bdd81232f2ef32fad9ebd0b92b9f63">AST_JB_FORCED</a>) ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>));
<a name="l03538"></a>03538    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;  Jitterbuffer max size:  %ld\n&quot;</span>, <a class="code" href="chan__skinny_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">global_jbconf</a>.<a class="code" href="structast__jb__conf.html#aaba39ba18eb00647786272b9061659e3" title="Max size of the jitterbuffer implementation.">max_size</a>);
<a name="l03539"></a>03539    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;  Jitterbuffer resync:    %ld\n&quot;</span>, <a class="code" href="chan__skinny_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">global_jbconf</a>.<a class="code" href="structast__jb__conf.html#ab5d708c3e3489b6fd1f92b19939c18e8" title="Resynchronization threshold of the jitterbuffer implementation.">resync_threshold</a>);
<a name="l03540"></a>03540    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;  Jitterbuffer impl:      %s\n&quot;</span>, <a class="code" href="chan__skinny_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">global_jbconf</a>.<a class="code" href="structast__jb__conf.html#a60072c5fdc7f8f7772e49783b48e37a6" title="Name of the jitterbuffer implementation to be used.">impl</a>);
<a name="l03541"></a>03541    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;  Jitterbuffer log:       %s\n&quot;</span>, (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;<a class="code" href="chan__skinny_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">global_jbconf</a>, <a class="code" href="abstract__jb_8h.html#aad393aa3e173d7f081ab4bbc6ba5027dae6ca3d7ddaa509b36e1fb4c36c18478e">AST_JB_LOG</a>) ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>));
<a name="l03542"></a>03542 
<a name="l03543"></a>03543    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l03544"></a>03544 }
<a name="l03545"></a>03545 
<a name="l03546"></a><a class="code" href="chan__skinny_8c.html#af1f50f72b24c706be012b5d9d93d4a10">03546</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> <a class="code" href="chan__skinny_8c.html#af1f50f72b24c706be012b5d9d93d4a10">cli_skinny</a>[] = {
<a name="l03547"></a>03547    <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="chan__skinny_8c.html#ae40517f2290aaf18acf058abb998173e">handle_skinny_show_devices</a>, <span class="stringliteral">&quot;List defined Skinny devices&quot;</span>),
<a name="l03548"></a>03548    <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="chan__skinny_8c.html#a6aeb19612127b1e5b27bbaf1950b922d" title="Show device information.">handle_skinny_show_device</a>, <span class="stringliteral">&quot;List Skinny device information&quot;</span>),
<a name="l03549"></a>03549    <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="chan__skinny_8c.html#aa141f086a05a7250a05aef742a4875c8">handle_skinny_show_lines</a>, <span class="stringliteral">&quot;List defined Skinny lines per device&quot;</span>),
<a name="l03550"></a>03550    <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="chan__skinny_8c.html#ab2c8a9b4d1c45221578f1c38d56205d1" title="List line information.">handle_skinny_show_line</a>, <span class="stringliteral">&quot;List Skinny line information&quot;</span>),
<a name="l03551"></a>03551    <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="chan__skinny_8c.html#aac76ce73e7e3ed21fe0b3b86e31c0f75" title="List global settings for the Skinny subsystem.">handle_skinny_show_settings</a>, <span class="stringliteral">&quot;List global Skinny settings&quot;</span>),
<a name="l03552"></a>03552    <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="chan__skinny_8c.html#a092e3458bbcb8f2c2f2d10ed8ea26a97">handle_skinny_set_debug</a>, <span class="stringliteral">&quot;Enable/Disable Skinny debugging&quot;</span>),
<a name="l03553"></a>03553    <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="chan__skinny_8c.html#a90b8b765d7701285c46cd5b10f116605">handle_skinny_reset</a>, <span class="stringliteral">&quot;Reset Skinny device(s)&quot;</span>),
<a name="l03554"></a>03554    <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="chan__skinny_8c.html#aa9263b2b877126867940d57b86a8132d">handle_skinny_reload</a>, <span class="stringliteral">&quot;Reload Skinny config&quot;</span>),
<a name="l03555"></a>03555 };
<a name="l03556"></a>03556 
<a name="l03557"></a><a class="code" href="chan__skinny_8c.html#afdd465471ea50755ff86f47ead660ea0">03557</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__skinny_8c.html#afdd465471ea50755ff86f47ead660ea0">start_rtp</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub)
<a name="l03558"></a>03558 {
<a name="l03559"></a>03559    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l = sub-&gt;parent;
<a name="l03560"></a>03560    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d = l-&gt;device;
<a name="l03561"></a>03561    <span class="keywordtype">int</span> hasvideo = 0;
<a name="l03562"></a>03562 
<a name="l03563"></a>03563    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;sub-&gt;<a class="code" href="structskinny__subchannel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03564"></a>03564    <span class="comment">/* Allocate the RTP */</span>
<a name="l03565"></a>03565    sub-&gt;<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a> = <a class="code" href="rtp_8h.html#a10d5296cd50be78954103b0a0c754640" title="Initializate a RTP session using an in_addr structure.">ast_rtp_new_with_bindaddr</a>(sched, io, 1, 0, <a class="code" href="chan__skinny_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>.sin_addr);
<a name="l03566"></a>03566    <span class="keywordflow">if</span> (hasvideo)
<a name="l03567"></a>03567       sub-&gt;<a class="code" href="structskinny__subchannel.html#a65e8f978abd3f0206026969c627200a9">vrtp</a> = <a class="code" href="rtp_8h.html#a10d5296cd50be78954103b0a0c754640" title="Initializate a RTP session using an in_addr structure.">ast_rtp_new_with_bindaddr</a>(sched, io, 1, 0, <a class="code" href="chan__skinny_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>.sin_addr);
<a name="l03568"></a>03568    
<a name="l03569"></a>03569    <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a> &amp;&amp; sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l03570"></a>03570       <a class="code" href="channel_8h.html#aca37ca2f3d55a223d26617329ed48a3e">ast_channel_set_fd</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, 0, <a class="code" href="rtp_8h.html#a9a990d85fb0aac29bda48777f0f86108">ast_rtp_fd</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a>));
<a name="l03571"></a>03571       <a class="code" href="channel_8h.html#aca37ca2f3d55a223d26617329ed48a3e">ast_channel_set_fd</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, 1, <a class="code" href="rtp_8h.html#ac3e115dfd0bfe82479060b55dd41601f">ast_rtcp_fd</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a>));
<a name="l03572"></a>03572    }
<a name="l03573"></a>03573    <span class="keywordflow">if</span> (hasvideo &amp;&amp; sub-&gt;<a class="code" href="structskinny__subchannel.html#a65e8f978abd3f0206026969c627200a9">vrtp</a> &amp;&amp; sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l03574"></a>03574       <a class="code" href="channel_8h.html#aca37ca2f3d55a223d26617329ed48a3e">ast_channel_set_fd</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, 2, <a class="code" href="rtp_8h.html#a9a990d85fb0aac29bda48777f0f86108">ast_rtp_fd</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a65e8f978abd3f0206026969c627200a9">vrtp</a>));
<a name="l03575"></a>03575       <a class="code" href="channel_8h.html#aca37ca2f3d55a223d26617329ed48a3e">ast_channel_set_fd</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, 3, <a class="code" href="rtp_8h.html#ac3e115dfd0bfe82479060b55dd41601f">ast_rtcp_fd</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a65e8f978abd3f0206026969c627200a9">vrtp</a>));
<a name="l03576"></a>03576    }
<a name="l03577"></a>03577    <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a>) {
<a name="l03578"></a>03578       <a class="code" href="rtp_8h.html#af8579b7a7b2815a83cd80bf1c23d7824">ast_rtp_setqos</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, <a class="code" href="chan__skinny_8c.html#abe7ea21619e746bb9b12fe3e47bc861b">qos</a>.tos_audio, <a class="code" href="chan__skinny_8c.html#abe7ea21619e746bb9b12fe3e47bc861b">qos</a>.cos_audio, <span class="stringliteral">&quot;Skinny RTP&quot;</span>);
<a name="l03579"></a>03579       <a class="code" href="rtp_8h.html#ad7fd9b0ac09fc5378dcf120bc5d18c03">ast_rtp_setnat</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, l-&gt;nat);
<a name="l03580"></a>03580    }
<a name="l03581"></a>03581    <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#a65e8f978abd3f0206026969c627200a9">vrtp</a>) {
<a name="l03582"></a>03582       <a class="code" href="rtp_8h.html#af8579b7a7b2815a83cd80bf1c23d7824">ast_rtp_setqos</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a65e8f978abd3f0206026969c627200a9">vrtp</a>, <a class="code" href="chan__skinny_8c.html#abe7ea21619e746bb9b12fe3e47bc861b">qos</a>.tos_video, <a class="code" href="chan__skinny_8c.html#abe7ea21619e746bb9b12fe3e47bc861b">qos</a>.cos_video, <span class="stringliteral">&quot;Skinny VRTP&quot;</span>);
<a name="l03583"></a>03583       <a class="code" href="rtp_8h.html#ad7fd9b0ac09fc5378dcf120bc5d18c03">ast_rtp_setnat</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a65e8f978abd3f0206026969c627200a9">vrtp</a>, l-&gt;nat);
<a name="l03584"></a>03584    }
<a name="l03585"></a>03585    <span class="comment">/* Set Frame packetization */</span>
<a name="l03586"></a>03586    <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a>)
<a name="l03587"></a>03587       <a class="code" href="rtp_8h.html#ae6a1acd75aaf08afc6954bd5ac671c6a" title="Set codec preference.">ast_rtp_codec_setpref</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, &amp;l-&gt;prefs);
<a name="l03588"></a>03588 
<a name="l03589"></a>03589    <span class="comment">/* Create the RTP connection */</span>
<a name="l03590"></a>03590    <a class="code" href="chan__skinny_8c.html#ae0cb986aeace802ace6a240d73c7335c">transmit_connect</a>(d, sub);
<a name="l03591"></a>03591    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;sub-&gt;<a class="code" href="structskinny__subchannel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03592"></a>03592 }
<a name="l03593"></a>03593 
<a name="l03594"></a><a class="code" href="chan__skinny_8c.html#a7341024ae1e485aaad445b8d2504b446">03594</a> <span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="chan__skinny_8c.html#a7341024ae1e485aaad445b8d2504b446">skinny_newcall</a>(<span class="keywordtype">void</span> *data)
<a name="l03595"></a>03595 {
<a name="l03596"></a>03596    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c = data;
<a name="l03597"></a>03597    <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub = c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l03598"></a>03598    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l = sub-&gt;parent;
<a name="l03599"></a>03599    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d = l-&gt;device;
<a name="l03600"></a>03600    <span class="keywordtype">int</span> res = 0;
<a name="l03601"></a>03601 
<a name="l03602"></a>03602    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(l-&gt;lastnumberdialed, c-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, <span class="keyword">sizeof</span>(l-&gt;lastnumberdialed));
<a name="l03603"></a>03603    <a class="code" href="channel_8h.html#a88d833a56ea7de33e230281c5c12b75d" title="Set caller ID number, name and ANI.">ast_set_callerid</a>(c,
<a name="l03604"></a>03604       l-&gt;hidecallerid ? <span class="stringliteral">&quot;&quot;</span> : l-&gt;cid_num,
<a name="l03605"></a>03605       l-&gt;hidecallerid ? <span class="stringliteral">&quot;&quot;</span> : l-&gt;cid_name,
<a name="l03606"></a>03606       c-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a7bb8ad258e687da69d6933ab48320df7">cid_ani</a> ? NULL : l-&gt;cid_num);
<a name="l03607"></a>03607    <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(c, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>);
<a name="l03608"></a>03608    <span class="keywordflow">if</span> (!sub-&gt;<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a>) {
<a name="l03609"></a>03609       <a class="code" href="chan__skinny_8c.html#afdd465471ea50755ff86f47ead660ea0">start_rtp</a>(sub);
<a name="l03610"></a>03610    }
<a name="l03611"></a>03611    res = <a class="code" href="pbx_8h.html#a44b6406c9220f7f2b610ac712369f405" title="Execute the PBX in the current thread.">ast_pbx_run</a>(c);
<a name="l03612"></a>03612    <span class="keywordflow">if</span> (res) {
<a name="l03613"></a>03613       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;PBX exited non-zero\n&quot;</span>);
<a name="l03614"></a>03614       <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, <a class="code" href="chan__skinny_8c.html#aceb6a87185d21366d7f3f21fd69cee90">SKINNY_REORDER</a>, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l03615"></a>03615    }
<a name="l03616"></a>03616    <span class="keywordflow">return</span> NULL;
<a name="l03617"></a>03617 }
<a name="l03618"></a>03618 
<a name="l03619"></a><a class="code" href="chan__skinny_8c.html#ad5d83012c464b49bfde0406a3dff68fe">03619</a> <span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="chan__skinny_8c.html#ad5d83012c464b49bfde0406a3dff68fe">skinny_ss</a>(<span class="keywordtype">void</span> *data)
<a name="l03620"></a>03620 {
<a name="l03621"></a>03621    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c = data;
<a name="l03622"></a>03622    <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub = c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l03623"></a>03623    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l = sub-&gt;parent;
<a name="l03624"></a>03624    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d = l-&gt;device;
<a name="l03625"></a>03625    <span class="keywordtype">int</span> <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> = 0;
<a name="l03626"></a>03626    <span class="keywordtype">int</span> timeout = firstdigittimeout;
<a name="l03627"></a>03627    <span class="keywordtype">int</span> res = 0;
<a name="l03628"></a>03628    <span class="keywordtype">int</span> loop_pause = 100;
<a name="l03629"></a>03629 
<a name="l03630"></a>03630    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Starting simple switch on &apos;%s@%s&apos;\n&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l03631"></a>03631 
<a name="l03632"></a>03632    len = strlen(d-&gt;exten);
<a name="l03633"></a>03633 
<a name="l03634"></a>03634    <span class="keywordflow">while</span> (len &lt; <a class="code" href="channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>-1) {
<a name="l03635"></a>03635       res = 1;  <span class="comment">/* Assume that we will get a digit */</span>
<a name="l03636"></a>03636       <span class="keywordflow">while</span> (strlen(d-&gt;exten) == len){
<a name="l03637"></a>03637          <a class="code" href="channel_8h.html#af10e3bd01602095e1908d3926afc3b76" title="Wait for a specified amount of time, looking for hangups.">ast_safe_sleep</a>(c, loop_pause);
<a name="l03638"></a>03638          timeout -= loop_pause;
<a name="l03639"></a>03639          <span class="keywordflow">if</span> ( (timeout -= loop_pause) &lt;= 0){
<a name="l03640"></a>03640              res = 0;
<a name="l03641"></a>03641              <span class="keywordflow">break</span>;
<a name="l03642"></a>03642          }
<a name="l03643"></a>03643       res = 1;
<a name="l03644"></a>03644       }
<a name="l03645"></a>03645 
<a name="l03646"></a>03646       timeout = 0;
<a name="l03647"></a>03647       len = strlen(d-&gt;exten);
<a name="l03648"></a>03648 
<a name="l03649"></a>03649       <span class="keywordflow">if</span> (!<a class="code" href="pbx_8h.html#aa73d176ed4f1ce51e5db6beafba45fe3" title="Checks to see if a number should be ignored.">ast_ignore_pattern</a>(c-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, d-&gt;exten)) {
<a name="l03650"></a>03650          <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, <a class="code" href="chan__skinny_8c.html#a2c63c304c5e6eff4a0b13617eb4a9bed">SKINNY_SILENCE</a>, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l03651"></a>03651       }
<a name="l03652"></a>03652       <span class="keywordflow">if</span> (<a class="code" href="pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7" title="Determine whether an extension exists.">ast_exists_extension</a>(c, c-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, d-&gt;exten, 1, l-&gt;cid_num)) {
<a name="l03653"></a>03653          <span class="keywordflow">if</span> (!res || !<a class="code" href="pbx_8h.html#ac359af75b9494f50904583d2168a7577" title="Looks to see if adding anything to this extension might match something. (exists...">ast_matchmore_extension</a>(c, c-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, d-&gt;exten, 1, l-&gt;cid_num)) {
<a name="l03654"></a>03654             <span class="keywordflow">if</span> (l-&gt;getforward) {
<a name="l03655"></a>03655                <span class="comment">/* Record this as the forwarding extension */</span>
<a name="l03656"></a>03656                <a class="code" href="chan__skinny_8c.html#ab04a8ea6a900e9b9327d8e896b61899b">set_callforwards</a>(l, d-&gt;exten, l-&gt;getforward);
<a name="l03657"></a>03657                <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Setting call forward (%d) to &apos;%s&apos; on channel %s\n&quot;</span>,
<a name="l03658"></a>03658                      l-&gt;cfwdtype, d-&gt;exten, c-&gt;name);
<a name="l03659"></a>03659                <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, <a class="code" href="chan__skinny_8c.html#a12616ab9d64a36f7c2f372084a3663c8">SKINNY_DIALTONE</a>, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l03660"></a>03660                <a class="code" href="chan__skinny_8c.html#aa16aabd900fdb4bd057303387115959f">transmit_lamp_indication</a>(d, <a class="code" href="chan__skinny_8c.html#af3ac1b0d1c42719b924361fb782507e5">STIMULUS_FORWARDALL</a>, 1, <a class="code" href="chan__skinny_8c.html#a360e677a1a8e92ab455b8c354a15d969">SKINNY_LAMP_ON</a>);
<a name="l03661"></a>03661                <a class="code" href="chan__skinny_8c.html#a8122a36b30f8a86ffe3a06548fa8903c">transmit_displaynotify</a>(d, <span class="stringliteral">&quot;CFwd enabled&quot;</span>, 10);
<a name="l03662"></a>03662                <a class="code" href="chan__skinny_8c.html#aa51e51361738b28e24f83d7ec6b4c0f3">transmit_cfwdstate</a>(d, l);
<a name="l03663"></a>03663                <a class="code" href="channel_8h.html#af10e3bd01602095e1908d3926afc3b76" title="Wait for a specified amount of time, looking for hangups.">ast_safe_sleep</a>(c, 500);
<a name="l03664"></a>03664                <a class="code" href="channel_8h.html#aef2af15a597c948e97628da6c5c84f28" title="Indicates condition of channel.">ast_indicate</a>(c, -1);
<a name="l03665"></a>03665                <a class="code" href="channel_8h.html#af10e3bd01602095e1908d3926afc3b76" title="Wait for a specified amount of time, looking for hangups.">ast_safe_sleep</a>(c, 1000);
<a name="l03666"></a>03666                memset(d-&gt;exten, 0, <span class="keyword">sizeof</span>(d-&gt;exten));
<a name="l03667"></a>03667                len = 0;
<a name="l03668"></a>03668                l-&gt;getforward = 0;
<a name="l03669"></a>03669                <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) {
<a name="l03670"></a>03670                   <a class="code" href="channel_8h.html#aef2af15a597c948e97628da6c5c84f28" title="Indicates condition of channel.">ast_indicate</a>(c, -1);
<a name="l03671"></a>03671                   <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(c);
<a name="l03672"></a>03672                }
<a name="l03673"></a>03673                <span class="keywordflow">return</span> NULL;
<a name="l03674"></a>03674             } <span class="keywordflow">else</span> {
<a name="l03675"></a>03675                <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(c-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, d-&gt;exten, <span class="keyword">sizeof</span>(c-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>));
<a name="l03676"></a>03676                <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(l-&gt;lastnumberdialed, d-&gt;exten, <span class="keyword">sizeof</span>(l-&gt;lastnumberdialed));
<a name="l03677"></a>03677                memset(d-&gt;exten, 0, <span class="keyword">sizeof</span>(d-&gt;exten));
<a name="l03678"></a>03678                <a class="code" href="chan__skinny_8c.html#a7341024ae1e485aaad445b8d2504b446">skinny_newcall</a>(c);
<a name="l03679"></a>03679                <span class="keywordflow">return</span> NULL;
<a name="l03680"></a>03680             }
<a name="l03681"></a>03681          } <span class="keywordflow">else</span> {
<a name="l03682"></a>03682             <span class="comment">/* It&apos;s a match, but they just typed a digit, and there is an ambiguous match,</span>
<a name="l03683"></a>03683 <span class="comment">               so just set the timeout to matchdigittimeout and wait some more */</span>
<a name="l03684"></a>03684             timeout = matchdigittimeout;
<a name="l03685"></a>03685          }
<a name="l03686"></a>03686       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res == 0) {
<a name="l03687"></a>03687          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Not enough digits (%s) (and no ambiguous match)...\n&quot;</span>, d-&gt;exten);
<a name="l03688"></a>03688          memset(d-&gt;exten, 0, <span class="keyword">sizeof</span>(d-&gt;exten));
<a name="l03689"></a>03689          <span class="keywordflow">if</span> (l-&gt;hookstate == <a class="code" href="chan__skinny_8c.html#a2e10f13253ac5069f50f7f66b9511537">SKINNY_OFFHOOK</a>) {
<a name="l03690"></a>03690             <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, <a class="code" href="chan__skinny_8c.html#aceb6a87185d21366d7f3f21fd69cee90">SKINNY_REORDER</a>, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l03691"></a>03691          }
<a name="l03692"></a>03692          <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) {
<a name="l03693"></a>03693             <a class="code" href="channel_8h.html#aef2af15a597c948e97628da6c5c84f28" title="Indicates condition of channel.">ast_indicate</a>(c, -1);
<a name="l03694"></a>03694             <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(c);
<a name="l03695"></a>03695          }
<a name="l03696"></a>03696          <span class="keywordflow">return</span> NULL;
<a name="l03697"></a>03697       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="pbx_8h.html#a93f9868530c1e8a9d9d367d1ead8782e" title="Looks for a valid matching extension.">ast_canmatch_extension</a>(c, c-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, d-&gt;exten, 1, c-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>) &amp;&amp;
<a name="l03698"></a>03698             ((d-&gt;exten[0] != <span class="charliteral">&apos;*&apos;</span>) || (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(d-&gt;exten) &gt; 2))) {
<a name="l03699"></a>03699          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Can&apos;t match [%s] from &apos;%s&apos; in context %s\n&quot;</span>, d-&gt;exten, c-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a> ? c-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a> : <span class="stringliteral">&quot;&lt;Unknown Caller&gt;&quot;</span>, c-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>);
<a name="l03700"></a>03700          memset(d-&gt;exten, 0, <span class="keyword">sizeof</span>(d-&gt;exten));
<a name="l03701"></a>03701          <span class="keywordflow">if</span> (l-&gt;hookstate == <a class="code" href="chan__skinny_8c.html#a2e10f13253ac5069f50f7f66b9511537">SKINNY_OFFHOOK</a>) {
<a name="l03702"></a>03702             <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, <a class="code" href="chan__skinny_8c.html#aceb6a87185d21366d7f3f21fd69cee90">SKINNY_REORDER</a>, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l03703"></a>03703             <span class="comment">/* hang out for 3 seconds to let congestion play */</span>
<a name="l03704"></a>03704             <a class="code" href="channel_8h.html#af10e3bd01602095e1908d3926afc3b76" title="Wait for a specified amount of time, looking for hangups.">ast_safe_sleep</a>(c, 3000);
<a name="l03705"></a>03705          }
<a name="l03706"></a>03706          <span class="keywordflow">break</span>;
<a name="l03707"></a>03707       }
<a name="l03708"></a>03708       <span class="keywordflow">if</span> (!timeout) {
<a name="l03709"></a>03709          timeout = gendigittimeout;
<a name="l03710"></a>03710       }
<a name="l03711"></a>03711       <span class="keywordflow">if</span> (len &amp;&amp; !<a class="code" href="pbx_8h.html#aa73d176ed4f1ce51e5db6beafba45fe3" title="Checks to see if a number should be ignored.">ast_ignore_pattern</a>(c-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, d-&gt;exten)) {
<a name="l03712"></a>03712          <a class="code" href="channel_8h.html#aef2af15a597c948e97628da6c5c84f28" title="Indicates condition of channel.">ast_indicate</a>(c, -1);
<a name="l03713"></a>03713       }
<a name="l03714"></a>03714    }
<a name="l03715"></a>03715    <span class="keywordflow">if</span> (c)
<a name="l03716"></a>03716       <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(c);
<a name="l03717"></a>03717    memset(d-&gt;exten, 0, <span class="keyword">sizeof</span>(d-&gt;exten));
<a name="l03718"></a>03718    <span class="keywordflow">return</span> NULL;
<a name="l03719"></a>03719 }
<a name="l03720"></a>03720 
<a name="l03721"></a>03721 
<a name="l03722"></a>03722 
<a name="l03723"></a><a class="code" href="chan__skinny_8c.html#a0a988e663d92ee91aba280fb97e1640f">03723</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a0a988e663d92ee91aba280fb97e1640f">skinny_call</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *ast, <span class="keywordtype">char</span> *dest, <span class="keywordtype">int</span> timeout)
<a name="l03724"></a>03724 {
<a name="l03725"></a>03725    <span class="keywordtype">int</span> res = 0;
<a name="l03726"></a>03726    <span class="keywordtype">int</span> tone = 0;
<a name="l03727"></a>03727    <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l03728"></a>03728    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l = sub-&gt;parent;
<a name="l03729"></a>03729    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d = l-&gt;device;
<a name="l03730"></a>03730 
<a name="l03731"></a>03731    <span class="keywordflow">if</span> (!d-&gt;registered) {
<a name="l03732"></a>03732       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Device not registered, cannot call %s\n&quot;</span>, dest);
<a name="l03733"></a>03733       <span class="keywordflow">return</span> -1;
<a name="l03734"></a>03734    }
<a name="l03735"></a>03735 
<a name="l03736"></a>03736    <span class="keywordflow">if</span> ((ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>) &amp;&amp; (ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660addb60fd97b55a4aea24f992e30fe3c84">AST_STATE_RESERVED</a>)) {
<a name="l03737"></a>03737       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;skinny_call called on %s, neither down nor reserved\n&quot;</span>, ast-&gt;name);
<a name="l03738"></a>03738       <span class="keywordflow">return</span> -1;
<a name="l03739"></a>03739    }
<a name="l03740"></a>03740 
<a name="l03741"></a>03741    <span class="keywordflow">if</span> (skinnydebug)
<a name="l03742"></a>03742       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;skinny_call(%s)\n&quot;</span>, ast-&gt;name);
<a name="l03743"></a>03743 
<a name="l03744"></a>03744    <span class="keywordflow">if</span> (l-&gt;dnd) {
<a name="l03745"></a>03745       <a class="code" href="channel_8h.html#a60f9d2b0ab8b7a839902313321163b28" title="Queue a control frame with payload.">ast_queue_control</a>(ast, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875">AST_CONTROL_BUSY</a>);
<a name="l03746"></a>03746       <span class="keywordflow">return</span> -1;
<a name="l03747"></a>03747    }
<a name="l03748"></a>03748 
<a name="l03749"></a>03749    <span class="keywordflow">if</span> (<a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(sub,list) &amp;&amp; !l-&gt;callwaiting) {
<a name="l03750"></a>03750       <a class="code" href="channel_8h.html#a60f9d2b0ab8b7a839902313321163b28" title="Queue a control frame with payload.">ast_queue_control</a>(ast, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875">AST_CONTROL_BUSY</a>);
<a name="l03751"></a>03751       <span class="keywordflow">return</span> -1;
<a name="l03752"></a>03752    }
<a name="l03753"></a>03753    
<a name="l03754"></a>03754    <span class="keywordflow">switch</span> (l-&gt;hookstate) {
<a name="l03755"></a>03755    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a2e10f13253ac5069f50f7f66b9511537">SKINNY_OFFHOOK</a>:
<a name="l03756"></a>03756       tone = <a class="code" href="chan__skinny_8c.html#ab0051964ea7b68461644ee964e3add4e">SKINNY_CALLWAITTONE</a>;
<a name="l03757"></a>03757       <span class="keywordflow">break</span>;
<a name="l03758"></a>03758    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#ad38b06a5edcc17eaa553739944e702e1">SKINNY_ONHOOK</a>:
<a name="l03759"></a>03759       tone = <a class="code" href="chan__skinny_8c.html#aa0c8daef788c72c3901d6d93bd873b1c">SKINNY_ALERT</a>;
<a name="l03760"></a>03760       l-&gt;<a class="code" href="structskinny__line.html#aedffa4337f76fdcdc808e16affbafd04">activesub</a> = sub;
<a name="l03761"></a>03761       <span class="keywordflow">break</span>;
<a name="l03762"></a>03762    <span class="keywordflow">default</span>:
<a name="l03763"></a>03763       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Don&apos;t know how to deal with hookstate %d\n&quot;</span>, l-&gt;hookstate);
<a name="l03764"></a>03764       <span class="keywordflow">break</span>;
<a name="l03765"></a>03765    }
<a name="l03766"></a>03766 
<a name="l03767"></a>03767    <a class="code" href="chan__skinny_8c.html#a891052a3d2334a56e4b5df01988ad8fb">transmit_callstateonly</a>(d, sub, <a class="code" href="chan__skinny_8c.html#a6bed741ef5e86581671d6c63ae9267c8">SKINNY_RINGIN</a>);
<a name="l03768"></a>03768    <a class="code" href="chan__skinny_8c.html#a5364d4b25cac8ec6f4572faf1434383d">transmit_selectsoftkeys</a>(d, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>, <a class="code" href="chan__skinny_8c.html#a529cdb7507128859a179f79e1966eb53">KEYDEF_RINGIN</a>);
<a name="l03769"></a>03769    <a class="code" href="chan__skinny_8c.html#a2c3127d93ed4f2dac8c6526a8b0ebd7d">transmit_displaypromptstatus</a>(d, <span class="stringliteral">&quot;Ring-In&quot;</span>, 0, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l03770"></a>03770    <a class="code" href="chan__skinny_8c.html#acb127c917ed7c5e9a7dd7e700f5b9cd9">transmit_callinfo</a>(d, ast-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a>, ast-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>, l-&gt;cid_name, l-&gt;cid_num, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>, 1);
<a name="l03771"></a>03771    <a class="code" href="chan__skinny_8c.html#aa16aabd900fdb4bd057303387115959f">transmit_lamp_indication</a>(d, <a class="code" href="chan__skinny_8c.html#af5c47ae0f0932f1d461f5b7b4cc0b095">STIMULUS_LINE</a>, l-&gt;instance, <a class="code" href="chan__skinny_8c.html#a92de27dd35149317b1c4cf78025b5b23">SKINNY_LAMP_BLINK</a>);
<a name="l03772"></a>03772    <a class="code" href="chan__skinny_8c.html#a4f65a9ef12827334502722b4cd8919c6">transmit_ringer_mode</a>(d, <a class="code" href="chan__skinny_8c.html#a4278efdb24cd17e04eff48e39475dd4e">SKINNY_RING_INSIDE</a>);
<a name="l03773"></a>03773 
<a name="l03774"></a>03774    <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(ast, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>);
<a name="l03775"></a>03775    <a class="code" href="channel_8h.html#a60f9d2b0ab8b7a839902313321163b28" title="Queue a control frame with payload.">ast_queue_control</a>(ast, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a>);
<a name="l03776"></a>03776    sub-&gt;<a class="code" href="structskinny__subchannel.html#a586fc7c710ade15aabab8f223e53fdd9">outgoing</a> = 1;
<a name="l03777"></a>03777    <span class="keywordflow">return</span> res;
<a name="l03778"></a>03778 }
<a name="l03779"></a>03779 
<a name="l03780"></a><a class="code" href="chan__skinny_8c.html#acbddfa3c6c07d0f530dce92d04c42c19">03780</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#acbddfa3c6c07d0f530dce92d04c42c19">skinny_hangup</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *ast)
<a name="l03781"></a>03781 {
<a name="l03782"></a>03782    <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l03783"></a>03783    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l;
<a name="l03784"></a>03784    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d;
<a name="l03785"></a>03785    <span class="keyword">struct </span><a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>;
<a name="l03786"></a>03786 
<a name="l03787"></a>03787    <span class="keywordflow">if</span> (!sub) {
<a name="l03788"></a>03788       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Asked to hangup channel not connected\n&quot;</span>);
<a name="l03789"></a>03789       <span class="keywordflow">return</span> 0;
<a name="l03790"></a>03790    }
<a name="l03791"></a>03791 
<a name="l03792"></a>03792    l = sub-&gt;parent;
<a name="l03793"></a>03793    d = l-&gt;device;
<a name="l03794"></a>03794    s = d-&gt;<a class="code" href="structskinny__device.html#a730a1864781691273d9f28b5ad1dadfd">session</a>;
<a name="l03795"></a>03795 
<a name="l03796"></a>03796    <span class="keywordflow">if</span> (skinnydebug)
<a name="l03797"></a>03797       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3,<span class="stringliteral">&quot;Hanging up %s/%d\n&quot;</span>,d-&gt;name,sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l03798"></a>03798 
<a name="l03799"></a>03799    <a class="code" href="linkedlists_8h.html#aa36e72b77f1b80881cd0a9fcca66ce19" title="Removes a specific entry from a list.">AST_LIST_REMOVE</a>(&amp;l-&gt;sub, sub, list);
<a name="l03800"></a>03800 
<a name="l03801"></a>03801    <span class="keywordflow">if</span> (d-&gt;registered) {
<a name="l03802"></a>03802       <span class="comment">/* Ignoring l-&gt;type, doesn&apos;t seem relevant and previous code </span>
<a name="l03803"></a>03803 <span class="comment">         assigned rather than tested, ie always true */</span>
<a name="l03804"></a>03804       <span class="keywordflow">if</span> (!<a class="code" href="linkedlists_8h.html#a4a1884cde93e53bef32ca85c194a1d05" title="Checks whether the specified list contains any entries.">AST_LIST_EMPTY</a>(&amp;l-&gt;sub)) {
<a name="l03805"></a>03805          <span class="keywordflow">if</span> (sub-&gt;related) {
<a name="l03806"></a>03806             sub-&gt;related-&gt;related = NULL;
<a name="l03807"></a>03807 
<a name="l03808"></a>03808          }
<a name="l03809"></a>03809          <span class="keywordflow">if</span> (sub == l-&gt;<a class="code" href="structskinny__line.html#aedffa4337f76fdcdc808e16affbafd04">activesub</a>) {      <span class="comment">/* we are killing the active sub, but there are other subs on the line*/</span>
<a name="l03810"></a>03810             <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(4,<span class="stringliteral">&quot;Killing active sub %d\n&quot;</span>, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l03811"></a>03811             <span class="keywordflow">if</span> (sub-&gt;related) {
<a name="l03812"></a>03812                l-&gt;<a class="code" href="structskinny__line.html#aedffa4337f76fdcdc808e16affbafd04">activesub</a> = sub-&gt;related;
<a name="l03813"></a>03813             } <span class="keywordflow">else</span> {
<a name="l03814"></a>03814                <span class="keywordflow">if</span> (<a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(sub, list)) {
<a name="l03815"></a>03815                   l-&gt;<a class="code" href="structskinny__line.html#aedffa4337f76fdcdc808e16affbafd04">activesub</a> = <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(sub, list);
<a name="l03816"></a>03816                } <span class="keywordflow">else</span> {
<a name="l03817"></a>03817                   l-&gt;<a class="code" href="structskinny__line.html#aedffa4337f76fdcdc808e16affbafd04">activesub</a> = <a class="code" href="linkedlists_8h.html#adf1959c5c03a3a706da97ad2f49617e5" title="Returns the first entry contained in a list.">AST_LIST_FIRST</a>(&amp;l-&gt;sub);
<a name="l03818"></a>03818                }
<a name="l03819"></a>03819             }
<a name="l03820"></a>03820             <span class="comment">//transmit_callstate(d, l-&gt;instance, SKINNY_ONHOOK, sub-&gt;callid);</span>
<a name="l03821"></a>03821             <a class="code" href="chan__skinny_8c.html#a6b694923ed4fb4da7b7e8fbcf650cbf1">transmit_activatecallplane</a>(d, l);
<a name="l03822"></a>03822             <a class="code" href="chan__skinny_8c.html#a875522082ab6d17f72cbf3ad88708a9b">transmit_closereceivechannel</a>(d, sub);
<a name="l03823"></a>03823             <a class="code" href="chan__skinny_8c.html#ae4983e199d8ab27568a4e09f740379d1">transmit_stopmediatransmission</a>(d, sub);
<a name="l03824"></a>03824             <a class="code" href="chan__skinny_8c.html#aa16aabd900fdb4bd057303387115959f">transmit_lamp_indication</a>(d, <a class="code" href="chan__skinny_8c.html#af5c47ae0f0932f1d461f5b7b4cc0b095">STIMULUS_LINE</a>, l-&gt;instance, <a class="code" href="chan__skinny_8c.html#a92de27dd35149317b1c4cf78025b5b23">SKINNY_LAMP_BLINK</a>);
<a name="l03825"></a>03825             <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, <a class="code" href="chan__skinny_8c.html#a2c63c304c5e6eff4a0b13617eb4a9bed">SKINNY_SILENCE</a>, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l03826"></a>03826          } <span class="keywordflow">else</span> {    <span class="comment">/* we are killing a background sub on the line with other subs*/</span>
<a name="l03827"></a>03827             <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(4,<span class="stringliteral">&quot;Killing inactive sub %d\n&quot;</span>, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l03828"></a>03828             <span class="keywordflow">if</span> (<a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(sub, list)) {
<a name="l03829"></a>03829                <a class="code" href="chan__skinny_8c.html#aa16aabd900fdb4bd057303387115959f">transmit_lamp_indication</a>(d, <a class="code" href="chan__skinny_8c.html#af5c47ae0f0932f1d461f5b7b4cc0b095">STIMULUS_LINE</a>, l-&gt;instance, <a class="code" href="chan__skinny_8c.html#a92de27dd35149317b1c4cf78025b5b23">SKINNY_LAMP_BLINK</a>);
<a name="l03830"></a>03830             } <span class="keywordflow">else</span> {
<a name="l03831"></a>03831                <a class="code" href="chan__skinny_8c.html#aa16aabd900fdb4bd057303387115959f">transmit_lamp_indication</a>(d, <a class="code" href="chan__skinny_8c.html#af5c47ae0f0932f1d461f5b7b4cc0b095">STIMULUS_LINE</a>, l-&gt;instance, <a class="code" href="chan__skinny_8c.html#a360e677a1a8e92ab455b8c354a15d969">SKINNY_LAMP_ON</a>);
<a name="l03832"></a>03832             }
<a name="l03833"></a>03833          }
<a name="l03834"></a>03834       } <span class="keywordflow">else</span> {                                                <span class="comment">/* no more subs on line so make idle */</span>
<a name="l03835"></a>03835          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(4,<span class="stringliteral">&quot;Killing only sub %d\n&quot;</span>, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l03836"></a>03836          l-&gt;hookstate = <a class="code" href="chan__skinny_8c.html#ad38b06a5edcc17eaa553739944e702e1">SKINNY_ONHOOK</a>;
<a name="l03837"></a>03837          <a class="code" href="chan__skinny_8c.html#a0cb936a217935cdbaa71cc6cb5171b44">transmit_callstate</a>(d, l-&gt;instance, <a class="code" href="chan__skinny_8c.html#ad38b06a5edcc17eaa553739944e702e1">SKINNY_ONHOOK</a>, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l03838"></a>03838          l-&gt;<a class="code" href="structskinny__line.html#aedffa4337f76fdcdc808e16affbafd04">activesub</a> = NULL;
<a name="l03839"></a>03839          <a class="code" href="chan__skinny_8c.html#aa16aabd900fdb4bd057303387115959f">transmit_lamp_indication</a>(d, <a class="code" href="chan__skinny_8c.html#af5c47ae0f0932f1d461f5b7b4cc0b095">STIMULUS_LINE</a>, l-&gt;instance, <a class="code" href="chan__skinny_8c.html#a87243536bbb96a314e88cfadd810f639">SKINNY_LAMP_OFF</a>);
<a name="l03840"></a>03840          <span class="keywordflow">if</span> (sub-&gt;parent == d-&gt;<a class="code" href="structskinny__device.html#a70da1427655ecdaa64e57324e51f440b">activeline</a>) {
<a name="l03841"></a>03841             <a class="code" href="chan__skinny_8c.html#a6b694923ed4fb4da7b7e8fbcf650cbf1">transmit_activatecallplane</a>(d, l);
<a name="l03842"></a>03842             <a class="code" href="chan__skinny_8c.html#a875522082ab6d17f72cbf3ad88708a9b">transmit_closereceivechannel</a>(d, sub);
<a name="l03843"></a>03843             <a class="code" href="chan__skinny_8c.html#ae4983e199d8ab27568a4e09f740379d1">transmit_stopmediatransmission</a>(d, sub);
<a name="l03844"></a>03844             <a class="code" href="chan__skinny_8c.html#a9d00b95f44b64f37d738f1ddc2ef972f">transmit_speaker_mode</a>(d, <a class="code" href="chan__skinny_8c.html#a0c90019de529b77fb06d587393ec42bf">SKINNY_SPEAKEROFF</a>);
<a name="l03845"></a>03845             <a class="code" href="chan__skinny_8c.html#a4f65a9ef12827334502722b4cd8919c6">transmit_ringer_mode</a>(d, <a class="code" href="chan__skinny_8c.html#aecd793ced0012f548eaf003e4609e994">SKINNY_RING_OFF</a>);
<a name="l03846"></a>03846             <a class="code" href="chan__skinny_8c.html#ad2e667cc9fa19462ea433bac21b74c7b">transmit_displaymessage</a>(d, NULL, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>); <span class="comment">/* clear display */</span>
<a name="l03847"></a>03847             <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, <a class="code" href="chan__skinny_8c.html#a2c63c304c5e6eff4a0b13617eb4a9bed">SKINNY_SILENCE</a>, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l03848"></a>03848             <span class="comment">/* we should check to see if we can start the ringer if another line is ringing */</span>
<a name="l03849"></a>03849          }
<a name="l03850"></a>03850       }
<a name="l03851"></a>03851    }
<a name="l03852"></a>03852    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;sub-&gt;<a class="code" href="structskinny__subchannel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03853"></a>03853    sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = NULL;
<a name="l03854"></a>03854    ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a> = NULL;
<a name="l03855"></a>03855    sub-&gt;<a class="code" href="structskinny__subchannel.html#ac43993a73742eff145b861107a1afa0d">alreadygone</a> = 0;
<a name="l03856"></a>03856    sub-&gt;<a class="code" href="structskinny__subchannel.html#a586fc7c710ade15aabab8f223e53fdd9">outgoing</a> = 0;
<a name="l03857"></a>03857    <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a>) {
<a name="l03858"></a>03858       <a class="code" href="rtp_8h.html#a6d2addabf879eb321a660932e3bd57eb">ast_rtp_destroy</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a>);
<a name="l03859"></a>03859       sub-&gt;<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a> = NULL;
<a name="l03860"></a>03860    }
<a name="l03861"></a>03861    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;sub-&gt;<a class="code" href="structskinny__subchannel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03862"></a>03862    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(sub);
<a name="l03863"></a>03863    <a class="code" href="module_8h.html#ac65fa15b16dbc563a2424af744ab003d">ast_module_unref</a>(<a class="code" href="structast__module__info.html">ast_module_info</a>-&gt;self);
<a name="l03864"></a>03864    <span class="keywordflow">return</span> 0;
<a name="l03865"></a>03865 }
<a name="l03866"></a>03866 
<a name="l03867"></a><a class="code" href="chan__skinny_8c.html#afac661ab214a4a68d115b3a1c70fdb32">03867</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#afac661ab214a4a68d115b3a1c70fdb32">skinny_answer</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *ast)
<a name="l03868"></a>03868 {
<a name="l03869"></a>03869    <span class="keywordtype">int</span> res = 0;
<a name="l03870"></a>03870    <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l03871"></a>03871    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l = sub-&gt;parent;
<a name="l03872"></a>03872    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d = l-&gt;device;
<a name="l03873"></a>03873 
<a name="l03874"></a>03874    <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#a9d49074e0655a086adb6bcc670b06f23">blindxfer</a>) {
<a name="l03875"></a>03875       <span class="keywordflow">if</span> (skinnydebug)
<a name="l03876"></a>03876          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;skinny_answer(%s) on %s@%s-%d with BlindXFER, transferring\n&quot;</span>,
<a name="l03877"></a>03877             ast-&gt;name, l-&gt;name, d-&gt;name, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l03878"></a>03878       <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(ast, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>);
<a name="l03879"></a>03879       <a class="code" href="chan__skinny_8c.html#aea5421cbe4655ae065e67067694eca68">skinny_transfer</a>(sub);
<a name="l03880"></a>03880       <span class="keywordflow">return</span> 0;
<a name="l03881"></a>03881    }
<a name="l03882"></a>03882 
<a name="l03883"></a>03883    sub-&gt;<a class="code" href="structskinny__subchannel.html#a4650e5e1429f8982af64b9c42c8c53d3">cxmode</a> = <a class="code" href="chan__skinny_8c.html#ac56d16f9c5cdbcc4b81eb63f9039e0e6">SKINNY_CX_SENDRECV</a>;
<a name="l03884"></a>03884    <span class="keywordflow">if</span> (!sub-&gt;<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a>) {
<a name="l03885"></a>03885       <a class="code" href="chan__skinny_8c.html#afdd465471ea50755ff86f47ead660ea0">start_rtp</a>(sub);
<a name="l03886"></a>03886    }
<a name="l03887"></a>03887    <span class="keywordflow">if</span> (skinnydebug)
<a name="l03888"></a>03888       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;skinny_answer(%s) on %s@%s-%d\n&quot;</span>, ast-&gt;name, l-&gt;name, d-&gt;name, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l03889"></a>03889    <span class="keywordflow">if</span> (ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) {
<a name="l03890"></a>03890       <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(ast, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>);
<a name="l03891"></a>03891    }
<a name="l03892"></a>03892 
<a name="l03893"></a>03893    <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, <a class="code" href="chan__skinny_8c.html#a2c63c304c5e6eff4a0b13617eb4a9bed">SKINNY_SILENCE</a>, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l03894"></a>03894    <span class="comment">/* order matters here...</span>
<a name="l03895"></a>03895 <span class="comment">      for some reason, transmit_callinfo must be before transmit_callstate,</span>
<a name="l03896"></a>03896 <span class="comment">      or you won&apos;t get keypad messages in some situations. */</span>
<a name="l03897"></a>03897    <a class="code" href="chan__skinny_8c.html#acb127c917ed7c5e9a7dd7e700f5b9cd9">transmit_callinfo</a>(d, ast-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a>, ast-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>, l-&gt;lastnumberdialed, l-&gt;lastnumberdialed, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>, 2);
<a name="l03898"></a>03898    <a class="code" href="chan__skinny_8c.html#a891052a3d2334a56e4b5df01988ad8fb">transmit_callstateonly</a>(d, sub, <a class="code" href="chan__skinny_8c.html#a1b0b13fd37b0eec0ebbc6031c91d4662">SKINNY_CONNECTED</a>);
<a name="l03899"></a>03899    <a class="code" href="chan__skinny_8c.html#a5364d4b25cac8ec6f4572faf1434383d">transmit_selectsoftkeys</a>(d, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>, <a class="code" href="chan__skinny_8c.html#aad5f46f88fa82da05103795046e110b7">KEYDEF_CONNECTED</a>);
<a name="l03900"></a>03900    <a class="code" href="chan__skinny_8c.html#a122fa20b73095a6195119dd979dfb6c1">transmit_dialednumber</a>(d, l-&gt;lastnumberdialed, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l03901"></a>03901    <a class="code" href="chan__skinny_8c.html#a2c3127d93ed4f2dac8c6526a8b0ebd7d">transmit_displaypromptstatus</a>(d, <span class="stringliteral">&quot;Connected&quot;</span>, 0, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l03902"></a>03902    l-&gt;<a class="code" href="structskinny__line.html#aedffa4337f76fdcdc808e16affbafd04">activesub</a> = sub;
<a name="l03903"></a>03903    <span class="keywordflow">return</span> res;
<a name="l03904"></a>03904 }
<a name="l03905"></a>03905 
<a name="l03906"></a>03906 <span class="comment">/* Retrieve audio/etc from channel.  Assumes sub-&gt;lock is already held. */</span>
<a name="l03907"></a><a class="code" href="chan__skinny_8c.html#abe9d19a5620cb9ddf6dc7d5b6310e0c2">03907</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="chan__skinny_8c.html#abe9d19a5620cb9ddf6dc7d5b6310e0c2">skinny_rtp_read</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub)
<a name="l03908"></a>03908 {
<a name="l03909"></a>03909    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *ast = sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l03910"></a>03910    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l03911"></a>03911 
<a name="l03912"></a>03912    <span class="keywordflow">if</span> (!sub-&gt;<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a>) {
<a name="l03913"></a>03913       <span class="comment">/* We have no RTP allocated for this channel */</span>
<a name="l03914"></a>03914       <span class="keywordflow">return</span> &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l03915"></a>03915    }
<a name="l03916"></a>03916 
<a name="l03917"></a>03917    <span class="keywordflow">switch</span>(ast-&gt;<a class="code" href="structast__channel.html#a3a804162c4be609a8def28f69b3e93b2">fdno</a>) {
<a name="l03918"></a>03918    <span class="keywordflow">case</span> 0:
<a name="l03919"></a>03919       f = <a class="code" href="rtp_8h.html#ac0a9d31f175e3de83fa1dda629c11674">ast_rtp_read</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a>); <span class="comment">/* RTP Audio */</span>
<a name="l03920"></a>03920       <span class="keywordflow">break</span>;
<a name="l03921"></a>03921    <span class="keywordflow">case</span> 1:
<a name="l03922"></a>03922       f = <a class="code" href="rtp_8h.html#ad2add11e197fbff70b7ff710f90e617f">ast_rtcp_read</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a>); <span class="comment">/* RTCP Control Channel */</span>
<a name="l03923"></a>03923       <span class="keywordflow">break</span>;
<a name="l03924"></a>03924    <span class="keywordflow">case</span> 2:
<a name="l03925"></a>03925       f = <a class="code" href="rtp_8h.html#ac0a9d31f175e3de83fa1dda629c11674">ast_rtp_read</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a65e8f978abd3f0206026969c627200a9">vrtp</a>); <span class="comment">/* RTP Video */</span>
<a name="l03926"></a>03926       <span class="keywordflow">break</span>;
<a name="l03927"></a>03927    <span class="keywordflow">case</span> 3:
<a name="l03928"></a>03928       f = <a class="code" href="rtp_8h.html#ad2add11e197fbff70b7ff710f90e617f">ast_rtcp_read</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a65e8f978abd3f0206026969c627200a9">vrtp</a>); <span class="comment">/* RTCP Control Channel for video */</span>
<a name="l03929"></a>03929       <span class="keywordflow">break</span>;
<a name="l03930"></a>03930 <span class="preprocessor">#if 0</span>
<a name="l03931"></a>03931 <span class="preprocessor"></span>   <span class="keywordflow">case</span> 5:
<a name="l03932"></a>03932       <span class="comment">/* Not yet supported */</span>
<a name="l03933"></a>03933       f = <a class="code" href="udptl_8h.html#ae0808bce80557e3107c9030bd8a832fe">ast_udptl_read</a>(sub-&gt;udptl); <span class="comment">/* UDPTL for T.38 */</span>
<a name="l03934"></a>03934       <span class="keywordflow">break</span>;
<a name="l03935"></a>03935 <span class="preprocessor">#endif</span>
<a name="l03936"></a>03936 <span class="preprocessor"></span>   <span class="keywordflow">default</span>:
<a name="l03937"></a>03937       f = &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l03938"></a>03938    }
<a name="l03939"></a>03939 
<a name="l03940"></a>03940    <span class="keywordflow">if</span> (ast) {
<a name="l03941"></a>03941       <span class="comment">/* We already hold the channel lock */</span>
<a name="l03942"></a>03942       <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>) {
<a name="l03943"></a>03943          <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> != ast-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>) {
<a name="l03944"></a>03944             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Oooh, format changed to %d\n&quot;</span>, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>);
<a name="l03945"></a>03945             ast-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a> = f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>;
<a name="l03946"></a>03946             <a class="code" href="channel_8h.html#a72d53065c6bc2b6092fa41eefa03f1ad" title="Sets read format on channel chan Set read format for channel to whichever component...">ast_set_read_format</a>(ast, ast-&gt;<a class="code" href="structast__channel.html#ab7786a0f5b9a9ebf83daed87be4f3868">readformat</a>);
<a name="l03947"></a>03947             <a class="code" href="channel_8h.html#a978161a52d98fdaee374d1f6e1359544" title="Sets write format on channel chan Set write format for channel to whichever component...">ast_set_write_format</a>(ast, ast-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a>);
<a name="l03948"></a>03948          }
<a name="l03949"></a>03949       }
<a name="l03950"></a>03950    }
<a name="l03951"></a>03951    <span class="keywordflow">return</span> f;
<a name="l03952"></a>03952 }
<a name="l03953"></a>03953 
<a name="l03954"></a><a class="code" href="chan__skinny_8c.html#ade22bc3bb339cf936adbcd5a32f07537">03954</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="chan__skinny_8c.html#ade22bc3bb339cf936adbcd5a32f07537">skinny_read</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *ast)
<a name="l03955"></a>03955 {
<a name="l03956"></a>03956    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *fr;
<a name="l03957"></a>03957    <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l03958"></a>03958    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;sub-&gt;<a class="code" href="structskinny__subchannel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03959"></a>03959    fr = <a class="code" href="chan__skinny_8c.html#abe9d19a5620cb9ddf6dc7d5b6310e0c2">skinny_rtp_read</a>(sub);
<a name="l03960"></a>03960    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;sub-&gt;<a class="code" href="structskinny__subchannel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03961"></a>03961    <span class="keywordflow">return</span> fr;
<a name="l03962"></a>03962 }
<a name="l03963"></a>03963 
<a name="l03964"></a><a class="code" href="chan__skinny_8c.html#a9e4a5b612101b227ea903b83bd9a863a">03964</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a9e4a5b612101b227ea903b83bd9a863a">skinny_write</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *ast, <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *frame)
<a name="l03965"></a>03965 {
<a name="l03966"></a>03966    <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l03967"></a>03967    <span class="keywordtype">int</span> res = 0;
<a name="l03968"></a>03968    <span class="keywordflow">if</span> (frame-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> != <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>) {
<a name="l03969"></a>03969       <span class="keywordflow">if</span> (frame-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a6c9398ee8989239124295d096a87bf32">AST_FRAME_IMAGE</a>) {
<a name="l03970"></a>03970          <span class="keywordflow">return</span> 0;
<a name="l03971"></a>03971       } <span class="keywordflow">else</span> {
<a name="l03972"></a>03972          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Can&apos;t send %d type frames with skinny_write\n&quot;</span>, frame-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a>);
<a name="l03973"></a>03973          <span class="keywordflow">return</span> 0;
<a name="l03974"></a>03974       }
<a name="l03975"></a>03975    } <span class="keywordflow">else</span> {
<a name="l03976"></a>03976       <span class="keywordflow">if</span> (!(frame-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> &amp; ast-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>)) {
<a name="l03977"></a>03977          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Asked to transmit frame type %d, while native formats is %d (read/write = %d/%d)\n&quot;</span>,
<a name="l03978"></a>03978             frame-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>, ast-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>, ast-&gt;<a class="code" href="structast__channel.html#ab7786a0f5b9a9ebf83daed87be4f3868">readformat</a>, ast-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a>);
<a name="l03979"></a>03979          <span class="keywordflow">return</span> -1;
<a name="l03980"></a>03980       }
<a name="l03981"></a>03981    }
<a name="l03982"></a>03982    <span class="keywordflow">if</span> (sub) {
<a name="l03983"></a>03983       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;sub-&gt;<a class="code" href="structskinny__subchannel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03984"></a>03984       <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a>) {
<a name="l03985"></a>03985          res = <a class="code" href="rtp_8h.html#a7a8ffdcbe10f04c3ca29e7cad359a68c">ast_rtp_write</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, frame);
<a name="l03986"></a>03986       }
<a name="l03987"></a>03987       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;sub-&gt;<a class="code" href="structskinny__subchannel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03988"></a>03988    }
<a name="l03989"></a>03989    <span class="keywordflow">return</span> res;
<a name="l03990"></a>03990 }
<a name="l03991"></a>03991 
<a name="l03992"></a><a class="code" href="chan__skinny_8c.html#aa67baa68e813caec6b66dac51d58f1f2">03992</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#aa67baa68e813caec6b66dac51d58f1f2">skinny_fixup</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *oldchan, <span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *newchan)
<a name="l03993"></a>03993 {
<a name="l03994"></a>03994    <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub = newchan-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l03995"></a>03995    <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;skinny_fixup(%s, %s)\n&quot;</span>, oldchan-&gt;name, newchan-&gt;name);
<a name="l03996"></a>03996    <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> != oldchan) {
<a name="l03997"></a>03997       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;old channel wasn&apos;t %p but was %p\n&quot;</span>, oldchan, sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l03998"></a>03998       <span class="keywordflow">return</span> -1;
<a name="l03999"></a>03999    }
<a name="l04000"></a>04000    sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = newchan;
<a name="l04001"></a>04001    <span class="keywordflow">return</span> 0;
<a name="l04002"></a>04002 }
<a name="l04003"></a>04003 
<a name="l04004"></a><a class="code" href="chan__skinny_8c.html#a60a505427fdd444c262281da8d1eb251">04004</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a60a505427fdd444c262281da8d1eb251">skinny_senddigit_begin</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *ast, <span class="keywordtype">char</span> digit)
<a name="l04005"></a>04005 {
<a name="l04006"></a>04006    <span class="keywordflow">return</span> -1; <span class="comment">/* Start inband indications */</span>
<a name="l04007"></a>04007 }
<a name="l04008"></a>04008 
<a name="l04009"></a><a class="code" href="chan__skinny_8c.html#a76035e956bb8c2cfc5e6412fd6c02c55">04009</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a76035e956bb8c2cfc5e6412fd6c02c55">skinny_senddigit_end</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *ast, <span class="keywordtype">char</span> digit, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> duration)
<a name="l04010"></a>04010 {
<a name="l04011"></a>04011 <span class="preprocessor">#if 0</span>
<a name="l04012"></a>04012 <span class="preprocessor"></span>   <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l04013"></a>04013    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l = sub-&gt;parent;
<a name="l04014"></a>04014    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d = l-&gt;device;
<a name="l04015"></a>04015    <span class="keywordtype">int</span> tmp;
<a name="l04016"></a>04016    <span class="comment">/* not right */</span>
<a name="l04017"></a>04017    sprintf(tmp, <span class="stringliteral">&quot;%d&quot;</span>, digit);
<a name="l04018"></a>04018    <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, digit, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l04019"></a>04019 <span class="preprocessor">#endif</span>
<a name="l04020"></a>04020 <span class="preprocessor"></span>   <span class="keywordflow">return</span> -1; <span class="comment">/* Stop inband indications */</span>
<a name="l04021"></a>04021 }
<a name="l04022"></a>04022 
<a name="l04023"></a><a class="code" href="chan__skinny_8c.html#a1ae95d3d12c225bb40b497687b3e9dc1">04023</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a1ae95d3d12c225bb40b497687b3e9dc1">get_devicestate</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__line.html">skinny_line</a> *l)
<a name="l04024"></a>04024 {
<a name="l04025"></a>04025    <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub;
<a name="l04026"></a>04026    <span class="keywordtype">int</span> res = <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a">AST_DEVICE_UNKNOWN</a>;
<a name="l04027"></a>04027 
<a name="l04028"></a>04028    <span class="keywordflow">if</span> (!l)
<a name="l04029"></a>04029       res = <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea9c008e1d20858cbc3275c157e02ebc94">AST_DEVICE_INVALID</a>;
<a name="l04030"></a>04030    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!l-&gt;device)
<a name="l04031"></a>04031       res = <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeafac147cbabf3ccb80e50e86027710549">AST_DEVICE_UNAVAILABLE</a>;
<a name="l04032"></a>04032    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (l-&gt;dnd)
<a name="l04033"></a>04033       res = <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeab43afabf5bcd4ad1f531ad78c48ccb6f">AST_DEVICE_BUSY</a>;
<a name="l04034"></a>04034    <span class="keywordflow">else</span> {
<a name="l04035"></a>04035       <span class="keywordflow">if</span> (l-&gt;hookstate == <a class="code" href="chan__skinny_8c.html#ad38b06a5edcc17eaa553739944e702e1">SKINNY_ONHOOK</a>) {
<a name="l04036"></a>04036          res = <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeadee91fc4886ffc7b4efb8459cef48fe2">AST_DEVICE_NOT_INUSE</a>;
<a name="l04037"></a>04037       } <span class="keywordflow">else</span> {
<a name="l04038"></a>04038          res = <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea23aa227468c09b5ebd0fb01b4c895190">AST_DEVICE_INUSE</a>;
<a name="l04039"></a>04039       }
<a name="l04040"></a>04040 
<a name="l04041"></a>04041       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;l-&gt;sub, sub, list) {
<a name="l04042"></a>04042          <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#a46585eaf56ac8588fa673c1c089f0238">onhold</a>) {
<a name="l04043"></a>04043             res = <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea6b7416bea92d3bc5ee8e36f0a484cdc1">AST_DEVICE_ONHOLD</a>;
<a name="l04044"></a>04044             <span class="keywordflow">break</span>;
<a name="l04045"></a>04045          }
<a name="l04046"></a>04046       }
<a name="l04047"></a>04047    }
<a name="l04048"></a>04048 
<a name="l04049"></a>04049    <span class="keywordflow">return</span> res;
<a name="l04050"></a>04050 }
<a name="l04051"></a>04051 
<a name="l04052"></a><a class="code" href="chan__skinny_8c.html#a240fa2ebaa98bd76495b1cefde05660a">04052</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="chan__skinny_8c.html#a240fa2ebaa98bd76495b1cefde05660a">control2str</a>(<span class="keywordtype">int</span> ind) {
<a name="l04053"></a>04053    <span class="keywordtype">char</span> *tmp;
<a name="l04054"></a>04054 
<a name="l04055"></a>04055    <span class="keywordflow">switch</span> (ind) {
<a name="l04056"></a>04056    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa7dac1c1896ab418c2ff351aae707fba">AST_CONTROL_HANGUP</a>:
<a name="l04057"></a>04057       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Other end has hungup&quot;</span>;
<a name="l04058"></a>04058    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a00675bfb8c64b2be86297fe4cba51fa2">AST_CONTROL_RING</a>:
<a name="l04059"></a>04059       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Local ring&quot;</span>;
<a name="l04060"></a>04060    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a>:
<a name="l04061"></a>04061       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Remote end is ringing&quot;</span>;
<a name="l04062"></a>04062    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>:
<a name="l04063"></a>04063       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Remote end has answered&quot;</span>;
<a name="l04064"></a>04064    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875">AST_CONTROL_BUSY</a>:
<a name="l04065"></a>04065       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Remote end is busy&quot;</span>;
<a name="l04066"></a>04066    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a5a24176e8066b727463907da4903bb8e">AST_CONTROL_TAKEOFFHOOK</a>:
<a name="l04067"></a>04067       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Make it go off hook&quot;</span>;
<a name="l04068"></a>04068    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a28cd8e9f9005e25624f993d6edd46755">AST_CONTROL_OFFHOOK</a>:
<a name="l04069"></a>04069       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Line is off hook&quot;</span>;
<a name="l04070"></a>04070    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a850bb06a1702741c93a3fd67cc9637ab">AST_CONTROL_CONGESTION</a>:
<a name="l04071"></a>04071       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Congestion (circuits busy)&quot;</span>;
<a name="l04072"></a>04072    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ae8f2cd460fdc81e0a774434fa002e4bf">AST_CONTROL_FLASH</a>:
<a name="l04073"></a>04073       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Flash hook&quot;</span>;
<a name="l04074"></a>04074    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a195b2c39c09113953814aa800dd06e7f">AST_CONTROL_WINK</a>:
<a name="l04075"></a>04075       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Wink&quot;</span>;
<a name="l04076"></a>04076    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ac4106406e269667ff84ee49e0a634f94">AST_CONTROL_OPTION</a>:
<a name="l04077"></a>04077       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Set a low-level option&quot;</span>;
<a name="l04078"></a>04078    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aacb7ddf1a95fa544fdecada68213f3c7">AST_CONTROL_RADIO_KEY</a>:
<a name="l04079"></a>04079       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Key Radio&quot;</span>;
<a name="l04080"></a>04080    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a34ac3ccebc219c59daa7eb0275fcd54d">AST_CONTROL_RADIO_UNKEY</a>:
<a name="l04081"></a>04081       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Un-Key Radio&quot;</span>;
<a name="l04082"></a>04082    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a1a461c5e737ed6ed7c8cb0f78557a6fd">AST_CONTROL_PROGRESS</a>:
<a name="l04083"></a>04083       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Remote end is making Progress&quot;</span>;
<a name="l04084"></a>04084    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a50b7fe33bba67b74dd7b746539e81000">AST_CONTROL_PROCEEDING</a>:
<a name="l04085"></a>04085       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Remote end is proceeding&quot;</span>;
<a name="l04086"></a>04086    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ab99a3d1c08c5ae8bca078c7cd1ec02f5">AST_CONTROL_HOLD</a>:
<a name="l04087"></a>04087       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Hold&quot;</span>;
<a name="l04088"></a>04088    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>:
<a name="l04089"></a>04089       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Unhold&quot;</span>;
<a name="l04090"></a>04090    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a009e81151b19671f42b5e84ab6a619f4">AST_CONTROL_SRCUPDATE</a>:
<a name="l04091"></a>04091       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Media Source Update&quot;</span>;
<a name="l04092"></a>04092    <span class="keywordflow">case</span> -1:
<a name="l04093"></a>04093       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Stop tone&quot;</span>;
<a name="l04094"></a>04094    <span class="keywordflow">default</span>:
<a name="l04095"></a>04095       <span class="keywordflow">if</span> (!(tmp = <a class="code" href="threadstorage_8h.html#a9153839e218c987b2ae47cbd39ac1ab5" title="Retrieve thread storage.">ast_threadstorage_get</a>(&amp;control2str_threadbuf, <a class="code" href="chan__skinny_8c.html#a2e749660fda8587e74d25b70e5b5504d">CONTROL2STR_BUFSIZE</a>)))
<a name="l04096"></a>04096                         <span class="keywordflow">return</span> <span class="stringliteral">&quot;Unknown&quot;</span>;
<a name="l04097"></a>04097       snprintf(tmp, <a class="code" href="chan__skinny_8c.html#a2e749660fda8587e74d25b70e5b5504d">CONTROL2STR_BUFSIZE</a>, <span class="stringliteral">&quot;UNKNOWN-%d&quot;</span>, ind);
<a name="l04098"></a>04098       <span class="keywordflow">return</span> tmp;
<a name="l04099"></a>04099    }
<a name="l04100"></a>04100 }
<a name="l04101"></a>04101 
<a name="l04102"></a><a class="code" href="chan__skinny_8c.html#aea5421cbe4655ae065e67067694eca68">04102</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#aea5421cbe4655ae065e67067694eca68">skinny_transfer</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub)
<a name="l04103"></a>04103 {
<a name="l04104"></a>04104    <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *<a class="code" href="structskinny__subchannel.html#a04f1e042676be8f4763d8d5a9000b1e5">xferor</a>; <span class="comment">/* the sub doing the transferring */</span>
<a name="l04105"></a>04105    <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *xferee; <span class="comment">/* the sub being transferred */</span>
<a name="l04106"></a>04106    <span class="keyword">struct </span><a class="code" href="structast__tone__zone__sound.html" title="Description of a tone.">ast_tone_zone_sound</a> *ts = NULL;
<a name="l04107"></a>04107       
<a name="l04108"></a>04108    <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) || <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(sub-&gt;related-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {
<a name="l04109"></a>04109       <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#a04f1e042676be8f4763d8d5a9000b1e5">xferor</a>) {
<a name="l04110"></a>04110          xferor = sub;
<a name="l04111"></a>04111          xferee = sub-&gt;related;
<a name="l04112"></a>04112       } <span class="keywordflow">else</span> {
<a name="l04113"></a>04113          xferor = sub;
<a name="l04114"></a>04114          xferee = sub-&gt;related;
<a name="l04115"></a>04115       }
<a name="l04116"></a>04116       
<a name="l04117"></a>04117       <span class="keywordflow">if</span> (skinnydebug) {
<a name="l04118"></a>04118          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Transferee channels (local/remote): %s and %s\n&quot;</span>,
<a name="l04119"></a>04119             xferee-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name, <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(xferee-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)?<a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(xferee-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)-&gt;name:<span class="stringliteral">&quot;&quot;</span>);
<a name="l04120"></a>04120          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Transferor channels (local/remote): %s and %s\n&quot;</span>,
<a name="l04121"></a>04121             xferor-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name, <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(xferor-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)?<a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(xferor-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)-&gt;name:<span class="stringliteral">&quot;&quot;</span>);
<a name="l04122"></a>04122       }
<a name="l04123"></a>04123       <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(xferor-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {
<a name="l04124"></a>04124          <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(xferee-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {
<a name="l04125"></a>04125             <a class="code" href="channel_8h.html#a60f9d2b0ab8b7a839902313321163b28" title="Queue a control frame with payload.">ast_queue_control</a>(xferee-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>);
<a name="l04126"></a>04126          }
<a name="l04127"></a>04127          <span class="keywordflow">if</span> (xferor-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>) {
<a name="l04128"></a>04128             <span class="comment">/* play ringing inband */</span>
<a name="l04129"></a>04129             <span class="keywordflow">if</span> ((ts = <a class="code" href="indications_8h.html#a516be2823557000dcd4be685a44d1d09" title="Locate a tone zone sound.">ast_get_indication_tone</a>(xferor-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a3b50931566324162ca5ebdd52fb5874c">zone</a>, <span class="stringliteral">&quot;ring&quot;</span>))) {
<a name="l04130"></a>04130                <a class="code" href="app__rpt_8c.html#a544e8a1dd4a986b00754103dda6a7d3b">ast_playtones_start</a>(xferor-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, 0, ts-&gt;<a class="code" href="structast__tone__zone__sound.html#a8f64897c7ccc5c13f276d1d07c4e7095" title="Description of a tone.">data</a>, 1);
<a name="l04131"></a>04131                ts = <a class="code" href="indications_8h.html#a8b52ace68f21c0ac24414f038471647d" title="Release a reference to an ast_tone_zone_sound.">ast_tone_zone_sound_unref</a>(ts);
<a name="l04132"></a>04132             }
<a name="l04133"></a>04133          }
<a name="l04134"></a>04134          <span class="keywordflow">if</span> (skinnydebug)
<a name="l04135"></a>04135             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Transfer Masquerading %s to %s\n&quot;</span>,
<a name="l04136"></a>04136                xferee-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name, <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(xferor-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)?<a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(xferor-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)-&gt;name:<span class="stringliteral">&quot;&quot;</span>);
<a name="l04137"></a>04137          <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a84fa04f019436467dc17f9bdd5341dce" title="Weird function made for call transfers.">ast_channel_masquerade</a>(xferee-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(xferor-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>))) {
<a name="l04138"></a>04138             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to masquerade %s as %s\n&quot;</span>,
<a name="l04139"></a>04139                <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(xferor-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)-&gt;name, xferee-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name);
<a name="l04140"></a>04140             <span class="keywordflow">return</span> -1;
<a name="l04141"></a>04141          }
<a name="l04142"></a>04142       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(xferee-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {
<a name="l04143"></a>04143          <a class="code" href="channel_8h.html#a60f9d2b0ab8b7a839902313321163b28" title="Queue a control frame with payload.">ast_queue_control</a>(xferee-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>);
<a name="l04144"></a>04144          <span class="keywordflow">if</span> (xferor-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>) {
<a name="l04145"></a>04145             <span class="comment">/* play ringing inband */</span>
<a name="l04146"></a>04146             <span class="keywordflow">if</span> ((ts = <a class="code" href="indications_8h.html#a516be2823557000dcd4be685a44d1d09" title="Locate a tone zone sound.">ast_get_indication_tone</a>(xferor-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a3b50931566324162ca5ebdd52fb5874c">zone</a>, <span class="stringliteral">&quot;ring&quot;</span>))) {
<a name="l04147"></a>04147                <a class="code" href="app__rpt_8c.html#a544e8a1dd4a986b00754103dda6a7d3b">ast_playtones_start</a>(xferor-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, 0, ts-&gt;<a class="code" href="structast__tone__zone__sound.html#a8f64897c7ccc5c13f276d1d07c4e7095" title="Description of a tone.">data</a>, 1);
<a name="l04148"></a>04148                ts = <a class="code" href="indications_8h.html#a8b52ace68f21c0ac24414f038471647d" title="Release a reference to an ast_tone_zone_sound.">ast_tone_zone_sound_unref</a>(ts);
<a name="l04149"></a>04149             }
<a name="l04150"></a>04150          }
<a name="l04151"></a>04151          <span class="keywordflow">if</span> (skinnydebug)
<a name="l04152"></a>04152             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Transfer Masquerading %s to %s\n&quot;</span>,
<a name="l04153"></a>04153                xferor-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name, <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(xferee-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)?<a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(xferee-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)-&gt;name:<span class="stringliteral">&quot;&quot;</span>);
<a name="l04154"></a>04154          <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a84fa04f019436467dc17f9bdd5341dce" title="Weird function made for call transfers.">ast_channel_masquerade</a>(xferor-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(xferee-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>))) {
<a name="l04155"></a>04155             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to masquerade %s as %s\n&quot;</span>,
<a name="l04156"></a>04156                <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(xferee-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)-&gt;name, xferor-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name);
<a name="l04157"></a>04157             <span class="keywordflow">return</span> -1;
<a name="l04158"></a>04158          }
<a name="l04159"></a>04159          <span class="keywordflow">return</span> 0;
<a name="l04160"></a>04160       } <span class="keywordflow">else</span> {
<a name="l04161"></a>04161          <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ga40f8fb2e731031d99f732f515cec680f">option_debug</a>)
<a name="l04162"></a>04162             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Neither %s nor %s are in a bridge, nothing to transfer\n&quot;</span>,
<a name="l04163"></a>04163                xferor-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name, xferee-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name);
<a name="l04164"></a>04164       }
<a name="l04165"></a>04165    }
<a name="l04166"></a>04166    <span class="keywordflow">return</span> 0;
<a name="l04167"></a>04167 }
<a name="l04168"></a>04168 
<a name="l04169"></a><a class="code" href="chan__skinny_8c.html#aa6752ab977ca12d5f27c6c6970dae085">04169</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#aa6752ab977ca12d5f27c6c6970dae085">skinny_indicate</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *ast, <span class="keywordtype">int</span> ind, <span class="keyword">const</span> <span class="keywordtype">void</span> *<a class="code" href="structast__tone__zone__sound.html#a8f64897c7ccc5c13f276d1d07c4e7095" title="Description of a tone.">data</a>, <span class="keywordtype">size_t</span> datalen)
<a name="l04170"></a>04170 {
<a name="l04171"></a>04171    <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l04172"></a>04172    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l = sub-&gt;parent;
<a name="l04173"></a>04173    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d = l-&gt;device;
<a name="l04174"></a>04174    <span class="keyword">struct </span><a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a> = d-&gt;<a class="code" href="structskinny__device.html#a730a1864781691273d9f28b5ad1dadfd">session</a>;
<a name="l04175"></a>04175 
<a name="l04176"></a>04176    <span class="keywordflow">if</span> (!s) {
<a name="l04177"></a>04177       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Asked to indicate &apos;%s&apos; condition on channel %s, but session does not exist.\n&quot;</span>, <a class="code" href="chan__skinny_8c.html#a240fa2ebaa98bd76495b1cefde05660a">control2str</a>(ind), ast-&gt;name);
<a name="l04178"></a>04178       <span class="keywordflow">return</span> -1;
<a name="l04179"></a>04179    }
<a name="l04180"></a>04180 
<a name="l04181"></a>04181    <span class="keywordflow">if</span> (skinnydebug)
<a name="l04182"></a>04182       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Asked to indicate &apos;%s&apos; condition on channel %s\n&quot;</span>, <a class="code" href="chan__skinny_8c.html#a240fa2ebaa98bd76495b1cefde05660a">control2str</a>(ind), ast-&gt;name);
<a name="l04183"></a>04183    <span class="keywordflow">switch</span>(ind) {
<a name="l04184"></a>04184    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a>:
<a name="l04185"></a>04185       <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#a9d49074e0655a086adb6bcc670b06f23">blindxfer</a>) {
<a name="l04186"></a>04186          <span class="keywordflow">if</span> (skinnydebug)
<a name="l04187"></a>04187             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Channel %s set up for Blind Xfer, so Xfer rather than ring device\n&quot;</span>, ast-&gt;name);
<a name="l04188"></a>04188          <a class="code" href="chan__skinny_8c.html#aea5421cbe4655ae065e67067694eca68">skinny_transfer</a>(sub);
<a name="l04189"></a>04189          <span class="keywordflow">break</span>;
<a name="l04190"></a>04190       }
<a name="l04191"></a>04191       <span class="keywordflow">if</span> (ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) {
<a name="l04192"></a>04192          <span class="keywordflow">if</span> (!sub-&gt;<a class="code" href="structskinny__subchannel.html#a4fb4072ccd44ea481eecfa5e74818db4">progress</a>) {
<a name="l04193"></a>04193             <span class="keywordflow">if</span> (!d-&gt;earlyrtp) {
<a name="l04194"></a>04194                <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, <a class="code" href="chan__skinny_8c.html#aa0c8daef788c72c3901d6d93bd873b1c">SKINNY_ALERT</a>, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l04195"></a>04195             }
<a name="l04196"></a>04196             <a class="code" href="chan__skinny_8c.html#a891052a3d2334a56e4b5df01988ad8fb">transmit_callstateonly</a>(d, sub, <a class="code" href="chan__skinny_8c.html#ae470ea8c2ed3420d624ea6f61b640a8a">SKINNY_RINGOUT</a>);
<a name="l04197"></a>04197             <a class="code" href="chan__skinny_8c.html#a122fa20b73095a6195119dd979dfb6c1">transmit_dialednumber</a>(d, l-&gt;lastnumberdialed, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l04198"></a>04198             <a class="code" href="chan__skinny_8c.html#a2c3127d93ed4f2dac8c6526a8b0ebd7d">transmit_displaypromptstatus</a>(d, <span class="stringliteral">&quot;Ring Out&quot;</span>, 0, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l04199"></a>04199             <a class="code" href="chan__skinny_8c.html#acb127c917ed7c5e9a7dd7e700f5b9cd9">transmit_callinfo</a>(d, ast-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a>, ast-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>, l-&gt;lastnumberdialed, l-&gt;lastnumberdialed, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>, 2); <span class="comment">/* 2 = outgoing from phone */</span>
<a name="l04200"></a>04200             sub-&gt;<a class="code" href="structskinny__subchannel.html#a44a0c9c7696fa5078c94c60140e83f5f">ringing</a> = 1;
<a name="l04201"></a>04201             <span class="keywordflow">if</span> (!d-&gt;earlyrtp) {
<a name="l04202"></a>04202                <span class="keywordflow">break</span>;
<a name="l04203"></a>04203             }
<a name="l04204"></a>04204          }
<a name="l04205"></a>04205       }
<a name="l04206"></a>04206       <span class="keywordflow">return</span> -1; <span class="comment">/* Tell asterisk to provide inband signalling */</span>
<a name="l04207"></a>04207    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875">AST_CONTROL_BUSY</a>:
<a name="l04208"></a>04208       <span class="keywordflow">if</span> (ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) {
<a name="l04209"></a>04209          <span class="keywordflow">if</span> (!d-&gt;earlyrtp) {
<a name="l04210"></a>04210             <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, <a class="code" href="chan__skinny_8c.html#afe81f121e37b9b5a707f27f80e7f20f5">SKINNY_BUSYTONE</a>, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l04211"></a>04211          }
<a name="l04212"></a>04212          <a class="code" href="chan__skinny_8c.html#a891052a3d2334a56e4b5df01988ad8fb">transmit_callstateonly</a>(d, sub, <a class="code" href="chan__skinny_8c.html#a068d6f987aefda74cc4eccf378f0e26f">SKINNY_BUSY</a>);
<a name="l04213"></a>04213          sub-&gt;<a class="code" href="structskinny__subchannel.html#ac43993a73742eff145b861107a1afa0d">alreadygone</a> = 1;
<a name="l04214"></a>04214          <a class="code" href="channel_8h.html#ae90da1877e143b996d202d4c88a9c862" title="Softly hangup up a channel (no channel lock).">ast_softhangup_nolock</a>(ast, <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709a2e185ce313026e13ed90ae3a319c9cb7">AST_SOFTHANGUP_DEV</a>);
<a name="l04215"></a>04215          <span class="keywordflow">if</span> (!d-&gt;earlyrtp) {
<a name="l04216"></a>04216             <span class="keywordflow">break</span>;
<a name="l04217"></a>04217          }
<a name="l04218"></a>04218       }
<a name="l04219"></a>04219       <span class="keywordflow">return</span> -1; <span class="comment">/* Tell asterisk to provide inband signalling */</span>
<a name="l04220"></a>04220    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a850bb06a1702741c93a3fd67cc9637ab">AST_CONTROL_CONGESTION</a>:
<a name="l04221"></a>04221       <span class="keywordflow">if</span> (ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) {
<a name="l04222"></a>04222          <span class="keywordflow">if</span> (!d-&gt;earlyrtp) {
<a name="l04223"></a>04223             <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, <a class="code" href="chan__skinny_8c.html#aceb6a87185d21366d7f3f21fd69cee90">SKINNY_REORDER</a>, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l04224"></a>04224          }
<a name="l04225"></a>04225          <a class="code" href="chan__skinny_8c.html#a891052a3d2334a56e4b5df01988ad8fb">transmit_callstateonly</a>(d, sub, <a class="code" href="chan__skinny_8c.html#a0d089cd7065341d1b915456ace035ac2">SKINNY_CONGESTION</a>);
<a name="l04226"></a>04226          sub-&gt;<a class="code" href="structskinny__subchannel.html#ac43993a73742eff145b861107a1afa0d">alreadygone</a> = 1;
<a name="l04227"></a>04227          <a class="code" href="channel_8h.html#ae90da1877e143b996d202d4c88a9c862" title="Softly hangup up a channel (no channel lock).">ast_softhangup_nolock</a>(ast, <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709a2e185ce313026e13ed90ae3a319c9cb7">AST_SOFTHANGUP_DEV</a>);
<a name="l04228"></a>04228          <span class="keywordflow">if</span> (!d-&gt;earlyrtp) {
<a name="l04229"></a>04229             <span class="keywordflow">break</span>;
<a name="l04230"></a>04230          }
<a name="l04231"></a>04231       }
<a name="l04232"></a>04232       <span class="keywordflow">return</span> -1; <span class="comment">/* Tell asterisk to provide inband signalling */</span>
<a name="l04233"></a>04233    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a1a461c5e737ed6ed7c8cb0f78557a6fd">AST_CONTROL_PROGRESS</a>:
<a name="l04234"></a>04234       <span class="keywordflow">if</span> ((ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) &amp;&amp; !sub-&gt;<a class="code" href="structskinny__subchannel.html#a4fb4072ccd44ea481eecfa5e74818db4">progress</a> &amp;&amp; !sub-&gt;<a class="code" href="structskinny__subchannel.html#a586fc7c710ade15aabab8f223e53fdd9">outgoing</a>) {
<a name="l04235"></a>04235          <span class="keywordflow">if</span> (!d-&gt;earlyrtp) {
<a name="l04236"></a>04236             <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, <a class="code" href="chan__skinny_8c.html#aa0c8daef788c72c3901d6d93bd873b1c">SKINNY_ALERT</a>, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l04237"></a>04237          }
<a name="l04238"></a>04238          <a class="code" href="chan__skinny_8c.html#a891052a3d2334a56e4b5df01988ad8fb">transmit_callstateonly</a>(d, sub, <a class="code" href="chan__skinny_8c.html#a2d1224352bf30cb08f222355450e4930">SKINNY_PROGRESS</a>);
<a name="l04239"></a>04239          <a class="code" href="chan__skinny_8c.html#a2c3127d93ed4f2dac8c6526a8b0ebd7d">transmit_displaypromptstatus</a>(d, <span class="stringliteral">&quot;Call Progress&quot;</span>, 0, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l04240"></a>04240          <a class="code" href="chan__skinny_8c.html#acb127c917ed7c5e9a7dd7e700f5b9cd9">transmit_callinfo</a>(d, ast-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a>, ast-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>, l-&gt;lastnumberdialed, l-&gt;lastnumberdialed, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>, 2); <span class="comment">/* 2 = outgoing from phone */</span>
<a name="l04241"></a>04241          sub-&gt;<a class="code" href="structskinny__subchannel.html#a4fb4072ccd44ea481eecfa5e74818db4">progress</a> = 1;
<a name="l04242"></a>04242          <span class="keywordflow">if</span> (!d-&gt;earlyrtp) {
<a name="l04243"></a>04243             <span class="keywordflow">break</span>;
<a name="l04244"></a>04244          }
<a name="l04245"></a>04245       }
<a name="l04246"></a>04246       <span class="keywordflow">return</span> -1; <span class="comment">/* Tell asterisk to provide inband signalling */</span>
<a name="l04247"></a>04247    <span class="keywordflow">case</span> -1:  <span class="comment">/* STOP_TONE */</span>
<a name="l04248"></a>04248       <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, <a class="code" href="chan__skinny_8c.html#a2c63c304c5e6eff4a0b13617eb4a9bed">SKINNY_SILENCE</a>, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l04249"></a>04249       <span class="keywordflow">break</span>;
<a name="l04250"></a>04250    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ab99a3d1c08c5ae8bca078c7cd1ec02f5">AST_CONTROL_HOLD</a>:
<a name="l04251"></a>04251       <a class="code" href="musiconhold_8h.html#a2acec01f2fddd8ca494d874003815cf7" title="Turn on music on hold on a given channel.">ast_moh_start</a>(ast, data, l-&gt;mohinterpret);
<a name="l04252"></a>04252       <span class="keywordflow">break</span>;
<a name="l04253"></a>04253    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>:
<a name="l04254"></a>04254       <a class="code" href="musiconhold_8h.html#a52fead32f69533450f3c05b2e6960149" title="Turn off music on hold on a given channel.">ast_moh_stop</a>(ast);
<a name="l04255"></a>04255       <span class="keywordflow">break</span>;
<a name="l04256"></a>04256    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a50b7fe33bba67b74dd7b746539e81000">AST_CONTROL_PROCEEDING</a>:
<a name="l04257"></a>04257       <span class="keywordflow">break</span>;
<a name="l04258"></a>04258    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a009e81151b19671f42b5e84ab6a619f4">AST_CONTROL_SRCUPDATE</a>:
<a name="l04259"></a>04259       <a class="code" href="rtp_8h.html#a858a9803ad1b78fc1b9602bb9cad1411">ast_rtp_new_source</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a>);
<a name="l04260"></a>04260       <span class="keywordflow">break</span>;
<a name="l04261"></a>04261    <span class="keywordflow">default</span>:
<a name="l04262"></a>04262       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Don&apos;t know how to indicate condition %d\n&quot;</span>, ind);
<a name="l04263"></a>04263       <span class="keywordflow">return</span> -1; <span class="comment">/* Tell asterisk to provide inband signalling */</span>
<a name="l04264"></a>04264    }
<a name="l04265"></a>04265    <span class="keywordflow">return</span> 0;
<a name="l04266"></a>04266 }
<a name="l04267"></a>04267 
<a name="l04268"></a><a class="code" href="chan__skinny_8c.html#a7d4cb293426c31e532f15f52fd8183fd">04268</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="chan__skinny_8c.html#a7d4cb293426c31e532f15f52fd8183fd">skinny_new</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__line.html">skinny_line</a> *l, <span class="keywordtype">int</span> <a class="code" href="structstate.html">state</a>)
<a name="l04269"></a>04269 {
<a name="l04270"></a>04270    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *tmp;
<a name="l04271"></a>04271    <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub;
<a name="l04272"></a>04272    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d = l-&gt;device;
<a name="l04273"></a>04273    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *v = NULL;
<a name="l04274"></a>04274    <span class="keywordtype">int</span> fmt;
<a name="l04275"></a>04275 
<a name="l04276"></a>04276    <span class="keywordflow">if</span> (!l-&gt;device) {
<a name="l04277"></a>04277       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Device for line %s is not registered.\n&quot;</span>, l-&gt;name);
<a name="l04278"></a>04278       <span class="keywordflow">return</span> NULL;
<a name="l04279"></a>04279    }
<a name="l04280"></a>04280 
<a name="l04281"></a>04281    tmp = <a class="code" href="channel_8h.html#adfbceb39821586c0f9be0c47496a4e18">ast_channel_alloc</a>(1, state, l-&gt;cid_num, l-&gt;cid_name, l-&gt;accountcode, l-&gt;exten, l-&gt;context, l-&gt;amaflags, <span class="stringliteral">&quot;Skinny/%s@%s-%d&quot;</span>, l-&gt;name, d-&gt;name, callnums);
<a name="l04282"></a>04282    <span class="keywordflow">if</span> (!tmp) {
<a name="l04283"></a>04283       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to allocate channel structure\n&quot;</span>);
<a name="l04284"></a>04284       <span class="keywordflow">return</span> NULL;
<a name="l04285"></a>04285    } <span class="keywordflow">else</span> {
<a name="l04286"></a>04286       sub = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*sub));
<a name="l04287"></a>04287       <span class="keywordflow">if</span> (!sub) {
<a name="l04288"></a>04288          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to allocate Skinny subchannel\n&quot;</span>);
<a name="l04289"></a>04289          <span class="keywordflow">return</span> NULL;
<a name="l04290"></a>04290       } <span class="keywordflow">else</span> {
<a name="l04291"></a>04291          <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;sub-&gt;<a class="code" href="structskinny__subchannel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l04292"></a>04292 
<a name="l04293"></a>04293          sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = tmp;
<a name="l04294"></a>04294          sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a> = callnums++;
<a name="l04295"></a>04295          d-&gt;lastlineinstance = l-&gt;instance;
<a name="l04296"></a>04296          d-&gt;lastcallreference = sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>;
<a name="l04297"></a>04297          sub-&gt;<a class="code" href="structskinny__subchannel.html#a4650e5e1429f8982af64b9c42c8c53d3">cxmode</a> = <a class="code" href="chan__skinny_8c.html#a2aefadaebf9f3da51e9fbd92c998dc6b">SKINNY_CX_INACTIVE</a>;
<a name="l04298"></a>04298          sub-&gt;<a class="code" href="structskinny__subchannel.html#ada540a5f25f7302dc1a3d17ccfa59b10">nat</a> = l-&gt;nat;
<a name="l04299"></a>04299          sub-&gt;parent = l;
<a name="l04300"></a>04300          sub-&gt;<a class="code" href="structskinny__subchannel.html#a46585eaf56ac8588fa673c1c089f0238">onhold</a> = 0;
<a name="l04301"></a>04301          sub-&gt;<a class="code" href="structskinny__subchannel.html#a9d49074e0655a086adb6bcc670b06f23">blindxfer</a> = 0;
<a name="l04302"></a>04302          sub-&gt;<a class="code" href="structskinny__subchannel.html#a04f1e042676be8f4763d8d5a9000b1e5">xferor</a> = 0;
<a name="l04303"></a>04303          sub-&gt;related = NULL;
<a name="l04304"></a>04304 
<a name="l04305"></a>04305          <a class="code" href="linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307" title="Inserts a list entry at the head of a list.">AST_LIST_INSERT_HEAD</a>(&amp;l-&gt;sub, sub, list);
<a name="l04306"></a>04306          <span class="comment">//l-&gt;activesub = sub;</span>
<a name="l04307"></a>04307       }
<a name="l04308"></a>04308       tmp-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a> = &amp;<a class="code" href="chan__skinny_8c.html#af6c38f501b802babce30ed7dd08fc686">skinny_tech</a>;
<a name="l04309"></a>04309       tmp-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a> = sub;
<a name="l04310"></a>04310       tmp-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a> = l-&gt;capability;
<a name="l04311"></a>04311       <span class="keywordflow">if</span> (!tmp-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>)
<a name="l04312"></a>04312          <span class="comment">// Should throw an error</span>
<a name="l04313"></a>04313          tmp-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a> = default_capability;
<a name="l04314"></a>04314       fmt = <a class="code" href="channel_8h.html#a4d78194779a26341c3ec7298b450b9ed" title="Pick the best audio codec.">ast_best_codec</a>(tmp-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>);
<a name="l04315"></a>04315       <span class="keywordflow">if</span> (skinnydebug)
<a name="l04316"></a>04316          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;skinny_new: tmp-&gt;nativeformats=%d fmt=%d\n&quot;</span>, tmp-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>, fmt);
<a name="l04317"></a>04317       <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a>) {
<a name="l04318"></a>04318          <a class="code" href="channel_8h.html#aca37ca2f3d55a223d26617329ed48a3e">ast_channel_set_fd</a>(tmp, 0, <a class="code" href="rtp_8h.html#a9a990d85fb0aac29bda48777f0f86108">ast_rtp_fd</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a>));
<a name="l04319"></a>04319       }
<a name="l04320"></a>04320       <span class="keywordflow">if</span> (state == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>) {
<a name="l04321"></a>04321          tmp-&gt;<a class="code" href="structast__channel.html#a358fd14658a0c5276190e48f1b1f251a">rings</a> = 1;
<a name="l04322"></a>04322       }
<a name="l04323"></a>04323       tmp-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a> = fmt;
<a name="l04324"></a>04324       tmp-&gt;<a class="code" href="structast__channel.html#a045b6dfdee84adceb7e86b6c5c4f9a86">rawwriteformat</a> = fmt;
<a name="l04325"></a>04325       tmp-&gt;<a class="code" href="structast__channel.html#ab7786a0f5b9a9ebf83daed87be4f3868">readformat</a> = fmt;
<a name="l04326"></a>04326       tmp-&gt;<a class="code" href="structast__channel.html#a6fcf944239e3718e282e0ba7512e66c6">rawreadformat</a> = fmt;
<a name="l04327"></a>04327       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(l-&gt;language))
<a name="l04328"></a>04328          <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(tmp, <a class="code" href="chan__alsa_8c.html#adf416dc058363e2fd5750c77e2d78bee">language</a>, l-&gt;language);
<a name="l04329"></a>04329       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(l-&gt;accountcode))
<a name="l04330"></a>04330          <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(tmp, <a class="code" href="chan__iax2_8c.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>, l-&gt;accountcode);
<a name="l04331"></a>04331       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(l-&gt;parkinglot))
<a name="l04332"></a>04332          <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(tmp, <a class="code" href="chan__dahdi_8c.html#ac59e01fcfbc9801f87f28f6b60957a24">parkinglot</a>, l-&gt;parkinglot);
<a name="l04333"></a>04333       <span class="keywordflow">if</span> (l-&gt;amaflags)
<a name="l04334"></a>04334          tmp-&gt;<a class="code" href="structast__channel.html#ad2cfb0f821c065261382a9298bb5a16b">amaflags</a> = l-&gt;amaflags;
<a name="l04335"></a>04335 
<a name="l04336"></a>04336       <a class="code" href="module_8h.html#aa08fcee0b390e15532dd03803c8728c4">ast_module_ref</a>(<a class="code" href="structast__module__info.html">ast_module_info</a>-&gt;self);
<a name="l04337"></a>04337       tmp-&gt;<a class="code" href="structast__channel.html#af0f007b48a9c8cf0629428bd0483e0d1">callgroup</a> = l-&gt;callgroup;
<a name="l04338"></a>04338       tmp-&gt;<a class="code" href="structast__channel.html#abc0651bcec68410023c036b7d8ec4d11">pickupgroup</a> = l-&gt;pickupgroup;
<a name="l04339"></a>04339 
<a name="l04340"></a>04340       <span class="comment">/* XXX Need to figure out how to handle CFwdNoAnswer */</span>
<a name="l04341"></a>04341       <span class="keywordflow">if</span> (l-&gt;cfwdtype &amp; <a class="code" href="chan__skinny_8c.html#a1a77767cd4cfc70d096da50a2fefecd7">SKINNY_CFWD_ALL</a>) {
<a name="l04342"></a>04342          <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(tmp, call_forward, l-&gt;call_forward_all);
<a name="l04343"></a>04343       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (l-&gt;cfwdtype &amp; <a class="code" href="chan__skinny_8c.html#a6cd59fd0c6c79219d38f437a485ce844">SKINNY_CFWD_BUSY</a>) {
<a name="l04344"></a>04344          <span class="keywordflow">if</span> (<a class="code" href="chan__skinny_8c.html#a1ae95d3d12c225bb40b497687b3e9dc1">get_devicestate</a>(l) != <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeadee91fc4886ffc7b4efb8459cef48fe2">AST_DEVICE_NOT_INUSE</a>) {
<a name="l04345"></a>04345             <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(tmp, call_forward, l-&gt;call_forward_busy);
<a name="l04346"></a>04346          }
<a name="l04347"></a>04347       }
<a name="l04348"></a>04348 
<a name="l04349"></a>04349       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, l-&gt;context, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>));
<a name="l04350"></a>04350       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, l-&gt;exten, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>));
<a name="l04351"></a>04351 
<a name="l04352"></a>04352       <span class="comment">/* Don&apos;t use ast_set_callerid() here because it will</span>
<a name="l04353"></a>04353 <span class="comment">       * generate a needless NewCallerID event */</span>
<a name="l04354"></a>04354       tmp-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a7bb8ad258e687da69d6933ab48320df7">cid_ani</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(l-&gt;cid_num);
<a name="l04355"></a>04355 
<a name="l04356"></a>04356       tmp-&gt;<a class="code" href="structast__channel.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> = 1;
<a name="l04357"></a>04357       tmp-&gt;<a class="code" href="structast__channel.html#a4507948aab513e976b52d2253376ee7f">adsicpe</a> = <a class="code" href="channel_8h.html#a828f537544a2ad2352c56c078390a0bda5f0673b46cfdba3094393b3fbce084ff">AST_ADSI_UNAVAILABLE</a>;
<a name="l04358"></a>04358 
<a name="l04359"></a>04359       <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a>)
<a name="l04360"></a>04360          <a class="code" href="abstract__jb_8h.html#a0981c84ac90dd79bc2a0fdd90aa6efba" title="Configures a jitterbuffer on a channel.">ast_jb_configure</a>(tmp, &amp;<a class="code" href="chan__skinny_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">global_jbconf</a>);
<a name="l04361"></a>04361 
<a name="l04362"></a>04362       <span class="comment">/* Set channel variables for this call from configuration */</span>
<a name="l04363"></a>04363       <span class="keywordflow">for</span> (v = l-&gt;chanvars ; v ; v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>)
<a name="l04364"></a>04364          <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(tmp, v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l04365"></a>04365 
<a name="l04366"></a>04366       <span class="keywordflow">if</span> (state != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>) {
<a name="l04367"></a>04367          <span class="keywordflow">if</span> (<a class="code" href="pbx_8h.html#a9a937fbb3b5f4e68880a9c5714a29ce5" title="Create a new thread and start the PBX.">ast_pbx_start</a>(tmp)) {
<a name="l04368"></a>04368             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to start PBX on %s\n&quot;</span>, tmp-&gt;name);
<a name="l04369"></a>04369             <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(tmp);
<a name="l04370"></a>04370             tmp = NULL;
<a name="l04371"></a>04371          }
<a name="l04372"></a>04372       }
<a name="l04373"></a>04373    }
<a name="l04374"></a>04374    <span class="keywordflow">return</span> tmp;
<a name="l04375"></a>04375 }
<a name="l04376"></a>04376 
<a name="l04377"></a><a class="code" href="chan__skinny_8c.html#ab83ed9e7df10c7f6008833ab7ab1bc0d">04377</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#ab83ed9e7df10c7f6008833ab7ab1bc0d">skinny_hold</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub)
<a name="l04378"></a>04378 {
<a name="l04379"></a>04379    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l = sub-&gt;parent;
<a name="l04380"></a>04380    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d = l-&gt;device;
<a name="l04381"></a>04381 
<a name="l04382"></a>04382    <span class="comment">/* Don&apos;t try to hold a channel that doesn&apos;t exist */</span>
<a name="l04383"></a>04383    <span class="keywordflow">if</span> (!sub || !sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)
<a name="l04384"></a>04384       <span class="keywordflow">return</span> 0;
<a name="l04385"></a>04385 
<a name="l04386"></a>04386    <span class="comment">/* Channel needs to be put on hold */</span>
<a name="l04387"></a>04387    <span class="keywordflow">if</span> (skinnydebug)
<a name="l04388"></a>04388       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Putting on Hold(%d)\n&quot;</span>, l-&gt;instance);
<a name="l04389"></a>04389 
<a name="l04390"></a>04390    <a class="code" href="channel_8h.html#a7e5e15c22564fd66351d332ad10658b5" title="Queue a control frame with payload.">ast_queue_control_data</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ab99a3d1c08c5ae8bca078c7cd1ec02f5">AST_CONTROL_HOLD</a>,
<a name="l04391"></a>04391       <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(l-&gt;mohsuggest, NULL),
<a name="l04392"></a>04392       !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(l-&gt;mohsuggest) ? strlen(l-&gt;mohsuggest) + 1 : 0);
<a name="l04393"></a>04393 
<a name="l04394"></a>04394    <a class="code" href="chan__skinny_8c.html#a6b694923ed4fb4da7b7e8fbcf650cbf1">transmit_activatecallplane</a>(d, l);
<a name="l04395"></a>04395    <a class="code" href="chan__skinny_8c.html#a875522082ab6d17f72cbf3ad88708a9b">transmit_closereceivechannel</a>(d, sub);
<a name="l04396"></a>04396    <a class="code" href="chan__skinny_8c.html#ae4983e199d8ab27568a4e09f740379d1">transmit_stopmediatransmission</a>(d, sub);
<a name="l04397"></a>04397 
<a name="l04398"></a>04398    <a class="code" href="chan__skinny_8c.html#a891052a3d2334a56e4b5df01988ad8fb">transmit_callstateonly</a>(d, sub, <a class="code" href="chan__skinny_8c.html#a4a2a093850ad1fe42d691104a8efcb5a">SKINNY_HOLD</a>);
<a name="l04399"></a>04399    <a class="code" href="chan__skinny_8c.html#aa16aabd900fdb4bd057303387115959f">transmit_lamp_indication</a>(d, <a class="code" href="chan__skinny_8c.html#af5c47ae0f0932f1d461f5b7b4cc0b095">STIMULUS_LINE</a>, l-&gt;instance, <a class="code" href="chan__skinny_8c.html#a7de4e252b70c1f9022529a7de2c16344">SKINNY_LAMP_WINK</a>);
<a name="l04400"></a>04400    sub-&gt;<a class="code" href="structskinny__subchannel.html#a46585eaf56ac8588fa673c1c089f0238">onhold</a> = 1;
<a name="l04401"></a>04401    <span class="keywordflow">return</span> 1;
<a name="l04402"></a>04402 }
<a name="l04403"></a>04403 
<a name="l04404"></a><a class="code" href="chan__skinny_8c.html#a00669e605357a5f37460c33e0917cc72">04404</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a00669e605357a5f37460c33e0917cc72">skinny_unhold</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub)
<a name="l04405"></a>04405 {
<a name="l04406"></a>04406    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l = sub-&gt;parent;
<a name="l04407"></a>04407    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d = l-&gt;device;
<a name="l04408"></a>04408 
<a name="l04409"></a>04409    <span class="comment">/* Don&apos;t try to unhold a channel that doesn&apos;t exist */</span>
<a name="l04410"></a>04410    <span class="keywordflow">if</span> (!sub || !sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)
<a name="l04411"></a>04411       <span class="keywordflow">return</span> 0;
<a name="l04412"></a>04412 
<a name="l04413"></a>04413    <span class="comment">/* Channel is on hold, so we will unhold */</span>
<a name="l04414"></a>04414    <span class="keywordflow">if</span> (skinnydebug)
<a name="l04415"></a>04415       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Taking off Hold(%d)\n&quot;</span>, l-&gt;instance);
<a name="l04416"></a>04416 
<a name="l04417"></a>04417    <a class="code" href="channel_8h.html#a60f9d2b0ab8b7a839902313321163b28" title="Queue a control frame with payload.">ast_queue_control</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>);
<a name="l04418"></a>04418 
<a name="l04419"></a>04419    <a class="code" href="chan__skinny_8c.html#a6b694923ed4fb4da7b7e8fbcf650cbf1">transmit_activatecallplane</a>(d, l);
<a name="l04420"></a>04420 
<a name="l04421"></a>04421    <a class="code" href="chan__skinny_8c.html#ae0cb986aeace802ace6a240d73c7335c">transmit_connect</a>(d, sub);
<a name="l04422"></a>04422    <a class="code" href="chan__skinny_8c.html#a891052a3d2334a56e4b5df01988ad8fb">transmit_callstateonly</a>(d, sub, <a class="code" href="chan__skinny_8c.html#a1b0b13fd37b0eec0ebbc6031c91d4662">SKINNY_CONNECTED</a>);
<a name="l04423"></a>04423    <a class="code" href="chan__skinny_8c.html#aa16aabd900fdb4bd057303387115959f">transmit_lamp_indication</a>(d, <a class="code" href="chan__skinny_8c.html#af5c47ae0f0932f1d461f5b7b4cc0b095">STIMULUS_LINE</a>, l-&gt;instance, <a class="code" href="chan__skinny_8c.html#a360e677a1a8e92ab455b8c354a15d969">SKINNY_LAMP_ON</a>);
<a name="l04424"></a>04424    l-&gt;hookstate = <a class="code" href="chan__skinny_8c.html#a2e10f13253ac5069f50f7f66b9511537">SKINNY_OFFHOOK</a>;
<a name="l04425"></a>04425    sub-&gt;<a class="code" href="structskinny__subchannel.html#a46585eaf56ac8588fa673c1c089f0238">onhold</a> = 0;
<a name="l04426"></a>04426    <span class="keywordflow">return</span> 1;
<a name="l04427"></a>04427 }
<a name="l04428"></a>04428 
<a name="l04429"></a><a class="code" href="chan__skinny_8c.html#aa9d48518ce398e46ebf39a3eff38c849">04429</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#aa9d48518ce398e46ebf39a3eff38c849">handle_hold_button</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub)
<a name="l04430"></a>04430 {
<a name="l04431"></a>04431    <span class="keywordflow">if</span> (!sub)
<a name="l04432"></a>04432       <span class="keywordflow">return</span> -1;
<a name="l04433"></a>04433    <span class="keywordflow">if</span> (sub-&gt;related) {
<a name="l04434"></a>04434       <a class="code" href="chan__skinny_8c.html#ab83ed9e7df10c7f6008833ab7ab1bc0d">skinny_hold</a>(sub);
<a name="l04435"></a>04435       <a class="code" href="chan__skinny_8c.html#a00669e605357a5f37460c33e0917cc72">skinny_unhold</a>(sub-&gt;related);
<a name="l04436"></a>04436       sub-&gt;parent-&gt;activesub = sub-&gt;related;
<a name="l04437"></a>04437    } <span class="keywordflow">else</span> {
<a name="l04438"></a>04438       <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#a46585eaf56ac8588fa673c1c089f0238">onhold</a>) {
<a name="l04439"></a>04439          <a class="code" href="chan__skinny_8c.html#a00669e605357a5f37460c33e0917cc72">skinny_unhold</a>(sub);
<a name="l04440"></a>04440          <a class="code" href="chan__skinny_8c.html#a5364d4b25cac8ec6f4572faf1434383d">transmit_selectsoftkeys</a>(sub-&gt;parent-&gt;device, sub-&gt;parent-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>, <a class="code" href="chan__skinny_8c.html#aad5f46f88fa82da05103795046e110b7">KEYDEF_CONNECTED</a>);
<a name="l04441"></a>04441       } <span class="keywordflow">else</span> {
<a name="l04442"></a>04442          <a class="code" href="chan__skinny_8c.html#ab83ed9e7df10c7f6008833ab7ab1bc0d">skinny_hold</a>(sub);
<a name="l04443"></a>04443          <a class="code" href="chan__skinny_8c.html#a5364d4b25cac8ec6f4572faf1434383d">transmit_selectsoftkeys</a>(sub-&gt;parent-&gt;device, sub-&gt;parent-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>, <a class="code" href="chan__skinny_8c.html#a1c1b2ec6acc543dbd96c917364d733e3">KEYDEF_ONHOLD</a>);
<a name="l04444"></a>04444       }
<a name="l04445"></a>04445    }
<a name="l04446"></a>04446    <span class="keywordflow">return</span> 1;
<a name="l04447"></a>04447 }
<a name="l04448"></a>04448 
<a name="l04449"></a><a class="code" href="chan__skinny_8c.html#af725e197a8e1179ddd97a81b592dbb93">04449</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#af725e197a8e1179ddd97a81b592dbb93">handle_transfer_button</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub)
<a name="l04450"></a>04450 {
<a name="l04451"></a>04451    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l = sub-&gt;parent;
<a name="l04452"></a>04452    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d = l-&gt;device;
<a name="l04453"></a>04453    <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *newsub;
<a name="l04454"></a>04454    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c;
<a name="l04455"></a>04455    pthread_t t;
<a name="l04456"></a>04456 
<a name="l04457"></a>04457    <span class="keywordflow">if</span> (!sub) {
<a name="l04458"></a>04458       <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;Transfer: No subchannel to transfer\n&quot;</span>);
<a name="l04459"></a>04459       <span class="keywordflow">return</span> -1;
<a name="l04460"></a>04460    }
<a name="l04461"></a>04461    <span class="keywordflow">if</span> (!sub-&gt;related) {
<a name="l04462"></a>04462       <span class="comment">/* Another sub has not been created so this must be first XFER press */</span>
<a name="l04463"></a>04463       <span class="keywordflow">if</span> (!sub-&gt;<a class="code" href="structskinny__subchannel.html#a46585eaf56ac8588fa673c1c089f0238">onhold</a>) {
<a name="l04464"></a>04464          <a class="code" href="chan__skinny_8c.html#ab83ed9e7df10c7f6008833ab7ab1bc0d">skinny_hold</a>(sub);
<a name="l04465"></a>04465       }
<a name="l04466"></a>04466       c = <a class="code" href="chan__skinny_8c.html#a7d4cb293426c31e532f15f52fd8183fd">skinny_new</a>(l, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>);
<a name="l04467"></a>04467       <span class="keywordflow">if</span> (c) {
<a name="l04468"></a>04468          newsub = c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l04469"></a>04469          <span class="comment">/* point the sub and newsub at each other so we know they are related */</span>
<a name="l04470"></a>04470          newsub-&gt;related = sub;
<a name="l04471"></a>04471          sub-&gt;related = newsub;
<a name="l04472"></a>04472          newsub-&gt;<a class="code" href="structskinny__subchannel.html#a04f1e042676be8f4763d8d5a9000b1e5">xferor</a> = 1;
<a name="l04473"></a>04473          l-&gt;<a class="code" href="structskinny__line.html#aedffa4337f76fdcdc808e16affbafd04">activesub</a> = newsub;
<a name="l04474"></a>04474          <a class="code" href="chan__skinny_8c.html#a0cb936a217935cdbaa71cc6cb5171b44">transmit_callstate</a>(d, l-&gt;instance, <a class="code" href="chan__skinny_8c.html#a2e10f13253ac5069f50f7f66b9511537">SKINNY_OFFHOOK</a>, newsub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l04475"></a>04475          <span class="keywordflow">if</span> (skinnydebug)
<a name="l04476"></a>04476             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Attempting to Clear display on Skinny %s@%s\n&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l04477"></a>04477          <a class="code" href="chan__skinny_8c.html#ad2e667cc9fa19462ea433bac21b74c7b">transmit_displaymessage</a>(d, NULL, l-&gt;instance, newsub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>); <span class="comment">/* clear display */</span>
<a name="l04478"></a>04478          <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, <a class="code" href="chan__skinny_8c.html#a12616ab9d64a36f7c2f372084a3663c8">SKINNY_DIALTONE</a>, l-&gt;instance, newsub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l04479"></a>04479          <a class="code" href="chan__skinny_8c.html#a5364d4b25cac8ec6f4572faf1434383d">transmit_selectsoftkeys</a>(d, l-&gt;instance, newsub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>, <a class="code" href="chan__skinny_8c.html#a0d46746cfe50b67c811cd2fc042e0729">KEYDEF_OFFHOOKWITHFEAT</a>);
<a name="l04480"></a>04480          <span class="comment">/* start the switch thread */</span>
<a name="l04481"></a>04481          <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a4781fd54a4ca8c7f0f8a32a6cce503c0">ast_pthread_create</a>(&amp;t, NULL, <a class="code" href="chan__skinny_8c.html#ad5d83012c464b49bfde0406a3dff68fe">skinny_ss</a>, c)) {
<a name="l04482"></a>04482             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create switch thread: %s\n&quot;</span>, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l04483"></a>04483             <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(c);
<a name="l04484"></a>04484          }
<a name="l04485"></a>04485       } <span class="keywordflow">else</span> {
<a name="l04486"></a>04486          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create channel for %s@%s\n&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l04487"></a>04487       }
<a name="l04488"></a>04488    } <span class="keywordflow">else</span> {
<a name="l04489"></a>04489       <span class="comment">/* We already have a related sub so we can either complete XFER or go into BLINDXFER (or cancel BLINDXFER */</span>
<a name="l04490"></a>04490       <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#a9d49074e0655a086adb6bcc670b06f23">blindxfer</a>) {
<a name="l04491"></a>04491          <span class="comment">/* toggle blindxfer off */</span>
<a name="l04492"></a>04492          sub-&gt;<a class="code" href="structskinny__subchannel.html#a9d49074e0655a086adb6bcc670b06f23">blindxfer</a> = 0;
<a name="l04493"></a>04493          sub-&gt;related-&gt;<a class="code" href="structskinny__subchannel.html#a9d49074e0655a086adb6bcc670b06f23">blindxfer</a> = 0;
<a name="l04494"></a>04494          <span class="comment">/* we really need some indications */</span>
<a name="l04495"></a>04495       } <span class="keywordflow">else</span> {
<a name="l04496"></a>04496          <span class="comment">/* We were doing attended transfer */</span>
<a name="l04497"></a>04497          <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a> || sub-&gt;related-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>) {
<a name="l04498"></a>04498             <span class="comment">/* one of the subs so we cant transfer yet, toggle blindxfer on */</span>
<a name="l04499"></a>04499             sub-&gt;<a class="code" href="structskinny__subchannel.html#a9d49074e0655a086adb6bcc670b06f23">blindxfer</a> = 1;
<a name="l04500"></a>04500             sub-&gt;related-&gt;<a class="code" href="structskinny__subchannel.html#a9d49074e0655a086adb6bcc670b06f23">blindxfer</a> = 1;
<a name="l04501"></a>04501          } <span class="keywordflow">else</span> {
<a name="l04502"></a>04502             <span class="comment">/* big assumption we have two channels, lets transfer */</span>
<a name="l04503"></a>04503             <a class="code" href="chan__skinny_8c.html#aea5421cbe4655ae065e67067694eca68">skinny_transfer</a>(sub);
<a name="l04504"></a>04504          }
<a name="l04505"></a>04505       }
<a name="l04506"></a>04506    }
<a name="l04507"></a>04507    <span class="keywordflow">return</span> 0;
<a name="l04508"></a>04508 }
<a name="l04509"></a>04509 
<a name="l04510"></a><a class="code" href="chan__skinny_8c.html#a4e67efb4749b43509711e424800bda72">04510</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a4e67efb4749b43509711e424800bda72">handle_keep_alive_message</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__req.html">skinny_req</a> *req, <span class="keyword">struct</span> <a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l04511"></a>04511 {
<a name="l04512"></a>04512    <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(0, <a class="code" href="chan__skinny_8c.html#abc0af116eb82cd2fef2601d565c64ecc">KEEP_ALIVE_ACK_MESSAGE</a>)))
<a name="l04513"></a>04513       <span class="keywordflow">return</span> -1;
<a name="l04514"></a>04514 
<a name="l04515"></a>04515    <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(s-&gt;<a class="code" href="structskinnysession.html#a70701ca9c2641bcb1740286273a0473a">device</a>, req);
<a name="l04516"></a>04516    <span class="keywordflow">return</span> 1;
<a name="l04517"></a>04517 }
<a name="l04518"></a>04518 
<a name="l04519"></a><a class="code" href="chan__skinny_8c.html#a7f535538747c986182c94720cc460806">04519</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a7f535538747c986182c94720cc460806">handle_register_message</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__req.html">skinny_req</a> *req, <span class="keyword">struct</span> <a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l04520"></a>04520 {
<a name="l04521"></a>04521    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d = NULL;
<a name="l04522"></a>04522    <span class="keywordtype">char</span> <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>[16];
<a name="l04523"></a>04523    <span class="keywordtype">int</span> res;
<a name="l04524"></a>04524 
<a name="l04525"></a>04525    memcpy(&amp;name, req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aceb9d5d9b0983f8fb0e5523310274dc4">reg</a>.<a class="code" href="structregister__message.html#acd328517a6cf718155c2e6e22b671ca9">name</a>, <span class="keyword">sizeof</span>(name));
<a name="l04526"></a>04526 
<a name="l04527"></a>04527    res = <a class="code" href="chan__skinny_8c.html#a3fe6385caa677e3d51eb12df891b0d4e">skinny_register</a>(req, s);
<a name="l04528"></a>04528    <span class="keywordflow">if</span> (!res) {
<a name="l04529"></a>04529       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Rejecting Device %s: Device not found\n&quot;</span>, name);
<a name="l04530"></a>04530       <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structregister__rej__message.html">register_rej_message</a>), <a class="code" href="chan__skinny_8c.html#a8a678ba2da3542aefebf876d6849ad6a">REGISTER_REJ_MESSAGE</a>)))
<a name="l04531"></a>04531          <span class="keywordflow">return</span> -1;
<a name="l04532"></a>04532 
<a name="l04533"></a>04533       snprintf(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a439767f912c8dce1e74fb1c3c45ee17b">regrej</a>.<a class="code" href="structregister__rej__message.html#ae277b64cf6cfc5934fc43b096023feed">errMsg</a>, <span class="keyword">sizeof</span>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a439767f912c8dce1e74fb1c3c45ee17b">regrej</a>.<a class="code" href="structregister__rej__message.html#ae277b64cf6cfc5934fc43b096023feed">errMsg</a>), <span class="stringliteral">&quot;No Authority: %s&quot;</span>, name);
<a name="l04534"></a>04534 
<a name="l04535"></a>04535       <span class="comment">/* transmit_respons in line as we don&apos;t have a valid d */</span>
<a name="l04536"></a>04536       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;s-&gt;<a class="code" href="structskinnysession.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l04537"></a>04537 
<a name="l04538"></a>04538       <span class="keywordflow">if</span> (<a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#afed088663f8704004425cdae2120b9b3">len</a> &gt; <a class="code" href="chan__skinny_8c.html#af113e81b9ed86ff1591580de9d8b1d52">SKINNY_MAX_PACKET</a>) || <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#afed088663f8704004425cdae2120b9b3">len</a> &lt; 0)) {
<a name="l04539"></a>04539          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;transmit_response: the length of the request is out of bounds\n&quot;</span>);
<a name="l04540"></a>04540          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;s-&gt;<a class="code" href="structskinnysession.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l04541"></a>04541          <span class="keywordflow">return</span> -1;
<a name="l04542"></a>04542       }
<a name="l04543"></a>04543 
<a name="l04544"></a>04544       memset(s-&gt;<a class="code" href="structskinnysession.html#add02b47ccdba2203fd3d2ae04d6180ea">outbuf</a>, 0, <span class="keyword">sizeof</span>(s-&gt;<a class="code" href="structskinnysession.html#add02b47ccdba2203fd3d2ae04d6180ea">outbuf</a>));
<a name="l04545"></a>04545       memcpy(s-&gt;<a class="code" href="structskinnysession.html#add02b47ccdba2203fd3d2ae04d6180ea">outbuf</a>, req, skinny_header_size);
<a name="l04546"></a>04546       memcpy(s-&gt;<a class="code" href="structskinnysession.html#add02b47ccdba2203fd3d2ae04d6180ea">outbuf</a>+skinny_header_size, &amp;req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>, <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#afed088663f8704004425cdae2120b9b3">len</a>));
<a name="l04547"></a>04547 
<a name="l04548"></a>04548       res = write(s-&gt;<a class="code" href="structskinnysession.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, s-&gt;<a class="code" href="structskinnysession.html#add02b47ccdba2203fd3d2ae04d6180ea">outbuf</a>, <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#afed088663f8704004425cdae2120b9b3">len</a>)+8);
<a name="l04549"></a>04549 
<a name="l04550"></a>04550       <span class="keywordflow">if</span> (res != <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#afed088663f8704004425cdae2120b9b3">len</a>)+8) {
<a name="l04551"></a>04551          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Transmit: write only sent %d out of %d bytes: %s\n&quot;</span>, res, <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#afed088663f8704004425cdae2120b9b3">len</a>)+8, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l04552"></a>04552       }
<a name="l04553"></a>04553    
<a name="l04554"></a>04554       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;s-&gt;<a class="code" href="structskinnysession.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l04555"></a>04555 
<a name="l04556"></a>04556       <span class="keywordflow">return</span> 0;
<a name="l04557"></a>04557    }
<a name="l04558"></a>04558    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Device &apos;%s&apos; successfully registered\n&quot;</span>, name);
<a name="l04559"></a>04559 
<a name="l04560"></a>04560    d = s-&gt;<a class="code" href="structskinnysession.html#a70701ca9c2641bcb1740286273a0473a">device</a>;
<a name="l04561"></a>04561    
<a name="l04562"></a>04562    <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structregister__ack__message.html">register_ack_message</a>), <a class="code" href="chan__skinny_8c.html#a3fb821358598b476576f3b098586498f">REGISTER_ACK_MESSAGE</a>)))
<a name="l04563"></a>04563       <span class="keywordflow">return</span> -1;
<a name="l04564"></a>04564 
<a name="l04565"></a>04565    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aab36685c6e9d5c3e2c01d568f2304663">regack</a>.<a class="code" href="structregister__ack__message.html#a7be363918d3701aef294dc8cd25f6d80">res</a>[0] = <span class="charliteral">&apos;0&apos;</span>;
<a name="l04566"></a>04566    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aab36685c6e9d5c3e2c01d568f2304663">regack</a>.<a class="code" href="structregister__ack__message.html#a7be363918d3701aef294dc8cd25f6d80">res</a>[1] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l04567"></a>04567    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aab36685c6e9d5c3e2c01d568f2304663">regack</a>.<a class="code" href="structregister__ack__message.html#aa7c63ac4bd47bf61251998dd8c9b63ea">keepAlive</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(keep_alive);
<a name="l04568"></a>04568    memcpy(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aab36685c6e9d5c3e2c01d568f2304663">regack</a>.<a class="code" href="structregister__ack__message.html#a05c27f79b3e6af4e4a8c19ce8bccefb7">dateTemplate</a>, date_format, <span class="keyword">sizeof</span>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aab36685c6e9d5c3e2c01d568f2304663">regack</a>.<a class="code" href="structregister__ack__message.html#a05c27f79b3e6af4e4a8c19ce8bccefb7">dateTemplate</a>));
<a name="l04569"></a>04569    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aab36685c6e9d5c3e2c01d568f2304663">regack</a>.<a class="code" href="structregister__ack__message.html#a4b9c948b588ab48f4bd3866b36624669">res2</a>[0] = <span class="charliteral">&apos;0&apos;</span>;
<a name="l04570"></a>04570    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aab36685c6e9d5c3e2c01d568f2304663">regack</a>.<a class="code" href="structregister__ack__message.html#a4b9c948b588ab48f4bd3866b36624669">res2</a>[1] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l04571"></a>04571    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aab36685c6e9d5c3e2c01d568f2304663">regack</a>.<a class="code" href="structregister__ack__message.html#a80e8d2b07d4ba102a31aea2fe00730b1">secondaryKeepAlive</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(keep_alive);
<a name="l04572"></a>04572    <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l04573"></a>04573    <span class="keywordflow">if</span> (skinnydebug)
<a name="l04574"></a>04574       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Requesting capabilities\n&quot;</span>);
<a name="l04575"></a>04575 
<a name="l04576"></a>04576    <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(0, <a class="code" href="chan__skinny_8c.html#adb5145c2019b8a1d29b20b7b482f8f17">CAPABILITIES_REQ_MESSAGE</a>)))
<a name="l04577"></a>04577       <span class="keywordflow">return</span> -1;
<a name="l04578"></a>04578 
<a name="l04579"></a>04579    <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l04580"></a>04580 
<a name="l04581"></a>04581    <span class="keywordflow">return</span> res;
<a name="l04582"></a>04582 }
<a name="l04583"></a>04583 
<a name="l04584"></a><a class="code" href="chan__skinny_8c.html#a82c88f8bbff9fac239c78d797a181343">04584</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a82c88f8bbff9fac239c78d797a181343">handle_callforward_button</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub, <span class="keywordtype">int</span> cfwdtype)
<a name="l04585"></a>04585 {
<a name="l04586"></a>04586    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l = sub-&gt;parent;
<a name="l04587"></a>04587    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d = l-&gt;device;
<a name="l04588"></a>04588    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c = sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l04589"></a>04589    pthread_t t;
<a name="l04590"></a>04590 
<a name="l04591"></a>04591    <span class="keywordflow">if</span> (l-&gt;hookstate == <a class="code" href="chan__skinny_8c.html#ad38b06a5edcc17eaa553739944e702e1">SKINNY_ONHOOK</a>) {
<a name="l04592"></a>04592       l-&gt;hookstate = <a class="code" href="chan__skinny_8c.html#a2e10f13253ac5069f50f7f66b9511537">SKINNY_OFFHOOK</a>;
<a name="l04593"></a>04593       <a class="code" href="chan__skinny_8c.html#a9d00b95f44b64f37d738f1ddc2ef972f">transmit_speaker_mode</a>(d, <a class="code" href="chan__skinny_8c.html#a379fd834cea6549831c799ed002b52f7">SKINNY_SPEAKERON</a>);
<a name="l04594"></a>04594       <a class="code" href="chan__skinny_8c.html#a0cb936a217935cdbaa71cc6cb5171b44">transmit_callstate</a>(d, l-&gt;instance, <a class="code" href="chan__skinny_8c.html#a2e10f13253ac5069f50f7f66b9511537">SKINNY_OFFHOOK</a>, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l04595"></a>04595    }
<a name="l04596"></a>04596    <span class="keywordflow">if</span> (skinnydebug)
<a name="l04597"></a>04597       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Attempting to Clear display on Skinny %s@%s\n&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l04598"></a>04598    <a class="code" href="chan__skinny_8c.html#ad2e667cc9fa19462ea433bac21b74c7b">transmit_displaymessage</a>(d, NULL, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>); <span class="comment">/* clear display */</span>
<a name="l04599"></a>04599 
<a name="l04600"></a>04600    <span class="keywordflow">if</span> (l-&gt;cfwdtype &amp; cfwdtype) {
<a name="l04601"></a>04601       <a class="code" href="chan__skinny_8c.html#ab04a8ea6a900e9b9327d8e896b61899b">set_callforwards</a>(l, NULL, cfwdtype);
<a name="l04602"></a>04602       <a class="code" href="channel_8h.html#af10e3bd01602095e1908d3926afc3b76" title="Wait for a specified amount of time, looking for hangups.">ast_safe_sleep</a>(c, 500);
<a name="l04603"></a>04603       <a class="code" href="chan__skinny_8c.html#a9d00b95f44b64f37d738f1ddc2ef972f">transmit_speaker_mode</a>(d, <a class="code" href="chan__skinny_8c.html#a0c90019de529b77fb06d587393ec42bf">SKINNY_SPEAKEROFF</a>);
<a name="l04604"></a>04604       <a class="code" href="chan__skinny_8c.html#a0cb936a217935cdbaa71cc6cb5171b44">transmit_callstate</a>(d, l-&gt;instance, <a class="code" href="chan__skinny_8c.html#ad38b06a5edcc17eaa553739944e702e1">SKINNY_ONHOOK</a>, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l04605"></a>04605       <a class="code" href="chan__skinny_8c.html#a8122a36b30f8a86ffe3a06548fa8903c">transmit_displaynotify</a>(d, <span class="stringliteral">&quot;CFwd disabled&quot;</span>, 10);
<a name="l04606"></a>04606       <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) {
<a name="l04607"></a>04607          <a class="code" href="channel_8h.html#aef2af15a597c948e97628da6c5c84f28" title="Indicates condition of channel.">ast_indicate</a>(c, -1);
<a name="l04608"></a>04608          <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(c);
<a name="l04609"></a>04609       }
<a name="l04610"></a>04610       <a class="code" href="chan__skinny_8c.html#aa51e51361738b28e24f83d7ec6b4c0f3">transmit_cfwdstate</a>(d, l);
<a name="l04611"></a>04611    } <span class="keywordflow">else</span> {
<a name="l04612"></a>04612       l-&gt;getforward = cfwdtype;
<a name="l04613"></a>04613       <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, <a class="code" href="chan__skinny_8c.html#a12616ab9d64a36f7c2f372084a3663c8">SKINNY_DIALTONE</a>, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l04614"></a>04614       <a class="code" href="chan__skinny_8c.html#a5364d4b25cac8ec6f4572faf1434383d">transmit_selectsoftkeys</a>(d, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>, <a class="code" href="chan__skinny_8c.html#ae18cb03403da5513c2c6ac0c32c4c939">KEYDEF_RINGOUT</a>);
<a name="l04615"></a>04615       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a4781fd54a4ca8c7f0f8a32a6cce503c0">ast_pthread_create</a>(&amp;t, NULL, <a class="code" href="chan__skinny_8c.html#ad5d83012c464b49bfde0406a3dff68fe">skinny_ss</a>, c)) {
<a name="l04616"></a>04616          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create switch thread: %s\n&quot;</span>, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l04617"></a>04617          <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(c);
<a name="l04618"></a>04618       }
<a name="l04619"></a>04619    }
<a name="l04620"></a>04620    <span class="keywordflow">return</span> 0;
<a name="l04621"></a>04621 }
<a name="l04622"></a><a class="code" href="chan__skinny_8c.html#ae331d9ec23b9f9ed1f97b87be60b9fb8">04622</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#ae331d9ec23b9f9ed1f97b87be60b9fb8">handle_ip_port_message</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__req.html">skinny_req</a> *req, <span class="keyword">struct</span> <a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l04623"></a>04623 {
<a name="l04624"></a>04624    <span class="comment">/* no response necessary */</span>
<a name="l04625"></a>04625    <span class="keywordflow">return</span> 1;
<a name="l04626"></a>04626 }
<a name="l04627"></a>04627 
<a name="l04628"></a><a class="code" href="chan__skinny_8c.html#a1f86382ae84168245fb2f120af3747d4">04628</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a1f86382ae84168245fb2f120af3747d4">handle_keypad_button_message</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__req.html">skinny_req</a> *req, <span class="keyword">struct</span> <a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l04629"></a>04629 {
<a name="l04630"></a>04630    <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub = NULL;
<a name="l04631"></a>04631    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l;
<a name="l04632"></a>04632    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d = s-&gt;<a class="code" href="structskinnysession.html#a70701ca9c2641bcb1740286273a0473a">device</a>;
<a name="l04633"></a>04633    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> f = { 0, };
<a name="l04634"></a>04634    <span class="keywordtype">char</span> dgt;
<a name="l04635"></a>04635    <span class="keywordtype">int</span> digit;
<a name="l04636"></a>04636    <span class="keywordtype">int</span> lineInstance;
<a name="l04637"></a>04637    <span class="keywordtype">int</span> callReference;
<a name="l04638"></a>04638 
<a name="l04639"></a>04639    digit = <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a23815068e4a04a658a8bd00aabab71fc">keypad</a>.<a class="code" href="structkeypad__button__message.html#a9ee7e63d91ac13e63dbad259aa1b52a6">button</a>);
<a name="l04640"></a>04640    lineInstance = <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a23815068e4a04a658a8bd00aabab71fc">keypad</a>.<a class="code" href="structkeypad__button__message.html#a3c8ec1b11804b48f666007331e0c90ba">lineInstance</a>);
<a name="l04641"></a>04641    callReference = <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a23815068e4a04a658a8bd00aabab71fc">keypad</a>.<a class="code" href="structkeypad__button__message.html#a8c5b70179481930bfaef1fa8f6aaba74">callReference</a>);
<a name="l04642"></a>04642 
<a name="l04643"></a>04643    <span class="keywordflow">if</span> (digit == 14) {
<a name="l04644"></a>04644       dgt = <span class="charliteral">&apos;*&apos;</span>;
<a name="l04645"></a>04645    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (digit == 15) {
<a name="l04646"></a>04646       dgt = <span class="charliteral">&apos;#&apos;</span>;
<a name="l04647"></a>04647    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (digit &gt;= 0 &amp;&amp; digit &lt;= 9) {
<a name="l04648"></a>04648       dgt = <span class="charliteral">&apos;0&apos;</span> + digit;
<a name="l04649"></a>04649    } <span class="keywordflow">else</span> {
<a name="l04650"></a>04650       <span class="comment">/* digit=10-13 (A,B,C,D ?), or</span>
<a name="l04651"></a>04651 <span class="comment">       * digit is bad value</span>
<a name="l04652"></a>04652 <span class="comment">       *</span>
<a name="l04653"></a>04653 <span class="comment">       * probably should not end up here, but set</span>
<a name="l04654"></a>04654 <span class="comment">       * value for backward compatibility, and log</span>
<a name="l04655"></a>04655 <span class="comment">       * a warning.</span>
<a name="l04656"></a>04656 <span class="comment">       */</span>
<a name="l04657"></a>04657       dgt = <span class="charliteral">&apos;0&apos;</span> + digit;
<a name="l04658"></a>04658       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unsupported digit %d\n&quot;</span>, digit);
<a name="l04659"></a>04659    }
<a name="l04660"></a>04660 
<a name="l04661"></a>04661    f.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = dgt;
<a name="l04662"></a>04662 
<a name="l04663"></a>04663    f.<a class="code" href="structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a> = <span class="stringliteral">&quot;skinny&quot;</span>;
<a name="l04664"></a>04664 
<a name="l04665"></a>04665    <span class="keywordflow">if</span> (lineInstance &amp;&amp; callReference)
<a name="l04666"></a>04666       sub = <a class="code" href="chan__skinny_8c.html#a10c715ff96a500b77ddc4442fa17cf55">find_subchannel_by_instance_reference</a>(d, lineInstance, callReference);
<a name="l04667"></a>04667    <span class="keywordflow">else</span>
<a name="l04668"></a>04668       sub = d-&gt;<a class="code" href="structskinny__device.html#a70da1427655ecdaa64e57324e51f440b">activeline</a>-&gt;<a class="code" href="structskinny__line.html#aedffa4337f76fdcdc808e16affbafd04">activesub</a>;
<a name="l04669"></a>04669       <span class="comment">//sub = find_subchannel_by_instance_reference(d, d-&gt;lastlineinstance, d-&gt;lastcallreference);</span>
<a name="l04670"></a>04670 
<a name="l04671"></a>04671    <span class="keywordflow">if</span> (!sub)
<a name="l04672"></a>04672       <span class="keywordflow">return</span> 0;
<a name="l04673"></a>04673 
<a name="l04674"></a>04674    l = sub-&gt;parent;
<a name="l04675"></a>04675    <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l04676"></a>04676       <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == 0) {
<a name="l04677"></a>04677          f.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a9b350360a64b55c7590f1ec03db480be">AST_FRAME_DTMF_BEGIN</a>;
<a name="l04678"></a>04678          <a class="code" href="channel_8h.html#a6cbcba5661d55216968cde8fdf913c89" title="Queue one or more frames to a channel&amp;#39;s frame queue.">ast_queue_frame</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, &amp;f);
<a name="l04679"></a>04679       }
<a name="l04680"></a>04680       <span class="comment">/* XXX MUST queue this frame to all lines in threeway call if threeway call is active */</span>
<a name="l04681"></a>04681       f.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a98e65764bc963016c394bcc1bad6540b">AST_FRAME_DTMF_END</a>;
<a name="l04682"></a>04682       <a class="code" href="channel_8h.html#a6cbcba5661d55216968cde8fdf913c89" title="Queue one or more frames to a channel&amp;#39;s frame queue.">ast_queue_frame</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, &amp;f);
<a name="l04683"></a>04683       <span class="comment">/* XXX This seriously needs to be fixed */</span>
<a name="l04684"></a>04684       <span class="keywordflow">if</span> (<a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(sub, list) &amp;&amp; <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(sub, list)-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l04685"></a>04685          <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == 0) {
<a name="l04686"></a>04686             f.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a9b350360a64b55c7590f1ec03db480be">AST_FRAME_DTMF_BEGIN</a>;
<a name="l04687"></a>04687             <a class="code" href="channel_8h.html#a6cbcba5661d55216968cde8fdf913c89" title="Queue one or more frames to a channel&amp;#39;s frame queue.">ast_queue_frame</a>(<a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(sub, list)-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, &amp;f);
<a name="l04688"></a>04688          }
<a name="l04689"></a>04689          f.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a98e65764bc963016c394bcc1bad6540b">AST_FRAME_DTMF_END</a>;
<a name="l04690"></a>04690          <a class="code" href="channel_8h.html#a6cbcba5661d55216968cde8fdf913c89" title="Queue one or more frames to a channel&amp;#39;s frame queue.">ast_queue_frame</a>(<a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(sub, list)-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, &amp;f);
<a name="l04691"></a>04691       }
<a name="l04692"></a>04692    } <span class="keywordflow">else</span> {
<a name="l04693"></a>04693       <span class="keywordflow">if</span> (skinnydebug)
<a name="l04694"></a>04694          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;No owner: %s\n&quot;</span>, l-&gt;name);
<a name="l04695"></a>04695    }
<a name="l04696"></a>04696    <span class="keywordflow">return</span> 1;
<a name="l04697"></a>04697 }
<a name="l04698"></a>04698 
<a name="l04699"></a><a class="code" href="chan__skinny_8c.html#ad229f47d1b225da7a72688def1a3c95b">04699</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#ad229f47d1b225da7a72688def1a3c95b">handle_stimulus_message</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__req.html">skinny_req</a> *req, <span class="keyword">struct</span> <a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l04700"></a>04700 {
<a name="l04701"></a>04701    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d = s-&gt;<a class="code" href="structskinnysession.html#a70701ca9c2641bcb1740286273a0473a">device</a>;
<a name="l04702"></a>04702    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l;
<a name="l04703"></a>04703    <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub;
<a name="l04704"></a>04704    <span class="comment">/*struct skinny_speeddial *sd;*/</span>
<a name="l04705"></a>04705    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c;
<a name="l04706"></a>04706    pthread_t t;
<a name="l04707"></a>04707    <span class="keywordtype">int</span> event;
<a name="l04708"></a>04708    <span class="keywordtype">int</span> instance;
<a name="l04709"></a>04709    <span class="keywordtype">int</span> callreference;
<a name="l04710"></a>04710    <span class="comment">/*int res = 0;*/</span>
<a name="l04711"></a>04711 
<a name="l04712"></a>04712    <span class="keyword">event</span> = <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aee5c3dbb8f03b80b242ed1b447d25886">stimulus</a>.<a class="code" href="structstimulus__message.html#af793c4f4a8ade380472caa8035905848">stimulus</a>);
<a name="l04713"></a>04713    instance = <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aee5c3dbb8f03b80b242ed1b447d25886">stimulus</a>.<a class="code" href="structstimulus__message.html#a9343bb7a21618047055c833ea497d1fe">stimulusInstance</a>);
<a name="l04714"></a>04714    callreference = <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aee5c3dbb8f03b80b242ed1b447d25886">stimulus</a>.<a class="code" href="structstimulus__message.html#aa056c11f2f813407952d829437cec263">callreference</a>); 
<a name="l04715"></a>04715    <span class="keywordflow">if</span> (skinnydebug)
<a name="l04716"></a>04716       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;callreference in handle_stimulus_message is &apos;%d&apos;\n&quot;</span>, callreference);
<a name="l04717"></a>04717 
<a name="l04718"></a>04718    <span class="comment">/*  Note that this call should be using the passed in instance and callreference */</span>
<a name="l04719"></a>04719    sub = <a class="code" href="chan__skinny_8c.html#a10c715ff96a500b77ddc4442fa17cf55">find_subchannel_by_instance_reference</a>(d, d-&gt;lastlineinstance, d-&gt;lastcallreference);
<a name="l04720"></a>04720 
<a name="l04721"></a>04721    <span class="keywordflow">if</span> (!sub) {
<a name="l04722"></a>04722       l = <a class="code" href="chan__skinny_8c.html#a7b9ecaa4bb1481a9a5666e91c88a3968">find_line_by_instance</a>(d, d-&gt;lastlineinstance);
<a name="l04723"></a>04723       <span class="keywordflow">if</span> (!l) {
<a name="l04724"></a>04724          <span class="keywordflow">return</span> 0;
<a name="l04725"></a>04725       }
<a name="l04726"></a>04726       sub = l-&gt;<a class="code" href="structskinny__line.html#aedffa4337f76fdcdc808e16affbafd04">activesub</a>;
<a name="l04727"></a>04727    } <span class="keywordflow">else</span> {
<a name="l04728"></a>04728       l = sub-&gt;parent;
<a name="l04729"></a>04729    }
<a name="l04730"></a>04730 
<a name="l04731"></a>04731    <span class="keywordflow">switch</span>(event) {
<a name="l04732"></a>04732    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a33435da098fa6baba656162b287d03ad">STIMULUS_REDIAL</a>:
<a name="l04733"></a>04733       <span class="keywordflow">if</span> (skinnydebug)
<a name="l04734"></a>04734          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Stimulus: Redial(%d/%d)\n&quot;</span>, instance, callreference);
<a name="l04735"></a>04735 
<a name="l04736"></a>04736       <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(l-&gt;lastnumberdialed)) {
<a name="l04737"></a>04737          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Attempted redial, but no previously dialed number found.\n&quot;</span>);
<a name="l04738"></a>04738          l-&gt;hookstate = <a class="code" href="chan__skinny_8c.html#ad38b06a5edcc17eaa553739944e702e1">SKINNY_ONHOOK</a>;
<a name="l04739"></a>04739          <a class="code" href="chan__skinny_8c.html#a9d00b95f44b64f37d738f1ddc2ef972f">transmit_speaker_mode</a>(d, <a class="code" href="chan__skinny_8c.html#a0c90019de529b77fb06d587393ec42bf">SKINNY_SPEAKEROFF</a>);
<a name="l04740"></a>04740          <a class="code" href="chan__skinny_8c.html#a0cb936a217935cdbaa71cc6cb5171b44">transmit_callstate</a>(d, l-&gt;instance, <a class="code" href="chan__skinny_8c.html#ad38b06a5edcc17eaa553739944e702e1">SKINNY_ONHOOK</a>, instance);
<a name="l04741"></a>04741          <span class="keywordflow">break</span>;
<a name="l04742"></a>04742       }
<a name="l04743"></a>04743 
<a name="l04744"></a>04744       c = <a class="code" href="chan__skinny_8c.html#a7d4cb293426c31e532f15f52fd8183fd">skinny_new</a>(l, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>);
<a name="l04745"></a>04745       <span class="keywordflow">if</span> (!c) {
<a name="l04746"></a>04746          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create channel for %s@%s\n&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l04747"></a>04747       } <span class="keywordflow">else</span> {
<a name="l04748"></a>04748          sub = c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l04749"></a>04749          l = sub-&gt;parent;
<a name="l04750"></a>04750          l-&gt;<a class="code" href="structskinny__line.html#aedffa4337f76fdcdc808e16affbafd04">activesub</a> = sub;
<a name="l04751"></a>04751          <span class="keywordflow">if</span> (l-&gt;hookstate == <a class="code" href="chan__skinny_8c.html#ad38b06a5edcc17eaa553739944e702e1">SKINNY_ONHOOK</a>) {
<a name="l04752"></a>04752             l-&gt;hookstate = <a class="code" href="chan__skinny_8c.html#a2e10f13253ac5069f50f7f66b9511537">SKINNY_OFFHOOK</a>;
<a name="l04753"></a>04753             <a class="code" href="chan__skinny_8c.html#a0cb936a217935cdbaa71cc6cb5171b44">transmit_callstate</a>(d, l-&gt;instance, <a class="code" href="chan__skinny_8c.html#a2e10f13253ac5069f50f7f66b9511537">SKINNY_OFFHOOK</a>, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l04754"></a>04754          }
<a name="l04755"></a>04755          <span class="keywordflow">if</span> (skinnydebug)
<a name="l04756"></a>04756             <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Attempting to Clear display on Skinny %s@%s\n&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l04757"></a>04757          <a class="code" href="chan__skinny_8c.html#ad2e667cc9fa19462ea433bac21b74c7b">transmit_displaymessage</a>(d, NULL, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>); <span class="comment">/* clear display */</span>
<a name="l04758"></a>04758          <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, <a class="code" href="chan__skinny_8c.html#a12616ab9d64a36f7c2f372084a3663c8">SKINNY_DIALTONE</a>, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l04759"></a>04759          <a class="code" href="chan__skinny_8c.html#a5364d4b25cac8ec6f4572faf1434383d">transmit_selectsoftkeys</a>(d, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>, <a class="code" href="chan__skinny_8c.html#ae18cb03403da5513c2c6ac0c32c4c939">KEYDEF_RINGOUT</a>);
<a name="l04760"></a>04760 
<a name="l04761"></a>04761          <span class="keywordflow">if</span> (!<a class="code" href="pbx_8h.html#aa73d176ed4f1ce51e5db6beafba45fe3" title="Checks to see if a number should be ignored.">ast_ignore_pattern</a>(c-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, l-&gt;lastnumberdialed)) {
<a name="l04762"></a>04762             <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, <a class="code" href="chan__skinny_8c.html#a2c63c304c5e6eff4a0b13617eb4a9bed">SKINNY_SILENCE</a>, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l04763"></a>04763          }
<a name="l04764"></a>04764          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(c-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, l-&gt;lastnumberdialed, <span class="keyword">sizeof</span>(c-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>));
<a name="l04765"></a>04765          <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a4781fd54a4ca8c7f0f8a32a6cce503c0">ast_pthread_create</a>(&amp;t, NULL, <a class="code" href="chan__skinny_8c.html#a7341024ae1e485aaad445b8d2504b446">skinny_newcall</a>, c)) {
<a name="l04766"></a>04766             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create new call thread: %s\n&quot;</span>, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l04767"></a>04767             <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(c);
<a name="l04768"></a>04768          }
<a name="l04769"></a>04769       }
<a name="l04770"></a>04770       <span class="keywordflow">break</span>;
<a name="l04771"></a>04771    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a5e78a80b19eee87e834b2f2b699c85f2">STIMULUS_SPEEDDIAL</a>:
<a name="l04772"></a>04772        {
<a name="l04773"></a>04773       <span class="keyword">struct </span><a class="code" href="structskinny__speeddial.html">skinny_speeddial</a> *sd;
<a name="l04774"></a>04774 
<a name="l04775"></a>04775       <span class="keywordflow">if</span> (skinnydebug)
<a name="l04776"></a>04776          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Stimulus: SpeedDial(%d/%d)\n&quot;</span>, instance, callreference);
<a name="l04777"></a>04777       <span class="keywordflow">if</span> (!(sd = <a class="code" href="chan__skinny_8c.html#a0be9e6c1ec02d36ff811d63a5b9ca022">find_speeddial_by_instance</a>(d, instance, 0))) {
<a name="l04778"></a>04778          <span class="keywordflow">return</span> 0;
<a name="l04779"></a>04779       }
<a name="l04780"></a>04780 
<a name="l04781"></a>04781       <span class="keywordflow">if</span> (!sub || !sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)
<a name="l04782"></a>04782          c = <a class="code" href="chan__skinny_8c.html#a7d4cb293426c31e532f15f52fd8183fd">skinny_new</a>(l, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>);
<a name="l04783"></a>04783       <span class="keywordflow">else</span>
<a name="l04784"></a>04784          c = sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l04785"></a>04785 
<a name="l04786"></a>04786       <span class="keywordflow">if</span> (!c) {
<a name="l04787"></a>04787          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create channel for %s@%s\n&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l04788"></a>04788       } <span class="keywordflow">else</span> {
<a name="l04789"></a>04789          sub = c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l04790"></a>04790          l = sub-&gt;parent;
<a name="l04791"></a>04791          l-&gt;<a class="code" href="structskinny__line.html#aedffa4337f76fdcdc808e16affbafd04">activesub</a> = sub;
<a name="l04792"></a>04792          <span class="keywordflow">if</span> (l-&gt;hookstate == <a class="code" href="chan__skinny_8c.html#ad38b06a5edcc17eaa553739944e702e1">SKINNY_ONHOOK</a>) {
<a name="l04793"></a>04793             l-&gt;hookstate = <a class="code" href="chan__skinny_8c.html#a2e10f13253ac5069f50f7f66b9511537">SKINNY_OFFHOOK</a>;
<a name="l04794"></a>04794             <a class="code" href="chan__skinny_8c.html#a9d00b95f44b64f37d738f1ddc2ef972f">transmit_speaker_mode</a>(d, <a class="code" href="chan__skinny_8c.html#a379fd834cea6549831c799ed002b52f7">SKINNY_SPEAKERON</a>);
<a name="l04795"></a>04795             <a class="code" href="chan__skinny_8c.html#a0cb936a217935cdbaa71cc6cb5171b44">transmit_callstate</a>(d, l-&gt;instance, <a class="code" href="chan__skinny_8c.html#a2e10f13253ac5069f50f7f66b9511537">SKINNY_OFFHOOK</a>, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l04796"></a>04796          }
<a name="l04797"></a>04797          <span class="keywordflow">if</span> (skinnydebug)
<a name="l04798"></a>04798             <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Attempting to Clear display on Skinny %s@%s\n&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l04799"></a>04799          <a class="code" href="chan__skinny_8c.html#ad2e667cc9fa19462ea433bac21b74c7b">transmit_displaymessage</a>(d, NULL, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>); <span class="comment">/* clear display */</span>
<a name="l04800"></a>04800          <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, <a class="code" href="chan__skinny_8c.html#a12616ab9d64a36f7c2f372084a3663c8">SKINNY_DIALTONE</a>, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l04801"></a>04801          <a class="code" href="chan__skinny_8c.html#a5364d4b25cac8ec6f4572faf1434383d">transmit_selectsoftkeys</a>(d, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>, <a class="code" href="chan__skinny_8c.html#ae18cb03403da5513c2c6ac0c32c4c939">KEYDEF_RINGOUT</a>);
<a name="l04802"></a>04802 
<a name="l04803"></a>04803          <span class="keywordflow">if</span> (!<a class="code" href="pbx_8h.html#aa73d176ed4f1ce51e5db6beafba45fe3" title="Checks to see if a number should be ignored.">ast_ignore_pattern</a>(c-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, sd-&gt;<a class="code" href="structskinny__speeddial.html#a78d4847658b695383d849efd12399b38">exten</a>)) {
<a name="l04804"></a>04804             <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, <a class="code" href="chan__skinny_8c.html#a2c63c304c5e6eff4a0b13617eb4a9bed">SKINNY_SILENCE</a>, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l04805"></a>04805          }
<a name="l04806"></a>04806          <span class="keywordflow">if</span> (<a class="code" href="pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7" title="Determine whether an extension exists.">ast_exists_extension</a>(c, c-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, sd-&gt;<a class="code" href="structskinny__speeddial.html#a78d4847658b695383d849efd12399b38">exten</a>, 1, l-&gt;cid_num)) {
<a name="l04807"></a>04807             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(c-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, sd-&gt;<a class="code" href="structskinny__speeddial.html#a78d4847658b695383d849efd12399b38">exten</a>, <span class="keyword">sizeof</span>(c-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>));
<a name="l04808"></a>04808             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(l-&gt;lastnumberdialed, sd-&gt;<a class="code" href="structskinny__speeddial.html#a78d4847658b695383d849efd12399b38">exten</a>, <span class="keyword">sizeof</span>(l-&gt;lastnumberdialed));
<a name="l04809"></a>04809 
<a name="l04810"></a>04810             <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a4781fd54a4ca8c7f0f8a32a6cce503c0">ast_pthread_create</a>(&amp;t, NULL, <a class="code" href="chan__skinny_8c.html#a7341024ae1e485aaad445b8d2504b446">skinny_newcall</a>, c)) {
<a name="l04811"></a>04811                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create new call thread: %s\n&quot;</span>, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l04812"></a>04812                <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(c);
<a name="l04813"></a>04813             }
<a name="l04814"></a>04814             <span class="keywordflow">break</span>;
<a name="l04815"></a>04815          }
<a name="l04816"></a>04816       }
<a name="l04817"></a>04817        }
<a name="l04818"></a>04818       <span class="keywordflow">break</span>;
<a name="l04819"></a>04819    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a68441ee5fadb36ee720812ba7f0ee460">STIMULUS_HOLD</a>:
<a name="l04820"></a>04820       <span class="keywordflow">if</span> (skinnydebug)
<a name="l04821"></a>04821          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Stimulus: Hold(%d/%d)\n&quot;</span>, instance, callreference);
<a name="l04822"></a>04822       <a class="code" href="chan__skinny_8c.html#aa9d48518ce398e46ebf39a3eff38c849">handle_hold_button</a>(sub);
<a name="l04823"></a>04823       <span class="keywordflow">break</span>;
<a name="l04824"></a>04824    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#ab3db0778b0a139e240053a7996b4a9e4">STIMULUS_TRANSFER</a>:
<a name="l04825"></a>04825       <span class="keywordflow">if</span> (skinnydebug)
<a name="l04826"></a>04826          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Stimulus: Transfer(%d/%d)\n&quot;</span>, instance, callreference);
<a name="l04827"></a>04827       <span class="keywordflow">if</span> (l-&gt;transfer)
<a name="l04828"></a>04828          <a class="code" href="chan__skinny_8c.html#af725e197a8e1179ddd97a81b592dbb93">handle_transfer_button</a>(sub);
<a name="l04829"></a>04829       <span class="keywordflow">else</span>
<a name="l04830"></a>04830          <a class="code" href="chan__skinny_8c.html#a8122a36b30f8a86ffe3a06548fa8903c">transmit_displaynotify</a>(d, <span class="stringliteral">&quot;Transfer disabled&quot;</span>, 10);
<a name="l04831"></a>04831       <span class="keywordflow">break</span>;
<a name="l04832"></a>04832    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#aef34632dd58c9bb98615297efcc1c964">STIMULUS_CONFERENCE</a>:
<a name="l04833"></a>04833       <span class="keywordflow">if</span> (skinnydebug)
<a name="l04834"></a>04834          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Stimulus: Conference(%d/%d)\n&quot;</span>, instance, callreference);
<a name="l04835"></a>04835       <span class="comment">/* XXX determine the best way to pull off a conference.  Meetme? */</span>
<a name="l04836"></a>04836       <span class="keywordflow">break</span>;
<a name="l04837"></a>04837    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#add30eeef22fe342e5e7e92354ece088e">STIMULUS_VOICEMAIL</a>:
<a name="l04838"></a>04838       <span class="keywordflow">if</span> (skinnydebug)
<a name="l04839"></a>04839          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Stimulus: Voicemail(%d/%d)\n&quot;</span>, instance, callreference);
<a name="l04840"></a>04840 
<a name="l04841"></a>04841       <span class="keywordflow">if</span> (!sub || !sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l04842"></a>04842          c = <a class="code" href="chan__skinny_8c.html#a7d4cb293426c31e532f15f52fd8183fd">skinny_new</a>(l, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>);
<a name="l04843"></a>04843       } <span class="keywordflow">else</span> {
<a name="l04844"></a>04844          c = sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l04845"></a>04845       }
<a name="l04846"></a>04846       <span class="keywordflow">if</span> (!c) {
<a name="l04847"></a>04847          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create channel for %s@%s\n&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l04848"></a>04848       } <span class="keywordflow">else</span> {
<a name="l04849"></a>04849          sub = c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l04850"></a>04850          l = sub-&gt;parent;
<a name="l04851"></a>04851          l-&gt;<a class="code" href="structskinny__line.html#aedffa4337f76fdcdc808e16affbafd04">activesub</a> = sub;
<a name="l04852"></a>04852 
<a name="l04853"></a>04853          <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(l-&gt;vmexten))  <span class="comment">/* Exit the call if no VM pilot */</span>
<a name="l04854"></a>04854             <span class="keywordflow">break</span>;
<a name="l04855"></a>04855 
<a name="l04856"></a>04856          <span class="keywordflow">if</span> (l-&gt;hookstate == <a class="code" href="chan__skinny_8c.html#ad38b06a5edcc17eaa553739944e702e1">SKINNY_ONHOOK</a>){
<a name="l04857"></a>04857             l-&gt;hookstate = <a class="code" href="chan__skinny_8c.html#a2e10f13253ac5069f50f7f66b9511537">SKINNY_OFFHOOK</a>;
<a name="l04858"></a>04858             <a class="code" href="chan__skinny_8c.html#a9d00b95f44b64f37d738f1ddc2ef972f">transmit_speaker_mode</a>(d, <a class="code" href="chan__skinny_8c.html#a379fd834cea6549831c799ed002b52f7">SKINNY_SPEAKERON</a>);
<a name="l04859"></a>04859             <a class="code" href="chan__skinny_8c.html#a0cb936a217935cdbaa71cc6cb5171b44">transmit_callstate</a>(d, l-&gt;instance, <a class="code" href="chan__skinny_8c.html#a2e10f13253ac5069f50f7f66b9511537">SKINNY_OFFHOOK</a>, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l04860"></a>04860          }
<a name="l04861"></a>04861 
<a name="l04862"></a>04862          <span class="keywordflow">if</span> (skinnydebug)
<a name="l04863"></a>04863             <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Attempting to Clear display on Skinny %s@%s\n&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l04864"></a>04864 
<a name="l04865"></a>04865          <a class="code" href="chan__skinny_8c.html#ad2e667cc9fa19462ea433bac21b74c7b">transmit_displaymessage</a>(d, NULL, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>); <span class="comment">/* clear display */</span>
<a name="l04866"></a>04866          <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, <a class="code" href="chan__skinny_8c.html#a12616ab9d64a36f7c2f372084a3663c8">SKINNY_DIALTONE</a>, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l04867"></a>04867          <a class="code" href="chan__skinny_8c.html#a5364d4b25cac8ec6f4572faf1434383d">transmit_selectsoftkeys</a>(d, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>, <a class="code" href="chan__skinny_8c.html#ae18cb03403da5513c2c6ac0c32c4c939">KEYDEF_RINGOUT</a>);
<a name="l04868"></a>04868 
<a name="l04869"></a>04869          <span class="keywordflow">if</span> (!<a class="code" href="pbx_8h.html#aa73d176ed4f1ce51e5db6beafba45fe3" title="Checks to see if a number should be ignored.">ast_ignore_pattern</a>(c-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, l-&gt;vmexten)) {
<a name="l04870"></a>04870             <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, <a class="code" href="chan__skinny_8c.html#a2c63c304c5e6eff4a0b13617eb4a9bed">SKINNY_SILENCE</a>, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l04871"></a>04871          }
<a name="l04872"></a>04872 
<a name="l04873"></a>04873          <span class="keywordflow">if</span> (<a class="code" href="pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7" title="Determine whether an extension exists.">ast_exists_extension</a>(c, c-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, l-&gt;vmexten, 1, l-&gt;cid_num)) {
<a name="l04874"></a>04874             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(c-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, l-&gt;vmexten, <span class="keyword">sizeof</span>(c-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>));
<a name="l04875"></a>04875             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(l-&gt;lastnumberdialed, l-&gt;vmexten, <span class="keyword">sizeof</span>(l-&gt;lastnumberdialed));
<a name="l04876"></a>04876             <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a4781fd54a4ca8c7f0f8a32a6cce503c0">ast_pthread_create</a>(&amp;t, NULL, <a class="code" href="chan__skinny_8c.html#a7341024ae1e485aaad445b8d2504b446">skinny_newcall</a>, c)) {
<a name="l04877"></a>04877                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create new call thread: %s\n&quot;</span>, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l04878"></a>04878                <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(c);
<a name="l04879"></a>04879             }
<a name="l04880"></a>04880             <span class="keywordflow">break</span>;
<a name="l04881"></a>04881          }
<a name="l04882"></a>04882       }
<a name="l04883"></a>04883       <span class="keywordflow">break</span>;
<a name="l04884"></a>04884    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a43375044fa9c80f030190f7f2f507d9b">STIMULUS_CALLPARK</a>:
<a name="l04885"></a>04885       {
<a name="l04886"></a>04886       <span class="keywordtype">int</span> extout;
<a name="l04887"></a>04887       <span class="keywordtype">char</span> <a class="code" href="structmessage.html">message</a>[32];
<a name="l04888"></a>04888 
<a name="l04889"></a>04889       <span class="keywordflow">if</span> (skinnydebug)
<a name="l04890"></a>04890          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Stimulus: Park Call(%d/%d)\n&quot;</span>, instance, callreference);
<a name="l04891"></a>04891 
<a name="l04892"></a>04892       <span class="keywordflow">if</span> ((sub &amp;&amp; sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) &amp;&amp; (sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> ==  <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>)){
<a name="l04893"></a>04893          c = sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l04894"></a>04894          <span class="keywordflow">if</span> (!<a class="code" href="features_8h.html#a70a2de2bf789996ae5e66142294ca18f" title="Park a call via a masqueraded channel.">ast_masq_park_call</a>(<a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(c), c, 0, &amp;extout)) {
<a name="l04895"></a>04895             snprintf(message, <span class="keyword">sizeof</span>(message), <span class="stringliteral">&quot;Call Parked at: %d&quot;</span>, extout);
<a name="l04896"></a>04896             <a class="code" href="chan__skinny_8c.html#a8122a36b30f8a86ffe3a06548fa8903c">transmit_displaynotify</a>(d, message, 10);
<a name="l04897"></a>04897          } <span class="keywordflow">else</span> {
<a name="l04898"></a>04898             <a class="code" href="chan__skinny_8c.html#a8122a36b30f8a86ffe3a06548fa8903c">transmit_displaynotify</a>(d, <span class="stringliteral">&quot;Call Park failed&quot;</span>, 10);
<a name="l04899"></a>04899          }
<a name="l04900"></a>04900       } <span class="keywordflow">else</span> {
<a name="l04901"></a>04901          <a class="code" href="chan__skinny_8c.html#a8122a36b30f8a86ffe3a06548fa8903c">transmit_displaynotify</a>(d, <span class="stringliteral">&quot;Call Park not available&quot;</span>, 10);
<a name="l04902"></a>04902       }
<a name="l04903"></a>04903       }
<a name="l04904"></a>04904       <span class="keywordflow">break</span>;
<a name="l04905"></a>04905    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a01245cf7008ec6fc7a898f2add35d1bd">STIMULUS_DND</a>:
<a name="l04906"></a>04906       <span class="keywordflow">if</span> (skinnydebug)
<a name="l04907"></a>04907          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Stimulus: DND (%d/%d)\n&quot;</span>, instance, callreference);
<a name="l04908"></a>04908 
<a name="l04909"></a>04909       <span class="comment">/* Do not disturb */</span>
<a name="l04910"></a>04910       <span class="keywordflow">if</span> (l-&gt;dnd != 0){
<a name="l04911"></a>04911          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Disabling DND on %s@%s\n&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l04912"></a>04912          l-&gt;dnd = 0;
<a name="l04913"></a>04913          <a class="code" href="chan__skinny_8c.html#aa16aabd900fdb4bd057303387115959f">transmit_lamp_indication</a>(d, <a class="code" href="chan__skinny_8c.html#a01245cf7008ec6fc7a898f2add35d1bd">STIMULUS_DND</a>, 1, <a class="code" href="chan__skinny_8c.html#a360e677a1a8e92ab455b8c354a15d969">SKINNY_LAMP_ON</a>);
<a name="l04914"></a>04914          <a class="code" href="chan__skinny_8c.html#a8122a36b30f8a86ffe3a06548fa8903c">transmit_displaynotify</a>(d, <span class="stringliteral">&quot;DnD disabled&quot;</span>, 10);
<a name="l04915"></a>04915       } <span class="keywordflow">else</span> {
<a name="l04916"></a>04916          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Enabling DND on %s@%s\n&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l04917"></a>04917          l-&gt;dnd = 1;
<a name="l04918"></a>04918          <a class="code" href="chan__skinny_8c.html#aa16aabd900fdb4bd057303387115959f">transmit_lamp_indication</a>(d, <a class="code" href="chan__skinny_8c.html#a01245cf7008ec6fc7a898f2add35d1bd">STIMULUS_DND</a>, 1, <a class="code" href="chan__skinny_8c.html#a87243536bbb96a314e88cfadd810f639">SKINNY_LAMP_OFF</a>);
<a name="l04919"></a>04919          <a class="code" href="chan__skinny_8c.html#a8122a36b30f8a86ffe3a06548fa8903c">transmit_displaynotify</a>(d, <span class="stringliteral">&quot;DnD enabled&quot;</span>, 10);
<a name="l04920"></a>04920       }
<a name="l04921"></a>04921       <span class="keywordflow">break</span>;
<a name="l04922"></a>04922    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#af3ac1b0d1c42719b924361fb782507e5">STIMULUS_FORWARDALL</a>:
<a name="l04923"></a>04923       <span class="keywordflow">if</span> (skinnydebug)
<a name="l04924"></a>04924          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Stimulus: Forward All(%d/%d)\n&quot;</span>, instance, callreference);
<a name="l04925"></a>04925 
<a name="l04926"></a>04926       <span class="keywordflow">if</span> (!sub || !sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l04927"></a>04927          c = <a class="code" href="chan__skinny_8c.html#a7d4cb293426c31e532f15f52fd8183fd">skinny_new</a>(l, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>);
<a name="l04928"></a>04928       } <span class="keywordflow">else</span> {
<a name="l04929"></a>04929          c = sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l04930"></a>04930       }
<a name="l04931"></a>04931 
<a name="l04932"></a>04932       <span class="keywordflow">if</span> (!c) {
<a name="l04933"></a>04933          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create channel for %s@%s\n&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l04934"></a>04934       } <span class="keywordflow">else</span> {
<a name="l04935"></a>04935          sub = c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l04936"></a>04936          <a class="code" href="chan__skinny_8c.html#a82c88f8bbff9fac239c78d797a181343">handle_callforward_button</a>(sub, <a class="code" href="chan__skinny_8c.html#a1a77767cd4cfc70d096da50a2fefecd7">SKINNY_CFWD_ALL</a>);
<a name="l04937"></a>04937       }
<a name="l04938"></a>04938       <span class="keywordflow">break</span>;
<a name="l04939"></a>04939    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#aa9a56439f327c8e4795abdd03bfeca10">STIMULUS_FORWARDBUSY</a>:
<a name="l04940"></a>04940       <span class="keywordflow">if</span> (skinnydebug)
<a name="l04941"></a>04941          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Stimulus: Forward Busy (%d/%d)\n&quot;</span>, instance, callreference);
<a name="l04942"></a>04942 
<a name="l04943"></a>04943       <span class="keywordflow">if</span> (!sub || !sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l04944"></a>04944          c = <a class="code" href="chan__skinny_8c.html#a7d4cb293426c31e532f15f52fd8183fd">skinny_new</a>(l, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>);
<a name="l04945"></a>04945       } <span class="keywordflow">else</span> {
<a name="l04946"></a>04946          c = sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l04947"></a>04947       }
<a name="l04948"></a>04948 
<a name="l04949"></a>04949       <span class="keywordflow">if</span> (!c) {
<a name="l04950"></a>04950          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create channel for %s@%s\n&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l04951"></a>04951       } <span class="keywordflow">else</span> {
<a name="l04952"></a>04952          sub = c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l04953"></a>04953          <a class="code" href="chan__skinny_8c.html#a82c88f8bbff9fac239c78d797a181343">handle_callforward_button</a>(sub, <a class="code" href="chan__skinny_8c.html#a6cd59fd0c6c79219d38f437a485ce844">SKINNY_CFWD_BUSY</a>);
<a name="l04954"></a>04954       }
<a name="l04955"></a>04955       <span class="keywordflow">break</span>;
<a name="l04956"></a>04956    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#acbcce2f0a7ce5f5734548811ba160923">STIMULUS_FORWARDNOANSWER</a>:
<a name="l04957"></a>04957       <span class="keywordflow">if</span> (skinnydebug)
<a name="l04958"></a>04958          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Stimulus: Forward No Answer (%d/%d)\n&quot;</span>, instance, callreference);
<a name="l04959"></a>04959 
<a name="l04960"></a>04960 <span class="preprocessor">#if 0 </span><span class="comment">/* Not sure how to handle this yet */</span>
<a name="l04961"></a>04961       <span class="keywordflow">if</span> (!sub || !sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l04962"></a>04962          c = <a class="code" href="chan__skinny_8c.html#a7d4cb293426c31e532f15f52fd8183fd">skinny_new</a>(l, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>);
<a name="l04963"></a>04963       } <span class="keywordflow">else</span> {
<a name="l04964"></a>04964          c = sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l04965"></a>04965       }
<a name="l04966"></a>04966 
<a name="l04967"></a>04967       <span class="keywordflow">if</span> (!c) {
<a name="l04968"></a>04968          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create channel for %s@%s\n&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l04969"></a>04969       } <span class="keywordflow">else</span> {
<a name="l04970"></a>04970          sub = c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l04971"></a>04971          <a class="code" href="chan__skinny_8c.html#a82c88f8bbff9fac239c78d797a181343">handle_callforward_button</a>(sub, <a class="code" href="chan__skinny_8c.html#a805d890f6df0e6cf5d9f281791d2a318">SKINNY_CFWD_NOANSWER</a>);
<a name="l04972"></a>04972       }
<a name="l04973"></a>04973 <span class="preprocessor">#endif</span>
<a name="l04974"></a>04974 <span class="preprocessor"></span>      <span class="keywordflow">break</span>;
<a name="l04975"></a>04975    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#aac6715ad310106017794df7beecb0b7e">STIMULUS_DISPLAY</a>:
<a name="l04976"></a>04976       <span class="comment">/* Not sure what this is */</span>
<a name="l04977"></a>04977       <span class="keywordflow">if</span> (skinnydebug)
<a name="l04978"></a>04978          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Stimulus: Display(%d/%d)\n&quot;</span>, instance, callreference);
<a name="l04979"></a>04979       <span class="keywordflow">break</span>;
<a name="l04980"></a>04980    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#af5c47ae0f0932f1d461f5b7b4cc0b095">STIMULUS_LINE</a>:
<a name="l04981"></a>04981       <span class="keywordflow">if</span> (skinnydebug)
<a name="l04982"></a>04982          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Stimulus: Line(%d/%d)\n&quot;</span>, instance, callreference);
<a name="l04983"></a>04983 
<a name="l04984"></a>04984       l = <a class="code" href="chan__skinny_8c.html#a7b9ecaa4bb1481a9a5666e91c88a3968">find_line_by_instance</a>(d, instance);
<a name="l04985"></a>04985 
<a name="l04986"></a>04986       <span class="keywordflow">if</span> (!l) {
<a name="l04987"></a>04987          <span class="keywordflow">return</span> 0;
<a name="l04988"></a>04988       }
<a name="l04989"></a>04989 
<a name="l04990"></a>04990       d-&gt;<a class="code" href="structskinny__device.html#a70da1427655ecdaa64e57324e51f440b">activeline</a> = l;
<a name="l04991"></a>04991 
<a name="l04992"></a>04992       <span class="comment">/* turn the speaker on */</span>
<a name="l04993"></a>04993       <a class="code" href="chan__skinny_8c.html#a9d00b95f44b64f37d738f1ddc2ef972f">transmit_speaker_mode</a>(d, <a class="code" href="chan__skinny_8c.html#a379fd834cea6549831c799ed002b52f7">SKINNY_SPEAKERON</a>);
<a name="l04994"></a>04994       <a class="code" href="chan__skinny_8c.html#a4f65a9ef12827334502722b4cd8919c6">transmit_ringer_mode</a>(d, <a class="code" href="chan__skinny_8c.html#aecd793ced0012f548eaf003e4609e994">SKINNY_RING_OFF</a>);
<a name="l04995"></a>04995       <a class="code" href="chan__skinny_8c.html#aa16aabd900fdb4bd057303387115959f">transmit_lamp_indication</a>(d, <a class="code" href="chan__skinny_8c.html#af5c47ae0f0932f1d461f5b7b4cc0b095">STIMULUS_LINE</a>, l-&gt;instance, <a class="code" href="chan__skinny_8c.html#a360e677a1a8e92ab455b8c354a15d969">SKINNY_LAMP_ON</a>);
<a name="l04996"></a>04996 
<a name="l04997"></a>04997       l-&gt;hookstate = <a class="code" href="chan__skinny_8c.html#a2e10f13253ac5069f50f7f66b9511537">SKINNY_OFFHOOK</a>;
<a name="l04998"></a>04998 
<a name="l04999"></a>04999       <span class="keywordflow">if</span> (sub &amp;&amp; sub-&gt;<a class="code" href="structskinny__subchannel.html#a586fc7c710ade15aabab8f223e53fdd9">outgoing</a>) {
<a name="l05000"></a>05000          <span class="comment">/* We&apos;re answering a ringing call */</span>
<a name="l05001"></a>05001          <a class="code" href="channel_8h.html#a60f9d2b0ab8b7a839902313321163b28" title="Queue a control frame with payload.">ast_queue_control</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>);
<a name="l05002"></a>05002          <a class="code" href="chan__skinny_8c.html#a0cb936a217935cdbaa71cc6cb5171b44">transmit_callstate</a>(d, l-&gt;instance, <a class="code" href="chan__skinny_8c.html#a2e10f13253ac5069f50f7f66b9511537">SKINNY_OFFHOOK</a>, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l05003"></a>05003          <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, <a class="code" href="chan__skinny_8c.html#a2c63c304c5e6eff4a0b13617eb4a9bed">SKINNY_SILENCE</a>, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l05004"></a>05004          <a class="code" href="chan__skinny_8c.html#a891052a3d2334a56e4b5df01988ad8fb">transmit_callstateonly</a>(d, sub, <a class="code" href="chan__skinny_8c.html#a1b0b13fd37b0eec0ebbc6031c91d4662">SKINNY_CONNECTED</a>);
<a name="l05005"></a>05005          <a class="code" href="chan__skinny_8c.html#a2c3127d93ed4f2dac8c6526a8b0ebd7d">transmit_displaypromptstatus</a>(d, <span class="stringliteral">&quot;Connected&quot;</span>, 0, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l05006"></a>05006          <a class="code" href="chan__skinny_8c.html#a5364d4b25cac8ec6f4572faf1434383d">transmit_selectsoftkeys</a>(d, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>, <a class="code" href="chan__skinny_8c.html#aad5f46f88fa82da05103795046e110b7">KEYDEF_CONNECTED</a>);
<a name="l05007"></a>05007          <a class="code" href="chan__skinny_8c.html#afdd465471ea50755ff86f47ead660ea0">start_rtp</a>(sub);
<a name="l05008"></a>05008          <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>);
<a name="l05009"></a>05009       } <span class="keywordflow">else</span> {
<a name="l05010"></a>05010          <span class="keywordflow">if</span> (sub &amp;&amp; sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l05011"></a>05011             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Current subchannel [%s] already has owner\n&quot;</span>, sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name);
<a name="l05012"></a>05012          } <span class="keywordflow">else</span> {
<a name="l05013"></a>05013             c = <a class="code" href="chan__skinny_8c.html#a7d4cb293426c31e532f15f52fd8183fd">skinny_new</a>(l, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>);
<a name="l05014"></a>05014             <span class="keywordflow">if</span> (c) {
<a name="l05015"></a>05015                sub = c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l05016"></a>05016                l-&gt;<a class="code" href="structskinny__line.html#aedffa4337f76fdcdc808e16affbafd04">activesub</a> = sub;
<a name="l05017"></a>05017                <a class="code" href="chan__skinny_8c.html#a0cb936a217935cdbaa71cc6cb5171b44">transmit_callstate</a>(d, l-&gt;instance, <a class="code" href="chan__skinny_8c.html#a2e10f13253ac5069f50f7f66b9511537">SKINNY_OFFHOOK</a>, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l05018"></a>05018                <span class="keywordflow">if</span> (skinnydebug)
<a name="l05019"></a>05019                   <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Attempting to Clear display on Skinny %s@%s\n&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l05020"></a>05020                <a class="code" href="chan__skinny_8c.html#ad2e667cc9fa19462ea433bac21b74c7b">transmit_displaymessage</a>(d, NULL, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>); <span class="comment">/* clear display */</span>
<a name="l05021"></a>05021                <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, <a class="code" href="chan__skinny_8c.html#a12616ab9d64a36f7c2f372084a3663c8">SKINNY_DIALTONE</a>, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l05022"></a>05022                <a class="code" href="chan__skinny_8c.html#a5364d4b25cac8ec6f4572faf1434383d">transmit_selectsoftkeys</a>(d, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>, <a class="code" href="chan__skinny_8c.html#a32b4dedb91edf80328d5cda72166bf6e">KEYDEF_OFFHOOK</a>);
<a name="l05023"></a>05023 
<a name="l05024"></a>05024                <span class="comment">/* start the switch thread */</span>
<a name="l05025"></a>05025                <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a4781fd54a4ca8c7f0f8a32a6cce503c0">ast_pthread_create</a>(&amp;t, NULL, <a class="code" href="chan__skinny_8c.html#ad5d83012c464b49bfde0406a3dff68fe">skinny_ss</a>, c)) {
<a name="l05026"></a>05026                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create switch thread: %s\n&quot;</span>, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l05027"></a>05027                   <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(c);
<a name="l05028"></a>05028                }
<a name="l05029"></a>05029             } <span class="keywordflow">else</span> {
<a name="l05030"></a>05030                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create channel for %s@%s\n&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l05031"></a>05031             }
<a name="l05032"></a>05032          }
<a name="l05033"></a>05033       }
<a name="l05034"></a>05034       <span class="keywordflow">break</span>;
<a name="l05035"></a>05035    <span class="keywordflow">default</span>:
<a name="l05036"></a>05036       <span class="keywordflow">if</span> (skinnydebug)
<a name="l05037"></a>05037          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;RECEIVED UNKNOWN STIMULUS:  %d(%d/%d)\n&quot;</span>, event, instance, callreference);
<a name="l05038"></a>05038       <span class="keywordflow">break</span>;
<a name="l05039"></a>05039    }
<a name="l05040"></a>05040    <a class="code" href="devicestate_8h.html#ac91fd8b93a2095c18ab86bd61c19ae46" title="Tells Asterisk the State for Device is changed.">ast_devstate_changed</a>(<a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a">AST_DEVICE_UNKNOWN</a>, <span class="stringliteral">&quot;Skinny/%s@%s&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l05041"></a>05041 
<a name="l05042"></a>05042    <span class="keywordflow">return</span> 1;
<a name="l05043"></a>05043 }
<a name="l05044"></a>05044 
<a name="l05045"></a><a class="code" href="chan__skinny_8c.html#a1186bffbea3bd1b7ff2af6a9ac9f6c7a">05045</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a1186bffbea3bd1b7ff2af6a9ac9f6c7a">handle_offhook_message</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__req.html">skinny_req</a> *req, <span class="keyword">struct</span> <a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l05046"></a>05046 {
<a name="l05047"></a>05047    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d = s-&gt;<a class="code" href="structskinnysession.html#a70701ca9c2641bcb1740286273a0473a">device</a>;
<a name="l05048"></a>05048    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l;
<a name="l05049"></a>05049    <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub;
<a name="l05050"></a>05050    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c;
<a name="l05051"></a>05051    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *tmp;
<a name="l05052"></a>05052    pthread_t t;
<a name="l05053"></a>05053    <span class="keywordtype">int</span> instance;
<a name="l05054"></a>05054    <span class="keywordtype">int</span> reference;
<a name="l05055"></a>05055 
<a name="l05056"></a>05056    <span class="comment">/* if any line on a device is offhook, than the device must be offhook, </span>
<a name="l05057"></a>05057 <span class="comment">      unless we have shared lines CCM seems that it would never get here, </span>
<a name="l05058"></a>05058 <span class="comment">      but asterisk does, so we may need to do more work.  Ugly, we should </span>
<a name="l05059"></a>05059 <span class="comment">      probably move hookstate from line to device, afterall, it&apos;s actually</span>
<a name="l05060"></a>05060 <span class="comment">       a device that changes hookstates */</span>
<a name="l05061"></a>05061 
<a name="l05062"></a>05062    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;lines, tmp, list) {
<a name="l05063"></a>05063       <span class="keywordflow">if</span> (tmp-&gt;hookstate == <a class="code" href="chan__skinny_8c.html#a2e10f13253ac5069f50f7f66b9511537">SKINNY_OFFHOOK</a>) {
<a name="l05064"></a>05064          <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<a class="code" href="logger_8h.html#a24b0f46e22f4ea3226fa082e955dd4ef">VERBOSE_PREFIX_3</a> <span class="stringliteral">&quot;Got offhook message when device (%s@%s) already offhook\n&quot;</span>, tmp-&gt;name, d-&gt;name);
<a name="l05065"></a>05065          <span class="keywordflow">return</span> 0;
<a name="l05066"></a>05066       }
<a name="l05067"></a>05067    }
<a name="l05068"></a>05068 
<a name="l05069"></a>05069    instance = <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a29a4718641ccff30ca7b21d7710c8bd3">offhook</a>.<a class="code" href="structoffhook__message.html#a9ed36c4f5392e9f1819ec7c9eb9aff80">instance</a>);
<a name="l05070"></a>05070    reference = <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a29a4718641ccff30ca7b21d7710c8bd3">offhook</a>.<a class="code" href="structoffhook__message.html#aa68938e371fea91ad4b64381877bd381">reference</a>);
<a name="l05071"></a>05071 
<a name="l05072"></a>05072    <span class="keywordflow">if</span> (instance) {
<a name="l05073"></a>05073       sub = <a class="code" href="chan__skinny_8c.html#a10c715ff96a500b77ddc4442fa17cf55">find_subchannel_by_instance_reference</a>(d, d-&gt;lastlineinstance, d-&gt;lastcallreference);
<a name="l05074"></a>05074       <span class="keywordflow">if</span> (!sub) {
<a name="l05075"></a>05075          l = <a class="code" href="chan__skinny_8c.html#a7b9ecaa4bb1481a9a5666e91c88a3968">find_line_by_instance</a>(d, d-&gt;lastlineinstance);
<a name="l05076"></a>05076          <span class="keywordflow">if</span> (!l) {
<a name="l05077"></a>05077             <span class="keywordflow">return</span> 0;
<a name="l05078"></a>05078          }
<a name="l05079"></a>05079       } <span class="keywordflow">else</span> {
<a name="l05080"></a>05080          l = sub-&gt;parent;
<a name="l05081"></a>05081       }
<a name="l05082"></a>05082    } <span class="keywordflow">else</span> {
<a name="l05083"></a>05083       l = d-&gt;<a class="code" href="structskinny__device.html#a70da1427655ecdaa64e57324e51f440b">activeline</a>;
<a name="l05084"></a>05084       sub = l-&gt;<a class="code" href="structskinny__line.html#aedffa4337f76fdcdc808e16affbafd04">activesub</a>;
<a name="l05085"></a>05085    }
<a name="l05086"></a>05086 
<a name="l05087"></a>05087    <a class="code" href="chan__skinny_8c.html#a4f65a9ef12827334502722b4cd8919c6">transmit_ringer_mode</a>(d, <a class="code" href="chan__skinny_8c.html#aecd793ced0012f548eaf003e4609e994">SKINNY_RING_OFF</a>);
<a name="l05088"></a>05088    l-&gt;hookstate = <a class="code" href="chan__skinny_8c.html#a2e10f13253ac5069f50f7f66b9511537">SKINNY_OFFHOOK</a>;
<a name="l05089"></a>05089 
<a name="l05090"></a>05090    <a class="code" href="devicestate_8h.html#ac91fd8b93a2095c18ab86bd61c19ae46" title="Tells Asterisk the State for Device is changed.">ast_devstate_changed</a>(<a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea23aa227468c09b5ebd0fb01b4c895190">AST_DEVICE_INUSE</a>, <span class="stringliteral">&quot;Skinny/%s@%s&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l05091"></a>05091 
<a name="l05092"></a>05092    <span class="keywordflow">if</span> (sub &amp;&amp; sub-&gt;<a class="code" href="structskinny__subchannel.html#a46585eaf56ac8588fa673c1c089f0238">onhold</a>) {
<a name="l05093"></a>05093       <span class="keywordflow">return</span> 1;
<a name="l05094"></a>05094    }
<a name="l05095"></a>05095 
<a name="l05096"></a>05096    <a class="code" href="chan__skinny_8c.html#aa16aabd900fdb4bd057303387115959f">transmit_lamp_indication</a>(d, <a class="code" href="chan__skinny_8c.html#af5c47ae0f0932f1d461f5b7b4cc0b095">STIMULUS_LINE</a>, l-&gt;instance, <a class="code" href="chan__skinny_8c.html#a360e677a1a8e92ab455b8c354a15d969">SKINNY_LAMP_ON</a>);
<a name="l05097"></a>05097 
<a name="l05098"></a>05098    <span class="keywordflow">if</span> (sub &amp;&amp; sub-&gt;<a class="code" href="structskinny__subchannel.html#a586fc7c710ade15aabab8f223e53fdd9">outgoing</a>) {
<a name="l05099"></a>05099       <span class="comment">/* We&apos;re answering a ringing call */</span>
<a name="l05100"></a>05100       <a class="code" href="channel_8h.html#a60f9d2b0ab8b7a839902313321163b28" title="Queue a control frame with payload.">ast_queue_control</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>);
<a name="l05101"></a>05101       <a class="code" href="chan__skinny_8c.html#a0cb936a217935cdbaa71cc6cb5171b44">transmit_callstate</a>(d, l-&gt;instance, <a class="code" href="chan__skinny_8c.html#a2e10f13253ac5069f50f7f66b9511537">SKINNY_OFFHOOK</a>, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l05102"></a>05102       <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, <a class="code" href="chan__skinny_8c.html#a2c63c304c5e6eff4a0b13617eb4a9bed">SKINNY_SILENCE</a>, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l05103"></a>05103       <a class="code" href="chan__skinny_8c.html#a891052a3d2334a56e4b5df01988ad8fb">transmit_callstateonly</a>(d, sub, <a class="code" href="chan__skinny_8c.html#a1b0b13fd37b0eec0ebbc6031c91d4662">SKINNY_CONNECTED</a>);
<a name="l05104"></a>05104       <a class="code" href="chan__skinny_8c.html#a5364d4b25cac8ec6f4572faf1434383d">transmit_selectsoftkeys</a>(d, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>, <a class="code" href="chan__skinny_8c.html#aad5f46f88fa82da05103795046e110b7">KEYDEF_CONNECTED</a>);
<a name="l05105"></a>05105       <a class="code" href="chan__skinny_8c.html#afdd465471ea50755ff86f47ead660ea0">start_rtp</a>(sub);
<a name="l05106"></a>05106       <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>);
<a name="l05107"></a>05107    } <span class="keywordflow">else</span> {
<a name="l05108"></a>05108       <span class="keywordflow">if</span> (sub &amp;&amp; sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l05109"></a>05109          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Current sub [%s] already has owner\n&quot;</span>, sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name);
<a name="l05110"></a>05110       } <span class="keywordflow">else</span> {
<a name="l05111"></a>05111          c = <a class="code" href="chan__skinny_8c.html#a7d4cb293426c31e532f15f52fd8183fd">skinny_new</a>(l, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>);
<a name="l05112"></a>05112          <span class="keywordflow">if</span> (c) {
<a name="l05113"></a>05113             sub = c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l05114"></a>05114             l-&gt;<a class="code" href="structskinny__line.html#aedffa4337f76fdcdc808e16affbafd04">activesub</a> = sub;
<a name="l05115"></a>05115             <a class="code" href="chan__skinny_8c.html#a0cb936a217935cdbaa71cc6cb5171b44">transmit_callstate</a>(d, l-&gt;instance, <a class="code" href="chan__skinny_8c.html#a2e10f13253ac5069f50f7f66b9511537">SKINNY_OFFHOOK</a>, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l05116"></a>05116             <span class="keywordflow">if</span> (skinnydebug)
<a name="l05117"></a>05117                <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Attempting to Clear display on Skinny %s@%s\n&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l05118"></a>05118             <a class="code" href="chan__skinny_8c.html#ad2e667cc9fa19462ea433bac21b74c7b">transmit_displaymessage</a>(d, NULL, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>); <span class="comment">/* clear display */</span>
<a name="l05119"></a>05119             <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, <a class="code" href="chan__skinny_8c.html#a12616ab9d64a36f7c2f372084a3663c8">SKINNY_DIALTONE</a>, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l05120"></a>05120             <a class="code" href="chan__skinny_8c.html#a5364d4b25cac8ec6f4572faf1434383d">transmit_selectsoftkeys</a>(d, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>, <a class="code" href="chan__skinny_8c.html#a32b4dedb91edf80328d5cda72166bf6e">KEYDEF_OFFHOOK</a>);
<a name="l05121"></a>05121 
<a name="l05122"></a>05122             <span class="comment">/* start the switch thread */</span>
<a name="l05123"></a>05123             <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a4781fd54a4ca8c7f0f8a32a6cce503c0">ast_pthread_create</a>(&amp;t, NULL, <a class="code" href="chan__skinny_8c.html#ad5d83012c464b49bfde0406a3dff68fe">skinny_ss</a>, c)) {
<a name="l05124"></a>05124                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create switch thread: %s\n&quot;</span>, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l05125"></a>05125                <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(c);
<a name="l05126"></a>05126             }
<a name="l05127"></a>05127          } <span class="keywordflow">else</span> {
<a name="l05128"></a>05128             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create channel for %s@%s\n&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l05129"></a>05129          }
<a name="l05130"></a>05130       }
<a name="l05131"></a>05131    }
<a name="l05132"></a>05132    <span class="keywordflow">return</span> 1;
<a name="l05133"></a>05133 }
<a name="l05134"></a>05134 
<a name="l05135"></a><a class="code" href="chan__skinny_8c.html#a168480819789a822d423c3fd6387a493">05135</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a168480819789a822d423c3fd6387a493">handle_onhook_message</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__req.html">skinny_req</a> *req, <span class="keyword">struct</span> <a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l05136"></a>05136 {
<a name="l05137"></a>05137    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d = s-&gt;<a class="code" href="structskinnysession.html#a70701ca9c2641bcb1740286273a0473a">device</a>;
<a name="l05138"></a>05138    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l;
<a name="l05139"></a>05139    <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub;
<a name="l05140"></a>05140    <span class="keywordtype">int</span> instance;
<a name="l05141"></a>05141    <span class="keywordtype">int</span> reference;
<a name="l05142"></a>05142    <span class="keywordtype">int</span> onlysub = 0;
<a name="l05143"></a>05143 
<a name="l05144"></a>05144    instance = <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a1351994edcbe98ad38854153208d91d0">onhook</a>.<a class="code" href="structonhook__message.html#a9ed36c4f5392e9f1819ec7c9eb9aff80">instance</a>);
<a name="l05145"></a>05145    reference = <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a1351994edcbe98ad38854153208d91d0">onhook</a>.<a class="code" href="structonhook__message.html#aa68938e371fea91ad4b64381877bd381">reference</a>);
<a name="l05146"></a>05146 
<a name="l05147"></a>05147    <span class="keywordflow">if</span> (instance &amp;&amp; reference) {
<a name="l05148"></a>05148       sub = <a class="code" href="chan__skinny_8c.html#a10c715ff96a500b77ddc4442fa17cf55">find_subchannel_by_instance_reference</a>(d, instance, reference);
<a name="l05149"></a>05149       <span class="keywordflow">if</span> (!sub) {
<a name="l05150"></a>05150          <span class="keywordflow">return</span> 0;
<a name="l05151"></a>05151       }
<a name="l05152"></a>05152       l = sub-&gt;parent;
<a name="l05153"></a>05153    } <span class="keywordflow">else</span> {
<a name="l05154"></a>05154       l = d-&gt;<a class="code" href="structskinny__device.html#a70da1427655ecdaa64e57324e51f440b">activeline</a>;
<a name="l05155"></a>05155       sub = l-&gt;<a class="code" href="structskinny__line.html#aedffa4337f76fdcdc808e16affbafd04">activesub</a>;
<a name="l05156"></a>05156       <span class="keywordflow">if</span> (!sub) {
<a name="l05157"></a>05157          <span class="keywordflow">return</span> 0;
<a name="l05158"></a>05158       }
<a name="l05159"></a>05159    }
<a name="l05160"></a>05160 
<a name="l05161"></a>05161    <span class="keywordflow">if</span> (l-&gt;hookstate == <a class="code" href="chan__skinny_8c.html#ad38b06a5edcc17eaa553739944e702e1">SKINNY_ONHOOK</a>) {
<a name="l05162"></a>05162       <span class="comment">/* Something else already put us back on hook */</span>
<a name="l05163"></a>05163       <span class="keywordflow">return</span> 0;
<a name="l05164"></a>05164    }
<a name="l05165"></a>05165 
<a name="l05166"></a>05166    <a class="code" href="devicestate_8h.html#ac91fd8b93a2095c18ab86bd61c19ae46" title="Tells Asterisk the State for Device is changed.">ast_devstate_changed</a>(<a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeadee91fc4886ffc7b4efb8459cef48fe2">AST_DEVICE_NOT_INUSE</a>, <span class="stringliteral">&quot;Skinny/%s@%s&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l05167"></a>05167 
<a name="l05168"></a>05168    <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#a46585eaf56ac8588fa673c1c089f0238">onhold</a>) {
<a name="l05169"></a>05169       <span class="keywordflow">return</span> 0;
<a name="l05170"></a>05170    }
<a name="l05171"></a>05171 
<a name="l05172"></a>05172    <span class="keywordflow">if</span> (!<a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(sub, list)) {
<a name="l05173"></a>05173       onlysub = 1;
<a name="l05174"></a>05174    } <span class="keywordflow">else</span> {
<a name="l05175"></a>05175       <a class="code" href="linkedlists_8h.html#aa36e72b77f1b80881cd0a9fcca66ce19" title="Removes a specific entry from a list.">AST_LIST_REMOVE</a>(&amp;l-&gt;sub, sub, list);
<a name="l05176"></a>05176    }
<a name="l05177"></a>05177 
<a name="l05178"></a>05178    sub-&gt;<a class="code" href="structskinny__subchannel.html#a4650e5e1429f8982af64b9c42c8c53d3">cxmode</a> = <a class="code" href="chan__skinny_8c.html#a7300c46280f93b446c8e13b404f55e36">SKINNY_CX_RECVONLY</a>;
<a name="l05179"></a>05179    <span class="keywordflow">if</span> (onlysub || sub-&gt;<a class="code" href="structskinny__subchannel.html#a04f1e042676be8f4763d8d5a9000b1e5">xferor</a>){  <span class="comment">/* is this the only call to this device? */</span>
<a name="l05180"></a>05180       l-&gt;hookstate = <a class="code" href="chan__skinny_8c.html#ad38b06a5edcc17eaa553739944e702e1">SKINNY_ONHOOK</a>;
<a name="l05181"></a>05181       <span class="keywordflow">if</span> (skinnydebug)
<a name="l05182"></a>05182          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Skinny %s@%s-%d went on hook\n&quot;</span>, l-&gt;name, d-&gt;name, reference);
<a name="l05183"></a>05183    }
<a name="l05184"></a>05184 
<a name="l05185"></a>05185    <a class="code" href="chan__skinny_8c.html#a0cb936a217935cdbaa71cc6cb5171b44">transmit_callstate</a>(d, l-&gt;instance, l-&gt;hookstate, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l05186"></a>05186    <span class="keywordflow">if</span> (l-&gt;transfer &amp;&amp; sub-&gt;<a class="code" href="structskinny__subchannel.html#a04f1e042676be8f4763d8d5a9000b1e5">xferor</a> &amp;&amp; sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> &gt;= <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>) {
<a name="l05187"></a>05187       <span class="comment">/* We&apos;re allowed to transfer, we have two active calls and</span>
<a name="l05188"></a>05188 <span class="comment">         we made at least one of the calls.  Let&apos;s try and transfer */</span>
<a name="l05189"></a>05189       <a class="code" href="chan__skinny_8c.html#af725e197a8e1179ddd97a81b592dbb93">handle_transfer_button</a>(sub);
<a name="l05190"></a>05190    } <span class="keywordflow">else</span> {
<a name="l05191"></a>05191       <span class="comment">/* Hangup the current call */</span>
<a name="l05192"></a>05192       <span class="comment">/* If there is another active call, skinny_hangup will ring the phone with the other call */</span>
<a name="l05193"></a>05193       <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#a04f1e042676be8f4763d8d5a9000b1e5">xferor</a> &amp;&amp; sub-&gt;related){
<a name="l05194"></a>05194          sub-&gt;related-&gt;related = NULL;
<a name="l05195"></a>05195          sub-&gt;related-&gt;<a class="code" href="structskinny__subchannel.html#a9d49074e0655a086adb6bcc670b06f23">blindxfer</a> = 0;
<a name="l05196"></a>05196       }
<a name="l05197"></a>05197 
<a name="l05198"></a>05198       <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l05199"></a>05199          sub-&gt;<a class="code" href="structskinny__subchannel.html#ac43993a73742eff145b861107a1afa0d">alreadygone</a> = 1;
<a name="l05200"></a>05200          <a class="code" href="channel_8h.html#a30bcf0418189567bc84ff32034f79f28" title="Queue a hangup frame.">ast_queue_hangup</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l05201"></a>05201       } <span class="keywordflow">else</span> {
<a name="l05202"></a>05202          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Skinny(%s@%s-%d) channel already destroyed\n&quot;</span>,
<a name="l05203"></a>05203             l-&gt;name, d-&gt;name, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l05204"></a>05204       }
<a name="l05205"></a>05205    }
<a name="l05206"></a>05206    <span class="keywordflow">return</span> 1;
<a name="l05207"></a>05207 }
<a name="l05208"></a>05208 
<a name="l05209"></a><a class="code" href="chan__skinny_8c.html#a6382ccdb9e04a0ce816a20a54a96700a">05209</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a6382ccdb9e04a0ce816a20a54a96700a">handle_capabilities_res_message</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__req.html">skinny_req</a> *req, <span class="keyword">struct</span> <a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l05210"></a>05210 {
<a name="l05211"></a>05211    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d = s-&gt;<a class="code" href="structskinnysession.html#a70701ca9c2641bcb1740286273a0473a">device</a>;
<a name="l05212"></a>05212    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l;
<a name="l05213"></a>05213    uint32_t count = 0;
<a name="l05214"></a>05214    <span class="keywordtype">int</span> codecs = 0;
<a name="l05215"></a>05215    <span class="keywordtype">int</span> i;
<a name="l05216"></a>05216 
<a name="l05217"></a>05217    count = <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a99fd8190ffcee05962cae3d8518033cc">caps</a>.<a class="code" href="structcapabilities__res__message.html#a86988a65e0d3ece7990c032c159786d6">count</a>);
<a name="l05218"></a>05218    <span class="keywordflow">if</span> (count &gt; <a class="code" href="chan__skinny_8c.html#aa12950ed52268059264cbac73630a91a">SKINNY_MAX_CAPABILITIES</a>) {
<a name="l05219"></a>05219       count = <a class="code" href="chan__skinny_8c.html#aa12950ed52268059264cbac73630a91a">SKINNY_MAX_CAPABILITIES</a>;
<a name="l05220"></a>05220       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Received more capabilities than we can handle (%d).  Ignoring the rest.\n&quot;</span>, <a class="code" href="chan__skinny_8c.html#aa12950ed52268059264cbac73630a91a">SKINNY_MAX_CAPABILITIES</a>);
<a name="l05221"></a>05221    }
<a name="l05222"></a>05222 
<a name="l05223"></a>05223    <span class="keywordflow">for</span> (i = 0; i &lt; count; i++) {
<a name="l05224"></a>05224       <span class="keywordtype">int</span> acodec = 0;
<a name="l05225"></a>05225       <span class="keywordtype">int</span> scodec = 0;
<a name="l05226"></a>05226       scodec = <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a99fd8190ffcee05962cae3d8518033cc">caps</a>.<a class="code" href="structcapabilities__res__message.html#ac665dc2214c0a6f27c0b17f5d88032ea">caps</a>[i].<a class="code" href="structstation__capabilities.html#a86c2d4142c7f419d8d327bc261fa851f">codec</a>);
<a name="l05227"></a>05227       acodec = <a class="code" href="chan__skinny_8c.html#a615827788544df4e5a9788b858d8a7f6">codec_skinny2ast</a>(scodec);
<a name="l05228"></a>05228       <span class="keywordflow">if</span> (skinnydebug)
<a name="l05229"></a>05229          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Adding codec capability &apos;%d (%d)&apos;\n&quot;</span>, acodec, scodec);
<a name="l05230"></a>05230       codecs |= acodec;
<a name="l05231"></a>05231    }
<a name="l05232"></a>05232 
<a name="l05233"></a>05233    d-&gt;capability = d-&gt;confcapability &amp; codecs;
<a name="l05234"></a>05234    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(0, <span class="stringliteral">&quot;Device capability set to &apos;%d&apos;\n&quot;</span>, d-&gt;capability);
<a name="l05235"></a>05235    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;lines, l, list) {
<a name="l05236"></a>05236       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;l-&gt;<a class="code" href="structskinny__line.html#ae5e68fb86600e9f1e67bb18aaa19f78a">lock</a>);
<a name="l05237"></a>05237       l-&gt;capability = l-&gt;confcapability &amp; d-&gt;capability;
<a name="l05238"></a>05238       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;l-&gt;<a class="code" href="structskinny__line.html#ae5e68fb86600e9f1e67bb18aaa19f78a">lock</a>);
<a name="l05239"></a>05239    }
<a name="l05240"></a>05240 
<a name="l05241"></a>05241    <span class="keywordflow">return</span> 1;
<a name="l05242"></a>05242 }
<a name="l05243"></a>05243 
<a name="l05244"></a><a class="code" href="chan__skinny_8c.html#a305823a106c34c948fb326ee7b45a369">05244</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a305823a106c34c948fb326ee7b45a369">handle_speed_dial_stat_req_message</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__req.html">skinny_req</a> *req, <span class="keyword">struct</span> <a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l05245"></a>05245 {
<a name="l05246"></a>05246    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d = s-&gt;<a class="code" href="structskinnysession.html#a70701ca9c2641bcb1740286273a0473a">device</a>;
<a name="l05247"></a>05247    <span class="keyword">struct </span><a class="code" href="structskinny__speeddial.html">skinny_speeddial</a> *sd;
<a name="l05248"></a>05248    <span class="keywordtype">int</span> <a class="code" href="structskinny__speeddial.html#a6fd216872447cfe5f757d2ce47fea6fb">instance</a>;
<a name="l05249"></a>05249 
<a name="l05250"></a>05250    instance = <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a883cd321c7b885c8eb325344e8a45e01">speeddialreq</a>.<a class="code" href="structspeed__dial__stat__req__message.html#acd27bc25ce21f3ab7dfe7d0c53763f04">speedDialNumber</a>);
<a name="l05251"></a>05251 
<a name="l05252"></a>05252    sd = <a class="code" href="chan__skinny_8c.html#a0be9e6c1ec02d36ff811d63a5b9ca022">find_speeddial_by_instance</a>(d, instance, 0);
<a name="l05253"></a>05253 
<a name="l05254"></a>05254    <span class="keywordflow">if</span> (!sd) {
<a name="l05255"></a>05255       <span class="keywordflow">return</span> 0;
<a name="l05256"></a>05256    }
<a name="l05257"></a>05257 
<a name="l05258"></a>05258    <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structspeed__dial__stat__res__message.html">speed_dial_stat_res_message</a>), <a class="code" href="chan__skinny_8c.html#a552f2cd0b0e5021c1a1d60d7e79e5488">SPEED_DIAL_STAT_RES_MESSAGE</a>)))
<a name="l05259"></a>05259       <span class="keywordflow">return</span> -1;
<a name="l05260"></a>05260 
<a name="l05261"></a>05261    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a883cd321c7b885c8eb325344e8a45e01">speeddialreq</a>.<a class="code" href="structspeed__dial__stat__req__message.html#acd27bc25ce21f3ab7dfe7d0c53763f04">speedDialNumber</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(instance);
<a name="l05262"></a>05262    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a23a2176cab0bee9f41d7b1af10f8f6cd">speeddial</a>.<a class="code" href="structspeed__dial__stat__res__message.html#a2e227f2e07370c68d9abeaca3dc883fb">speedDialDirNumber</a>, sd-&gt;<a class="code" href="structskinny__speeddial.html#a78d4847658b695383d849efd12399b38">exten</a>, <span class="keyword">sizeof</span>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a23a2176cab0bee9f41d7b1af10f8f6cd">speeddial</a>.<a class="code" href="structspeed__dial__stat__res__message.html#a2e227f2e07370c68d9abeaca3dc883fb">speedDialDirNumber</a>));
<a name="l05263"></a>05263    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a23a2176cab0bee9f41d7b1af10f8f6cd">speeddial</a>.<a class="code" href="structspeed__dial__stat__res__message.html#a33a668a02f35239d4d39ccaf1c30c273">speedDialDisplayName</a>, sd-&gt;<a class="code" href="structskinny__speeddial.html#ab20c01b68c97d3477a795c85e6c37be9">label</a>, <span class="keyword">sizeof</span>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a23a2176cab0bee9f41d7b1af10f8f6cd">speeddial</a>.<a class="code" href="structspeed__dial__stat__res__message.html#a33a668a02f35239d4d39ccaf1c30c273">speedDialDisplayName</a>));
<a name="l05264"></a>05264 
<a name="l05265"></a>05265    <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l05266"></a>05266    <span class="keywordflow">return</span> 1;
<a name="l05267"></a>05267 }
<a name="l05268"></a>05268 
<a name="l05269"></a><a class="code" href="chan__skinny_8c.html#a672a36345b53d8f188c5f9520482b5c3">05269</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a672a36345b53d8f188c5f9520482b5c3">handle_line_state_req_message</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__req.html">skinny_req</a> *req, <span class="keyword">struct</span> <a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l05270"></a>05270 {
<a name="l05271"></a>05271    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d = s-&gt;<a class="code" href="structskinnysession.html#a70701ca9c2641bcb1740286273a0473a">device</a>;
<a name="l05272"></a>05272    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l;
<a name="l05273"></a>05273    <span class="keyword">struct </span><a class="code" href="structskinny__speeddial.html">skinny_speeddial</a> *sd = NULL;
<a name="l05274"></a>05274    <span class="keywordtype">int</span> <a class="code" href="structskinny__speeddial.html#a6fd216872447cfe5f757d2ce47fea6fb">instance</a>;
<a name="l05275"></a>05275 
<a name="l05276"></a>05276    instance = <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#ac8bbcfcff4905989003310cb08dedc92">line</a>.<a class="code" href="structline__state__req__message.html#a987293a1c8fcaf937487ecbe613f0c52">lineNumber</a>);
<a name="l05277"></a>05277 
<a name="l05278"></a>05278    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>);
<a name="l05279"></a>05279 
<a name="l05280"></a>05280    l = <a class="code" href="chan__skinny_8c.html#a7b9ecaa4bb1481a9a5666e91c88a3968">find_line_by_instance</a>(d, instance);
<a name="l05281"></a>05281 
<a name="l05282"></a>05282    <span class="keywordflow">if</span> (!l) {
<a name="l05283"></a>05283       sd = <a class="code" href="chan__skinny_8c.html#a0be9e6c1ec02d36ff811d63a5b9ca022">find_speeddial_by_instance</a>(d, instance, 1);
<a name="l05284"></a>05284    }
<a name="l05285"></a>05285 
<a name="l05286"></a>05286    <span class="keywordflow">if</span> (!l &amp;&amp; !sd) {
<a name="l05287"></a>05287       <span class="keywordflow">return</span> 0;
<a name="l05288"></a>05288    }
<a name="l05289"></a>05289 
<a name="l05290"></a>05290    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>);
<a name="l05291"></a>05291 
<a name="l05292"></a>05292    <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structline__stat__res__message.html">line_stat_res_message</a>), <a class="code" href="chan__skinny_8c.html#a2181f1d209288ce7edad5fc7bc07a9c1">LINE_STAT_RES_MESSAGE</a>)))
<a name="l05293"></a>05293       <span class="keywordflow">return</span> -1;
<a name="l05294"></a>05294 
<a name="l05295"></a>05295    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a0622af8a74c6dd3ce12a70c2013f3744">linestat</a>.<a class="code" href="structline__stat__res__message.html#a987293a1c8fcaf937487ecbe613f0c52">lineNumber</a> = <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(instance);
<a name="l05296"></a>05296    <span class="keywordflow">if</span> (!l) {
<a name="l05297"></a>05297       memcpy(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a0622af8a74c6dd3ce12a70c2013f3744">linestat</a>.<a class="code" href="structline__stat__res__message.html#a7b3df44a29beab3b350e067cbfb7075b">lineDirNumber</a>, sd-&gt;<a class="code" href="structskinny__speeddial.html#ab20c01b68c97d3477a795c85e6c37be9">label</a>, <span class="keyword">sizeof</span>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a0622af8a74c6dd3ce12a70c2013f3744">linestat</a>.<a class="code" href="structline__stat__res__message.html#a7b3df44a29beab3b350e067cbfb7075b">lineDirNumber</a>));
<a name="l05298"></a>05298       memcpy(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a0622af8a74c6dd3ce12a70c2013f3744">linestat</a>.<a class="code" href="structline__stat__res__message.html#a54c4c4fcc87cdc8712a6b9808f7e4215">lineDisplayName</a>, sd-&gt;<a class="code" href="structskinny__speeddial.html#ab20c01b68c97d3477a795c85e6c37be9">label</a>, <span class="keyword">sizeof</span>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a0622af8a74c6dd3ce12a70c2013f3744">linestat</a>.<a class="code" href="structline__stat__res__message.html#a54c4c4fcc87cdc8712a6b9808f7e4215">lineDisplayName</a>));
<a name="l05299"></a>05299    } <span class="keywordflow">else</span> {
<a name="l05300"></a>05300       memcpy(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a0622af8a74c6dd3ce12a70c2013f3744">linestat</a>.<a class="code" href="structline__stat__res__message.html#a7b3df44a29beab3b350e067cbfb7075b">lineDirNumber</a>, l-&gt;name, <span class="keyword">sizeof</span>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a0622af8a74c6dd3ce12a70c2013f3744">linestat</a>.<a class="code" href="structline__stat__res__message.html#a7b3df44a29beab3b350e067cbfb7075b">lineDirNumber</a>));
<a name="l05301"></a>05301       memcpy(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a0622af8a74c6dd3ce12a70c2013f3744">linestat</a>.<a class="code" href="structline__stat__res__message.html#a54c4c4fcc87cdc8712a6b9808f7e4215">lineDisplayName</a>, l-&gt;label, <span class="keyword">sizeof</span>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a0622af8a74c6dd3ce12a70c2013f3744">linestat</a>.<a class="code" href="structline__stat__res__message.html#a54c4c4fcc87cdc8712a6b9808f7e4215">lineDisplayName</a>));
<a name="l05302"></a>05302    }
<a name="l05303"></a>05303    <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l05304"></a>05304    <span class="keywordflow">return</span> 1;
<a name="l05305"></a>05305 }
<a name="l05306"></a>05306 
<a name="l05307"></a><a class="code" href="chan__skinny_8c.html#a9900f684e2e692200c87ade6605b3570">05307</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a9900f684e2e692200c87ade6605b3570">handle_time_date_req_message</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__req.html">skinny_req</a> *req, <span class="keyword">struct</span> <a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l05308"></a>05308 {
<a name="l05309"></a>05309    <span class="keyword">struct </span>timeval now = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l05310"></a>05310    <span class="keyword">struct </span><a class="code" href="structast__tm.html">ast_tm</a> cmtime;
<a name="l05311"></a>05311 
<a name="l05312"></a>05312    <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structdefinetimedate__message.html">definetimedate_message</a>), <a class="code" href="chan__skinny_8c.html#a05d20dbd5d289408e887b7c267ec3eea">DEFINETIMEDATE_MESSAGE</a>)))
<a name="l05313"></a>05313       <span class="keywordflow">return</span> -1;
<a name="l05314"></a>05314 
<a name="l05315"></a>05315    <a class="code" href="localtime_8h.html#ae9fbda728350a9a5b9c09b29214d718e" title="Timezone-independent version of localtime_r(3).">ast_localtime</a>(&amp;now, &amp;cmtime, NULL);
<a name="l05316"></a>05316    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#ac6a060847a0ae4c9ce457a22c4df61fa">definetimedate</a>.<a class="code" href="structdefinetimedate__message.html#aac3a162d2f192fe2360aba534eac7198">year</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(cmtime.<a class="code" href="structast__tm.html#a994c4f4519ba57e186580d21cc86f9e5">tm_year</a>+1900);
<a name="l05317"></a>05317    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#ac6a060847a0ae4c9ce457a22c4df61fa">definetimedate</a>.<a class="code" href="structdefinetimedate__message.html#a55a5fa57878363d803833666ddf3c16f">month</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(cmtime.<a class="code" href="structast__tm.html#ada983deda100b604bee5716512453658">tm_mon</a>+1);
<a name="l05318"></a>05318    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#ac6a060847a0ae4c9ce457a22c4df61fa">definetimedate</a>.<a class="code" href="structdefinetimedate__message.html#ab470c6489808456f63cfd7f94df28712">dayofweek</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(cmtime.<a class="code" href="structast__tm.html#a4412571b90746a85cae9b8841c44c59c">tm_wday</a>);
<a name="l05319"></a>05319    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#ac6a060847a0ae4c9ce457a22c4df61fa">definetimedate</a>.<a class="code" href="structdefinetimedate__message.html#a897ed87b95b7a37afeeb935ca0b2366b">day</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(cmtime.<a class="code" href="structast__tm.html#a02048604d30b880033311cf542d63f92">tm_mday</a>);
<a name="l05320"></a>05320    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#ac6a060847a0ae4c9ce457a22c4df61fa">definetimedate</a>.<a class="code" href="structdefinetimedate__message.html#a26d5bae76d83086900174b266fd2cd82">hour</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(cmtime.<a class="code" href="structast__tm.html#a4d171061df9e012fcfbd1172b8440d5f">tm_hour</a>);
<a name="l05321"></a>05321    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#ac6a060847a0ae4c9ce457a22c4df61fa">definetimedate</a>.<a class="code" href="structdefinetimedate__message.html#aa4bd38811c26969cc4d8cd6723199530">minute</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(cmtime.<a class="code" href="structast__tm.html#a987fa9280fe4cd6c6b8f77409f1c1504">tm_min</a>);
<a name="l05322"></a>05322    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#ac6a060847a0ae4c9ce457a22c4df61fa">definetimedate</a>.<a class="code" href="structdefinetimedate__message.html#a6d5694839ec935781627e5c52de21fda">seconds</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(cmtime.<a class="code" href="structast__tm.html#a18df301c1a10c8d493da86ce5c2aea78">tm_sec</a>);
<a name="l05323"></a>05323    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#ac6a060847a0ae4c9ce457a22c4df61fa">definetimedate</a>.<a class="code" href="structdefinetimedate__message.html#a62744aa03cd35aa3b6955f8ff972edb2">milliseconds</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(cmtime.<a class="code" href="structast__tm.html#aefbab7d1223d156a8cfaaf3ff170540b">tm_usec</a> / 1000);
<a name="l05324"></a>05324    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#ac6a060847a0ae4c9ce457a22c4df61fa">definetimedate</a>.<a class="code" href="structdefinetimedate__message.html#ab20b0c7772544cf5d318507f34231fbe">timestamp</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(now.tv_sec);
<a name="l05325"></a>05325    <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(s-&gt;<a class="code" href="structskinnysession.html#a70701ca9c2641bcb1740286273a0473a">device</a>, req);
<a name="l05326"></a>05326    <span class="keywordflow">return</span> 1;
<a name="l05327"></a>05327 }
<a name="l05328"></a>05328 
<a name="l05329"></a><a class="code" href="chan__skinny_8c.html#a987b03603d0ce69e4e50662c7c3fb744">05329</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a987b03603d0ce69e4e50662c7c3fb744">handle_button_template_req_message</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__req.html">skinny_req</a> *req, <span class="keyword">struct</span> <a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l05330"></a>05330 {
<a name="l05331"></a>05331    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d = s-&gt;<a class="code" href="structskinnysession.html#a70701ca9c2641bcb1740286273a0473a">device</a>;
<a name="l05332"></a>05332    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l;
<a name="l05333"></a>05333    <span class="keywordtype">int</span> i;
<a name="l05334"></a>05334 
<a name="l05335"></a>05335    <span class="keyword">struct </span><a class="code" href="structskinny__speeddial.html">skinny_speeddial</a> *sd;
<a name="l05336"></a>05336    <span class="keyword">struct </span><a class="code" href="structbutton__definition__template.html">button_definition_template</a> btn[42];
<a name="l05337"></a>05337    <span class="keywordtype">int</span> lineInstance = 1;
<a name="l05338"></a>05338    <span class="keywordtype">int</span> speeddialInstance = 1;
<a name="l05339"></a>05339    <span class="keywordtype">int</span> buttonCount = 0;
<a name="l05340"></a>05340 
<a name="l05341"></a>05341    <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structbutton__template__res__message.html">button_template_res_message</a>), <a class="code" href="chan__skinny_8c.html#aa0698f06ea990283d266b4fad44a49c1">BUTTON_TEMPLATE_RES_MESSAGE</a>)))
<a name="l05342"></a>05342       <span class="keywordflow">return</span> -1;
<a name="l05343"></a>05343 
<a name="l05344"></a>05344    memset(&amp;btn, 0, <span class="keyword">sizeof</span>(btn));
<a name="l05345"></a>05345 
<a name="l05346"></a>05346    <a class="code" href="chan__skinny_8c.html#a777f6b11a8e0eb771de41dfe998bb570">get_button_template</a>(s, btn);
<a name="l05347"></a>05347 
<a name="l05348"></a>05348    <span class="keywordflow">for</span> (i=0; i&lt;42; i++) {
<a name="l05349"></a>05349       <span class="keywordtype">int</span> btnSet = 0;
<a name="l05350"></a>05350       <span class="keywordflow">switch</span> (btn[i].<a class="code" href="structbutton__definition__template.html#aca4595173e9d8b5d9c6dfcc94d15f74a">buttonDefinition</a>) {
<a name="l05351"></a>05351          <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a79703f70916908d1d8a2cbb2c319a287">BT_CUST_LINE</a>:
<a name="l05352"></a>05352             <span class="comment">/* assume failure */</span>
<a name="l05353"></a>05353             req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aeccc27699eb18669c1753cc2fd3ba382">buttontemplate</a>.<a class="code" href="structbutton__template__res__message.html#aa40104e9b00b6ca099695c7494cf0c93">definition</a>[i].<a class="code" href="structbutton__definition.html#aca4595173e9d8b5d9c6dfcc94d15f74a">buttonDefinition</a> = <a class="code" href="chan__skinny_8c.html#afaba3e566686d3d7a3f42c20aa5e882d">BT_NONE</a>;
<a name="l05354"></a>05354             req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aeccc27699eb18669c1753cc2fd3ba382">buttontemplate</a>.<a class="code" href="structbutton__template__res__message.html#aa40104e9b00b6ca099695c7494cf0c93">definition</a>[i].<a class="code" href="structbutton__definition.html#a9354e42b02d44b23794884f29cc25d78">instanceNumber</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(0);
<a name="l05355"></a>05355 
<a name="l05356"></a>05356             <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;lines, l, list) {
<a name="l05357"></a>05357                <span class="keywordflow">if</span> (l-&gt;instance == lineInstance) {
<a name="l05358"></a>05358                   <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(0, <span class="stringliteral">&quot;Adding button: %d, %d\n&quot;</span>, <a class="code" href="chan__skinny_8c.html#a081aff21e0bee826b43a1e779321a5e0">BT_LINE</a>, lineInstance);
<a name="l05359"></a>05359                   req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aeccc27699eb18669c1753cc2fd3ba382">buttontemplate</a>.<a class="code" href="structbutton__template__res__message.html#aa40104e9b00b6ca099695c7494cf0c93">definition</a>[i].<a class="code" href="structbutton__definition.html#aca4595173e9d8b5d9c6dfcc94d15f74a">buttonDefinition</a> = <a class="code" href="chan__skinny_8c.html#a081aff21e0bee826b43a1e779321a5e0">BT_LINE</a>;
<a name="l05360"></a>05360                   req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aeccc27699eb18669c1753cc2fd3ba382">buttontemplate</a>.<a class="code" href="structbutton__template__res__message.html#aa40104e9b00b6ca099695c7494cf0c93">definition</a>[i].<a class="code" href="structbutton__definition.html#a9354e42b02d44b23794884f29cc25d78">instanceNumber</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(lineInstance);
<a name="l05361"></a>05361                   lineInstance++;
<a name="l05362"></a>05362                   buttonCount++;
<a name="l05363"></a>05363                   btnSet = 1;
<a name="l05364"></a>05364                   <span class="keywordflow">break</span>;
<a name="l05365"></a>05365                }
<a name="l05366"></a>05366             }
<a name="l05367"></a>05367 
<a name="l05368"></a>05368             <span class="keywordflow">if</span> (!btnSet) {
<a name="l05369"></a>05369                <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;speeddials, sd, list) {
<a name="l05370"></a>05370                   <span class="keywordflow">if</span> (sd-&gt;<a class="code" href="structskinny__speeddial.html#ad3d414cdb71376b88dc5ce91a2a6118e">isHint</a> &amp;&amp; sd-&gt;<a class="code" href="structskinny__speeddial.html#a6fd216872447cfe5f757d2ce47fea6fb">instance</a> == lineInstance) {
<a name="l05371"></a>05371                      <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(0, <span class="stringliteral">&quot;Adding button: %d, %d\n&quot;</span>, <a class="code" href="chan__skinny_8c.html#a081aff21e0bee826b43a1e779321a5e0">BT_LINE</a>, lineInstance);
<a name="l05372"></a>05372                      req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aeccc27699eb18669c1753cc2fd3ba382">buttontemplate</a>.<a class="code" href="structbutton__template__res__message.html#aa40104e9b00b6ca099695c7494cf0c93">definition</a>[i].<a class="code" href="structbutton__definition.html#aca4595173e9d8b5d9c6dfcc94d15f74a">buttonDefinition</a> = <a class="code" href="chan__skinny_8c.html#a081aff21e0bee826b43a1e779321a5e0">BT_LINE</a>;
<a name="l05373"></a>05373                      req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aeccc27699eb18669c1753cc2fd3ba382">buttontemplate</a>.<a class="code" href="structbutton__template__res__message.html#aa40104e9b00b6ca099695c7494cf0c93">definition</a>[i].<a class="code" href="structbutton__definition.html#a9354e42b02d44b23794884f29cc25d78">instanceNumber</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(lineInstance);
<a name="l05374"></a>05374                      lineInstance++;
<a name="l05375"></a>05375                      buttonCount++;
<a name="l05376"></a>05376                      btnSet = 1;
<a name="l05377"></a>05377                      <span class="keywordflow">break</span>;
<a name="l05378"></a>05378                   }
<a name="l05379"></a>05379                }
<a name="l05380"></a>05380             }
<a name="l05381"></a>05381             <span class="keywordflow">break</span>;
<a name="l05382"></a>05382          <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#ad25614879b5f61a397dd7e6afc94e315">BT_CUST_LINESPEEDDIAL</a>:
<a name="l05383"></a>05383             <span class="comment">/* assume failure */</span>
<a name="l05384"></a>05384             req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aeccc27699eb18669c1753cc2fd3ba382">buttontemplate</a>.<a class="code" href="structbutton__template__res__message.html#aa40104e9b00b6ca099695c7494cf0c93">definition</a>[i].<a class="code" href="structbutton__definition.html#aca4595173e9d8b5d9c6dfcc94d15f74a">buttonDefinition</a> = <a class="code" href="chan__skinny_8c.html#afaba3e566686d3d7a3f42c20aa5e882d">BT_NONE</a>;
<a name="l05385"></a>05385             req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aeccc27699eb18669c1753cc2fd3ba382">buttontemplate</a>.<a class="code" href="structbutton__template__res__message.html#aa40104e9b00b6ca099695c7494cf0c93">definition</a>[i].<a class="code" href="structbutton__definition.html#a9354e42b02d44b23794884f29cc25d78">instanceNumber</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(0);
<a name="l05386"></a>05386 
<a name="l05387"></a>05387             <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;lines, l, list) {
<a name="l05388"></a>05388                <span class="keywordflow">if</span> (l-&gt;instance == lineInstance) {
<a name="l05389"></a>05389                   <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(0, <span class="stringliteral">&quot;Adding button: %d, %d\n&quot;</span>, <a class="code" href="chan__skinny_8c.html#a081aff21e0bee826b43a1e779321a5e0">BT_LINE</a>, lineInstance);
<a name="l05390"></a>05390                   req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aeccc27699eb18669c1753cc2fd3ba382">buttontemplate</a>.<a class="code" href="structbutton__template__res__message.html#aa40104e9b00b6ca099695c7494cf0c93">definition</a>[i].<a class="code" href="structbutton__definition.html#aca4595173e9d8b5d9c6dfcc94d15f74a">buttonDefinition</a> = <a class="code" href="chan__skinny_8c.html#a081aff21e0bee826b43a1e779321a5e0">BT_LINE</a>;
<a name="l05391"></a>05391                   req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aeccc27699eb18669c1753cc2fd3ba382">buttontemplate</a>.<a class="code" href="structbutton__template__res__message.html#aa40104e9b00b6ca099695c7494cf0c93">definition</a>[i].<a class="code" href="structbutton__definition.html#a9354e42b02d44b23794884f29cc25d78">instanceNumber</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(lineInstance);
<a name="l05392"></a>05392                   lineInstance++;
<a name="l05393"></a>05393                   buttonCount++;
<a name="l05394"></a>05394                   btnSet = 1;
<a name="l05395"></a>05395                   <span class="keywordflow">break</span>;
<a name="l05396"></a>05396                }
<a name="l05397"></a>05397             }
<a name="l05398"></a>05398 
<a name="l05399"></a>05399             <span class="keywordflow">if</span> (!btnSet) {
<a name="l05400"></a>05400                <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;speeddials, sd, list) {
<a name="l05401"></a>05401                   <span class="keywordflow">if</span> (sd-&gt;<a class="code" href="structskinny__speeddial.html#ad3d414cdb71376b88dc5ce91a2a6118e">isHint</a> &amp;&amp; sd-&gt;<a class="code" href="structskinny__speeddial.html#a6fd216872447cfe5f757d2ce47fea6fb">instance</a> == lineInstance) {
<a name="l05402"></a>05402                      <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(0, <span class="stringliteral">&quot;Adding button: %d, %d\n&quot;</span>, <a class="code" href="chan__skinny_8c.html#a081aff21e0bee826b43a1e779321a5e0">BT_LINE</a>, lineInstance);
<a name="l05403"></a>05403                      req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aeccc27699eb18669c1753cc2fd3ba382">buttontemplate</a>.<a class="code" href="structbutton__template__res__message.html#aa40104e9b00b6ca099695c7494cf0c93">definition</a>[i].<a class="code" href="structbutton__definition.html#aca4595173e9d8b5d9c6dfcc94d15f74a">buttonDefinition</a> = <a class="code" href="chan__skinny_8c.html#a081aff21e0bee826b43a1e779321a5e0">BT_LINE</a>;
<a name="l05404"></a>05404                      req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aeccc27699eb18669c1753cc2fd3ba382">buttontemplate</a>.<a class="code" href="structbutton__template__res__message.html#aa40104e9b00b6ca099695c7494cf0c93">definition</a>[i].<a class="code" href="structbutton__definition.html#a9354e42b02d44b23794884f29cc25d78">instanceNumber</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(lineInstance);
<a name="l05405"></a>05405                      lineInstance++;
<a name="l05406"></a>05406                      buttonCount++;
<a name="l05407"></a>05407                      btnSet = 1;
<a name="l05408"></a>05408                      <span class="keywordflow">break</span>;
<a name="l05409"></a>05409                   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!sd-&gt;<a class="code" href="structskinny__speeddial.html#ad3d414cdb71376b88dc5ce91a2a6118e">isHint</a> &amp;&amp; sd-&gt;<a class="code" href="structskinny__speeddial.html#a6fd216872447cfe5f757d2ce47fea6fb">instance</a> == speeddialInstance) {
<a name="l05410"></a>05410                      <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(0, <span class="stringliteral">&quot;Adding button: %d, %d\n&quot;</span>, <a class="code" href="chan__skinny_8c.html#a6c4119bfe726809a67361ef8873aebb1">BT_SPEEDDIAL</a>, speeddialInstance);
<a name="l05411"></a>05411                      req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aeccc27699eb18669c1753cc2fd3ba382">buttontemplate</a>.<a class="code" href="structbutton__template__res__message.html#aa40104e9b00b6ca099695c7494cf0c93">definition</a>[i].<a class="code" href="structbutton__definition.html#aca4595173e9d8b5d9c6dfcc94d15f74a">buttonDefinition</a> = <a class="code" href="chan__skinny_8c.html#a6c4119bfe726809a67361ef8873aebb1">BT_SPEEDDIAL</a>;
<a name="l05412"></a>05412                      req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aeccc27699eb18669c1753cc2fd3ba382">buttontemplate</a>.<a class="code" href="structbutton__template__res__message.html#aa40104e9b00b6ca099695c7494cf0c93">definition</a>[i].<a class="code" href="structbutton__definition.html#a9354e42b02d44b23794884f29cc25d78">instanceNumber</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(speeddialInstance);
<a name="l05413"></a>05413                      speeddialInstance++;
<a name="l05414"></a>05414                      buttonCount++;
<a name="l05415"></a>05415                      btnSet = 1;
<a name="l05416"></a>05416                      <span class="keywordflow">break</span>;
<a name="l05417"></a>05417                   }
<a name="l05418"></a>05418                }
<a name="l05419"></a>05419             }
<a name="l05420"></a>05420             <span class="keywordflow">break</span>;
<a name="l05421"></a>05421          <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a081aff21e0bee826b43a1e779321a5e0">BT_LINE</a>:
<a name="l05422"></a>05422             req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aeccc27699eb18669c1753cc2fd3ba382">buttontemplate</a>.<a class="code" href="structbutton__template__res__message.html#aa40104e9b00b6ca099695c7494cf0c93">definition</a>[i].<a class="code" href="structbutton__definition.html#aca4595173e9d8b5d9c6dfcc94d15f74a">buttonDefinition</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(<a class="code" href="chan__skinny_8c.html#afaba3e566686d3d7a3f42c20aa5e882d">BT_NONE</a>);
<a name="l05423"></a>05423             req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aeccc27699eb18669c1753cc2fd3ba382">buttontemplate</a>.<a class="code" href="structbutton__template__res__message.html#aa40104e9b00b6ca099695c7494cf0c93">definition</a>[i].<a class="code" href="structbutton__definition.html#a9354e42b02d44b23794884f29cc25d78">instanceNumber</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(0);
<a name="l05424"></a>05424 
<a name="l05425"></a>05425             <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;lines, l, list) {
<a name="l05426"></a>05426                <span class="keywordflow">if</span> (l-&gt;instance == lineInstance) {
<a name="l05427"></a>05427                   <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(0, <span class="stringliteral">&quot;Adding button: %d, %d\n&quot;</span>, <a class="code" href="chan__skinny_8c.html#a081aff21e0bee826b43a1e779321a5e0">BT_LINE</a>, lineInstance);
<a name="l05428"></a>05428                   req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aeccc27699eb18669c1753cc2fd3ba382">buttontemplate</a>.<a class="code" href="structbutton__template__res__message.html#aa40104e9b00b6ca099695c7494cf0c93">definition</a>[i].<a class="code" href="structbutton__definition.html#aca4595173e9d8b5d9c6dfcc94d15f74a">buttonDefinition</a> = <a class="code" href="chan__skinny_8c.html#a081aff21e0bee826b43a1e779321a5e0">BT_LINE</a>;
<a name="l05429"></a>05429                   req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aeccc27699eb18669c1753cc2fd3ba382">buttontemplate</a>.<a class="code" href="structbutton__template__res__message.html#aa40104e9b00b6ca099695c7494cf0c93">definition</a>[i].<a class="code" href="structbutton__definition.html#a9354e42b02d44b23794884f29cc25d78">instanceNumber</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(lineInstance);
<a name="l05430"></a>05430                   lineInstance++;
<a name="l05431"></a>05431                   buttonCount++;
<a name="l05432"></a>05432                   btnSet = 1;
<a name="l05433"></a>05433                   <span class="keywordflow">break</span>;
<a name="l05434"></a>05434                }
<a name="l05435"></a>05435             }
<a name="l05436"></a>05436             <span class="keywordflow">break</span>;
<a name="l05437"></a>05437          <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a6c4119bfe726809a67361ef8873aebb1">BT_SPEEDDIAL</a>:
<a name="l05438"></a>05438             req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aeccc27699eb18669c1753cc2fd3ba382">buttontemplate</a>.<a class="code" href="structbutton__template__res__message.html#aa40104e9b00b6ca099695c7494cf0c93">definition</a>[i].<a class="code" href="structbutton__definition.html#aca4595173e9d8b5d9c6dfcc94d15f74a">buttonDefinition</a> = <a class="code" href="chan__skinny_8c.html#afaba3e566686d3d7a3f42c20aa5e882d">BT_NONE</a>;
<a name="l05439"></a>05439             req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aeccc27699eb18669c1753cc2fd3ba382">buttontemplate</a>.<a class="code" href="structbutton__template__res__message.html#aa40104e9b00b6ca099695c7494cf0c93">definition</a>[i].<a class="code" href="structbutton__definition.html#a9354e42b02d44b23794884f29cc25d78">instanceNumber</a> = 0;
<a name="l05440"></a>05440 
<a name="l05441"></a>05441             <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;speeddials, sd, list) {
<a name="l05442"></a>05442                <span class="keywordflow">if</span> (!sd-&gt;<a class="code" href="structskinny__speeddial.html#ad3d414cdb71376b88dc5ce91a2a6118e">isHint</a> &amp;&amp; sd-&gt;<a class="code" href="structskinny__speeddial.html#a6fd216872447cfe5f757d2ce47fea6fb">instance</a> == speeddialInstance) {
<a name="l05443"></a>05443                   <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(0, <span class="stringliteral">&quot;Adding button: %d, %d\n&quot;</span>, <a class="code" href="chan__skinny_8c.html#a6c4119bfe726809a67361ef8873aebb1">BT_SPEEDDIAL</a>, speeddialInstance);
<a name="l05444"></a>05444                   req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aeccc27699eb18669c1753cc2fd3ba382">buttontemplate</a>.<a class="code" href="structbutton__template__res__message.html#aa40104e9b00b6ca099695c7494cf0c93">definition</a>[i].<a class="code" href="structbutton__definition.html#aca4595173e9d8b5d9c6dfcc94d15f74a">buttonDefinition</a> = <a class="code" href="chan__skinny_8c.html#a6c4119bfe726809a67361ef8873aebb1">BT_SPEEDDIAL</a>;
<a name="l05445"></a>05445                   req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aeccc27699eb18669c1753cc2fd3ba382">buttontemplate</a>.<a class="code" href="structbutton__template__res__message.html#aa40104e9b00b6ca099695c7494cf0c93">definition</a>[i].<a class="code" href="structbutton__definition.html#a9354e42b02d44b23794884f29cc25d78">instanceNumber</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(speeddialInstance - 1);
<a name="l05446"></a>05446                   speeddialInstance++;
<a name="l05447"></a>05447                   buttonCount++;
<a name="l05448"></a>05448                   btnSet = 1;
<a name="l05449"></a>05449                   <span class="keywordflow">break</span>;
<a name="l05450"></a>05450                }
<a name="l05451"></a>05451             }
<a name="l05452"></a>05452             <span class="keywordflow">break</span>;
<a name="l05453"></a>05453          <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#afaba3e566686d3d7a3f42c20aa5e882d">BT_NONE</a>:
<a name="l05454"></a>05454             <span class="keywordflow">break</span>;
<a name="l05455"></a>05455          <span class="keywordflow">default</span>:
<a name="l05456"></a>05456             <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(0, <span class="stringliteral">&quot;Adding button: %d, %d\n&quot;</span>, btn[i].buttonDefinition, 0);
<a name="l05457"></a>05457             req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aeccc27699eb18669c1753cc2fd3ba382">buttontemplate</a>.<a class="code" href="structbutton__template__res__message.html#aa40104e9b00b6ca099695c7494cf0c93">definition</a>[i].<a class="code" href="structbutton__definition.html#aca4595173e9d8b5d9c6dfcc94d15f74a">buttonDefinition</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(btn[i].buttonDefinition);
<a name="l05458"></a>05458             req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aeccc27699eb18669c1753cc2fd3ba382">buttontemplate</a>.<a class="code" href="structbutton__template__res__message.html#aa40104e9b00b6ca099695c7494cf0c93">definition</a>[i].<a class="code" href="structbutton__definition.html#a9354e42b02d44b23794884f29cc25d78">instanceNumber</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(0);
<a name="l05459"></a>05459             buttonCount++;
<a name="l05460"></a>05460             btnSet = 1;
<a name="l05461"></a>05461             <span class="keywordflow">break</span>;
<a name="l05462"></a>05462       }
<a name="l05463"></a>05463    }
<a name="l05464"></a>05464 
<a name="l05465"></a>05465    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aeccc27699eb18669c1753cc2fd3ba382">buttontemplate</a>.<a class="code" href="structbutton__template__res__message.html#a8bfe0684eb73994b284e34cbab2ab7ec">buttonOffset</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(0);
<a name="l05466"></a>05466    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aeccc27699eb18669c1753cc2fd3ba382">buttontemplate</a>.<a class="code" href="structbutton__template__res__message.html#aa100098f03a37452cf695a63ec6cc205">buttonCount</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(buttonCount);
<a name="l05467"></a>05467    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aeccc27699eb18669c1753cc2fd3ba382">buttontemplate</a>.<a class="code" href="structbutton__template__res__message.html#a119c7a9d583c29cc7454bf18f9328527">totalButtonCount</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(buttonCount);
<a name="l05468"></a>05468 
<a name="l05469"></a>05469    <span class="keywordflow">if</span> (skinnydebug)
<a name="l05470"></a>05470       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Sending %d template to %s\n&quot;</span>,
<a name="l05471"></a>05471                d-&gt;type,
<a name="l05472"></a>05472                d-&gt;name);
<a name="l05473"></a>05473    <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l05474"></a>05474    <span class="keywordflow">return</span> 1;
<a name="l05475"></a>05475 }
<a name="l05476"></a>05476 
<a name="l05477"></a><a class="code" href="chan__skinny_8c.html#a31f03379857613754159979877ff9d31">05477</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a31f03379857613754159979877ff9d31">handle_version_req_message</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__req.html">skinny_req</a> *req, <span class="keyword">struct</span> <a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l05478"></a>05478 {
<a name="l05479"></a>05479    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d = s-&gt;<a class="code" href="structskinnysession.html#a70701ca9c2641bcb1740286273a0473a">device</a>;
<a name="l05480"></a>05480    <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structversion__res__message.html">version_res_message</a>), <a class="code" href="chan__skinny_8c.html#a12901431f5ab5e4cb9df9edc664e6d85">VERSION_RES_MESSAGE</a>)))
<a name="l05481"></a>05481       <span class="keywordflow">return</span> -1;
<a name="l05482"></a>05482 
<a name="l05483"></a>05483    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#ab39e2139ac39eb022bbe54356481ec1d">version</a>.<a class="code" href="structversion__res__message.html#a2eaaed79d5d4970bf38f17ccbfdbb035">version</a>, d-&gt;version_id, <span class="keyword">sizeof</span>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#ab39e2139ac39eb022bbe54356481ec1d">version</a>.<a class="code" href="structversion__res__message.html#a2eaaed79d5d4970bf38f17ccbfdbb035">version</a>));
<a name="l05484"></a>05484    <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l05485"></a>05485    <span class="keywordflow">return</span> 1;
<a name="l05486"></a>05486 }
<a name="l05487"></a>05487 
<a name="l05488"></a><a class="code" href="chan__skinny_8c.html#a950ddf064bd0e55b40d080f650549113">05488</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a950ddf064bd0e55b40d080f650549113">handle_server_request_message</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__req.html">skinny_req</a> *req, <span class="keyword">struct</span> <a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l05489"></a>05489 {
<a name="l05490"></a>05490    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d = s-&gt;<a class="code" href="structskinnysession.html#a70701ca9c2641bcb1740286273a0473a">device</a>;
<a name="l05491"></a>05491    <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structserver__res__message.html">server_res_message</a>), <a class="code" href="chan__skinny_8c.html#acfb45c382a52256b57620a7340c20a69">SERVER_RES_MESSAGE</a>)))
<a name="l05492"></a>05492       <span class="keywordflow">return</span> -1;
<a name="l05493"></a>05493 
<a name="l05494"></a>05494    memcpy(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a1e9a94870602b6a3227fe3ce05d3c13a">serverres</a>.<a class="code" href="structserver__res__message.html#a79e782cec3d53c0ec6b5922620d6a74f">server</a>[0].<a class="code" href="structserver__identifier.html#a24f34926c446be4afb4b2fef4538e524">serverName</a>, ourhost,
<a name="l05495"></a>05495          <span class="keyword">sizeof</span>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a1e9a94870602b6a3227fe3ce05d3c13a">serverres</a>.<a class="code" href="structserver__res__message.html#a79e782cec3d53c0ec6b5922620d6a74f">server</a>[0].<a class="code" href="structserver__identifier.html#a24f34926c446be4afb4b2fef4538e524">serverName</a>));
<a name="l05496"></a>05496    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a1e9a94870602b6a3227fe3ce05d3c13a">serverres</a>.<a class="code" href="structserver__res__message.html#a610e7308d2c7e6410d1728a991afd82e">serverListenPort</a>[0] = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(ourport);
<a name="l05497"></a>05497    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a1e9a94870602b6a3227fe3ce05d3c13a">serverres</a>.<a class="code" href="structserver__res__message.html#a696fd8eaa59bbf6a3b8c4d20c3a39ee0">serverIpAddr</a>[0] = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(d-&gt;<a class="code" href="structskinny__device.html#aff045cc68524670d4355f882c7ac6271">ourip</a>.s_addr);
<a name="l05498"></a>05498    <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l05499"></a>05499    <span class="keywordflow">return</span> 1;
<a name="l05500"></a>05500 }
<a name="l05501"></a>05501 
<a name="l05502"></a><a class="code" href="chan__skinny_8c.html#a371506325b3c5c8f36759a64648479ab">05502</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a371506325b3c5c8f36759a64648479ab">handle_alarm_message</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__req.html">skinny_req</a> *req, <span class="keyword">struct</span> <a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l05503"></a>05503 {
<a name="l05504"></a>05504    <span class="comment">/* no response necessary */</span>
<a name="l05505"></a>05505    <span class="keywordflow">if</span> (skinnydebug)
<a name="l05506"></a>05506       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Alarm Message: %s\n&quot;</span>, req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a00a93cc2ecf0e10506731d164fd2e49d">alarm</a>.<a class="code" href="structalarm__message.html#a6e7842182520ec6229e0903bf023290c">displayMessage</a>);
<a name="l05507"></a>05507 
<a name="l05508"></a>05508    <span class="keywordflow">return</span> 1;
<a name="l05509"></a>05509 }
<a name="l05510"></a>05510 
<a name="l05511"></a><a class="code" href="chan__skinny_8c.html#a0e967f0092b2ed2450643b9842a38ebe">05511</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a0e967f0092b2ed2450643b9842a38ebe">handle_open_receive_channel_ack_message</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__req.html">skinny_req</a> *req, <span class="keyword">struct</span> <a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l05512"></a>05512 {
<a name="l05513"></a>05513    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d = s-&gt;<a class="code" href="structskinnysession.html#a70701ca9c2641bcb1740286273a0473a">device</a>;
<a name="l05514"></a>05514    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l;
<a name="l05515"></a>05515    <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub;
<a name="l05516"></a>05516    <span class="keyword">struct </span><a class="code" href="structast__format__list.html" title="Definition of supported media formats (codecs).">ast_format_list</a> fmt;
<a name="l05517"></a>05517    <span class="keyword">struct </span>sockaddr_in sin;
<a name="l05518"></a>05518    <span class="keyword">struct </span>sockaddr_in us;
<a name="l05519"></a>05519    uint32_t addr;
<a name="l05520"></a>05520    <span class="keywordtype">int</span> port;
<a name="l05521"></a>05521    <span class="keywordtype">int</span> <a class="code" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>;
<a name="l05522"></a>05522    <span class="keywordtype">int</span> passthruid;
<a name="l05523"></a>05523 
<a name="l05524"></a>05524    status = <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a5a6cde0861dd60fad6a45fbae0633e44">openreceivechannelack</a>.<a class="code" href="structopen__receive__channel__ack__message.html#ade20423e91627f07e610924cb0081623">status</a>);
<a name="l05525"></a>05525    <span class="keywordflow">if</span> (status) {
<a name="l05526"></a>05526       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Open Receive Channel Failure\n&quot;</span>);
<a name="l05527"></a>05527       <span class="keywordflow">return</span> 0;
<a name="l05528"></a>05528    }
<a name="l05529"></a>05529    addr = <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a5a6cde0861dd60fad6a45fbae0633e44">openreceivechannelack</a>.<a class="code" href="structopen__receive__channel__ack__message.html#a597bb7df7851baf554b7310863015b2e">ipAddr</a>);
<a name="l05530"></a>05530    port = <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a5a6cde0861dd60fad6a45fbae0633e44">openreceivechannelack</a>.<a class="code" href="structopen__receive__channel__ack__message.html#a83a04ad582de2b7d36b96f9db429c2c6">port</a>);
<a name="l05531"></a>05531    passthruid = <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a5a6cde0861dd60fad6a45fbae0633e44">openreceivechannelack</a>.<a class="code" href="structopen__receive__channel__ack__message.html#af22e6c78114fae653c45640e3c2b6f7a">passThruId</a>);
<a name="l05532"></a>05532 
<a name="l05533"></a>05533    sin.sin_family = AF_INET;
<a name="l05534"></a>05534    sin.sin_addr.s_addr = addr;
<a name="l05535"></a>05535    sin.sin_port = htons(port);
<a name="l05536"></a>05536 
<a name="l05537"></a>05537    sub = <a class="code" href="chan__skinny_8c.html#acaafecebc752534270c786c48539a9ee">find_subchannel_by_reference</a>(d, passthruid);
<a name="l05538"></a>05538 
<a name="l05539"></a>05539    <span class="keywordflow">if</span> (!sub)
<a name="l05540"></a>05540       <span class="keywordflow">return</span> 0;
<a name="l05541"></a>05541 
<a name="l05542"></a>05542    l = sub-&gt;parent;
<a name="l05543"></a>05543 
<a name="l05544"></a>05544    <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a>) {
<a name="l05545"></a>05545       <a class="code" href="rtp_8h.html#a8731e858c93551d3bb56a2f297a9ef59">ast_rtp_set_peer</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, &amp;sin);
<a name="l05546"></a>05546       <a class="code" href="rtp_8h.html#a307269685e6f067a6abe35a184c3bae6">ast_rtp_get_us</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, &amp;us);
<a name="l05547"></a>05547    } <span class="keywordflow">else</span> {
<a name="l05548"></a>05548       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No RTP structure, this is very bad\n&quot;</span>);
<a name="l05549"></a>05549       <span class="keywordflow">return</span> 0;
<a name="l05550"></a>05550    }
<a name="l05551"></a>05551 
<a name="l05552"></a>05552    <span class="keywordflow">if</span> (skinnydebug)
<a name="l05553"></a>05553       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;ipaddr = %s:%d\n&quot;</span>, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(sin.sin_addr), ntohs(sin.sin_port));
<a name="l05554"></a>05554 
<a name="l05555"></a>05555    <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structstart__media__transmission__message.html">start_media_transmission_message</a>), <a class="code" href="chan__skinny_8c.html#aa8c4fd39788d87301b7b97543537a12c">START_MEDIA_TRANSMISSION_MESSAGE</a>)))
<a name="l05556"></a>05556       <span class="keywordflow">return</span> -1;
<a name="l05557"></a>05557 
<a name="l05558"></a>05558    fmt = <a class="code" href="frame_8h.html#ac9789499b866949ab31bab025b497964" title="Get packet size for codec.">ast_codec_pref_getsize</a>(&amp;l-&gt;prefs, <a class="code" href="channel_8h.html#a4d78194779a26341c3ec7298b450b9ed" title="Pick the best audio codec.">ast_best_codec</a>(l-&gt;capability));
<a name="l05559"></a>05559 
<a name="l05560"></a>05560    <span class="keywordflow">if</span> (skinnydebug)
<a name="l05561"></a>05561       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Setting payloadType to &apos;%d&apos; (%d ms)\n&quot;</span>, fmt.<a class="code" href="structast__format__list.html#ad1e28a1a66a25529b0b61b9ca4e66d44">bits</a>, fmt.<a class="code" href="structast__format__list.html#a8082330d5592ca639ddd6f7be0c0c39b">cur_ms</a>);
<a name="l05562"></a>05562 
<a name="l05563"></a>05563    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a42e0451ac6706cc1e6140aa7f48472a3">startmedia</a>.<a class="code" href="structstart__media__transmission__message.html#aad8282aaef639f3310f833e9b44a541e">conferenceId</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l05564"></a>05564    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a42e0451ac6706cc1e6140aa7f48472a3">startmedia</a>.<a class="code" href="structstart__media__transmission__message.html#ae7a8ce78da6117ddd5e98de15f85af23">passThruPartyId</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l05565"></a>05565    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a42e0451ac6706cc1e6140aa7f48472a3">startmedia</a>.<a class="code" href="structstart__media__transmission__message.html#ac4946ecf0faa3d0281b86b9df56cbc6f">remoteIp</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(d-&gt;<a class="code" href="structskinny__device.html#aff045cc68524670d4355f882c7ac6271">ourip</a>.s_addr);
<a name="l05566"></a>05566    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a42e0451ac6706cc1e6140aa7f48472a3">startmedia</a>.<a class="code" href="structstart__media__transmission__message.html#a52c51c79d848efbf9fbf291a2f2645c6">remotePort</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(ntohs(us.sin_port));
<a name="l05567"></a>05567    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a42e0451ac6706cc1e6140aa7f48472a3">startmedia</a>.<a class="code" href="structstart__media__transmission__message.html#ada112a060915d95bc25fb2917272914f">packetSize</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(fmt.<a class="code" href="structast__format__list.html#a8082330d5592ca639ddd6f7be0c0c39b">cur_ms</a>);
<a name="l05568"></a>05568    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a42e0451ac6706cc1e6140aa7f48472a3">startmedia</a>.<a class="code" href="structstart__media__transmission__message.html#aaf0b83c81dec67533a9edcf9f4c3c760">payloadType</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(<a class="code" href="chan__skinny_8c.html#a8e3a410f226a1ae0959bc3604421bcb7">codec_ast2skinny</a>(fmt.<a class="code" href="structast__format__list.html#ad1e28a1a66a25529b0b61b9ca4e66d44">bits</a>));
<a name="l05569"></a>05569    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a42e0451ac6706cc1e6140aa7f48472a3">startmedia</a>.<a class="code" href="structstart__media__transmission__message.html#a5304bc4afe911142322308d69ffe6466">qualifier</a>.<a class="code" href="structmedia__qualifier.html#a3f52bd316aba6dea4bc6374f5e4b0258">precedence</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(127);
<a name="l05570"></a>05570    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a42e0451ac6706cc1e6140aa7f48472a3">startmedia</a>.<a class="code" href="structstart__media__transmission__message.html#a5304bc4afe911142322308d69ffe6466">qualifier</a>.<a class="code" href="structmedia__qualifier.html#af22582b468205e3b1c3681dc5c28aa6b">vad</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(0);
<a name="l05571"></a>05571    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a42e0451ac6706cc1e6140aa7f48472a3">startmedia</a>.<a class="code" href="structstart__media__transmission__message.html#a5304bc4afe911142322308d69ffe6466">qualifier</a>.<a class="code" href="structmedia__qualifier.html#ab55cdaa8e99da057ceeb21efdd56909a">packets</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(0);
<a name="l05572"></a>05572    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a42e0451ac6706cc1e6140aa7f48472a3">startmedia</a>.<a class="code" href="structstart__media__transmission__message.html#a5304bc4afe911142322308d69ffe6466">qualifier</a>.<a class="code" href="structmedia__qualifier.html#a497243c8d5b9134495d3a68af76693c8">bitRate</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(0);
<a name="l05573"></a>05573    <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l05574"></a>05574 
<a name="l05575"></a>05575    <span class="keywordflow">return</span> 1;
<a name="l05576"></a>05576 }
<a name="l05577"></a>05577 
<a name="l05578"></a><a class="code" href="chan__skinny_8c.html#a6b153ba03b4ade85409b370040668b3a">05578</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a6b153ba03b4ade85409b370040668b3a">handle_enbloc_call_message</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__req.html">skinny_req</a> *req, <span class="keyword">struct</span> <a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l05579"></a>05579 {
<a name="l05580"></a>05580    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d = s-&gt;<a class="code" href="structskinnysession.html#a70701ca9c2641bcb1740286273a0473a">device</a>;
<a name="l05581"></a>05581    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l;
<a name="l05582"></a>05582    <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub = NULL;
<a name="l05583"></a>05583    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c;
<a name="l05584"></a>05584    pthread_t t;
<a name="l05585"></a>05585 
<a name="l05586"></a>05586    <span class="keywordflow">if</span> (skinnydebug)
<a name="l05587"></a>05587       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Enbloc Call: %s\n&quot;</span>, req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a8b760cddc80b9386b1ed58030b170a30">enbloccallmessage</a>.<a class="code" href="structenbloc__call__message.html#aaa9b00db6f95d4932ee8d3b825c73bca">calledParty</a>);
<a name="l05588"></a>05588 
<a name="l05589"></a>05589    sub = <a class="code" href="chan__skinny_8c.html#a10c715ff96a500b77ddc4442fa17cf55">find_subchannel_by_instance_reference</a>(d, d-&gt;lastlineinstance, d-&gt;lastcallreference);
<a name="l05590"></a>05590 
<a name="l05591"></a>05591    <span class="keywordflow">if</span> (!sub) {
<a name="l05592"></a>05592       l = <a class="code" href="chan__skinny_8c.html#a7b9ecaa4bb1481a9a5666e91c88a3968">find_line_by_instance</a>(d, d-&gt;lastlineinstance);
<a name="l05593"></a>05593       <span class="keywordflow">if</span> (!l) {
<a name="l05594"></a>05594          <span class="keywordflow">return</span> 0;
<a name="l05595"></a>05595       }
<a name="l05596"></a>05596    } <span class="keywordflow">else</span> {
<a name="l05597"></a>05597       l = sub-&gt;parent;
<a name="l05598"></a>05598    }
<a name="l05599"></a>05599 
<a name="l05600"></a>05600    c = <a class="code" href="chan__skinny_8c.html#a7d4cb293426c31e532f15f52fd8183fd">skinny_new</a>(l, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>);
<a name="l05601"></a>05601 
<a name="l05602"></a>05602    <span class="keywordflow">if</span>(!c) {
<a name="l05603"></a>05603       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create channel for %s@%s\n&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l05604"></a>05604    } <span class="keywordflow">else</span> {
<a name="l05605"></a>05605       l-&gt;hookstate = <a class="code" href="chan__skinny_8c.html#a2e10f13253ac5069f50f7f66b9511537">SKINNY_OFFHOOK</a>;
<a name="l05606"></a>05606 
<a name="l05607"></a>05607       sub = c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l05608"></a>05608       l-&gt;<a class="code" href="structskinny__line.html#aedffa4337f76fdcdc808e16affbafd04">activesub</a> = sub;
<a name="l05609"></a>05609       <a class="code" href="chan__skinny_8c.html#a0cb936a217935cdbaa71cc6cb5171b44">transmit_callstate</a>(d, l-&gt;instance, <a class="code" href="chan__skinny_8c.html#a2e10f13253ac5069f50f7f66b9511537">SKINNY_OFFHOOK</a>, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l05610"></a>05610       <span class="keywordflow">if</span> (skinnydebug)
<a name="l05611"></a>05611          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Attempting to Clear display on Skinny %s@%s\n&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l05612"></a>05612       <a class="code" href="chan__skinny_8c.html#ad2e667cc9fa19462ea433bac21b74c7b">transmit_displaymessage</a>(d, NULL, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>); <span class="comment">/* clear display */</span>
<a name="l05613"></a>05613       <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, <a class="code" href="chan__skinny_8c.html#a12616ab9d64a36f7c2f372084a3663c8">SKINNY_DIALTONE</a>, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l05614"></a>05614 
<a name="l05615"></a>05615       <span class="keywordflow">if</span> (!<a class="code" href="pbx_8h.html#aa73d176ed4f1ce51e5db6beafba45fe3" title="Checks to see if a number should be ignored.">ast_ignore_pattern</a>(c-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a8b760cddc80b9386b1ed58030b170a30">enbloccallmessage</a>.<a class="code" href="structenbloc__call__message.html#aaa9b00db6f95d4932ee8d3b825c73bca">calledParty</a>)) {
<a name="l05616"></a>05616          <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, <a class="code" href="chan__skinny_8c.html#a2c63c304c5e6eff4a0b13617eb4a9bed">SKINNY_SILENCE</a>, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l05617"></a>05617       }
<a name="l05618"></a>05618       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(c-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a8b760cddc80b9386b1ed58030b170a30">enbloccallmessage</a>.<a class="code" href="structenbloc__call__message.html#aaa9b00db6f95d4932ee8d3b825c73bca">calledParty</a>, <span class="keyword">sizeof</span>(c-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>));
<a name="l05619"></a>05619       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a4781fd54a4ca8c7f0f8a32a6cce503c0">ast_pthread_create</a>(&amp;t, NULL, <a class="code" href="chan__skinny_8c.html#a7341024ae1e485aaad445b8d2504b446">skinny_newcall</a>, c)) {
<a name="l05620"></a>05620          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create new call thread: %s\n&quot;</span>, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l05621"></a>05621          <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(c);
<a name="l05622"></a>05622       }
<a name="l05623"></a>05623    }
<a name="l05624"></a>05624    
<a name="l05625"></a>05625    <span class="keywordflow">return</span> 1;
<a name="l05626"></a>05626 }
<a name="l05627"></a>05627 
<a name="l05628"></a>05628 
<a name="l05629"></a><a class="code" href="chan__skinny_8c.html#a36d5c794f9d8c2d99417312340c7b708">05629</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a36d5c794f9d8c2d99417312340c7b708">handle_soft_key_set_req_message</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__req.html">skinny_req</a> *req, <span class="keyword">struct</span> <a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l05630"></a>05630 {
<a name="l05631"></a>05631    <span class="keywordtype">int</span> i;
<a name="l05632"></a>05632    <span class="keywordtype">int</span> x;
<a name="l05633"></a>05633    <span class="keywordtype">int</span> y;
<a name="l05634"></a>05634    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structsoft__key__definitions.html">soft_key_definitions</a> *softkeymode = soft_key_default_definitions;
<a name="l05635"></a>05635    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d = s-&gt;<a class="code" href="structskinnysession.html#a70701ca9c2641bcb1740286273a0473a">device</a>;
<a name="l05636"></a>05636 
<a name="l05637"></a>05637    <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structsoft__key__set__res__message.html">soft_key_set_res_message</a>), <a class="code" href="chan__skinny_8c.html#aee3cbe69978806b2ccea81e6931e5f06">SOFT_KEY_SET_RES_MESSAGE</a>)))
<a name="l05638"></a>05638       <span class="keywordflow">return</span> -1;
<a name="l05639"></a>05639 
<a name="l05640"></a>05640    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a2c1c09cd3cb77663c2963dd040506edd">softkeysets</a>.<a class="code" href="structsoft__key__set__res__message.html#a9e0609aa98d8027663e88c42524a391f">softKeySetOffset</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(0);
<a name="l05641"></a>05641    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a2c1c09cd3cb77663c2963dd040506edd">softkeysets</a>.<a class="code" href="structsoft__key__set__res__message.html#a821d404bc80c2b793f4d0bd3f125928b">softKeySetCount</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(11);
<a name="l05642"></a>05642    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a2c1c09cd3cb77663c2963dd040506edd">softkeysets</a>.<a class="code" href="structsoft__key__set__res__message.html#a626519dd0d8e97afdb9ab94f3f0514af">totalSoftKeySetCount</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(11);
<a name="l05643"></a>05643    <span class="keywordflow">for</span> (x = 0; x &lt; <span class="keyword">sizeof</span>(soft_key_default_definitions) / <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structsoft__key__definitions.html">soft_key_definitions</a>); x++) {
<a name="l05644"></a>05644       <span class="keyword">const</span> uint8_t *defaults = softkeymode-&gt;<a class="code" href="structsoft__key__definitions.html#a841d7c4569174bfa7f45657449a69b6f">defaults</a>;
<a name="l05645"></a>05645       <span class="comment">/* XXX I wanted to get the size of the array dynamically, but that wasn&apos;t wanting to work.</span>
<a name="l05646"></a>05646 <span class="comment">         This will have to do for now. */</span>
<a name="l05647"></a>05647       <span class="keywordflow">for</span> (y = 0; y &lt; softkeymode-&gt;<a class="code" href="structsoft__key__definitions.html#ada8f9c34ea6de0264c2d808acf540ad2">count</a>; y++) {
<a name="l05648"></a>05648          <span class="keywordflow">for</span> (i = 0; i &lt; (<span class="keyword">sizeof</span>(soft_key_template_default) / <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structsoft__key__template__definition.html">soft_key_template_definition</a>)); i++) {
<a name="l05649"></a>05649             <span class="keywordflow">if</span> (defaults[y] == i+1) {
<a name="l05650"></a>05650                req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a2c1c09cd3cb77663c2963dd040506edd">softkeysets</a>.<a class="code" href="structsoft__key__set__res__message.html#ab19f86d91e65941777c4e0c5a840fdae">softKeySetDefinition</a>[softkeymode-&gt;<a class="code" href="structsoft__key__definitions.html#a858b33a55c1de4c9bc94b982fc722754">mode</a>].<a class="code" href="structsoft__key__set__definition.html#a29a5f3fd75bf8ffa5df8c331c1ac3e18">softKeyTemplateIndex</a>[y] = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(i+1);
<a name="l05651"></a>05651                req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a2c1c09cd3cb77663c2963dd040506edd">softkeysets</a>.<a class="code" href="structsoft__key__set__res__message.html#ab19f86d91e65941777c4e0c5a840fdae">softKeySetDefinition</a>[softkeymode-&gt;<a class="code" href="structsoft__key__definitions.html#a858b33a55c1de4c9bc94b982fc722754">mode</a>].<a class="code" href="structsoft__key__set__definition.html#ac85b46723c412dd2807ee7345621cc3f">softKeyInfoIndex</a>[y] = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(i+301);
<a name="l05652"></a>05652             }
<a name="l05653"></a>05653          }
<a name="l05654"></a>05654       }
<a name="l05655"></a>05655       softkeymode++;
<a name="l05656"></a>05656    }
<a name="l05657"></a>05657    <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l05658"></a>05658    <a class="code" href="chan__skinny_8c.html#a5364d4b25cac8ec6f4572faf1434383d">transmit_selectsoftkeys</a>(d, 0, 0, <a class="code" href="chan__skinny_8c.html#aab983751d9fb47d03d07a9e9dd2b4776">KEYDEF_ONHOOK</a>);
<a name="l05659"></a>05659    <span class="keywordflow">return</span> 1;
<a name="l05660"></a>05660 }
<a name="l05661"></a>05661 
<a name="l05662"></a><a class="code" href="chan__skinny_8c.html#a2c55bb9609ddde15bace5fe2d7962b43">05662</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a2c55bb9609ddde15bace5fe2d7962b43">handle_soft_key_event_message</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__req.html">skinny_req</a> *req, <span class="keyword">struct</span> <a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l05663"></a>05663 {
<a name="l05664"></a>05664    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d = s-&gt;<a class="code" href="structskinnysession.html#a70701ca9c2641bcb1740286273a0473a">device</a>;
<a name="l05665"></a>05665    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l;
<a name="l05666"></a>05666    <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub = NULL;
<a name="l05667"></a>05667    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c;
<a name="l05668"></a>05668    pthread_t t;
<a name="l05669"></a>05669    <span class="keywordtype">int</span> event;
<a name="l05670"></a>05670    <span class="keywordtype">int</span> instance;
<a name="l05671"></a>05671    <span class="keywordtype">int</span> callreference;
<a name="l05672"></a>05672 
<a name="l05673"></a>05673    <span class="keyword">event</span> = <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aac712770efa4df6178f5dd12bb346907">softkeyeventmessage</a>.<a class="code" href="structsoft__key__event__message.html#a4358d46dc0a917c9906274cf85132904">softKeyEvent</a>);
<a name="l05674"></a>05674    instance = <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aac712770efa4df6178f5dd12bb346907">softkeyeventmessage</a>.<a class="code" href="structsoft__key__event__message.html#a9ed36c4f5392e9f1819ec7c9eb9aff80">instance</a>);
<a name="l05675"></a>05675    callreference = <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aac712770efa4df6178f5dd12bb346907">softkeyeventmessage</a>.<a class="code" href="structsoft__key__event__message.html#aa056c11f2f813407952d829437cec263">callreference</a>);
<a name="l05676"></a>05676 
<a name="l05677"></a>05677    <span class="keywordflow">if</span> (instance) {
<a name="l05678"></a>05678       l = <a class="code" href="chan__skinny_8c.html#a7b9ecaa4bb1481a9a5666e91c88a3968">find_line_by_instance</a>(d, instance);
<a name="l05679"></a>05679       <span class="keywordflow">if</span> (callreference) {
<a name="l05680"></a>05680          sub = <a class="code" href="chan__skinny_8c.html#a10c715ff96a500b77ddc4442fa17cf55">find_subchannel_by_instance_reference</a>(d, instance, callreference);
<a name="l05681"></a>05681       } <span class="keywordflow">else</span> {
<a name="l05682"></a>05682          sub = <a class="code" href="chan__skinny_8c.html#a10c715ff96a500b77ddc4442fa17cf55">find_subchannel_by_instance_reference</a>(d, instance, d-&gt;lastcallreference);
<a name="l05683"></a>05683       }
<a name="l05684"></a>05684    } <span class="keywordflow">else</span> {
<a name="l05685"></a>05685       l = <a class="code" href="chan__skinny_8c.html#a7b9ecaa4bb1481a9a5666e91c88a3968">find_line_by_instance</a>(d, d-&gt;lastlineinstance);
<a name="l05686"></a>05686    }
<a name="l05687"></a>05687 
<a name="l05688"></a>05688    <span class="keywordflow">if</span> (!l) {
<a name="l05689"></a>05689       <span class="keywordflow">if</span> (skinnydebug)
<a name="l05690"></a>05690          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Softkey Event: %d(%d/%d)\n&quot;</span>, event, instance, callreference);
<a name="l05691"></a>05691       <span class="keywordflow">return</span> 0;
<a name="l05692"></a>05692    }
<a name="l05693"></a>05693 
<a name="l05694"></a>05694    <a class="code" href="devicestate_8h.html#ac91fd8b93a2095c18ab86bd61c19ae46" title="Tells Asterisk the State for Device is changed.">ast_devstate_changed</a>(<a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea23aa227468c09b5ebd0fb01b4c895190">AST_DEVICE_INUSE</a>, <span class="stringliteral">&quot;Skinny/%s@%s&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l05695"></a>05695 
<a name="l05696"></a>05696    <span class="keywordflow">switch</span>(event) {
<a name="l05697"></a>05697    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#ae3ccec26212b7c55493ffa4865cbb88d">SOFTKEY_NONE</a>:
<a name="l05698"></a>05698       <span class="keywordflow">if</span> (skinnydebug)
<a name="l05699"></a>05699          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Softkey Event: None(%d/%d)\n&quot;</span>, instance, callreference);
<a name="l05700"></a>05700       <span class="keywordflow">break</span>;
<a name="l05701"></a>05701    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a32dc8fa6b998e84ecd2dd709774e25e9">SOFTKEY_REDIAL</a>:
<a name="l05702"></a>05702       <span class="keywordflow">if</span> (skinnydebug)
<a name="l05703"></a>05703          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Softkey Event: Redial(%d/%d)\n&quot;</span>, instance, callreference);
<a name="l05704"></a>05704 
<a name="l05705"></a>05705       <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(l-&gt;lastnumberdialed)) {
<a name="l05706"></a>05706          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Attempted redial, but no previously dialed number found.\n&quot;</span>);
<a name="l05707"></a>05707          l-&gt;hookstate = <a class="code" href="chan__skinny_8c.html#ad38b06a5edcc17eaa553739944e702e1">SKINNY_ONHOOK</a>;
<a name="l05708"></a>05708          <a class="code" href="chan__skinny_8c.html#a9d00b95f44b64f37d738f1ddc2ef972f">transmit_speaker_mode</a>(d, <a class="code" href="chan__skinny_8c.html#a0c90019de529b77fb06d587393ec42bf">SKINNY_SPEAKEROFF</a>);
<a name="l05709"></a>05709          <a class="code" href="chan__skinny_8c.html#a0cb936a217935cdbaa71cc6cb5171b44">transmit_callstate</a>(d, l-&gt;instance, <a class="code" href="chan__skinny_8c.html#ad38b06a5edcc17eaa553739944e702e1">SKINNY_ONHOOK</a>, instance);
<a name="l05710"></a>05710          <span class="keywordflow">break</span>;
<a name="l05711"></a>05711       }
<a name="l05712"></a>05712 
<a name="l05713"></a>05713       <span class="keywordflow">if</span> (!sub || !sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l05714"></a>05714          c = <a class="code" href="chan__skinny_8c.html#a7d4cb293426c31e532f15f52fd8183fd">skinny_new</a>(l, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>);
<a name="l05715"></a>05715       } <span class="keywordflow">else</span> {
<a name="l05716"></a>05716          c = sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l05717"></a>05717       }
<a name="l05718"></a>05718 
<a name="l05719"></a>05719       <span class="keywordflow">if</span> (!c) {
<a name="l05720"></a>05720          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create channel for %s@%s\n&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l05721"></a>05721       } <span class="keywordflow">else</span> {
<a name="l05722"></a>05722          sub = c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l05723"></a>05723          l-&gt;<a class="code" href="structskinny__line.html#aedffa4337f76fdcdc808e16affbafd04">activesub</a> = sub;
<a name="l05724"></a>05724          <span class="keywordflow">if</span> (l-&gt;hookstate == <a class="code" href="chan__skinny_8c.html#ad38b06a5edcc17eaa553739944e702e1">SKINNY_ONHOOK</a>) {
<a name="l05725"></a>05725             l-&gt;hookstate = <a class="code" href="chan__skinny_8c.html#a2e10f13253ac5069f50f7f66b9511537">SKINNY_OFFHOOK</a>;
<a name="l05726"></a>05726             <a class="code" href="chan__skinny_8c.html#a9d00b95f44b64f37d738f1ddc2ef972f">transmit_speaker_mode</a>(d, <a class="code" href="chan__skinny_8c.html#a379fd834cea6549831c799ed002b52f7">SKINNY_SPEAKERON</a>);
<a name="l05727"></a>05727             <a class="code" href="chan__skinny_8c.html#a0cb936a217935cdbaa71cc6cb5171b44">transmit_callstate</a>(d, l-&gt;instance, <a class="code" href="chan__skinny_8c.html#a2e10f13253ac5069f50f7f66b9511537">SKINNY_OFFHOOK</a>, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l05728"></a>05728          }
<a name="l05729"></a>05729          <span class="keywordflow">if</span> (skinnydebug)
<a name="l05730"></a>05730             <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Attempting to Clear display on Skinny %s@%s\n&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l05731"></a>05731          <a class="code" href="chan__skinny_8c.html#ad2e667cc9fa19462ea433bac21b74c7b">transmit_displaymessage</a>(d, NULL, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>); <span class="comment">/* clear display */</span>
<a name="l05732"></a>05732          <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, <a class="code" href="chan__skinny_8c.html#a12616ab9d64a36f7c2f372084a3663c8">SKINNY_DIALTONE</a>, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l05733"></a>05733          <a class="code" href="chan__skinny_8c.html#a5364d4b25cac8ec6f4572faf1434383d">transmit_selectsoftkeys</a>(d, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>, <a class="code" href="chan__skinny_8c.html#ae18cb03403da5513c2c6ac0c32c4c939">KEYDEF_RINGOUT</a>);
<a name="l05734"></a>05734 
<a name="l05735"></a>05735          <span class="keywordflow">if</span> (!<a class="code" href="pbx_8h.html#aa73d176ed4f1ce51e5db6beafba45fe3" title="Checks to see if a number should be ignored.">ast_ignore_pattern</a>(c-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, l-&gt;lastnumberdialed)) {
<a name="l05736"></a>05736             <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, <a class="code" href="chan__skinny_8c.html#a2c63c304c5e6eff4a0b13617eb4a9bed">SKINNY_SILENCE</a>, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l05737"></a>05737          }
<a name="l05738"></a>05738          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(c-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, l-&gt;lastnumberdialed, <span class="keyword">sizeof</span>(c-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>));
<a name="l05739"></a>05739          <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a4781fd54a4ca8c7f0f8a32a6cce503c0">ast_pthread_create</a>(&amp;t, NULL, <a class="code" href="chan__skinny_8c.html#a7341024ae1e485aaad445b8d2504b446">skinny_newcall</a>, c)) {
<a name="l05740"></a>05740             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create new call thread: %s\n&quot;</span>, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l05741"></a>05741             <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(c);
<a name="l05742"></a>05742          }
<a name="l05743"></a>05743       }
<a name="l05744"></a>05744       <span class="keywordflow">break</span>;
<a name="l05745"></a>05745    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#aee0ce143cf0a49d49c86cabcf1c829cc">SOFTKEY_NEWCALL</a>:  <span class="comment">/* Actually the DIAL softkey */</span>
<a name="l05746"></a>05746       <span class="keywordflow">if</span> (skinnydebug)
<a name="l05747"></a>05747          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Softkey Event: New Call(%d/%d)\n&quot;</span>, instance, callreference);
<a name="l05748"></a>05748 
<a name="l05749"></a>05749       <span class="comment">/* New Call ALWAYS gets a new sub-channel */</span>
<a name="l05750"></a>05750       c = <a class="code" href="chan__skinny_8c.html#a7d4cb293426c31e532f15f52fd8183fd">skinny_new</a>(l, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>);
<a name="l05751"></a>05751       sub = c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l05752"></a>05752    
<a name="l05753"></a>05753       <span class="comment">/* transmit_ringer_mode(d, SKINNY_RING_OFF);</span>
<a name="l05754"></a>05754 <span class="comment">      transmit_lamp_indication(d, STIMULUS_LINE, l-&gt;instance, SKINNY_LAMP_ON); */</span>
<a name="l05755"></a>05755 
<a name="l05756"></a>05756       <span class="comment">/* l-&gt;hookstate = SKINNY_OFFHOOK; */</span>
<a name="l05757"></a>05757 
<a name="l05758"></a>05758       <span class="keywordflow">if</span> (!c) {
<a name="l05759"></a>05759          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create channel for %s@%s\n&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l05760"></a>05760       } <span class="keywordflow">else</span> {
<a name="l05761"></a>05761          sub = c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l05762"></a>05762          l-&gt;<a class="code" href="structskinny__line.html#aedffa4337f76fdcdc808e16affbafd04">activesub</a> = sub;
<a name="l05763"></a>05763          <span class="keywordflow">if</span> (l-&gt;hookstate == <a class="code" href="chan__skinny_8c.html#ad38b06a5edcc17eaa553739944e702e1">SKINNY_ONHOOK</a>) {
<a name="l05764"></a>05764             l-&gt;hookstate = <a class="code" href="chan__skinny_8c.html#a2e10f13253ac5069f50f7f66b9511537">SKINNY_OFFHOOK</a>;
<a name="l05765"></a>05765             <a class="code" href="chan__skinny_8c.html#a9d00b95f44b64f37d738f1ddc2ef972f">transmit_speaker_mode</a>(d, <a class="code" href="chan__skinny_8c.html#a379fd834cea6549831c799ed002b52f7">SKINNY_SPEAKERON</a>);
<a name="l05766"></a>05766          }
<a name="l05767"></a>05767          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Call-id: %d\n&quot;</span>, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l05768"></a>05768 
<a name="l05769"></a>05769          <a class="code" href="chan__skinny_8c.html#a0cb936a217935cdbaa71cc6cb5171b44">transmit_callstate</a>(d, l-&gt;instance, <a class="code" href="chan__skinny_8c.html#a2e10f13253ac5069f50f7f66b9511537">SKINNY_OFFHOOK</a>, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l05770"></a>05770 
<a name="l05771"></a>05771          <span class="keywordflow">if</span> (skinnydebug)
<a name="l05772"></a>05772             <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Attempting to Clear display on Skinny %s@%s\n&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l05773"></a>05773          <a class="code" href="chan__skinny_8c.html#ad2e667cc9fa19462ea433bac21b74c7b">transmit_displaymessage</a>(d, NULL, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>); <span class="comment">/* clear display */</span>
<a name="l05774"></a>05774          <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, <a class="code" href="chan__skinny_8c.html#a12616ab9d64a36f7c2f372084a3663c8">SKINNY_DIALTONE</a>, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l05775"></a>05775          <a class="code" href="chan__skinny_8c.html#a5364d4b25cac8ec6f4572faf1434383d">transmit_selectsoftkeys</a>(d, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>, <a class="code" href="chan__skinny_8c.html#a32b4dedb91edf80328d5cda72166bf6e">KEYDEF_OFFHOOK</a>);
<a name="l05776"></a>05776 
<a name="l05777"></a>05777          <span class="comment">/* start the switch thread */</span>
<a name="l05778"></a>05778          <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a4781fd54a4ca8c7f0f8a32a6cce503c0">ast_pthread_create</a>(&amp;t, NULL, <a class="code" href="chan__skinny_8c.html#ad5d83012c464b49bfde0406a3dff68fe">skinny_ss</a>, c)) {
<a name="l05779"></a>05779             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create switch thread: %s\n&quot;</span>, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l05780"></a>05780             <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(c);
<a name="l05781"></a>05781          }
<a name="l05782"></a>05782       }
<a name="l05783"></a>05783       <span class="keywordflow">break</span>;
<a name="l05784"></a>05784    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#ab185c974c2da13dfd3d0fba53d1c4966">SOFTKEY_HOLD</a>:
<a name="l05785"></a>05785       <span class="keywordflow">if</span> (skinnydebug)
<a name="l05786"></a>05786          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Softkey Event: Hold(%d/%d)\n&quot;</span>, instance, callreference);
<a name="l05787"></a>05787       <a class="code" href="chan__skinny_8c.html#aa9d48518ce398e46ebf39a3eff38c849">handle_hold_button</a>(sub);   
<a name="l05788"></a>05788       <span class="keywordflow">break</span>;
<a name="l05789"></a>05789    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a666157a09f886de9effc7d648ad7dde8">SOFTKEY_TRNSFER</a>:
<a name="l05790"></a>05790       <span class="keywordflow">if</span> (skinnydebug)
<a name="l05791"></a>05791          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Softkey Event: Transfer(%d/%d)\n&quot;</span>, instance, callreference);
<a name="l05792"></a>05792       <span class="keywordflow">if</span> (l-&gt;transfer)
<a name="l05793"></a>05793          <a class="code" href="chan__skinny_8c.html#af725e197a8e1179ddd97a81b592dbb93">handle_transfer_button</a>(sub);
<a name="l05794"></a>05794       <span class="keywordflow">else</span>
<a name="l05795"></a>05795          <a class="code" href="chan__skinny_8c.html#a8122a36b30f8a86ffe3a06548fa8903c">transmit_displaynotify</a>(d, <span class="stringliteral">&quot;Transfer disabled&quot;</span>, 10);
<a name="l05796"></a>05796 
<a name="l05797"></a>05797       <span class="keywordflow">break</span>;
<a name="l05798"></a>05798    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a5673732b39310cef6a6f21820d95be71">SOFTKEY_DND</a>:
<a name="l05799"></a>05799       <span class="keywordflow">if</span> (skinnydebug)
<a name="l05800"></a>05800          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Softkey Event: DND(%d/%d)\n&quot;</span>, instance, callreference);
<a name="l05801"></a>05801 
<a name="l05802"></a>05802       <span class="comment">/* Do not disturb */</span>
<a name="l05803"></a>05803       <span class="keywordflow">if</span> (l-&gt;dnd != 0){
<a name="l05804"></a>05804          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Disabling DND on %s@%s\n&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l05805"></a>05805          l-&gt;dnd = 0;
<a name="l05806"></a>05806          <a class="code" href="chan__skinny_8c.html#aa16aabd900fdb4bd057303387115959f">transmit_lamp_indication</a>(d, <a class="code" href="chan__skinny_8c.html#a01245cf7008ec6fc7a898f2add35d1bd">STIMULUS_DND</a>, 1, <a class="code" href="chan__skinny_8c.html#a360e677a1a8e92ab455b8c354a15d969">SKINNY_LAMP_ON</a>);
<a name="l05807"></a>05807          <a class="code" href="chan__skinny_8c.html#a8122a36b30f8a86ffe3a06548fa8903c">transmit_displaynotify</a>(d, <span class="stringliteral">&quot;DnD disabled&quot;</span>, 10);
<a name="l05808"></a>05808       } <span class="keywordflow">else</span> {
<a name="l05809"></a>05809          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Enabling DND on %s@%s\n&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l05810"></a>05810          l-&gt;dnd = 1;
<a name="l05811"></a>05811          <a class="code" href="chan__skinny_8c.html#aa16aabd900fdb4bd057303387115959f">transmit_lamp_indication</a>(d, <a class="code" href="chan__skinny_8c.html#a01245cf7008ec6fc7a898f2add35d1bd">STIMULUS_DND</a>, 1, <a class="code" href="chan__skinny_8c.html#a87243536bbb96a314e88cfadd810f639">SKINNY_LAMP_OFF</a>);
<a name="l05812"></a>05812          <a class="code" href="chan__skinny_8c.html#a8122a36b30f8a86ffe3a06548fa8903c">transmit_displaynotify</a>(d, <span class="stringliteral">&quot;DnD enabled&quot;</span>, 10);
<a name="l05813"></a>05813       }
<a name="l05814"></a>05814       <span class="keywordflow">break</span>;
<a name="l05815"></a>05815    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a0045f3127762983aa2efee3a41e37c40">SOFTKEY_CFWDALL</a>:
<a name="l05816"></a>05816       <span class="keywordflow">if</span> (skinnydebug)
<a name="l05817"></a>05817          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Softkey Event: Forward All(%d/%d)\n&quot;</span>, instance, callreference);
<a name="l05818"></a>05818 
<a name="l05819"></a>05819       <span class="keywordflow">if</span> (!sub || !sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l05820"></a>05820          c = <a class="code" href="chan__skinny_8c.html#a7d4cb293426c31e532f15f52fd8183fd">skinny_new</a>(l, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>);
<a name="l05821"></a>05821       } <span class="keywordflow">else</span> {
<a name="l05822"></a>05822          c = sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l05823"></a>05823       }
<a name="l05824"></a>05824 
<a name="l05825"></a>05825       <span class="keywordflow">if</span> (!c) {
<a name="l05826"></a>05826          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create channel for %s@%s\n&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l05827"></a>05827       } <span class="keywordflow">else</span> {
<a name="l05828"></a>05828          sub = c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l05829"></a>05829          l-&gt;<a class="code" href="structskinny__line.html#aedffa4337f76fdcdc808e16affbafd04">activesub</a> = sub;
<a name="l05830"></a>05830          <a class="code" href="chan__skinny_8c.html#a82c88f8bbff9fac239c78d797a181343">handle_callforward_button</a>(sub, <a class="code" href="chan__skinny_8c.html#a1a77767cd4cfc70d096da50a2fefecd7">SKINNY_CFWD_ALL</a>);
<a name="l05831"></a>05831       }
<a name="l05832"></a>05832       <span class="keywordflow">break</span>;
<a name="l05833"></a>05833    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a744ad78b0f1ed0a0f678528bc64b1b86">SOFTKEY_CFWDBUSY</a>:
<a name="l05834"></a>05834       <span class="keywordflow">if</span> (skinnydebug)
<a name="l05835"></a>05835          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Softkey Event: Forward Busy (%d/%d)\n&quot;</span>, instance, callreference);
<a name="l05836"></a>05836 
<a name="l05837"></a>05837       <span class="keywordflow">if</span> (!sub || !sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l05838"></a>05838          c = <a class="code" href="chan__skinny_8c.html#a7d4cb293426c31e532f15f52fd8183fd">skinny_new</a>(l, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>);
<a name="l05839"></a>05839       } <span class="keywordflow">else</span> {
<a name="l05840"></a>05840          c = sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l05841"></a>05841       }
<a name="l05842"></a>05842 
<a name="l05843"></a>05843       <span class="keywordflow">if</span> (!c) {
<a name="l05844"></a>05844          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create channel for %s@%s\n&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l05845"></a>05845       } <span class="keywordflow">else</span> {
<a name="l05846"></a>05846          sub = c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l05847"></a>05847          l-&gt;<a class="code" href="structskinny__line.html#aedffa4337f76fdcdc808e16affbafd04">activesub</a> = sub;
<a name="l05848"></a>05848          <a class="code" href="chan__skinny_8c.html#a82c88f8bbff9fac239c78d797a181343">handle_callforward_button</a>(sub, <a class="code" href="chan__skinny_8c.html#a6cd59fd0c6c79219d38f437a485ce844">SKINNY_CFWD_BUSY</a>);
<a name="l05849"></a>05849       }
<a name="l05850"></a>05850       <span class="keywordflow">break</span>;
<a name="l05851"></a>05851    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a3c6159fb829fb3916ace06ed837f7b04">SOFTKEY_CFWDNOANSWER</a>:
<a name="l05852"></a>05852       <span class="keywordflow">if</span> (skinnydebug)
<a name="l05853"></a>05853          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Softkey Event: Forward No Answer (%d/%d)\n&quot;</span>, instance, callreference);
<a name="l05854"></a>05854 
<a name="l05855"></a>05855 <span class="preprocessor">#if 0 </span><span class="comment">/* Not sure how to handle this yet */</span>
<a name="l05856"></a>05856       <span class="keywordflow">if</span> (!sub || !sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l05857"></a>05857          c = <a class="code" href="chan__skinny_8c.html#a7d4cb293426c31e532f15f52fd8183fd">skinny_new</a>(l, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>);
<a name="l05858"></a>05858       } <span class="keywordflow">else</span> {
<a name="l05859"></a>05859          c = sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l05860"></a>05860       }
<a name="l05861"></a>05861 
<a name="l05862"></a>05862       <span class="keywordflow">if</span> (!c) {
<a name="l05863"></a>05863          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create channel for %s@%s\n&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l05864"></a>05864       } <span class="keywordflow">else</span> {
<a name="l05865"></a>05865          sub = c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l05866"></a>05866          l-&gt;<a class="code" href="structskinny__line.html#aedffa4337f76fdcdc808e16affbafd04">activesub</a> = sub;
<a name="l05867"></a>05867          <a class="code" href="chan__skinny_8c.html#a82c88f8bbff9fac239c78d797a181343">handle_callforward_button</a>(sub, <a class="code" href="chan__skinny_8c.html#a805d890f6df0e6cf5d9f281791d2a318">SKINNY_CFWD_NOANSWER</a>);
<a name="l05868"></a>05868       }
<a name="l05869"></a>05869 <span class="preprocessor">#endif</span>
<a name="l05870"></a>05870 <span class="preprocessor"></span>      <span class="keywordflow">break</span>;
<a name="l05871"></a>05871    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a8faf0f3196e7a21d01dbbb7719bf11e7">SOFTKEY_BKSPC</a>:
<a name="l05872"></a>05872       <span class="keywordflow">if</span> (skinnydebug)
<a name="l05873"></a>05873          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Softkey Event: Backspace(%d/%d)\n&quot;</span>, instance, callreference);
<a name="l05874"></a>05874       <span class="keywordflow">break</span>;
<a name="l05875"></a>05875    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#aabbdbf515a0e193662eb006117759b00">SOFTKEY_ENDCALL</a>:
<a name="l05876"></a>05876       <span class="keywordflow">if</span> (skinnydebug)
<a name="l05877"></a>05877          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Softkey Event: End Call(%d/%d)\n&quot;</span>, instance, callreference);
<a name="l05878"></a>05878 
<a name="l05879"></a>05879       <span class="keywordflow">if</span> (l-&gt;hookstate == <a class="code" href="chan__skinny_8c.html#ad38b06a5edcc17eaa553739944e702e1">SKINNY_ONHOOK</a>) {
<a name="l05880"></a>05880          <span class="comment">/* Something else already put us back on hook */</span>
<a name="l05881"></a>05881          <span class="keywordflow">break</span>;
<a name="l05882"></a>05882       }
<a name="l05883"></a>05883       <span class="keywordflow">if</span> (sub) {
<a name="l05884"></a>05884          <span class="keywordtype">int</span> onlysub = 0;
<a name="l05885"></a>05885 
<a name="l05886"></a>05886          <span class="keywordflow">if</span> (!<a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(sub, list)) {
<a name="l05887"></a>05887             onlysub = 1;
<a name="l05888"></a>05888          } <span class="keywordflow">else</span> {
<a name="l05889"></a>05889             <a class="code" href="linkedlists_8h.html#aa36e72b77f1b80881cd0a9fcca66ce19" title="Removes a specific entry from a list.">AST_LIST_REMOVE</a>(&amp;l-&gt;sub, sub, list);
<a name="l05890"></a>05890          }
<a name="l05891"></a>05891 
<a name="l05892"></a>05892          sub-&gt;<a class="code" href="structskinny__subchannel.html#a4650e5e1429f8982af64b9c42c8c53d3">cxmode</a> = <a class="code" href="chan__skinny_8c.html#a7300c46280f93b446c8e13b404f55e36">SKINNY_CX_RECVONLY</a>;
<a name="l05893"></a>05893          <span class="keywordflow">if</span> (onlysub || sub-&gt;<a class="code" href="structskinny__subchannel.html#a04f1e042676be8f4763d8d5a9000b1e5">xferor</a>){    <span class="comment">/*Are there other calls to this device */</span>
<a name="l05894"></a>05894             l-&gt;hookstate = <a class="code" href="chan__skinny_8c.html#ad38b06a5edcc17eaa553739944e702e1">SKINNY_ONHOOK</a>;
<a name="l05895"></a>05895             <span class="keywordflow">if</span> (skinnydebug)
<a name="l05896"></a>05896                <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Skinny %s@%s-%d went on hook\n&quot;</span>, l-&gt;name, d-&gt;name, callreference);
<a name="l05897"></a>05897          }
<a name="l05898"></a>05898 
<a name="l05899"></a>05899          <a class="code" href="chan__skinny_8c.html#a0cb936a217935cdbaa71cc6cb5171b44">transmit_callstate</a>(d, l-&gt;instance, l-&gt;hookstate, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l05900"></a>05900          <a class="code" href="devicestate_8h.html#ac91fd8b93a2095c18ab86bd61c19ae46" title="Tells Asterisk the State for Device is changed.">ast_devstate_changed</a>(<a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeadee91fc4886ffc7b4efb8459cef48fe2">AST_DEVICE_NOT_INUSE</a>, <span class="stringliteral">&quot;Skinny/%s@%s&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l05901"></a>05901          <span class="keywordflow">if</span> (skinnydebug)
<a name="l05902"></a>05902             <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Skinny %s@%s went on hook\n&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l05903"></a>05903          <span class="keywordflow">if</span> (l-&gt;transfer &amp;&amp; sub-&gt;<a class="code" href="structskinny__subchannel.html#a04f1e042676be8f4763d8d5a9000b1e5">xferor</a> &amp;&amp; sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> &gt;= <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>) {
<a name="l05904"></a>05904             <span class="comment">/* We&apos;re allowed to transfer, we have two active calls and</span>
<a name="l05905"></a>05905 <span class="comment">               we made at least one of the calls.  Let&apos;s try and transfer */</span>
<a name="l05906"></a>05906             <a class="code" href="chan__skinny_8c.html#af725e197a8e1179ddd97a81b592dbb93">handle_transfer_button</a>(sub);
<a name="l05907"></a>05907          } <span class="keywordflow">else</span> {
<a name="l05908"></a>05908             <span class="comment">/* Hangup the current call */</span>
<a name="l05909"></a>05909             <span class="comment">/* If there is another active call, skinny_hangup will ring the phone with the other call */</span>
<a name="l05910"></a>05910             <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#a04f1e042676be8f4763d8d5a9000b1e5">xferor</a> &amp;&amp; sub-&gt;related){
<a name="l05911"></a>05911                sub-&gt;related-&gt;related = NULL;
<a name="l05912"></a>05912                sub-&gt;related-&gt;<a class="code" href="structskinny__subchannel.html#a9d49074e0655a086adb6bcc670b06f23">blindxfer</a> = 0;
<a name="l05913"></a>05913             }
<a name="l05914"></a>05914 
<a name="l05915"></a>05915             <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l05916"></a>05916                sub-&gt;<a class="code" href="structskinny__subchannel.html#ac43993a73742eff145b861107a1afa0d">alreadygone</a> = 1;
<a name="l05917"></a>05917                <a class="code" href="channel_8h.html#a30bcf0418189567bc84ff32034f79f28" title="Queue a hangup frame.">ast_queue_hangup</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l05918"></a>05918             } <span class="keywordflow">else</span> {
<a name="l05919"></a>05919                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Skinny(%s@%s-%d) channel already destroyed\n&quot;</span>,
<a name="l05920"></a>05920                   l-&gt;name, d-&gt;name, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l05921"></a>05921             }
<a name="l05922"></a>05922          }
<a name="l05923"></a>05923          <span class="keywordflow">if</span> ((l-&gt;hookstate == <a class="code" href="chan__skinny_8c.html#ad38b06a5edcc17eaa553739944e702e1">SKINNY_ONHOOK</a>) &amp;&amp; (<a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(sub, list) &amp;&amp; !<a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(sub, list)-&gt;<a class="code" href="structskinny__subchannel.html#aba39773f04fd6540d56897b3d0396086">rtp</a>)) {
<a name="l05924"></a>05924             <a class="code" href="devicestate_8h.html#ac91fd8b93a2095c18ab86bd61c19ae46" title="Tells Asterisk the State for Device is changed.">ast_devstate_changed</a>(<a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeadee91fc4886ffc7b4efb8459cef48fe2">AST_DEVICE_NOT_INUSE</a>, <span class="stringliteral">&quot;Skinny/%s@%s&quot;</span>, l-&gt;name, d-&gt;name);
<a name="l05925"></a>05925          }
<a name="l05926"></a>05926       }
<a name="l05927"></a>05927       <span class="keywordflow">break</span>;
<a name="l05928"></a>05928    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#af1726f9c94deb2725bdd8fabf57f1a53">SOFTKEY_RESUME</a>:
<a name="l05929"></a>05929       <span class="keywordflow">if</span> (skinnydebug)
<a name="l05930"></a>05930          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Softkey Event: Resume(%d/%d)\n&quot;</span>, instance, callreference);
<a name="l05931"></a>05931 
<a name="l05932"></a>05932       <span class="keywordflow">if</span> (sub) {
<a name="l05933"></a>05933          <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#a46585eaf56ac8588fa673c1c089f0238">onhold</a>) {
<a name="l05934"></a>05934             <a class="code" href="chan__skinny_8c.html#a00669e605357a5f37460c33e0917cc72">skinny_unhold</a>(sub);
<a name="l05935"></a>05935             <a class="code" href="chan__skinny_8c.html#a5364d4b25cac8ec6f4572faf1434383d">transmit_selectsoftkeys</a>(d, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>, <a class="code" href="chan__skinny_8c.html#aad5f46f88fa82da05103795046e110b7">KEYDEF_CONNECTED</a>);
<a name="l05936"></a>05936          } <span class="keywordflow">else</span> {
<a name="l05937"></a>05937             <a class="code" href="chan__skinny_8c.html#ab83ed9e7df10c7f6008833ab7ab1bc0d">skinny_hold</a>(sub);
<a name="l05938"></a>05938             <a class="code" href="chan__skinny_8c.html#a5364d4b25cac8ec6f4572faf1434383d">transmit_selectsoftkeys</a>(d, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>, <a class="code" href="chan__skinny_8c.html#a1c1b2ec6acc543dbd96c917364d733e3">KEYDEF_ONHOLD</a>);
<a name="l05939"></a>05939          }
<a name="l05940"></a>05940       }
<a name="l05941"></a>05941 
<a name="l05942"></a>05942       <span class="keywordflow">break</span>;
<a name="l05943"></a>05943    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a3b3e11372b76c65944afdea7205fa209">SOFTKEY_ANSWER</a>:
<a name="l05944"></a>05944       <span class="keywordflow">if</span> (skinnydebug)
<a name="l05945"></a>05945          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Softkey Event: Answer(%d/%d)\n&quot;</span>, instance, callreference);
<a name="l05946"></a>05946 
<a name="l05947"></a>05947       <a class="code" href="chan__skinny_8c.html#a4f65a9ef12827334502722b4cd8919c6">transmit_ringer_mode</a>(d, <a class="code" href="chan__skinny_8c.html#aecd793ced0012f548eaf003e4609e994">SKINNY_RING_OFF</a>);
<a name="l05948"></a>05948       <a class="code" href="chan__skinny_8c.html#aa16aabd900fdb4bd057303387115959f">transmit_lamp_indication</a>(d, <a class="code" href="chan__skinny_8c.html#af5c47ae0f0932f1d461f5b7b4cc0b095">STIMULUS_LINE</a>, l-&gt;instance, <a class="code" href="chan__skinny_8c.html#a360e677a1a8e92ab455b8c354a15d969">SKINNY_LAMP_ON</a>);
<a name="l05949"></a>05949       <span class="keywordflow">if</span> (l-&gt;hookstate == <a class="code" href="chan__skinny_8c.html#ad38b06a5edcc17eaa553739944e702e1">SKINNY_ONHOOK</a>) {
<a name="l05950"></a>05950          <a class="code" href="chan__skinny_8c.html#a9d00b95f44b64f37d738f1ddc2ef972f">transmit_speaker_mode</a>(d, <a class="code" href="chan__skinny_8c.html#a379fd834cea6549831c799ed002b52f7">SKINNY_SPEAKERON</a>);
<a name="l05951"></a>05951          l-&gt;hookstate = <a class="code" href="chan__skinny_8c.html#a2e10f13253ac5069f50f7f66b9511537">SKINNY_OFFHOOK</a>;
<a name="l05952"></a>05952       }
<a name="l05953"></a>05953 
<a name="l05954"></a>05954       <span class="keywordflow">if</span> (sub &amp;&amp; sub-&gt;<a class="code" href="structskinny__subchannel.html#a586fc7c710ade15aabab8f223e53fdd9">outgoing</a>) {
<a name="l05955"></a>05955          <span class="comment">/* We&apos;re answering a ringing call */</span>
<a name="l05956"></a>05956          <a class="code" href="channel_8h.html#a60f9d2b0ab8b7a839902313321163b28" title="Queue a control frame with payload.">ast_queue_control</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>);
<a name="l05957"></a>05957          <a class="code" href="chan__skinny_8c.html#a0cb936a217935cdbaa71cc6cb5171b44">transmit_callstate</a>(d, l-&gt;instance, <a class="code" href="chan__skinny_8c.html#a2e10f13253ac5069f50f7f66b9511537">SKINNY_OFFHOOK</a>, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l05958"></a>05958          <a class="code" href="chan__skinny_8c.html#a27234a48baa82c80262b21a69782aafd">transmit_tone</a>(d, <a class="code" href="chan__skinny_8c.html#a2c63c304c5e6eff4a0b13617eb4a9bed">SKINNY_SILENCE</a>, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>);
<a name="l05959"></a>05959          <a class="code" href="chan__skinny_8c.html#a891052a3d2334a56e4b5df01988ad8fb">transmit_callstateonly</a>(d, sub, <a class="code" href="chan__skinny_8c.html#a1b0b13fd37b0eec0ebbc6031c91d4662">SKINNY_CONNECTED</a>);
<a name="l05960"></a>05960          <a class="code" href="chan__skinny_8c.html#a5364d4b25cac8ec6f4572faf1434383d">transmit_selectsoftkeys</a>(d, l-&gt;instance, sub-&gt;<a class="code" href="structskinny__subchannel.html#a5664ba9ada8edc9a6112efdd609a8216">callid</a>, <a class="code" href="chan__skinny_8c.html#aad5f46f88fa82da05103795046e110b7">KEYDEF_CONNECTED</a>);
<a name="l05961"></a>05961          <a class="code" href="chan__skinny_8c.html#afdd465471ea50755ff86f47ead660ea0">start_rtp</a>(sub);
<a name="l05962"></a>05962          <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>);
<a name="l05963"></a>05963       }
<a name="l05964"></a>05964       <span class="keywordflow">break</span>;
<a name="l05965"></a>05965    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a62c9ec7d264add3d067520147bcf73ef">SOFTKEY_INFO</a>:
<a name="l05966"></a>05966       <span class="keywordflow">if</span> (skinnydebug)
<a name="l05967"></a>05967          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Softkey Event: Info(%d/%d)\n&quot;</span>, instance, callreference);
<a name="l05968"></a>05968       <span class="keywordflow">break</span>;
<a name="l05969"></a>05969    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a50a64a17998ee0c20b7ea929f06f7371">SOFTKEY_CONFRN</a>:
<a name="l05970"></a>05970       <span class="keywordflow">if</span> (skinnydebug)
<a name="l05971"></a>05971          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Softkey Event: Conference(%d/%d)\n&quot;</span>, instance, callreference);
<a name="l05972"></a>05972       <span class="comment">/* XXX determine the best way to pull off a conference.  Meetme? */</span>
<a name="l05973"></a>05973       <span class="keywordflow">break</span>;
<a name="l05974"></a>05974    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a572b1d3a412d0e3eec76ed6888d88885">SOFTKEY_PARK</a>:
<a name="l05975"></a>05975       {
<a name="l05976"></a>05976       <span class="keywordtype">int</span> extout;
<a name="l05977"></a>05977       <span class="keywordtype">char</span> <a class="code" href="structmessage.html">message</a>[32];
<a name="l05978"></a>05978 
<a name="l05979"></a>05979       <span class="keywordflow">if</span> (skinnydebug)
<a name="l05980"></a>05980          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Softkey Event: Park Call(%d/%d)\n&quot;</span>, instance, callreference);
<a name="l05981"></a>05981 
<a name="l05982"></a>05982       <span class="keywordflow">if</span> ((sub &amp;&amp; sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) &amp;&amp; (sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> ==  <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>)){
<a name="l05983"></a>05983          c = sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l05984"></a>05984          <span class="keywordflow">if</span> (!<a class="code" href="features_8h.html#a70a2de2bf789996ae5e66142294ca18f" title="Park a call via a masqueraded channel.">ast_masq_park_call</a>(<a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(c), c, 0, &amp;extout)) {
<a name="l05985"></a>05985             snprintf(message, <span class="keyword">sizeof</span>(message), <span class="stringliteral">&quot;Call Parked at: %d&quot;</span>, extout);
<a name="l05986"></a>05986             <a class="code" href="chan__skinny_8c.html#a8122a36b30f8a86ffe3a06548fa8903c">transmit_displaynotify</a>(d, message, 10);
<a name="l05987"></a>05987          } <span class="keywordflow">else</span> {
<a name="l05988"></a>05988             <a class="code" href="chan__skinny_8c.html#a8122a36b30f8a86ffe3a06548fa8903c">transmit_displaynotify</a>(d, <span class="stringliteral">&quot;Call Park failed&quot;</span>, 10);
<a name="l05989"></a>05989          }
<a name="l05990"></a>05990       } <span class="keywordflow">else</span> {
<a name="l05991"></a>05991          <a class="code" href="chan__skinny_8c.html#a8122a36b30f8a86ffe3a06548fa8903c">transmit_displaynotify</a>(d, <span class="stringliteral">&quot;Call Park not available&quot;</span>, 10);
<a name="l05992"></a>05992       }
<a name="l05993"></a>05993       }
<a name="l05994"></a>05994       <span class="keywordflow">break</span>;
<a name="l05995"></a>05995    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#aba3c2540666fbf54305aeaa2cfd85fef">SOFTKEY_JOIN</a>:
<a name="l05996"></a>05996       <span class="keywordflow">if</span> (skinnydebug)
<a name="l05997"></a>05997          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Softkey Event: Join(%d/%d)\n&quot;</span>, instance, callreference);
<a name="l05998"></a>05998       <span class="keywordflow">break</span>;
<a name="l05999"></a>05999    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a4b72ea00639536a0cc23d112890d4bc2">SOFTKEY_MEETME</a>:
<a name="l06000"></a>06000       <span class="comment">/* XXX How is this different from CONFRN? */</span>
<a name="l06001"></a>06001       <span class="keywordflow">if</span> (skinnydebug)
<a name="l06002"></a>06002          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Softkey Event: Meetme(%d/%d)\n&quot;</span>, instance, callreference);
<a name="l06003"></a>06003       <span class="keywordflow">break</span>;
<a name="l06004"></a>06004    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#aa4f7a1e0fe94c644277ca765f1d5862c">SOFTKEY_PICKUP</a>:
<a name="l06005"></a>06005       <span class="keywordflow">if</span> (skinnydebug)
<a name="l06006"></a>06006          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Softkey Event: Pickup(%d/%d)\n&quot;</span>, instance, callreference);
<a name="l06007"></a>06007       <span class="keywordflow">break</span>;
<a name="l06008"></a>06008    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#add8c1a6457db2951e7a1ca2395e3da62">SOFTKEY_GPICKUP</a>:
<a name="l06009"></a>06009       <span class="keywordflow">if</span> (skinnydebug)
<a name="l06010"></a>06010          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Softkey Event: Group Pickup(%d/%d)\n&quot;</span>, instance, callreference);
<a name="l06011"></a>06011       <span class="keywordflow">break</span>;
<a name="l06012"></a>06012    <span class="keywordflow">default</span>:
<a name="l06013"></a>06013       <span class="keywordflow">if</span> (skinnydebug)
<a name="l06014"></a>06014          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received unknown Softkey Event: %d(%d/%d)\n&quot;</span>, event, instance, callreference);
<a name="l06015"></a>06015       <span class="keywordflow">break</span>;
<a name="l06016"></a>06016    }
<a name="l06017"></a>06017 
<a name="l06018"></a>06018    <span class="keywordflow">return</span> 1;
<a name="l06019"></a>06019 }
<a name="l06020"></a>06020 
<a name="l06021"></a><a class="code" href="chan__skinny_8c.html#ac2ff777262737f58dba8364caa1cf921">06021</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#ac2ff777262737f58dba8364caa1cf921">handle_unregister_message</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__req.html">skinny_req</a> *req, <span class="keyword">struct</span> <a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l06022"></a>06022 {
<a name="l06023"></a>06023    <span class="keywordflow">return</span> <a class="code" href="chan__skinny_8c.html#aac25ed22beafaebfee5acb276c2e0d28">skinny_unregister</a>(req, s);
<a name="l06024"></a>06024 }
<a name="l06025"></a>06025 
<a name="l06026"></a><a class="code" href="chan__skinny_8c.html#a4ef63024063c091aeeef49c3570c7514">06026</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a4ef63024063c091aeeef49c3570c7514">handle_soft_key_template_req_message</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__req.html">skinny_req</a> *req, <span class="keyword">struct</span> <a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l06027"></a>06027 {
<a name="l06028"></a>06028    <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structsoft__key__template__res__message.html">soft_key_template_res_message</a>), <a class="code" href="chan__skinny_8c.html#aa48c2edb2669fe7c10ed6b6b5efa2e05">SOFT_KEY_TEMPLATE_RES_MESSAGE</a>)))
<a name="l06029"></a>06029       <span class="keywordflow">return</span> -1;
<a name="l06030"></a>06030 
<a name="l06031"></a>06031    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a72600783648a844a5e45e185f42e00c4">softkeytemplate</a>.<a class="code" href="structsoft__key__template__res__message.html#aeb69bb0f70da60dbba0bf2e7c5fdd33d">softKeyOffset</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(0);
<a name="l06032"></a>06032    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a72600783648a844a5e45e185f42e00c4">softkeytemplate</a>.<a class="code" href="structsoft__key__template__res__message.html#a8db1b287e91a13a96808f529a4dc49e9">softKeyCount</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(<span class="keyword">sizeof</span>(soft_key_template_default) / <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structsoft__key__template__definition.html">soft_key_template_definition</a>));
<a name="l06033"></a>06033    req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a72600783648a844a5e45e185f42e00c4">softkeytemplate</a>.<a class="code" href="structsoft__key__template__res__message.html#a48b489a0ba6479db34f7c580f40af762">totalSoftKeyCount</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(<span class="keyword">sizeof</span>(soft_key_template_default) / <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structsoft__key__template__definition.html">soft_key_template_definition</a>));
<a name="l06034"></a>06034    memcpy(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a72600783648a844a5e45e185f42e00c4">softkeytemplate</a>.<a class="code" href="structsoft__key__template__res__message.html#ad6fd242c4e813675148ea902f327e4f1">softKeyTemplateDefinition</a>,
<a name="l06035"></a>06035       soft_key_template_default,
<a name="l06036"></a>06036       <span class="keyword">sizeof</span>(soft_key_template_default));
<a name="l06037"></a>06037    <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(s-&gt;<a class="code" href="structskinnysession.html#a70701ca9c2641bcb1740286273a0473a">device</a>, req);
<a name="l06038"></a>06038    <span class="keywordflow">return</span> 1;
<a name="l06039"></a>06039 }
<a name="l06040"></a>06040 
<a name="l06041"></a><a class="code" href="chan__skinny_8c.html#a5738cebd023fa44b2b46a069bf4006e3">06041</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a5738cebd023fa44b2b46a069bf4006e3">handle_headset_status_message</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__req.html">skinny_req</a> *req, <span class="keyword">struct</span> <a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l06042"></a>06042 {
<a name="l06043"></a>06043    <span class="comment">/* XXX umm...okay?  Why do I care? */</span>
<a name="l06044"></a>06044    <span class="keywordflow">return</span> 1;
<a name="l06045"></a>06045 }
<a name="l06046"></a>06046 
<a name="l06047"></a><a class="code" href="chan__skinny_8c.html#ab51bcbe920bd0dbdd70510befa2aecc9">06047</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#ab51bcbe920bd0dbdd70510befa2aecc9">handle_register_available_lines_message</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__req.html">skinny_req</a> *req, <span class="keyword">struct</span> <a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l06048"></a>06048 {
<a name="l06049"></a>06049    <span class="comment">/* XXX I have no clue what this is for, but my phone was sending it, so... */</span>
<a name="l06050"></a>06050    <span class="keywordflow">return</span> 1;
<a name="l06051"></a>06051 }
<a name="l06052"></a>06052 
<a name="l06053"></a><a class="code" href="chan__skinny_8c.html#af4e0e1821262024a6a2c5dafe646c775">06053</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#af4e0e1821262024a6a2c5dafe646c775">handle_message</a>(<span class="keyword">struct</span> <a class="code" href="structskinny__req.html">skinny_req</a> *req, <span class="keyword">struct</span> <a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l06054"></a>06054 {
<a name="l06055"></a>06055    <span class="keywordtype">int</span> res = 0;
<a name="l06056"></a>06056 
<a name="l06057"></a>06057    <span class="keywordflow">if</span> ((!s-&gt;<a class="code" href="structskinnysession.html#a70701ca9c2641bcb1740286273a0473a">device</a>) &amp;&amp; (<a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#a88859ce72faebb79ea0a2bca00a0f46b">e</a>) != <a class="code" href="chan__skinny_8c.html#aec789812d6cc0ff846fb308745e91531">REGISTER_MESSAGE</a> &amp;&amp; <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#a88859ce72faebb79ea0a2bca00a0f46b">e</a>) != <a class="code" href="chan__skinny_8c.html#ae2a02a450e18eeb46029c20efadd4ab3">ALARM_MESSAGE</a>)) {
<a name="l06058"></a>06058       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Client sent message #%d without first registering.\n&quot;</span>, req-&gt;<a class="code" href="structskinny__req.html#a88859ce72faebb79ea0a2bca00a0f46b">e</a>);
<a name="l06059"></a>06059       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(req);
<a name="l06060"></a>06060       <span class="keywordflow">return</span> 0;
<a name="l06061"></a>06061    }
<a name="l06062"></a>06062 
<a name="l06063"></a>06063    <a class="code" href="chan__skinny_8c.html#af74ed86d376b6d64e63fa69f16d4ce1f">SKINNY_DEVONLY</a>(<span class="keywordflow">if</span> (skinnydebug &gt; 1) {
<a name="l06064"></a>06064       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(4, <span class="stringliteral">&quot;Received %s from %s\n&quot;</span>, message2str(req-&gt;<a class="code" href="structskinny__req.html#a88859ce72faebb79ea0a2bca00a0f46b">e</a>), s-&gt;<a class="code" href="structskinnysession.html#a70701ca9c2641bcb1740286273a0473a">device</a>-&gt;name);
<a name="l06065"></a>06065    })
<a name="l06066"></a>06066 
<a name="l06067"></a>06067    <span class="keywordflow">switch</span>(<a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#a88859ce72faebb79ea0a2bca00a0f46b">e</a>)) {
<a name="l06068"></a>06068    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a9e35a268fd7c3a1b2cb28c295c816160">KEEP_ALIVE_MESSAGE</a>:
<a name="l06069"></a>06069       res = <a class="code" href="chan__skinny_8c.html#a4e67efb4749b43509711e424800bda72">handle_keep_alive_message</a>(req, s);
<a name="l06070"></a>06070       <span class="keywordflow">break</span>;
<a name="l06071"></a>06071    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#aec789812d6cc0ff846fb308745e91531">REGISTER_MESSAGE</a>:
<a name="l06072"></a>06072       <span class="keywordflow">if</span> (skinnydebug)
<a name="l06073"></a>06073          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Device %s is attempting to register\n&quot;</span>, req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#aceb9d5d9b0983f8fb0e5523310274dc4">reg</a>.<a class="code" href="structregister__message.html#acd328517a6cf718155c2e6e22b671ca9">name</a>);
<a name="l06074"></a>06074 
<a name="l06075"></a>06075       res = <a class="code" href="chan__skinny_8c.html#a7f535538747c986182c94720cc460806">handle_register_message</a>(req, s);
<a name="l06076"></a>06076       <span class="keywordflow">break</span>;
<a name="l06077"></a>06077    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#aa1b2b6b1bab1095ef0753afc2582d29d">IP_PORT_MESSAGE</a>:
<a name="l06078"></a>06078       res = <a class="code" href="chan__skinny_8c.html#ae331d9ec23b9f9ed1f97b87be60b9fb8">handle_ip_port_message</a>(req, s);
<a name="l06079"></a>06079       <span class="keywordflow">break</span>;
<a name="l06080"></a>06080    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a1d5b89af9a01395da0daefcbcc8fd8bb">KEYPAD_BUTTON_MESSAGE</a>:
<a name="l06081"></a>06081        {
<a name="l06082"></a>06082       <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d = s-&gt;<a class="code" href="structskinnysession.html#a70701ca9c2641bcb1740286273a0473a">device</a>;
<a name="l06083"></a>06083       <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub;
<a name="l06084"></a>06084       <span class="keywordtype">int</span> lineInstance;
<a name="l06085"></a>06085       <span class="keywordtype">int</span> callReference;
<a name="l06086"></a>06086 
<a name="l06087"></a>06087       <span class="keywordflow">if</span> (skinnydebug)
<a name="l06088"></a>06088          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Collected digit: [%d]\n&quot;</span>, <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a23815068e4a04a658a8bd00aabab71fc">keypad</a>.<a class="code" href="structkeypad__button__message.html#a9ee7e63d91ac13e63dbad259aa1b52a6">button</a>));
<a name="l06089"></a>06089 
<a name="l06090"></a>06090       lineInstance = <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a23815068e4a04a658a8bd00aabab71fc">keypad</a>.<a class="code" href="structkeypad__button__message.html#a3c8ec1b11804b48f666007331e0c90ba">lineInstance</a>);
<a name="l06091"></a>06091       callReference = <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a23815068e4a04a658a8bd00aabab71fc">keypad</a>.<a class="code" href="structkeypad__button__message.html#a8c5b70179481930bfaef1fa8f6aaba74">callReference</a>);
<a name="l06092"></a>06092 
<a name="l06093"></a>06093       <span class="keywordflow">if</span> (lineInstance) {
<a name="l06094"></a>06094          sub = <a class="code" href="chan__skinny_8c.html#a10c715ff96a500b77ddc4442fa17cf55">find_subchannel_by_instance_reference</a>(d, lineInstance, callReference);
<a name="l06095"></a>06095       } <span class="keywordflow">else</span> {
<a name="l06096"></a>06096          sub = d-&gt;<a class="code" href="structskinny__device.html#a70da1427655ecdaa64e57324e51f440b">activeline</a>-&gt;<a class="code" href="structskinny__line.html#aedffa4337f76fdcdc808e16affbafd04">activesub</a>;
<a name="l06097"></a>06097       }
<a name="l06098"></a>06098 
<a name="l06099"></a>06099       <span class="keywordflow">if</span> (sub &amp;&amp; ((sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> &lt;  <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) || sub-&gt;<a class="code" href="structskinny__subchannel.html#a46585eaf56ac8588fa673c1c089f0238">onhold</a>)) {
<a name="l06100"></a>06100          <span class="keywordtype">char</span> dgt;
<a name="l06101"></a>06101          <span class="keywordtype">int</span> digit = <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#a23815068e4a04a658a8bd00aabab71fc">keypad</a>.<a class="code" href="structkeypad__button__message.html#a9ee7e63d91ac13e63dbad259aa1b52a6">button</a>);
<a name="l06102"></a>06102 
<a name="l06103"></a>06103          <span class="keywordflow">if</span> (digit == 14) {
<a name="l06104"></a>06104             dgt = <span class="charliteral">&apos;*&apos;</span>;
<a name="l06105"></a>06105          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (digit == 15) {
<a name="l06106"></a>06106             dgt = <span class="charliteral">&apos;#&apos;</span>;
<a name="l06107"></a>06107          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (digit &gt;= 0 &amp;&amp; digit &lt;= 9) {
<a name="l06108"></a>06108             dgt = <span class="charliteral">&apos;0&apos;</span> + digit;
<a name="l06109"></a>06109          } <span class="keywordflow">else</span> {
<a name="l06110"></a>06110             <span class="comment">/* digit=10-13 (A,B,C,D ?), or</span>
<a name="l06111"></a>06111 <span class="comment">            * digit is bad value</span>
<a name="l06112"></a>06112 <span class="comment">            *</span>
<a name="l06113"></a>06113 <span class="comment">            * probably should not end up here, but set</span>
<a name="l06114"></a>06114 <span class="comment">            * value for backward compatibility, and log</span>
<a name="l06115"></a>06115 <span class="comment">            * a warning.</span>
<a name="l06116"></a>06116 <span class="comment">            */</span>
<a name="l06117"></a>06117             dgt = <span class="charliteral">&apos;0&apos;</span> + digit;
<a name="l06118"></a>06118             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unsupported digit %d\n&quot;</span>, digit);
<a name="l06119"></a>06119          }
<a name="l06120"></a>06120 
<a name="l06121"></a>06121          d-&gt;exten[strlen(d-&gt;exten)] = dgt;
<a name="l06122"></a>06122          d-&gt;exten[strlen(d-&gt;exten)+1] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l06123"></a>06123       } <span class="keywordflow">else</span>
<a name="l06124"></a>06124          res = <a class="code" href="chan__skinny_8c.html#a1f86382ae84168245fb2f120af3747d4">handle_keypad_button_message</a>(req, s);
<a name="l06125"></a>06125       }
<a name="l06126"></a>06126       <span class="keywordflow">break</span>;
<a name="l06127"></a>06127    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a67e29aa17c48ffce8b07634ac656c172">ENBLOC_CALL_MESSAGE</a>:
<a name="l06128"></a>06128       res = <a class="code" href="chan__skinny_8c.html#a6b153ba03b4ade85409b370040668b3a">handle_enbloc_call_message</a>(req, s);
<a name="l06129"></a>06129       <span class="keywordflow">break</span>;
<a name="l06130"></a>06130    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a8caf5d84aafa52ecdd3a86a08620850c">STIMULUS_MESSAGE</a>:
<a name="l06131"></a>06131       res = <a class="code" href="chan__skinny_8c.html#ad229f47d1b225da7a72688def1a3c95b">handle_stimulus_message</a>(req, s);
<a name="l06132"></a>06132       <span class="keywordflow">break</span>;
<a name="l06133"></a>06133    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a258aee0512dcbdce20a4ec7c9174efec">OFFHOOK_MESSAGE</a>:
<a name="l06134"></a>06134       res = <a class="code" href="chan__skinny_8c.html#a1186bffbea3bd1b7ff2af6a9ac9f6c7a">handle_offhook_message</a>(req, s);
<a name="l06135"></a>06135       <span class="keywordflow">break</span>;
<a name="l06136"></a>06136    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a195491206014b7ee4a2950b8af3c8a82">ONHOOK_MESSAGE</a>:
<a name="l06137"></a>06137       res = <a class="code" href="chan__skinny_8c.html#a168480819789a822d423c3fd6387a493">handle_onhook_message</a>(req, s);
<a name="l06138"></a>06138       <span class="keywordflow">break</span>;
<a name="l06139"></a>06139    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#aff32b9bb805415bcfea5b23ebb62b661">CAPABILITIES_RES_MESSAGE</a>:
<a name="l06140"></a>06140       <span class="keywordflow">if</span> (skinnydebug)
<a name="l06141"></a>06141          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received CapabilitiesRes\n&quot;</span>);
<a name="l06142"></a>06142 
<a name="l06143"></a>06143       res = <a class="code" href="chan__skinny_8c.html#a6382ccdb9e04a0ce816a20a54a96700a">handle_capabilities_res_message</a>(req, s);
<a name="l06144"></a>06144       <span class="keywordflow">break</span>;
<a name="l06145"></a>06145    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a79d95555682062db176dfd2a5e9c0752">SPEED_DIAL_STAT_REQ_MESSAGE</a>:
<a name="l06146"></a>06146       <span class="keywordflow">if</span> (skinnydebug)
<a name="l06147"></a>06147          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received SpeedDialStatRequest\n&quot;</span>);
<a name="l06148"></a>06148 
<a name="l06149"></a>06149       res = <a class="code" href="chan__skinny_8c.html#a305823a106c34c948fb326ee7b45a369">handle_speed_dial_stat_req_message</a>(req, s);
<a name="l06150"></a>06150       <span class="keywordflow">break</span>;
<a name="l06151"></a>06151    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a610dfde5df1301f6c347b10415678e0f">LINE_STATE_REQ_MESSAGE</a>:
<a name="l06152"></a>06152       <span class="keywordflow">if</span> (skinnydebug)
<a name="l06153"></a>06153          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received LineStatRequest\n&quot;</span>);
<a name="l06154"></a>06154       res = <a class="code" href="chan__skinny_8c.html#a672a36345b53d8f188c5f9520482b5c3">handle_line_state_req_message</a>(req, s);
<a name="l06155"></a>06155       <span class="keywordflow">break</span>;
<a name="l06156"></a>06156    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#ad0232ebceef396ab30795eb9348d7cac">TIME_DATE_REQ_MESSAGE</a>:
<a name="l06157"></a>06157       <span class="keywordflow">if</span> (skinnydebug)
<a name="l06158"></a>06158          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Time/Date Request\n&quot;</span>);
<a name="l06159"></a>06159 
<a name="l06160"></a>06160       res = <a class="code" href="chan__skinny_8c.html#a9900f684e2e692200c87ade6605b3570">handle_time_date_req_message</a>(req, s);
<a name="l06161"></a>06161       <span class="keywordflow">break</span>;
<a name="l06162"></a>06162    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a2eafa2761d0f30c216c041a97cad9c30">BUTTON_TEMPLATE_REQ_MESSAGE</a>:
<a name="l06163"></a>06163       <span class="keywordflow">if</span> (skinnydebug)
<a name="l06164"></a>06164          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Buttontemplate requested\n&quot;</span>);
<a name="l06165"></a>06165 
<a name="l06166"></a>06166       res = <a class="code" href="chan__skinny_8c.html#a987b03603d0ce69e4e50662c7c3fb744">handle_button_template_req_message</a>(req, s);
<a name="l06167"></a>06167       <span class="keywordflow">break</span>;
<a name="l06168"></a>06168    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#ad4deebb4a9be4ed5eaf37f0ddb7ea361">VERSION_REQ_MESSAGE</a>:
<a name="l06169"></a>06169       <span class="keywordflow">if</span> (skinnydebug)
<a name="l06170"></a>06170          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Version Request\n&quot;</span>);
<a name="l06171"></a>06171 
<a name="l06172"></a>06172       res = <a class="code" href="chan__skinny_8c.html#a31f03379857613754159979877ff9d31">handle_version_req_message</a>(req, s);
<a name="l06173"></a>06173       <span class="keywordflow">break</span>;
<a name="l06174"></a>06174    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a36c56f4d73172d09aaf26225c2446963">SERVER_REQUEST_MESSAGE</a>:
<a name="l06175"></a>06175       <span class="keywordflow">if</span> (skinnydebug)
<a name="l06176"></a>06176          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Server Request\n&quot;</span>);
<a name="l06177"></a>06177 
<a name="l06178"></a>06178       res = <a class="code" href="chan__skinny_8c.html#a950ddf064bd0e55b40d080f650549113">handle_server_request_message</a>(req, s);
<a name="l06179"></a>06179       <span class="keywordflow">break</span>;
<a name="l06180"></a>06180    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#ae2a02a450e18eeb46029c20efadd4ab3">ALARM_MESSAGE</a>:
<a name="l06181"></a>06181       res = <a class="code" href="chan__skinny_8c.html#a371506325b3c5c8f36759a64648479ab">handle_alarm_message</a>(req, s);
<a name="l06182"></a>06182       <span class="keywordflow">break</span>;
<a name="l06183"></a>06183    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a95a2cd4add7896f4feabe8dc6b0744b6">OPEN_RECEIVE_CHANNEL_ACK_MESSAGE</a>:
<a name="l06184"></a>06184       <span class="keywordflow">if</span> (skinnydebug)
<a name="l06185"></a>06185          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Open Receive Channel Ack\n&quot;</span>);
<a name="l06186"></a>06186 
<a name="l06187"></a>06187       res = <a class="code" href="chan__skinny_8c.html#a0e967f0092b2ed2450643b9842a38ebe">handle_open_receive_channel_ack_message</a>(req, s);
<a name="l06188"></a>06188       <span class="keywordflow">break</span>;
<a name="l06189"></a>06189    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a95a0727067965ab3ce6652eefaee5afc">SOFT_KEY_SET_REQ_MESSAGE</a>:
<a name="l06190"></a>06190       <span class="keywordflow">if</span> (skinnydebug)
<a name="l06191"></a>06191          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received SoftKeySetReq\n&quot;</span>);
<a name="l06192"></a>06192 
<a name="l06193"></a>06193       res = <a class="code" href="chan__skinny_8c.html#a36d5c794f9d8c2d99417312340c7b708">handle_soft_key_set_req_message</a>(req, s);
<a name="l06194"></a>06194       <span class="keywordflow">break</span>;
<a name="l06195"></a>06195    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a8fdb22d136247b1f7980bbaf1ed2b7ce">SOFT_KEY_EVENT_MESSAGE</a>:
<a name="l06196"></a>06196       res = <a class="code" href="chan__skinny_8c.html#a2c55bb9609ddde15bace5fe2d7962b43">handle_soft_key_event_message</a>(req, s);
<a name="l06197"></a>06197       <span class="keywordflow">break</span>;
<a name="l06198"></a>06198    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a33d2f7a83eef8e9bd1b39f8e38c150f7">UNREGISTER_MESSAGE</a>:
<a name="l06199"></a>06199       <span class="keywordflow">if</span> (skinnydebug)
<a name="l06200"></a>06200          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received Unregister Request\n&quot;</span>);
<a name="l06201"></a>06201 
<a name="l06202"></a>06202       res = <a class="code" href="chan__skinny_8c.html#ac2ff777262737f58dba8364caa1cf921">handle_unregister_message</a>(req, s);
<a name="l06203"></a>06203       <span class="keywordflow">break</span>;
<a name="l06204"></a>06204    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#aaa8ae193940da9236d260041a3a8a5c4">SOFT_KEY_TEMPLATE_REQ_MESSAGE</a>:
<a name="l06205"></a>06205       <span class="keywordflow">if</span> (skinnydebug)
<a name="l06206"></a>06206          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Received SoftKey Template Request\n&quot;</span>);
<a name="l06207"></a>06207 
<a name="l06208"></a>06208       res = <a class="code" href="chan__skinny_8c.html#a4ef63024063c091aeeef49c3570c7514">handle_soft_key_template_req_message</a>(req, s);
<a name="l06209"></a>06209       <span class="keywordflow">break</span>;
<a name="l06210"></a>06210    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#a9f3bcf87db314d362bb2ca29ed73c71c">HEADSET_STATUS_MESSAGE</a>:
<a name="l06211"></a>06211       res = <a class="code" href="chan__skinny_8c.html#a5738cebd023fa44b2b46a069bf4006e3">handle_headset_status_message</a>(req, s);
<a name="l06212"></a>06212       <span class="keywordflow">break</span>;
<a name="l06213"></a>06213    <span class="keywordflow">case</span> <a class="code" href="chan__skinny_8c.html#acffbaca19a4702b6ae9284d1902b67f9">REGISTER_AVAILABLE_LINES_MESSAGE</a>:
<a name="l06214"></a>06214       res = <a class="code" href="chan__skinny_8c.html#ab51bcbe920bd0dbdd70510befa2aecc9">handle_register_available_lines_message</a>(req, s);
<a name="l06215"></a>06215       <span class="keywordflow">break</span>;
<a name="l06216"></a>06216    <span class="keywordflow">default</span>:
<a name="l06217"></a>06217       <span class="keywordflow">if</span> (skinnydebug)
<a name="l06218"></a>06218          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;RECEIVED UNKNOWN MESSAGE TYPE:  %x\n&quot;</span>, <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#a88859ce72faebb79ea0a2bca00a0f46b">e</a>));
<a name="l06219"></a>06219       <span class="keywordflow">break</span>;
<a name="l06220"></a>06220    }
<a name="l06221"></a>06221    <span class="keywordflow">if</span> (res &gt;= 0 &amp;&amp; req)
<a name="l06222"></a>06222       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(req);
<a name="l06223"></a>06223    <span class="keywordflow">return</span> res;
<a name="l06224"></a>06224 }
<a name="l06225"></a>06225 
<a name="l06226"></a><a class="code" href="chan__skinny_8c.html#af628a56dd3c32bfbe40a5f03bbe2dae6">06226</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__skinny_8c.html#af628a56dd3c32bfbe40a5f03bbe2dae6">destroy_session</a>(<span class="keyword">struct</span> <a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l06227"></a>06227 {
<a name="l06228"></a>06228    <span class="keyword">struct </span><a class="code" href="structskinnysession.html">skinnysession</a> *cur;
<a name="l06229"></a>06229    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="structsessions.html">sessions</a>);
<a name="l06230"></a>06230    <a class="code" href="linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d" title="Loops safely over (traverses) the entries in a list.">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(&amp;<a class="code" href="structsessions.html">sessions</a>, cur, list) {
<a name="l06231"></a>06231       <span class="keywordflow">if</span> (cur == s) {
<a name="l06232"></a>06232          <a class="code" href="linkedlists_8h.html#aa8ac496fa9c717d5afb99a02e1e2760c" title="Removes the current entry from a list during a traversal.">AST_LIST_REMOVE_CURRENT</a>(list);
<a name="l06233"></a>06233          <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structskinnysession.html#a6f8059414f0228f0256115e024eeed4b">fd</a> &gt; -1) 
<a name="l06234"></a>06234             close(s-&gt;<a class="code" href="structskinnysession.html#a6f8059414f0228f0256115e024eeed4b">fd</a>);
<a name="l06235"></a>06235          
<a name="l06236"></a>06236          <a class="code" href="lock_8h.html#ab237e70b569019bfb490ab0c3c09b8c5">ast_mutex_destroy</a>(&amp;s-&gt;<a class="code" href="structskinnysession.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06237"></a>06237          
<a name="l06238"></a>06238          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(s);
<a name="l06239"></a>06239       } <span class="keywordflow">else</span> {
<a name="l06240"></a>06240          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Trying to delete nonexistent session %p?\n&quot;</span>, s);
<a name="l06241"></a>06241       }
<a name="l06242"></a>06242    }
<a name="l06243"></a>06243    <a class="code" href="linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9" title="Closes a safe loop traversal block.">AST_LIST_TRAVERSE_SAFE_END</a>
<a name="l06244"></a>06244    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="structsessions.html">sessions</a>);
<a name="l06245"></a>06245 }
<a name="l06246"></a>06246 
<a name="l06247"></a><a class="code" href="chan__skinny_8c.html#a104a0842e9173151171249a77f59e71c">06247</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a104a0842e9173151171249a77f59e71c">get_input</a>(<span class="keyword">struct</span> <a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l06248"></a>06248 {
<a name="l06249"></a>06249    <span class="keywordtype">int</span> res;
<a name="l06250"></a>06250    <span class="keywordtype">int</span> dlen = 0;
<a name="l06251"></a>06251    <span class="keywordtype">int</span> *bufaddr;
<a name="l06252"></a>06252    <span class="keyword">struct </span>pollfd fds[1];
<a name="l06253"></a>06253 
<a name="l06254"></a>06254    fds[0].fd = s-&gt;<a class="code" href="structskinnysession.html#a6f8059414f0228f0256115e024eeed4b">fd</a>;
<a name="l06255"></a>06255    fds[0].events = POLLIN;
<a name="l06256"></a>06256    fds[0].revents = 0;
<a name="l06257"></a>06257    res = <a class="code" href="poll-compat_8h.html#a5a0c58fa8311e94cd0ed34382aa822f9">ast_poll</a>(fds, 1, (keep_alive * 1100)); <span class="comment">/* If nothing has happen, client is dead */</span>
<a name="l06258"></a>06258                    <span class="comment">/* we add 10% to the keep_alive to deal */</span>
<a name="l06259"></a>06259                    <span class="comment">/* with network delays, etc */</span>
<a name="l06260"></a>06260    <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l06261"></a>06261       <span class="keywordflow">if</span> (<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> != EINTR) {
<a name="l06262"></a>06262          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Select returned error: %s\n&quot;</span>, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l06263"></a>06263          <span class="keywordflow">return</span> res;
<a name="l06264"></a>06264       }
<a name="l06265"></a>06265    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res == 0) {
<a name="l06266"></a>06266       <span class="keywordflow">if</span> (skinnydebug)
<a name="l06267"></a>06267          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Skinny Client was lost, unregistering\n&quot;</span>);
<a name="l06268"></a>06268       <a class="code" href="chan__skinny_8c.html#aac25ed22beafaebfee5acb276c2e0d28">skinny_unregister</a>(NULL, s);
<a name="l06269"></a>06269       <span class="keywordflow">return</span> -1;
<a name="l06270"></a>06270    }
<a name="l06271"></a>06271            
<a name="l06272"></a>06272    <span class="keywordflow">if</span> (fds[0].revents) {
<a name="l06273"></a>06273       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;s-&gt;<a class="code" href="structskinnysession.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06274"></a>06274       memset(s-&gt;<a class="code" href="structskinnysession.html#ad5c7d4962dc867066ef0c2fd430bfa96">inbuf</a>, 0, <span class="keyword">sizeof</span>(s-&gt;<a class="code" href="structskinnysession.html#ad5c7d4962dc867066ef0c2fd430bfa96">inbuf</a>));
<a name="l06275"></a>06275       res = read(s-&gt;<a class="code" href="structskinnysession.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, s-&gt;<a class="code" href="structskinnysession.html#ad5c7d4962dc867066ef0c2fd430bfa96">inbuf</a>, 4);
<a name="l06276"></a>06276       <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l06277"></a>06277          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;read() returned error: %s\n&quot;</span>, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l06278"></a>06278 
<a name="l06279"></a>06279          <span class="keywordflow">if</span> (skinnydebug)
<a name="l06280"></a>06280             <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Skinny Client was lost, unregistering\n&quot;</span>);
<a name="l06281"></a>06281 
<a name="l06282"></a>06282          <a class="code" href="chan__skinny_8c.html#aac25ed22beafaebfee5acb276c2e0d28">skinny_unregister</a>(NULL, s);
<a name="l06283"></a>06283          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;s-&gt;<a class="code" href="structskinnysession.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06284"></a>06284          <span class="keywordflow">return</span> res;
<a name="l06285"></a>06285       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res != 4) {
<a name="l06286"></a>06286          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Skinny Client sent less data than expected.  Expected 4 but got %d.\n&quot;</span>, res);
<a name="l06287"></a>06287          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;s-&gt;<a class="code" href="structskinnysession.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06288"></a>06288          
<a name="l06289"></a>06289          <span class="keywordflow">if</span> (res == 0) {
<a name="l06290"></a>06290             <span class="keywordflow">if</span> (skinnydebug)
<a name="l06291"></a>06291                <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Skinny Client was lost, unregistering\n&quot;</span>);
<a name="l06292"></a>06292             <a class="code" href="chan__skinny_8c.html#aac25ed22beafaebfee5acb276c2e0d28">skinny_unregister</a>(NULL, s);
<a name="l06293"></a>06293          }
<a name="l06294"></a>06294 
<a name="l06295"></a>06295          <span class="keywordflow">return</span> -1;
<a name="l06296"></a>06296       }
<a name="l06297"></a>06297 
<a name="l06298"></a>06298       bufaddr = (<span class="keywordtype">int</span> *)s-&gt;<a class="code" href="structskinnysession.html#ad5c7d4962dc867066ef0c2fd430bfa96">inbuf</a>;
<a name="l06299"></a>06299       dlen = <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(*bufaddr);
<a name="l06300"></a>06300       <span class="keywordflow">if</span> (dlen &lt; 4) {
<a name="l06301"></a>06301          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Skinny Client sent invalid data.\n&quot;</span>);
<a name="l06302"></a>06302          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;s-&gt;<a class="code" href="structskinnysession.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06303"></a>06303          <span class="keywordflow">return</span> -1;
<a name="l06304"></a>06304       }
<a name="l06305"></a>06305       <span class="keywordflow">if</span> (dlen+8 &gt; <span class="keyword">sizeof</span>(s-&gt;<a class="code" href="structskinnysession.html#ad5c7d4962dc867066ef0c2fd430bfa96">inbuf</a>)) {
<a name="l06306"></a>06306          dlen = <span class="keyword">sizeof</span>(s-&gt;<a class="code" href="structskinnysession.html#ad5c7d4962dc867066ef0c2fd430bfa96">inbuf</a>) - 8;
<a name="l06307"></a>06307       }
<a name="l06308"></a>06308       *bufaddr = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(dlen);
<a name="l06309"></a>06309 
<a name="l06310"></a>06310       res = read(s-&gt;<a class="code" href="structskinnysession.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, s-&gt;<a class="code" href="structskinnysession.html#ad5c7d4962dc867066ef0c2fd430bfa96">inbuf</a>+4, dlen+4);
<a name="l06311"></a>06311       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;s-&gt;<a class="code" href="structskinnysession.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06312"></a>06312       <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l06313"></a>06313          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;read() returned error: %s\n&quot;</span>, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l06314"></a>06314          <span class="keywordflow">return</span> res;
<a name="l06315"></a>06315       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res != (dlen+4)) {
<a name="l06316"></a>06316          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Skinny Client sent less data than expected.\n&quot;</span>);
<a name="l06317"></a>06317          <span class="keywordflow">return</span> -1;
<a name="l06318"></a>06318       }
<a name="l06319"></a>06319       <span class="keywordflow">return</span> res;
<a name="l06320"></a>06320    }
<a name="l06321"></a>06321    <span class="keywordflow">return</span> 0;
<a name="l06322"></a>06322 }
<a name="l06323"></a>06323 
<a name="l06324"></a><a class="code" href="chan__skinny_8c.html#a6d55d2fb9734c0fc71c2ea572a86fbd9">06324</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structskinny__req.html">skinny_req</a> *<a class="code" href="chan__skinny_8c.html#a6d55d2fb9734c0fc71c2ea572a86fbd9">skinny_req_parse</a>(<span class="keyword">struct</span> <a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)
<a name="l06325"></a>06325 {
<a name="l06326"></a>06326    <span class="keyword">struct </span><a class="code" href="structskinny__req.html">skinny_req</a> *req;
<a name="l06327"></a>06327    <span class="keywordtype">int</span> *bufaddr;
<a name="l06328"></a>06328 
<a name="l06329"></a>06329    <span class="keywordflow">if</span> (!(req = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <a class="code" href="chan__skinny_8c.html#af113e81b9ed86ff1591580de9d8b1d52">SKINNY_MAX_PACKET</a>)))
<a name="l06330"></a>06330       <span class="keywordflow">return</span> NULL;
<a name="l06331"></a>06331 
<a name="l06332"></a>06332    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;s-&gt;<a class="code" href="structskinnysession.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06333"></a>06333    memcpy(req, s-&gt;<a class="code" href="structskinnysession.html#ad5c7d4962dc867066ef0c2fd430bfa96">inbuf</a>, skinny_header_size);
<a name="l06334"></a>06334    bufaddr = (<span class="keywordtype">int</span> *)(s-&gt;<a class="code" href="structskinnysession.html#ad5c7d4962dc867066ef0c2fd430bfa96">inbuf</a>);
<a name="l06335"></a>06335    memcpy(&amp;req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>, s-&gt;<a class="code" href="structskinnysession.html#ad5c7d4962dc867066ef0c2fd430bfa96">inbuf</a>+skinny_header_size, <a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(*bufaddr)-4);
<a name="l06336"></a>06336 
<a name="l06337"></a>06337    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;s-&gt;<a class="code" href="structskinnysession.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06338"></a>06338 
<a name="l06339"></a>06339    <span class="keywordflow">if</span> (<a class="code" href="chan__skinny_8c.html#aecac20e4d67a701a117a8c0d575cacb5">letohl</a>(req-&gt;<a class="code" href="structskinny__req.html#a88859ce72faebb79ea0a2bca00a0f46b">e</a>) &lt; 0) {
<a name="l06340"></a>06340       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Event Message is NULL from socket %d, This is bad\n&quot;</span>, s-&gt;<a class="code" href="structskinnysession.html#a6f8059414f0228f0256115e024eeed4b">fd</a>);
<a name="l06341"></a>06341       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(req);
<a name="l06342"></a>06342       <span class="keywordflow">return</span> NULL;
<a name="l06343"></a>06343    }
<a name="l06344"></a>06344 
<a name="l06345"></a>06345    <span class="keywordflow">return</span> req;
<a name="l06346"></a>06346 }
<a name="l06347"></a>06347 
<a name="l06348"></a><a class="code" href="chan__skinny_8c.html#a34b032f1a0422e2024f822aaaaf8283a">06348</a> <span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="chan__skinny_8c.html#a34b032f1a0422e2024f822aaaaf8283a">skinny_session</a>(<span class="keywordtype">void</span> *<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>)
<a name="l06349"></a>06349 {
<a name="l06350"></a>06350    <span class="keywordtype">int</span> <a class="code" href="structskinny__req.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;
<a name="l06351"></a>06351    <span class="keyword">struct </span><a class="code" href="structskinny__req.html">skinny_req</a> *req;
<a name="l06352"></a>06352    <span class="keyword">struct </span><a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a> = data;
<a name="l06353"></a>06353 
<a name="l06354"></a>06354    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Starting Skinny session from %s\n&quot;</span>, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(s-&gt;<a class="code" href="structskinnysession.html#ac7cbd331d33fcd5a6f81a257975e4cd5">sin</a>.sin_addr));
<a name="l06355"></a>06355 
<a name="l06356"></a>06356    <span class="keywordflow">for</span> (;;) {
<a name="l06357"></a>06357       res = <a class="code" href="chan__skinny_8c.html#a104a0842e9173151171249a77f59e71c">get_input</a>(s);
<a name="l06358"></a>06358       <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l06359"></a>06359          <span class="keywordflow">break</span>;
<a name="l06360"></a>06360       }
<a name="l06361"></a>06361 
<a name="l06362"></a>06362       <span class="keywordflow">if</span> (res &gt; 0)
<a name="l06363"></a>06363       {
<a name="l06364"></a>06364          <span class="keywordflow">if</span> (!(req = <a class="code" href="chan__skinny_8c.html#a6d55d2fb9734c0fc71c2ea572a86fbd9">skinny_req_parse</a>(s))) {
<a name="l06365"></a>06365             <a class="code" href="chan__skinny_8c.html#af628a56dd3c32bfbe40a5f03bbe2dae6">destroy_session</a>(s);
<a name="l06366"></a>06366             <span class="keywordflow">return</span> NULL;
<a name="l06367"></a>06367          }
<a name="l06368"></a>06368 
<a name="l06369"></a>06369          res = <a class="code" href="chan__skinny_8c.html#af4e0e1821262024a6a2c5dafe646c775">handle_message</a>(req, s);
<a name="l06370"></a>06370          <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l06371"></a>06371             <a class="code" href="chan__skinny_8c.html#af628a56dd3c32bfbe40a5f03bbe2dae6">destroy_session</a>(s);
<a name="l06372"></a>06372             <span class="keywordflow">return</span> NULL;
<a name="l06373"></a>06373          }
<a name="l06374"></a>06374       }
<a name="l06375"></a>06375    }
<a name="l06376"></a>06376    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(3, <span class="stringliteral">&quot;Skinny Session returned: %s\n&quot;</span>, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l06377"></a>06377 
<a name="l06378"></a>06378    <span class="keywordflow">if</span> (s) 
<a name="l06379"></a>06379       <a class="code" href="chan__skinny_8c.html#af628a56dd3c32bfbe40a5f03bbe2dae6">destroy_session</a>(s);
<a name="l06380"></a>06380    
<a name="l06381"></a>06381    <span class="keywordflow">return</span> 0;
<a name="l06382"></a>06382 }
<a name="l06383"></a>06383 
<a name="l06384"></a><a class="code" href="chan__skinny_8c.html#afb67d0042be5e8bd0d96b62379856fe2">06384</a> <span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="chan__skinny_8c.html#afb67d0042be5e8bd0d96b62379856fe2">accept_thread</a>(<span class="keywordtype">void</span> *ignore)
<a name="l06385"></a>06385 {
<a name="l06386"></a>06386    <span class="keywordtype">int</span> as;
<a name="l06387"></a>06387    <span class="keyword">struct </span>sockaddr_in sin;
<a name="l06388"></a>06388    socklen_t sinlen;
<a name="l06389"></a>06389    <span class="keyword">struct </span><a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>;
<a name="l06390"></a>06390    <span class="keyword">struct </span>protoent *p;
<a name="l06391"></a>06391    <span class="keywordtype">int</span> arg = 1;
<a name="l06392"></a>06392 
<a name="l06393"></a>06393    <span class="keywordflow">for</span> (;;) {
<a name="l06394"></a>06394       sinlen = <span class="keyword">sizeof</span>(sin);
<a name="l06395"></a>06395       as = accept(skinnysock, (<span class="keyword">struct</span> sockaddr *)&amp;sin, &amp;sinlen);
<a name="l06396"></a>06396       <span class="keywordflow">if</span> (as &lt; 0) {
<a name="l06397"></a>06397          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Accept returned -1: %s\n&quot;</span>, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l06398"></a>06398          <span class="keywordflow">continue</span>;
<a name="l06399"></a>06399       }
<a name="l06400"></a>06400       p = getprotobyname(<span class="stringliteral">&quot;tcp&quot;</span>);
<a name="l06401"></a>06401       <span class="keywordflow">if</span>(p) {
<a name="l06402"></a>06402          <span class="keywordflow">if</span>( setsockopt(as, p-&gt;p_proto, TCP_NODELAY, (<span class="keywordtype">char</span> *)&amp;arg, <span class="keyword">sizeof</span>(arg) ) &lt; 0 ) {
<a name="l06403"></a>06403             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to set Skinny tcp connection to TCP_NODELAY mode: %s\n&quot;</span>, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l06404"></a>06404          }
<a name="l06405"></a>06405       }
<a name="l06406"></a>06406       <span class="keywordflow">if</span> (!(s = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structskinnysession.html">skinnysession</a>))))
<a name="l06407"></a>06407          <span class="keywordflow">continue</span>;
<a name="l06408"></a>06408 
<a name="l06409"></a>06409       memcpy(&amp;s-&gt;<a class="code" href="structskinnysession.html#ac7cbd331d33fcd5a6f81a257975e4cd5">sin</a>, &amp;sin, <span class="keyword">sizeof</span>(sin));
<a name="l06410"></a>06410       <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;s-&gt;<a class="code" href="structskinnysession.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06411"></a>06411       s-&gt;<a class="code" href="structskinnysession.html#a6f8059414f0228f0256115e024eeed4b">fd</a> = as;
<a name="l06412"></a>06412       <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="structsessions.html">sessions</a>);
<a name="l06413"></a>06413       <a class="code" href="linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307" title="Inserts a list entry at the head of a list.">AST_LIST_INSERT_HEAD</a>(&amp;<a class="code" href="structsessions.html">sessions</a>, s, list);
<a name="l06414"></a>06414       <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="structsessions.html">sessions</a>);
<a name="l06415"></a>06415 
<a name="l06416"></a>06416       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a4781fd54a4ca8c7f0f8a32a6cce503c0">ast_pthread_create</a>(&amp;s-&gt;<a class="code" href="structskinnysession.html#aa49d6a06775253352589280dc7f30018">t</a>, NULL, <a class="code" href="chan__skinny_8c.html#a34b032f1a0422e2024f822aaaaf8283a">skinny_session</a>, s)) {
<a name="l06417"></a>06417          <a class="code" href="chan__skinny_8c.html#af628a56dd3c32bfbe40a5f03bbe2dae6">destroy_session</a>(s);
<a name="l06418"></a>06418       }
<a name="l06419"></a>06419    }
<a name="l06420"></a>06420    <span class="keywordflow">if</span> (skinnydebug)
<a name="l06421"></a>06421       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;killing accept thread\n&quot;</span>);
<a name="l06422"></a>06422    close(as);
<a name="l06423"></a>06423    <span class="keywordflow">return</span> 0;
<a name="l06424"></a>06424 }
<a name="l06425"></a>06425 
<a name="l06426"></a><a class="code" href="chan__skinny_8c.html#a02d8db6086b4a18353b82ebcad631ff6">06426</a> <span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="chan__skinny_8c.html#a02d8db6086b4a18353b82ebcad631ff6">do_monitor</a>(<span class="keywordtype">void</span> *data)
<a name="l06427"></a>06427 {
<a name="l06428"></a>06428    <span class="keywordtype">int</span> res;
<a name="l06429"></a>06429 
<a name="l06430"></a>06430    <span class="comment">/* This thread monitors all the interfaces which are not yet in use</span>
<a name="l06431"></a>06431 <span class="comment">      (and thus do not have a separate thread) indefinitely */</span>
<a name="l06432"></a>06432    <span class="comment">/* From here on out, we die whenever asked */</span>
<a name="l06433"></a>06433    <span class="keywordflow">for</span>(;;) {
<a name="l06434"></a>06434       pthread_testcancel();
<a name="l06435"></a>06435       <span class="comment">/* Wait for sched or io */</span>
<a name="l06436"></a>06436       res = <a class="code" href="sched_8h.html#a64797d66b6051095debfcdb7f790e605" title="Determines number of seconds until the next outstanding event to take place Determine...">ast_sched_wait</a>(sched);
<a name="l06437"></a>06437       <span class="keywordflow">if</span> ((res &lt; 0) || (res &gt; 1000)) {
<a name="l06438"></a>06438          res = 1000;
<a name="l06439"></a>06439       }
<a name="l06440"></a>06440       res = <a class="code" href="io_8h.html#a6f1abe730a5606b88c8f415f53b784bc" title="Waits for IO.">ast_io_wait</a>(io, res);
<a name="l06441"></a>06441       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;monlock);
<a name="l06442"></a>06442       <span class="keywordflow">if</span> (res &gt;= 0) {
<a name="l06443"></a>06443          <a class="code" href="sched_8h.html#a2867b39106061847a8508bf49e38f420" title="Runs the queue.">ast_sched_runq</a>(sched);
<a name="l06444"></a>06444       }
<a name="l06445"></a>06445       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;monlock);
<a name="l06446"></a>06446    }
<a name="l06447"></a>06447    <span class="comment">/* Never reached */</span>
<a name="l06448"></a>06448    <span class="keywordflow">return</span> NULL;
<a name="l06449"></a>06449 
<a name="l06450"></a>06450 }
<a name="l06451"></a>06451 
<a name="l06452"></a><a class="code" href="chan__skinny_8c.html#a83af94bb19a421cb25ca02d16fa5ba9c">06452</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#a83af94bb19a421cb25ca02d16fa5ba9c">restart_monitor</a>(<span class="keywordtype">void</span>)
<a name="l06453"></a>06453 {
<a name="l06454"></a>06454    <span class="comment">/* If we&apos;re supposed to be stopped -- stay stopped */</span>
<a name="l06455"></a>06455    <span class="keywordflow">if</span> (monitor_thread == <a class="code" href="lock_8h.html#a873a83eb8196323194aac2bea23d794e">AST_PTHREADT_STOP</a>)
<a name="l06456"></a>06456       <span class="keywordflow">return</span> 0;
<a name="l06457"></a>06457 
<a name="l06458"></a>06458    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;monlock);
<a name="l06459"></a>06459    <span class="keywordflow">if</span> (monitor_thread == pthread_self()) {
<a name="l06460"></a>06460       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;monlock);
<a name="l06461"></a>06461       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot kill myself\n&quot;</span>);
<a name="l06462"></a>06462       <span class="keywordflow">return</span> -1;
<a name="l06463"></a>06463    }
<a name="l06464"></a>06464    <span class="keywordflow">if</span> (monitor_thread != <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>) {
<a name="l06465"></a>06465       <span class="comment">/* Wake up the thread */</span>
<a name="l06466"></a>06466       pthread_kill(monitor_thread, SIGURG);
<a name="l06467"></a>06467    } <span class="keywordflow">else</span> {
<a name="l06468"></a>06468       <span class="comment">/* Start a new monitor */</span>
<a name="l06469"></a>06469       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a595e2f8aa398f4bd21e381c3211235fe">ast_pthread_create_background</a>(&amp;monitor_thread, NULL, <a class="code" href="chan__skinny_8c.html#a02d8db6086b4a18353b82ebcad631ff6">do_monitor</a>, NULL) &lt; 0) {
<a name="l06470"></a>06470          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;monlock);
<a name="l06471"></a>06471          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to start monitor thread.\n&quot;</span>);
<a name="l06472"></a>06472          <span class="keywordflow">return</span> -1;
<a name="l06473"></a>06473       }
<a name="l06474"></a>06474    }
<a name="l06475"></a>06475    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;monlock);
<a name="l06476"></a>06476    <span class="keywordflow">return</span> 0;
<a name="l06477"></a>06477 }
<a name="l06478"></a>06478 
<a name="l06479"></a><a class="code" href="chan__skinny_8c.html#ad7cca1158f92f6fd2716c633fa141f50">06479</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#ad7cca1158f92f6fd2716c633fa141f50">skinny_devicestate</a>(<span class="keywordtype">void</span> *data)
<a name="l06480"></a>06480 {
<a name="l06481"></a>06481    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l;
<a name="l06482"></a>06482    <span class="keywordtype">char</span> *tmp;
<a name="l06483"></a>06483 
<a name="l06484"></a>06484    tmp = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(data);
<a name="l06485"></a>06485 
<a name="l06486"></a>06486    l = <a class="code" href="chan__skinny_8c.html#a2a4f825b302983d41ab43a9e3387da4b">find_line_by_name</a>(tmp);
<a name="l06487"></a>06487 
<a name="l06488"></a>06488    <span class="keywordflow">return</span> <a class="code" href="chan__skinny_8c.html#a1ae95d3d12c225bb40b497687b3e9dc1">get_devicestate</a>(l);
<a name="l06489"></a>06489 }
<a name="l06490"></a>06490 
<a name="l06491"></a><a class="code" href="chan__skinny_8c.html#a2e70d14d4ce2c4135bee603be0a3264d">06491</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="chan__skinny_8c.html#a2e70d14d4ce2c4135bee603be0a3264d">skinny_request</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *type, <span class="keywordtype">int</span> <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>, <span class="keywordtype">void</span> *<a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>, <span class="keywordtype">int</span> *<a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>)
<a name="l06492"></a>06492 {
<a name="l06493"></a>06493    <span class="keywordtype">int</span> oldformat;
<a name="l06494"></a>06494    
<a name="l06495"></a>06495    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l;
<a name="l06496"></a>06496    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *tmpc = NULL;
<a name="l06497"></a>06497    <span class="keywordtype">char</span> tmp[256];
<a name="l06498"></a>06498    <span class="keywordtype">char</span> *dest = data;
<a name="l06499"></a>06499 
<a name="l06500"></a>06500    oldformat = format;
<a name="l06501"></a>06501    
<a name="l06502"></a>06502    <span class="keywordflow">if</span> (!(format &amp;= <a class="code" href="frame_8h.html#a3f680b9c15596de927d507a664fd2803">AST_FORMAT_AUDIO_MASK</a>)) {
<a name="l06503"></a>06503       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Asked to get a channel of unsupported format &apos;%d&apos;\n&quot;</span>, format);
<a name="l06504"></a>06504       <span class="keywordflow">return</span> NULL;
<a name="l06505"></a>06505    }
<a name="l06506"></a>06506 
<a name="l06507"></a>06507    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp, dest, <span class="keyword">sizeof</span>(tmp));
<a name="l06508"></a>06508    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(tmp)) {
<a name="l06509"></a>06509       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Skinny channels require a device\n&quot;</span>);
<a name="l06510"></a>06510       <span class="keywordflow">return</span> NULL;
<a name="l06511"></a>06511    }
<a name="l06512"></a>06512    l = <a class="code" href="chan__skinny_8c.html#a2a4f825b302983d41ab43a9e3387da4b">find_line_by_name</a>(tmp);
<a name="l06513"></a>06513    <span class="keywordflow">if</span> (!l) {
<a name="l06514"></a>06514       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;No available lines on: %s\n&quot;</span>, dest);
<a name="l06515"></a>06515       <span class="keywordflow">return</span> NULL;
<a name="l06516"></a>06516    }
<a name="l06517"></a>06517    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;skinny_request(%s)\n&quot;</span>, tmp);
<a name="l06518"></a>06518    tmpc = <a class="code" href="chan__skinny_8c.html#a7d4cb293426c31e532f15f52fd8183fd">skinny_new</a>(l, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>);
<a name="l06519"></a>06519    <span class="keywordflow">if</span> (!tmpc) {
<a name="l06520"></a>06520       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to make channel for &apos;%s&apos;\n&quot;</span>, tmp);
<a name="l06521"></a>06521    }
<a name="l06522"></a>06522    <a class="code" href="chan__skinny_8c.html#a83af94bb19a421cb25ca02d16fa5ba9c">restart_monitor</a>();
<a name="l06523"></a>06523    <span class="keywordflow">return</span> tmpc;
<a name="l06524"></a>06524 }
<a name="l06525"></a>06525 
<a name="l06526"></a><a class="code" href="chan__skinny_8c.html#ae3837bf7d2100903b0651f5b22e289e9">06526</a> <span class="preprocessor"> #define TYPE_GENERAL   1</span>
<a name="l06527"></a><a class="code" href="chan__skinny_8c.html#ad78ece34f886398c83a2ccf05d31499b">06527</a> <span class="preprocessor"></span><span class="preprocessor"> #define TYPE_DEF_DEVICE 2</span>
<a name="l06528"></a><a class="code" href="chan__skinny_8c.html#a1041d2c4aa7a5e6f54efdc452178975d">06528</a> <span class="preprocessor"></span><span class="preprocessor"> #define TYPE_DEF_LINE  4</span>
<a name="l06529"></a><a class="code" href="chan__skinny_8c.html#a1cb072ae2d3e0fdccbbfbbe5a7bff5bd">06529</a> <span class="preprocessor"></span><span class="preprocessor"> #define TYPE_DEVICE    8</span>
<a name="l06530"></a><a class="code" href="chan__skinny_8c.html#abe6753ebe7fd05e1561f837b71f81372">06530</a> <span class="preprocessor"></span><span class="preprocessor"> #define TYPE_LINE   16</span>
<a name="l06531"></a>06531 <span class="preprocessor"></span> 
<a name="l06532"></a><a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">06532</a> <span class="preprocessor"> #define CLINE_OPTS  ((struct skinny_line_options *)item)</span>
<a name="l06533"></a><a class="code" href="chan__skinny_8c.html#ad5a3074858d7493097d940e0be4365f3">06533</a> <span class="preprocessor"></span><span class="preprocessor"> #define CLINE    ((struct skinny_line *)item)</span>
<a name="l06534"></a><a class="code" href="chan__skinny_8c.html#a9af539d2dccccf8963f64f712844fbab">06534</a> <span class="preprocessor"></span><span class="preprocessor"> #define CDEV_OPTS   ((struct skinny_device_options *)item)</span>
<a name="l06535"></a><a class="code" href="chan__skinny_8c.html#a36da73f15a23c9efbc5efabb8cc08f73">06535</a> <span class="preprocessor"></span><span class="preprocessor"> #define CDEV     ((struct skinny_device *)item)</span>
<a name="l06536"></a>06536 <span class="preprocessor"></span> 
<a name="l06537"></a><a class="code" href="chan__skinny_8c.html#a290744d808f70a1932e3916b0db16acb">06537</a>  <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__skinny_8c.html#a290744d808f70a1932e3916b0db16acb">config_parse_variables</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">void</span> *item, <span class="keyword">struct</span> <a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *vptr)
<a name="l06538"></a>06538  {
<a name="l06539"></a>06539    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *v;
<a name="l06540"></a>06540    <span class="keywordtype">int</span> lineInstance = 1;
<a name="l06541"></a>06541    <span class="keywordtype">int</span> speeddialInstance = 1;
<a name="l06542"></a>06542    
<a name="l06543"></a>06543    <span class="keywordflow">while</span>(vptr) {
<a name="l06544"></a>06544       v = vptr;
<a name="l06545"></a>06545       vptr = vptr-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l06546"></a>06546  
<a name="l06547"></a>06547       <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#ae3837bf7d2100903b0651f5b22e289e9">TYPE_GENERAL</a>)) {
<a name="l06548"></a>06548          <span class="keywordtype">char</span> newcontexts[<a class="code" href="channel_8h.html#abcf1aea85b924e9cd605040b86241e2a">AST_MAX_CONTEXT</a>];
<a name="l06549"></a>06549          <span class="keywordtype">char</span> oldcontexts[<a class="code" href="channel_8h.html#abcf1aea85b924e9cd605040b86241e2a">AST_MAX_CONTEXT</a>];
<a name="l06550"></a>06550          <span class="keywordtype">char</span> *stringp, *<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, *oldregcontext;
<a name="l06551"></a>06551          <span class="keywordflow">if</span> (!<a class="code" href="abstract__jb_8h.html#ae50ad081bd2ae6b58bcfc4687916c586" title="Sets jitterbuffer configuration property.">ast_jb_read_conf</a>(&amp;<a class="code" href="chan__skinny_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">global_jbconf</a>, v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>)) {
<a name="l06552"></a>06552             v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l06553"></a>06553             <span class="keywordflow">continue</span>;
<a name="l06554"></a>06554          }
<a name="l06555"></a>06555          <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;bindaddr&quot;</span>)) {
<a name="l06556"></a>06556             <span class="keywordflow">if</span> (!(hp = <a class="code" href="utils_8h.html#ad3b63ee1041593219ef0765b28d70442" title="Thread-safe gethostbyname function to use in Asterisk.">ast_gethostbyname</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, &amp;<a class="code" href="chan__skinny_8c.html#a9e435aef83f14da6d3d5ec44f821558e">ahp</a>))) {
<a name="l06557"></a>06557                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid address: %s\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l06558"></a>06558             } <span class="keywordflow">else</span> {
<a name="l06559"></a>06559                memcpy(&amp;<a class="code" href="chan__skinny_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>.sin_addr, hp-&gt;h_addr, <span class="keyword">sizeof</span>(<a class="code" href="chan__skinny_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>.sin_addr));
<a name="l06560"></a>06560             }
<a name="l06561"></a>06561             <span class="keywordflow">continue</span>;
<a name="l06562"></a>06562          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;keepalive&quot;</span>)) {
<a name="l06563"></a>06563             keep_alive = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l06564"></a>06564             <span class="keywordflow">continue</span>;
<a name="l06565"></a>06565          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;regcontext&quot;</span>)) {
<a name="l06566"></a>06566             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(newcontexts, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(newcontexts));
<a name="l06567"></a>06567             stringp = newcontexts;
<a name="l06568"></a>06568             <span class="comment">/* Initialize copy of current global_regcontext for later use in removing stale contexts */</span>
<a name="l06569"></a>06569             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(oldcontexts, regcontext, <span class="keyword">sizeof</span>(oldcontexts));
<a name="l06570"></a>06570             oldregcontext = oldcontexts;
<a name="l06571"></a>06571             <span class="comment">/* Let&apos;s remove any contexts that are no longer defined in regcontext */</span>
<a name="l06572"></a>06572             <a class="code" href="chan__skinny_8c.html#aa1ca2cdc74f2438ac4aa7e1f9200518a">cleanup_stale_contexts</a>(stringp, oldregcontext);
<a name="l06573"></a>06573             <span class="comment">/* Create contexts if they don&apos;t exist already */</span>
<a name="l06574"></a>06574             <span class="keywordflow">while</span> ((context = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;stringp, <span class="stringliteral">&quot;&amp;&quot;</span>))) {
<a name="l06575"></a>06575                <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(used_context, context, <span class="keyword">sizeof</span>(used_context));
<a name="l06576"></a>06576                <a class="code" href="pbx_8h.html#a8a07400b41b3302edf8aef9f53644698" title="Register a new context or find an existing one.">ast_context_find_or_create</a>(NULL, NULL, context, <span class="stringliteral">&quot;Skinny&quot;</span>);
<a name="l06577"></a>06577             }
<a name="l06578"></a>06578             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(regcontext, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(regcontext));
<a name="l06579"></a>06579             <span class="keywordflow">continue</span>;
<a name="l06580"></a>06580          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;dateformat&quot;</span>)) {
<a name="l06581"></a>06581             memcpy(date_format, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(date_format));
<a name="l06582"></a>06582             <span class="keywordflow">continue</span>;
<a name="l06583"></a>06583          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;tos&quot;</span>)) {
<a name="l06584"></a>06584             <span class="keywordflow">if</span> (<a class="code" href="acl_8h.html#a49d1eefe77636e2a63ad013afa0fc3b5">ast_str2tos</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, &amp;<a class="code" href="chan__skinny_8c.html#abe7ea21619e746bb9b12fe3e47bc861b">qos</a>.tos))
<a name="l06585"></a>06585                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid tos value at line %d, refer to QoS documentation\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l06586"></a>06586             <span class="keywordflow">continue</span>;
<a name="l06587"></a>06587          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;tos_audio&quot;</span>)) {
<a name="l06588"></a>06588             <span class="keywordflow">if</span> (<a class="code" href="acl_8h.html#a49d1eefe77636e2a63ad013afa0fc3b5">ast_str2tos</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, &amp;<a class="code" href="chan__skinny_8c.html#abe7ea21619e746bb9b12fe3e47bc861b">qos</a>.tos_audio))
<a name="l06589"></a>06589                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid tos_audio value at line %d, refer to QoS documentation\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l06590"></a>06590             <span class="keywordflow">continue</span>;
<a name="l06591"></a>06591          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;tos_video&quot;</span>)) {
<a name="l06592"></a>06592             <span class="keywordflow">if</span> (<a class="code" href="acl_8h.html#a49d1eefe77636e2a63ad013afa0fc3b5">ast_str2tos</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, &amp;<a class="code" href="chan__skinny_8c.html#abe7ea21619e746bb9b12fe3e47bc861b">qos</a>.tos_video))
<a name="l06593"></a>06593                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid tos_video value at line %d, refer to QoS documentation\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l06594"></a>06594             <span class="keywordflow">continue</span>;
<a name="l06595"></a>06595          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;cos&quot;</span>)) {
<a name="l06596"></a>06596             <span class="keywordflow">if</span> (<a class="code" href="acl_8h.html#ad364a9241e15fc0dbec0ffcb88f64671">ast_str2cos</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, &amp;<a class="code" href="chan__skinny_8c.html#abe7ea21619e746bb9b12fe3e47bc861b">qos</a>.cos))
<a name="l06597"></a>06597                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid cos value at line %d, refer to QoS documentation\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l06598"></a>06598             <span class="keywordflow">continue</span>;
<a name="l06599"></a>06599          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;cos_audio&quot;</span>)) {
<a name="l06600"></a>06600             <span class="keywordflow">if</span> (<a class="code" href="acl_8h.html#ad364a9241e15fc0dbec0ffcb88f64671">ast_str2cos</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, &amp;<a class="code" href="chan__skinny_8c.html#abe7ea21619e746bb9b12fe3e47bc861b">qos</a>.cos_audio))
<a name="l06601"></a>06601                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid cos_audio value at line %d, refer to QoS documentation\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l06602"></a>06602             <span class="keywordflow">continue</span>;
<a name="l06603"></a>06603          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;cos_video&quot;</span>)) {
<a name="l06604"></a>06604             <span class="keywordflow">if</span> (<a class="code" href="acl_8h.html#ad364a9241e15fc0dbec0ffcb88f64671">ast_str2cos</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, &amp;<a class="code" href="chan__skinny_8c.html#abe7ea21619e746bb9b12fe3e47bc861b">qos</a>.cos_video))
<a name="l06605"></a>06605                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid cos_video value at line %d, refer to QoS documentation\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l06606"></a>06606             <span class="keywordflow">continue</span>;
<a name="l06607"></a>06607          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;bindport&quot;</span>)) {
<a name="l06608"></a>06608             <span class="keywordflow">if</span> (sscanf(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;%5d&quot;</span>, &amp;ourport) == 1) {
<a name="l06609"></a>06609                <a class="code" href="chan__skinny_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>.sin_port = htons(ourport);
<a name="l06610"></a>06610             } <span class="keywordflow">else</span> {
<a name="l06611"></a>06611                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid bindport &apos;%s&apos; at line %d of %s\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>, config);
<a name="l06612"></a>06612             }
<a name="l06613"></a>06613             <span class="keywordflow">continue</span>;
<a name="l06614"></a>06614          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;allow&quot;</span>)) {
<a name="l06615"></a>06615             <a class="code" href="frame_8h.html#a35aa1fb72e1993a14156a6b912034ef9" title="Parse an &amp;quot;allow&amp;quot; or &amp;quot;deny&amp;quot; line in a channel or device configuration...">ast_parse_allow_disallow</a>(&amp;<a class="code" href="chan__skinny_8c.html#a8825096054254f7ab84afdfe5083f564">default_prefs</a>, &amp;default_capability, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, 1);
<a name="l06616"></a>06616             <span class="keywordflow">continue</span>;
<a name="l06617"></a>06617          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;disallow&quot;</span>)) {
<a name="l06618"></a>06618             <a class="code" href="frame_8h.html#a35aa1fb72e1993a14156a6b912034ef9" title="Parse an &amp;quot;allow&amp;quot; or &amp;quot;deny&amp;quot; line in a channel or device configuration...">ast_parse_allow_disallow</a>(&amp;<a class="code" href="chan__skinny_8c.html#a8825096054254f7ab84afdfe5083f564">default_prefs</a>, &amp;default_capability, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, 0);
<a name="l06619"></a>06619             <span class="keywordflow">continue</span>;
<a name="l06620"></a>06620          } 
<a name="l06621"></a>06621       }
<a name="l06622"></a>06622  
<a name="l06623"></a>06623       <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;transfer&quot;</span>)) {
<a name="l06624"></a>06624          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#ad78ece34f886398c83a2ccf05d31499b">TYPE_DEF_DEVICE</a> | <a class="code" href="chan__skinny_8c.html#a1cb072ae2d3e0fdccbbfbbe5a7bff5bd">TYPE_DEVICE</a>)) {
<a name="l06625"></a>06625             <a class="code" href="chan__skinny_8c.html#a9af539d2dccccf8963f64f712844fbab">CDEV_OPTS</a>-&gt;transfer = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l06626"></a>06626             <span class="keywordflow">continue</span>;
<a name="l06627"></a>06627          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#a1041d2c4aa7a5e6f54efdc452178975d">TYPE_DEF_LINE</a> | <a class="code" href="chan__mgcp_8c.html#abe6753ebe7fd05e1561f837b71f81372">TYPE_LINE</a>)) {
<a name="l06628"></a>06628             <a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;transfer = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l06629"></a>06629             <span class="keywordflow">continue</span>;
<a name="l06630"></a>06630          }
<a name="l06631"></a>06631       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;callwaiting&quot;</span>)) {
<a name="l06632"></a>06632          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#ad78ece34f886398c83a2ccf05d31499b">TYPE_DEF_DEVICE</a> | <a class="code" href="chan__skinny_8c.html#a1cb072ae2d3e0fdccbbfbbe5a7bff5bd">TYPE_DEVICE</a>)) {
<a name="l06633"></a>06633             <a class="code" href="chan__skinny_8c.html#a9af539d2dccccf8963f64f712844fbab">CDEV_OPTS</a>-&gt;callwaiting = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l06634"></a>06634             <span class="keywordflow">continue</span>;
<a name="l06635"></a>06635          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#a1041d2c4aa7a5e6f54efdc452178975d">TYPE_DEF_LINE</a> | <a class="code" href="chan__mgcp_8c.html#abe6753ebe7fd05e1561f837b71f81372">TYPE_LINE</a>)) {
<a name="l06636"></a>06636             <a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;callwaiting = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l06637"></a>06637             <span class="keywordflow">continue</span>;
<a name="l06638"></a>06638          }
<a name="l06639"></a>06639       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;directmedia&quot;</span>) || !strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;canreinvite&quot;</span>)) {
<a name="l06640"></a>06640          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#a1041d2c4aa7a5e6f54efdc452178975d">TYPE_DEF_LINE</a> | <a class="code" href="chan__mgcp_8c.html#abe6753ebe7fd05e1561f837b71f81372">TYPE_LINE</a>)) {
<a name="l06641"></a>06641             <a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;directmedia = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l06642"></a>06642             <span class="keywordflow">continue</span>;
<a name="l06643"></a>06643          }
<a name="l06644"></a>06644       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;nat&quot;</span>)) {
<a name="l06645"></a>06645          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#a1041d2c4aa7a5e6f54efdc452178975d">TYPE_DEF_LINE</a> | <a class="code" href="chan__mgcp_8c.html#abe6753ebe7fd05e1561f837b71f81372">TYPE_LINE</a>)) {
<a name="l06646"></a>06646             <a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;nat = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l06647"></a>06647             <span class="keywordflow">continue</span>;
<a name="l06648"></a>06648          }
<a name="l06649"></a>06649       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;context&quot;</span>)) {
<a name="l06650"></a>06650          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#a1041d2c4aa7a5e6f54efdc452178975d">TYPE_DEF_LINE</a> | <a class="code" href="chan__mgcp_8c.html#abe6753ebe7fd05e1561f837b71f81372">TYPE_LINE</a>)) {
<a name="l06651"></a>06651             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;context, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(<a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;context));
<a name="l06652"></a>06652             <span class="keywordflow">continue</span>;
<a name="l06653"></a>06653          }
<a name="l06654"></a>06654       }<span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;vmexten&quot;</span>)) {
<a name="l06655"></a>06655          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#ad78ece34f886398c83a2ccf05d31499b">TYPE_DEF_DEVICE</a> | <a class="code" href="chan__skinny_8c.html#a1cb072ae2d3e0fdccbbfbbe5a7bff5bd">TYPE_DEVICE</a>)) {
<a name="l06656"></a>06656             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="chan__skinny_8c.html#a9af539d2dccccf8963f64f712844fbab">CDEV_OPTS</a>-&gt;vmexten, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(<a class="code" href="chan__skinny_8c.html#a9af539d2dccccf8963f64f712844fbab">CDEV_OPTS</a>-&gt;vmexten));
<a name="l06657"></a>06657             <span class="keywordflow">continue</span>;
<a name="l06658"></a>06658          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#a1041d2c4aa7a5e6f54efdc452178975d">TYPE_DEF_LINE</a> | <a class="code" href="chan__mgcp_8c.html#abe6753ebe7fd05e1561f837b71f81372">TYPE_LINE</a>)) {
<a name="l06659"></a>06659             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;vmexten, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(<a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;vmexten));
<a name="l06660"></a>06660             <span class="keywordflow">continue</span>;
<a name="l06661"></a>06661          }
<a name="l06662"></a>06662       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;mwiblink&quot;</span>)) {
<a name="l06663"></a>06663          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#ad78ece34f886398c83a2ccf05d31499b">TYPE_DEF_DEVICE</a> | <a class="code" href="chan__skinny_8c.html#a1cb072ae2d3e0fdccbbfbbe5a7bff5bd">TYPE_DEVICE</a>)) {
<a name="l06664"></a>06664             <a class="code" href="chan__skinny_8c.html#a9af539d2dccccf8963f64f712844fbab">CDEV_OPTS</a>-&gt;mwiblink = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l06665"></a>06665             <span class="keywordflow">continue</span>;
<a name="l06666"></a>06666          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#a1041d2c4aa7a5e6f54efdc452178975d">TYPE_DEF_LINE</a> | <a class="code" href="chan__mgcp_8c.html#abe6753ebe7fd05e1561f837b71f81372">TYPE_LINE</a>)) {
<a name="l06667"></a>06667             <a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;mwiblink = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l06668"></a>06668             <span class="keywordflow">continue</span>;
<a name="l06669"></a>06669          }
<a name="l06670"></a>06670       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;linelabel&quot;</span>)) {
<a name="l06671"></a>06671          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#a1041d2c4aa7a5e6f54efdc452178975d">TYPE_DEF_LINE</a> | <a class="code" href="chan__mgcp_8c.html#abe6753ebe7fd05e1561f837b71f81372">TYPE_LINE</a>)) {
<a name="l06672"></a>06672             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;label, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(<a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;label));
<a name="l06673"></a>06673             <span class="keywordflow">continue</span>;
<a name="l06674"></a>06674          }
<a name="l06675"></a>06675       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;callerid&quot;</span>)) {
<a name="l06676"></a>06676          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#a1041d2c4aa7a5e6f54efdc452178975d">TYPE_DEF_LINE</a> | <a class="code" href="chan__mgcp_8c.html#abe6753ebe7fd05e1561f837b71f81372">TYPE_LINE</a>)) {
<a name="l06677"></a>06677             <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;asreceived&quot;</span>)) {
<a name="l06678"></a>06678                <a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;cid_num[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l06679"></a>06679                <a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;cid_name[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l06680"></a>06680             } <span class="keywordflow">else</span> {
<a name="l06681"></a>06681                <a class="code" href="callerid_8h.html#af33ee38631fe79ab21d91bcd0634903a">ast_callerid_split</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;cid_name, <span class="keyword">sizeof</span>(<a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;cid_name), <a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;cid_num, <span class="keyword">sizeof</span>(<a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;cid_num));
<a name="l06682"></a>06682             }
<a name="l06683"></a>06683             <span class="keywordflow">continue</span>;
<a name="l06684"></a>06684          }
<a name="l06685"></a>06685       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;amaflags&quot;</span>)) {
<a name="l06686"></a>06686          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#a1041d2c4aa7a5e6f54efdc452178975d">TYPE_DEF_LINE</a> | <a class="code" href="chan__mgcp_8c.html#abe6753ebe7fd05e1561f837b71f81372">TYPE_LINE</a>)) {
<a name="l06687"></a>06687             <span class="keywordtype">int</span> tempamaflags = <a class="code" href="cdr_8h.html#a5c2d2dee484a1ad9dbef128c11a2b693" title="Convert a string to a detail record AMA flag.">ast_cdr_amaflags2int</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l06688"></a>06688             <span class="keywordflow">if</span> (tempamaflags &lt; 0) {
<a name="l06689"></a>06689                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid AMA flags: %s at line %d\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l06690"></a>06690             } <span class="keywordflow">else</span> {
<a name="l06691"></a>06691                <a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;amaflags = tempamaflags;
<a name="l06692"></a>06692             }
<a name="l06693"></a>06693             <span class="keywordflow">continue</span>;
<a name="l06694"></a>06694          }
<a name="l06695"></a>06695       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;regexten&quot;</span>)) {
<a name="l06696"></a>06696          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#a1041d2c4aa7a5e6f54efdc452178975d">TYPE_DEF_LINE</a> | <a class="code" href="chan__mgcp_8c.html#abe6753ebe7fd05e1561f837b71f81372">TYPE_LINE</a>)) {
<a name="l06697"></a>06697             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;regexten, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(<a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;regexten));
<a name="l06698"></a>06698             <span class="keywordflow">continue</span>;
<a name="l06699"></a>06699          }
<a name="l06700"></a>06700       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;language&quot;</span>)) {
<a name="l06701"></a>06701          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#a1041d2c4aa7a5e6f54efdc452178975d">TYPE_DEF_LINE</a> | <a class="code" href="chan__mgcp_8c.html#abe6753ebe7fd05e1561f837b71f81372">TYPE_LINE</a>)) {
<a name="l06702"></a>06702             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;language, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(<a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;language));
<a name="l06703"></a>06703             <span class="keywordflow">continue</span>;
<a name="l06704"></a>06704          }
<a name="l06705"></a>06705       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;accountcode&quot;</span>)) {
<a name="l06706"></a>06706          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#a1041d2c4aa7a5e6f54efdc452178975d">TYPE_DEF_LINE</a> | <a class="code" href="chan__mgcp_8c.html#abe6753ebe7fd05e1561f837b71f81372">TYPE_LINE</a>)) {
<a name="l06707"></a>06707             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;accountcode, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(<a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;accountcode));
<a name="l06708"></a>06708             <span class="keywordflow">continue</span>;
<a name="l06709"></a>06709          }
<a name="l06710"></a>06710       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;mohinterpret&quot;</span>) || !strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;musiconhold&quot;</span>)) {
<a name="l06711"></a>06711          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#a1041d2c4aa7a5e6f54efdc452178975d">TYPE_DEF_LINE</a> | <a class="code" href="chan__mgcp_8c.html#abe6753ebe7fd05e1561f837b71f81372">TYPE_LINE</a>)) {
<a name="l06712"></a>06712             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;mohinterpret, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(<a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;mohinterpret));
<a name="l06713"></a>06713             <span class="keywordflow">continue</span>;
<a name="l06714"></a>06714          }
<a name="l06715"></a>06715       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;mohsuggest&quot;</span>)) {
<a name="l06716"></a>06716          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#a1041d2c4aa7a5e6f54efdc452178975d">TYPE_DEF_LINE</a> | <a class="code" href="chan__mgcp_8c.html#abe6753ebe7fd05e1561f837b71f81372">TYPE_LINE</a>)) {
<a name="l06717"></a>06717             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;mohsuggest, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(<a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;mohsuggest));
<a name="l06718"></a>06718             <span class="keywordflow">continue</span>;
<a name="l06719"></a>06719          }
<a name="l06720"></a>06720       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;callgroup&quot;</span>)) {
<a name="l06721"></a>06721          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#a1041d2c4aa7a5e6f54efdc452178975d">TYPE_DEF_LINE</a> | <a class="code" href="chan__mgcp_8c.html#abe6753ebe7fd05e1561f837b71f81372">TYPE_LINE</a>)) {
<a name="l06722"></a>06722             <a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;callgroup = <a class="code" href="channel_8h.html#aee83e23058d0a4111fda1f506cbda107">ast_get_group</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l06723"></a>06723             <span class="keywordflow">continue</span>;
<a name="l06724"></a>06724          }
<a name="l06725"></a>06725       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;pickupgroup&quot;</span>)) {
<a name="l06726"></a>06726          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#a1041d2c4aa7a5e6f54efdc452178975d">TYPE_DEF_LINE</a> | <a class="code" href="chan__mgcp_8c.html#abe6753ebe7fd05e1561f837b71f81372">TYPE_LINE</a>)) {
<a name="l06727"></a>06727             <a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;pickupgroup = <a class="code" href="channel_8h.html#aee83e23058d0a4111fda1f506cbda107">ast_get_group</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l06728"></a>06728             <span class="keywordflow">continue</span>;
<a name="l06729"></a>06729          }
<a name="l06730"></a>06730       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;immediate&quot;</span>)) {
<a name="l06731"></a>06731          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#ad78ece34f886398c83a2ccf05d31499b">TYPE_DEF_DEVICE</a> | <a class="code" href="chan__skinny_8c.html#a1cb072ae2d3e0fdccbbfbbe5a7bff5bd">TYPE_DEVICE</a> | <a class="code" href="chan__skinny_8c.html#a1041d2c4aa7a5e6f54efdc452178975d">TYPE_DEF_LINE</a> | <a class="code" href="chan__mgcp_8c.html#abe6753ebe7fd05e1561f837b71f81372">TYPE_LINE</a>)) {
<a name="l06732"></a>06732             <a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;immediate = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l06733"></a>06733             <span class="keywordflow">continue</span>;
<a name="l06734"></a>06734          }
<a name="l06735"></a>06735       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;cancallforward&quot;</span>)) {
<a name="l06736"></a>06736          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#a1041d2c4aa7a5e6f54efdc452178975d">TYPE_DEF_LINE</a> | <a class="code" href="chan__mgcp_8c.html#abe6753ebe7fd05e1561f837b71f81372">TYPE_LINE</a>)) {
<a name="l06737"></a>06737             <a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;cancallforward = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l06738"></a>06738             <span class="keywordflow">continue</span>;
<a name="l06739"></a>06739          }
<a name="l06740"></a>06740       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;mailbox&quot;</span>)) {
<a name="l06741"></a>06741          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#a1041d2c4aa7a5e6f54efdc452178975d">TYPE_DEF_LINE</a> | <a class="code" href="chan__mgcp_8c.html#abe6753ebe7fd05e1561f837b71f81372">TYPE_LINE</a>)) {
<a name="l06742"></a>06742             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;mailbox, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(<a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;mailbox));
<a name="l06743"></a>06743             <span class="keywordflow">continue</span>;
<a name="l06744"></a>06744          }
<a name="l06745"></a>06745       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( !strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;parkinglot&quot;</span>)) {
<a name="l06746"></a>06746          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#a1041d2c4aa7a5e6f54efdc452178975d">TYPE_DEF_LINE</a> | <a class="code" href="chan__mgcp_8c.html#abe6753ebe7fd05e1561f837b71f81372">TYPE_LINE</a>)) {
<a name="l06747"></a>06747             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;parkinglot, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(<a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;parkinglot));
<a name="l06748"></a>06748             <span class="keywordflow">continue</span>;
<a name="l06749"></a>06749          }
<a name="l06750"></a>06750       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;hasvoicemail&quot;</span>)) {
<a name="l06751"></a>06751          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__mgcp_8c.html#abe6753ebe7fd05e1561f837b71f81372">TYPE_LINE</a>)) {
<a name="l06752"></a>06752             <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>) &amp;&amp; <a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="chan__skinny_8c.html#ad5a3074858d7493097d940e0be4365f3">CLINE</a>-&gt;mailbox)) {
<a name="l06753"></a>06753                <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="chan__skinny_8c.html#ad5a3074858d7493097d940e0be4365f3">CLINE</a>-&gt;mailbox, <a class="code" href="chan__skinny_8c.html#ad5a3074858d7493097d940e0be4365f3">CLINE</a>-&gt;name, <span class="keyword">sizeof</span>(<a class="code" href="chan__skinny_8c.html#ad5a3074858d7493097d940e0be4365f3">CLINE</a>-&gt;mailbox));
<a name="l06754"></a>06754             }
<a name="l06755"></a>06755             <span class="keywordflow">continue</span>;
<a name="l06756"></a>06756          }
<a name="l06757"></a>06757       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;callreturn&quot;</span>)) {
<a name="l06758"></a>06758          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#a1041d2c4aa7a5e6f54efdc452178975d">TYPE_DEF_LINE</a> | <a class="code" href="chan__mgcp_8c.html#abe6753ebe7fd05e1561f837b71f81372">TYPE_LINE</a>)) {
<a name="l06759"></a>06759             <a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;callreturn = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l06760"></a>06760             <span class="keywordflow">continue</span>;
<a name="l06761"></a>06761          }
<a name="l06762"></a>06762       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;threewaycalling&quot;</span>)) {
<a name="l06763"></a>06763          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#a1041d2c4aa7a5e6f54efdc452178975d">TYPE_DEF_LINE</a> | <a class="code" href="chan__mgcp_8c.html#abe6753ebe7fd05e1561f837b71f81372">TYPE_LINE</a>)) {
<a name="l06764"></a>06764             <a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;threewaycalling = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l06765"></a>06765             <span class="keywordflow">continue</span>;
<a name="l06766"></a>06766          }
<a name="l06767"></a>06767       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;setvar&quot;</span>)) {
<a name="l06768"></a>06768          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__mgcp_8c.html#abe6753ebe7fd05e1561f837b71f81372">TYPE_LINE</a>)) {
<a name="l06769"></a>06769             <a class="code" href="chan__skinny_8c.html#ad5a3074858d7493097d940e0be4365f3">CLINE</a>-&gt;chanvars = <a class="code" href="chan__skinny_8c.html#aeb7b46c1c2ecae89c0bb53a53f5684d2">add_var</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <a class="code" href="chan__skinny_8c.html#ad5a3074858d7493097d940e0be4365f3">CLINE</a>-&gt;chanvars);
<a name="l06770"></a>06770             <span class="keywordflow">continue</span>;
<a name="l06771"></a>06771          }
<a name="l06772"></a>06772       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;earlyrtp&quot;</span>)) {
<a name="l06773"></a>06773          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#ad78ece34f886398c83a2ccf05d31499b">TYPE_DEF_DEVICE</a> | <a class="code" href="chan__skinny_8c.html#a1cb072ae2d3e0fdccbbfbbe5a7bff5bd">TYPE_DEVICE</a>)) {
<a name="l06774"></a>06774             <a class="code" href="chan__skinny_8c.html#a9af539d2dccccf8963f64f712844fbab">CDEV_OPTS</a>-&gt;earlyrtp = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l06775"></a>06775             <span class="keywordflow">continue</span>;
<a name="l06776"></a>06776          }
<a name="l06777"></a>06777       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;host&quot;</span>)) {
<a name="l06778"></a>06778          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#a1cb072ae2d3e0fdccbbfbbe5a7bff5bd">TYPE_DEVICE</a>)) {
<a name="l06779"></a>06779             <span class="keywordflow">if</span> (<a class="code" href="acl_8h.html#af04bd435c082da93aec0cb6e0782788a">ast_get_ip</a>(&amp;<a class="code" href="chan__skinny_8c.html#a36da73f15a23c9efbc5efabb8cc08f73">CDEV</a>-&gt;addr, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>)) {
<a name="l06780"></a>06780                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Bad IP &apos;%s&apos; at line %d.\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l06781"></a>06781             }
<a name="l06782"></a>06782             <span class="keywordflow">continue</span>;
<a name="l06783"></a>06783          }
<a name="l06784"></a>06784       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;port&quot;</span>)) {
<a name="l06785"></a>06785          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#ad78ece34f886398c83a2ccf05d31499b">TYPE_DEF_DEVICE</a>)) {
<a name="l06786"></a>06786             <a class="code" href="chan__skinny_8c.html#a36da73f15a23c9efbc5efabb8cc08f73">CDEV</a>-&gt;addr.sin_port = htons(atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>));
<a name="l06787"></a>06787             <span class="keywordflow">continue</span>;
<a name="l06788"></a>06788          }
<a name="l06789"></a>06789       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;device&quot;</span>)) {
<a name="l06790"></a>06790          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#a1cb072ae2d3e0fdccbbfbbe5a7bff5bd">TYPE_DEVICE</a>)) {
<a name="l06791"></a>06791             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="chan__skinny_8c.html#a9af539d2dccccf8963f64f712844fbab">CDEV_OPTS</a>-&gt;id, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(<a class="code" href="chan__skinny_8c.html#a9af539d2dccccf8963f64f712844fbab">CDEV_OPTS</a>-&gt;id));
<a name="l06792"></a>06792             <span class="keywordflow">continue</span>;
<a name="l06793"></a>06793          }
<a name="l06794"></a>06794       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;permit&quot;</span>) || !strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;deny&quot;</span>)) {
<a name="l06795"></a>06795          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#a1cb072ae2d3e0fdccbbfbbe5a7bff5bd">TYPE_DEVICE</a>)) {
<a name="l06796"></a>06796             <a class="code" href="chan__skinny_8c.html#a36da73f15a23c9efbc5efabb8cc08f73">CDEV</a>-&gt;ha = <a class="code" href="acl_8h.html#ae839a9c2465be4e9a560dda668a65b9b" title="Append ACL entry to host access list.">ast_append_ha</a>(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <a class="code" href="chan__skinny_8c.html#a36da73f15a23c9efbc5efabb8cc08f73">CDEV</a>-&gt;ha, NULL);
<a name="l06797"></a>06797             <span class="keywordflow">continue</span>;
<a name="l06798"></a>06798          }
<a name="l06799"></a>06799       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;allow&quot;</span>)) {
<a name="l06800"></a>06800          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#ad78ece34f886398c83a2ccf05d31499b">TYPE_DEF_DEVICE</a> | <a class="code" href="chan__skinny_8c.html#a1cb072ae2d3e0fdccbbfbbe5a7bff5bd">TYPE_DEVICE</a>)) {
<a name="l06801"></a>06801             <a class="code" href="frame_8h.html#a35aa1fb72e1993a14156a6b912034ef9" title="Parse an &amp;quot;allow&amp;quot; or &amp;quot;deny&amp;quot; line in a channel or device configuration...">ast_parse_allow_disallow</a>(&amp;<a class="code" href="chan__skinny_8c.html#a9af539d2dccccf8963f64f712844fbab">CDEV_OPTS</a>-&gt;confprefs, &amp;<a class="code" href="chan__skinny_8c.html#a9af539d2dccccf8963f64f712844fbab">CDEV_OPTS</a>-&gt;confcapability, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, 1);
<a name="l06802"></a>06802             <span class="keywordflow">continue</span>;
<a name="l06803"></a>06803          }
<a name="l06804"></a>06804          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#a1041d2c4aa7a5e6f54efdc452178975d">TYPE_DEF_LINE</a> | <a class="code" href="chan__mgcp_8c.html#abe6753ebe7fd05e1561f837b71f81372">TYPE_LINE</a>)) {
<a name="l06805"></a>06805             <a class="code" href="frame_8h.html#a35aa1fb72e1993a14156a6b912034ef9" title="Parse an &amp;quot;allow&amp;quot; or &amp;quot;deny&amp;quot; line in a channel or device configuration...">ast_parse_allow_disallow</a>(&amp;<a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;confprefs, &amp;<a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;confcapability, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, 1);
<a name="l06806"></a>06806             <span class="keywordflow">continue</span>;
<a name="l06807"></a>06807          }
<a name="l06808"></a>06808       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;disallow&quot;</span>)) {
<a name="l06809"></a>06809          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#ad78ece34f886398c83a2ccf05d31499b">TYPE_DEF_DEVICE</a> | <a class="code" href="chan__skinny_8c.html#a1cb072ae2d3e0fdccbbfbbe5a7bff5bd">TYPE_DEVICE</a>)) {
<a name="l06810"></a>06810             <a class="code" href="frame_8h.html#a35aa1fb72e1993a14156a6b912034ef9" title="Parse an &amp;quot;allow&amp;quot; or &amp;quot;deny&amp;quot; line in a channel or device configuration...">ast_parse_allow_disallow</a>(&amp;<a class="code" href="chan__skinny_8c.html#a9af539d2dccccf8963f64f712844fbab">CDEV_OPTS</a>-&gt;confprefs, &amp;<a class="code" href="chan__skinny_8c.html#a9af539d2dccccf8963f64f712844fbab">CDEV_OPTS</a>-&gt;confcapability, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, 0);
<a name="l06811"></a>06811             <span class="keywordflow">continue</span>;
<a name="l06812"></a>06812          }
<a name="l06813"></a>06813          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#a1041d2c4aa7a5e6f54efdc452178975d">TYPE_DEF_LINE</a> | <a class="code" href="chan__mgcp_8c.html#abe6753ebe7fd05e1561f837b71f81372">TYPE_LINE</a>)) {
<a name="l06814"></a>06814             <a class="code" href="frame_8h.html#a35aa1fb72e1993a14156a6b912034ef9" title="Parse an &amp;quot;allow&amp;quot; or &amp;quot;deny&amp;quot; line in a channel or device configuration...">ast_parse_allow_disallow</a>(&amp;<a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;confprefs, &amp;<a class="code" href="chan__skinny_8c.html#a733134b7afc2e7cd8481d089d2880bf6">CLINE_OPTS</a>-&gt;confcapability, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, 0);
<a name="l06815"></a>06815             <span class="keywordflow">continue</span>;
<a name="l06816"></a>06816          }
<a name="l06817"></a>06817       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;version&quot;</span>)) {
<a name="l06818"></a>06818          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#ad78ece34f886398c83a2ccf05d31499b">TYPE_DEF_DEVICE</a> | <a class="code" href="chan__skinny_8c.html#a1cb072ae2d3e0fdccbbfbbe5a7bff5bd">TYPE_DEVICE</a>)) {
<a name="l06819"></a>06819             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="chan__skinny_8c.html#a9af539d2dccccf8963f64f712844fbab">CDEV_OPTS</a>-&gt;version_id, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(<a class="code" href="chan__skinny_8c.html#a9af539d2dccccf8963f64f712844fbab">CDEV_OPTS</a>-&gt;version_id));
<a name="l06820"></a>06820             <span class="keywordflow">continue</span>;
<a name="l06821"></a>06821          }
<a name="l06822"></a>06822       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;line&quot;</span>)) {
<a name="l06823"></a>06823          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#a1cb072ae2d3e0fdccbbfbbe5a7bff5bd">TYPE_DEVICE</a>)) {
<a name="l06824"></a>06824             <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l;
<a name="l06825"></a>06825             <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;lines, l, all) {
<a name="l06826"></a>06826                <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, l-&gt;name) &amp;&amp; !l-&gt;prune) {
<a name="l06827"></a>06827 
<a name="l06828"></a>06828                   <span class="comment">/* FIXME: temp solution about line conflicts */</span>
<a name="l06829"></a>06829                   <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d;
<a name="l06830"></a>06830                   <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l2;
<a name="l06831"></a>06831                   <span class="keywordtype">int</span> lineinuse = 0;
<a name="l06832"></a>06832                   <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>, d, list) {
<a name="l06833"></a>06833                      <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;lines, l2, list) {
<a name="l06834"></a>06834                         <span class="keywordflow">if</span> (l2 == l &amp;&amp; strcasecmp(d-&gt;id, <a class="code" href="chan__skinny_8c.html#a36da73f15a23c9efbc5efabb8cc08f73">CDEV</a>-&gt;id)) {
<a name="l06835"></a>06835                            <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Line %s already used by %s. Not connecting to %s.\n&quot;</span>, l-&gt;name, d-&gt;name, <a class="code" href="chan__skinny_8c.html#a36da73f15a23c9efbc5efabb8cc08f73">CDEV</a>-&gt;name);
<a name="l06836"></a>06836                            lineinuse++;
<a name="l06837"></a>06837                         }
<a name="l06838"></a>06838                      }
<a name="l06839"></a>06839                   }
<a name="l06840"></a>06840                   <span class="keywordflow">if</span> (!lineinuse) {
<a name="l06841"></a>06841                      <span class="keywordflow">if</span> (!<a class="code" href="linkedlists_8h.html#adf1959c5c03a3a706da97ad2f49617e5" title="Returns the first entry contained in a list.">AST_LIST_FIRST</a>(&amp;<a class="code" href="chan__skinny_8c.html#a36da73f15a23c9efbc5efabb8cc08f73">CDEV</a>-&gt;lines)) {
<a name="l06842"></a>06842                         <a class="code" href="chan__skinny_8c.html#a36da73f15a23c9efbc5efabb8cc08f73">CDEV</a>-&gt;activeline = l;
<a name="l06843"></a>06843                      }
<a name="l06844"></a>06844                      lineInstance++;
<a name="l06845"></a>06845                      <a class="code" href="linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307" title="Inserts a list entry at the head of a list.">AST_LIST_INSERT_HEAD</a>(&amp;<a class="code" href="chan__skinny_8c.html#a36da73f15a23c9efbc5efabb8cc08f73">CDEV</a>-&gt;lines, l, list);
<a name="l06846"></a>06846                   }
<a name="l06847"></a>06847                   <span class="keywordflow">break</span>;
<a name="l06848"></a>06848                }
<a name="l06849"></a>06849             }
<a name="l06850"></a>06850             <span class="keywordflow">continue</span>;
<a name="l06851"></a>06851          }
<a name="l06852"></a>06852       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;speeddial&quot;</span>)) {
<a name="l06853"></a>06853          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#a1cb072ae2d3e0fdccbbfbbe5a7bff5bd">TYPE_DEVICE</a>)) {
<a name="l06854"></a>06854             <span class="keyword">struct </span><a class="code" href="structskinny__speeddial.html">skinny_speeddial</a> *sd;
<a name="l06855"></a>06855             <span class="keywordflow">if</span> (!(sd = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*sd)))) {
<a name="l06856"></a>06856                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to allocate memory for speeddial %s. Ignoring speeddial.\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);
<a name="l06857"></a>06857                <span class="keywordflow">continue</span>;
<a name="l06858"></a>06858             } <span class="keywordflow">else</span> {
<a name="l06859"></a>06859                <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[256];
<a name="l06860"></a>06860                <span class="keywordtype">char</span> *stringp = buf, *<a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, *<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, *<a class="code" href="structskinny__speeddial.html#ab20c01b68c97d3477a795c85e6c37be9">label</a>;
<a name="l06861"></a>06861                   <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(buf, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(buf));
<a name="l06862"></a>06862                exten = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;stringp, <span class="stringliteral">&quot;,&quot;</span>);
<a name="l06863"></a>06863                <span class="keywordflow">if</span> ((context = strchr(exten, <span class="charliteral">&apos;@&apos;</span>))) {
<a name="l06864"></a>06864                   *context++ = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l06865"></a>06865                }
<a name="l06866"></a>06866                label = stringp;
<a name="l06867"></a>06867                <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;sd-&gt;<a class="code" href="structskinny__speeddial.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06868"></a>06868                <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(sd-&gt;<a class="code" href="structskinny__speeddial.html#a78d4847658b695383d849efd12399b38">exten</a>, exten, <span class="keyword">sizeof</span>(sd-&gt;<a class="code" href="structskinny__speeddial.html#a78d4847658b695383d849efd12399b38">exten</a>));
<a name="l06869"></a>06869                <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(context)) {
<a name="l06870"></a>06870                   sd-&gt;<a class="code" href="structskinny__speeddial.html#ad3d414cdb71376b88dc5ce91a2a6118e">isHint</a> = 1;
<a name="l06871"></a>06871                   sd-&gt;<a class="code" href="structskinny__speeddial.html#a6fd216872447cfe5f757d2ce47fea6fb">instance</a> = lineInstance++;
<a name="l06872"></a>06872                   <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(sd-&gt;<a class="code" href="structskinny__speeddial.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, context, <span class="keyword">sizeof</span>(sd-&gt;<a class="code" href="structskinny__speeddial.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>));
<a name="l06873"></a>06873                } <span class="keywordflow">else</span> {
<a name="l06874"></a>06874                   sd-&gt;<a class="code" href="structskinny__speeddial.html#ad3d414cdb71376b88dc5ce91a2a6118e">isHint</a> = 0;
<a name="l06875"></a>06875                   sd-&gt;<a class="code" href="structskinny__speeddial.html#a6fd216872447cfe5f757d2ce47fea6fb">instance</a> = speeddialInstance++;
<a name="l06876"></a>06876                   sd-&gt;<a class="code" href="structskinny__speeddial.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l06877"></a>06877                }
<a name="l06878"></a>06878                <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(sd-&gt;<a class="code" href="structskinny__speeddial.html#ab20c01b68c97d3477a795c85e6c37be9">label</a>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(label, exten), <span class="keyword">sizeof</span>(sd-&gt;<a class="code" href="structskinny__speeddial.html#ab20c01b68c97d3477a795c85e6c37be9">label</a>));
<a name="l06879"></a>06879                sd-&gt;parent = <a class="code" href="chan__skinny_8c.html#a36da73f15a23c9efbc5efabb8cc08f73">CDEV</a>;
<a name="l06880"></a>06880                <a class="code" href="linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307" title="Inserts a list entry at the head of a list.">AST_LIST_INSERT_HEAD</a>(&amp;<a class="code" href="chan__skinny_8c.html#a36da73f15a23c9efbc5efabb8cc08f73">CDEV</a>-&gt;speeddials, sd, list);
<a name="l06881"></a>06881             }
<a name="l06882"></a>06882             <span class="keywordflow">continue</span>;
<a name="l06883"></a>06883          }
<a name="l06884"></a>06884       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;addon&quot;</span>)) {
<a name="l06885"></a>06885          <span class="keywordflow">if</span> (type &amp; (<a class="code" href="chan__skinny_8c.html#a1cb072ae2d3e0fdccbbfbbe5a7bff5bd">TYPE_DEVICE</a>)) {
<a name="l06886"></a>06886             <span class="keyword">struct </span>skinny_addon *a;
<a name="l06887"></a>06887             <span class="keywordflow">if</span> (!(a = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*a)))) {
<a name="l06888"></a>06888                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to allocate memory for addon %s. Ignoring addon.\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);
<a name="l06889"></a>06889                <span class="keywordflow">continue</span>;
<a name="l06890"></a>06890             } <span class="keywordflow">else</span> {
<a name="l06891"></a>06891                <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;a-&gt;<a class="code" href="structskinny__addon.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06892"></a>06892                <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(a-&gt;<a class="code" href="structskinny__addon.html#a33e6e7edca48ac1ff105d85011dfc454">type</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(a-&gt;<a class="code" href="structskinny__addon.html#a33e6e7edca48ac1ff105d85011dfc454">type</a>));
<a name="l06893"></a>06893                <a class="code" href="linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307" title="Inserts a list entry at the head of a list.">AST_LIST_INSERT_HEAD</a>(&amp;<a class="code" href="chan__skinny_8c.html#a36da73f15a23c9efbc5efabb8cc08f73">CDEV</a>-&gt;addons, a, list);
<a name="l06894"></a>06894             }
<a name="l06895"></a>06895             <span class="keywordflow">continue</span>;
<a name="l06896"></a>06896          }
<a name="l06897"></a>06897 
<a name="l06898"></a>06898       } <span class="keywordflow">else</span> {
<a name="l06899"></a>06899          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Don&apos;t know keyword &apos;%s&apos; at line %d\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l06900"></a>06900          <span class="keywordflow">continue</span>;
<a name="l06901"></a>06901       }
<a name="l06902"></a>06902       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid category used: %s at line %d\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l06903"></a>06903    }
<a name="l06904"></a>06904  }
<a name="l06905"></a>06905  
<a name="l06906"></a><a class="code" href="chan__skinny_8c.html#af7fc256a5120f42598d936ab979d302f">06906</a>  <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *<a class="code" href="chan__skinny_8c.html#af7fc256a5120f42598d936ab979d302f">config_line</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *lname, <span class="keyword">struct</span> <a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *v)
<a name="l06907"></a>06907  {
<a name="l06908"></a>06908    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l, *temp;
<a name="l06909"></a>06909    <span class="keywordtype">int</span> <a class="code" href="codec__g726_8c.html#a8c58a1d1fd9436ff5145385d3ef7a430">update</a> = 0;
<a name="l06910"></a>06910  
<a name="l06911"></a>06911    <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Configuring skinny line %s.\n&quot;</span>, lname);
<a name="l06912"></a>06912 
<a name="l06913"></a>06913    <span class="comment">/* We find the old line and remove it just before the new</span>
<a name="l06914"></a>06914 <span class="comment">      line is created */</span>
<a name="l06915"></a>06915    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;lines);
<a name="l06916"></a>06916    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;lines, temp, all) {
<a name="l06917"></a>06917       <span class="keywordflow">if</span> (!strcasecmp(lname, temp-&gt;name) &amp;&amp; temp-&gt;prune) {
<a name="l06918"></a>06918          update = 1;
<a name="l06919"></a>06919          <span class="keywordflow">break</span>;
<a name="l06920"></a>06920       }
<a name="l06921"></a>06921    }
<a name="l06922"></a>06922 
<a name="l06923"></a>06923    <span class="keywordflow">if</span> (!(l=<a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*l)))) {
<a name="l06924"></a>06924       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Unable to allocate memory for line %s.\n&quot;</span>, lname);
<a name="l06925"></a>06925       <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;lines);
<a name="l06926"></a>06926       <span class="keywordflow">return</span> NULL;
<a name="l06927"></a>06927    }
<a name="l06928"></a>06928 
<a name="l06929"></a>06929    memcpy(l, <a class="code" href="chan__skinny_8c.html#a6e99a595511d5057826b95311fa49465">default_line</a>, <span class="keyword">sizeof</span>(*<a class="code" href="chan__skinny_8c.html#a6e99a595511d5057826b95311fa49465">default_line</a>));
<a name="l06930"></a>06930    <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;l-&gt;<a class="code" href="structskinny__line.html#ae5e68fb86600e9f1e67bb18aaa19f78a">lock</a>);
<a name="l06931"></a>06931    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(l-&gt;name, lname, <span class="keyword">sizeof</span>(l-&gt;name));
<a name="l06932"></a>06932    <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;lines, l, all);
<a name="l06933"></a>06933 
<a name="l06934"></a>06934    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;l-&gt;<a class="code" href="structskinny__line.html#ae5e68fb86600e9f1e67bb18aaa19f78a">lock</a>);
<a name="l06935"></a>06935    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;lines);
<a name="l06936"></a>06936 
<a name="l06937"></a>06937    <a class="code" href="chan__skinny_8c.html#a290744d808f70a1932e3916b0db16acb">config_parse_variables</a>(<a class="code" href="chan__mgcp_8c.html#abe6753ebe7fd05e1561f837b71f81372">TYPE_LINE</a>, l, v);
<a name="l06938"></a>06938          
<a name="l06939"></a>06939    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(l-&gt;mailbox)) {
<a name="l06940"></a>06940       <span class="keywordtype">char</span> *cfg_mailbox, *cfg_context;
<a name="l06941"></a>06941       cfg_context = cfg_mailbox = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(l-&gt;mailbox);
<a name="l06942"></a>06942       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Setting mailbox &apos;%s&apos; on line %s\n&quot;</span>, cfg_mailbox, l-&gt;name);
<a name="l06943"></a>06943       <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;cfg_context, <span class="stringliteral">&quot;@&quot;</span>);
<a name="l06944"></a>06944       <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(cfg_context))
<a name="l06945"></a>06945           cfg_context = <span class="stringliteral">&quot;default&quot;</span>;
<a name="l06946"></a>06946       l-&gt;<a class="code" href="structskinny__line.html#a7dec0df43032d5c53d9a125030385a30">mwi_event_sub</a> = <a class="code" href="event_8h.html#a517ac17630e7658463b66b309a6ce78f" title="Subscribe to events.">ast_event_subscribe</a>(<a class="code" href="event__defs_8h.html#a6fa079412d9d9c1cc539f6d71f37f79fa9a217b1f500680b3e458d62b048c0892">AST_EVENT_MWI</a>, <a class="code" href="chan__skinny_8c.html#a46e4523f99409c6696dc775ed6a5e5ed">mwi_event_cb</a>, l,
<a name="l06947"></a>06947          <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491aae6c80d8f4c6ab3cee006ed57d874710" title="Mailbox name.">AST_EVENT_IE_MAILBOX</a>, <a class="code" href="event__defs_8h.html#a73dadfa1128d5e75107536e132e758c6ab82ac16f0791be2f8f918429a73430be">AST_EVENT_IE_PLTYPE_STR</a>, cfg_mailbox,
<a name="l06948"></a>06948          <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491a25764e2fb734ccb3ee1f6f41caba5318" title="Context IE Used by AST_EVENT_MWI Payload type: str.">AST_EVENT_IE_CONTEXT</a>, <a class="code" href="event__defs_8h.html#a73dadfa1128d5e75107536e132e758c6ab82ac16f0791be2f8f918429a73430be">AST_EVENT_IE_PLTYPE_STR</a>, cfg_context,
<a name="l06949"></a>06949          <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491aff40847f0450f17c96e94e721aee38f2" title="Number of new messages Used by: AST_EVENT_MWI Payload type: UINT.">AST_EVENT_IE_NEWMSGS</a>, <a class="code" href="event__defs_8h.html#a73dadfa1128d5e75107536e132e758c6a9a74c1021384e906552a3187545b5068">AST_EVENT_IE_PLTYPE_EXISTS</a>,
<a name="l06950"></a>06950          <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491a04c78c1362e97d548344c354001c151f">AST_EVENT_IE_END</a>);
<a name="l06951"></a>06951    }
<a name="l06952"></a>06952  
<a name="l06953"></a>06953    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;l-&gt;<a class="code" href="structskinny__line.html#ae5e68fb86600e9f1e67bb18aaa19f78a">lock</a>);
<a name="l06954"></a>06954    
<a name="l06955"></a>06955    <span class="comment">/* We do not want to unlink or free the line yet, it needs</span>
<a name="l06956"></a>06956 <span class="comment">      to be available to detect a device reconfig when we load the</span>
<a name="l06957"></a>06957 <span class="comment">      devices.  Old lines will be pruned after the reload completes */</span>
<a name="l06958"></a>06958 
<a name="l06959"></a>06959    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;%s config for line &apos;%s&apos;\n&quot;</span>, update ? <span class="stringliteral">&quot;Updated&quot;</span> : (skinnyreload ? <span class="stringliteral">&quot;Reloaded&quot;</span> : <span class="stringliteral">&quot;Created&quot;</span>), l-&gt;name);
<a name="l06960"></a>06960 
<a name="l06961"></a>06961    <span class="keywordflow">return</span> l;
<a name="l06962"></a>06962  }
<a name="l06963"></a>06963  
<a name="l06964"></a><a class="code" href="chan__skinny_8c.html#a6054476b05c0d6694c867269e4a0b429">06964</a>  <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *<a class="code" href="chan__skinny_8c.html#a6054476b05c0d6694c867269e4a0b429">config_device</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *dname, <span class="keyword">struct</span> <a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *v)
<a name="l06965"></a>06965  {
<a name="l06966"></a>06966    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d, *temp;
<a name="l06967"></a>06967    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l, *ltemp;
<a name="l06968"></a>06968    <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub;
<a name="l06969"></a>06969    <span class="keywordtype">int</span> <a class="code" href="codec__g726_8c.html#a8c58a1d1fd9436ff5145385d3ef7a430">update</a> = 0;
<a name="l06970"></a>06970  
<a name="l06971"></a>06971    <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Configuring skinny device %s.\n&quot;</span>, dname);
<a name="l06972"></a>06972 
<a name="l06973"></a>06973    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>);
<a name="l06974"></a>06974    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>, temp, list) {
<a name="l06975"></a>06975       <span class="keywordflow">if</span> (!strcasecmp(dname, temp-&gt;name) &amp;&amp; temp-&gt;prune) {
<a name="l06976"></a>06976          update = 1;
<a name="l06977"></a>06977          <span class="keywordflow">break</span>;
<a name="l06978"></a>06978       }
<a name="l06979"></a>06979    }
<a name="l06980"></a>06980 
<a name="l06981"></a>06981    <span class="keywordflow">if</span> (!(d = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*d)))) {
<a name="l06982"></a>06982       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Unable to allocate memory for device %s.\n&quot;</span>, dname);
<a name="l06983"></a>06983       <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>);
<a name="l06984"></a>06984       <span class="keywordflow">return</span> NULL;
<a name="l06985"></a>06985    }
<a name="l06986"></a>06986    memcpy(d, <a class="code" href="chan__skinny_8c.html#aea5308550d9d24974ceb40dd660b2fd9">default_device</a>, <span class="keyword">sizeof</span>(*<a class="code" href="chan__skinny_8c.html#aea5308550d9d24974ceb40dd660b2fd9">default_device</a>));
<a name="l06987"></a>06987    <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;d-&gt;<a class="code" href="structskinny__device.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06988"></a>06988    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(d-&gt;name, dname, <span class="keyword">sizeof</span>(d-&gt;name));
<a name="l06989"></a>06989    <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>, d, list);
<a name="l06990"></a>06990 
<a name="l06991"></a>06991    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;d-&gt;<a class="code" href="structskinny__device.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06992"></a>06992    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>);
<a name="l06993"></a>06993  
<a name="l06994"></a>06994    <a class="code" href="chan__skinny_8c.html#a290744d808f70a1932e3916b0db16acb">config_parse_variables</a>(<a class="code" href="chan__skinny_8c.html#a1cb072ae2d3e0fdccbbfbbe5a7bff5bd">TYPE_DEVICE</a>, d, v);
<a name="l06995"></a>06995  
<a name="l06996"></a>06996    <span class="keywordflow">if</span> (!<a class="code" href="linkedlists_8h.html#adf1959c5c03a3a706da97ad2f49617e5" title="Returns the first entry contained in a list.">AST_LIST_FIRST</a>(&amp;d-&gt;lines)) {
<a name="l06997"></a>06997       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;A Skinny device must have at least one line!\n&quot;</span>);
<a name="l06998"></a>06998       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;d-&gt;<a class="code" href="structskinny__device.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06999"></a>06999       <span class="keywordflow">return</span> NULL;
<a name="l07000"></a>07000    }
<a name="l07001"></a>07001    <span class="keywordflow">if</span> (<span class="comment">/*d-&gt;addr.sin_addr.s_addr &amp;&amp; */</span>!ntohs(d-&gt;<a class="code" href="structskinny__device.html#afdf3b1ca80400cc6bd5bfe2bb1cb7e65">addr</a>.sin_port)) {
<a name="l07002"></a>07002       d-&gt;<a class="code" href="structskinny__device.html#afdf3b1ca80400cc6bd5bfe2bb1cb7e65">addr</a>.sin_port = htons(<a class="code" href="chan__skinny_8c.html#aeffadc396b98efd62e385678a8c1cf62">DEFAULT_SKINNY_PORT</a>);
<a name="l07003"></a>07003    }
<a name="l07004"></a>07004  
<a name="l07005"></a>07005    <span class="keywordflow">if</span> (skinnyreload){
<a name="l07006"></a>07006       <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>);
<a name="l07007"></a>07007       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>, temp, list) {
<a name="l07008"></a>07008          <span class="keywordflow">if</span> (strcasecmp(d-&gt;id, temp-&gt;id) || !temp-&gt;prune || !temp-&gt;<a class="code" href="structskinny__device.html#a730a1864781691273d9f28b5ad1dadfd">session</a>) {
<a name="l07009"></a>07009             <span class="keywordflow">continue</span>;
<a name="l07010"></a>07010          }
<a name="l07011"></a>07011          <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;d-&gt;<a class="code" href="structskinny__device.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l07012"></a>07012          d-&gt;<a class="code" href="structskinny__device.html#a730a1864781691273d9f28b5ad1dadfd">session</a> = temp-&gt;<a class="code" href="structskinny__device.html#a730a1864781691273d9f28b5ad1dadfd">session</a>;
<a name="l07013"></a>07013          d-&gt;<a class="code" href="structskinny__device.html#a730a1864781691273d9f28b5ad1dadfd">session</a>-&gt;<a class="code" href="structskinnysession.html#a70701ca9c2641bcb1740286273a0473a">device</a> = d;
<a name="l07014"></a>07014 
<a name="l07015"></a>07015          <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;d-&gt;lines);
<a name="l07016"></a>07016          <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;lines, l, list){
<a name="l07017"></a>07017             l-&gt;device = d; 
<a name="l07018"></a>07018 
<a name="l07019"></a>07019             <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;temp-&gt;lines);
<a name="l07020"></a>07020             <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;temp-&gt;lines, ltemp, list) {
<a name="l07021"></a>07021                <span class="keywordflow">if</span> (strcasecmp(l-&gt;name, ltemp-&gt;name)) {
<a name="l07022"></a>07022                   <span class="keywordflow">continue</span>;
<a name="l07023"></a>07023                }
<a name="l07024"></a>07024                <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;ltemp-&gt;<a class="code" href="structskinny__line.html#ae5e68fb86600e9f1e67bb18aaa19f78a">lock</a>);
<a name="l07025"></a>07025                l-&gt;instance = ltemp-&gt;instance;
<a name="l07026"></a>07026                l-&gt;hookstate = ltemp-&gt;hookstate;
<a name="l07027"></a>07027                <span class="keywordflow">if</span> (!<a class="code" href="linkedlists_8h.html#a4a1884cde93e53bef32ca85c194a1d05" title="Checks whether the specified list contains any entries.">AST_LIST_EMPTY</a>(&amp;ltemp-&gt;sub)) {
<a name="l07028"></a>07028                   <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;l-&gt;<a class="code" href="structskinny__line.html#ae5e68fb86600e9f1e67bb18aaa19f78a">lock</a>);
<a name="l07029"></a>07029                   l-&gt;sub = ltemp-&gt;sub;
<a name="l07030"></a>07030                   <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;l-&gt;sub, sub, list) {
<a name="l07031"></a>07031                      sub-&gt;parent = l;
<a name="l07032"></a>07032                   }
<a name="l07033"></a>07033                   <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;l-&gt;<a class="code" href="structskinny__line.html#ae5e68fb86600e9f1e67bb18aaa19f78a">lock</a>);
<a name="l07034"></a>07034                }
<a name="l07035"></a>07035                <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;ltemp-&gt;<a class="code" href="structskinny__line.html#ae5e68fb86600e9f1e67bb18aaa19f78a">lock</a>);
<a name="l07036"></a>07036             }
<a name="l07037"></a>07037             <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;temp-&gt;lines);
<a name="l07038"></a>07038          }
<a name="l07039"></a>07039          <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;d-&gt;lines);
<a name="l07040"></a>07040          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;d-&gt;<a class="code" href="structskinny__device.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l07041"></a>07041       }
<a name="l07042"></a>07042       <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>);
<a name="l07043"></a>07043    }
<a name="l07044"></a>07044 
<a name="l07045"></a>07045    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;d-&gt;<a class="code" href="structskinny__device.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l07046"></a>07046 
<a name="l07047"></a>07047    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;%s config for device &apos;%s&apos;\n&quot;</span>, update ? <span class="stringliteral">&quot;Updated&quot;</span> : (skinnyreload ? <span class="stringliteral">&quot;Reloaded&quot;</span> : <span class="stringliteral">&quot;Created&quot;</span>), d-&gt;name);
<a name="l07048"></a>07048    
<a name="l07049"></a>07049    <span class="keywordflow">return</span> d;
<a name="l07050"></a>07050 
<a name="l07051"></a>07051  }
<a name="l07052"></a>07052  
<a name="l07053"></a><a class="code" href="chan__skinny_8c.html#adcba01fd94435658f19c16a842d33330">07053</a>  <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#adcba01fd94435658f19c16a842d33330">config_load</a>(<span class="keywordtype">void</span>)
<a name="l07054"></a>07054  {
<a name="l07055"></a>07055    <span class="keywordtype">int</span> on = 1;
<a name="l07056"></a>07056    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *cfg;
<a name="l07057"></a>07057    <span class="keywordtype">char</span> *cat;
<a name="l07058"></a>07058    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d;
<a name="l07059"></a>07059    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l;
<a name="l07060"></a>07060    <span class="keywordtype">int</span> oldport = ntohs(<a class="code" href="chan__skinny_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>.sin_port);
<a name="l07061"></a>07061    <span class="keyword">struct </span><a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> config_flags = { 0 };
<a name="l07062"></a>07062    
<a name="l07063"></a>07063    <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Configuring skinny from %s\n&quot;</span>, config);
<a name="l07064"></a>07064   
<a name="l07065"></a>07065    <span class="keywordflow">if</span> (gethostname(ourhost, <span class="keyword">sizeof</span>(ourhost))) {
<a name="l07066"></a>07066       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to get hostname, Skinny disabled.\n&quot;</span>);
<a name="l07067"></a>07067       <span class="keywordflow">return</span> 0;
<a name="l07068"></a>07068    }
<a name="l07069"></a>07069    cfg = <a class="code" href="config_8h.html#a0a07ddd6bbcf44485e01c14c96109482">ast_config_load</a>(config, config_flags);
<a name="l07070"></a>07070   
<a name="l07071"></a>07071    <span class="comment">/* We *must* have a config file otherwise stop immediately */</span>
<a name="l07072"></a>07072    <span class="keywordflow">if</span> (!cfg || cfg == <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>) {
<a name="l07073"></a>07073       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Unable to load config %s, Skinny disabled.\n&quot;</span>, config);
<a name="l07074"></a>07074       <span class="keywordflow">return</span> -1;
<a name="l07075"></a>07075    }
<a name="l07076"></a>07076    memset(&amp;<a class="code" href="chan__skinny_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="chan__skinny_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>));
<a name="l07077"></a>07077    memset(&amp;<a class="code" href="chan__skinny_8c.html#a8825096054254f7ab84afdfe5083f564">default_prefs</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="chan__skinny_8c.html#a8825096054254f7ab84afdfe5083f564">default_prefs</a>));
<a name="l07078"></a>07078 
<a name="l07079"></a>07079    <span class="comment">/* Copy the default jb config over global_jbconf */</span>
<a name="l07080"></a>07080    memcpy(&amp;<a class="code" href="chan__skinny_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">global_jbconf</a>, &amp;default_jbconf, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__jb__conf.html" title="General jitterbuffer configuration.">ast_jb_conf</a>));
<a name="l07081"></a>07081 
<a name="l07082"></a>07082    <span class="comment">/* load the general section */</span>
<a name="l07083"></a>07083    cat = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>);
<a name="l07084"></a>07084    <a class="code" href="chan__skinny_8c.html#a290744d808f70a1932e3916b0db16acb">config_parse_variables</a>(<a class="code" href="chan__skinny_8c.html#ae3837bf7d2100903b0651f5b22e289e9">TYPE_GENERAL</a>, NULL, <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>));
<a name="l07085"></a>07085 
<a name="l07086"></a>07086    <span class="keywordflow">if</span> (ntohl(<a class="code" href="chan__skinny_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>.sin_addr.s_addr)) {
<a name="l07087"></a>07087       <a class="code" href="chan__skinny_8c.html#a1d084b82cb21102ba46ea60d3cd9c085">__ourip</a> = <a class="code" href="chan__skinny_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>.sin_addr;
<a name="l07088"></a>07088    } <span class="keywordflow">else</span> {
<a name="l07089"></a>07089       hp = <a class="code" href="utils_8h.html#ad3b63ee1041593219ef0765b28d70442" title="Thread-safe gethostbyname function to use in Asterisk.">ast_gethostbyname</a>(ourhost, &amp;<a class="code" href="chan__skinny_8c.html#a9e435aef83f14da6d3d5ec44f821558e">ahp</a>);
<a name="l07090"></a>07090       <span class="keywordflow">if</span> (!hp) {
<a name="l07091"></a>07091          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to get our IP address, Skinny disabled\n&quot;</span>);
<a name="l07092"></a>07092          <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(cfg);
<a name="l07093"></a>07093          <span class="keywordflow">return</span> 0;
<a name="l07094"></a>07094       }
<a name="l07095"></a>07095       memcpy(&amp;<a class="code" href="chan__skinny_8c.html#a1d084b82cb21102ba46ea60d3cd9c085">__ourip</a>, hp-&gt;h_addr, <span class="keyword">sizeof</span>(<a class="code" href="chan__skinny_8c.html#a1d084b82cb21102ba46ea60d3cd9c085">__ourip</a>));
<a name="l07096"></a>07096    }
<a name="l07097"></a>07097    <span class="keywordflow">if</span> (!ntohs(<a class="code" href="chan__skinny_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>.sin_port)) {
<a name="l07098"></a>07098       <a class="code" href="chan__skinny_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>.sin_port = ntohs(<a class="code" href="chan__skinny_8c.html#aeffadc396b98efd62e385678a8c1cf62">DEFAULT_SKINNY_PORT</a>);
<a name="l07099"></a>07099    }
<a name="l07100"></a>07100    <a class="code" href="chan__skinny_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>.sin_family = AF_INET;
<a name="l07101"></a>07101 
<a name="l07102"></a>07102    <span class="comment">/* load the lines sections */</span>
<a name="l07103"></a>07103    <a class="code" href="chan__skinny_8c.html#a6e99a595511d5057826b95311fa49465">default_line</a>-&gt;confcapability = default_capability;
<a name="l07104"></a>07104    <a class="code" href="chan__skinny_8c.html#a6e99a595511d5057826b95311fa49465">default_line</a>-&gt;confprefs = <a class="code" href="chan__skinny_8c.html#a8825096054254f7ab84afdfe5083f564">default_prefs</a>;
<a name="l07105"></a>07105    <a class="code" href="chan__skinny_8c.html#a290744d808f70a1932e3916b0db16acb">config_parse_variables</a>(<a class="code" href="chan__skinny_8c.html#a1041d2c4aa7a5e6f54efdc452178975d">TYPE_DEF_LINE</a>, <a class="code" href="chan__skinny_8c.html#a6e99a595511d5057826b95311fa49465">default_line</a>, <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(cfg, <span class="stringliteral">&quot;lines&quot;</span>));
<a name="l07106"></a>07106    cat = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(cfg, <span class="stringliteral">&quot;lines&quot;</span>);
<a name="l07107"></a>07107    <span class="keywordflow">while</span> (cat &amp;&amp; strcasecmp(cat, <span class="stringliteral">&quot;general&quot;</span>) &amp;&amp; strcasecmp(cat, <span class="stringliteral">&quot;devices&quot;</span>)) {
<a name="l07108"></a>07108       l = <a class="code" href="chan__skinny_8c.html#af7fc256a5120f42598d936ab979d302f">config_line</a>(cat, <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(cfg, cat));
<a name="l07109"></a>07109       cat = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(cfg, cat);
<a name="l07110"></a>07110    }
<a name="l07111"></a>07111       
<a name="l07112"></a>07112    <span class="comment">/* load the devices sections */</span>
<a name="l07113"></a>07113    <a class="code" href="chan__skinny_8c.html#aea5308550d9d24974ceb40dd660b2fd9">default_device</a>-&gt;confcapability = default_capability;
<a name="l07114"></a>07114    <a class="code" href="chan__skinny_8c.html#aea5308550d9d24974ceb40dd660b2fd9">default_device</a>-&gt;confprefs = <a class="code" href="chan__skinny_8c.html#a8825096054254f7ab84afdfe5083f564">default_prefs</a>;
<a name="l07115"></a>07115    <a class="code" href="chan__skinny_8c.html#a290744d808f70a1932e3916b0db16acb">config_parse_variables</a>(<a class="code" href="chan__skinny_8c.html#ad78ece34f886398c83a2ccf05d31499b">TYPE_DEF_DEVICE</a>, <a class="code" href="chan__skinny_8c.html#aea5308550d9d24974ceb40dd660b2fd9">default_device</a>, <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(cfg, <span class="stringliteral">&quot;devices&quot;</span>));
<a name="l07116"></a>07116    cat = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(cfg, <span class="stringliteral">&quot;devices&quot;</span>);
<a name="l07117"></a>07117    <span class="keywordflow">while</span> (cat &amp;&amp; strcasecmp(cat, <span class="stringliteral">&quot;general&quot;</span>) &amp;&amp; strcasecmp(cat, <span class="stringliteral">&quot;lines&quot;</span>)) {
<a name="l07118"></a>07118       d = <a class="code" href="chan__skinny_8c.html#a6054476b05c0d6694c867269e4a0b429">config_device</a>(cat, <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(cfg, cat));
<a name="l07119"></a>07119       cat = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(cfg, cat);
<a name="l07120"></a>07120    }
<a name="l07121"></a>07121 
<a name="l07122"></a>07122    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;netlock);
<a name="l07123"></a>07123    <span class="keywordflow">if</span> ((skinnysock &gt; -1) &amp;&amp; (ntohs(<a class="code" href="chan__skinny_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>.sin_port) != oldport)) {
<a name="l07124"></a>07124       close(skinnysock);
<a name="l07125"></a>07125       skinnysock = -1;
<a name="l07126"></a>07126    }
<a name="l07127"></a>07127    <span class="keywordflow">if</span> (skinnysock &lt; 0) {
<a name="l07128"></a>07128       skinnysock = socket(AF_INET, SOCK_STREAM, 0);
<a name="l07129"></a>07129       <span class="keywordflow">if</span>(setsockopt(skinnysock, SOL_SOCKET, SO_REUSEADDR, &amp;on, <span class="keyword">sizeof</span>(on)) == -1) {
<a name="l07130"></a>07130          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Set Socket Options failed: errno %d, %s\n&quot;</span>, <a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l07131"></a>07131          <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(cfg);
<a name="l07132"></a>07132          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;netlock);
<a name="l07133"></a>07133          <span class="keywordflow">return</span> 0;
<a name="l07134"></a>07134       }
<a name="l07135"></a>07135       <span class="keywordflow">if</span> (skinnysock &lt; 0) {
<a name="l07136"></a>07136          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create Skinny socket: %s\n&quot;</span>, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l07137"></a>07137       } <span class="keywordflow">else</span> {
<a name="l07138"></a>07138          <span class="keywordflow">if</span> (bind(skinnysock, (<span class="keyword">struct</span> sockaddr *)&amp;<a class="code" href="chan__skinny_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>, <span class="keyword">sizeof</span>(bindaddr)) &lt; 0) {
<a name="l07139"></a>07139             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to bind to %s:%d: %s\n&quot;</span>,
<a name="l07140"></a>07140                   <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(bindaddr.sin_addr), ntohs(bindaddr.sin_port),
<a name="l07141"></a>07141                      strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l07142"></a>07142             close(skinnysock);
<a name="l07143"></a>07143             skinnysock = -1;
<a name="l07144"></a>07144             <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(cfg);
<a name="l07145"></a>07145             <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;netlock);
<a name="l07146"></a>07146             <span class="keywordflow">return</span> 0;
<a name="l07147"></a>07147          }
<a name="l07148"></a>07148          <span class="keywordflow">if</span> (listen(skinnysock, <a class="code" href="chan__skinny_8c.html#ac92b1ca5df61c89413c2588028c01ef8">DEFAULT_SKINNY_BACKLOG</a>)) {
<a name="l07149"></a>07149                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to start listening to %s:%d: %s\n&quot;</span>,
<a name="l07150"></a>07150                   <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(bindaddr.sin_addr), ntohs(bindaddr.sin_port),
<a name="l07151"></a>07151                      strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l07152"></a>07152                close(skinnysock);
<a name="l07153"></a>07153                skinnysock = -1;
<a name="l07154"></a>07154                <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(cfg);
<a name="l07155"></a>07155                <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;netlock);
<a name="l07156"></a>07156                <span class="keywordflow">return</span> 0;
<a name="l07157"></a>07157          }
<a name="l07158"></a>07158          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Skinny listening on %s:%d\n&quot;</span>,
<a name="l07159"></a>07159                <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(bindaddr.sin_addr), ntohs(bindaddr.sin_port));
<a name="l07160"></a>07160          <a class="code" href="netsock_8h.html#aef64bf03f17c3251f549b08b6620bc24">ast_netsock_set_qos</a>(skinnysock, <a class="code" href="chan__skinny_8c.html#abe7ea21619e746bb9b12fe3e47bc861b">qos</a>.tos, <a class="code" href="chan__skinny_8c.html#abe7ea21619e746bb9b12fe3e47bc861b">qos</a>.cos, <span class="stringliteral">&quot;Skinny&quot;</span>);
<a name="l07161"></a>07161          <a class="code" href="utils_8h.html#a595e2f8aa398f4bd21e381c3211235fe">ast_pthread_create_background</a>(&amp;accept_t, NULL, <a class="code" href="chan__skinny_8c.html#afb67d0042be5e8bd0d96b62379856fe2">accept_thread</a>, NULL);
<a name="l07162"></a>07162       }
<a name="l07163"></a>07163    }
<a name="l07164"></a>07164    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;netlock);
<a name="l07165"></a>07165    <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(cfg);
<a name="l07166"></a>07166    <span class="keywordflow">return</span> 1;
<a name="l07167"></a>07167 }
<a name="l07168"></a>07168 
<a name="l07169"></a><a class="code" href="chan__skinny_8c.html#aa9daeada19a92710d428551482cb20f9">07169</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__skinny_8c.html#aa9daeada19a92710d428551482cb20f9">delete_devices</a>(<span class="keywordtype">void</span>)
<a name="l07170"></a>07170 {
<a name="l07171"></a>07171    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d;
<a name="l07172"></a>07172    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l;
<a name="l07173"></a>07173    <span class="keyword">struct </span><a class="code" href="structskinny__speeddial.html">skinny_speeddial</a> *sd;
<a name="l07174"></a>07174    <span class="keyword">struct </span>skinny_addon *a;
<a name="l07175"></a>07175 
<a name="l07176"></a>07176    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>);
<a name="l07177"></a>07177    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;lines);
<a name="l07178"></a>07178 
<a name="l07179"></a>07179    <span class="comment">/* Delete all devices */</span>
<a name="l07180"></a>07180    <span class="keywordflow">while</span> ((d = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>, list))) {
<a name="l07181"></a>07181       <span class="comment">/* Delete all lines for this device */</span>
<a name="l07182"></a>07182       <span class="keywordflow">while</span> ((l = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;d-&gt;lines, list))) {
<a name="l07183"></a>07183          <a class="code" href="linkedlists_8h.html#aa36e72b77f1b80881cd0a9fcca66ce19" title="Removes a specific entry from a list.">AST_LIST_REMOVE</a>(&amp;lines, l, all);
<a name="l07184"></a>07184          <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(l);
<a name="l07185"></a>07185       }
<a name="l07186"></a>07186       <span class="comment">/* Delete all speeddials for this device */</span>
<a name="l07187"></a>07187       <span class="keywordflow">while</span> ((sd = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;d-&gt;speeddials, list))) {
<a name="l07188"></a>07188          <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(sd);
<a name="l07189"></a>07189       }
<a name="l07190"></a>07190       <span class="comment">/* Delete all addons for this device */</span>
<a name="l07191"></a>07191       <span class="keywordflow">while</span> ((a = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;d-&gt;addons, list))) {
<a name="l07192"></a>07192          <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(a);
<a name="l07193"></a>07193       } 
<a name="l07194"></a>07194       <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(d);
<a name="l07195"></a>07195    }
<a name="l07196"></a>07196    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;lines);
<a name="l07197"></a>07197    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>);
<a name="l07198"></a>07198 }
<a name="l07199"></a>07199 
<a name="l07200"></a><a class="code" href="chan__skinny_8c.html#aa53f60b698c21b4f290b5defcf53ef9b">07200</a> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#aa53f60b698c21b4f290b5defcf53ef9b">skinny_reload</a>(<span class="keywordtype">void</span>)
<a name="l07201"></a>07201 {
<a name="l07202"></a>07202    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d;
<a name="l07203"></a>07203    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l;
<a name="l07204"></a>07204    <span class="keyword">struct </span><a class="code" href="structskinny__speeddial.html">skinny_speeddial</a> *sd;
<a name="l07205"></a>07205    <span class="keyword">struct </span>skinny_addon *a;
<a name="l07206"></a>07206    <span class="keyword">struct </span><a class="code" href="structskinny__req.html">skinny_req</a> *req;
<a name="l07207"></a>07207 
<a name="l07208"></a>07208    <span class="keywordflow">if</span> (skinnyreload) {
<a name="l07209"></a>07209       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Chan_skinny is already reloading.\n&quot;</span>);
<a name="l07210"></a>07210       <span class="keywordflow">return</span> 0;
<a name="l07211"></a>07211    }
<a name="l07212"></a>07212 
<a name="l07213"></a>07213    skinnyreload = 1;
<a name="l07214"></a>07214 
<a name="l07215"></a>07215    <span class="comment">/* Mark all devices and lines as candidates to be pruned */</span>
<a name="l07216"></a>07216    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>);
<a name="l07217"></a>07217    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>, d, list) {
<a name="l07218"></a>07218       d-&gt;prune = 1;
<a name="l07219"></a>07219    }
<a name="l07220"></a>07220    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>);
<a name="l07221"></a>07221 
<a name="l07222"></a>07222    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;lines);
<a name="l07223"></a>07223    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;lines, l, all) {
<a name="l07224"></a>07224       l-&gt;prune = 1;
<a name="l07225"></a>07225    }
<a name="l07226"></a>07226    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;lines);
<a name="l07227"></a>07227 
<a name="l07228"></a>07228         <a class="code" href="chan__skinny_8c.html#adcba01fd94435658f19c16a842d33330">config_load</a>();
<a name="l07229"></a>07229 
<a name="l07230"></a>07230    <span class="comment">/* Remove any devices that no longer exist in the config */</span>
<a name="l07231"></a>07231    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>);
<a name="l07232"></a>07232    <a class="code" href="linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d" title="Loops safely over (traverses) the entries in a list.">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>, d, list) {
<a name="l07233"></a>07233       <span class="keywordflow">if</span> (!d-&gt;prune) {
<a name="l07234"></a>07234          <span class="keywordflow">continue</span>;
<a name="l07235"></a>07235       }
<a name="l07236"></a>07236       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Removing device &apos;%s&apos;\n&quot;</span>, d-&gt;name);
<a name="l07237"></a>07237       <span class="comment">/* Delete all lines for this device. </span>
<a name="l07238"></a>07238 <span class="comment">         We do not want to free the line here, that</span>
<a name="l07239"></a>07239 <span class="comment">         will happen below. */</span>
<a name="l07240"></a>07240       <span class="keywordflow">while</span> ((l = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;d-&gt;lines, list))) {
<a name="l07241"></a>07241       }
<a name="l07242"></a>07242       <span class="comment">/* Delete all speeddials for this device */</span>
<a name="l07243"></a>07243       <span class="keywordflow">while</span> ((sd = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;d-&gt;speeddials, list))) {
<a name="l07244"></a>07244          <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(sd);
<a name="l07245"></a>07245       }
<a name="l07246"></a>07246       <span class="comment">/* Delete all addons for this device */</span>
<a name="l07247"></a>07247       <span class="keywordflow">while</span> ((a = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;d-&gt;addons, list))) {
<a name="l07248"></a>07248          <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(a);
<a name="l07249"></a>07249       }
<a name="l07250"></a>07250       <a class="code" href="linkedlists_8h.html#aa8ac496fa9c717d5afb99a02e1e2760c" title="Removes the current entry from a list during a traversal.">AST_LIST_REMOVE_CURRENT</a>(list);
<a name="l07251"></a>07251       <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(d);
<a name="l07252"></a>07252    }
<a name="l07253"></a>07253    <a class="code" href="linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9" title="Closes a safe loop traversal block.">AST_LIST_TRAVERSE_SAFE_END</a>;
<a name="l07254"></a>07254    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>);
<a name="l07255"></a>07255 
<a name="l07256"></a>07256    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;lines);  
<a name="l07257"></a>07257    <a class="code" href="linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d" title="Loops safely over (traverses) the entries in a list.">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(&amp;lines, l, all) {
<a name="l07258"></a>07258       <span class="keywordflow">if</span> (l-&gt;prune) {
<a name="l07259"></a>07259          <a class="code" href="linkedlists_8h.html#aa8ac496fa9c717d5afb99a02e1e2760c" title="Removes the current entry from a list during a traversal.">AST_LIST_REMOVE_CURRENT</a>(all);
<a name="l07260"></a>07260          <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(l);
<a name="l07261"></a>07261       }
<a name="l07262"></a>07262    }
<a name="l07263"></a>07263    <a class="code" href="linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9" title="Closes a safe loop traversal block.">AST_LIST_TRAVERSE_SAFE_END</a>;
<a name="l07264"></a>07264    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;lines);  
<a name="l07265"></a>07265 
<a name="l07266"></a>07266    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="chan__unistim_8c.html#a36a5308ad8c28bc27b643dab70a466d3" title="A device containing one or more lines.">devices</a>, d, list) {
<a name="l07267"></a>07267       <span class="comment">/* Do a soft reset to re-register the devices after</span>
<a name="l07268"></a>07268 <span class="comment">         cleaning up the removed devices and lines */</span>
<a name="l07269"></a>07269       <span class="keywordflow">if</span> (d-&gt;<a class="code" href="structskinny__device.html#a730a1864781691273d9f28b5ad1dadfd">session</a>) {
<a name="l07270"></a>07270          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Restarting device &apos;%s&apos;\n&quot;</span>, d-&gt;name);
<a name="l07271"></a>07271          <span class="keywordflow">if</span> ((req = <a class="code" href="chan__skinny_8c.html#a6358965132aca36a703727fc05ddfcad">req_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structreset__message.html">reset_message</a>), <a class="code" href="chan__skinny_8c.html#afb6f653351a09b4b3bbbb0fbd3ba4f1e">RESET_MESSAGE</a>))) {
<a name="l07272"></a>07272             req-&gt;<a class="code" href="structskinny__req.html#a87a58180d0bd467e0e1ca4c0cc824a69">data</a>.<a class="code" href="unionskinny__data.html#af94af305e2c5f2374e813e4eb240296c">reset</a>.<a class="code" href="structreset__message.html#a7a8191f03b981d7fd9ea45a66270833b">resetType</a> = 2;
<a name="l07273"></a>07273             <a class="code" href="chan__skinny_8c.html#a76027369b65769f5b1c218f0e9c3114c">transmit_response</a>(d, req);
<a name="l07274"></a>07274          }
<a name="l07275"></a>07275       }
<a name="l07276"></a>07276    }
<a name="l07277"></a>07277    
<a name="l07278"></a>07278    skinnyreload = 0;
<a name="l07279"></a>07279         <span class="keywordflow">return</span> 0;
<a name="l07280"></a>07280 }
<a name="l07281"></a>07281 
<a name="l07282"></a><a class="code" href="chan__skinny_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">07282</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>(<span class="keywordtype">void</span>)
<a name="l07283"></a>07283 {
<a name="l07284"></a>07284    <span class="keywordtype">int</span> <a class="code" href="structskinny__req.html#aac31eb68bff694554a182bd796b2f1c5">res</a> = 0;
<a name="l07285"></a>07285 
<a name="l07286"></a>07286    <span class="keywordflow">for</span> (; res &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(soft_key_template_default); res++) {
<a name="l07287"></a>07287       soft_key_template_default[res].<a class="code" href="structsoft__key__template__definition.html#a4358d46dc0a917c9906274cf85132904">softKeyEvent</a> = <a class="code" href="chan__skinny_8c.html#a1fc4646ed08dd658e9bfeb2d56f12d3a">htolel</a>(soft_key_template_default[res].softKeyEvent);
<a name="l07288"></a>07288    }
<a name="l07289"></a>07289    <span class="comment">/* load and parse config */</span>
<a name="l07290"></a>07290    res = <a class="code" href="chan__skinny_8c.html#adcba01fd94435658f19c16a842d33330">config_load</a>();
<a name="l07291"></a>07291    <span class="keywordflow">if</span> (res == -1) {
<a name="l07292"></a>07292       <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;
<a name="l07293"></a>07293    }
<a name="l07294"></a>07294 
<a name="l07295"></a>07295    <span class="comment">/* Make sure we can register our skinny channel type */</span>
<a name="l07296"></a>07296    <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#ab5f3776fda943e52820ceeee5835c1b4" title="Register a channel technology (a new channel driver) Called by a channel module to...">ast_channel_register</a>(&amp;<a class="code" href="chan__skinny_8c.html#af6c38f501b802babce30ed7dd08fc686">skinny_tech</a>)) {
<a name="l07297"></a>07297       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to register channel class &apos;Skinny&apos;\n&quot;</span>);
<a name="l07298"></a>07298       <span class="keywordflow">return</span> -1;
<a name="l07299"></a>07299    }
<a name="l07300"></a>07300 
<a name="l07301"></a>07301    <a class="code" href="rtp_8h.html#a00b94396faf3f52b0c3ea612a9af334d" title="Register an RTP channel client.">ast_rtp_proto_register</a>(&amp;<a class="code" href="chan__skinny_8c.html#a9ab841fc2038e3f502fdc47d0a0fb5d9">skinny_rtp</a>);
<a name="l07302"></a>07302    <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(<a class="code" href="chan__skinny_8c.html#af1f50f72b24c706be012b5d9d93d4a10">cli_skinny</a>, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="chan__skinny_8c.html#af1f50f72b24c706be012b5d9d93d4a10">cli_skinny</a>));
<a name="l07303"></a>07303 
<a name="l07304"></a>07304    <a class="code" href="group__Group__AMI.html#ga332bf7ef48f67d63d849dd9febb18fb2" title="Register a manager command with the manager interface.">ast_manager_register2</a>(<span class="stringliteral">&quot;SKINNYdevices&quot;</span>, <a class="code" href="manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a> | <a class="code" href="manager_8h.html#a0b1b4140c2836696a6950e92ab48a580">EVENT_FLAG_REPORTING</a>, <a class="code" href="chan__skinny_8c.html#a19dd4f20ea170713fc94f3d787e453ec" title="Show SKINNY devices in the manager API.">manager_skinny_show_devices</a>,
<a name="l07305"></a>07305          <span class="stringliteral">&quot;List SKINNY devices (text format)&quot;</span>, <a class="code" href="chan__skinny_8c.html#a5e5c6c43f047a96d0d24880bb00e0884">mandescr_show_devices</a>);
<a name="l07306"></a>07306    <a class="code" href="group__Group__AMI.html#ga332bf7ef48f67d63d849dd9febb18fb2" title="Register a manager command with the manager interface.">ast_manager_register2</a>(<span class="stringliteral">&quot;SKINNYshowdevice&quot;</span>, <a class="code" href="manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a> | <a class="code" href="manager_8h.html#a0b1b4140c2836696a6950e92ab48a580">EVENT_FLAG_REPORTING</a>, <a class="code" href="chan__skinny_8c.html#a603b2c3fc96fb332fef1787046574afd">manager_skinny_show_device</a>,
<a name="l07307"></a>07307          <span class="stringliteral">&quot;Show SKINNY device (text format)&quot;</span>, <a class="code" href="chan__skinny_8c.html#ad44c1690168c6ca3cc1d1f4b413db89e">mandescr_show_device</a>);
<a name="l07308"></a>07308    <a class="code" href="group__Group__AMI.html#ga332bf7ef48f67d63d849dd9febb18fb2" title="Register a manager command with the manager interface.">ast_manager_register2</a>(<span class="stringliteral">&quot;SKINNYlines&quot;</span>, <a class="code" href="manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a> | <a class="code" href="manager_8h.html#a0b1b4140c2836696a6950e92ab48a580">EVENT_FLAG_REPORTING</a>, <a class="code" href="chan__skinny_8c.html#a1ac9ad552f6392f35b494cb0cf075fe6" title="Show Skinny lines in the manager API.">manager_skinny_show_lines</a>,
<a name="l07309"></a>07309          <span class="stringliteral">&quot;List SKINNY lines (text format)&quot;</span>, <a class="code" href="chan__skinny_8c.html#a1f1de5e1fada16afeaa394c7f655f6b3">mandescr_show_lines</a>);
<a name="l07310"></a>07310    <a class="code" href="group__Group__AMI.html#ga332bf7ef48f67d63d849dd9febb18fb2" title="Register a manager command with the manager interface.">ast_manager_register2</a>(<span class="stringliteral">&quot;SKINNYshowline&quot;</span>, <a class="code" href="manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a> | <a class="code" href="manager_8h.html#a0b1b4140c2836696a6950e92ab48a580">EVENT_FLAG_REPORTING</a>, <a class="code" href="chan__skinny_8c.html#a665787ef574f276e9a42fcfc3db4dbb4">manager_skinny_show_line</a>,
<a name="l07311"></a>07311          <span class="stringliteral">&quot;Show SKINNY line (text format)&quot;</span>, <a class="code" href="chan__skinny_8c.html#a2193fe3c36be63b25002e47f39f1fc05">mandescr_show_line</a>);
<a name="l07312"></a>07312 
<a name="l07313"></a>07313    sched = <a class="code" href="sched_8h.html#ad4fd5c63d5d3dcc8e11bec644c601017" title="New schedule context.">sched_context_create</a>();
<a name="l07314"></a>07314    <span class="keywordflow">if</span> (!sched) {
<a name="l07315"></a>07315       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create schedule context\n&quot;</span>);
<a name="l07316"></a>07316    }
<a name="l07317"></a>07317    io = <a class="code" href="io_8h.html#a7d66d121ef63109c2f55188a38b8240f" title="Creates a context Create a context for I/O operations Basically mallocs an IO structure...">io_context_create</a>();
<a name="l07318"></a>07318    <span class="keywordflow">if</span> (!io) {
<a name="l07319"></a>07319       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create I/O context\n&quot;</span>);
<a name="l07320"></a>07320    }
<a name="l07321"></a>07321    <span class="comment">/* And start the monitor for the first time */</span>
<a name="l07322"></a>07322    <a class="code" href="chan__skinny_8c.html#a83af94bb19a421cb25ca02d16fa5ba9c">restart_monitor</a>();
<a name="l07323"></a>07323 
<a name="l07324"></a>07324    <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a>;
<a name="l07325"></a>07325 }
<a name="l07326"></a>07326 
<a name="l07327"></a><a class="code" href="chan__skinny_8c.html#ad09fa931f468002152a3cc2d5ce25eae">07327</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="agent_8c.html#a95bac1db604c69a01ef7b3995342cd7a">unload_module</a>(<span class="keywordtype">void</span>)
<a name="l07328"></a>07328 {
<a name="l07329"></a>07329    <span class="keyword">struct </span><a class="code" href="structskinnysession.html">skinnysession</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>;
<a name="l07330"></a>07330    <span class="keyword">struct </span><a class="code" href="structskinny__device.html">skinny_device</a> *d;
<a name="l07331"></a>07331    <span class="keyword">struct </span><a class="code" href="structskinny__line.html">skinny_line</a> *l;
<a name="l07332"></a>07332    <span class="keyword">struct </span><a class="code" href="structskinny__subchannel.html">skinny_subchannel</a> *sub;
<a name="l07333"></a>07333    <span class="keyword">struct </span><a class="code" href="structast__context.html" title="ast_context: An extension context">ast_context</a> *con;
<a name="l07334"></a>07334 
<a name="l07335"></a>07335    <a class="code" href="rtp_8h.html#a39d797fe6097e914323998f72b13420c" title="Unregister an RTP channel client.">ast_rtp_proto_unregister</a>(&amp;<a class="code" href="chan__skinny_8c.html#a9ab841fc2038e3f502fdc47d0a0fb5d9">skinny_rtp</a>);
<a name="l07336"></a>07336    <a class="code" href="channel_8h.html#a53b708b7fc71dcbcd33acae0ad4d7ef8" title="Unregister a channel technology.">ast_channel_unregister</a>(&amp;<a class="code" href="chan__skinny_8c.html#af6c38f501b802babce30ed7dd08fc686">skinny_tech</a>);
<a name="l07337"></a>07337    <a class="code" href="cli_8h.html#a56b6b59ee2eaa994597a5b0f4e9f9d09" title="Unregister multiple commands.">ast_cli_unregister_multiple</a>(<a class="code" href="chan__skinny_8c.html#af1f50f72b24c706be012b5d9d93d4a10">cli_skinny</a>, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="chan__skinny_8c.html#af1f50f72b24c706be012b5d9d93d4a10">cli_skinny</a>));
<a name="l07338"></a>07338 
<a name="l07339"></a>07339    <a class="code" href="group__Group__AMI.html#ga5a9336fe5bb6b2cf350de9571080809d" title="Unregister a registered manager command.">ast_manager_unregister</a>(<span class="stringliteral">&quot;SKINNYdevices&quot;</span>);
<a name="l07340"></a>07340    <a class="code" href="group__Group__AMI.html#ga5a9336fe5bb6b2cf350de9571080809d" title="Unregister a registered manager command.">ast_manager_unregister</a>(<span class="stringliteral">&quot;SKINNYshowdevice&quot;</span>);
<a name="l07341"></a>07341    <a class="code" href="group__Group__AMI.html#ga5a9336fe5bb6b2cf350de9571080809d" title="Unregister a registered manager command.">ast_manager_unregister</a>(<span class="stringliteral">&quot;SKINNYlines&quot;</span>);
<a name="l07342"></a>07342    <a class="code" href="group__Group__AMI.html#ga5a9336fe5bb6b2cf350de9571080809d" title="Unregister a registered manager command.">ast_manager_unregister</a>(<span class="stringliteral">&quot;SKINNYshowline&quot;</span>);
<a name="l07343"></a>07343    
<a name="l07344"></a>07344    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="structsessions.html">sessions</a>);
<a name="l07345"></a>07345    <span class="comment">/* Destroy all the interfaces and free their memory */</span>
<a name="l07346"></a>07346    <span class="keywordflow">while</span>((s = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;<a class="code" href="structsessions.html">sessions</a>, list))) {
<a name="l07347"></a>07347       d = s-&gt;<a class="code" href="structskinnysession.html#a70701ca9c2641bcb1740286273a0473a">device</a>;
<a name="l07348"></a>07348       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;d-&gt;lines, l, list){
<a name="l07349"></a>07349          <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;l-&gt;<a class="code" href="structskinny__line.html#ae5e68fb86600e9f1e67bb18aaa19f78a">lock</a>);
<a name="l07350"></a>07350          <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;l-&gt;sub, sub, list) {
<a name="l07351"></a>07351             <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;sub-&gt;<a class="code" href="structskinny__subchannel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l07352"></a>07352             <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l07353"></a>07353                sub-&gt;<a class="code" href="structskinny__subchannel.html#ac43993a73742eff145b861107a1afa0d">alreadygone</a> = 1;
<a name="l07354"></a>07354                <a class="code" href="channel_8h.html#ac2d6607253f7e8b272d4e845474eaa9b" title="Softly hangup up a channel.">ast_softhangup</a>(sub-&gt;<a class="code" href="structskinny__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709aeeafae6abd77156800ec76b0ff7d3867">AST_SOFTHANGUP_APPUNLOAD</a>);
<a name="l07355"></a>07355             }
<a name="l07356"></a>07356             <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;sub-&gt;<a class="code" href="structskinny__subchannel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l07357"></a>07357          }
<a name="l07358"></a>07358          <span class="keywordflow">if</span> (l-&gt;<a class="code" href="structskinny__line.html#a7dec0df43032d5c53d9a125030385a30">mwi_event_sub</a>)
<a name="l07359"></a>07359             <a class="code" href="event_8h.html#a71eb177cf8553883be773f1534e8a09a" title="Un-subscribe from events.">ast_event_unsubscribe</a>(l-&gt;<a class="code" href="structskinny__line.html#a7dec0df43032d5c53d9a125030385a30">mwi_event_sub</a>);
<a name="l07360"></a>07360          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;l-&gt;<a class="code" href="structskinny__line.html#ae5e68fb86600e9f1e67bb18aaa19f78a">lock</a>);
<a name="l07361"></a>07361          <a class="code" href="chan__skinny_8c.html#ae456c964b75f4dff4d73df78f39db454">unregister_exten</a>(l);
<a name="l07362"></a>07362       }
<a name="l07363"></a>07363       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structskinnysession.html#a6f8059414f0228f0256115e024eeed4b">fd</a> &gt; -1)
<a name="l07364"></a>07364          close(s-&gt;<a class="code" href="structskinnysession.html#a6f8059414f0228f0256115e024eeed4b">fd</a>);
<a name="l07365"></a>07365       pthread_cancel(s-&gt;<a class="code" href="structskinnysession.html#aa49d6a06775253352589280dc7f30018">t</a>);
<a name="l07366"></a>07366       pthread_kill(s-&gt;<a class="code" href="structskinnysession.html#aa49d6a06775253352589280dc7f30018">t</a>, SIGURG);
<a name="l07367"></a>07367       pthread_join(s-&gt;<a class="code" href="structskinnysession.html#aa49d6a06775253352589280dc7f30018">t</a>, NULL);
<a name="l07368"></a>07368       <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(s);
<a name="l07369"></a>07369    }
<a name="l07370"></a>07370    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="structsessions.html">sessions</a>);
<a name="l07371"></a>07371 
<a name="l07372"></a>07372    <a class="code" href="chan__skinny_8c.html#aa9daeada19a92710d428551482cb20f9">delete_devices</a>();
<a name="l07373"></a>07373 
<a name="l07374"></a>07374    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;monlock);
<a name="l07375"></a>07375    <span class="keywordflow">if</span> ((monitor_thread != <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>) &amp;&amp; (monitor_thread != <a class="code" href="lock_8h.html#a873a83eb8196323194aac2bea23d794e">AST_PTHREADT_STOP</a>)) {
<a name="l07376"></a>07376       pthread_cancel(monitor_thread);
<a name="l07377"></a>07377       pthread_kill(monitor_thread, SIGURG);
<a name="l07378"></a>07378       pthread_join(monitor_thread, NULL);
<a name="l07379"></a>07379    }
<a name="l07380"></a>07380    monitor_thread = <a class="code" href="lock_8h.html#a873a83eb8196323194aac2bea23d794e">AST_PTHREADT_STOP</a>;
<a name="l07381"></a>07381    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;monlock);
<a name="l07382"></a>07382 
<a name="l07383"></a>07383    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;netlock);
<a name="l07384"></a>07384    <span class="keywordflow">if</span> (accept_t &amp;&amp; (accept_t != <a class="code" href="lock_8h.html#a873a83eb8196323194aac2bea23d794e">AST_PTHREADT_STOP</a>)) {
<a name="l07385"></a>07385       pthread_cancel(accept_t);
<a name="l07386"></a>07386       pthread_kill(accept_t, SIGURG);
<a name="l07387"></a>07387       pthread_join(accept_t, NULL);
<a name="l07388"></a>07388    }
<a name="l07389"></a>07389    accept_t = <a class="code" href="lock_8h.html#a873a83eb8196323194aac2bea23d794e">AST_PTHREADT_STOP</a>;
<a name="l07390"></a>07390    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;netlock);
<a name="l07391"></a>07391 
<a name="l07392"></a>07392    close(skinnysock);
<a name="l07393"></a>07393    <span class="keywordflow">if</span> (sched)
<a name="l07394"></a>07394       <a class="code" href="sched_8h.html#a7350994bcfd1be91874493dbe25faf0c" title="destroys a schedule context Destroys (free&amp;#39;s) the given sched_context structure...">sched_context_destroy</a>(sched);
<a name="l07395"></a>07395 
<a name="l07396"></a>07396    con = <a class="code" href="pbx_8h.html#a2af2d2771e5347b18454a05dbc98e35f" title="Find a context.">ast_context_find</a>(used_context);
<a name="l07397"></a>07397    <span class="keywordflow">if</span> (con)
<a name="l07398"></a>07398       <a class="code" href="pbx_8h.html#a9546b830c22c693a2baed08e48569401" title="Destroy a context (matches the specified context (or ANY context if NULL).">ast_context_destroy</a>(con, <span class="stringliteral">&quot;Skinny&quot;</span>);
<a name="l07399"></a>07399    
<a name="l07400"></a>07400    <span class="keywordflow">return</span> 0;
<a name="l07401"></a>07401 }
<a name="l07402"></a>07402 
<a name="l07403"></a><a class="code" href="chan__skinny_8c.html#ad1982509765f4870f1f63412a53ea668">07403</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__skinny_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a>(<span class="keywordtype">void</span>)
<a name="l07404"></a>07404 {
<a name="l07405"></a>07405    <a class="code" href="chan__skinny_8c.html#aa53f60b698c21b4f290b5defcf53ef9b">skinny_reload</a>();
<a name="l07406"></a>07406    <span class="keywordflow">return</span> 0;
<a name="l07407"></a>07407 }
<a name="l07408"></a>07408 
<a name="l07409"></a>07409 <a class="code" href="module_8h.html#a9f4aa0e21486bdbcef428335268690c9">AST_MODULE_INFO</a>(<a class="code" href="module_8h.html#aba2c8d4be709a254658b21a834f8294a" title="The text the key() function should return.">ASTERISK_GPL_KEY</a>, <a class="code" href="module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a54af2a9b29d140908cc9dffd0618951b">AST_MODFLAG_DEFAULT</a>, <span class="stringliteral">&quot;Skinny Client Control Protocol (Skinny)&quot;</span>,
<a name="l07410"></a>07410       .load = <a class="code" href="chan__skinny_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>,
<a name="l07411"></a>07411       .unload = <a class="code" href="agent_8c.html#a95bac1db604c69a01ef7b3995342cd7a">unload_module</a>,
<a name="l07412"></a>07412       .<a class="code" href="chan__skinny_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> = <a class="code" href="chan__skinny_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a>,
<a name="l07413"></a>07413 );
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:18:36 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
