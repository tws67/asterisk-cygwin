<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:18:50 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_1ab815038f534adda65c8b4ae4993449.html">include</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_16d825f1fa9ecca2e70b1a8d9256d0e6.html">asterisk</a>
  </div>
</div>
<div class="contents">
<h1>abstract_jb.h File Reference</h1>
<p>Common implementation-independent jitterbuffer stuff.  
<a href="#_details">More...</a></p>
<code>#include &lt;sys/time.h&gt;</code><br/>

<p><a href="abstract__jb_8h_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__jb.html">ast_jb</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">General jitterbuffer <a class="el" href="structstate.html">state</a>.  <a href="structast__jb.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__jb__conf.html">ast_jb_conf</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">General jitterbuffer configuration.  <a href="structast__jb__conf.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="abstract__jb_8h.html#a168e0e7cbd179c4aceefd8bb42c3a408">AST_JB_CONF_ENABLE</a>&nbsp;&nbsp;&nbsp;&quot;enable&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="abstract__jb_8h.html#ad9f3ff3a64a627dd8ec08e92e32081c3">AST_JB_CONF_FORCE</a>&nbsp;&nbsp;&nbsp;&quot;force&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="abstract__jb_8h.html#a3025d70ca72b1abc6983d3f18c50b899">AST_JB_CONF_IMPL</a>&nbsp;&nbsp;&nbsp;&quot;impl&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="abstract__jb_8h.html#a30af15dd4b567ed1950e7b3a78d9a89f">AST_JB_CONF_LOG</a>&nbsp;&nbsp;&nbsp;&quot;log&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="abstract__jb_8h.html#adf4913cb009ccd8f95dc5cc6422872b9">AST_JB_CONF_MAX_SIZE</a>&nbsp;&nbsp;&nbsp;&quot;maxsize&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="abstract__jb_8h.html#aff7a5dfaf7cb79efb8e9ddc564212d1c">AST_JB_CONF_PREFIX</a>&nbsp;&nbsp;&nbsp;&quot;jb&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="abstract__jb_8h.html#a1c488fb41b043a2e392f6ecd6e78f3ed">AST_JB_CONF_RESYNCH_THRESHOLD</a>&nbsp;&nbsp;&nbsp;&quot;resyncthreshold&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="abstract__jb_8h.html#aec196522d0bff37d617dab5fcb403a46">AST_JB_CONF_TARGET_EXTRA</a>&nbsp;&nbsp;&nbsp;&quot;targetextra&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="abstract__jb_8h.html#aed29eaebafbb4e5179d3a40d4d890e2e">AST_JB_IMPL_NAME_SIZE</a>&nbsp;&nbsp;&nbsp;12</td></tr>
<tr><td colspan="2"><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom">{ <a class="el" href="abstract__jb_8h.html#aad393aa3e173d7f081ab4bbc6ba5027daf49c3e265d3ff27e62d8c38779d89dd9">AST_JB_ENABLED</a> =  (1 &lt;&lt; 0), 
<a class="el" href="abstract__jb_8h.html#aad393aa3e173d7f081ab4bbc6ba5027dac9bdd81232f2ef32fad9ebd0b92b9f63">AST_JB_FORCED</a> =  (1 &lt;&lt; 1), 
<a class="el" href="abstract__jb_8h.html#aad393aa3e173d7f081ab4bbc6ba5027dae6ca3d7ddaa509b36e1fb4c36c18478e">AST_JB_LOG</a> =  (1 &lt;&lt; 2)
 }</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="abstract__jb_8h.html#a0981c84ac90dd79bc2a0fdd90aa6efba">ast_jb_configure</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const struct <a class="el" href="structast__jb__conf.html">ast_jb_conf</a> *conf)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Configures a jitterbuffer on a channel.  <a href="#a0981c84ac90dd79bc2a0fdd90aa6efba"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="abstract__jb_8h.html#aa94fd3c228854f8ac519da8218d5c032">ast_jb_destroy</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Destroys jitterbuffer on a channel.  <a href="#aa94fd3c228854f8ac519da8218d5c032"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="abstract__jb_8h.html#ad013da092efd28ba7a6a21ee76297a80">ast_jb_do_usecheck</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c0, struct <a class="el" href="structast__channel.html">ast_channel</a> *c1)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Checks the need of a jb use in a generic bridge.  <a href="#ad013da092efd28ba7a6a21ee76297a80"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="abstract__jb_8h.html#a252f5415d8e69c1d17597ccb16446a30">ast_jb_empty_and_reset</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c0, struct <a class="el" href="structast__channel.html">ast_channel</a> *c1)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">drops all frames from a jitterbuffer and resets it  <a href="#a252f5415d8e69c1d17597ccb16446a30"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="abstract__jb_8h.html#a543ca527d26b42c6f50eccb2924ddebd">ast_jb_get_and_deliver</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c0, struct <a class="el" href="structast__channel.html">ast_channel</a> *c1)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Deliver the queued frames that should be delivered now for both <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>.  <a href="#a543ca527d26b42c6f50eccb2924ddebd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="abstract__jb_8h.html#ae38fc3d7573cd890716edca9bcb31766">ast_jb_get_config</a> (const struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__jb__conf.html">ast_jb_conf</a> *conf)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Copies a channel's jitterbuffer configuration.  <a href="#ae38fc3d7573cd890716edca9bcb31766"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="abstract__jb_8h.html#ad3f6eb99c87c8fb1d79232762df48354">ast_jb_get_when_to_wakeup</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c0, struct <a class="el" href="structast__channel.html">ast_channel</a> *c1, int time_left)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Calculates the time, left to the closest delivery moment in a bridge.  <a href="#ad3f6eb99c87c8fb1d79232762df48354"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="abstract__jb_8h.html#a971bdfddf7e452f516dd32991951d581">ast_jb_put</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__frame.html">ast_frame</a> *<a class="el" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Puts a frame into a channel jitterbuffer.  <a href="#a971bdfddf7e452f516dd32991951d581"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="abstract__jb_8h.html#ae50ad081bd2ae6b58bcfc4687916c586">ast_jb_read_conf</a> (struct <a class="el" href="structast__jb__conf.html">ast_jb_conf</a> *conf, const char *varname, const char *value)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Sets jitterbuffer configuration property.  <a href="#ae50ad081bd2ae6b58bcfc4687916c586"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Common implementation-independent jitterbuffer stuff. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Slav Klenov &lt;<a href="mailto:slav@securax.org">slav@securax.org</a>&gt; </dd></dl>

<p>Definition in file <a class="el" href="abstract__jb_8h_source.html">abstract_jb.h</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a168e0e7cbd179c4aceefd8bb42c3a408"></a><!-- doxytag: member="abstract_jb.h::AST_JB_CONF_ENABLE" ref="a168e0e7cbd179c4aceefd8bb42c3a408" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_JB_CONF_ENABLE&nbsp;&nbsp;&nbsp;&quot;enable&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="abstract__jb_8h_source.html#l00070">70</a> of file <a class="el" href="abstract__jb_8h_source.html">abstract_jb.h</a>.</p>

<p>Referenced by <a class="el" href="abstract__jb_8c_source.html#l00571">ast_jb_read_conf()</a>.</p>

</div>
</div>
<a class="anchor" id="ad9f3ff3a64a627dd8ec08e92e32081c3"></a><!-- doxytag: member="abstract_jb.h::AST_JB_CONF_FORCE" ref="ad9f3ff3a64a627dd8ec08e92e32081c3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_JB_CONF_FORCE&nbsp;&nbsp;&nbsp;&quot;force&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="abstract__jb_8h_source.html#l00071">71</a> of file <a class="el" href="abstract__jb_8h_source.html">abstract_jb.h</a>.</p>

<p>Referenced by <a class="el" href="abstract__jb_8c_source.html#l00571">ast_jb_read_conf()</a>.</p>

</div>
</div>
<a class="anchor" id="a3025d70ca72b1abc6983d3f18c50b899"></a><!-- doxytag: member="abstract_jb.h::AST_JB_CONF_IMPL" ref="a3025d70ca72b1abc6983d3f18c50b899" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_JB_CONF_IMPL&nbsp;&nbsp;&nbsp;&quot;impl&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="abstract__jb_8h_source.html#l00075">75</a> of file <a class="el" href="abstract__jb_8h_source.html">abstract_jb.h</a>.</p>

<p>Referenced by <a class="el" href="abstract__jb_8c_source.html#l00571">ast_jb_read_conf()</a>.</p>

</div>
</div>
<a class="anchor" id="a30af15dd4b567ed1950e7b3a78d9a89f"></a><!-- doxytag: member="abstract_jb.h::AST_JB_CONF_LOG" ref="a30af15dd4b567ed1950e7b3a78d9a89f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_JB_CONF_LOG&nbsp;&nbsp;&nbsp;&quot;log&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="abstract__jb_8h_source.html#l00076">76</a> of file <a class="el" href="abstract__jb_8h_source.html">abstract_jb.h</a>.</p>

<p>Referenced by <a class="el" href="abstract__jb_8c_source.html#l00571">ast_jb_read_conf()</a>.</p>

</div>
</div>
<a class="anchor" id="adf4913cb009ccd8f95dc5cc6422872b9"></a><!-- doxytag: member="abstract_jb.h::AST_JB_CONF_MAX_SIZE" ref="adf4913cb009ccd8f95dc5cc6422872b9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_JB_CONF_MAX_SIZE&nbsp;&nbsp;&nbsp;&quot;maxsize&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="abstract__jb_8h_source.html#l00072">72</a> of file <a class="el" href="abstract__jb_8h_source.html">abstract_jb.h</a>.</p>

<p>Referenced by <a class="el" href="abstract__jb_8c_source.html#l00571">ast_jb_read_conf()</a>.</p>

</div>
</div>
<a class="anchor" id="aff7a5dfaf7cb79efb8e9ddc564212d1c"></a><!-- doxytag: member="abstract_jb.h::AST_JB_CONF_PREFIX" ref="aff7a5dfaf7cb79efb8e9ddc564212d1c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_JB_CONF_PREFIX&nbsp;&nbsp;&nbsp;&quot;jb&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="abstract__jb_8h_source.html#l00069">69</a> of file <a class="el" href="abstract__jb_8h_source.html">abstract_jb.h</a>.</p>

<p>Referenced by <a class="el" href="abstract__jb_8c_source.html#l00571">ast_jb_read_conf()</a>.</p>

</div>
</div>
<a class="anchor" id="a1c488fb41b043a2e392f6ecd6e78f3ed"></a><!-- doxytag: member="abstract_jb.h::AST_JB_CONF_RESYNCH_THRESHOLD" ref="a1c488fb41b043a2e392f6ecd6e78f3ed" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_JB_CONF_RESYNCH_THRESHOLD&nbsp;&nbsp;&nbsp;&quot;resyncthreshold&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="abstract__jb_8h_source.html#l00073">73</a> of file <a class="el" href="abstract__jb_8h_source.html">abstract_jb.h</a>.</p>

<p>Referenced by <a class="el" href="abstract__jb_8c_source.html#l00571">ast_jb_read_conf()</a>.</p>

</div>
</div>
<a class="anchor" id="aec196522d0bff37d617dab5fcb403a46"></a><!-- doxytag: member="abstract_jb.h::AST_JB_CONF_TARGET_EXTRA" ref="aec196522d0bff37d617dab5fcb403a46" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_JB_CONF_TARGET_EXTRA&nbsp;&nbsp;&nbsp;&quot;targetextra&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="abstract__jb_8h_source.html#l00074">74</a> of file <a class="el" href="abstract__jb_8h_source.html">abstract_jb.h</a>.</p>

<p>Referenced by <a class="el" href="abstract__jb_8c_source.html#l00571">ast_jb_read_conf()</a>.</p>

</div>
</div>
<a class="anchor" id="aed29eaebafbb4e5179d3a40d4d890e2e"></a><!-- doxytag: member="abstract_jb.h::AST_JB_IMPL_NAME_SIZE" ref="aed29eaebafbb4e5179d3a40d4d890e2e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_JB_IMPL_NAME_SIZE&nbsp;&nbsp;&nbsp;12</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="abstract__jb_8h_source.html#l00048">48</a> of file <a class="el" href="abstract__jb_8h_source.html">abstract_jb.h</a>.</p>

<p>Referenced by <a class="el" href="abstract__jb_8c_source.html#l00445">create_jb()</a>.</p>

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="aad393aa3e173d7f081ab4bbc6ba5027d"></a><!-- doxytag: member="abstract_jb.h::@89" ref="aad393aa3e173d7f081ab4bbc6ba5027d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="aad393aa3e173d7f081ab4bbc6ba5027daf49c3e265d3ff27e62d8c38779d89dd9"></a><!-- doxytag: member="AST_JB_ENABLED" ref="aad393aa3e173d7f081ab4bbc6ba5027daf49c3e265d3ff27e62d8c38779d89dd9" args="" -->AST_JB_ENABLED</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="aad393aa3e173d7f081ab4bbc6ba5027dac9bdd81232f2ef32fad9ebd0b92b9f63"></a><!-- doxytag: member="AST_JB_FORCED" ref="aad393aa3e173d7f081ab4bbc6ba5027dac9bdd81232f2ef32fad9ebd0b92b9f63" args="" -->AST_JB_FORCED</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="aad393aa3e173d7f081ab4bbc6ba5027dae6ca3d7ddaa509b36e1fb4c36c18478e"></a><!-- doxytag: member="AST_JB_LOG" ref="aad393aa3e173d7f081ab4bbc6ba5027dae6ca3d7ddaa509b36e1fb4c36c18478e" args="" -->AST_JB_LOG</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="abstract__jb_8h_source.html#l00042">42</a> of file <a class="el" href="abstract__jb_8h_source.html">abstract_jb.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00042"></a>00042      {
<a name="l00043"></a>00043    <a class="code" href="abstract__jb_8h.html#aad393aa3e173d7f081ab4bbc6ba5027daf49c3e265d3ff27e62d8c38779d89dd9">AST_JB_ENABLED</a> = (1 &lt;&lt; 0),
<a name="l00044"></a>00044    <a class="code" href="abstract__jb_8h.html#aad393aa3e173d7f081ab4bbc6ba5027dac9bdd81232f2ef32fad9ebd0b92b9f63">AST_JB_FORCED</a> =  (1 &lt;&lt; 1),
<a name="l00045"></a>00045    <a class="code" href="abstract__jb_8h.html#aad393aa3e173d7f081ab4bbc6ba5027dae6ca3d7ddaa509b36e1fb4c36c18478e">AST_JB_LOG</a> =     (1 &lt;&lt; 2)
<a name="l00046"></a>00046 };
</pre></div></p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a0981c84ac90dd79bc2a0fdd90aa6efba"></a><!-- doxytag: member="abstract_jb.h::ast_jb_configure" ref="a0981c84ac90dd79bc2a0fdd90aa6efba" args="(struct ast_channel *chan, const struct ast_jb_conf *conf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_jb_configure </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structast__jb__conf.html">ast_jb_conf</a> *&nbsp;</td>
          <td class="paramname"> <em>conf</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Configures a jitterbuffer on a channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel to configure. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>conf</em>&nbsp;</td><td>configuration to apply.</td></tr>
  </table>
  </dd>
</dl>
<p>Called from a channel driver when a channel is created and its jitterbuffer needs to be configured. </p>

<p>Definition at line <a class="el" href="abstract__jb_8c_source.html#l00610">610</a> of file <a class="el" href="abstract__jb_8c_source.html">abstract_jb.c</a>.</p>

<p>References <a class="el" href="abstract__jb_8h_source.html#l00088">ast_jb::conf</a>, and <a class="el" href="channel_8h_source.html#l00451">ast_channel::jb</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l00951">__oh323_rtp_create()</a>, <a class="el" href="chan__h323_8c_source.html#l00332">__oh323_update_info()</a>, <a class="el" href="chan__alsa_8c_source.html#l00536">alsa_new()</a>, <a class="el" href="chan__console_8c_source.html#l00410">console_new()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00989">gtalk_new()</a>, <a class="el" href="chan__jingle_8c_source.html#l00800">jingle_new()</a>, <a class="el" href="chan__local_8c_source.html#l00734">local_new()</a>, <a class="el" href="chan__mgcp_8c_source.html#l01470">mgcp_new()</a>, <a class="el" href="chan__misdn_8c_source.html#l03705">misdn_new()</a>, <a class="el" href="chan__oss_8c_source.html#l00784">oss_new()</a>, <a class="el" href="chan__sip_8c_source.html#l06599">sip_new()</a>, <a class="el" href="chan__skinny_8c_source.html#l04268">skinny_new()</a>, <a class="el" href="chan__unistim_8c_source.html#l04422">unistim_new()</a>, and <a class="el" href="chan__usbradio_8c_source.html#l02183">usbradio_new()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00611"></a>00611 {
<a name="l00612"></a>00612    memcpy(&amp;chan-&gt;<a class="code" href="structast__channel.html#ac9cb7d989f739f5a082bcffd4262d4af">jb</a>.<a class="code" href="structast__jb.html#a5e0765fcfec251b02238ec7159d3857a" title="Jitterbuffer configuration.">conf</a>, conf, <span class="keyword">sizeof</span>(*conf));
<a name="l00613"></a>00613 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa94fd3c228854f8ac519da8218d5c032"></a><!-- doxytag: member="abstract_jb.h::ast_jb_destroy" ref="aa94fd3c228854f8ac519da8218d5c032" args="(struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_jb_destroy </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Destroys jitterbuffer on a channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel.</td></tr>
  </table>
  </dd>
</dl>
<p>Called from <a class="el" href="channel_8h.html#a239d899b30002db4e8b08c055ac9d8e5" title="Free a channel structure.">ast_channel_free()</a> when a channel is destroyed. </p>

<p>Definition at line <a class="el" href="abstract__jb_8c_source.html#l00530">530</a> of file <a class="el" href="abstract__jb_8c_source.html">abstract_jb.c</a>.</p>

<p>References <a class="el" href="utils_8h_source.html#l00075">ast_clear_flag</a>, <a class="el" href="frame_8h_source.html#l00462">ast_frfree</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="abstract__jb_8c_source.html#l00080">ast_jb_impl::destroy</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="abstract__jb_8h_source.html#l00090">ast_jb::impl</a>, <a class="el" href="channel_8h_source.html#l00451">ast_channel::jb</a>, <a class="el" href="abstract__jb_8c_source.html#l00049">JB_CREATED</a>, <a class="el" href="abstract__jb_8c_source.html#l00146">JB_IMPL_OK</a>, <a class="el" href="abstract__jb_8h_source.html#l00092">ast_jb::jbobj</a>, <a class="el" href="abstract__jb_8h_source.html#l00100">ast_jb::logfile</a>, <a class="el" href="abstract__jb_8c_source.html#l00078">ast_jb_impl::name</a>, and <a class="el" href="abstract__jb_8c_source.html#l00085">ast_jb_impl::remove</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l01388">ast_channel_free()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00531"></a>00531 {
<a name="l00532"></a>00532    <span class="keyword">struct </span><a class="code" href="structast__jb.html" title="General jitterbuffer state.">ast_jb</a> *jb = &amp;chan-&gt;<a class="code" href="structast__channel.html#ac9cb7d989f739f5a082bcffd4262d4af">jb</a>;
<a name="l00533"></a>00533    <span class="keyword">struct </span><a class="code" href="structast__jb__impl.html" title="Jitterbuffer implementation private struct.">ast_jb_impl</a> *jbimpl = jb-&gt;<a class="code" href="structast__jb.html#abb027c8d7c9c539e7e8ba8a31be7569f" title="Jitterbuffer implementation to be used.">impl</a>;
<a name="l00534"></a>00534    <span class="keywordtype">void</span> *jbobj = jb-&gt;<a class="code" href="structast__jb.html#a51035317dc8789dd45eb2879177fea07" title="Jitterbuffer object, passed to the implementation.">jbobj</a>;
<a name="l00535"></a>00535    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l00536"></a>00536 
<a name="l00537"></a>00537    <span class="keywordflow">if</span> (jb-&gt;<a class="code" href="structast__jb.html#ab25a3625a8efbaa3d81ef27bbb51c9c5" title="File for frame timestamp tracing.">logfile</a>) {
<a name="l00538"></a>00538       fclose(jb-&gt;<a class="code" href="structast__jb.html#ab25a3625a8efbaa3d81ef27bbb51c9c5" title="File for frame timestamp tracing.">logfile</a>);
<a name="l00539"></a>00539       jb-&gt;<a class="code" href="structast__jb.html#ab25a3625a8efbaa3d81ef27bbb51c9c5" title="File for frame timestamp tracing.">logfile</a> = NULL;
<a name="l00540"></a>00540    }
<a name="l00541"></a>00541 
<a name="l00542"></a>00542    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a44ed8c27e26a66b03cedb8d77a424af5">JB_CREATED</a>)) {
<a name="l00543"></a>00543       <span class="comment">/* Remove and free all frames still queued in jb */</span>
<a name="l00544"></a>00544       <span class="keywordflow">while</span> (jbimpl-&gt;<a class="code" href="structast__jb__impl.html#a66c0c9ee34addeb93c5adca833649f9b">remove</a>(jbobj, &amp;f) == <a class="code" href="abstract__jb_8c.html#a52864abcf6ebd8d120995b36fe6ce06ead66978f8f133d1d59c73904b675b170a">JB_IMPL_OK</a>) {
<a name="l00545"></a>00545          <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l00546"></a>00546       }
<a name="l00547"></a>00547 
<a name="l00548"></a>00548       jbimpl-&gt;<a class="code" href="structast__jb__impl.html#a2deddc2d4df26e6e0e3ebde6c98f6647">destroy</a>(jbobj);
<a name="l00549"></a>00549       jb-&gt;<a class="code" href="structast__jb.html#a51035317dc8789dd45eb2879177fea07" title="Jitterbuffer object, passed to the implementation.">jbobj</a> = NULL;
<a name="l00550"></a>00550 
<a name="l00551"></a>00551       <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(jb, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a44ed8c27e26a66b03cedb8d77a424af5">JB_CREATED</a>);
<a name="l00552"></a>00552 
<a name="l00553"></a>00553       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;%s jitterbuffer destroyed on channel %s\n&quot;</span>, jbimpl-&gt;<a class="code" href="structast__jb__impl.html#a5276c0a183c322592ca4435cf76f8fb2">name</a>, chan-&gt;name);
<a name="l00554"></a>00554    }
<a name="l00555"></a>00555 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad013da092efd28ba7a6a21ee76297a80"></a><!-- doxytag: member="abstract_jb.h::ast_jb_do_usecheck" ref="ad013da092efd28ba7a6a21ee76297a80" args="(struct ast_channel *c0, struct ast_channel *c1)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_jb_do_usecheck </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c1</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Checks the need of a jb use in a generic bridge. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c0</em>&nbsp;</td><td>first bridged channel. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>c1</em>&nbsp;</td><td>second bridged channel.</td></tr>
  </table>
  </dd>
</dl>
<p>Called from <a class="el" href="channel_8c.html#a94b603f7b9476126cafc9e0b82dd7d4d">ast_generic_bridge()</a> when two <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> are entering in a bridge. The function checks the need of a jitterbuffer, depending on both channel's configuration and technology properties. As a result, this function sets appropriate internal jb flags to the <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>, determining further behaviour of the bridged jitterbuffers.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>zero</em>&nbsp;</td><td>if there are no jitter buffers in use </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>non-zero</em>&nbsp;</td><td>if there are </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="abstract__jb_8c_source.html#l00202">202</a> of file <a class="el" href="abstract__jb_8c_source.html">abstract_jb.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00517">AST_CHAN_TP_CREATESJITTER</a>, <a class="el" href="channel_8h_source.html#l00514">AST_CHAN_TP_WANTSJITTER</a>, <a class="el" href="abstract__jb_8h_source.html#l00043">AST_JB_ENABLED</a>, <a class="el" href="abstract__jb_8h_source.html#l00044">AST_JB_FORCED</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="abstract__jb_8h_source.html#l00088">ast_jb::conf</a>, <a class="el" href="pbx__gtkconsole_8c_source.html#l00054">inuse</a>, <a class="el" href="channel_8h_source.html#l00451">ast_channel::jb</a>, <a class="el" href="abstract__jb_8c_source.html#l00180">jb_choose_impl()</a>, <a class="el" href="abstract__jb_8c_source.html#l00049">JB_CREATED</a>, <a class="el" href="abstract__jb_8c_source.html#l00048">JB_TIMEBASE_INITIALIZED</a>, <a class="el" href="abstract__jb_8c_source.html#l00047">JB_USE</a>, <a class="el" href="channel_8h_source.html#l00231">ast_channel_tech::properties</a>, <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>, and <a class="el" href="abstract__jb_8h_source.html#l00094">ast_jb::timebase</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l04776">ast_generic_bridge()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00203"></a>00203 {
<a name="l00204"></a>00204    <span class="keyword">struct </span><a class="code" href="structast__jb.html" title="General jitterbuffer state.">ast_jb</a> *jb0 = &amp;c0-&gt;<a class="code" href="structast__channel.html#ac9cb7d989f739f5a082bcffd4262d4af">jb</a>;
<a name="l00205"></a>00205    <span class="keyword">struct </span><a class="code" href="structast__jb.html" title="General jitterbuffer state.">ast_jb</a> *jb1 = &amp;c1-&gt;<a class="code" href="structast__channel.html#ac9cb7d989f739f5a082bcffd4262d4af">jb</a>;
<a name="l00206"></a>00206    <span class="keyword">struct </span><a class="code" href="structast__jb__conf.html" title="General jitterbuffer configuration.">ast_jb_conf</a> *conf0 = &amp;jb0-&gt;<a class="code" href="structast__jb.html#a5e0765fcfec251b02238ec7159d3857a" title="Jitterbuffer configuration.">conf</a>;
<a name="l00207"></a>00207    <span class="keyword">struct </span><a class="code" href="structast__jb__conf.html" title="General jitterbuffer configuration.">ast_jb_conf</a> *conf1 = &amp;jb1-&gt;<a class="code" href="structast__jb.html#a5e0765fcfec251b02238ec7159d3857a" title="Jitterbuffer configuration.">conf</a>;
<a name="l00208"></a>00208    <span class="keywordtype">int</span> c0_wants_jitter = c0-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a5f36febd4b26a025856e994a4e189a20">properties</a> &amp; <a class="code" href="channel_8h.html#a4f126a0a9b1d8c6a8f46a051ef8830bba54130226ec87f80c48ee98aa5cc9168c" title="Channels have this property if they can accept input with jitter; i.e. most VoIP...">AST_CHAN_TP_WANTSJITTER</a>;
<a name="l00209"></a>00209    <span class="keywordtype">int</span> c0_creates_jitter = c0-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a5f36febd4b26a025856e994a4e189a20">properties</a> &amp; <a class="code" href="channel_8h.html#a4f126a0a9b1d8c6a8f46a051ef8830bbafb2c9cea57f7fc8e0350ed6f60cbb892" title="Channels have this property if they can create jitter; i.e. most VoIP channels.">AST_CHAN_TP_CREATESJITTER</a>;
<a name="l00210"></a>00210    <span class="keywordtype">int</span> c0_jb_enabled = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(conf0, <a class="code" href="abstract__jb_8h.html#aad393aa3e173d7f081ab4bbc6ba5027daf49c3e265d3ff27e62d8c38779d89dd9">AST_JB_ENABLED</a>);
<a name="l00211"></a>00211    <span class="keywordtype">int</span> c0_force_jb = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(conf0, <a class="code" href="abstract__jb_8h.html#aad393aa3e173d7f081ab4bbc6ba5027dac9bdd81232f2ef32fad9ebd0b92b9f63">AST_JB_FORCED</a>);
<a name="l00212"></a>00212    <span class="keywordtype">int</span> c0_jb_timebase_initialized = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb0, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140afe2d9a1cb0e496b589437b7faed7f23a">JB_TIMEBASE_INITIALIZED</a>);
<a name="l00213"></a>00213    <span class="keywordtype">int</span> c0_jb_created = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb0, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a44ed8c27e26a66b03cedb8d77a424af5">JB_CREATED</a>);
<a name="l00214"></a>00214    <span class="keywordtype">int</span> c1_wants_jitter = c1-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a5f36febd4b26a025856e994a4e189a20">properties</a> &amp; <a class="code" href="channel_8h.html#a4f126a0a9b1d8c6a8f46a051ef8830bba54130226ec87f80c48ee98aa5cc9168c" title="Channels have this property if they can accept input with jitter; i.e. most VoIP...">AST_CHAN_TP_WANTSJITTER</a>;
<a name="l00215"></a>00215    <span class="keywordtype">int</span> c1_creates_jitter = c1-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a5f36febd4b26a025856e994a4e189a20">properties</a> &amp; <a class="code" href="channel_8h.html#a4f126a0a9b1d8c6a8f46a051ef8830bbafb2c9cea57f7fc8e0350ed6f60cbb892" title="Channels have this property if they can create jitter; i.e. most VoIP channels.">AST_CHAN_TP_CREATESJITTER</a>;
<a name="l00216"></a>00216    <span class="keywordtype">int</span> c1_jb_enabled = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(conf1, <a class="code" href="abstract__jb_8h.html#aad393aa3e173d7f081ab4bbc6ba5027daf49c3e265d3ff27e62d8c38779d89dd9">AST_JB_ENABLED</a>);
<a name="l00217"></a>00217    <span class="keywordtype">int</span> c1_force_jb = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(conf1, <a class="code" href="abstract__jb_8h.html#aad393aa3e173d7f081ab4bbc6ba5027dac9bdd81232f2ef32fad9ebd0b92b9f63">AST_JB_FORCED</a>);
<a name="l00218"></a>00218    <span class="keywordtype">int</span> c1_jb_timebase_initialized = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb1, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140afe2d9a1cb0e496b589437b7faed7f23a">JB_TIMEBASE_INITIALIZED</a>);
<a name="l00219"></a>00219    <span class="keywordtype">int</span> c1_jb_created = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb1, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a44ed8c27e26a66b03cedb8d77a424af5">JB_CREATED</a>);
<a name="l00220"></a>00220    <span class="keywordtype">int</span> <a class="code" href="pbx__gtkconsole_8c.html#a679cabe3b846f2e363f43d8e57433834">inuse</a> = 0;
<a name="l00221"></a>00221 
<a name="l00222"></a>00222    <span class="comment">/* Determine whether audio going to c0 needs a jitter buffer */</span>
<a name="l00223"></a>00223    <span class="keywordflow">if</span> (((!c0_wants_jitter &amp;&amp; c1_creates_jitter) || (c0_force_jb &amp;&amp; c1_creates_jitter)) &amp;&amp; c0_jb_enabled) {
<a name="l00224"></a>00224       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(jb0, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a8ee448ef258f740aeb4e0ea89436af6d">JB_USE</a>);
<a name="l00225"></a>00225       <span class="keywordflow">if</span> (!c0_jb_timebase_initialized) {
<a name="l00226"></a>00226          <span class="keywordflow">if</span> (c1_jb_timebase_initialized) {
<a name="l00227"></a>00227             memcpy(&amp;jb0-&gt;<a class="code" href="structast__jb.html#ab0653ad203e83c307faf381f663e4649" title="The time the jitterbuffer was created.">timebase</a>, &amp;jb1-&gt;<a class="code" href="structast__jb.html#ab0653ad203e83c307faf381f663e4649" title="The time the jitterbuffer was created.">timebase</a>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> timeval));
<a name="l00228"></a>00228          } <span class="keywordflow">else</span> {
<a name="l00229"></a>00229             gettimeofday(&amp;jb0-&gt;<a class="code" href="structast__jb.html#ab0653ad203e83c307faf381f663e4649" title="The time the jitterbuffer was created.">timebase</a>, NULL);
<a name="l00230"></a>00230          }
<a name="l00231"></a>00231          <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(jb0, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140afe2d9a1cb0e496b589437b7faed7f23a">JB_TIMEBASE_INITIALIZED</a>);
<a name="l00232"></a>00232       }
<a name="l00233"></a>00233 
<a name="l00234"></a>00234       <span class="keywordflow">if</span> (!c0_jb_created) {
<a name="l00235"></a>00235          <a class="code" href="abstract__jb_8c.html#ab45f11b0a95110a51f848b2b873e1065">jb_choose_impl</a>(c0);
<a name="l00236"></a>00236       }
<a name="l00237"></a>00237 
<a name="l00238"></a>00238       inuse = 1;
<a name="l00239"></a>00239    }
<a name="l00240"></a>00240 
<a name="l00241"></a>00241    <span class="comment">/* Determine whether audio going to c1 needs a jitter buffer */</span>
<a name="l00242"></a>00242    <span class="keywordflow">if</span> (((!c1_wants_jitter &amp;&amp; c0_creates_jitter) || (c1_force_jb &amp;&amp; c0_creates_jitter)) &amp;&amp; c1_jb_enabled) {
<a name="l00243"></a>00243       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(jb1, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a8ee448ef258f740aeb4e0ea89436af6d">JB_USE</a>);
<a name="l00244"></a>00244       <span class="keywordflow">if</span> (!c1_jb_timebase_initialized) {
<a name="l00245"></a>00245          <span class="keywordflow">if</span> (c0_jb_timebase_initialized) {
<a name="l00246"></a>00246             memcpy(&amp;jb1-&gt;<a class="code" href="structast__jb.html#ab0653ad203e83c307faf381f663e4649" title="The time the jitterbuffer was created.">timebase</a>, &amp;jb0-&gt;<a class="code" href="structast__jb.html#ab0653ad203e83c307faf381f663e4649" title="The time the jitterbuffer was created.">timebase</a>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> timeval));
<a name="l00247"></a>00247          } <span class="keywordflow">else</span> {
<a name="l00248"></a>00248             gettimeofday(&amp;jb1-&gt;<a class="code" href="structast__jb.html#ab0653ad203e83c307faf381f663e4649" title="The time the jitterbuffer was created.">timebase</a>, NULL);
<a name="l00249"></a>00249          }
<a name="l00250"></a>00250          <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(jb1, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140afe2d9a1cb0e496b589437b7faed7f23a">JB_TIMEBASE_INITIALIZED</a>);
<a name="l00251"></a>00251       }
<a name="l00252"></a>00252 
<a name="l00253"></a>00253       <span class="keywordflow">if</span> (!c1_jb_created) {
<a name="l00254"></a>00254          <a class="code" href="abstract__jb_8c.html#ab45f11b0a95110a51f848b2b873e1065">jb_choose_impl</a>(c1);
<a name="l00255"></a>00255       }
<a name="l00256"></a>00256 
<a name="l00257"></a>00257       inuse = 1;
<a name="l00258"></a>00258    }
<a name="l00259"></a>00259 
<a name="l00260"></a>00260    <span class="keywordflow">return</span> inuse;
<a name="l00261"></a>00261 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a252f5415d8e69c1d17597ccb16446a30"></a><!-- doxytag: member="abstract_jb.h::ast_jb_empty_and_reset" ref="a252f5415d8e69c1d17597ccb16446a30" args="(struct ast_channel *c0, struct ast_channel *c1)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_jb_empty_and_reset </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c1</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>drops all frames from a jitterbuffer and resets it </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c0</em>&nbsp;</td><td>one channel of a bridge </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>c1</em>&nbsp;</td><td>the other channel of the bridge </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="abstract__jb_8c_source.html#l00621">621</a> of file <a class="el" href="abstract__jb_8c_source.html">abstract_jb.c</a>.</p>

<p>References <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="abstract__jb_8c_source.html#l00087">ast_jb_impl::empty_and_reset</a>, <a class="el" href="abstract__jb_8h_source.html#l00090">ast_jb::impl</a>, <a class="el" href="channel_8h_source.html#l00451">ast_channel::jb</a>, <a class="el" href="abstract__jb_8c_source.html#l00049">JB_CREATED</a>, <a class="el" href="abstract__jb_8c_source.html#l00047">JB_USE</a>, and <a class="el" href="abstract__jb_8h_source.html#l00092">ast_jb::jbobj</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l04776">ast_generic_bridge()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00622"></a>00622 {
<a name="l00623"></a>00623    <span class="keyword">struct </span><a class="code" href="structast__jb.html" title="General jitterbuffer state.">ast_jb</a> *jb0 = &amp;c0-&gt;<a class="code" href="structast__channel.html#ac9cb7d989f739f5a082bcffd4262d4af">jb</a>;
<a name="l00624"></a>00624    <span class="keyword">struct </span><a class="code" href="structast__jb.html" title="General jitterbuffer state.">ast_jb</a> *jb1 = &amp;c1-&gt;<a class="code" href="structast__channel.html#ac9cb7d989f739f5a082bcffd4262d4af">jb</a>;
<a name="l00625"></a>00625    <span class="keywordtype">int</span> c0_use_jb = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb0, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a8ee448ef258f740aeb4e0ea89436af6d">JB_USE</a>);
<a name="l00626"></a>00626    <span class="keywordtype">int</span> c0_jb_is_created = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb0, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a44ed8c27e26a66b03cedb8d77a424af5">JB_CREATED</a>);
<a name="l00627"></a>00627    <span class="keywordtype">int</span> c1_use_jb = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb1, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a8ee448ef258f740aeb4e0ea89436af6d">JB_USE</a>);
<a name="l00628"></a>00628    <span class="keywordtype">int</span> c1_jb_is_created = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb1, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a44ed8c27e26a66b03cedb8d77a424af5">JB_CREATED</a>);
<a name="l00629"></a>00629 
<a name="l00630"></a>00630    <span class="keywordflow">if</span> (c0_use_jb &amp;&amp; c0_jb_is_created &amp;&amp; jb0-&gt;<a class="code" href="structast__jb.html#abb027c8d7c9c539e7e8ba8a31be7569f" title="Jitterbuffer implementation to be used.">impl</a>-&gt;<a class="code" href="structast__jb__impl.html#a86d5347bd385fb0681a2e2414bff18be">empty_and_reset</a>) {
<a name="l00631"></a>00631       jb0-&gt;<a class="code" href="structast__jb.html#abb027c8d7c9c539e7e8ba8a31be7569f" title="Jitterbuffer implementation to be used.">impl</a>-&gt;<a class="code" href="structast__jb__impl.html#a86d5347bd385fb0681a2e2414bff18be">empty_and_reset</a>(jb0-&gt;<a class="code" href="structast__jb.html#a51035317dc8789dd45eb2879177fea07" title="Jitterbuffer object, passed to the implementation.">jbobj</a>);
<a name="l00632"></a>00632    }
<a name="l00633"></a>00633 
<a name="l00634"></a>00634    <span class="keywordflow">if</span> (c1_use_jb &amp;&amp; c1_jb_is_created &amp;&amp; jb1-&gt;<a class="code" href="structast__jb.html#abb027c8d7c9c539e7e8ba8a31be7569f" title="Jitterbuffer implementation to be used.">impl</a>-&gt;<a class="code" href="structast__jb__impl.html#a86d5347bd385fb0681a2e2414bff18be">empty_and_reset</a>) {
<a name="l00635"></a>00635       jb1-&gt;<a class="code" href="structast__jb.html#abb027c8d7c9c539e7e8ba8a31be7569f" title="Jitterbuffer implementation to be used.">impl</a>-&gt;<a class="code" href="structast__jb__impl.html#a86d5347bd385fb0681a2e2414bff18be">empty_and_reset</a>(jb1-&gt;<a class="code" href="structast__jb.html#a51035317dc8789dd45eb2879177fea07" title="Jitterbuffer object, passed to the implementation.">jbobj</a>);
<a name="l00636"></a>00636    }
<a name="l00637"></a>00637 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a543ca527d26b42c6f50eccb2924ddebd"></a><!-- doxytag: member="abstract_jb.h::ast_jb_get_and_deliver" ref="a543ca527d26b42c6f50eccb2924ddebd" args="(struct ast_channel *c0, struct ast_channel *c1)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_jb_get_and_deliver </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c1</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Deliver the queued frames that should be delivered now for both <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c0</em>&nbsp;</td><td>first bridged channel. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>c1</em>&nbsp;</td><td>second bridged channel.</td></tr>
  </table>
  </dd>
</dl>
<p>Called from <a class="el" href="channel_8c.html#a94b603f7b9476126cafc9e0b82dd7d4d">ast_generic_bridge()</a> to deliver any frames, that should be delivered for the moment of invocation. Does nothing if neihter of the <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> is using jb or has any frames currently queued in. The function delivers frames usig <a class="el" href="channel_8h.html#a79c413d51b7135404d5cacf811649a61" title="Write a frame to a channel This function writes the given frame to the indicated...">ast_write()</a> each of the <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>. </p>

<p>Definition at line <a class="el" href="abstract__jb_8c_source.html#l00368">368</a> of file <a class="el" href="abstract__jb_8c_source.html">abstract_jb.c</a>.</p>

<p>References <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="channel_8h_source.html#l00451">ast_channel::jb</a>, <a class="el" href="abstract__jb_8c_source.html#l00049">JB_CREATED</a>, <a class="el" href="abstract__jb_8c_source.html#l00385">jb_get_and_deliver()</a>, and <a class="el" href="abstract__jb_8c_source.html#l00047">JB_USE</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l04776">ast_generic_bridge()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00369"></a>00369 {
<a name="l00370"></a>00370    <span class="keyword">struct </span><a class="code" href="structast__jb.html" title="General jitterbuffer state.">ast_jb</a> *jb0 = &amp;c0-&gt;<a class="code" href="structast__channel.html#ac9cb7d989f739f5a082bcffd4262d4af">jb</a>;
<a name="l00371"></a>00371    <span class="keyword">struct </span><a class="code" href="structast__jb.html" title="General jitterbuffer state.">ast_jb</a> *jb1 = &amp;c1-&gt;<a class="code" href="structast__channel.html#ac9cb7d989f739f5a082bcffd4262d4af">jb</a>;
<a name="l00372"></a>00372    <span class="keywordtype">int</span> c0_use_jb = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb0, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a8ee448ef258f740aeb4e0ea89436af6d">JB_USE</a>);
<a name="l00373"></a>00373    <span class="keywordtype">int</span> c0_jb_is_created = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb0, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a44ed8c27e26a66b03cedb8d77a424af5">JB_CREATED</a>);
<a name="l00374"></a>00374    <span class="keywordtype">int</span> c1_use_jb = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb1, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a8ee448ef258f740aeb4e0ea89436af6d">JB_USE</a>);
<a name="l00375"></a>00375    <span class="keywordtype">int</span> c1_jb_is_created = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb1, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a44ed8c27e26a66b03cedb8d77a424af5">JB_CREATED</a>);
<a name="l00376"></a>00376 
<a name="l00377"></a>00377    <span class="keywordflow">if</span> (c0_use_jb &amp;&amp; c0_jb_is_created)
<a name="l00378"></a>00378       <a class="code" href="abstract__jb_8c.html#a5cb94ef2c28559777814eaa4a4b12e0f">jb_get_and_deliver</a>(c0);
<a name="l00379"></a>00379 
<a name="l00380"></a>00380    <span class="keywordflow">if</span> (c1_use_jb &amp;&amp; c1_jb_is_created)
<a name="l00381"></a>00381       <a class="code" href="abstract__jb_8c.html#a5cb94ef2c28559777814eaa4a4b12e0f">jb_get_and_deliver</a>(c1);
<a name="l00382"></a>00382 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae38fc3d7573cd890716edca9bcb31766"></a><!-- doxytag: member="abstract_jb.h::ast_jb_get_config" ref="ae38fc3d7573cd890716edca9bcb31766" args="(const struct ast_channel *chan, struct ast_jb_conf *conf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_jb_get_config </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__jb__conf.html">ast_jb_conf</a> *&nbsp;</td>
          <td class="paramname"> <em>conf</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Copies a channel's jitterbuffer configuration. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>conf</em>&nbsp;</td><td>destination. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="abstract__jb_8c_source.html#l00616">616</a> of file <a class="el" href="abstract__jb_8c_source.html">abstract_jb.c</a>.</p>

<p>References <a class="el" href="abstract__jb_8h_source.html#l00088">ast_jb::conf</a>, and <a class="el" href="channel_8h_source.html#l00451">ast_channel::jb</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00617"></a>00617 {
<a name="l00618"></a>00618    memcpy(conf, &amp;chan-&gt;<a class="code" href="structast__channel.html#ac9cb7d989f739f5a082bcffd4262d4af">jb</a>.<a class="code" href="structast__jb.html#a5e0765fcfec251b02238ec7159d3857a" title="Jitterbuffer configuration.">conf</a>, <span class="keyword">sizeof</span>(*conf));
<a name="l00619"></a>00619 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad3f6eb99c87c8fb1d79232762df48354"></a><!-- doxytag: member="abstract_jb.h::ast_jb_get_when_to_wakeup" ref="ad3f6eb99c87c8fb1d79232762df48354" args="(struct ast_channel *c0, struct ast_channel *c1, int time_left)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_jb_get_when_to_wakeup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>time_left</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Calculates the time, left to the closest delivery moment in a bridge. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c0</em>&nbsp;</td><td>first bridged channel. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>c1</em>&nbsp;</td><td>second bridged channel. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>time_left</em>&nbsp;</td><td>bridge time limit, or -1 if not set.</td></tr>
  </table>
  </dd>
</dl>
<p>Called from <a class="el" href="channel_8c.html#a94b603f7b9476126cafc9e0b82dd7d4d">ast_generic_bridge()</a> to determine the maximum time to wait for activity in <a class="el" href="channel_8h.html#aec8ce59b78afbd3651f3de011f13290a" title="Waits for input on a group of channels Wait for input on an array of channels for...">ast_waitfor_n()</a> call. If neihter of the <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> is using jb, this function returns the time limit passed.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>maximum time to wait. </dd></dl>

<p>Definition at line <a class="el" href="abstract__jb_8c_source.html#l00263">263</a> of file <a class="el" href="abstract__jb_8c_source.html">abstract_jb.c</a>.</p>

<p>References <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="abstract__jb_8c_source.html#l00558">get_now()</a>, <a class="el" href="channel_8h_source.html#l00451">ast_channel::jb</a>, <a class="el" href="abstract__jb_8c_source.html#l00049">JB_CREATED</a>, <a class="el" href="abstract__jb_8c_source.html#l00047">JB_USE</a>, and <a class="el" href="abstract__jb_8h_source.html#l00096">ast_jb::next</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l04776">ast_generic_bridge()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00264"></a>00264 {
<a name="l00265"></a>00265    <span class="keyword">struct </span><a class="code" href="structast__jb.html" title="General jitterbuffer state.">ast_jb</a> *jb0 = &amp;c0-&gt;<a class="code" href="structast__channel.html#ac9cb7d989f739f5a082bcffd4262d4af">jb</a>;
<a name="l00266"></a>00266    <span class="keyword">struct </span><a class="code" href="structast__jb.html" title="General jitterbuffer state.">ast_jb</a> *jb1 = &amp;c1-&gt;<a class="code" href="structast__channel.html#ac9cb7d989f739f5a082bcffd4262d4af">jb</a>;
<a name="l00267"></a>00267    <span class="keywordtype">int</span> c0_use_jb = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb0, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a8ee448ef258f740aeb4e0ea89436af6d">JB_USE</a>);
<a name="l00268"></a>00268    <span class="keywordtype">int</span> c0_jb_is_created = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb0, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a44ed8c27e26a66b03cedb8d77a424af5">JB_CREATED</a>);
<a name="l00269"></a>00269    <span class="keywordtype">int</span> c1_use_jb = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb1, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a8ee448ef258f740aeb4e0ea89436af6d">JB_USE</a>);
<a name="l00270"></a>00270    <span class="keywordtype">int</span> c1_jb_is_created = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb1, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a44ed8c27e26a66b03cedb8d77a424af5">JB_CREATED</a>);
<a name="l00271"></a>00271    <span class="keywordtype">int</span> wait, wait0, wait1;
<a name="l00272"></a>00272    <span class="keyword">struct </span>timeval tv_now;
<a name="l00273"></a>00273 
<a name="l00274"></a>00274    <span class="keywordflow">if</span> (time_left == 0) {
<a name="l00275"></a>00275       <span class="comment">/* No time left - the bridge will be retried */</span>
<a name="l00276"></a>00276       <span class="comment">/* TODO: Test disable this */</span>
<a name="l00277"></a>00277       <span class="comment">/*return 0;*/</span>
<a name="l00278"></a>00278    }
<a name="l00279"></a>00279 
<a name="l00280"></a>00280    <span class="keywordflow">if</span> (time_left &lt; 0) {
<a name="l00281"></a>00281       time_left = INT_MAX;
<a name="l00282"></a>00282    }
<a name="l00283"></a>00283 
<a name="l00284"></a>00284    gettimeofday(&amp;tv_now, NULL);
<a name="l00285"></a>00285 
<a name="l00286"></a>00286    wait0 = (c0_use_jb &amp;&amp; c0_jb_is_created) ? jb0-&gt;<a class="code" href="structast__jb.html#a7c51e0a99ee5dbb8d94870937e62f4c0" title="The time the next frame should be played.">next</a> - <a class="code" href="abstract__jb_8c.html#a1f09f2a933351d824c96a8f614261e5c">get_now</a>(jb0, &amp;tv_now) : time_left;
<a name="l00287"></a>00287    wait1 = (c1_use_jb &amp;&amp; c1_jb_is_created) ? jb1-&gt;<a class="code" href="structast__jb.html#a7c51e0a99ee5dbb8d94870937e62f4c0" title="The time the next frame should be played.">next</a> - <a class="code" href="abstract__jb_8c.html#a1f09f2a933351d824c96a8f614261e5c">get_now</a>(jb1, &amp;tv_now) : time_left;
<a name="l00288"></a>00288 
<a name="l00289"></a>00289    wait = wait0 &lt; wait1 ? wait0 : wait1;
<a name="l00290"></a>00290    wait = wait &lt; time_left ? wait : time_left;
<a name="l00291"></a>00291 
<a name="l00292"></a>00292    <span class="keywordflow">if</span> (wait == INT_MAX) {
<a name="l00293"></a>00293       wait = -1;
<a name="l00294"></a>00294    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wait &lt; 1) {
<a name="l00295"></a>00295       <span class="comment">/* don&apos;t let wait=0, because this can cause the pbx thread to loop without any sleeping at all */</span>
<a name="l00296"></a>00296       wait = 1;
<a name="l00297"></a>00297    }
<a name="l00298"></a>00298 
<a name="l00299"></a>00299    <span class="keywordflow">return</span> wait;
<a name="l00300"></a>00300 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a971bdfddf7e452f516dd32991951d581"></a><!-- doxytag: member="abstract_jb.h::ast_jb_put" ref="a971bdfddf7e452f516dd32991951d581" args="(struct ast_channel *chan, struct ast_frame *f)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_jb_put </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td>
          <td class="paramname"> <em>f</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Puts a frame into a channel jitterbuffer. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>f</em>&nbsp;</td><td>frame.</td></tr>
  </table>
  </dd>
</dl>
<p>Called from <a class="el" href="channel_8c.html#a94b603f7b9476126cafc9e0b82dd7d4d">ast_generic_bridge()</a> to put a frame into a channel's jitterbuffer. The function will successfuly enqueue a frame if and only if: 1. the channel is using a jitterbuffer (as determined by <a class="el" href="abstract__jb_8h.html#ad013da092efd28ba7a6a21ee76297a80" title="Checks the need of a jb use in a generic bridge.">ast_jb_do_usecheck()</a>), 2. the frame's type is AST_FRAME_VOICE, 3. the frame has timing info set and has length &gt;= 2 ms, 4. there is no some internal error happened (like failed memory allocation). Frames, successfuly queued, should be delivered by the channel's jitterbuffer, when their delivery time has came. Frames, not successfuly queued, should be delivered immediately. Dropped by the jb implementation frames are considered successfuly enqueued as far as they should not be delivered at all.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if the frame was queued </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>if not </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="abstract__jb_8c_source.html#l00303">303</a> of file <a class="el" href="abstract__jb_8c_source.html">abstract_jb.c</a>.</p>

<p>References <a class="el" href="utils_8h_source.html#l00075">ast_clear_flag</a>, <a class="el" href="frame_8h_source.html#l00124">AST_FRAME_DTMF</a>, <a class="el" href="frame_8h_source.html#l00101">AST_FRAME_VOICE</a>, <a class="el" href="frame_8c_source.html#l00474">ast_frdup()</a>, <a class="el" href="frame_8h_source.html#l00128">AST_FRFLAG_HAS_TIMING_INFO</a>, <a class="el" href="frame_8h_source.html#l00462">ast_frfree</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="abstract__jb_8c_source.html#l00445">create_jb()</a>, <a class="el" href="abstract__jb_8c_source.html#l00086">ast_jb_impl::force_resync</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="abstract__jb_8c_source.html#l00558">get_now()</a>, <a class="el" href="abstract__jb_8h_source.html#l00090">ast_jb::impl</a>, <a class="el" href="channel_8h_source.html#l00451">ast_channel::jb</a>, <a class="el" href="abstract__jb_8c_source.html#l00049">JB_CREATED</a>, <a class="el" href="abstract__jb_8c_source.html#l00162">jb_framelog</a>, <a class="el" href="abstract__jb_8c_source.html#l00146">JB_IMPL_OK</a>, <a class="el" href="abstract__jb_8c_source.html#l00047">JB_USE</a>, <a class="el" href="abstract__jb_8h_source.html#l00092">ast_jb::jbobj</a>, <a class="el" href="frame_8h_source.html#l00169">ast_frame::len</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="abstract__jb_8c_source.html#l00084">ast_jb_impl::next</a>, <a class="el" href="abstract__jb_8h_source.html#l00096">ast_jb::next</a>, <a class="el" href="abstract__jb_8c_source.html#l00082">ast_jb_impl::put</a>, <a class="el" href="frame_8h_source.html#l00157">ast_frame::src</a>, and <a class="el" href="frame_8h_source.html#l00167">ast_frame::ts</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l04776">ast_generic_bridge()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00304"></a>00304 {
<a name="l00305"></a>00305    <span class="keyword">struct </span><a class="code" href="structast__jb.html" title="General jitterbuffer state.">ast_jb</a> *jb = &amp;chan-&gt;<a class="code" href="structast__channel.html#ac9cb7d989f739f5a082bcffd4262d4af">jb</a>;
<a name="l00306"></a>00306    <span class="keyword">struct </span><a class="code" href="structast__jb__impl.html" title="Jitterbuffer implementation private struct.">ast_jb_impl</a> *jbimpl = jb-&gt;<a class="code" href="structast__jb.html#abb027c8d7c9c539e7e8ba8a31be7569f" title="Jitterbuffer implementation to be used.">impl</a>;
<a name="l00307"></a>00307    <span class="keywordtype">void</span> *jbobj = jb-&gt;<a class="code" href="structast__jb.html#a51035317dc8789dd45eb2879177fea07" title="Jitterbuffer object, passed to the implementation.">jbobj</a>;
<a name="l00308"></a>00308    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *frr;
<a name="l00309"></a>00309    <span class="keywordtype">long</span> now = 0;
<a name="l00310"></a>00310 
<a name="l00311"></a>00311    <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a8ee448ef258f740aeb4e0ea89436af6d">JB_USE</a>))
<a name="l00312"></a>00312       <span class="keywordflow">return</span> -1;
<a name="l00313"></a>00313 
<a name="l00314"></a>00314    <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> != <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>) {
<a name="l00315"></a>00315       <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#a248afd6c02044259a386f6b7aee922a2">AST_FRAME_DTMF</a> &amp;&amp; <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a44ed8c27e26a66b03cedb8d77a424af5">JB_CREATED</a>)) {
<a name="l00316"></a>00316          <a class="code" href="abstract__jb_8c.html#a25587b898af76bc590a5d2905a160786" title="Macros for the frame log files.">jb_framelog</a>(<span class="stringliteral">&quot;JB_PUT {now=%ld}: Received DTMF frame. Force resynching jb...\n&quot;</span>, now);
<a name="l00317"></a>00317          jbimpl-&gt;<a class="code" href="structast__jb__impl.html#aeeb89aa0366801501aa518694cad193a">force_resync</a>(jbobj);
<a name="l00318"></a>00318       }
<a name="l00319"></a>00319 
<a name="l00320"></a>00320       <span class="keywordflow">return</span> -1;
<a name="l00321"></a>00321    }
<a name="l00322"></a>00322 
<a name="l00323"></a>00323    <span class="comment">/* We consider an enabled jitterbuffer should receive frames with valid timing info. */</span>
<a name="l00324"></a>00324    <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(f, <a class="code" href="frame_8h.html#a0ae1e3bf78c960c83e2d437efd802058ae8f674e19f6450e2b746c8a52c11649a">AST_FRFLAG_HAS_TIMING_INFO</a>) || f-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a> &lt; 2 || f-&gt;<a class="code" href="structast__frame.html#a1eb46dcb363821328c0d2a758549216b">ts</a> &lt; 0) {
<a name="l00325"></a>00325       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s received frame with invalid timing info: &quot;</span>
<a name="l00326"></a>00326          <span class="stringliteral">&quot;has_timing_info=%d, len=%ld, ts=%ld, src=%s\n&quot;</span>,
<a name="l00327"></a>00327          chan-&gt;name, <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(f, <a class="code" href="frame_8h.html#a0ae1e3bf78c960c83e2d437efd802058ae8f674e19f6450e2b746c8a52c11649a">AST_FRFLAG_HAS_TIMING_INFO</a>), f-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a>, f-&gt;<a class="code" href="structast__frame.html#a1eb46dcb363821328c0d2a758549216b">ts</a>, f-&gt;<a class="code" href="structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a>);
<a name="l00328"></a>00328       <span class="keywordflow">return</span> -1;
<a name="l00329"></a>00329    }
<a name="l00330"></a>00330 
<a name="l00331"></a>00331    frr = <a class="code" href="frame_8h.html#a4b23720d208128250a765490b1a4f145" title="Copies a frame.">ast_frdup</a>(f);
<a name="l00332"></a>00332 
<a name="l00333"></a>00333    <span class="keywordflow">if</span> (!frr) {
<a name="l00334"></a>00334       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to isolate frame for the jitterbuffer on channel &apos;%s&apos;\n&quot;</span>, chan-&gt;name);
<a name="l00335"></a>00335       <span class="keywordflow">return</span> -1;
<a name="l00336"></a>00336    }
<a name="l00337"></a>00337 
<a name="l00338"></a>00338    <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a44ed8c27e26a66b03cedb8d77a424af5">JB_CREATED</a>)) {
<a name="l00339"></a>00339       <span class="keywordflow">if</span> (<a class="code" href="abstract__jb_8c.html#a1af5788183300b288581f5606bcadcb1">create_jb</a>(chan, frr)) {
<a name="l00340"></a>00340          <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(frr);
<a name="l00341"></a>00341          <span class="comment">/* Disable the jitterbuffer */</span>
<a name="l00342"></a>00342          <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(jb, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a8ee448ef258f740aeb4e0ea89436af6d">JB_USE</a>);
<a name="l00343"></a>00343          <span class="keywordflow">return</span> -1;
<a name="l00344"></a>00344       }
<a name="l00345"></a>00345 
<a name="l00346"></a>00346       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(jb, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a44ed8c27e26a66b03cedb8d77a424af5">JB_CREATED</a>);
<a name="l00347"></a>00347       <span class="keywordflow">return</span> 0;
<a name="l00348"></a>00348    } <span class="keywordflow">else</span> {
<a name="l00349"></a>00349       now = <a class="code" href="abstract__jb_8c.html#a1f09f2a933351d824c96a8f614261e5c">get_now</a>(jb, NULL);
<a name="l00350"></a>00350       <span class="keywordflow">if</span> (jbimpl-&gt;<a class="code" href="structast__jb__impl.html#aee1fbf86e67d9bacc09a0dd8d77171bd">put</a>(jbobj, frr, now) != <a class="code" href="abstract__jb_8c.html#a52864abcf6ebd8d120995b36fe6ce06ead66978f8f133d1d59c73904b675b170a">JB_IMPL_OK</a>) {
<a name="l00351"></a>00351          <a class="code" href="abstract__jb_8c.html#a25587b898af76bc590a5d2905a160786" title="Macros for the frame log files.">jb_framelog</a>(<span class="stringliteral">&quot;JB_PUT {now=%ld}: Dropped frame with ts=%ld and len=%ld\n&quot;</span>, now, frr-&gt;<a class="code" href="structast__frame.html#a1eb46dcb363821328c0d2a758549216b">ts</a>, frr-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a>);
<a name="l00352"></a>00352          <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(frr);
<a name="l00353"></a>00353          <span class="comment">/*return -1;*/</span>
<a name="l00354"></a>00354          <span class="comment">/* TODO: Check this fix - should return 0 here, because the dropped frame shouldn&apos;t</span>
<a name="l00355"></a>00355 <span class="comment">            be delivered at all */</span>
<a name="l00356"></a>00356          <span class="keywordflow">return</span> 0;
<a name="l00357"></a>00357       }
<a name="l00358"></a>00358 
<a name="l00359"></a>00359       jb-&gt;<a class="code" href="structast__jb.html#a7c51e0a99ee5dbb8d94870937e62f4c0" title="The time the next frame should be played.">next</a> = jbimpl-&gt;<a class="code" href="structast__jb__impl.html#a9343b518a13ed73bb3f42c41792d7dee">next</a>(jbobj);
<a name="l00360"></a>00360 
<a name="l00361"></a>00361       <a class="code" href="abstract__jb_8c.html#a25587b898af76bc590a5d2905a160786" title="Macros for the frame log files.">jb_framelog</a>(<span class="stringliteral">&quot;JB_PUT {now=%ld}: Queued frame with ts=%ld and len=%ld\n&quot;</span>, now, frr-&gt;<a class="code" href="structast__frame.html#a1eb46dcb363821328c0d2a758549216b">ts</a>, frr-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a>);
<a name="l00362"></a>00362 
<a name="l00363"></a>00363       <span class="keywordflow">return</span> 0;
<a name="l00364"></a>00364    }
<a name="l00365"></a>00365 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae50ad081bd2ae6b58bcfc4687916c586"></a><!-- doxytag: member="abstract_jb.h::ast_jb_read_conf" ref="ae50ad081bd2ae6b58bcfc4687916c586" args="(struct ast_jb_conf *conf, const char *varname, const char *value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_jb_read_conf </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__jb__conf.html">ast_jb_conf</a> *&nbsp;</td>
          <td class="paramname"> <em>conf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>varname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>value</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Sets jitterbuffer configuration property. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>conf</em>&nbsp;</td><td>configuration to store the property in. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>varname</em>&nbsp;</td><td>property name. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>value</em>&nbsp;</td><td>property value.</td></tr>
  </table>
  </dd>
</dl>
<p>Called from a channel driver to build a jitterbuffer configuration typically when reading a configuration file. It is not necessary for a channel driver to know each of the jb configuration property names. The jitterbuffer itself knows them. The channel driver can pass each config var it reads through this function. It will return 0 if the variable was consumed from the jb conf.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>zero if the property was set to the configuration, -1 if not. </dd></dl>

<p>Definition at line <a class="el" href="abstract__jb_8c_source.html#l00571">571</a> of file <a class="el" href="abstract__jb_8c_source.html">abstract_jb.c</a>.</p>

<p>References <a class="el" href="abstract__jb_8h_source.html#l00070">AST_JB_CONF_ENABLE</a>, <a class="el" href="abstract__jb_8h_source.html#l00071">AST_JB_CONF_FORCE</a>, <a class="el" href="abstract__jb_8h_source.html#l00075">AST_JB_CONF_IMPL</a>, <a class="el" href="abstract__jb_8h_source.html#l00076">AST_JB_CONF_LOG</a>, <a class="el" href="abstract__jb_8h_source.html#l00072">AST_JB_CONF_MAX_SIZE</a>, <a class="el" href="abstract__jb_8h_source.html#l00069">AST_JB_CONF_PREFIX</a>, <a class="el" href="abstract__jb_8h_source.html#l00073">AST_JB_CONF_RESYNCH_THRESHOLD</a>, <a class="el" href="abstract__jb_8h_source.html#l00074">AST_JB_CONF_TARGET_EXTRA</a>, <a class="el" href="abstract__jb_8h_source.html#l00043">AST_JB_ENABLED</a>, <a class="el" href="abstract__jb_8h_source.html#l00044">AST_JB_FORCED</a>, <a class="el" href="abstract__jb_8h_source.html#l00045">AST_JB_LOG</a>, <a class="el" href="utils_8h_source.html#l00092">ast_set2_flag</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="utils_8c_source.html#l01311">ast_true()</a>, <a class="el" href="abstract__jb_8h_source.html#l00062">ast_jb_conf::impl</a>, <a class="el" href="abstract__jb_8h_source.html#l00058">ast_jb_conf::max_size</a>, <a class="el" href="cdr__adaptive__odbc_8c_source.html#l00053">name</a>, <a class="el" href="abstract__jb_8h_source.html#l00060">ast_jb_conf::resync_threshold</a>, and <a class="el" href="abstract__jb_8h_source.html#l00064">ast_jb_conf::target_extra</a>.</p>

<p>Referenced by <a class="el" href="misdn__config_8c_source.html#l00947">_build_general_config()</a>, <a class="el" href="chan__skinny_8c_source.html#l06537">config_parse_variables()</a>, <a class="el" href="chan__gtalk_8c_source.html#l01901">gtalk_load_config()</a>, <a class="el" href="chan__jingle_8c_source.html#l01724">jingle_load_config()</a>, <a class="el" href="chan__alsa_8c_source.html#l00852">load_module()</a>, <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, <a class="el" href="chan__h323_8c_source.html#l02832">reload_config()</a>, <a class="el" href="chan__usbradio_8c_source.html#l03406">store_config()</a>, and <a class="el" href="chan__console_8c_source.html#l01277">store_config_core()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00572"></a>00572 {
<a name="l00573"></a>00573    <span class="keywordtype">int</span> prefixlen = <span class="keyword">sizeof</span>(<a class="code" href="abstract__jb_8h.html#aff7a5dfaf7cb79efb8e9ddc564212d1c">AST_JB_CONF_PREFIX</a>) - 1;
<a name="l00574"></a>00574    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>;
<a name="l00575"></a>00575    <span class="keywordtype">int</span> tmp;
<a name="l00576"></a>00576 
<a name="l00577"></a>00577    <span class="keywordflow">if</span> (strncasecmp(<a class="code" href="abstract__jb_8h.html#aff7a5dfaf7cb79efb8e9ddc564212d1c">AST_JB_CONF_PREFIX</a>, varname, prefixlen)) {
<a name="l00578"></a>00578       <span class="keywordflow">return</span> -1;
<a name="l00579"></a>00579    }
<a name="l00580"></a>00580 
<a name="l00581"></a>00581    name = varname + prefixlen;
<a name="l00582"></a>00582 
<a name="l00583"></a>00583    <span class="keywordflow">if</span> (!strcasecmp(name, <a class="code" href="abstract__jb_8h.html#a168e0e7cbd179c4aceefd8bb42c3a408">AST_JB_CONF_ENABLE</a>)) {
<a name="l00584"></a>00584       <a class="code" href="utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(conf, <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(value), <a class="code" href="abstract__jb_8h.html#aad393aa3e173d7f081ab4bbc6ba5027daf49c3e265d3ff27e62d8c38779d89dd9">AST_JB_ENABLED</a>);
<a name="l00585"></a>00585    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(name, <a class="code" href="abstract__jb_8h.html#ad9f3ff3a64a627dd8ec08e92e32081c3">AST_JB_CONF_FORCE</a>)) {
<a name="l00586"></a>00586       <a class="code" href="utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(conf, <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(value), <a class="code" href="abstract__jb_8h.html#aad393aa3e173d7f081ab4bbc6ba5027dac9bdd81232f2ef32fad9ebd0b92b9f63">AST_JB_FORCED</a>);
<a name="l00587"></a>00587    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(name, <a class="code" href="abstract__jb_8h.html#adf4913cb009ccd8f95dc5cc6422872b9">AST_JB_CONF_MAX_SIZE</a>)) {
<a name="l00588"></a>00588       <span class="keywordflow">if</span> ((tmp = atoi(value)) &gt; 0)
<a name="l00589"></a>00589          conf-&gt;<a class="code" href="structast__jb__conf.html#aaba39ba18eb00647786272b9061659e3" title="Max size of the jitterbuffer implementation.">max_size</a> = tmp;
<a name="l00590"></a>00590    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(name, <a class="code" href="abstract__jb_8h.html#a1c488fb41b043a2e392f6ecd6e78f3ed">AST_JB_CONF_RESYNCH_THRESHOLD</a>)) {
<a name="l00591"></a>00591       <span class="keywordflow">if</span> ((tmp = atoi(value)) &gt; 0)
<a name="l00592"></a>00592          conf-&gt;<a class="code" href="structast__jb__conf.html#ab5d708c3e3489b6fd1f92b19939c18e8" title="Resynchronization threshold of the jitterbuffer implementation.">resync_threshold</a> = tmp;
<a name="l00593"></a>00593    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(name, <a class="code" href="abstract__jb_8h.html#a3025d70ca72b1abc6983d3f18c50b899">AST_JB_CONF_IMPL</a>)) {
<a name="l00594"></a>00594       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(value))
<a name="l00595"></a>00595          snprintf(conf-&gt;<a class="code" href="structast__jb__conf.html#a60072c5fdc7f8f7772e49783b48e37a6" title="Name of the jitterbuffer implementation to be used.">impl</a>, <span class="keyword">sizeof</span>(conf-&gt;<a class="code" href="structast__jb__conf.html#a60072c5fdc7f8f7772e49783b48e37a6" title="Name of the jitterbuffer implementation to be used.">impl</a>), <span class="stringliteral">&quot;%s&quot;</span>, value);
<a name="l00596"></a>00596    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(name, <a class="code" href="abstract__jb_8h.html#aec196522d0bff37d617dab5fcb403a46">AST_JB_CONF_TARGET_EXTRA</a>)) {
<a name="l00597"></a>00597       <span class="keywordflow">if</span> (sscanf(value, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;tmp) == 1) {
<a name="l00598"></a>00598          conf-&gt;<a class="code" href="structast__jb__conf.html#a322d898485ffd6c3c07391f381903bdd" title="amount of additional jitterbuffer adjustment">target_extra</a> = tmp;
<a name="l00599"></a>00599       }
<a name="l00600"></a>00600    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(name, <a class="code" href="abstract__jb_8h.html#a30af15dd4b567ed1950e7b3a78d9a89f">AST_JB_CONF_LOG</a>)) {
<a name="l00601"></a>00601       <a class="code" href="utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(conf, <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(value), <a class="code" href="abstract__jb_8h.html#aad393aa3e173d7f081ab4bbc6ba5027dae6ca3d7ddaa509b36e1fb4c36c18478e">AST_JB_LOG</a>);
<a name="l00602"></a>00602    } <span class="keywordflow">else</span> {
<a name="l00603"></a>00603       <span class="keywordflow">return</span> -1;
<a name="l00604"></a>00604    }
<a name="l00605"></a>00605 
<a name="l00606"></a>00606    <span class="keywordflow">return</span> 0;
<a name="l00607"></a>00607 }
</pre></div></p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:18:50 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
